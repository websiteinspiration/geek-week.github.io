<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦🏿 🤰🏾 🔀 Java 14で改善されたinstanceofオペレーターを試す 🏬 🚨 💛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="さほど遠くないところに、 Javaの新しいバージョン14があります。つまり、このバージョンのJavaに含まれる新しい構文機能を確認するときが来ました。これらの構文の可能性の1つは、改良された（拡張された）演算子によって実行されるタイプのパターンマッチングですinstanceof。
 
 今日、私はこ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Java 14で改善されたinstanceofオペレーターを試す</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477654/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さほど遠くないところに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Javaの</font><font style="vertical-align: inherit;">新しい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">バージョン14があり</font></a><font style="vertical-align: inherit;">ます。つまり、このバージョンのJavaに含まれる新しい構文機能を確認するときが来ました。これらの構文の可能性の1つは</font><font style="vertical-align: inherit;">、改良された（拡張された）演算子によって実行される</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプのパターンマッチングです</font></font></a><font style="vertical-align: inherit;"></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、私はこの新しいオペレーターで遊んで、その仕事の特徴をより詳細に検討したいと思います。タイプによるパターンマッチングはまだメインのJDKリポジトリに入っていない</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ため、</font></a><font style="vertical-align: inherit;">新しいJava構文構造を開発して</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるAmberプロジェクトの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリをダウンロードし、</font><font style="vertical-align: inherit;">このリポジトリから</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">収集する必要がありました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最初に行うことは、Javaバージョンをチェックして、JDK 14が実際に使用されていることを確認することです。</font></font><br>
<br>
<pre><code class="bash hljs">&gt; java -version<font></font>
openjdk version <span class="hljs-string">"14-internal"</span> 2020-03-17<font></font>
OpenJDK Runtime Environment (build 14-internal+0-adhoc.osboxes.amber-amber)<font></font>
OpenJDK 64-Bit Server VM (build 14-internal+0-adhoc.osboxes.amber-amber, mixed mode, sharing)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのとおり。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、「古い」演算子を使用して小さなコードを記述し、</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> A().f(<span class="hljs-string">"Hello, world!"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Object obj)</span> </span>{
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String) {<font></font>
            String str = (String) obj;<font></font>
            System.out.println(str.toLowerCase());<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="bash hljs">&gt; java A.java<font></font>
hello, world!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動作します。</font><font style="vertical-align: inherit;">これは、標準の型チェックとそれに続くキャストです。</font><font style="vertical-align: inherit;">使用するJavaのバージョン（少なくとも1.0、少なくとも13）に関係なく、毎日同様の構造を作成していますが、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今やJava 14が手元にあるので、改良された演算子を使用してコードを書き直しましょう</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（将来、繰り返されるコード行は省略します）。 ：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">&gt; java --<span class="hljs-built_in">enable</span>-preview --<span class="hljs-built_in">source</span> 14 A.java<font></font>
hello, world!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完璧に。</font><font style="vertical-align: inherit;">コードはより簡潔、より短く、より安全で読みやすくなっています。</font><font style="vertical-align: inherit;">文字列という単語の繰り返しが3回ありました。</font><font style="vertical-align: inherit;">私たちは、引数を指定することを忘れなかったことを注意</font></font><code>--enable-preview --source 14</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として、</font><font style="vertical-align: inherit;">新しい演算子は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレビュー機能です</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">さらに、注意深い読者はおそらく、A.javaソースファイルをコンパイルせずに直接実行したことに気づいたでしょう。</font><font style="vertical-align: inherit;">そのような機会</font><font style="vertical-align: inherit;">はJava 11に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登場し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もっと洗練されたものを書いて、宣言したばかりの変数を使用する2番目の条件を追加してみましょう。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str &amp;&amp; str.length() &gt; <span class="hljs-number">5</span>) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイルして動作します。</font><font style="vertical-align: inherit;">しかし、条件を交換するとどうなりますか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (str.length() &gt; <span class="hljs-number">5</span> &amp;&amp; obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">A.java:7: error: cannot find symbol
        <span class="hljs-keyword">if</span> (str.length() &gt; 5 &amp;&amp; obj instanceof String str) {<font></font>
            ^</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイルエラー。</font><font style="vertical-align: inherit;">予期されること：変数は</font></font><code>str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まだ宣言されていないため、使用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ところで、可変性についてはどうですか？</font><font style="vertical-align: inherit;">変数はfinalですか？</font><font style="vertical-align: inherit;">私たちは試みます：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
    str = <span class="hljs-string">"World, hello!"</span>;<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">A.java:8: error: pattern binding str may not be assigned<font></font>
    str = <span class="hljs-string">"World, hello!"</span>;<font></font>
    ^</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ええ、最後の変数です。</font><font style="vertical-align: inherit;">これは、「変数」という単語がここでは完全に正しくないことを意味します。</font><font style="vertical-align: inherit;">また、コンパイラは「パターンバインディング」という特別な用語を使用します。</font><font style="vertical-align: inherit;">したがって、今後は「変数」ではなく「パターンバインディング」と言います（残念ながら、「バインディング」という言葉はロシア語にうまく翻訳されていません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可変性と用語が整理されています。</font><font style="vertical-align: inherit;">さらに実験してみましょう。</font><font style="vertical-align: inherit;">コンパイラを「壊す」ことができたらどうでしょうか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数とパターンバインディングに同じ名前を付けるとどうなりますか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String obj) {<font></font>
    System.out.println(obj.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">A.java:7: error: variable obj is already defined <span class="hljs-keyword">in</span> method f(Object)
<span class="hljs-keyword">if</span> (obj instanceof String obj) {<font></font>
                          ^</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
論理的です。</font><font style="vertical-align: inherit;">外部スコープからの変数の重複は機能しません。</font><font style="vertical-align: inherit;">これは</font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、同じスコープ内で</font><font style="vertical-align: inherit;">変数を</font><font style="vertical-align: inherit;">2回</font><font style="vertical-align: inherit;">だけ単純に巻いた場合</font><font style="vertical-align: inherit;">と同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそうならば：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str &amp;&amp; obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">A.java:7: error: illegal attempt to redefine an existing match binding
<span class="hljs-keyword">if</span> (obj instanceof String str &amp;&amp; obj instanceof String str) {<font></font>
                              ^</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイラーは、コンクリートのようにしっかりしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他に何ができますか？</font><font style="vertical-align: inherit;">スコープをいじってみましょう。</font><font style="vertical-align: inherit;">場合は</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、バインディングが枝に定義されている</font></font><code>else</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">それがブランチで定義される</font><font style="vertical-align: inherit;">状態が反転している場合は？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (!(obj <span class="hljs-keyword">instanceof</span> String str)) {<font></font>
    System.out.println(<span class="hljs-string">"not a string"</span>);<font></font>
} <span class="hljs-keyword">else</span> {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動いた。</font><font style="vertical-align: inherit;">コンパイラは信頼できるだけでなく、スマートでもあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそうならば？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str &amp;&amp; <span class="hljs-keyword">true</span>) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは再び働いた。</font><font style="vertical-align: inherit;">コンパイラーは、条件が単純な条件に削減されたことを正しく理解し</font></font><code>obj instanceof String str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイラを「壊す」ことは本当に不可能ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多分そうですか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str || <span class="hljs-keyword">false</span>) {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br>
<pre><code class="bash hljs">A.java:8: error: cannot find symbol<font></font>
    System.out.println(str.toLowerCase());<font></font>
                       ^<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
うん！</font><font style="vertical-align: inherit;">これはすでにバグのようです。</font><font style="vertical-align: inherit;">結局のところ、3つの条件はすべてまったく同等です。</font></font><br>
<br>
<ul>
<li><code>obj instanceof String str</code></li>
<li><code>obj instanceof String str &amp;&amp; true</code></li>
<li><code>obj instanceof String str || false</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、フロースコーピングルールはかなり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、おそらくそのようなケースは実際には機能しないはずです。</font><font style="vertical-align: inherit;">しかし、純粋に人間の視点から見ると、これはバグだと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、さあ、他のことを試してみましょう。</font><font style="vertical-align: inherit;">これは機能しますか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (!(obj <span class="hljs-keyword">instanceof</span> String str)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();<font></font>
}<font></font>
System.out.println(str.toLowerCase());</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
編集済み。</font><font style="vertical-align: inherit;">このコードは以下と同等であるため、これは適切です。</font></font><br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (!(obj <span class="hljs-keyword">instanceof</span> String str)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException();<font></font>
} <span class="hljs-keyword">else</span> {<font></font>
    System.out.println(str.toLowerCase());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、両方のオプションは同等であるため、プログラマはそれらが同じように機能することを期待しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重複するフィールドについてはどうですか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-keyword">private</span> String str;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Object obj)</span> </span>{
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
            System.out.println(str.toLowerCase());<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            System.out.println(str.toLowerCase());<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイラは誓いませんでした。</font><font style="vertical-align: inherit;">ローカル変数は常にフィールドと重複する可能性があるため、これは論理的です。</font><font style="vertical-align: inherit;">どうやら、彼らはまた、パターンバインディングの例外を作らないことに決めました。</font><font style="vertical-align: inherit;">一方、そのようなコードはかなり壊れやすいものです。</font><font style="vertical-align: inherit;">一つの不注意な動き、そしてあなたはあなたのブランチ</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">どのように</font><font style="vertical-align: inherit;">壊れた</font><font style="vertical-align: inherit;">か気付かないかもしれません</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOK</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Object obj)</span> </span>{
    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str || isOK()) {<font></font>
        System.out.println(str.toLowerCase());<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        System.out.println(str.toLowerCase());<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、両方のブランチでfieldが使用されています</font></font><code>str</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このようなエラーをできるだけ早く検出するには、IDEの検査と、フィールドおよび変数のさまざまな構文の強調表示を使用します。</font><font style="vertical-align: inherit;">また、常に</font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールド</font><font style="vertical-align: inherit;">修飾子を使用することをお勧めします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、信頼性がさらに向上します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他に何が面白いですか？</font><font style="vertical-align: inherit;">「古い」のよう</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、新しいものは決して一致しません</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、パターンバインダーが決してあり得ないという事実に常に依存できることを意味します</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String str) {<font></font>
    System.out.println(str.toLowerCase()); <span class="hljs-comment">//    NullPointerException</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、このプロパティを使用すると、そのようなチェーンを短縮できます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (a != <span class="hljs-keyword">null</span>) {<font></font>
    B b = a.getB();<font></font>
    <span class="hljs-keyword">if</span> (b != <span class="hljs-keyword">null</span>) {<font></font>
        C c = b.getC();<font></font>
        <span class="hljs-keyword">if</span> (c != <span class="hljs-keyword">null</span>) {<font></font>
            System.out.println(c.getSize());<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用する場合</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、上記のコードは次のように書き直すことができます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (a != <span class="hljs-keyword">null</span> &amp;&amp; a.getB() <span class="hljs-keyword">instanceof</span> B b &amp;&amp; b.getC() <span class="hljs-keyword">instanceof</span> C c) {<font></font>
    System.out.println(c.getSize());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このスタイルについてどう思うかコメントに書いてください。</font><font style="vertical-align: inherit;">このイディオムを使用しますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ジェネリックはどうですか？</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> java.util.List;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">new</span> A().f(List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Object obj)</span> </span>{
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> List&lt;Integer&gt; list) {<font></font>
            System.out.println(list.size());<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="bash hljs">&gt; java --<span class="hljs-built_in">enable</span>-preview --<span class="hljs-built_in">source</span> 14 A.java<font></font>
Note: A.java uses unchecked or unsafe operations.<font></font>
Note: Recompile with -Xlint:unchecked <span class="hljs-keyword">for</span> details.<font></font>
3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とても興味深い。</font><font style="vertical-align: inherit;">「古い」</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><code>instanceof List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font><font style="vertical-align: inherit;">のみをサポートしている</font><font style="vertical-align: inherit;">場合</font></font><code>instanceof List&lt;?&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、新しいものは特定のタイプで機能します。</font><font style="vertical-align: inherit;">私たちは最初の人がそのような罠に陥るのを待っています：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> List&lt;Integer&gt; list) {<font></font>
    System.out.println(<span class="hljs-string">"Int list of size "</span> + list.size());<font></font>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> List&lt;String&gt; list) {<font></font>
    System.out.println(<span class="hljs-string">"String list of size "</span> + list.size());<font></font>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜこれが機能しないのですか？</font></font></b><div class="spoiler_text">:  reified generics  Java.</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私見、これはかなり深刻な問題です。</font><font style="vertical-align: inherit;">一方、私はそれを修正する方法を知りません。</font><font style="vertical-align: inherit;">IDEでの検査に再度依存する必要があるようです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、新しいパターンマッチングタイプは非常に優れています。</font><font style="vertical-align: inherit;">改善された演算子を</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、タイプテストを実行できるだけでなく、このタイプの既製のバインダーを宣言して、手動でキャストする必要がなくなります。</font><font style="vertical-align: inherit;">つまり、コード内のノイズが少なくなり、読者が有用なロジックを識別しやすくなります。</font><font style="vertical-align: inherit;">たとえば、ほとんどの実装</font></font><code>equals()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は1行で記述できます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> x, y;<font></font>
    …<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> Objects.hash(x, y);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>{
        <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> Point p &amp;&amp; p.x == <span class="hljs-keyword">this</span>.x &amp;&amp; p.y == <span class="hljs-keyword">this</span>.y;<font></font>
    }<font></font>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記のコードはさらに短く書くことができます。</font><font style="vertical-align: inherit;">どうやって？</font></font></b><div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,     Java 14.       .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、いくつかの物議を醸している問題は小さな質問を提起します：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全に透過的なスコープルールではありません（例c </font></font><code>instanceof || false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重複するフィールド。</font></font></li>
<li><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> とジェネリック。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これらは深刻な主張よりもささいなことです。</font><font style="vertical-align: inherit;">全体として、新しいオペレーターの莫大な利点は、</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その言語を追加する価値があります。</font><font style="vertical-align: inherit;">そして、彼がまだプレビュー状態を離れて安定した構文になる場合、これは最終的にJava 8を新しいバージョンのJavaに任せる大きな動機になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS私は</font><font style="vertical-align: inherit;">Javaニュースについて書く</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャンネルをTelegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に持ってい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ぜひご購読ください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja477638/index.html">Bought！= Yours：John Deereが農家からトラクターを修理する権利を奪う</a></li>
<li><a href="../ja477642/index.html">機械（無線）ビジョンが壁越しに見える</a></li>
<li><a href="../ja477644/index.html">UNIX v0からPDP-7への復元：バックルームの詳細</a></li>
<li><a href="../ja477646/index.html">数学者は方程式の一部を求めて数字を切り取る</a></li>
<li><a href="../ja477650/index.html">Stunnelを使用したGOST-2012アルゴリズムによるTLSトラフィックの暗号化</a></li>
<li><a href="../ja477656/index.html">それでも、なぜmakeが必要なのですか？</a></li>
<li><a href="../ja477658/index.html">アクティブリストア：災害復旧を高速化できますか？はるかに高速？</a></li>
<li><a href="../ja477662/index.html">FTDIブリッジ上のReddタイヤへのアクセス</a></li>
<li><a href="../ja477668/index.html">11月29日午後6時-devleads-mitap</a></li>
<li><a href="../ja477670/index.html">テストを自動化するもの</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>