<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔨 🏥 👨‍👩‍👦 卫星与反塔融合 🔧 👨‍🚒 💐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="使用Red Hat Satellite和Red Hat Ansible自动化平台？从Satellite 6.3开始，它们可以彼此集成，以便Ansible Tower中的动态清单从Satellite提取主机列表。此外，如果使用Satellite初始化RHEL主机（即配置），则可以在此过程中内置Ansi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>卫星与反塔融合</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/491138/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Red Hat Satellite和Red Hat Ansible自动化平台？从Satellite 6.3开始，它们可以彼此集成，以便Ansible Tower中的动态清单从Satellite提取主机列表。此外，如果使用Satellite初始化RHEL主机（即配置），则可以在此过程中内置Ansible Tower，以便它在新主机上自动运行配置脚本。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/4o/so/qq4oso9wx_wxkl81ha7aiy1b18a.jpeg" width="100%"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我们将研究如何在Ansible Tower中配置动态广告资源，以使其从Satellite中提取主机，并通过示例展示如何使用它。此外，我们将向您展示在从Satellite初始化新主机后如何组织自动呼叫Ansible Tower。</font></font><br>
<a name="habracut"></a><br>
<h3> 1.    Inventory.  Satellite,       Dynamic Inventory  Ansible Tower</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使Ansible Tower能够访问主机，主机组和其他相关信息的列表，它需要在Satellite中有一个帐户。该条目具有足够的最小权限，因此我们将在Satellite中创建一个新角色，仅为其授予Ansible Tower所需的权限，然后创建一个新帐户并为其分配此角色。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satellite 6.6和更高版本已经为此准备好了Ansible Tower库存读取器角色，因此您可以跳过以下步骤来创建角色。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Satellite 6.3-6.5中，必须手动创建角色。为此，请转到Satellite Web界面，转到“管理”屏幕，选择“角色”，然后单击“创建角色”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将此角色</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名为ansible_tower_integration_role</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><b><font style="vertical-align: inherit;">为其</font></b><font style="vertical-align: inherit;">设置</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置和组织</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/oy/ey/ocoyeyrceo04wboamjmzv_2nnf0.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
单击提交以创建角色。之后，点击她的名字，然后转到“过滤器”标签。单击绿色的“新建过滤器”按钮，并一次添加以下过滤器：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
资源类型：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，权限：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_hosts</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
资源类型：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机组</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，权限：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_hostgroups</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
资源类型：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实值</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，权限：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_facts</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
因此，以下过滤器应具有一定的作用：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cc/ia/r-/cciar-m-0-bz63n2lrijzatkbrg.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们创建了一个角色。现在，我们将在Satellite中启动一个新用户，进入“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜单</font><font style="vertical-align: inherit;">，选择“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后点击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建用户</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们将此用户</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名为ansible_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorized by</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数更改</font><font style="vertical-align: inherit;">为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNAL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并设置密码。然后，在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置和组织”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡上，</font><font style="vertical-align: inherit;">选择适当的位置/组织。最后，转到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡，</font><font style="vertical-align: inherit;">并为该用户分配新创建的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible_tower_integration_role</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色</font><font style="vertical-align: inherit;">（如果您有Satellite </font><b><font style="vertical-align: inherit;">6.3-6.5</font></b><font style="vertical-align: inherit;">）或内置的</font><b><font style="vertical-align: inherit;">Ansible Tower广告资源阅读器</font></b><font style="vertical-align: inherit;">角色</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（卫星6.6及更高版本）。</font><font style="vertical-align: inherit;">最后，单击提交为该用户创建一个帐户。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定制Ansible塔</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在转到Ansible Tower Web界面并转到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭证”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">单击绿色的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+（添加）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font><font style="vertical-align: inherit;">创建一个新的凭据条目。</font><font style="vertical-align: inherit;">我们将其称为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在凭据类型中指定</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red Hat Satellite 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，输入URL（在本例中为Satellite 6）和用户名（在本例中为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），密码是我们在上面的Satellite中设置的密码：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/xd/ws/ybxdws81uadmggdncbl_icg-ig8.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后点击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，进入“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库存”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕</font><font style="vertical-align: inherit;">，单击绿色的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+（添加）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮，</font><font style="vertical-align: inherit;">然后选择“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库存”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定satellite_inventory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为名称</font><font style="vertical-align: inherit;">，然后单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以创建清单。之后，转到新创建的清单的“源”选项卡，然后单击绿色的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+（添加）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font><font style="vertical-align: inherit;">。我们使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卫星</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为源名称</font><font style="vertical-align: inherit;">，并将源类型指定为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red Hat Satellite 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在“凭据”字段中，指定</font><font style="vertical-align: inherit;">上一步中创建的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。启用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖复选框</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“更新选项”控制组中的“ </font><b><font style="vertical-align: inherit;">覆盖变量</font></b><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时更新”（您可以使用右侧的问号了解有关这些选项的更多信息）。</font><font style="vertical-align: inherit;">另外，在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存超时（秒）”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中，</font><font style="vertical-align: inherit;">输入90并单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0n/_2/0j/0n_20jc394t3fh9vkxz00cqda3w.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，无需离开</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡</font><font style="vertical-align: inherit;">，单击</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start sync process</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图标</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gz/ys/um/gzysumhr2fghwc0l-xymeofs7cu.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们等到图标变成绿色-这表明同步已成功完成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，您可以转到“主机”选项卡，查看从Satellite提取的数据：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ne/4_/qk/ne4_qk5ne8ohsfx3iriwkkdfbvm.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您还可以查看“网上论坛”标签：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oj/sw/af/ojswafnsedywlukqweh3oib_hgu.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如您所见，同步不仅从Satellite提取主机列表，而且根据Satellite中的相应内容视图，主机组，生命周期环境，位置和组织将它们分为几组。</font><font style="vertical-align: inherit;">该分组可用于将目标主机上的Ansible脚本作为目标，这是非常强大的功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在“主机”选项卡上选择一个主机，我们将看到在Satellite和Ansible Tower之间，有关该主机的许多辅助信息都是同步的，这些信息以变量的形式显示。</font><font style="vertical-align: inherit;">然后可以在Ansible脚本中使用这些变量：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/la/6o/fw/la6ofwr3cf91cfxktzok_0eoy7c.png"></div><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用与卫星关联的动态广告资源</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们同步了卫星和Ansible塔，现在我们将考虑如何在实践中使用它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最简单的方法是</font><font style="vertical-align: inherit;">在Ansible Tower模板中</font><font style="vertical-align: inherit;">使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_inventory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为清单源。如果在脚本中指定了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosts：all</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">，则该脚本将在所有Satellite主机上运行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个更高级的选项是在脚本中使用自动创建的清单组（如何创建它们-请参见上文），换句话说，在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行中指定所需的主机组</font><font style="vertical-align: inherit;">。例如，在这种情况下，其中安装了屏幕软件包：</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Install screen package<font></font>
  hosts: "foreman_hostgroup_rhel6"<font></font>
  tasks:<font></font>
  - yum:<font></font>
      name: screen<font></font>
      state: installed<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们已经注册了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机：foreman_hostgroup_rhel6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从而指示了Satellite中组成rhel6主机组的主机列表。</font><font style="vertical-align: inherit;">因此，该脚本将仅在这些主机上执行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，在脚本中，您可以在主机行中指定Ansible Tower与Satellite同步期间接收到的那些变量。</font><font style="vertical-align: inherit;">例如，您可以这样做：</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Install screen package<font></font>
  hosts: "{{ hosts_var }}"<font></font>
  tasks:<font></font>
  - yum:<font></font>
      name: screen<font></font>
      state: installed<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，我们将能够即时更改Ansible Tower中的作业模板，从而通过外部变量指示一个库存组。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jr/fe/iu/jrfeiulsq6wqesxwt-e1njpt2mm.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此示例中，模板将仅</font><font style="vertical-align: inherit;">在Satellite </font><font style="vertical-align: inherit;">中属于</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rhel7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组成员的主机上运行</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，可以配置作业模板，以便在启动时它将要求用户提供</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosts_var</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的值</font><font style="vertical-align: inherit;">（并同时以注释的形式显示可用的库存组）：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/lh/gl/adlhglvneyz5ettasl8vh1z_mag.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上面的屏幕说明了启动模板时提示用户输入要在其主机上运行脚本的Satellite清单组的名称的情况。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，您可以在同步期间使用从Satellite提取的主机变量。</font><font style="vertical-align: inherit;">例如，这是脚本的样子，显示了如何引用这些变量：</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Show Satellite variables<font></font>
  hosts: all<font></font>
  tasks:<font></font>
  - name: Show subscription_status<font></font>
    debug:<font></font>
      msg: &gt;<font></font>
        Subscription Status: {{ foreman.subscription_status_label }}<font></font>
  - name: Show Errata Counts<font></font>
    debug:<font></font>
      msg: &gt;<font></font>
        Bug fixes: {{ foreman.content_facet_attributes.errata_counts.bugfix }},<font></font>
        Security: {{ foreman.content_facet_attributes.errata_counts.security }},<font></font>
        Enhancement: {{ foreman.content_facet_attributes.errata_counts.enhancement }},<font></font>
        Total: {{ foreman.content_facet_attributes.errata_counts.total }}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您在Ansible Tower中运行此脚本，它将显示变量的值：</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/la/3o/ub/la3oubu_3gdoc2o_tvxhuqycyko.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，这些变量可以在有条件的构造中使用，以便仅在某些条件下启动任务。</font><font style="vertical-align: inherit;">例如，如果主机没有安全补丁，或者主机订阅无效。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总结一下</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
红帽卫星和红帽Ansible本身是非常强大的工具，它们的集成提供了切实的协同作用。</font><font style="vertical-align: inherit;">上面，我们展示了如何在Ansible中将Satellite用作动态库存的数据源并在实践中使用它。</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分。通过预配置回调自动配置新主机</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除了许多其他功能，Satellite还能够初始化主机，换句话说，执行配置。反过来，Ansible Tower则用于配置主机。集成使您可以确保在通过Satellite初始化新的RHEL主机之后，Ansible Tower将自动连接到该主机并在其上运行相应的配置脚本。显然，这种方案为系统管理员节省了大量时间，帮助他们快速响应组织的需求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应该注意的是，该方案仅在满足多个条件的情况下才有效。</font><font style="vertical-align: inherit;">首先，应将卫星用作Ansible Tower中的动态库存数据源（我们在上一部分中讨论了此问题）。</font><font style="vertical-align: inherit;">其次，主机初始化不仅应通过Satellite完成，而且还应通过主机组机制进行工作（有关更多详细信息，请参见《</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置指南》</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面我们展示了如何配置Satellite和Ansible Tower，以便在初始化主机之后，它将自动运行Ansible配置脚本。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总览</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IT自动化工具（例如Ansible Tower）通常分为两类之一：有些通过推入方法进行工作，而另一些通过拉入方法进行工作。在Ansible Tower所属的推送系统中，自动化服务器会启动与主机的连接。在拉式系统中，发起者是主机，其本身与自动化服务器进行通信。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的情况下，通过在新主机上自动编写脚本，使用了混合方案。新初始化的主机与自动化服务器联系，以请求对其进行“回调”并进行配置。此后，自动化服务器将连接到该主机，并在其上运行主机请求的配置脚本。因此，在Ansible Tower中，此机制称为配置回调，可以转换为“初始化回调”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了说明为什么根本需要配置回调，请考虑以下情况：我们有一个特定的主机配置脚本，该脚本每天午夜运行。假设在上午8点，我们正在通过Satellite一次初始化几台新服务器。同时，Satellite在Ansible Tower中用作动态库存数据源，因此创建的主机自动落入Ansible。但是，自动化脚本的下一次启动将仅在午夜（即16小时后）进行。显然，这远非理想，我希望脚本在新主​​机初始化后立即运行。为此，还考虑了预配置回调。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，预配置回调的配置和工作方式如下：</font></font><br>
<br>
<ol>
<li>  Ansible Tower   credential        root,  Satellite           . Tower    ,            .</li>
<li>   Job Template  Ansible Tower   provisioning callback.       URL     Host Config Key,        Ansible. </li>
<li> Satellite      ,       provisioning callback   Ansible Tower,  : URL-  Ansible Tower,  Host Config Key    Ansible.</li>
<li>      Satellite     /etc/systemd/system/ansible-callback.service (  RHEL 7  8;   RHEL 6  ).         provisioning callback   Ansible Tower,  ,     (URL-, Host Config Key   ).</li>
<li>Ansible Tower       Host Config Key.   , Tower       ,      root,    Job Template.   ,      .</li>
</ol><br>
<h4> Ansible Tower  Provisioning Callback</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们从在Ansible Tower服务器上创建配置脚本开始，该脚本更改/ etc / motd的内容，创建某种用户，并安装特定的软件包。</font><font style="vertical-align: inherit;">然后，我们将使用此脚本在初始化新主机后立即对其进行配置。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在现实生活中，自动化脚本很可能存储在某个版本控制系统中，但为简单起见，我们假设它们直接位于Ansible Tower服务器上。</font><font style="vertical-align: inherit;">因此，我们通过运行以下命令，通过SSH进入Ansible Tower服务器并为其创建目录/ var / lib / awx / projects / provision：</font></font><br>
<br>
<pre><code class="plaintext hljs"># mkdir /var/lib/awx/projects/provision
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，我们在此目录中创建脚本，将其称为provision.yaml，并将以下内容写入其中：</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
<font></font>
- name: Provision new host<font></font>
<font></font>
  hosts: all<font></font>
<font></font>
  tasks:<font></font>
<font></font>
  - name: Set content in /etc/motd <font></font>
<font></font>
    copy:<font></font>
<font></font>
      content: Authorized use only!<font></font>
<font></font>
      dest: /etc/motd<font></font>
<font></font>
      mode: 644<font></font>
<font></font>
      owner: root<font></font>
<font></font>
      group: root<font></font>
<font></font>
<font></font>
  - name: Create brian user account<font></font>
<font></font>
    user:<font></font>
<font></font>
      name: brian<font></font>
<font></font>
      uid: 10000<font></font>
<font></font>
      state: present<font></font>
<font></font>
<font></font>
  - name: Install tmux package<font></font>
<font></font>
    yum:<font></font>
<font></font>
      name: tmux<font></font>
<font></font>
      state: present<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在转到塔式Web界面，然后转到“凭据”屏幕。</font><font style="vertical-align: inherit;">我们单击带有绿色加号的按钮以创建新的凭据记录，为其命名为Provisioning_root，还将凭据类型设置为Machine。</font><font style="vertical-align: inherit;">在“用户名”字段中，写入root，在“密码”字段中，指定在Satellite中指定的密码，以在Satellite中相应主机组的新主机上使用（其名称可以在“操作系统”选项卡上的Satellite Web界面中找到）。</font><font style="vertical-align: inherit;">使用此条目，Ansible Tower将能够登录通过Satellite初始化期间创建的新主机。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zf/b7/lb/zfb7lbondu4unvzqe-h5ex-2e54.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，在Ansible Tower界面中，转到“项目”屏幕，然后单击绿色加号创建一个新项目。</font><font style="vertical-align: inherit;">将其称为提供，将“ SCM类型”更改为“手动”，然后将提供指定为“ Playbook目录”：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/aq/ib/ybaqibhcd2nlts3ysjwzfphdr8w.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，在Ansible Tower界面中，转到“模板”屏幕，单击绿色加号以创建新的作业模板。</font><font style="vertical-align: inherit;">我们将其称为“供应”，在“库存”字段中编写“卫星”，在“项目”字段-“供应”中，在“ Playbook”字段中-“ provision.yaml”，在“凭据”字段中-“ provisioning_root”。</font><font style="vertical-align: inherit;">此外，您需要启用“允许配置回调”复选框，然后单击“主机配置密钥”字段右侧的魔术棒图标以生成密钥。</font><font style="vertical-align: inherit;">为了请求配置回调，此密钥是必需的，它不能是任何人，而只能是知道主机配置密钥的人。</font><font style="vertical-align: inherit;">如果没有正确的密钥，Ansible Tower服务器将无法响应该请求。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mx/lo/f6/mxlof6mxbd8ny0f0wursfzhqdzy.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们需要记住主机配置密钥的未来值以及模板ID，可以从此作业模板的URL中找到它们： </font></font><br>
<br>
<pre><code class="plaintext hljs">https://tower.example.com/#/templates/job_template/11
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此示例中，ID为11。 </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置卫星以配置回调</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在转到卫星Web界面，转到“配置”屏幕，然后单击“主机组”。</font><font style="vertical-align: inherit;">我们选择用于初始化新主机的现有主机组，在本例中为RHEL8。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在主机组编辑屏幕上，转到“参数”选项卡并创建4个新参数：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_host_config_key-在这里，我们从Ansible Tower模板中输入主机配置密钥。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_job_template_id-在这里，我们编写模板ID，该ID是我们先前从模板URL中找到的。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_tower_fqdn是Ansible塔服务器的标准域名。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_tower_provisioning-设置为true。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/th/ji/m8/thjim8rh06qhbq_gdwhxfc4jlue.png"></div><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查一切如何</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，从Satellite初始化新主机，并验证预配置回调函数是否正常运行，并在该主机上自动运行我们的脚本。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Satellite Web界面中，转到Hosts屏幕，单击Create Host并验证是否使用了刚刚为其创建4个新参数的组，即RHEL 8组。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xt/mn/yc/xtmnycjplympck_rrh4lag9l2ts.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主机初始化完成后，我们需要确保已成功启动其上的模板。</font><font style="vertical-align: inherit;">为此，请转到Ansible Tower Web界面中的“模板”屏幕，在列表中查找我们的模板，然后查看其指示器最左边的正方形是否变为绿色：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/g2/o-/lkg2o-kj5rtuuotxnvyhnxrcr3e.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们单击此绿色框以查看启动详细信息，在我们的情况下成功完成了。</font><font style="vertical-align: inherit;">请注意，此任务有一个限制（Limit）-仅启动在初始化期间创建的新主机。</font><font style="vertical-align: inherit;">嗯，这并不奇怪，因为配置回调机制仅在请求模板的主机上运行模板。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aa/ll/t1/aallt1qykw1g_z9t_hmsujmtqby.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们转到新创建的主机，并检查它是否与脚本中编写的内容匹配：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# rpm -qa | grep tmux<font></font>
tmux-2.7-1.el8.x86_64<font></font>
<font></font>
[root@provision-test-rhel8 ~]# id brian<font></font>
uid=10000(brian) gid=10000(brian) groups=10000(brian)<font></font>
<font></font>
[root@provision-test-rhel8 ~]# cat /etc/motd<font></font>
Authorized use only!<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">故障排除</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果Ansible Tower模板未在通过Satellite初始化的新主机上自动启动，则需要检查一些事项。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一步是查明Ansible Tower是否收到配置回叫的请求，脚本的运行方式以及是否启动。为此，请转到塔式界面中的“模板”屏幕，然后查看模板名称旁边的指示器的颜色：绿色-启动成功，红色-启动失败。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gc/ra/id/gcraidlrqdznksnzfsryp80qbwk.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果该框为红色，则单击它并查找其他信息以了解启动失败的原因（这些错误既可能是脚本中的语法错误，也可能是其他问题）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果正方形为绿色，则无论如何我们都单击并查找，因为该任务可以报告成功执行，但实际上并没有在主机上启动。例如，如果脚本中的主机行指示特定的主机和组，但不包括初始化期间创建的主机，则该任务将报告成功，但是其他信息将显示为“正在跳过：没有匹配的主机”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果指示器正方形既不是绿色也不是红色，则需要从检查Satellite中的主机组的参数开始。确保在此处正确指定Ansible Tower服务器URL，主机配置密钥和模板ID。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，转到新初始化的主机，并检查是否存在文件/etc/systemd/system/ansible-callback.service（在RHEL 7或8系统上）或文件/root/ansible_provisioning_call.sh（RHEL 6）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果该文件不存在，请验证此主机组的ansible_tower_provisioning参数是否设置为true，以及Satellite服务器上的初始化模式是否未更改。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果主机上存在文件/etc/systemd/system/ansible-callback.service，则将其打开并查找发送配置回调请求的URL：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# cat /etc/systemd/system/ansible-callback.service<font></font>
[Unit]<font></font>
Description=Provisioning callback to Ansible Tower<font></font>
Wants=network-online.target<font></font>
After=network-online.target<font></font>
<font></font>
[Service]<font></font>
Type=oneshot<font></font>
ExecStart=/usr/bin/curl -k -s --data "host_config_key=aa5ebe82-491c-4fbb-bd36-a6657549451e" https://tower.example.com/api/v2/job_templates/11/callback/<font></font>
ExecStartPost=/usr/bin/systemctl disable ansible-callback<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以运行curl并手动复制此文件中指定的命令，以手动启动配置回调：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=aa5ebe82-491c-4fbb-bd36-a6657549451e" https://tower.example.com/api/v2/job_templates/11/callback/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果指定了无效的主机配置密钥，我们将收到以下错误消息：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=wrong-key-here" https://tower.example.com/api/v2/job_templates/11/callback/<font></font>
<font></font>
{"detail":"You do not have permission to perform this action."}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果未正确指定模板ID（此处为-43，而不是11），则答案如下：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=wrong-key-here" https://tower.example.com/api/v2/job_templates/43/callback/<font></font>
<font></font>
{"detail":"Not found."}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您还可以在curl命令中禁用静默（-s）模式，以使其显示与解析主机名有关的错误，如以下示例所示，其中我们用不正确的ansible-tower.example.com替换了正确的名称ansible.example.com。 ：</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k  --data "host_config_key=wrong-key-here" https://ansible-tower.example.com/api/v2/job_templates/11/callback/<font></font>
<font></font>
curl: (6) Could not resolve host: ansible-tower.example.com<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，在找出错误原因时，Ansible Tower服务器上的/var/log/tower/tower.log文件可能会派上用场。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，此文件记录无效的主机配置密钥的使用：</font></font><br>
<br>
<pre><code class="plaintext hljs">2019-11-19 23:19:17,371 WARNING  awx.api.generics status 403 received by user AnonymousUser attempting to access /api/v2/job_templates/11/callback/ from 192.168.0.138
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这也解决了无效模板ID的使用：</font></font><br>
<br>
<pre><code class="plaintext hljs">2019-11-19 23:19:49,093 WARNING  awx.api.generics status 404 received by user AnonymousUser attempting to access /api/v2/job_templates/43/callback/ from 192.168.0.138<font></font>
<font></font>
2019-11-19 23:19:49,095 WARNING  django.request Not Found: /api/v2/job_templates/43/callback/<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总结一下</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satellite和Ansible Tower的集成可以极大地优化新主机的初始化和配置，从而为系统管理员节省了大量时间，帮助他们更快地响应组织的需求。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3月24日，从11:00到12：30，Red Hat将举行一个网络研讨会“您需要了解的自动化知识：基本的Ansible技能”。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
自动化是一个热门话题，并且涉及数字化转换的请求数量。我们将与Ansible和Ansible Tower一起介绍您对自动化的看法，这将是为您打开声明性自动化工具的美好新世界的基本信息。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这次网络研讨会之后，您将了解基本的Ansible实体，例如剧本，广告资源，模块。</font><font style="vertical-align: inherit;">我们将与您一起掌握基本的YAML语法，以便您可以编写自己的脚本。</font><font style="vertical-align: inherit;">它还将考虑启动脚本和提升权限。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，您将获得一套基本的技能，使您能够成功地学习文档和其他文献，而不会一直感到自己缺少某些东西。</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并过来！</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491122/index.html">HiSuite备份的取证分析</a></li>
<li><a href="../zh-CN491130/index.html">要记住的Vue功能</a></li>
<li><a href="../zh-CN491132/index.html">当布隆过滤器不合适时</a></li>
<li><a href="../zh-CN491134/index.html">不可避免地要通过ISO / IEC 27001认证的5个阶段。否定</a></li>
<li><a href="../zh-CN491136/index.html">在Angular或丢失的ng-content文档中投影内容</a></li>
<li><a href="../zh-CN491146/index.html">针对开发人员的UML</a></li>
<li><a href="../zh-CN491150/index.html">我是如何欺骗诈骗者的，或者仅是网上诱骗面板的内部的黑客</a></li>
<li><a href="../zh-CN491154/index.html">课程搜寻：如何建立学习路径</a></li>
<li><a href="../zh-CN491156/index.html">可测量的共情：预测脑MRI的同情</a></li>
<li><a href="../zh-CN491162/index.html">PostgreSQL Antipatterns：关于按名称迭代优化或“来回优化”的故事</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>