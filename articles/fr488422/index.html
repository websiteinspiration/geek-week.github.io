<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèø üë®üèΩ‚Äç‚öïÔ∏è üóΩ 10 lignes de code pour r√©duire la douleur de votre projet Vue üë©üèæ‚Äçüîß üö¥üèΩ üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... ou familiarit√© avec les plugins Vue JS comme exemple de bus d'√©v√©nements int√©gr√©
 Quelques mots sur ...
 Bonjour √† tous! Je ferai une r√©servation ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>10 lignes de code pour r√©duire la douleur de votre projet Vue</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odin_ingram_micro/blog/488422/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ou familiarit√© avec les plugins Vue JS comme exemple de bus d'√©v√©nements int√©gr√©</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques mots sur ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous! </font><font style="vertical-align: inherit;">Je ferai une r√©servation tout de suite. </font><font style="vertical-align: inherit;">J'adore vraiment VueJS, j'√©cris activement dessus depuis plus de 2 ans et je ne pense pas que son d√©veloppement puisse faire mal au moins dans une certaine mesure :)</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'un autre c√¥t√©, nous essayons toujours de trouver des solutions universelles qui aideront √† passer moins de temps sur les travaux m√©caniques et plus sur ce qui est vraiment int√©ressant. Parfois, la solution est particuli√®rement r√©ussie. Je veux partager avec vous l'un d'entre eux. Les 10 lignes qui seront discut√©es (spoiler: √† la fin il y en aura un peu plus) sont n√©es dans le processus de travail sur le projet Cloud Blue - Connect, qui est une application assez grande avec plus de 400 composants. La solution que nous avons trouv√©e est d√©j√† int√©gr√©e √† divers points du syst√®me et pendant plus de six mois, elle n'a jamais n√©cessit√© de corrections, elle peut donc √™tre consid√©r√©e avec succ√®s comme test√©e avec succ√®s pour la stabilit√©.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et la derni√®re. </font><font style="vertical-align: inherit;">Avant de passer directement √† la solution, je voudrais m'attarder un peu plus sur la description des trois types d'interaction entre les composants Vue entre eux: les principes du flux unidirectionnel, le mod√®le du magasin et le bus d'√©v√©nements. </font><font style="vertical-align: inherit;">Si cette explication est inutile (ou ennuyeuse) pour vous, allez directement √† la section avec la solution - tout est aussi bref et technique que possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur la fa√ßon dont les composants Vue communiquent entre eux</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que la premi√®re question qu'une personne qui a r√©dig√© son premier volet soul√®ve est de savoir comment il recevra les donn√©es pour le travail et comment, √† son tour, il transmettra les donn√©es qu'il a re√ßues ¬´√† l'ext√©rieur¬ª. </font><font style="vertical-align: inherit;">Le principe d'interaction adopt√© dans le framework Vue JS s'appelle ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux de donn√©es unidirectionnel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, ce principe sonne comme ¬´propri√©t√©s - vers le bas, √©v√©nements - vers le haut¬ª. Autrement dit, pour recevoir des donn√©es de l'ext√©rieur (¬´d'en haut¬ª), nous enregistrons une propri√©t√© sp√©ciale √† l'int√©rieur du composant dans lequel le framework √©crit, si n√©cessaire, nos donn√©es re√ßues ¬´de l'ext√©rieur¬ª. Afin de transf√©rer les donn√©es ¬´vers le haut¬ª, √† l'int√©rieur du composant au bon endroit, nous appelons la m√©thode sp√©ciale $ emit framework, qui transmet nos donn√©es au gestionnaire du composant parent. Dans le m√™me temps, dans Vue JS, nous ne pouvons pas simplement ¬´diffuser¬ª l'√©v√©nement jusqu'√† une profondeur illimit√©e (comme par exemple dans Angular 1.x). Il "n'appara√Æt" qu'un seul niveau, au parent imm√©diat. Il en va de m√™me pour les √©v√©nements. Pour les transf√©rer au niveau suivant, pour chacun d'eux, vous devez √©galement enregistrer une interface sp√©ciale - les propri√©t√©s et les √©v√©nements qui transmettront notre ¬´message¬ª plus loin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut √™tre d√©crit comme un immeuble de bureaux dans lequel les travailleurs ne peuvent se d√©placer que de leurs √©tages vers les √©tages voisins - un de haut en bas. Ainsi, afin de transf√©rer le ¬´document √† signer¬ª du cinqui√®me √©tage au deuxi√®me, une cha√Æne de trois travailleurs sera requise qui le livrera du cinqui√®me √©tage au deuxi√®me, puis trois autres qui le remettront au cinqui√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Mais ce n'est pas pratique!" Bien s√ªr, cela n'est pas toujours pratique du point de vue du d√©veloppement, mais en regardant le code de chaque composant, nous pouvons voir ce qu'il transmet et √† qui il passe. Nous n'avons pas besoin de garder √† l'esprit toute la structure de l'application pour comprendre si notre composant est ¬´en route¬ª vers l'√©v√©nement ou non. Nous pouvons voir cela √† partir du composant parent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien que les avantages de cette approche soient compr√©hensibles, elle pr√©sente √©galement des inconv√©nients √©vidents, √† savoir la forte coh√©sion des composants. </font><font style="vertical-align: inherit;">Autrement dit, pour que nous puissions placer un composant dans la structure, nous devons le superposer avec les interfaces n√©cessaires afin de g√©rer son √©tat. </font><font style="vertical-align: inherit;">Afin de r√©duire cette connectivit√©, ils utilisent souvent des ¬´outils de gestion des √©tats¬ª. </font><font style="vertical-align: inherit;">L'outil le plus populaire pour Vue est peut-√™tre ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vuex (c√¥t√©)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poursuivant notre analogie avec un immeuble de bureaux, Vuex Stor est un service postal interne. Imaginez qu'√† chaque √©tage du bureau il y ait une fen√™tre pour √©mettre et recevoir des colis. Au cinqui√®me √©tage, ils transf√®rent le document n ¬∞ 11 pour signature, et au deuxi√®me ils demandent p√©riodiquement: "Y a-t-il des documents √† signer?", Signez les documents existants et restituez-les. Sur le cinqui√®me, ils demandent √©galement: "Y a-t-il des signataires?" Dans le m√™me temps, les employ√©s peuvent d√©m√©nager √† d'autres √©tages ou dans d'autres pi√®ces - le principe du travail ne changera pas pendant le travail du courrier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Environ par ce principe, le mod√®le appel√© Store fonctionne √©galement. √Ä l'aide de l'interface Vuex, un entrep√¥t de donn√©es global est enregistr√© et configur√©, et les composants s'y abonnent. Et peu importe le niveau de la structure de l'appel, le magasin fournira toujours les bonnes informations.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que tous les probl√®mes aient d√©j√† √©t√© r√©solus. Mais √† un moment donn√© dans notre b√¢timent m√©taphorique, un employ√© veut appeler un autre pour le d√©jeuner ... ou signaler une sorte d'erreur. Et ici commence l'√©trange. Le message lui-m√™me ne n√©cessite pas de transmission en tant que tel. Mais pour utiliser le courrier, vous devez transf√©rer quelque chose. Ensuite, nos employ√©s √©laborent un code. Une balle verte - allez d√©jeuner, deux cubes rouges - une erreur d'application E-981273 s'est produite, trois pi√®ces jaunes - v√©rifiez votre courrier et ainsi de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est facile de deviner qu'avec l'aide de cette m√©taphore maladroite, je d√©cris des situations o√π nous devons assurer la r√©ponse de notre composant √† un √©v√©nement qui s'est produit dans un autre composant, qui en soi n'est en aucun cas li√© au flux de donn√©es. </font><font style="vertical-align: inherit;">L'enregistrement d'un nouvel √©l√©ment est termin√© - vous devez reprendre la collection. </font><font style="vertical-align: inherit;">Une erreur 403 non autoris√©e s'est produite - vous devez d√©marrer une d√©connexion utilisateur, etc. </font><font style="vertical-align: inherit;">La pratique habituelle (et loin d'√™tre la meilleure) dans ce cas est de cr√©er des indicateurs √† l'int√©rieur du magasin ou d'interpr√©ter indirectement les donn√©es stock√©es et leurs modifications. </font><font style="vertical-align: inherit;">Cela entra√Æne rapidement une pollution √† la fois du magasin lui-m√™me et de la logique des composants qui l'entourent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, nous commen√ßons √† r√©fl√©chir √† la fa√ßon de passer directement les √©v√©nements, en contournant toute la cha√Æne des composants. </font><font style="vertical-align: inherit;">Et, un peu sur Google ou en fouillant dans la documentation, on tombe sur un sch√©ma ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bus d'√©v√©nement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'un point de vue technique, le bus d'√©v√©nements est un objet qui permet d'utiliser une m√©thode sp√©ciale pour lancer un ¬´√©v√©nement¬ª et s'y abonner en utilisant une autre. En d'autres termes, lors de l'abonnement √† l'√©v√©nement eventA, cet objet stocke la fonction de gestionnaire transmis dans sa structure, qu'il appellera lorsque la m√©thode de lancement avec la cl√© eventA est appel√©e quelque part dans l'application. Pour signer ou ex√©cuter, il suffit d'y acc√©der via l'importation ou par r√©f√©rence, et vous avez termin√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©taphoriquement, dans notre ¬´b√¢timent¬ª, un bus est une conversation courante dans le messager. Les composants s'abonnent √† une ¬´conversation g√©n√©rale¬ª √† laquelle d'autres composants envoient des messages. D√®s qu'un ¬´message¬ª appara√Æt sur le ¬´chat¬ª auquel le composant s'est abonn√©, le gestionnaire d√©marre.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe diff√©rentes mani√®res de cr√©er un bus d'√©v√©nements. </font><font style="vertical-align: inherit;">Vous pouvez l'√©crire vous-m√™me ou vous pouvez utiliser des solutions pr√™tes √† l'emploi - le m√™me RxJS, qui offre une √©norme fonctionnalit√© pour travailler avec des flux entiers d'√©v√©nements. </font><font style="vertical-align: inherit;">Mais le plus souvent, lorsqu'ils utilisent VueJS, ils utilisent, curieusement, VueJS lui-m√™me. </font><font style="vertical-align: inherit;">L'instance Vue cr√©√©e via le constructeur (new Vue ()) fournit une interface √©v√©nementielle belle et concise, d√©crite dans la documentation officielle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous approchons de la question suivante ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que voulons-nous?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous voulons construire un bus d'√©v√©nements dans notre application. </font><font style="vertical-align: inherit;">Mais nous avons deux exigences suppl√©mentaires:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il doit √™tre facilement accessible dans tous les composants. </font><font style="vertical-align: inherit;">Des importations distinctes dans chacune des dizaines de composants nous semblent redondantes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il doit √™tre modulaire. </font><font style="vertical-align: inherit;">Nous ne voulons pas garder √† l'esprit tous les noms d'√©v√©nements afin d'√©viter la situation o√π l'√©v√©nement ¬´cr√©√© par un √©l√©ment¬ª d√©clenche des gestionnaires de l'application enti√®re. </font><font style="vertical-align: inherit;">Par cons√©quent, nous voulons pouvoir s√©parer facilement un petit fragment de l'arborescence des composants dans un module s√©par√© et diffuser ses √©v√©nements √† l'int√©rieur, et non √† l'ext√©rieur.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de mettre en ≈ìuvre une fonctionnalit√© aussi impressionnante, nous utilisons la puissante interface de plug-in que VueJS nous fournit. </font><font style="vertical-align: inherit;">Vous pouvez vous y familiariser plus en d√©tail </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la page de documentation officielle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enregistrons d'abord notre plugin. </font><font style="vertical-align: inherit;">Pour ce faire, juste avant le point d'initialisation de notre application Vue (avant d'appeler Vue. $ Mount ()) nous pla√ßons le bloc suivant:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { }, <font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, les plugins Vue sont un moyen d'√©tendre les fonctionnalit√©s du framework √† l'ensemble du niveau de l'application. L'interface du plugin offre plusieurs fa√ßons de s'int√©grer dans le composant, mais aujourd'hui, nous allons pr√©senter l'interface mixin. Cette m√©thode accepte un objet qui √©tend le descripteur de chaque composant avant de d√©marrer le cycle de vie dans l'application.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Le code du composant que nous √©crivons n'est probablement pas le composant lui-m√™me, mais une description de son comportement et l'encapsulation d'une certaine partie de la logique que le framework utilise √† diff√©rentes √©tapes de son cycle de vie. L'initialisation du plug-in est en dehors du cycle de vie du composant, le pr√©c√©dant, donc nous nous disons ¬´descripteur¬ª, pas un composant, pour souligner qu'exactement le code qui est √©crit dans notre fichier, et non une entit√© qui est un produit du travail du framework, sera transf√©r√© dans la section mixin du plugin)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) {     <font></font>
    vue.mixin({}); <span class="hljs-comment">// &lt;--</span><font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est cet objet vide qui contiendra les extensions de nos composants. Mais pour commencer, un autre arr√™t. Dans notre cas, nous voulons cr√©er une interface pour acc√©der au bus au niveau de chaque composant. Ajoutons le champ '$ broadcast' √† notre descripteur, il stockera un lien vers notre bus. Pour ce faire, utilisez Vue.prototype:</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <span class="hljs-comment">// &lt;--</span><font></font>
    vue.mixin({}); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous devons cr√©er le bus lui-m√™me, mais rappelons d'abord l'exigence de modularit√© et supposons que dans le descripteur de composant, nous d√©clarerons un nouveau module avec le champ ¬´$ module¬ª avec une valeur de texte (nous en aurons besoin un peu plus tard). </font><font style="vertical-align: inherit;">Si le champ $ module est sp√©cifi√© dans le composant lui-m√™me, nous allons cr√©er un nouveau bus pour lui; sinon, nous transmettrons le lien au parent via le champ $ parent. </font><font style="vertical-align: inherit;">Notez que les champs descripteurs seront disponibles pour nous via le champ $ options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous placerons la cr√©ation de notre bus le plus t√¥t possible - dans le crochet avantCr√©er.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({<font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() {  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
 	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) {  <span class="hljs-comment">// &lt;--</span><font></font>
         <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, remplissons les branches logiques. </font><font style="vertical-align: inherit;">Si le descripteur contient une nouvelle d√©claration de module, cr√©ez une nouvelle instance de bus, sinon, prenez le lien de $ parent.</font></font><br>
<br>
<pre><code class="javascript hljs">Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>; <font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue();  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast;  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous rejetons l'annonce du plugin, nous consid√©rons ... 1, 2, 3, 4 ... 10 lignes, comme je l'ai promis! </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pouvons-nous faire mieux?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr on peut. </font><font style="vertical-align: inherit;">Ce code est facilement extensible. </font><font style="vertical-align: inherit;">Par exemple, dans notre cas, en plus de $ broadcast, nous avons d√©cid√© d'ajouter l'interface $ rootBroadcast, qui donne acc√®s √† un seul bus pour toute l'application. </font><font style="vertical-align: inherit;">Les √©v√©nements que l'utilisateur ex√©cute sur le bus $ broadcast sont dupliqu√©s sur le bus $ rootBroadcast afin que vous puissiez vous abonner √† tous les √©v√©nements d'un module particulier (dans ce cas, le nom de l'√©v√©nement sera transmis au gestionnaire comme premier argument) ou √† tous les √©v√©nements d'application en g√©n√©ral (puis le nom du module sera transmis au gestionnaire avec le premier argument, le nom de l'√©v√©nement avec le second, et les donn√©es transmises avec l'√©v√©nement seront transmises avec les arguments suivants). </font><font style="vertical-align: inherit;">Cette conception nous permettra d'√©tablir une interaction entre les modules, ainsi que de suspendre un seul gestionnaire sur les √©v√©nements des diff√©rents modules.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// This one emits event  </span>
<span class="hljs-keyword">this</span>.$broadcast.$emit(‚Äòmy-event‚Äô, ‚ÄòPARAM_A‚Äô); 
<span class="hljs-comment">// This is standard subscription inside module </span>
<span class="hljs-keyword">this</span>.$broadcast.$on(‚Äòmy-event‚Äô, (paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äòmy-event‚Äô, (<span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶}); 
<span class="hljs-comment">// This subscription will also work for the same event </span>
<span class="hljs-keyword">this</span>.$rootBroadcast.$on(‚Äò*‚Äô, (event, <span class="hljs-built_in">module</span>, paramA) =&gt; {‚Ä¶});
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment nous pouvons y parvenir: tout d' </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
abord, cr√©ez un seul bus, qui sera organis√© via $ rootBroadcast, et le champ lui-m√™me avec un lien:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue(); <span class="hljs-comment">// &lt;--</span><font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus; <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous avons besoin d'appartenance √† un module dans chaque composant, d√©veloppons donc la d√©finition de la modularit√© comme ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">new</span> Vue(); <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast = <span class="hljs-keyword">this</span>.$parent.$broadcast; <font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous devons faire en sorte que l'√©v√©nement sur le bus local modulaire se refl√®te dans la mani√®re dont nous avons besoin √† la racine. </font><font style="vertical-align: inherit;">Pour ce faire, nous devons d'abord cr√©er une interface proxy simple et placer le bus lui-m√™me dans la propri√©t√© conditionnellement priv√©e de $ bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <span class="hljs-comment">// &lt;--</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };  <span class="hljs-comment">// &lt;--</span><font></font>
        } <font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et enfin, ajoutez des m√©thodes proxy √† l'objet - car maintenant le champ $ broadcast ne fournit pas un acc√®s direct au bus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
        <span class="hljs-comment">// &gt;&gt;&gt;</span>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
        <span class="hljs-comment">// &lt;&lt;&lt;</span><font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, comme touche finale, rappelons-nous que nous avons acc√®s au bus en fermant, ce qui signifie que les gestionnaires ajout√©s une fois ne seront pas effac√©s avec le composant, mais vivront pendant tout le temps de travail avec l'application. Cela peut provoquer des effets secondaires d√©sagr√©ables, alors ajoutons une fonction de nettoyage de l'auditeur √† notre bus √† la fin du cycle de vie du composant:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> $rootBus = <span class="hljs-keyword">new</span> Vue();<font></font>
<font></font>
Vue.use({   <font></font>
  install(vue) { <font></font>
    vue.prototype.$broadcast = <span class="hljs-literal">null</span>;<font></font>
    vue.mixin({<font></font>
      beforeDestroy() {                               <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">this</span>.$broadcast.$off(<span class="hljs-keyword">this</span>.$broadcastEvents);  <span class="hljs-comment">// &lt;--</span><font></font>
      },<font></font>
<font></font>
      beforeCreate() { <font></font>
        vue.prototype.$rootBroadcast = $rootBus;<font></font>
        <span class="hljs-keyword">this</span>.$broadcastEvents = [];  <span class="hljs-comment">// &lt;--</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>) {
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$options.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">new</span> Vue() };  <font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$parent &amp;&amp; <span class="hljs-keyword">this</span>.$parent.$broadcast) { 
          <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span> = <span class="hljs-keyword">this</span>.$parent.$<span class="hljs-built_in">module</span>;
          <span class="hljs-keyword">this</span>.$broadcast = { <span class="hljs-attr">$bus</span>: <span class="hljs-keyword">this</span>.$parent.$broadcast.$bus };<font></font>
        } <font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$emit = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {
          <span class="hljs-keyword">this</span>.$broadcastEvents.push(attrs[<span class="hljs-number">0</span>]);   <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$emit(‚Ä¶attrs);           
          <span class="hljs-keyword">const</span> [event, ‚Ä¶attributes] = attrs; 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)); 
          <span class="hljs-keyword">this</span>.$rootBroadcast.$emit(‚Äò*‚Äô, event, <span class="hljs-keyword">this</span>.$<span class="hljs-built_in">module</span>, ‚Ä¶attributes)<font></font>
        };<font></font>
        <font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$on = <span class="hljs-function">(<span class="hljs-params">‚Ä¶attrs</span>) =&gt;</span> {           
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$on(‚Ä¶attrs);<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.$broadcast.$off =: <span class="hljs-function">(<span class="hljs-params">...attrs</span>) =&gt;</span> {  <span class="hljs-comment">// &lt;--</span>
          <span class="hljs-keyword">this</span>.$broadcast.$bus.$off(...attrs);   <span class="hljs-comment">// &lt;--</span><font></font>
        };<font></font>
      }, <font></font>
    }); <font></font>
  }, <font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, cette option offre une fonctionnalit√© plus int√©ressante, bien que moins concise. </font><font style="vertical-align: inherit;">Avec lui, vous pouvez impl√©menter un syst√®me complet de communication alternative entre les composants. </font><font style="vertical-align: inherit;">De plus, il est enti√®rement sous notre contr√¥le et n'apporte pas de d√©pendances externes dans notre projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'esp√®re qu'apr√®s avoir lu ou acquis votre connaissance des plugins Vue, et peut-√™tre que la prochaine fois que vous aurez besoin d'ajouter des fonctionnalit√©s g√©n√©riques √† votre application, vous pourrez les impl√©menter plus efficacement - sans ajouter de d√©pendances externes.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488408/index.html">Passerelle IoT Ethernet-RS485 STM32</a></li>
<li><a href="../fr488410/index.html">7 le√ßons que j'ai apprises en dix ans de d√©veloppement</a></li>
<li><a href="../fr488412/index.html">Cr√©ation d'un bot Discord bas√© sur discord.js</a></li>
<li><a href="../fr488416/index.html">SLAE - Examen expert de s√©curit√© Linux Assembly</a></li>
<li><a href="../fr488418/index.html">Authentification de l'API REST avec Spring Security et MongoDB</a></li>
<li><a href="../fr488424/index.html">Qu'adviendra-t-il de l'ITSM en 2020?</a></li>
<li><a href="../fr488426/index.html">Comment faire une revue de code? Partie 2: revoir la navigation, la vitesse, les commentaires, les conflits</a></li>
<li><a href="../fr488428/index.html">Comment pr√©disons-nous l'avenir de la recherche Yandex: des corrections de bugs aux requ√™tes de d√©couverte</a></li>
<li><a href="../fr488432/index.html">Snoop Project, un outil incroyable pour l'intelligence Internet, que les utilisateurs de RuNet attendent depuis si longtemps - est disponible</a></li>
<li><a href="../fr488436/index.html">Cr√©ez rapidement de la musique chiptune open source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>