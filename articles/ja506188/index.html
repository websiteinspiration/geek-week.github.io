<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📥 👩🏼‍🤝‍👩🏻 🔇 400行のカスタム文法パーサー 🤲 🕢 ☯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="特定の文法のファイルを解析するための多くの既存のツールがあります。たとえば、ANTLRまたはYaccです。ステートマシンを使用して、解析用の大きなソースファイルを生成します。本当に難しいですか？自分でやってみましょう。
 

この記事では、再帰降下法を使用してそのようなパーサーを作成する方法を示しま...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>400行のカスタム文法パーサー</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506188/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定の文法のファイルを解析するための多くの既存のツールがあります。</font><font style="vertical-align: inherit;">たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANTLR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yacc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ステートマシンを使用して、解析用の大きなソースファイルを生成します。</font><font style="vertical-align: inherit;">本当に難しいですか？</font><font style="vertical-align: inherit;">自分でやってみましょう。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、再帰降下法を使用してそのようなパーサーを作成する方法を示します。</font><font style="vertical-align: inherit;">比較のために、ANTLRについて説明します。他のパーサーは考慮されません。</font><font style="vertical-align: inherit;">カットの下には多くのコード例がありますが、これがないと、なぜこれが行われるのかを説明するのは難しく、それ以外の場合はそうではありません。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANTLRのような形式の文法のパーサーを作成します。</font><font style="vertical-align: inherit;">ここでこれ：</font></font></p><br>
<pre><code class="plaintext hljs">C:<font></font>
    | A1? A2* A3<font></font>
    | B1? B2+ B3<font></font>
;</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHPでそれを行います。</font><font style="vertical-align: inherit;">そしてそれがうまくいったら、C ++で書き直します。</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何のために？</font><font style="vertical-align: inherit;">まあ、同じANTLRには制限があります。</font><font style="vertical-align: inherit;">たとえば、C ++言語</font></font><code>asm { ... }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">アセンブリを挿入するための文法を作成するのは難しいです。C++言語の</font><font style="vertical-align: inherit;">内部には、異なる構文や</font><font style="vertical-align: inherit;">PHP </font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nowdoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列の構文が</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">あり</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、不快な点も少なくありません。文法ファイルでは、「|」に合わせて「：」を別の行に記述する必要があります。</font><font style="vertical-align: inherit;">そして一般的に、これは大きくて複雑なことですが、突然、それを簡単にすることができます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用語を定義しましょう。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明全体がルール（ルール）です。</font><font style="vertical-align: inherit;">上記の例では、ルールCが定義されており、ルールは1つ以上のオプションで構成されています。</font></font></p><br>
<p>   —   (Statement).    "statement"   ,  ,    .    2 .     Variant ( Alternative,   ANTLR),      ,    -   .</p><br>
<p>Statement       (Expression).    regular expressions,     ,    ,    statement.   3    .</p><br>
<p>Expression    (Element)    (Quantifier). Quantifier       — <code>?</code>, <code>*</code>, <code>+</code>.</p><br>
<p>Element         —          (<code>'a'</code>)       :       (<code>[a-z]</code>)        (<code>.</code>).    .    ,     ,   " "      .</p><br>
<h3 id="grammatika"></h3><br>
<p>     .    .</p><br>
<p>   .</p><br>
<pre><code class="plaintext hljs">Grammar:<font></font>
    delimiter* Rule*<font></font>
;<font></font>
<font></font>
delimiter:<font></font>
    | space<font></font>
    | comment<font></font>
;<font></font>
<font></font>
space:<font></font>
    [\s\n\t\r]+<font></font>
;</code></pre><br>
<p>    ,  .   ,    .      "<code>\s</code>"      0x20,     ,     .</p><br>
<p>       .  ,              .</p><br>
<p>,    .</p><br>
<p>     .       :</p><br>
<pre><code class="plaintext hljs">comment:<font></font>
    '/*' .* '*/'<font></font>
;</code></pre><br>
<p>  <code>.*</code>         <code>'*'</code>,     .   - ,      ,     '*'   .      lookahead.</p><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">comment:<font></font>
    '/*' AnySymbol*&gt;&gt; '*/'<font></font>
;</code></pre><br>
<p>        .     .<br>
   ,      ,            .</p><br>
<pre><code class="plaintext hljs">comment:<font></font>
    '/*' content '*/'<font></font>
;<font></font>
<font></font>
content:<font></font>
    AnySymbol*&gt;'*/'<font></font>
;</code></pre><br>
<p>    ,    lookahead    ,                .     ,      1 .</p><br>
<p>     2  ,   <code>'a*? b'</code>    <code>'a*(?=b)'</code>.   ,    2 ,        .</p><br>
<p> .    .</p><br>
<pre><code class="plaintext hljs">Rule:<font></font>
    RuleName delimiter* ':' delimiter* RuleBody ';' delimiter*<font></font>
;<font></font>
<font></font>
RuleName:<font></font>
    ID<font></font>
;<font></font>
<font></font>
ID:<font></font>
    [a-zA-Z_] [a-zA-Z_0-9]*<font></font>
;</code></pre><br>
<p>     ,         .     <code>delimiter*</code>     <code>Grammar</code>.</p><br>
<p> .</p><br>
<pre><code class="plaintext hljs">RuleBody:<font></font>
    '|'? delimiter* Statement ('|' delimiter* Statement)*<font></font>
;<font></font>
<font></font>
Statement:<font></font>
    Expression+<font></font>
;</code></pre><br>
<p>     inline-  .    ,   ,    .</p><br>
<p>  .</p><br>
<pre><code class="plaintext hljs">Expression:<font></font>
    Element Quantifier? LookAhead? delimiter*<font></font>
;<font></font>
<font></font>
Element:<font></font>
    | RuleName<font></font>
    | StringLiteral<font></font>
    | RegexpLiteral<font></font>
    | InlineRule<font></font>
;<font></font>
<font></font>
Quantifier:<font></font>
    | '*'<font></font>
    | '?'<font></font>
    | '+'<font></font>
;<font></font>
<font></font>
LookAhead:<font></font>
    | '&gt;&gt;'<font></font>
    | '&gt;' Element<font></font>
;<font></font>
<font></font>
InlineRule:<font></font>
    '(' RuleBody ')'<font></font>
;</code></pre><br>
<p>  4 ,      .      ,  .</p><br>
<p>  .</p><br>
<pre><code class="plaintext hljs">StringLiteral:<font></font>
    '\'' Symbol+&gt;&gt; '\''<font></font>
;<font></font>
<font></font>
RegexpLiteral:<font></font>
    | '[' SymbolRange+&gt;&gt; ']'<font></font>
    | AnySymbolLiteral<font></font>
;<font></font>
<font></font>
SymbolRange:<font></font>
    Symbol&gt;']' ('-' Symbol&gt;']')?<font></font>
;<font></font>
<font></font>
Symbol:<font></font>
    | HexCodeSymbol<font></font>
    | EscapedSymbol<font></font>
    | AnySymbol<font></font>
;<font></font>
<font></font>
HexCodeSymbol:<font></font>
    '\\x' HexDigit HexDigit<font></font>
;<font></font>
<font></font>
HexDigit:<font></font>
    [0-9A-F]<font></font>
;<font></font>
<font></font>
EscapedSymbol:<font></font>
    '\\' AnySymbol<font></font>
;<font></font>
<font></font>
AnySymbol:<font></font>
    .<font></font>
;<font></font>
<font></font>
AnySymbolLiteral:<font></font>
    '.'<font></font>
;</code></pre><br>
<p>  ,  RegexpLiteral   ,     ,      .         .</p><br>
<p>       .        lookahead ,     <code>[]</code>  <code>[a-]</code>   .</p><br>
<p>        . ,     <code>\x20</code>.      .</p><br>
<p>   .    ,    . </p><br>
<p>  ,     .    GDL — Grammar Definition Language.</p><br>
<p>        <code>self.gdl</code>.</p><br>
<h3 id="parser"></h3><br>
<p>    .</p><br>
<p>   —     <code>( ,   )</code>.  ,     ,       .     <code>*</code>  <code>?</code>   .            .         ,      .        .    .<br>
   —      .   ,  .</p><br>
<p>   —      .<br>
     —     . ,        ,   .</p><br>
<p>    null.</p><br>
<p>  ,    ,    (  ).</p><br>
<p>  ,    ,    (  ).</p><br>
<p>  ,       ,  .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力：</font></font><code>aaab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<pre><code class="plaintext hljs">/*  */<font></font>
Data:<font></font>
    'a'* 'b' 'c'?<font></font>
;<font></font>
<font></font>
/*   */<font></font>
['Data', [<font></font>
    ['', 'a'],<font></font>
    ['', 'a'],<font></font>
    ['', 'a'],<font></font>
    ['', 'b'],<font></font>
]]<font></font>
<font></font>
/*  */<font></font>
Data:<font></font>
    R1* R2 R3?<font></font>
;<font></font>
R1: 'a';<font></font>
R2: 'b';<font></font>
R3: 'c';<font></font>
<font></font>
/*   */<font></font>
['Data', [<font></font>
    ['R1', [<font></font>
        ['', 'a'],<font></font>
    ]],<font></font>
    ['R1', [<font></font>
        ['', 'a'],<font></font>
    ]],<font></font>
    ['R1', [<font></font>
        ['', 'a'],<font></font>
    ]],<font></font>
    ['R2', [<font></font>
        ['', 'b'],<font></font>
    ]],<font></font>
]]</code></pre><br>
<p> ,      ,      ,   "  "   .</p><br>
<p>       <code>R1:= 'a';</code>      ,     <code>['R1', 'a']</code>,       (     )    ,        .      XML  JSON     ,       2 ,     1.</p></div>
                    </div><br>
<p>    .         ,        ,     ,       .       —      <code>preg_match()</code>  <code>explode()</code>,  ,        PHP ,    .   ,   —     ,     ,    .      ,   ,       ,   StringLiteral,        .</p><br>
<p>     -,    <code>self.gdl</code>     .        .     ,         ,          ,    .   ,            PHP,         PHP       PHP.</p><br>
<p>  ,  ,   :</p><br>
<pre><code class="php hljs">$selfGrammar = [<span class="hljs-string">'Grammar'</span>, [<font></font>
  [<span class="hljs-string">'Rule'</span>, [<font></font>
    [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'Grammar'</span>],<font></font>
    [<span class="hljs-string">'RuleBody'</span>, [<font></font>
      [<span class="hljs-string">'Statement'</span>, [<font></font>
        [<span class="hljs-string">'Expression'</span>, [<font></font>
          [<span class="hljs-string">'Element'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'delimiter'</span>],<font></font>
          ]],<font></font>
          [<span class="hljs-string">'Quantifier'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'*'</span>]]],<font></font>
        ]],<font></font>
        [<span class="hljs-string">'Expression'</span>, [<font></font>
          [<span class="hljs-string">'Element'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'Rule'</span>],<font></font>
          ]],<font></font>
          [<span class="hljs-string">'Quantifier'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'*'</span>]]],<font></font>
        ]],<font></font>
      ]],<font></font>
    ]],<font></font>
  ]],<font></font>
  [<span class="hljs-string">'Rule'</span>, [<font></font>
    [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'delimiter'</span>],<font></font>
    [<span class="hljs-string">'RuleBody'</span>, [<font></font>
      [<span class="hljs-string">'Statement'</span>, [<font></font>
        [<span class="hljs-string">'Expression'</span>, [<font></font>
          [<span class="hljs-string">'Element'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'space'</span>],<font></font>
          ]],<font></font>
        ]],<font></font>
      ]],<font></font>
      [<span class="hljs-string">'Statement'</span>, [<font></font>
        [<span class="hljs-string">'Expression'</span>, [<font></font>
          [<span class="hljs-string">'Element'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'comment'</span>],<font></font>
          ]],<font></font>
        ]],<font></font>
      ]],<font></font>
    ]],<font></font>
  ]],<font></font>
  [<span class="hljs-string">'Rule'</span>, [<font></font>
    [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'space'</span>],<font></font>
    [<span class="hljs-string">'RuleBody'</span>, [<font></font>
      [<span class="hljs-string">'Statement'</span>, [<font></font>
        [<span class="hljs-string">'Expression'</span>, [<font></font>
          [<span class="hljs-string">'Element'</span>, [<font></font>
            [<span class="hljs-string">'RegexpLiteral'</span>, [<font></font>
              [<span class="hljs-string">'SymbolRange'</span>, [<font></font>
                [<span class="hljs-string">'Symbol'</span>, [[<span class="hljs-string">'AnySymbol'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">' '</span>]]]]],<font></font>
              ]],<font></font>
              [<span class="hljs-string">'SymbolRange'</span>, [<font></font>
                [<span class="hljs-string">'Symbol'</span>, [[<span class="hljs-string">'EscapedSymbol'</span>, [[<span class="hljs-string">'AnySymbol'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'n'</span>]]]]]]],<font></font>
              ]],<font></font>
              [<span class="hljs-string">'SymbolRange'</span>, [<font></font>
                [<span class="hljs-string">'Symbol'</span>, [[<span class="hljs-string">'EscapedSymbol'</span>, [[<span class="hljs-string">'AnySymbol'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'t'</span>]]]]]]],<font></font>
              ]],<font></font>
              [<span class="hljs-string">'SymbolRange'</span>, [<font></font>
                [<span class="hljs-string">'Symbol'</span>, [[<span class="hljs-string">'EscapedSymbol'</span>, [[<span class="hljs-string">'AnySymbol'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'r'</span>]]]]]]],<font></font>
              ]],<font></font>
            ]],<font></font>
          ]],<font></font>
          [<span class="hljs-string">'Quantifier'</span>, [[<span class="hljs-string">''</span>, <span class="hljs-string">'+'</span>]]],<font></font>
        ]],<font></font>
      ]],<font></font>
    ]],<font></font>
  ]],<font></font>
  ...<font></font>
]];</code></pre><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.</p><br>
<p>       .</p><br>
<pre><code class="php hljs">[<span class="hljs-string">'Symbol'</span>, [<font></font>
    [<span class="hljs-string">'EscapedSymbol'</span>, [<font></font>
        [<span class="hljs-string">'AnySymbol'</span>, [<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">'n'</span>],<font></font>
        ]],<font></font>
    ]],<font></font>
]],</code></pre><br>
<p>  ,             ,        .</p><br>
<p> <code>RuleName</code>        ,   ,       .</p><br>
<p> ,    <code>( ,   )</code>    .   .   ,   <code>GdlNode</code>.</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">GdlNode</b>
                        <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GdlNode</span>
</span>{
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> string */</span>
    <span class="hljs-keyword">protected</span> $name;<font></font>
<font></font>
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> static[]|string */</span>
    <span class="hljs-keyword">protected</span> $value;<font></font>
<font></font>
    <span class="hljs-keyword">protected</span> $hashValue = [];<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$name, $value</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;name = $name;
        <span class="hljs-keyword">$this</span>-&gt;value = $value;<font></font>
<font></font>
        <span class="hljs-keyword">$this</span>-&gt;init();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">if</span> (is_array(<span class="hljs-keyword">$this</span>-&gt;value)) {
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;value <span class="hljs-keyword">as</span> &amp;$element) {
                <span class="hljs-keyword">$this</span>-&gt;hashValue[$element-&gt;getName()][] = $element;<font></font>
            }<font></font>
            <span class="hljs-keyword">unset</span>($element);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;name;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValue</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;value;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setValue</span>(<span class="hljs-params">$value</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;value = $value;
        <span class="hljs-keyword">$this</span>-&gt;init();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">$name</span>): ?<span class="hljs-title">GdlNode</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;hashValue[$name][<span class="hljs-number">0</span>] ?? <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFirst</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;value[<span class="hljs-number">0</span>];<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> string $name
     * <span class="hljs-doctag">@return</span> GdlNode[]
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getArray</span>(<span class="hljs-params">$name</span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;hashValue[$name] ?? [];<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toString</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-keyword">$this</span>-&gt;value)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (is_string(<span class="hljs-keyword">$this</span>-&gt;value)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;value;<font></font>
        }<font></font>
<font></font>
        $str = [];<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;value <span class="hljs-keyword">as</span> $n =&gt; $item) {<font></font>
            $str[] = $item-&gt;toString();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> implode(<span class="hljs-string">''</span>, $str);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toArray</span>(<span class="hljs-params"></span>)
    </span>{<font></font>
        $name = <span class="hljs-keyword">$this</span>-&gt;getName();<font></font>
        $value = [];<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (is_array(<span class="hljs-keyword">$this</span>-&gt;value)) {
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;value <span class="hljs-keyword">as</span> $element) {<font></font>
                $elementRes = $element-&gt;toArray();<font></font>
                $value[] = $elementRes;<font></font>
            }<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {<font></font>
            $value = <span class="hljs-keyword">$this</span>-&gt;value;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> [$name, $value];<font></font>
    }<font></font>
}</code></pre></div>
                    </div><br>
<p>      <code>get($name)</code>  <code>getArray($name)</code>.       , <code>$name</code>   .</p><br>
<p>  :</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/** <span class="hljs-doctag">@var</span> GdlNode $grammar */</span>
<span class="hljs-keyword">foreach</span> ($grammar-&gt;getArray(<span class="hljs-string">'Rule'</span>) <span class="hljs-keyword">as</span> $rule) {
    <span class="hljs-keyword">echo</span> $rule-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;toString() . <span class="hljs-string">"\n"</span>;<font></font>
}</code></pre><br>
<p>    <code>toString()</code>,     ,       .        .</p><br>
<p><code>RuleName</code>        <code>[a-zA-Z_] [a-zA-Z_0-9]*</code>,           ,     <code>RuleName</code>    ,   ,     <code>$selfGrammar</code>. <code>toString()</code>    .        ,     .   <code>Symbol</code>       <code>['AnySymbol', [['', ' ']]]</code>,  <code>['AnySymbol', ' ']</code>   <code>toString()</code>,     ,  ,    ,        .</p><br>
<p>         GdlNode  .         <code>new GdlNode(...)</code>,     ,    .</p><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Stream</a>.    ,     PHP-.          .       ,     .</p><br>
<p>    .</p><br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GdlParser</span>
</span>{
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> GdlNode[]  Keys are rule names */</span>
    <span class="hljs-keyword">protected</span> $ruleMap;<font></font>
<font></font>
    <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> Stream */</span>
    <span class="hljs-keyword">protected</span> $stream;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">GdlNode $grammar</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;initRules($grammar);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initRules</span>(<span class="hljs-params">GdlNode $grammar</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;ruleMap = [];
        <span class="hljs-keyword">foreach</span> ($grammar-&gt;getArray(<span class="hljs-string">'Rule'</span>) <span class="hljs-keyword">as</span> $rule) {
            <span class="hljs-keyword">$this</span>-&gt;ruleMap[$rule-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;toString()] = $rule;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $mainRuleName, Stream $stream</span>)
    </span>{
        <span class="hljs-keyword">$this</span>-&gt;stream = $stream;<font></font>
<font></font>
        $rule = <span class="hljs-keyword">$this</span>-&gt;getRule($mainRuleName);<font></font>
        $result = <span class="hljs-keyword">$this</span>-&gt;parseRule($rule);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> $result;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
}</code></pre><br>
<p>   .   ,             .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseRule</span>(<span class="hljs-params">GdlNode $rule</span>)
</span>{<font></font>
    $ruleName = $rule-&gt;get(<span class="hljs-string">'RuleName'</span>);<font></font>
    $ruleNameStr = ($ruleName !== <span class="hljs-literal">null</span> ? $ruleName-&gt;toString() : <span class="hljs-string">'()'</span>);<font></font>
<font></font>
    $parsedRule = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    $statementList = $rule-&gt;get(<span class="hljs-string">'RuleBody'</span>)-&gt;getArray(<span class="hljs-string">'Statement'</span>);<font></font>
    $initialPos = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;getPos();
    <span class="hljs-keyword">foreach</span> ($statementList <span class="hljs-keyword">as</span> $statement) {<font></font>
        $parsedRule = <span class="hljs-keyword">$this</span>-&gt;parseStatement($statement);
        <span class="hljs-keyword">if</span> ($parsedRule !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">// try parse next variant from same position</span>
        <span class="hljs-keyword">$this</span>-&gt;stream-&gt;setPos($initialPos);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> ($parsedRule === <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">new</span> GdlNode($ruleNameStr, $parsedRule));<font></font>
}</code></pre><br>
<p>    Statement.   ,     Statement,    ,     .<br>
<code>'()'</code>     inline-  .   ,        .      ,       -    ,        .     ,        .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseStatement</span>(<span class="hljs-params">GdlNode $statement</span>)
</span>{<font></font>
    $parsedStatement = [];<font></font>
<font></font>
    $expressionList = $statement-&gt;getArray(<span class="hljs-string">'Expression'</span>);
    <span class="hljs-keyword">foreach</span> ($expressionList <span class="hljs-keyword">as</span> $i =&gt; $expression) {<font></font>
        $lookAheadElement = <span class="hljs-literal">null</span>;<font></font>
        $lookAhead = $expression-&gt;get(<span class="hljs-string">'LookAhead'</span>);
        <span class="hljs-keyword">if</span> ($lookAhead !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> ($lookAhead-&gt;get(<span class="hljs-string">'Element'</span>) !== <span class="hljs-literal">null</span>) {<font></font>
                $lookAheadElement = $lookAhead-&gt;get(<span class="hljs-string">'Element'</span>);<font></font>
            }<font></font>
            <span class="hljs-keyword">elseif</span> (<span class="hljs-keyword">isset</span>($expressionList[$i + <span class="hljs-number">1</span>])) {<font></font>
                $lookAheadElement = $expressionList[$i + <span class="hljs-number">1</span>]-&gt;get(<span class="hljs-string">'Element'</span>);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        $parsedExpression = <span class="hljs-keyword">$this</span>-&gt;parseExpression($expression, $lookAheadElement);
        <span class="hljs-keyword">if</span> ($parsedExpression === <span class="hljs-literal">null</span>) {<font></font>
            $parsedStatement = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($parsedExpression)) {
            <span class="hljs-comment">// skip elements with name started with small letter</span>
            $name = $parsedExpression[<span class="hljs-number">0</span>]-&gt;getName();  <span class="hljs-comment">// all parsed elements in expression have same name</span>
            $isSmallLetter = (!<span class="hljs-keyword">empty</span>($name) &amp;&amp; ($name[<span class="hljs-number">0</span>] &gt;= <span class="hljs-string">'a'</span> &amp;&amp; $name[<span class="hljs-number">0</span>] &lt;= <span class="hljs-string">'z'</span>));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!$isSmallLetter) {
                <span class="hljs-keyword">if</span> ($name === <span class="hljs-string">'()'</span>) {
                    <span class="hljs-keyword">foreach</span> ($parsedExpression <span class="hljs-keyword">as</span> $inlineRule) {
                        <span class="hljs-keyword">$this</span>-&gt;addToParsedStatement($parsedStatement, $inlineRule-&gt;getValue());<font></font>
                    }<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">$this</span>-&gt;addToParsedStatement($parsedStatement, $parsedExpression);<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $parsedStatement;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToParsedStatement</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> &amp;$parsedStatement, <span class="hljs-keyword">array</span> $parsedExpression</span>)
</span>{
    <span class="hljs-keyword">foreach</span> ($parsedExpression <span class="hljs-keyword">as</span> $parsedElement) {<font></font>
        $parsedStatement[] = $parsedElement;<font></font>
    }<font></font>
}</code></pre><br>
<p>    Expression.   Expression,     ,      Statement.  LookAhead.      .  inline-   ,       .</p><br>
<p>     ,        ,        .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseExpression</span>(<span class="hljs-params">GdlNode $expression, ?GdlNode $lookAheadElement = <span class="hljs-literal">null</span></span>)
</span>{<font></font>
    $element = $expression-&gt;get(<span class="hljs-string">'Element'</span>);<font></font>
<font></font>
    $quantifier = $expression-&gt;get(<span class="hljs-string">'Quantifier'</span>);<font></font>
    $quantifierType = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> ($quantifier !== <span class="hljs-literal">null</span>) {<font></font>
        $quantifierType = $quantifier-&gt;get(<span class="hljs-string">''</span>)-&gt;getValue();<font></font>
    }<font></font>
<font></font>
    $parsedElementList = [];<font></font>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<font></font>
        $initialElementPos = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;getPos();<font></font>
<font></font>
        $parsedLookAheadElement = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> ($lookAheadElement !== <span class="hljs-literal">null</span>) {<font></font>
            $parsedLookAheadElement = <span class="hljs-keyword">$this</span>-&gt;parseElement($lookAheadElement);
            <span class="hljs-keyword">$this</span>-&gt;stream-&gt;setPos($initialElementPos);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ($parsedLookAheadElement !== <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        $parsedElement = <span class="hljs-keyword">$this</span>-&gt;parseElement($element);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> ($parsedElement !== <span class="hljs-literal">null</span>) {<font></font>
            $parsedElementList[] = $parsedElement;<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">$this</span>-&gt;stream-&gt;setPos($initialElementPos);
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> ($quantifierType === <span class="hljs-literal">null</span> || $quantifierType === <span class="hljs-string">'?'</span>) {
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    $countDoesNotMatch = (($quantifierType === <span class="hljs-literal">null</span> || $quantifierType === <span class="hljs-string">'+'</span>) ? <span class="hljs-keyword">empty</span>($parsedElementList) : <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">if</span> ($countDoesNotMatch) {<font></font>
        $parsedElementList = <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $parsedElementList;<font></font>
}</code></pre><br>
<p>    LookAhead.   ,    .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseElement</span>(<span class="hljs-params">GdlNode $element</span>)
</span>{<font></font>
    $specificElement = $element-&gt;getFirst();<font></font>
    $elementType = $specificElement-&gt;getName();<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($elementType === <span class="hljs-string">'RuleName'</span>) {<font></font>
        $rule = <span class="hljs-keyword">$this</span>-&gt;getRule($specificElement-&gt;toString());<font></font>
        $parsedElement = <span class="hljs-keyword">$this</span>-&gt;parseRule($rule);<font></font>
    }<font></font>
    <span class="hljs-keyword">elseif</span> ($elementType === <span class="hljs-string">'StringLiteral'</span>) {<font></font>
        $parsedElement = <span class="hljs-keyword">$this</span>-&gt;parseStringLiteral($specificElement);<font></font>
    }<font></font>
    <span class="hljs-keyword">elseif</span> ($elementType === <span class="hljs-string">'RegexpLiteral'</span>) {<font></font>
        $parsedElement = <span class="hljs-keyword">$this</span>-&gt;parseRegexpLiteral($specificElement);<font></font>
    }<font></font>
    <span class="hljs-keyword">elseif</span> ($elementType === <span class="hljs-string">'InlineRule'</span>) {<font></font>
        $parsedElement = <span class="hljs-keyword">$this</span>-&gt;parseRule($specificElement);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Unknown element type: '</span> . $elementType);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $parsedElement;<font></font>
}</code></pre><br>
<p>       ,     . Inline-      .</p><br>
<p>     ,     GdlNode,  <code>parseElement()</code>    .      label  ,   ANTLR,     <code>parseRule()</code>  ,       <code>setName()</code>  GdlNode,     .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseStringLiteral</span>(<span class="hljs-params">GdlNode $element</span>)
</span>{<font></font>
    $parsedValue = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    $symbolList = $element-&gt;getArray(<span class="hljs-string">'Symbol'</span>);
    <span class="hljs-keyword">foreach</span> ($symbolList <span class="hljs-keyword">as</span> $symbol) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;stream-&gt;eof()) {<font></font>
            $parsedValue = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        $contentSymbol = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;readSymbol();<font></font>
        $str = <span class="hljs-keyword">$this</span>-&gt;getSymbolStr($symbol);
        <span class="hljs-keyword">if</span> ($contentSymbol !== $str) {<font></font>
            $parsedValue = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
<font></font>
        $parsedValue .= $contentSymbol;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> ($parsedValue === <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">new</span> GdlNode(<span class="hljs-string">''</span>, $parsedValue));<font></font>
}</code></pre><br>
<p> ,    .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseRegexpLiteral</span>(<span class="hljs-params">GdlNode $element</span>)
</span>{<font></font>
    $parsedValue = <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;stream-&gt;eof()) {<font></font>
        $contentSymbol = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;readSymbol();
        <span class="hljs-keyword">if</span> ($element-&gt;get(<span class="hljs-string">'AnySymbolLiteral'</span>) !== <span class="hljs-literal">null</span>) {<font></font>
            $parsedValue = $contentSymbol;<font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {<font></font>
            $symbolRangeList = $element-&gt;getArray(<span class="hljs-string">'SymbolRange'</span>);
            <span class="hljs-keyword">foreach</span> ($symbolRangeList <span class="hljs-keyword">as</span> $symbolRange) {<font></font>
                $symbolList = $symbolRange-&gt;getArray(<span class="hljs-string">'Symbol'</span>);<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (count($symbolList) === <span class="hljs-number">2</span>) {<font></font>
                    $strFrom = <span class="hljs-keyword">$this</span>-&gt;getSymbolStr($symbolList[<span class="hljs-number">0</span>]);<font></font>
                    $strTo = <span class="hljs-keyword">$this</span>-&gt;getSymbolStr($symbolList[<span class="hljs-number">1</span>]);<font></font>
<font></font>
                    <span class="hljs-comment">// use build-in PHP string comparison</span>
                    <span class="hljs-keyword">if</span> ($contentSymbol &gt;= $strFrom &amp;&amp; $contentSymbol &lt;= $strTo) {<font></font>
                        $parsedValue = $contentSymbol;<font></font>
                        <span class="hljs-keyword">break</span>;<font></font>
                    }<font></font>
                }<font></font>
                <span class="hljs-keyword">elseif</span> (count($symbolList) === <span class="hljs-number">1</span>) {<font></font>
                    $str = <span class="hljs-keyword">$this</span>-&gt;getSymbolStr($symbolList[<span class="hljs-number">0</span>]);<font></font>
<font></font>
                    <span class="hljs-keyword">if</span> ($contentSymbol === $str) {<font></font>
                        $parsedValue = $contentSymbol;<font></font>
                        <span class="hljs-keyword">break</span>;<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> ($parsedValue === <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">new</span> GdlNode(<span class="hljs-string">''</span>, $parsedValue));<font></font>
}</code></pre><br>
<p>  ,  .       .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">protected</span> $escapedSymbols = [<span class="hljs-string">'s'</span> =&gt; <span class="hljs-string">' '</span>, <span class="hljs-string">'t'</span> =&gt; <span class="hljs-string">"\t"</span>, <span class="hljs-string">'r'</span> =&gt; <span class="hljs-string">"\r"</span>, <span class="hljs-string">'n'</span> =&gt; <span class="hljs-string">"\n"</span>];<font></font>
<font></font>
<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSymbolStr</span>(<span class="hljs-params">GdlNode $symbol</span>)
</span>{<font></font>
    $str = <span class="hljs-literal">null</span>;<font></font>
    $specificElement = $symbol-&gt;getFirst();<font></font>
    $elementType = $specificElement-&gt;getName();<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ($elementType === <span class="hljs-string">'AnySymbol'</span>) {<font></font>
        $str = $specificElement-&gt;get(<span class="hljs-string">''</span>)-&gt;getValue();<font></font>
    }<font></font>
    <span class="hljs-keyword">elseif</span> ($elementType === <span class="hljs-string">'EscapedSymbol'</span>) {<font></font>
        $str = $specificElement-&gt;get(<span class="hljs-string">'AnySymbol'</span>)-&gt;get(<span class="hljs-string">''</span>)-&gt;getValue();<font></font>
        $str = (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;escapedSymbols[$str]) ? <span class="hljs-keyword">$this</span>-&gt;escapedSymbols[$str] : $str);<font></font>
    }<font></font>
    <span class="hljs-keyword">elseif</span> ($elementType === <span class="hljs-string">'HexCodeSymbol'</span>) {
        <span class="hljs-keyword">list</span>($hexDigit1, $hexDigit2) = $specificElement-&gt;getArray(<span class="hljs-string">'HexDigit'</span>);<font></font>
        $intValue1 = ord($hexDigit1-&gt;get(<span class="hljs-string">''</span>)-&gt;getValue()) - <span class="hljs-number">0x30</span>;<font></font>
        $intValue2 = ord($hexDigit2-&gt;get(<span class="hljs-string">''</span>)-&gt;getValue()) - <span class="hljs-number">0x30</span>;<font></font>
        $intValue1 -= ($intValue1 &gt;= <span class="hljs-number">0x0A</span> ? <span class="hljs-number">0x07</span> : <span class="hljs-number">0</span>);<font></font>
        $intValue2 -= ($intValue2 &gt;= <span class="hljs-number">0x0A</span> ? <span class="hljs-number">0x07</span> : <span class="hljs-number">0</span>);<font></font>
        $code = $intValue1 * <span class="hljs-number">0x10</span> + $intValue2;<font></font>
        $str = chr($code);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> $str;<font></font>
}</code></pre><br>
<p>          hex-.</p><br>
<p>   .</p><br>
<p>      .      <code>self.php</code>,   <code>self.gdl</code>,   .    ,       ,    ,      <code>self.php</code>   —      StringLiteral.     .      <code>self.gdl</code>  ,    .        .    ,   .</p><br>
<p>  ,     ,     ,           .     —              .   <code>RuleName</code>   .       .</p><br>
<p>      ,     <code>testSelfParsing()</code>.</p><br>
<pre><code class="plaintext hljs">php parser_test.php testSelfParsing<font></font>
0.077260971069336<font></font>
0.12426900863647</code></pre><br>
<p>    ,  <code>microtime()</code>.         <code>self.php</code>,        .     ,    .  ,  <code>toString()</code>   .  <code>self.php</code>    ,     ,      ,      .</p><br>
<h3 id="obrabotka-oshibok"> </h3><br>
<p>,    -    ,         ,       null.<br>
  ,   . ,      <code>ReturnStatement</code>       <code>return</code>,    <code>ReturnStatement</code>,      - ,   <code>';'</code>.       ,     "Expected ';'".         <code>return</code>.</p><br>
<p>     ,      <code>parseRule()</code>,  ,    -.   ,    "Expected ';'",   ,    ,    .     ,   ,   ,     ,      .       ,    .   ,    ,     ,   .</p><br>
<p>       ,     .      .     .</p><br>
<p>   ,      .       .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">diff</b>
                        <div class="spoiler_text"><pre><code class="diff hljs">GdlParser.php<font></font>
<font></font>
     protected function parseRule(GdlNode $rule)<font></font>
     {<font></font>
         $ruleName = $rule-&gt;get('RuleName');<font></font>
         $ruleNameStr = ($ruleName !== null ? $ruleName-&gt;toString() : '()');<font></font>
<span class="hljs-addition">+        $this-&gt;ruleCallStack[] = [$ruleNameStr, $this-&gt;stream-&gt;getPos()];</span><font></font>
<font></font>
         ...<font></font>
<font></font>
<span class="hljs-addition">+        array_pop($this-&gt;ruleCallStack);</span>
<span class="hljs-addition">+</span>
         return ($parsedRule <span class="hljs-comment">=== null ? null : new GdlNode($ruleNameStr, $parsedRule));</span><font></font>
     }<font></font>
<font></font>
     protected function parseStatement(GdlNode $statement)<font></font>
     {<font></font>
         $parsedStatement = [];<font></font>
<font></font>
         $expressionList = $statement-&gt;getArray('Expression');<font></font>
<span class="hljs-addition">+        $cut = false;</span><font></font>
         foreach ($expressionList as $i =&gt; $expression) {<font></font>
             ...<font></font>
<font></font>
             $parsedExpression = $this-&gt;parseExpression($expression, $lookAheadElement);<font></font>
             if ($parsedExpression <span class="hljs-comment">=== null) {</span>
<span class="hljs-deletion">-                $parsedStatement = null;</span>
<span class="hljs-deletion">-                break;</span>
<span class="hljs-addition">+                if ($cut) {</span>
<span class="hljs-addition">+                    $this-&gt;handleError($expression);</span>
<span class="hljs-addition">+                    continue;</span>
<span class="hljs-addition">+                }</span>
<span class="hljs-addition">+                else {</span>
<span class="hljs-addition">+                    $parsedStatement = null;</span>
<span class="hljs-addition">+                    break;</span>
<span class="hljs-addition">+                }</span><font></font>
             }<font></font>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+            if ($expression-&gt;get('Cut') !== null) {</span>
<span class="hljs-addition">+                $cut = true;</span>
<span class="hljs-addition">+            }</span><font></font>
             ...<font></font>
         }<font></font>
         ...<font></font>
     }<font></font>
<font></font>
<span class="hljs-addition">+    protected function handleError(GdlNode $expression)</span>
<span class="hljs-addition">+    {</span>
<span class="hljs-addition">+        $elementType = $expression-&gt;get('Element')-&gt;getFirst()-&gt;getName();</span>
<span class="hljs-addition">+        if ($elementType === 'StringLiteral' || $elementType === 'RegexpLiteral') {</span>
<span class="hljs-addition">+            $name = $expression-&gt;toString();</span>
<span class="hljs-addition">+        }</span>
<span class="hljs-addition">+        else {</span>
<span class="hljs-addition">+            $name = $expression-&gt;get('Element')-&gt;getFirst()-&gt;toString();</span>
<span class="hljs-addition">+        }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+        $i = count($this-&gt;ruleCallStack) - 1;</span>
<span class="hljs-addition">+        while ($this-&gt;ruleCallStack[$i][0] == '()') { $i--; }</span>
<span class="hljs-addition">+        $ruleInfo = $this-&gt;ruleCallStack[$i];</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+        $this-&gt;errors[] = 'Expected ' . $name . ' at ' . implode(':', $this-&gt;stream-&gt;getLineAndColumn()) . ' (' . $this-&gt;stream-&gt;getPos() . ')'</span>
<span class="hljs-addition">+            . ' in ' . $ruleInfo[0] . ' at ' . implode(':', $this-&gt;stream-&gt;getLineAndColumn($ruleInfo[1])) . ' (' . $ruleInfo[1] . ')';</span>
<span class="hljs-addition">+    }</span><font></font>
<font></font>
self.gdl<font></font>
<font></font>
Rule:<font></font>
<span class="hljs-deletion">-    RuleName delimiter* ':' delimiter* RuleBody ';' delimiter*</span>
<span class="hljs-addition">+    RuleName! delimiter* ':' delimiter* RuleBody ';' delimiter*</span><font></font>
;<font></font>
...</code></pre></div>
                    </div><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testParsingErrors</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $mainRuleName = <span class="hljs-string">'Grammar'</span>;<font></font>
    $gdlParser = <span class="hljs-keyword">new</span> GdlParser(<span class="hljs-keyword">$this</span>-&gt;getSelfGrammar());<font></font>
<font></font>
    $grammarSource = <span class="hljs-string">&lt;&lt;&lt;'SRC'
Program:
;

Test:;

SRC;</span>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($grammarSource));
    <span class="hljs-keyword">foreach</span> ($languageGrammar-&gt;getArray(<span class="hljs-string">'Rule'</span>) <span class="hljs-keyword">as</span> $rule) {<font></font>
        $rule-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;setValue($rule-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;toString());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($languageGrammar-&gt;toArray() === [<span class="hljs-string">'Grammar'</span>, [<font></font>
        [<span class="hljs-string">'Rule'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'Program'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">':'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">';'</span>],<font></font>
        ]],<font></font>
        [<span class="hljs-string">'Rule'</span>, [<font></font>
            [<span class="hljs-string">'RuleName'</span>, <span class="hljs-string">'Test'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">':'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">';'</span>],<font></font>
        ]],<font></font>
    ]]);<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($gdlParser-&gt;getErrors() === [
        <span class="hljs-string">'Expected RuleBody at 2:1 (9) in Rule at 1:1 (0)'</span>,
        <span class="hljs-string">'Expected RuleBody at 4:6 (17) in Rule at 4:1 (12)'</span>,<font></font>
    ]);<font></font>
<font></font>
    $grammarSource = <span class="hljs-string">&lt;&lt;&lt;'SRC'
SRC;</span>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($grammarSource));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($languageGrammar-&gt;toArray() === [<span class="hljs-string">'Grammar'</span>, []]);
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($gdlParser-&gt;getErrors());<font></font>
}</code></pre><br>
<h3 id="dopolnitelnye-vozmozhnosti"> </h3><br>
<p>      ,       UTF-8.  UTF-8    <code>AnySymbol*</code>     UTF-8,       . </p><br>
<p>      ,    UTF     Stream.     .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testUtf8</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $mainRuleName = <span class="hljs-string">'Grammar'</span>;<font></font>
    $gdlParser = <span class="hljs-keyword">new</span> GdlParser(<span class="hljs-keyword">$this</span>-&gt;getSelfGrammar());<font></font>
<font></font>
    $grammarSource = <span class="hljs-string">&lt;&lt;&lt;'SRC'
Grammar:
    (Word={str} '\n')*
;

Word:
    Utf8RussianLetter+
;

Utf8RussianLetter:
    | [\xD0][\x90-\xBF]  /* -- */
    | [\xD1][\x80-\x8F]  /* - */
    | [\xD0][\x01]       /*  */
    | [\xD1][\x91]       /*  */
;
SRC;</span>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($grammarSource));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($gdlParser-&gt;getErrors());<font></font>
<font></font>
    $mainRuleName = $languageGrammar-&gt;get(<span class="hljs-string">'Rule'</span>)-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;getValue();<font></font>
    $languageParser = <span class="hljs-keyword">new</span> GdlParser($languageGrammar);<font></font>
<font></font>
    $source = <span class="hljs-string">&lt;&lt;&lt;'SRC'




SRC;</span>
    $tree = $languageParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($source));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($languageParser-&gt;getErrors());
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($tree-&gt;toArray() === [<span class="hljs-string">'Grammar'</span>, [<font></font>
        [<span class="hljs-string">'Word'</span>, <span class="hljs-string">''</span>],<font></font>
        [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
        [<span class="hljs-string">'Word'</span>, <span class="hljs-string">''</span>],<font></font>
        [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
        [<span class="hljs-string">'Word'</span>, <span class="hljs-string">''</span>],<font></font>
        [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
    ]]);<font></font>
}</code></pre><br>
<p>     TCP-   .     ,         ,   ,        .</p><br>
<p>,  ,      ,     .</p><br>
<pre><code class="plaintext hljs">3<font></font>
Element1<font></font>
Element2<font></font>
Element3</code></pre><br>
<p>    .        ?     ?  big-endian  little-endian?</p><br>
<p>     .</p><br>
<p> ANTLR       .        ,      ,      ,       <code>=</code>.      .       ,       ,       .     ,       null,  ,     .         .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">diff</b>
                        <div class="spoiler_text"><pre><code class="diff hljs">GdlParser.php<font></font>
<font></font>
     protected function parseExpression(GdlNode $expression, ?GdlNode $lookAheadElement = null)<font></font>
     {<font></font>
         $element = $expression-&gt;get('Element');<font></font>
<font></font>
<span class="hljs-addition">+        $elementFunctionNameList = null;</span>
<span class="hljs-addition">+        if ($expression-&gt;get('FunctionCall') !== null) {</span>
<span class="hljs-addition">+            foreach ($expression-&gt;get('FunctionCall')-&gt;getArray('FunctionName') as $functionName) {</span>
<span class="hljs-addition">+                $elementFunctionNameList[] = $functionName-&gt;toString();</span>
<span class="hljs-addition">+            }</span>
<span class="hljs-addition">+        }</span>
<span class="hljs-addition">+</span><font></font>
         $quantifier = $expression-&gt;get('Quantifier');<font></font>
         $quantifierType = null;<font></font>
<span class="hljs-addition">+        $countVal = 0;</span><font></font>
         if ($quantifier !== null) {<font></font>
<span class="hljs-deletion">-            $quantifierType = $quantifier-&gt;get('')-&gt;getValue();</span>
<span class="hljs-addition">+            $count = $quantifier-&gt;get('Count');</span>
<span class="hljs-addition">+            if ($count === null) {</span>
<span class="hljs-addition">+                $quantifierType = $quantifier-&gt;get('')-&gt;getValue();</span>
<span class="hljs-addition">+            }</span>
<span class="hljs-addition">+            else {</span>
<span class="hljs-addition">+                $quantifierType = '{}';</span>
<span class="hljs-addition">+                if ($count-&gt;get('IntValue') !== null) {</span>
<span class="hljs-addition">+                    $countVal = intval($count-&gt;get('IntValue')-&gt;toString());</span>
<span class="hljs-addition">+                }</span>
<span class="hljs-addition">+                elseif ($count-&gt;get('FunctionCall') !== null) {</span>
<span class="hljs-addition">+                    $countFunctionName = $count-&gt;get('FunctionCall')-&gt;get('FunctionName')-&gt;toString();</span>
<span class="hljs-addition">+                    $countVal = $this-&gt;$countFunctionName();</span>
<span class="hljs-addition">+                }</span>
<span class="hljs-addition">+            }</span><font></font>
         }<font></font>
<font></font>
             $parsedElement = $this-&gt;parseElement($element);<font></font>
<span class="hljs-addition">+            if ($elementFunctionNameList !== null &amp;&amp; $parsedElement !== null) {</span>
<span class="hljs-addition">+                foreach ($elementFunctionNameList as $elementFunctionName) {</span>
<span class="hljs-addition">+                    $this-&gt;$elementFunctionName($parsedElement);</span>
<span class="hljs-addition">+                    if ($parsedElement === null) {</span>
<span class="hljs-addition">+                        break;</span>
<span class="hljs-addition">+                    }</span>
<span class="hljs-addition">+                }</span>
<span class="hljs-addition">+            }</span><font></font>
<font></font>
<span class="hljs-deletion">-            if ($quantifierType === null || $quantifierType === '?') {</span>
<span class="hljs-addition">+            if ($quantifierType === null || $quantifierType === '?' || $quantifierType === '{}' &amp;&amp; count($parsedElementList) === $countVal) {</span><font></font>
                 break;<font></font>
             }<font></font>
         }<font></font>
<font></font>
<span class="hljs-deletion">-        $countDoesNotMatch = (($quantifierType === null || $quantifierType === '+') ? empty($parsedElementList) : false);</span>
<span class="hljs-addition">+        $countDoesNotMatch = (($quantifierType === null || $quantifierType === '+') ? empty($parsedElementList)</span>
<span class="hljs-addition">+            : (($quantifierType === '{}') ? count($parsedElementList) !== $countVal : false)</span>
<span class="hljs-addition">+        );</span><font></font>
         if ($countDoesNotMatch) {<font></font>
             $parsedElementList = null;<font></font>
         }<font></font>
<font></font>
self.gdl<font></font>
<font></font>
 Expression:<font></font>
<span class="hljs-deletion">-    Element Quantifier? LookAhead? Cut? delimiter*</span>
<span class="hljs-addition">+    Element FunctionCall? Quantifier? LookAhead? Cut? delimiter*</span><font></font>
 ;<font></font>
<font></font>
 Quantifier:<font></font>
     | '*'<font></font>
     | '?'<font></font>
     | '+'<font></font>
<span class="hljs-addition">+    | '{' Count '}'</span><font></font>
 ;<font></font>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+Count:</span>
<span class="hljs-addition">+    | IntValue</span>
<span class="hljs-addition">+    | FunctionCall</span>
<span class="hljs-addition">+;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+IntValue:</span>
<span class="hljs-addition">+    [0-9]+</span>
<span class="hljs-addition">+;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+FunctionCall:</span>
<span class="hljs-addition">+    '={'! FunctionName (',' FunctionName)* '}'</span>
<span class="hljs-addition">+;</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+FunctionName:</span>
<span class="hljs-addition">+    ID</span>
<span class="hljs-addition">+;</span></code></pre></div>
                    </div><br>
<p>   ,          .      <code>Function</code>  <code>Element</code>,      .</p><br>
<p>  <code>Count</code>  <code>FunctionCall</code>   .   <code>Count</code>   int,       .</p><br>
<p>     .</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testCount</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $mainRuleName = <span class="hljs-string">'Grammar'</span>;<font></font>
    $gdlParser = <span class="hljs-keyword">new</span> GdlParser(<span class="hljs-keyword">$this</span>-&gt;getSelfGrammar());<font></font>
<font></font>
    $grammarSource = <span class="hljs-string">&lt;&lt;&lt;'SRC'
Data:
    Count={setCount} '\n' Element{={getCount}}
;

Count:
    [0-9]{4}
;

Element:
    [a-zA-Z0-9]+ '\n'
;
SRC;</span>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($grammarSource));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($gdlParser-&gt;getErrors());<font></font>
<font></font>
    $mainRuleName = $languageGrammar-&gt;get(<span class="hljs-string">'Rule'</span>)-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;toString();<font></font>
<font></font>
    $languageParser = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span>($<span class="hljs-title">languageGrammar</span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">GdlParser</span> </span>{
        <span class="hljs-keyword">protected</span> $cnt;<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCount</span>(<span class="hljs-params">GdlNode &amp;$parsedElement</span>)
        </span>{
            <span class="hljs-keyword">$this</span>-&gt;cnt = intval($parsedElement-&gt;toString());<font></font>
        }<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCount</span>(<span class="hljs-params"></span>): <span class="hljs-title">int</span>
        </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;cnt;<font></font>
        }<font></font>
    };<font></font>
<font></font>
    $source = <span class="hljs-string">&lt;&lt;&lt;'SRC'
0006</span><font></font>
Element1<font></font>
Element2<font></font>
Element3<font></font>
Element4<font></font>
Element5<font></font>
Element6<font></font>
<font></font>
SRC;<font></font>
    $tree = $languageParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($source));<font></font>
    $tree-&gt;get(<span class="hljs-string">'Count'</span>)-&gt;setValue($tree-&gt;get(<span class="hljs-string">'Count'</span>)-&gt;toString());<font></font>
    $tree-&gt;get(<span class="hljs-string">''</span>)-&gt;setValue($tree-&gt;get(<span class="hljs-string">''</span>)-&gt;toString());
    <span class="hljs-keyword">foreach</span> ($tree-&gt;getArray(<span class="hljs-string">'Element'</span>) <span class="hljs-keyword">as</span> $element) {<font></font>
        $element-&gt;setValue($element-&gt;toString());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($languageParser-&gt;getErrors());
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($tree-&gt;toArray() === [<span class="hljs-string">'Data'</span>, [<font></font>
        [<span class="hljs-string">'Count'</span>, <span class="hljs-string">'0006'</span>],<font></font>
        [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element1\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element2\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element3\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element4\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element5\n"</span>],<font></font>
        [<span class="hljs-string">'Element'</span>, <span class="hljs-string">"Element6\n"</span>],<font></font>
    ]]);<font></font>
}</code></pre><br>
<p>    .     <code>toString()</code>  ,      ,       .    <code>str</code>,    <code>toString()</code>,       <code>RuleName</code>    <code>RuleName={str}</code>.  ,    <code>self.gdl</code>    ,   <code>$ruleName-&gt;toString()</code>     <code>$ruleName-&gt;getValue()</code>.       <code>symbolStr</code>      <code>self.php</code>.</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">diff</b>
                        <div class="spoiler_text"><pre><code class="diff hljs">GdlParser.php<font></font>
<font></font>
     public function initRules(GdlNode $grammar)<font></font>
     {<font></font>
         $this-&gt;ruleMap = [];<font></font>
         foreach ($grammar-&gt;getArray('Rule') as $rule) {<font></font>
<span class="hljs-deletion">-            $this-&gt;ruleMap[$rule-&gt;get('RuleName')-&gt;toString()] = $rule;</span>
<span class="hljs-addition">+            $this-&gt;ruleMap[$rule-&gt;get('RuleName')-&gt;getValue()] = $rule;</span><font></font>
         }<font></font>
     }<font></font>
<font></font>
     protected function parseRule(GdlNode $rule)<font></font>
     {<font></font>
         $ruleName = $rule-&gt;get('RuleName');<font></font>
<span class="hljs-deletion">-        $ruleNameStr = ($ruleName !== null ? $ruleName-&gt;toString() : '()');</span>
<span class="hljs-addition">+        $ruleNameStr = ($ruleName !== null ? $ruleName-&gt;getValue() : '()');</span><font></font>
         $this-&gt;ruleCallStack[] = [$ruleNameStr, $this-&gt;stream-&gt;getPos()];<font></font>
<font></font>
             foreach ($expression-&gt;get('FunctionCall')-&gt;getArray('FunctionName') as $functionName) {<font></font>
<span class="hljs-deletion">-                $elementFunctionNameList[] = $functionName-&gt;toString();</span>
<span class="hljs-addition">+                $elementFunctionNameList[] = $functionName-&gt;getValue();</span><font></font>
<font></font>
<span class="hljs-addition">+    protected function str(GdlNode &amp;$parsedElement)</span>
<span class="hljs-addition">+    {</span>
<span class="hljs-addition">+        $parsedElement-&gt;setValue($parsedElement-&gt;toString());</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    protected function symbolStr(GdlNode &amp;$parsedElement)</span>
<span class="hljs-addition">+    {</span>
<span class="hljs-addition">+        $parsedElement-&gt;setValue($this-&gt;getSymbolStr($parsedElement));</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+</span><font></font>
     protected function parseStringLiteral(GdlNode $element)<font></font>
     { <font></font>
             $contentSymbol = $this-&gt;stream-&gt;readSymbol();<font></font>
<span class="hljs-deletion">-            $str = $this-&gt;getSymbolStr($symbol);</span>
<span class="hljs-addition">+            $str = $symbol-&gt;getValue();</span><font></font>
<font></font>
     protected function parseRegexpLiteral(GdlNode $element)<font></font>
     {<font></font>
                     if (count($symbolList) <span class="hljs-comment">=== 2) {</span>
<span class="hljs-deletion">-                        $strFrom = $this-&gt;getSymbolStr($symbolList[0]);</span>
<span class="hljs-deletion">-                        $strTo = $this-&gt;getSymbolStr($symbolList[1]);</span>
<span class="hljs-addition">+                        $strFrom = $symbolList[0]-&gt;getValue();</span>
<span class="hljs-addition">+                        $strTo = $symbolList[1]-&gt;getValue();</span><font></font>
<font></font>
                     elseif (count($symbolList) <span class="hljs-comment">=== 1) {</span>
<span class="hljs-deletion">-                        $str = $this-&gt;getSymbolStr($symbolList[0]);</span>
<span class="hljs-addition">+                        $str = $symbolList[0]-&gt;getValue();</span><font></font>
<font></font>
self.gdl<font></font>
<font></font>
 Rule:<font></font>
<span class="hljs-deletion">-    RuleName! delimiter* ':' delimiter* RuleBody ';' delimiter*</span>
<span class="hljs-addition">+    RuleName={str}! delimiter* ':' delimiter* RuleBody ';' delimiter*</span><font></font>
 ;<font></font>
<font></font>
 Element:<font></font>
<span class="hljs-deletion">-    | RuleName</span>
<span class="hljs-addition">+    | RuleName={str}</span><font></font>
     | StringLiteral<font></font>
     | RegexpLiteral<font></font>
     | InlineRule<font></font>
 ;<font></font>
<font></font>
 Count:<font></font>
<span class="hljs-deletion">-    | IntValue</span>
<span class="hljs-addition">+    | IntValue={str}</span><font></font>
     | FunctionCall<font></font>
 ;<font></font>
<font></font>
 FunctionCall:<font></font>
<span class="hljs-deletion">-    '={'! FunctionName (',' FunctionName)* '}'</span>
<span class="hljs-addition">+    '={'! FunctionName={str} (',' FunctionName={str})* '}'</span><font></font>
 ;<font></font>
<font></font>
 StringLiteral:<font></font>
<span class="hljs-deletion">-    '\''! Symbol+&gt;&gt; '\''</span>
<span class="hljs-addition">+    '\''! Symbol={symbolStr}+&gt;&gt; '\''</span><font></font>
 ;<font></font>
<font></font>
 SymbolRange:<font></font>
<span class="hljs-deletion">-    Symbol&gt;']' ('-'! Symbol&gt;']')?</span>
<span class="hljs-addition">+    Symbol={symbolStr}&gt;']' ('-'! Symbol={symbolStr}&gt;']')?</span><font></font>
 ;<font></font>
<font></font>
self.php<font></font>
<font></font>
                         ['RegexpLiteral', [<font></font>
                             ['SymbolRange', [<font></font>
<span class="hljs-deletion">-                                ['Symbol', [['AnySymbol', [['', ' ']]]]],</span>
<span class="hljs-addition">+                                ['Symbol', " "],</span><font></font>
                             ]],<font></font>
                             ['SymbolRange', [<font></font>
<span class="hljs-deletion">-                                ['Symbol', [['EscapedSymbol', [['AnySymbol', [['', 'n']]]]]]],</span>
<span class="hljs-addition">+                                ['Symbol', "\n"],</span><font></font>
                             ]],<font></font>
                             ['SymbolRange', [<font></font>
<span class="hljs-deletion">-                                ['Symbol', [['EscapedSymbol', [['AnySymbol', [['', 't']]]]]]],</span>
<span class="hljs-addition">+                                ['Symbol', "\t"],</span><font></font>
                             ]],<font></font>
                             ['SymbolRange', [<font></font>
<span class="hljs-deletion">-                                ['Symbol', [['EscapedSymbol', [['AnySymbol', [['', 'r']]]]]]],</span>
<span class="hljs-addition">+                                ['Symbol', "\r"],</span><font></font>
                             ]],<font></font>
                         ]],<font></font>
                     ]],<font></font>
...</code></pre></div>
                    </div><br>
<p>       ?</p><br>
<pre><code class="plaintext hljs">php parser_test.php testSelfParsing<font></font>
0.10463285446167<font></font>
0.10712099075317</code></pre><br>
<p>               . ,      <code>self.gdl</code>    <code>self.php</code>,          .</p><br>
<p>            <code>toString()</code>  ,    <code>self.php</code>    .   <code>toString()</code>       <code>RuleName</code>,   ,      .</p><br>
<p>     ,           ,    <code>self.php</code>,     .      .</p><br>
<p>     .     Nowdoc  PHP.</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testComplexString</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $mainRuleName = <span class="hljs-string">'Grammar'</span>;<font></font>
    $gdlParser = <span class="hljs-keyword">new</span> GdlParser(<span class="hljs-keyword">$this</span>-&gt;getSelfGrammar());<font></font>
<font></font>
    $grammarSource = <span class="hljs-string">&lt;&lt;&lt;'SRC'
Data:
    ComplexString*
;

ComplexString:
    '&lt;&lt;&lt;\'' StringTag={str,setStringStart} '\'' '\n' Content={str} '\n' StringTag={str,checkStringEnd} '\n'
;

Content:
    .*&gt;('\n' StringTag={str,checkStringEnd})
;

StringTag:
    [a-zA-Z]+
;
SRC;</span>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($grammarSource));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($gdlParser-&gt;getErrors());<font></font>
<font></font>
    $mainRuleName = $languageGrammar-&gt;get(<span class="hljs-string">'Rule'</span>)-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;getValue();<font></font>
<font></font>
    $languageParser = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span>($<span class="hljs-title">languageGrammar</span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">GdlParser</span> </span>{
        <span class="hljs-keyword">protected</span> $complexStringTag;<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStringStart</span>(<span class="hljs-params">GdlNode &amp;$parsedElement</span>)
        </span>{
            <span class="hljs-keyword">$this</span>-&gt;complexStringTag = $parsedElement-&gt;getValue();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkStringEnd</span>(<span class="hljs-params">GdlNode &amp;$parsedElement</span>)
        </span>{
            <span class="hljs-keyword">if</span> ($parsedElement-&gt;getValue() !== <span class="hljs-keyword">$this</span>-&gt;complexStringTag) {<font></font>
                $parsedElement = <span class="hljs-literal">null</span>;<font></font>
            }<font></font>
        }<font></font>
    };<font></font>
<font></font>
    $source = <span class="hljs-string">&lt;&lt;&lt;'SRC'
&lt;&lt;&lt;'test'
&lt;&lt;&lt;'abc'
a b c
abc</span><font></font>
test<font></font>
<span class="hljs-string">&lt;&lt;&lt;'tag'
1 2 3 4
tag</span><font></font>
<font></font>
SRC;<font></font>
    $tree = $languageParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($source));<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($languageParser-&gt;getErrors());
    <span class="hljs-keyword">$this</span>-&gt;assertTrue($tree-&gt;toArray() === [<span class="hljs-string">'Data'</span>, [<font></font>
        [<span class="hljs-string">'ComplexString'</span>, [<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">'&lt;&lt;&lt;\''</span>],<font></font>
            [<span class="hljs-string">'StringTag'</span>, <span class="hljs-string">'test'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">'\''</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
            [<span class="hljs-string">'Content'</span>, <span class="hljs-string">"&lt;&lt;&lt;'abc'\na b c\nabc"</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
            [<span class="hljs-string">'StringTag'</span>, <span class="hljs-string">'test'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
        ]],<font></font>
        [<span class="hljs-string">'ComplexString'</span>, [<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">'&lt;&lt;&lt;\''</span>],<font></font>
            [<span class="hljs-string">'StringTag'</span>, <span class="hljs-string">'tag'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">'\''</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
            [<span class="hljs-string">'Content'</span>, <span class="hljs-string">"1 2 3 4"</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
            [<span class="hljs-string">'StringTag'</span>, <span class="hljs-string">'tag'</span>],<font></font>
            [<span class="hljs-string">''</span>, <span class="hljs-string">"\n"</span>],<font></font>
        ]],<font></font>
    ]]);<font></font>
}</code></pre><br>
<p>    <code>.*&gt;('\n' StringTag={str,checkStringEnd})</code>.   LookAhead   Element,    Expression,       ,    inline-,    ,  .</p><br>
<p>   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  PHP</a>.</p><br>
<h3 id="realnyy-primer"> </h3><br>
<p>       .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>  PHP.    ,    ,      <code>GdlParser.php</code>  .  ""      AST.</p><br>
<p>   .    ,   <code>self.gdl</code>,   .   -,   <code>parseExpression()</code>,       <code>$this-&gt;stream</code>   .   ,    ,   .      ,   ,          .          ,      ,    <code>count($this-&gt;ruleCallStack)</code>.        ,  <code>parseStatement()</code>   ,          (          ),  .    .      (<code>IfStatement | ReturnStatement | comment</code>),           ,      .</p><br>
<p>    .</p><br>
<pre><code class="plaintext hljs">SingleQuoteString:<font></font>
    '\''={setKeepSpaces} Symbol*&gt;&gt; '\''={clearKeepSpaces}<font></font>
;</code></pre><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">GdlTextParser.php</a>.</p><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testPhp</span>(<span class="hljs-params"></span>)
</span>{<font></font>
    $mainRuleName = <span class="hljs-string">'Grammar'</span>;<font></font>
    $gdlParser = <span class="hljs-keyword">new</span> GdlParser(<span class="hljs-keyword">$this</span>-&gt;getSelfGrammar());<font></font>
<font></font>
    $grammarSource = file_get_contents(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/php.gdl'</span>);<font></font>
    $stream = <span class="hljs-keyword">new</span> Stream($grammarSource);<font></font>
<font></font>
    $t1 = microtime(<span class="hljs-number">1</span>);<font></font>
    $languageGrammar = $gdlParser-&gt;parse($mainRuleName, $stream);<font></font>
    $t2 = microtime(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">echo</span> ($t2 - $t1) . <span class="hljs-string">"\n"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($gdlParser-&gt;getErrors());<font></font>
<font></font>
    $mainRuleName = $languageGrammar-&gt;get(<span class="hljs-string">'Rule'</span>)-&gt;get(<span class="hljs-string">'RuleName'</span>)-&gt;getValue();<font></font>
<font></font>
    $languageParser = <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">class</span>($<span class="hljs-title">languageGrammar</span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">GdlTextParser</span> </span>{
        <span class="hljs-keyword">protected</span> $complexStringTag;<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStringStart</span>(<span class="hljs-params">GdlNode &amp;$parsedElement</span>)
        </span>{
            <span class="hljs-keyword">$this</span>-&gt;complexStringTag = $parsedElement-&gt;getValue();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkStringEnd</span>(<span class="hljs-params">GdlNode &amp;$parsedElement</span>)
        </span>{
            <span class="hljs-keyword">if</span> ($parsedElement-&gt;getValue() !== <span class="hljs-keyword">$this</span>-&gt;complexStringTag) {<font></font>
                $parsedElement = <span class="hljs-literal">null</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleError</span>(<span class="hljs-params">GdlNode $expression</span>)
        </span>{
            <span class="hljs-built_in">parent</span>::handleError($expression);<font></font>
<font></font>
            <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">$this</span>-&gt;stream-&gt;eof()) {<font></font>
                $symbol = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;readSymbol();
                <span class="hljs-keyword">if</span> ($symbol === <span class="hljs-string">"\n"</span>) {
                    <span class="hljs-keyword">break</span>;<font></font>
                }<font></font>
            }<font></font>
<font></font>
            $i = count(<span class="hljs-keyword">$this</span>-&gt;ruleCallStack) - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">$this</span>-&gt;ruleCallStack[$i][<span class="hljs-number">0</span>] == <span class="hljs-string">'()'</span>) { $i--; }<font></font>
            $ruleName = <span class="hljs-keyword">$this</span>-&gt;ruleCallStack[$i][<span class="hljs-number">0</span>];<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ($ruleName === <span class="hljs-string">'FunctionDeclaration'</span> || $ruleName === <span class="hljs-string">'StatementBlock'</span>) {<font></font>
                $level = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">$this</span>-&gt;stream-&gt;eof()) {<font></font>
                    $symbol = <span class="hljs-keyword">$this</span>-&gt;stream-&gt;readSymbol();
                    <span class="hljs-keyword">if</span> ($symbol === <span class="hljs-string">'{'</span>) {<font></font>
                        $level++;<font></font>
                    }<font></font>
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($symbol === <span class="hljs-string">'}'</span>) {<font></font>
                        $level--;<font></font>
                        <span class="hljs-keyword">if</span> ($level == <span class="hljs-number">0</span>) {
                            <span class="hljs-keyword">break</span>;<font></font>
                        }<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    };<font></font>
<font></font>
    $source = file_get_contents(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/GdlParser.php'</span>);<font></font>
<font></font>
    $t1 = microtime(<span class="hljs-number">1</span>);<font></font>
    $tree = $languageParser-&gt;parse($mainRuleName, <span class="hljs-keyword">new</span> Stream($source));<font></font>
    $t2 = microtime(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">echo</span> ($t2 - $t1) . <span class="hljs-string">"\n"</span>;<font></font>
<font></font>
    <span class="hljs-keyword">$this</span>-&gt;assertEmpty($languageParser-&gt;getErrors());
    <span class="hljs-keyword">$this</span>-&gt;assertTrue(!<span class="hljs-keyword">empty</span>($tree));<font></font>
}</code></pre><br>
<p>      <code>handleError()</code>.  ,  ,      ,   <code>handleError()</code>   <code>$this-&gt;stream</code>   ,    <code>';'</code>  '}'   .<br>
           <code>'{'! Statement+ '}'</code>   <code>Statement</code>   .       <code>Statement</code>,     ,    <code>'}'</code>,    <code>Expected '}'</code>.        <code>parseExpression()</code>,      ,       .       null    GdlNode      <code>IncompleteStatement</code>.       null    ,      .</p><br>
<p>  <code>GdlParser.php</code>  ,  <code>handleError()</code>  ,     .</p><br>
<h3 id="proizvoditelnost"></h3><br>
<p> .      .</p><br>
<p>     <code>parse*</code>    .     ,    .       <code>quantifierType</code>.   2   :   ,        —   ,     ,       ,    .</p><br>
<pre><code class="plaintext hljs">php parser_test.php testPhp<font></font>
0.44992613792419<font></font>
1.7462248802185</code></pre><br>
<p>      PHP,     <code>GdlParser.php</code>.<br>
      ,             .</p><br>
<p> 2   ,  ,   PHP.     C++?</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  C++</a></p><br>
<p> C++    ,      PHP.       <code>if</code>   .     <code>make.sh</code>,   ,     -O3.<br>
      production!    new    delete.   ,     .</p><br>
<p> ,       .    <code>GdlParser.php</code>  <code>php.gdl</code>.</p><br>
<p>GdlParser  PHP    1.7 .<br>
GdlParser  C++   -O3  0.022 .<br>
PHP  eval    0.001 .<br>
ANTLR  C++   -O3  0.2 .</p><br>
<p>  , GdlParser  10   ANTLR.</p><br>
<pre><code class="plaintext hljs">./parser <font></font>
PHP grammar parsing OK<font></font>
PHP source parsing OK<font></font>
Duration: 0.022794</code></pre><br>
<p> ANTLR    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Php.g4</a>,   <code>php.gdl</code>.</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  ANTLR  C++  Linux</b>
                        <div class="spoiler_text"><p> "antlr-4.8-complete.jar" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>,  "ANTLR tool and Java Target",  "Complete ANTLR 4.8 Java binaries jar"</p><br>
<p> runtime  demo  ,  "C++ Target",  "antlr4-cpp-runtime-4.8-source.zip (.h, .cpp)"</p><br>
<p>   ,    runtime  demo   "antlr4-cpp-runtime-4.8-source",     </p><br>
<p>  "TLexer.g4"  "TParser.g4"<br>
 "Php.g4"  "GdlParser.php"  "demo/"<br>
 "TLexer"  "TParser"  "PhpLexer"  "PhpParser"  "demo/Linux/main.cpp, demo/generate.sh, demo/CMakeLists.txt",  "TParserBaseListener"  "PhpBaseListener"   3   .</p><br>
<p> main.cpp  :</p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;chrono&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"PhpLexer.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"PhpParser.h"</span></span><font></font>
<font></font>
<span class="hljs-built_in">std</span>::ifstream stream;<font></font>
stream.open(<span class="hljs-string">"../demo/GdlParser.php"</span>);
<span class="hljs-function">ANTLRInputStream <span class="hljs-title">input</span><span class="hljs-params">(stream)</span></span>;<font></font>
<font></font>
<span class="hljs-function">PhpLexer <span class="hljs-title">lexer</span><span class="hljs-params">(&amp;input)</span></span>;
<span class="hljs-function">CommonTokenStream <span class="hljs-title">tokens</span><span class="hljs-params">(&amp;lexer)</span></span>;<font></font>
<font></font>
tokens.fill();<font></font>
<font></font>
<span class="hljs-function">PhpParser <span class="hljs-title">parser</span><span class="hljs-params">(&amp;tokens)</span></span>;
<span class="hljs-keyword">auto</span> t1 = <span class="hljs-built_in">std</span>::chrono::high_resolution_clock::now();<font></font>
tree::ParseTree* tree = parser.program();<font></font>
<span class="hljs-keyword">auto</span> t2 = <span class="hljs-built_in">std</span>::chrono::high_resolution_clock::now();
<span class="hljs-keyword">auto</span> duration = <span class="hljs-built_in">std</span>::chrono::duration_cast&lt;<span class="hljs-built_in">std</span>::chrono::microseconds&gt;(t2 - t1).count();
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Duration: "</span> &lt;&lt; ((<span class="hljs-keyword">double</span>)duration / <span class="hljs-number">1000000</span>) &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;</code></pre><br>
<p>  ,     "Compiling on Linux"   README.md</p><br>
<pre><code class="plaintext hljs">mkdir build &amp;&amp; mkdir run &amp;&amp; cd build<font></font>
cmake .. -DANTLR_JAR_LOCATION=../../antlr-4.8-complete.jar -DWITH_DEMO=True<font></font>
make<font></font>
demo/antlr4-demo</code></pre></div>
                    </div><br>
<p>     :</p><br>
<ul>
<li>        enum      .  <code>name</code>  GdlNode   .</li>
<li>    <code>getArray(name)</code>,   <code>std::vector</code>  .    ,         <code>getArray(name)</code>    <code>listValue</code>   ,    20% .</li>
<li>       .       ( inline)         ,   Symbol,      ,       .       , ,      ,    .         ,    <code>A* B? C</code>.      PHP   ,      .</li>
<li>     ,   .       Stream   .      enum        .</li>
</ul><br>
<p>    GdlParser  ,         .    <code>parseRule(getRule('Program'))</code>  <code>parseProgram()</code>,  <code>parseExpression()</code>       <code>parseRule()</code>   <code>while</code>,  ..</p><br>
<h3 id="obschaya-informaciya"> </h3><br>
<p>  -,   ,       <code>class</code>.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">- </a>   .      <code>a...b...c...</code>,     a, b, c   ,        ,        .    ,      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">c  </a>.</p><br>
<p>        .<br>
  :</p><br>
<pre><code class="plaintext hljs">return [2];</code></pre><br>
<p>  <code>return</code>,    ,        2     <code>return</code>?</p><br>
<pre><code class="plaintext hljs">a[2];<font></font>
return[2];</code></pre><br>
<p>   <code>ReturnStatement</code>       ,       <code>ReturnStatement</code>,       .       ,       .</p><br>
<p>   ,          .   ,  PHP     ,    . <code>@public @static @class Math</code>.   -  -.</p><br>
<p>        .        .   ,       ,       ,    ,  .   ,    <code>'return'</code>,  ,    <code>ID</code>.</p><br>
<p>    —    ,    ,  x  <code>+</code>    <code>?</code>   ,     ,         .     ,     ,    .      ,       0 .</p><br>
<pre><code class="plaintext hljs">// <font></font>
C: D A;<font></font>
A: B*;<font></font>
<font></font>
// <font></font>
C: D A?;<font></font>
A: B+;<font></font>
<font></font>
// <font></font>
Expression: Expression ('+' | '-') Expression;<font></font>
<font></font>
// <font></font>
Expression: MulExpression ('+' | '-') MulExpression;<font></font>
MulExpression: ...</code></pre><br>
<h3 id="rezultat"></h3><br>
<p>  GdlParser  367 ,    ,      .</p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"></a>.</p><br>
<p>   MIT,     ,           .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja506168/index.html">Googleトレンドの優れたガイド：これらすべての統計を読み、トレンドを把握する方法を学ぶ方法</a></li>
<li><a href="../ja506170/index.html">抽象データ型。パート1：データ（データ型）</a></li>
<li><a href="../ja506176/index.html">Creaform 3Dスキャナーの概要</a></li>
<li><a href="../ja506178/index.html">ソフトウェアテストの未来を変えるトレンド：専門家の意見</a></li>
<li><a href="../ja506180/index.html">UPSに適切な電力を選択する方法。イートンの例を分析します</a></li>
<li><a href="../ja506190/index.html">一連の時間間隔を差し引き、ベントレーオットマンアルゴリズムを試す方法</a></li>
<li><a href="../ja506196/index.html">スマートファクトリをハッキングする方法</a></li>
<li><a href="../ja506204/index.html">抽象データ型。パート2：データ管理</a></li>
<li><a href="../ja506206/index.html">ICQ New：ボット育種ガイド</a></li>
<li><a href="../ja506218/index.html">Мегафон продолжает вмешиваться в мой HTTP трафик в 2020 году, отправлять рекламу, даже после получения запретов на это</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>