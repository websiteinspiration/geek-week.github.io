<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïò ‚ûñ üë®üèº‚Äç‚öïÔ∏è Transmita seus v√≠deos no YouTube 24 horas por dia üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üë¥üèæ üñï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, como hobby, estou filmando palestras de um psic√≥logo familiar em v√≠deo. Montei e publico as imagens no meu site. H√° um m√™s, tive a ideia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Transmita seus v√≠deos no YouTube 24 horas por dia</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493352/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recentemente, como hobby, estou filmando palestras de um psic√≥logo familiar em v√≠deo. Montei e publico as imagens no meu site. H√° um m√™s, tive a ideia de organizar uma transmiss√£o ininterrupta dessas palestras no YouTube 24/7. Uma esp√©cie de "canal" tem√°tico dedicado ao crescimento pessoal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como fazer uma transmiss√£o normal, eu sei. Mas como fazer uma transmiss√£o de arquivos de v√≠deo? Que ela andava 24/7, era flex√≠vel, o mais aut√¥noma poss√≠vel e, ao mesmo tempo, n√£o dependia do meu computador dom√©stico. Era isso que eu tinha que descobrir. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/vn/5u/tivn5utlpr-vmldtf9dh5hh7fku.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Demorou v√°rios dias para encontrar uma solu√ß√£o. Estudei muitos f√≥runs e v√°rios manuais sem os quais minha transmiss√£o simplesmente n√£o teria terminado. E agora, quando a brincadeira √© um sucesso, sinto a necessidade de compartilhar minha decis√£o. Ent√£o este artigo apareceu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, a solu√ß√£o final foi a seguinte: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS + ffmeg + bash script</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Abaixo, descrevo os passos dados e falo sobre as "armadilhas" que foram descobertas durante a transmiss√£o.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 1 - de onde ser√° a transmiss√£o?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No in√≠cio, era necess√°rio determinar onde a transmiss√£o ser√° conduzida, onde ser√° sua fonte. A primeira coisa que veio √† mente foi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um computador dom√©stico</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Colete v√≠deos em uma lista de reprodu√ß√£o e reproduza-os em qualquer player de v√≠deo. Em seguida, capture a imagem da tela e transmita-a para o YouTube. Mas quase imediatamente rejeitei esta op√ß√£o. Para implement√°-lo, √© necess√°rio manter o computador dom√©stico constantemente, e esse √© o ru√≠do dos refrigeradores, mesmo √† noite, e o aumento do consumo de energia (+ 100-150 kWh por m√™s). E acontece que voc√™ n√£o poder√° usar o computador dom√©stico durante a transmiss√£o. qualquer movimento do mouse ser√° vis√≠vel na transmiss√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o comecei a olhar para os </font><b><font style="vertical-align: inherit;">servi√ßos</font></b><font style="vertical-align: inherit;"> em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuvem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Eu estava procurando por um servi√ßo pronto para fazer o upload de seus v√≠deos ou, por exemplo, inserir links para v√≠deos do YouTube e tudo seria compactado em uma transmiss√£o cont√≠nua. Mas n√£o encontrei nada adequado. Talvez eu estivesse parecendo mal. A √∫nica coisa ¬± adequada para a funcionalidade √© restream.io, um servi√ßo que ajuda a transmitir simultaneamente em v√°rias plataformas. Eles parecem capazes de enviar seus v√≠deos. Mas esse servi√ßo foi criado para prop√≥sitos completamente diferentes e eles esperam que a transmiss√£o dure apenas algumas horas. Penso que se atrav√©s desse servi√ßo fosse poss√≠vel organizar uma transmiss√£o 24 horas por dia, isso teria disparado em dezenas, ou at√© centenas de d√≥lares por m√™s. Mas eu ainda queria organizar a transmiss√£o gratuitamente ou com um investimento financeiro m√≠nimo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ficou claro que voc√™ precisa transmitir</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um dispositivo separado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou mesmo um computador separado. Pensando em algo como o Raspberri Pi. E o que? Ele n√£o tem mais frio. Gravei o v√≠deo em uma unidade flash USB, prendi um cabo Ethernet e o deixei em algum lugar isolado, transmitindo. Op√ß√£o. Mas como eu n√£o tinha o conselho nem a experi√™ncia com ele, tamb√©m recusei essa op√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, me deparei com uma discuss√£o em que eles discutiram a cria√ß√£o de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seu pr√≥prio servidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transmiss√µes. N√£o era exatamente isso que eu estava procurando, mas peguei a id√©ia principal - voc√™ pode usar o servidor! Nessa discuss√£o, eles sugeriram o uso de v√°rios VPS + nginx + OBS. Tornou-se claro que esse bando poderia me atender. A √∫nica coisa que me confundiu foi que eu nunca administrei o servidor e me pareceu que meu servidor dedicado estava confuso e caro. Decidi descobrir quanto custaria alugar um servidor na configura√ß√£o m√≠nima e fiquei agradavelmente surpreendido.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/v8/ms/muv8msmvpgnhzj9z04nuhv_y0-s.jpeg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os pre√ßos est√£o em rublos bielorrussos e s√£o apenas migalhas. Para entender, 8 rublos bielorrussos est√£o em torno de 3,5 d√≥lares ou 240 rublos russos. Por um m√™s, usando um computador completo, ligado 24 horas por dia, 7 dias por semana e com acesso r√°pido √† Internet. Por alguma raz√£o, essa descoberta foi muito feliz para mim e, por v√°rios dias, andei muito satisfeito como uma crian√ßa que descobriu foguetes espaciais :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, aproveitei a oferta do primeiro site que o Google me deu a pedido de "aluguel VPS". Talvez haja ainda mais solu√ß√µes or√ßament√°rias, mas esse pre√ßo me convinha e eu n√£o procurei mais.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao criar um servidor, voc√™ pode selecionar o sistema operacional no qual ele ir√° operar. </font><font style="vertical-align: inherit;">Em qualquer um dos sistemas listados, voc√™ pode organizar a transmiss√£o e fazer uma escolha com base em suas prefer√™ncias e recursos financeiros (eles solicitam uma taxa adicional por um servidor com Windows). </font><font style="vertical-align: inherit;">Eu escolhi o CentOS. </font><font style="vertical-align: inherit;">S√≥ porque eu costumava ter um pouco de experi√™ncia com ela.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/0a/wh/cv0awhhxim1w2fgglkrlupl5hgc.jpeg" alt="imagem"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 2 - configura√ß√£o do servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa que voc√™ precisa depois de criar o servidor √© conectar-se a ele via SSH. </font><font style="vertical-align: inherit;">Inicialmente, usei o PuTTy, mas comecei a usar o Secure Shell App, que √© executado no Google Chrome. </font><font style="vertical-align: inherit;">Ent√£o acabou sendo mais conveniente para mim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o mudei o nome do host, configurei a sincroniza√ß√£o de hor√°rio no servidor, atualizei o sistema, mexi com iptables ... e fiz v√°rias coisas, mas n√£o porque era necess√°rio. </font><font style="vertical-align: inherit;">Foi interessante configurar o servidor e funcionou para mim. </font><font style="vertical-align: inherit;">Adoro quando acontece :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas essas etapas precisam ser feitas:</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte o reposit√≥rio EPEL.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Levante servidor FTP (eu escolhi vsftp).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale o ffmpeg.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o vou dar detalhes da equipe, esta instru√ß√£o √© bastante conceitual para transmitir um plano de a√ß√£o geral. Se voc√™ tiver alguma dificuldade com alguma das etapas, elas s√£o resolvidas rapidamente por uma consulta em um mecanismo de pesquisa como ‚ÄúCentOS connect EPEL‚Äù ou ‚ÄúCentOS FTP server installation‚Äù. E nos primeiros links, voc√™ encontra instru√ß√µes detalhadas e passo a passo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, como escrevi anteriormente, eu precisava de um monte de VPS + nginx + OBS. Pronto para VPS. Mas aqui nos pontos restantes as quest√µes come√ßaram a surgir. OBS √© um programa de transmiss√£o, Open Broadcaster Software. E s√≥ funciona com threads, ou seja, por exemplo, pega uma imagem de uma webcam e a transmite. Ou grava√ß√£o de tela. Ou uma transmiss√£o j√° em andamento √© redirecionada para outro site. E eu n√£o tenho um fluxo, s√≥ tenho um conjunto de arquivos de v√≠deo que preciso para fazer um fluxo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele come√ßou a cavar nessa dire√ß√£o e se deparou com ffmpeg. </font><font style="vertical-align: inherit;">O FFmpeg √© um conjunto de bibliotecas de c√≥digo aberto gratuitas que permitem gravar, converter e transferir grava√ß√µes digitais de √°udio e v√≠deo em v√°rios formatos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E fiquei muito surpreso com o quanto o ffmpeg pode fazer. </font><font style="vertical-align: inherit;">Se voc√™ quiser, ele retirar√° o som do v√≠deo. </font><font style="vertical-align: inherit;">Se voc√™ quiser, ele cortar√° um fragmento do v√≠deo sem transcodifica√ß√£o. </font><font style="vertical-align: inherit;">Se desejar, ele ser√° convertido de um formato para outro. </font><font style="vertical-align: inherit;">E muito, muito mais. </font><font style="vertical-align: inherit;">At√© o ponto em que voc√™ pode especificar um arquivo para ele, ele o converter√° em um fluxo e o transferir√° para o pr√≥prio YouTube. </font><font style="vertical-align: inherit;">Tudo, a corrente est√° montada. </font><font style="vertical-align: inherit;">Resta apenas refinar as nuances.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 3 - configura√ß√£o da transmiss√£o</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criamos uma transmiss√£o no YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesta fase, precisamos apenas de um link e uma chave de tradu√ß√£o. </font><font style="vertical-align: inherit;">Na captura de tela abaixo, eles s√£o destacados em vermelho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gr/a3/oo/gra3oogooafzdfjzhlqdqjjxr8o.jpeg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carregue os arquivos de v√≠deo no servidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que planejamos transmitir. </font><font style="vertical-align: inherit;">Na verdade, o FTP √© necess√°rio apenas para este est√°gio. </font><font style="vertical-align: inherit;">Se voc√™ tiver outra maneira conveniente de enviar arquivos para o servidor, o servidor FTP poder√° ficar de fora. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s transmitimos para o YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para come√ßar a transmitir, voc√™ deve executar o ffmpeg com v√°rios atributos. </font><font style="vertical-align: inherit;">Aqui est√° o comando mais curto que recebi:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descriptografia de Atributos</font></font></b><div class="spoiler_text"><code>-re</code> ‚Äì ,      .<br>
<br>
<code>-i</code> ‚Äì ,    . ,       ,    -.       ,  <code>/usr/media/lecture1.mp4</code>.<br>
<br>
<code>-f</code> ‚Äì    .    ,  ffmpeg ¬´ ¬ª     mp4  flv.<br>
<br>
    ,     YouTube     .. ,     ,   ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ fez tudo corretamente, depois de executar este comando, o YouTube ver√° o fluxo transmitido. </font><font style="vertical-align: inherit;">Para iniciar a transmiss√£o, basta clicar no bot√£o "Iniciar transmiss√£o" no pr√≥prio YouTube.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 4 - adicione autonomia</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parab√©ns! Agora voc√™ sabe como come√ßar a transmitir a partir de um arquivo de v√≠deo. Mas isso n√£o √© suficiente para transmiss√£o cont√≠nua. √â importante que, ap√≥s a reprodu√ß√£o do primeiro v√≠deo, o pr√≥ximo comece imediatamente e, quando todos os v√≠deos forem mostrados, a reprodu√ß√£o come√ßar√° novamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu vim com a seguinte op√ß√£o: crie um arquivo .sh no qual registrei um comando para cada arquivo de v√≠deo e, no final, indiquei um comando para reiniciar o mesmo script. Aconteceu uma esp√©cie de recurs√£o:</font></font><br>
<br>
<pre><code class="bash hljs"> 1... (   lecture1.mp4)<font></font>
 2... (   lecture2.mp4)<font></font>
 3... (   lecture3.mp4)<font></font>
bash start.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E sim, funcionou. Eu, satisfeito comigo, comecei uma transmiss√£o de teste e fui dormir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma surpresa desagrad√°vel me esperava de manh√£. Aconteceu que a transmiss√£o durou apenas alguns minutos e terminou quase imediatamente quando eu desliguei o computador. A investiga√ß√£o mostrou que os comandos lan√ßados dessa maneira s√£o executados enquanto o usu√°rio est√° autorizado no servidor. Assim que eu desconectei, a execu√ß√£o dos comandos iniciados foi interrompida. Para impedir que isso aconte√ßa, basta </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicionar a equipe </font><font style="vertical-align: inherit;">antes da </font><font style="vertical-align: inherit;">equipe </font></font><code>nohup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso permitir√° que o processo em execu√ß√£o seja executado independentemente da sua presen√ßa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vers√£o m√≠nima final do script √© assim:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture2.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture3.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
nohup bash start.sh $</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Onde start.sh √© o arquivo no qual esse script √© gravado. </font><font style="vertical-align: inherit;">E esse arquivo deve estar localizado no mesmo diret√≥rio que os arquivos de v√≠deo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicionar um cifr√£o no final permite iniciar o processo em segundo plano, para que voc√™ possa continuar usando o console sem interromper a transmiss√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos b√¥nus, os seguintes p√£es resultaram:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode alternar manualmente a reprodu√ß√£o de arquivos. </font><font style="vertical-align: inherit;">Para fazer isso, voc√™ precisa "matar" o processo ffmpeg atualmente em execu√ß√£o. </font><font style="vertical-align: inherit;">Depois disso, a reprodu√ß√£o do pr√≥ximo arquivo da lista ser√° iniciada automaticamente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novos v√≠deos podem ser adicionados √† transmiss√£o sem interromper a transmiss√£o. </font><font style="vertical-align: inherit;">Apenas envie o v√≠deo para o servidor, adicione o comando para executar este arquivo no script, salve-o. </font><font style="vertical-align: inherit;">E √© isso. </font><font style="vertical-align: inherit;">Na pr√≥xima rodada de reprodu√ß√£o, o novo arquivo j√° ser√° transmitido junto com os arquivos antigos.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 5 - configurar o ffmpeg</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre isso, em princ√≠pio, algu√©m poderia parar. Mas eu queria tornar a transmiss√£o um pouco mais amig√°vel para o p√∫blico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que uma pessoa foi √† transmiss√£o, come√ßou a assistir, gostou e quis assistir a essa palestra desde o in√≠cio, e a transmiss√£o n√£o inclui rebobinar. Para visualizar uma palestra desde o in√≠cio, uma pessoa precisar√° ir ao meu site e obter um registro da palestra de seu interesse. E como entender o que a palestra lhe interessa? O site tem 16 palestras e toda semana h√° apenas mais. Penso que nem eu, que gravei e editei todas essas palestras, poderei determinar qual √© a palestra de um fragmento aleat√≥rio. Portanto, √© necess√°rio que cada palestra seja de alguma forma designada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A op√ß√£o de adicionar legendas aos arquivos de v√≠deo de origem no programa de edi√ß√£o n√£o me agradou. </font><font style="vertical-align: inherit;">Era necess√°rio ter certeza de que os arquivos originais foram usados. </font><font style="vertical-align: inherit;">Para apoiar a transmiss√£o exigida de mim o m√≠nimo de movimentos corporais poss√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobriu-se que o ffmpeg tamb√©m pode me ajudar com isso. </font><font style="vertical-align: inherit;">Ele possui um atributo especial </font></font><code>-vf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite colocar texto em cima do v√≠deo. </font><font style="vertical-align: inherit;">Para adicionar texto ao v√≠deo, voc√™ precisa adicionar o seguinte fragmento ao comando:</font></font><br>
<br>
<pre><code class="bash hljs">-vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 13\:  .   ?':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span></code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decodifica√ß√£o de par√¢metros</font></font></b><div class="spoiler_text"><code>fontfile=</code> ‚Äì    .       .          .        .<br>
<br>
<code>text=</code> ‚Äì ,  ,     .<br>
<br>
<code>fontsize=</code> ‚Äì    .<br>
<br>
<code>fontcolor=</code> ‚Äì  .<br>
<br>
<code>borderw=</code> ‚Äì       (         1 ).<br>
<br>
<code>bordercolor=</code> ‚Äì  .<br>
<br>
<code>x=</code>  <code>y=</code> ‚Äì  .  <code>0;0</code>     .      ,           1280720 .<br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se parece com isso:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jf/1n/sh/jf1nshia1hbk30-pjd5y6mztga0.jpeg" alt="imagem"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 6 - determinar a qualidade da transmiss√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo, a transmiss√£o est√° pronta. Transmiss√µes FFmpeg, arquivos reproduzidos, minha presen√ßa n√£o √© necess√°ria para transmiss√£o. At√© todas as palestras s√£o assinadas. Parece que √© isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas outra nuance veio √† tona - eu escolhi a configura√ß√£o m√≠nima do servidor e ela n√£o gerou a transmiss√£o. Configura√ß√£o do servidor: 1 n√∫cleo (como 2,2 GHz), 1 gigabyte de RAM, SSD de 25 GB. Havia RAM suficiente, mas o processador quase completamente carregou 100% (e √†s vezes at√© 102-103% :) Isso levou ao fato de que a transmiss√£o congela uma vez a cada poucos segundos. Feio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ter uma configura√ß√£o mais cara com dois n√∫cleos, o benef√≠cio √© que, com as tecnologias em nuvem, a configura√ß√£o do servidor √© alterada pressionando alguns bot√µes. </font><font style="vertical-align: inherit;">Mas eu queria me encaixar no poder da configura√ß√£o m√≠nima. </font><font style="vertical-align: inherit;">Comecei a estudar a documenta√ß√£o do ffmpeg e, sim, tamb√©m existem configura√ß√µes que permitem ajustar a carga no sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A alta qualidade da imagem pode ser alcan√ßada de duas maneiras: uma alta carga do processador ou um grande tr√°fego de sa√≠da. </font><font style="vertical-align: inherit;">Acontece que quanto mais o processador suportar a carga, menor ser√° a largura de banda que o canal precisar√°. </font><font style="vertical-align: inherit;">Ou voc√™ n√£o pode carregar muito o processador, mas precisar√° de um canal amplo com uma grande margem de tr√°fego. </font><font style="vertical-align: inherit;">Se houver restri√ß√µes no processador e no tamanho do canal / tr√°fego de sa√≠da, ser√° necess√°rio reduzir a qualidade da imagem para que a transmiss√£o ocorra sem problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu servidor possui um canal de 10 Mbps. Esta largura √© reta com uma margem. Mas h√° um limite de tr√°fego - 1 TB por m√™s. Portanto, para atender √†s restri√ß√µes de tr√°fego, meu fluxo de sa√≠da n√£o deve exceder ~ 300 Kb por segundo, ou seja, a taxa de bits do fluxo de sa√≠da n√£o deve exceder 2,5 Mbps. A prop√≥sito, o YouTube recomenda apenas transmitir em uma taxa de bits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Ffmpeg usa abordagens diferentes para regular a carga no sistema. Bem escrito sobre isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Acabei usando dois atributos: </font></font><code>-crf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>-preset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fator de taxa constante (CRF)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- este √© um coeficiente devido ao qual voc√™ pode ajustar a qualidade da imagem. </font><font style="vertical-align: inherit;">O CRF pode variar de 0 a 51, onde 0 √© a qualidade do arquivo de origem, 51 √© a pior qualidade poss√≠vel. </font><font style="vertical-align: inherit;">√â recomend√°vel usar valores de 17 a 28, o padr√£o √© 23. Com uma propor√ß√£o de 17, o v√≠deo ser√° visualmente id√™ntico ao original, mas tecnicamente n√£o ser√°. </font><font style="vertical-align: inherit;">A documenta√ß√£o tamb√©m afirma que o tamanho do v√≠deo final, dependendo do CRF especificado, muda exponencialmente, ou seja, </font><font style="vertical-align: inherit;">aumentar o coeficiente em 6 pontos dobrar√° a taxa de bits do v√≠deo enviado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ estiver usando o CRF, poder√° escolher o "peso" da imagem enviada e, em seguida, usar as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">predefini√ß√µes (-preset)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para determinar quanto ser√° carregado o processador. </font><font style="vertical-align: inherit;">Os par√¢metros para este atributo t√™m o seguinte:</font></font><br>
<br>
<ul>
<li><code>ultrafast</code></li>
<li><code>superfast</code></li>
<li><code>veryfast</code></li>
<li><code>faster</code></li>
<li><code>fast</code></li>
<li><code>medium</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - valor padr√£o</font></font></li>
<li><code>slow</code></li>
<li><code>slower</code></li>
<li><code>veryslow</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais r√°pido o par√¢metro for especificado, maior ser√° a carga no processador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peguei primeiro a predefini√ß√£o, que era basicamente "dif√≠cil" para o meu processador, e depois ajustei a carga com mais precis√£o usando CRF. </font><font style="vertical-align: inherit;">No meu caso, a predefini√ß√£o surgiu </font></font><code>fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, para o crf, decidi pelo valor de 24.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo. </font><font style="vertical-align: inherit;">O comando final para iniciar a transmiss√£o, recebi o seguinte:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 1\:   ':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span> -c:v libx264 -preset fast -crf 24 -g 3 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui existem apenas dois momentos n√£o descritos: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><code>-c:v libx264</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- uma indica√ß√£o de um codec espec√≠fico para trabalhar com o arquivo de origem. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) </font></font><code>-g 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- uma indica√ß√£o expl√≠cita do n√∫mero de quadros-chave. Nesse caso, √© indicado que cada terceiro quadro deve ser a chave. O valor padr√£o √© 5 ou 8, mas o YouTube jura, pergunta pelo menos 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que qualidade da transmiss√£o acabou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A carga do servidor foi a seguinte:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/b5/3s/za/b53szauaywx3bdwoic-yebil1es.jpeg" alt="imagem"><br>
<br>
<img src="https://habrastorage.org/webt/cq/jc/t4/cqjct4xhbz3zabriimgydbxvjaq.jpeg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Com base nos dados de monitoramento, √© claro que a carga do processador varia de 70% a 95% e a transmiss√£o nunca parou em 100% em uma semana. Portanto, com essas configura√ß√µes, o processador √© suficiente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao carregar um disco, posso dizer que ele quase n√£o est√° carregado e um HDD comum deve ser suficiente para transmitir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas a quantidade de tr√°fego de sa√≠da me incomoda. Acontece que meu fluxo de sa√≠da varia de 450 a 650 KB por segundo. Durante um m√™s, ser√£o cerca de 1,8 terabytes. Pode ser necess√°rio comprar tr√°fego ou ainda mudar para uma configura√ß√£o de n√∫cleo duplo porque Eu n√£o gostaria de reduzir a qualidade da imagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, direi que a configura√ß√£o dessa transmiss√£o do zero leva cerca de uma a duas horas. Al√©m disso, na maioria das vezes √© necess√°rio o upload do v√≠deo para o servidor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ferramenta de marketing, o lan√ßamento de uma transmiss√£o desse tipo n√£o deu resultado. Talvez se voc√™ encerrar as visualiza√ß√µes para que os algoritmos do YouTube capturem essa transmiss√£o e a mostrem ativamente nas recomenda√ß√µes, algo funcione. No meu caso, durante 16 dias de transmiss√£o cont√≠nua, foi assistida 58 vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° bem. A transmiss√£o se encaixa harmoniosamente na p√°gina principal do meu site. Foi um tipo de oportunidade para se decidir rapidamente sobre o palestrante e as pr√≥prias palestras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E um momento. √â importante que a transmiss√£o n√£o viole os direitos autorais de outras pessoas, caso contr√°rio, ser√° bloqueada. Estou calmo para a minha transmiss√£o. Selecionei especialmente inser√ß√µes musicais com uso gratuito, e o autor do conte√∫do fica em um computador vizinho e n√£o √© contra mim usar seu conte√∫do :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas se voc√™ tem um r√°dio tocando em segundo plano em algum lugar no fundo, ou voc√™ usou sua faixa favorita durante a edi√ß√£o ou gravou um v√≠deo de um videoclipe, s√©rie ou filme popular, sua transmiss√£o est√° em risco. </font><font style="vertical-align: inherit;">Tamb√©m √© importante que a transmiss√£o carregue pelo menos uma carga sem√¢ntica m√≠nima, caso contr√°rio, poder√° ser bloqueada como spam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo para mim. </font><font style="vertical-align: inherit;">Espero que este manual sirva bem a algu√©m. </font><font style="vertical-align: inherit;">Bem, se voc√™ tem algo a acrescentar - escreva, terei prazer em ler adi√ß√µes e esclarecimentos ao artigo.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493336/index.html">Como o Centro de Ci√™ncia da Computa√ß√£o traduziu o aprendizado on-line</a></li>
<li><a href="../pt493340/index.html">Tornando as fun√ß√µes SIL port√°teis entre vers√µes no Jira</a></li>
<li><a href="../pt493342/index.html">Como o NSPK preparou a infraestrutura para a transi√ß√£o para udalenka</a></li>
<li><a href="../pt493346/index.html">Conseguimos transferir escrit√≥rios para udalenka, e voc√™?</a></li>
<li><a href="../pt493348/index.html">Torne o "udalenka" √≥timo novamente: como transferir toda a empresa para o trabalho remoto em 4 etapas</a></li>
<li><a href="../pt493356/index.html">V√≠deo @ Meetups de Bancos de dados: DBMS Security, Tarantool na IoT, Greenplum para Big Data Analytics</a></li>
<li><a href="../pt493360/index.html">Dois dedos de Algol</a></li>
<li><a href="../pt493362/index.html">Suporte t√©cnico "nas malas". Como trabalhamos remotamente, sem nervos desnecess√°rios, e obtemos os servi√ßos de que precisamos remotamente</a></li>
<li><a href="../pt493366/index.html">O que √© o Windows PowerShell e o que ele come? Parte 3: passando par√¢metros para scripts e fun√ß√µes, criando cmdlets</a></li>
<li><a href="../pt493374/index.html">Coronav√≠rus - dicas pr√°ticas e um pouco de teoria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>