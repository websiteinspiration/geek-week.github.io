<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèΩ üë™ üíï √Ä propos des fuites GDI et de l'importance de la chance üöü ü§ò ‚ùï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En mai 2019, on m'a demand√© de jeter un ≈ìil √† un bogue Chrome potentiellement dangereux. Au d√©but, je l'ai diagnostiqu√© comme sans importance, perdant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>√Ä propos des fuites GDI et de l'importance de la chance</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501506/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e75/586/6da/e755866da35a13300e4fde55ebfd100b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mai 2019, on m'a demand√© de jeter un ≈ìil √† un bogue Chrome potentiellement dangereux. Au d√©but, je l'ai diagnostiqu√© comme sans importance, perdant ainsi deux semaines. Plus tard, lorsque je suis retourn√© √† l'enqu√™te, cela est devenu la premi√®re cause de blocage du processus du navigateur dans le canal b√™ta de Chrome. Oops </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le 6 juin, le jour m√™me o√π j'ai r√©alis√© mon erreur d'interpr√©tation des donn√©es de d√©parts, le bug a √©t√© marqu√© comme ReleaseBlock-Stable. Cela signifie que nous ne pourrons pas publier une nouvelle version de Chrome pour la plupart des utilisateurs tant que nous n'aurons pas compris ce qui se passe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le crash se produit car nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manquions d'objets GDI (Graphics Device Interface)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais nous ne savions pas de quel type d'objets GDI il s'agissait, les donn√©es de diagnostic ne donnaient aucun indice sur l'emplacement du probl√®me et nous n'avons pas pu le recr√©er.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de gens de notre √©quipe ont travaill√© dur sur ce bug du 6 au 7 juin, ils ont test√© leurs th√©ories, mais n'ont pas avanc√©. Le 8 juin, j'ai d√©cid√© de v√©rifier mon courrier et Chrome s'est imm√©diatement √©cras√©. Ce fut </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le m√™me √©chec</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle ironie. Alors que je cherchais des modifications et que j'examinais les rapports de plantage, essayant de comprendre ce qui pouvait provoquer une fuite des objets GDI dans le navigateur Chrome, le nombre d'objets GDI dans mon navigateur augmentait sans rel√¢che, et au matin du 8 juin, il d√©passait le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre magique de 10000</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √Ä ce stade, l'une des op√©rations d'allocation de m√©moire pour l'objet GDI a √©chou√© et nous avons intentionnellement plant√© le navigateur. Ce fut une chance incroyable.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous pouvez reproduire le bogue, vous pouvez in√©vitablement le corriger. </font><font style="vertical-align: inherit;">Je devais juste comprendre comment j'ai caus√© ce bogue, apr√®s quoi nous pouvons l'√©liminer.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour commencer, un bref historique du probl√®me</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a10/aba/273/a10aba273e79a9fc534a6d436c21f8de.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des endroits du code Chromium, lorsque nous essayons d'allouer de la m√©moire √† un objet GDI, nous v√©rifions d'abord si cette allocation a r√©ussi. S'il n'√©tait pas possible d'allouer de la m√©moire, nous √©crivons des informations sur la pile et effectuons intentionnellement un plantage, comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on peut le voir dans ce code source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'√©chec est provoqu√© intentionnellement, car si nous ne pouvons pas allouer de m√©moire pour les objets GDI, nous ne pourrons pas restituer √† l'√©cran - il est pr√©f√©rable de signaler un probl√®me (si les rapports de plantage sont activ√©s) et de red√©marrer le processus plut√¥t que d'afficher une interface utilisateur vide. Par d√©faut, vous pouvez cr√©er jusqu'√† 10 000 objets GDI par processus, et g√©n√©ralement quelques centaines seulement sont utilis√©s. Par cons√©quent, si nous avons d√©pass√© cette limite, quelque chose s'est compl√®tement pass√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous obtenons l'un des rapports d'erreur indiquant l'erreur d'allocation de m√©moire pour l'objet GDI, nous avons une pile d'appels et toutes sortes d'autres informations utiles. </font><font style="vertical-align: inherit;">Bien! </font><font style="vertical-align: inherit;">Mais le probl√®me est que ces vidages sur incident ne sont pas n√©cessairement li√©s au bogue. </font><font style="vertical-align: inherit;">Cela est d√ª au fait que le code qui provoque la fuite d'objets GDI et le code qui signale l'√©chec peuvent ne pas √™tre le m√™me code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, nous avons deux types de code:</font></font><br>
<br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void GoodCode () {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   auto x = AllocateGDIObject ();</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   si (! x)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     CollectGDIUsageAndDie ();</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   UseGDIObject (x);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   FreeGDIObject (x);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
void BadCode () {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   auto x = AllocateGDIObject ();</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   UseGDIObject (x);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le bon code remarque que l'allocation de m√©moire a √©chou√©, et le signale, et le mauvais code ignore les plantages et renverse des objets, ¬´substituant¬ª ainsi le bon code pour qu'il prenne ses responsabilit√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le chrome contient plusieurs millions de lignes de code. Nous ne savions pas quelle fonction avait une erreur et nous ne savions m√™me pas quel </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type d'</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objets GDI </font><font style="vertical-align: inherit;">fuyait. Un de mes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coll√®gues a ajout√© du code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui contournait le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloc d'environnement de processus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avant le crash </font><font style="vertical-align: inherit;">pour obtenir le nombre d'objets GDI de chaque type, mais pour tous les types √©num√©r√©s (contextes de p√©riph√©rique, zones, bitmaps, palettes, pinceaux, plumes et inconnus), le nombre ne d√©passait pas cent. C'est √©trange.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que les objets pour lesquels nous allouons directement de la m√©moire se trouvent dans ce tableau, mais il n'y a aucun objet cr√©√© par le noyau en notre nom, et ils existent quelque part dans le gestionnaire d'objets Windows. </font><font style="vertical-align: inherit;">Cela signifie que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDIView est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tout aussi aveugle √† ce probl√®me que nous le sommes (en outre, GDIView n'est utile que lors de la lecture d'un √©chec localement). </font><font style="vertical-align: inherit;">Parce que nous avons des fuites de curseurs, et les curseurs sont des objets USER32 avec des objets GDI attach√©s √† eux; </font><font style="vertical-align: inherit;">la m√©moire de ces objets GDI est allou√©e par le noyau, et nous n'avons pas pu voir ce qui se passait.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interpr√©tation erron√©e</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre fonction </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CollectGDIUsageAndDie a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> un nom tr√®s vif, et je pense que vous serez d'accord avec moi sur ce point. Tr√®s expressif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me est qu'il effectue trop d'actions. CollectGDIUsageAndDie a v√©rifi√© environ une douzaine de diff√©rents types d'√©checs d'allocation de m√©moire pour les objets GDI, et en raison de l'int√©gration du code, ils ont re√ßu la m√™me signature d'√©chec en cons√©quence - ils se sont tous √©cras√©s dans les fonctions principales et ont fusionn√©. Par cons√©quent, l'un de mes coll√®gues a judicieusement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apport√© un changement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en r√©partissant diff√©rents contr√¥les en fonctions distinctes (non int√©gr√©es). Gr√¢ce √† cela, maintenant, √† premi√®re vue, nous pouvions comprendre quel contr√¥le s'√©tait sold√© par un √©chec. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√©las, cela a conduit au fait que lorsque nous avons commenc√© √† obtenir des rapports d' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">erreur</font></a><font style="vertical-align: inherit;"> de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrashIfExcessiveHandles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, J'ai dit avec confiance: "ce n'est pas la cause de l'√©chec, c'est simplement caus√© par un changement de signature". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais je me trompais. </font><font style="vertical-align: inherit;">Ce fut la cause de l'√©chec </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du changement de signature. </font><font style="vertical-align: inherit;">Oops </font><font style="vertical-align: inherit;">Analyse maladroite, Dawson. </font><font style="vertical-align: inherit;">Pas de cookies pour vous.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retour √† notre histoire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, je savais d√©j√† que quelque chose que j'ai fait le 7 juin utilisait pr√®s de 10 000 objets GDI par jour. </font><font style="vertical-align: inherit;">Si je pouvais comprendre cela, je r√©soudrais l'√©nigme.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c0/b8e/9ee/0c0b8e9ee9f5afdfff26391eb2e360f8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le Gestionnaire des t√¢ches de Windows poss√®de une colonne d' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objets GDI</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suppl√©mentaire </font><font style="vertical-align: inherit;">que vous pouvez utiliser pour rechercher des fuites. Le 7 juin, je travaillais de chez moi, me connectant √† ma machine de travail, et cette colonne a √©t√© activ√©e sur la machine de travail parce que j'ai effectu√© des tests et essay√© de reproduire le sc√©nario de plantage. Mais en attendant, </font><font style="vertical-align: inherit;">il y a eu des fuites d'objets GDI </font><font style="vertical-align: inherit;">dans le navigateur de ma </font><font style="vertical-align: inherit;">machine </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domestique</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La principale t√¢che pour laquelle j'ai utilis√© le navigateur √† la maison est de se connecter √† une machine en √©tat de marche √† l'aide de l'application </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome Remote Desktop (CRD)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . J'ai donc activ√© la colonne des objets GDI sur la machine domestique et j'ai commenc√© √† exp√©rimenter. Bient√¥t, j'ai obtenu les r√©sultats.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, la chronologie du bogue montre qu'√† partir du moment o√π ¬´j'ai eu un √©chec¬ª (14h00) √† ¬´il est en quelque sorte connect√© avec CRD¬ª, et ensuite il n'a fallu que 35 minutes pour ¬´g√©rer les curseurs¬ª. J'ai d√©j√† dit √† quel point il est plus facile d'enqu√™ter sur les bogues lorsque vous pouvez les jouer localement? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est av√©r√© que chaque fois qu'une application CRD (ou toute application Chrome?) Changeait de curseur, cela entra√Ænait la fuite de six objets GDI. Si vous d√©placez la souris sur la partie souhait√©e de l'√©cran lorsque vous travaillez avec Chrome Remote Desktop, des centaines d'objets GDI par minute et des milliers par heure peuvent fuir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s un mois d'absence de tout progr√®s dans la r√©solution de ce probl√®me, il est soudainement pass√© d'un √©tat inamovible √† une simple correction. J'ai rapidement √©crit un projet de correctif, puis un de mes coll√®gues (je n'ai pas travaill√© sur ce bogue) a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©√© un v√©ritable correctif</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a √©t√© t√©l√©charg√© le 10 juin √† 11:16 et a √©t√© publi√© √† 13:00. </font><font style="vertical-align: inherit;">Apr√®s quelques fusions, le bug a disparu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est tout?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons corrig√© le bogue, et c'est g√©nial, mais il est beaucoup plus important que de tels bogues ne se reproduisent plus. </font><font style="vertical-align: inherit;">√âvidemment, il est correct d'utiliser des objets C ++ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAII</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">pour la gestion des ressources </font><font style="vertical-align: inherit;">, mais dans ce cas, le bogue √©tait contenu dans la classe WebCursor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce qui concerne les fuites de m√©moire, il existe un ensemble fiable de syst√®mes. </font><font style="vertical-align: inherit;">Microsoft a des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instantan√©s de tas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Chromium a un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">profilage de tas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les versions utilisateur et un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©liminateur de fuites</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur des machines d'essai. </font><font style="vertical-align: inherit;">Mais il semble que les fuites d'objets GDI aient √©t√© priv√©es d'attention. </font><font style="vertical-align: inherit;">Le bloc d'informations sur le processus contient des informations incompl√®tes, certains objets GDI peuvent √™tre r√©pertori√©s uniquement en mode noyau, et il n'y a pas de point unique pour allouer et lib√©rer de la m√©moire pour les objets qui peuvent faciliter le tra√ßage. </font><font style="vertical-align: inherit;">Ce n'√©tait pas la premi√®re fuite d'objets GDI avec laquelle j'ai d√ª faire face, et ce ne sera pas la derni√®re, car il n'existe aucun moyen fiable de les suivre. </font><font style="vertical-align: inherit;">Voici mes recommandations pour les versions Windows suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre le processus d'obtention du nombre de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tous les</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> types d'objets GDI trivial, sans avoir √† lire obscurement PEB (et sans ignorer les curseurs)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez un moyen pris en charge pour intercepter et tracer </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toutes les</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> op√©rations de cr√©ation et de destruction d'objets GDI pour un suivi fiable; </font><font style="vertical-align: inherit;">y compris pour ceux qui ont √©t√© cr√©√©s indirectement</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refl√©ter tout cela dans la documentation</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Un tel suivi n'est m√™me pas difficile √† mettre en ≈ìuvre, car les objets GDI sont n√©cessairement limit√©s de mani√®re √† ce que la m√©moire ne soit pas limit√©e. </font><font style="vertical-align: inherit;">Ce serait formidable si l'utilisation de ces objets GDI √©tranges mais in√©vitables √©tait plus s√ªre. </font><font style="vertical-align: inherit;">Oh s'il te plait. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez lire la discussion sur Reddit. </font><font style="vertical-align: inherit;">Le sujet sur Twitter commence </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501494/index.html">Pas un gramme pour l'√¢me: l'histoire de l'√©chec de la crypto-monnaie Durov</a></li>
<li><a href="../fr501496/index.html">Lac Comet, ach√®vement de l'it√©ration</a></li>
<li><a href="../fr501498/index.html">Quelle quantit√© de code C ++ doit √™tre √©crite pour analyser l'en-t√™te HTTP d'autorisation √† l'aide d'easy_parser de RESTinio?</a></li>
<li><a href="../fr501500/index.html">Piratage visuel: ce qui menace et comment se prot√©ger de l'espionnage</a></li>
<li><a href="../fr501502/index.html">Le nouveau laboratoire de synth√®se num√©rique poursuit Harris Book et aide √† cr√©er un jeu vid√©o FPGA</a></li>
<li><a href="../fr501508/index.html">Merde vieux CRM</a></li>
<li><a href="../fr501510/index.html">Un nouveau regard sur le d√©veloppement Fullstack avec le framework Ruby on Rails</a></li>
<li><a href="../fr501516/index.html">Coupons le vide?! Alexey Lesovsky</a></li>
<li><a href="../fr501520/index.html">C # 8 et validit√© nulle. Comment vivons-nous avec cela</a></li>
<li><a href="../fr501522/index.html">Webinaires Skillbox gratuits: jeux d'√©criture en PHP, Unity et Unreal Engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>