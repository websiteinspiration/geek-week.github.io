<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üë®üèª‚Äçüöí üï¶ Broadcast your videos on YouTube around the clock üëãüèø ‚õ©Ô∏è ‚òëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, as a hobby, I‚Äôm filming lectures of a familiar psychologist on video. I mount and publish the footage on my website. A month ago, I got the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Broadcast your videos on YouTube around the clock</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493352/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recently, as a hobby, I‚Äôm filming lectures of a familiar psychologist on video. I mount and publish the footage on my website. A month ago, I got the idea to organize a round-the-clock broadcast of these lectures on YouTube 24/7. A sort of thematic ‚Äúchannel‚Äù dedicated to personal growth. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to make a normal broadcast, I know. But how to make it a broadcast of video files? That she walked 24/7, was flexible, as autonomous as possible, and at the same time did not depend on my home computer. This was what I had to find out. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/vn/5u/tivn5utlpr-vmldtf9dh5hh7fku.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It took several days to find a solution. I studied a lot of forums and various manuals without which my broadcast would simply not have turned out. And now, when the prank is a success, I feel the need to share my decision. So this article appeared.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In short, the final solution was as follows: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS + ffmeg + bash script</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Under the cut, I describe the steps taken and talk about the "pitfalls" that were discovered during the broadcast.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 1 - where will the broadcast go from?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the very beginning, it was necessary to determine where the broadcast will be conducted, where its source will be. The very first thing that came to mind was </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from a home computer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Collect videos into a playlist and play them in any video player. Then capture the screen image and broadcast it to YouTube. But I almost immediately dismissed this option. to implement it, you need to keep your home computer constantly on, and this is the noise from the coolers even at night and increased energy consumption (+ 100-150 kWh every month). And it turns out that you will not be able to use your home computer for the duration of the broadcast. any movement of the mouse will be visible in the broadcast. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I began to look towards </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud services</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. I was looking for a ready-made service where you could upload your videos or, for example, insert links to videos from YouTube and it would all be packed into one non-stop broadcast. But I did not find anything suitable. Perhaps I was looking badly. The only thing ¬± suitable for the functionality is restream.io, a service that helps broadcast simultaneously on multiple platforms. They seem to be able to upload their videos. But this service was created for completely different purposes and they expect that the broadcast will last only a couple of hours. I think that if through this service it would have been possible to organize a round-the-clock broadcast, then this would have shot at tens, or even hundreds of dollars a month. But I still wanted to organize the broadcast either for free or with minimal financial investment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It became clear that you need to broadcast</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a separate device</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or even a separate computer. Thinking toward something like the Raspberri Pi. And what? He has no cooler. I recorded the video on a USB flash drive, stuck an Ethernet cable and let it lie somewhere in a secluded place, it‚Äôs broadcasting. Option. But I had neither the board itself nor the experience with it, so I also refused this option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, I came across a discussion where they discussed creating </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your own server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">broadcasts. This was not exactly what I was looking for, but I caught the main idea - you can use the server! In that discussion, they suggested using a bunch of VPS + nginx + OBS. It became clear that this bunch could suit me. The only thing that confused me was that I never administered the server and it seemed to me that my dedicated server was confused and expensive. I decided to find out how much it would cost to rent a server in the minimum configuration and was pleasantly surprised.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/v8/ms/muv8msmvpgnhzj9z04nuhv_y0-s.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prices are in Belarusian rubles and they are just crumbs. For understanding, 8 Belarusian rubles is somewhere around 3.5 dollars or 240 Russian rubles. For a month using a full-fledged computer that is turned on 24/7 and has fast Internet access. For some reason, this discovery was very joyful for me, and for several days I walked terribly pleased like a child who discovered space rockets :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, I took advantage of the offer of the very first site that Google gave me on request ‚ÄúVPS rental‚Äù. Perhaps there are even more budget solutions, but this price suited me and I did not look further.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When creating a server, you can select the operating system under which it will operate. </font><font style="vertical-align: inherit;">On any of the listed systems, you can organize the broadcast and make a choice based on your preferences and financial capabilities (they ask for an additional fee for a server with Windows). </font><font style="vertical-align: inherit;">I chose CentOS. </font><font style="vertical-align: inherit;">Just because I used to have a little experience with her.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/0a/wh/cv0awhhxim1w2fgglkrlupl5hgc.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 2 - server setup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing you need after creating the server is to connect to it via SSH. </font><font style="vertical-align: inherit;">At first I used PuTTy, but then I started using the Secure Shell App, which runs on Google Chrome. </font><font style="vertical-align: inherit;">So it turned out to be more convenient for me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I changed the host name, set up time synchronization on the server, updated the system, messed around with iptables ... and did a bunch of things, but not because it was necessary. </font><font style="vertical-align: inherit;">It was just interesting for me to set up the server and it worked for me. </font><font style="vertical-align: inherit;">I love when it turns out :) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But those steps that need to be done:</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connect the EPEL repository.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raise FTP server (I chose vsftp).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install ffmpeg.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not give details of the team, this instruction is rather conceptual in order to convey a general plan of action. If you have any difficulties with any of the steps, they are quickly resolved by a query in a search engine like ‚ÄúCentOS connect EPEL‚Äù or ‚ÄúCentOS FTP server installation‚Äù. And at the first links you can find detailed step-by-step instructions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, as I wrote earlier, I needed a bunch of VPS + nginx + OBS. VPS - ready. But here on the remaining points questions began to arise. OBS is a broadcast program, Open Broadcaster Software. And it only works with threads i.e. for example, it takes an image from a webcam and broadcasts it. Or screen recording. Or an already ongoing broadcast redirects to another site. And I do not have a stream, I only have a set of video files that I need to make a stream.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He began to dig in this direction and came across ffmpeg. </font><font style="vertical-align: inherit;">FFmpeg is a set of free open source libraries that allow you to record, convert and transfer digital audio and video recordings in various formats. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And I was very surprised how much ffmpeg can do. </font><font style="vertical-align: inherit;">If you want, it will pull the sound out of the video. </font><font style="vertical-align: inherit;">If you want, it will cut out a fragment of the video without transcoding. </font><font style="vertical-align: inherit;">If you want, it will convert from one format to another. </font><font style="vertical-align: inherit;">And much, much more. </font><font style="vertical-align: inherit;">Up to the point that you can specify a file for him, he will convert it to a stream and transfer it to YouTube himself. </font><font style="vertical-align: inherit;">Everything, the chain is assembled. </font><font style="vertical-align: inherit;">It remains only to refine the nuances.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 3 - broadcast setup</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We create a broadcast on YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this stage, we only need a link and a translation key. </font><font style="vertical-align: inherit;">In the screenshot below, they are highlighted in red. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gr/a3/oo/gra3oogooafzdfjzhlqdqjjxr8o.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upload the video files to the server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that we plan to broadcast. </font><font style="vertical-align: inherit;">Actually, FTP is only needed for this stage. </font><font style="vertical-align: inherit;">If you have another convenient way to upload files to the server, then the FTP server can be left out. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We stream to YouTube. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To start broadcasting, you must run ffmpeg with several attributes. </font><font style="vertical-align: inherit;">Here is the shortest command that I got:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attribute Decryption</font></font></b><div class="spoiler_text"><code>-re</code> ‚Äì ,      .<br>
<br>
<code>-i</code> ‚Äì ,    . ,       ,    -.       ,  <code>/usr/media/lecture1.mp4</code>.<br>
<br>
<code>-f</code> ‚Äì    .    ,  ffmpeg ¬´ ¬ª     mp4  flv.<br>
<br>
    ,     YouTube     .. ,     ,   ,       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you did everything correctly, then after running this command, YouTube will see the transmitted stream. </font><font style="vertical-align: inherit;">To start the broadcast, you just have to click the ‚ÄúStart Broadcast‚Äù button in YouTube itself.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 4 - add autonomy</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Congratulations! Now you know how to start broadcasting from a video file. But this is not enough for round-the-clock broadcasting. It is important that after the first video has finished playing, the next one will start immediately, and when all the videos are shown, playback starts all over again. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I came up with the following option: create a .sh file in which I registered a command for each video file and at the very end indicated a command to restart the same script. It turned out a kind of recursion:</font></font><br>
<br>
<pre><code class="bash hljs"> 1... (   lecture1.mp4)<font></font>
 2... (   lecture2.mp4)<font></font>
 3... (   lecture3.mp4)<font></font>
bash start.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And yes, it worked. I, pleased with myself, started a test broadcast and went to sleep. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An unpleasant surprise awaited me in the morning. It turned out that the broadcast went on just a couple of minutes and ended almost immediately as I turned off my computer. The investigation showed that the commands launched in this way are executed while the user is authorized on the server. As soon as I disconnected, the execution of the commands I started was interrupted. To prevent this from happening, it‚Äôs enough to </font></font><code>bash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add the team </font><font style="vertical-align: inherit;">before the </font><font style="vertical-align: inherit;">team </font></font><code>nohup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This will allow the running process to run regardless of your presence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The final minimum version of the script looks like this:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture2.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
ffmpeg -re -i lecture3.mp4 -f flv rtmp://a.rtmp.youtube.com/live2/%_%<font></font>
nohup bash start.sh $</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Where start.sh is the file in which this script is written. </font><font style="vertical-align: inherit;">And this file should be located in the same directory as the video files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adding a dollar sign at the end allows you to start the process in the background so that you can continue to use the console without interrupting broadcasting. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From bonuses the following buns turned out:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can manually switch the playback of files. </font><font style="vertical-align: inherit;">To do this, you need to "kill" the currently running ffmpeg process. </font><font style="vertical-align: inherit;">After that, playback of the next file from the list will automatically start.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New videos can be added to the broadcast without stopping the broadcast. </font><font style="vertical-align: inherit;">Just upload the video to the server, add the command to run this file in the script, save it. </font><font style="vertical-align: inherit;">And that‚Äôs it. </font><font style="vertical-align: inherit;">In the next round of playback, the new file will already be broadcast along with the old files.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 5 - configure ffmpeg</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this, in principle, one could stop. But I wanted to make the broadcast a little more friendly for the audience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose a person went to the broadcast, started watching, he liked it and wanted to watch this lecture from the beginning, and the broadcast does not include rewinding. To view a lecture from the beginning, a person will need to go to my website and get a record of the lecture of interest. And how to understand what lecture interests him? The site has 16 lectures and every week there are only more. I think that even I, who shot and edited all these lectures, will not be able to determine which lecture it is from a random fragment. Therefore, it is necessary that each lecture be somehow designated.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The option to add captions to the source video files in the editing program did not suit me. </font><font style="vertical-align: inherit;">It was necessary to make sure that the original files were used. </font><font style="vertical-align: inherit;">To support broadcast required from me as little body movements as possible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turned out that ffmpeg can help me with this as well. </font><font style="vertical-align: inherit;">It has a special attribute </font></font><code>-vf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that allows you to put text on top of the video. </font><font style="vertical-align: inherit;">To add text to the video, you need to add the following fragment to the command:</font></font><br>
<br>
<pre><code class="bash hljs">-vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 13\:  .   ?':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span></code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decoding of parameters</font></font></b><div class="spoiler_text"><code>fontfile=</code> ‚Äì    .       .          .        .<br>
<br>
<code>text=</code> ‚Äì ,  ,     .<br>
<br>
<code>fontsize=</code> ‚Äì    .<br>
<br>
<code>fontcolor=</code> ‚Äì  .<br>
<br>
<code>borderw=</code> ‚Äì       (         1 ).<br>
<br>
<code>bordercolor=</code> ‚Äì  .<br>
<br>
<code>x=</code>  <code>y=</code> ‚Äì  .  <code>0;0</code>     .      ,           1280720 .<br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It looks like this:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/jf/1n/sh/jf1nshia1hbk30-pjd5y6mztga0.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 6 - determine the broadcast quality</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything, the broadcast is ready. FFmpeg broadcasts, files play, my presence is not needed for broadcast. Even every lecture is signed. Look like that's it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But another nuance surfaced - I chose the minimum server configuration and it did not pull the broadcast. Server configuration: 1 core (like 2.2 GHz), 1 gigabyte of RAM, 25 GB SSD. There was enough RAM, but the processor almost completely went into loading 100% (and sometimes even at 102-103% :) This led to the fact that the broadcast freezes once every few seconds. Ugly.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You could just take a more expensive configuration with two cores, the benefit is that with cloud technologies, the server configuration is changed by pressing a couple of buttons. </font><font style="vertical-align: inherit;">But I wanted to fit in the power of the minimum configuration. </font><font style="vertical-align: inherit;">I began to study the ffmpeg documentation and yes, there are also settings there that allow you to adjust the load on the system.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
High image quality can be achieved in two ways: either a high processor load, or a large outgoing traffic. </font><font style="vertical-align: inherit;">It turns out that the more the processor can take on the load, the less bandwidth the channel will need. </font><font style="vertical-align: inherit;">Or you can not heavily load the processor, but then you will need a wide channel with a large margin of traffic. </font><font style="vertical-align: inherit;">If there are restrictions both on the processor and on the size of the outgoing channel / traffic, then you will have to reduce the picture quality so that the broadcast goes smoothly.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My server has a 10 Mbps channel. This width is straight with a margin. But there is a traffic limit - 1 TB per month. Therefore, in order to meet the traffic restrictions, my outgoing stream should not exceed ~ 300 Kb per second i.e. the bitrate of the outgoing stream should be no more than 2.5 Mbps. YouTube, by the way, just recommends broadcasting in such a bitrate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ffmpeg uses different approaches to regulate the load on the system. Well written about it </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . I ended up using two attributes: </font></font><code>-crf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>-preset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constant Rate Factor (CRF)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is a coefficient due to which you can adjust the picture quality. </font><font style="vertical-align: inherit;">CRF can range from 0 to 51, where 0 is the quality of the source file, 51 is the worst quality possible. </font><font style="vertical-align: inherit;">It is recommended to use values ‚Äã‚Äãfrom 17 to 28, the default is 23. With a ratio of 17, the video will visually be identical to the original, but technically it will not. </font><font style="vertical-align: inherit;">The documentation also states that the size of the final video, depending on the specified CRF, changes exponentially i.e. </font><font style="vertical-align: inherit;">increasing the coefficient by 6 points will double the bitrate of the outgoing video. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If using CRF you can choose the "weight" of the outgoing picture, then using </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presets (-preset)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can determine how much the processor will be loaded. </font><font style="vertical-align: inherit;">The parameters for this attribute have the following:</font></font><br>
<br>
<ul>
<li><code>ultrafast</code></li>
<li><code>superfast</code></li>
<li><code>veryfast</code></li>
<li><code>faster</code></li>
<li><code>fast</code></li>
<li><code>medium</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - default value</font></font></li>
<li><code>slow</code></li>
<li><code>slower</code></li>
<li><code>veryslow</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The ‚Äúfaster‚Äù the parameter is specified, the higher the load on the processor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I first picked up the preset, which was basically ‚Äútough‚Äù to my processor, and then more finely tuned the load using CRF. </font><font style="vertical-align: inherit;">In my case, the preset came up </font></font><code>fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and for crf I settled on a value of 24.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font><font style="vertical-align: inherit;">The final command to start the broadcast I got this:</font></font><br>
<br>
<pre><code class="bash hljs">ffmpeg -re -i lecture1.mp4 -vf drawtext=<span class="hljs-string">"fontfile=OpenSans.ttf:text=' 1\:   ':fontsize=26:fontcolor=white:borderw=1:bordercolor=black:x=40:y=670"</span> -c:v libx264 -preset fast -crf 24 -g 3 -f flv rtmp://a.rtmp.youtube.com/live2/%_%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here there are only two undescribed moments: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><code>-c:v libx264</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an indication of a specific codec for working with the source file. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) </font></font><code>-g 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an explicit indication of the number of key frames. In this case, it is indicated that every third frame should be key. The standard value is either 5 or 8, but YouTube swears, asks at least 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What quality of the broadcast turned out can be seen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The server load was as follows:</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/b5/3s/za/b53szauaywx3bdwoic-yebil1es.jpeg" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/cq/jc/t4/cqjct4xhbz3zabriimgydbxvjaq.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Based on the monitoring data, it is clear that the processor load varies from 70% to 95% and the broadcast has never reached 100% in a week. So, with these settings, the processor is enough.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When loading a disk, I can say that it is almost not loaded and a regular HDD should be enough for broadcasting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the amount of outgoing traffic bothers me. It turns out that my outgoing stream ranges from 450 to 650 KB per second. For a month it will be about 1.8 terabytes. You may have to buy traffic or still switch to a dual-core configuration because I would not like to reduce the quality of the picture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, I‚Äôll say that setting up such a broadcast from scratch takes about 1-2 hours. Moreover, most of the time it will take to upload the video to the server.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a marketing tool, the launch of such a broadcast did not pay off. Perhaps if you wind up the views so that YouTube's algorithms pick up this broadcast and actively show it in the recommendations, then something would work out. In my case, for 16 days of continuous broadcasting, it was watched 58 times. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is OK. Broadcast harmoniously fit on the main page of my site. It turned out a kind of opportunity to quickly make up your mind about the lecturer and the lectures themselves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And one moment. It is important that the broadcast does not violate anyone else‚Äôs copyright, otherwise it will be blocked. I‚Äôm calm for my broadcast. I specially selected musical inserts with free use, and the author of the content sits at a neighboring computer and is not at all against me using its content :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if you have a radio playing in the background somewhere in the background, or you used your favorite track during editing, or you took a video from a popular music video, series or movie, then your broadcast is at risk. </font><font style="vertical-align: inherit;">It is also important that the broadcast carries at least minimal semantic load, otherwise it may be blocked as spam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*** </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all for me. </font><font style="vertical-align: inherit;">I hope this manual will serve someone well. </font><font style="vertical-align: inherit;">Well, if you have something to add - write, I will gladly read additions and clarifications to the article.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493336/index.html">How Computer Science Center Translated Learning Online</a></li>
<li><a href="../en493340/index.html">Making SIL functions portable between versions in Jira</a></li>
<li><a href="../en493342/index.html">How NSPK prepared the infrastructure for the transition to udalenka</a></li>
<li><a href="../en493346/index.html">We managed to transfer offices to udalenka, and you?</a></li>
<li><a href="../en493348/index.html">Make "udalenka" great again: how to transfer the whole company to remote work in 4 stages</a></li>
<li><a href="../en493356/index.html">Video @Databases Meetup: DBMS Security, Tarantool in IoT, Greenplum for Big Data Analytics</a></li>
<li><a href="../en493360/index.html">Two fingers from Algol</a></li>
<li><a href="../en493362/index.html">Technical support "on the suitcases." How we work remotely without unnecessary nerves and get the services we need remotely</a></li>
<li><a href="../en493366/index.html">What is Windows PowerShell and what does it eat? Part 3: passing parameters to scripts and functions, creating cmdlets</a></li>
<li><a href="../en493374/index.html">Coronavirus - practical tips and a bit of theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>