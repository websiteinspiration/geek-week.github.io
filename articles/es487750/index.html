<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüîß üç¶ üõ¢Ô∏è Algunas sutilezas de las colecciones de inyecci√≥n en primavera üÜë üõ≥Ô∏è üöå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Hola a todos! Me llamo Vladislav Rodin. Actualmente estoy impartiendo cursos sobre arquitectura de software y arquitectura de software de alta carga ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Algunas sutilezas de las colecciones de inyecci√≥n en primavera</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/487750/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hola a todos! </font><font style="vertical-align: inherit;">Me llamo Vladislav Rodin. </font><font style="vertical-align: inherit;">Actualmente estoy impartiendo cursos sobre arquitectura de software y arquitectura de software de alta carga en el portal OTUS. </font><font style="vertical-align: inherit;">Ahora en OTUS hay un conjunto abierto para el nuevo hilo del curso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desarrollador en Spring Framework</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En previsi√≥n del inicio del curso, decid√≠ escribir un peque√±o material de copyright que quiero compartir con ustedes.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/z-/xc/bw/z-xcbwfaea9ckpi7rtggkasvdmq.png"><br>
<hr><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antecedentes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring contiene mucha "magia" dentro de s√≠ misma, llevando a cabo algunas cosas no obvias por s√≠ misma. </font><font style="vertical-align: inherit;">La ignorancia o la incomprensi√≥n de esto pueden provocar efectos secundarios que puede encontrar en el proceso de escribir su aplicaci√≥n usando este marco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de estas cosas obvias es la inyecci√≥n de interfaces de Java Collection Framework. </font><font style="vertical-align: inherit;">Habiendo pisado de manera independiente un rastrillo relacionado con este tema y escuchando las siguientes preguntas de mis colegas, decid√≠ resolverlo y registrar los resultados de mi investigaci√≥n en forma de art√≠culo con la esperanza de que ayudar√≠a a alguien que ya est√° trabajando o durante el desarrollo inicial de Spring.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gui√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos un servicio que funcionar√° con los h√©roes del cine. </font><font style="vertical-align: inherit;">Habr√° 3 de ellos: Rambo, Terminator y Gandalf. </font><font style="vertical-align: inherit;">Cada uno de ellos representar√° una clase separada, y sus padres ser√°n comunes: H√©roe.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hero</span> </span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rambo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Rambo"</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Terminator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Terminator"</span>;<font></font>
    }<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gandalf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Hero</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Gandalf"</span>;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de inyecciones</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que queremos crear un servicio que funcione con los h√©roes de los militantes. </font><font style="vertical-align: inherit;">Probablemente, tendr√°s que inyectarle una lista de esos h√©roes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°No hay problema! </font><font style="vertical-align: inherit;">Crear un servicio y configuraci√≥n:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    List&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Hero&gt; <span class="hljs-title">action</span><span class="hljs-params">()</span> </span>{<font></font>
        List&lt;Hero&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<font></font>
        result.add(<span class="hljs-keyword">new</span> Terminator());<font></font>
        result.add(<span class="hljs-keyword">new</span> Rambo());
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Todo est√° bien, pero al verificarlo se puede encontrar que Gandalf est√° en la lista! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spring, al ver que era necesario inyectar la Lista, omiti√≥ los granos ubicados en el contexto, encontr√≥ entre ellos todos los que se ajustaban al tipo gen√©rico, recolect√≥ la Lista de ellos y la inyect√≥, ignorando nuestra Lista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo lograr que Spring haga lo que queremos?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opci√≥n 1. Muleta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que el problema es precisamente al tratar de inyectar la interfaz de Java Collection Framework, simplemente puede reemplazar List con ArrayList en el servicio y, por supuesto, en la configuraci√≥n para que Spring encuentre una instancia de la clase que necesitamos. </font><font style="vertical-align: inherit;">Entonces todo funcionar√° como esper√°bamos.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ArrayList&lt;Hero&gt; <span class="hljs-title">action</span><span class="hljs-params">()</span> </span>{<font></font>
        ArrayList&lt;Hero&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<font></font>
        result.add(<span class="hljs-keyword">new</span> Terminator());<font></font>
        result.add(<span class="hljs-keyword">new</span> Rambo());
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    ArrayList&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
</code></pre> <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opci√≥n 2. M√°s correcta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra forma de atar las manos de Spring es pedirle que inyecte en el servicio no solo cualquier Lista, sino un bean con un nombre especial, agregando Qualifier. </font><font style="vertical-align: inherit;">Por lo tanto, podremos inyectar nuestro frijol.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionHeroesService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("action")</span><font></font>
    List&lt;Hero&gt; actionHeroes;<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapas de inyecci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si muchas personas conocen el matiz de la inyecci√≥n de List, las cosas generalmente empeoran con el Mapa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribamos un servicio que funcione con los personajes principales de las pel√≠culas. Se inyectar√° un mapa en √©l, que contiene los nombres de las pel√≠culas mediante las teclas y los valores de los beans de los personajes principales:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    Map&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Hero&gt; <span class="hljs-title">mainCharactersByFilmName</span><span class="hljs-params">()</span> </span>{<font></font>
        Map&lt;String, Hero&gt; result = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
        result.put(<span class="hljs-string">"rambo"</span>, <span class="hljs-keyword">new</span> Rambo());<font></font>
        result.put(<span class="hljs-string">"terminator"</span>, <span class="hljs-keyword">new</span> Terminator());<font></font>
        result.put(<span class="hljs-string">"LOTR"</span>, <span class="hljs-keyword">new</span> Gandalf());<font></font>
<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al inicio, puede ver que la clave de Gandalf no es LOTR, sino gandalf, de lo que podemos concluir que no fue el nombre de la pel√≠cula que se escribi√≥, sino el nombre del bean, mientras que en el caso de Rimbaud y el terminador fue una suerte: los nombres de los personajes principales coinciden con t√≠tulos de pel√≠culas </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, cuando es necesario inyectar un Mapa, cuya clave es String, y el valor de los beans, Spring (como en el caso de la Lista) simplemente ignorar√° el Mapa que propusimos, revisar√° el contexto y recoger√° todos los beans adecuados. s, y crear√° un Mapa con ellos como valores y con sus nombres como claves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las soluciones alternativas son similares a las que funcionaron para la Lista:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opci√≥n 1. Muleta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reemplazar mapa con HashMap:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span><font></font>
    HashMap&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeroesConfig</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HashMap&lt;String, Hero&gt; <span class="hljs-title">mainCharactersByFilmName</span><span class="hljs-params">()</span> </span>{<font></font>
        HashMap&lt;String, Hero&gt; result = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
        result.put(<span class="hljs-string">"rambo"</span>, <span class="hljs-keyword">new</span> Rambo());<font></font>
        result.put(<span class="hljs-string">"terminator"</span>, <span class="hljs-keyword">new</span> Terminator());<font></font>
        result.put(<span class="hljs-string">"LOTR"</span>, <span class="hljs-keyword">new</span> Gandalf());<font></font>
<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opci√≥n 2. M√°s correcta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A√±adir calificador:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainCharactersService</span> </span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("mainCharactersByFilmName")</span><font></font>
    Map&lt;String, Hero&gt; mainCharactersByFilmName;<font></font>
}<font></font>
<font></font>
</code></pre></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es487740/index.html">Ensamblar un magnet√≥metro port√°til</a></li>
<li><a href="../es487742/index.html">Comercio de Arbitraje (Algoritmo Bellman-Ford)</a></li>
<li><a href="../es487744/index.html">FARO presenta el esc√°ner l√°ser 3D FOCUS S 70</a></li>
<li><a href="../es487746/index.html">Eterno</a></li>
<li><a href="../es487748/index.html">Clave de cifrado de hardware de $ 3: ¬øes esto posible?</a></li>
<li><a href="../es487752/index.html">Optimice el almacenamiento: un caso de unificaci√≥n y menor costo de propiedad</a></li>
<li><a href="../es487754/index.html">Organizaci√≥n de la intranet (automatizaci√≥n de la producci√≥n de TI). Parte 1 - Usuarios y correo</a></li>
<li><a href="../es487756/index.html">RIT, Maxim Lapshin (Erlyvideo): c√≥mo un programador para hacer crecer una empresa</a></li>
<li><a href="../es487764/index.html">Tengo 14 a√±os y combino la escuela con el trabajo en TI</a></li>
<li><a href="../es487768/index.html">Apertura de los puertos 4321 y 9898 en Xiaomi Gateway 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>