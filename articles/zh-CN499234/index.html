<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔀 👶🏼 🧑🏻 Flexiant Cloud Orchestrator中的网络 👲🏾 🐽 🏓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在关于云乐队的系列文章的续篇中，Flexiant想要谈谈如何在该乐队下管理虚拟机和容器的网络组织。
 
 Flexiant标识客户端可以在其虚拟机中访问的四种网络类型。
 
 PVIP是一个将单个/ 32地址分配给客户端的网络。到此IP地址的路由是在
 公共IP 虚拟机所在的主机上执行的，该主机是客...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Flexiant Cloud Orchestrator中的网络</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在关于云乐队的系列文章的续篇中，Flexiant想要谈谈如何在该乐队下管理虚拟机和容器的网络组织。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Flexiant标识客户端可以在其虚拟机中访问的四种网络类型。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVIP是一个将单个/ 32地址分配给客户端的网络。到此IP地址的路由是在</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公共IP </font><font style="vertical-align: inherit;">虚拟机所在的主机上执行的，该主机是</font><font style="vertical-align: inherit;">客户端在其中接收单独的VLAN和/ 29子网的网络。这是我们使用的主要网络。它的路由在由Flexiant Cloud Orchestrator管理的特殊路由器节点上执行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
专用IP-网络，组织与上一个类似，不同之处在于它不在路由器节点上外部显示。客户端可以使用它在其虚拟机之间创建内部网络。 IP地址既可以从接口也可以在机器本身上分配。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
互通VLAN –再次与专用IP非常相似，不同之处在于，如果没有提供者的参与，则不能直接供客户端使用。当客户需要将现有的L2基础架构连接到Flexiant Cloud Orchestrator基础架构时，我们会将其提供给客户端。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除第一个网络外，所有网络都在单独的隔离VLAN中运行；因此，客户端可以使用所有第二层协议：arp，dhcp，lldp等。 PVIP网络在L3上运行，我们将其用于希望从DDoS获得保护的客户端。如果他们想保护IP地址，则需要使用它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个网络都分配给一个虚拟机适配器。因此，在一台虚拟机中，可以同时存在多种类型的网络。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户端可以任意选择专用IP和互通VLAN的IP地址。从控制面板的列表中选择公用IP和PVIP的IP地址。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_l/zn/kr/_lznkrleqhvfpqv5okrisl7wcb4.jpeg" alt="图片"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
适配器接收到网络以及可选的IP地址后，有关该信息的信息就会进入管弦乐队的数据库，并在路由节点（对于公共IP网络），计算节点（对于PVIP）以及位于DHCP服务器中的相应设置中输入相应的设置如果已设置IP地址，则在管理节点上。卡的虚拟mac地址与所选IP地址之间的对应表将输入到PgSQL数据库中，DHCP服务器将从该数据库中获取该对应表。</font></font><br>
<cut></cut><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在每个节点上，无论是路由器节点还是计算节点，都将安装Flexiant代理，该代理从管弦乐队接收命令。在节点本身内部，在单独的网络名称空间中引发了虚拟路由器。因此，节点上的Linux网络堆栈和虚拟路由器网络堆栈彼此独立。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在鲤鱼的实现中，使用VRRP协议确保公共IP正常工作的路由器节点相互复制。如果其中一个节点发生故障，流量将通过另一个节点，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一个在路由节点上进行路由的示例：</font></font><br>
<br>
<pre><code class="plaintext hljs">Router0# ip a l<font></font>
…<font></font>
766: VLAN367: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default<font></font>
    link/ether 00:1e:67:d3:67:5c brd ff:ff:ff:ff:ff:ff<font></font>
    inet6 fe80::e0fe:25ff:fef9:7304/64 scope link<font></font>
     valid_lft forever preferred_lft forever<font></font>
…<font></font>
Router0# brctl show VLAN367<font></font>
bridge name     bridge id               STP enabled     interfaces<font></font>
VLAN367         8000.001e67d3675c       no              bond0.367<font></font>
                                                                               evrl-000190<font></font>
<font></font>
#         ,     shell  screen,       <font></font>
<font></font>
Router0# evrs<font></font>
Router0# ip a l evrr-000190<font></font>
768: evrr-000190: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<font></font>
    link/ether e6:52:0f:21:83:b0 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 217.23.xxx.xxx/29 scope global evrr-000190<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::e452:fff:fe21:83b0/64 scope link<font></font>
       valid_lft forever preferred_lft forever<font></font>
<font></font>
Router0# ip r l 217.23.xxx.xxx<font></font>
217.23.xxx.xxx/29 dev evrr-000190  proto kernel  scope link  src 217.23.xxx.xxx<font></font>
Router#0 ip r l ip r l 0.0.0.0/0<font></font>
default via 10.158.192.3 dev evrr-000000  proto bird<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一对evrr / evrl接口是Linux上的常规版本，它们将两个网络名称空间互连。因此，可以看到进入虚拟路由器的传入流量如何在那里路由到特定接口。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
防火墙管理也发生在虚拟路由器中。创建了单独的表和链，这些表和链允许或不允许到特定网络接口的流量。</font></font><br>
<br>
<pre><code class="plaintext hljs">Router0# iptables -nvL evrr-000190-4i<font></font>
Chain evrr-000190-4i (1 references)<font></font>
 pkts bytes target     prot opt in     out     source               destination<font></font>
 435M  124G RETURN     all  --  *      *       217.23.xxx.xxx        0.0.0.0/0<font></font>
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0<font></font>
Router0# iptables -nvL evrr-000190-4o<font></font>
Chain evrr-000190-4o (1 references)<font></font>
pkts bytes target     prot opt in     out     source               destination<font></font>
587M  782G ACCEPT     all  --  *      *       0.0.0.0/0            217.23.xxx.xxx<font></font>
6038K  350M DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用OSPF作为路由协议，将配置与计算和路由器节点连接到网络的核心，再从那里到达核心路由器。</font><font style="vertical-align: inherit;">作为节点上的软件，使用了由Flexiant控制的bird。</font><font style="vertical-align: inherit;">我们还对配置模板进行了更改，因为Flexiant允许我们执行此操作。</font><font style="vertical-align: inherit;">Flexiant还允许您将statics和bgp用作路由协议。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在付款方面，所有网络都是免费的。</font><font style="vertical-align: inherit;">仅针对PVIP和公共IP网络的IP地址付款。</font><font style="vertical-align: inherit;">但是，PVIP的IP地址更昂贵，因为它们受到了DDoS攻击的保护。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN499220/index.html">由于冠状病毒将开发人员转移到远程站点，从而提高了Google和Microsoft的生产率</a></li>
<li><a href="../zh-CN499224/index.html">是时候开始正确学习了</a></li>
<li><a href="../zh-CN499226/index.html">没有大流行：如何以1000美元的价格制作一部关于加密货币的电影并进入美国顶级电影发行市场</a></li>
<li><a href="../zh-CN499230/index.html">如何养成健康的蠕虫：解析1910年手册</a></li>
<li><a href="../zh-CN499232/index.html">配置gitlab.com CI和VPS服务器</a></li>
<li><a href="../zh-CN499236/index.html">国家服务电话</a></li>
<li><a href="../zh-CN499238/index.html">在家焊接：流记录</a></li>
<li><a href="../zh-CN499240/index.html">通过刺向星星，或在天上事务中进行数据分析</a></li>
<li><a href="../zh-CN499242/index.html">研究人员通过桌子上的振动从台式PC传输数据</a></li>
<li><a href="../zh-CN499244/index.html">协同组织。第二部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>