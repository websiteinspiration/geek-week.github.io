<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👑 ↖️ 🎁 フォールトトレラントITインフラストラクチャの作成。パート1. oVirt 4.3クラスターをデプロイする準備 🏎️ 😙 ⭐️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="読者は、1つのデータセンター内に小規模企業のフォールトトレラントインフラストラクチャを構築するという原則に慣れるように招待されます。これについては、一連の短い記事で詳しく説明します。
 前書き
 

DPC（データ処理センター）の下で理解することができます：
 

- 企業のテリトリーにある「サーバ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>フォールトトレラントITインフラストラクチャの作成。パート1. oVirt 4.3クラスターをデプロイする準備</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/483980/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者は、1つのデータセンター内に小規模企業のフォールトトレラントインフラストラクチャを構築するという原則に慣れるように招待されます。これについては、一連の短い記事で詳しく説明します。</font></font></p><a name="habracut"></a><br>
<h2 id="vvodnaya-chast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<p><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DPC</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（データ処理センター）の</font><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">で理解することができます：</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企業のテリトリーにある「サーバールーム」内に、電力および冷却装置を提供するための最小要件を満たし、2つの独立したプロバイダーを通じてインターネットにアクセスできる独自のラック。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このデータセンターにある独自の機器付きのレンタルラック-いわゆる </font><font style="vertical-align: inherit;">Tier IIIまたはIV規格に準拠し、信頼性の高い電源供給、冷却を保証し、フォールトトレラントなインターネットアクセスを提供するコロケーション。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tier IIIまたはIVデータセンターの完全にリースされた機器。</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どの宿泊施設オプションを選択するか-いずれの場合も、すべてが個別のものであり、通常、いくつかの主な要因によって異なります。</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企業に独自のITインフラストラクチャがあるのはなぜですか。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企業がITインフラストラクチャに何を求めているか（信頼性、スケーラビリティ、管理性など）。</font></font></li>
<li>    IT ,        –  (   ),   (  );</li>
<li>   . </li>
</ul><br>
<p> ,          IT ,   ,     ,    ,     ,     ,         –      ,    .</p><br>
<p>   ,     ,     ,    .    –  ,    ,          ,    ,  ""  .   ""       ,         ,            ,        ,       ,    .</p><br>
<p>,    :</p><br>
<ul>
<li> ,     -      ;</li>
<li>          ,     Tier III;</li>
<li>      ,          :</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><blockquote><ul>
<li>   Dell PowerEdge R640   :</li>
<li><em>  Intel Xeon Gold 5120</em></li>
<li><em>512 Gb RAM</em></li>
<li><em> SAS   RAID1,   </em></li>
<li><em> 4-    1G</em></li>
<li><em> 2-    10G</em></li>
<li><em> 2-  FC HBA 16G.</em> </li>
<li>2-   Dell MD3820f,   FC 16G    Dell;</li>
<li>    — Cisco WS-C2960RX-48FPS-L   ;</li>
<li>    — Cisco WS-C3850-24T-E (     ,   );</li>
<li>, UPS, PDU,   –  .</li>
</ul><br>
</blockquote></div></div><br>
<p>  ,           ,  ,           ,    ,             .</p><br>
<p>    ,        :</p><br>
<ul>
<li>          2960,      ;</li>
<li>  FC ,        ;</li>
<li>     –  ,     ,    10G    ;</li>
<li>           – SAS, SATA  SSD,    ;</li>
<li>  FC      ,      ,        Remote Replication,             ,     (     );</li>
<li>     – Cisco 3850,        ,      .     ,     .   3850   10G,    ,       10G.</li>
</ul><br>
<p>     ,        ,                 (-,    ..),         ,         . </p><br>
<p>       ,     :      , Live migration       ,        ,  ..</p><br>
<p> ,  ,   -  VMware vSphere,       VMware   «» ,            – <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>oVirt</strong></a>,     ,     — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>RHEV</strong></a>.</p><br>
<p>  <strong>oVirt</strong>           ,       -   –   , -, -, ,        ..,   ,     -  .</p><br>
<p>  ,    ,    ,     -  :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> 1.</strong>     oVirt 4.3</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> 2.</strong>     oVirt 4.3</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> 3.</strong>      VyOS</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> 4.</strong>   Cisco 3850   </a></li>
</ul></div></div><br>
<h2 id="chast-1-podgotovka-k-razvyortyvaniyu-klastera-ovirt-43"> 1.     oVirt 4.3</h2><br>
<h3 id="bazovaya-nastroyka-hostov">  </h3><br>
<p>    –    .        –  ,       -    .</p><br>
<p>,      Dell PowerEdge R640,         ,             oVirt 4.3. </p><br>
<p>        oVirt,       <strong>CentOS 7.7</strong>,     oVirt'     :</p><br>
<ul>
<li>    RHEL, .. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>oVirt Node</strong></a>;</li>
<li>OS Oracle Linux,  2019 . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    oVirt  .</li>
</ul><br>
<p>   :</p><br>
<ul>
<li>   iDRAC   ;</li>
<li>   BIOS  iDRAC   ;</li>
<li> System Profile     Performance;</li>
<li> RAID    ( RAID1),     .</li>
</ul><br>
<p>       iDRAC  –   , -     .             iDRAC,      ,           "".</p><br>
<p>  ,    :</p><br>
<pre><code class="plaintext hljs">systemctl enable network.service<font></font>
systemctl start network.service<font></font>
systemctl status network.service</code></pre><br>
<pre><code class="plaintext hljs">systemctl stop NetworkManager<font></font>
systemctl disable NetworkManager<font></font>
systemctl status NetworkManager</code></pre><br>
<pre><code class="plaintext hljs">yum install -y ntp<font></font>
systemctl enable ntpd.service<font></font>
systemctl start ntpd.service</code></pre><br>
<pre><code class="plaintext hljs">cat /etc/sysconfig/selinux<font></font>
SELINUX=disabled<font></font>
SELINUXTYPE=targeted</code></pre><br>
<pre><code class="plaintext hljs">cat /etc/security/limits.conf<font></font>
 *               soft    nofile         65536<font></font>
 *               hard   nofile         65536</code></pre><br>
<pre><code class="plaintext hljs">cat /etc/sysctl.conf<font></font>
vm.max_map_count = 262144<font></font>
vm.swappiness = 1</code></pre><br>
<p><u>   </u></p><br>
<p>   ,       ,        ,        .        ,    .</p><br>
<pre><code class="plaintext hljs">yum -y install epel-release<font></font>
yum update<font></font>
yum -y install bind-utils yum-utils net-tools git htop iotop nmon pciutils sysfsutils sysstat mc nc rsync wget traceroute gzip unzip telnet </code></pre><br>
<p>      –    ,        .</p><br>
<p>       ,     :</p><br>
<pre><code class="plaintext hljs">systemctl enable tuned <font></font>
systemctl start tuned <font></font>
systemctl status tuned </code></pre><br>
<pre><code class="plaintext hljs">tuned-adm profile <font></font>
tuned-adm profile virtual-host </code></pre><br>
<p>      : "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Chapter 4. tuned and tuned-adm</a>".</p><br>
<p>  ,     –     ,    Cisco 2960X.</p><br>
<h3 id="nastroyka-steka-kommutatorov-cisco-2960x">   Cisco 2960X</h3><br>
<p>       VLAN' —   ,    ,      :</p><br>
<p><strong>VLAN 10</strong> – public Internet<br>
<strong>VLAN 17</strong> – management network (iDRAC, , switches management)<br>
<strong>VLAN 30</strong> – test network<br>
<strong>VLAN 31</strong> – test network<br>
<strong>VLAN 32</strong> – VM production network<br>
<strong>VLAN 33</strong> – interconnection network (to external contractors)<br>
<strong>VLAN 34</strong> – test network<br>
<strong>VLAN 35</strong> – test network<br>
<strong>VLAN 36</strong> – test network<br>
<strong>VLAN 37</strong> – test network<br>
<strong>VLAN 38</strong> – test network<br>
<strong>VLAN 40</strong> – VM test network</p><br>
<p>  ,     L2,       :</p><br>
<p><img src="https://habrastorage.org/webt/in/ak/8a/inak8aoyty8yujo2zagwdehdytg.jpeg"></p><br>
<p>    oVirt     ,      ,     Cisco 2960X.</p><br>
<p>  Dell   4-   , ,     Cisco 2960X      ,          ,   LACP (802.3ad):</p><br>
<ul>
<li>             2960X –       <strong><em>bridge </em></strong>     , ,       oVirt,      Live migration  ;</li>
<li>             2960X –       oVirt,     bridge' (  VLAN')      .</li>
<li>  ,     ,  , ..      ,   .</li>
<li>        ,   IP .</li>
</ul><br>
<p><u>    <strong>2960X</strong>   </u></p><br>
<p>    :</p><br>
<ul>
<li>  ;</li>
<li>      , , CAB-STK-E-1M;</li>
<li>  ;</li>
<li>       ,    .</li>
</ul><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> . </p><br>
<p>   ,   .<br>
   ,       ,       .<br>
  –              .</p><br>
<p>1)    ,    ,         .</p><br>
<div class="spoiler"><b class="spoiler_title">  :</b><div class="spoiler_text"><pre><code class="plaintext hljs"> enable<font></font>
 configure terminal<font></font>
<font></font>
 hostname 2960X<font></font>
<font></font>
 no service pad<font></font>
 service timestamps debug datetime msec<font></font>
 service timestamps log datetime localtime show-timezone msec<font></font>
 no service password-encryption<font></font>
 service sequence-numbers<font></font>
<font></font>
 switch 1 priority 15<font></font>
 switch 2 priority 14<font></font>
 stack-mac persistent timer 0<font></font>
<font></font>
 clock timezone MSK 3<font></font>
  vtp mode transparent<font></font>
  ip subnet-zero<font></font>
<font></font>
 vlan 17<font></font>
  name Management<font></font>
<font></font>
 vlan 32<font></font>
  name PROD <font></font>
<font></font>
 vlan 33<font></font>
  name Interconnect<font></font>
<font></font>
 vlan 34<font></font>
  name Test<font></font>
<font></font>
 vlan 35<font></font>
  name Dev<font></font>
<font></font>
 vlan 40<font></font>
  name Monitoring<font></font>
<font></font>
 spanning-tree mode rapid-pvst<font></font>
 spanning-tree etherchannel guard misconfig<font></font>
 spanning-tree portfast bpduguard default<font></font>
 spanning-tree extend system-id<font></font>
 spanning-tree vlan 1-40 root primary<font></font>
 spanning-tree loopguard default<font></font>
 vlan internal allocation policy ascending<font></font>
 port-channel load-balance src-dst-ip<font></font>
<font></font>
 errdisable recovery cause loopback<font></font>
 errdisable recovery cause bpduguard<font></font>
 errdisable recovery interval 60<font></font>
<font></font>
line con 0<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 logging synchronous<font></font>
line vty 5 15<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 logging synchronous<font></font>
<font></font>
 ip http server<font></font>
 ip http secure-server<font></font>
 no vstack<font></font>
<font></font>
interface Vlan1<font></font>
 no ip address<font></font>
 shutdown<font></font>
<font></font>
 exit <font></font>
</code></pre></div></div><br>
<p>   «<strong>wr mem</strong>»      «<strong>reload</strong>»    switch 1.</p><br>
<p>2)        (access)  VLAN 17,       iDRAC .</p><br>
<div class="spoiler"><b class="spoiler_title">  :</b><div class="spoiler_text"><pre><code class="plaintext hljs">interface GigabitEthernet1/0/5<font></font>
 description iDRAC - host1<font></font>
 switchport access vlan 17<font></font>
 switchport mode access<font></font>
 spanning-tree portfast edge<font></font>
<font></font>
interface GigabitEthernet1/0/6<font></font>
 description Storage1 - Cntr0/Eth0<font></font>
 switchport access vlan 17<font></font>
 switchport mode access<font></font>
 spanning-tree portfast edge<font></font>
<font></font>
interface GigabitEthernet2/0/5<font></font>
 description iDRAC - host2<font></font>
 switchport access vlan 17<font></font>
 switchport mode access<font></font>
 spanning-tree portfast edge<font></font>
<font></font>
interface GigabitEthernet2/0/6<font></font>
 description Storage1 – Cntr1/Eth0<font></font>
 switchport access vlan 17<font></font>
 switchport mode access<font></font>
 spanning-tree portfast edge<font></font>
 exit</code></pre></div></div><br>
<p>3)   , ,    :</p><br>
<div class="spoiler"><b class="spoiler_title">  :</b><div class="spoiler_text"><pre><code class="plaintext hljs">2960X#show switch stack-ring speed<font></font>
<font></font>
Stack Ring Speed        : 20G<font></font>
Stack Ring Configuration: Full<font></font>
Stack Ring Protocol     : FlexStack<font></font>
<font></font>
2960X#show switch stack-ports<font></font>
  Switch #    Port 1       Port 2<font></font>
  --------    ------       ------<font></font>
    1           Ok           Ok<font></font>
    2           Ok           Ok<font></font>
<font></font>
2960X#show switch neighbors<font></font>
  Switch #    Port 1       Port 2<font></font>
  --------    ------       ------<font></font>
      1         2             2<font></font>
      2         1             1<font></font>
<font></font>
2960X#show switch detail<font></font>
Switch/Stack Mac Address : 0cd0.f8e4.<font></font>
Mac persistency wait time: Indefinite<font></font>
                                           H/W   Current<font></font>
Switch#  Role   Mac Address     Priority Version  State<font></font>
----------------------------------------------------------<font></font>
*1       Master 0cd0.f8e4.    15     4       Ready<font></font>
 2       Member 0029.c251.     14     4       Ready<font></font>
<font></font>
         Stack Port Status             Neighbors<font></font>
Switch#  Port 1     Port 2           Port 1   Port 2<font></font>
--------------------------------------------------------<font></font>
  1        Ok         Ok                2        2<font></font>
  2        Ok         Ok                1        1</code></pre></div></div><br>
<p>4)  SSH    2960X</p><br>
<p>     SSH,   IP 172.20.1.10,   SVI (switch virtual interface) <strong>VLAN17</strong>. </p><br>
<p>          ,       .</p><br>
<div class="spoiler"><b class="spoiler_title"> SSH    :</b><div class="spoiler_text"><pre><code class="plaintext hljs">ip default-gateway 172.20.1.2<font></font>
<font></font>
interface vlan 17<font></font>
 ip address 172.20.1.10 255.255.255.0<font></font>
<font></font>
hostname 2960X<font></font>
 ip domain-name hw.home-lab.ru<font></font>
 no ip domain-lookup<font></font>
<font></font>
clock set 12:47:04 06 Dec 2019<font></font>
<font></font>
crypto key generate rsa<font></font>
<font></font>
ip ssh version 2<font></font>
ip ssh time-out 90<font></font>
<font></font>
line vty 0 4<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 privilege level 15<font></font>
 logging synchronous<font></font>
 transport input ssh<font></font>
<font></font>
line vty 5 15<font></font>
 session-timeout 60<font></font>
 exec-timeout 60 0<font></font>
 privilege level 15<font></font>
 logging synchronous<font></font>
 transport input ssh<font></font>
<font></font>
aaa new-model<font></font>
aaa authentication login default local <font></font>
username cisco privilege 15 secret my_ssh_password</code></pre></div></div><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">enable secret *myenablepassword*<font></font>
service password-encryption</code></pre><br>
<p> NTP:</p><br>
<pre><code class="plaintext hljs">ntp server 85.21.78.8 prefer<font></font>
ntp server 89.221.207.113<font></font>
ntp server 185.22.60.71<font></font>
ntp server 192.36.143.130<font></font>
ntp server 185.209.85.222<font></font>
<font></font>
show ntp status<font></font>
show ntp associations<font></font>
show clock detail</code></pre><br>
<p>5)    Etherchannel   ,   .   ,   VLAN'      ,      ,  :</p><br>
<div class="spoiler"><b class="spoiler_title">  Etherchannel:</b><div class="spoiler_text"><pre><code class="plaintext hljs">interface Port-channel1<font></font>
 description EtherChannel with Host1-management<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree portfast edge trunk<font></font>
<font></font>
interface Port-channel2<font></font>
 description EtherChannel with Host2-management<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree portfast edge trunk<font></font>
<font></font>
interface Port-channel3<font></font>
 description EtherChannel with Host1-VM<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree portfast edge trunk<font></font>
<font></font>
interface Port-channel4<font></font>
 description EtherChannel with Host2-VM<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 spanning-tree portfast edge trunk<font></font>
<font></font>
interface GigabitEthernet1/0/1<font></font>
 description Host1-management<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 1 mode active<font></font>
<font></font>
interface GigabitEthernet1/0/2<font></font>
 description Host2-management<font></font>
  switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 2 mode active<font></font>
<font></font>
interface GigabitEthernet1/0/3<font></font>
 description Host1-VM<font></font>
  switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 3 mode active<font></font>
<font></font>
interface GigabitEthernet1/0/4<font></font>
 description Host2-VM<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 4 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/1<font></font>
 description Host1-management<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 1 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/2<font></font>
 description Host2-management<font></font>
  switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 2 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/3<font></font>
 description Host1-VM<font></font>
  switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 3 mode active<font></font>
<font></font>
interface GigabitEthernet2/0/4<font></font>
 description Host2-VM<font></font>
 switchport trunk allowed vlan 10,17,30-40<font></font>
 switchport mode trunk<font></font>
 channel-protocol lacp<font></font>
 channel-group 4 mode active</code></pre></div></div><br>
<p><u>      ,   <strong>Host1 </strong> <strong>Host2</strong></u></p><br>
<p>        ,     :</p><br>
<pre><code class="plaintext hljs">modinfo bonding<font></font>
modinfo 8021q<font></font>
yum install bridge-utils</code></pre><br>
<div class="spoiler"><b class="spoiler_title">     BOND1   ,    :</b><div class="spoiler_text"><pre><code class="plaintext hljs">cat /etc/sysconfig/network-scripts/ifcfg-bond1<font></font>
#DESCRIPTION - management<font></font>
DEVICE=bond1<font></font>
NAME=bond1<font></font>
TYPE=Bond<font></font>
IPV6INIT=no<font></font>
ONBOOT=yes<font></font>
USERCTL=no<font></font>
NM_CONTROLLED=no<font></font>
BOOTPROTO=none<font></font>
BONDING_OPTS='mode=4 lacp_rate=1 xmit_hash_policy=2'<font></font>
<font></font>
cat /etc/sysconfig/network-scripts/ifcfg-em2<font></font>
#DESCRIPTION - management<font></font>
DEVICE=em2<font></font>
TYPE=Ethernet<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes<font></font>
MASTER=bond1<font></font>
SLAVE=yes<font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no <font></font>
<font></font>
cat /etc/sysconfig/network-scripts/ifcfg-em3<font></font>
#DESCRIPTION - management<font></font>
DEVICE=em3<font></font>
TYPE=Ethernet<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes<font></font>
MASTER=bond1<font></font>
SLAVE=yes<font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no </code></pre></div></div><br>
<p>     <strong>2960 </strong> ,    ,     .</p><br>
<ul>
<li> :</li>
</ul><br>
<pre><code class="plaintext hljs">systemctl restart network<font></font>
<font></font>
cat /proc/net/bonding/bond1<font></font>
Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)<font></font>
<font></font>
Bonding Mode: IEEE 802.3ad Dynamic link aggregation<font></font>
Transmit Hash Policy: layer2+3 (2)<font></font>
MII Status: up<font></font>
MII Polling Interval (ms): 100<font></font>
Up Delay (ms): 0<font></font>
Down Delay (ms): 0<font></font>
...<font></font>
802.3ad info<font></font>
LACP rate: fast<font></font>
Min links: 0<font></font>
Aggregator selection policy (ad_select): stable<font></font>
System priority: 65535<font></font>
...<font></font>
Slave Interface: em2<font></font>
MII Status: up<font></font>
Speed: 1000 Mbps<font></font>
Duplex: full<font></font>
...<font></font>
Slave Interface: em3<font></font>
MII Status: up<font></font>
Speed: 1000 Mbps<font></font>
Duplex: full</code></pre><br>
<ul>
<li>   <strong>2960</strong>:</li>
</ul><br>
<pre><code class="plaintext hljs">2960X#show lacp internal<font></font>
Flags:  S - Device is requesting Slow LACPDUs<font></font>
        F - Device is requesting Fast LACPDUs<font></font>
        A - Device is in Active mode       P - Device is in Passive mode<font></font>
<font></font>
Channel group 1<font></font>
                            LACP port     Admin     Oper    Port        Port<font></font>
Port      Flags   State     Priority      Key       Key     Number      State<font></font>
Gi1/0/1   SA      bndl      32768         0x1       0x1     0x102       0x3D<font></font>
Gi2/0/1   SA      bndl      32768         0x1       0x1     0x202       0x3D<font></font>
<font></font>
2960X#sh etherchannel summary<font></font>
Flags:  D - down        P - bundled in port-channel<font></font>
        I - stand-alone s - suspended<font></font>
        H - Hot-standby (LACP only)<font></font>
        R - Layer3      S - Layer2<font></font>
        U - in use      N - not in use, no aggregation<font></font>
        f - failed to allocate aggregator<font></font>
<font></font>
        M - not in use, minimum links not met<font></font>
        m - not in use, port not aggregated due to minimum links not met<font></font>
        u - unsuitable for bundling<font></font>
        w - waiting to be aggregated<font></font>
        d - default port<font></font>
<font></font>
        A - formed by Auto LAG<font></font>
<font></font>
Number of channel-groups in use: 11<font></font>
Number of aggregators:           11<font></font>
<font></font>
Group  Port-channel  Protocol    Ports<font></font>
------+-------------+-----------+-----------------------------------------------<font></font>
1      Po1(SU)         LACP      Gi1/0/1(P)  Gi2/0/1(P)</code></pre><br>
<p>       ,   <strong>Host1 </strong> <strong>Host2</strong></p><br>
<div class="spoiler"><b class="spoiler_title">     BOND1  ,    :</b><div class="spoiler_text"><pre><code class="plaintext hljs">cat /etc/sysconfig/network-scripts/ifcfg-bond0<font></font>
#DESCRIPTION - management<font></font>
DEVICE=bond0<font></font>
NAME=bond0<font></font>
TYPE=Bond<font></font>
BONDING_MASTER=yes<font></font>
IPV6INIT=no<font></font>
ONBOOT=yes<font></font>
USERCTL=no<font></font>
NM_CONTROLLED=no<font></font>
BOOTPROTO=none<font></font>
BONDING_OPTS='mode=4 lacp_rate=1 xmit_hash_policy=2'<font></font>
<font></font>
cat /etc/sysconfig/network-scripts/ifcfg-em0<font></font>
#DESCRIPTION - management<font></font>
DEVICE=em0<font></font>
TYPE=Ethernet<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes<font></font>
MASTER=bond0<font></font>
SLAVE=yes<font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no <font></font>
<font></font>
cat /etc/sysconfig/network-scripts/ifcfg-em1<font></font>
#DESCRIPTION - management<font></font>
DEVICE=em1<font></font>
TYPE=Ethernet<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes<font></font>
MASTER=bond0<font></font>
SLAVE=yes<font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no </code></pre></div></div><br>
<p>     <strong>2960 </strong> ,    ,     .</p><br>
<pre><code class="plaintext hljs">systemctl restart network<font></font>
cat /proc/net/bonding/bond1<font></font>
<font></font>
2960X#show lacp internal<font></font>
2960X#sh etherchannel summary</code></pre><br>
<p>        <strong>VLAN 17</strong>,       BOND1:</p><br>
<div class="spoiler"><b class="spoiler_title"> VLAN17  Host1:</b><div class="spoiler_text"><pre><code class="plaintext hljs">cat /etc/sysconfig/network-scripts/ifcfg-bond1.17<font></font>
DEVICE=bond1.17<font></font>
NAME=bond1-vlan17<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes <font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no <font></font>
VLAN=yes<font></font>
MTU=1500  <font></font>
IPV4_FAILURE_FATAL=yes<font></font>
IPV6INIT=no<font></font>
IPADDR=172.20.1.163<font></font>
NETMASK=255.255.255.0<font></font>
GATEWAY=172.20.1.2<font></font>
DEFROUTE=yes<font></font>
DNS1=172.20.1.8<font></font>
DNS2=172.20.1.9<font></font>
ZONE=public</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> VLAN17  Host2:</b><div class="spoiler_text"><pre><code class="plaintext hljs">cat /etc/sysconfig/network-scripts/ifcfg-bond1.17<font></font>
DEVICE=bond1.17<font></font>
NAME=bond1-vlan17<font></font>
BOOTPROTO=none<font></font>
ONBOOT=yes <font></font>
USERCTL=no <font></font>
NM_CONTROLLED=no <font></font>
VLAN=yes<font></font>
MTU=1500  <font></font>
IPV4_FAILURE_FATAL=yes<font></font>
IPV6INIT=no<font></font>
IPADDR=172.20.1.164<font></font>
NETMASK=255.255.255.0<font></font>
GATEWAY=172.20.1.2<font></font>
DEFROUTE=yes<font></font>
DNS1=172.20.1.8<font></font>
DNS2=172.20.1.9<font></font>
ZONE=public</code></pre></div></div><br>
<p>          .</p><br>
<p>     Cisco 2960X ,      ,              L2.</p><br>
<h3 id="nastroyka-shd-dell-md3820f">  Dell MD3820f</h3><br>
<p>     ,         Cisco <strong>2960</strong>  ,     <strong>Host1 </strong> <strong>Host2 </strong> FC.</p><br>
<p> ,        ,    .</p><br>
<p>    FC  ,   :</p><br>
<p><img src="https://habrastorage.org/webt/el/k8/5a/elk85aqc6ilmxeiowmh6acrkwri.jpeg"></p><br>
<p>  ,   WWPN   FC HBA ,   FC    –          LUN'  .</p><br>
<p>           Dell MD3820f – <strong>PowerVault Modular Disk Storage Manager</strong> (<strong>MDSM</strong>).<br>
     IP   ,       <strong>VLAN17</strong>,     TCP/IP:</p><br>
<p><strong>Storage1</strong>:</p><br>
<pre><code class="plaintext hljs">ControllerA IP - 172.20.1.13, MASK - 255.255.255.0, Gateway - 172.20.1.2<font></font>
ControllerB IP - 172.20.1.14, MASK - 255.255.255.0, Gateway - 172.20.1.2</code></pre><br>
<p>  ,        ,  ,      ,     ..<br>
   –   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a> .</p><br>
<p>   ,       :</p><br>
<ol>
<li>   FC  – <strong>Host Port Identifiers</strong>.</li>
<li>   – <strong>Host group</strong>        Dell.</li>
<li>        ( LUN'),    .</li>
<li>    ( LUN')  .</li>
</ol><br>
<p>         FC ,    – <strong>Host Mappings</strong> -&gt; <strong>Define</strong> -&gt; <strong>Hosts…</strong><br>
WWPN  FC HBA   , ,  iDRAC .</p><br>
<p>        :</p><br>
<p><img src="https://habrastorage.org/webt/p_/uk/u4/p_uku4o-ewgqpyi0xudxqjesfjc.png"> </p><br>
<p>        ,    – <strong>Host Mappings</strong> -&gt; <strong>Define</strong> -&gt; <strong>Host Group…</strong><br>
     – <strong><em>Linux (DM-MP)</em></strong>.</p><br>
<p>   ,   <strong>Storage &amp; Copy Services</strong>,    – <strong>Disk Group</strong>,       , , RAID10,       :</p><br>
<p><img src="https://habrastorage.org/webt/ue/g2/kn/ueg2kn0m3usv1kb4tygvx2vajz0.png"></p><br>
<p> ,   —    ( LUN')  .<br>
    – <strong>Host Mappings</strong> -&gt; <strong>Lun mapping</strong> -&gt; <strong>Add…</strong>      ,   . </p><br>
<p>   ,    :</p><br>
<p><img src="https://habrastorage.org/webt/db/a-/xq/dba-xqbacgrjxrutupvhvmua7ro.png"></p><br>
<p>      ,      ,       LUN'   FC HBA.<br>
      :</p><br>
<pre><code class="plaintext hljs">ls -la /sys/class/scsi_host/<font></font>
echo "- - -" &gt; /sys/class/scsi_host/host[0-9]/scan</code></pre><br>
<div class="spoiler"><b class="spoiler_title">,      :</b><div class="spoiler_text"><pre><code class="plaintext hljs">cat /proc/scsi/scsi<font></font>
Attached devices:<font></font>
Host: scsi0 Channel: 02 Id: 00 Lun: 00<font></font>
  Vendor: DELL     Model: PERC H330 Mini   Rev: 4.29<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi15 Channel: 00 Id: 00 Lun: 00<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi15 Channel: 00 Id: 00 Lun: 01<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi15 Channel: 00 Id: 00 Lun: 04<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi15 Channel: 00 Id: 00 Lun: 11<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi15 Channel: 00 Id: 00 Lun: 31<font></font>
  Vendor: DELL     Model: Universal Xport  Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi18 Channel: 00 Id: 00 Lun: 00<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi18 Channel: 00 Id: 00 Lun: 01<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi18 Channel: 00 Id: 00 Lun: 04<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi18 Channel: 00 Id: 00 Lun: 11<font></font>
  Vendor: DELL     Model: MD38xxf          Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
Host: scsi18 Channel: 00 Id: 00 Lun: 31<font></font>
  Vendor: DELL     Model: Universal Xport  Rev: 0825<font></font>
  Type:   Direct-Access                    ANSI  SCSI revision: 05<font></font>
<font></font>
lsscsi<font></font>
[0:2:0:0]    disk    DELL     PERC H330 Mini   4.29  /dev/sda<font></font>
[15:0:0:0]   disk    DELL     MD38xxf          0825  -<font></font>
[15:0:0:1]   disk    DELL     MD38xxf          0825  /dev/sdb<font></font>
[15:0:0:4]   disk    DELL     MD38xxf          0825  /dev/sdc<font></font>
[15:0:0:11]  disk    DELL     MD38xxf          0825  /dev/sdd<font></font>
[15:0:0:31]  disk    DELL     Universal Xport  0825  -<font></font>
 [18:0:0:0]   disk    DELL     MD38xxf          0825  -<font></font>
[18:0:0:1]   disk    DELL     MD38xxf          0825  /dev/sdi<font></font>
[18:0:0:4]   disk    DELL     MD38xxf          0825  /dev/sdj<font></font>
[18:0:0:11]  disk    DELL     MD38xxf          0825  /dev/sdk<font></font>
[18:0:0:31]  disk    DELL     Universal Xport  0825  -</code></pre></div></div><br>
<p>      <strong>multipath</strong>,     oVirt      ,      MP  .</p><br>
<p><u>   DM Multipath</u></p><br>
<pre><code class="plaintext hljs">yum install device-mapper-multipath<font></font>
mpathconf --enable --user_friendly_names y<font></font>
<font></font>
cat /etc/multipath.conf | egrep -v "^\s*(#|$)"<font></font>
defaults {<font></font>
    user_friendly_names yes<font></font>
            find_multipaths yes<font></font>
}<font></font>
<font></font>
blacklist {<font></font>
  wwid 26353900f02796769<font></font>
  devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"     <font></font>
  devnode "^hd[a-z]"<font></font>
 }</code></pre><br>
<p>  MP     :</p><br>
<pre><code class="plaintext hljs">systemctl enable multipathd &amp;&amp; systemctl restart multipathd</code></pre><br>
<div class="spoiler"><b class="spoiler_title">       MP:</b><div class="spoiler_text"><pre><code class="plaintext hljs">lsmod | grep dm_multipath<font></font>
dm_multipath           27792  6 dm_service_time<font></font>
dm_mod                124407  139 dm_multipath,dm_log,dm_mirror<font></font>
<font></font>
modinfo dm_multipath<font></font>
filename:       /lib/modules/3.10.0-957.12.2.el7.x86_64/kernel/drivers/md/dm-multipath.ko.xz<font></font>
license:        GPL<font></font>
author:         Sistina Software &lt;dm-devel@redhat.com&gt;<font></font>
description:    device-mapper multipath target<font></font>
retpoline:      Y<font></font>
rhelversion:    7.6<font></font>
srcversion:     985A03DCAF053D4910E53EE<font></font>
depends:        dm-mod<font></font>
intree:         Y<font></font>
vermagic:       3.10.0-957.12.2.el7.x86_64 SMP mod_unload modversions<font></font>
signer:         CentOS Linux kernel signing key<font></font>
sig_key:        A3:2D:39:46:F2:D3:58:EA:52:30:1F:63:37:8A:37:A5:54:03:00:45<font></font>
sig_hashalgo:   sha256</code></pre></div></div><br>
<p>      multipath:</p><br>
<pre><code class="plaintext hljs">mpathconf<font></font>
multipath is enabled<font></font>
find_multipaths is disabled<font></font>
user_friendly_names is disabled<font></font>
dm_multipath module is loaded<font></font>
multipathd is running</code></pre><br>
<p>   LUN      ,         HBA. </p><br>
<pre><code class="plaintext hljs">systemctl reload multipathd<font></font>
multipath -v2</code></pre><br>
<p>  , ,   LUN'      ,       .</p><br>
<div class="spoiler"><b class="spoiler_title">  MP:</b><div class="spoiler_text"><pre><code class="plaintext hljs">multipath -ll<font></font>
3600a098000e4b4b3000003175cec1840 dm-2 DELL    ,MD38xxf<font></font>
size=2.0T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw<font></font>
|-+- policy='service-time 0' prio=14 status=active<font></font>
| `- 15:0:0:1  sdb 8:16  active ready running<font></font>
`-+- policy='service-time 0' prio=9 status=enabled<font></font>
  `- 18:0:0:1  sdi 8:128 active ready running<font></font>
3600a098000e4b48f000002ab5cec1921 dm-6 DELL    ,MD38xxf<font></font>
size=10T features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw<font></font>
|-+- policy='service-time 0' prio=14 status=active<font></font>
| `- 18:0:0:11 sdk 8:160 active ready running<font></font>
`-+- policy='service-time 0' prio=9 status=enabled<font></font>
  `- 15:0:0:11 sdd 8:48  active ready running<font></font>
3600a098000e4b4b3000003c95d171065 dm-3 DELL    ,MD38xxf<font></font>
size=150G features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw<font></font>
|-+- policy='service-time 0' prio=14 status=active<font></font>
| `- 15:0:0:4  sdc 8:32  active ready running<font></font>
`-+- policy='service-time 0' prio=9 status=enabled<font></font>
  `- 18:0:0:4  sdj 8:144 active ready running</code></pre></div></div><br>
<p> ,          .      ,         –   oVirt,      .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483960/index.html">ブラッド・テンプルトン：自動運転車産業の2019年の結果</a></li>
<li><a href="../ja483964/index.html">JSONや最初のAPIアプリケーションを恐れないでください</a></li>
<li><a href="../ja483972/index.html">Quoraを使用してビジネスを宣伝する方法</a></li>
<li><a href="../ja483974/index.html">iSCSI経由のCeph-またはハンモックに立っている間スキー</a></li>
<li><a href="../ja483976/index.html">2020年のサイバーセキュリティと脅威：休暇後に私たちを待ち受けるもの</a></li>
<li><a href="../ja483986/index.html">Emotiv Insightによるロボット思考の制御</a></li>
<li><a href="../ja483988/index.html">MicroSPA、または四角いホイールを発明する方法</a></li>
<li><a href="../ja483992/index.html">なぜいくつかの惑星は彼らの空を食べるのですか</a></li>
<li><a href="../ja483994/index.html">ヨットでのIT移転。スウェーデンからスペインへ</a></li>
<li><a href="../ja484004/index.html">@Pythonetc 2019年12月</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>