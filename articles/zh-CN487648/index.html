<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷🏻 🔺 👠 它可能是另一个javascript框架。 😌 😖 🙆🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="去年夏天，在为Habr 编写文章的过程中，我不太懒惰将我的后端应用程序模板打包到npm包中的Node.js上，使其成为快速入门的cli-utility。
 

除我之外，没有其他人会最初使用此软件包。但是，当我决定通过引入所需的功能来更新模板时，我注意到npm软件包每周有几十个下载，而github上...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>它可能是另一个javascript框架。</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487648/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">去年夏天，在</font><font style="vertical-align: inherit;">为Habr </font><font style="vertical-align: inherit;">编写</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的过程中</font><font style="vertical-align: inherit;">，我不太懒惰将我的后端应用程序模板打包到npm包中的Node.js上，使其成为快速入门的cli-utility。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除我之外，没有其他人会最初使用此软件包。</font><font style="vertical-align: inherit;">但是，当我决定通过引入所需的功能来更新模板时，我注意到npm软件包每周有几十个下载，而github上的项目有12个星级。</font><font style="vertical-align: inherit;">好的人肯定会给予我支持，而不是为了这个项目。</font><font style="vertical-align: inherit;">只有12颗星，但这足以让我决定我要开发卡尔卡斯，似乎不仅对我来说是必要的。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管最初我决定为后端应用程序创建一个轻量级框架，但在开发过程中，我还是使自己确信不需要这辆自行车。</font><font style="vertical-align: inherit;">那个“ karcass”不应该是一个框架，而应该是一个从模板创建应用程序的通用工具。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/8z/z7/w-/8zz7w-6mc0gxiotwj-bbz3uuete.jpeg" alt="图片"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个版本中，气候脚本的逻辑是原始的。</font></font></p><br>
<ol>
<li>  .</li>
<li>karcass      template      .</li>
<li>       ,      ( - ,  )    (     ).</li>
<li>  ,   <code>npm install</code>.</li>
</ol><br>
<p>     :</p><br>
<p><img src="https://habrastorage.org/webt/rk/uz/8f/rkuz8fkc3bpzr4dksqgerrganjo.gif" alt="图片"></p><br>
<p>            .    , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"> </a>.</p><br>
<p>      ,    :  Application  ,    ,    .           , :</p><br>
<div class="spoiler"><b class="spoiler_title">Application.ts</b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> Express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> { AbstractConsoleCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Base/Console/AbstractConsoleCommand'</span>
<span class="hljs-keyword">import</span> { DbService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Database/Service/DbService'</span>
<span class="hljs-keyword">import</span> { HelpCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Base/Console/HelpCommand'</span>
<span class="hljs-keyword">import</span> { LoggerService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Logger/Service/LoggerService'</span>
<span class="hljs-keyword">import</span> { IssueService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Project/Service/IssueService'</span>
<span class="hljs-keyword">import</span> { GitlabService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Gitlab/Service/GitlabService'</span>
<span class="hljs-keyword">import</span> { LocalCacheService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Base/Service/LocalCacheService'</span>
<span class="hljs-keyword">import</span> { ProjectService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Project/Service/ProjectService'</span>
<span class="hljs-keyword">import</span> { GroupService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Project/Service/GroupService'</span>
<span class="hljs-keyword">import</span> { UserService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./User/Service/UserService'</span>
<span class="hljs-keyword">import</span> { UpdateProjectsCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Gitlab/Console/UpdateProjectsCommand'</span>
<span class="hljs-keyword">import</span> { CreateMigrationCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Database/Console/CreateMigrationCommand'</span>
<span class="hljs-keyword">import</span> { MigrateCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Database/Console/MigrateCommand'</span>
<span class="hljs-keyword">import</span> { MigrateUndoCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Database/Console/MigrateUndoCommand'</span>
<span class="hljs-keyword">import</span> IssueController <span class="hljs-keyword">from</span> <span class="hljs-string">'./Project/Controller/IssueController'</span>
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<font></font>
    public http!: Express.Express<font></font>
<font></font>
    <span class="hljs-comment">// Services</span><font></font>
    public localCacheService!: LocalCacheService<font></font>
    public loggerService!: LoggerService<font></font>
    public dbService!: DbService<font></font>
    public gitlabService!: GitlabService<font></font>
    public issueService!: IssueService<font></font>
    public projectService!: ProjectService<font></font>
    public groupService!: GroupService<font></font>
    public userService!: UserService<font></font>
<font></font>
    <span class="hljs-comment">// Commands</span><font></font>
    public helpCommand!: HelpCommand<font></font>
    public createMigrationCommand!: CreateMigrationCommand<font></font>
    public migrateCommand!: MigrateCommand<font></font>
    public migrateUndoCommand!: MigrateUndoCommand<font></font>
    public updateProjectsCommand!: UpdateProjectsCommand<font></font>
<font></font>
    <span class="hljs-comment">// Controllers</span><font></font>
    public issueController!: IssueController<font></font>
<font></font>
    public <span class="hljs-keyword">constructor</span>(public readonly config: IConfig) {
        <span class="hljs-keyword">if</span> (config.columns.length &lt; <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'There are too few columns :-('</span>)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> run() {
        <span class="hljs-keyword">this</span>.initializeServices()
        <span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">2</span>]) {
            <span class="hljs-keyword">this</span>.initializeCommands()
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> command <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.values(<span class="hljs-keyword">this</span>)<font></font>
                .filter(<span class="hljs-function">(<span class="hljs-params">c: any</span>) =&gt;</span> c <span class="hljs-keyword">instanceof</span> AbstractConsoleCommand) <span class="hljs-keyword">as</span> AbstractConsoleCommand[]<font></font>
            ) {<font></font>
                <span class="hljs-keyword">if</span> (command.name === process.argv[<span class="hljs-number">2</span>]) {
                    <span class="hljs-keyword">await</span> command.execute()<font></font>
                    process.exit()<font></font>
                }<font></font>
            }<font></font>
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.helpCommand.execute()<font></font>
            process.exit()<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.runWebServer()<font></font>
        }<font></font>
    }<font></font>
<font></font>
    protected runWebServer() {<font></font>
        <span class="hljs-keyword">this</span>.initCron()
        <span class="hljs-keyword">this</span>.http = Express()
        <span class="hljs-keyword">this</span>.http.use(<span class="hljs-string">'/'</span>, Express.static(<span class="hljs-string">'vue/dist'</span>))
        <span class="hljs-keyword">this</span>.http.use(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (req.url.indexOf(<span class="hljs-string">'/api'</span>) === <span class="hljs-number">-1</span>) {<font></font>
                res.header(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'private, no-cache, no-store, must-revalidate'</span>)<font></font>
                res.header(<span class="hljs-string">'Expires'</span>, <span class="hljs-string">'-1'</span>)<font></font>
                res.header(<span class="hljs-string">'Pragma'</span>, <span class="hljs-string">'no-cache'</span>)
                <span class="hljs-keyword">return</span> res.send(fs.readFileSync(<span class="hljs-string">'vue/dist/index.html'</span>).toString())<font></font>
            }<font></font>
            next()<font></font>
        })<font></font>
        <span class="hljs-keyword">this</span>.http.use(Express.urlencoded())
        <span class="hljs-keyword">this</span>.http.use(Express.json())
        <span class="hljs-keyword">this</span>.http.listen(<span class="hljs-keyword">this</span>.config.listen, () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Listening on port <span class="hljs-subst">${<span class="hljs-keyword">this</span>.config.listen}</span>`</span>))<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.initializeControllers()<font></font>
    }<font></font>
<font></font>
    protected initCron() {<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.config.gitlab.updateInterval) {<font></font>
            setInterval(<span class="hljs-keyword">async</span> () =&gt; {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.updateProjectsCommand) {
                    <span class="hljs-keyword">this</span>.updateProjectsCommand = <span class="hljs-keyword">new</span> UpdateProjectsCommand(<span class="hljs-keyword">this</span>)<font></font>
                }<font></font>
                <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.updateProjectsCommand.execute()<font></font>
            }, <span class="hljs-keyword">this</span>.config.gitlab.updateInterval * <span class="hljs-number">1000</span>)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    protected initializeServices() {<font></font>
        <span class="hljs-keyword">this</span>.localCacheService = <span class="hljs-keyword">new</span> LocalCacheService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.gitlabService = <span class="hljs-keyword">new</span> GitlabService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.loggerService = <span class="hljs-keyword">new</span> LoggerService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.dbService = <span class="hljs-keyword">new</span> DbService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.issueService = <span class="hljs-keyword">new</span> IssueService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.projectService = <span class="hljs-keyword">new</span> ProjectService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.groupService = <span class="hljs-keyword">new</span> GroupService(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.userService = <span class="hljs-keyword">new</span> UserService(<span class="hljs-keyword">this</span>)<font></font>
    }<font></font>
<font></font>
    protected initializeCommands() {<font></font>
        <span class="hljs-keyword">this</span>.helpCommand = <span class="hljs-keyword">new</span> HelpCommand(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.createMigrationCommand = <span class="hljs-keyword">new</span> CreateMigrationCommand(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.migrateCommand = <span class="hljs-keyword">new</span> MigrateCommand(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.migrateUndoCommand = <span class="hljs-keyword">new</span> MigrateUndoCommand(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">this</span>.updateProjectsCommand = <span class="hljs-keyword">new</span> UpdateProjectsCommand(<span class="hljs-keyword">this</span>)<font></font>
    }<font></font>
<font></font>
    protected initializeControllers() {<font></font>
        <span class="hljs-keyword">this</span>.issueController = <span class="hljs-keyword">new</span> IssueController(<span class="hljs-keyword">this</span>)<font></font>
    }<font></font>
<font></font>
}</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">ProjectService.ts</b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { AbstractService } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../Base/Service/AbstractService'</span>
<span class="hljs-keyword">import</span> { Project } <span class="hljs-keyword">from</span> <span class="hljs-string">'../Entity/Project'</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProjectService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractService</span> </span>{<font></font>
<font></font>
    public <span class="hljs-keyword">get</span> <span class="hljs-title">projectRepository</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.app.dbService.connection.getRepository(Project)<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> updateProjects(allTime = <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.groupService.updateGroups()
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> data <span class="hljs-keyword">of</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.gitlabService.getProjects()) {
            <span class="hljs-keyword">let</span> project = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.getProject(data.id)<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!project) {<font></font>
                project = <span class="hljs-keyword">this</span>.projectRepository.create({ <span class="hljs-attr">id</span>: data.id })<font></font>
            }<font></font>
            project.name = data.name<font></font>
            project.url = data.web_url<font></font>
            project.updatedTimestamp = <span class="hljs-built_in">Math</span>.round(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(data.last_activity_at).getTime() / <span class="hljs-number">1000</span>)<font></font>
            project.groupId = data.namespace &amp;&amp; data.namespace.kind === <span class="hljs-string">'group'</span> ? data.namespace.id : <span class="hljs-literal">null</span>
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.projectRepository.save(project)
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.issueService.updateProjectIssues(project, allTime)<font></font>
        }<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> getProject(id: number): <span class="hljs-built_in">Promise</span>&lt;Project|<span class="hljs-literal">undefined</span>&gt; {
        <span class="hljs-keyword">return</span> id ? <span class="hljs-keyword">this</span>.app.localCacheService.get(<span class="hljs-string">`project.<span class="hljs-subst">${id}</span>`</span>, () =&gt; <span class="hljs-keyword">this</span>.projectRepository.findOne(id)) : <span class="hljs-literal">undefined</span><font></font>
    }<font></font>
<font></font>
}</code></pre></div></div><br>
<p>,    ,        ,       .       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">DI-</a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">    cli</a>.</p><br>
<p>  <code>Application.ts</code>  ,        « ».             .</p><br>
<div class="spoiler"><b class="spoiler_title">Application.ts</b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> CreateExpress, { Express } <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> { TwingEnvironment, TwingLoaderFilesystem } <span class="hljs-keyword">from</span> <span class="hljs-string">'twing'</span>;
<span class="hljs-keyword">import</span> { Container } <span class="hljs-keyword">from</span> <span class="hljs-string">'@karcass/container'</span>;
<span class="hljs-keyword">import</span> { Cli } <span class="hljs-keyword">from</span> <span class="hljs-string">'@karcass/cli'</span>;
<span class="hljs-keyword">import</span> { Connection, createConnection } <span class="hljs-keyword">from</span> <span class="hljs-string">'typeorm'</span>;
<span class="hljs-keyword">import</span> { CreateMigrationCommand, MigrateCommand, MigrateUndoCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'@karcass/migration-commands'</span>;
<span class="hljs-keyword">import</span> { createLogger } <span class="hljs-keyword">from</span> <span class="hljs-string">'./routines/createLogger'</span>;
<span class="hljs-keyword">import</span> { Logger } <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>;
<span class="hljs-keyword">import</span> { FrontPageController } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SampleBundle/Controller/FrontPageController'</span>;
<span class="hljs-keyword">import</span> { Message } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SampleBundle/Entity/Message'</span>;
<span class="hljs-keyword">import</span> { MessagesService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SampleBundle/Service/MessagesService'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{<font></font>
    private container = <span class="hljs-keyword">new</span> Container();<font></font>
    private <span class="hljs-built_in">console</span> = <span class="hljs-keyword">new</span> Cli();<font></font>
    private controllers: object[] = [];<font></font>
    private http!: Express;<font></font>
<font></font>
    public <span class="hljs-keyword">constructor</span>(public readonly config: IConfig) { }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> run() {
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.initializeServices();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">2</span>]) {
            <span class="hljs-keyword">this</span>.initializeCommands();
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.console.run();<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.runWebServer();<font></font>
        }<font></font>
    }<font></font>
<font></font>
    protected runWebServer() {<font></font>
        <span class="hljs-keyword">this</span>.http = CreateExpress();
        <span class="hljs-keyword">this</span>.http.use(<span class="hljs-string">'/public'</span>, CreateExpress.static(<span class="hljs-string">'public'</span>));
        <span class="hljs-keyword">this</span>.http.use(CreateExpress.urlencoded());
        <span class="hljs-keyword">this</span>.http.listen(<span class="hljs-keyword">this</span>.config.listen, () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Listening on port <span class="hljs-subst">${<span class="hljs-keyword">this</span>.config.listen}</span>`</span>));<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.container.add&lt;Express&gt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">'express'</span>, (</span>) =&gt;</span> <span class="hljs-keyword">this</span>.http);
        <span class="hljs-keyword">this</span>.container.add(TwingEnvironment, () =&gt; <span class="hljs-keyword">new</span> TwingEnvironment(<span class="hljs-keyword">new</span> TwingLoaderFilesystem(<span class="hljs-string">'src'</span>)));<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.initializeControllers();<font></font>
    }<font></font>
<font></font>
    protected <span class="hljs-keyword">async</span> initializeServices() {
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.addInplace&lt;Logger&gt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">'logger'</span>, (</span>) =&gt;</span> createLogger(<span class="hljs-keyword">this</span>.config.logdir));
        <span class="hljs-keyword">const</span> typeorm = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.addInplace(Connection, () =&gt; createConnection({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'sqlite'</span>,
            <span class="hljs-attr">database</span>: <span class="hljs-string">'db/sample.sqlite'</span>,
            <span class="hljs-attr">entities</span>: [<span class="hljs-string">'build/**/Entity/*.js'</span>],
            <span class="hljs-attr">migrations</span>: [<span class="hljs-string">'build/**/Migrations/*.js'</span>],
            <span class="hljs-attr">logging</span>: [<span class="hljs-string">'error'</span>, <span class="hljs-string">'warn'</span>, <span class="hljs-string">'migration'</span>],<font></font>
        }));<font></font>
        <span class="hljs-keyword">this</span>.container.add(<span class="hljs-string">'Repository&lt;Message&gt;'</span>, () =&gt; typeorm.getRepository(Message));
        <span class="hljs-keyword">this</span>.container.add(MessagesService);<font></font>
    }<font></font>
<font></font>
    protected initializeCommands() {<font></font>
        <span class="hljs-keyword">this</span>.console.add(CreateMigrationCommand, () =&gt; <span class="hljs-keyword">new</span> CreateMigrationCommand());
        <span class="hljs-keyword">this</span>.console.add(MigrateCommand, <span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">new</span> MigrateCommand(<span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.get(Connection)));
        <span class="hljs-keyword">this</span>.console.add(MigrateUndoCommand, <span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">new</span> MigrateUndoCommand(<span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.get(Connection)));<font></font>
    }<font></font>
<font></font>
    protected <span class="hljs-keyword">async</span> initializeControllers() {
        <span class="hljs-keyword">this</span>.controllers.push(
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.inject(FrontPageController),<font></font>
        );<font></font>
    }<font></font>
<font></font>
}</code></pre></div></div><br>
<p> TypeScript      :</p><br>
<div class="spoiler"><b class="spoiler_title">FrontPageController.ts</b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Express } <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> { Dependency } <span class="hljs-keyword">from</span> <span class="hljs-string">'@karcass/container'</span>;
<span class="hljs-keyword">import</span> { TwingEnvironment } <span class="hljs-keyword">from</span> <span class="hljs-string">'twing'</span>;
<span class="hljs-keyword">import</span> { AbstractController, QueryData } <span class="hljs-keyword">from</span> <span class="hljs-string">'./AbstractController'</span>;
<span class="hljs-keyword">import</span> { MessagesService } <span class="hljs-keyword">from</span> <span class="hljs-string">'../Service/MessagesService'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FrontPageController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span> </span>{<font></font>
<font></font>
    public <span class="hljs-keyword">constructor</span>(<font></font>
        @Dependency('express') protected express: Express,<font></font>
        @Dependency(TwingEnvironment) protected twing: TwingEnvironment,<font></font>
        @Dependency(MessagesService) protected messagesService: MessagesService,<font></font>
    ) {<font></font>
        <span class="hljs-keyword">super</span>(express);<font></font>
<font></font>
        <span class="hljs-keyword">this</span>.onQuery(<span class="hljs-string">'/'</span>, <span class="hljs-string">'get'</span>, <span class="hljs-keyword">this</span>.frontPageAction);
        <span class="hljs-keyword">this</span>.onQuery(<span class="hljs-string">'/'</span>, <span class="hljs-string">'post'</span>, <span class="hljs-keyword">this</span>.sendMessageAction);<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> sendMessageAction(data: QueryData) {
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.messagesService.addMessage(data.params.text);<font></font>
        data.res.redirect(<span class="hljs-string">'/'</span>);<font></font>
    }<font></font>
<font></font>
    public <span class="hljs-keyword">async</span> frontPageAction() {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.messagesService.isEmpty()) {
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.messagesService.createSampleMessages();<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.twing.render(<span class="hljs-string">'SampleBundle/Views/front.twig'</span>, {
            <span class="hljs-attr">messages</span>: <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.messagesService.getMessages(),<font></font>
        });<font></font>
    }<font></font>
<font></font>
}</code></pre></div></div><br>
<p>   JavaScript,    «»:</p><br>
<pre><code class="javascript hljs">protected <span class="hljs-keyword">async</span> initializeControllers() {
    <span class="hljs-keyword">this</span>.controllers.push(
        <span class="hljs-keyword">new</span> FrontPageController(
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.get(<span class="hljs-string">'express'</span>),
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.get(TwingEnvironment),
            <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.container.get(MessagesService),<font></font>
        ),<font></font>
    );<font></font>
}</code></pre><br>
<p>      <code>template</code>  karcass,         :      . ,          . </p><br>
<p>          :        <code>TemplateReducer.ts</code>  <code>TemplateReducer.js</code>,     <code>TemplateReducer</code>,   :</p><br>
<pre><code class="javascript hljs">interface TemplateReducerInterface {<font></font>
    getConfigParameters(): <span class="hljs-built_in">Promise</span>&lt;ConfigParametersResult&gt;<font></font>
    getConfig(): Record&lt;string, any&gt;<font></font>
    setConfig(config: Record&lt;string, any&gt;): <span class="hljs-keyword">void</span>
    getDirectoriesForRemove(): <span class="hljs-built_in">Promise</span>&lt;string[]&gt;<font></font>
    getFilesForRemove(): <span class="hljs-built_in">Promise</span>&lt;string[]&gt;<font></font>
    getDependenciesForRemove(): <span class="hljs-built_in">Promise</span>&lt;string[]&gt;<font></font>
    getFilesContentReplacers(): <span class="hljs-built_in">Promise</span>&lt;ReplaceFileContentItem[]&gt;<font></font>
    finish(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;<font></font>
    getTestConfigSet(): <span class="hljs-built_in">Promise</span>&lt;Record&lt;string, any&gt;[]&gt;<font></font>
}</code></pre><br>
<p>   , , ,       -  ,  karcass       ,             JavaScript/TypeScript.     -. -            webpack. , -      <code>create-react-app</code> <s> ...</s>     ,   <code>vue create</code>.</p><br>
<p>      <code>TemplateReducerInterface</code>,  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>  .           karcass:</p><br>
<p>   <code>hello</code>   <code>index.js</code>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello, [replacethisname]!'</span>)</code></pre><br>
<p>     <code>TemplateReducer.js</code>,   karcass'          :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> reducer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@karcass/template-reducer'</span>)
<span class="hljs-keyword">const</span> Type = reducer.ConfigParameterType<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TemplateReducer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">reducer</span>.<span class="hljs-title">AbstractTemplateReducer</span> </span>{<font></font>
    getConfigParameters() {<font></font>
        <span class="hljs-keyword">return</span> [<font></font>
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'Please enter your name'</span>, <span class="hljs-attr">type</span>: Type.string },<font></font>
        ]<font></font>
    }<font></font>
    <span class="hljs-keyword">async</span> getFilesContentReplacers() {
        <span class="hljs-keyword">return</span> [<font></font>
            { <span class="hljs-attr">filename</span>: <span class="hljs-string">'index.js'</span>, <span class="hljs-attr">replacer</span>: <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> {
                <span class="hljs-keyword">return</span> content.replace(<span class="hljs-string">'[replacethisname]'</span>, <span class="hljs-keyword">this</span>.config.name)<font></font>
            } },<font></font>
        ]<font></font>
    }<font></font>
    <span class="hljs-keyword">async</span> finish() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Application installed, to launch it execute\n  cd <span class="hljs-subst">${<span class="hljs-keyword">this</span>.directoryName}</span> &amp;&amp; node index.js`</span>)it.<span class="hljs-string">`)
    }
}
module.exports = { TemplateReducer }</span></code></pre><br>
<p>  ,    ,  ,   — <code>@karcass/template-reducer</code>,     ,    <code>package.json</code>:</p><br>
<pre><code class="bash hljs">npm init &amp;&amp; npm install @karcass/template-reducer</code></pre><br>
<p>    ,       <code>getDependenciesForRemove</code>,  karcass  .</p><br>
<p>    karcass       .       ,          .</p><br>
<p><img src="https://habrastorage.org/webt/qz/qh/vr/qzqhvrhktoayi9xaym0lvssbx94.gif" alt="图片"></p><br>
<p>    ,        karcass       .    github.com,  :</p><br>
<pre><code class="bash hljs">npx karcass create helloworld https://github.com/karcass-ts/hello-world</code></pre><br>
<p>      ,   -,      :</p><br>
<pre><code class="bash hljs">npx karcass create ooohhhh-ok-show-it</code></pre><br>
<p>?         ,  <code>TemplateReducer</code>  helloworld-      :</p><br>
<pre><code class="javascript hljs">    getTestConfigSet() {
        <span class="hljs-keyword">return</span> [<font></font>
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'testname1'</span> },<font></font>
            { <span class="hljs-attr">name</span>: <span class="hljs-string">'testname2'</span> },<font></font>
        ]<font></font>
    }</code></pre><br>
<p>   :</p><br>
<pre><code class="bash hljs">npx karcass <span class="hljs-built_in">test</span> www/karcass/hello</code></pre><br>
<p>  —        . ,      ,   , :</p><br>
<p><img src="https://habrastorage.org/webt/jw/k2/ho/jwk2hobgtfuf9i-gokqmgcr_5ko.gif" alt="图片"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我决定不对karcass的所有功能进行描述，而只是做一个小的事实调查记录，以进行介绍和收集反馈：任何反馈对我来说都是有用的，以了解下一步该做什么以及是否值得。</font><font style="vertical-align: inherit;">同时，编写文档是优先事项。</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github上的Karcass存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></p></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN487636/index.html">最终值得从Java 8升级的API。第2部分</a></li>
<li><a href="../zh-CN487638/index.html">HighLoad ++，Mikhail Tyulenev（MongoDB）：因果一致性：从理论到实践</a></li>
<li><a href="../zh-CN487640/index.html">游戏自动化测试</a></li>
<li><a href="../zh-CN487644/index.html">使用Python获取股票报价</a></li>
<li><a href="../zh-CN487646/index.html">试管中子星。声致发光</a></li>
<li><a href="../zh-CN487650/index.html">希望SDK不会出错：BottomSheetBehavior中的嵌套滚动问题</a></li>
<li><a href="../zh-CN487654/index.html">关系数据库如何工作（第1部分）</a></li>
<li><a href="../zh-CN487656/index.html">＃332移动开发人员的有趣材料摘要（2月3日至9日）</a></li>
<li><a href="../zh-CN487660/index.html">Android机器学习</a></li>
<li><a href="../zh-CN487662/index.html">FOSS新闻2-2020年2月3日至9日免费和开源新闻的回顾</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>