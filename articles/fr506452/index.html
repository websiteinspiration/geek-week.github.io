<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìù ü§ì üê´ Comment prot√©ger votre site public avec ESNI üßëüèº‚Äçü§ù‚Äçüßëüèº üíáüèº üéÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Habr, je m'appelle Ilya, je travaille dans l'√©quipe de la plateforme Exness. Nous d√©veloppons et impl√©mentons des composants d'infrastructure de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment prot√©ger votre site public avec ESNI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/506452/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salut Habr, je m'appelle Ilya, je travaille dans l'√©quipe de la plateforme Exness. </font><font style="vertical-align: inherit;">Nous d√©veloppons et impl√©mentons des composants d'infrastructure de base qui utilisent nos √©quipes de d√©veloppement de produits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je voudrais partager l'exp√©rience de la mise en ≈ìuvre de la technologie SNI crypt√©e (ESNI) dans l'infrastructure des sites Web publics.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/3v/bq/my3vbqy87t_ep9l7wnjzsghs9oo.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de cette technologie augmentera le niveau de s√©curit√© lors de l'utilisation d'un site Web public et respectera les normes de s√©curit√© internes adopt√©es par la Soci√©t√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je veux faire attention au fait que la technologie n'est pas standardis√©e et est toujours en projet, mais CloudFlare et Mozilla la supportent d√©j√† (en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">draft01</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Cela nous a motiv√©s √† une telle exp√©rience.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de th√©orie</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESNI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une extension du protocole TLS 1.3 qui vous permet de crypter SNI dans un message de n√©gociation TLS ¬´Client Hello¬ª. </font><font style="vertical-align: inherit;">Voici √† quoi ressemble Client Hello avec le support ESNI (au lieu du SNI habituel, nous voyons ESNI): </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/74d/efd/449/74defd4491b50c470ee3b81651edfb62.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;Pour utiliser ESNI, vous avez besoin de trois choses:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS&nbsp;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service client</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge c√¥t√© serveur.</font></font><br>
</li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est n√©cessaire d'ajouter deux enregistrements DNS - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TXT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (l'enregistrement TXT contient une cl√© publique avec laquelle le client peut crypter SNI) - voir ci-dessous. </font><font style="vertical-align: inherit;">De plus, il devrait y avoir une prise en charge </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DoH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (DNS sur HTTPS), car les clients disponibles (voir ci-dessous) n'activent pas la prise en charge ESNI sans DoH. </font><font style="vertical-align: inherit;">C'est logique, car ESNI implique le cryptage du nom de la ressource √† laquelle nous acc√©dons, c'est-√†-dire qu'il n'a aucun sens d'acc√©der au DNS via UDP. </font><font style="vertical-align: inherit;">De plus, l'utilisation de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prot√®ge contre les attaques d'empoisonnement du cache dans ce sc√©nario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actuellement, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs fournisseurs DoH sont disponibles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , parmi eux:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://developers.cloudflare.com/1.1.1.1/dns-over-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudflare</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opendns</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CloudFlare </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clare</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (V√©rifier mon navigateur ‚Üí SNI crypt√© ‚Üí En savoir plus) que leurs serveurs prennent d√©sormais en charge ESNI, c'est-√†-dire que pour les serveurs CloudFlare dans DNS, nous avons au moins deux enregistrements - A et TXT. </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessous, nous demandons Google DNS (via HTTPS):&nbsp; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enregistrement:</font></font><br>
<br>
<pre><code class="plaintext hljs">curl 'https://dns.google.com/resolve?name=www.cloudflare.com&amp;type=A' \<font></font>
-s -H 'accept: application/dns+json'<font></font>
{<font></font>
&nbsp; "Status": 0,<font></font>
&nbsp; "TC": false,<font></font>
&nbsp; "RD": true,<font></font>
&nbsp; "RA": true,<font></font>
&nbsp; "AD": true,<font></font>
&nbsp; "CD": false,<font></font>
&nbsp; "Question": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Answer": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1,<font></font>
&nbsp; &nbsp; &nbsp; "TTL": 257,<font></font>
&nbsp; &nbsp; &nbsp; "data": "104.17.210.9"<font></font>
&nbsp; &nbsp; },<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1,<font></font>
&nbsp; &nbsp; &nbsp; "TTL": 257,<font></font>
&nbsp; &nbsp; &nbsp; "data": "104.17.209.9"<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ]<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrement </font><b><font style="vertical-align: inherit;">TXT</font></b><font style="vertical-align: inherit;"> , la demande est g√©n√©r√©e par le mod√®le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_esni.FQDN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">curl 'https://dns.google.com/resolve?name=_esni.www.cloudflare.com&amp;type=TXT' \<font></font>
-s -H 'accept: application/dns+json'<font></font>
{<font></font>
&nbsp; "Status": 0,<font></font>
&nbsp; "TC": false,<font></font>
&nbsp; "RD": true,<font></font>
&nbsp; "RA": true,<font></font>
&nbsp; "AD": true,<font></font>
&nbsp; "CD": false,<font></font>
&nbsp; "Question": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; "name": "_esni.www.cloudflare.com.",<font></font>
&nbsp; &nbsp; "type": 16<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Answer": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; "name": "_esni.www.cloudflare.com.",<font></font>
&nbsp; &nbsp; "type": 16,<font></font>
&nbsp; &nbsp; "TTL": 1799,<font></font>
&nbsp; &nbsp; "data": "\"/wEUgUKlACQAHQAg9SiAYQ9aUseUZr47HYHvF5jkt3aZ5802eAMJPhRz1QgAAhMBAQQAAAAAXtUmAAAAAABe3Q8AAAA=\""<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Comment": "Response from 2400:cb00:2049:1::a29f:209."<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, en termes de DNS, nous devons utiliser DoH (de pr√©f√©rence avec DNSSEC) et ajouter deux entr√©es.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service client</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous parlons de navigateurs, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support n'est pour</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'instant </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">impl√©ment√© que dans FireFox</font></a><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comment activer la prise en charge ESNI et DoH dans FireFox. </font><font style="vertical-align: inherit;">Une fois le navigateur configur√©, nous devrions voir quelque chose comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f06/6ef/b4c/f066efb4ce235c0abf798652123b1a13.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour v√©rifier le navigateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, TLS 1.3 doit √™tre utilis√© pour prendre en charge ESNI, car ESNI est une extension de TLS 1.3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester le back - </font><font style="vertical-align: inherit;">end avec le </font><font style="vertical-align: inherit;">soutien ESNI, nous avons mis le client sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais plus sur cela plus tard.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge c√¥t√© serveur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESNI n'est actuellement pas pris en charge par les serveurs Web tels que nginx / apache, etc., car ils fonctionnent avec TLS via OpenSSL / BoringSSL, dans lequel ESNI n'est pas officiellement pris en charge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous avons d√©cid√© de cr√©er notre propre composant frontal (proxy inverse ESNI), qui prendrait en charge la terminaison de TLS 1.3 avec ESNI et le proxy du trafic HTTP (S) vers l'amont qui ne prend pas en charge ESNI. Cela vous permet d'appliquer la technologie dans une infrastructure existante, sans changer les principaux composants, c'est-√†-dire d'utiliser des serveurs Web actuels qui ne prennent pas en charge ESNI.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de clart√©, nous donnons un diagramme:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b30/035/725/b30035725aca99c4c0085c237a1d1a9e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je note que le proxy a √©t√© con√ßu avec la possibilit√© de mettre fin √† une connexion TLS sans ESNI, pour prendre en charge les clients sans ESNI. De plus, le protocole de communication avec l'amont peut √™tre HTTP ou HTTPS avec une version TLS inf√©rieure √† 1.3 (si l'amont ne prend pas en charge 1.3). Cette conception offre une flexibilit√© maximale. </font><font style="vertical-align: inherit;">Nous avons emprunt√© la </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mise en ≈ìuvre de la prise en charge ESNI √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partir</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFlare</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Imm√©diatement, je note que l'impl√©mentation elle-m√™me est assez non triviale, car elle implique des changements dans la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que crypto / tls</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> standard </font><font style="vertical-align: inherit;">et n√©cessite donc un ¬´ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font><b><font style="vertical-align: inherit;">GOROOT</font></b><font style="vertical-align: inherit;"> avant l'assemblage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour g√©n√©rer des cl√©s ESNI, nous avons utilis√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esnitool</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (√©galement l'id√©e originale de CloudFlare). Ces cl√©s sont utilis√©es pour crypter / d√©crypter SNI.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons test√© la version en utilisant go 1.13 sous Linux (Debian, Alpine) et MacOS.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques mots sur les fonctionnalit√©s op√©rationnelles</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le proxy inverse ESNI fournit des m√©triques au format Prometheus, telles que les rps, les codes de latence et de r√©ponse en amont, les prises de contact TLS √©chou√©es / r√©ussies et la dur√©e de la prise de contact TLS. </font><font style="vertical-align: inherit;">√Ä premi√®re vue, cela semblait suffisant pour √©valuer comment le proxy g√®re le trafic.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©galement effectu√© des tests de r√©sistance avant utilisation. </font><font style="vertical-align: inherit;">R√©sultats ci-dessous:</font></font><br>
<br>
<pre><code class="plaintext hljs">wrk -t50 -c1000 -d360s 'https://esni-rev-proxy.npw:443' --timeout 15s<font></font>
Running 6m test @ https://esni-rev-proxy.npw:443<font></font>
&nbsp;&nbsp;50 threads and 1000 connections<font></font>
&nbsp;&nbsp;Thread Stats &nbsp; Avg&nbsp; &nbsp; &nbsp; Stdev &nbsp; &nbsp; Max &nbsp; +/- Stdev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Latency &nbsp; &nbsp; 1.77s &nbsp; &nbsp; 1.21s&nbsp; &nbsp; 7.20s&nbsp; &nbsp; 65.43%<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Req/Sec&nbsp; &nbsp; 13.78&nbsp; &nbsp; &nbsp; 8.84 &nbsp; 140.00 &nbsp; &nbsp; 83.70%<font></font>
&nbsp;&nbsp;206357 requests in 6.00m, 6.08GB read<font></font>
Requests/sec:&nbsp; &nbsp; 573.07<font></font>
Transfer/sec: &nbsp; &nbsp; 17.28MB&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons effectu√© des tests de charge de qualit√© pure, pour comparer les sch√©mas en utilisant et sans proxy inverse ESNI. </font><font style="vertical-align: inherit;">Nous avons ¬´coul√©¬ª le trafic localement afin d'√©liminer les ¬´interf√©rences¬ª dans les composants interm√©diaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, avec le support ESNI et le proxy en amont avec HTTP, nous avons obtenu environ 550 rps √† partir d'une instance, avec la consommation moyenne CPU / RAM du proxy inverse ESNI:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80% d'utilisation du processeur (4 processeurs virtuels, h√¥tes de 4 Go de RAM, Linux) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">130 MB Mem RSS </font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/lx/ad/em/lxademanjtgdgtbp2zj3dtztoaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä titre de comparaison, RPS pour le m√™me nginx amont sans terminaison TLS (protocole HTTP) ~ 1100:</font></font><br>
<br>
<pre><code class="plaintext hljs">wrk -t50 -c1000 -d360s 'http://lb.npw:80' ‚Äì-timeout 15s<font></font>
Running 6m test @ http://lb.npw:80<font></font>
&nbsp;&nbsp;50 threads and 1000 connections<font></font>
&nbsp;&nbsp;Thread Stats &nbsp; Avg&nbsp; &nbsp; &nbsp; Stdev &nbsp; &nbsp; Max &nbsp; +/- Stdev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Latency &nbsp; &nbsp; 1.11s &nbsp; &nbsp; 2.30s &nbsp; 15.00s&nbsp; &nbsp; 90.94%<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Req/Sec&nbsp; &nbsp; 23.25 &nbsp; &nbsp; 13.55 &nbsp; 282.00 &nbsp; &nbsp; 79.25%<font></font>
&nbsp;&nbsp;393093 requests in 6.00m, 11.35GB read<font></font>
&nbsp;&nbsp;Socket errors: connect 0, read 0, write 0, timeout 9555<font></font>
&nbsp;&nbsp;Non-2xx or 3xx responses: 8111<font></font>
Requests/sec: &nbsp; 1091.62<font></font>
Transfer/sec: &nbsp; &nbsp; 32.27MB&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pr√©sence de d√©lais d'attente indique qu'il y a un manque de ressources (nous avons utilis√© 4 vCPU, 4 Go de RAM, Linux), et en fait le RPS potentiel est plus √©lev√© (nous avons re√ßu des nombres allant jusqu'√† 2700 RPS sur des ressources plus puissantes). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En conclusion, je note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que la technologie ESNI semble assez prometteuse. </font><font style="vertical-align: inherit;">Il existe de nombreuses autres questions ouvertes, par exemple, le stockage d'une cl√© ESNI publique dans DNS et la rotation des cl√©s ESNI - ces questions sont activement discut√©es, et la derni√®re version du projet (au moment de la r√©daction) ESNI est d√©j√† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506432/index.html">Comment cr√©er un projet Web ou mobile personnalis√© √† partir de z√©ro: processus, r√®gles et un peu de sang</a></li>
<li><a href="../fr506438/index.html">√Ä propos de la traduction des mots "choix" / "choisir" sans choisir / choix / s√©lectionner</a></li>
<li><a href="../fr506442/index.html">Tick ‚Äã‚ÄãTuck</a></li>
<li><a href="../fr506444/index.html">D√©fis futurs</a></li>
<li><a href="../fr506450/index.html">Exp√©rience de l'utilisation de la technologie Rutoken pour l'enregistrement et l'autorisation des utilisateurs dans le syst√®me (partie 1)</a></li>
<li><a href="../fr506454/index.html">Pour ce qu'un bim-manager obtient 100 000 et comment le devenir</a></li>
<li><a href="../fr506456/index.html">Nous recevons et analysons le signal radio du terminal de paiement via SDR</a></li>
<li><a href="../fr506460/index.html">Diff√©rences entre le cerveau masculin et f√©minin: les femmes codent-elles mieux?</a></li>
<li><a href="../fr506462/index.html">Poussoirs et tachers - comment j'ai test√© tout ce que j'ai trouv√©</a></li>
<li><a href="../fr506472/index.html">Protection des entreprises pour les entrepreneurs Internet: o√π ouvrir une entreprise et un compte, que rechercher</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>