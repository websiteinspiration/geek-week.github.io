<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûï üë®‚Äçüîß üé© Mejores pr√°cticas de Redis, parte 3 ‚úçÔ∏è üéÉ üç∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Traducci√≥n final de las secciones Redis Best Practices del sitio web oficial de Redis Labs. ¬°Lo m√°s inusual e interesante hoy bajo el corte!
 
 
 La p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mejores pr√°cticas de Redis, parte 3</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506594/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traducci√≥n final de las secciones </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Best Practices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del sitio web oficial de Redis Labs. </font><font style="vertical-align: inherit;">¬°Lo m√°s inusual e interesante hoy bajo el corte!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/6y/f5/hr6yf5w1hp0fh-i5vfa0p1pxeuy.png" width="15%"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera parte est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el segundo est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo contiene los siguientes temas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en conjuntos ordenados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en conjuntos ordenados lexicogr√°ficamente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en campos de bits;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patr√≥n b√°sico de limitaci√≥n de ancho de banda;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filtro de floraci√≥n;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mostrador;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patr√≥n de conteo de bits;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperLogLog;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guiones Lua.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datos de secuencia de tiempo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los datos de secuencia de tiempo, o datos con un orden de tiempo natural, se pueden modelar en Redis de varias maneras, dependiendo de los datos en s√≠ y de la forma en que desea acceder a ellos. </font><font style="vertical-align: inherit;">Veremos algunos de estos patrones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en conjuntos ordenados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en conjuntos ordenados lexicogr√°ficamente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">secuencias de tiempo en campos de bits;</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secuencias de tiempo en conjuntos ordenados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las secuencias de tiempo en conjuntos ordenados (zsets) son una forma t√≠pica de modelar una secuencia de tiempo en Redis. </font><font style="vertical-align: inherit;">Los conjuntos ordenados consisten en objetos √∫nicos cuyas puntuaciones se almacenan en una clave. </font><font style="vertical-align: inherit;">El uso de este tipo de datos para conjuntos ordenados significa que el recuento se comporta como una especie de indicador de tiempo (a menudo es una marca de tiempo precisa al milisegundo), y el elemento son datos registrados. </font><font style="vertical-align: inherit;">El √∫nico beneficio es que, dado que se trata de una forma de conjunto, solo se permiten elementos √∫nicos, e intentar grabar secuencias de tiempo con los mismos valores solo actualizar√° la puntuaci√≥n. </font><font style="vertical-align: inherit;">Para ilustrar este problema, tomamos el siguiente ejemplo de registro peri√≥dico de temperatura:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sello de tiempo</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temperatura, C</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1586697976001</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1586697977001</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1586697978001</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si simplemente los agrega al conjunto ordenado usando ZADD, puede perder algunos valores: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ANTI-PATTERN</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZADD temperature 1586697976001 21<font></font>
(integer) 1<font></font>
&gt; ZADD temperature 1586697977001 22<font></font>
(integer) 1<font></font>
&gt; ZADD temperature 1586697978001 21<font></font>
(integer) 0<font></font>
&gt; ZRANGEBYSCORE temperature -inf +inf WITHSCORES<font></font>
1) "22"<font></font>
2) "1586697977001"<font></font>
3) "21"<font></font>
4) "1586697978001"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que la tercera llamada a ZADD devuelve 0, lo que indica que el nuevo elemento no se ha agregado al conjunto. Luego, en ZRANGEBYSCORE, vemos que solo hay dos registros en el conjunto ordenado. ¬øPor qu√©? Porque el primero y el tercero comparten el mismo objeto, y acabamos de actualizar la cuenta de este objeto. Hay varias formas de solucionar este problema. Una de ellas es incluir algunos datos aleatorios con suficiente variaci√≥n, asegurando as√≠ la unicidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, cree un n√∫mero real pseudoaleatorio de 0 a 1, inclusive, y luego agr√©guelo a nuestra marca de tiempo. En nuestro ejemplo, lo dejaremos en forma decimal para facilitar su lectura (en realidad, ser√≠a m√°s inteligente convertirlo a una cadena de 8 bytes para ahorrar espacio).</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZADD temperature2 1586697976001 21:1586697976001.2583<font></font>
(integer) 1<font></font>
&gt; ZADD temperature2 1586697977001 22:1586697977001.941678<font></font>
(integer) 1<font></font>
&gt; ZADD temperature2 1586697978001 21:1586697978001.732015<font></font>
(integer) 1<font></font>
&gt; ZRANGEBYSCORE temperature2 -inf +inf WITHSCORES<font></font>
1) "21:1586697976001.2583"<font></font>
2) "1511533205001"<font></font>
3) "22:1586697977001.941678"<font></font>
4) "1586697977001"<font></font>
5) "21:1586697978001.732015"<font></font>
6) "1586697978001"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, todos los ZADD devolvieron 1, lo que indica una adici√≥n exitosa, y ZRANGEBYSCORE devolvi√≥ todos los valores. </font><font style="vertical-align: inherit;">Este es un m√©todo de trabajo, sin embargo, no es muy eficiente debido al desperdicio de bytes para garantizar la unicidad, lo que agrega una sobrecarga al almacenamiento. </font><font style="vertical-align: inherit;">En la mayor√≠a de los casos, su aplicaci√≥n simplemente eliminar√° la singularidad. </font><font style="vertical-align: inherit;">Cabe se√±alar que no es necesario agregar unicidad si sus datos ya son √∫nicos (por ejemplo, datos que incluyen UUID). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con este m√©todo, tiene acceso a todos los m√©todos de conjuntos ordenados para an√°lisis y control:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZRANGEBYSCORE le permite obtener un segmento espec√≠fico entre dos marcas de tiempo (ZREVRANGEBYSCORE devolver√° el segmento en orden descendente);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZREMRANGEBYSCORE le permite eliminar un rango espec√≠fico de marcas de tiempo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZCOUNT: el n√∫mero de elementos entre el rango de marca de tiempo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZINTERSTORE: le permite obtener la intersecci√≥n de dos datos y guardarlos con una nueva clave;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZUNIONSTORE: le permite obtener la uni√≥n de dos datos y tambi√©n guardarlos con una nueva clave. </font><font style="vertical-align: inherit;">Tambi√©n puede usar esto para duplicar un conjunto ordenado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Operaciones ZINTERSTORE y ZUNIONSTORE que funcionan con varias teclas. </font><font style="vertical-align: inherit;">Cuando trabaje con un entorno compartido, debe tener cuidado de verificar que su nueva clave est√© en el mismo segmento, de lo contrario, estos comandos generar√°n un error.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secuencias de tiempo en conjuntos lexicogr√°ficamente ordenados</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra forma de trabajar con secuencias de tiempo es usar las propiedades lexicogr√°ficas de los conjuntos ordenados para almacenar una marca de tiempo y un valor. Si a√∫n no est√° familiarizado con esto, es hora de leer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta secci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con este m√©todo, almacenamos todo con el mismo recuento y primero codificamos la marca de tiempo, luego agregamos el valor como un elemento. Toma un ejemplo:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZADD lex-temperature 0 1589392163001:21<font></font>
(integer) 1<font></font>
&gt; ZADD lex-temperature 0 1589392164001:22<font></font>
(integer) 1<font></font>
&gt; ZADD lex-temperature 0 1589392165001:21<font></font>
(integer) 1<font></font>
&gt; ZRANGE lex-temperature 0 -1<font></font>
1) "1589392163001:21"<font></font>
2) "1589392164001:22"<font></font>
3) "1589392165001:21"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En estas tres llamadas ZADD, la marca de tiempo est√° separada del valor por dos puntos, y podemos ver que se devuelve 1 cada vez, lo que significa que se han agregado los tres. En ZRANGE vemos el orden guardado. ¬øPor qu√©? En conjuntos ordenados, si el puntaje es el mismo, los resultados con el mismo puntaje se ordenan por orden binario. Dado que las marcas de tiempo en este per√≠odo tienen el mismo n√∫mero de d√≠gitos, todo se ordenar√° correctamente (si sus marcas de tiempo son anteriores a 2002 o posteriores a 2285, necesitar√° m√°s d√≠gitos para completar). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obtener un rango de valores de este tipo, use el comando ZRANGEBYLEX:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZRANGEBYLEX lex-temperature (1511533200001 +<font></font>
1) "1589392163001:21"<font></font>
2) "1589392164001:22"<font></font>
3) "1589392165001:21"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo argumento tiene un prefijo (que indica la exclusividad del valor (la inclusi√≥n se denota por [). En la pr√°ctica, este formato hace que la inclusi√≥n y la exclusividad sean irrelevantes, ya que la marca de tiempo siempre ir√° seguida de datos adicionales. El tercer argumento + indica la falta de l√≠mite del l√≠mite superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intente obtener la fecha entre 1589392160001 y 1589392165001 inclusive:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZRANGEBYLEX lex-temperature [1589392160001 [1589392165001<font></font>
1) "1589392163001:21"<font></font>
2) "1589392164001:22"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© los datos de la marca de tiempo 1589392165001 no entran en la muestra, a pesar del prefijo inclusivo? </font><font style="vertical-align: inherit;">Quiero creer que Redis de alguna manera entiende que esto es una marca de tiempo. </font><font style="vertical-align: inherit;">De hecho, Redis solo ve la ordenaci√≥n binaria. </font><font style="vertical-align: inherit;">En la ordenaci√≥n binaria, 1589392165001: 21 es mayor que 1589392165001 inclusivo o exclusivo. </font><font style="vertical-align: inherit;">La forma correcta de incluir esto en el l√≠mite superior es agregar 1 milisegundo al l√≠mite superior deseado y usar exclusividad:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; ZRANGEBYLEX lex-temperature [1589392160001 (1589392165002<font></font>
1) "1589392163001:21"<font></font>
2) "1589392164001:22"<font></font>
3) "1589392165001:21"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las secuencias temporales con conjuntos ordenados lexicogr√°ficamente tienen un conjunto similar de comandos √∫tiles, como secuencias temporales con conjuntos simplemente ordenados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZRANGEBYLEX / ZREVRANGEBYLEX: obtiene un rango de valores en orden ascendente o descendente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZREMRANGEBYLEX: elimina un rango ordenado espec√≠fico de valores;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZLEXCOUNT: obtiene el n√∫mero de elementos en un rango ordenado de valores.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZINTERSTORE y ZUNIONSTORE se pueden usar en conjuntos ordenados lexicogr√°ficamente, pero existe el riesgo de p√©rdida de datos, porque las combinaciones duplicadas de marcas de tiempo y valores no se duplicar√°n en el resultado devuelto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s se pregunte por qu√© elegir conjuntos ordenados con marcas de tiempo en lugar de codificar conjuntos ordenados lexicogr√°ficamente. </font><font style="vertical-align: inherit;">Como regla general, es mejor trabajar con conjuntos ordenados lexicogr√°ficamente para secuencias de tiempo: si los valores no siempre son √∫nicos, las marcas de tiempo ser√°n m√°s efectivas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secuencias temporales de campo de bits</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redis puede almacenar efectivamente secuencias de tiempo en campos de bits. </font><font style="vertical-align: inherit;">Para hacer esto, primero debe seleccionar un punto de referencia arbitrario y un formato num√©rico. </font><font style="vertical-align: inherit;">Tome el ejemplo de medici√≥n de temperatura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que queremos tomar la temperatura cada minuto, y estableceremos el punto de partida para la medianoche todos los d√≠as. </font><font style="vertical-align: inherit;">Medimos la temperatura ambiente en grados Celsius. </font><font style="vertical-align: inherit;">Puede estructurar los datos de la siguiente manera:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 minutos = byte 0;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la temperatura se escribe en un n√∫mero sin signo de 8 bits (0-255).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante un d√≠a, los datos se escriben a aproximadamente 1,44 kb. </font><font style="vertical-align: inherit;">Puede registrar la temperatura con el comando BITFIELD:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITFIELD bit-ts SET u8 #0 22<font></font>
1) (integer) 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, utilizando la tecla bit-ts, el valor de temperatura 22 se escribe en el n√∫mero de 8 bits sin signo (u8) a medianoche (# 0). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los campos de bits no est√°n limitados a valores de 8 bits sin signo. </font><font style="vertical-align: inherit;">Presta atenci√≥n al signo de la libra antes del desplazamiento. </font><font style="vertical-align: inherit;">Significa que la alineaci√≥n ocurrir√° en el tipo seleccionado. </font><font style="vertical-align: inherit;">Por ejemplo, si especifica "# 79", esto significar√° el byte 79, "79", el bit 79 (consulte la ayuda de BITFIELD). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El desplazamiento se puede alinear por el tipo del n√∫mero almacenado, comenzando desde 0. Por ejemplo, si queremos escribir 1 am, considerando los espacios cero, usamos el desplazamiento # 59 o el desplazamiento # 719 para el mediod√≠a.</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITFIELD bit-ts SET u8 #59 23 SET u8 #719 25<font></font>
1) (integer) 0<font></font>
2) (integer) 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo tambi√©n muestra que BITFIELD es variable, es decir </font><font style="vertical-align: inherit;">Puede trabajar con m√∫ltiples valores en una sola llamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue algunos valores m√°s:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITFIELD bit-ts SET u8 #60 21 SET u8 #61 20<font></font>
1) (integer) 0<font></font>
2) (integer) 0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora extraeremos:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITFIELD bit-ts GET u8 #59 GET u8 #60 GET u8 #61<font></font>
1) (integer) 23<font></font>
2) (integer) 21<font></font>
3) (integer) 20</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La firma del subcomando bit GET es similar a la firma SET, con la √∫nica diferencia de que no acepta un valor como tercer argumento. </font><font style="vertical-align: inherit;">Es normal cuando conocemos todos los √≠ndices que deben obtenerse, pero a veces necesitamos un rango de valores, y cada byte individualmente ser√° demasiado estresante. </font><font style="vertical-align: inherit;">Podemos usar el comando GETRANGE. </font><font style="vertical-align: inherit;">En una situaci√≥n normal, se usa para obtener bytes de una cadena, pero los BITFIELD son solo otra forma de direccionar los mismos datos.</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; GETRANGE bit-ts 59 61<font></font>
"\x17\x15\x14"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El comando devolvi√≥ los bytes 59 a 61 en hexadecimal (23, 21 y 20 en decimal. Los idiomas del cliente manejan los datos binarios mejor que redis-cli, y generalmente pueden obtener una matriz de bytes espec√≠fica del idioma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro ejemplo, usamos bytes 0 , 59-61 y 719. ¬øQu√© sucede si solicitamos bytes que a√∫n no se han configurado?</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITFIELD bit-ts GET u8 #40<font></font>
1) (integer) 0<font></font>
&gt; BITFIELD bit-ts GET u8 #750<font></font>
1) (integer) 0<font></font>
&gt; GETRANGE bit-ts 30 50<font></font>
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redis devuelve bytes no especificados como 0. Esto puede causar dificultades al trabajar con datos de secuencia de tiempo: la l√≥gica de la aplicaci√≥n necesita distinguir entre 0 y un valor indefinido. </font><font style="vertical-align: inherit;">El redondeo y la omisi√≥n de valores 0 son posibles, especialmente cuando se usan enteros con signo, ya que este puede ser un valor v√°lido en el medio de su rango. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La longitud real de la secuencia de tiempo realmente depende del √∫ltimo byte. </font><font style="vertical-align: inherit;">En el ejemplo, el √∫ltimo byte almacenado es 719, por lo que la longitud de los datos es de 720 bytes.</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; STRLEN bit-ts<font></font>
(integer) 720</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las secuencias de tiempo basadas en BITFIELD son un patr√≥n potente y compacto para almacenar datos num√©ricos o binarios. </font><font style="vertical-align: inherit;">Sin embargo, esta soluci√≥n no cubre todos los casos de uso, y su uso debe considerarse cuidadosamente para satisfacer sus necesidades.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patr√≥n de l√≠mite de ancho de banda b√°sico</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crear limitadores de ancho de banda con Redis es f√°cil gracias a los comandos INCR y EXPIRE. </font><font style="vertical-align: inherit;">La idea es que desee limitar las solicitudes a un servicio espec√≠fico durante un per√≠odo de tiempo determinado. </font><font style="vertical-align: inherit;">Supongamos que tenemos un servicio en el que los usuarios son identificados por una clave API. </font><font style="vertical-align: inherit;">El servicio tiene un l√≠mite de 20 solicitudes por minuto. </font><font style="vertical-align: inherit;">Para implementar esto, queremos crear una clave Redis en la clave API cada minuto. </font><font style="vertical-align: inherit;">Para no ensuciar la base de datos, el per√≠odo de validez de la clave tambi√©n se establece en 1 minuto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clave API - zA21X31, negrita - l√≠mite alcanzado:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Key</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zA21X31: 0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zA21X31: 1</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zA21X31: 2</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zA21X31: 3</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zA21X31: 4</font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veinte</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veinte</font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expira en</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:02</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:03</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:04</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:05</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:06</font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hora</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:00</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:01</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:02</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:03</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:04</font></font></b></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clave est√° compuesta por la clave API y el n√∫mero de minuto a trav√©s de dos puntos. </font><font style="vertical-align: inherit;">Dado que las claves siempre caducan, solo necesitamos usar los n√∫meros de minutos; con el inicio de la nueva hora podemos estar seguros de que no hay otras 59 claves (expiraron hace 59 minutos). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a ver c√≥mo funciona:</font></font><br>
<br>
<ol>
<li><pre><code class="plaintext hljs">&gt; GET [ API]:[ ]</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el resultado es inferior a 20 o no est√° configurado, vaya al paso 4; de lo contrario, vaya al paso 3;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar un mensaje de error, cerrar la conexi√≥n y finalizar;</font></font></li>
<li><pre><code class="plaintext hljs">&gt; MULTI<font></font>
OK<font></font>
&gt; INCR [user-api-key]:[current minute number]<font></font>
QUEUED<font></font>
&gt; EXPIRE [user-api-key]:[current minute number] 59<font></font>
QUEUED<font></font>
&gt; EXEC<font></font>
OK</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuar el programa.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dos puntos clave:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INCR en una clave inexistente siempre ser√° 1;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPIRE se encuentra dentro de la transacci√≥n MULTI junto con INCR, lo que significa que ser√° una operaci√≥n at√≥mica.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El peor de los casos es si, por alguna raz√≥n muy extra√±a e improbable, el servidor Redis muere entre INCR y EXPIRE. </font><font style="vertical-align: inherit;">Al restaurar datos de AOF o de una r√©plica en memoria, INCR no se restaurar√° porque la transacci√≥n no se complet√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se utiliza este patr√≥n, es posible que un usuario tenga dos claves: una que se est√° utilizando actualmente y otra que caduca en este momento. </font><font style="vertical-align: inherit;">Sin embargo, el patr√≥n es muy efectivo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtro de floraci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El filtro Bloom es una estructura de datos probabil√≠stica interesante que puede usar para verificar si un elemento se ha agregado anteriormente. Aqu√≠ est√° la redacci√≥n intencionalmente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La probabilidad es que solo puede haber una respuesta falsa positiva, pero no un falso negativo. El filtro Bloom ofrece una forma mucho m√°s compacta y r√°pida de verificar la disponibilidad que guardar todos los elementos en un conjunto y llamar a SISMEMBER.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El filtro Bloom funciona pasando un elemento a trav√©s de la funci√≥n hash r√°pida, seleccionando bits de √©l y configur√°ndolos en 1 y 0 en un cierto intervalo en el campo de bits. Para verificar la presencia de un filtro, se seleccionan los mismos bits. Muchos elementos pueden tener bits que se superponen, pero dado que la funci√≥n hash crea identificadores √∫nicos, si un bit del hash sigue siendo 0, entonces sabemos que no se ha agregado antes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redis ha estado usando el filtro durante muchos a√±os como una biblioteca cliente que usa GETBIT y SETBIT para trabajar con campos de bits. Afortunadamente, el m√≥dulo ReBloom est√° disponible en Redis 4.0, lo que elimina la necesidad de crear su propia implementaci√≥n del filtro Bloom.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un buen caso de uso para este filtro es verificar si el nombre de usuario ya se ha utilizado. </font><font style="vertical-align: inherit;">No hay problemas con tama√±os de datos peque√±os, pero a medida que el servicio crece, las consultas a la base de datos pueden ser costosas. </font><font style="vertical-align: inherit;">Esto es f√°cil de solucionar con ReBloom. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue algunos nombres para la prueba:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BF.ADD usernames funnyfred<font></font>
(integer) 1<font></font>
&gt; BF.ADD usernames fredisfunny<font></font>
(integer) 1<font></font>
&gt; BF.ADD usernames fred<font></font>
(integer) 1<font></font>
&gt; BF.ADD usernames funfred<font></font>
(integer) 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora pruebe el filtro Bloom:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BF.EXISTS usernames fred<font></font>
(integer) 1<font></font>
&gt; BF.EXISTS usernames fred_is_funny<font></font>
(integer) 0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se esperaba, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fred_is_funny</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolvi√≥ 0. Esto significa que ese nombre no se us√≥. </font><font style="vertical-align: inherit;">Aunque es imposible decirlo con certeza, ya que los bits pueden simplemente superponerse entre varios elementos. </font><font style="vertical-align: inherit;">B√°sicamente, la probabilidad de falsos positivos es baja, pero no igual a 0. A medida que se llena el filtro Bloom, la probabilidad aumenta, pero puede ajustar la tasa de error y el tama√±o inicial (el valor predeterminado es 0.01 y 100, respectivamente).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrador</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un contador en Redis se puede implementar de varias maneras. </font><font style="vertical-align: inherit;">El m√°s obvio es INCR et al (INCRBY, INCRBYFLOAT, HINCRBY, HINCRBYFLOAT, ZINCRBY), que se pueden encontrar simplemente leyendo la documentaci√≥n. </font><font style="vertical-align: inherit;">Menos obvio es el uso de BITCOUNT y PFADD.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patr√≥n de conteo de bits</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BITCOUNT cuenta el n√∫mero de bits establecidos en 1 en el campo de bits por clave. </font><font style="vertical-align: inherit;">Esto se puede usar para calcular una serie de actividades durante un per√≠odo de tiempo arbitrario (similar al patr√≥n de secuencias de tiempo en campos de bits). </font><font style="vertical-align: inherit;">El proceso consiste en elegir un punto en el tiempo, y cada bit representa una unidad de per√≠odo. </font><font style="vertical-align: inherit;">Cada vez que se realiza una acci√≥n durante este per√≠odo, ejecute SETBIT a una distancia de 1 unidad del √∫ltimo punto.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:00</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:02</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:03</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12:04</font></font></th>
</tr>
<tr>
<td></td>
<td><pre><code class="plaintext hljs">&gt; SETBIT btct 2 1</code></pre></td>
<td><pre><code class="plaintext hljs">&gt; SETBIT btct 3 1</code></pre></td>
<td><pre><code class="plaintext hljs">&gt; SETBIT btct 4 1</code></pre></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[punto de partida]</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuar</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuar</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuar</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para calcular en qu√© minutos se produjo la actividad de 12:00 a 12:30, puede hacer esto:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; BITCOUNT btct 0 30<font></font>
(integer) 3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, este patr√≥n responde a la pregunta "¬øCon qu√© frecuencia?" En lugar de "¬øCu√°ntas veces?". </font><font style="vertical-align: inherit;">Por ejemplo, un usuario podr√≠a estar activo 20 veces en un minuto, pero esto contar√° como 1. La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ventaja real de esta plantilla es que proporciona la puntuaci√≥n m√≠nima posible durante un cierto per√≠odo de tiempo, ya que los bits son los bloques de construcci√≥n m√°s elementales. </font><font style="vertical-align: inherit;">Este es literalmente el repositorio m√°s peque√±o (sin comprimir) para contar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperLogLog</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contar art√≠culos √∫nicos puede ser complicado. Esto generalmente significa almacenar cada elemento √∫nico y luego invocar esta informaci√≥n de alguna manera. En Redis, esto se puede hacer con muchos y un equipo, sin embargo, tanto el volumen ocupado como la complejidad del tiempo ser√°n muy grandes. HyperLogLog proporciona una alternativa probabil√≠stica. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HyperLogLog es internamente similar a un filtro Bloom, tambi√©n alimenta elementos a trav√©s de una funci√≥n hash no criptogr√°fica y establece bits en un campo de bits. Pero, a diferencia del filtro Bloom, HyperLogLog almacena un contador de elementos que se incrementa cuando se agrega un nuevo elemento que no se ha agregado antes. Esto da una baja tasa de error al contar elementos √∫nicos en un conjunto. HyperLogLog est√° integrado en Redis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay 3 comandos HyperLogLog en Redis: PFADD, PFCOUNT y PFMERGE. </font><font style="vertical-align: inherit;">Supongamos que creamos un esc√°ner web y queremos contar la cantidad de URL √∫nicas de p√°ginas vistas durante el d√≠a. </font><font style="vertical-align: inherit;">Para cada p√°gina, ejecute el siguiente comando:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; PFADD crawled:20200613 "http://www.google.com/"<font></font>
(integer) 1<font></font>
&gt; PFADD crawled:20200613 "http://www.redislabs.com/"<font></font>
(integer) 1<font></font>
&gt; PFADD crawled:20200613 "http://www.redis.io/"<font></font>
(integer) 1<font></font>
&gt; PFADD crawled:20200614 "http://www.redisearch.io/"<font></font>
(integer) 1<font></font>
&gt; PFADD crawled:20200614 "http://www.redis.io/"<font></font>
(integer) 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada tecla anterior est√° indexada por d√≠a. </font><font style="vertical-align: inherit;">Puede ver cu√°ntas p√°ginas se vieron el 13/06/2020, de la siguiente manera:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; PFCOUNT crawled:20200613<font></font>
(integer) 3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver el n√∫mero de p√°ginas para el 13/06/2020 y el 14/06/2020, use el comando PFMERGE para crear una nueva clave con un valor que combine dos contadores. </font><font style="vertical-align: inherit;">Tenga en cuenta que, dado que </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.redis.io</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se almacena en ambos conjuntos, se calcular√° una vez:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; PFMERGE crawled:20200613-14 crawled:20200613 crawled:20200614<font></font>
OK<font></font>
&gt; PFCOUNT crawled:20200613-14<font></font>
(integer) 4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta operaci√≥n puede funcionar con varias claves, as√≠ que tenga cuidado en un entorno dividido, de modo que las claves est√©n en el mismo fragmento.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guiones Lua</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redis puede hacer cosas incre√≠bles solo desde "redis-cli" e incluso m√°s entre Redis y su lenguaje de programaci√≥n. Pero a veces, puede ser necesario un comportamiento que no puede obtenerse en la arquitectura cliente-servidor debido a problemas de eficiencia o seguridad: la l√≥gica debe ejecutarse en la capa de la base de datos. En tales casos, Lua viene al rescate. Lua trabaja en Redis como lenguaje de script. Con √©l, puede ejecutar c√≥digo en Redis, sin el costo de transporte hacia y desde el cliente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un caso de prueba est√° agregando un valor a un campo hash. </font><font style="vertical-align: inherit;">Si bien Redis puede agregar f√°cilmente un valor a una clave de cadena usando APPEND, no hay ning√∫n comando para agregar un valor a un campo hash. </font><font style="vertical-align: inherit;">Puede intentar obtener esto extrayendo el valor del cliente, agregando una nueva l√≠nea al valor y soltando los campos hash, pero esta es una mala idea. </font><font style="vertical-align: inherit;">Dado que esto no es at√≥mico, es probable que mientras agrega un valor, otro cliente pueda cambiarlo antes, y luego sobrescribir√° el nuevo valor.</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># #</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliente 1</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cliente 2</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><pre><code class="plaintext hljs">&gt; HGET myhash myfield</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[hola regresa]</font></font></td>
<td></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[agrega "mundo" a "hola"]</font></font></td>
<td><pre><code class="plaintext hljs">&gt; HSET myhash myfield "goodbye"</code></pre></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><pre><code class="plaintext hljs">&gt; HSET myhash myfield "hello world"</code></pre></td>
<td></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 4</font></font></td>
<td></td>
<td><pre><code class="plaintext hljs">&gt; HGET myhash myfield</code></pre></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver en la l√≠nea 2, la actualizaci√≥n se perder√°. </font><font style="vertical-align: inherit;">Puede usar los scripts de Lua para solucionar este problema y eliminar el costo de enviar / recibir valores del cliente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cualquier editor de texto, cree un script y d√≠gale que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sucedi√≥</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="lua hljs"><span class="hljs-keyword">local</span> original = redis.call(<span class="hljs-string">'HGET'</span>,KEYS[<span class="hljs-number">1</span>],ARGV[<span class="hljs-number">1</span>])
<span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">'HSET'</span>,KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>], original .. ARGV[<span class="hljs-number">2</span>])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la primera l√≠nea, cree una variable local </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">original</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en la que guardemos el valor actual de la clave hash desde el primer argumento pasado, y el campo es el primer argumento sin clave. Es importante comprender que los scripts de Lua en tiempo de ejecuci√≥n distinguen entre argumentos clave y no clave. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la segunda l√≠nea, se llama a HSET para la misma clave y campo, luego combinamos el valor original con el segundo argumento sin clave. Esto vuelve a Redis, por lo que mantendremos el valor de retorno HSET original.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ejecuci√≥n directa de scripts Lua con el comando EVAL puede ser confusa e ineficiente. </font><font style="vertical-align: inherit;">Redis tiene un cach√© de script incorporado que le permite precargar el script y luego acceder a √©l utilizando el hash SHA1 del script principal. </font><font style="vertical-align: inherit;">Puede descargar este script desde la l√≠nea de comandos usando "cat" y "redis-cli". </font><font style="vertical-align: inherit;">Tenga en cuenta que si su script difiere en al menos un car√°cter, tendr√° un hash completamente diferente.</font></font><br>
<br>
<pre><code class="bash hljs">$ redis-cli -a yourRedisPassword SCRIPT LOAD <span class="hljs-string">"<span class="hljs-subst">$(cat ./happend.lua)</span>"</span>
<span class="hljs-string">"d30c7f6d0c23fcfe6d4630b11f4e3db4cb2db099"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede usar EVALSHA para invocar el script y agregar:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt; HSET mynewhash greeting "Hello"<font></font>
(integer) 1<font></font>
&gt; EVALSHA d30c7f6d0c23fcfe6d4630b11f4e3db4cb2db099 1 mynewhash greeting " world"<font></font>
(integer) 0<font></font>
&gt; HGET mynewhash greeting<font></font>
"Hello world"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primer argumento para el comando EVALSHA es el hash del script generado por SCRIPT LOAD. El segundo argumento es el n√∫mero de claves. En nuestro caso, la clave es una. El tercer argumento es la clave sobre la que realizamos la acci√≥n. Y finalmente, el cuarto es el valor que agregamos al campo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que la adici√≥n se produce dentro del script Lua, el script anterior se cancelar√° porque los scripts Lua se ejecutan sincr√≥nicamente y at√≥micamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque Lua puede ser muy √∫til para resolver problemas, debe usarlo con cuidado. El script bloquea el servidor y puede conducir a una base de datos que no responde. En situaciones de fragmentaci√≥n, los scripts intentan guardar todas las operaciones en un √∫nico servidor para evitar errores cruzados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ es donde termina la secci√≥n de Mejores Pr√°cticas de Redis. </font><font style="vertical-align: inherit;">No tenga miedo de probar y experimentar, Redis es muy rico en funcionalidad. </font><font style="vertical-align: inherit;">Deje sus casos de uso interesantes en los comentarios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que las t√©cnicas descritas lo ayuden si no directamente, ¬°al menos se√±alando el camino correcto para resolver problemas!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es506574/index.html">Visualizaci√≥n de una lista de mujeres ganadoras del Premio Nobel en forma de cristales en 3D usando Vue, WebGL, three.js</a></li>
<li><a href="../es506578/index.html">Volumen de clientes potenciales gestionado</a></li>
<li><a href="../es506586/index.html">FizzBuzz l√≥gico</a></li>
<li><a href="../es506588/index.html">¬øQu√© es un algoritmo! (parte 2)</a></li>
<li><a href="../es506590/index.html">Conferencia DEVOXX Reino Unido. Elija un marco: Docker Swarm, Kubernetes o Mesos. Parte 2</a></li>
<li><a href="../es506598/index.html">Microsoft: Rust es la 'mejor oportunidad' en la industria de programaci√≥n de sistemas seguros</a></li>
<li><a href="../es506600/index.html">El contrato para el desarrollo del sitio en t√©rminos de gesti√≥n de proyectos (teor√≠a + muestra)</a></li>
<li><a href="../es506604/index.html">Concurrencia y eficiencia: Python vs FSM</a></li>
<li><a href="../es506606/index.html">Creaci√≥n de clicker PIXI.js</a></li>
<li><a href="../es506610/index.html">WAL-G: Copias de seguridad y recuperaci√≥n de bases de datos PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>