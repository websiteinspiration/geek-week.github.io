<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🏫 👨🏽‍🌾 🧖🏻 Apprentissage d'un mini moteur pas à pas 🤞🏽 📶 🤴🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les moteurs pas à pas sont largement utilisés dans l'industrie moderne et les produits maison. Ils sont utilisés là où il est nécessaire d'assurer la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Apprentissage d'un mini moteur pas à pas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498788/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les moteurs pas à pas sont largement utilisés dans l'industrie moderne et les produits maison. Ils sont utilisés là où il est nécessaire d'assurer la précision du positionnement des composants mécaniques, sans recourir à des retours et des mesures précises. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, je veux parler d'un type spécial de moteurs pas à pas - les moteurs pas à pas miniatures, qui sont utilisés dans la construction de systèmes optiques. Nous allons examiner de plus près leur appareil et comment contrôler ces petits moteurs.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/sz/_x/zhsz_xl6lm4btv11g953x7e2kwa.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un moteur pas à pas est un moteur électrique sans balais (sans balais) avec plusieurs enroulements (phases) situés sur le stator et des aimants (souvent permanents) sur le rotor. En appliquant une tension aux enroulements du stator, nous pouvons fixer la position du rotor, et en appliquant une tension aux enroulements, nous pouvons obtenir successivement le mouvement du rotor d'une position à une autre (étape), et cette étape a une valeur angulaire fixe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne nous attarderons pas sur la considération de chaque type de moteur pas à pas. Beaucoup a été écrit à ce sujet sur le réseau et bien, par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux parler d'un type spécial de moteurs pas à pas - les moteurs pas à pas miniatures, qui sont utilisés dans la construction de systèmes optiques. </font><font style="vertical-align: inherit;">Ces enfants sont disponibles à la vente. </font><font style="vertical-align: inherit;">Mais sur le réseau, surtout en russophone, il y a très peu d'informations sur ces moteurs. </font><font style="vertical-align: inherit;">Par conséquent, lorsque j'ai eu besoin de les utiliser dans mon projet, j'ai dû chercher des informations et mener quelques expériences. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je partagerai les résultats de mes recherches et expériences dans cet article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous considérerons la gestion de ces petits moteurs, à savoir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pilote L293D + microcontrôleur ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilote TMC2208 + microcontrôleur ATtiny44;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microcontrôleur ATtiny44 (sans pilote).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, seul le dernier point peut poser des questions ici. </font><font style="vertical-align: inherit;">Croyez-moi, j'ai également été surpris lorsque je suis tombé sur un clip vidéo (le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), où le gars prend juste et accroche directement le moteur pas à pas aux broches du microcontrôleur! </font><font style="vertical-align: inherit;">Mais parlons de tout dans l'ordre.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connaissance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, jetez un œil à l'apparence de notre héros: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s9/6n/lu/s96nlurhh1cpirq8g8zrtv1t_t0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
il est vraiment très petit! Selon le livre intelligent Petrenko S.F. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Les moteurs piézoélectriques dans l'instrumentation", les petits moteurs électromagnétiques, en principe, il est impossible de créer ... c'est-à-dire, c'est possible, mais avec une diminution du diamètre du fil à partir duquel les enroulements sont fabriqués, de plus en plus d'énergie est dissipée sous forme de chaleur dans l'environnement, ce qui entraîne une diminution de l'efficacité du moteur et fait leur utilisation est irrationnelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les remarquables, on peut noter que son arbre est très court et possède une rainure spéciale pour l'installation de l'engrenage ou du levier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deux enroulements sont clairement visibles, qui sont même recouverts d'une isolation de différentes couleurs. Donc, notre moteur appartient très probablement à la classe des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moteurs pas à pas bipolaires</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment cela fonctionne: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/ds/2w/5vds2wkt6kjahi0m55emzq5ipmc.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je pense que notre connaissance de ces moteurs ne sera pas complète si nous ne voyons pas ce qu'il y a à l'intérieur. Il est toujours intéressant de regarder à l'intérieur du mécanisme! N'est-ce pas?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En fait, nous n'avons rien vu d'inhabituel. Le rotor est magnétisé. Il n'y a aucun roulement nulle part, tout est sur les coussinets. Le moyeu arrière est enfoncé dans le carter moteur. L'avant n'est fixé par rien. Fait intéressant, le corps du moteur a été assemblé par soudage par points. Il a donc fallu couper le capot avant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant à la question de la connexion et de ses caractéristiques électriques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assurez-vous qu'il est bipolaire en faisant sonner les enroulements. Vraiment bipolaire, comme dans l'image ci-dessus. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La résistance d'enroulement est d'environ 26 ohms</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bien que le vendeur ait indiqué 14 ohms.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La description indique que la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tension d'alimentation est de 5V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bien que nous sachions tous que pour un moteur pas à pas, le courant consommé par ses enroulements est important. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous essayons de nous connecter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expérience n ° 1. </font><font style="vertical-align: inherit;">L293D + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous le savons, pour contrôler un moteur pas à pas bipolaire, il est nécessaire non seulement d'appliquer une tension aux deux enroulements dans la séquence souhaitée, mais également de changer la direction du courant dans ces enroulements, et de le faire indépendamment l'un de l'autre. Pour cela, chaque enroulement a besoin de son propre pont en H. Afin de ne pas le barrer des transistors, une puce L293D prête à l'emploi a été prise. Un autre de ses avantages - la puce a des broches spéciales Enable1 et Enable2, qui activent et désactivent chaque pont. Ils peuvent être utilisés pour fournir un signal PWM, ainsi, il est possible de contrôler la tension d'alimentation de chaque pont. Pourquoi cela pourrait être nécessaire, nous verrons plus loin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le L293D peut commuter des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tensions jusqu'à 36 V et produire jusqu'à 1,2 A par canal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui devrait être suffisant pour alimenter les enroulements de notre moteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, le schéma: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/eu/sm/apeusmkkhcddqmhrdrmvwkpjbsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les entrées de contrôle du L293D sont connectées aux sorties OC0A et OC0B, ce qui nous permettra de leur envoyer un signal PWM à l'avenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous flasherons le contrôleur via le programmateur en circuit (non représenté sur le schéma). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble le circuit assemblé sur une planche à pain: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/87/jg/gx87jgsrgeuethu-dotn-_a-fsc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et </font><font style="vertical-align: inherit;">voici </font><font style="vertical-align: inherit;">comment se trouve notre </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/so/xw/xrsoxwzgqmg1q80dx9dwecpcg68.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pilote d' </font><font style="vertical-align: inherit;">essai: </font><font style="vertical-align: inherit;">vous pouvez maintenant commencer à expérimenter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous calculons le courant qui traversera les enroulements du moteur lorsqu'ils sont connectés à une tension de 5V: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I = U / R = 5V / 26Ohm = 190mA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Très petit. Je me demande combien de temps il peut maintenir un tel courant et ne pas surchauffer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous incluons un ampèremètre et un voltmètre dans le circuit de l'un des enroulements, et mesurons les valeurs correspondantes lorsque l'alimentation de cet enroulement est fournie par le conducteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque la tension chute à travers l'enroulement de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,56 V, l'ampèremètre affiche un courant de 150 mA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et il est clairement visible comment l'amplitude du courant commence à chuter pendant le chauffage des enroulements. Il faut noter qu'il ne fait pas si chaud. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après vous être assuré que la tension de 5 V du moteur n'est pas dangereuse, essayez de les tordre dans différentes directions. Et maintenant, nous allons dire quelques mots sur les modes de fonctionnement du moteur pas à pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est assez bien dit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne répéterons pas, mais rappelons qu'un moteur pas à pas peut fonctionner en trois modes:</font></font><br>
<br>
<ul>
<li>           ,   ,       . </li>
<li>          ,  ,      ,     .</li>
<li>        ,     ,      ,   (   )    . ,  ,          ( , ,   ).   .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons d'implémenter les deux premiers modes sur la puce L293D, et pour le mode micro-pas, nous laisserons un pilote spécial de la deuxième expérience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code source du programme est le suivant:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2)); <span class="hljs-comment">//   </span><font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1); <span class="hljs-comment">//    </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4))); <font></font>
	 <font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_one_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2))); <font></font>
	<font></font>
	PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);  <font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN2));<span class="hljs-comment">//2</span><font></font>
	<font></font>
	PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN1);<font></font>
  <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3);<span class="hljs-comment">//3</span><font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4));<font></font>
	<font></font>
	PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
  <font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
  <font></font>
	<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
    PORTA |=(<span class="hljs-number">1</span>&lt;&lt;IN2);<span class="hljs-comment">//4</span><font></font>
  <font></font>
    PORTA &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN1));<font></font>
    <font></font>
    PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
  <font></font>
    PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3));<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stepper_OFF</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
	<span class="hljs-comment">//    ,       ,    </span><font></font>
	<font></font>
	PORTA &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2)));<font></font>
	<font></font>
	PORTB &amp;=(~((<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4)));<font></font>
	<font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1);<font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">255</span>; <span class="hljs-comment">//    (0-255)</span><font></font>
<font></font>
    OCR0B = <span class="hljs-number">255</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
    PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	LED_ON;<font></font>
		<font></font>
        L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	LED_OFF;<font></font>
		<font></font>
	L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	<span class="hljs-comment">//stepper_OFF();</span><font></font>
		<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		  <font></font>
    } <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode pas à pas. </font><font style="vertical-align: inherit;">Monophasé</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_U7lQKinBe8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur prend 16 pas par tour. </font><font style="vertical-align: inherit;">De plus, les étapes des deux phases n'ont pas la même valeur angulaire. </font><font style="vertical-align: inherit;">Je ne sais pas à quoi cela est lié. </font><font style="vertical-align: inherit;">Peut-être que la conception du moteur est la suivante? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons la fréquence maximale d'étapes qu'il peut fournir dans ce mode sans les manquer. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le délai minimum entre les étapes est de 2 ms, ce qui signifie 500 étapes / seconde. </font><font style="vertical-align: inherit;">Pas mal, c'est 31 rpm = 1850 rpm.</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mode pas à pas. </font><font style="vertical-align: inherit;">Deux phases</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/AGNc-i35tkI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veuillez noter que dans ce cas, les étapes sont plus lisses, elles sont de taille identique (en tout cas, plus identiques que dans le cas précédent). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, dans ce cas, deux enroulements sont simultanément alimentés et le transfert de chaleur augmente. </font><font style="vertical-align: inherit;">Après quelques secondes, le moteur chauffe assez fortement, j'ai donc arrêté l'expérience. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et avec la fréquence maximale des pas? </font><font style="vertical-align: inherit;">500 pas / seconde; </font><font style="vertical-align: inherit;">31 tr / min = 1875 tr / min. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il faut dire que pour un moteur pas à pas c'est assez agile. </font><font style="vertical-align: inherit;">Cela est dû au petit nombre de pôles magnétiques sur le rotor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous continuons ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expérience numéro 2. </font><font style="vertical-align: inherit;">TMC2208 + ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TMC2208 est le nom d'une puce pilote pour contrôler les moteurs pas à pas bipolaires, un module basé sur celui-ci est également appelé, qui est produit pour être installé dans des imprimantes 3D faites maison (et pas seulement) et a une disposition de broches unifiée. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup et lucidement dit sur ce module </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup a été écrit sur Internet sur la façon de l'installer dans votre imprimante 3D, mais nous sommes intéressés par la façon de connecter le module au microcontrôleur, alors comprenons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les caractéristiques de la puce sont impressionnantes (uniquement les personnes impressionnables):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tension d'alimentation de la partie logique: 3-5V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tension d'alimentation du moteur 5,5-36 V;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">courant de crête 2A;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réglage du courant moteur maximum;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge de l'interface UART pour la gestion et la configuration des registres internes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arrêt automatique;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prise en charge du mode micropas de contrôle moteur jusqu'à 1/16 de pas.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hy/4x/fg/hy4xfgf0clqt-j9hxilghfje85u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est très simple à gérer, en fait, vous n'avez besoin que de deux broches du microcontrôleur. </font><font style="vertical-align: inherit;">L'un est connecté à DIR - nous indiquons le sens de rotation du moteur, l'autre est connecté à STEP - lorsqu'une impulsion est appliquée, le microcircuit effectue les manipulations nécessaires avec des courants et des tensions sur les enroulements du moteur et cela prend une étape. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma de connexion ressemblera à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p6/7m/s1/p67ms10_2wbu6fdbxjmkcz7y5f8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, j'ai utilisé la broche EN pour éteindre le moteur et pendant longtemps pour ne pas garder les enroulements sous tension.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     TMC2208</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR PB2</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN PA6</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP PA7</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_OFF PORTA |=(1&lt;&lt;EN)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EN_ON PORTA &amp;=(~(1&lt;&lt;EN))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_FOR PORTB |=(1&lt;&lt;DIR)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DIR_BACK PORTB &amp;=(~(1&lt;&lt;DIR))</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_ON PORTA |=(1&lt;&lt;STP)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> STP_OFF PORTA &amp;=(~(1&lt;&lt;STP))</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TMS2208_STEP</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay</span>)</span> {<font></font>
<font></font>
    <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//  </span><font></font>
	<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:<font></font>
			DIR_FOR;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:<font></font>
			DIR_BACK;	<font></font>
		<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
	}<font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//      </span><font></font>
	<font></font>
		STP_ON; <span class="hljs-comment">//   </span><font></font>
		<font></font>
		delay_microsecond(<span class="hljs-number">100</span>); <span class="hljs-comment">//   100</span><font></font>
		<font></font>
		STP_OFF;<font></font>
		<font></font>
		delay_millisecond(step_delay);<span class="hljs-comment">//   </span><font></font>
	<font></font>
	    step_quantity--;<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> {<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
<font></font>
        DDRB |=(<span class="hljs-number">1</span>&lt;&lt;DIR);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;EN);<font></font>
<font></font>
        DDRA |=(<span class="hljs-number">1</span>&lt;&lt;STP);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <font></font>
	   <font></font>
	   LED_ON;<font></font>
	   <font></font>
	   EN_ON;<font></font>
	<font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">10</span>); <span class="hljs-comment">// TMS2208_STEP ( ,  F/B,   )</span><font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	   <font></font>
	   LED_OFF;<font></font>
	   <font></font>
	   TMS2208_STEP(<span class="hljs-number">32</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">10</span>);<font></font>
	   <font></font>
	   delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
}  </code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de tout démarrer, vous devez pré-configurer le module. Tout d'abord, définissez le mode micropas souhaité. Deuxièmement, réglez le courant moteur maximal souhaité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec un micropas, tout est simple. Les broches MS1 et MS2 en sont responsables. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/vf/ba/mrvfbaqfm3rvb_fkop2w28ybtiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je note que le microcircuit ne modifie pas la tension pas à pas, mais le fait «en douceur», mais comme le microcircuit est numérique, la sortie n'est pas un signal lisse, mais un signal avec un petit pas, selon la documentation, il décompose chaque pas en 256 micro pas. Cela a été fait pour augmenter la douceur de roulement, réduire le bruit du moteur et, en théorie, ne devrait pas permettre à la structure sur laquelle il est vissé d'entrer en résonance. Bref, tout cela pour rendre l'imprimante 3D plus silencieuse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour régler le courant du moteur, il est nécessaire de mesurer la tension au contact Vref, ce qui est indiqué sur la figure. La valeur de la tension peut être modifiée à l'aide d'un potentiomètre installé à côté du contact. La tension au contact sera proportionnelle au courant du moteur, et la dépendance aura la forme suivante: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vref = I * 1,44; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moteur a besoin d'environ 150mA, car Vref = 0,216V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous installons ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est entendu qu'une augmentation de courant fournit le microcircuit en augmentant la tension aux bornes de l'enroulement. Par conséquent, vous devez vous assurer que cette tension est suffisante. Mais, je crois, 5V devrait être suffisant pour ce petit moteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons tester le fonctionnement du moteur avec différents modes de micropas et voir ce qui se passe (la pause entre les micropas est de 10 ms):</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/smws8Omm5Gk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez remarquer que les mouvements du moteur sont devenus plus fluides (par rapport à l'expérience précédente), cependant, les 16 étapes caractéristiques sont encore assez clairement observées. </font><font style="vertical-align: inherit;">Eh bien ... apparemment, c'est une caractéristique des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moteurs pas à pas avec un rotor à aimant permanent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient également de noter que le moteur dans ce mode chauffe presque autant que dans un mode à pas complet à deux phases. </font><font style="vertical-align: inherit;">C'est compréhensible, les enroulements sont constamment alimentés, de la chaleur est continuellement générée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que pour de tels moteurs, l'utilisation d'un tel pilote, et en fait de modes micropas, n'est pas très recommandée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expérience numéro 3. </font><font style="vertical-align: inherit;">Pilote ATtiny44</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons brièvement à la première expérience et rappelons que les entrées EN1 et EN2 du microcircuit pilote sont connectées aux broches OC0A et OC0B du microcontrôleur. Cela signifie que nous pouvons y envoyer un signal PWM généré à l'aide de la minuterie TIMER0 et ainsi changer la tension appliquée aux enroulements du moteur et réguler en conséquence le courant qui les traversera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon la fiche technique du microcontrôleur ATtiny44, le courant maximal qu'une broche peut fournir n'est que de 40 mA. De plus, il n'est pas indiqué pour quel type de courant (pulsé ou constant) cette caractéristique. C'est juste là et c'est comme ça ... Je </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dois dire que je connais les microcontrôleurs ATMEL depuis plus de 7 ans. Et jamais une seule fois je n'ai eu envie de vérifier cette ligne de la fiche technique.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7g/-s/b3/7g-sb3h1t3qbhccp7kyvd0knqge.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être que le fabricant est juste sûr et qu'il peut en donner plus, ou peut-être que c'est vraiment le maximum qui peut donner une broche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons découvrir. Mais vous devez d'abord savoir à quel courant minimum le moteur est généralement capable de tourner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant le circuit de la première expérience, nous ajustons la valeur du courant à travers les enroulements égale à 40 mA. On commence en mode pas à pas avec deux phases (car le couple sera plus élevé): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Excellent! </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À 40mA, le moteur a démarré avec succès!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La valeur minimale du courant d'enroulement nécessaire au fonctionnement stable du moteur a également été détectée, et elle est égale à 30mA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, le couple sera beaucoup plus faible, mais le fait que nous ayons réussi à démarrer le moteur avec une si petite consommation d'énergie est important pour nous.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma de connexion du moteur pas à pas au microcontrôleur sera le suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8z/no/s8/8znos8hnrnwto939rm8yap_znpw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que chaque broche du microcontrôleur fonctionne comme un demi-pont (il peut commuter la sortie du microcircuit sur Vcc ou GND), pour contrôler le moteur pas à pas bipolaire, nous avons besoin de 4 broches du microcontrôleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Code de programme:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source WinAVR</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 8000000UL  //    </span><font></font>
<font></font>
<span class="hljs-comment">//    L: E2; H:DF; Ex:FF; </span>
<span class="hljs-comment">//    8         (     8)</span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/io.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;util/delay.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-meta">#include &lt;avr/interrupt.h&gt; //   </span><font></font>
<font></font>
<span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_pin PA5</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_ON PORTA |=(1&lt;&lt;LED_pin)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_OFF PORTA &amp;=(~(1&lt;&lt;LED_pin))</span><font></font>
<font></font>
<span class="hljs-comment">//     L293DD</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1 PB2 // OC0A (EN1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2 PA7 // OC0B (EN2)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_1_value OCR0A</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PWM_2_value OCR0B</span><font></font>
<font></font>
<span class="hljs-comment">//       L293D</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN1 PA0 //  PORTA</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN2 PA1</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN3 PB1 //  PORTB</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IN4 PB0</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_microsecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
    <font></font>
	<span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_us = <span class="hljs-number">0</span>; delay_us&lt;delay_time; delay_us++) {<font></font>
	<font></font>
	    _delay_us(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delay_millisecond</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> delay_time</span>)</span> { <span class="hljs-comment">//     </span><font></font>
<font></font>
    <span class="hljs-keyword">for</span>(unsigned <span class="hljs-keyword">int</span> delay_ms = <span class="hljs-number">0</span>; delay_ms&lt;delay_time; delay_ms++) {<font></font>
	<font></font>
	    _delay_ms(<span class="hljs-number">1</span>);<font></font>
	<font></font>
	}<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//        </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_1_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">// DL - driver less</span><font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_2_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN4)); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_3_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN3); <font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">step_4_two_phase_DL</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0A = <span class="hljs-number">95</span>;<font></font>
   PORTB |=(<span class="hljs-number">1</span>&lt;&lt;IN4); <font></font>
   <font></font>
   <span class="hljs-comment">//  </span>
   OCR0B = <span class="hljs-number">160</span>;<font></font>
   PORTB &amp;=(~(<span class="hljs-number">1</span>&lt;&lt;IN3)); <font></font>
    <font></font>
}<font></font>
<font></font>
unsigned <span class="hljs-keyword">char</span> step_counter = <span class="hljs-number">0</span>; <font></font>
<font></font>
<span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">L293D_step</span> (<span class="hljs-params">unsigned <span class="hljs-keyword">int</span> step_quantity, unsigned <span class="hljs-keyword">char</span> direction, unsigned <span class="hljs-keyword">int</span> step_delay, unsigned <span class="hljs-keyword">char</span> phase</span>)</span> { <span class="hljs-comment">//      </span><font></font>
<font></font>
    <span class="hljs-keyword">while</span>(step_quantity&gt;<span class="hljs-number">0</span>) { <span class="hljs-comment">//  ,      </span><font></font>
<font></font>
        <span class="hljs-keyword">switch</span>(direction) { <span class="hljs-comment">//           </span><font></font>
	<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
				<span class="hljs-keyword">if</span>(step_counter&lt;<span class="hljs-number">3</span>) { step_counter++; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">0</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
				<span class="hljs-keyword">if</span>(step_counter&gt;<span class="hljs-number">0</span>) { step_counter--; } <span class="hljs-keyword">else</span> { step_counter=<span class="hljs-number">3</span>; }
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
		<span class="hljs-keyword">switch</span>(phase) { <span class="hljs-comment">//     </span><font></font>
		<font></font>
		    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
			<font></font>
			<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
			<font></font>
				<span class="hljs-keyword">switch</span>(step_counter) { <span class="hljs-comment">//   </span><font></font>
	<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<font></font>
						step_1_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
						step_2_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
						step_3_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<font></font>
						step_4_two_phase_DL();<font></font>
					<span class="hljs-keyword">break</span>;<font></font>
	<font></font>
				}<font></font>
			<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		<font></font>
		}<font></font>
		<font></font>
    delay_millisecond(step_delay); <span class="hljs-comment">//       </span><font></font>
	<font></font>
	step_quantity--; <font></font>
	<font></font>
	} <font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PWM_init</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//   </span><font></font>
<font></font>
    DDRB |=(<span class="hljs-number">1</span>&lt;&lt;PWM_1); <font></font>
	<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;PWM_2);<font></font>
<font></font>
    TCCR0A = (<span class="hljs-number">1</span>&lt;&lt;WGM01)|(<span class="hljs-number">1</span>&lt;&lt;WGM00)|(<span class="hljs-number">1</span>&lt;&lt;COM0A1)|(<span class="hljs-number">0</span>&lt;&lt;COM0A0)|(<span class="hljs-number">1</span>&lt;&lt;COM0B1)|(<span class="hljs-number">0</span>&lt;&lt;COM0B0); <span class="hljs-comment">//  FAST PWM,   </span><font></font>
	<font></font>
    TCCR0B = (<span class="hljs-number">0</span>&lt;&lt;WGM02)|(<span class="hljs-number">0</span>&lt;&lt;CS02)|(<span class="hljs-number">0</span>&lt;&lt;CS01)|(<span class="hljs-number">1</span>&lt;&lt;CS00); <span class="hljs-comment">//   8</span><font></font>
	<font></font>
    OCR0A = <span class="hljs-number">160</span>; <font></font>
	<font></font>
    OCR0B = <span class="hljs-number">160</span>;<font></font>
<font></font>
} <span class="hljs-comment">//    </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> (<span class="hljs-params"><span class="hljs-keyword">void</span></span>)</span> { <span class="hljs-comment">//  </span><font></font>
<font></font>
    DDRA |=(<span class="hljs-number">1</span>&lt;&lt;LED_pin);<font></font>
	<font></font>
	DDRA |=(<span class="hljs-number">1</span>&lt;&lt;IN1)|(<span class="hljs-number">1</span>&lt;&lt;IN2);<font></font>
	<font></font>
	DDRB |=(<span class="hljs-number">1</span>&lt;&lt;IN3)|(<span class="hljs-number">1</span>&lt;&lt;IN4);<font></font>
	<font></font>
	PWM_init(); <span class="hljs-comment">//  </span><font></font>
	<font></font>
	delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
	<font></font>
	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>) { <span class="hljs-comment">//  </span><font></font>
<font></font>
	    LED_ON;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'F'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>); <span class="hljs-comment">//step( ,  F/B,   , / )</span><font></font>
		<font></font>
            delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	    LED_OFF;<font></font>
		<font></font>
	    L293D_step(<span class="hljs-number">16</span>,<span class="hljs-string">'B'</span>,<span class="hljs-number">100</span>,<span class="hljs-number">2</span>);<font></font>
		<font></font>
	    delay_millisecond(<span class="hljs-number">2000</span>);<font></font>
		<font></font>
	<font></font>
	   <font></font>
	} <font></font>
<font></font>
} </code></pre><br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi d'expliquer un peu comment ce programme fonctionne. Il s'agit d'un code modifié de la première expérience. Comme je l'ai dit plus haut, un TIMER0 8 bits sera utilisé pour générer un signal PWM aux sorties OC0A et OC0B. La minuterie est réglée sur le mode FastPWM avec un pré-échelle de 8 (la fréquence du signal à 8 MHz de l'horloge du microcontrôleur est de 3906 Hz). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour changer la polarité des signaux sur les enroulements, la broche du microcontrôleur est commutée de Vcc à GND en changeant le bit correspondant dans le registre PORTx et en changeant le rapport cyclique PWM en écrivant des valeurs dans les registres OCR0A et OCR0B (les valeurs ont été sélectionnées expérimentalement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et donc:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yvaAGt1vhxs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un cours sur les circuits pris au cours de la première année de l'institut suggère que le multimètre affiche la valeur efficace de la tension et du courant dans le moteur. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moteur pas à pas tourne à partir des broches du microcontrôleur sans pilotes! </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ici, nous n'allons pas au-delà des capacités du microcontrôleur, du moins, selon ce qui est écrit dans la documentation. </font><font style="vertical-align: inherit;">Dans ce mode, le microcontrôleur et le moteur peuvent fonctionner pendant longtemps. </font><font style="vertical-align: inherit;">En effet, l'expérience a duré 20 minutes. </font><font style="vertical-align: inherit;">Pendant ce temps, il n'y a eu aucune étape de saut, aucune réinitialisation du contrôleur ou surchauffe (ni le moteur ni le contrôleur).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mettez de côté toutes les précautions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous retirons le PWM de l'expérience et nous contrôlerons directement les broches du microcontrôleur à l'aide des registres PORTx. </font><font style="vertical-align: inherit;">Voyons ce qui arrive au microcontrôleur après cela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne ... avec un courant maximum de 51mA ... Eh bien ... de façon inattendue, il semble que ce soit le courant maximum que peut donner une broche du microcontrôleur? </font><font style="vertical-align: inherit;">Si je me trompe, corrigez-moi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tout cas, la vidéo de YouTube n'a pas été trompée. </font><font style="vertical-align: inherit;">En effet, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez contrôler ce moteur sans aucun pilote</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">résultats</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons étudié en détail les moteurs pas à pas bipolaires miniatures, leur conception et comment les contrôler, pour une utilisation dans nos propres applications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Le moteur pas à pas bipolaire miniature avec un rotor à aimant permanent est vraiment miniature. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ses principales caractéristiques:</font></font><br>
<br>
<ul>
<li>   ,  ,    ( , ,  16);</li>
<li>    (   ),     1875 /;</li>
<li>     (    );</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Le moteur pas à pas miniature peut être contrôlé par n'importe quel pilote adapté pour travailler avec des moteurs pas à pas bipolaires, il vous suffit de sélectionner les paramètres de courant d'enroulement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. L'utilisation d'un pilote TMC2208 spécialisé est un problème controversé, car le mode micropas n'est pas pris en charge par le moteur lui-même, bien que les transitions entre les étapes soient effectuées plus en douceur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Il est possible de connecter un moteur pas à pas directement aux ports du microcontrôleur. </font><font style="vertical-align: inherit;">Mais ce n'est que dans le cadre de l'expérience, car le couple dans ce cas est très insignifiant, et même un petit courant ne permet pas de faire des pas à grande vitesse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prochaine fois, je vais vous expliquer pourquoi nous avions besoin de si petits moteurs pas à pas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498760/index.html">Cours de formation gratuits en quarantaine: commerce, gestion, marketing</a></li>
<li><a href="../fr498762/index.html">Les contrefaçons sont-elles stupides ou sérieuses?</a></li>
<li><a href="../fr498766/index.html">Meilleures comédies informatiques. Top 3 des émissions de télévision</a></li>
<li><a href="../fr498768/index.html">Utilisation d'un détecteur de fumée dans les véhicules</a></li>
<li><a href="../fr498782/index.html">Expérimentateurs de bataille - Science du sable et du bâton - Inoculation de la pensée scientifique dans l'esprit du public</a></li>
<li><a href="../fr498796/index.html">Politique de sécurité du contenu dans Magento 2</a></li>
<li><a href="../fr498798/index.html">Continuez à apprendre et à apprendre avec JetBrains</a></li>
<li><a href="../fr498800/index.html">Comment j'ai appris à mon ordinateur à jouer à Dobble avec OpenCV et Deep Learning</a></li>
<li><a href="../fr498808/index.html">Vim avec prise en charge YAML pour Kubernetes</a></li>
<li><a href="../fr498814/index.html">Vous avez échoué une question théorique sur la sécurité sociale, et ils ont mis fin à vous. C'est normal? // Nous sommes condamnés # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>