<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✌🏾 🧜🏾 ➗ 小さなリポジトリのより多くのサイト統計 👩🏼‍✈️ ⚔️ 🤹🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="サイトの統計を分析することで、サイトで何が起こっているのかがわかります。結果を製品やサービスに関する他の知識と比較することで、経験を向上させます。
 
 最初の結果の分析が完了し、情報が理解され、結論が出されると、次の段階が始まります。アイデアが生まれます。別の視点からデータを見るとどうなりますか？...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>小さなリポジトリのより多くのサイト統計</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463493/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトの統計を分析することで、サイトで何が起こっているのかがわかります。結果を製品やサービスに関する他の知識と比較することで、経験を向上させます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の結果の分析が完了し、情報が理解され、結論が出されると、次の段階が始まります。アイデアが生まれます。別の視点からデータを見るとどうなりますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点で、分析ツールには制限があります。これは、Googleアナリティクスツールでは十分ではなかった理由の1つです。つまり、データを表示および操作する機能が制限されていたためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本データ（マスターデータ）をすばやく読み込んだり、別のレベルの集計を追加したり、既存の値を解釈したりすることを常に望んでいました。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">小さなストレージ</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
で簡単にでき</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> access.logファイルに基づいており、SQL言語で十分です。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、どのような質問に対する答えを見つけたかったのでしょうか。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトで何がいつ変更されたか</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基礎となるデータ（マスターデータ）の変更履歴は常に重要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ew/p4/yd/ewp4yd4bsspfxtobssjrfg7tp6g.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLレポート要求</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
	<span class="hljs-number">1</span> <span class="hljs-keyword">as</span> <span class="hljs-string">'SideStackedBar: Content Updates by Months'</span>,<font></font>
	strftime(<span class="hljs-string">'%m/%Y'</span>, datetime(UPDATE_DT, <span class="hljs-string">'unixepoch'</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Day'</span>,
	<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">THEN</span> DIM_REQUEST_ID <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Web page updates'</span>,
	<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> PAGE_DESCR = <span class="hljs-string">'IMAGES'</span> <span class="hljs-keyword">THEN</span> DIM_REQUEST_ID <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Image uploads'</span>,
	<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> PAGE_DESCR = <span class="hljs-string">'VIDEO'</span> <span class="hljs-keyword">THEN</span> DIM_REQUEST_ID <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Video uploads'</span>,
	<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> PAGE_DESCR = <span class="hljs-string">'AUDIO'</span> <span class="hljs-keyword">THEN</span> DIM_REQUEST_ID <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Audio uploads'</span>
<span class="hljs-keyword">FROM</span> DIM_REQUEST
<span class="hljs-keyword">WHERE</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">OR</span> PAGE_DESCR != <span class="hljs-string">'n.a.'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> strftime(<span class="hljs-string">'%m/%Y'</span>, datetime(UPDATE_DT, <span class="hljs-string">'unixepoch'</span>))
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> UPDATE_DT</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、ある時点で、検索エンジンの最適化が実行された、または新しいコンテンツがサイトに追加された、この点で、トラフィックの増加が予想されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーのグループ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループの最も単純な例は、ユーザーエージェントまたはオペレーティングシステムの名前です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーエージェントの測定には約1000件のレコードが蓄積されており、グループ内のエージェントの分布のダイナミクスを確認することに興味がありました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/5t/e8/jf5te8lwo8aig--witfbv71c0jy.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLレポート要求</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
	<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'SideStackedBar: User Agents'</span>,<font></font>
	AGENT_OS <span class="hljs-keyword">AS</span> <span class="hljs-string">'OS'</span>,
	<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> AGENT_BOT = <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> ) <span class="hljs-keyword">AS</span> <span class="hljs-string">'User Agent of Users'</span>,
	<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> AGENT_BOT != <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> ) <span class="hljs-keyword">AS</span> <span class="hljs-string">'User Agent of Bots'</span>
<span class="hljs-keyword">FROM</span> DIM_USER_AGENT
<span class="hljs-keyword">WHERE</span> DIM_USER_AGENT_ID != <span class="hljs-number">-1</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> AGENT_OS
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">3</span> <span class="hljs-keyword">DESC</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エージェントのさまざまな組み合わせのほとんどは、Windowsの世界からサイトにアクセスします。</font><font style="vertical-align: inherit;">不確かなものの中には、WhatsApp、PocketImageCache、PlayStation、SmartTVなどがありました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">毎週のユーザーグループアクティビティ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのグループを組み合わせると、その活動の分布を観察できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、Linuxクラスタのユーザーは、他の誰よりもサイト上のトラフィックを多く消費します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ei/vq/60/eivq60u6x7mp2plf5xqgrbv5rnq.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLレポート要求</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">as</span> <span class="hljs-string">'StackedBar: Traffic Volume by User OS and by Week'</span>,<font></font>
strftime(<span class="hljs-string">'%W week'</span>, datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Week'</span>,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> USG.AGENT_OS <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Android'</span>, <span class="hljs-string">'Linux'</span>) <span class="hljs-keyword">THEN</span> FCT.BYTES <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>)/<span class="hljs-number">1000</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'Android/Linux Users'</span>,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> USG.AGENT_OS <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Windows'</span>) <span class="hljs-keyword">THEN</span> FCT.BYTES <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>)/<span class="hljs-number">1000</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'Windows Users'</span>,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> USG.AGENT_OS <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Macintosh'</span>, <span class="hljs-string">'iOS'</span>) <span class="hljs-keyword">THEN</span> FCT.BYTES <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>)/<span class="hljs-number">1000</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'Mac/iOS Users'</span>,
<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> USG.AGENT_OS <span class="hljs-keyword">IN</span> (<span class="hljs-string">'n.a.'</span>, <span class="hljs-string">'BlackBerry'</span>) <span class="hljs-keyword">THEN</span> FCT.BYTES <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>)/<span class="hljs-number">1000</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'Other'</span>
<span class="hljs-keyword">FROM</span><font></font>
  FCT_ACCESS_USER_AGENT_DD FCT,<font></font>
  DIM_USER_AGENT USG,<font></font>
  DIM_HTTP_STATUS HST<font></font>
<span class="hljs-keyword">WHERE</span> FCT.DIM_USER_AGENT_ID=USG.DIM_USER_AGENT_ID
  <span class="hljs-keyword">AND</span> FCT.DIM_HTTP_STATUS_ID = HST.DIM_HTTP_STATUS_ID
  <span class="hljs-keyword">AND</span> USG.AGENT_BOT = <span class="hljs-string">'n.a.'</span> <span class="hljs-comment">/* users only */</span>
  <span class="hljs-keyword">AND</span> HST.STATUS_GROUP <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Successful'</span>) <span class="hljs-comment">/* good pages */</span>
  <span class="hljs-keyword">AND</span> datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>) &gt; <span class="hljs-built_in">date</span>(<span class="hljs-string">'now'</span>, <span class="hljs-string">'-3 month'</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> strftime(<span class="hljs-string">'%W week'</span>, datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>))
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> FCT.EVENT_DT</code></pre><br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交通量の多い</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルには、最もアクティブなユーザーグループとそのアクティビティの日が表示されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最もアクティブなものはLinuxクラスターに属しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/np/tx/3f/nptx3flvgdvq2rooddxfxjg6xx4.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQLレポート要求</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> <span class="hljs-string">'Table: User Agent with Havy Usage'</span>,<font></font>
strftime(<span class="hljs-string">'%d.%m.%Y'</span>, datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Day'</span>,
<span class="hljs-keyword">ROUND</span>(<span class="hljs-number">1.0</span>*<span class="hljs-keyword">SUM</span>(FCT.BYTES)/<span class="hljs-number">1000000</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Traffic MB'</span>,
<span class="hljs-keyword">ROUND</span>(<span class="hljs-number">1.0</span>*<span class="hljs-keyword">SUM</span>(FCT.IP_CNT)/<span class="hljs-keyword">SUM</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'IPs'</span>,
<span class="hljs-keyword">ROUND</span>(<span class="hljs-number">1.0</span>*<span class="hljs-keyword">SUM</span>(FCT.REQUEST_CNT)/<span class="hljs-keyword">SUM</span>(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Requests'</span>,<font></font>
USA.DIM_USER_AGENT_ID <span class="hljs-keyword">AS</span> <span class="hljs-string">'ID'</span>,
<span class="hljs-keyword">MAX</span>(USA.USER_AGENT_NK) <span class="hljs-keyword">AS</span> <span class="hljs-string">'User Agent'</span>,
<span class="hljs-keyword">MAX</span>(USA.AGENT_BOT) <span class="hljs-keyword">AS</span> <span class="hljs-string">'Bot'</span>
<span class="hljs-keyword">FROM</span><font></font>
FCT_ACCESS_USER_AGENT_DD FCT,<font></font>
DIM_USER_AGENT USA<font></font>
<span class="hljs-keyword">WHERE</span> FCT.DIM_USER_AGENT_ID = USA.DIM_USER_AGENT_ID
  <span class="hljs-keyword">AND</span> datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>) &gt;= <span class="hljs-built_in">date</span>(<span class="hljs-string">'now'</span>, <span class="hljs-string">'-30 day'</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> USA.DIM_USER_AGENT_ID, strftime(<span class="hljs-string">'%d.%m.%Y'</span>, datetime(FCT.EVENT_DT, <span class="hljs-string">'unixepoch'</span>)) 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SUM</span>(FCT.BYTES) <span class="hljs-keyword">DESC</span>, FCT.EVENT_DT
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
日属性とエージェントID属性を使用すると、個々のユーザーグループの日の統計をすばやく見つけて追跡できます。</font><font style="vertical-align: inherit;">必要に応じて、ステージテーブルで詳細情報をすばやく見つけることができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報を入手するには？</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">access.logファイルの情報は、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加のデータソースを統合し、新しいレベルの集約とグループ化を導入することで、さらに効果的にすることができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的なデータとエンティティ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本データには、エンティティに関する情報が含まれます：Webページ、写真、ビデオおよびオーディオコンテンツ、店舗の場合は製品。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンティティ自体がディメンションの役割を果たし、属性の変更を保存するプロセスは履歴化と呼ばれます。</font><font style="vertical-align: inherit;">データベースでは、このプロセスは多くの場合、緩やかに変化するディメンション（SCD）の形で実装されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまなシステムが基本データのソースになる可能性があるため、ほとんどの場合、それらを統合する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゆっくりと変化する次元</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DIM_REQUESTディメンションには、サイト上のクエリに関する情報が履歴形式で含まれます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCD2テーブル</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> DIM_REQUEST ( <span class="hljs-comment">/* scd table for user requests */</span>
  DIM_REQUEST_ID      <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span> AUTOINCREMENT,<font></font>
  DIM_REQUEST_ID_HIST <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">-1</span>,<font></font>
  REQUEST_NK          <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'n.a.'</span>, <span class="hljs-comment">/* request without ?parameters */</span>
  PAGE_TITLE          <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'n.a.'</span>,<font></font>
  PAGE_DESCR          <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'n.a.'</span>,<font></font>
  PAGE_KEYWORDS       <span class="hljs-built_in">TEXT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'n.a.'</span>,<font></font>
  DELETE_FLAG         <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<font></font>
  UPDATE_DT           <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  <span class="hljs-keyword">UNIQUE</span> (REQUEST_NK, DIM_REQUEST_ID_HIST)<font></font>
);<font></font>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> DIM_REQUEST (DIM_REQUEST_ID) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">-1</span>);</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに加えて、常に最後の状態のすべてのレコードを表示する1つのビューを作成します。</font><font style="vertical-align: inherit;">測定自体をロードする必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l_/mx/f7/l_mxf7tivchzxir_wwhxd_smeq8.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCD2の現在のビュー</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Content: actual view on scd table */</span>
<span class="hljs-keyword">SELECT</span> HI.DIM_REQUEST_ID,<font></font>
  HI.DIM_REQUEST_ID_HIST,<font></font>
  HI.REQUEST_NK,<font></font>
  HI.PAGE_TITLE,<font></font>
  HI.PAGE_DESCR,<font></font>
  HI.PAGE_KEYWORDS,<font></font>
  NK.CNT <span class="hljs-keyword">AS</span> HIST_CNT,<font></font>
  HI.DELETE_FLAG,<font></font>
  strftime(<span class="hljs-string">'%d.%m.%Y %H:%M'</span>, datetime(HI.UPDATE_DT, <span class="hljs-string">'unixepoch'</span>)) <span class="hljs-keyword">AS</span> UPDATE_DT
<span class="hljs-keyword">FROM</span>
  ( <span class="hljs-keyword">SELECT</span> REQUEST_NK, <span class="hljs-keyword">MAX</span>(DIM_REQUEST_ID) <span class="hljs-keyword">AS</span> DIM_REQUEST_ID, <span class="hljs-keyword">SUM</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> CNT
    <span class="hljs-keyword">FROM</span> DIM_REQUEST
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> REQUEST_NK<font></font>
  ) NK,<font></font>
  DIM_REQUEST HI<font></font>
<span class="hljs-keyword">WHERE</span> <span class="hljs-number">1</span> = <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> NK.REQUEST_NK = HI.REQUEST_NK
  <span class="hljs-keyword">AND</span> NK.DIM_REQUEST_ID = HI.DIM_REQUEST_ID;</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、各レコードの履歴情報が収集される場所のビュー。</font><font style="vertical-align: inherit;">事実と歴史的に正しいつながりを築く必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/12/d1/pm12d1iahjmnaq8yebudgzv7ayi.png" alt="画像"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCD2の歴史観</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Content: actual view on scd table */</span>
<span class="hljs-keyword">SELECT</span> SCD.DIM_REQUEST_ID,<font></font>
  SCD.DIM_REQUEST_ID_HIST,<font></font>
  SCD.REQUEST_NK,<font></font>
  SCD.PAGE_TITLE,<font></font>
  SCD.PAGE_DESCR,<font></font>
  SCD.PAGE_KEYWORDS,<font></font>
  SCD.DELETE_FLAG,<font></font>
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> HIS.UPDATE_DT <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
    <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> ACTIVE_FLAG,<font></font>
  SCD.DIM_REQUEST_ID_HIST <span class="hljs-keyword">AS</span> ID_FROM,<font></font>
  SCD.DIM_REQUEST_ID <span class="hljs-keyword">AS</span> ID_TO,
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> SCD.DIM_REQUEST_ID_HIST=<span class="hljs-number">-1</span>
    <span class="hljs-keyword">THEN</span> <span class="hljs-number">3600</span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IFNULL</span>(HIS.UPDATE_DT,SCD.UPDATE_DT)
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> TIME_FROM,
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> HIS.UPDATE_DT <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
    <span class="hljs-keyword">THEN</span> <span class="hljs-number">253370764800</span>
    <span class="hljs-keyword">ELSE</span> HIS.UPDATE_DT
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> TIME_TO,
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> SCD.DIM_REQUEST_ID_HIST=<span class="hljs-number">-1</span>
    <span class="hljs-keyword">THEN</span> STRFTIME(<span class="hljs-string">'%d.%m.%Y %H:%M'</span>, DATETIME(<span class="hljs-number">3600</span>, <span class="hljs-string">'unixepoch'</span>))
    <span class="hljs-keyword">ELSE</span> STRFTIME(<span class="hljs-string">'%d.%m.%Y %H:%M'</span>, DATETIME(<span class="hljs-keyword">IFNULL</span>(HIS.UPDATE_DT,SCD.UPDATE_DT), <span class="hljs-string">'unixepoch'</span>))
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> ACTIVE_FROM,
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> HIS.UPDATE_DT <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
    <span class="hljs-keyword">THEN</span> STRFTIME(<span class="hljs-string">'%d.%m.%Y %H:%M'</span>, DATETIME(<span class="hljs-number">253370764800</span>, <span class="hljs-string">'unixepoch'</span>))
    <span class="hljs-keyword">ELSE</span> STRFTIME(<span class="hljs-string">'%d.%m.%Y %H:%M'</span>, DATETIME(HIS.UPDATE_DT, <span class="hljs-string">'unixepoch'</span>))
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> ACTIVE_TO
<span class="hljs-keyword">FROM</span><font></font>
  DIM_REQUEST SCD<font></font>
  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> DIM_REQUEST HIS
  <span class="hljs-keyword">ON</span> SCD.REQUEST_NK = HIS.REQUEST_NK <span class="hljs-keyword">AND</span> SCD.DIM_REQUEST_ID = HIS.DIM_REQUEST_ID_HIST;</code></pre><br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ集約</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
圧縮（集計）を使用すると、より高いレベルでデータを評価し、詳細レポートには表示されない異常や傾向を検出できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、リクエストステータスコードがDIM_HTTP_STATUSのディメンションに、グループを追加します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステータス/グループ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0xx / na </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1xx /情報</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2xx /成功</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3xx /リダイレクト</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4xx /クライアントエラー</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5xx /サーバーエラー</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーエージェントディメンションDIM_USER_AGENTには、グループのAGENT_OSおよびAGENT_BOT属性が含まれます。</font><font style="vertical-align: inherit;">ETLプロセス中に入力できます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIM_USER_AGENTをダウンロード</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Propagate the user agent from access log */</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> DIM_USER_AGENT (USER_AGENT_NK, AGENT_OS, AGENT_ENGINE, AGENT_DEVICE, AGENT_BOT, UPDATE_DT)
<span class="hljs-keyword">WITH</span> CLS <span class="hljs-keyword">AS</span> (
	<span class="hljs-keyword">SELECT</span> BROWSER
	<span class="hljs-keyword">FROM</span> STG_ACCESS_LOG <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">LENGTH</span>(BROWSER)&gt;<span class="hljs-number">1</span>
	<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> BROWSER<font></font>
)<font></font>
<span class="hljs-keyword">SELECT</span>
	CLS.BROWSER <span class="hljs-keyword">AS</span> USER_AGENT_NK,
	<span class="hljs-keyword">CASE</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Macintosh'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'Macintosh'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPhone'</span>)&gt;<span class="hljs-number">0</span>
			 <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPad'</span>)&gt;<span class="hljs-number">0</span>
			 <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPod'</span>)&gt;<span class="hljs-number">0</span>
			 <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Apple TV'</span>)&gt;<span class="hljs-number">0</span>
			 <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Darwin'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'iOS'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'Android'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'X11;'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Wayland;'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'linux-gnu'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'Linux'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'BB10;'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'BlackBerry'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'BlackBerry'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Windows'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'Windows'</span>
	<span class="hljs-keyword">ELSE</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> AGENT_OS, <span class="hljs-comment">-- OS</span>
	<span class="hljs-keyword">CASE</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'AppleCoreMedia'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'AppleWebKit'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">') '</span>)&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">LENGTH</span>(CLS.BROWSER)&gt;<span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">') '</span>)
		<span class="hljs-keyword">THEN</span> <span class="hljs-keyword">COALESCE</span>(<span class="hljs-keyword">SUBSTR</span>(CLS.BROWSER, <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">') '</span>)+<span class="hljs-number">2</span>, <span class="hljs-keyword">LENGTH</span>(CLS.BROWSER) - <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">') '</span>)<span class="hljs-number">-1</span>), <span class="hljs-string">'N/A'</span>)
	<span class="hljs-keyword">ELSE</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> AGENT_ENGINE, <span class="hljs-comment">-- Engine</span>
	<span class="hljs-keyword">CASE</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPhone'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'iPhone'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPad'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'iPad'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'iPod'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'iPod'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Apple TV'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'Apple TV'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Build'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-keyword">COALESCE</span>(<span class="hljs-keyword">SUBSTR</span>(CLS.BROWSER, <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>), <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Build'</span>)-<span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>)), <span class="hljs-string">'n.a.'</span>)
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'MIUI'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-keyword">COALESCE</span>(<span class="hljs-keyword">SUBSTR</span>(CLS.BROWSER, <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>), <span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'MIUI'</span>)-<span class="hljs-keyword">INSTR</span>(CLS.BROWSER,<span class="hljs-string">'Android '</span>)), <span class="hljs-string">'n.a.'</span>)
	<span class="hljs-keyword">ELSE</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> AGENT_DEVICE, <span class="hljs-comment">-- Device</span>
	<span class="hljs-keyword">CASE</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'yandex.com'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'yandex'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'googlebot'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'google'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'bingbot'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'microsoft'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'ahrefsbot'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'ahrefs'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'jobboersebot'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'jobkicks'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'job.de'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'mail.ru'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'mail.ru'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'baiduspider'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'baidu'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'mj12bot'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'majestic-12'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'duckduckgo'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'duckduckgo'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'bytespider'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'bytespider'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'360spider'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'so.360.cn'</span>
	<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'compatible'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'http'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'libwww'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'spider'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'java'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'python'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'robot'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'curl'</span>)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">INSTR</span>(<span class="hljs-keyword">LOWER</span>(CLS.BROWSER),<span class="hljs-string">'wget'</span>)&gt;<span class="hljs-number">0</span>
		<span class="hljs-keyword">THEN</span> <span class="hljs-string">'other'</span>
	<span class="hljs-keyword">ELSE</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> AGENT_BOT, <span class="hljs-comment">-- Bot</span>
	STRFTIME(<span class="hljs-string">'%s'</span>,<span class="hljs-string">'now'</span>) <span class="hljs-keyword">AS</span> UPDATE_DT
<span class="hljs-keyword">FROM</span> CLS
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> DIM_USER_AGENT TRG
<span class="hljs-keyword">ON</span> CLS.BROWSER = TRG.USER_AGENT_NK
<span class="hljs-keyword">WHERE</span> TRG.DIM_USER_AGENT_ID <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span></code></pre><br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ統合</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これには、オペレーティングシステムからレポートシステムへのデータ転送の構成が含まれます。</font><font style="vertical-align: inherit;">これを行うには、ソースと同様の構造を持つステージテーブルを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webページに関する情報は、挿入要求の形式でCMSバックアップからステージに取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
履歴DIM_REQUESTテーブルに基本データをロードするには、3つのステップが必要です。新しいキーと属性のロード、既存のキーと属性の更新、削除されたレコードの修正です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいSCD2エントリをダウンロードする</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Load request table SCD from master data */</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> DIM_REQUEST (DIM_REQUEST_ID_HIST, REQUEST_NK, PAGE_TITLE, PAGE_DESCR, PAGE_KEYWORDS, DELETE_FLAG, UPDATE_DT)
<span class="hljs-keyword">WITH</span> CLS  <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- prepare keys</span>
	<span class="hljs-keyword">SELECT</span>
	<span class="hljs-string">'/'</span> || <span class="hljs-keyword">NAME</span> <span class="hljs-keyword">AS</span> REQUEST_NK,<font></font>
	TITLE       <span class="hljs-keyword">AS</span> PAGE_TITLE,
	<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> DESCRIPTION = <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> DESCRIPTION <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
	     <span class="hljs-keyword">THEN</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">ELSE</span> DESCRIPTION
	<span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> PAGE_DESCR,
	<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> KEYWORDS = <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> KEYWORDS <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
	     <span class="hljs-keyword">THEN</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">ELSE</span> KEYWORDS
	<span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> PAGE_KEYWORDS
	<span class="hljs-keyword">FROM</span> STG_CMS_MENU
	<span class="hljs-keyword">WHERE</span> CONTENT_TYPE != <span class="hljs-string">'folder'</span> <span class="hljs-comment">-- only web pages</span>
	  <span class="hljs-keyword">AND</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-comment">-- master data which make sense</span><font></font>
)<font></font>
<span class="hljs-comment">/* new records from stage: CLS */</span>
<span class="hljs-keyword">SELECT</span>
	<span class="hljs-number">-1</span> <span class="hljs-keyword">AS</span> DIM_REQUEST_ID_HIST,<font></font>
	CLS.REQUEST_NK,<font></font>
	CLS.PAGE_TITLE,<font></font>
	CLS.PAGE_DESCR,<font></font>
	CLS.PAGE_KEYWORDS,<font></font>
	<span class="hljs-number">0</span> <span class="hljs-keyword">AS</span> DELETE_FLAG,<font></font>
	STRFTIME(<span class="hljs-string">'%s'</span>,<span class="hljs-string">'now'</span>) <span class="hljs-keyword">AS</span> UPDATE_DT
<span class="hljs-keyword">FROM</span> CLS
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span><font></font>
 (<font></font>
	<span class="hljs-keyword">SELECT</span><font></font>
	DIM_REQUEST_ID,<font></font>
	REQUEST_NK,<font></font>
	PAGE_TITLE,<font></font>
	PAGE_DESCR,<font></font>
	PAGE_KEYWORDS<font></font>
	<span class="hljs-keyword">FROM</span> DIM_REQUEST_V_ACT<font></font>
) TRG <span class="hljs-keyword">ON</span> CLS.REQUEST_NK = TRG.REQUEST_NK
<span class="hljs-keyword">WHERE</span> TRG.REQUEST_NK <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-comment">-- no such record in data mart</span></code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCD2属性の更新</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Load request table SCD from master data */</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> DIM_REQUEST (DIM_REQUEST_ID_HIST, REQUEST_NK, PAGE_TITLE, PAGE_DESCR, PAGE_KEYWORDS, DELETE_FLAG, UPDATE_DT)
<span class="hljs-keyword">WITH</span> CLS  <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- prepare keys</span>
	<span class="hljs-keyword">SELECT</span>
	<span class="hljs-string">'/'</span> || <span class="hljs-keyword">NAME</span> <span class="hljs-keyword">AS</span> REQUEST_NK,<font></font>
	TITLE       <span class="hljs-keyword">AS</span> PAGE_TITLE,
	<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> DESCRIPTION = <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> DESCRIPTION <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
	     <span class="hljs-keyword">THEN</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">ELSE</span> DESCRIPTION
	<span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> PAGE_DESCR,
	<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> KEYWORDS = <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> KEYWORDS <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>
	     <span class="hljs-keyword">THEN</span> <span class="hljs-string">'n.a.'</span> <span class="hljs-keyword">ELSE</span> KEYWORDS
	<span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> PAGE_KEYWORDS
	<span class="hljs-keyword">FROM</span> STG_CMS_MENU
	<span class="hljs-keyword">WHERE</span> CONTENT_TYPE != <span class="hljs-string">'folder'</span> <span class="hljs-comment">-- only web pages</span>
	  <span class="hljs-keyword">AND</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-comment">-- master data which make sense</span><font></font>
)<font></font>
<span class="hljs-comment">/* updated records from stage: CLS and build reference to history: HIST */</span>
<span class="hljs-keyword">SELECT</span>
	HIST.DIM_REQUEST_ID <span class="hljs-keyword">AS</span> DIM_REQUEST_ID_HIST,<font></font>
	HIST.REQUEST_NK,<font></font>
	CLS.PAGE_TITLE,<font></font>
	CLS.PAGE_DESCR,<font></font>
	CLS.PAGE_KEYWORDS,<font></font>
	<span class="hljs-number">0</span> <span class="hljs-keyword">AS</span> DELETE_FLAG,<font></font>
	STRFTIME(<span class="hljs-string">'%s'</span>,<span class="hljs-string">'now'</span>) <span class="hljs-keyword">AS</span> UPDATE_DT
<span class="hljs-keyword">FROM</span> CLS,<font></font>
     DIM_REQUEST_V_ACT TRG,<font></font>
     DIM_REQUEST HIST<font></font>
<span class="hljs-keyword">WHERE</span> CLS.REQUEST_NK = TRG.REQUEST_NK
  <span class="hljs-keyword">AND</span> TRG.DIM_REQUEST_ID = HIST.DIM_REQUEST_ID
  <span class="hljs-keyword">AND</span> ( CLS.PAGE_TITLE != HIST.PAGE_TITLE <span class="hljs-comment">/* changes only */</span>
     <span class="hljs-keyword">OR</span> CLS.PAGE_DESCR != HIST.PAGE_DESCR
     <span class="hljs-keyword">OR</span> CLS.PAGE_KEYWORDS != HIST.PAGE_KEYWORDS )</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除されたSCD2エントリ</font></font></b><div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-comment">/* Load request table SCD from master data */</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> DIM_REQUEST (DIM_REQUEST_ID_HIST, REQUEST_NK, PAGE_TITLE, PAGE_DESCR, PAGE_KEYWORDS, DELETE_FLAG, UPDATE_DT)
<span class="hljs-keyword">WITH</span> CLS  <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- prepare keys</span>
	<span class="hljs-keyword">SELECT</span>
	<span class="hljs-string">'/'</span> || <span class="hljs-keyword">NAME</span> <span class="hljs-keyword">AS</span> REQUEST_NK,<font></font>
	TITLE       <span class="hljs-keyword">AS</span> PAGE_TITLE
	<span class="hljs-keyword">FROM</span> STG_CMS_MENU
	<span class="hljs-keyword">WHERE</span> CONTENT_TYPE != <span class="hljs-string">'folder'</span> <span class="hljs-comment">-- only web pages</span>
	  <span class="hljs-keyword">AND</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-comment">-- master data which make sense</span><font></font>
)<font></font>
<span class="hljs-comment">/*  deleted records in data mart: TRG */</span>
<span class="hljs-keyword">SELECT</span>
	TRG.DIM_REQUEST_ID <span class="hljs-keyword">AS</span> DIM_REQUEST_ID_HIST,<font></font>
	TRG.REQUEST_NK,<font></font>
	TRG.PAGE_TITLE,<font></font>
	TRG.PAGE_DESCR,<font></font>
	TRG.PAGE_KEYWORDS,<font></font>
	<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> DELETE_FLAG,<font></font>
	STRFTIME(<span class="hljs-string">'%s'</span>,<span class="hljs-string">'now'</span>) <span class="hljs-keyword">AS</span> UPDATE_DT
<span class="hljs-keyword">FROM</span> (
	<span class="hljs-keyword">SELECT</span><font></font>
	DIM_REQUEST_ID,<font></font>
	REQUEST_NK,<font></font>
	PAGE_TITLE,<font></font>
	PAGE_DESCR,<font></font>
	PAGE_KEYWORDS<font></font>
	<span class="hljs-keyword">FROM</span> DIM_REQUEST_V_ACT
	<span class="hljs-keyword">WHERE</span> PAGE_TITLE != <span class="hljs-string">'n.a.'</span> <span class="hljs-comment">-- track master data only</span>
	  <span class="hljs-keyword">AND</span> DELETE_FLAG = <span class="hljs-number">0</span> <span class="hljs-comment">-- not already deleted</span><font></font>
) TRG<font></font>
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> CLS <span class="hljs-keyword">ON</span> TRG.REQUEST_NK = CLS.REQUEST_NK
<span class="hljs-keyword">WHERE</span> CLS.REQUEST_NK <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-comment">-- no such record in stage</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各データソースには、たとえばreadme.txtファイル内の正式な説明が必要です。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ受信者の形式的/技術的に：名前、メールアドレス</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データプロバイダーの形式的/技術的に：名前、電子メールアドレス</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データソース：ファイルパス、サービス名</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データへのアクセスに関する情報：ユーザーとパスワード</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データ移動スキームは、たとえばテキスト形式で、保守と更新のプロセスに役立ちます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを移動する。</font><font style="vertical-align: inherit;">ソース：ftp.domain.net：/logs/access.log目的：/var/www/access.log </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステージで読み取ります。</font><font style="vertical-align: inherit;">ターゲット：STG_ACCESS_LOG </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダウンロードおよび変換。</font><font style="vertical-align: inherit;">ターゲット：FCT_ACCESS_REQUEST_REF_HH </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダウンロードと変換。</font><font style="vertical-align: inherit;">ターゲット：FCT_ACCESS_USER_AGENT_DD </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レポート。</font><font style="vertical-align: inherit;">ターゲット：/var/www/report.html</font></font></blockquote> <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、この記事では、基本データの統合や新しいレベルの集計の導入などのメカニズムについて説明します。</font><font style="vertical-align: inherit;">これらは、追加の知識を得て情報の品質を向上させるためにデータウェアハウスを構築するときに必要です。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja463477/index.html">静かで静か：2つのノイズ低減レベルを備えたdBud耳栓</a></li>
<li><a href="../ja463481/index.html">WMSの離散数学：セル内の商品を圧縮するアルゴリズム（パート1）</a></li>
<li><a href="../ja463483/index.html">ドキュメントのコラボレーション、更新された企業チャット、モバイルアプリ：Zextras Suite 3.0の新機能</a></li>
<li><a href="../ja463489/index.html">ヘビーメタルは嘘をついた：実際、ヘビーミュージックはファンの健康にプラスの影響を与える</a></li>
<li><a href="../ja463491/index.html">メタルギアソリッドの奇妙な英訳ストーリー</a></li>
<li><a href="../ja463495/index.html">Laravelキャッシング：基本とヒントとコツ</a></li>
<li><a href="../ja463497/index.html">在庫効率計算機と物事がうまくいかない5つの理由</a></li>
<li><a href="../ja463499/index.html">快適なオフィス-仕事に役立ちますか、それとも邪魔になり注意散漫になりますか？Sidenis、Alternativa Games、FunBoxが回答します</a></li>
<li><a href="../ja463503/index.html">なぜ現代のウェブ開発はそんなに複雑なのですか？パート1</a></li>
<li><a href="../ja463505/index.html">システム管理者がDevOpsエンジニアになる理由</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>