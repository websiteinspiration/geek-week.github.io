<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∂Ô∏è üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üõ¢Ô∏è Einige Tipps zur Beschleunigung der Erstellung von Docker-Images. Zum Beispiel bis zu 30 Sekunden üë∞üèø üë©üèΩ‚Äç‚úàÔ∏è üö∂üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bevor das Feature in den Handel kommt, haben komplexe Orchestratoren und CI / CD in unserer Zeit noch einen langen Weg vom Festschreiben bis zum Teste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Einige Tipps zur Beschleunigung der Erstellung von Docker-Images. Zum Beispiel bis zu 30 Sekunden</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/501680/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bevor das Feature in den Handel kommt, haben komplexe Orchestratoren und CI / CD in unserer Zeit noch einen langen Weg vom Festschreiben bis zum Testen und Ausliefern vor sich. </font><font style="vertical-align: inherit;">Bisher war es m√∂glich, neue Dateien √ºber FTP hochzuladen (das macht sonst niemand, oder?), Und der Bereitstellungsprozess dauerte Sekunden. </font><font style="vertical-align: inherit;">Jetzt m√ºssen Sie eine Zusammenf√ºhrungsanforderung erstellen und eine betr√§chtliche Zeit warten, bis die Funktion die Benutzer erreicht.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Teil dieser Reise besteht darin, ein Docker-Image zu erstellen. </font><font style="vertical-align: inherit;">Manchmal dauert die Montage Minuten, manchmal zehn Minuten, was kaum als normal bezeichnet werden kann. </font><font style="vertical-align: inherit;">In diesem Artikel nehmen wir eine einfache Anwendung, die wir in ein Bild packen, wenden verschiedene Methoden an, um die Montage zu beschleunigen, und ber√ºcksichtigen die Nuancen dieser Methoden.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/po/se/ly/poselyxzccug-jtxbstwdrpm7yg.jpeg"></p><a name="habracut"></a><br>
<p>        : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The Bell</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">" "</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Republic</a>‚Ä¶      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Reminder</a>.          ,     .</p><br>
<p>    GitLab.  ,   GitLab Registry    .      ‚Äî   .  :       14 .</p><br>
<p><img src="https://habrastorage.org/webt/pe/ih/sl/peihslyjxkii0aw14jpyuyqe91w.png"></p><br>
<p>    ,     ,    ,     .        30 !</p><br>
<p><img src="https://habrastorage.org/webt/gg/3y/4x/gg3y4xd2p1f0wg-3lv_1aw5z898.png"></p><br>
<p>  ,      Reminder',       Angular. ,   :</p><br>
<pre><code class="bash hljs">ng n app</code></pre><br>
<p>   PWA (  ):</p><br>
<pre><code class="bash hljs">ng add @angular/pwa --project app</code></pre><br>
<p>   npm-,  ,   docker-. Docker          ,   .          .     ,      .      ,     ,     ,      .    ‚Äî    .  ,  Dockerfile:</p><br>
<pre><code class="plaintext hljs">FROM node:12.16.2<font></font>
WORKDIR /app<font></font>
COPY . .<font></font>
RUN npm ci<font></font>
RUN npm run build --prod</code></pre><br>
<p>Dockerfile ‚Äî   ;    , Docker           .     .    ‚Äî    .</p><br>
<p>  :     .       ,         .           ,              . ,  :</p><br>
<ol>
<li>  ,       .<br>
<code>docker rmi $(docker images -q)</code></li>
<li>   .<br>
<code>time docker build -t app .</code></li>
<li>  src/index.html ‚Äî   .</li>
<li>   .<br>
<code>time docker build -t app .</code></li>
</ol><br>
<p>       (   ),            .   ‚Äî    ,     .   ,          ‚Äî  , ‚Äî  ,   ,      .       ,          .   ,       .</p><br>
<p> Dockerfile,  ,       .       .</p><br>
<pre><code class="bash hljs">$ time docker build -t app .<font></font>
Sending build context to Docker daemon 409MB<font></font>
Step 1/5 : FROM node:12.16.2<font></font>
Status: Downloaded newer image <span class="hljs-keyword">for</span> node:12.16.2<font></font>
Step 2/5 : WORKDIR /app<font></font>
Step 3/5 : COPY . .<font></font>
Step 4/5 : RUN npm ci<font></font>
added 1357 packages <span class="hljs-keyword">in</span> 22.47s<font></font>
Step 5/5 : RUN npm run build --prod<font></font>
Date: 2020-04-16T19:20:09.664Z - Hash: fffa0fddaa3425c55dd3 - Time: 37581ms<font></font>
Successfully built c8c279335f46<font></font>
Successfully tagged app:latest<font></font>
<font></font>
real 5m4.541s<font></font>
user 0m0.000s<font></font>
sys 0m0.000s</code></pre><br>
<p>  src/index.html    .</p><br>
<pre><code class="bash hljs">$ time docker build -t app .<font></font>
Sending build context to Docker daemon 409MB<font></font>
Step 1/5 : FROM node:12.16.2<font></font>
Step 2/5 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 3/5 : COPY . .<font></font>
Step 4/5 : RUN npm ci<font></font>
added 1357 packages <span class="hljs-keyword">in</span> 22.47s<font></font>
Step 5/5 : RUN npm run build --prod<font></font>
Date: 2020-04-16T19:26:26.587Z - Hash: fffa0fddaa3425c55dd3 - Time: 37902ms<font></font>
Successfully built 79f335df92d3<font></font>
Successfully tagged app:latest<font></font>
<font></font>
real 3m33.262s<font></font>
user 0m0.000s<font></font>
sys 0m0.000s</code></pre><br>
<p> ,     ,   <code>docker images</code>:</p><br>
<pre><code class="bash hljs">REPOSITORY   TAG      IMAGE ID       CREATED              SIZE<font></font>
app          latest   79f335df92d3   About a minute ago   1.74GB</code></pre><br>
<p>              <code>Sending build context to Docker daemon 409MB</code>.        build.       ‚Äî ¬´.¬ª, ‚Äî    ,       . 409  ‚Äî  :  ,   .</p><br>
<h2 id="umenshaem-kontekst"> </h2><br>
<p>  ,   .    ,   ,           .      ,     :      .       .dockerignore  ,     :</p><br>
<pre><code class="plaintext hljs">.git<font></font>
/node_modules</code></pre><br>
<p>    :</p><br>
<pre><code class="bash hljs">$ time docker build -t app .<font></font>
Sending build context to Docker daemon 607.2kB<font></font>
Step 1/5 : FROM node:12.16.2<font></font>
Step 2/5 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 3/5 : COPY . .<font></font>
Step 4/5 : RUN npm ci<font></font>
added 1357 packages <span class="hljs-keyword">in</span> 22.47s<font></font>
Step 5/5 : RUN npm run build --prod<font></font>
Date: 2020-04-16T19:33:54.338Z - Hash: fffa0fddaa3425c55dd3 - Time: 37313ms<font></font>
Successfully built 4942f010792a<font></font>
Successfully tagged app:latest<font></font>
<font></font>
real 1m47.763s<font></font>
user 0m0.000s<font></font>
sys 0m0.000s</code></pre><br>
<p>607.2  ‚Äî  ,  409 .        1.74  1.38:</p><br>
<pre><code class="bash hljs">REPOSITORY   TAG      IMAGE ID       CREATED         SIZE<font></font>
app          latest   4942f010792a   3 minutes ago   1.38GB</code></pre><br>
<p>     .</p><br>
<h2 id="ispolzuem-alpine"> Alpine</h2><br>
<p>       ‚Äî    .   ‚Äî  ,      .     <code>FROM</code>  Dockerfile.         Ubuntu,     nodejs.    ‚Ä¶</p><br>
<pre><code class="bash hljs">$ docker images -a | grep node<font></font>
node 12.16.2 406aa3abbc6c 17 minutes ago 916MB</code></pre><br>
<p>‚Ä¶  .    ,     Alpine Linux. Alpine ‚Äî    . -  nodejs   alpine   88.5 .      <del></del> :</p><br>
<pre><code class="plaintext hljs">FROM node:12.16.2-alpine3.11<font></font>
RUN apk --no-cache --update --virtual build-dependencies add \<font></font>
    python \<font></font>
    make \<font></font>
    g++<font></font>
WORKDIR /app<font></font>
COPY . .<font></font>
RUN npm ci<font></font>
RUN npm run build --prod</code></pre><br>
<p>    ,     . , Angular     ¬Ø(¬∞_o)/¬Ø</p><br>
<p>     619 :</p><br>
<pre><code class="bash hljs">REPOSITORY   TAG      IMAGE ID       CREATED          SIZE<font></font>
app          latest   aa031edc315a   22 minutes ago   761MB</code></pre><br>
<p>  .</p><br>
<h2 id="multisteydzh-sborka"> </h2><br>
<p> ,    ,    .</p><br>
<pre><code class="bash hljs">$ docker run app ls -lah<font></font>
total 576K<font></font>
drwxr-xr-x 1 root root 4.0K Apr 16 19:54 .<font></font>
drwxr-xr-x 1 root root 4.0K Apr 16 20:00 ..<font></font>
-rwxr-xr-x 1 root root 19 Apr 17 2020 .dockerignore<font></font>
-rwxr-xr-x 1 root root 246 Apr 17 2020 .editorconfig<font></font>
-rwxr-xr-x 1 root root 631 Apr 17 2020 .gitignore<font></font>
-rwxr-xr-x 1 root root 181 Apr 17 2020 Dockerfile<font></font>
-rwxr-xr-x 1 root root 1020 Apr 17 2020 README.md<font></font>
-rwxr-xr-x 1 root root 3.6K Apr 17 2020 angular.json<font></font>
-rwxr-xr-x 1 root root 429 Apr 17 2020 browserslist<font></font>
drwxr-xr-x 3 root root 4.0K Apr 16 19:54 dist<font></font>
drwxr-xr-x 3 root root 4.0K Apr 17 2020 e2e<font></font>
-rwxr-xr-x 1 root root 1015 Apr 17 2020 karma.conf.js<font></font>
-rwxr-xr-x 1 root root 620 Apr 17 2020 ngsw-config.json<font></font>
drwxr-xr-x 1 root root 4.0K Apr 16 19:54 node_modules<font></font>
-rwxr-xr-x 1 root root 494.9K Apr 17 2020 package-lock.json<font></font>
-rwxr-xr-x 1 root root 1.3K Apr 17 2020 package.json<font></font>
drwxr-xr-x 5 root root 4.0K Apr 17 2020 src<font></font>
-rwxr-xr-x 1 root root 210 Apr 17 2020 tsconfig.app.json<font></font>
-rwxr-xr-x 1 root root 489 Apr 17 2020 tsconfig.json<font></font>
-rwxr-xr-x 1 root root 270 Apr 17 2020 tsconfig.spec.json<font></font>
-rwxr-xr-x 1 root root 1.9K Apr 17 2020 tslint.json</code></pre><br>
<p>  <code>docker run app ls -lah</code>        <code>app</code>      <code>ls -lah</code>,      .</p><br>
<p>      <code>dist</code>.    -   .   - HTTP-  nodejs.    .   ,     ¬´¬ª. ! .    nginx,     <code>dist</code>   :</p><br>
<pre><code class="nginx hljs"><span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span> default_server;
    <span class="hljs-attribute">server_name</span> localhost;
    <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;
    <span class="hljs-attribute">root</span> /app/dist;<font></font>
<font></font>
    <span class="hljs-attribute">location</span> / {
        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<font></font>
    }<font></font>
}</code></pre><br>
<p>     multi-stage build.   Dockerfile:</p><br>
<pre><code class="plaintext hljs">FROM node:12.16.2-alpine3.11 as builder<font></font>
RUN apk --no-cache --update --virtual build-dependencies add \<font></font>
    python \<font></font>
    make \<font></font>
    g++<font></font>
WORKDIR /app<font></font>
COPY . .<font></font>
RUN npm ci<font></font>
RUN npm run build --prod<font></font>
<font></font>
FROM nginx:1.17.10-alpine<font></font>
RUN rm /etc/nginx/conf.d/default.conf<font></font>
COPY nginx/static.conf /etc/nginx/conf.d<font></font>
COPY --from=builder /app/dist/app .</code></pre><br>
<p>     <code>FROM</code>  Dockerfile,       .    <code>builder</code>,      FROM     .              nginx.    :</p><br>
<pre><code class="bash hljs">REPOSITORY   TAG      IMAGE ID       CREATED          SIZE<font></font>
app          latest   2c6c5da07802   29 minutes ago   36MB</code></pre><br>
<p>       ,   :</p><br>
<pre><code class="bash hljs">docker run -p8080:80 app</code></pre><br>
<p> -p8080:80    8080       80  ,   nginx.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://localhost:8080/</a>    .  !</p><br>
<p><img src="https://habrastorage.org/webt/us/kf/st/uskfstv9s72xfhlbi1zq6iae2g4.png"></p><br>
<p>    1.74   36         .      .</p><br>
<pre><code class="bash hljs">$ time docker build -t app .<font></font>
Sending build context to Docker daemon 608.8kB<font></font>
Step 1/11 : FROM node:12.16.2-alpine3.11 as builder<font></font>
Step 2/11 : RUN apk --no-cache --update --virtual build-dependencies add python make g++<font></font>
 ---&gt; Using cache<font></font>
Step 3/11 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 4/11 : COPY . .<font></font>
Step 5/11 : RUN npm ci<font></font>
added 1357 packages <span class="hljs-keyword">in</span> 47.338s<font></font>
Step 6/11 : RUN npm run build --prod<font></font>
Date: 2020-04-16T21:16:03.899Z - Hash: fffa0fddaa3425c55dd3 - Time: 39948ms<font></font>
 ---&gt; 27f1479221e4<font></font>
Step 7/11 : FROM nginx:stable-alpine<font></font>
Step 8/11 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 9/11 : RUN rm /etc/nginx/conf.d/default.conf<font></font>
 ---&gt; Using cache<font></font>
Step 10/11 : COPY nginx/static.conf /etc/nginx/conf.d<font></font>
 ---&gt; Using cache<font></font>
Step 11/11 : COPY --from=builder /app/dist/app .<font></font>
Successfully built d201471c91ad<font></font>
Successfully tagged app:latest<font></font>
<font></font>
real 2m17.700s<font></font>
user 0m0.000s<font></font>
sys 0m0.000s</code></pre><br>
<h2 id="menyaem-poryadok-sloyov">  </h2><br>
<p>       ( <code>Using cache</code>).              <code>RUN npm ci</code> ‚Äî  47.338s.      ,     ?  ,    .   ,      ,      ,   .         ,   ,  ,  ,          ,    !      Dockerfile.</p><br>
<pre><code class="plaintext hljs">FROM node:12.16.2-alpine3.11 as builder<font></font>
RUN apk --no-cache --update --virtual build-dependencies add \<font></font>
    python \<font></font>
    make \<font></font>
    g++<font></font>
WORKDIR /app<font></font>
COPY package*.json ./<font></font>
RUN npm ci<font></font>
COPY . .<font></font>
RUN npm run build --prod<font></font>
<font></font>
FROM nginx:1.17.10-alpine<font></font>
RUN rm /etc/nginx/conf.d/default.conf<font></font>
COPY nginx/static.conf /etc/nginx/conf.d<font></font>
COPY --from=builder /app/dist/app .</code></pre><br>
<p>  package.json  package-lock.json,   ,       .  :</p><br>
<pre><code class="bash hljs">$ time docker build -t app .<font></font>
Sending build context to Docker daemon 608.8kB<font></font>
Step 1/12 : FROM node:12.16.2-alpine3.11 as builder<font></font>
Step 2/12 : RUN apk --no-cache --update --virtual build-dependencies add python make g++<font></font>
 ---&gt; Using cache<font></font>
Step 3/12 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 4/12 : COPY package*.json ./<font></font>
 ---&gt; Using cache<font></font>
Step 5/12 : RUN npm ci<font></font>
 ---&gt; Using cache<font></font>
Step 6/12 : COPY . .<font></font>
Step 7/12 : RUN npm run build --prod<font></font>
Date: 2020-04-16T21:29:44.770Z - Hash: fffa0fddaa3425c55dd3 - Time: 38287ms<font></font>
 ---&gt; 1b9448c73558<font></font>
Step 8/12 : FROM nginx:stable-alpine<font></font>
Step 9/12 : WORKDIR /app<font></font>
 ---&gt; Using cache<font></font>
Step 10/12 : RUN rm /etc/nginx/conf.d/default.conf<font></font>
 ---&gt; Using cache<font></font>
Step 11/12 : COPY nginx/static.conf /etc/nginx/conf.d<font></font>
 ---&gt; Using cache<font></font>
Step 12/12 : COPY --from=builder /app/dist/app .<font></font>
Successfully built a44dd7c217c3<font></font>
Successfully tagged app:latest<font></font>
<font></font>
real 0m46.497s<font></font>
user 0m0.000s<font></font>
sys 0m0.000s</code></pre><br>
<p>46   3  ‚Äî  !    :   ,   ,  ,   ,    ‚Äî ,  .</p><br>
<p>       CI/CD .</p><br>
<h2 id="ispolzovanie-predyduschih-obrazov-dlya-kesha">    </h2><br>
<p>     - SaaS-,         .       ,     .</p><br>
<p>       GitHub Actions.   </p><br>
<pre><code class="plaintext hljs">on:<font></font>
  push:<font></font>
    branches:<font></font>
      - master<font></font>
<font></font>
name: Test docker build<font></font>
<font></font>
jobs:<font></font>
  deploy:<font></font>
    name: Build<font></font>
    runs-on: ubuntu-latest<font></font>
    env:<font></font>
      IMAGE_NAME: docker.pkg.github.com/${{ github.repository }}/app<font></font>
      IMAGE_TAG: ${{ github.sha }}<font></font>
<font></font>
    steps:<font></font>
    - name: Checkout<font></font>
      uses: actions/checkout@v2<font></font>
<font></font>
    - name: Login to GitHub Packages<font></font>
      env:<font></font>
        TOKEN: ${{ secrets.GITHUB_TOKEN }}<font></font>
      run: |<font></font>
        docker login docker.pkg.github.com -u $GITHUB_ACTOR -p $TOKEN<font></font>
<font></font>
    - name: Build<font></font>
      run: |<font></font>
        docker build \<font></font>
          -t $IMAGE_NAME:$IMAGE_TAG \<font></font>
          -t $IMAGE_NAME:latest \<font></font>
          .<font></font>
<font></font>
    - name: Push image to GitHub Packages<font></font>
      run: |<font></font>
        docker push $IMAGE_NAME:latest<font></font>
        docker push $IMAGE_NAME:$IMAGE_TAG<font></font>
<font></font>
    - name: Logout<font></font>
      run: |<font></font>
        docker logout docker.pkg.github.com</code></pre><br>
<p>     GitHub Packages     20 :</p><br>
<p><img src="https://habrastorage.org/webt/bn/2g/kj/bn2gkjz2fmwmmo4cvatanfn9gu4.png"></p><br>
<p>   ,        :</p><br>
<pre><code class="plaintext hljs">on:<font></font>
  push:<font></font>
    branches:<font></font>
      - master<font></font>
<font></font>
name: Test docker build<font></font>
<font></font>
jobs:<font></font>
  deploy:<font></font>
    name: Build<font></font>
    runs-on: ubuntu-latest<font></font>
    env:<font></font>
      IMAGE_NAME: docker.pkg.github.com/${{ github.repository }}/app<font></font>
      IMAGE_TAG: ${{ github.sha }}<font></font>
<font></font>
    steps:<font></font>
    - name: Checkout<font></font>
      uses: actions/checkout@v2<font></font>
<font></font>
    - name: Login to GitHub Packages<font></font>
      env:<font></font>
        TOKEN: ${{ secrets.GITHUB_TOKEN }}<font></font>
      run: |<font></font>
        docker login docker.pkg.github.com -u $GITHUB_ACTOR -p $TOKEN<font></font>
<font></font>
    - name: Pull latest images<font></font>
      run: |<font></font>
        docker pull $IMAGE_NAME:latest || true<font></font>
        docker pull $IMAGE_NAME-builder-stage:latest || true<font></font>
<font></font>
    - name: Images list<font></font>
      run: |<font></font>
        docker images<font></font>
<font></font>
    - name: Build<font></font>
      run: |<font></font>
        docker build \<font></font>
          --target builder \<font></font>
          --cache-from $IMAGE_NAME-builder-stage:latest \<font></font>
          -t $IMAGE_NAME-builder-stage \<font></font>
          .<font></font>
        docker build \<font></font>
          --cache-from $IMAGE_NAME-builder-stage:latest \<font></font>
          --cache-from $IMAGE_NAME:latest \<font></font>
          -t $IMAGE_NAME:$IMAGE_TAG \<font></font>
          -t $IMAGE_NAME:latest \<font></font>
          .<font></font>
<font></font>
    - name: Push image to GitHub Packages<font></font>
      run: |<font></font>
        docker push $IMAGE_NAME-builder-stage:latest<font></font>
        docker push $IMAGE_NAME:latest<font></font>
        docker push $IMAGE_NAME:$IMAGE_TAG<font></font>
<font></font>
    - name: Logout<font></font>
      run: |<font></font>
        docker logout docker.pkg.github.com</code></pre><br>
<p>   ,     <code>build</code>.   ,   -        .          .         Docker         c nodejs ( builder).      ,    <code>$IMAGE_NAME-builder-stage</code>    GitHub Packages,           .</p><br>
<p><img src="https://habrastorage.org/webt/rm/jg/nb/rmjgnba2qdrrkiyndk8nlzu7koy.png"></p><br>
<p>      .      .</p><br>
<h2 id="predvaritelnoe-sozdanie-obrazov">  </h2><br>
<p>        ‚Äî      Dockerfile,   ,   Container Registry    .</p><br>
<p>   nodejs   Angular-.    Dockerfile.node</p><br>
<pre><code class="plaintext hljs">FROM node:12.16.2-alpine3.11<font></font>
RUN apk --no-cache --update --virtual build-dependencies add \<font></font>
    python \<font></font>
    make \<font></font>
    g++</code></pre><br>
<p>      Docker Hub:</p><br>
<pre><code class="bash hljs">docker build -t exsmund/node-for-angular -f Dockerfile.node .<font></font>
docker push exsmund/node-for-angular:latest</code></pre><br>
<p>    Dockerfile   :</p><br>
<pre><code class="plaintext hljs">FROM exsmund/node-for-angular:latest as builder<font></font>
...</code></pre><br>
<p>      ,       ,              .</p><br>
<p><img src="https://habrastorage.org/webt/0u/k9/vi/0uk9viz8qpknwfpmgjdtiijogy0.png"></p><br>
<p>      -.  ,    ,     :</p><br>
<ul>
<li> ;</li>
<li>   ;</li>
<li>-;</li>
<li>    Dockerfile,    ;</li>
<li>   CI/CD-;</li>
<li>  .</li>
</ul><br>
<p>,    ,   Docker,       .  ,      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/devopsprodigy/test-docker-build</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de501670/index.html">Wie viel kostet das Leben oder 2,1 Millionen US-Dollar pro Injektion: eine wunderbare Gentherapie</a></li>
<li><a href="../de501672/index.html">Wie Mods f√ºr Unity-Spiele entwickelt werden. Teil 2: Schreibe deinen Mod</a></li>
<li><a href="../de501674/index.html">Winkel: Machen Sie den Code f√ºr das Back-End lesbar. Bonus: APIs austauschen und Caching von Abfragen</a></li>
<li><a href="../de501676/index.html">C # -Operatoren vergleichen?: Vs if-else vs switch</a></li>
<li><a href="../de501678/index.html">Universelle GUI ~ = Ende des Elends</a></li>
<li><a href="../de501684/index.html">Kreuzgang -> einfache OTP-Clusterverwaltung</a></li>
<li><a href="../de501688/index.html">Zus√§tzliche SSR-Leistung mit Nuxt Fullstack-Server (Teil 2)</a></li>
<li><a href="../de501690/index.html">Wer ist ein DevOps-Ingenieur, was macht er, wie viel verdient er und wie wird er einer?</a></li>
<li><a href="../de501696/index.html">Dashboard Postgresql √úbersicht f√ºr postgres_exporter (Prometheus)</a></li>
<li><a href="../de501698/index.html">Wir haben die Zeit f√ºr die Entwicklung eines neuen Szenarios f√ºr die Ver√∂ffentlichung einer Anzeige von 6 Tagen auf 42 Sekunden verk√ºrzt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>