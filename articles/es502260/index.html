<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜé üëßüèΩ üöµüèª ESP-NOW es un protocolo de comunicaci√≥n alternativo para ESP8266 y ESP32. Conceptos b√°sicos üëÅÔ∏è üßëüèø‚Äçü§ù‚Äçüßëüèø üë®üèΩ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESP-NOW es un protocolo WiFi simplificado para transferir paquetes cortos entre pares de dispositivos emparejados, desarrollado y lanzado por Espressi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP-NOW es un protocolo de comunicaci√≥n alternativo para ESP8266 y ESP32. Conceptos b√°sicos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502260/"><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW es un protocolo WiFi simplificado para transferir paquetes cortos entre pares de dispositivos emparejados, desarrollado y lanzado por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en 2016.07 para los microcontroladores ESP8266 y ESP32. </font><font style="vertical-align: inherit;">Al mismo tiempo, no se utilizan procedimientos adicionales relacionados con el soporte del protocolo WiFi, lo que acelera el proceso de intercambio de paquetes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW se puede usar en Internet de las cosas para controlar fuentes de luz inteligentes, rel√©s, enchufes, otros dispositivos de control remoto, recibir informaci√≥n de sensores y otras aplicaciones.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW admite las siguientes funciones</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comunicaci√≥n cifrada y no cifrada entre dispositivos emparejados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comunicaci√≥n mixta encriptada y no encriptada entre dispositivos emparejados. </font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfiera hasta 250 bytes de informaci√≥n √∫til.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurar una funci√≥n de devoluci√≥n de llamada para informar a la capa de aplicaci√≥n, en particular, sobre el √©xito o el fracaso de la transmisi√≥n.</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW tambi√©n tiene las siguientes caracter√≠sticas y limitaciones.</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Velocidad de transmisi√≥n: no m√°s de 1 Mbps a una frecuencia de 2.4 GHz, es decir </font><font style="vertical-align: inherit;">ESP-NOW funciona en la misma frecuencia y canales que su enrutador WiFi.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocolo WiFi no utilizado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar al protocolo de baja potencia utilizado en un mouse inal√°mbrico de 2.4 GHz.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo se requiere emparejamiento inicial.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s del emparejamiento, la conexi√≥n no se rompe.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La transmisi√≥n no es compatible, solo distribuci√≥n m√∫ltiple a pares de dispositivos emparejados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se admite un m√°ximo de 20 pares, incluidos los cifrados, en un dispositivo, incluidos los pares cifrados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se admite un m√°ximo de 10 pares encriptados en el modo Estaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°ximo 6 en modo SoftAP o SoftAP + Station.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El cifrado de multidifusi√≥n no es compatible.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seguridad</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOW adopta la tecnolog√≠a de trama IEEE802.11 Action Vendor con la funci√≥n IE desarrollada por Espressif y la tecnolog√≠a de cifrado CCMP, que proporciona una soluci√≥n de comunicaci√≥n segura y sin conexi√≥n. </font><font style="vertical-align: inherit;">Un dispositivo Wi-Fi admite una clave maestra principal (PMK) y varias claves maestras locales (LMK)</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utiliza para cifrar LMK utilizando el algoritmo AES-128.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dispositivo emparejado </font><b><font style="vertical-align: inherit;">LMK</font></b><font style="vertical-align: inherit;"> se utiliza para cifrar la informaci√≥n del usuario mediante CCMP. </font><font style="vertical-align: inherit;">El n√∫mero m√°ximo de LMK diferentes es 6. Si no se establece LMK para el dispositivo emparejado, los datos del usuario no se cifrar√°n.</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un nivel b√°sico de</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el nivel inferior del protocolo ESP_NOW, se mantiene una lista vinculada que contiene informaci√≥n sobre el dispositivo local y el dispositivo emparejado, incluidas las direcciones MAC y las claves. </font><font style="vertical-align: inherit;">ESP-NOW tambi√©n almacena datos de uso frecuente para la capa de aplicaci√≥n para evitar la sobrecarga de reprocesar la lista vinculada. </font><font style="vertical-align: inherit;">La informaci√≥n sobre los dispositivos se utiliza para enviar y recibir datos e incluye </font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informaci√≥n sobre el dispositivo local:</font></font></u> <br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 bytes: la clave maestra principal que se utiliza para cifrar la clave en el dispositivo conectado (KOK en la API) ESP_NOW admite PMK de forma predeterminada, por lo que no se requiere configuraci√≥n. </font><font style="vertical-align: inherit;">Si es necesario, puede verificar que el valor PMK coincida con el dispositivo local.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte: el modo de dispositivo local que define la interfaz WiFi de transmisi√≥n (SoftAP o STA) ESP-NOW. </font><font style="vertical-align: inherit;">El modo de dispositivo emparejado no afecta a ninguna funci√≥n, sino que solo guarda la informaci√≥n del modo para la capa de aplicaci√≥n. </font><font style="vertical-align: inherit;">En el modo STA WiFi, solo es aplicable la estaci√≥n y SoftAP WiFi es solo SoftAP.</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modos de operaci√≥n del dispositivo local ESP_NOW</font></font></b>
                        <div class="spoiler_text"><blockquote><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th></th>
<th> WiFi</th>
</tr>
<tr>
<td><b>IDLE</b></td>
<td> </td>
<td>   </td>
</tr>
<tr>
<td><b>CONTROLLER</b></td>
<td></td>
<td>STA</td>
</tr>
<tr>
<td><b>SLAVE</b></td>
<td></td>
<td>SoftAP‚Ä®</td>
</tr>
<tr>
<td><b>COMBO</b></td>
<td>&amp;</td>
<td>SoftAP</td>
</tr>
</tbody></table></div></blockquote><br>
</div>
                    </div></li>
</ul><br>
<u><font style="vertical-align: inherit;"></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informaci√≥n del </font><u><font style="vertical-align: inherit;">dispositivo emparejado</font></u><font style="vertical-align: inherit;"> (incluida la informaci√≥n de uso frecuente y otra informaci√≥n del usuario):</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 16 bytes: una clave maestra local que se utiliza para cifrar la clave de informaci√≥n √∫til durante la comunicaci√≥n en este par.</font></font></li>
<li><b>MAC-</b>: 6  ‚Äî   ,    . ,     Station, MAC-     Station.</li>
<li><b></b>: 1  ‚Äî       (SoftAP  STA) ESP-NOW.</li>
<li><b></b>: 1  ‚Äî ,     ,   .   0..255.       ,         .    . , 0 ,    ; 1 ~ 14   ;       ,    .</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no recomienda el uso de operaciones largas en las funciones de devoluci√≥n de llamada al enviar / enviar paquetes, lo que presumiblemente est√° relacionado con la implementaci√≥n de algoritmos utilizando el mecanismo de interrupci√≥n. </font><font style="vertical-align: inherit;">Esta suposici√≥n tambi√©n est√° respaldada por los problemas asociados con la asignaci√≥n de memoria din√°mica en las funciones de devoluci√≥n de llamada, que se resuelve mediante el uso preferido de variables est√°ticas, as√≠ como la ambig√ºedad de usar el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mecanismo de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> excepci√≥n </font><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No se describe la </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
implementaci√≥n de la asincron√≠a de los procesos de inicio / finalizaci√≥n, emparejamiento, recepci√≥n / transmisi√≥n de paquetes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que tampoco facilita la aplicaci√≥n de la ideolog√≠a </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asyncio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato del paquete ESP-NOW</font></font></h4><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encabezado MAC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 24 bytes.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Categor√≠a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte que indica la categor√≠a del creador del paquete. </font><font style="vertical-align: inherit;">El valor est√° establecido (127).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de la organizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 bytes, contiene un identificador √∫nico, que son los primeros tres bytes de la direcci√≥n MAC utilizada por Espressif. </font><font style="vertical-align: inherit;">Valor establecido (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor aleatorio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 bytes, utilizado para proteger datos.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datos del creador del paquete</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 7-255 Bytes</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los datos del creador del paquete contienen los siguientes campos:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, establecido en (221).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Longitud</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, longitud total de identificaci√≥n de la organizaci√≥n, tipo, versi√≥n y datos del usuario.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de la organizaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3 bytes, contiene un identificador √∫nico, que son los primeros tres bytes de la direcci√≥n MAC utilizada por Espressif. </font><font style="vertical-align: inherit;">Valor establecido (0x18fe34)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, protocolo ESP-NOW. </font><font style="vertical-align: inherit;">Valor establecido (4)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versi√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 1 byte, versi√≥n actual de ESP-NOW. </font><font style="vertical-align: inherit;">Instalado (1)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : datos de usuario de 0-250 bytes.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FCS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 4 bytes, suma de verificaci√≥n</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ESP-NOW no usa WiFi, el encabezado MAC es ligeramente diferente del encabezado de paquete est√°ndar. </font><font style="vertical-align: inherit;">Los bits FromDS y ToDS del campo FrameControl son 0. La direcci√≥n de destino se especifica en el primer campo de direcci√≥n. </font><font style="vertical-align: inherit;">El segundo campo de direcci√≥n muestra la direcci√≥n de origen. </font><font style="vertical-align: inherit;">El tercer campo de direcci√≥n se establece como la direcci√≥n de difusi√≥n (0xff: 0xff: 0xff: 0xff: 0xff: 0xff).</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmo de aplicaci√≥n b√°sica</font></font></h2></u><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio y fin</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de usar ESP-NOW, se recomienda que configure la interfaz Wi-Fi en el modo deseado. </font><font style="vertical-align: inherit;">Por lo general, la interfaz de la estaci√≥n est√° configurada para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTROLLER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la interfaz SoftAP para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SLAVE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMBO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tambi√©n es recomendable detener el Wi-Fi despu√©s de usar ESP-NOW. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para iniciar ESP-NOW, llame a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_init ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para completar. </font><font style="vertical-align: inherit;">Cuando se llama a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , se elimina toda la informaci√≥n sobre dispositivos emparejados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funciones de devoluci√≥n de llamada vinculantes</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n de procesamiento de llamadas al enviar el paquete </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se puede usar para informar al nivel de la aplicaci√≥n de la parte que env√≠a en un par sobre el √©xito o el fracaso de la transmisi√≥n, por ejemplo, si la informaci√≥n en la subcapa MAC se transmite con √©xito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , considere lo siguiente: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un par vinculado:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la capa de aplicaci√≥n no recibi√≥ el paquete, pero la funci√≥n de devoluci√≥n de llamada devolvi√≥ "√©xito", la raz√≥n podr√≠a ser: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - ataques desde un dispositivo fraudulento </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - errores de instalaci√≥n de claves cifradas </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - p√©rdida de paquetes en el nivel de aplicaci√≥n Espressif</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la capa de aplicaci√≥n recibi√≥ el paquete, pero la funci√≥n de devoluci√≥n de llamada devuelve un error, la causa puede ser: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - El canal est√° ocupado y no se recibe el ACK.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con comunicaci√≥n m√∫ltiple con todos los pares del dispositivo local:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la devoluci√≥n de llamada devuelve "√©xito", significa que el paquete se envi√≥ correctamente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la funci√≥n de devoluci√≥n de llamada devuelve un error, significa que el paquete no se envi√≥ correctamente.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n de procesamiento de llamadas al recibir el paquete </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_receive_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devuelve informaci√≥n que incluye la direcci√≥n MAC del dispositivo emisor en un par e informaci√≥n √∫til. </font><font style="vertical-align: inherit;">Tambi√©n se puede utilizar para informar a la capa de aplicaci√≥n del dispositivo de env√≠o emparejado con el receptor que el paquete se recibi√≥ con √©xito.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregar un par de dispositivos emparejados</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de enviar datos, debe agregar el dispositivo a la lista de pares de dispositivos emparejados llamando a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_add_peer ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Antes de enviar datos a un grupo de pares establecidos, debe agregar un dispositivo con una direcci√≥n MAC de multidifusi√≥n. </font><font style="vertical-align: inherit;">El rango de canales de los dispositivos emparejados es de 0 a 14. Si el canal se establece en 0, los datos se enviar√°n en el canal actual. </font><font style="vertical-align: inherit;">De lo contrario, el canal debe establecerse como el canal en el que se encuentra el dispositivo local.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seguridad</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la clave necesita ser encriptada, puede llamar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_set_pmk ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para configurarla </font><font style="vertical-align: inherit;">para configurar PMK. </font><font style="vertical-align: inherit;">Si PMK no est√° instalado, PMK se usar√° de manera predeterminada y seleccionar√° la misma clave para todos los dispositivos. </font><font style="vertical-align: inherit;">Tambi√©n configure LMK para los pares seleccionados.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Env√≠o de datos con paquetes ESP-NOW</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para enviar datos ESP-NOW </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Al mismo tiempo, la funci√≥n establecida anteriormente en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devolver√° </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_SUCCESS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al enviar una funci√≥n de devoluci√≥n de llamada si los datos se recibieron con √©xito en el nivel MAC. </font><font style="vertical-align: inherit;">De lo contrario, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_FAIL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> volver√° </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Varias razones pueden hacer que ESP-NOW no pueda enviar datos. </font><font style="vertical-align: inherit;">En particular,</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el dispositivo de destino no existe;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los canales del dispositivo no coinciden;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los datos se pierden durante la transmisi√≥n.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No se garantiza que la capa de aplicaci√≥n necesariamente acepte datos. Si es necesario, puede enviar una confirmaci√≥n cuando reciba datos de ESP-NOW. Si se produce un tiempo de espera de confirmaci√≥n, la transmisi√≥n de datos ESP-NOW debe repetirse. Tambi√©n se puede asignar un n√∫mero de secuencia a los datos ESP-NOW para eliminar datos duplicados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al enviar datos ESP-NOW a trav√©s de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send (),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tenga en cuenta que no se pueden enviar m√°s de 250 bytes de informaci√≥n a la vez.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°ATENCI√ìN! Un intervalo demasiado corto entre el env√≠o de dos paquetes ESP-NOW puede conducir a errores en la ejecuci√≥n de la funci√≥n de devoluci√≥n de llamada, por lo tanto, se recomienda enviar el siguiente paquete de datos ESP-NOW despu√©s de que la funci√≥n de devoluci√≥n de llamada haya completado con √©xito el procesamiento del env√≠o anterior. La funci√≥n de devoluci√≥n de llamada se env√≠a desde una tarea de Wi-Fi de alta prioridad. Por lo tanto, no se recomienda realizar operaciones largas en la funci√≥n de devoluci√≥n de llamada. En su lugar, puede colocar los datos necesarios en una cola est√°tica y procesarlos desde un proceso con una prioridad m√°s baja.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la funci√≥n de env√≠o devuelve una direcci√≥n MAC, se enviar√° al dispositivo con esta direcci√≥n MAC. </font><font style="vertical-align: inherit;">Si la funci√≥n de env√≠o devuelve NULL, el paquete se enviar√° a todos los dispositivos conectados al remitente, lo que puede provocar fallas o retrasos en la transmisi√≥n debido a la congesti√≥n de la red.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW recibe datos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n de devoluci√≥n de llamada tambi√©n comienza desde una tarea de Wi-Fi. </font><font style="vertical-align: inherit;">Por lo tanto, no se recomienda realizar operaciones largas en la funci√≥n de devoluci√≥n de llamada. </font><font style="vertical-align: inherit;">En su lugar, puede colocar los datos necesarios en una cola est√°tica y procesarlos con un proceso de menor prioridad.</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En conclusi√≥n, lo anterior</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi experiencia en la construcci√≥n de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif IDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con ESP-NOW, describiendo los errores que encontr√© durante el ensamblaje y los solucionar√© despu√©s de lograr un resultado estable. Luego, har√© una descripci√≥n de la biblioteca ESP-NOW en MicroPython con los errores detectados y las formas de resolverlos. Desafortunadamente, debido al hecho de que el c√≥digo fuente de ESP-NOW est√° cerrado y se distribuye solo en forma binaria, la comprensi√≥n de los algoritmos del protocolo ESP-NOW es emp√≠rica y hay una serie de problemas que ya se han identificado, para los cuales no siempre hay opciones para superarlos l√≥gicamente, pero en general ESP -NOW se ha aplicado con √©xito en la comunidad de usuarios de C y Pythonists en base a m√°s de 300 aplicaciones presentadas en GitHub. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de la biblioteca ESP-NOW C de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> ESP-NOW Descripci√≥n y fuentes abiertas</font></font><i><font style="vertical-align: inherit;"></font></i></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502248/index.html">Entr√≥ en vigor un nuevo GOST para recursos digitales: todas las plataformas deber√≠an ser accesibles para personas con discapacidad</a></li>
<li><a href="../es502250/index.html">Aviaci√≥n civil hoy: aspectos importantes y desaf√≠os en la capacitaci√≥n</a></li>
<li><a href="../es502252/index.html">Control remoto y drones</a></li>
<li><a href="../es502254/index.html">PostgreSQL: programaci√≥n del lado del servidor en lenguaje humano (PL / Perl, PL / Python, PL / v8)</a></li>
<li><a href="../es502256/index.html">¬øC√≥mo visualizar un gr√°fico de Spring Integration usando Neo4j?</a></li>
<li><a href="../es502262/index.html">¬øPor qu√© AIOps y monitoreo general para el banco, o en qu√© se basan las relaciones con los clientes?</a></li>
<li><a href="../es502264/index.html">Infraestructura de Clave P√∫blica. Emisi√≥n de certificados en condiciones de autoaislamiento.</a></li>
<li><a href="../es502266/index.html">Aurora en la plataforma Intel. Amanecer de la Era Exaflops</a></li>
<li><a href="../es502268/index.html">HackTheBox. Pasando patentes. XXE a trav√©s de archivos DOCX, LFI a RCE, GIT y ROP-chain</a></li>
<li><a href="../es502272/index.html">No digas "Me siento", y otras reglas inglesas que conducen a un estupor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>