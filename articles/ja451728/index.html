<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ‚ ğŸ‘©ğŸ»â€ğŸ”¬ â˜”ï¸ RESTinioã¯éåŒæœŸHTTPã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚éåŒæœŸ ğŸš¾ ğŸ›‹ï¸ ğŸ•¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ•°å¹´å‰ã«ã€HTTPã‚µãƒ¼ãƒãƒ¼ã‚’C ++ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åŸ‹ã‚è¾¼ã‚€ãŸã‚ã®å°ã•ãªOpenSource C ++ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹RESTinioã‚’å…¬â€‹â€‹é–‹ã—ã¾ã—ãŸã€‚ã“ã®é–“ã€REStinioã¯å¤§äººæ°—ã«ãªã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€å¤±ã‚ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚èª°ã‹ãŒã€Œãƒã‚¤ãƒ†ã‚£ãƒ–ã€ã®Windowsã‚µãƒãƒ¼ãƒˆã€èª°ã‹ï¼ˆsendfil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RESTinioã¯éåŒæœŸHTTPã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚éåŒæœŸ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451728/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°å¹´å‰ã«</font><font style="vertical-align: inherit;">ã€HTTPã‚µãƒ¼ãƒãƒ¼ã‚’C ++ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åŸ‹ã‚è¾¼ã‚€ãŸã‚ã®å°ã•ãªOpenSource C ++ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RESTinio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’å…¬â€‹â€‹é–‹ã—</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã—ãŸ</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®é–“ã€REStinioã¯å¤§äººæ°—ã«ãªã‚Š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“ã§ã—ãŸ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã€å¤±ã‚</font></a><font style="vertical-align: inherit;">ã‚Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã›ã‚“ã§ã—ãŸ</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">èª°ã‹ãŒã€Œãƒã‚¤ãƒ†ã‚£ãƒ–ã€ã®Windowsã‚µãƒãƒ¼ãƒˆã€èª°ã‹ï¼ˆsendfileã‚µãƒãƒ¼ãƒˆãªã©ï¼‰ã®å€‹ã€…ã®æ©Ÿèƒ½ã€æ©Ÿèƒ½ã®æ¯”ç‡ã€ä½¿ã„ã‚„ã™ã•ã€ãŠã‚ˆã³ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®ãŸã‚ã«èª°ã‹ã‚’é¸æŠã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€æœ€åˆã¯å¤šãã®RESTinioãŒã“ã®ç°¡æ½”ãªã€ŒHelloã€Worldã€ã«æƒ¹ã‹ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚</font></font></p><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;restinio/all.hpp&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    restinio::run(<font></font>
        restinio::on_this_thread()<font></font>
        .port(<span class="hljs-number">8080</span>)<font></font>
        .address(<span class="hljs-string">"localhost"</span>)<font></font>
        .request_handler([](<span class="hljs-keyword">auto</span> req) {
            <span class="hljs-keyword">return</span> req-&gt;create_response().set_body(<span class="hljs-string">"Hello, World!"</span>).done();<font></font>
        }));<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€C ++ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§HTTPã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªã™ã¹ã¦ã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ç§ãŸã¡ãŒRESTinioã‚’ä¸€èˆ¬çš„ã«å–ã‚Šä¸Šã’ãŸä¸»ãªæ©Ÿèƒ½ã¯ç€ä¿¡è¦æ±‚ã®éåŒæœŸå‡¦ç†ã§ã‚ã‚‹ã¨ã„ã¤ã‚‚è¨€ã£ã¦ã„ã¾ã™ãŒã€request_handlerå†…ã§é•·æ™‚é–“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã®å¯¾å‡¦æ³•ã«ã¤ã„ã¦ã®è³ªå•ãŒæ™‚ã€…ç™ºç”Ÿã—ã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ãã®ã‚ˆã†ãªè³ªå•ã¯é–¢é€£ãŒã‚ã‚‹ã®ã§ã€ãã‚Œã«ã¤ã„ã¦ã‚‚ã†ä¸€åº¦è©±ã—ã€ã„ãã¤ã‹ã®å°ã•ãªä¾‹ã‚’æŒ™ã’ã¦ãã ã•ã„ã€‚</font></font></p><a name="habracut"></a><br>
<h1 id="nebolshaya-otsylka-k-istokam"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ·æºã¸ã®å°‘ã—ã®è¨€åŠ</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸ‹ã‚è¾¼ã¿å¯èƒ½ãªHTTPã‚µãƒ¼ãƒãƒ¼ã‚’æ•°å›ç¶šã‘ã¦éå¸¸ã«ã‚ˆãä¼¼ãŸã‚¿ã‚¹ã‚¯ã«ç›´é¢ã•ã›ã‚‹ã“ã¨ã‚’æ±ºå®šã—ã¾ã—ãŸã€‚æ—¢å­˜ã®C ++ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®HTTPå…¥åŠ›ã‚’æ•´ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã€æ—¢å­˜ã®ã€Œé‡ã„ã€C ++ã‚’å†åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚³ãƒ¼ãƒ‰ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã®ã‚¿ã‚¹ã‚¯ã®å…±é€šã®ç‰¹å¾´ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãŒæ•°åç§’é–“ä¼¸ã³ã‚‹ã“ã¨ã§ã—ãŸã€‚</font></font></p><br>
<p> , HTTP-      HTTP-,    HTTP-    -      -  .    HTTP-   ,  HTTP-      ,           .</p><br>
<p> ,  HTTP-       ,    /    .       -       HTTP-. ,  , -           ,   HTTP-,    HTTP-      .</p><br>
<p>         ,        ,      Windows  "" ,   -  , , ,       ,    2017    RESTinio.</p><br>
<p>     HTTP-,   ,    -  ,   - ,        .   ,      ...</p><br>
<h1 id="itak-est-vhodyaschiy-zapros-trebuyuschiy-mnogo-vremeni-na-obrabotku-chto-delat">,   ,     .  ?</h1><br>
<h2 id="rabochie-niti-restinioasio">  RESTinio/Asio</h2><br>
<p>  RESTinio    ,        RESTinio. , -  ,   RESTinio      ( <code>run(on_this_thread(...))</code>,    ),      RESTinio    .     - RESTinio " "   .              request_handler-.</p><br>
<p>    ,    RESTinio,      -,    request_handler-. ,    RESTinio-  <code>run(on_this_thread(...))</code>,   <code>run()</code>        -,   .</p><br>
<p> , RESTinio  Asio- event-loop,      ,        ,     ,     ..  ,  ,          ,        request_handler.</p><br>
<p>,  request_handler    ,         Asio- event-loop.  .</p><br>
<p> RESTinio      (..  <code>run(on_thread_pool(...))</code>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>),     :       Asio- event-loop.   - request_handler    ,               -.</p><br>
<p>   RESTinio    ,   request_handler-    , ,    .</p><br>
<h2 id="nuzhen-li-vam-pul-rabochih-potokov-dlya-restinioasio">       RESTinio/Asio?</h2><br>
<p>,    request_handler     ,    ,        -.   ,  request_handler-      ? ,   -   ,         ?</p><br>
<p>-    ,   RESTinio      ,        .</p><br>
<p> ,       ,      .     .         (       ),    ,           .     -    .      "".    RESTinio    -,  RESTinio          .</p><br>
<p>,           ,     RESTinio    ,            .          - ,        .</p><br>
<p>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">- Shrimp</a>    : "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Shrimp:     HTTP    C++  ImageMagic++, SObjectizer  RESTinio</a>".</p><br>
<h2 id="primery-delegirovaniya-obrabotki-zaprosov-na-otdelnye-rabochie-niti">       </h2><br>
<p>   ,         request_handler-.    :       -   .    ,    .</p><br>
<p>           RESTinio          .     -        RESTinio    .</p><br>
<p>   thread-safe message queue           ,       SObjectizer-   mchain-,   CSP- .   mchain-   : "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">      ? CSP-    </a>".</p><br>
<h3 id="sohranenie-obekta-request_handle">  request_handle</h3><br>
<p> ,      , â€”   -  <code>request_handle_t</code>.</p><br>
<p> RESTinio        request_handler,   request_handler    <code>request_handle_t</code>.      ,       .    -  ,  <code>request_handle_t</code> â€”  <code>shared_ptr</code>,     .  <code>shared_ptr</code>  .</p><br>
<p>  <code>request_handle_t</code> â€”  <code>shared_ptr</code>,        - .         .</p><br>
<p>,           .   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">//  SObjectizer.</span>
    so_5::<span class="hljs-keyword">wrapped_env_t</span> sobj;<font></font>
<font></font>
    <span class="hljs-comment">//  std::thread    .</span>
    <span class="hljs-built_in">std</span>::thread processing_thread;
    <span class="hljs-comment">//    main      join.</span>
    <span class="hljs-comment">//    RAII.</span>
    <span class="hljs-keyword">auto</span> processing_thread_joiner = so_5::auto_join(processing_thread);<font></font>
<font></font>
    <span class="hljs-comment">//      .</span>
    <span class="hljs-keyword">auto</span> req_ch = so_5::create_mchain(sobj);
    <span class="hljs-comment">//       main.</span>
    <span class="hljs-comment">//    RAII.</span>
    <span class="hljs-keyword">auto</span> ch_closer = so_5::auto_close_drop_content(req_ch);<font></font>
<font></font>
    <span class="hljs-comment">//     .</span>
    <span class="hljs-comment">//      main()  - ,</span>
    <span class="hljs-comment">//     ,      join().</span>
    processing_thread = <span class="hljs-built_in">std</span>::thread{<font></font>
            processing_thread_func, req_ch<font></font>
    };</code></pre><br>
<p>       <code>processing_thread_func()</code>,     .</p><br>
<p>             .   RESTinio-:</p><br>
<pre><code class="cpp hljs">    <span class="hljs-comment">// ,     .</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">traits_t</span> :</span> <span class="hljs-keyword">public</span> restinio::<span class="hljs-keyword">default_traits_t</span><font></font>
    {<font></font>
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">logger_t</span> = restinio::<span class="hljs-keyword">shared_ostream_logger_t</span>;<font></font>
    };<font></font>
<font></font>
    restinio::run(<font></font>
        restinio::on_this_thread&lt;<span class="hljs-keyword">traits_t</span>&gt;()<font></font>
            .port(<span class="hljs-number">8080</span>)<font></font>
            .address(<span class="hljs-string">"localhost"</span>)<font></font>
            .request_handler([req_ch](<span class="hljs-keyword">auto</span> req) {
                <span class="hljs-comment">//   GET-   .</span>
                <span class="hljs-keyword">if</span>(restinio::<span class="hljs-keyword">http_method_t</span>::http_get == req-&gt;header().method() &amp;&amp;
                        <span class="hljs-string">"/"</span> == req-&gt;header().path())<font></font>
                {<font></font>
                    <span class="hljs-comment">//    .</span><font></font>
                    so_5::send&lt;handle_request&gt;(req_ch, req);<font></font>
                    <span class="hljs-keyword">return</span> restinio::request_accepted();<font></font>
                }<font></font>
                <span class="hljs-keyword">else</span>
                    <span class="hljs-keyword">return</span> restinio::request_rejected();<font></font>
            })<font></font>
            .cleanup_func([&amp;] {<font></font>
                <span class="hljs-comment">//      .</span>
                <span class="hljs-comment">//    , ..  req_ch</span>
                <span class="hljs-comment">//         </span>
                <span class="hljs-comment">//     .</span><font></font>
                so_5::close_drop_content(req_ch);<font></font>
            }));</code></pre><br>
<p>     .   GET-  '/',       .      :</p><br>
<ul>
<li>  <code>request_handle_t</code>  CSP- .      CSP-   - ,  RESTinio ,    ;</li>
<li>  <code>restinio::request_accepted()</code>   .   RESTinio ,           .</li>
</ul><br>
<p> ,  request_handler     RESTinio   .   <code>restinio::request_accepted()</code>,           -     .</p><br>
<p>     <code>restinio::request_rejected()</code>,  RESTinio ,          501.</p><br>
<p>,   :  <code>request_handle_t</code>    -,  ,  , <code>std::shared_ptr</code>.    , RESTinio ,     .     <code>restinio::request_accepted()</code>,  RESTinio     ,          .</p><br>
<p>         :</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">processing_thread_func</span><span class="hljs-params">(so_5::<span class="hljs-keyword">mchain_t</span> req_ch)</span>
</span>{
    <span class="hljs-comment">//      </span>
    <span class="hljs-comment">//    .</span>
    <span class="hljs-built_in">std</span>::random_device rd;
    <span class="hljs-built_in">std</span>::mt19937 generator{rd()};
    <span class="hljs-built_in">std</span>::uniform_int_distribution&lt;&gt; pause_generator{<span class="hljs-number">350</span>, <span class="hljs-number">3500</span>};<font></font>
<font></font>
    <span class="hljs-comment">//      timeout_elapsed.</span>
    <span class="hljs-keyword">auto</span> delayed_ch = so_5::create_mchain(req_ch-&gt;environment());<font></font>
<font></font>
    <span class="hljs-comment">//     -  .</span>
    <span class="hljs-keyword">bool</span> stop = <span class="hljs-literal">false</span>;<font></font>
    select(<font></font>
        so_5::from_all()<font></font>
            <span class="hljs-comment">//      .</span>
            .on_close([&amp;stop](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;) { stop = <span class="hljs-literal">true</span>; })
            <span class="hljs-comment">//     select().</span>
            <span class="hljs-comment">//  select()     .</span>
            .stop_on([&amp;stop]{ <span class="hljs-keyword">return</span> stop; }),<font></font>
<font></font>
        <span class="hljs-comment">//   handle_request     RESTinio.</span><font></font>
        case_(req_ch,<font></font>
            [&amp;](handle_request cmd) {<font></font>
                <span class="hljs-comment">//     .</span>
                <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::chrono::milliseconds pause{pause_generator(generator)};<font></font>
<font></font>
                <span class="hljs-comment">//     .</span><font></font>
                so_5::send_delayed&lt;timeout_elapsed&gt;(delayed_ch,<font></font>
                        <span class="hljs-comment">//    timeout_elapsed.</span><font></font>
                        pause,<font></font>
                        <span class="hljs-comment">//      timeout_elapsed.</span><font></font>
                        cmd.m_req,<font></font>
                        pause);<font></font>
            }),<font></font>
<font></font>
        <span class="hljs-comment">//   timeout_elapsed.</span><font></font>
        case_(delayed_ch,<font></font>
            [](timeout_elapsed cmd) {<font></font>
                <span class="hljs-comment">//     .</span><font></font>
                cmd.m_req-&gt;create_response()<font></font>
                        .set_body(<span class="hljs-string">"Hello, World! (pause:"</span>
                                + <span class="hljs-built_in">std</span>::to_string(cmd.m_pause.count())<font></font>
                                + <span class="hljs-string">"ms)"</span>)<font></font>
                        .done();<font></font>
            })<font></font>
    );<font></font>
}</code></pre><br>
<p>   :        <code>handle_request</code>              <code>timeout_elapsed</code>.        <code>timeout_elapsed</code>.</p><br>
<p><strong>Upd.</strong>        <code>done()</code>,  RESTinio   ,    ,     TCP-. RESTinio   ,   I/O-    ,   <code>done()</code>,  ,  RESTinio  -   request_handler-. ..    <code>done()</code>     ,        , ,   <code>restinio::run()</code>.</p><br>
<p>     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">handle_request</span>
{</span>
    restinio::<span class="hljs-keyword">request_handle_t</span> m_req;<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeout_elapsed</span>
{</span>
    restinio::<span class="hljs-keyword">request_handle_t</span> m_req;
    <span class="hljs-built_in">std</span>::chrono::milliseconds m_pause;<font></font>
};</code></pre><br>
<p>..     <code>request_handle_t</code>      ,       .     ,   -  <code>create_response()</code>    RESTinio.   RESTinio            .</p><br>
<p>  <code>request_handle_t</code>     <code>timeout_elapsed</code>,         .    <code>request_handle_t</code>    -    - ,    .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   RESTinio</a>.</p><br>
<h4 id="neskolko-nebolshih-poyasneniy-po-kodu">    </h4><br>
<p>    RESTinio ,    RESTinio-:</p><br>
<pre><code class="cpp hljs">    <span class="hljs-comment">// ,     .</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">traits_t</span> :</span> <span class="hljs-keyword">public</span> restinio::<span class="hljs-keyword">default_traits_t</span><font></font>
    {<font></font>
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">logger_t</span> = restinio::<span class="hljs-keyword">shared_ostream_logger_t</span>;<font></font>
    };<font></font>
<font></font>
    restinio::run(<font></font>
        restinio::on_this_thread&lt;<span class="hljs-keyword">traits_t</span>&gt;()</code></pre><br>
<p>    ,  RESTinio      .    <code>logger_t</code>,      <code>null_logger_t</code>.  .. RESTinio  , ,    (  RESTinio    ,          ),   thread-safe logger,    <code>shared_ostream_logger_t</code>.</p><br>
<p> <code>processing_thread_func()</code>  SObjectizer-  <code>select()</code>,  -  Go-  select:         .  <code>select()</code>    ,        .      ,   .</p><br>
<p>        RESTinio-,     .   <code>select()</code>       :   -  ,   stop.       <code>select()</code>    <code>processing_thread_func()</code>.</p><br>
<h3 id="sohranenie-obekta-response_builder">  response_builder</h3><br>
<p>      ,     <code>request_handle_t</code>   ,         .</p><br>
<p>      , , ,     . ..,   ,       .  . ,  - ,        . ,   - ,       ..</p><br>
<p>    ,        ,    . ..    ,     ,  ,    ..</p><br>
<p>RESTinio      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">responce_builder-  </a>.  ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">user_controlled_output</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">chunked_output</a>.</p><br>
<p>      <code>request_handle_t</code>,  <code>request_handle_t</code>       <code>create_reponse()</code>.      response_builder-.  ...</p><br>
<p>   . Response_builder â€”  moveable , -   unique_ptr.           ,    .   ,   ,     .  ,   <code>processing_thread_func()</code>   .</p><br>
<p>   .</p><br>
<p>     ,    <code>processing_thread_func()</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">handle_request</span>
{</span>
   restinio::<span class="hljs-keyword">request_handle_t</span> m_req;<font></font>
};<font></font>
<font></font>
<span class="hljs-comment">//     .</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">output_t</span> = restinio::<span class="hljs-keyword">chunked_output_t</span>;<font></font>
<font></font>
<span class="hljs-comment">//   reponse_builder-   .</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">response_t</span> = restinio::<span class="hljs-keyword">response_builder_t</span>&lt;<span class="hljs-keyword">output_t</span>&gt;;<font></font>
<font></font>
<span class="hljs-comment">//     .</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeout_elapsed</span>
{</span>
   <span class="hljs-keyword">response_t</span> m_resp;
   <span class="hljs-keyword">int</span> m_counter;<font></font>
};</code></pre><br>
<p> <code>handle_request</code>   .     <code>timeout_elapsed</code>     <code>request_handle_t</code>,  response_builder   .    .     ,   .</p><br>
<p>        <code>processing_thread_func()</code>:</p><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">processing_thread_func</span><span class="hljs-params">(so_5::<span class="hljs-keyword">mchain_t</span> req_ch)</span>
</span>{
   <span class="hljs-built_in">std</span>::random_device rd;
   <span class="hljs-built_in">std</span>::mt19937 generator{rd()};
   <span class="hljs-built_in">std</span>::uniform_int_distribution&lt;&gt; pause_generator{<span class="hljs-number">350</span>, <span class="hljs-number">3500</span>};<font></font>
<font></font>
   <span class="hljs-keyword">auto</span> delayed_ch = so_5::create_mchain(req_ch-&gt;environment());<font></font>
<font></font>
   <span class="hljs-keyword">bool</span> stop = <span class="hljs-literal">false</span>;<font></font>
   select(<font></font>
      so_5::from_all()<font></font>
         .on_close([&amp;stop](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;) { stop = <span class="hljs-literal">true</span>; })<font></font>
         .stop_on([&amp;stop]{ <span class="hljs-keyword">return</span> stop; }),<font></font>
<font></font>
      case_(req_ch,<font></font>
         [&amp;](handle_request cmd) {<font></font>
            <span class="hljs-comment">//    ,    .</span>
            <span class="hljs-keyword">auto</span> resp = cmd.m_req-&gt;create_response&lt;<span class="hljs-keyword">output_t</span>&gt;();<font></font>
<font></font>
            resp.append_header( restinio::http_field::server, <span class="hljs-string">"RESTinio"</span> )<font></font>
               .append_header_date_field()<font></font>
               .append_header( restinio::http_field::content_type,<font></font>
                     <span class="hljs-string">"text/plain; charset=utf-8"</span> );<font></font>
<font></font>
            <span class="hljs-comment">//    ,  RESTinio</span>
            <span class="hljs-comment">//   .</span><font></font>
            resp.flush();<font></font>
<font></font>
            <span class="hljs-comment">//       .</span><font></font>
            so_5::send_delayed&lt;so_5::mutable_msg&lt;timeout_elapsed&gt;&gt;(delayed_ch,<font></font>
                  <span class="hljs-comment">//     .</span>
                  <span class="hljs-built_in">std</span>::chrono::milliseconds{pause_generator(generator)},
                  <span class="hljs-comment">//    timeout_elapsed.</span>
                  <span class="hljs-comment">//     response_builder-  .</span>
                  <span class="hljs-built_in">std</span>::move(resp),
                  <span class="hljs-number">3</span>);<font></font>
         }),<font></font>
<font></font>
      case_(delayed_ch,<font></font>
         [&amp;](so_5::<span class="hljs-keyword">mutable_mhood_t</span>&lt;timeout_elapsed&gt; cmd) {
            <span class="hljs-comment">//      .</span>
            cmd-&gt;m_resp.append_chunk( <span class="hljs-string">"this is the next part of the response\n"</span> );
            <span class="hljs-comment">//  RESTinio   .</span><font></font>
            cmd-&gt;m_resp.flush();<font></font>
<font></font>
            cmd-&gt;m_counter -= <span class="hljs-number">1</span>;<font></font>
<font></font>
            <span class="hljs-keyword">if</span>( <span class="hljs-number">0</span> != cmd-&gt;m_counter )<font></font>
            {<font></font>
               <span class="hljs-comment">//        .</span><font></font>
               so_5::send_delayed(<font></font>
                     delayed_ch,<font></font>
                     <span class="hljs-built_in">std</span>::chrono::milliseconds{pause_generator(generator)},
                     <span class="hljs-built_in">std</span>::move(cmd));<font></font>
            }<font></font>
            <span class="hljs-keyword">else</span>
               <span class="hljs-comment">// ,   .</span><font></font>
               cmd-&gt;m_resp.done();<font></font>
         })<font></font>
   );<font></font>
}</code></pre><br>
<p>..     ,        .       .         .</p><br>
<p><strong>Upd.</strong>   <code>flush()</code>   ,     <code>done()</code>: RESTinio   ,   I/O-    ,   <code>flush()</code>,  ,  RESTinio  -   request_handler-. ..    <code>flush()</code>     ,        , ,   <code>restinio::run()</code>.</p><br>
<p>      ,    RESTinio    :</p><br>
<pre><code class="plaintext hljs">[2019-05-13 15:02:35.106] TRACE: starting server on 127.0.0.1:8080<font></font>
[2019-05-13 15:02:35.106]  INFO: init accept #0<font></font>
[2019-05-13 15:02:35.106]  INFO: server started on 127.0.0.1:8080<font></font>
[2019-05-13 15:02:39.050] TRACE: accept connection from 127.0.0.1:49280 on socket #0<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] start connection with 127.0.0.1:49280<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] start waiting for request<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] continue reading request<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] received 78 bytes<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] request received (#0): GET /<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] append response (#0), flags: { not_final_parts, connection_keepalive }, write group size: 1<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] start next write group for response (#0), size: 1<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] start response (#0): HTTP/1.1 200 OK<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] sending resp data, buf count: 1, total size: 167<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] outgoing data was sent: 167 bytes<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] finishing current write group<font></font>
[2019-05-13 15:02:39.050] TRACE: [connection:1] should keep alive<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] append response (#0), flags: { not_final_parts, connection_keepalive }, write group size: 3<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] start next write group for response (#0), size: 3<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] sending resp data, buf count: 3, total size: 42<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] outgoing data was sent: 42 bytes<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] finishing current write group<font></font>
[2019-05-13 15:02:40.190] TRACE: [connection:1] should keep alive<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] append response (#0), flags: { not_final_parts, connection_keepalive }, write group size: 3<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] start next write group for response (#0), size: 3<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] sending resp data, buf count: 3, total size: 42<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] outgoing data was sent: 42 bytes<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] finishing current write group<font></font>
[2019-05-13 15:02:43.542] TRACE: [connection:1] should keep alive<font></font>
[2019-05-13 15:02:46.297] TRACE: [connection:1] append response (#0), flags: { not_final_parts, connection_keepalive }, write group size: 3<font></font>
[2019-05-13 15:02:46.297] TRACE: [connection:1] start next write group for response (#0), size: 3<font></font>
[2019-05-13 15:02:46.297] TRACE: [connection:1] sending resp data, buf count: 3, total size: 42<font></font>
[2019-05-13 15:02:46.297] TRACE: [connection:1] append response (#0), flags: { final_parts, connection_keepalive }, write group size: 1<font></font>
[2019-05-13 15:02:46.297] TRACE: [connection:1] outgoing data was sent: 42 bytes<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] finishing current write group<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] should keep alive<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] start next write group for response (#0), size: 1<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] sending resp data, buf count: 1, total size: 5<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] outgoing data was sent: 5 bytes<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] finishing current write group<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] should keep alive<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] start waiting for request<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] continue reading request<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] EOF and no request, close connection<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] close<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] close: close socket<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] close: timer canceled<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] close: reset responses data<font></font>
[2019-05-13 15:02:46.298] TRACE: [connection:1] destructor called</code></pre><br>
<p>  ,  RESTinio           167 .          ,           , RESTinio          .</p><br>
<p>  ,    RESTinio   -     response_builder     ,        .</p><br>
<p>     .        , ,     .       response_builder   .     ,   responce_builder       ,          ..</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<h2 id="chto-budet-esli-obrabotka-zaprosa-zaymet-slishkom-mnogo-vremeni"> ,       ?</h2><br>
<p>,   request_handler-     -   .  ,      ,           ?</p><br>
<p> RESTinio    ,   -  request_handler-.    - ,     , RESTinio       . ,         . , :</p><br>
<pre><code class="plaintext hljs">[2019-05-13 15:32:23.618] TRACE: starting server on 127.0.0.1:8080<font></font>
[2019-05-13 15:32:23.618]  INFO: init accept #0<font></font>
[2019-05-13 15:32:23.618]  INFO: server started on 127.0.0.1:8080<font></font>
[2019-05-13 15:32:26.768] TRACE: accept connection from 127.0.0.1:49502 on socket #0<font></font>
[2019-05-13 15:32:26.768] TRACE: [connection:1] start connection with 127.0.0.1:49502<font></font>
[2019-05-13 15:32:26.768] TRACE: [connection:1] start waiting for request<font></font>
[2019-05-13 15:32:26.768] TRACE: [connection:1] continue reading request<font></font>
[2019-05-13 15:32:26.768] TRACE: [connection:1] received 78 bytes<font></font>
[2019-05-13 15:32:26.768] TRACE: [connection:1] request received (#0): GET /<font></font>
[2019-05-13 15:32:30.768] TRACE: [connection:1] handle request timed out<font></font>
[2019-05-13 15:32:30.768] TRACE: [connection:1] close<font></font>
[2019-05-13 15:32:30.768] TRACE: [connection:1] close: close socket<font></font>
[2019-05-13 15:32:30.768] TRACE: [connection:1] close: timer canceled<font></font>
[2019-05-13 15:32:30.768] TRACE: [connection:1] close: reset responses data<font></font>
[2019-05-13 15:32:31.768]  WARN: [connection:1] try to write response, while socket is closed<font></font>
[2019-05-13 15:32:31.768] TRACE: [connection:1] destructor called</code></pre><br>
<p>  -       . ,      ,  RESTinio   , ..     .</p><br>
<p>  -    <code>handle_request_timeout</code>,     RESTinio- ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>).</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>,   ,      RESTinio â€”   ,   .  ,     RESTinio,    ,        RESTinio,     .</p><br>
<p>     RESTinio        ,  , ,  :  ? -  ? -  ? - -  ?</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSã€‚</font><font style="vertical-align: inherit;">HabrÃ©ã«ã¤ã„ã¦ã¯ã€ã“ã‚Œã¾ã§ã®ã¨ã“ã‚RESTinioã«ã¤ã„ã¦ã¯SObjectizerã«ã¤ã„ã¦è©±ã™ã‚ˆã‚Šã‚‚ãšã£ã¨å°‘ãªã„ã§ã™ãŒã€ã„ãã¤ã‹ã®å‡ºç‰ˆç‰©ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã€Œï¼šã ã‹ã‚‰ã€ã“ã“ã§ã¯ã€ãã®å¾Œã€èª°ã‹ãŒæœ€åˆRESTinioã«ã¤ã„ã¦å­¦ã‚“ã å ´åˆã¯ã€ãã®ã†ã¡ã®ã„ãã¤ã‹ã§</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äººé–“ã®é¡”ã‚’æŒã¤çµ„ã¿è¾¼ã¿éåŒæœŸHTTPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…ã®3éšå»ºã¦ã®C ++ã®ãƒ‘ã‚¿ãƒ¼ãƒ³</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã€Œã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ã§ã®éåŒæœŸHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼šé€ä¿¡ã€RESTinioé€šã£ã¦ãã‚‹ã«ã¯ã€ libcurlçµŒç”±ã€‚ãƒ‘ãƒ¼ãƒˆ1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "ã€" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¨ãƒ“ï¼šImageMagic ++ã€SObjectizerã€ãŠã‚ˆã³RESTinioã‚’ä½¿ç”¨ã—ã¦æœ€æ–°ã®C ++ã§HTTPã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŠã‚ˆã³é…å¸ƒã—ã¾ã™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja451718/index.html">éŸ³å£°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½œæˆ</a></li>
<li><a href="../ja451720/index.html">FIASã¯ã€MSSQLSERVERä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®å³èˆˆï¼ˆSQLXMLBULKLOADï¼‰ã«ã‚ˆã‚‹ãƒ­ãƒ¼ãƒ‰ã§ã™ã€‚ï¼ˆãŠãã‚‰ãï¼‰ãã‚Œã‚’è¡Œã†å¿…è¦ãŒãªã„æ–¹æ³•</a></li>
<li><a href="../ja451722/index.html">Qt-éåŒæœŸéåŒæœŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a></li>
<li><a href="../ja451724/index.html">ã‚¹ã‚­ãƒ«ãƒŸã‚ªãƒ³ã¨ã‚¹ã‚­ãƒ«ãƒŸã‚ªãƒ³ã®ä¸å’Œï¼šå¼·å¼¾æ€§ã«ãŠã‘ã‚‹ä¸‰æ¬¡å…ƒæ¥µã‚¹ã‚­ãƒ«ãƒŸã‚ªãƒ³</a></li>
<li><a href="../ja451726/index.html">æµ·å¤–ã§ä»•äº‹ã‚’æ¢ã™ï¼šITãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å‘ã‘ã®7ã¤ã®ç°¡å˜ãªãƒ’ãƒ³ãƒˆ</a></li>
<li><a href="../ja451738/index.html">è¨˜äº‹ã€ŒDeViSEï¼šæ·±ã„è¦–è¦šæ„å‘³çš„åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã€ã®çŸ­ã„ãƒ¬ãƒ“ãƒ¥ãƒ¼</a></li>
<li><a href="../ja451742/index.html">DotNext 2019 Piterã®1æ—¥å‰ã€‚ç„¡æ–™ã®æ”¾é€ã‚¢ãƒŠã‚¦ãƒ³ã‚¹</a></li>
<li><a href="../ja451746/index.html">ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨å»ºç¯‰å®¶ã®ãŸã‚ã®MegaSlerm Kubernetes</a></li>
<li><a href="../ja451748/index.html">Qsanã‚¢ãƒ¬ã‚¤ã§ã®SSDã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ç›£è¦–</a></li>
<li><a href="../ja451750/index.html">æœ¬ã€ŒElasticsearchã€Kibanaã€Logstashã€ãŠã‚ˆã³æ¬¡ä¸–ä»£æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>