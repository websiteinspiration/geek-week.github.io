<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝🏻 🤾🏼 🎎 Exemple de SPA Simple Notes sur Mithril.js 👨🏾‍💻 🤳🏾 🙍🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mithril.js est un outil impopulaire pour créer des applications Web clientes. Il n'y a pratiquement aucune publication sur Habré à ce sujet. Dans cet ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Exemple de SPA Simple Notes sur Mithril.js</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492496/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un outil impopulaire pour créer des applications Web clientes. </font><font style="vertical-align: inherit;">Il n'y a pratiquement aucune publication sur Habré à ce sujet. </font><font style="vertical-align: inherit;">Dans cet article, je veux montrer comment vous pouvez faire une petite application sur Mithril. </font><font style="vertical-align: inherit;">La candidature sera basée sur cette </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publication</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traduction</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que Mihtril</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mithril est un framework réactif conçu pour créer des SPA (applications web à page unique). Dans l'ensemble, c'est juste du javascript et 13 signatures de fonctions API. De plus, il existe une bibliothèque de flux de mithril qui n'est pas incluse dans le mithril et est utilisée séparément. Le cœur du mithril comprend le routage de l'application et l'utilisation des demandes XHR. Le concept central est l'abstraction - un nœud virtuel (vnode). Un nœud virtuel est juste un objet js avec un ensemble d'attributs. Les nœuds virtuels sont créés par la fonction spéciale m (). L'état actuel de l'interface est stocké dans une liste de nœuds virtuels (DOM virtuel). Lors du rendu initial de la page d'application, le DOM virtuel est traduit dans le DOM. Lorsque le gestionnaire d'événements DOM API démarre, lorsque la promesse m.request () est terminée et lorsque l'URL change (navigation le long des itinéraires de l'application), un nouveau tableau DOM virtuel est généré,se compare à l'ancien, et les nœuds modifiés changent le DOM du navigateur. En plus des événements DOM et de l'achèvement de la demande m.request (), le redessin peut être appelé manuellement avec la fonction m.redraw ().</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de modèles HTML en mithril prêts à l'emploi, il n'y a pas de support JSX, bien que vous puissiez utiliser tout cela avec différents plugins pour construire si vous le souhaitez. Je n'utiliserai pas ces opportunités ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le premier argument de m () est une chaîne (par exemple, 'div'), la fonction renvoie un simple nœud virtuel et, par conséquent, une balise HTML sera affichée dans le DOM</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le premier argument de m () est l'objet ou la fonction qui renvoie l'objet, alors un tel objet doit avoir une méthode view (), et un tel objet est appelé un composant. La méthode view () du composant, à son tour, doit toujours renvoyer la fonction m () (ou un tableau du type: [m (),]). Ainsi, nous pouvons construire une hiérarchie d'objets composants. Et il est clair qu'en fin de compte, tous les composants renvoient de simples nœuds vnode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les nœuds virtuels et les composants ont des méthodes de cycle de vie, et ils sont appelés les mêmes oninit (), oncreate (), onbeforeupdate (), etc. Chacune de ces méthodes est appelée à un moment très précis du rendu de la page.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez transmettre des paramètres au nœud virtuel ou au composant en tant qu'objet, qui doit être le deuxième argument de la fonction m (). Vous pouvez obtenir un lien vers cet objet à l'intérieur du nœud en utilisant la notation vnode.attrs. Le troisième argument de la fonction m () est la descendance de ce nœud et est accessible via le lien vnode.children. En plus de la fonction m (), des nœuds simples sont renvoyés par la fonction m.trust (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur de mithril n'offre aucun modèle de conception d'application spécial, bien qu'il conseille d'éviter certaines décisions infructueuses, par exemple, des composants «trop épais» ou la manipulation des descendants de l'arborescence des composants. L'auteur ne propose pas non plus de méthodes ou de méthodes spéciales pour contrôler l'état de l'application dans son ensemble ou des composants. Bien que la documentation indique que vous ne devez pas utiliser l'état du nœud lui-même, manipulez-le.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes ces fonctionnalités du mithril semblent très gênantes et le cadre semble inachevé, il n'y a pas de recommandations spéciales, il n'y a pas d'état / de stockage, il n'y a pas de réducteur / répartiteur d'événements, pas de modèles. </font><font style="vertical-align: inherit;">En général, faites comme vous le pouvez.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce dont vous avez besoin pour un exemple </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utiliserons:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js version 2.0.4</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothèque css </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure.css</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version 1.0.1</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontawesome v5.12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les icônes</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rollup.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version 1.32 pour la construction de l'application</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgREST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> version 5.2.0, en tant que serveur REST backend</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgresql version 9.6 ou supérieure en tant que base de données.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le serveur frontal n'est pas important ici, il suffit de donner au client index.html et les fichiers de script et de style. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'installerons pas de mithril dans node_modules, et lierons le code d'application et le framework dans un seul fichier. </font><font style="vertical-align: inherit;">Le code d'application et le mithril seront téléchargés sur la page séparément. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne décrirai pas la procédure d'installation des outils, bien que je puisse dire à propos de postgREST, téléchargez simplement le fichier binaire, placez-le dans un dossier séparé, créez un fichier de configuration test.conf comme ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">db-uri = "postgres://postgres:user1@localhost:5432/testbase"<font></font>
server-port= 5000<font></font>
# The name of which database schema to expose to REST clients<font></font>
db-schema= "public"<font></font>
# The database role to use when no client authentication is provided.<font></font>
# Can (and probably should) differ from user in db-uri<font></font>
db-anon-role = "postgres" </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En même temps, votre cluster postgesql devrait avoir une base de test et user1. </font><font style="vertical-align: inherit;">Dans cette base de test, créez une table:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-comment">-- Postgrest sql notes table </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> notes (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">serial</span> primary <span class="hljs-keyword">key</span>,<font></font>
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">127</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">content</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
created <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,<font></font>
completed <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-built_in">time</span> zone,<font></font>
ddel <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le démarrage du serveur postgREST se fait avec la commande:</font></font><br>
<br>
<pre><code class="bash hljs">postgrest test.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir démarré le serveur, il affiche des messages d'information sur la connexion à la base de données et sur le port sur lequel il écoutera les clients.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planifier un projet</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, si vous comprenez à peu près comment fonctionne Mitril, vous devez comprendre comment faire la demande. </font><font style="vertical-align: inherit;">Voici le plan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons stocker les données d'application dans un objet local, appelons son modèle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les applications API seront stockées dans un fichier séparé</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous stockons les itinéraires d'application dans un fichier séparé</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fichier de chemin sera le point d'entrée pour la construction de l'application.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque composant séparé (et j'utiliserai le schéma de rendu des composants) et les fonctions qui lui sont associées seront stockés dans un fichier séparé</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque composant qui restitue les données du modèle aura accès au modèle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les gestionnaires d'événements DOM du composant sont localisés dans le composant</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous n'avons pas besoin d'événements personnalisés, plutôt d'événements DOM natifs, les rappels de ces événements sont localisés dans les composants. </font><font style="vertical-align: inherit;">J'utiliserai une reliure bidirectionnelle. </font><font style="vertical-align: inherit;">Peut-être que tout le monde n'aime pas cette approche, mais tout le monde n'aime pas redux ou vuex. </font><font style="vertical-align: inherit;">De plus, la technique de liaison unidirectionnelle peut également être mise en œuvre avec élégance dans le mitril en utilisant du fil de mithril. </font><font style="vertical-align: inherit;">Mais dans ce cas, il s'agit d'une solution redondante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure du dossier d'application</font></font></h3><br>
<img src="https://habrastorage.org/webt/yp/uy/fa/ypuyfap4tlxl_ccqo86wbtb9h98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dossier public sera servi par le serveur frontal, il y a un fichier index.html et des répertoires avec des styles et des scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dossier src contient la racine du routeur et la définition de l'API, ainsi que deux répertoires, pour le modèle et les vues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la racine du projet, il y a un fichier de configuration rollup.config, et le projet est construit à l'aide de la commande:</font></font><br>
<br>
<pre><code class="bash hljs">rollup –c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas ennuyer le lecteur avec les longs morceaux de code disponibles sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> je ne commenterai que les principaux éléments de mise en œuvre pour démontrer une approche idiomatique pour mitral.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API et routeur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Code API:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// used by backend server</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> restApi= {
  <span class="hljs-attr">notes</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">'notes'</span>, <span class="hljs-attr">editable</span>: [<span class="hljs-string">'add'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'del'</span>] }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// used by routers</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appApi = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">"/"</span>,<font></font>
}<font></font>
<span class="hljs-comment">// used by navBar</span>
<span class="hljs-comment">// here array of arrays though it may be hash eg</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appMenu = [<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Home'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'About'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Contacts'</span>],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai défini une API pour le serveur REST et pour le routeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Routeur:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { restApi, appApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'./appApi'</span>;
<span class="hljs-keyword">import</span> { moModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/moModel'</span>;
<span class="hljs-keyword">import</span> { vuView, vuApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuApp'</span>;
<span class="hljs-keyword">import</span> { vuNavBar } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuNavBar'</span>;<font></font>
<font></font>
<span class="hljs-comment">// application router</span>
<span class="hljs-keyword">const</span> appRouter = { [appApi.root]: {<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> view = m(vuApp, {
      <span class="hljs-attr">model</span>: moModel.getModel( restApi.notes ),<font></font>
    });<font></font>
    <span class="hljs-keyword">return</span> vuView( {<span class="hljs-attr">menu</span>: vuNavBar}, view);<font></font>
  }<font></font>
}};<font></font>
<font></font>
<span class="hljs-comment">// once per app</span>
m.route(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">"/"</span>, appRouter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, le routeur est monté sur le corps du document. </font><font style="vertical-align: inherit;">Le routeur lui-même est un objet qui décrit les routes et les composants qui seront utilisés sur cette route, la fonction render () devrait retourner vnode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'objet appApi définit tous les itinéraires d'application valides et l'objet appMenu définit tous les éléments de navigation possibles pour l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction de rendu, lorsqu'elle est appelée, génère un modèle d'application et le transmet au nœud racine.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modèle d'application</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La structure qui stocke les données pertinentes, j'ai appelé le modèle. </font><font style="vertical-align: inherit;">Le code source de la fonction qui renvoie le modèle:</font></font><br>
<br>
<pre><code class="javascript hljs">getModel(<font></font>
    {url=<span class="hljs-literal">null</span>, method=<span class="hljs-string">"GET"</span>, order_by=<span class="hljs-string">'id'</span>, editable=<span class="hljs-literal">null</span>} = {}<font></font>
  ) {<font></font>
<span class="hljs-comment">/**
  * url - string of model's REST API url
  * method - string of model's REST method
  * order_by - string "order by" with initially SELECT 
  * editable - array defines is model could changed
*/</span>
    <span class="hljs-keyword">const</span> model = {
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">method</span>: method,
      <span class="hljs-attr">order_by</span>: order_by,
      <span class="hljs-attr">editable</span>: editable,
      <span class="hljs-attr">key</span>: order_by, <span class="hljs-comment">// here single primary key only</span>
      <span class="hljs-attr">list</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// main data list </span>
      <span class="hljs-attr">item</span>: {}, <span class="hljs-comment">// note item</span>
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Promise error</span>
      <span class="hljs-attr">save</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// save status</span>
      <span class="hljs-attr">editMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// view switch flag</span>
      <span class="hljs-attr">word</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// dialog header word</span><font></font>
    };  <font></font>
    model.getItem= <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {<font></font>
      model.item= {};<font></font>
      <span class="hljs-keyword">if</span> ( !id ) {<font></font>
        model.editMode= <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">const</span> key= model.key;
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> it <span class="hljs-keyword">of</span> model.list ) {
        <span class="hljs-keyword">if</span> (it[key] == id) {<font></font>
          model.item= <span class="hljs-built_in">Object</span>.assign({}, it);
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> model;<font></font>
  },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ici, il est initialisé et retourne l'objet modèle. </font><font style="vertical-align: inherit;">Les liens à l'intérieur de l'objet peuvent changer, mais le lien vers l'objet lui-même reste constant. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus de la fonction getModel, l'objet global moModel a des fonctions wrapper pour la fonction mitry m.request (), ce sont getList (modèle) et formSubmit (événement, modèle, méthode). </font><font style="vertical-align: inherit;">Le paramètre modèle est en fait une référence à l'objet modèle, événement est l'objet événement qui est généré lorsque le formulaire est soumis, méthode est la méthode HTTP avec laquelle nous voulons enregistrer la note (POST est une nouvelle note, PATCH, DELETE est ancien).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Représentation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dossier de vue contient des fonctions qui sont responsables du rendu des éléments de page individuels. </font><font style="vertical-align: inherit;">Je les ai divisés en 4 parties:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuApp - le composant racine de l'application, </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNavBar - barre de navigation,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes - une liste de notes,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formulaire d'édition de notes,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuDialog - élément de dialogue HTML </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le routeur détermine que vuView (menu, vue) est renvoyé sur un seul itinéraire </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Définition de cette fonction:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuView= <span class="hljs-function">(<span class="hljs-params">appMenu, view</span>)=&gt;</span> m(vuMain, appMenu, view);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit simplement d'un wrapper qui renvoie le composant vuMain, si l'objet appMenu est suffisamment complexe pour avoir des objets imbriqués dans une structure similaire à un objet externe, alors un tel wrapper est un moyen approprié de renvoyer un composant avec différents éléments de navigation et composants enfants (il vous suffit d'écrire moins de code) . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Composant VuMain:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> vuMain= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-comment">// We use ivnode as argument as it is initial vnode</span>
  <span class="hljs-keyword">const</span> { menu }= ivnode.attrs;
  <span class="hljs-keyword">return</span> { view(vnode) {
    <span class="hljs-comment">// IMPORTANT !</span>
    <span class="hljs-comment">// If we use vnode inside the view function we MUST provide it for view</span>
    <span class="hljs-keyword">return</span> [<font></font>
      m(menu),<font></font>
      m(<span class="hljs-string">'#layout'</span>, vnode.children)<font></font>
    ];<font></font>
  }};<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela renvoie simplement les vnodes de la navigation et le contenu réel de la page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-après, là où il est possible de définir un composant, j'utiliserai des fermetures. </font><font style="vertical-align: inherit;">Les fermetures sont appelées une fois lors du rendu initial de la page et stockent localement tous les liens transmis aux objets et les définitions de leurs propres fonctions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fermeture en tant que définition doit toujours renvoyer un composant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et en fait le composant de contenu d'application:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuApp= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-comment">//initially get notes</span><font></font>
  moModel.getList( model );<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() { 
    <span class="hljs-keyword">return</span> [<font></font>
      m(vuNotes, { model }),<font></font>
      m(vuNoteForm, { model }),<font></font>
      vuModalDialog(model)<font></font>
    ];<font></font>
  }};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque nous avons déjà un modèle, lorsque j'appelle une fermeture, je veux obtenir la liste complète des notes de la base de données. </font><font style="vertical-align: inherit;">Il y aura trois composants sur la page:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes - une liste de notes avec le bouton ajouter,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formulaire d'édition de notes,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuModalDialog - un élément de dialogue que nous afficherons de façon modale, et claquerons si nécessaire. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que chacun de ces composants doit savoir comment se dessiner, nous passons un lien vers l'objet modèle dans chacun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Liste des notes sur les composants:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//Notes List</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuNotes= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-keyword">const</span> _display= <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> model.editMode ? <span class="hljs-string">'display:none'</span>: <span class="hljs-string">'display:block'</span>;
  <span class="hljs-keyword">const</span> vuNote= noteItem(model); <span class="hljs-comment">// returns note function</span><font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() {
    <span class="hljs-keyword">return</span> model.error ? m(<span class="hljs-string">'h2'</span>, {<span class="hljs-attr">style</span>: <span class="hljs-string">'color:red'</span>}, model.error) :<font></font>
    !model.list ? m(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'...LOADING'</span> ) :<font></font>
    m(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">style</span>: _display() }, [<font></font>
      m(addButton , { model } ),<font></font>
      m(<span class="hljs-string">'.pure-g'</span>, m(<span class="hljs-string">'.pure-u-1-2.pure-u-md-1-1'</span>,<font></font>
        m(<span class="hljs-string">'.notes'</span>, model.list.map( vuNote ) )<font></font>
      ))<font></font>
    ]);<font></font>
  }};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur bool editMode est stocké dans l'objet modèle; si la valeur de l'indicateur est vraie, alors nous montrons le formulaire d'édition, sinon - une liste de notes. </font><font style="vertical-align: inherit;">Vous pouvez augmenter le test d'un niveau plus haut, mais le nombre de nœuds virtuels et les nœuds DOM réels changeraient chaque fois que l'indicateur est commuté, ce qui est un travail inutile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous sommes idiomatiques pour mitril, nous générons une page, vérifiant la présence ou l'absence d'attributs dans le modèle à l'aide d'opérateurs ternaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici la fermeture qui renvoie la fonction d'affichage des notes:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noteItem= <span class="hljs-function"><span class="hljs-params">model</span>=&gt;</span> {
  <span class="hljs-comment">// click event handler</span>
  <span class="hljs-keyword">const</span> event= <span class="hljs-function">(<span class="hljs-params"> msg, word=<span class="hljs-string">''</span>, time=<span class="hljs-literal">null</span></span>)=&gt;</span> <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    model.getItem(e.target.getAttribute(<span class="hljs-string">'data'</span>));
    <span class="hljs-keyword">if</span> ( !!msg ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">msg</span>: msg };<font></font>
      model.word= word;<font></font>
      <span class="hljs-keyword">if</span> ( !!time )<font></font>
        model.item.completed= time;<font></font>
      vuDialog.open();<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      model.editMode= <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  };<font></font>
  <span class="hljs-comment">// trash icon's click handler</span>
  <span class="hljs-keyword">const</span> _trash= event(<span class="hljs-string">'trash'</span>, <span class="hljs-string">'Dlelete'</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// check icon's click handler</span>
  <span class="hljs-keyword">const</span> _check= event(<span class="hljs-string">'check'</span>, <span class="hljs-string">'Complete'</span>,
    <span class="hljs-comment">// postgre timestamp string</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString().split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">' '</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// edit this note</span>
  <span class="hljs-keyword">const</span> _edit= event(<span class="hljs-string">''</span>);<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> _time= <span class="hljs-function"><span class="hljs-params">ts</span>=&gt;</span> ts.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>];<font></font>
  <font></font>
  <span class="hljs-comment">// Single Note </span>
  <span class="hljs-keyword">const</span> _note= <span class="hljs-function"><span class="hljs-params">note</span>=&gt;</span> m(<span class="hljs-string">'section.note'</span>, {<span class="hljs-attr">key</span>: note.id}, [<font></font>
    m(<span class="hljs-string">'header.note-header'</span>, [ m(<span class="hljs-string">'p.note-meta'</span>, [
      <span class="hljs-comment">// note metadata</span>
      m(<span class="hljs-string">'span'</span>, { <span class="hljs-attr">style</span>: <span class="hljs-string">'padding: right: 3em'</span> }, <span class="hljs-string">`Created: <span class="hljs-subst">${_time( note.created )}</span>`</span>),<font></font>
      note.completed ? m(<span class="hljs-string">'span'</span>, <span class="hljs-string">`  Completed: <span class="hljs-subst">${_time( note.completed )}</span>`</span>) : <span class="hljs-string">''</span>, 
      <span class="hljs-comment">// note right panel </span>
      m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-trash'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _trash } )),<font></font>
      note.completed ? <span class="hljs-string">''</span> : [<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-pen'</span>, {<span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _edit } )),<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-check'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _check} ))<font></font>
      ]<font></font>
    ]),<font></font>
      m(<span class="hljs-string">'h2.note-title'</span>, { <span class="hljs-attr">style</span>: note.completed ? <span class="hljs-string">'text-decoration: line-through'</span>: <span class="hljs-string">''</span>}, note.title)<font></font>
    ]),<font></font>
    m(<span class="hljs-string">'.note-content'</span>, m(<span class="hljs-string">'p'</span>, note.content))<font></font>
  ]);<font></font>
  <span class="hljs-keyword">return</span> _note;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les gestionnaires de clics sont définis localement. Le modèle ne sait pas comment l'objet note est structuré, je n'ai défini que la propriété key, avec laquelle nous pouvons sélectionner l'élément souhaité dans le tableau model.list. Cependant, le composant doit savoir exactement comment l'objet qu'il dessine est structuré. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne donnerai pas le texte complet du code du formulaire pour modifier la note; nous examinons simplement le gestionnaire de soumission de formulaire séparément:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// form submit handler</span>
  <span class="hljs-keyword">const</span> _submit= <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    e.preventDefault();<font></font>
    model.item.title= clean(model.item.title);<font></font>
    model.item.content= clean(model.item.content);<font></font>
    <span class="hljs-keyword">const</span> check= check_note(model.item);
    <span class="hljs-keyword">if</span> ( !!check ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">msg</span>: check }; <font></font>
      model.word= <span class="hljs-string">'Edit'</span>;<font></font>
      vuDialog.open();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> moModel.formSubmit(e, model, _method() ).then(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { model.editMode=<span class="hljs-literal">false</span>; <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}).catch(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { vuDialog.open(); <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } );<font></font>
  };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Étant donné que la définition se produit dans la fermeture, nous avons un lien vers le modèle et nous retournons une promesse avec le traitement ultérieur du résultat: l'interdiction de montrer le formulaire lorsque la demande est terminée normalement, ou en cas d'erreur - ouvrir une boîte de dialogue avec le texte de l'erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque fois que vous accédez au serveur principal, la liste des notes est relue. </font><font style="vertical-align: inherit;">Dans cet exemple, il n'est pas nécessaire d'ajuster la liste en mémoire, bien que cela puisse être fait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le composant de dialogue peut être affiché dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la seule chose qui doit être soulignée est que dans ce cas j'ai utilisé un littéral objet pour définir le composant, parce que je veux que les fonctions d'ouverture et de fermeture de fenêtre soient disponibles pour d'autres composants.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons écrit une petite application SPA en javascript et mithril.js, essayant de coller avec les idiomes de ce framework. </font><font style="vertical-align: inherit;">Je veux faire attention une fois de plus que ce n'est que du code javascript. </font><font style="vertical-align: inherit;">Peut-être pas tout à fait propre. </font><font style="vertical-align: inherit;">L'approche vous permet d'encapsuler de petits morceaux de code, d'isoler la mécanique d'un composant et d'utiliser un état commun pour tous les composants.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492482/index.html">Événements numériques à Moscou du 16 au 22 mars</a></li>
<li><a href="../fr492484/index.html">Événements numériques à Saint-Pétersbourg du 16 au 22 mars</a></li>
<li><a href="../fr492486/index.html">Nuxt + Django + GraphQL par exemple</a></li>
<li><a href="../fr492488/index.html">OpenID Connect: autorisation des applications internes du générique au standard</a></li>
<li><a href="../fr492492/index.html">NikiRobot - une évolution de la robotique éducative</a></li>
<li><a href="../fr492500/index.html">Garage scientifique en russe. Expérience de traduction d'un spectacle américain</a></li>
<li><a href="../fr492502/index.html">MIP * = RE: preuve historique du domaine de l'informatique qui a provoqué l'effet domino en physique et en mathématiques</a></li>
<li><a href="../fr492504/index.html">Que se passe-t-il lorsqu'un module JS est importé deux fois?</a></li>
<li><a href="../fr492506/index.html">3 façons de rendre de grandes listes en angulaire</a></li>
<li><a href="../fr492508/index.html">Réservez Kubernetes pour DevOps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>