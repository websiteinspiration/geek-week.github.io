<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔘 👩🏼‍🎤 🧗🏼 Pontilhando sobre os sensores de gás da série MQ - compreensão profunda da folha de dados e do ajuste 🐏 🍂 👎🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depois de comprar um detector de vazamento de gás, havia um desejo de desmontar tudo nas prateleiras e descobrir o que estava acontecendo lá dentro. H...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pontilhando sobre os sensores de gás da série MQ - compreensão profunda da folha de dados e do ajuste</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490654/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/aj/tw/2i/ajtw2iwb5ombl2yqqgfhyxotoz0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de comprar um detector de vazamento de gás, havia um desejo de desmontar tudo nas prateleiras e descobrir o que estava acontecendo lá dentro. Há muitas informações e artigos sobre sensores, mas a maioria está limitada à pinagem do módulo chinês padrão, às vezes aos princípios de operação. Sobre a determinação relativamente precisa dos valores absolutos das informações lá. Olhando para o futuro, direi que tentaremos extrair tudo da folha de dados, incluindo: as funções exatas de determinar "papagaios", correção de temperatura e umidade e algumas possibilidades de seleção.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, um sensor de gás combustível (principalmente metano) MQ-4. </font><font style="vertical-align: inherit;">Em resumo, o elemento sensor, devido às suas propriedades químicas, altera a resistência em diferentes concentrações de gás e atua como um resistor do divisor de tensão a partir do qual obtemos o valor da tensão através do ADC. </font><font style="vertical-align: inherit;">Essas propriedades se manifestam a uma certa temperatura do elemento para o qual o sensor deve ser aquecido.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oo/4q/wb/oo4qwb2riinmgctynzrukmkespi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acima está uma representação esquemática de um sensor e um circuito divisor, onde H é uma bobina de aquecimento (33 Ohms - cerca de 150 mA, as correntes são grandes demais para trabalhos com controladores; isso deve ser levado em consideração ao projetar um circuito de potência), AV são as saídas de um elemento sensível com resistência intercambiável, dependendo da concentração de gás , RL é o segundo resistor divisor recomendado pela ficha de dados - 20 kOhm.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentário sobre a escolha de uma tensão de referência ADC (Vref)</font></font></b><div class="spoiler_text">  Hanwei    Vc = 5 ,   Winsen – Vc &lt; 24 . ,   3.3  ,       ,      .       5  . <br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Converter ADC para ppm</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas saídas do divisor ADC, tomamos o valor de tensão (Uadc) com base no qual podemos calcular a resistência do sensor Rs (sabendo o valor do segundo resistor do divisor RL), ou seja, </font><font style="vertical-align: inherit;">determine o que exatamente o sensor nos transmite:</font></font><br>
<br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mi>s</mi><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><mi>V</mi><mi>r</mi><mi>e</mi><mi>f</mi><mo>&amp;#xD7;</mo><mi>R</mi><mi>L</mi><mo stretchy=&quot;false&quot;>)</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mi>U</mi><mi>a</mi><mi>d</mi><mi>c</mi><mo>&amp;#x2212;</mo><mi>R</mi><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.732ex" height="2.634ex" viewBox="0 -809.3 13662.4 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-73" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-3D" x="1506" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-28" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-56" x="2952" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-72" x="3722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-65" x="4173" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-66" x="4640" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-D7" x="5412" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-52" x="6413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-4C" x="7173" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-29" x="7854" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2F" x="8244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-55" x="8744" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-61" x="9512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-64" x="10041" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-63" x="10565" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2212" x="11220" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-52" x="12221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-4C" x="12980" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mi>s</mi><mo>=</mo><mo stretchy="false">(</mo><mi>V</mi><mi>r</mi><mi>e</mi><mi>f</mi><mo>×</mo><mi>R</mi><mi>L</mi><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>U</mi><mi>a</mi><mi>d</mi><mi>c</mi><mo>−</mo><mi>R</mi><mi>L</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1">Rs = (Vref ×RL) / Uadc-RL</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com o valor de Rs, já podemos determinar a concentração de gás de acordo com o gráfico da folha de dados. </font><font style="vertical-align: inherit;">Uma simples relação Rs / Ro é usada para determinar a concentração. </font><font style="vertical-align: inherit;">Ro, neste caso, é a resistência do elemento sensor a uma concentração de gás de detecção de 1000 ppm.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentário sobre pontos de partida nos cálculos</font></font></b><div class="spoiler_text">    ,       <br>
<blockquote>«Ro: sensor resistance at 1000ppm of CH4 in the clean air»</blockquote> ,            1000 ppm.     «»    .     ,         «  » ,  ,       1800 ppb (  1.8 ppm,    1000 ppm).     ,        4.4 Rs/Ro.<br>
</div></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pp/km/zg/ppkmzg2fcdtqu4pzjjgzliez4uq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta fase, graças ao ADC e à fórmula, sabemos apenas o valor da resistência atual (Rs) da qual iremos repelir. </font><font style="vertical-align: inherit;">Assumiremos que a medimos em ar limpo (a partir de gases detectados), em temperatura e umidade de calibração (pela folha de dados 20, 65%). </font><font style="vertical-align: inherit;">Um pouco mais tarde, haverá um comentário interessante sobre a umidade em que a calibração é realizada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, o valor de referência Ro para o sensor MQ-4 é:</font></font><br>
<br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mi>o</mi><mo>=</mo><mi>R</mi><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>4.4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.979ex" height="2.634ex" viewBox="0 -809.3 5588.1 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-6F" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-3D" x="1522" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-52" x="2579" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-73" x="3338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2F" x="3808" y="0"></use><g transform="translate(4308,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-34"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-34" x="779" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mi>o</mi><mo>=</mo><mi>R</mi><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4.4</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2">Ro=Rs/4.4</script></p><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentar sobre a seleção de fumaça</font></font></b><div class="spoiler_text"> ,     ,       Rs/Ro   – 1.8…0.43,   – 3.8…2.6.          .  ,  , «»   .       .  RsRo   2.8,  «» :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xf/ms/ay/xfmsayti8hipqb0dn1x0ymup8fe.png"></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cálculo da concentração real de gás é um pouco complicado pela curvatura do gráfico e pela falta de pontos de controle distintos pelos quais esse gráfico pode ser ajustado. </font><font style="vertical-align: inherit;">Além disso, o problema está na baixa expansão da imagem, pelo que é necessário determinar os pontos de controle pixel por pixel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esclarecer os cálculos, os valores mais óbvios são espaçados em uma grade de coordenadas. </font><font style="vertical-align: inherit;">Os pontos de controle determinaram a função da dependência de ppm em Rs / Ro:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentar limites de medição</font></font></b><div class="spoiler_text">     400…10000 ppm.      (Winsen/Hanwei)    200  400 ppm,     400.    ppm  Rs/Ro,  x = ppm/1000; y= (Rs/Ro)*10:<br>
</div></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fm/dq/fk/fmdqfknpnud93wwitd2lgqhduea.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gráfico construído corresponde à função:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/t-/ug/uft-ugzeblq_hebbv-id34yslg0.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, o número de "papagaios" é reconhecido pela fórmula:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bc/uq/fz/bcuqfzxkyfx9sontj8xehalniyq.png"></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco sobre a compensação de temperatura</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base no seguinte gráfico de dados, sabe-se que, dependendo do ambiente em que o sensor é usado, as leituras se desviam das reais: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xa/wr/jc/xawrjc2ujhhcxuwdyzx06qnu1fk.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentário sobre a umidade típica do ambiente de medição</font></font></b><div class="spoiler_text"> ,         = 65%.       RsRo/ppm (    ppm)  RsRo/Temp (    ).     Rs/Ro = 1  ppm=1000   20,    :  33%  65%.    . ,      ,      33%.        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para determinar com mais precisão a dependência dos indicadores no ambiente, também foi construído um gráfico de funções, o sensor é limitado a uma faixa de temperatura de -10 ° C ... +50 ° C (x = TEMP / 10; y = RsRo (erro) * 100):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uv/dc/ek/uvdcekdqdsn2szxgfm3ye1mzj08.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gráfico corresponde à função:</font></font><br>
<br>
<p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mn>0.83</mn><msup><mi>x</mi><mn>2</mn></msup><mo>&amp;#x2212;</mo><mn>9.2</mn><mi>x</mi><mo>+</mo><mn>25</mn><mo>&amp;#x2212;</mo><mo stretchy=&quot;false&quot;>(</mo><mn>0.3</mn><mo>&amp;#xD7;</mo><mi>H</mi><mi>U</mi><mi>M</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.092ex" height="3.009ex" viewBox="0 -970.7 18553.2 1295.7" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-29" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-3D" x="2179" y="0"></use><g transform="translate(3236,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-38" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-33" x="1279" y="0"></use></g><g transform="translate(5016,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-32" x="809" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2212" x="6264" y="0"></use><g transform="translate(7265,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-32" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-78" x="8544" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2B" x="9339" y="0"></use><g transform="translate(10340,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-35" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2212" x="11563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-28" x="12564" y="0"></use><g transform="translate(12953,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-33" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-D7" x="14455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-48" x="15456" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-55" x="16344" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMATHI-4D" x="17112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/490654/&amp;usg=ALkJrhjIN4sIapPciR8Lgb9sXaXSIuryEQ#MJMAIN-29" x="18163" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0.83</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>9.2</mn><mi>x</mi><mo>+</mo><mn>25</mn><mo>−</mo><mo stretchy="false">(</mo><mn>0.3</mn><mo>×</mo><mi>H</mi><mi>U</mi><mi>M</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3">f(x)=0.83x^2-9.2x+25-(0.3×HUM)</script></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A base é um gráfico com uma umidade de 33% (a julgar pela interseção 1, é uma calibração). Se você prestar atenção à umidade, a umidade de 1% muda o gráfico em 0,3 Y (em valores reais do ajuste RsRo será dividido por 100 - o coeficiente é usado no gráfico para maior clareza). "+25" muda a posição do gráfico em Y para umidade "zero"; "0,3 x HUM" retorna a posição Y para a umidade real. Alguma mudança no “peso” de 1% de umidade a temperaturas extremas é de pouca importância e não é levada em consideração. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota importante: tudo isso se aplica se a calibração for realizada em ar limpo a uma umidade de 33% e a uma temperatura de 20 graus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O valor de correção RsRo (erro), que precisará ser adicionado aos valores de RsRo para compensar o impacto ambiental, pode ser calculado pela fórmula:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/dj/je/apdjje0di63lldgrcoho5tqwhfu.png"></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tarefa "com um asterisco" é esclarecer a compensação durante a calibração em um ambiente não padrão</font></font></b><div class="spoiler_text">       ,       (20/33%),      RsRo(error)    :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ym/vd/kx/ymvdkxgyamyi9qaanh664cqknjc.png"></div><br>
      Y     –   .        X:       .       ,       ,     .<br>
<br>
   ,       ,         ,          . <br>
<br>
    , —   . <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para calcular um valor já compensado:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3r/jb/-k/3rjb-kl0vr_okrgqt5vhw9s4jeu.png"></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transferimos a teoria para o microcontrolador</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar o sensor, foram utilizados o microcontrolador STM32F407VET e a biblioteca HAL, os valores para correção foram recebidos do sensor BME280. </font><font style="vertical-align: inherit;">No arquivo de cabeçalho, definimos alguns valores constantes para nossa configuração.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mq4.h</font></font></h4><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> MQ4_H_</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_H_</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_default_work</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>; <span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_advanced_work</span> <span class="hljs-params">(<span class="hljs-keyword">float</span> temp, <span class="hljs-keyword">float</span> hum)</span></span>; <span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_full_work</span> <span class="hljs-params">(<span class="hljs-keyword">float</span> temp, <span class="hljs-keyword">float</span> hum, <span class="hljs-keyword">float</span> temp_cal, <span class="hljs-keyword">float</span> hum_cal)</span></span>; <span class="hljs-comment">//      </span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_calib_Ro</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>; <span class="hljs-comment">// </span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_get_adc</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>; <span class="hljs-comment">//   ,   </span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_ADC hadc1 <span class="hljs-comment">//    </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_ADC_PRECISION 4096 <span class="hljs-comment">//     (4096 = 12 bit)</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_REFERENCE_VOLTAGE 3.3f <span class="hljs-comment">//  </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_STATIC_RESISTOR 20000 <span class="hljs-comment">//RL -     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_RO_DEF 13600 <span class="hljs-comment">//Ro -   1000 ppm (RsRo=1),   </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_HUM_WEIGHT 0.3f <span class="hljs-comment">//     (  ) </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MQ4_AIR_RSRO 4.4f <span class="hljs-comment">// RsRo    (   )</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* MQ4_H_ */</span></span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mq4.c</font></font></h4><br>
<pre><code class="cpp hljs">mq4.c
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mq4.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"adc.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"math.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> mq4_Rs; <span class="hljs-comment">//  </span>
<span class="hljs-keyword">int</span> mq4_adc_value; <span class="hljs-comment">// </span>
<span class="hljs-keyword">float</span> mq4_volts; <span class="hljs-comment">// </span>
<span class="hljs-keyword">float</span> mq4_RsRo; <span class="hljs-comment">//  .  . 1000 ppm</span>
<span class="hljs-keyword">float</span> mq4_calib_value;  <span class="hljs-comment">//   RsRo</span>
<span class="hljs-keyword">float</span> mq4_calib_value2; <span class="hljs-comment">//   RsRo (    )</span><font></font>
<font></font>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> mq4_Ro; <span class="hljs-comment">//   1000ppm </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> mq4_temp_cal; <span class="hljs-comment">//     </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> mq4_hum_cal; <span class="hljs-comment">//     </span>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Função de cálculo de ppm (sem correções)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_default_work</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
<span class="hljs-keyword">int</span> ppm; 
<span class="hljs-keyword">int</span> mq4_adc;
<span class="hljs-keyword">float</span> volts;
<span class="hljs-keyword">int</span> Rs;
<span class="hljs-keyword">float</span> RsRo;
<span class="hljs-comment">//  : </span><font></font>
mq4_adc = mq4_get_adc(); <font></font>
<span class="hljs-comment">//   :</span><font></font>
volts = mq4_adc/(MQ4_ADC_PRECISION/MQ4_REFERENCE_VOLTAGE); <font></font>
<span class="hljs-comment">//    :</span><font></font>
Rs = ((MQ4_REFERENCE_VOLTAGE * MQ4_STATIC_RESISTOR)/volts)- MQ4_STATIC_RESISTOR; <font></font>
<span class="hljs-comment">//    :</span>
RsRo = (<span class="hljs-keyword">float</span>)Rs / (<span class="hljs-keyword">float</span>)mq4_Ro; <font></font>
<font></font>
<span class="hljs-comment">//   ( ,  ):</span><font></font>
mq4_RsRo = RsRo; <font></font>
mq4_adc_value = mq4_adc; <font></font>
mq4_volts = volts; <font></font>
 <font></font>
<span class="hljs-keyword">if</span> (RsRo&gt;<span class="hljs-number">0.437</span>) <span class="hljs-comment">//    (  )</span>
 <span class="hljs-comment">//     :</span>
 {ppm = (<span class="hljs-built_in">pow</span>((<span class="hljs-number">10</span>/(RsRo*<span class="hljs-number">10</span>)),(<span class="hljs-number">1</span>/<span class="hljs-number">0.36152689</span>)))*<span class="hljs-number">1000</span>;} 
 <span class="hljs-comment">//     -  9999 :</span>
 <span class="hljs-keyword">else</span> {ppm=<span class="hljs-number">9999</span>;} <font></font>
 <font></font>
 <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>)ppm;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Função de cálculo de ppm com compensação da temperatura e umidade atuais</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_advanced_work</span> <span class="hljs-params">(<span class="hljs-keyword">float</span> temp, <span class="hljs-keyword">float</span> hum)</span>
</span>{
<span class="hljs-keyword">int</span> ppm; 
<span class="hljs-keyword">int</span> mq4_adc;
<span class="hljs-keyword">float</span> volts;
<span class="hljs-keyword">int</span> Rs;
<span class="hljs-keyword">float</span> RsRo;
<span class="hljs-keyword">float</span> K; <span class="hljs-comment">// </span><font></font>
<font></font>
<span class="hljs-comment">//   :</span><font></font>
mq4_adc = mq4_get_adc(); <font></font>
<span class="hljs-comment">//    :</span><font></font>
volts = mq4_adc/(MQ4_ADC_PRECISION/MQ4_REFERENCE_VOLTAGE); <font></font>
<font></font>
<span class="hljs-comment">//    </span><font></font>
Rs = ((MQ4_REFERENCE_VOLTAGE * MQ4_STATIC_RESISTOR)/volts)- MQ4_STATIC_RESISTOR; <font></font>
<span class="hljs-comment">//    :</span>
RsRo = (<span class="hljs-keyword">float</span>)Rs / (<span class="hljs-keyword">float</span>)mq4_Ro;  
<span class="hljs-comment">// :</span>
K = ((<span class="hljs-number">0.83</span>*(<span class="hljs-built_in">pow</span>((temp/<span class="hljs-number">10</span>),<span class="hljs-number">2</span>)))-(<span class="hljs-number">9.2</span>*(temp/<span class="hljs-number">10</span>))+ <span class="hljs-number">25</span> - (hum*MQ4_HUM_WEIGHT))/<span class="hljs-number">100</span>; 
<span class="hljs-comment">//  </span><font></font>
RsRo = RsRo - K; <font></font>
<font></font>
<span class="hljs-comment">//    (  )</span>
<span class="hljs-keyword">if</span> (RsRo&gt;<span class="hljs-number">0.437</span>) 
<span class="hljs-comment">//     :</span>
{ppm = (<span class="hljs-built_in">pow</span>((<span class="hljs-number">10</span>/(RsRo*<span class="hljs-number">10</span>)),(<span class="hljs-number">1</span>/<span class="hljs-number">0.36152689</span>)))*<span class="hljs-number">1000</span>;} 
<span class="hljs-comment">//     -  9999ppm:</span>
<span class="hljs-keyword">else</span> {ppm=<span class="hljs-number">9999</span>;}<font></font>
 <font></font>
<span class="hljs-comment">//    ( ,  ):</span><font></font>
mq4_RsRo = RsRo; <font></font>
mq4_calib_value = K; <font></font>
mq4_adc_value = mq4_adc; <font></font>
mq4_Rs = Rs; <font></font>
<font></font>
    <span class="hljs-keyword">return</span> ppm;<font></font>
 }<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Função de cálculo de ppm (com compensação de temperatura / umidade e correção para o meio de calibração)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_full_work</span> <span class="hljs-params">(<span class="hljs-keyword">float</span> temp, <span class="hljs-keyword">float</span> hum, <span class="hljs-keyword">float</span> temp_cal, <span class="hljs-keyword">float</span> hum_cal)</span> 
<span class="hljs-comment">//:    ,       </span>
</span>{
<span class="hljs-keyword">int</span> ppm; 
<span class="hljs-keyword">int</span> mq4_adc;
<span class="hljs-keyword">float</span> volts;
<span class="hljs-keyword">int</span> Rs;
<span class="hljs-keyword">float</span> RsRo;
<span class="hljs-keyword">float</span> K;
<span class="hljs-comment">//  :</span>
temp = temp + (<span class="hljs-number">20</span> - temp_cal);  <font></font>
<font></font>
<span class="hljs-comment">//   : </span><font></font>
mq4_adc = mq4_get_adc(); <font></font>
<span class="hljs-comment">//    :</span><font></font>
volts = mq4_adc/(MQ4_ADC_PRECISION/MQ4_REFERENCE_VOLTAGE); <font></font>
<font></font>
<span class="hljs-comment">//     :</span><font></font>
Rs = ((MQ4_REFERENCE_VOLTAGE * MQ4_STATIC_RESISTOR)/volts)- MQ4_STATIC_RESISTOR; <font></font>
<span class="hljs-comment">//  :</span>
RsRo = (<span class="hljs-keyword">float</span>)Rs / (<span class="hljs-keyword">float</span>)mq4_Ro;  
<span class="hljs-comment">//  (   - MQ4_HUM_WEIGHT*(hum_cal-33)          ): </span>
K = ((<span class="hljs-number">0.83</span>*(<span class="hljs-built_in">pow</span>((temp/<span class="hljs-number">10</span>),<span class="hljs-number">2</span>)))-(<span class="hljs-number">9.2</span>*(temp/<span class="hljs-number">10</span>))+ <span class="hljs-number">25</span> - (hum*MQ4_HUM_WEIGHT)+(MQ4_HUM_WEIGHT*(hum_cal<span class="hljs-number">-33</span>)))/<span class="hljs-number">100</span>; <span class="hljs-comment">//</span>
<span class="hljs-comment">//   RsRo:</span><font></font>
RsRo = RsRo - K; <font></font>
<font></font>
<span class="hljs-keyword">if</span> (RsRo&gt;<span class="hljs-number">0.437</span>) ppm = (<span class="hljs-built_in">pow</span>((<span class="hljs-number">10</span>/(RsRo*<span class="hljs-number">10</span>)),(<span class="hljs-number">1</span>/<span class="hljs-number">0.36152689</span>)))*<span class="hljs-number">1000</span>; 
<span class="hljs-keyword">else</span> {ppm=<span class="hljs-number">9999</span>;}<font></font>
<font></font>
<span class="hljs-comment">//    ( ,  ) </span><font></font>
mq4_RsRo = RsRo; <font></font>
mq4_calib_value2 = K; <font></font>
mq4_adc_value = mq4_adc; <font></font>
mq4_Rs = Rs; <font></font>
<font></font>
   <span class="hljs-keyword">return</span> ppm;<font></font>
 }<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valor ADC</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_get_adc</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
 </span>{
 <span class="hljs-keyword">int</span> mq4_adc_bits; <font></font>
 HAL_ADC_Start(&amp;MQ4_ADC);<font></font>
 HAL_ADC_PollForConversion(&amp;MQ4_ADC,<span class="hljs-number">100</span>);<font></font>
 mq4_adc_bits = HAL_ADC_GetValue(&amp;MQ4_ADC);<font></font>
 HAL_ADC_Stop(&amp;MQ4_ADC);<font></font>
    <span class="hljs-keyword">return</span> mq4_adc_bits;<font></font>
 }<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calibração</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mq4_calib_Ro</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
<span class="hljs-keyword">float</span> mq4_adc_volts;
<span class="hljs-keyword">int</span> Rs;
<span class="hljs-keyword">int</span> Ro;
<span class="hljs-keyword">int</span> mq4_adc;<font></font>
mq4_adc = mq4_get_adc(); <font></font>
mq4_adc_volts = (<span class="hljs-keyword">float</span>)mq4_adc/((<span class="hljs-keyword">float</span>)MQ4_ADC_PRECISION/MQ4_REFERENCE_VOLTAGE); 
<span class="hljs-comment">//     </span>
Rs = (((<span class="hljs-keyword">float</span>)MQ4_REFERENCE_VOLTAGE * (<span class="hljs-keyword">float</span>)MQ4_STATIC_RESISTOR)/mq4_adc_volts)- (<span class="hljs-keyword">float</span>)MQ4_STATIC_RESISTOR;
<span class="hljs-comment">//    1000 ppm (      RsRo 4.4  MQ-4):</span><font></font>
Ro = Rs/MQ4_AIR_RSRO;<font></font>
   <span class="hljs-keyword">return</span> Ro;<font></font>
 }<font></font>
</code></pre><br>
</div></div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></h4><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"main.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"adc.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"gpio.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mq4.h"</span></span><font></font>
<font></font>
<span class="hljs-keyword">int</span> ppm_def;  <span class="hljs-comment">//ppm  </span>
<span class="hljs-keyword">int</span> ppm_adv;  <span class="hljs-comment">//ppm     </span>
<span class="hljs-keyword">int</span> ppm_full;  <span class="hljs-comment">//ppm        </span><font></font>
<font></font>
<span class="hljs-keyword">float</span> mq4_temp_cal = <span class="hljs-number">20</span>; <span class="hljs-comment">//    </span>
<span class="hljs-keyword">float</span> mq4_hum_cal = <span class="hljs-number">33</span>; <span class="hljs-comment">//    </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">float</span> mq4_calib_value; <span class="hljs-comment">//   RsRo</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">float</span> mq4_calib_value2; <span class="hljs-comment">//   RsRo c   </span><font></font>
<font></font>
<span class="hljs-keyword">int</span> mq4_Ro = MQ4_RO_DEF; <span class="hljs-comment">//   1000ppm   </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> mq4_Rs;   <span class="hljs-comment">//    </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> mq4_adc_value; <span class="hljs-comment">// </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">float</span> mq4_volts; <span class="hljs-comment">//   </span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">float</span>  mq4_RsRo; <span class="hljs-comment">//   .  . 1000 ppm</span><font></font>
<font></font>
<span class="hljs-comment">//  :</span>
<span class="hljs-keyword">float</span> tf = <span class="hljs-number">0.0f</span>, hf = <span class="hljs-number">0.0f</span>; <span class="hljs-comment">//     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
 HAL_Init();<font></font>
 MX_GPIO_Init();<font></font>
 MX_ADC1_Init();<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<font></font>
{<font></font>
 <span class="hljs-comment">//    :</span><font></font>
 ppm_def = mq4_default_work();              <font></font>
 ppm_adv = mq4_advanced_work(tf,hf);<font></font>
 ppm_full= mq4_full_work(tf,hf,mq4_temp_cal,mq4_hum_cal);<font></font>
 <span class="hljs-comment">//   : </span>
  <span class="hljs-keyword">if</span>(HAL_GPIO_ReadPin(KEY_1_GPIO_Port, KEY_1_Pin)==GPIO_PIN_RESET) <font></font>
   {<font></font>
   mq4_Ro = mq4_calib_Ro(); <span class="hljs-comment">// </span>
   mq4_temp_cal = tf;   <span class="hljs-comment">//     </span>
   mq4_hum_cal = hf;   <span class="hljs-comment">//     </span><font></font>
   }<font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplos de uso</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Determinando o valor de ppm:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uy/ck/sk/uycksku72gsvnzsejgxqlv3cagm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A função do cálculo da compensação de temperatura (neste caso, com a mesma umidade):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/px/vv/ce/pxvvceqaffjkishhom0tb_as2nw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Correção de valores durante a calibração em condições fora do padrão:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/p9/cq/es/p9cqesincmvt2u0lnacftqtj3ie.png"></div> <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h4><br>
<ol>
<li>,   ,       .      TGS2611 (   15-20   MQ-4).           header-      ppm (      Graph 4.4.2).</li>
<li>      1$  ,            . </li>
<li> ,    ,  RsRo    0,5…0,8,      (   ).        (    1000 ppm), ..     ,     .  ,   ,       –      4…5 RsRo    . </li>
<li>      .      ,   «»    header- (     Y).</li>
<li>    ,    , .        (20  , 33%  ( 65%      )).</li>
<li>          3.8 RsRo.      —   2.6,     1.2…1.5.</li>
<li>         ,     RL (   20 ,    10…47 ).     High Precision Resistor.</li>
</ol> <br>
<h4> </h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">  MQ-4</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">   Graph 4.4.2</a>      Rs/Ro.  . </li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490642/index.html">Plug-in para monitorar aplicativos K8s DevOpsProdigy KubeGraf v1.3.0: nova versão e novos recursos</a></li>
<li><a href="../pt490644/index.html">Repositório rpm simples usando Inotify e webdav</a></li>
<li><a href="../pt490648/index.html">Usando recipientes Kata no Kubernetes</a></li>
<li><a href="../pt490650/index.html">Os principais erros na compilação de um currículo de especialistas iniciantes em TI</a></li>
<li><a href="../pt490652/index.html">Logística. Introdução Quase complicado</a></li>
<li><a href="../pt490656/index.html">Tarefas externas do Camunda - uma ferramenta poderosa para criar aplicativos com arquitetura resiliente e escalável</a></li>
<li><a href="../pt490660/index.html">Como garantimos o crescimento do CityMobile</a></li>
<li><a href="../pt490664/index.html">PHP: array_key_exists pesquisa 500 vezes mais rápido que in_array</a></li>
<li><a href="../pt490668/index.html">A história da transformação de produto em projeto e vice-versa (usando o exemplo de Bondade na região de Moscou)</a></li>
<li><a href="../pt490670/index.html">Como fazer um carro escrever testes de código para você</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>