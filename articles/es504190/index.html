<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ©Ô∏è üî´ üëêüèæ MVCC como una forma de garantizar el aislamiento de la transacci√≥n üö£üèª üë®‚Äçüî¨ ‚úÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr Me llamo Vladislav Rodin. Actualmente, soy el jefe del curso High Load Architect en OTUS, y tambi√©n doy cursos sobre arquitectura de softwar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MVCC como una forma de garantizar el aislamiento de la transacci√≥n</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/504190/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola Habr </font><font style="vertical-align: inherit;">Me llamo Vladislav Rodin. </font><font style="vertical-align: inherit;">Actualmente, soy el jefe del curso High Load Architect en OTUS, y tambi√©n doy cursos sobre arquitectura de software. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especialmente para el comienzo de un nuevo set para el curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Arquitecto de altas cargas"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , escrib√≠ un peque√±o material, que con gusto comparto con ustedes.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/hv/fy/ll/hvfyllpmp4nnso0wztz_u0ju278.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La √∫ltima vez,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hablamos con usted sobre las consecuencias de debilitar el aislamiento de transacciones en bases de datos. </font><font style="vertical-align: inherit;">Hoy discutiremos con m√°s detalle una de las formas de garantizar este aislamiento y evitar las anomal√≠as consideradas. </font><font style="vertical-align: inherit;">Como habr√°s notado, en el √∫ltimo art√≠culo se distinguieron dos enfoques: uno se bas√≥ en el hecho de que los registros tienen algunas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versiones</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el segundo en que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloquearemos la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grabaci√≥n de una forma u otra </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por lo tanto, se distinguen dos clases de bases de datos: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versionadas y bloqueadoras</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hoy hablaremos sobre qu√© son los controladores de versi√≥n, y dejemos la consideraci√≥n de los bloqueadores la pr√≥xima vez.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versionionistas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije, uno de los enfoques se basa en el control de versiones. </font><font style="vertical-align: inherit;">Tambi√©n se llama el </font><font style="vertical-align: inherit;">enfoque </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimista</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MVCC (control de concurrencia multiversion)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De hecho, se produce el almacenamiento de versiones para transacciones activas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øD√≥nde se almacenan las versiones?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La implementaci√≥n del mecanismo depende de la base de datos. </font><font style="vertical-align: inherit;">Dar√© ejemplos de algunos de ellos.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada transacci√≥n se caracteriza por alg√∫n id-shnik. Las transacciones de id-shnik crecen de manera mon√≥tona. Cualquier l√≠nea tiene 2 atributos que representan metainformaci√≥n para proporcionar el mecanismo: updated_by_id - id de la transacci√≥n que actualiz√≥ este registro por √∫ltima vez y deleted_by_id - id de la transacci√≥n que elimin√≥ este registro. Cuando llega una nueva transacci√≥n, la base de datos determina los apodos de identificaci√≥n de las transacciones que se realizan actualmente, los cambios realizados por estas transacciones ser√°n ignorados dentro de la transacci√≥n entrante. Resulta que la transacci√≥n entrante funciona como si fuera su versi√≥n de los datos. Las versiones antiguas de datos se almacenan en el mismo lugar que las actuales. Si llega la actualizaci√≥n, se agrega otra l√≠nea y este registro se activa. Tambi√©n est√° claro que para el correcto funcionamiento de este esquema, se requiere un "recolector de basura":si alg√∫n registro ha eliminado_by_id = 100, y el m√≠nimo id-shnik entre las transacciones actuales es 150, entonces este registro debe eliminarse.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL (motor InnoDB)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo la versi√≥n actual se almacena en la base de datos MySQL. </font><font style="vertical-align: inherit;">Cuando llega la actualizaci√≥n, se corrigen los datos dentro del archivo de la tabla. </font><font style="vertical-align: inherit;">Despu√©s de ajustar los datos, la versi√≥n anterior est√° en el registro de reversi√≥n. </font><font style="vertical-align: inherit;">Hay varios registros de reversi√≥n en MySQL (son diferentes para insert'ov y update'ov). </font><font style="vertical-align: inherit;">Si una transacci√≥n necesita una versi√≥n anterior de la l√≠nea, el sistema va a deshacer el registro y restaura la versi√≥n necesaria. </font><font style="vertical-align: inherit;">La versi√≥n tambi√©n est√° determinada por la identificaci√≥n de la transacci√≥n.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or√°culo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El esquema es similar a MySQL: las versiones actuales se almacenan en el archivo de datos, las versiones antiguas se restauran gracias al registro de deshacer. </font><font style="vertical-align: inherit;">El registro de deshacer en Oracle se reescribe c√≠clicamente. </font><font style="vertical-align: inherit;">Por lo tanto, una situaci√≥n es posible cuando una transacci√≥n necesita una versi√≥n muy antigua del registro, pero en el registro de deshacer ya no est√° all√≠. </font><font style="vertical-align: inherit;">Si se produce esta situaci√≥n, la transacci√≥n fallar√°.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS SQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MS SQL permite la inclusi√≥n de los modos versionioner y blocker. Para habilitar el modo versionado en la configuraci√≥n de la base de datos, debe habilitar las instant√°neas. En MS SQL hay una tabla del sistema (tempdb), que est√° dise√±ada para almacenar tablas temporales. Es tempdb que se utiliza para almacenar versiones antiguas, mientras que la tabla contiene las versiones actuales. El proceso del sistema monitorea que en tempdb hay versiones a las que nadie se refiere, se pueden eliminar. Si la transacci√≥n es de larga duraci√≥n, las versiones se guardar√°n para ella. Tempdb crece, alcanza su tama√±o m√°ximo, MS SQL asigna un poco de espacio en disco. Si finaliza, no se pueden realizar transacciones con aislamiento de instant√°nea. Si se utiliza este modo de operaci√≥n, es necesario monitorear transacciones largas,porque la reversi√≥n de tal transacci√≥n a tiempo puede costar tanto como funciona, y tal vez un poco m√°s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conflictos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este enfoque se llama optimista, porque esperamos que no haya conflicto si se ejecutan transacciones paralelas de cambio de datos. </font><font style="vertical-align: inherit;">¬øQu√© pasa en caso de conflicto? </font><font style="vertical-align: inherit;">Suponga que la transacci√≥n T1 cambia 10,000 registros y la transacci√≥n T2 cambia 1 registro en paralelo. </font><font style="vertical-align: inherit;">Si sucedi√≥ que este registro 1 est√° incluido en esos 10,000, entonces una de las transacciones se revertir√°: si T1 se ejecuta primero, entonces T2 se revertir√°, de lo contrario ser√° al rev√©s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mecanismo de retroceso</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mecanismo de reversi√≥n de transacciones en versiones versionadas depende de la implementaci√≥n. </font><font style="vertical-align: inherit;">Por ejemplo, en PostgreSQL, una transacci√≥n se marca como evacuada y el vac√≠o libera espacio en disco. </font><font style="vertical-align: inherit;">Tal mecanismo es lo suficientemente r√°pido. </font><font style="vertical-align: inherit;">En Oracle, para la reversi√≥n, los datos se restauran desde el registro de deshacer. </font><font style="vertical-align: inherit;">En este caso, el tiempo de funcionamiento aumenta, sin embargo, sigue siendo mucho m√°s r√°pido que en los armarios. </font><font style="vertical-align: inherit;">MySQL funciona de la misma manera que Oracle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El enfoque optimista es bueno porque el escritor no bloquea al lector, el lector simplemente lee su versi√≥n de los datos. </font><font style="vertical-align: inherit;">Por lo tanto, el control de versiones es beneficioso si la carga principal es leer m√°s que escribir (blog, informes y otros casos en los que necesita leer con frecuencia y mucho).</font></font><br>
<br>
<hr><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenga m√°s informaci√≥n sobre el curso aqu√≠.</font></font></a></b><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es504180/index.html">La historia de c√≥mo domesticamos a BigQuery</a></li>
<li><a href="../es504182/index.html">Esc√°ner 3D Reviewix Solution500 C500</a></li>
<li><a href="../es504184/index.html">Crear un robot comercial utilizando el aprendizaje autom√°tico en el an√°lisis de series de tiempo</a></li>
<li><a href="../es504186/index.html">Paul Graham: C√≥mo escribir textos √∫tiles (completo)</a></li>
<li><a href="../es504188/index.html">Cuarentena, sistemas en l√≠nea y ciencia de datos. ¬øQui√©n piensa en la retenci√≥n de clientes?</a></li>
<li><a href="../es504194/index.html">El resultado de una encuesta de desarrolladores en Stack Overflow 2020 (+ habraopros)</a></li>
<li><a href="../es504196/index.html">NFC: an√°lisis de la tecnolog√≠a de comunicaci√≥n de campo cercano</a></li>
<li><a href="../es504198/index.html">SwiftUI en los estantes: Animaci√≥n. Parte 1</a></li>
<li><a href="../es504204/index.html">Talleres de IBM: Quarkus (Ultrafast Java for Microservices), Jakarta EE y OpenShift</a></li>
<li><a href="../es504208/index.html">C√≥mo automatizar un centro de servicio compartido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>