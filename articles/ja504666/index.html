<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖕🏽 👨🏻‍🍳 👦🏻 DEVOXX UK。本番環境でのKubernetes：青/緑のデプロイ、自動スケーリング、デプロイの自動化。パート1 ⚪️ ☎️ 🍴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetesは、クラスター化された本番環境でDockerコンテナーを実行するための優れたツールです。ただし、Kubernetesが解決できないタスクがあります。本番環境に頻繁にデプロイする場合、このプロセスでのダウンタイムを回避するために、完全に自動化されたBlue / Greenデプロイメ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DEVOXX UK。本番環境でのKubernetes：青/緑のデプロイ、自動スケーリング、デプロイの自動化。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/504666/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesは、クラスター化された本番環境でDockerコンテナーを実行するための優れたツールです。ただし、Kubernetesが解決できないタスクがあります。本番環境に頻繁にデプロイする場合、このプロセスでのダウンタイムを回避するために、完全に自動化されたBlue / Greenデプロイメントが必要です。これには、外部HTTPリクエストとSSLアップロードも必要です。これには、ha-proxyなどのロードバランサーとの統合が必要です。もう1つのタスクは、クラウドで作業するときのKubernetesクラスター自体の半自動スケーリングです。たとえば、夜間のクラスタースケールの部分的な削減です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesにはこれらの機能はそのままではありませんが、そのような問題を解決するために使用できるAPIを提供します。 Kubernetesクラスターの自動化された青/緑のデプロイとスケーリングツールは、Cloud RTIオープンソースプロジェクトの一部として開発されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このビデオのトランスクリプトは、他のオープンソースコンポーネントとともにKubernetesを構成して、本番環境でのダウンタイムなしにgit commit change commitからコードを受け入れる本番環境に対応する環境を取得する方法について説明しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/4y/jm/cy4yjm9zwmpfpvtfwhwfigavpkw.jpeg"><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は、Kubernetes、特にその自動化について話します。このシステムの基本を確認してから、開発段階でKubernetesをプロジェクトに統合する方法に進みます。私の名前はポールです。オランダ出身で、Luminis Technologiesという会社で働いています。また、「Designing Cloud Applications with OSGi」と「Modulating Java 9」の著者でもあります。私がお話しする内容は、これらの本のテーマとは大きく異なります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
昨年、私の時間のほとんどは、Kubernetesに基づくインフラストラクチャプラットフォームでの作業と、そのためのツールの作成に費やされました。さらに、私はまだJava 9の本に取り組んでおり、私の趣味は重量挙げです。それでは、ビジネスに取り掛かりましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesを管理する理由まず、クラスターでDockerを実行できるからです。 Dockerを使用しない場合は、対象外です。 Dockerを使用する場合、Dockerは主に自分のマシンでコンテナーを実行するように設計されていることがわかります。多くのネットワークでの作業が改善されますが、これはすべて1台のマシンに限定されるため、クラスターでコンテナーを実行する方法はありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-j/vz/o4/-jvzo4f26dwscphdsorfnczffik.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerの作成者は常に機能を拡張していますが、実際にコンテナーを実行する必要がある場合は、コマンドラインを使用するDockerが役に立たないため、Kubernetesのようなものが必要になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesの基本について話しましょう。自動化のためのAPIの使用を検討する前に、このプラットフォームの仕組みの概念を理解する必要があります。典型的なクラスターには、次の要素が含まれます。マスターノードは、クラスター全体の操作を管理および制御し、コンテナーの計画場所とコンテナーの起動方法を決定します。プラットフォームの作業の最も重要な要素であるAPIサーバーを起動します。後でこの問題を詳しく検討します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/rr/af/vvrraf7malypw8vgucqll1-p3ec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dockerコンテナーを備えたポッドポッド、および分散ストレージなどを含むノード作業ノードがたくさんあります。ノードは、コンテナが実行される場所です。 KubernetesはDockerコンテナーを直接操作しませんが、このためにポッドと呼ばれる抽象化を使用します。稼働中のノードは一連のコンテナーを起動し、マスターノードはそれらが機能することを確認します。さらに、クラスターに関するすべての情報を格納する分散キー値タイプのetcdストレージがあります。 Etcdはフォールトトレラントであるため、少なくとも3つの独立したノードで構成されます。これにより、ウィザードは状態を失うことなく機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべてのコンポーネントを使用してKubernetesを起動すると、スケジューリングコンテナがデプロイされます。デプロイとは、コンテナがクラスタで機能し始めることを意味します。これを行うには、まず、マスターサーバーで起動されるレプリケーションコントローラと呼ばれるオブジェクトが必要です。これにより、ハースの複数のインスタンスのステータスを作成および監視できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u-/to/g0/u-tog08sgexmcjn4mn8hkuxdo7s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、5つの異なる作業ノードにコンテナーの5つのレプリカを作成するようにレプリケーションコントローラーを構成するには、非常に多くのノードが必要です。コントローラーがこれらのコンテナーの操作を開始するという事実に加えて、コントローラーはそれらの状況をモニターします。メモリ不足が原因でコンテナの1つに障害が発生した場合、コントローラは5から4への減少を記録し、使用可能なノードの1つで新しいコンテナを開始します。つまり、Kubernetesの実行中は、特定のノードでコンテナを起動せずに、必要な状態を設定します。5つのコンテナをデプロイするようにプラットフォームを構成し、この状態を維持するために制御をレプリケーションコントローラに転送します。したがって、レプリケーションコントローラは非常に重要な概念です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先ほど述べたように、Kubernetesはコンテナーを直接操作しません。彼はポッドを介してこれを行います-コンテナーの上に抽象化。 KubernetesがDockerコンテナーだけでなく、たとえばその代替であるrktコンテナーでも動作することが重要です。これは公式のサポートではありません。Kubernetesの技術ドキュメントを見ると、Dockerコンテナについてのみ言及しているためです。ただし、プラットフォームの開発に伴い、他の形式のコンテナーとの互換性が追加されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/bv/m2/qlbvm22buned0-bj3_bvef6ub8e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アンダーには、同じライフサイクルを持つ多くのコンテナを含めることができます。つまり、すべてのコンテナは同じ期間にしか存在できないため、同じポッドでさまざまな目的でコンテナを実行することはできません。彼らは同時に開始し、同時に作業を停止します。したがって、マイクロサービスを使用する場合、それらすべてを同じサブに置くことはできません。囲炉裏内のコンテナは、ローカルホスト上で互いに「見える」ようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、Webサービスをデプロイしている場合、このアプリケーションのポッドにはnginxコンテナーが含まれ、nginxは変更されませんが、そのまま使用できます。このnginxを機能させるには、独自のHTMLファイルを追加して、Webファイル用の別のコンテナーに配置する必要があります。これらのコンテナは両方とも1つの共通のサブに配置され、同じ物理マシンに存在するかのように連携して動作し始めるため、同じローカルホストにある同じファイルシステムのファイルを見ることができます。クラスターコンポーネントの相互作用を提供するサービスは、env vars環境変数を使用して動作します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に提供するのはネットワーキングです。同じ物理マシン上で複数のコンテナーを実行し、それらをクラウド内に配置することもでき、これらすべてのコンテナーがポートを使用している場合、たとえば、同じポート8080で動作する3つのJavaアプリケーションを使用すると、競合が発生します。これを回避するには、ポートマッピングポートマッピングが必要になります。これにより、アプリケーションの展開プロセスが大幅に複雑になります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qm/wt/vs/qmwtvs3ose470fyu5kyhkzsnxoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、競合が発生する可能性を考慮せずに、起動された各コンテナが、使用可能なすべてのポートにアクセスできる独自の仮想IPアドレスを持っていると便利です。これは、まさにKubernetesが提供するものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はポッドを作成するたびに、ポッド用に独自の仮想IPアドレスを作成します。ポートは残りのポッド間で共有されないため、競合は発生しません。このIPアドレスで機能するのは、このコンテナが行うことだけです。それはすべて簡素化します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これにより新しい問題が発生します。コンテナーを再起動するたびに仮想IPアドレスが変更される場合、これはよく発生しますが、これらのコンテナーをどのように使用できますか？互いに通信する2つの異なるポッドがあり、それらのIPアドレスは常に変化するとします。 Kubernetesは、サービスと呼ばれる概念を使用してこの問題を解決します。これらのサービスは、囲炉裏の上にプロキシを構成し、特定の範囲の仮想IPアドレスを引き続き使用しますが、これらは常に変化しない固定アドレスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ポッドが互いに通信する場合、ポッドは直接ではなく、これらの固定IPアドレスを使用してサービスを介して通信します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7z/jy/ry/7zjyryqkf6iwxdiyer2_ctwmskm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのサービスは、クラスターコンポーネント間で交換されるすべてのレプリカのトラフィックを整理します。したがって、コンポーネント間の通信を確保するには、サービスが非常に重要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスのコンセプトは、マイクロサービスアーキテクチャなど、より大きなアプリケーションの一部に複数のコンポーネントが含まれている場合に、マルチコンポーネントの展開プロセスを大幅に容易にしますが、個人的にはマイクロサービスを扱うのは好きではありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k2/qq/7d/k2qq7dl7sikpjzngr_cyukdv68e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有する各コンポーネントは、独自のライフサイクルを持つ個別のサブとしてデプロイできます。これらは互いに独立しており、個別の名前空間、独自のIPアドレス、ポート番号の範囲があり、個別に更新およびスケーリングできます。サービスを使用すると、コンポーネント間の通信が非常に容易になります。次のスライドは、いくつかのコンポーネントのサンプルアプリケーションを示しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/ig/bq/s4igbqyg-ml1e0bpzq07_oslduu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のフロントエンドは、いくつかのバックエンドサービス、またはバックエンドサービスのレプリカを使用するユーザーインターフェースです。サービスがプロキシとして使用されるそのようないくつかのポッドのバンドルが表示されます。各ポッドのパフォーマンスを気にする必要はありません。いずれかのポッドが失敗すると、Kubernetesは自動的に新しいポッドを再起動します。バックエンドサービスは、さまざまなポッドにある他の多くのサービスを使用し、それらのすべてが相互作用のためのサービスの概念を使用します。これらはすべてうまく機能するため、このアーキテクチャを使用すると、Kubernetesで簡単にデプロイできます。アーキテクチャが異なる原則に基づいて構築されている場合、問題が発生する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
導入される次の重要な概念は、名前空間の名前空間です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/kf/nq/mhkfnqcy6wbrez8clmhjedh9se0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、囲炉裏、レプリケーションコントローラ、サービスを含むKubernetes内の分離されたスペースです。分離とは、たとえば、開発環境が1つの名前空間にあり、本番環境が別の名前空間にある場合、同じ名前のサービスを使用して、異なる名前空間間の競合を防ぐことです。このようにして、同じ物理Kubernetesクラスターに異なる環境を簡単に配置できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのデプロイは、本番環境でアプリケーションをリリースする前に必要なステップです。 Kubernetesのドキュメントには、デプロイを完了するにはkubectlコマンドラインツールを使用する必要があると記載されています。このツールは常に改善されており、何でも配備するのに最適です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/xx/kx/_pxxkxumpyndwztbngvhezit08u.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kubectlコマンドを使用して、API用に作成する必要があるyaml構成ファイルが表示されます。次のスライドは、一般的なyamlファイルの外観を示しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/e2/3u/3ge23une8cdkvl9xhjou_knhpfo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルでは、レプリケーションコントローラを設定します。最初の重要な部分は、複製したい複製の数の行です：3。この数は、使用するノードの数と同じです。この場合、番号3は、クラスター内の3つの異なるマシンでポッドを実行することを意味します。レプリケーションコントローラはシステムの状態を監視し、必要に応じてポッドを自動的に再起動して、指定された数のレプリカが継続的に動作するようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの下部には、炉の仕様を表す行があります。ポート、ストレージノード、Webサーバーの名前とイメージ、およびDockerコンテナーに必要なその他の情報について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、ラベルなどのメタデータがたくさんあります。ラベルはキーと値のペアであり、ポッドなどのオブジェクトに追加されます。これらは、オブジェクトのサブセットをグループ化および選択するために使用されます。 APIの相互作用を整理し、コントローラー、ポッド、サービスをリンクするために非常に重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポッドはそれを作成したレプリケーションコントローラーを認識しません。また、レプリケーションコントローラーはそれが作成したポッドのリストを認識しません。ただし、ポッドとコントローラーの両方にラベルがあります。ラベルの一致は、特定のサブが特定のコントローラーに属していることを示します。これはかなり弱いですが、柔軟な接続であり、APIの安定した動作と自動化を保証します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、kubectlの動作を示す短いデモが表示されます。次に、ロードバランサーの動作とAPIの使用について詳しく説明します。そのため、kubectl get podsコマンドを入力しましたが、まだ何も実行していないため、システムは囲炉裏を表示しません。次に、lsコマンドを入力して、使用可能なファイルのリストを表示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/hk/ep/o-hkep7n2cltgoxhavqlehq_l5i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、リストの最初のファイルの名前を入力すると、今見たのと同様の構成yamlファイルが表示されます。このファイルを使用して、kubectl create –f nginx-controller.yamlと入力して囲炉裏を作成します。その結果、下に作成してしまいます。 kubectl get podsコマンドを繰り返すと、これが機能することがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pq/ke/hb/pqkehb1prgianxodc101qscmbgi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これは1つ下です。複数のレプリカを作成して、コントローラーをスケーリングしてみましょう。これを行うには、コマンドkubectl scale rc nginx-replicas = 5を入力します。rcはレプリケーションコントローラー、5はインスタンスの必要な数、またはこのコントローラーのレプリカです。コンテナーの作成の進行状況が表示されます。数秒後にkubectl get podsコマンドを再入力すると、作成されたコンテナーのほとんどがすでに機能し始めていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cu/rv/bb/curvbbj-qsapsqlbja8jz8ywmu0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、クラスター内で動作するハースまたはレプリカの数を5コピーに増やしました。</font><font style="vertical-align: inherit;">また、たとえば、kubectl describe pod nginx-772iaコマンドを入力して、最初のレプリカ用に作成されたIPアドレスを確認できます。</font><font style="vertical-align: inherit;">これは、この特定のコンテナーに接続されている仮想IPアドレスです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xj/nu/lw/xjnulwtnrrzytonpkxak_chgsy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼の仕事は上記のサービスによって提供されます。</font><font style="vertical-align: inherit;">いずれの場合も、指定された数のコピーが確実に機能するようにする必要があるため、動作しているレプリカの1つを破棄するとどうなるかを見てみましょう。</font><font style="vertical-align: inherit;">kubectl delete pod nginx-772iaコマンドを入力すると、その識別子が付いたアンダーが削除されたことがシステムから報告されます。</font><font style="vertical-align: inherit;">kubectl get podsコマンドを使用すると、5つのコントローラーインスタンスが再び機能しており、リモートレプリカnginx-772iaの代わりに、識別子nginx-sunfnを持つ新しいインスタンスが表示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wo/bx/xj/wobxxjfzhq9y2x-u-bilv6cmw4s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、Kubernetesがいずれかのレプリカの障害に気付いたために発生しました。実際には、私が個人的に削除した限り、これは偶発的な誤動作ではなく、意図的なアクションでした。しかし、クラスター構成で指定されたレプリカの数は変わらないため、レプリケーションコントローラーはインスタンスの1つが消えたことを認識し、新しいIDで新しいコンテナーを作成して開始することで、クラスターの必要な状態をすぐに復元しました。もちろん、これは自分でレプリカを削除し、コントローラーがそれを復元するのを待つときの愚かな例ですが、メモリー不足などのコンテナー障害が原因で、実際に同様の状況が発生します。この場合、コントローラーも再起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリーが不足しているなど、Javaアプリケーションが正しく構成されていない実稼働シナリオがいくつかある場合、プログラムの開始後数時間と1週間の両方でクラッシュを引き起こす可能性があります。このような場合、Kubernetesはワークフローが中断されないように注意します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製品の操作を保証するためにkubectlコマンドラインやキーボードから入力したその他の事項を使用するべきではない場合、上記のすべてが本番環境では適用されないことをもう一度思い出させてください。したがって、自動化の導入を開始する前に、別の大きな問題を解決する必要があります。現在nginxコンテナを実行しているが、「外の世界」からアクセスできないとします。ただし、それがWebアプリケーションであれば、インターネット経由でアクセスできます。このプロセスの安定性を確保するために、クラスターの前にあるロードバランサーが使用されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外部からKubernetesサービスを管理できる必要がありますが、この機能はそのままでは自動的にサポートされません。たとえば、HTTPバランシングを確実にするには、SSLオフロードまたはSSLアップロードを使用する必要があります。これは、データの復号化からサーバーを解放するために、Webサーバーが受信する受信トラフィックからSSLベースの暗号化を削除するプロセスです。トラフィックのバランスを取るために、WebページのGzip圧縮を使用することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.02などのKubernetesの最近のバージョンには、Ingressと呼ばれる新機能があります。ロードバランサーを設定するのに役立ちます。これは、使用する外部ロードバランサーを構成するプラグインを作成できるAPIの新しい概念です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/ly/ic/nwlyicpw6nmt0chuu48t9a7zlbs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、今日この概念は確定されておらず、アルファ版で提供されています。あなたはそれが将来どのように機能するかを示すことができますが、それは今日のそれが機能する方法と一致しません。私はGoogle Cloud Engineが提供するバランサーを使用していますが、このサービスを使用しない場合は、少なくとも現時点では自分で何かを行う必要があります。将来的には、おそらく1か月後には、はるかに簡単になるでしょう。トラフィックのバランスをとるために、イングレス機能を使用できます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、この問題はカスタムトラフィックバランサーを作成することで解決されています。まず、Kubernetesクラスターの前にあるha-proxyを使用できます。これは、外部マシンまたはマシンのセットのクラスターの外部で実行されます。次に、ha-proxyの自動動的構成を提供して、新しい炉床を作成するときに手動で構成しないようにする必要があります。 nginx、Apache、その他のサーバーでも同様の作業を行う必要があり、ha-proxyは簡単に統合できるツールとして機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のスライドは、ロードバランサーノードが着信HTTPSトラフィックを処理する方法を示しています。ha-proxyは、Kubernetesクラスターの外部にある外部マシンまたはマシンのクラスターにあります。 SSLアップロードもここにあります。プロキシは、要求されたアドレスを検出してから、時間の経過とともに変化する可能性のある炉のIPアドレスに関係なく、トラフィックをKubernetesサービスに渡します。次に、サービスは動的IPアドレスで実行中のポッドにトラフィックを渡します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qk/wc/a2/qkwca2qqlvbk3scsv5em8qhhowc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSを使用する場合は、ELBロードバランサーの概念を使用できます。 Elastic Load Balancingは、トラフィックを正常なAmazonインスタンスにリダイレクトして、アプリケーションの安定性を確保します。このメカニズムは、ロードバランサーのスケーラビリティが必要な場合に特に役立ちます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/27/au/6v/27au6v9dwa5zljlmv8rjsuynh6m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、トラフィックは最初にAWSサービスに送信され、そこでSSLがアンロードされます。その後、トラフィックはha-proxyロードバランサーノードに入ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスタが完全にプライベート仮想VPNネットワーク内にある場合も、同じことができます。この場合、AWS ELBを使用すると、システムのセキュリティが完全に保証されます。クラスタ外のさまざまなコンポーネント間にSSLを実装する必要はありません。外の世界とつながる唯一のものは、私たちの代理人です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/kn/gi/gakngiqkuudm2sdiv7txownahuc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
概念的には非常にシンプルに見えますが、実際にはどのように機能しますか？ Ha-proxyを設定して、Kubernetesサービスを認識させるにはどうすればよいですか？ nginxと同じようにha-proxyを見ると、静的構成ファイルがまだ使用されていることがわかります。新しいバックエンドを追加する場合（この場合はKubernetesサービス）、構成ファイルを変更し、ha-proxyをリロードする必要があります。その後、すべてが正常に機能します。もちろん、これを手動で行う必要はありません。したがって、Condfと呼ばれる小さなオープンソースツールを使用できます。このツールは、etcdデータを使用してローカルアプリケーション構成ファイルを管理します。メタデータストアetcdで変更が発生した場合、Confdは構成テンプレートを自動的に生成し、新しい作業条件に従ってha-proxyを再構成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチは追加の作業を必要とするように見えるかもしれませんが、テンプレートを操作する非常にシンプルなツールであるため、その使用はかなり簡単な作業です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
26:00 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
続きはもうすぐ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-Ci4vd4rh4M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">広告のビット:)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつもご利用いただきありがとうございます。私たちの記事は好きですか？もっと面白い資料を見たいですか？注文やお友達に推薦することにより、私たちをサポートしています、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ 4.99からご開発者向けクラウドVPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたのための私達によって発明されたエントリーレベルのサーバのユニークなアナログ：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS（KVM）E5-2697 v3の（6つのコア）10ギガバイトDDR4 480ギガバイトSSDの1Gbpsについて全体の真実19ドルから、またはサーバーを分割する方法？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オプションは、RAID1およびRAID10、最大24コア、最大40GB DDR4で利用可能です）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xdは、アムステルダムのEquinix Tier IVデータセンターで2倍安いですか？</font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">オランダでは、</font></b><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">199ドルから、インテルTetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV</font></a></b><font style="vertical-align: inherit;">を</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">2台</font></a></b><font style="vertical-align: inherit;">だけ持ってい</font><b><font style="vertical-align: inherit;">ます！</font></b></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デルR420-2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB-$ 99から！</font></font></b></b><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">インフラストラクチャビルディングの構築方法</font></a><font style="vertical-align: inherit;">について</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">お</font></a><font style="vertical-align: inherit;">読みください</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Dell R730xd E5-2650 v4サーバーを使用するクラスcは、1ペニーで9,000ユーロかかりますか？</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja504656/index.html">シートベルトを締める：クラウド業界の変化</a></li>
<li><a href="../ja504658/index.html">Yotaが不便なオペレーターである理由と、より良い方法</a></li>
<li><a href="../ja504660/index.html">プリンセスカエル2.0別名Pelophylax ridibundus</a></li>
<li><a href="../ja504662/index.html">音楽を描く：ピュアデータで棺桶ダンス</a></li>
<li><a href="../ja504664/index.html">VK API、Tampermonkey、Telegramボットを介してGoogle Sheetsに音楽グループをスマートに追加</a></li>
<li><a href="../ja504668/index.html">モバイルデベロッパー向けの興味深い資料の要約＃346（5月25〜31日）</a></li>
<li><a href="../ja504670/index.html">コンピュータサイエンスまたは苦痛における統一国家試験</a></li>
<li><a href="../ja504672/index.html">DEVOXX UK。本番環境でのKubernetes：青/緑のデプロイ、自動スケーリング、デプロイの自動化。パート2</a></li>
<li><a href="../ja504674/index.html">CRUDジェネレーターを備えたLaravel + Vue + ElementUIの大規模モジュラーSPAの基礎</a></li>
<li><a href="../ja504676/index.html">ゲームにランダムなピンチを追加します</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>