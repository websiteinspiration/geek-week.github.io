<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏿 🚞 👨🏻‍🎨 Visualisation des promesses et Async / Await 🌤️ 👩🏿‍🤝‍👨🏾 🚈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour mes amis! 
 
 Je vous présente la traduction de l'article "JavaScript Visualized: Promises & Async / Await" de Lydia Hallie. 
 
 Avez-vous ren...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Visualisation des promesses et Async / Await</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501702/"><img src="https://habrastorage.org/webt/bu/rt/-e/burt-epjeqoebt-fjzxyhekod2m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour mes amis! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vous présente la traduction de l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"JavaScript Visualized: Promises &amp; Async / Await"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de Lydia Hallie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avez-vous rencontré du code JavaScript qui ... ne fonctionne pas comme prévu? </font><font style="vertical-align: inherit;">Lorsque les fonctions sont exécutées dans un ordre arbitraire et imprévisible, ou sont exécutées avec un retard. </font><font style="vertical-align: inherit;">L'une des tâches principales des promesses est de rationaliser l'exécution des fonctions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ma curiosité insatiable et mes nuits blanches ont porté leurs fruits - grâce à eux, j'ai créé plusieurs animations. </font><font style="vertical-align: inherit;">Il est temps de parler des promesses: comment elles fonctionnent, pourquoi elles devraient être utilisées et comment elles sont réalisées.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'écriture de code JS, nous devons souvent traiter des tâches qui dépendent d'autres tâches. Supposons que nous voulons obtenir une image, la compresser, lui appliquer un filtre et l'enregistrer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous devons obtenir une image. Pour ce faire, utilisez la fonction </font></font><code>getImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Après avoir chargé l'image, nous la transmettons à la fonction </font></font><code>resizeImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Après avoir compressé l'image, nous lui appliquons un filtre à l'aide de la fonction </font></font><code>applyFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Après compression et application du filtre, nous enregistrons l'image et informons l'utilisateur du succès. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons les éléments suivants:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vy/sf/kq/vysfkqrpan_45kt7zkasehy14m4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm ... Avez-vous remarqué quelque chose? </font><font style="vertical-align: inherit;">Malgré le fait que tout fonctionne, cela ne semble pas le meilleur. </font><font style="vertical-align: inherit;">Nous obtenons de nombreuses fonctions de rappel imbriquées qui dépendent des rappels précédents. </font><font style="vertical-align: inherit;">C'est ce qu'on appelle l'enfer de rappel et cela rend très difficile la lecture et la maintenance du code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, nous avons aujourd'hui des promesses.</font></font><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntaxe de promesse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des promesses ont été introduites dans ES6. </font><font style="vertical-align: inherit;">Dans de nombreux manuels, vous pouvez lire ce qui suit:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une promesse (promesse) est une valeur qui est remplie ou rejetée à l'avenir.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouais ... Explication moyenne. </font><font style="vertical-align: inherit;">À un moment donné, cela m'a fait considérer les promesses comme quelque chose d'étrange, de vague, une sorte de magie. </font><font style="vertical-align: inherit;">Que sont-ils vraiment? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons créer une promesse avec un constructeur </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui prend une fonction de rappel comme argument. </font><font style="vertical-align: inherit;">Cool, essayons: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/or/hu/yxorhuwt-ogj2_grnqpexlducek.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Attendez, qu'est-ce qui revient ici? </font></font><br>
<br>
<code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est un objet qui contient status ( </font></font><code>[[PromiseStatus]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et value ( </font></font><code>[[PromiseValue]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessus, la valeur </font></font><code>[[PromiseStatus]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font></font><code>pending</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la valeur de la promesse est </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne vous inquiétez pas, vous n'avez pas besoin d'interagir avec cet objet, vous ne pouvez même pas accéder aux propriétés </font></font><code>[[PromiseStatus]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>[[PromiseValue]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cependant, ces propriétés sont très importantes lorsque vous travaillez avec des promesses.</font></font><br>
<br>
<code>PromiseStatus</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou le statut d'une promesse peut prendre l'une des trois valeurs suivantes:</font></font><br>
<br>
<ul>
<li><code>fulfilled</code>:   <code>resolved</code> ().   ,  </li>
<li><code>rejected</code>:   <code>rejected</code> ().  - </li>
<li><code>pending</code>:       ,  <code>pending</code> (,    )</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble génial, mais quand une promesse obtient-elle les statuts indiqués? Et pourquoi le statut est-il important? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple ci-dessus, nous transmettons une </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple fonction de rappel au </font><font style="vertical-align: inherit;">constructeur </font></font><code>() =&gt; {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette fonction prend en fait deux arguments. La valeur du premier argument, généralement appelée </font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>res</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, est la méthode invoquée lors de l'exécution de la promesse. La valeur du deuxième argument, généralement appelée </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>rej</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, est la méthode appelée lorsque la promesse est rejetée en cas de problème. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ph/ev/5o/phev5oy-unumotchrvnwquasnas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce qui est sorti sur la console lors de l'appel des méthodes </font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0o/oc/jr/0oocjrmqi757q-x4decxez9rana.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool! Maintenant, nous savons comment nous débarrasser du statut </font></font><code>pending</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et du sens </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le statut de la promesse lors de l'appel de la méthode </font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font></font><code>fulfilled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lorsque </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font><code>rejected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<code>[[PromiseValue]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou la valeur de la promesse est la valeur que nous transmettons aux méthodes </font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme argument. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fait amusant: Jake Archibald après avoir lu cet article a signalé un bogue dans Chrome, qui est plutôt </font></font><code>fulfilled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revenu </font></font><code>resolved</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wv/zd/6y/wvzd6y2g_mz5act3lvnpjkacebm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, maintenant nous savons comment travailler avec l'objet </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais à quoi sert-il? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'introduction, j'ai donné un exemple dans lequel nous obtenons une image, la compressons, lui appliquons un filtre et l'enregistrons. Ensuite, tout s'est terminé par un enfer de rappel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heureusement, les promesses aident à y faire face. Nous réécrivons le code afin que chaque fonction renvoie une promesse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'image est chargée, nous réalisons une promesse. Sinon, si une erreur se produit, rejetez la promesse:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/7w/s3/ci7ws3oh1myicklbwzotn0ge1ge.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce qui se passe lorsque ce code est exécuté dans le terminal: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/vx/01/kfvx01bguyyok5fdwcgnsr2qzfk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool! </font><font style="vertical-align: inherit;">Promis revient avec des données analysées («analysées»), comme prévu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ... quelle est la prochaine étape? </font><font style="vertical-align: inherit;">Nous ne nous intéressons pas au sujet de promis, nous nous intéressons à ses données. </font><font style="vertical-align: inherit;">Il existe 3 méthodes intégrées pour obtenir une valeur Promise:</font></font><br>
<br>
<ul>
<li><code>.then()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: appelé après avoir exécuté une promesse</font></font></li>
<li><code>.catch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: appelé après le rejet de la promesse</font></font></li>
<li><code>.finally()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: toujours appelé, à la fois après l'exécution et après le rejet d'une promesse</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/jm/kx/bl/jmkxblijk89jgqpte14xgimhp4q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La méthode </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur transmise à la méthode </font></font><code>resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/tb/xo/o5tbxoro5xa0cfx80ijumefdg_e.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La méthode </font></font><code>.catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur transmise à la méthode </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8i/6p/vm/8i6pvmsr8uyhrmrlqlfry3o2fzo.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, nous avons obtenu la valeur souhaitée. Nous pouvons tout faire avec cette valeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous sommes confiants dans l'accomplissement ou le rejet d'une promesse, vous pouvez écrire </font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soit </font></font><code>Promise.reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec la valeur appropriée. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/oz/3h/nioz3hmwq-ercnvsi8xc4isphtk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit de la syntaxe qui sera utilisée dans les exemples suivants.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la valeur de la promesse (c'est-à-dire que cette méthode renvoie également la promesse). </font><font style="vertical-align: inherit;">Cela signifie que nous pouvons en utiliser autant </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nécessaire: le résultat du précédent </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est passé en argument au suivant </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/6_/z_/ga6_z_34tprviih5r2yf1afyaoe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><code>getImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons en utiliser plusieurs </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour transférer l'image traitée vers la fonction suivante. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6t/va/8w/6tva8wgrrpmr3yk1h131dhaxcmq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette syntaxe est bien meilleure que l'échelle des fonctions de rappel imbriquées.</font></font><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microtâches et tâches (macro)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, maintenant nous savons comment créer des promesses et comment en extraire des valeurs. Ajoutez du code à notre script et réexécutez-le: tout d' </font></font><br>
<br>
<img src="https://habrastorage.org/webt/47/pd/id/47pdidukvud0u2p8eibdk3ytmiu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
abord, il s'affiche dans la console </font></font><code>Start!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est normal, car nous avons la première ligne de code </font></font><code>console.log('Start!')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La deuxième valeur affichée sur la console n'est </font></font><code>End!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas la valeur de la promesse remplie. La valeur de la promesse est affichée en dernier. Pourquoi est-ce arrivé? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons ici la puissance des promesses. Bien que JS soit monothread, nous pouvons rendre le code asynchrone avec </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Où d'autre pourrions-nous observer un comportement asynchrone? Certaines méthodes intégrées au navigateur, telles que </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, peuvent simuler l'asynchronie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Droite </font><font style="vertical-align: inherit;">Dans la boucle d'événement (boucle d'événement), il existe deux types de files d'attente: la file d'attente des tâches (macro) ou simplement des tâches (file d'attente des tâches (macro), file d'attente des tâches) et la file d'attente des microtâches ou simplement des microtâches (file d'attente des microtâches, microtâches). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce qui s'applique à chacun d'eux? </font><font style="vertical-align: inherit;">Bref, alors:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tâches de macro: setTimeout, setInterval, setImmediate</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microtâches: process.nextTick, Promise callback, queueMicrotask</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la liste des microtâches. </font><font style="vertical-align: inherit;">Lorsque la </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode est exécutée et appelée </font></font><code>then()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>catch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>finally()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la fonction de rappel avec la méthode est ajoutée à la file d'attente des microtâches. </font><font style="vertical-align: inherit;">Cela signifie que le rappel avec la méthode n'est pas exécuté immédiatement, ce qui rend le code JS asynchrone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand est la méthode </font></font><code>then()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>catch()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>finally()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est-elle exécutée? </font><font style="vertical-align: inherit;">Les tâches de la boucle d'événements ont la priorité suivante:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, les fonctions de la pile d'appels sont exécutées. </font><font style="vertical-align: inherit;">Les valeurs renvoyées par ces fonctions sont supprimées de la pile.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois la pile libérée, les microtâches sont placées et exécutées l'une après l'autre (les microtâches peuvent renvoyer d'autres microtâches, créant un cycle sans fin de microtâches).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fois la pile et la file d'attente de microtâches libérées, la boucle d'événements recherche les macros. </font><font style="vertical-align: inherit;">Les tâches de macro sont insérées dans la pile, exécutées et supprimées.</font></font></li>
</ol><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prenons un exemple:</font></font><br>
<br>
<ul>
<li><code>Task1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Une fonction qui est ajoutée à la pile immédiatement, par exemple, par un appel en code.</font></font></li>
<li><code>Task2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Exemple Mikrozadachi </font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProMIS ou tâche ajoutée par </font></font><code>queueMicrotask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><code>Task5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: tâches de macro, par exemple, </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou</font></font><code>setImmediate</code></li>
</ul><br>
<img src="https://habrastorage.org/webt/xl/hp/gl/xlhpgltjfi-dxo70zyuqjimbzzu.gif"><br>
<br><font style="vertical-align: inherit;"></font><code>Task1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retourne d' </font><font style="vertical-align: inherit;">
abord </font><font style="vertical-align: inherit;">une valeur et est supprimé de la pile. Ensuite, le moteur recherche les microtâches dans la file d'attente correspondante. Après avoir ajouté et supprimé des microtâches de la pile, le moteur recherche les tâches de macro, qui sont également ajoutées à la pile et supprimées de celle-ci après avoir renvoyé les valeurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assez de mots. Écrivons le code. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/oj/ee/_hojeek-qp4i0v1fatji5qxyd4m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce code, nous avons une macro </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tâche et une micro tâche </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Exécutez le code et voyez ce qui s'affiche dans la console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque: dans l'exemple ci-dessus, j'utilise des méthodes telles que </font></font><code>console.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Toutes ces méthodes sont internes, elles n'apparaissent donc pas dans la trace de la pile - ne soyez pas surpris lorsque vous ne les trouvez pas dans les outils de dépannage du navigateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la première ligne, nous avons</font></font><code>console.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est ajouté à la pile et affiché dans la console </font></font><code>Start!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Après cela, cette méthode est supprimée de la pile et le moteur continue d'analyser le code. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/ss/nu/pcssnuqx9bbmlywvd6zearuoaqu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur atteint </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est ajouté à la pile. Cette méthode est une méthode de navigateur intégrée: sa fonction de rappel ( </font></font><code>() =&gt; console.log('In timeout')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) est ajoutée à l'API Web et est là avant le déclenchement du minuteur. Malgré le fait que le compteur de la minuterie est à 0, le rappel est toujours placé d'abord dans WebAPI puis dans la file d'attente des tâches de macro: </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il s'agit d'une tâche de macro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9t/yq/yw/9tyqywfouzwyjiks-b41l5vtxq4.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, le moteur atteint la méthode </font></font><code>Promise.resolve()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette méthode est ajoutée à la pile, puis exécutée avec une valeur </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Son rappel </font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est placé dans la file d'attente des microtâches. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/mi/np/acminp3ylrdseonspqvm_m_nq44.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, le moteur atteint la deuxième méthode </font></font><code>console.log()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est immédiatement poussé sur la pile, il est sorti sur la console</font></font><code>End!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la méthode est supprimée de la pile et le moteur continue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/76/wt/z0/76wtz0lpgee1nuob0vz2coji-fw.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur «voit» que la pile est vide. </font><font style="vertical-align: inherit;">Vérification de la file d'attente des tâches. </font><font style="vertical-align: inherit;">Il y est situé </font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il est poussé sur la pile, la valeur de la promesse est affichée sur la console: dans ce cas, une chaîne </font></font><code>Promise!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1n/5u/05/1n5u05wug2yzg2hqfftf2lilaci.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur voit que la pile est vide. </font><font style="vertical-align: inherit;">Il "regarde" dans la file d'attente des microtâches. </font><font style="vertical-align: inherit;">Elle est vide aussi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de vérifier la file d'attente des tâches macro: elle est là </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il est poussé sur la pile et renvoie une méthode </font></font><code>console.log()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Une chaîne est sortie sur la console </font></font><code>'In timeout!'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est retiré de la pile. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6v/42/lo/6v42lobbr5hkg5y4tvrt5rapwio.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terminé. </font><font style="vertical-align: inherit;">Maintenant, tout s'est mis en place, non?</font></font><br>
<br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / attente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ES7 a introduit une nouvelle façon de travailler avec du code asynchrone dans JS. En utilisant les mots clés </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons créer une fonction asynchrone qui renvoie implicitement une promesse. Mais ... comment on fait ça? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus tôt, nous avons expliqué comment créer explicitement un objet </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: en utilisant </font></font><code>new Promise(() =&gt; {})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>Promise.reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de cela, nous pouvons créer une fonction asynchrone qui renvoie implicitement l'objet spécifié. Cela signifie que nous n'avons plus besoin de créer manuellement </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/me/py/py/mepypyet9xa6eky4slldnhflprs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fait qu'une fonction asynchrone renvoie implicitement une promesse est, bien sûr, génial, mais la puissance de cette fonction se manifeste pleinement lors de l'utilisation d'un mot-clé </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fait attendre la fonction asynchrone que la promesse (sa valeur) se termine. Pour obtenir la valeur de la promesse réalisée, nous devons affecter à la variable la valeur attendue (attendue) de la promesse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que nous pouvons retarder l'exécution d'une fonction asynchrone? Génial, mais ... qu'est-ce que cela signifie? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ce qui se passe lorsque vous exécutez le code suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/wt/o0/vhwto0gbbpku7nehrlg5fe1nsni.gif"><br>
<br>
<hr><br>
<img src="https://habrastorage.org/webt/tk/zo/nx/tkzonxqy0rpal2gsghjjok33elg.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début, le moteur voit </font></font><code>console.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette méthode est poussée sur la pile et affichée sur la console </font></font><code>Before function!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/7u/k4/hr7uk471lkclnrkq6j4reflsaem.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, la fonction asynchrone est appelée </font></font><code>myFunc()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, son code est exécuté. Dans la première ligne de ce code, nous appelons la seconde </font></font><code>console.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une ligne </font></font><code>'In function!'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette méthode est ajoutée à la pile, sa valeur s'affiche sur la console et elle est supprimée de la pile. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/0k/bq/x80kbq_ivdjxkn5otwj7iraowiu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code de fonction est ensuite exécuté. Sur la deuxième ligne, nous avons un mot-clé </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose qui se passe ici est l'exécution de la valeur attendue: dans ce cas, la fonction </font></font><code>one</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est poussé sur la pile et renvoie une promesse. Une fois la promesse terminée et la fonction </font></font><code>one</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retournée la valeur, le moteur voit </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, l'exécution de la fonction asynchrone est retardée. L'exécution du corps de la fonction est suspendue, le code restant est exécuté comme une microtâche. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nq/iz/w6/nqizw6g6lhqkheesua-yai1etwy.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après que l'exécution de la fonction asynchrone a été retardée, le moteur revient à l'exécution du code dans un contexte global. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e-/ad/ea/e-adeazwnxkl63oawcydpapig1a.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que tout le code a été exécuté dans un contexte global, la boucle d'événements recherche les microtâches et les détecte </font></font><code>myFunc()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>myFunc()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poussé sur la pile et exécuté. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable </font></font><code>res</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtient la valeur de la promesse exécutée retournée par la fonction </font></font><code>one</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Nous appelons </font></font><code>console.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec la valeur de la variable </font></font><code>res</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: une chaîne </font></font><code>One!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans ce cas. </font></font><code>One!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'affiche dans la console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terminé. Remarquez la différence entre la fonction asynchrone et la méthode </font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promis? Mot-clé</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retarde l'exécution d'une fonction asynchrone. </font><font style="vertical-align: inherit;">Si nous </font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'utilisions, le corps Promise continuerait de fonctionner.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré assez verbeux. </font><font style="vertical-align: inherit;">Ne vous inquiétez pas si vous ne vous sentez pas en sécurité lorsque vous travaillez avec des promesses. </font><font style="vertical-align: inherit;">Il faut du temps pour s'y habituer. </font><font style="vertical-align: inherit;">Ceci est commun à toutes les techniques de travail avec du code asynchrone dans JS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voir également </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Visualisation du travail des travailleurs de service"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci pour votre temps. </font><font style="vertical-align: inherit;">J'espère que cela a été bien dépensé.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501684/index.html">Cloître -> gestion aisée des clusters OTP</a></li>
<li><a href="../fr501688/index.html">Performances SSR supplémentaires avec le serveur Nuxt fullstack (partie 2)</a></li>
<li><a href="../fr501690/index.html">Qui est un ingénieur DevOps, que fait-il, combien il gagne et comment le devenir</a></li>
<li><a href="../fr501696/index.html">Présentation du tableau de bord Postgresql pour postgres_exporter (Prometheus)</a></li>
<li><a href="../fr501698/index.html">Nous avons réduit le temps de développement d'un nouveau scénario de publication d'une annonce de 6 jours à 42 secondes</a></li>
<li><a href="../fr501704/index.html">Le projet va-t-il à un nouveau niveau? Test nécessaire</a></li>
<li><a href="../fr501706/index.html">Comment faire un bon court rapport</a></li>
<li><a href="../fr501708/index.html">Adapter les verres ouverts et fermés à un demi-masque et un obturateur fait maison pour les verres ouverts</a></li>
<li><a href="../fr501710/index.html">Pour quelles niches la crise 2020 est le meilleur moment pour le développement</a></li>
<li><a href="../fr501712/index.html">Parler de tests: quelques histoires et une enquête</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>