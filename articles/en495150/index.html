<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÅÔ∏è üÜé üïô Docker and VMWare Workstation on the same Windows machine üë®üèª‚Äçüé® ‚≠ïÔ∏è üí∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task was simple, put Docker on your working laptop with Windows, which already has a zoo. Delivered Docker Desktop created containers, everything ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Docker and VMWare Workstation on the same Windows machine</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495150/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task was simple, put Docker on your working laptop with Windows, which already has a zoo. </font><font style="vertical-align: inherit;">Delivered Docker Desktop created containers, everything is ok, but just quickly discovered that VMWare Workstation stopped running virtual machines with an error:</font></font><br>
<br>
<pre><code class="plaintext hljs">VMware Workstation and Device/Credential Guard are not compatible. VMware Workstation can be run after disabling Device/Credential Guard.</code></pre><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work got up, urgent need to be fixed</font></font></h3><br>
<img src="https://habrastorage.org/webt/b1/t1/zb/b1t1zbtgf0ryh6x4bfeocywnkig.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using Google, it was found that this error occurs due to the incompatibility of VMWare Workstation and Hyper-V on the same machine. </font><font style="vertical-align: inherit;">The problem is known and there is an official VMWare solution on how to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fix it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with reference to the Microsoft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manage Windows Defender Credential Guard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> knowledge base </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The solution is to disable the Defender Credential Guard (paragraph 4 of the Disable Windows Defender Credential Guard section helped me):</font></font><br>
<br>
<pre><code class="plaintext hljs">mountvol X: /s<font></font>
copy %WINDIR%\System32\SecConfig.efi X:\EFI\Microsoft\Boot\SecConfig.efi /Y<font></font>
bcdedit /create {0cb3b571-2f2e-4343-a879-d86a476d7215} /d "DebugTool" /application osloader<font></font>
bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} path "\EFI\Microsoft\Boot\SecConfig.efi"<font></font>
bcdedit /set {bootmgr} bootsequence {0cb3b571-2f2e-4343-a879-d86a476d7215}<font></font>
bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} loadoptions DISABLE-LSA-ISO<font></font>
bcdedit /set {0cb3b571-2f2e-4343-a879-d86a476d7215} device partition=X:<font></font>
mountvol X: /d</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the restart, Windows will ask if it is really possible to disable Defender Credential Guard. </font><font style="vertical-align: inherit;">Yes! </font><font style="vertical-align: inherit;">Thus, VMWare Workstation will return to normal operation, and we will be in the same place as before installing the docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I never found solutions to reconcile Hyper-V and VMWare Workstation, I hope they will make friends in new versions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another way</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I have long been hooked on VMWare Workstation for various purposes, tried to get down on Hyper-V and VirtualBox, but the functionality did not satisfy my tasks, so I still sit. </font><font style="vertical-align: inherit;">It turned out there is a solution to how to bring together VMWare, Docker and VSCode in one working environment. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Machine</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - allows you to run the Docker Engine on a virtual host and connect to it both remotely and locally. </font><font style="vertical-align: inherit;">And for him there is a compatibility driver with VMWare Workstation, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link to GitHub</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I will not particularly retell the installation instructions, only a list of ingredients:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Toolbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Machine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> included)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Machine VMware Workstation Driver</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker desktop</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, Docker Desktop, unfortunately, is also needed. </font><font style="vertical-align: inherit;">If you demolished it, then install it again, but this time removing the checkbox about making changes to the OS so as not to break VMWare Workstation again. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I want to note right away that everything works fine from a simple user, the installation programs will ask for an escalation of rights when they need to, but all the commands on the command line and scripts are executed from the current user. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, the team:</font></font><br>
<pre><code class="powershell hljs"><span class="hljs-variable">$</span> docker<span class="hljs-literal">-machine</span> create -<span class="hljs-literal">-driver</span>=vmwareworkstation dev</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
from Boot2Docker a virtual dev will be created inside of which there will be a Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can attach this virtual machine to the VMWare Workstation graphical interface by opening the corresponding vmx file. </font><font style="vertical-align: inherit;">But this is not necessary, because VSCode will now need to be run by PowerShell with a script (for some reason, docker-machine and docker-machine-driver-vmwareworkstation turned out to be in the bin folder):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">cd</span> ~/bin<font></font>
./docker<span class="hljs-literal">-machine</span> env dev | <span class="hljs-built_in">Invoke-Expression</span>
code</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VSCode opens to work with code on the local machine and docker in the virtual machine. The </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker for Visual Studio Code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plugin </font><font style="vertical-align: inherit;">allows you to conveniently manage containers in a virtual machine without climbing into the console. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Difficulties:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the process of creating docker-machine, my process freezes:</font></font><br>
<br>
<pre><code class="powershell hljs">Waiting <span class="hljs-keyword">for</span> SSH to be available...</code></pre><br>
<img src="https://habrastorage.org/webt/sf/4a/a7/sf4aa7bnmnh4zwmtccicwm4yong.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And after some time it ended with exceeding attempts to establish a connection with the virtual machine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It's all about the politics of certificates. When creating a virtual machine, you will see the directory ~ \ .docker \ machine \ machines \ dev in this directory there will be certificate files for connecting via SSH: id_rsa, id_rsa.pub. OpenSSH may refuse to use them because it believes that they have access rights problems. Only here docker-machine will not tell you anything about this, but will simply reconnect until it gets bored. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As soon as the creation of a new virtual machine starts, go to the ~ \ .docker \ machine \ machines \ dev directory and change the rights to the specified files, one at a time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The owner of the file should be the current user, full access only to the current user and SYSTEM, all other users, including the group of administrators and the administrators themselves, must be deleted. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There may also be problems with converting absolute paths from the Windows format to Posix, and with binding volumes containing symbolic link. </font><font style="vertical-align: inherit;">But that's another story.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495130/index.html">Sorting in Scala - an example on cats</a></li>
<li><a href="../en495138/index.html">How will society and technology change after the coronavirus. Expert Opinions</a></li>
<li><a href="../en495140/index.html">Top 10 memes of the past decade</a></li>
<li><a href="../en495146/index.html">Uninterrupted power supply of shopping centers or Shopping Must Go On</a></li>
<li><a href="../en495148/index.html">Dell XPS 13 7390 "2 in 1": a lightweight metal transformer with a bright screen and Intel Ice Lake</a></li>
<li><a href="../en495154/index.html">Eternal server - how to get rid of monthly hosting payments</a></li>
<li><a href="../en495156/index.html">Amazing your product still works</a></li>
<li><a href="../en495158/index.html">Developers Perekrestok.ru. What we do and who we are looking for in teams</a></li>
<li><a href="../en495160/index.html">From monolith to distributed system</a></li>
<li><a href="../en495162/index.html">What you need to know about the impact of news on stock prices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>