<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📿 😍 😵 大規模なレガシーネットワークを自動化する方法 🎞️ 👨🏽 🎂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ねえ。15,260以上のオブジェクトと38,000のネットワークデバイスがあり、それらの機能を構成、更新、チェックする必要があります。そのような機材を維持することは非常に困難であり、多くの時間、労力、および人員を必要とします。そのため、ネットワーク機器を使用した作業を自動化する必要があり、社内ネット...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>大規模なレガシーネットワークを自動化する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/468197/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ねえ。</font><font style="vertical-align: inherit;">15,260以上のオブジェクトと38,000のネットワークデバイスがあり、それらの機能を構成、更新、チェックする必要があります。</font><font style="vertical-align: inherit;">そのような機材を維持することは非常に困難であり、多くの時間、労力、および人員を必要とします。</font><font style="vertical-align: inherit;">そのため、ネットワーク機器を使用した作業を自動化する必要があり、社内ネットワークを管理するためのコードとしてのネットワークの概念を採用することにしました。</font><font style="vertical-align: inherit;">カットの下で、自動化の歴史、行われた間違い、およびシステム構築のさらなる計画をお読みください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/6w/po/tq6wposkryjnbyoqfcpv6qgj-q8.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一言で言えば、ネットワークを自動化したい</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんにちは！私の名前はAlexander Prokhorovです。私たちの部門のネットワークエンジニアのチームと一緒に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#IT </font></font></b><b><font color="#FFA500"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X5の</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークに</font><b><font style="vertical-align: inherit;">取り組ん</font></b><font style="vertical-align: inherit;">でいます</font><font style="vertical-align: inherit;">。私たちの部門は、ネットワークインフラストラクチャ、監視、ネットワーク自動化、およびNetwork as a Codeのトレンドの方向性を開発しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初、私は原則としてネットワークの自動化を本当に信じていませんでした。多くのレガシーおよび構成エラーがありました-中央認証がどこにあるわけでも、すべてのハードウェアがSSHをサポートしているわけではなく、すべての</font></font><abbr title="シンプルなネットワーク管理プロトコル"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SNMP</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が構成されて</font><font style="vertical-align: inherit;">いる</font><font style="vertical-align: inherit;">わけではありません</font><font style="vertical-align: inherit;">。これらすべてが、自動化への信念を大きく損なった。したがって、まず最初に、自動化を開始するために必要なもの、つまり、SSH接続の標準化、単一認証（</font></font><abbr title="認証、承認、会計"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）およびSNMPプロファイル。</font><font style="vertical-align: inherit;">このすべての基盤により、構成をデバイスに大量配信するためのツールを作成できますが、疑問が生じます。</font><font style="vertical-align: inherit;">したがって、特に自動化の開発計画と、コードとしてのネットワークの概念を作成する必要が生じました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シスコによると、コードとしてのネットワークの概念は、次の原則を意味します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲット構成をリポジトリ、ソース管理に保存する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成の変更は、単一ソースの真実のリポジトリを通過します</font></font></li>
<li><font style="vertical-align: inherit;"><abbr title="アプリケーションプログラミングインターフェース"><font style="vertical-align: inherit;">API</font></abbr><font style="vertical-align: inherit;">を介した構成の埋め込み</font></font><abbr title="アプリケーションプログラミングインターフェース"><font style="vertical-align: inherit;"></font></abbr></li>
</ul><br>
<img src="https://habrastorage.org/webt/bw/wi/6u/bwwi6us89ipickqukqdgd1zkvk0.jpeg" align="right" width="240"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の2つのポイントにより、ネットワークインフラストラクチャの管理にDevOpsまたはNetDevOpsアプローチを適用できます。</font><font style="vertical-align: inherit;">3番目の段落では、たとえば、APIがない場合はどうするかなどの困難があります。</font><font style="vertical-align: inherit;">もちろん、SSHとCLI、私たちはネットワーカーです！</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それで十分ですか？</font></font></b><div class="spoiler_text">          ,             . <br>
<br>
,        :<br>
<br>
<ul>
<li>,     ,        ? </li>
<li>,       ,          ? </li>
<li>           ?  ? </li>
<li>           ? </li>
<li>           ? </li>
<li>      ,    Zero Touch Provisioning? </li>
<li>     ,     ? </li>
<li>      ?</li>
</ul><br>
      ,     ,    ,              .<br>
<br>
<img src="https://habrastorage.org/webt/iz/us/cx/izuscxapcn5-6ync8yexgqlxs0u.jpeg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワーク管理に新しいアプローチを適用することに加えて、データの整合性、更新、そしてもちろん自動化など、ネットワークインフラストラクチャのいくつかのより深刻な問題を解決したいと考えました。</font><font style="vertical-align: inherit;">自動化とは、機器への構成の大量配信だけでなく、自動構成、ネットワーク機器のインベントリデータの自動収集、監視システムとの統合も意味します。</font><font style="vertical-align: inherit;">しかし、まず最初に。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが目指している機能は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク機器データベース（+検出、+自動更新）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本ネットワークアドレス（IPAM +検証チェック）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監視システムと在庫データの統合</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン管理システムでの構成標準の保管</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトのターゲット構成の自動形成</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク機器への構成の大量配信</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CDプロセスを実装して、ネットワーク構成の変更を管理する</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI / CDを使用したネットワーク構成のテスト</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZTP（ゼロタッチプロビジョニング）-オブジェクトの機器の自動セットアップ</font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長い話、自動化を試みました</font></font></b><div class="spoiler_text">         2   .             ?<br>
<br>
        .    ,    .      ,   ,       .<br>
<br>
    ?   ,       ,  ,    ,      (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Python</a>,   ). ,     n+1 ,        .  ,      .    «   »  ,      ,      .<br>
<br>
<img src="https://habrastorage.org/webt/rp/ts/ie/rptsiexeli86bdhhumak_d1z7eo.jpeg"><br>
<br>
<h5></h5> <br>
<img src="https://habrastorage.org/webt/ow/q8/tk/owq8tkmg8p5xeorxn0ypbwqudw0.png" align="right" width="240"> ,        –     .          <i><font color="#008080">prefix-list</font></i>   ,      .       <i><font color="#008080">loopback'</font></i>  ,       ,         .   ,       .     <i><font color="#008080">prefix-list</font></i>,            .      <i><font color="#008080">prefix-list'</font></i>,  ,  .        <i><font color="#008080">prefix-list</font></i>      .    ,     ,  <i><font color="#008080">«no prefix-list pl-cisco-primer»</font></i>    .<br>
<br>
 -   ,  ,   ,    ,   .     , .     ,    10,   2-3   .      .  40-50        ,    .       20    .    7    .<br>
<br>
<h5> </h5><br>
<i><font color="#008080">Prefix-list</font></i>    <i><font color="#008080">loopback'</font></i> —     ,   .           .     <i><font color="#008080">route-map</font></i>  <i><font color="#008080">BGP</font></i>   <i><font color="#008080">DENY</font></i>  <i><font color="#008080">«match ip address prefix list»</font></i>.    <i><font color="#008080">route-map</font></i>   <i><font color="#008080">PERMIT</font></i>.<br>
<br>
   ,    :<br>
<br>
<ul>
<li> <i><font color="#008080">route-map</font></i>,    <i><font color="#008080">match</font></i> –  </li>
<li>  <i><font color="#008080">prefix-list</font></i>  <i><font color="#008080">implicit deny</font></i>,      </li>
<li> <i><font color="#008080">prefix-list</font></i>  <i><font color="#008080">implicit permit</font></i></li>
</ul><br>
    <b>Cisco IOS</b>.  <i><font color="#008080">prefix-list</font></i>  ,    <i><font color="#008080">route-map</font></i>,    <i><font color="#008080">«match ip address prefix-list pl-test-cisco»</font></i>.  <i><font color="#008080">prefix-list</font></i>         (   <i><font color="#008080">match</font></i>),      <i><font color="#008080">show ip prefix-list</font></i>.<br>
<br>
<pre><code class="plaintext hljs">2901-NOC-4.2(config)#route-map rm-test-in<font></font>
2901-NOC-4.2(config-route-map)#match ip address prefix-list pl-test-in<font></font>
2901-NOC-4.2(config-route-map)#do sh run | i prefix<font></font>
match ip address prefix-list pl-test-in<font></font>
2901-NOC-4.2(config-route-map)#do sh ip prefix<font></font>
ip prefix-list pl-test-in: 0 entries<font></font>
2901-NOC-4.2(config-route-map)#<font></font>
</code></pre><br>
  ,     <i><font color="#008080">prefix-list</font></i>,   ,         <i><font color="#008080">DENY</font></i>  <i><font color="#008080">route-map</font></i>.  <i><font color="#008080">prefix-list</font></i>   ,      <i><font color="#008080">BGP</font></i>      <i><font color="#008080">DENY</font></i>.<br>
     ,   ?     <i><font color="#008080">BGP</font></i>  Cisco.<br>
<i><font color="#008080">BGP</font></i>        ,       <i><font color="#008080">BGP</font></i>,   BGP    , <i><font color="#008080">«clear ip bgp &lt;peer-ip&gt;»</font></i>  Cisco. <br>
<br>
      :<br>
<br>
<ul>
<li><b>Soft-Reconfiguration</b>  Cisco</li>
<li><b>Route Refresh</b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RFC2918</a></li>
</ul><br>
<b>Soft-reconfiguration</b>  ,   <i><font color="#008080">UPDATE</font></i>  ,         <i><font color="#008080">adj-RIB-in</font></i>.       <i><font color="#008080">UPDATE</font></i>  .<br>
<b>Route Refresh</b> –  «»   <i><font color="#008080">UPDATE</font></i>  .        .  –     <i><font color="#008080">UPDATE</font></i> .  –     <i><font color="#008080">UPDATE</font></i>    ,    . ,    Cisco   :<br>
<br>
<pre><code class="plaintext hljs">neighbor &lt;peer-ip&gt; dont-capability-negotiate
</code></pre><br>
   Cisco – 30- ,       <i><font color="#008080">BGP</font></i>.   ,  30          .        ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">BUG CSCvi91270</a>.       , <img src="https://habrastorage.org/webt/mk/tm/7s/mktm7sjydraauxoeajhyzkm9lyc.png" align="right" width="400">       <i><font color="#008080">debug</font></i>   <i><font color="#008080">UPDATE</font></i>     <i><font color="#008080">soft-reconfiguration</font></i>. (      –    )<br>
<br>
 <b>Soft-Reconfiguration</b>    :<br>
<br>
<pre><code class="plaintext hljs">2901-NOC-4.2(config)#no ip prefix-list pl-test seq 10 permit 10.5.5.0/26 <font></font>
2901-NOC-4.2(config)#do sh clock<font></font>
16:53:31.117 Tue Sep 24 2019<font></font>
Sep 24 16:53:59.396: BGP(0): start inbound soft reconfiguration for<font></font>
Sep 24 16:53:59.396: BGP(0): process 10.5.5.0/26, next hop 10.0.0.1, metric 0 from 10.0.0.1<font></font>
Sep 24 16:53:59.396: BGP(0): Prefix 10.5.5.0/26 rejected by inbound route-map.<font></font>
Sep 24 16:53:59.396: BGP(0): update denied, previous used path deleted<font></font>
Sep 24 16:53:59.396: BGP(0): no valid path for 10.5.5.0/26<font></font>
Sep 24 16:53:59.396: BGP(0): complete inbound soft reconfiguration, ran for 0ms<font></font>
Sep 24 16:53:59.396: BGP: topo global:IPv4 Unicast:base Remove_fwdroute for 10.5.5.0/26<font></font>
2901-NOC-4.2(config)#<font></font>
</code></pre><br>
 <b>Route-Refresh</b>     :<br>
<br>
<pre><code class="plaintext hljs">2801-RTR (config-router)#<font></font>
*Sep 24 20:57:29.847 MSK: BGP: 10.0.0.2 rcv REFRESH_REQ for afi/sfai: 1/1<font></font>
*Sep 24 20:57:29.847 MSK: BGP: 10.0.0.2 start outbound soft reconfig for afi/safi: 1/1<font></font>
</code></pre><br>
 <i><font color="#008080">Route-Refresh</font></i>       <i><font color="#008080">soft-reconfiguration inbound</font></i>  ,         .<br>
<br>
, <i><font color="#008080">prefix-list</font></i>  ,  ,  30  .    ,  ,   .       ,      .<br>
<br>
      ,   ,  ,       .<br>
<br>
<img src="https://habrastorage.org/webt/du/ew/zc/duewzcojsasaegoufuir8jymcz0.jpeg"><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なシステムとその接続</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スポイラーからの簡単な結論は、構成のエラーの大量配信が行われないように、構成の大量配信のプロセスをより体系化および制御することです。 </font></font><br>
<br>
<pre><code class="plaintext hljs">- DevOps:    50ms     4   <font></font>
-     : ", !@#$%"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが到達したスキームは、「ビジネス」マスターデータブロック、「ネットワーク」マスターデータブロック、ネットワークインフラストラクチャ監視システム、構成配信システム、テストユニットを備えたバージョン管理システムで構成されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/sc/wl/ftscwlfa_zs4afvfwkeybwo7et0.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なのはデータだけです</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、社内にあるオブジェクトを知る必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><abbr title="エンタープライズリソースプランニング"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ERP</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会社システム。ほとんどすべてのオブジェクトのデータは、すべての店舗と流通センターにあります。また、在庫番号を付けてIT倉庫を通過した機器のデータもあり、今後も参考になります。欠落しているオフィスのみで、システムで開始されません。この問題を別のプロセスで解決しようとしています。開く瞬間から始めて、各オブジェクトに接続が必要であり、通信の設定を選択するため、この時点でマスターデータを作成する必要があります。ただし、データ不足は別のトピックであり、興味がある場合は、この説明を別の記事にまとめることをお勧めします。</font></font><br>
<br>
<b><abbr title="HPサービスマネージャー"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HPSM-</font></font></abbr></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的な</font><abbr title="構成管理データベース"><font style="vertical-align: inherit;">CMDB</font></abbr><font style="vertical-align: inherit;">を含むシステム</font></font><abbr title="構成管理データベース"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IT、インシデント管理、変更管理。システムはすべてのITに共通なので、ネットワーク機器を含むすべてのIT機器が必要です。これは、ネットワークを介してすべての最終データを追加する場所です。インシデントと変更の管理により、将来的には監視システムと対話する予定です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは私たちが持っているオブジェクトを知っており、それらをネットワーク上のデータで豊かにします。 -この目的のために、我々は、2つのシステム持っ</font></font><abbr title="IPアドレス管理"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPAM</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SolarWinds社</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と当社独自のCMDB.nocシステムを。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -IPサブネットのストレージ、会社のIPアドレスの所有権に関する最も正確なデータはここにあるはずです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMDB.noc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ネットワーク機器の静的データが格納されるWEBインターフェイスを備えたデータベース-ルーター、スイッチ、アクセスポイント、プロバイダー、およびそれらの特性。静的の下では、それらの変更は人間の参加によってのみ実行されることを意味します。つまり、自動検出はこのデータベースに変更を加えません。オブジェクトに何をインストールする必要があるかを理解する必要があります。そのベースは、会社全体が動作する生産的なシステムと内部ネットワークツールの間のバッファとして必要です。開発を加速し、必要なフィールド、新しい関係、パラメーターの調整などを追加します。さらに、このソリューションは、開発の速度だけでなく、妥協することなく、必要なデータ間の関係が存在する場合にも役立ちます。小さな例として、いくつかの</font><abbr title="外部ID"><font style="vertical-align: inherit;">exid</font></abbr><font style="vertical-align: inherit;">を使用し</font></font><abbr title="外部ID"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPAM、SAP、HPSM間のデータ通信用のデータベース。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、接続されたネットワーク機器とIPアドレスを含むすべてのオブジェクトに関する完全なデータを受け取りました。</font><font style="vertical-align: inherit;">次に、これらのサイトで提供する構成テンプレートまたはネットワークサービスが必要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uy/qp/7f/uyqp7fxlkyf4rluokbotmtg5wvy.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真実の単一の情報源</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、最初のNaaC原則の適用に到達しました-ターゲット構成をリポジトリに保存します。</font><font style="vertical-align: inherit;">私たちの場合、これはGitlabです。</font><font style="vertical-align: inherit;">選択は簡単でした：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、このツールはすでに社内にあり、最初から展開する必要はありませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二に、ネットワークインフラストラクチャに関する現在および将来のすべてのタスクに非常に適しています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gitlabでは、自動化の主な興味深い部分が行われます-構成標準または、より簡単に言えば、テンプレートの変更プロセス。 </font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準変更プロセスの例</font></font></h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちが持っているオブジェクトのタイプの1つは、Pyaterochkaストアです。</font><font style="vertical-align: inherit;">そこでは、典型的なトポロジーは1つのルーターと1つまたは2つのスイッチで構成されます。</font><font style="vertical-align: inherit;">テンプレート構成ファイルはGitlabに保存されますが、この部分ではすべてがシンプルです。</font><font style="vertical-align: inherit;">しかし、それはまったくNaaCではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、新しいプロジェクトがやってきたとしましょう。</font><font style="vertical-align: inherit;">新しいITプロジェクトのタスクは、特定の量の店舗でパイロットを作成することです。</font><font style="vertical-align: inherit;">パイロットの結果によると-成功した場合、このタイプのすべてのオブジェクトの複製を作成します。</font><font style="vertical-align: inherit;">それ以外の場合は、レプリケーションを実行せずにパイロットを折りたたみます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスは、Gitロジックに非常によく適合します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいプロジェクトでは、ブランチを作成します。ここで構成を変更します</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブランチでは、このプロジェクトがパイロットされているオブジェクトのリストも保持しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功した場合は、masterブランチでマージ要求を作成します。これは、prodネットワークに複製する必要があります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失敗した場合は、ブランチを履歴に残すか、単に削除します</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/lx/o1/hu/lxo1hulupq0mzqe37qcodnutxno.png" align="right" width="240"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の近似では-自動化がなくても、ネットワーク構成で一緒に作業するための非常に便利なツールです。</font><font style="vertical-align: inherit;">特に、3つ以上のプロジェクトが同時に発生したと想像すると、</font><font style="vertical-align: inherit;">prodでプロジェクトをリリースするときが来たら、merge-requestsのすべての構成の競合を解決し、設定が相互に排他的でないことを確認する必要があります。</font><font style="vertical-align: inherit;">そして、これはgitで行うのに非常に便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このアプローチにより、Gitlab CI / CDツールを使用して構成を仮想的にテストし、テストベンチまたはパイロットグループのオブジェクトへの構成の配信を自動化する柔軟性が追加されます。</font><font style="vertical-align: inherit;">//必要に応じて製品版でも。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成を任意の環境に展開する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初、主な目標は、構成の大量配布でした。これは、エンジニアの時間を節約し、構成タスクを高速化できるツールであることを明確に示しています。</font><font style="vertical-align: inherit;">このため、「ネットワークとしてのコード」というすばらしいアクティビティが始まる前であっても、</font><font style="vertical-align: inherit;">機器に接続して機器構成を収集するか構成するための</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューションを作成しました。</font><font style="vertical-align: inherit;">これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netmiko</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pysnmp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jinja2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、バルク構成をいくつかの亜種に分割する時が来ました。</font></font><br>
<br>
<ol>
<li><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストゾーンとパイロットゾーンへの構成の配信</font></font></b><div class="spoiler_text">    Gitlab CI,     pipeline       .<br>
</div></div></li>
<li><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品での構成の複製</font></font></b><div class="spoiler_text"><ul>
<li> ,     38k      —   —     prod. ,       ,      .     Ansible +-AWX       inventory    -. </li>
<li>  –   ,        playbook’,     ,      .</li>
</ul></div></div></li>
<li><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ収集</font></font></b><div class="spoiler_text"><ul>
<li>  </li>
<li> </li>
<li>  </li>
</ul> <br>
      ,      -       ,       . ,        -      , ,      . ,    ,    «»  ,  - ,    <i>ssh</i>, <i>snmp</i>, <i>aaa</i>     .      python,     <i>legacy</i>- ,       ,  -    ,               <i>ansible</i>  . <br>
<br>
   —   <i>ansible</i>  <i>inventory</i>-,        (       /)   <i>playbook</i>    <i>inventory</i>.     ,    RedHat  Ansible    .   ,       . <br>
    —       ,  , –      . ,    python -     ,             ,     (  , ),   ,   , ,         API.<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モニタリングのような検証</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、自動化のタスクの1つは、この自動化から何が失われたかを見つけることです。</font><font style="vertical-align: inherit;">38kのすべてが初めて完全に構成されているわけではなく、誰かが手で機器をセットアップすることも起こります。</font><font style="vertical-align: inherit;">そして、これらの変更を追跡</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、正義を</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲット構成に</font><font style="vertical-align: inherit;">復元する必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成が標準に準拠していることを確認するには、3つの方法があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期的にチェックを行う-現在の状態をアンロードし、ターゲットをチェックして、特定された欠陥を修正します。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何もチェックせずに、定期的に-ターゲット構成をロールアウトします。</font><font style="vertical-align: inherit;">確かに、何かを壊すリスクがあります-おそらくターゲット構成にすべてがあったわけではありません。</font></font></li>
<li>  —       <i>Single Source of Truth</i>      .   :     ,      -,     <i>IPAM</i>. </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のケースでは、この作業をインシデント管理（OS）に転送するオプションが表示されます。これにより、不測の事態は、緊急事態によるものよりも、全体を通して小さな部分で解消されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbixは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「14,000個のオブジェクトをどのように監視したか」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の記事</font><font style="vertical-align: inherit;">ですでに説明しましたが、考えられるトリガーやアラートを作成できる分散オブジェクト監視システムです。最後の記事を書いてから、Zabbix 4.0 </font></font><abbr title="長期サポート"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LTSに</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップグレードしました</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">Web Zabbixに</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
基づい</font><font style="vertical-align: inherit;">て、ネットワークサポートポータルを更新しました</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これにより、すべてのシステムのオブジェクトに関するすべての情報を1つの画面で確認できるほか、スクリプトを実行して頻繁に発生する問題を確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o_/65/ha/o_65haiskiyx5jvmofs1wwmy9a8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、新機能も導入しました</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Zabbix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、システム統合スクリプトや自動検出スクリプトなどのスケジュールされたスクリプトを起動</font><font style="vertical-align: inherit;">するための</font><i><font style="vertical-align: inherit;">CRONになり</font></i><font style="vertical-align: inherit;">ました。</font><font style="vertical-align: inherit;">これは、すべてのサーバーをチェックせずに、現在のスクリプトとスクリプトをいつ、どこで実行するかを調べる必要がある場合に非常に便利です。</font><font style="vertical-align: inherit;">確かに、30秒以上実行されるスクリプトの場合</font><font style="vertical-align: inherit;">、終了を待たず</font><font style="vertical-align: inherit;">にスクリプトを</font><font style="vertical-align: inherit;">起動する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランチャー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">幸い、それは簡単です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launcher.sh</font></font></b><div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash</span><font></font>
nohup $* &gt; /dev/null 2&gt;/dev/null &amp;<font></font>
<span class="hljs-built_in">echo</span> $(date) Started job <span class="hljs-keyword">for</span> $*
</code></pre><br>
</div></div><br>
<img src="https://habrastorage.org/webt/gu/vp/ww/guvpwwbg0scnt8ngqkhuy7keey8.png"><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Splunk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ネットワーク機器からイベントログを収集できるソリューションであり、自動化の監視にも使用できます。たとえば、設定のバックアップを収集すると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOG</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CFG-5-BACKUPを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成し</font><font style="vertical-align: inherit;">、ルーターまたはスイッチがSplunkにメッセージを送信します。ここで、ネットワーク機器からのこのタイプのメッセージの数をカウントします。これにより、スクリプトが検出した機器の量を追跡できます。そして、いくつの鉄片がこれを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Splunk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に報告できた</font><font style="vertical-align: inherit;">かを確認し、すべての鉄片からのメッセージが到着</font><i><font style="vertical-align: inherit;">したこと</font></i><font style="vertical-align: inherit;">を確認します。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スペクトラム</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-重要なオブジェクトの監視に使用する統合システム。ネットワークを介した重要なインシデントの解決に役立つ強力なツールです。</font><font style="vertical-align: inherit;">自動化では、データをプルするだけで使用します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソース</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではない</font><font style="vertical-align: inherit;">ため、可能性は多少制限されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケーキの桜</font></font></h3> <br>
<img src="https://habrastorage.org/webt/-a/g_/qk/-ag_qktnw97gq5edbpbswa1h_xa.png" align="right" width="240"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機器にマスターデータがあるシステムを使用すると、ZTPまたはゼロタッチプロビジョニングの作成を考えることができます。ボタンの「自動調整」に似ていますが、ボタンがありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のブロックから必要なすべてのデータがあります。オブジェクト、そのタイプ、機器の種類（ベンダーとモデル）、アドレス（IPAM）、現在の構成標準（Git）はわかっています。これらをすべてまとめることで、少なくともデバイスにアップロードするための構成テンプレートを準備できます。これは、ワンタッチプロビジョニングに似ていますが、それ以上は必要ない場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
True Zero Touchには、構成されていないハードウェアに構成を自動的に配信する方法が必要です。</font><font style="vertical-align: inherit;">また、ベンダーを問わず望ましい。</font><font style="vertical-align: inherit;">いくつかの実用的なオプションがあります-すべての機器が中央倉庫を通過する場合のコンソールサーバー、機器がすぐに到着する場合のモバイルコンソールソリューション。</font><font style="vertical-align: inherit;">私たちはこれらのソリューションのみに取り組んでいますが、実用的なオプションがあればすぐに共有できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として、「コードとして</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">ネットワーク</font></b><font style="vertical-align: inherit;">」の概念で</font><font style="vertical-align: inherit;">は、5つの主要なマイルストーンがありました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスターデータ（システムとデータの相互通信、システムのAPI、サポートと起動のための十分なデータ）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データと構成の監視（ネットワークデバイスの自動検出、施設での構成の関連性の確認）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成のバージョン管理、テスト、およびパイロット（ネットワークに適用されるGitlab CI / CD、ネットワーク構成テストツール）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成の配信（Ansible、AWX、接続用のPythonスクリプト）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロタッチプロビジョニング（必要なデータ、プロセスを構築する方法、構成されていないハードウェアに接続する方法）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてを1つの記事に収めるのはうまくいきませんでした。各項目は個別に議論する価値があります。実際に解決策を確認するときに、今から何かについて話すことができます。</font><font style="vertical-align: inherit;">いずれかのトピックに興味がある場合-最後に、次の記事に投票できるアンケートがあります。</font><font style="vertical-align: inherit;">トピックがリストに含まれていないが、それについて読むのが興味深い場合は、できるだけ早くコメントを残してください。経験を共有してください。</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virilin Alexander（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xscrew</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）およびシブガツリンマラット（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーカリオット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）2018年秋のyandex-cloudへの参照訪問と、クラウドネットワークインフラストラクチャの自動化に関するストーリーについて。</font><font style="vertical-align: inherit;">彼の後、X5 Retail Groupのインフラストラクチャでの自動化とNetDevOpsの使用に関するインスピレーションと多くのアイデアを得ました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468185/index.html">AWS EC2サービスと連携</a></li>
<li><a href="../ja468189/index.html">コンソールトリックを使用してJavaScriptデバッグスキルを向上させる</a></li>
<li><a href="../ja468191/index.html">RubyRussia 2019：サーバーレスについてのニコライ・スベルチコフ</a></li>
<li><a href="../ja468193/index.html">JVMの内部、パート1-クラスローダー</a></li>
<li><a href="../ja468195/index.html">なぜ私の財政はビーラインに依存しているのですか？</a></li>
<li><a href="../ja468203/index.html">完璧なチャンスを求めてなぞなぞ</a></li>
<li><a href="../ja468205/index.html">内部からのGIT：導入（翻訳）</a></li>
<li><a href="../ja468207/index.html">Zabbixを更新した方法</a></li>
<li><a href="../ja468211/index.html">「冗談を言いたかったのですが、誰も理解していませんでした」、またはプロジェクトのプレゼンテーションに埋もれない方法</a></li>
<li><a href="../ja468213/index.html">tinc-boot-痛みのないフルメッシュネットワーク</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>