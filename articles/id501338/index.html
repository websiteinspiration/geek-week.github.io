<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèñÔ∏è ü§õüèæ ‚ôãÔ∏è Di dalam mesin virtual Python. Bagian 1 üåî ü•û üì¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Saya akhirnya memutuskan untuk mencari tahu cara kerja juru bahasa Python. Untuk melakukan ini, ia mulai mempelajari satu buku artikel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Di dalam mesin virtual Python. Bagian 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501338/"><img src="https://habrastorage.org/webt/jm/9r/uc/jm9rucormi1lrcussoajjremszi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Halo semuanya. </font><font style="vertical-align: inherit;">Saya akhirnya memutuskan untuk mencari tahu cara kerja juru bahasa Python. </font><font style="vertical-align: inherit;">Untuk melakukan ini, ia mulai mempelajari satu buku artikel dan pada saat yang sama menerjemahkannya ke dalam bahasa Rusia. </font><font style="vertical-align: inherit;">Faktanya adalah bahwa terjemahan tidak memungkinkan Anda untuk melewatkan kalimat yang tidak dapat dimengerti dan kualitas asimilasi materi meningkat.</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya minta maaf sebelumnya untuk kemungkinan ketidakakuratan. </font><font style="vertical-align: inherit;">Saya selalu berusaha menerjemahkan seakurat mungkin, tetapi salah satu masalah utama: sama sekali tidak disebutkan beberapa istilah dalam padanan bahasa Rusia.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan Terjemahan</font></font></b>
                        <div class="spoiler_text"> Python   ,  ¬´code object¬ª,  (  )     .    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  </a>   .<br>
<br>
<b> </b> ‚Äî   Python,    -   ,     :   ,    ,  ( !    )  ,    ,     - (     )  .. ‚Äî    ()  -   str (,  Python3, bytes).<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa pemrograman Python telah ada selama beberapa waktu. </font><font style="vertical-align: inherit;">Pengembangan versi pertama dimulai oleh Guido Van Rossum pada tahun 1989, dan sejak itu bahasa tersebut telah berkembang dan menjadi salah satu yang paling populer. </font><font style="vertical-align: inherit;">Python digunakan dalam berbagai aplikasi: dari antarmuka grafis ke aplikasi analisis data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuan artikel ini adalah untuk pergi di belakang layar dari juru bahasa dan memberikan tinjauan konsep tentang bagaimana program yang ditulis dengan Python dieksekusi. </font><font style="vertical-align: inherit;">CPython akan dipertimbangkan dalam artikel, karena pada saat penulisan, ini adalah implementasi Python yang paling populer dan mendasar.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python dan CPython digunakan sebagai sinonim dalam teks ini, tetapi penyebutan Python berarti CPython (versi python diimplementasikan dalam C). </font><font style="vertical-align: inherit;">Implementasi lain termasuk PyPy (python diimplementasikan dalam subset Python terbatas), Jython (implementasi pada Java Virtual Machine), dll.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya suka membagi pelaksanaan program Python menjadi dua atau tiga langkah utama (tercantum di bawah), tergantung pada bagaimana penerjemah dipanggil. </font><font style="vertical-align: inherit;">Langkah-langkah ini akan dibahas dalam beberapa derajat dalam artikel ini:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inisialisasi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - langkah ini melibatkan pengaturan berbagai struktur data yang diperlukan oleh proses python. </font><font style="vertical-align: inherit;">Kemungkinan besar ini akan terjadi ketika program dijalankan dalam mode non-interaktif melalui cangkang penerjemah.</font></font></li>
<li><b></b> ‚Äî     , :       ,    ,       .</li>
<li><b></b> ‚Äî         .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mekanisme untuk menghasilkan pohon "parsing", serta pohon sintaksis abstrak (ASD), adalah bahasa independen. Oleh karena itu, kami tidak akan membahas topik ini terlalu banyak, karena metode yang digunakan dalam Python mirip dengan metode bahasa pemrograman lainnya. Di sisi lain, proses membangun tabel simbol dan objek kode dari ADS dengan Python lebih spesifik, oleh karena itu, perlu mendapat perhatian khusus. Ini juga membahas interpretasi objek kode yang dikompilasi dan semua struktur data lainnya. Topik yang dibahas oleh kami akan mencakup, tetapi tidak terbatas pada: proses membangun tabel simbol dan membuat objek kode, objek Python, objek frame, objek kode, objek fungsional, opcodes, loop interpreter, generator, dan kelas pengguna.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Materi ini ditujukan bagi siapa saja yang tertarik mempelajari cara kerja mesin virtual CPython. Diasumsikan bahwa pengguna sudah terbiasa dengan python dan memahami dasar-dasar bahasa. Ketika mempelajari struktur mesin virtual, kita akan menemukan sejumlah besar kode-C, sehingga akan lebih mudah bagi pengguna yang memiliki pemahaman dasar bahasa C untuk memahami materi. Jadi, pada dasarnya, apa yang Anda butuhkan untuk berkenalan dengan materi ini: keinginan untuk mempelajari lebih lanjut tentang mesin virtual CPython. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini adalah versi tambahan dari catatan pribadi yang dibuat dalam studi pekerjaan internal penerjemah. Ada banyak hal berkualitas dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video PyCon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kuliah sekolah, dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog ini.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pekerjaan saya tidak akan selesai tanpa sumber pengetahuan yang fantastis ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di akhir buku ini, pembaca akan dapat memahami seluk-beluk bagaimana interpreter Python menjalankan program Anda. </font><font style="vertical-align: inherit;">Ini termasuk berbagai tahapan pelaksanaan program dan struktur data yang sangat penting dalam program. </font><font style="vertical-align: inherit;">Untuk memulainya, kita akan melihat apa yang terjadi ketika program sepele dijalankan, ketika nama modul diteruskan ke penerjemah pada baris perintah. </font><font style="vertical-align: inherit;">Kode yang dapat dieksekusi CPython dapat diinstal dari sumber, mengikuti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panduan Pengembang Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buku ini menggunakan versi Python 3.</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilan 30.000 kaki</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bab ini berbicara tentang bagaimana penerjemah mengeksekusi program Python. Dalam bab-bab berikut, kami akan memeriksa berbagai bagian dari "teka-teki" ini dan memberikan deskripsi yang lebih rinci dari setiap bagian. Terlepas dari kompleksitas program yang ditulis dengan Python, proses ini selalu sama. Penjelasan luar biasa yang diberikan oleh Yaniv Aknin dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serangkaian artikelnya tentang Python Internal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menetapkan topik untuk diskusi kita.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modul source test.py dapat dieksekusi dari baris perintah (ketika meneruskannya sebagai argumen ke program interpreter Python dalam bentuk $ python test.py). Ini hanyalah salah satu cara untuk memanggil executable Python. Kami juga dapat meluncurkan juru bahasa interaktif, mengeksekusi baris file sebagai kode, dll. Tapi ini dan metode lain tidak menarik bagi kita. Ini adalah transfer modul sebagai argumen (di dalam baris perintah) ke file yang dapat dieksekusi (Gambar 2.1) yang paling mencerminkan aliran berbagai tindakan yang terlibat dalam pelaksanaan kode yang sebenarnya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/bw/i5/tlbwi5onywd5j1xmkmyv7ni_lgm.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar 2.1: Streaming saat runtime.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eksekusi python adalah program C biasa, jadi ketika dipanggil, proses yang serupa dengan yang ada, misalnya, di kernel linux atau program hello world yang sederhana, terjadi. </font><font style="vertical-align: inherit;">Luangkan waktu sebentar untuk memahami: eksekusi python hanyalah program lain yang meluncurkan program Anda sendiri. </font><font style="vertical-align: inherit;">"Hubungan" semacam itu ada antara bahasa C dan assembler (atau llvm). </font><font style="vertical-align: inherit;">Proses inisialisasi standar (yang tergantung pada platform tempat eksekusi berlangsung) dimulai ketika python executable dipanggil dengan nama modul sebagai argumen.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini mengasumsikan Anda menggunakan sistem operasi berbasis Unix, sehingga beberapa fitur mungkin berbeda pada Windows.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahasa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada saat startup menjalankan semua "keajaiban" inisialisasi - memuat pustaka, memeriksa / menetapkan variabel lingkungan, dan setelah itu, metode utama dari python executable diluncurkan sama seperti program C lainnya. File executable utama Python terletak di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./Programs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font><b><font style="vertical-align: inherit;">python.c</font></b><font style="vertical-align: inherit;"> dan melakukan beberapa inisialisasi (seperti membuat salinan argumen baris perintah program yang diteruskan ke modul). Fungsi utama kemudian memanggil fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_Main yang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terletak di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./Modules/main.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ia memproses proses inisialisasi interpreter: menganalisis argumen baris perintah, menetapkan flag, membaca variabel lingkungan, mengeksekusi kait, mengacak fungsi hash, dll. Disebut juga</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_Initialize</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pylifecycle.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menangani inisialisasi struktur data interpreter dan stream state, adalah dua struktur data yang sangat penting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meneliti deklarasi struktur data interpreter dan status streaming memperjelas mengapa mereka diperlukan. Keadaan interpreter dan stream hanyalah struktur dengan pointer ke bidang yang berisi informasi yang diperlukan untuk menjalankan program. Data status </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juru</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dibuat melalui </font><b><font style="vertical-align: inherit;">typedef</font></b><font style="vertical-align: inherit;"> (anggap saja kata kunci ini dalam C sebagai definisi jenis, meskipun ini tidak sepenuhnya benar). Kode untuk struktur ini ditunjukkan pada Listing 2.1.</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-number">1</span>     <span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">is</span> {</span>
 <span class="hljs-number">2</span> 
 <span class="hljs-number">3</span>         <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">is</span> *<span class="hljs-title">next</span>;</span>
 <span class="hljs-number">4</span>         <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ts</span> *<span class="hljs-title">tstate_head</span>;</span>
 <span class="hljs-number">5</span> 
 <span class="hljs-number">6</span>         PyObject *modules;
 <span class="hljs-number">7</span>         PyObject *modules_by_index;
 <span class="hljs-number">8</span>         PyObject *sysdict;
 <span class="hljs-number">9</span>         PyObject *builtins;
<span class="hljs-number">10</span>         PyObject *importlib;
<span class="hljs-number">11</span> 
<span class="hljs-number">12</span>         PyObject *codec_search_path;
<span class="hljs-number">13</span>         PyObject *codec_search_cache;
<span class="hljs-number">14</span>         PyObject *codec_error_registry;
<span class="hljs-number">15</span>         <span class="hljs-keyword">int</span> codecs_initialized;
<span class="hljs-number">16</span>         <span class="hljs-keyword">int</span> fscodec_initialized;
<span class="hljs-number">17</span> 
<span class="hljs-number">18</span>         PyObject *builtins_copy;
<span class="hljs-number">19</span>     } PyInterpreterState;</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar Kode 2.1: Struktur data status</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
juru bahasa Siapa pun yang telah menggunakan bahasa pemrograman Python sejak lama dapat mengenali beberapa bidang yang disebutkan dalam struktur ini (sysdict, builtins, codec).</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kolom </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah referensi ke instance lain dari interpreter, karena beberapa interpreter Python dapat ada dalam proses yang sama.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bidang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* tstate_head</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menunjukkan utas eksekusi utama (jika program multi-utas, maka penerjemah umum untuk semua utas yang dibuat oleh program). </font><font style="vertical-align: inherit;">Kami akan membahas ini secara lebih rinci dalam waktu dekat.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modules, modules_by_index, sysdict, builtins</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importlib</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berbicara sendiri. </font><font style="vertical-align: inherit;">Semuanya didefinisikan sebagai instance dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang merupakan tipe root untuk semua objek di mesin virtual Python. </font><font style="vertical-align: inherit;">Objek Python akan dibahas lebih rinci dalam bab-bab berikut.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bidang yang terkait dengan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codec *</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berisi informasi yang membantu mengunduh pengodean. </font><font style="vertical-align: inherit;">Ini sangat penting untuk decoding byte.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eksekusi program harus terjadi di utas. </font><font style="vertical-align: inherit;">Struktur keadaan aliran berisi semua informasi yang diperlukan aliran untuk menjalankan beberapa objek kode. </font><font style="vertical-align: inherit;">Bagian dari struktur data aliran ditunjukkan pada Listing 2.2.</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-number">1</span>     <span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ts</span> {</span>
 <span class="hljs-number">2</span>         <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ts</span> *<span class="hljs-title">prev</span>;</span>
 <span class="hljs-number">3</span>         <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">ts</span> *<span class="hljs-title">next</span>;</span>
 <span class="hljs-number">4</span>         PyInterpreterState *interp;
 <span class="hljs-number">5</span> 
 <span class="hljs-number">6</span>         <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">frame</span> *<span class="hljs-title">frame</span>;</span>
 <span class="hljs-number">7</span>         <span class="hljs-keyword">int</span> recursion_depth;
 <span class="hljs-number">8</span>         <span class="hljs-keyword">char</span> overflowed; 
 <span class="hljs-number">9</span>                         
<span class="hljs-number">10</span>         <span class="hljs-keyword">char</span> recursion_critical; 
<span class="hljs-number">11</span>         <span class="hljs-keyword">int</span> tracing;
<span class="hljs-number">12</span>         <span class="hljs-keyword">int</span> use_tracing;
<span class="hljs-number">13</span> 
<span class="hljs-number">14</span>         Py_tracefunc c_profilefunc;
<span class="hljs-number">15</span>         Py_tracefunc c_tracefunc;
<span class="hljs-number">16</span>         PyObject *c_profileobj;
<span class="hljs-number">17</span>         PyObject *c_traceobj;
<span class="hljs-number">18</span> 
<span class="hljs-number">19</span>         PyObject *curexc_type;
<span class="hljs-number">20</span>         PyObject *curexc_value;
<span class="hljs-number">21</span>         PyObject *curexc_traceback;
<span class="hljs-number">22</span> 
<span class="hljs-number">23</span>         PyObject *exc_type;
<span class="hljs-number">24</span>         PyObject *exc_value;
<span class="hljs-number">25</span>         PyObject *exc_traceback;
<span class="hljs-number">26</span> 
<span class="hljs-number">27</span>         PyObject *dict;  <span class="hljs-comment">/* Stores per-thread state */</span>
<span class="hljs-number">28</span>         <span class="hljs-keyword">int</span> gilstate_counter;
<span class="hljs-number">29</span> 
<span class="hljs-number">30</span>         ... 
<span class="hljs-number">31</span>     } PyThreadState;</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 2.2: Bagian dari</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
struktur </font><i><font style="vertical-align: inherit;">data state stream</font></i><font style="vertical-align: inherit;"> Struktur data interpreter dan state stream dibahas lebih rinci dalam bab-bab berikut. Proses inisialisasi juga menetapkan mekanisme impor serta stdio dasar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menyelesaikan semua inisialisasi, Py_Main memanggil fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run_file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (juga terletak di modul main.c). Berikut ini adalah serangkaian panggilan fungsi: PyRun_AnyFileExFlags -&gt; PyRun_SimpleFileExFlags -&gt; PyRun_FileExFlags -&gt; PyParser_ASTFromFileObject. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyRun_SimpleFileExFlags</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menciptakan namespace __main__ di mana konten file akan dieksekusi. Ini juga memeriksa apakah versi file pyc ada (file pyc adalah file sederhana yang berisi versi kode sumber yang sudah dikompilasi). Jika versi pyc ada, upaya akan dilakukan untuk membacanya sebagai file biner, dan kemudian jalankan. Jika file pyc tidak ada, PyRun_FileExFlags dipanggil, dll. Fungsi PyParser_ASTFromFileObject memanggil </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyParser_ParseFileObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang membaca isi modul dan membuat parsing tree dari itu. Kemudian, pohon yang dibuat diteruskan ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyParser_ASTFromNodeObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang membuat pohon sintaksis abstrak darinya.</font></font><br>
<br>
<blockquote>     ,     Py_INCREF  Py_DECREF.    ,     . CPython        :  ,      ,    Py_INCREF. ,      ,       Py_DECREF.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AST dihasilkan ketika </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run_mod</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dipanggil </font><font style="vertical-align: inherit;">. Fungsi ini memanggil </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyAST_CompileObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang membuat objek kode dari AST. Perhatikan bahwa bytecode yang dihasilkan selama panggilan PyAST_CompileObject dilewatkan melalui optimizer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lubang intip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang melakukan optimalisasi rendah bytecode yang dihasilkan sebelum membuat objek kode. Fungsi run_mod kemudian menerapkan fungsi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyEval_EvalCode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ceval.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke objek kode. Ini mengarah ke serangkaian panggilan fungsi lain: PyEval_EvalCode -&gt; PyEval_EvalCode -&gt; _PyEval_EvalCodeWithName -&gt; _PyEval_EvalFrameEx. Objek kode dilewatkan sebagai argumen ke sebagian besar fungsi ini dalam satu bentuk atau lainnya. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_PyEval_EvalFrameEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ini adalah loop juru bahasa normal yang menangani eksekusi objek kode. Namun, ini disebut tidak hanya dengan objek kode sebagai argumen, tetapi dengan objek bingkai, yang memiliki atribut sebagai bidang yang merujuk ke objek kode. Bingkai ini menyediakan konteks untuk eksekusi objek kode. Dengan kata sederhana: loop juru terus membaca instruksi selanjutnya yang ditunjukkan oleh penghitung instruksi dari array instruksi. Kemudian ia mengeksekusi instruksi ini: ia menambah atau menghapus objek dari tumpukan nilai dalam proses sampai kosong ke dalam array instruksi yang akan dieksekusi (baik, atau sesuatu yang luar biasa terjadi yang mengganggu loop).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python menyediakan satu set fungsi yang dapat Anda gunakan untuk memeriksa objek kode nyata. Misalnya, program sederhana dapat dikompilasi menjadi objek kode dan dibongkar untuk mendapatkan opcodes yang dieksekusi oleh mesin virtual python. Ini ditunjukkan pada Listing 2.3.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-number">1</span>         &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">square</span>(<span class="hljs-params">x</span>):</span>
<span class="hljs-number">2</span>         ...     <span class="hljs-keyword">return</span> x*x
<span class="hljs-number">3</span>         ... 
<span class="hljs-number">4</span> 
<span class="hljs-number">5</span>         &gt;&gt;&gt; dis(square)
<span class="hljs-number">6</span>         <span class="hljs-number">2</span>           <span class="hljs-number">0</span> LOAD_FAST                <span class="hljs-number">0</span> (x)
<span class="hljs-number">7</span>                     <span class="hljs-number">2</span> LOAD_FAST                <span class="hljs-number">0</span> (x)
<span class="hljs-number">8</span>                     <span class="hljs-number">4</span> BINARY_MULTIPLY     
<span class="hljs-number">9</span>                     <span class="hljs-number">6</span> RETURN_VALUE        </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar Kode 2.3: Membongkar fungsi dengan Python File </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
header </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./Include/opcodes.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berisi daftar lengkap semua instruksi / opcode untuk mesin virtual Python. Opcode cukup sederhana. Ambil contoh kami di Listing 2.3, yang memiliki empat instruksi. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOAD_FAST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memuat nilai argumennya (dalam hal ini x) </font><b><font style="vertical-align: inherit;">ke</font></b><font style="vertical-align: inherit;"> tumpukan nilai. Mesin virtual python berbasis stack, sehingga nilai untuk operasi opcode "muncul" dari stack, dan hasil perhitungan didorong kembali ke stack untuk digunakan lebih lanjut oleh opcode lain. Kemudian </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BINARY_MULTIPLY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muncul dua item dari stack, melakukan multiplikasi biner dari kedua nilai, dan mendorong hasilnya kembali </font><b><font style="vertical-align: inherit;">ke</font></b><font style="vertical-align: inherit;"> stack. Instruksi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NILAI PENGEMBALIAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengambil nilai dari tumpukan, menetapkan nilai kembali untuk objek ke nilai ini, dan keluar dari loop juru bahasa. </font><font style="vertical-align: inherit;">Jika Anda melihat Listing 2.3, jelas bahwa ini adalah penyederhanaan yang cukup kuat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penjelasan saat ini dari loop juru tidak memperhitungkan sejumlah detail, yang akan dibahas dalam bab-bab berikutnya. </font><font style="vertical-align: inherit;">Misalnya, berikut adalah pertanyaan yang kami tidak terima jawabannya:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari mana nilai-nilai yang dimuat oleh pernyataan LOAD_FAST berasal?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari mana datangnya argumen, yang digunakan sebagai bagian dari instruksi?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menangani fungsi dan metode bersarang ditangani?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana loop interpreter menangani pengecualian?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menyelesaikan semua instruksi, fungsi Py_Main melanjutkan eksekusi, tetapi kali ini memulai proses pembersihan. </font><font style="vertical-align: inherit;">Jika </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_Initialize</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dipanggil untuk melakukan inisialisasi selama dimulainya penerjemah, maka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Py_FinalizeEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dipanggil untuk melakukan pembersihan. </font><font style="vertical-align: inherit;">Proses ini termasuk menunggu keluar dari utas, memanggil semua penangan keluar, serta membebaskan memori yang masih digunakan yang dialokasikan oleh juru bahasa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami melihat deskripsi "tingkat tinggi" dari proses yang terjadi di Python yang dapat dieksekusi ketika skrip dijalankan. </font><font style="vertical-align: inherit;">Seperti disebutkan sebelumnya, ada banyak pertanyaan yang masih harus dijawab. </font><font style="vertical-align: inherit;">Di masa depan, kami akan mempelajari studi juru bahasa dan mempertimbangkan secara rinci setiap tahap. </font><font style="vertical-align: inherit;">Dan kita akan mulai dengan menjelaskan proses kompilasi pada bab selanjutnya.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id501326/index.html">Bagaimana menjadi insinyur DevOps dalam enam bulan atau bahkan lebih cepat. Bagian 3. Versi</a></li>
<li><a href="../id501328/index.html">Memperkenalkan Visual Studio Codespaces: Cloud Development, Dimanapun Anda Berada</a></li>
<li><a href="../id501330/index.html">Layanan microser di C ++. Fiksi atau kenyataan?</a></li>
<li><a href="../id501332/index.html">Rapat itu mudah. Tiga tips latihan harian</a></li>
<li><a href="../id501336/index.html">FOSS News No. 15 - ulasan berita gratis dan sumber terbuka untuk 4-10 Mei 2020</a></li>
<li><a href="../id501340/index.html">Mengapa Flutter menang?</a></li>
<li><a href="../id501342/index.html">Sertifikasi Online Microsoft - Catatan Lapangan</a></li>
<li><a href="../id501344/index.html">Ventilasi pasokan dikombinasikan dengan AC saluran (bagian 1 - listrik)</a></li>
<li><a href="../id501346/index.html">Tinjauan umum tentang keyboard mekanis Vortex Core RGB</a></li>
<li><a href="../id501352/index.html">Kafka menyerang balik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>