<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ»â€ğŸ¨ ğŸ•“ ğŸ’‚ Ansibleå‰§æœ¬æ˜¯ä¸€ä¸ªä»£ç ï¼šæˆ‘ä»¬è¿›è¡Œæ£€æŸ¥ï¼Œæµ‹è¯•å’ŒæŒç»­é›†æˆã€‚ä¼Šå‡¡Â·æ³¢è¯ºé©¬åˆ—å¤«ï¼ˆIvan Ponomarevï¼‰ ğŸ¤¸ğŸ¾ â˜ğŸ¾ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘å»ºè®®æ‚¨ç†Ÿæ‚‰Ivan Ponomarevå¯¹æŠ¥å‘Šçš„è§£è¯»ï¼Œâ€œ Ansibleå‰§æœ¬æ˜¯ä¸€ç§ä»£ç ï¼šæˆ‘ä»¬è¿›è¡Œæ£€æŸ¥ï¼Œæµ‹è¯•å’ŒæŒç»­é›†æˆã€‚â€
 

ä»£ç é‡æ„å¯èƒ½å¾ˆæœ‰è¶£ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨çš„åŸºç¡€ç»“æ„ä»£ç ä¸­ã€‚æ­¤å¤–ï¼ŒAnsibleè§’è‰²å‡ºäºæŸç§åŸå› å¾€å¾€ä¼šè¿…é€Ÿå¢åŠ å¤æ‚æ€§ã€‚è¿™å¢åŠ äº†æ‚¨çš„ä»»åŠ¡çš„éš¾åº¦ã€‚ä¼Šä¸‡å°†å‘Šè¯‰æ‚¨å¦‚ä½•é€šè¿‡æµ‹è¯•å…‹æœAnsible...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ansibleå‰§æœ¬æ˜¯ä¸€ä¸ªä»£ç ï¼šæˆ‘ä»¬è¿›è¡Œæ£€æŸ¥ï¼Œæµ‹è¯•å’ŒæŒç»­é›†æˆã€‚ä¼Šå‡¡Â·æ³¢è¯ºé©¬åˆ—å¤«ï¼ˆIvan Ponomarevï¼‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488966/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å»ºè®®æ‚¨ç†Ÿæ‚‰Ivan Ponomarevå¯¹æŠ¥å‘Šçš„è§£è¯»ï¼Œâ€œ Ansibleå‰§æœ¬æ˜¯ä¸€ç§ä»£ç ï¼šæˆ‘ä»¬è¿›è¡Œæ£€æŸ¥ï¼Œæµ‹è¯•å’ŒæŒç»­é›†æˆã€‚â€</font></font></strong></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£ç é‡æ„å¯èƒ½å¾ˆæœ‰è¶£ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨çš„åŸºç¡€ç»“æ„ä»£ç ä¸­ã€‚æ­¤å¤–ï¼ŒAnsibleè§’è‰²å‡ºäºæŸç§åŸå› å¾€å¾€ä¼šè¿…é€Ÿå¢åŠ å¤æ‚æ€§ã€‚è¿™å¢åŠ äº†æ‚¨çš„ä»»åŠ¡çš„éš¾åº¦ã€‚ä¼Šä¸‡å°†å‘Šè¯‰æ‚¨å¦‚ä½•é€šè¿‡æµ‹è¯•å…‹æœAnsibleä»£ç çš„å¤æ‚æ€§ã€‚åœ¨Dockerå®¹å™¨ä¸­ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éšç€ä»£ç åº“çš„å¢é•¿ï¼ŒAnsibleä¼šé‡åˆ°ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼šç»´æŠ¤ä»£ç çš„å¤æ‚æ€§ï¼Œé”™è¯¯ä»¥åŠå¯¹æ›´æ”¹çš„ææƒ§ã€‚ç†Ÿæ‚‰çš„é—®é¢˜æœ‰ä¸€ä¸ªç†Ÿæ‚‰çš„è§£å†³æ–¹æ¡ˆï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’ŒCIã€‚åœ¨æŠ¥å‘Šä¸­ï¼ŒIvanå°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨å·¥å…·æ¥è§£å†³Ansibleä»£ç çš„â€œæ˜“ç¢æ€§â€é—®é¢˜ï¼Œæ‰§è¡Œé™æ€åˆ†æï¼Œæµ‹è¯•Ansibleè„šæœ¬ä»¥åŠé…ç½®CIç³»ç»Ÿä»¥åœ¨Ansible Galaxyä¸­å‘å¸ƒè§’è‰²ã€‚</font></font></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UkP0PGMbWxY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<p>  .      ,     .       ,    ,    - .</p><br>
<p><img src="https://habrastorage.org/webt/nf/ta/07/nfta07piewosflcsbxpy5kor--u.png"></p><br>
<p>   .     .     .     .   â€”   Â«Â»,  -     ,       .   ,      , â€”      DigitalOcean.      : Terraform + Ansible.      Terraform,    Ansible              . </p><br>
<p><img src="https://habrastorage.org/webt/s-/qw/d7/s-qwd7u14wwm_i79vtj3ifdr3uw.png"></p><br>
<p>    Ansible        ,         best practices.     - â€”  ,  ,  ,  ,    . .</p><br>
<p><img src="https://habrastorage.org/webt/eg/ar/gh/egarghk4xofk4ikuz5j1jeakse8.png"></p><br>
<p>       ,     .    best practices,    . ,        -,         -    . </p><br>
<p><img src="https://habrastorage.org/webt/nj/uh/ag/njuhagvg09hsrbwnqqk5jmgc23y.png"></p><br>
<p>      ,     . :</p><br>
<ol>
<li> .<br>
<ul>
<li>  ,    .</li>
<li> . :     ,     ?    ?</li>
</ul></li>
<li>   ,    ,     .</li>
<li>   .  playbook,   ,  . </li>
</ol><br>
<p><img src="https://habrastorage.org/webt/i-/pb/-i/i-pb-iobvlx80mqokwtgj6ytuu0.png"></p><br>
<p>     CI.  ?     ,   unit-tests ,   Java   Python.   configuration is code.   ?</p><br>
<p><img src="https://habrastorage.org/webt/bp/m5/hy/bpm5hydmqirbdjn2uvxrlhxmhmi.png"></p><br>
<p>     ,     ,    ,   ,      . </p><br>
<p>  â€”  well-formedness:      .        ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">YAMLLint</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Ansible-lint</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Syntax check</a>   playbook.      .</p><br>
<p><img src="https://habrastorage.org/webt/rg/cj/hp/rgcjhpmrkjjubwqyqv9xvoszxi0.png"></p><br>
<p> YAMLLint.</p><br>
<ul>
<li>  YAML. YAML   ,   .    ,     .</li>
<li>  .</li>
<li>   UNIX-style.</li>
<li>  ,      YAML,    ,       . </li>
</ul><br>
<p>    ,  Ansible,  ,      . ,      Windows,       Windows-style   ,   . YAMLLint  .</p><br>
<p><img src="https://habrastorage.org/webt/g-/av/n5/g-avn5ij32qy-p-ethg2ii0momw.png"></p><br>
<p>   YAMLLint.   :     ,  - ,        -. YAMLLint    YAML-   ,     Ansible playbooks  ,   -  ,     . </p><br>
<p><img src="https://habrastorage.org/webt/tt/0h/fy/tt0hfyelhpl2ce_yz-gv06d6zcs.png"></p><br>
<p>Ansible-lint â€”   ,     good practices.</p><br>
<p> :</p><br>
<ul>
<li>  command module,  â€” shell module?     . Ansible-lint  . </li>
<li>  command module,     ,      Ansible. Ansible-lint ,        Ansible. </li>
<li>  idempotence ()   command  shell.  idempotence  -   .  ,   Ansible,    best practices  .</li>
<li>,  ,     Python - ,    ,         . </li>
</ul><br>
<p><img src="https://habrastorage.org/webt/mg/fm/vz/mgfmvzpu54jsgq3yughva-ie4eg.png"></p><br>
<p>    .    Â«Â».     -  ,          .       ,      CI-.    .</p><br>
<p><img src="https://habrastorage.org/webt/u_/cv/xz/u_cvxz-8vy7zjmtahzf8garcof0.png"></p><br>
<p>    .</p><br>
<p><img src="https://habrastorage.org/webt/pi/uu/bd/piuubdpass_jwhus5pbwkwppqqc.png"></p><br>
<p>  â€”  Syntax check,    Ansible.   .   Â«Â»,    , â€”      CI,      .   Syntax check    Syntax check,      ,         .    -   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/e-/-r/8s/e--r8s3rjxdbcjdubnnrxdv3kak.png"></p><br>
<p>         CI-.    Jenkins,      .      pipeline.      ,    .     ,          Ansible-.</p><br>
<p><img src="https://habrastorage.org/webt/8u/xb/vu/8uxbvuxkjrr6dnkrddxsv4nqy7m.png"></p><br>
<p>,  ,    . -,  ,   .    ?</p><br>
<p><img src="https://habrastorage.org/webt/qw/rr/mg/qwrrmgn-vgntjqmu-xsm3fszvpq.png"></p><br>
<p>   . Jeff Geerling â€”  ,   Ansible-.    ,    Â«Ansible for DevOpsÂ».        ,   Travis  ,   . </p><br>
<p><img src="https://habrastorage.org/webt/my/md/z_/mymdz_tcpxpr0oqq2dju3q6x8-8.png"></p><br>
<p>            ,    docker-.              .</p><br>
<p><img src="https://habrastorage.org/webt/jv/f0/ag/jvf0agrgtaoon9n2frjkp79pdki.png"></p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Molecule</a>.  ,   -   .     .        Ansible-.</p><br>
<p><img src="https://habrastorage.org/webt/ko/-u/hl/ko-uhlyjoskb4ecbx1tnjhhyq24.png"></p><br>
<p>   OpenSource-,     .</p><br>
<p><img src="https://habrastorage.org/webt/ov/du/qs/ovduqsqkvbgjkinm_d_txkvfnju.png"></p><br>
<p>    Python environment.   ansible, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">molecule</a> ,      Docker, â€” docker-py.</p><br>
<p><img src="https://habrastorage.org/webt/wf/ed/6g/wfed6gpup-uhfxzypzjyljzrmje.png"></p><br>
<p>   ,       .   Ansible ,   . ,        .     instances (,  ),       . ,    . </p><br>
<p> ,      playbook. Playbook â€”  ,   ,    instances.</p><br>
<p>   .</p><br>
<p><img src="https://habrastorage.org/webt/sq/i9/3v/sqi93vsxqfvtrydvzim_add-j_i.png"></p><br>
<p>-, .         molecule,      .        ,   readme-,     ,    Ansible-.    Molecule        Default.  ,     Default    ,      .</p><br>
<p><img src="https://habrastorage.org/webt/gq/-a/at/gq-aat0xi_za7ivwowhvwyzrz-w.png"></p><br>
<p>    molecule    ,       .     Default-.    ,        .        ,   Molecule,    .      . </p><br>
<p><img src="https://habrastorage.org/webt/d_/lu/6s/d_lu6sbyrw1jzgmhmwmnyzhm0pu.png"></p><br>
<p>    ,     : <code>molecule test</code>. ,   Molecule   .  ,  .    . ,   .</p><br>
<p><img src="https://habrastorage.org/webt/72/8d/im/728dimppa5gdm8wduhgxkdf50kq.png"></p><br>
<p>    <code>--debug</code>,   ,     <code>docker-py</code>.      ,  <code>docker-py</code>   .  <code>--debug</code>  :     .</p><br>
<p><img src="https://habrastorage.org/webt/pn/yi/xm/pnyixm6epqfwgxsocthjpo7mueq.png"></p><br>
<p>    Test matrix.     ,   Molecule     .  ,     .       ,    syntax, converge, idempotence,      instances,     .</p><br>
<p><img src="https://habrastorage.org/webt/wb/3w/yn/wb3wynbjsnbxjez2gx175oteaam.png"></p><br>
<p> , , â€”    , , Molecule   ,   instances,     ?        â€” molecule.yml.      Platforms  instances,   .       ,      .  Ansible   converge       ,  Ansible   .</p><br>
<p>  docker,      image. ,   image .    ,     systemd.       - ,    systemd, ,  , docker    ,      .    ,      ,     systemd.</p><br>
<p><img src="https://habrastorage.org/webt/dq/s-/r4/dqs-r4l6l85jvy9lisxd2wfaj64.png"></p><br>
<p> docker     .</p><br>
<p>-,     instances  ,   ,   Ansible.</p><br>
<p>-,     .     .</p><br>
<p>  Vagrant,    .</p><br>
<p>    Molecule,     .  docker â€”    ,          .</p><br>
<p><img src="https://habrastorage.org/webt/zl/up/va/zlupvavg_cyxfje1hhkmayrzhle.png"></p><br>
<p>  :     ,    .       ,     .</p><br>
<p>    requirements.yml,     best practices Ansible.     :              .    ,   dependency,       . </p><br>
<p><img src="https://habrastorage.org/webt/wr/ka/hb/wrkahbv7gzh_0rsbqke7goeiyvq.png"></p><br>
<p>     ,       : YAMLLint, Ansible-lint, Syntax check.</p><br>
<p><img src="https://habrastorage.org/webt/yk/wi/q7/ykwiq7vk_vt8wdp52zrktdtk1og.png"></p><br>
<p> converge    instances   playbook.yml.     ,    .         ,  - .    converge    playbook.yml.       , -     ,     . </p><br>
<p><img src="https://habrastorage.org/webt/0b/gm/ad/0bgmadx7ytt05b623n_ol78joq0.png"></p><br>
<p> -   : converge    ,    ,  ,  , â€”      <code>destroy=never</code> (  Â«    instancesÂ»)     docker,     interactive-      ,          .</p><br>
<p><img src="https://habrastorage.org/webt/d4/lf/ok/d4lfokwbrnbw0din9z9zztsw-ou.png"></p><br>
<p>   converge. ,  ,     instances ,  . Molecule     . ,    diff  Ansible, Jeff Geerling  : ,       .   ,        ,      .     ,    .</p><br>
<p><img src="https://habrastorage.org/webt/9t/i7/dp/9ti7dpbx3vyhq0we3_zlw1qvp8i.png"></p><br>
<p>   <code>--diff</code>.   ,        ,  ,         ,   failed  idempotence.</p><br>
<p><img src="https://habrastorage.org/webt/6n/xb/zn/6nxbzn_vxumz-n2g6ovdgcff3lq.png"></p><br>
<p>     Molecule â€”   . ,  ,     .   ,     ,      . Molecule    . </p><br>
<p> :</p><br>
<ul>
<li>Testinfra (Python, default).</li>
<li>Serverspec (Ruby).</li>
<li>Goss (written in Go, tests in YAML).</li>
</ul><br>
<p>  ,        -  ,   Serverspec,         Molecule.</p><br>
<p>    ,   Testinfra,     Python,    Molecule  Ansible,     .</p><br>
<p><img src="https://habrastorage.org/webt/wf/do/98/wfdo98snolnlm4h1g1gxyhkojvg.png"></p><br>
<p>Testinfra     Molecule.      . </p><br>
<p><img src="https://habrastorage.org/webt/1o/eg/rs/1oegrsh2wq8ywmy6vvecgdjocx4.png"></p><br>
<p>, ,  ? ,    ,   -     ,    ?    shell,  -   ,     .</p><br>
<p>      .    ,   host,   host   Â«runÂ»     return code    stdout  stderr    . </p><br>
<p><img src="https://habrastorage.org/webt/zh/qs/u0/zhqsu0kpfsgqfbauu8hn7otzt5q.png"></p><br>
<p>  assert, , ,  rc=0.            -   ,     assert ,       :   ,     .</p><br>
<p><img src="https://habrastorage.org/webt/jv/p9/vw/jvp9vwpal0og_tc9bqcakc7af8u.png"></p><br>
<p>   molecule test,     â€”   Ansible-  instances.          instances,      <code>destroy=never</code>   <code>molecule verify</code>.             instances.</p><br>
<p><img src="https://habrastorage.org/webt/yc/ds/gl/ycdsglouflle8lxkplabyh7c3a0.png"></p><br>
<p>   ,    .   2000   JUnit,   Unit-,     : Â«keep the bar green to keep your code cleanÂ».      everything is code,         .</p><br>
<p><img src="https://habrastorage.org/webt/q_/fa/3v/q_fa3vjdcg7fcvxbpwfct_vafxw.png"></p><br>
<p>   ?    ,       .  curl â€”   - ,    curl.</p><br>
<p><img src="https://habrastorage.org/webt/dc/by/-g/dcby-g5pxpfyolbid1wbfezlhhs.png"></p><br>
<p>  Testinfra        . , . Host.process     ,    host.      - ,  - ,     ,    :        ,     root  ,      -  . </p><br>
<p><img src="https://habrastorage.org/webt/9p/vb/bt/9pvbbtal3_h6lhus3xpyjvr6o64.png"></p><br>
<p>   .       ,    .</p><br>
<p><img src="https://habrastorage.org/webt/ah/2f/nt/ah2fntrmiqiybu-8v864v7bmkqm.png"></p><br>
<p>       . ,      - ,       ,     - ,     . -,  exists   ,       ,    contains    ,     - ,   ,   OK. </p><br>
<p><img src="https://habrastorage.org/webt/0i/cd/2w/0icd2wxc0aypghabejearlmzxss.png"></p><br>
<p> -  TDD, ,     ,       Ansible,     Ansible.</p><br>
<p>  Ansible-    ,    Java   Python,        .</p><br>
<p>,  , -  â€”     Testinfra, â€”    Ansible   assert. ,   â€”      Ansible-. Jython â€”   Python  JVM. ,    jython version, ,    -  .</p><br>
<p><img src="https://habrastorage.org/webt/9g/ml/uq/9gmluqfpql9ot8rmqmjavikpkzw.png"></p><br>
<p> . ,   ,    Molecule,   Molecule ,     . ?     Ansible-lint.       Ansible-lint  ,   Molecule       .</p><br>
<p>       assert   Ansible.</p><br>
<p><img src="https://habrastorage.org/webt/cw/2_/oy/cw2_oy1vknpgl_x11srbuegvihy.png"></p><br>
<p>     ,      . ,    ,           , ,         ,    ,    .</p><br>
<p>        .    -  production -   ,      ,       Ansible playbooks     . </p><br>
<p><img src="https://habrastorage.org/webt/kn/de/yd/kndeydeuaimjnu2bmgs2ekqadh4.png"></p><br>
<p>        ,      -.    ,      , ,  Testinfra,   .   ,     Ansible-  . </p><br>
<p><img src="https://habrastorage.org/webt/ng/yr/tr/ngyrtrhqjvhroywdhjzgj2ielwg.png"></p><br>
<p>      .  .    â€”  Galaxy.      GitHub,        OpenSource,     GitHub , , GitHub-    CI    .  ,    Master,    .      - ,     -   Master,        .</p><br>
<p><img src="https://habrastorage.org/webt/nn/5j/re/nn5jrelzhhbbnd6xlwpgkgrhe7o.png"></p><br>
<p>   ?  Molecule     CI-.   Jenkins,     Â«Â».    Jenkins Multibranch,    checkout             MyRole,          ,     Ansible  ,      :      MyRole,    .      :    symlink   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/hl/uj/ao/hlujaokyhvxxozxviyxxvs25gnm.png"></p><br>
<p>      Molecule  .</p><br>
<p><img src="https://habrastorage.org/webt/fj/e2/bx/fje2bx3wnisexoe7oos43rn5peu.png"></p><br>
<p>   ,        Jenkins.     -   - ,    ,     .   ,     .   ,   ,     ,     molecule test.</p><br>
<p><img src="https://habrastorage.org/webt/__/fw/0q/__fw0qet_ehwql4ousfupgkc3xc.png"></p><br>
<p> ,      ,      OpenSource,  , â€”  Travis.     .    services docker,    ,     Ansible Molecule docker-py. ,    â€”    ,    ,       ,   .</p><br>
<p>    â€” molecule test,    ,   ,   GitHub-.</p><br>
<p><img src="https://habrastorage.org/webt/ec/of/xj/ecofxj1thtspbigbxnxydwf8eri.png"></p><br>
<p>,    webhook,   Ansible Galaxy ,    : build passing  build failing.</p><br>
<p>          Galaxy   .    ,   GitHub,     Ansible Galaxy.   ,   Travis   webhook.   CI ,  ,   ,      â€” .     Travis.</p><br>
<p><img src="https://habrastorage.org/webt/dl/hv/ar/dlhvarqg_cksv7oepmhakepmt_i.png"></p><br>
<p>    ,  ?      â€”   - , - ,   copy-paste-modify   .</p><br>
<p><img src="https://habrastorage.org/webt/mp/0v/zi/mp0vzik3lii8bjig_0mfxolcoqq.png"></p><br>
<p> .  ,     ,    Galaxy,  . ,     Molecule,       ,     .</p><br>
<p>  ,     ,  linting.     â€” YAMLLint, Ansible-lint  Syntax Check.     ,  .</p><br>
<p><img src="https://habrastorage.org/webt/v1/qu/ss/v1qussep3_c0mdbhxdnm66eoiua.png"></p><br>
<p>  :        - ?    ,   Ansible Galaxy    Molecule,    ,    Molecule      .      ,   ,   ,      ,    . ,  ,  YAML  well format,       . </p><br>
<p><img src="https://habrastorage.org/webt/bg/p3/t_/bgp3t_on2vb9p2k0poevu5txkxk.png"></p><br>
<p>    - ?    ?    ,  Molecule â€”   .   , ,   Molecule  .</p><br>
<p>         ,      ,     ,     ,         .</p><br>
<p><img src="https://habrastorage.org/webt/yd/4p/v_/yd4pv_xcw3a7po3qyhzpyk-x1bw.png"></p><br>
<p>    ,     ,   .</p><br>
<p>       â€” Heisenbug.     ,   . </p><br>
<p><img src="https://habrastorage.org/webt/a1/rx/g6/a1rxg6i44u5ybwotvbhuo7xhtxg.png"></p><br>
<p>    - .       ,     ? </p><br>
<ul>
<li>     .      ,    ,   - ,  ,   ,  URL,  URL. </li>
<li>  ,         . </li>
<li>    .         , ,  ,  ,  Ansible . </li>
<li>    . ,        ,     ,   instances -    ,    ,       failsafe.            ,    ,      instances?</li>
</ul><br>
<p>     :      ,   framework,  pytest.   ,      ,  .   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/f7/wf/ir/f7wfirmtx2m0avb6pbkyhhhmfzy.png"></p><br>
<p>,      ?        ,   pytest,       ,   â€”  ,   ,   â€”    .    asserts :    ,       .     .    :      Python,      values-  ,    .</p><br>
<p><img src="https://habrastorage.org/webt/av/e8/ic/ave8icjotwx98amrm-hemktlj3m.png"></p><br>
<p>    ,   ,   ?        .   ,   ,    ,   â€˜port$â€™.        Â«var_valuesÂ»,     ,   -,     Ansible playbooks,            var_values  ,    Â«portÂ», ,     ,   ,        ,   .</p><br>
<p>   var_values?   Python  .     YAML-.   ,   YAML  Ansible,       ,   .</p><br>
<p><img src="https://habrastorage.org/webt/0c/ge/8g/0cge8g9b5rcd3y7zjtcurvhkek4.png"></p><br>
<p>   , ,        ,     ,       ,     .</p><br>
<p>    ?  .      port_var_values,       ,              ,     . </p><br>
<p><img src="https://habrastorage.org/webt/nd/k_/53/ndk_53txd6_wytpacr-8bfacv80.png"></p><br>
<p>       ,     : Â«keep the bar green to keep the configuration cleanÂ».    ,   .</p><br>
<p> :   ,       .   ,      .  ,              .   , .       ,        .        ,  ,     .</p><br>
<p><img src="https://habrastorage.org/webt/hk/ch/uh/hkchuh90w1l651tffrcu2e2hc68.png"></p><br>
<p>  â€” ,    Â«Â»    . -,     -   ,     .</p><br>
<p>   :      Â«passwordÂ»,    Â«passÂ»,   Â«pwdÂ». -,   ,     placeholder,    -,   - ,    Vault.  ,  .</p><br>
<p><img src="https://habrastorage.org/webt/r_/ko/vx/r_kovxpxhggjar5zgdfkns8jp0s.png"></p><br>
<p>   .   pull request.  .     : k=â€™myskq_root_passwordâ€™, v=â€™12345â€™.     ,  password Â«12345Â»,  ,    GitHub .  ,   pull request  .</p><br>
<p>   .</p><br>
<p><img src="https://habrastorage.org/webt/6f/vo/gm/6fvogmb9p-lj1lzce90bisk3mrs.png"></p><br>
<p>  â€”   Ansible.</p><br>
<ul>
<li>-,  : YAMLLint + Ansible-lint + Syntax check â€”     .     -   Ansible-,  - ,    ,    , ,    .      ,  . Ansible-lint    ,   ,    best practices   . </li>
<li>   Molecule.</li>
<li>   .   playbook failed fast. , ,  -   ,        .</li>
<li>  .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/ns/lr/9r/nslr9ruw6lznmu6apuua3dti97w.png"></p><br>
<ul>
<li>   -   â€”  Molecule.  : <code>pip install molecule</code>, <code>molecule init</code>, <code>molecule test</code>. </li>
<li>   ?  converge  idempotence. </li>
<li>   converge  idempotence?      .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/tj/wn/8k/tjwn8klvrwdzl9r8fddpwnwagre.png"></p><br>
<p> ,      :   ,    ,   .    â€”   ?      ,     Git,  ,    pipeline,   quality gates,      .</p><br>
<p><img src="https://habrastorage.org/webt/ib/bi/bz/ibbibzu1dccagtq8w_fslbqpo14.png"></p><br>
<p>  ,    , â€”  GitHub + Travis + Galaxy.       OpenSource. ,         OpenSource. Jenkins Multibranch     .</p><br>
<p><img src="https://habrastorage.org/webt/kl/ay/5n/klay5nrakvoxev7akq9cefxbdzu.png"></p><br>
<p>,    ,   ,   .</p><br>
<ul>
<li><strong> </strong>.      Ansible-   Molecule  Jenkins <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://habr.com/post/351974/</a></li>
<li><strong>Jeff Geerling</strong>. Testing Ansible Roles with Travis CI on GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://www.jeffgeerling.com/blog/testing-ansible-roles-travis-cigithub</a></li>
<li><strong>Werner Dijkerman</strong>. Continuous deployment of Ansible Roles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://werner-dijkerman.nl/2017/09/17/continuous-deployment-ofansible-roles/</a></li>
</ul><br>
<p><strong></strong></p><br>
<p>: <em>  !   .    :      , , ,     ?   ,        Ansible?   Ansible       ,       Python, Testinfra,   Molecule.    ,         Python,     ,     .</em></p><br>
<p>:    ?     ,     Java.  pull request â€”  :     .   ,  â€”  -  ,      .  ,    -  ,     ,   ,      .     .   playbooks  .    ,     .     - ,     ?        .    ,  - ,   .   -  shell,   shell  - .        ,    . </p><br>
<p>: <em>  Ansible  Windows?   Ansible playbook  Windows.    ?  ,      ?</em></p><br>
<p>:  ,      Ansible -  Windows     Testinfra.    Windows,   Ansible  cygwin   .       Linux-   ,    .  , .       .</p><br>
<p>: <em>  ,    .     â€”   .    ,      ?       .      changed_when, ?</em></p><br>
<p>:    ,     -,  -   ,              ,  ?</p><br>
<p>: <em>, ,          ,    .    ,   .</em></p><br>
<p>:    ,    asserts,    .     .   .    command  shell,       ,      .        ,       ,        .    â€”  ,      â€”  ,   .       ,   .     Ansible   .  ,  ,     ,   .  . </p><br>
<p>: <em>        .   ,  Ansible     gathering facts study,      ,  â€¦</em></p><br>
<p>:  .</p><br>
<p>: <em>, ,  JUnit   , â€” ,      ,   gathering tasks,   ,    ,    ?</em></p><br>
<p>:  .   ,        .  -,   -. -,     ? ,   -.  ,    ,     ,   ,   ,    -  . -     .   ,  : ,    ,      ?   .</p><br>
<p>: <em>,    ,   GitHub  ,  .         ,       version.      ,      .</em></p><br>
<p>: .    .      Molecule ,      .</p><br>
<p>: <em>  .         ,    ? ,  - ,   - ,  ,     ,    .</em> </p><br>
<p>:   .    ,  service is running.    ,      Â«Â»?</p><br>
<p>: <em>  ,   â€”   ,     .  ,      ,    â€¦</em></p><br>
<p>:     ,  ,       ,      -,   - .  ,      Â«200Â» ,   - .         .   selenium-   .       ,    Ansible : Â«  Â».    ,   ,    Â«200Â» ,     ,      ,           pipeline.</p><br>
<p>: <em>    production   Ansible Galaxy     ?    .</em></p><br>
<p>:  , . , nginx, PostgreSQL.    .   Oracle Java      Ansible Galaxy.    .       . ,  ,  .  ,   Ansible  build pipeline.     Molecule,     Travis  .   ,  ,    Jeff Geerling.</p><br>
<p>: <em>   playbook  Ansible Galaxy?</em></p><br>
<p>:   ,    ,    .   . ,   ,      ,    .  ,   150000 ,   ,   150 .   150000   , ,  , -     production.</p><br>
<p>: <em>         Jinja. , Jinja    ,       hosts.    ?</em></p><br>
<p>:    ,     Molecule ,   Molecule  ,     .       inventory. Molecule  ,      ,     .  -  â€¦   Molecule? Molecule    -   ,   playbook.yml.      playbook.yml,   , ,     playbook.   -  Jinja,  â€” .    ,  .     Molecule   .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN488956/index.html">æ–‡ä»¶å’Œç¿»è¯‘çš„ç»„ç»‡ï¼Œä¾‹å¦‚iondvã€‚æ„æ¶</a></li>
<li><a href="../zh-CN488958/index.html">æˆ‘å¯¹Rubyä½œè€…çš„é‡‡è®¿è®°å½•</a></li>
<li><a href="../zh-CN488960/index.html">ç¨‹åºè®¾è®¡ï¼Œå…ç–«å’Œå†›é˜Ÿ</a></li>
<li><a href="../zh-CN488962/index.html">æˆ‘å¯ä»¥ç”¨C ++ç¼–å†™è„šæœ¬å—ï¼Ÿ</a></li>
<li><a href="../zh-CN488964/index.html">ç´§æ€¥ä»»åŠ¡ã€‚æ„¿æ•‘ä¸»æ¥</a></li>
<li><a href="../zh-CN488982/index.html">S905Xå¤„ç†å™¨ï¼ˆå®‰å…¨å¯åŠ¨ï¼‰è½¯ä»¶å®‰å…¨æ¦‚è¿°</a></li>
<li><a href="../zh-CN488986/index.html">è°æ˜¯å¯¼å¸ˆï¼Œåº”è¯¥å…·å¤‡ä»€ä¹ˆæ ·çš„çµæ´»æŠ€èƒ½</a></li>
<li><a href="../zh-CN488990/index.html">UNIX 5100å…¨é¢ç½©çš„æ¦‚è¿°ï¼Œå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œä¸UNIX 5000ã€6100å‹å·å’ŒPPM-88æ©æ¨¡çš„æ¯”è¾ƒ</a></li>
<li><a href="../zh-CN488994/index.html">DDR5ï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä»¬å‡ ä¹æ²¡æœ‰é‡åˆ°DDR4</a></li>
<li><a href="../zh-CN488998/index.html">ä¸ºä»€ä¹ˆAIè¦æ±‚åªä¼šä½¿æƒ…å†µæ›´ç³Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>