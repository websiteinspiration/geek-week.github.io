<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüî¨ üëó üëµüèø Snort o Suricata. Parte 2: instalaci√≥n y configuraci√≥n inicial de Suricata üà∏ üö¥ üßì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seg√∫n las estad√≠sticas, el volumen del tr√°fico de red aumenta en aproximadamente un 50% cada a√±o. Esto conduce a un aumento de la carga en el equipo y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Snort o Suricata. Parte 2: instalaci√≥n y configuraci√≥n inicial de Suricata</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/507234/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seg√∫n las estad√≠sticas, el volumen del tr√°fico de red aumenta en aproximadamente un 50% cada a√±o. </font><font style="vertical-align: inherit;">Esto conduce a un aumento de la carga en el equipo y, en particular, aumenta los requisitos de rendimiento de IDS / IPS. </font><font style="vertical-align: inherit;">Puede comprar hardware especializado costoso, pero hay una opci√≥n m√°s barata: la introducci√≥n de uno de los sistemas de c√≥digo abierto. </font><font style="vertical-align: inherit;">Muchos administradores novatos tienen dificultades para instalar y configurar IPS gratis. </font><font style="vertical-align: inherit;">En el caso de Suricata, esto no es del todo cierto: puede instalarlo y comenzar a repeler ataques t√≠picos con un conjunto de reglas gratuitas en pocos minutos.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/5i/pc/nn5ipc7z3qk2abxsmfthdja8vww.jpeg"></div></a><a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snort o Suricata. </font><font style="vertical-align: inherit;">Parte 1: elija un IDS / IPS gratuito para proteger la red corporativa</font></font></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© necesito otro IPS abierto?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante mucho tiempo, el sistema Snort, considerado est√°ndar, se ha desarrollado desde finales de los noventa, por lo que originalmente era de un solo subproceso. Con los a√±os, todos los chips modernos han aparecido en √©l, como el soporte IPv6, la posibilidad de analizar protocolos de nivel de aplicaci√≥n o un m√≥dulo de acceso universal a datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El motor b√°sico Snort 2.X ha aprendido a trabajar con m√∫ltiples n√∫cleos, pero se ha mantenido con un solo subproceso y, por lo tanto, no puede utilizar de manera √≥ptima las ventajas de las plataformas de hardware modernas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema se resolvi√≥ en la tercera versi√≥n del sistema, pero se prepar√≥ durante tanto tiempo que Suricata, escrita desde cero, logr√≥ aparecer en el mercado. </font><font style="vertical-align: inherit;">En 2009, comenzaron a desarrollarlo precisamente como una alternativa multiproceso a Snort, que tiene funciones IPS listas para usar. </font><font style="vertical-align: inherit;">El c√≥digo se distribuye bajo la licencia GPLv2, pero los socios financieros del proyecto tienen acceso a una versi√≥n cerrada del motor. </font><font style="vertical-align: inherit;">Algunos problemas con la escalabilidad aparecieron en las primeras versiones del sistema, pero se resolvieron r√°pidamente.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√© suricata?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suricata tiene varios m√≥dulos (como Snort): captura, captura, decodificaci√≥n, detecci√≥n y salida. Por defecto, el tr√°fico capturado va antes de la decodificaci√≥n por una secuencia, aunque esto carga m√°s el sistema. Si es necesario, los subprocesos se pueden dividir en la configuraci√≥n y distribuir entre los procesadores: Suricata est√° muy bien optimizado para un hardware espec√≠fico, aunque este ya no es el nivel de COMO para principiantes. Tambi√©n vale la pena se√±alar que Suricata tiene una herramienta de inspecci√≥n HTTP avanzada basada en la biblioteca HTP. Tambi√©n se pueden usar para registrar el tr√°fico sin detecci√≥n. El sistema tambi√©n admite la decodificaci√≥n IPv6, incluidos los t√∫neles IPv4-in-IPv6, IPv6-in-IPv6 y otros.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pueden utilizar diferentes interfaces para interceptar el tr√°fico (NFQueue, IPFRing, LibPcap, IPFW, AF_PACKET, PF_RING), y en el modo Unix Socket, los archivos PCAP capturados por otro sniffer se pueden analizar autom√°ticamente. Adem√°s, la arquitectura modular de Suricata facilita la conexi√≥n de nuevos elementos para capturar, decodificar, analizar y procesar paquetes de red. Tambi√©n es importante tener en cuenta que en Suricata, el tr√°fico se bloquea mediante un filtro est√°ndar del sistema operativo. Hay dos opciones de IPS disponibles en GNU / Linux: a trav√©s de la cola NFQUEUE (modo NFQ) y a trav√©s de copia cero (modo AF_PACKET). En el primer caso, el paquete que ingresa a iptables se env√≠a a la cola NFQUEUE, donde puede procesarse a nivel de usuario. Suricata lo ejecuta seg√∫n sus propias reglas y hace uno de los tres veredictos: NF_ACCEPT, NF_DROP y NF_REPEAT.Las dos primeras explicaciones no son obligatorias, y la √∫ltima le permite marcar paquetes y enviarlos al comienzo de la tabla actual de iptables. El modo AF_PACKET se caracteriza por una mayor velocidad, pero impone una serie de limitaciones en el sistema: debe tener dos interfaces de red y funcionar como una puerta de enlace. Un paquete bloqueado simplemente no se reenv√≠a a la segunda interfaz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una caracter√≠stica importante de Suricata es la capacidad de usar desarrollos para Snort. El administrador puede acceder, en particular, a los conjuntos de reglas Sourcefire VRT y OpenSource Emerging Threats, as√≠ como a los comerciales Emerging Threats Pro. La salida unificada se puede analizar utilizando backends populares, y tambi√©n se admite la salida a PCAP y Syslog. La configuraci√≥n y las reglas del sistema se almacenan en archivos YAML, que son f√°ciles de leer y se pueden procesar autom√°ticamente. El motor Suricata reconoce muchos protocolos, por lo que no es necesario vincular el n√∫mero de puerto en las reglas. Adem√°s, el concepto de bits de flujo se practica activamente en las reglas de Suricata. Para rastrear la respuesta, las variables de sesi√≥n se utilizan para crear y aplicar varios contadores y banderas.Muchos IDS consideran diferentes conexiones TCP como entidades separadas y pueden no ver la conexi√≥n entre ellas, lo que indica el comienzo de un ataque. Suricata intenta ver la imagen completa y, en muchos casos, reconoce el tr√°fico malicioso distribuido a trav√©s de diferentes conexiones. Puede hablar sobre sus ventajas durante mucho tiempo, es mejor que pasemos a la instalaci√≥n y configuraci√≥n.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo instalar?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalaremos Suricata en un servidor virtual con Ubuntu 18.04 LTS. </font><font style="vertical-align: inherit;">Todos los comandos deben ejecutarse como root (root). </font><font style="vertical-align: inherit;">La opci√≥n m√°s segura es conectarse al servidor a trav√©s de SSH con los derechos de un usuario normal y luego usar la utilidad sudo para aumentar los privilegios. </font><font style="vertical-align: inherit;">Primero necesita instalar los paquetes que necesitamos:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt -y install libpcre3 libpcre3-dev build-essential autoconf automake libtool libpcap-dev libnet1-dev libyaml-0-2 libyaml-dev zlib1g zlib1g-dev libmagic-dev libcap-ng-dev libjansson-dev pkg-config libnetfilter-queue-dev geoip-bin geoip-database geoipupdate apt-transport-https</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conectamos un repositorio externo:</font></font><br>
<br>
<pre><code class="bash hljs">sudo add-apt-repository ppa:oisf/suricata-stable<font></font>
sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale la √∫ltima versi√≥n estable de Suricata:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install suricata</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si es necesario, edite el nombre de los archivos de configuraci√≥n, reemplazando el eth0 predeterminado con el nombre real de la interfaz del servidor externo. </font><font style="vertical-align: inherit;">La configuraci√≥n predeterminada se almacena en el archivo / etc / default / suricata, y la configuraci√≥n del usuario se almacena en /etc/suricata/suricata.yaml. </font><font style="vertical-align: inherit;">La configuraci√≥n de IDS se limita en su mayor parte a la edici√≥n de este archivo de configuraci√≥n. </font><font style="vertical-align: inherit;">Tiene muchos par√°metros, que en nombre y prop√≥sito coinciden con sus contrapartes de Snort. </font><font style="vertical-align: inherit;">Sin embargo, la sintaxis es completamente diferente, pero el archivo es mucho m√°s f√°cil de leer que las configuraciones de Snort, y est√° bien comentado.</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /etc/default/suricata</code></pre><br>
<img src="https://habrastorage.org/webt/d3/oc/qt/d3ocqteatkouq5i01wub0k9dmyo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /etc/suricata/suricata.yaml</code></pre><br>
<img src="https://habrastorage.org/webt/nh/v8/it/nhv8itz1ajztjvvvkpmfxxxw8cc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Atenci√≥n! </font><font style="vertical-align: inherit;">Antes de comenzar, vale la pena verificar los valores de las variables de la secci√≥n vars. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para completar la configuraci√≥n, deber√° instalar suricata-update para actualizar y descargar las reglas. </font><font style="vertical-align: inherit;">Hacer esto es bastante simple:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install python-pip<font></font>
sudo pip install pyyaml<font></font>
sudo pip install &lt;a href=<span class="hljs-string">"https://github.com/OISF/suricata-update/archive/master.zip"</span>&gt;https://github.com/OISF/suricata-update/archive/master.zip&lt;/a&gt;<font></font>
sudo pip install --pre --upgrade suricata-update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debemos ejecutar el comando suricata-update para establecer el conjunto de reglas Abrir amenazas emergentes:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update</code></pre><br>
<img src="https://habrastorage.org/webt/tg/nz/yd/tgnzydwuy7jqdeq7swl0sf1xwmc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver la lista de or√≠genes de reglas, ejecute el siguiente comando:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update list-sources</code></pre><br>
<img src="https://habrastorage.org/webt/8o/tf/od/8otfodsrz6j0r0lxgnyjuirwyso.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualizaci√≥n de las fuentes de las reglas:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update update-sources</code></pre><br>
<img src="https://habrastorage.org/webt/yc/gf/jd/ycgfjdt8bfuxkd5ncvt03uhxtgc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revisamos las fuentes actualizadas:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update list-sources</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si es necesario, puede habilitar las fuentes gratuitas disponibles:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update <span class="hljs-built_in">enable</span>-source ptresearch/attackdetection<font></font>
sudo suricata-update <span class="hljs-built_in">enable</span>-source oisf/trafficid<font></font>
sudo suricata-update <span class="hljs-built_in">enable</span>-source sslbl/ssl-fp-blacklist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, debe actualizar las reglas nuevamente:</font></font><br>
<br>
<pre><code class="bash hljs">sudo suricata-update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esto, la instalaci√≥n y configuraci√≥n inicial de Suricata en Ubuntu 18.04 LTS puede considerarse completa. </font><font style="vertical-align: inherit;">La parte m√°s interesante comienza: en el pr√≥ximo art√≠culo conectaremos un servidor virtual a la red de la oficina a trav√©s de VPN y comenzaremos a analizar todo el tr√°fico entrante y saliente. </font><font style="vertical-align: inherit;">Prestaremos especial atenci√≥n al bloqueo de ataques DDoS, actividad de malware e intentos de explotar vulnerabilidades en servicios accesibles desde redes p√∫blicas. </font><font style="vertical-align: inherit;">Para mayor claridad, se modelar√°n los ataques de los tipos m√°s comunes.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/gu/ab/cg/guabcgmwuqoopx1ar80sjpz6keq.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/de/0y/l-/de0yl-6ppopvisr_a80b4yuhjj8.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es507214/index.html">C√≥mo crear y modificar formularios PDF interactivos, o la nueva habilidad ABBYY FineReader PDF</a></li>
<li><a href="../es507218/index.html">L√©ame o por qu√© el texto no se lee hasta el final</a></li>
<li><a href="../es507222/index.html">¬øPor qu√© todos deber√≠an usar m√°scaras?</a></li>
<li><a href="../es507224/index.html">C√≥mo eliminar los puntos ciegos con pruebas visuales</a></li>
<li><a href="../es507226/index.html">OCR para PDF en .NET: c√≥mo extraer texto de documentos PDF inaccesibles</a></li>
<li><a href="../es507236/index.html">Aumentamos la efectividad de la interacci√≥n entre dise√±adores y desarrolladores frontend</a></li>
<li><a href="../es507238/index.html">Utilizamos DS para procesar comentarios de clientes de sitios grandes</a></li>
<li><a href="../es507242/index.html">Lo que es interesante Wi-Fi 6 en el rendimiento de Huawei</a></li>
<li><a href="../es507250/index.html">Definir una mano de p√≥quer ganadora usando map / reduce en JavaScript</a></li>
<li><a href="../es507254/index.html">Zabbix - expandiendo las fronteras macro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>