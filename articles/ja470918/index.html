<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☦️ 👂🏿 🎦 F＃9：タイプオプション 💚 ✍️ ⌨️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C＃に、参照型にはnull、構造体にはnullの概念がある場合。これは、次の2つの形式のいずれかになります（デモンストレーションでは、ここではint型を使用していますが、型は任意の構造にすることができます）。
 
 

- ヌル可能
- int？
 免責事項

 Nullabe Nullable<T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>F＃9：タイプオプション</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470918/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃に、参照型にはnull、構造体にはnullの概念がある場合。</font><font style="vertical-align: inherit;">これは、次の2つの形式のいずれかになります（デモンストレーションでは、ここではint型を使用していますが、型は任意の構造にすることができます）。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌル可能</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int？</font></font></li>
</ul><a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項</font></font></b><div class="spoiler_text"><pre><code class="css hljs">   <span class="hljs-selector-tag">Nullabe</span>  <span class="hljs-selector-tag">Nullable</span>&lt;<span class="hljs-selector-tag">T</span>&gt; ,    <span class="hljs-selector-tag">-</span> ,   
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらも同等です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nullableクラスは、nullの型と構造を簡単に操作できるようにするいくつかのヘルパープロパティとメソッドを提供します。</font><font style="vertical-align: inherit;">これらは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasvalue </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetValueOrDefault（） </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetValueOrDefault（T） </font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
typeの形でF＃とは少し異なるものがあります</font><font style="vertical-align: inherit;">。これは、nullを処理しないことを好むが、「型の値を含む場合がある」または「持たない場合がある値"。それはNullableのように聞こえますが、最終的にはタイプF＃であるため、F＃で通常使用されることが期待できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Option F＃タイプで注目すべきもう1つの点は、構造体だけでなく、あらゆるタイプに使用できることです。これは、構造体でのみ使用できる.NET Nullableとは異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
値</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noneは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、値がない場合に使用されます。そうでない表現</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のいくつか</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（...）値を割り当てます。パターンと照合する場合、SomeとNoneの値を使用できます。この例は、この投稿で確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nullableと同様に、F＃Optionタイプにはいくつかのヘルパープロパティ/メソッドがあり、以下の表に示されています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なし</font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Tオプション</font></font></i><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">None </font></b><i><font style="vertical-align: inherit;">の</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
値を持つパラメーター値を作成できる静的プロパティ。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsNone </font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パラメータがNoneの場合、trueを返します。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsSome </font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パラメータの値がNone以外の場合はtrueを返します。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部の</font></font><br>
</b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Tオプション</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
値がNoneではないパラメーターを作成する静的メンバー。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'T</font></font><br>
</i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本値を返すか、値がNoneの場合はNullReferenceExceptionをスローします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションを作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、オプションのタイプが何であるかがわかったので、それらをどのように作成しますか。</font><font style="vertical-align: inherit;">いくつかの例を見てみましょう。</font><font style="vertical-align: inherit;">この例では、ヘルパーメソッドIsSome / IsNoneを使用したことに注意してください。</font><font style="vertical-align: inherit;">個人的には、パターンとの照合が最良の方法だと思います。これは、[いいえ]オプションを含むすべてのケースを比較するのに役立つためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、ヘルパーメソッドを使用することにした場合、Option型を操作するときに問題が発生しやすいことを説明しますが、最初に正しいケースの例を見てみましょう。</font></font><br>
<br>
<pre><code class="erlang hljs"><span class="hljs-keyword">let</span> someInt = Some(<span class="hljs-number">43</span>)
<span class="hljs-keyword">let</span> someString = Some(<span class="hljs-string">"cat"</span>)<font></font>
 <font></font>
<span class="hljs-keyword">let</span> printTheOption (opt :Option&lt;'a&gt;) =<font></font>
    printfn <span class="hljs-string">"Actual Option=%A"</span> opt<font></font>
    printfn <span class="hljs-string">"IsNone=%b, IsSome=%b Value=%A\r\n\r\n"</span> opt.IsNone opt.IsSome opt.Value<font></font>
 <font></font>
printfn <span class="hljs-string">"let someInt = Some(43)"</span>
printfn <span class="hljs-string">"let someString = Some(\"cat\")"</span>
printfn <span class="hljs-string">"printTheOption (someInt)"</span><font></font>
printTheOption someInt<font></font>
printfn <span class="hljs-string">"printTheOption (someString)"</span>
printTheOption someString</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/ae4/af3/8ca/ae4af38ca8dd1f725292179fc98697da.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、次のコードを使用してもう一度試すと、オプション値にNoneがあり、それをprintTheOption関数に渡します。</font></font><br>
<br>
<pre><code class="erlang hljs"><span class="hljs-keyword">let</span> demoNone = None<font></font>
 <font></font>
<span class="hljs-keyword">let</span> printTheOption (opt :Option&lt;'a&gt;) =<font></font>
    printfn <span class="hljs-string">"Actual Option=%A"</span> opt<font></font>
    printfn <span class="hljs-string">"IsNone=%b, IsSome=%b Value=%A\r\n\r\n"</span> opt.IsNone opt.IsSome opt.Value<font></font>
 <font></font>
printfn <span class="hljs-string">"let demoNone = None"</span>
printfn <span class="hljs-string">"printTheOption demoNone"</span>
printTheOption demoNone</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/802/4eb/a28/8024eba2857b3bac536be8365ad69770.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、ここに問題があります。問題は、ヘルパープロパティOption.Valueを使用してOption値を取得しようとしたことです。この場合は、Noneなので、NullReferenceExceptionが発生しました。上の表に示されているように、補助プロパティとメソッドを使用すると、例外が発生する可能性があります。まあ、IsNoneメソッドを使用できます。きれいなパターンマッチを使用できる場合は、常にこれを使用して値を確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを受け入れることができない場合は、C＃を使用するときにnull値を確認する必要があった回数を自問してください。これにより、通常の.NETコードにMaybe Null Monadなどの関数構造を含めるようになりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘルパーメソッド/プロパティを使用することの危険性を見てきましたので、これらの例外を回避する方法に注意を向けましょう。</font></font><br>
<br>
<pre><code class="erlang hljs"><font></font>
et printTheOption (opt :Option&lt;'a&gt;) =<font></font>
    match opt with<font></font>
    | Some a -&gt; printfn <span class="hljs-string">"opt is Some, and has value %A"</span> a<font></font>
    | None -&gt; printfn <span class="hljs-string">"opt is None"</span><font></font>
 <font></font>
<span class="hljs-keyword">let</span> demoNone = None
<span class="hljs-keyword">let</span> someInt = Some <span class="hljs-number">1</span>
<span class="hljs-keyword">let</span> someString = Some <span class="hljs-string">"crazy dude in the monkey house"</span><font></font>
 <font></font>
printTheOption demoNone<font></font>
printTheOption someInt<font></font>
printTheOption someString</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の個人的な意見では、どこにでもIsSome / IsNoneが点在するコードよりも読みやすいです。</font><font style="vertical-align: inherit;">これはもちろんすべての人のビジネスですが、この単純な関数でここですべての基本をカバーしたという事実は無視できません。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1f5/4e0/a2a/1f54e0a2a31a62cb9a7e0293298f2cbe.png" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションとヌル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、F＃のオプションについてはNullabeと比較して説明しました。Optionタイプはどのタイプでも使用できますが、Nullableは構造体でのみ使用できます。しかし、.NETの通常の参照型と比較したオプション型についてはどうでしょうか。さて、Optionの大きな利点の1つは、.NETで参照型を使用するときに、nullに設定できるポインター参照を扱っていることです。ただし、オブジェクトのタイプは宣言されたものと同じままであり、ヒープ（ヒープ）内のオブジェクトへの有効な参照が含まれているか、nullである可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように書くのは完全に正常です。</font></font><br>
<br>
<pre><code class="erlang hljs">
string s1 = <span class="hljs-string">"cats"</span>;<font></font>
int s1Length = s1.Length;<font></font>
 <font></font>
string s2 = null;<font></font>
int s2Length = s2.Length;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは正常にコンパイルされます。</font><font style="vertical-align: inherit;">ただし、これを実行すると、NullReferenceExceptionが発生します。そのため、Nullが存在する可能性からすべてのコードを保護する必要があります。</font><font style="vertical-align: inherit;">これは、値をチェックしてそれを処理する/より意味のある例外をスローする保護用の素敵な小さなクラスがある場合でも、かなりすぐに退屈になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このスクリーンショットはLinqPadを使用しているため、LinqPadを以前に見たことがない場合は少し変わっているように見えるかもしれませんが、別のIDEでも同じ結果が得られます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/bc0/36c/5b0/bc036c5b0a7b7e81f74b87209d39a8ed.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、F＃の同等のコードがどのように見えるかを見てみましょう</font></font><br>
<br>
<pre><code class="erlang hljs"><span class="hljs-keyword">let</span> s1 = <span class="hljs-string">"Cats"</span>
<span class="hljs-keyword">let</span> s1Length = s1.Length;<font></font>
 <font></font>
<span class="hljs-keyword">let</span> s2 = None
<span class="hljs-keyword">let</span> s2Length = s2.Length;<font></font>
 <font></font>
//excplicily string typed None<font></font>
<span class="hljs-keyword">let</span> s3 = Option.None
<span class="hljs-keyword">let</span> s3Length = s3.Length;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードでは、s3が「Length」プロパティを持たない別の型と見なされるため、すぐにコンパイルエラーが発生します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプション比較</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションのタイプは等しいと見なされ、同じタイプであり、含まれるタイプが等しいことは、保持されたタイプの等価ルールに従います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、この種のことは、Fでのコンパイル時エラーをすぐに引き起こす可能性があります。</font></font><br>
<br>
<pre><code class="erlang hljs"><span class="hljs-keyword">let</span> o1 = Some <span class="hljs-number">1</span>
<span class="hljs-keyword">let</span> o2 = Some <span class="hljs-string">"Cats"</span><font></font>
 <font></font>
printfn <span class="hljs-string">"o1=o2 : %b"</span> (o1 = o2)</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/16f/f67/263/16ff67263839f6f581343d34d79619a4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイプが同じであるため、これは期待どおりに機能します</font></font><br>
<br>
<pre><code class="erlang hljs"><span class="hljs-keyword">let</span> o1 = Some <span class="hljs-string">"Cats"</span>
<span class="hljs-keyword">let</span> o2 = Some <span class="hljs-string">"Cats"</span>
<span class="hljs-keyword">let</span> o3 = Some <span class="hljs-string">"cats"</span><font></font>
 <font></font>
printfn <span class="hljs-string">"o1=o2 : %b"</span> (o1 = o2)<font></font>
printfn <span class="hljs-string">"o2=o3 : %b"</span> (o2 = o3)</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/113/103/5f9/1131035f97e9929bd0dd703d669e7afb.png" alt="画像"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja470902/index.html">高性能でネイティブなパーティション分割：TimescaleDBをサポートするZabbix</a></li>
<li><a href="../ja470904/index.html">機械学習とディープニューラルネットワークで最も柔らかく、毛皮で覆われた道</a></li>
<li><a href="../ja470908/index.html">付加技術の助けを借りて世界で初めて、大型航空機エンジンアセンブリが入手されました</a></li>
<li><a href="../ja470910/index.html">マイクロサービスコントラクトのアノテーションで何ができますか？</a></li>
<li><a href="../ja470916/index.html">スマートフォンから制御されるロシアの「最も安い」電子チェックポイント</a></li>
<li><a href="../ja470920/index.html">DataLine Cloudに接続する5つ以上の方法</a></li>
<li><a href="../ja470922/index.html">ハリコフでのmitap ThinkJava＃10の発表</a></li>
<li><a href="../ja470924/index.html">新しいプロジェクトでRobot Frameworkを採用した理由</a></li>
<li><a href="../ja470926/index.html">「私たちはお互いを信頼しています。たとえば、給与はまったくありません」-Peoplewareの作者であるTim Listerへの大規模なインタビュー</a></li>
<li><a href="../ja470928/index.html">コンテナー内でBuildahを実行するためのベストプラクティス</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>