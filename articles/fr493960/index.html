<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏼 🚶🏿 👩‍✈️ Configuration d'une imprimante d'étiquettes XPrinter sous Linux dans VMware Workstation 🍗 👨🏿‍🤝‍👨🏻 🤳🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un exemple à configurer sur CentOS sans shell graphique; par analogie, vous pouvez le configurer sur n'importe quel OS Linux. 
 
 Je résous un problèm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Configuration d'une imprimante d'étiquettes XPrinter sous Linux dans VMware Workstation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493960/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple à configurer sur CentOS sans shell graphique; par analogie, vous pouvez le configurer sur n'importe quel OS Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je résous un problème spécifique, à partir de PHP, vous devez imprimer des étiquettes avec du texte arbitraire selon le modèle. Puisqu'il est impossible de compter sur un Internet stable lors de l'événement, et que la plupart des tâches d'automatisation se croisent avec le site Web, nous avons décidé de travailler avec la machine virtuelle sur VMware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XPrinter convient également pour le marquage des tâches; l'installation sous les fenêtres est beaucoup plus facile. Il s'est arrêté sur le modèle XP-460B avec une largeur d'étiquette allant jusqu'à 108 mm.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kb/nb/gf/kbnbgfyypq5nwyake2w2hg2wegi.jpeg"></div><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je m'occupe rarement de la configuration Linux et de la connexion de périphériques, je cherchais des manuels de configuration prêts à l'emploi, j'ai réalisé que la façon la plus simple de connecter l'imprimante à travers des tasses. </font><font style="vertical-align: inherit;">Je n'ai pas pu connecter l'imprimante via USB, aucune manipulation sur les astuces des manuels n'a aidé, j'ai juste cassé la machine virtuelle plusieurs fois.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez les pilotes à partir du site Web du fabricant xprintertech.com, ils se trouvent dans une archive pour Windows, Mac et Linux.Les </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pilotes sont situés sur le site pour une série de périphériques, dans mon cas, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pilotes d'imprimante d'étiquettes de 4 pouces</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En fin de compte, le XP-460B a déjà été abandonné, j'ai réalisé à quelle série il appartient dans la chapelure du modèle similaire XP-470B.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez l'imprimante dans Windows, activez le partage</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mq/_x/cj/mq_xcj-xg_3khujjepoijh-9q-k.png"></div></li>
<li> Linux   1  4BARCODE.  «2  1» , bash   tar ,         cups.       bzip2 (  80    )<br>
<br>
<pre><code class="bash hljs">yum install cups<font></font>
yum install bzip2<font></font>
chmod 744 ./4BARCODE<font></font>
sh ./4BARCODE<font></font>
service cups start<font></font>
</code></pre></li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">localhost</a>:631  ,    ,      windows.  /etc/cups/cupsd.conf:<br>
<br>
<pre><code class="xml hljs">Listen localhost:631   Listen *:631
<span class="hljs-tag">&lt;<span class="hljs-name">Location</span> /&gt;</span><font></font>
  Order allow,deny<font></font>
  Allow localhost<font></font>
  Allow 192.168.1.*  <font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">Location</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Location</span> /<span class="hljs-attr">admin</span>&gt;</span><font></font>
  Order allow,deny<font></font>
  Allow localhost<font></font>
  Allow 192.168.1.*<font></font>
<span class="hljs-tag">&lt;/<span class="hljs-name">Location</span>&gt;</span>
</code></pre><br>
 631   firewall (  iptables):<br>
<br>
<pre><code class="bash hljs">firewall-cmd --zone=public --add-port=631/tcp --permanent<font></font>
firewall-cmd --reload<font></font>
</code></pre></li>
<li>     IP  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">192.168.1.5</a>:631/admin<br>
<br>
  (  root  )<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/uq/vo/dq/uqvodquq5zrhfxu0dqezx3ulmky.png"></div></li>
<li> 2 ,    ,   LPD   samba.<br>
<br>
<ol>
<li>    LPD,     windows (    Windows),  .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yu/2y/41/yu2y417h1xccrcfpysa9jkpr4se.png"></div><br>
  cups  lpd://192.168.1.52/Xprinter_XP-460B,  192.168.1.52 — IP ,    , Xprinter_XP-460B —       windows<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/ay/tk/lzaytk-6ywoldviksu9cyxaksfw.png"></div><br>
  4BARCODE =&gt; 4B-3064TA<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/if/ml/ig/ifmligg_hdt17kwsmlrzildy_5a.png"></div><br>
<b>       !</b>     ,     -   .        .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dv/7v/ud/dv7vud9j8yxo8a6g2guhswt_shw.png"></div><br>
<b>    — !</b></li>
<li> .   samba, ,  cups,       cups,      smb://user:password@192.168.1.52/Xprinter_XP-460B. , user —   windows,       ,     .</li>
</ol></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque tout s'est déroulé et que l'imprimante a imprimé une page de test, les tâches peuvent être envoyées via la console:</font></font><br>
<br>
<pre><code class="bash hljs">lpr -P Xprinter_XP-460B -o media=Custom.100x102mm test.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, l'étiquette a des dimensions de 100x100 mm, 2 mm sont sélectionnés expérimentalement. </font><font style="vertical-align: inherit;">La distance entre les étiquettes est de 3 mm, mais si vous définissez la hauteur sur 103 mm, la bande est décalée, il n'est pas pratique de déchirer l'étiquette. </font><font style="vertical-align: inherit;">L'inconvénient du protocole LPD est que les travaux sont envoyés comme vers une imprimante standard, le format ESC / P0S n'est pas envoyé à l'imprimante, le capteur ne calibre pas les étiquettes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous pouvez travailler avec l'imprimante via php. </font><font style="vertical-align: inherit;">Il existe des bibliothèques pour travailler avec des cups, il est plus facile pour moi d'envoyer une commande à la console via exec (); </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme ESC / P0S ne fonctionne pas, j'ai décidé de créer des modèles en pdf via la bibliothèque tFPDF</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">require_once</span>($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">"/tfpdf/tfpdf.php"</span>);<font></font>
$w = <span class="hljs-number">100</span>;<font></font>
$h = <span class="hljs-number">100</span>;<font></font>
$number = <span class="hljs-number">59</span>;<font></font>
$pdf = <span class="hljs-keyword">new</span> tFPDF(<span class="hljs-string">'P'</span>, <span class="hljs-string">'mm'</span>, [$w, $h]);<font></font>
$pdf-&gt;SetTitle(<span class="hljs-string">'Information'</span>);<font></font>
$pdf-&gt;AddFont(<span class="hljs-string">'Font'</span>, <span class="hljs-string">'B'</span>, $_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>] . <span class="hljs-string">'/fonts/opensans-bold.ttf'</span>, <span class="hljs-literal">true</span>);<font></font>
$pdf-&gt;SetTextColor(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<font></font>
$pdf-&gt;SetDrawColor(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<font></font>
<font></font>
$pdf-&gt;AddPage(<span class="hljs-string">'P'</span>);<font></font>
$pdf-&gt;SetDisplayMode(<span class="hljs-string">'real'</span>,<span class="hljs-string">'default'</span>);<font></font>
$pdf-&gt;Image($_SERVER[<span class="hljs-string">"DOCUMENT_ROOT"</span>]. <span class="hljs-string">'/images/logo_site.png'</span>,$w - <span class="hljs-number">4</span> - <span class="hljs-number">28</span>,$h - <span class="hljs-number">13</span>,<span class="hljs-number">28.1</span>,<span class="hljs-number">9.6</span>,<span class="hljs-string">''</span>);<font></font>
<font></font>
$pdf-&gt;SetFontSize(<span class="hljs-number">140</span>);<font></font>
$pdf-&gt;SetXY(<span class="hljs-number">0</span>,<span class="hljs-number">24</span>);<font></font>
$pdf-&gt;Cell($w,$h - <span class="hljs-number">45</span>, $number,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-string">'C'</span>,<span class="hljs-number">0</span>);<font></font>
<font></font>
$pdf-&gt;SetFontSize(<span class="hljs-number">1</span>);<font></font>
$pdf-&gt;SetTextColor(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>);<font></font>
$pdf-&gt;Write(<span class="hljs-number">0</span>, $number);<font></font>
<font></font>
$pdf-&gt;Output(<span class="hljs-string">'example.pdf'</span>,<span class="hljs-string">'I'</span>);
</code></pre><br>
<pre><code class="php hljs">exec(<span class="hljs-string">'php label.php | lpr -P Xprinter_XP-460B -o media=Custom.100x102mm'</span>);
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5w/uy/ly/5wuylysbgybnsmuhf2hwg_vz54o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terminé. </font><font style="vertical-align: inherit;">J'ai tué 2 jours de repos pour m'installer, j'espère que ça va être utile à quelqu'un.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493944/index.html">Nous continuons d'analyser les vulnérabilités des commutateurs industriels: nous exécutons du code arbitraire sans mot de passe</a></li>
<li><a href="../fr493948/index.html">Comment j'ai fabriqué un respirateur KN95 à la maison à partir de matériaux improvisés. des instructions détaillées</a></li>
<li><a href="../fr493950/index.html">Calculateur de réseau neuronal pour additionner et soustraire des nombres pas très grands</a></li>
<li><a href="../fr493952/index.html">Comment évaluer l'intelligence? Approche Google</a></li>
<li><a href="../fr493954/index.html">PostgreSQL Ajouter des contraintes non nulles aux grandes tables</a></li>
<li><a href="../fr493964/index.html">Mathématiques discrètes à l'examen au ShAD</a></li>
<li><a href="../fr493966/index.html">Où résoudre des problèmes réels pour les candidats Yandex: formation sur Codeforces et analyse</a></li>
<li><a href="../fr493968/index.html">GoToHome: isoler et programmer</a></li>
<li><a href="../fr493970/index.html">Vidéo pour les entreprises: comment attirer le public cible et ne pas effrayer par accident. 11 erreurs de message vidéo tueur</a></li>
<li><a href="../fr493972/index.html">L'ultra-condensateur de la NASA est devenu ... un humidimètre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>