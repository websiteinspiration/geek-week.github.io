<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤕 👩🏽‍🤝‍👨🏿 👩🏿‍✈️ CSS Houdini Tutorial 🧛🏽 🏉 🎐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, friends!
 
 What is a Houdini?
 Houdini ( Houdini ) - a collection of browser APIs that significantly improve the web development process, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CSS Houdini Tutorial</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494660/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good day, friends!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a Houdini?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Houdini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - a collection of browser APIs that significantly improve the web development process, including the development of CSS standards. </font><font style="vertical-align: inherit;">Developers will be able to extend CSS using JavaScript, influencing CSS rendering and telling the browser how styles should be applied. </font><font style="vertical-align: inherit;">This will provide a significant increase in performance and stability than the use of polyphiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini consists of two API groups - high-level APIs and low-level APIs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
High-level APIs are associated with the rendering process (style - layout - drawing - composition). </font><font style="vertical-align: inherit;">This group includes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paint API - allows you to extend CSS at the step (meaning the rendering stage) of rendering visual elements (color, background, borders, etc.).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layout API - allows you to extend CSS at the step of determining the size, position and alignment of elements.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation API - “extension point” in the step of displaying and animating elements.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Low-level APIs are the foundation for higher-level APIs and include:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typed Object Model API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Custom Properties &amp; Values ​​API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Font Metrics API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Worklets</font></font></li>
</ul><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS future</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini, unlike regular CSS, allows developers to extend CSS in a more natural way. </font><font style="vertical-align: inherit;">Does this mean that CSS specifications will cease to evolve and new standards be adopted? </font><font style="vertical-align: inherit;">Not at all. </font><font style="vertical-align: inherit;">Houdini's goal is to help develop new CSS features through the creation of working prototypes that can easily be standardized. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, developers can easily share open CSS worklets without worrying about compatibility.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typed Object Model (TOM) API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before Houdini, the only way JS and CSS interacted was to cast CSS to a string and modify it. </font><font style="vertical-align: inherit;">Manually parsing and redefining styles can be complex and error prone due to the need for double conversion of the value type (for example, from a number to a string and vice versa). </font><font style="vertical-align: inherit;">You also have to manually specify the units of measure for the new value.</font></font><br>
<br>
<pre><code class="javascript hljs">selectedElement.style.fontSize = newFontSize + <span class="hljs-string">'px'</span> <span class="hljs-comment">// newFontSize = 20</span>
<span class="hljs-built_in">console</span>.log(selectedElement.style.fontSize) <span class="hljs-comment">// 20px</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOM gives CSS properties a more semantic meaning by representing them as typed JS objects. </font><font style="vertical-align: inherit;">This greatly improves performance, stability, and facilitates code support. </font><font style="vertical-align: inherit;">CSS values ​​are represented by the CSSUnitValue interface, which consists of the value and the “unit of measure” property.</font></font><br>
<br>
<pre><code class="javascript hljs">{
  <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">unit</span>: <span class="hljs-string">'px'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This interface can be used with the following new features:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">computedStyleMap (): for parsing computed (not built-in) styles. </font><font style="vertical-align: inherit;">This method is called before parsing or using other methods.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attributeStyleMap: for parsing and modifying inline styles. </font><font style="vertical-align: inherit;">This is an item property.</font></font></li>
</ul><br>
<pre><code class="javascript hljs"><span class="hljs-comment">//       ( )</span>
selectedElement.computedStyleMap().get(<span class="hljs-string">'font-size'</span>) <span class="hljs-comment">// { value: 20, unit: 'px' }</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
selectedElement.attributeStyleMap.set(<span class="hljs-string">'font-size'</span>, CSS.em(<span class="hljs-number">2</span>))<font></font>
selectedElement. attributeStyleMap.set(<span class="hljs-string">'color'</span>, <span class="hljs-string">'blue'</span>)<font></font>
<font></font>
<span class="hljs-comment">//    </span>
selectedElement.computedStyleMap().get(<span class="hljs-string">'font-size'</span>) <span class="hljs-comment">// { value: 20, unit: 'px' }</span><font></font>
<font></font>
<span class="hljs-comment">//    </span>
selectedElement.attributeStyleMap.get(<span class="hljs-string">'font-size'</span>) <span class="hljs-comment">// { value: 2, unit: 'em' }</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note how CSS types are used when assigning a new value. </font><font style="vertical-align: inherit;">Using this syntax avoids the problems associated with types, and the resulting code becomes more secure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The API under consideration includes not only get and set, but also other methods, for example:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clear: removes all inline styles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete: deletes a specific CSS property and its value</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has: returns true / false depending on the availability of the specified property</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">append: adds an extra value to a property that supports multiple values</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> selectedElement = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'example'</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span>(selectedElement.attributeStyleMap){
  <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span>(selectedElement.computedStyleMap){
  <span class="hljs-comment">// ...</span><font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Working draft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : posted for community discussion.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Custom Properties and Values ​​API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This API allows developers to extend CSS variables by defining type, initial value, and inheritance. </font><font style="vertical-align: inherit;">In order to define a custom property, it is necessary to register it using the registerProperty method. </font><font style="vertical-align: inherit;">This method determines how browsers should apply the property and handle errors.</font></font><br>
<br>
<pre><code class="javascript hljs">CSS.registerProperty({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'--colorPrimary'</span>,
  <span class="hljs-attr">syntax</span>: <span class="hljs-string">'&lt;color&gt;'</span>,
  <span class="hljs-attr">inherits</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">initialValue</span>: <span class="hljs-string">'blue'</span>,<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An object with the following properties is passed to this method as an argument:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name: name of the custom property</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syntax: instruction for parsing. </font><font style="vertical-align: inherit;">The predefined values ​​are: &lt;color&gt;, &lt;integer&gt;, &lt;number&gt;, &lt;length&gt;, &lt;percentage&gt;, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initialValue: default value (before overriding, as well as when errors occur)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the above example, a custom property of type &lt;color&gt; was defined. </font><font style="vertical-align: inherit;">This property will be used to determine the gradient. </font><font style="vertical-align: inherit;">Regular CSS does not support gradient transitions. </font><font style="vertical-align: inherit;">Notice how the custom property will be used to define the transition.</font></font><br>
<br>
<pre><code class="javascript hljs">.gradient-box {
  <span class="hljs-attr">background</span>: linear-gradient(<span class="hljs-number">45</span>deg, rgba(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">1</span>) <span class="hljs-number">0</span>% <span class="hljs-keyword">var</span>(--colorPrimary) <span class="hljs-number">60</span>%);<font></font>
  transition: --colorPrimary <span class="hljs-number">0.5</span>s ease;<font></font>
  ...<font></font>
}<font></font>
<font></font>
.gradient-box:hover {<font></font>
  --colorPrimary: red;<font></font>
  ...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The browser does not know how to do the transition for the gradient, but it knows how to do it for the color. </font><font style="vertical-align: inherit;">That is why we defined the property type as &lt;color&gt;. </font><font style="vertical-align: inherit;">In a browser that supports Houdini, a gradient change will occur when you hover. </font><font style="vertical-align: inherit;">The gradient position, measured in percent, can also be changed using the CSS custom property (registered as &lt;percentage&gt;). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probably in the future it will be possible to register a custom property directly in CSS.</font></font><br>
<br>
<pre><code class="javascript hljs">@property --colorPrimary {
  <span class="hljs-attr">syntax</span>: <span class="hljs-string">'&lt;color&gt;'</span>;<font></font>
  inherits: <span class="hljs-literal">false</span>;<font></font>
  initial-value: blue;<font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This simple example shows how you can change the color and control points of a gradient using custom CSS properties. </font><font style="vertical-align: inherit;">An example code can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/p4/_n/fnp4_n8vvdfqg3c4xey3vrng-v0.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span>(CSS.registeredProperty) {
  <span class="hljs-comment">// ...</span><font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Working draft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : posted for community discussion.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Font Metrics API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This API is at an early stage of development, so the specification may change dramatically in the future. </font><font style="vertical-align: inherit;">It currently provides methods for measuring the size of text elements displayed on the screen, allowing developers to influence the rendering of characters. </font><font style="vertical-align: inherit;">The existing CSS features do not allow you to work with these values ​​or make this work very difficult. </font><font style="vertical-align: inherit;">One example of the use of this API is multi-line dynamic truncation of text.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collection of ideas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : draft not published. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browsers are not supported.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorkleta</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before moving on to the following APIs, you need to understand the concept of worklets. </font><font style="vertical-align: inherit;">Vorklets are scripts that run during rendering and are independent of the underlying JS code. </font><font style="vertical-align: inherit;">They expand the capabilities of the rendering engine, are designed for parallel execution (2 or more instances), do not block the main thread, have limited access to the global scope and are called by the engine as necessary. </font><font style="vertical-align: inherit;">Vorklets can only be run through HTTPS (in production) or through localhost (for development and testing purposes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini includes the following worklets that extend the browser rendering engine:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paint Worklet - Paint API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation Worklet - Animation API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layout Worklet - Layout API</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paint API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Paint API allows developers to use JS functions to paint the background, borders, or contents of an element using the 2D Rendering Context, which is a subset of the HTML5 Canvas API. </font><font style="vertical-align: inherit;">The Paint API uses the Paint Worklet to draw an image that depends on changes to the CSS (such as changes to CSS variables). </font><font style="vertical-align: inherit;">Those familiar with the Canvas API will feel right at home with the Paint API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creating a Paint Worklet consists of several steps:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write and register a worklet using the registerPaint function</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Call a worklet in HTML or JS using CSS.paintWorklet.addModule</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use the paint () method in CSS along with the name of the vorklet and the arguments passed</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the registerPaint function, which is used to register and determine the functionality of the Paint Worklet.</font></font><br>
<br>
<pre><code class="javascript hljs">registerPaint(<span class="hljs-string">'paintWorkletExample'</span>, <span class="hljs-class"><span class="hljs-keyword">class</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">inputProperties</span>() { <span class="hljs-keyword">return</span> [<span class="hljs-string">'--myVariable'</span>]; }
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">inputArguments</span>() { <span class="hljs-keyword">return</span> [<span class="hljs-string">'&lt;color&gt;'</span>]; }
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">contextOptions</span>() { <span class="hljs-keyword">return</span> {<span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span>} }<font></font>
<font></font>
  paint(ctx, size, properties, args) {<font></font>
    <span class="hljs-comment">// ...</span><font></font>
  }<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The registerPaint function consists of the following parts:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputProperties: An array of custom CSS properties that the worklet is observing. </font><font style="vertical-align: inherit;">This array represents the dependencies of the worklet.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputArguments: an array of arguments that can be passed from a function to external CSS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contextOptions: color transparency. </font><font style="vertical-align: inherit;">If false, all colors will be completely opaque</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paint: the main function taking the following arguments:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ctx: a 2D drawing context that is almost identical to the 2D canvas context of the Canvas API</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size: an object with the width and height of the element. </font><font style="vertical-align: inherit;">Values ​​depend on the layout rendering process. </font><font style="vertical-align: inherit;">Canvas size is same as actual item size</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properties: variables contained in inputProperties</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">args: an array of arguments passed to the paint function</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After registering the worklet, it must be called in HTML, indicating the path to the file.</font></font><br>
<br>
<pre><code class="javascript hljs">CSS.paintWorklet.addModule(<span class="hljs-string">'path/to/worklet/file.js'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vorklets can be added from any external source (for example, from CDN), which makes them modular and reusable.</font></font><br>
<br>
<pre><code class="javascript hljs">CSS.paintWorklet.addModule(<span class="hljs-string">'https://url/to/worklet/file.js'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After calling the worklet, it can be used in CSS using the “paint” function. </font><font style="vertical-align: inherit;">This function, as the first parameter, takes the registered name of the vorklet and all the arguments specified in inputArguments. </font><font style="vertical-align: inherit;">From this moment, the browser knows when to call the worklet and what user actions lead to the change of certain values ​​of CSS custom properties.</font></font><br>
<br>
<pre><code class="javascript hljs">.example-element {
  <span class="hljs-comment">// paintWorkletExample -  </span>
  <span class="hljs-comment">// blue - ,  </span>
  <span class="hljs-attr">background</span>: paint(paintWorkletExample, blue);<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following example demonstrates the use of the Paint API, as well as the modularity and reuse of worklets. </font><font style="vertical-align: inherit;">It uses the ripple worklet from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Google Chrome Labs repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">See example code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u3/yk/2y/u3yk2yldoyuza04pdyyz1zbxs-u.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span>(‘paintWorklet’ <span class="hljs-keyword">in</span> CSS){
  <span class="hljs-comment">// …</span><font></font>
}<font></font>
<font></font>
@supports(background: paint(paintWorkletExample)){<font></font>
  <span class="hljs-comment">// …</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recommendation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A stable working draft, ready to use.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supported by</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This API extends web animations through the processing of various events (scrolling, hovering, clicking, etc.) and improves performance by launching animations in its own stream through the animation worklet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like any other worklet, a workout animation must first be registered.</font></font><br>
<br>
<pre><code class="javascript hljs">registerAnimation(‘animationWorkletExample’, <span class="hljs-class"><span class="hljs-keyword">class</span> </span>{
  <span class="hljs-keyword">constructor</span>(options){
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
  animate(currentTime, effect){<font></font>
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This class includes two functions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constructor: called when a new instance is created. </font><font style="vertical-align: inherit;">Used for general setup.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">animate: The main function containing the animation logic. </font><font style="vertical-align: inherit;">The following parameters are accepted:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentTime: timestamps on a specific timeline</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effect: an array of effects used in the animation</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After registration, the worklet is included in the main JS file, animation (element, frames, settings) is added and attached to the timeline. </font><font style="vertical-align: inherit;">The concept of timeline marks and the basics of web animation is in the next section.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   </span>
<span class="hljs-keyword">await</span> CSS.animationWorklet.addModule(‘path/to/worklet/file.js’)<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-keyword">const</span> elementExample = <span class="hljs-built_in">document</span>.getElementById(‘element-example’)<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">const</span> effectExample = <span class="hljs-keyword">new</span> KeyframeEffect(<font></font>
  elementExample, <span class="hljs-comment">//  </span>
  [ <span class="hljs-comment">// … ], //  </span>
  { <span class="hljs-comment">// … } //  - , ,    ..</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">//        </span>
<span class="hljs-keyword">new</span> WorkletAnimation(<font></font>
  ‘animationWorkletExample’ <span class="hljs-comment">//  </span>
  effectExample, <span class="hljs-comment">//  </span>
  <span class="hljs-built_in">document</span>.timeline, <span class="hljs-comment">//  </span>
  {},  <span class="hljs-comment">//   </span>
).play()</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time stamps</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Web animations are based on timestamps — milestones for effects on the animation timeline. </font><font style="vertical-align: inherit;">For example, we analyze a repeating linear animation, which consists of three frames (beginning, middle, end), starts 1 second after the page is fully loaded (delay) and lasts 4 seconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The time stamps of the effects will look like this (for an animation lasting 4 seconds and without delay):</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time stamps</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation frame</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first frame - the beginning of the animation</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second frame - the middle of the animation</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last frame - end of animation or reset to first frame</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
effect.localTime with a value of 3000ms (given a delay of 1000ms) binds the animation to the average frame on the timeline (1000ms delay + 2000ms average frame). </font><font style="vertical-align: inherit;">The same effect will be achieved when setting 7000ms and 11000ms, as the animation repeats every 4000ms.</font></font><br>
<br>
<pre><code class="javascript hljs">animate(currentTime, effect){<font></font>
  effect.localTime = <span class="hljs-number">3000</span> <span class="hljs-comment">// 1000ms  + 2000ms  </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With a constant value of effect.localTime, the animation will be locked on a specific frame. </font><font style="vertical-align: inherit;">Therefore, the value of effect.localTime should change. </font><font style="vertical-align: inherit;">This value should be a function bound to currentTime or another variable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what the linear animation code looks like:</font></font><br>
<br>
<pre><code class="javascript hljs">animate(currentTime, effect){<font></font>
  effect.localTime = currentTime <span class="hljs-comment">// y = x  </span>
}</code></pre><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timeline (document.timeline)</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Time stamp</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frame</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 0ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 0ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (delay) + 0ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 3000ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (delay) + 2000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middle</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 5000ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (delay) + 4000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last / first</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 7000ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (delay) + 6000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middle</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 9000ms (elapsed time)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startTime + 1000ms (delay) + 8000ms</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last / first</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Time stamps are not limited to 1: 1. </font><font style="vertical-align: inherit;">The Animation API allows developers to manipulate marks through the animate function, using standard JS functions to create complex effects. </font><font style="vertical-align: inherit;">Animations can also vary at each iteration (with repeatable animations). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Animation can be tied not only to document loading, but also to user actions. </font><font style="vertical-align: inherit;">A user action such as scrolling a page can be used in animation through a ScrollTimeline object. </font><font style="vertical-align: inherit;">For example, an animation can start when you scroll 200px and end when you scroll 800px.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> scrollTimelineExample = <span class="hljs-keyword">new</span> ScrollTimeline({
  <span class="hljs-attr">scrollSource</span>: scrollElement, <span class="hljs-comment">// ,     </span>
  <span class="hljs-attr">orientation</span>: ‘vertical’, <span class="hljs-comment">//  </span>
  <span class="hljs-attr">startScrollOffset</span>: ‘<span class="hljs-number">200</span>px’, <span class="hljs-comment">//  </span>
  <span class="hljs-attr">endScrollOffset</span>: ‘<span class="hljs-number">800</span>px’, <span class="hljs-comment">//  </span>
  <span class="hljs-attr">timeRange</span>: <span class="hljs-number">1200</span>, <span class="hljs-comment">//  </span>
  <span class="hljs-attr">fill</span>: ‘forwards’ <span class="hljs-comment">//  </span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The animation automatically adapts to the scroll speed, while remaining smooth and responsive. </font><font style="vertical-align: inherit;">Since the animation runs in its own stream and connects to the browser rendering engine, it starts smoothly and does not affect performance.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following example demonstrates non-linear animation. </font><font style="vertical-align: inherit;">It uses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Gaussian function</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the same time rotation there and back. </font><font style="vertical-align: inherit;">See example code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hq/aw/es/hqawes_i_8t4arxvc3-7mo-ouqc.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span>(CSS.animationWorklet){
  <span class="hljs-comment">// …</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First public working draft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ready for community discussion, subject to change in the future.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layout API</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Layout API allows developers to extend the layout rendering process by defining new modules for use in the CSS “display” property. </font><font style="vertical-align: inherit;">This API introduces new concepts, is very complex and offers a large number of settings for developing custom algorithms for working with page layout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First things first, a worklet needs to be registered.</font></font><br>
<br>
<pre><code class="javascript hljs">registerLayout(‘exampleLayout’, <span class="hljs-class"><span class="hljs-keyword">class</span></span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">inputProperties</span>() { <span class="hljs-keyword">return</span> [‘--example-variable’] }<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">childrenInputProperties</span>() { <span class="hljs-keyword">return</span> [‘--exampleChildVariable’] }<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">get</span> <span class="hljs-title">layoutOptions</span>(){
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">childDisplay</span>: ‘normal’,
      <span class="hljs-attr">sizing</span>: ‘block-like’<font></font>
    }<font></font>
  }<font></font>
<font></font>
  intrinsicSizes(children, edges, styleMap){<font></font>
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
<font></font>
  layout(children, edges, constraints, styleMap, breakToken){<font></font>
    <span class="hljs-comment">// …</span><font></font>
  }<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Registering a worklet includes the following methods:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputProperties: an array of custom CSS properties that are watched by the worklet and that belong to the parent, the element that caused the layout to render. </font><font style="vertical-align: inherit;">This array represents the layout dependencies</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">childrenInputProperties: an array of custom CSS properties that are watched by the widget and which belong to the descendant</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">layoutOptions: defines the following layout properties:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">childDisplay: The predefined values ​​are block and normal. </font><font style="vertical-align: inherit;">Defines how the item is displayed (block or line)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizing: The predefined values ​​are block-like and manual. </font><font style="vertical-align: inherit;">Determines the need for preliminary calculation of element sizes (if not specified)</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intrinsicSizes: defines how the container or its contents are displayed in the layout context:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">children: child of the element that caused the page layout to render</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edges: container borders</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">styleMap: typed container style object model</font></font></li>
</ul></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">layout: the main function for working with the layout:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">children: child element</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edges: borders</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constraints: constraints imposed by the parent layout</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">styleMap: typed container style object model</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">breakToken: breakpoint for pagination or print layout splitting</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, the worklet is added to the HTML or JS file.</font></font><br>
<br>
<pre><code class="javascript hljs">CSS.layoutWorklet.addModule(‘path/to/worklet/file.js’)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We make a link to the worklet in the file with styles.</font></font><br>
<br>
<pre><code class="javascript hljs">.example-element {
  <span class="hljs-attr">display</span>: layout(exampleLayout)<font></font>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How the Layout API works with layout</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the previous example, we defined exampleLayout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An .example-element is called a parent layout, including indents, borders, and scroll sliders. </font><font style="vertical-align: inherit;">A parent layout consists of children elements called current layouts. </font><font style="vertical-align: inherit;">Current layouts are target elements whose layouts are “customized” using the Layout API. </font><font style="vertical-align: inherit;">For example, when using “display: flex”, the descendants of the element are rearranged according to the flexible layout. </font><font style="vertical-align: inherit;">This is similar to the operation of the Layout API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each current layout consists of child layouts containing algorithms for rendering the layout of the child element - LayoutChild (including the pseudo-classes :: before and :: after). </font><font style="vertical-align: inherit;">LayoutChild - a container generated by CSS tools containing data about styles (without data about the layout). </font><font style="vertical-align: inherit;">LayoutChild elements are automatically created by the browser at the stage of applying styles. </font><font style="vertical-align: inherit;">A child layout can create a Fragment containing instructions for rendering the layout.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This example also uses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Google Chrome Labs repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but the text is replaced with images. </font><font style="vertical-align: inherit;">See example code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yp/ft/b_/ypftb_-lievo3nmpij1lidenius.gif"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detection</font></font></h4><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span>(CSS.layoutWorklet){
  <span class="hljs-comment">// …</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Specification Status</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First public working draft</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ready for community discussion, subject to change in the future.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support</font></font></h4><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edge</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safari</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partial support</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not supported</font></font></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Houdini and progressive improvement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the fact that Houdini currently does not have optimal browser support, it can be used for progressive improvement. </font><font style="vertical-align: inherit;">If you are not familiar with the concept of progressive improvement, I advise you to take a look at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">When using Houdini, the following should be considered:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Always identify support to avoid errors.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each Houdini API and Worklet has an easy way to check accessibility. </font><font style="vertical-align: inherit;">This avoids the problems of using Houdini in browsers that do not yet support this technology.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use Houdini to improve display and visualization.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Users using browsers that do not support Houdini should have access to the content and basic functionality of the site. </font><font style="vertical-align: inherit;">User experience and content display should not be dependent on Houdini.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use standard CSS as an alternative</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, custom CSS properties can be used as an alternative to the custom properties and values ​​API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Focus on developing productive and reliable applications, using Houdini for decorative purposes only as a progressive improvement.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini allows developers to use JS code to work with styles in the rendering process, increasing application performance and stability. The ability to embed code in the rendering process allows you to create CSS polyphiles that are easy to share with others, apply, and possibly even include in the specification. In addition, Houdini allows developers and designers to be less dependent on CSS restrictions when working with styles, layouts, and animations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houdini can be used now, but only as a progressive improvement. This will allow browsers that do not support Houdini to display pages without errors, providing an optimal user experience. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I can’t wait until the developer community can fully enjoy the capabilities of Houdini. Here are a couple of examples:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS Houdini Expirements </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An Interactive Introduction to CSS Houdini Houdini </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples from Google Chrome Labs</font></font></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">References</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W3C Drafts of the Houdini </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Houdini </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Specification </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">(Chrome Dev Summit 2018) </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animation Worklet - Google Developers</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Thank you for your attention.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494646/index.html">The life of analytics lead or “I figured you would do it yourself”</a></li>
<li><a href="../en494648/index.html">We analyze the problems of GOST R 53894-2016 “Knowledge Management. Terms and Definitions"</a></li>
<li><a href="../en494650/index.html">Search for anagrams and sabanagrams in all words of the language</a></li>
<li><a href="../en494652/index.html">How much marketing is at ACID?</a></li>
<li><a href="../en494658/index.html">Using traits for polymorphic relationships in Laravel</a></li>
<li><a href="../en494662/index.html">Our space - is it so bad?</a></li>
<li><a href="../en494664/index.html">How implementing security processes helps transition to remote work</a></li>
<li><a href="../en494666/index.html">Finds of an audio man: where to listen to the music of bygone eras</a></li>
<li><a href="../en494668/index.html">Powerful Typescript Decorators - how they work, what they are compiled into, and for which application tasks are applicable</a></li>
<li><a href="../en494670/index.html">Intersection Observer API Case Studies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>