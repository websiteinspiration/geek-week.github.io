<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😿 🎉 🧖🏽 EitherモナドでのエレガントなJavaScriptエラー処理 ⛸️ 🎂 🖋️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="エラーの処理方法について少し説明しましょう。 JavaScriptには、例外を処理するための組み込みの言語関数があります。問題のあるコードをデザインに含めますtry...catch。これにより、セクションtryで通常の実行パスを指定して、セクションですべての例外を処理できますcatch。悪いオプショ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>EitherモナドでのエレガントなJavaScriptエラー処理</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457098/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーの処理方法について少し説明しましょう。 JavaScriptには、例外を処理するための組み込みの言語関数があります。問題のあるコードをデザインに含めます</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これにより、セクション</font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">通常の実行パスを指定して、セクション</font><font style="vertical-align: inherit;">ですべての例外を処理</font><font style="vertical-align: inherit;">できます</font></font><code>catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。悪いオプションではありません。これにより、起こり得るすべての間違いについて考えることなく、現在のタスクに集中できます。無限のifでコードを詰まらせるよりも間違いなく優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なし</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予期しない値のために、各関数呼び出しの結果を確認することは困難です。これは便利なデザインです。しかし、彼女には特定の問題があります。そして、これはエラーを処理する唯一の方法ではありません。この記事では</font><font style="vertical-align: inherit;">、代わりに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherモナドの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用を検討します</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
続行する前に、いくつかの点に注意します。</font><font style="vertical-align: inherit;">この記事では、関数の構成とカレーについてすでに知っていることを前提としています。</font><font style="vertical-align: inherit;">そして警告。</font><font style="vertical-align: inherit;">これまでにモナドに出会ったことがない場合、それらは本当に奇妙に見えるかもしれません... </font><font style="vertical-align: inherit;">このようなツールを使用するには、考え方を変える必要があります。</font><font style="vertical-align: inherit;">最初は難しいかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに混乱しても心配しないでください。</font><font style="vertical-align: inherit;">誰もが持っています。</font><font style="vertical-align: inherit;">記事の最後に、役立つかもしれないいくつかのリンクを挙げました。</font><font style="vertical-align: inherit;">あきらめないでください。</font><font style="vertical-align: inherit;">これらは脳に浸透するとすぐに酔いしれる。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題の例</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例外の問題を説明する前に、なぜそれらが存在するのか、なぜブロックが出現するのかについて話しましょう</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを行うために、私が少なくとも部分的に現実的にしようとした問題を見てみましょう。</font><font style="vertical-align: inherit;">通知のリストを表示する関数を書いていると想像してください。</font><font style="vertical-align: inherit;">サーバーからデータを返すことは、なんとかなんとかしてなんとかしています。</font><font style="vertical-align: inherit;">しかし、何らかの理由で、バックエンドエンジニアはJSONではなくCSV形式で送信することにしました。</font><font style="vertical-align: inherit;">生データは次のようになります。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイムスタンプ、コンテンツ、閲覧済み、href</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018-10-27T05：33：34 + 00：00、@ madhatterがあなたをお茶に招待し、未読、https：//example.com/invite/tea/3801</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018-10-26T13：47：12 + 00：00、@ queenofheartsが 'Croquet Tournament'ディスカッションであなたに言及し、閲覧、https：//example.com/discussions/croquet/1168</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018-10-25T03：50：08 + 00：00、@ cheshirecatがニヤリと未読を送信しました、https：//example.com/interactions/grin/88</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTMLで表示したい。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"MessageList"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message Message--viewed"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://example.com/invite/tea/3801"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message-link"</span>&gt;</span>@madhatter invited you to tea<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2018-10-27T05:33:34+00:00"</span>&gt;</span>27 October 2018<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message Message--viewed"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://example.com/discussions/croquet/1168"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message-link"</span>&gt;</span>@queenofhearts mentioned you in 'Croquet Tournament' discussion<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2018-10-26T13:47:12+00:00"</span>&gt;</span>26 October 2018<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message Message--viewed"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://example.com/interactions/grin/88"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Message-link"</span>&gt;</span>@cheshirecat sent you a grin<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">"2018-10-25T03:50:08+00:00"</span>&gt;</span>25 October 2018<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクを簡略化するには、今のところCSVデータの各行の処理に焦点を当てます。</font><font style="vertical-align: inherit;">文字列を処理するためのいくつかの簡単な関数から始めましょう。</font><font style="vertical-align: inherit;">最初はテキスト文字列をフィールドに分割します：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitFields</span>(<span class="hljs-params">row</span>) </span>{
    <span class="hljs-keyword">return</span> row.split(<span class="hljs-string">'","'</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
教材なのでここでは機能を簡略化しています。 CSV分析ではなく、エラー処理を扱います。メッセージの1つにカンマが表示されている場合、これはすべてひどく間違っています。このコードを使用して実際のCSVデータを分析しないでください。 CSVデータを分析する必要があった場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十分にテストされたCSV解析ライブラリを使用してください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを分割した後、オブジェクトを作成します。そして、各プロパティ名がCSVヘッダーと一致するようにします。タイトルバーをすでに何らかの形で分析していると仮定します（これについては後で詳しく説明します）。問題が発生する可能性があります。処理中にエラーが発生しました。文字列の長さがタイトルバーと一致しない場合、エラーがスローされます。 （</font></font><code>_.zipObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lodash機能</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zipRow</span>(<span class="hljs-params">headerFields, fieldData</span>) </span>{
    <span class="hljs-keyword">if</span> (headerFields.length !== fieldData.length) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Row has an unexpected number of fields"</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> _.zipObject(headerFields, fieldData);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、人間が読める形式の日付をオブジェクトに追加して、テンプレートに表示します。</font><font style="vertical-align: inherit;">JavaScriptには完全に組み込まれた日付フォーマットのサポートがないため、少し冗長になっています。</font><font style="vertical-align: inherit;">また、潜在的な問題に直面しています。</font><font style="vertical-align: inherit;">無効な日付が検出された場合、関数はエラーをスローします。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addDateStr</span>(<span class="hljs-params">messageObj</span>) </span>{
    <span class="hljs-keyword">const</span> errMsg = <span class="hljs-string">'Unable to parse date stamp in message object'</span>;
    <span class="hljs-keyword">const</span> months = [
        <span class="hljs-string">'January'</span>, <span class="hljs-string">'February'</span>, <span class="hljs-string">'March'</span>, <span class="hljs-string">'April'</span>, <span class="hljs-string">'May'</span>, <span class="hljs-string">'June'</span>, <span class="hljs-string">'July'</span>,
        <span class="hljs-string">'August'</span>, <span class="hljs-string">'September'</span>, <span class="hljs-string">'October'</span>, <span class="hljs-string">'November'</span>, <span class="hljs-string">'December'</span><font></font>
    ];<font></font>
    <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(messageObj.datestamp);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(d)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(errMsg);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> datestr = <span class="hljs-string">`<span class="hljs-subst">${d.getDate()}</span> <span class="hljs-subst">${months[d.getMonth()]}</span> <span class="hljs-subst">${d.getFullYear()}</span>`</span>;
    <span class="hljs-keyword">return</span> {datestr, ...messageObj};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、オブジェクト</font><font style="vertical-align: inherit;">を取得</font><font style="vertical-align: inherit;">し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てテンプレート関数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">渡し</font><font style="vertical-align: inherit;">、HTML文字列を取得します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> rowToMessage = _.template(<span class="hljs-string">`&lt;li class="Message Message--&lt;%= viewed %&gt;"&gt;
  &lt;a href="&lt;%= href %&gt;" class="Message-link"&gt;&lt;%= content %&gt;&lt;/a&gt;
  &lt;time datetime="&lt;%= datestamp %&gt;"&gt;&lt;%= datestr %&gt;&lt;/time&gt;
&lt;li&gt;`</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、エラーが発生した場合にエラーを出力すると便利です。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> showError = _.template(<span class="hljs-string">`&lt;li class="Error"&gt;&lt;%= message %&gt;&lt;/li&gt;`</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての準備が整ったら、各行を処理する関数をまとめることができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFieldNames, row</span>) </span>{
    <span class="hljs-keyword">try</span> {<font></font>
        fields = splitFields(row);<font></font>
        rowObj = zipRow(headerFieldNames, fields);<font></font>
        rowObjWithDate = addDateStr(rowObj);<font></font>
        <span class="hljs-keyword">return</span> rowToMessage(rowObj);<font></font>
    } <span class="hljs-keyword">catch</span>(e) {
        <span class="hljs-keyword">return</span> showError(e);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで関数の準備が整いました。</font><font style="vertical-align: inherit;">例外の処理方法を詳しく見てみましょう。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外：良い部分</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから何が良いの</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ですか？上記の例では、ブロック内のどのステップで</font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もエラーが発生する可能性がある</font><font style="vertical-align: inherit;">ことに注意し</font><font style="vertical-align: inherit;">てください。で</font></font><code>zipRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>addDateStr()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意図的にエラーをスローします。問題が発生した場合は、エラーをキャッチして、ページにメッセージを表示します。このメカニズムがないと、コードは本当に醜くなります。これはどのように見えるかです。関数はエラーをスローせず、を返すと仮定し</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRowWithoutExceptions</span>(<span class="hljs-params">headerFieldNames, row</span>) </span>{<font></font>
    fields = splitFields(row);<font></font>
    rowObj = zipRow(headerFieldNames, fields);<font></font>
    <span class="hljs-keyword">if</span> (rowObj === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> showError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Encountered a row with an unexpected number of items'</span>));<font></font>
    }<font></font>
<font></font>
    rowObjWithDate = addDateStr(rowObj);<font></font>
    <span class="hljs-keyword">if</span> (rowObjWithDate === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> showError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Unable to parse date in row object'</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> rowToMessage(rowObj);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、多数のテンプレート式が表示されてい</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。コードはより冗長です。そして、基本的なロジックに従うのは難しいです。また、その意味</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はあまりわかりません。前回の関数呼び出しが失敗した理由は本当にわかりません。推測する必要があります。エラーメッセージを作成してを呼び出します</font></font><code>showError()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。そのようなコードはより汚く、より混乱します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例外処理バージョンをもう一度見てください。これは、プログラムの成功パスと例外処理コードを明確に分離します。ブランチ</font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;は良い方法ですが、</font></font><code>catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;間違いです。すべての例外処理が1か所で行われます。そして、個々の関数が失敗した理由を報告する場合があります。全体として、これはかなり甘いようです。私は、大多数が最初の例を非常に適切であると考えていると思います。なぜ別のアプローチですか？</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理の問題...例外をキャッチ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチでは、これらの迷惑な間違いを無視できます。</font><font style="vertical-align: inherit;">残念ながら、</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼の仕事は上手すぎます。</font><font style="vertical-align: inherit;">あなたはただ例外を投げて次に進む。</font><font style="vertical-align: inherit;">後で彼を捕まえることができます。</font><font style="vertical-align: inherit;">そして、誰もが本当にそのようなブロックを常に置くつもりです。</font><font style="vertical-align: inherit;">しかし、エラーがどこに進むのかは必ずしも明らかではありません。</font><font style="vertical-align: inherit;">そして、そのブロックは忘れがちです。</font><font style="vertical-align: inherit;">そして、これに気付く前に、アプリケーションがクラッシュします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、例外はコードを汚染します。</font><font style="vertical-align: inherit;">ここでは、機能的な純度については詳しく説明しません。</font><font style="vertical-align: inherit;">しかし、機能の純粋さの1つの小さな側面を見てみましょう。参照の透明性です。</font><font style="vertical-align: inherit;">リンク透過関数は、特定の入力に対して常に同じ結果を返します。</font><font style="vertical-align: inherit;">しかし、例外のある関数については、これを言うことはできません。</font><font style="vertical-align: inherit;">値を返す代わりに、いつでも例外をスローできます。</font><font style="vertical-align: inherit;">これはロジックを複雑にします。</font><font style="vertical-align: inherit;">しかし、win-winオプションを見つけた場合はどうでしょう-エラーを処理するためのクリーンな方法は？</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは代替案を考え出します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
純粋な関数は常に値を返します（その値がない場合でも）。</font><font style="vertical-align: inherit;">したがって、エラー処理コードは常に値を返すと想定する必要があります。</font><font style="vertical-align: inherit;">では、最初の試みとして、失敗したときにErrorオブジェクトを返した場合はどうすればよいでしょうか。</font><font style="vertical-align: inherit;">つまり、エラーが発生した場合は常に、そのようなオブジェクトを返します。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRowReturningErrors</span>(<span class="hljs-params">headerFieldNames, row</span>) </span>{<font></font>
    fields = splitFields(row);<font></font>
    rowObj = zipRow(headerFieldNames, fields);<font></font>
    <span class="hljs-keyword">if</span> (rowObj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
        <span class="hljs-keyword">return</span> showError(rowObj);<font></font>
    }<font></font>
<font></font>
    rowObjWithDate = addDateStr(rowObj);<font></font>
    <span class="hljs-keyword">if</span> (rowObjWithDate <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
        <span class="hljs-keyword">return</span> showError(rowObjWithDate);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> rowToMessage(rowObj);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは例外なく特定のアップグレードではありません。</font><font style="vertical-align: inherit;">しかし、それはより良いです。</font><font style="vertical-align: inherit;">エラーメッセージの責任を個々の機能に戻しました。</font><font style="vertical-align: inherit;">しかし、まだこれらすべてのifがあります。</font><font style="vertical-align: inherit;">テンプレートを何らかの形でカプセル化するとよいでしょう。</font><font style="vertical-align: inherit;">つまり、バグがあることがわかっている場合は、残りのコードについて心配する必要はありません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリモーフィズム</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやってするの？これは難しい問題です。しかし、それは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多態性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の魔法の助けを借りて解決できます</font><font style="vertical-align: inherit;">。以前にポリモーフィズムに遭遇したことがない場合でも、心配する必要はありません。本質的には、「異なるタイプのエンティティに単一のインターフェースを提供すること」です（Straustrup、B。「C ++BjörnStraustrupの用語集」）。 JavaScriptでは、これは同じ名前のメソッドとシグネチャを持つオブジェクトを作成することを意味します。しかし、異なる動作。典型的な例はアプリケーションのロギングです。雑誌は私たちがいる環境に応じてさまざまな場所に送ることができます。たとえば、2つのロガーオブジェクトを作成するとどうなるでしょうか。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> consoleLogger = {
    <span class="hljs-attr">log</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">msg</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'This is the console logger, logging:'</span>, msg);<font></font>
    }<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> ajaxLogger = {
    <span class="hljs-attr">log</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">msg</span>) </span>{
        <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'https://example.com/logger'</span>, {<span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: msg});<font></font>
    }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方のオブジェクトは、単一の文字列パラメーターを期待するログ関数を定義します。</font><font style="vertical-align: inherit;">ただし、動作は異なります。</font><font style="vertical-align: inherit;">美しさは、</font></font><code>.log()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのオブジェクトを使用しても、</font><font style="vertical-align: inherit;">を呼び出すコードを記述できることです</font><font style="vertical-align: inherit;">。</font></font><code>consoleLogger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font><font style="vertical-align: inherit;">かもしれません</font></font><code>ajaxLogger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">とにかくすべてが機能します。</font><font style="vertical-align: inherit;">たとえば、次のコードはどのオブジェクトでも同じように機能します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">logger, message</span>) </span>{<font></font>
    logger.log(message);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の例は、</font></font><code>.toString()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのJSオブジェクトの</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">です。</font></font><code>.toString()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成した任意のクラスの</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を作成できます。</font><font style="vertical-align: inherit;">次に、メソッドを異なる方法で実装する2つのクラスを作成できます</font></font><code>.toString()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは、</font><font style="vertical-align: inherit;">名前が付けられます</font><font style="vertical-align: inherit;">それらを</font></font><code>Left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>Right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（少し後、私は名前を説明します）。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Left</span> </span>{
  <span class="hljs-keyword">constructor</span>(val) {
    <span class="hljs-keyword">this</span>._val = val;<font></font>
  }<font></font>
  toString() {<font></font>
    <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Left(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
  }<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Right</span> </span>{
  <span class="hljs-keyword">constructor</span>(val) {
    <span class="hljs-keyword">this</span>._val = val;<font></font>
  }<font></font>
  toString() {<font></font>
    <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Right(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font></font><code>.toString()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これらの2つのオブジェクト</font><font style="vertical-align: inherit;">を呼び出す関数を作成し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trace</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-built_in">console</span>.log(val.toString());
    <span class="hljs-keyword">return</span> val;<font></font>
}<font></font>
<font></font>
trace(<span class="hljs-keyword">new</span> Left(<span class="hljs-string">'Hello world'</span>));
<span class="hljs-comment">// ⦘ Left(Hello world)</span><font></font>
<font></font>
trace(<span class="hljs-keyword">new</span> Right(<span class="hljs-string">'Hello world'</span>));
<span class="hljs-comment">// ⦘ Right(Hello world);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目立ったコードではないことは知っています。</font><font style="vertical-align: inherit;">しかし、実際には、同じインターフェースを使用する2種類の動作があります。</font><font style="vertical-align: inherit;">これがポリモーフィズムです。</font><font style="vertical-align: inherit;">しかし、興味深いものに注意を払ってください。</font><font style="vertical-align: inherit;">ifステートメントをいくつ使用しましたか？</font><font style="vertical-align: inherit;">ゼロ。</font><font style="vertical-align: inherit;">誰も。</font><font style="vertical-align: inherit;">単一のifステートメントを使用せずに、2つの異なるタイプの動作を作成しました。</font><font style="vertical-align: inherit;">おそらく、このようなものを使用してエラーを処理できます...</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左右</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題に戻ります。</font><font style="vertical-align: inherit;">コードの成功パスと失敗パスを判別する必要があります。</font><font style="vertical-align: inherit;">適切なパスでは、エラーが発生するか完了するまで、コードを静かに実行し続けます。</font><font style="vertical-align: inherit;">間違った方向に進んだ場合、コードを実行しようとしなくなります。</font><font style="vertical-align: inherit;">これらのパスにHappyとSadという名前を付けることもできますが、他のプログラミング言語やライブラリが使用する命名規則に従うようにしてください。</font><font style="vertical-align: inherit;">では、悪い道を左、成功した道を右と呼びましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
良いパスにいる場合は関数を実行するメソッドを作成しますが、悪いパスでは無視します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Left represents the sad path.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Left</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    runFunctionOnlyOnHappyPath() {<font></font>
        <span class="hljs-comment">// Left is the sad path. Do nothing</span><font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Left(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Right represents the happy path.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Right</span> </span>{
  <span class="hljs-keyword">constructor</span>(val) {
    <span class="hljs-keyword">this</span>._val = val;<font></font>
  }<font></font>
  runFunctionOnlyOnHappyPath(fn) {<font></font>
    <span class="hljs-keyword">return</span> fn(<span class="hljs-keyword">this</span>._val);<font></font>
  }<font></font>
  toString() {<font></font>
    <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Right(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなもの：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> leftHello  = <span class="hljs-keyword">new</span> Left(<span class="hljs-string">'Hello world'</span>);
<span class="hljs-keyword">const</span> rightHello = <span class="hljs-keyword">new</span> Right(<span class="hljs-string">'Hello world'</span>);<font></font>
<font></font>
leftHello.runFunctionOnlyOnHappyPath(trace);<font></font>
<span class="hljs-comment">// does nothing</span><font></font>
<font></font>
<font></font>
rightHello.runFunctionOnlyOnHappyPath(trace);<font></font>
<span class="hljs-comment">// ⦘ Hello world</span>
<span class="hljs-comment">// ￩ "Hello world"</span></code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放送</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有用なものに近づいていますが、まだ完全ではありません。</font><font style="vertical-align: inherit;">このメソッド</font></font><code>.runFunctionOnlyOnHappyPath()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はプロパティを返します</font></font><code>_val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すべてうまくいきますが、複数の関数を実行したい場合は不便です。</font><font style="vertical-align: inherit;">どうして？</font><font style="vertical-align: inherit;">成功したのか失敗したのかが分からなくなったからです。</font><font style="vertical-align: inherit;">情報は、LeftとRight以外の値を取るとすぐに消えます。</font><font style="vertical-align: inherit;">だから私たちができることは、新しいものを</font></font><code>_val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中に入れ</font><font style="vertical-align: inherit;">て左または右のパスを返すことです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここにいるので、名前を短くします。</font><font style="vertical-align: inherit;">私たちが行うことは、関数を単純な値の世界から左と右の世界に変換することです。</font><font style="vertical-align: inherit;">したがって、次のメソッドを呼び出します</font></font><code>map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Left represents the sad path.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Left</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map() {<font></font>
        <span class="hljs-comment">// Left is the sad path</span>
        <span class="hljs-comment">// so we do nothing</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Left(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Right represents the happy path
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Right</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map(fn) {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Right(<font></font>
            fn(<span class="hljs-keyword">this</span>._val)<font></font>
        );<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Right(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドを挿入し、自由構文でLeftまたはRightを使用します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> leftHello        = <span class="hljs-keyword">new</span> Left(<span class="hljs-string">'Hello world'</span>);
<span class="hljs-keyword">const</span> rightHello       = <span class="hljs-keyword">new</span> Right(<span class="hljs-string">'Hello world'</span>);
<span class="hljs-keyword">const</span> helloToGreetings = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.replace(<span class="hljs-regexp">/Hello/</span>, <span class="hljs-string">'Greetings,'</span>);<font></font>
<font></font>
leftHello.map(helloToGreetings).map(trace);<font></font>
<span class="hljs-comment">// Doesn't print any thing to the console</span>
<span class="hljs-comment">// ￩ Left(Hello world)</span><font></font>
<font></font>
rightHello.map(helloToGreetings).map(trace);<font></font>
<span class="hljs-comment">// ⦘ Greetings, world</span>
<span class="hljs-comment">// ￩ Right(Greetings, world)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
達成するための2つの方法を作成しました。</font><font style="vertical-align: inherit;">を呼び出してデータを正常なパスに配置する</font></font><code>new Right()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">か</font><font style="vertical-align: inherit;">、を呼び出し</font><font style="vertical-align: inherit;">て失敗した</font><font style="vertical-align: inherit;">パスにデータを配置</font><font style="vertical-align: inherit;">でき</font><font style="vertical-align: inherit;">ます</font></font><code>new Left()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/36a/2ee/cf6/36a2eecf61c554e388c5723b0b5cbd02.svg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各クラスはパスを表します：成功または失敗。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scott Vlashchina</font></font></a></font></i><font style="vertical-align: inherit;"><i><font color="gray"><font style="vertical-align: inherit;">からこの鉄道のメタファーを盗み</font></font></i><i><font color="gray"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました。</font></a></font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
もしそれ</font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><i><font color="gray"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">良い</font></a></font></i><font style="vertical-align: inherit;">軌道に乗っ</font><font style="vertical-align: inherit;">たら</font><font style="vertical-align: inherit;">、それに沿ってデータを処理します。</font><font style="vertical-align: inherit;">自分が失敗したと思っても、何も起こりません。</font><font style="vertical-align: inherit;">値をさらに渡してください。</font><font style="vertical-align: inherit;">たとえば、Errorをこの間違ったパスに置くと、と非常に似たものになり</font></font><code>try…catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/17c/3e6/09d/17c3e609d306efc1bee111077456b9ab.svg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これ</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をパスに沿って移動</font><font style="vertical-align: inherit;">するため</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">ます。次の</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パスが進むにつれて、LeftまたはRightを常に書き込むことが少し難しくなるため、この組み合わせを単にEither（「どちらか」）と呼びます。</font><font style="vertical-align: inherit;">左か右。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherオブジェクトを作成するためのショートカット</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、次のステップは、Eitherを返すようにサンプル関数を書き直すことです。</font><font style="vertical-align: inherit;">エラーの場合は左、値の場合は右。</font><font style="vertical-align: inherit;">しかし、これを行う前に、楽しんでください。</font><font style="vertical-align: inherit;">いくつかのショートカットを書いてみましょう。</font><font style="vertical-align: inherit;">1つ目は、という静的メソッド</font></font><code>.of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">新しいLeftまたはRightを返すだけです。</font><font style="vertical-align: inherit;">コードは次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">Left.of = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">of</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Left(x);<font></font>
};<font></font>
<font></font>
Right.of = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">of</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Right(x);<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
率直に言っても</font></font><code>Left.of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>Right.of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書くのは面倒です。</font><font style="vertical-align: inherit;">したがって、私はさらに短いショートカットを使用する傾向があり</font></font><code>left()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>right()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">left</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">return</span> Left.of(x);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">right</span>(<span class="hljs-params">x</span>) </span>{
    <span class="hljs-keyword">return</span> Right.of(x);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのショートカットを使用して、アプリケーションの機能を書き直します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zipRow</span>(<span class="hljs-params">headerFields, fieldData</span>) </span>{
    <span class="hljs-keyword">const</span> lengthMatch = (headerFields.length == fieldData.length);
    <span class="hljs-keyword">return</span> (!lengthMatch)<font></font>
        ? left(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Row has an unexpected number of fields"</span>))<font></font>
        : right(_.zipObject(headerFields, fieldData));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addDateStr</span>(<span class="hljs-params">messageObj</span>) </span>{
    <span class="hljs-keyword">const</span> errMsg = <span class="hljs-string">'Unable to parse date stamp in message object'</span>;
    <span class="hljs-keyword">const</span> months = [
        <span class="hljs-string">'January'</span>, <span class="hljs-string">'February'</span>, <span class="hljs-string">'March'</span>, <span class="hljs-string">'April'</span>, <span class="hljs-string">'May'</span>, <span class="hljs-string">'June'</span>, <span class="hljs-string">'July'</span>,
        <span class="hljs-string">'August'</span>, <span class="hljs-string">'September'</span>, <span class="hljs-string">'October'</span>, <span class="hljs-string">'November'</span>, <span class="hljs-string">'December'</span><font></font>
    ];<font></font>
    <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(messageObj.datestamp);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(d)) { <span class="hljs-keyword">return</span> left(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(errMsg));  }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> datestr = <span class="hljs-string">`<span class="hljs-subst">${d.getDate()}</span> <span class="hljs-subst">${months[d.getMonth()]}</span> <span class="hljs-subst">${d.getFullYear()}</span>`</span>;
    <span class="hljs-keyword">return</span> right({datestr, ...messageObj});<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更された機能は、古い機能とそれほど変わりません。</font><font style="vertical-align: inherit;">エラーがあるかどうかに応じて、戻り値を単にLeftまたはRightでラップします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、1行を処理するmain関数の処理を開始できます。</font><font style="vertical-align: inherit;">まず、文字列をEither sに入れ、</font></font><code>right()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font><code>splitFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して分割します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
   <span class="hljs-comment">// …</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは問題なく動作しますが、次のように同じことを実行しようとすると問題が発生します</font></font><code>zipRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
        <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
        <span class="hljs-keyword">const</span> rowObj         = fieldsEither.map(zipRow <span class="hljs-comment">/* wait. this isn't right */</span>);
        <span class="hljs-comment">// ...</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、</font></font><code>zipRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのパラメーターが必要です。</font><font style="vertical-align: inherit;">ただし、渡す関数は</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティから1つの値のみ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">取得します</font></font><code>._val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">カレーバージョンを使用して状況を修正できます</font></font><code>zipRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zipRow</span>(<span class="hljs-params">headerFields</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zipRowWithHeaderFields</span>(<span class="hljs-params">fieldData</span>) </span>{
        <span class="hljs-keyword">const</span> lengthMatch = (headerFields.length == fieldData.length);
        <span class="hljs-keyword">return</span> (!lengthMatch)<font></font>
            ? left(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Row has an unexpected number of fields"</span>))<font></font>
            : right(_.zipObject(headerFields, fieldData));<font></font>
    };<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この小さな変更は変換を単純化する</font></font><code>zipRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ので、以下でうまく機能し</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
    <span class="hljs-keyword">const</span> rowObj         = fieldsEither.map(zipRow(headerFields));
    <span class="hljs-comment">// ... But now we have another problem ...</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherが返されない</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、起動に</font><font style="vertical-align: inherit;">
使用</font><font style="vertical-align: inherit;">するの</font></font><code>splitFields()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;は正常</font></font><code>.splitFields()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ただし、を開始する必要がある場合</font></font><code>zipRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Eitherが返されるため問題が発生します。</font><font style="vertical-align: inherit;">そのため、使用すると、</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherの内部にぶつかることになります。</font><font style="vertical-align: inherit;">我々はさらに行けば、我々が実行されるまで、その後、動けなく</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それも機能しません。</font><font style="vertical-align: inherit;">これらのネストされたEitherを組み合わせる方法が必要です。</font><font style="vertical-align: inherit;">したがって、次のように呼び出す新しいメソッドを作成します</font></font><code>.join()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 *Left represents the sad path.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Left</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map() {<font></font>
        <span class="hljs-comment">// Left is the sad path</span>
        <span class="hljs-comment">// so we do nothing</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    join() {<font></font>
        <span class="hljs-comment">// On the sad path, we don't</span>
        <span class="hljs-comment">// do anything with join</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Left(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Right represents the happy path
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Right</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map(fn) {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Right(<font></font>
            fn(<span class="hljs-keyword">this</span>._val)<font></font>
        );<font></font>
    }<font></font>
    join() {<font></font>
        <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>._val <span class="hljs-keyword">instanceof</span> Left)<font></font>
            || (<span class="hljs-keyword">this</span>._val <span class="hljs-keyword">instanceof</span> Right))<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._val;<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Right(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、資産を「開梱」できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
    <span class="hljs-keyword">const</span> rowObj         = fieldsEither.map(zipRow(headerFields)).join();
    <span class="hljs-keyword">const</span> rowObjWithDate = rowObj.map(addDateStr).join();
    <span class="hljs-comment">// Slowly getting better... but what do we return?</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鎖</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは長い道のりを歩んできました。</font><font style="vertical-align: inherit;">しかし、あなたは常に挑戦を覚えておく必要があり</font></font><code>.join()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは迷惑です。</font><font style="vertical-align: inherit;">ただし、共通の連続呼び出しパターン</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>.join()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があるため、そのためのクイックアクセスメソッドを作成しましょう。</font></font><code>chain()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左または右を返す関数をリンクするため、</font><font style="vertical-align: inherit;">これを</font><font style="vertical-align: inherit;">（チェーン）</font><font style="vertical-align: inherit;">と呼び</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 *Left represents the sad path.
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Left</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map() {<font></font>
        <span class="hljs-comment">// Left is the sad path</span>
        <span class="hljs-comment">// so we do nothing</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    join() {<font></font>
        <span class="hljs-comment">// On the sad path, we don't</span>
        <span class="hljs-comment">// do anything with join</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    chain() {<font></font>
        <span class="hljs-comment">// Boring sad path,</span>
        <span class="hljs-comment">// do nothing.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Left(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-comment">/**
 * Right represents the happy path
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Right</span> </span>{
    <span class="hljs-keyword">constructor</span>(val) {
        <span class="hljs-keyword">this</span>._val = val;<font></font>
    }<font></font>
    map(fn) {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Right(<font></font>
            fn(<span class="hljs-keyword">this</span>._val)<font></font>
        );<font></font>
    }<font></font>
    join() {<font></font>
        <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>._val <span class="hljs-keyword">instanceof</span> Left)<font></font>
            || (<span class="hljs-keyword">this</span>._val <span class="hljs-keyword">instanceof</span> Right)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._val;<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }<font></font>
    chain(fn) {<font></font>
        <span class="hljs-keyword">return</span> fn(<span class="hljs-keyword">this</span>._val);<font></font>
    }<font></font>
    toString() {<font></font>
        <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">this</span>._val.toString();
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Right(<span class="hljs-subst">${str}</span>)`</span>;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
線路との類推に戻る</font></font><code>.chain()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、エラーが発生した場合はレール</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">切り替えます。</font><font style="vertical-align: inherit;">ただし、ダイアグラムに表示する方が簡単です。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/1bc/279/530/1bc2795304c211004070da858179fcfc.svg"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーが発生した場合、.chain（）メソッドを使用すると、左側のパスに切り替えることができます。</font><font style="vertical-align: inherit;">スイッチは一方向にしか機能しないことに注意してください。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コードは少しすっきりしています：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
    <span class="hljs-keyword">const</span> rowObj         = fieldsEither.chain(zipRow(headerFields));
    <span class="hljs-keyword">const</span> rowObjWithDate = rowObj.chain(addDateStr);
    <span class="hljs-comment">// Slowly getting better... but what do we return?</span>
}</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値で何かをする</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数のリファクタリングは</font></font><code>processRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほぼ完了です。</font><font style="vertical-align: inherit;">しかし、値を返すとどうなりますか？</font><font style="vertical-align: inherit;">結局のところ、私たちは、私たちがどのような状況にあるかに応じて、さまざまなアクションを実行したいと考えています。</font><font style="vertical-align: inherit;">したがって、適切な対策を講じる関数を記述します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">either</span>(<span class="hljs-params">leftFunc, rightFunc, e</span>) </span>{
    <span class="hljs-keyword">return</span> (e <span class="hljs-keyword">instanceof</span> Left) ? leftFunc(e._val) : rightFunc(e._val);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、LeftオブジェクトまたはRightオブジェクトの内部値をだまして使用しました。</font><font style="vertical-align: inherit;">しかし、あなたがこれに気づかなかったふりをしてください。</font><font style="vertical-align: inherit;">これで関数を完成させることができます：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> fieldsEither   = right(row).map(splitFields);
    <span class="hljs-keyword">const</span> rowObj         = fieldsEither.chain(zipRow(headerFields));
    <span class="hljs-keyword">const</span> rowObjWithDate = rowObj.chain(addDateStr);
    <span class="hljs-keyword">return</span> either(showError, rowToMessage, rowObjWithDate);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私たちが特に賢いと感じた場合は、無料の構文を再び使用できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRow</span>(<span class="hljs-params">headerFields, row</span>) </span>{
    <span class="hljs-keyword">const</span> rowObjWithDate = right(row)<font></font>
        .map(splitFields)<font></font>
        .chain(zipRow(headerFields))<font></font>
        .chain(addDateStr);<font></font>
    <span class="hljs-keyword">return</span> either(showError, rowToMessage, rowObjWithDate);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのバージョンもかなりきれいです。</font><font style="vertical-align: inherit;">デザインはありません</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、最上位関数にはifステートメントはありません。</font><font style="vertical-align: inherit;">特定の行に問題がある場合は、最後にエラーメッセージを表示します。</font><font style="vertical-align: inherit;">また</font></font><code>processRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最初にを呼び出すのは、LeftまたはRightについてだけ</font></font><code>right()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">残りは唯一使用される方法です</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font></font><code>.chain()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用するための次の機能。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APとリフト</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見た目は良いですが、最後のシナリオを検討する必要があります。</font><font style="vertical-align: inherit;">この例に続いて、個々の行だけでなく、すべてのCSVデータを処理する方法を見てみましょう。</font><font style="vertical-align: inherit;">補助関数（ヘルパー）または3つが必要です。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitCSVToRows</span>(<span class="hljs-params">csvData</span>) </span>{
    <span class="hljs-comment">// There should always be a header row... so if there's no</span>
    <span class="hljs-comment">// newline character, something is wrong.</span>
    <span class="hljs-keyword">return</span> (csvData.indexOf(<span class="hljs-string">'\n'</span>) &lt; <span class="hljs-number">0</span>)<font></font>
        ? left(<span class="hljs-string">'No header row found in CSV data'</span>)<font></font>
        : right(csvData.split(<span class="hljs-string">'\n'</span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRows</span>(<span class="hljs-params">headerFields, dataRows</span>) </span>{
    <span class="hljs-comment">// Note this is Array map, not Either map.</span>
    <span class="hljs-keyword">return</span> dataRows.map(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> processRow(headerFields, row));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showMessages</span>(<span class="hljs-params">messages</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;ul class="Messages"&gt;<span class="hljs-subst">${messages.join(<span class="hljs-string">'\n'</span>)}</span>&lt;/ul&gt;`</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、CSVを行に分割するヘルパーがあります。</font><font style="vertical-align: inherit;">そしてEitherでオプションに戻ります。</font><font style="vertical-align: inherit;">これで</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、lodash関数を</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">て、データ行からタイトルバーを抽出</font><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、私たちは興味深い状況にいます...</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">csvToMessages</span>(<span class="hljs-params">csvData</span>) </span>{
    <span class="hljs-keyword">const</span> csvRows      = splitCSVToRows(csvData);
    <span class="hljs-keyword">const</span> headerFields = csvRows.map(_.head).map(splitFields);
    <span class="hljs-keyword">const</span> dataRows     = csvRows.map(_.tail);
    <span class="hljs-comment">// What’s next?</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で表示できるヘッダーフィールドとデータ行があります</font></font><code>processRows()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、</font></font><code>headerFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、</font></font><code>dataRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どちらかに包まれました。</font></font><code>processRows()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherで機能する関数</font><font style="vertical-align: inherit;">に変換</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">方法が必要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">まず、カレーを行います</font></font><code>processRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRows</span>(<span class="hljs-params">headerFields</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processRowsWithHeaderFields</span>(<span class="hljs-params">dataRows</span>) </span>{
        <span class="hljs-comment">// Note this is Array map, not Either map.</span>
        <span class="hljs-keyword">return</span> dataRows.map(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> processRow(headerFields, row));<font></font>
    };<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、実験の準備がすべて整いました。</font></font><code>headerFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherである</font><font style="vertical-align: inherit;">us </font><font style="vertical-align: inherit;">では、配列をラップします。</font><font style="vertical-align: inherit;">私たちがそれを受け取っ</font></font><code>headerFields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て呼び出す</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>processRows()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どうなりますか？</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">csvToMessages</span>(<span class="hljs-params">csvData</span>) </span>{
    <span class="hljs-keyword">const</span> csvRows      = splitCSVToRows(csvData);
    <span class="hljs-keyword">const</span> headerFields = csvRows.map(_.head).map(splitFields);
    <span class="hljs-keyword">const</span> dataRows     = csvRows.map(_.tail);<font></font>
<font></font>
    <span class="hljs-comment">// How will we pass headerFields and dataRows to</span>
    <span class="hljs-comment">// processRows() ?</span>
    <span class="hljs-keyword">const</span> funcInEither = headerFields.map(processRows);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.map（）を使用すると、ここ</font></font><code>processRows()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">は外部関数が呼び出されます</font><font style="vertical-align: inherit;">が、内部</font><font style="vertical-align: inherit;">関数は呼び出され</font><font style="vertical-align: inherit;">ません。</font><font style="vertical-align: inherit;">つまり、</font></font><code>processRows()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を返します。</font><font style="vertical-align: inherit;">それ以来、</font></font><code>.map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eitherは引き続き返されます。</font><font style="vertical-align: inherit;">したがって、結果はと呼ばれるEither内の関数になり</font></font><code>funcInEither</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">文字列の配列を取り、他の文字列の配列を返します。</font><font style="vertical-align: inherit;">どういうわけか、この関数を取得して、の中に値を指定して呼び出す必要があります</font></font><code>dataRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを行うには、クラスLeftおよびRightに別のメソッドを追加します。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">基準</font></a></font><code>.ap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従って</font><font style="vertical-align: inherit;">呼びます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
いつものように、このメソッドはLeftトラックでは何もしません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-comment">// In Left (the sad path)</span><font></font>
    ap() {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、Rightクラスでは、関数を持つ別のEitherが必要です。</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-comment">// In Right (the happy path)</span><font></font>
    ap(otherEither) {<font></font>
        <span class="hljs-keyword">const</span> functionToRun = otherEither._val;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(functionToRun);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、メイン関数を完了できます。</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">csvToMessages</span>(<span class="hljs-params">csvData</span>) </span>{
        <span class="hljs-keyword">const</span> csvRows      = splitCSVToRows(csvData);
        <span class="hljs-keyword">const</span> headerFields = csvRows.map(_.head).map(splitFields);
        <span class="hljs-keyword">const</span> dataRows     = csvRows.map(_.tail);
        <span class="hljs-keyword">const</span> funcInEither = headerFields.map(processRows);
        <span class="hljs-keyword">const</span> messagesArr  = dataRows.ap(funcInEither);
        <span class="hljs-keyword">return</span> either(showError, showMessages, messagesArr);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドの本質は</font></font><code>.ap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐに理解されます（Fantasy Landの仕様では混乱していますが、他のほとんどの言語では、メソッドは逆に使用されています）。簡単に説明すると、次のように言います。「通常、2つの単純な値を取る関数があります。どちらかを2つ取る関数にしたい」可能であれば、</font></font><code>.ap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それを行う関数を作成できます。</font></font><code>liftA2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再び標準的な名前に従って</font><font style="vertical-align: inherit;">それを呼びましょう</font><font style="vertical-align: inherit;">。彼女は2つの引数を期待する単純な関数を取り、それを「リフト」して「アプリケーション」と連携させます。 （これらはmethod </font></font><code>.ap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">methodの両方を含むオブジェクトです</font></font><code>.of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。したがって、liftA2は「適用可能なリフト、2つのパラメーター」の略です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、関数</font></font><code>liftA2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">liftA2</span>(<span class="hljs-params">func</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runApplicativeFunc</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> b.ap(a.map(func));<font></font>
    };<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トップレベルの関数はそれを次のように使用します：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">csvToMessages</span>(<span class="hljs-params">csvData</span>) </span>{
    <span class="hljs-keyword">const</span> csvRows      = splitCSVToRows(csvData);
    <span class="hljs-keyword">const</span> headerFields = csvRows.map(_.head).map(splitFields);
    <span class="hljs-keyword">const</span> dataRows     = csvRows.map(_.tail);
    <span class="hljs-keyword">const</span> processRowsA = liftA2(processRows);
    <span class="hljs-keyword">const</span> messagesArr  = processRowsA(headerFields, dataRows);
    <span class="hljs-keyword">return</span> either(showError, showMessages, messagesArr);<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePenのコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真実？</font><font style="vertical-align: inherit;">全部？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたは尋ねるかもしれません、単純な例外より良いものは何ですか？</font><font style="vertical-align: inherit;">これは単純な問題を解決する方法としては複雑すぎると思いませんか？</font><font style="vertical-align: inherit;">まず、なぜ例外が好きなのかを考えてみましょう。</font><font style="vertical-align: inherit;">例外がなければ、どこにでも多くのifステートメントを記述する必要があります。</font><font style="vertical-align: inherit;">「後者が機能する場合は続行し、それ以外の場合はエラーを処理する」という原則に従って、常にコードを記述します。</font><font style="vertical-align: inherit;">そして、コード全体でこれらのエラーを処理する必要があります。</font><font style="vertical-align: inherit;">これは何が起こっているのか理解するのを難しくします。</font><font style="vertical-align: inherit;">例外を使用すると、問題が発生した場合にプログラムを終了できます。</font><font style="vertical-align: inherit;">したがって、これらすべてのifを記述する必要はありません。</font><font style="vertical-align: inherit;">実行の成功パスに集中できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、障害が1つあります。例外はあまりにも隠されています。例外をスローすると、エラー処理の問題が他の関数に転送されます。最高レベルにポップアップする例外を無視するのは簡単です。 Eitherの優れた点は、メインプログラムストリームからジャンプできることです。そしてそれは正直に働きます。あなたは右か左のどちらかを取得します。左オプションが不可能なふりをすることはできません。最後に、のような呼び出しで値を引き出す必要があります</font></font><code>either()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある種の複雑さのように聞こえることは知っています。しかし、私たちが作成したコードを見てください（クラスではなく、それらを使用する関数）。例外処理コードはあまりありません。これは、コールの例外を除いて、ほとんど存在しない</font></font><code>either()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">終わり</font></font><code>csvToMessages()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>processRow()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それがポイントです。</font><font style="vertical-align: inherit;">Eitherを使用すると、誤って忘れることができないクリーンなエラー処理を行うことができます。</font><font style="vertical-align: inherit;">Eitherを使用しない場合は、コード全体にスタンプを付け、どこにでもパディングを追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、決して使用してはならないという意味ではありません</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">時にはそれは適切なツールであり、それは正常です。</font><font style="vertical-align: inherit;">しかし、これは唯一のツールではありません。</font><font style="vertical-align: inherit;">どちらも利用できないいくつかの利点を提供します</font></font><code>try...catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">だからこのモナドにチャンスを与える。</font><font style="vertical-align: inherit;">最初は難しいと思っても、きっと気に入ると思います。</font><font style="vertical-align: inherit;">この記事の実装は使用しないでください。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crocks</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sanctuary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folktale</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの有名なライブラリをお試しください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼らはより良いサービスを提供しています。</font><font style="vertical-align: inherit;">そして、ここでは、簡単にするために何かを逃しました。</font></font><br>
<br>
<blockquote><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加のリソース</font></font></h1><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フリスビー教授</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">最も適切な関数型プログラミングガイド」</font></a><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brian Lonsdorf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（et al。）</font></font><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファンタジーランド仕様</font></font></a><br>
</li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptのモナドの実践入門：どちらか</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヤクブStroevski</font></font></a><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazingly Mysterious JavaScript：Monad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your humble servant</font></font></a></li>
</ul></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457086/index.html">「Swift」と「iOS」/「macOS」の世界における建築パターン「ビルダー」</a></li>
<li><a href="../ja457090/index.html">安全ベビーベッド：JWT</a></li>
<li><a href="../ja457092/index.html">MITER ATT＆CKを勉強しています。モバイルマトリックス：デバイスアクセス。パート5</a></li>
<li><a href="../ja457094/index.html">キューブを操作するときにフィルターを簡単に設定できるExcelアドイン（VBA）</a></li>
<li><a href="../ja457096/index.html">いくつかのアナリストに手を貸します：典型的な銀行業務の自動化のためのAPI Livy</a></li>
<li><a href="../ja457100/index.html">AWS Lambda-理論、知人</a></li>
<li><a href="../ja457102/index.html">QVDファイル-内容、パート3</a></li>
<li><a href="../ja457106/index.html">米国のロボコール戦争-勝者とその理由</a></li>
<li><a href="../ja457108/index.html">WWDC19：XCTestのテスト計画の開始</a></li>
<li><a href="../ja457110/index.html">トレイトを使用したC ++およびモックインジェクションパターンの単体テスト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>