<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüé® üõ£Ô∏è üê∞ Une architecture propre vue par un d√©veloppeur Python üë∞üèª ü§∑üèø üë®‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="salut! Je m'appelle Eugene, je suis d√©veloppeur Python. Au cours de la derni√®re ann√©e et demie, notre √©quipe a commenc√© √† appliquer activement les pri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Une architecture propre vue par un d√©veloppeur Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/494370/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salut! Je m'appelle Eugene, je suis d√©veloppeur Python. Au cours de la derni√®re ann√©e et demie, notre √©quipe a commenc√© √† appliquer activement les principes de l'architecture propre, en s'√©loignant du mod√®le MVC classique. Et aujourd'hui, je parlerai de la fa√ßon dont nous en sommes arriv√©s l√†, de ce que cela nous donne et pourquoi le transfert direct d'approches d'autres PL n'est pas toujours une bonne solution.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/hs/tl/t_hstlzmkevavrg4y8tazjdfu4c.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python est mon principal outil de d√©veloppement depuis plus de sept ans maintenant. Quand ils me demandent ce que j'aime le plus chez lui, je r√©ponds que c'est son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excellente lisibilit√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La premi√®re connaissance a commenc√© par la lecture du livre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Programmer un esprit collectif¬ª</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je m'int√©ressais aux algorithmes qui y sont d√©crits, mais tous les exemples √©taient dans un langage qui ne m'√©tait pas encore familier √† l'√©poque. Ce n'√©tait pas habituel (Python n'√©tait pas encore courant dans l'apprentissage automatique), les listes √©taient souvent √©crites en pseudo-code ou en utilisant des diagrammes. Mais apr√®s une br√®ve introduction √† la langue, j'ai appr√©ci√© sa concision: tout √©tait </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facile et clair, rien de superflu et de distrayant, seulement l'essence m√™me du processus d√©crit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le principal m√©rite de cela est la conception √©tonnante de la langue, le sucre syntaxique tr√®s intuitif. </font><font style="vertical-align: inherit;">Cette expressivit√© a toujours √©t√© appr√©ci√©e dans la communaut√©. </font><font style="vertical-align: inherit;">Qu'est-ce que ¬´ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importer √ßa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª, n√©cessairement pr√©sent sur les premi√®res pages de tout manuel: il ressemble √† un surveillant invisible, √©value constamment vos actions. </font><font style="vertical-align: inherit;">Sur les forums, il valait la peine pour un d√©butant d'utiliser </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CamelCase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le nom de la variable dans la liste, donc imm√©diatement l'angle de discussion s'est d√©plac√© vers l'idiome du code propos√© avec des r√©f√©rences √† PEP8.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La poursuite de l'√©l√©gance et le dynamisme puissant du langage ont cr√©√© de nombreuses biblioth√®ques avec une API vraiment d√©licieuse.&nbsp;</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√©anmoins, Python, bien que puissant, n'est qu'un outil qui vous permet d'√©crire du code expressif et auto-document√©, mais il </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne garantit pas cela</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pas plus que la conformit√© PEP8. </font><font style="vertical-align: inherit;">Lorsque notre boutique en ligne apparemment simple sur Django commence √† gagner de l'argent et, par cons√©quent, √† augmenter les fonctionnalit√©s, √† un moment donn√©, nous r√©alisons que ce n'est pas si simple, et m√™me effectuer des changements de base n√©cessite de plus en plus d'efforts, et plus important encore, cette tendance </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'accentue. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que s'est-il pass√© et quand tout s'est mal pass√©?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mauvais code</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mauvais code n'est pas celui qui ne suit pas PEP8 ou ne r√©pond pas aux exigences de complexit√© cyclomatique. </font><font style="vertical-align: inherit;">Un mauvais code est, tout d'abord, des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©pendances incontr√¥l√©es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui conduit au fait qu'un changement √† un endroit du programme entra√Æne des changements impr√©visibles dans d'autres parties. </font><font style="vertical-align: inherit;">Nous perdons le contr√¥le du code; l'extension des fonctionnalit√©s n√©cessite une √©tude d√©taill√©e du projet. </font><font style="vertical-align: inherit;">Un tel code perd de sa souplesse et, pour ainsi dire, r√©siste aux changements, tandis que le programme lui-m√™me devient ¬´fragile¬ª.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture √©pur√©e</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'architecture choisie de l'application devrait √©viter ce probl√®me, et nous ne sommes pas les premiers √† le rencontrer: il y a eu une discussion au sein de la communaut√© Java sur la cr√©ation d'une conception d'application optimale depuis longtemps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2000, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robert Martin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (√©galement connu sous le nom d'Oncle Bob) dans son article ¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Principles of Design and Design</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª a r√©uni cinq principes pour la conception d'applications OOP sous l'acronyme m√©morable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOLID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ces principes ont √©t√© bien re√ßus par la communaut√© et vont bien au-del√† de l'√©cosyst√®me Java. N√©anmoins, ils sont de nature tr√®s abstraite. Plus tard, il y a eu plusieurs tentatives pour d√©velopper une conception d'application g√©n√©rale bas√©e sur les principes SOLID. Ceux-ci incluent: ¬´Architecture hexagonale¬ª, ¬´Ports et adaptateurs¬ª, ¬´Architecture bulbeuse¬ª et ils ont tous beaucoup en commun, bien que diff√©rents d√©tails de mise en ≈ìuvre. Et en 2012, un article a √©t√© publi√© par le m√™me Robert Martin, o√π il a propos√© sa propre version intitul√©e ¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture propre</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c32/3a9/769/c323a9769c90f4e28a17e1d5c05ab160.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon Uncle Bob, l'architecture est avant tout ¬´ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fronti√®res et barri√®res</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª, il faut bien comprendre les besoins et limiter les interfaces logicielles afin de ne pas perdre le contr√¥le de l'application. Pour ce faire, le programme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est divis√© en couches</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En passant d'une couche √† une autre, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seules les donn√©es</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peuvent √™tre transf√©r√©es </font><font style="vertical-align: inherit;">(les structures simples et les </font><font style="vertical-align: inherit;">objets </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peuvent agir comme des donn√©es </font><font style="vertical-align: inherit;">) - c'est la r√®gle des limites. </font><font style="vertical-align: inherit;">Une autre phrase la plus fr√©quemment cit√©e selon laquelle ¬´l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application devrait crier</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª signifie que l'√©l√©ment principal de l'application n'est pas le cadre utilis√© ou la technologie de stockage de donn√©es, mais ce que cette application fait r√©ellement, quelle fonction elle remplit - la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logique m√©tier de l'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application . </font><font style="vertical-align: inherit;">Par cons√©quent, les couches n'ont pas de structure lin√©aire, mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ont une hi√©rarchie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">D'o√π deux r√®gles suppl√©mentaires:</font></font><br>
 <br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√®gle de priorit√© pour la couche int√©rieure</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - c'est la couche int√©rieure qui d√©termine l'interface par laquelle elle interagira avec le monde ext√©rieur;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√®gle de d√©pendance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Les d√©pendances doivent √™tre dirig√©es de la couche int√©rieure vers l'ext√©rieur.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La derni√®re r√®gle est assez atypique dans le monde Python. </font><font style="vertical-align: inherit;">Pour appliquer un sc√©nario de logique m√©tier complexe, vous devez toujours acc√©der √† des services externes (par exemple, une base de donn√©es), mais pour √©viter cette d√©pendance, la couche de logique m√©tier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit elle-m√™me d√©clarer l'interface</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par laquelle elle interagira avec le monde ext√©rieur. </font><font style="vertical-align: inherit;">Cette technique est appel√©e ¬´ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inversion de d√©pendance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª (la lettre D dans SOLID) et est largement utilis√©e dans les langages √† typage statique. </font><font style="vertical-align: inherit;">Selon Robert Martin, c'est le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal avantage de la POO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces trois r√®gles sont l'essence m√™me de l'architecture propre:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√®gle de passage des fronti√®res;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√®gle de d√©pendance;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√®gle de priorit√© de la couche int√©rieure.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les avantages de cette approche comprennent:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilit√© de test</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - les couches sont isol√©es, respectivement, elles peuvent √™tre test√©es sans patch de singe, vous pouvez d√©finir granulairement le rev√™tement pour diff√©rentes couches, selon le degr√© de leur importance;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilit√© de modification des r√®gles m√©tier</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car toutes sont collect√©es en un seul endroit, ne sont pas r√©parties sur le projet et ne sont pas m√©lang√©es avec du code de bas niveau;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ind√©pendance vis-√†-vis des agents externes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la pr√©sence d'abstractions entre la logique m√©tier et le monde ext√©rieur permet dans certains cas de changer de sources externes sans affecter les couches internes. </font><font style="vertical-align: inherit;">Cela fonctionne si vous n'avez pas li√© la logique m√©tier aux fonctionnalit√©s sp√©cifiques des agents externes, par exemple, les transactions de base de donn√©es;</font></font></li>
<li><b> </b>,   ,     ,      .</li>
</ul><br>
<blockquote>     ,    .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>.     ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Clean Architecture</a>¬ª.<br>
</blockquote><br>
<h2>  Python</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'une th√©orie, des exemples d'application pratique peuvent √™tre trouv√©s dans l'article original, les rapports et le livre de Robert Martin. Ils s'appuient sur plusieurs mod√®les de conception courants du monde Java: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adaptateur, passerelle, interacteur, Fasade, r√©f√©rentiel, DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, qu'en est-il de Python? Comme je l'ai dit, le laconicisme est valoris√© dans la communaut√© Python, ce qui a pris racine chez les autres est loin d'√™tre ancr√© chez nous. La premi√®re fois que j'ai abord√© ce sujet il y a trois ans, il n'y avait pas beaucoup de documents sur le th√®me de l'utilisation de l'architecture propre en Python, mais le premier lien dans Google √©tait </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leonardo Giordani: l'auteur d√©crit en d√©tail le processus de cr√©ation d'une API pour un site de recherche de propri√©t√© en utilisant la m√©thode TDD, appliquer une architecture propre.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, malgr√© l'explication scrupuleuse et en suivant tous les canons de l'oncle Bob, cet exemple est plut√¥t </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effrayant</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'API du projet consiste en une m√©thode: obtenir une liste avec un filtre disponible. Je pense que m√™me pour un d√©veloppeur novice, le code d'un tel projet ne prendra pas plus de 15 lignes. Mais dans ce cas, il a pris six paquets. Vous pouvez vous r√©f√©rer √† une mise en page pas enti√®rement r√©ussie, et c'est vrai, mais en tout cas, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est difficile pour quelqu'un d'expliquer l'efficacit√© de cette approche</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en se r√©f√©rant √† ce projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un probl√®me plus grave, si vous ne lisez pas l'article et que vous commencez imm√©diatement √† √©tudier le projet, il est assez difficile √† comprendre. Consid√©rez la mise en ≈ìuvre de la logique m√©tier:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> rentomatic.response_objects <span class="hljs-keyword">import</span> response_objects <span class="hljs-keyword">as</span> res<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>(<span class="hljs-params">object</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self, request_object</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_object:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_from_invalid_request_object(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_object)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.list(filters=request_object.filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseSuccess(rooms)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_system_error(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{}: {}"</span>.format(exc.__class__.__name__, <span class="hljs-string">"{}"</span>.format(exc)))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La classe RoomListUseCase qui impl√©mente la logique m√©tier (pas tr√®s similaire √† la logique m√©tier, non?) Du projet est initialis√© par l'objet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais qu'est-ce qu'un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Bien s√ªr, du contexte, on peut comprendre que les </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prises en </font><font style="vertical-align: inherit;">pension</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> met en </font><font style="vertical-align: inherit;">≈ìuvre le mod√®le du </font><font style="vertical-align: inherit;">r√©f√©rentiel pour acc√©der aux </font><font style="vertical-align: inherit;">donn√©es, si nous regardons le corps de RoomListUseCase, nous comprenons qu'il doit avoir une m√©thode de liste, dont </font><font style="vertical-align: inherit;">l'entr√©e est une liste de filtres, ce </font><font style="vertical-align: inherit;">qui est clair √† la sortie, vous devez regarder dans ResponseSuccess. Et si le sc√©nario est plus complexe, avec plusieurs acc√®s √† la source de donn√©es? Il s'av√®re que vous comprenez ce qu'est le d√©p√¥t, vous ne pouvez vous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©f√©rer qu'√† la mise en ≈ìuvre</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais o√π est-elle situ√©e? Il se trouve dans un module s√©par√©, qui n'est en aucun cas associ√© √† RoomListUseCase. Ainsi, pour comprendre ce qui se passe, vous devez remonter au niveau sup√©rieur (le niveau du framework) et voir ce qui alimente l'entr√©e de la classe lors de la cr√©ation de l'objet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pourriez penser que j'√©num√®re les inconv√©nients de la frappe dynamique, mais ce n'est pas enti√®rement vrai. C'est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un typage dynamique qui vous permet d'√©crire du code expressif et compact</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'analogie avec les microservices vient √† l'esprit, lorsque nous d√©coupons un monolithe en microservices, la conception prend une rigidit√© suppl√©mentaire, car tout peut √™tre fait √† l'int√©rieur du microservice (PL, frameworks, architecture), mais il doit respecter l'interface d√©clar√©e. Alors ici: quand nous avons divis√© notre projet en couches,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les relations entre les couches doivent √™tre coh√©rentes avec le contrat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tandis qu'√† l'int√©rieur de la couche, le contrat est facultatif. Sinon, vous devez garder un contexte assez large dans votre t√™te. Rappelez-vous, j'ai dit que le probl√®me avec le mauvais code √©tait les d√©pendances, et donc, sans interface explicite, nous glissons √† nouveau l√† o√π nous voulions nous √©loigner - √† l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">absence de relations de cause √† effet explicites</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote>    <i>repo</i>     RoomListUseCase,    execute ‚Äî <b>   </b>.       -    ,   ,     .     -        . ,   ,    ,  <i>repo</i>   .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, √† cette √©poque, j'ai abandonn√© l'architecture propre dans un nouveau projet, en appliquant √† nouveau le MVC classique. Mais, apr√®s avoir rempli le prochain lot de c√¥nes, il est revenu sur cette id√©e un an plus tard, quand, enfin, nous avons commenc√© √† lancer des services en Python 3.5+. Comme vous le savez, il a apport√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des annotations de type</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des classes de donn√©es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Deux puissants outils de description d'interface. Sur la base de ceux-ci, j'ai esquiss√© un prototype du service, et le r√©sultat √©tait d√©j√† bien meilleur: les couches ont cess√© de s'effriter, malgr√© le fait qu'il y avait encore beaucoup de code, surtout lors de l'int√©gration avec le framework. Mais cela a suffi pour commencer √† appliquer cette approche dans les petits projets. Peu √† peu, des cadres ont commenc√© √† appara√Ætre qui se concentraient sur l'utilisation maximale des annotations de type: apistar (maintenant starlette), fondu. Le bundle pydantic / FastAPI est maintenant courant et l'int√©gration avec de tels frameworks est devenue beaucoup plus facile. Voici √† quoi ressemblerait l'exemple ci-dessus de restomatic / services.py:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, List
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span>(<span class="hljs-params">BaseModel</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;code: str<font></font>
&nbsp;&nbsp;&nbsp;size: int<font></font>
&nbsp;&nbsp;&nbsp;price: int<font></font>
&nbsp;&nbsp;&nbsp;latitude: float<font></font>
&nbsp;&nbsp;&nbsp;longitude: float<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomFilter</span>(<span class="hljs-params">BaseModel</span>):</span>
&nbsp;&nbsp;&nbsp;code: Optional[str] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_min: Optional[int] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_max: Optional[int] = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomStorage</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span> ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo: RoomStorage</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoomListUseCase - une classe qui impl√©mente la logique m√©tier du projet. Vous ne devez pas faire attention au fait que tout ce que fait la m√©thode show_rooms est d'appeler RoomStorage (je n'ai pas trouv√© cet exemple). Dans la vie r√©elle, il peut √©galement y avoir un calcul de remise, un classement d'une liste bas√©e sur des publicit√©s, etc. Cependant, le module est autosuffisant. Si nous voulons utiliser ce sc√©nario dans un autre projet, nous devrons impl√©menter RoomStorage. Et ce qui est n√©cessaire pour cela est clairement visible depuis le module. Contrairement √† l'exemple pr√©c√©dent, une telle couche </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est autosuffisante</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et, lors d'une modification, il n'est pas n√©cessaire de garder √† l'esprit tout le contexte. A partir de d√©pendances non syst√©miques uniquement pydantiques, eh bien, cela deviendra clair dans le plug-in du framework. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pas de d√©pendances</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une autre fa√ßon d'am√©liorer la lisibilit√© du code, et non un contexte suppl√©mentaire, m√™me un d√©veloppeur novice pourra comprendre ce que fait ce module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un sc√©nario de logique m√©tier ne doit pas n√©cessairement √™tre une classe; voici un exemple d'un sc√©nario similaire sous la forme d'une fonction:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rool_list_use_case</span>(<span class="hljs-params">filters: RoomFilter, repo: RoomStorage</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;rooms = repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici le lien avec le framework:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> rentomatic <span class="hljs-keyword">import</span> services, adapters<font></font>
app = FastAPI()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_use_case</span>() -&gt; services.RoomListUseCase:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> services.RoomListUseCase(adapters.MemoryStorage())<font></font>
<font></font>
<span class="hljs-meta">@app.post("/rooms", response_model=List[services.Room])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rooms</span>(<span class="hljs-params">filters: services.RoomFilter, use_case=Depends(<span class="hljs-params">get_use_case</span>)</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> use_case.show_rooms(filters)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'aide de la fonction get_use_case, FastAPI impl√©mente le mod√®le d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">injection de d√©pendance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous n'avons pas √† nous soucier de la s√©rialisation des donn√©es, tout le travail est effectu√© par FastAPI en collaboration avec pydantic. Malheureusement, les </font><font style="vertical-align: inherit;">donn√©es ne sont pas toujours format logique m√©tier adapt√© √† la </font><font style="vertical-align: inherit;">diffusion en </font><font style="vertical-align: inherit;">direct dans le restaurant &lt;et, au contraire, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la logique m√©tier ne sait pas o√π les donn√©es se sont - avec des </font><font style="vertical-align: inherit;">barres obliques, corps de la </font><font style="vertical-align: inherit;">demande, les </font><font style="vertical-align: inherit;">cookies, etc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans ce cas, le corps de la fonction room aura une certaine conversion des donn√©es d'entr√©e et de sortie, mais dans la plupart des cas, si nous travaillons avec l'API, une telle fonction proxy simple suffit.&nbsp;</font></font><br>
<br>
<blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>   , ,    ,    RoomStorage.  ,     15 ,     ,      ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas intentionnellement s√©par√© la couche de la logique m√©tier, comme le sugg√®re le mod√®le canonique de l'architecture propre. </font><font style="vertical-align: inherit;">La classe Room √©tait cens√©e se trouver dans la couche de r√©gion de domaine d'entit√© repr√©sentant la r√©gion de domaine, mais pour cet exemple, cela n'est pas n√©cessaire. </font><font style="vertical-align: inherit;">En combinant les couches Entity et UseCase, le projet ne cesse pas d'√™tre une impl√©mentation de Clean Architecture. </font><font style="vertical-align: inherit;">Robert Martin lui-m√™me a d√©clar√© √† plusieurs reprises que le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre de couches peut varier √† la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fois vers le haut et vers le bas. </font><font style="vertical-align: inherit;">Dans le m√™me temps, le projet r√©pond aux principaux crit√®res de l'architecture propre:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√®gle du</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> franchissement des fronti√®res: les mod√®les pydantiques, qui sont essentiellement des DTO, </font><b><font style="vertical-align: inherit;">traversent les fronti√®res</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√®gle de d√©pendance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : la couche de logique m√©tier est ind√©pendante des autres couches;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√®gle de priorit√© pour la couche interne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : c'est la couche de logique m√©tier qui d√©finit l'interface (RoomStorage), √† ‚Äã‚Äãtravers laquelle la logique m√©tier interagit avec le monde ext√©rieur.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, plusieurs projets de notre √©quipe, mis en ≈ìuvre selon l'approche d√©crite, travaillent sur la prod. </font><font style="vertical-align: inherit;">J'essaie d'organiser m√™me les plus petits services de cette fa√ßon. </font><font style="vertical-align: inherit;">Il s'entra√Æne bien - des questions auxquelles je n'avais pas pens√© avant de se poser. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, quelle est la logique m√©tier ici? </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est loin d'√™tre toujours √©vident, par exemple, si vous √©crivez une sorte de proxy. </font><font style="vertical-align: inherit;">Un autre point important est d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apprendre √† penser diff√©remment.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lorsque nous obtenons une t√¢che, nous commen√ßons g√©n√©ralement √† penser aux cadres, aux services utilis√©s, √† savoir s'il y aura un besoin d'une file d'attente o√π il est pr√©f√©rable de stocker ces donn√©es, qui peuvent √™tre mises en cache. Dans l'approche dictant l'architecture propre, nous devons d'abord mettre en ≈ìuvre la logique m√©tier et ensuite passer √† la mise en ≈ìuvre de l'interaction avec l'infrastructure, car, selon Robert Martin, la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√¢che principale de l'architecture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est de retarder le moment o√π la connexion avec tout La couche infrastructure fera partie int√©grante de votre application.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, je vois une perspective favorable √† l'utilisation d'une architecture propre en Python. </font><font style="vertical-align: inherit;">Mais la forme sera tr√®s probablement tr√®s diff√©rente de la fa√ßon dont elle est accept√©e dans d'autres PL. </font><font style="vertical-align: inherit;">Au cours des derni√®res ann√©es, j'ai vu une augmentation significative de l'int√©r√™t pour le sujet de l'architecture dans la communaut√©. </font><font style="vertical-align: inherit;">Ainsi, lors du dernier PyCon, il y avait plusieurs rapports sur l'utilisation du DDD, et les gars des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laboratoires secs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devraient √™tre not√©s s√©par√©ment </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans notre entreprise, de nombreuses √©quipes mettent d√©j√† en ≈ìuvre l'approche d√©crite √† un degr√© ou √† un autre. </font><font style="vertical-align: inherit;">Nous faisons tous la m√™me chose, nous avons grandi, nos projets ont grandi, la communaut√© Python doit travailler avec cela, d√©finir le style commun et le langage qui, par exemple, est devenu une fois pour tout Django.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494350/index.html">Sommaire des √©v√©nements en ligne de mars et avril</a></li>
<li><a href="../fr494354/index.html">Connaissance et condition</a></li>
<li><a href="../fr494356/index.html">Tutoriel Linux Newbie Aircrack-ng</a></li>
<li><a href="../fr494364/index.html">GDPR: Consentement au traitement des donn√©es personnelles</a></li>
<li><a href="../fr494366/index.html">Mitaps en ligne pour toute la semaine, √† partir du 27 mars (pour le dos, mobile, QA, PM et tout)</a></li>
<li><a href="../fr494372/index.html">Logiciel de v√©rification panrusse - une vue int√©rieure</a></li>
<li><a href="../fr494374/index.html">Bus √©lectriques et leurs batteries: qu'est-ce que le titanate de lithium? (Partie 1)</a></li>
<li><a href="../fr494376/index.html">Tampon de profondeur hi√©rarchique</a></li>
<li><a href="../fr494380/index.html">Introduction √† la gestion strat√©gique des produits</a></li>
<li><a href="../fr494384/index.html">Enqu√™te fonctionnelle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>