<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∏ üèæ üçó Mediensystem f√ºr Toyota Prius (Teil 2) ‚öõÔ∏è ‚ô®Ô∏è üõï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fortsetzung des Projekts zum Ersatz des Toyota Prius Mediensystems. 
 
 In diesem Artikel - PHY, Transport und Paketzustellung an das Host-Ger√§t, das ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mediensystem f√ºr Toyota Prius (Teil 2)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493670/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortsetzung des Projekts zum Ersatz des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toyota Prius Mediensystems. </font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel - PHY, Transport und Paketzustellung an das Host-Ger√§t, das schlie√ülich auf dem echten nativen Kopf des Prius √ºberpr√ºft werden konnte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schnell wirkt sich das M√§rchen aus, aber nicht schnell ist die Sache erledigt. </font><font style="vertical-align: inherit;">Heute setze ich das langwierige Projekt zur Neugestaltung des Mediensystems in Prius fort, das vor zwei Jahren begonnen hat.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historisches Offtopic</font></font></b>
                        <div class="spoiler_text">   ‚Äî  USB-AVC    ,        .           ,     , ..       ++ ‚Äî     ,  . <br>
<br>
  ,    ,        ,     ,           . <br>
<br>
,      ,     ,   PHY- . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also von Anfang an. </font><font style="vertical-align: inherit;">Graben um im Internet f√ºr Adapter AVC-LAN, sah ich sehr oft L√∂sungen √§hnlich wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diese</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Und in der Diskussion schl√ºpfen solche Kommentare oft durch:</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ehrlich gesagt funktioniert es nicht sehr gut, oder besser gesagt, es funktioniert nicht mit allen K√∂pfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend der Reifen auf einem alten Radio mit einem 99 Jahre alten Spacio perfekt lesbar ist.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich war anfangs grunds√§tzlich dagegen, etwas zu tun, und L√∂sungen mit struktureller Instabilit√§t passen nicht zu mir. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden den Weg des Reverse Engineering des Reifens wiederholen. Gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst verbinden wir uns mit einem Live-Auto mit dem Bus und entfernen die Wellenform: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/cz/uf/ccczuftggnmbqqtebaewgwcx_3e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Anfang des Pakets. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ac/v-/wu/acv-wuwaaoywpav08fjqekdyaq8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bits sind irgendwo in der Mitte, gr√∂√üer. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/l3/cy/ba/l3cyba6lailk2fcxp9274-eltlk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etwas sehr √§hnliches wie ACK.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ein bisschen mehr √ºber diesen seltsamen Schritt - unten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe bereits Screenshots der Wellenformen aus den gespeicherten Daten gemacht, w√§hrend ich sie aufgenommen habe, habe ich nicht sofort auf den Spannungsbereich geachtet, in dem ich die Daten aufgenommen habe. Und als er es zeichnete, musste er wieder ins Auto steigen, um sicherzugehen, dass er nicht aus dem Kopf √ºberlebt hatte. Ja, die Spannweite des Differentialbusses betr√§gt nur 200 mV (!!!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als n√§chstes gehen wir zum Datenblatt, das von den Kollegen ST485 verwendet wird, und sehen dort Folgendes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ui/n8/dmuin85kauk3hwji9d6w4d2dx5w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wurde tats√§chlich die Wurzel aller Probleme gefunden, weshalb wir mit Widerst√§nden spielen und zu den Kolophoniumg√∂ttern beten m√ºssen, damit der Konverter auf einer bestimmten Maschine arbeitet. Arbeiten in der N√§he von Schwellen ist b√∂se. Noch interessanter ist jedoch, dass f√ºr AVC-LAN, das in seiner Physik ein Klon eines IE-Busses von NEC ist, gem√§√ü seiner Spezifikation (die Verbindung wird etwas weiter entfernt sein) der aktive Zustand eine Spannung √ºber 120 mV ist, w√§hrend ST485 das Recht hat, dies zu ber√ºcksichtigen alles weniger als 200 mV ist Null. Das hei√üt, wenn der ST485 aufgrund von Herstellungsabweichungen einen geringf√ºgig niedrigeren Schwellenwert aufweist und auf dem Bus f√ºr einen geringf√ºgig √ºber der Norm liegenden Rand angezeigt wird (bis zu 6 Volt sind zul√§ssig), kann der ST485 nat√ºrlich ein solches Signal empfangen. Und diese Herstellungsungenauigkeiten sind das einzige, was Ger√§te mit ST485 </font><b><font style="vertical-align: inherit;">manchmal</font></b><font style="vertical-align: inherit;"> in die Zusammensetzung zwingt</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeit. Nat√ºrlich werden wir dieses Gl√ºck nicht in die Entwicklung bringen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite verf√ºgbare L√∂sung, die auf demselben ST485 und einem Operationsverst√§rker basiert, hat mir die F√ºlle an Komponenten nicht gefallen. Nun, schlie√ülich leben wir im 21. Jahrhundert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√∂sung: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt spezielle Konverter f√ºr AVC-LAN. Aber ich konnte sie nicht zu einem erschwinglichen Preis f√ºr dieses Ger√§t bekommen. Das br√ºderliche China kam erneut zur Rettung, wo der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HA12240FP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entdeckt wurde </font><font style="vertical-align: inherit;">, der eine Spannungsdifferenz f√ºr die Wahrnehmung eines Protokolls aufweist. "1" pro Datenblatt ist 80..110 mV. Dadurch kann unser Reifen ein aktives Niveau mit einem fast doppelten Spielraum einstellen. Arrangiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir geb√§ren das Schema auf dem STM32F103, das im ersten Teil erw√§hnt wurde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ds/mj/ey/dsmjeylhhd1tldlydzj7kdf8yky.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Schema wurde in Eile geboren, es enth√§lt einen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehler</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Busfahrer m√ºssen mit 5 V versorgt werden. Wenn ja, wie im Diagramm, steigt ihre Differenz. Schwellenwert, und nicht alle Pakete werden akzeptiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist einfach f√ºr den Primitivismus, denke ich, braucht keine Beschreibung. Au√üer vielleicht der Tatsache, dass die Auswahl der Beine f√ºr RX1 / 2 nicht zuf√§llig ist und die erste Version der Schaltung eine ‚ÄûDateiverfeinerung‚Äú erfordert, um Signale an die Erfassungs- / Vergleichseing√§nge zu senden, da ich damit die Pulsl√§nge messen m√∂chte. Alternative L√∂sungen - Abfragen und Unterbrechen bei Status√§nderungen verlieren an Genauigkeit und Komplexit√§t der Softwareimplementierung. Plus - Ich m√∂chte mindestens zwei Zeilen parallel erhalten (es gibt drei im Kopf), und wenn die Fronten auf zwei √ºbereinstimmen, k√∂nnen Sie sich von der Idee einer akzeptablen Genauigkeit verabschieden, wenn Sie keine Erfassung / keinen Vergleich verwenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere Analyse der Daten in dem Paket ist gut geschrieben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Da die Links jedoch inkonsistent sind, werde ich hier kurz wiederholen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Differentialbus, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schreiben sie √ºber die Interpretation der Ebenen des Logs. </font><font style="vertical-align: inherit;">"1" bei &lt;20 mV, log. </font><font style="vertical-align: inherit;">"0" -&gt; 110 mV.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Bitl√§nge betr√§gt 40 ¬µs, die ersten 20 ¬µs sind immer "0", die letzten 7 ¬µs sind immer "1", in der Mitte steht der Bitwert. </font></font><br>
<img src="https://habrastorage.org/webt/vv/6_/_8/vv6__8pbidlx43eqnvjbupnee3g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die Ampel:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/u2/k-/i1u2k-ji3f5mckou9r7mut6nzkm.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startbit - l√§nger als 180 Œºs </font></font></li>
<li>        (ACK).    ¬´¬ª,    - :<br>
<br>
<img src="https://habrastorage.org/webt/pg/sl/hq/pgslhqq84ha2ytwegw9njtlq6we.png"><br>
<br>
  ACK-    ,    Dallas 1-wire,      ,  , , .    ,   . 1     ,      ¬´0¬ª ( ,    ),     .2  ,      ,    ,   .  .3 ,        (1),     ,           ,    7  ,    . ¬´1¬ª. <br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun ... wir haben die physische Ebene herausgefunden, die Schaltung gezeichnet und das Board auseinander genommen. Es stellte sich </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_d/4y/gj/_d4ygj2rf315jb9yqodcdfh7dda.png"><br>
<br>
<img src="https://habrastorage.org/webt/fu/om/rm/fuomrmmvbepdwmvpiqrmh1efezm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ungef√§hr </font><font style="vertical-align: inherit;">so heraus: Die </font><font style="vertical-align: inherit;">Leiterplatte kam etwas erfolglos heraus und nicht, weil der QR-Code beim Siebdruck nicht funktionierte. Es gibt einen Fehler in der Schaltung (in der Abbildung oben habe ich ihn bereits korrigiert) bez√ºglich der Auswahl der Beine f√ºr den RX, und drei Leitungstreiber sind geschieden. Beim Schreiben und Debuggen des Programms wurde mir klar, dass es gut ist, wenn Sie mindestens zwei kontinuierlich ausf√ºhren k√∂nnen. Ja, und mehr ist nicht erforderlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun ... das Ger√§t erwies sich als einfach und effektiv, w√§hrend das konstruktive Problem mit der Nicht√ºbereinstimmung der Ebenen gel√∂st wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weiter im Programm:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a>   .   ,        .  : *         USB ‚Äî     ,    ,     ¬´¬ª  .    . *      ,             8,  6-    ,   4.4   .       ,    ,       . </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android-Monitor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr die vollst√§ndige Umkehrung der Buslogik. </font><font style="vertical-align: inherit;">Wenn jemand stark in Android und Kotlin ist, bin ich dankbar f√ºr die Gelegenheit, sich zu beraten. </font><font style="vertical-align: inherit;">Dies sind sch√ºchterne Versuche, alles auf einmal zu meistern. Betreten Sie das Repository daher nicht ohne neuen Durchgang als Referenz :)</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: feste zeitliche </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e Daten anstelle Mikrosekunden waren ms.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493660/index.html">CSS: vollst√§ndige calc () - Funktionsanleitung</a></li>
<li><a href="../de493662/index.html">Weltraummacht</a></li>
<li><a href="../de493664/index.html">Analyse der COVID-19-Ausbreitungsrate und Ver√∂ffentlichung der Ergebnisse auf dstack.ai</a></li>
<li><a href="../de493666/index.html">Wie wir k√ºnstliche Intelligenz lehrten, um Unterst√ºtzungsfragen zu beantworten. Erleben Sie Yandex.Taxi</a></li>
<li><a href="../de493668/index.html">Wie ich den n√§chsten Site Builder erstellt habe</a></li>
<li><a href="../de493674/index.html">Video Player √úbersicht f√ºr das Web</a></li>
<li><a href="../de493680/index.html">10 Tricks, wie man Online-Konfu nicht zusammenf√ºhrt</a></li>
<li><a href="../de493686/index.html">Der mysteri√∂se Ursprung des Brettspiels √ºber das Hacken von Codes Mastermind</a></li>
<li><a href="../de493688/index.html">Wir machen Microsoft Teams kostenlos - bleiben Sie in dieser schwierigen Zeit mit Kollegen in Kontakt</a></li>
<li><a href="../de493690/index.html">20 Tipps f√ºr den Piloten DJI Mavic Mini zum Schutz Ihrer Drohne vor Absturz und Verlust</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>