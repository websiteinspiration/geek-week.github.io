<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏽 🏒 ⛹🏿 Controle de cabeçalho HTTP da política de recursos e navegador da Web 🗣️ 🏽 🚬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe uma técnica completamente incomparável que permite manter o desempenho de um projeto da Web sob controle. Consiste em introduzir mecanismos no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Controle de cabeçalho HTTP da política de recursos e navegador da Web</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/490624/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe uma técnica completamente incomparável que permite manter o desempenho de um projeto da Web sob controle. Consiste em introduzir mecanismos no processo de desenvolvimento, cujos resultados são claramente visíveis. Esses mecanismos são projetados para sempre lembrar o programador da importância do desempenho. Há algo neste contexto que eu realmente gosto. Este é o cabeçalho HTTP da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">política de recursos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Este título é um recurso relativamente novo que permite ao desenvolvedor ativar e desativar determinados recursos do navegador enquanto navega no site. </font><font style="vertical-align: inherit;">
Por exemplo, você pode dizer ao navegador que ele não deve permitir o uso da API de geolocalização passando o seguinte cabeçalho:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/_a/mh/zz/_amhzzcwmae7goctptz7hobpnwa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: geolocation 'none'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitas vantagens em </font><font style="vertical-align: inherit;">usar um cabeçalho </font><font style="vertical-align: inherit;">em termos de segurança e desempenho. </font><font style="vertical-align: inherit;">Mas agora gosto especialmente de como </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">você pode usá-lo para tornar mais visíveis os problemas de desempenho do site que geralmente são fáceis de esquecer. </font><font style="vertical-align: inherit;">Isso pode ser comparado a algo como "desempenho linting". </font><font style="vertical-align: inherit;">Em particular, estamos falando sobre identificar problemas com imagens usadas em projetos da web.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Política de imagens de grandes dimensões</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a imagem for transmitida ao navegador em um formato compatível, ela será exibida. Esse é o comportamento padrão do navegador. O navegador, tentando ajudar aqueles que estão visualizando a página, também dimensiona automaticamente essas imagens. Portanto, eles ficam bem, mesmo que sejam representados por grandes arquivos gráficos. Como resultado, se você usar imagens maiores que os tamanhos necessários para a página, isso será, à primeira vista, invisível. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Política</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diretiva</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informa ao navegador que ele não deve permitir o uso de imagens cujo tamanho exceda, por um número especificado de vezes, o tamanho de seus contêineres. </font><font style="vertical-align: inherit;">A imagem, de acordo com a restrição padrão, não pode exceder 2 vezes o contêiner. </font><font style="vertical-align: inherit;">Mas esse valor, se necessário, pode ser redefinido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se o navegador receber o próximo cabeçalho, ele não permitirá que você exiba imagens tiradas de nenhuma fonte (isso é definido graças </font></font><code>none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), cujas dimensões são mais de duas vezes o tamanho de seus contêineres (em largura ou altura).</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você precisar de mais flexibilidade, poderá informar ao navegador que ele não deve exibir imagens que sejam três vezes maiores que os contêineres:</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images *(3) 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, se a imagem não corresponder aos limites especificados, um stub será exibido em vez da imagem e uma mensagem de erro será enviada ao console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c98/1e3/169/c981e3169d9219c226c13236f198c222.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site usar a política de imagens de tamanho grande, serão enviadas imagens grandes, mas um stub será exibido e uma mensagem de erro será exibida no console</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagens não otimizadas</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro problema comum com gráficos é o uso de imagens não otimizadas. Muitas vezes, você pode encontrar imagens que não foram compactadas adequadamente. Seu tamanho, no entanto, pode ser selecionado corretamente. Portanto, para arquivos com fotos, ao capturá-las e criá-las, muitos metadados desnecessários podem ser adicionados, que geralmente permanecem nos arquivos e quando usados ​​nos navegadores. Um exemplo particularmente irritante disso são as imagens, cujos metadados contêm suas próprias miniaturas para visualização. Muitas vezes eu vi como a miniatura incorporada na imagem (cuja presença os designers e desenvolvedores nem conheciam) "pesava" mais do que a própria imagem!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre outras coisas, aqui você pode recordar a compactação de imagem usual, suportada por muitos formatos, o que permite alcançar o equilíbrio perfeito entre a qualidade da imagem e o tamanho do arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As políticas de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">imagens com perda não otimizadas</font></a><font style="vertical-align: inherit;"> e de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem perda não otimizadas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permitem que o navegador saiba que ele corresponde ao tamanho do arquivo e ao tamanho da imagem em pixels.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unoptimized-lossy-images 'none';<font></font>
Feature-Policy: unoptimized-lossless-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o número de bytes por pixel (Byte por pixel, BPP) for muito alto, o navegador exibirá um esboço em vez da imagem e uma mensagem de erro no console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/215/e57/347215e574f0574312eff1d6737b8d9e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A aplicação de políticas não otimizadas- * faz com que um stub seja exibido em vez de imagens inadequadas - assim como a política de imagens superdimensionadas, o</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nível recomendado de BPP para imagens compactadas com perda é de 0,5 e 1 para imagens compactadas sem perda. Além disso, ao analisar imagens, é permitido um pequeno desvio do tamanho total desses níveis. Agora, esse desvio para imagens compactadas com perda é de 1 Kb, para imagens compactadas sem perda - 10 Kb.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, suponha que tenhamos uma imagem JPEG de 200x200 pixels. JPEG é um formato de compactação com perda de imagem, resultando em um nível recomendado de BPP de 0,5. Ao mesmo tempo, o tamanho total da imagem pode exceder o tamanho recomendado em apenas 1 Kb. Para descobrir qual tamanho uma imagem semelhante deve se adequar a um navegador, é necessário multiplicar as dimensões dos lados da imagem em pixels entre si e pelo BPP e, em seguida, adicionar o desvio permitido ao que acontece. </font></font><br>
<br>
<code>(200 x 200 x .5) + 1024 = 21,024</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte ou </font></font><code>20.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a imagem for compactada sem perda, é permitido um desvio do tamanho “ideal” de 10 Kb, enquanto o BPP dessa imagem será 1. Caso contrário, os cálculos serão exatamente iguais: </font></font><br>
<br>
<code>(200 x 200 x 1) + 10,240 = 50,240</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte ou </font></font><code>49.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É provável que o tamanho do desvio permitido mude no futuro. </font><font style="vertical-align: inherit;">De fato, embora o Blink, por padrão, use esse indicador para imagens compactadas sem perda, iguais a 10 Kb, já estão em andamento experimentos com uma política </font></font><code>unoptimized-lossless-images-strict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que altera esse indicador, baixando-o para o nível de 1 Kb.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mídia não especificada</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O novo é o velho bem esquecido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante muito tempo, o uso de atributos de imagem </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi mais ou menos comum. Sem esses atributos, o navegador não sabia quanto espaço a imagem deveria ocupar até o momento em que a imagem foi carregada. Isso levou a mudanças nos layouts de página. A página foi exibida e, depois que a imagem chegou, seu conteúdo mudou. O navegador mais uma vez teve que recontar o layout para alocar espaço para a imagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando chegou a hora dos layouts em que os tamanhos das imagens precisavam ser redimensionados de maneira flexível usando CSS, a presença ou ausência desses atributos não exercia mais um papel especial. Como resultado, muitos simplesmente pararam de usar esses atributos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas graças ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabalho recente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iniciado por Jen Simmons, Firefox e Chrome podem calcular a proporção das imagens com base em seus atributos </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Quando essa abordagem é combinada com os estilos aplicados às imagens, os navegadores podem reservar espaço para as imagens durante a passagem inicial do layout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A política de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mídia sem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho informa ao navegador que todos os elementos de mídia devem ter atributos que especificam os tamanhos desses elementos. Se não houver tais atributos, o navegador deverá usar os valores padrão. Tudo, de fato, é um pouco mais complicado, mas a conclusão é que, se a imagem não tiver os atributos apropriados, o navegador usará o valor padrão de </font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixel.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unsized-media 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando essa política é aplicada, as imagens serão exibidas, mas se o tamanho não for especificado em HTML, o desenvolvedor notará rapidamente que as imagens são exibidas no tamanho padrão. E, como sempre, uma mensagem de erro será enviada ao console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4b/b8a/4c5/a4bb8a4c52a7267ef162a8a8244c0f9a.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A aplicação da política de mídia sem tamanho leva ao fato de que imagens e vídeos sem os atributos de altura e largura são exibidos, mas o navegador define seus tamanhos para 300 x 150 pixels.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Provavelmente, vale a pena mencionar um recurso que a princípio me pareceu incomum. </font><font style="vertical-align: inherit;">Ela se mostra ao compartilhar políticas</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nesta situação, não se deve surpreender com a aparência de mais do que antes, o número de mensagens sobre imagens muito grandes. </font><font style="vertical-align: inherit;">O fato é que, devido à aplicação da política, o</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navegador redimensiona imagens que não possuem atributos</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">até</font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixels. </font><font style="vertical-align: inherit;">Após o qual é esse tamanho que o navegador usa como ponto de referência para determinar se a imagem corresponde ao seu contêiner.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atrair atenção para problemas menos visíveis</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas políticas relacionadas à imagem, gosto do fato de que elas, no processo de desenvolvimento de projetos, tornam possível tornar visível o que geralmente está oculto. Como resultado, o desenvolvedor descobre que não cuidou de otimizar as imagens ou que esqueceu de definir seus atributos </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Todos esses erros são refletidos imediatamente na aparência das páginas. De fato, a principal vantagem do uso das políticas acima é que elas permitem que o desenvolvedor descubra rapidamente os problemas com as imagens. Enquanto política</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode levar a uma diminuição no número de situações nas quais ocorrem “trocas” de layouts de página; o uso de outras políticas não impede o carregamento de imagens inadequadas. Como resultado, o único ponto forte da aplicação dessas políticas é que elas chamam a atenção dos desenvolvedores para os problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem várias outras políticas que podem ser úteis em termos de análise de páginas quanto ao impacto de algo em seu desempenho. É aqui que políticas como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script de sincronização</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vêm à mente </font><font style="vertical-align: inherit;">(essa política bloqueia a execução de scripts síncronos), </font></font><code>sync-xhr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloqueia solicitações síncronas de AJAX) e </font></font><code>document-write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloqueia chamadas </font></font><code>document.write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas políticas são ótimas ferramentas para controlar certos aspectos do desempenho da página, mas elas próprias não fornecem aos desenvolvedores o mesmo feedback perceptível que muitas das políticas acima fornecem na forma de imagens ausentes. Obviamente, se a página possui um script síncrono, sem o qual não é exibido, isso não é fácil de perder (e essas páginas não são tão difíceis de encontrar). Mas essas políticas geralmente indicam erros na forma de mensagens exibidas no console. E, para ser sincero, suspeito que a maioria dos desenvolvedores não presta muita atenção ao console (acho que todos devemos ter mais cuidado com o console). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no entanto, podemos tornar os erros detectados pelas políticas "invisíveis" muito mais visíveis usando a API</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportingObserver</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para monitorar violações e exibir notificações relevantes na página. </font><font style="vertical-align: inherit;">Tais notificações podem ser feitas muito visíveis.</font></font><br>
<br>
<pre><code class="plaintext hljs">let reportingAlerts = document.createElement('ul');<font></font>
&nbsp;&nbsp;reportingAlerts.setAttribute('id','reportingAlerts');<font></font>
&nbsp;&nbsp;document.body.appendChild(reportingAlerts);<font></font>
<font></font>
const alertBox = document.getElementById('reportingAlerts');<font></font>
<font></font>
new ReportingObserver((reports, observer) =&gt; {<font></font>
&nbsp;&nbsp;let fragment = document.createDocumentFragment();<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;Object.keys(reports).forEach(function(item) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let li = document.createElement('li');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;li.textContent = reports[item].body.message + ': ' + reports[item].body.featureId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fragment.appendChild(li);<font></font>
&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;alertBox.appendChild(fragment)<font></font>
}, {types: ['feature-policy-violation'], buffered: true}).observe();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu esbocei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no CodePen </font><font style="vertical-align: inherit;">de como isso pode parecer.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/c18/c8a/2bdc18c8a9bb20db1f18a9e095be4b8e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo de como você pode exibir notificações de violações da política especificadas pelo cabeçalho da Política de Recursos. </font><font style="vertical-align: inherit;">Essas notificações são projetadas para saída no ambiente de desenvolvimento ou onde o projeto é preparado para saída para produção.</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menos uso do cabeçalho da política de recursos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O grande ponto negativo de usar o cabeçalho </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é o suporte dos navegadores. </font><font style="vertical-align: inherit;">Aparentemente, agora ele é suportado apenas por navegadores baseados em Blink (Opera, Edge, Chrome, Samsung). </font><font style="vertical-align: inherit;">Os navegadores Firefox e Safari suportam o atributo </font></font><code>allow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para itens </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas mesmo onde é </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suportado, para garantir a integridade de muitas políticas, você precisa ativar o sinalizador </font></font><code>Experimental Web Platform features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(você pode encontrá-lo no endereço </font></font><code>about:flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como uso o cabeçalho da política de recursos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquele menos o título </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mencionado acima, para mim, pessoalmente, não é um problema específico. Prefiro usar as políticas definidas por este cabeçalho como um verificador de páginas baseado em navegador. Portanto, não preciso me esforçar para aplicar </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na produção ou garantir que as políticas funcionem para todos os meus usuários. Eles são necessários apenas por mim e por aqueles que estão desenvolvendo o site. De qualquer forma, eu uso o Chrome como o navegador principal no processo de desenvolvimento. Portanto, garantir o desempenho </font></font><code>Feature-Police</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no meu ambiente de trabalho é ativar o sinalizador apropriado. Depois disso, os políticos trabalham sem nenhuma intervenção adicional da minha parte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobri que a maneira mais fácil de usar o cabeçalho é </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com uma extensão do navegador</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModHeader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta extensão permite que você defina seus próprios títulos que são passados ​​para as páginas quando são visualizados.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/ec2/33b/9c9ec233b6a3913a5e584335ac43a344.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A extensão ModHeader permite configurar as opções de cabeçalho da política de recursos. </font><font style="vertical-align: inherit;">Eles podem ser ativados e desativados, se desejado.Eu</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tenho três conjuntos de valores de cabeçalho</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que uso periodicamente:</font></font><br>
<br>
<ul>
<li><code>oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>script-sync 'none'; unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Costumo manter o primeiro ligado. É muito emocionante viajar por páginas da web às quais as políticas usadas nela se aplicam. É assustador ver quão grandes são algumas imagens. Há muitas coisas na web moderna que poderiam ser melhoradas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a política é muitas vezes desencadeada nas páginas </font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(e eu também peço por isso); portanto, seu uso durante o trabalho normal na Internet é inconveniente. É por isso que eu o destaquei em uma política separada, que eu posso ativar e desativar. O mesmo se aplica às políticas </font></font><code>sync-scripts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuja aplicação "quebra" muitos sites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas das equipes com as quais trabalhei começaram a usar as políticas que descrevi durante o desenvolvimento. </font><font style="vertical-align: inherit;">Isso permite que eles prestem atenção rapidamente a problemas anteriormente invisíveis. </font><font style="vertical-align: inherit;">Obviamente, recomendo incluir todas as políticas </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no ambiente de desenvolvimento, o que permite identificar e corrigir erros rapidamente.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumário</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que o suporte </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apareça, como resultado, não apenas no Chrome. </font><font style="vertical-align: inherit;">Embora este seja o meu navegador principal, também tenho que usar outros navegadores. </font><font style="vertical-align: inherit;">Seria útil se eles suportassem </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas aqui, no entanto, vemos essa situação rara em que até o suporte experimental de uma certa oportunidade é suficiente para que seja um benefício real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Problemas sutis de desempenho também são problemas. </font><font style="vertical-align: inherit;">E a capacidade de tornar esses problemas mais visíveis é um dos melhores métodos que um desenvolvedor pode usar para identificá-los e corrigi-los. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queridos leitores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você planeja usar o cabeçalho da Política de recursos para identificar problemas imperceptíveis em projetos da web?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490612/index.html">Abordagem funcional para transações no Scala ou escreva sua própria mônada útil</a></li>
<li><a href="../pt490616/index.html">O resumo de materiais frescos do mundo do front-end da última semana n ° 404 (24 de fevereiro a 1 de março de 2020)</a></li>
<li><a href="../pt490618/index.html">Buffers de pilha da Goroutine</a></li>
<li><a href="../pt490620/index.html">Quando ouço as palavras "restaurou a rede neural", subo para verificar os backups</a></li>
<li><a href="../pt490622/index.html">Combate a vazamentos de memória em aplicativos da web</a></li>
<li><a href="../pt490626/index.html">Um guia completo para dados- * atributos HTML</a></li>
<li><a href="../pt490628/index.html">O que fazer quando o CSS bloqueia a análise de página?</a></li>
<li><a href="../pt490630/index.html">Carregando matrizes NumPy do disco: Comparando memmap () e Zarr / HDF5</a></li>
<li><a href="../pt490634/index.html">Eventos digitais em Moscou de 2 a 8 de março</a></li>
<li><a href="../pt490636/index.html">Eventos digitais em São Petersburgo, de 2 a 8 de março</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>