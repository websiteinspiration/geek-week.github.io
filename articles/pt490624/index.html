<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèΩ üèí ‚õπüèø Controle de cabe√ßalho HTTP da pol√≠tica de recursos e navegador da Web üó£Ô∏è üèΩ üö¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe uma t√©cnica completamente incompar√°vel que permite manter o desempenho de um projeto da Web sob controle. Consiste em introduzir mecanismos no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Controle de cabe√ßalho HTTP da pol√≠tica de recursos e navegador da Web</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/490624/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe uma t√©cnica completamente incompar√°vel que permite manter o desempenho de um projeto da Web sob controle. Consiste em introduzir mecanismos no processo de desenvolvimento, cujos resultados s√£o claramente vis√≠veis. Esses mecanismos s√£o projetados para sempre lembrar o programador da import√¢ncia do desempenho. H√° algo neste contexto que eu realmente gosto. Este √© o cabe√ßalho HTTP da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pol√≠tica de recursos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Este t√≠tulo √© um recurso relativamente novo que permite ao desenvolvedor ativar e desativar determinados recursos do navegador enquanto navega no site. </font><font style="vertical-align: inherit;">
Por exemplo, voc√™ pode dizer ao navegador que ele n√£o deve permitir o uso da API de geolocaliza√ß√£o passando o seguinte cabe√ßalho:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/_a/mh/zz/_amhzzcwmae7goctptz7hobpnwa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: geolocation 'none'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitas vantagens em </font><font style="vertical-align: inherit;">usar um cabe√ßalho </font><font style="vertical-align: inherit;">em termos de seguran√ßa e desempenho. </font><font style="vertical-align: inherit;">Mas agora gosto especialmente de como </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode us√°-lo para tornar mais vis√≠veis os problemas de desempenho do site que geralmente s√£o f√°ceis de esquecer. </font><font style="vertical-align: inherit;">Isso pode ser comparado a algo como "desempenho linting". </font><font style="vertical-align: inherit;">Em particular, estamos falando sobre identificar problemas com imagens usadas em projetos da web.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pol√≠tica de imagens de grandes dimens√µes</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a imagem for transmitida ao navegador em um formato compat√≠vel, ela ser√° exibida. Esse √© o comportamento padr√£o do navegador. O navegador, tentando ajudar aqueles que est√£o visualizando a p√°gina, tamb√©m dimensiona automaticamente essas imagens. Portanto, eles ficam bem, mesmo que sejam representados por grandes arquivos gr√°ficos. Como resultado, se voc√™ usar imagens maiores que os tamanhos necess√°rios para a p√°gina, isso ser√°, √† primeira vista, invis√≠vel. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pol√≠tica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diretiva</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informa ao navegador que ele n√£o deve permitir o uso de imagens cujo tamanho exceda, por um n√∫mero especificado de vezes, o tamanho de seus cont√™ineres. </font><font style="vertical-align: inherit;">A imagem, de acordo com a restri√ß√£o padr√£o, n√£o pode exceder 2 vezes o cont√™iner. </font><font style="vertical-align: inherit;">Mas esse valor, se necess√°rio, pode ser redefinido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se o navegador receber o pr√≥ximo cabe√ßalho, ele n√£o permitir√° que voc√™ exiba imagens tiradas de nenhuma fonte (isso √© definido gra√ßas </font></font><code>none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), cujas dimens√µes s√£o mais de duas vezes o tamanho de seus cont√™ineres (em largura ou altura).</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ precisar de mais flexibilidade, poder√° informar ao navegador que ele n√£o deve exibir imagens que sejam tr√™s vezes maiores que os cont√™ineres:</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images *(3) 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De qualquer forma, se a imagem n√£o corresponder aos limites especificados, um stub ser√° exibido em vez da imagem e uma mensagem de erro ser√° enviada ao console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c98/1e3/169/c981e3169d9219c226c13236f198c222.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site usar a pol√≠tica de imagens de tamanho grande, ser√£o enviadas imagens grandes, mas um stub ser√° exibido e uma mensagem de erro ser√° exibida no console</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagens n√£o otimizadas</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro problema comum com gr√°ficos √© o uso de imagens n√£o otimizadas. Muitas vezes, voc√™ pode encontrar imagens que n√£o foram compactadas adequadamente. Seu tamanho, no entanto, pode ser selecionado corretamente. Portanto, para arquivos com fotos, ao captur√°-las e cri√°-las, muitos metadados desnecess√°rios podem ser adicionados, que geralmente permanecem nos arquivos e quando usados ‚Äã‚Äãnos navegadores. Um exemplo particularmente irritante disso s√£o as imagens, cujos metadados cont√™m suas pr√≥prias miniaturas para visualiza√ß√£o. Muitas vezes eu vi como a miniatura incorporada na imagem (cuja presen√ßa os designers e desenvolvedores nem conheciam) "pesava" mais do que a pr√≥pria imagem!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre outras coisas, aqui voc√™ pode recordar a compacta√ß√£o de imagem usual, suportada por muitos formatos, o que permite alcan√ßar o equil√≠brio perfeito entre a qualidade da imagem e o tamanho do arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As pol√≠ticas de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">imagens com perda n√£o otimizadas</font></a><font style="vertical-align: inherit;"> e de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagens </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem perda n√£o otimizadas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permitem que o navegador saiba que ele corresponde ao tamanho do arquivo e ao tamanho da imagem em pixels.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unoptimized-lossy-images 'none';<font></font>
Feature-Policy: unoptimized-lossless-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o n√∫mero de bytes por pixel (Byte por pixel, BPP) for muito alto, o navegador exibir√° um esbo√ßo em vez da imagem e uma mensagem de erro no console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/215/e57/347215e574f0574312eff1d6737b8d9e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A aplica√ß√£o de pol√≠ticas n√£o otimizadas- * faz com que um stub seja exibido em vez de imagens inadequadas - assim como a pol√≠tica de imagens superdimensionadas, o</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
n√≠vel recomendado de BPP para imagens compactadas com perda √© de 0,5 e 1 para imagens compactadas sem perda. Al√©m disso, ao analisar imagens, √© permitido um pequeno desvio do tamanho total desses n√≠veis. Agora, esse desvio para imagens compactadas com perda √© de 1 Kb, para imagens compactadas sem perda - 10 Kb.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, suponha que tenhamos uma imagem JPEG de 200x200 pixels. JPEG √© um formato de compacta√ß√£o com perda de imagem, resultando em um n√≠vel recomendado de BPP de 0,5. Ao mesmo tempo, o tamanho total da imagem pode exceder o tamanho recomendado em apenas 1 Kb. Para descobrir qual tamanho uma imagem semelhante deve se adequar a um navegador, √© necess√°rio multiplicar as dimens√µes dos lados da imagem em pixels entre si e pelo BPP e, em seguida, adicionar o desvio permitido ao que acontece. </font></font><br>
<br>
<code>(200 x 200 x .5) + 1024 = 21,024</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte ou </font></font><code>20.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a imagem for compactada sem perda, √© permitido um desvio do tamanho ‚Äúideal‚Äù de 10 Kb, enquanto o BPP dessa imagem ser√° 1. Caso contr√°rio, os c√°lculos ser√£o exatamente iguais: </font></font><br>
<br>
<code>(200 x 200 x 1) + 10,240 = 50,240</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">byte ou </font></font><code>49.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â prov√°vel que o tamanho do desvio permitido mude no futuro. </font><font style="vertical-align: inherit;">De fato, embora o Blink, por padr√£o, use esse indicador para imagens compactadas sem perda, iguais a 10 Kb, j√° est√£o em andamento experimentos com uma pol√≠tica </font></font><code>unoptimized-lossless-images-strict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que altera esse indicador, baixando-o para o n√≠vel de 1 Kb.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≠dia n√£o especificada</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O novo √© o velho bem esquecido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante muito tempo, o uso de atributos de imagem </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi mais ou menos comum. Sem esses atributos, o navegador n√£o sabia quanto espa√ßo a imagem deveria ocupar at√© o momento em que a imagem foi carregada. Isso levou a mudan√ßas nos layouts de p√°gina. A p√°gina foi exibida e, depois que a imagem chegou, seu conte√∫do mudou. O navegador mais uma vez teve que recontar o layout para alocar espa√ßo para a imagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando chegou a hora dos layouts em que os tamanhos das imagens precisavam ser redimensionados de maneira flex√≠vel usando CSS, a presen√ßa ou aus√™ncia desses atributos n√£o exercia mais um papel especial. Como resultado, muitos simplesmente pararam de usar esses atributos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas gra√ßas ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabalho recente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iniciado por Jen Simmons, Firefox e Chrome podem calcular a propor√ß√£o das imagens com base em seus atributos </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Quando essa abordagem √© combinada com os estilos aplicados √†s imagens, os navegadores podem reservar espa√ßo para as imagens durante a passagem inicial do layout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pol√≠tica de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√≠dia sem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamanho informa ao navegador que todos os elementos de m√≠dia devem ter atributos que especificam os tamanhos desses elementos. Se n√£o houver tais atributos, o navegador dever√° usar os valores padr√£o. Tudo, de fato, √© um pouco mais complicado, mas a conclus√£o √© que, se a imagem n√£o tiver os atributos apropriados, o navegador usar√° o valor padr√£o de </font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixel.</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unsized-media 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando essa pol√≠tica √© aplicada, as imagens ser√£o exibidas, mas se o tamanho n√£o for especificado em HTML, o desenvolvedor notar√° rapidamente que as imagens s√£o exibidas no tamanho padr√£o. E, como sempre, uma mensagem de erro ser√° enviada ao console.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4b/b8a/4c5/a4bb8a4c52a7267ef162a8a8244c0f9a.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A aplica√ß√£o da pol√≠tica de m√≠dia sem tamanho leva ao fato de que imagens e v√≠deos sem os atributos de altura e largura s√£o exibidos, mas o navegador define seus tamanhos para 300 x 150 pixels.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Provavelmente, vale a pena mencionar um recurso que a princ√≠pio me pareceu incomum. </font><font style="vertical-align: inherit;">Ela se mostra ao compartilhar pol√≠ticas</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nesta situa√ß√£o, n√£o se deve surpreender com a apar√™ncia de mais do que antes, o n√∫mero de mensagens sobre imagens muito grandes. </font><font style="vertical-align: inherit;">O fato √© que, devido √† aplica√ß√£o da pol√≠tica, o</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navegador redimensiona imagens que n√£o possuem atributos</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at√©</font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixels. </font><font style="vertical-align: inherit;">Ap√≥s o qual √© esse tamanho que o navegador usa como ponto de refer√™ncia para determinar se a imagem corresponde ao seu cont√™iner.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atrair aten√ß√£o para problemas menos vis√≠veis</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas pol√≠ticas relacionadas √† imagem, gosto do fato de que elas, no processo de desenvolvimento de projetos, tornam poss√≠vel tornar vis√≠vel o que geralmente est√° oculto. Como resultado, o desenvolvedor descobre que n√£o cuidou de otimizar as imagens ou que esqueceu de definir seus atributos </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Todos esses erros s√£o refletidos imediatamente na apar√™ncia das p√°ginas. De fato, a principal vantagem do uso das pol√≠ticas acima √© que elas permitem que o desenvolvedor descubra rapidamente os problemas com as imagens. Enquanto pol√≠tica</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode levar a uma diminui√ß√£o no n√∫mero de situa√ß√µes nas quais ocorrem ‚Äútrocas‚Äù de layouts de p√°gina; o uso de outras pol√≠ticas n√£o impede o carregamento de imagens inadequadas. Como resultado, o √∫nico ponto forte da aplica√ß√£o dessas pol√≠ticas √© que elas chamam a aten√ß√£o dos desenvolvedores para os problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rias outras pol√≠ticas que podem ser √∫teis em termos de an√°lise de p√°ginas quanto ao impacto de algo em seu desempenho. √â aqui que pol√≠ticas como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script de sincroniza√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v√™m √† mente </font><font style="vertical-align: inherit;">(essa pol√≠tica bloqueia a execu√ß√£o de scripts s√≠ncronos), </font></font><code>sync-xhr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloqueia solicita√ß√µes s√≠ncronas de AJAX) e </font></font><code>document-write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bloqueia chamadas </font></font><code>document.write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas pol√≠ticas s√£o √≥timas ferramentas para controlar certos aspectos do desempenho da p√°gina, mas elas pr√≥prias n√£o fornecem aos desenvolvedores o mesmo feedback percept√≠vel que muitas das pol√≠ticas acima fornecem na forma de imagens ausentes. Obviamente, se a p√°gina possui um script s√≠ncrono, sem o qual n√£o √© exibido, isso n√£o √© f√°cil de perder (e essas p√°ginas n√£o s√£o t√£o dif√≠ceis de encontrar). Mas essas pol√≠ticas geralmente indicam erros na forma de mensagens exibidas no console. E, para ser sincero, suspeito que a maioria dos desenvolvedores n√£o presta muita aten√ß√£o ao console (acho que todos devemos ter mais cuidado com o console). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, no entanto, podemos tornar os erros detectados pelas pol√≠ticas "invis√≠veis" muito mais vis√≠veis usando a API</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportingObserver</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para monitorar viola√ß√µes e exibir notifica√ß√µes relevantes na p√°gina. </font><font style="vertical-align: inherit;">Tais notifica√ß√µes podem ser feitas muito vis√≠veis.</font></font><br>
<br>
<pre><code class="plaintext hljs">let reportingAlerts = document.createElement('ul');<font></font>
&nbsp;&nbsp;reportingAlerts.setAttribute('id','reportingAlerts');<font></font>
&nbsp;&nbsp;document.body.appendChild(reportingAlerts);<font></font>
<font></font>
const alertBox = document.getElementById('reportingAlerts');<font></font>
<font></font>
new ReportingObserver((reports, observer) =&gt; {<font></font>
&nbsp;&nbsp;let fragment = document.createDocumentFragment();<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;Object.keys(reports).forEach(function(item) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let li = document.createElement('li');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;li.textContent = reports[item].body.message + ': ' + reports[item].body.featureId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fragment.appendChild(li);<font></font>
&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;alertBox.appendChild(fragment)<font></font>
}, {types: ['feature-policy-violation'], buffered: true}).observe();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu esbocei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no CodePen </font><font style="vertical-align: inherit;">de como isso pode parecer.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/c18/c8a/2bdc18c8a9bb20db1f18a9e095be4b8e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo de como voc√™ pode exibir notifica√ß√µes de viola√ß√µes da pol√≠tica especificadas pelo cabe√ßalho da Pol√≠tica de Recursos. </font><font style="vertical-align: inherit;">Essas notifica√ß√µes s√£o projetadas para sa√≠da no ambiente de desenvolvimento ou onde o projeto √© preparado para sa√≠da para produ√ß√£o.</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menos uso do cabe√ßalho da pol√≠tica de recursos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O grande ponto negativo de usar o cabe√ßalho </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o suporte dos navegadores. </font><font style="vertical-align: inherit;">Aparentemente, agora ele √© suportado apenas por navegadores baseados em Blink (Opera, Edge, Chrome, Samsung). </font><font style="vertical-align: inherit;">Os navegadores Firefox e Safari suportam o atributo </font></font><code>allow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para itens </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas mesmo onde √© </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suportado, para garantir a integridade de muitas pol√≠ticas, voc√™ precisa ativar o sinalizador </font></font><code>Experimental Web Platform features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(voc√™ pode encontr√°-lo no endere√ßo </font></font><code>about:flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como uso o cabe√ßalho da pol√≠tica de recursos</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquele menos o t√≠tulo </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mencionado acima, para mim, pessoalmente, n√£o √© um problema espec√≠fico. Prefiro usar as pol√≠ticas definidas por este cabe√ßalho como um verificador de p√°ginas baseado em navegador. Portanto, n√£o preciso me esfor√ßar para aplicar </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na produ√ß√£o ou garantir que as pol√≠ticas funcionem para todos os meus usu√°rios. Eles s√£o necess√°rios apenas por mim e por aqueles que est√£o desenvolvendo o site. De qualquer forma, eu uso o Chrome como o navegador principal no processo de desenvolvimento. Portanto, garantir o desempenho </font></font><code>Feature-Police</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no meu ambiente de trabalho √© ativar o sinalizador apropriado. Depois disso, os pol√≠ticos trabalham sem nenhuma interven√ß√£o adicional da minha parte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descobri que a maneira mais f√°cil de usar o cabe√ßalho √© </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com uma extens√£o do navegador</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModHeader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta extens√£o permite que voc√™ defina seus pr√≥prios t√≠tulos que s√£o passados ‚Äã‚Äãpara as p√°ginas quando s√£o visualizados.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/ec2/33b/9c9ec233b6a3913a5e584335ac43a344.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A extens√£o ModHeader permite configurar as op√ß√µes de cabe√ßalho da pol√≠tica de recursos. </font><font style="vertical-align: inherit;">Eles podem ser ativados e desativados, se desejado.Eu</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tenho tr√™s conjuntos de valores de cabe√ßalho</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que uso periodicamente:</font></font><br>
<br>
<ul>
<li><code>oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>script-sync 'none'; unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Costumo manter o primeiro ligado. √â muito emocionante viajar por p√°ginas da web √†s quais as pol√≠ticas usadas nela se aplicam. √â assustador ver qu√£o grandes s√£o algumas imagens. H√° muitas coisas na web moderna que poderiam ser melhoradas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a pol√≠tica √© muitas vezes desencadeada nas p√°ginas </font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(e eu tamb√©m pe√ßo por isso); portanto, seu uso durante o trabalho normal na Internet √© inconveniente. √â por isso que eu o destaquei em uma pol√≠tica separada, que eu posso ativar e desativar. O mesmo se aplica √†s pol√≠ticas </font></font><code>sync-scripts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuja aplica√ß√£o "quebra" muitos sites.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algumas das equipes com as quais trabalhei come√ßaram a usar as pol√≠ticas que descrevi durante o desenvolvimento. </font><font style="vertical-align: inherit;">Isso permite que eles prestem aten√ß√£o rapidamente a problemas anteriormente invis√≠veis. </font><font style="vertical-align: inherit;">Obviamente, recomendo incluir todas as pol√≠ticas </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no ambiente de desenvolvimento, o que permite identificar e corrigir erros rapidamente.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que o suporte </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apare√ßa, como resultado, n√£o apenas no Chrome. </font><font style="vertical-align: inherit;">Embora este seja o meu navegador principal, tamb√©m tenho que usar outros navegadores. </font><font style="vertical-align: inherit;">Seria √∫til se eles suportassem </font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas aqui, no entanto, vemos essa situa√ß√£o rara em que at√© o suporte experimental de uma certa oportunidade √© suficiente para que seja um benef√≠cio real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Problemas sutis de desempenho tamb√©m s√£o problemas. </font><font style="vertical-align: inherit;">E a capacidade de tornar esses problemas mais vis√≠veis √© um dos melhores m√©todos que um desenvolvedor pode usar para identific√°-los e corrigi-los. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queridos leitores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ planeja usar o cabe√ßalho da Pol√≠tica de recursos para identificar problemas impercept√≠veis em projetos da web?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt490612/index.html">Abordagem funcional para transa√ß√µes no Scala ou escreva sua pr√≥pria m√¥nada √∫til</a></li>
<li><a href="../pt490616/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 404 (24 de fevereiro a 1 de mar√ßo de 2020)</a></li>
<li><a href="../pt490618/index.html">Buffers de pilha da Goroutine</a></li>
<li><a href="../pt490620/index.html">Quando ou√ßo as palavras "restaurou a rede neural", subo para verificar os backups</a></li>
<li><a href="../pt490622/index.html">Combate a vazamentos de mem√≥ria em aplicativos da web</a></li>
<li><a href="../pt490626/index.html">Um guia completo para dados- * atributos HTML</a></li>
<li><a href="../pt490628/index.html">O que fazer quando o CSS bloqueia a an√°lise de p√°gina?</a></li>
<li><a href="../pt490630/index.html">Carregando matrizes NumPy do disco: Comparando memmap () e Zarr / HDF5</a></li>
<li><a href="../pt490634/index.html">Eventos digitais em Moscou de 2 a 8 de mar√ßo</a></li>
<li><a href="../pt490636/index.html">Eventos digitais em S√£o Petersburgo, de 2 a 8 de mar√ßo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>