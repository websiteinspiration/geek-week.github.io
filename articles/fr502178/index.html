<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëàüèº üôèüèº üïäÔ∏è oVirt en 2 heures. Partie 3. Param√®tres avanc√©s üíî üòû üñ•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous examinerons un certain nombre de param√®tres facultatifs mais utiles:
 
 

- utilisation de noms suppl√©mentaires pour le gestion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>oVirt en 2 heures. Partie 3. Param√®tres avanc√©s</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502178/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cet article, nous examinerons un certain nombre de param√®tres facultatifs mais utiles:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisation de noms suppl√©mentaires pour le gestionnaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">authentification de la connexion via l'annuaire Active</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutlipathing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestion de l'√©nergie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplacement du certificat SSL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'archivage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface de gestion d'h√¥te (cockpit)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les VLAN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifique pour HPE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est une suite, commencez √† voir oVirt dans 2 heures </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des articles</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation du gestionnaire (ovirt-engine) et des hyperviseurs (h√¥tes) </font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres avanc√©s - Nous sommes ici</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√©rations de base</font></font></a></li>
</ol><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres suppl√©mentaires du gestionnaire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour plus de commodit√©, nous vous fournirons des packages suppl√©mentaires:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install bash-completion vim</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour activer l'auto-compl√©tion, les commandes bash-compl√©tement doivent √™tre commut√©es sur bash.</font></font><br>
<br>
<a name="add-fqdn"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout de noms DNS suppl√©mentaires</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est n√©cessaire lorsque vous devez vous connecter au gestionnaire par un autre nom (CNAME, alias ou simplement un nom court sans suffixe de domaine). </font><font style="vertical-align: inherit;">Pour des raisons de s√©curit√©, le gestionnaire autorise uniquement les connexions en utilisant la liste de noms autoris√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez un fichier de configuration:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/engine.conf.d/99-custom-sso-setup.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le contenu suivant:</font></font><br>
<br>
<pre><code class="cmake hljs">SSO_ALTERNATE_ENGINE_FQDNS=<span class="hljs-string">"ovirt.example.com some.alias.example.com ovirt"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et red√©marrez le gestionnaire:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl restart ovirt-engine</code></pre><br>
<a name="ad-auth"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer l'authentification via AD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
oVirt a une base d'utilisateurs int√©gr√©e, mais les fournisseurs LDAP externes sont √©galement pris en charge, y compris </font><font style="vertical-align: inherit;">UN D. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple pour une configuration typique est de d√©marrer l'assistant et de red√©marrer le gestionnaire:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install ovirt-engine-extension-aaa-ldap-setup<font></font>
$ sudo ovirt-engine-extension-aaa-ldap-setup<font></font>
$ sudo systemctl restart ovirt-engine</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple d'assistant</font></font></b>
                        <div class="spoiler_text">$ <b>sudo ovirt-engine-extension-aaa-ldap-setup</b><br>
Available LDAP implementations:<br>
‚Ä¶<br>
 3 ‚Äî Active Directory<br>
‚Ä¶<br>
 Please select: <b>3</b><br>
 Please enter Active Directory Forest name: <b>example.com<br>
</b><br>
 Please select protocol to use (startTLS, ldaps, plain) <b>[startTLS]</b>: <br>
 Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure): <b>URL</b><br>
 URL: <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">wwwca.example.com/myRootCA.pem</a></b><br>
 Enter search user DN (for example uid=username,dc=example,dc=com or leave empty for anonymous): <b>CN=oVirt-Engine,CN=Users,DC=example,DC=com</b><br>
 Enter search user password: <b>*password*</b><br>
[ INFO ] Attempting to bind using 'CN=oVirt-Engine,CN=Users,DC=example,DC=com'<br>
 Are you going to use Single Sign-On for Virtual Machines (Yes, No) <b>[Yes]</b>: <br>
 Please specify profile name that will be visible to users <b>[example.com]</b>: <br>
 Please provide credentials to test login flow:<br>
 Enter user name: <b>someAnyUser</b><br>
 Enter user password: <br>
‚Ä¶<br>
[ INFO ] Login sequence executed successfully<br>
‚Ä¶<br>
 Select test sequence to execute (Done, Abort, Login, Search) <b>[Done]</b>: <br>
[ INFO ] Stage: Transaction setup<br>
‚Ä¶<br>
 CONFIGURATION SUMMARY<br>
‚Ä¶<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de l'assistant convient √† la plupart des cas. </font><font style="vertical-align: inherit;">Pour les configurations complexes, les param√®tres sont manuels. </font><font style="vertical-align: inherit;">En savoir plus dans la documentation oVirt, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Users and Roles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Une fois le moteur correctement connect√© √† AD, un profil suppl√©mentaire appara√Æt dans la fen√™tre de connexion et dans l'onglet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorisations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les objets syst√®me - la possibilit√© d'accorder des autorisations aux utilisateurs et aux groupes AD. </font><font style="vertical-align: inherit;">Il convient de noter que le r√©pertoire externe des utilisateurs et des groupes peut √™tre non seulement AD, mais √©galement IPA, eDirectory, etc.</font></font><br>
<br>
<a name="mpath"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multipathing</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un environnement de production, le syst√®me de stockage doit √™tre connect√© √† l'h√¥te par plusieurs chemins d'E / S multiples ind√©pendants. </font><font style="vertical-align: inherit;">En r√®gle g√©n√©rale, dans CentOS (et donc oVirt), il n'y a pas de probl√®me avec la construction de plusieurs chemins de p√©riph√©rique (find_multipaths oui). </font><font style="vertical-align: inherit;">Des param√®tres suppl√©mentaires pour FCoE sont d√©crits dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partie 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il vaut la peine de pr√™ter attention √† la recommandation du fabricant des syst√®mes de stockage - beaucoup recommandent d'utiliser la politique de tourniquet, par d√©faut, le service Linux est utilis√© dans Enterprise Linux 7.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, 3PAR</font></font></b>
                        <div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HPE 3PAR Red Hat Enterprise Linux, CentOS Linux, Oracle Linux, and OracleVM Server Implementation Guide</a> EL   Host  Generic-ALUA Persona 2,     /etc/multipath.conf   :<br>
<br>
<pre><code class="plaintext hljs">defaults {<font></font>
           polling_interval      10<font></font>
           user_friendly_names   no<font></font>
           find_multipaths       yes<font></font>
          }<font></font>
devices {<font></font>
          device {<font></font>
                   vendor                   "3PARdata"<font></font>
                   product                  "VV"<font></font>
                   path_grouping_policy     group_by_prio<font></font>
                   path_selector            "round-robin 0"<font></font>
                   path_checker             tur<font></font>
                   features                 "0"<font></font>
                   hardware_handler         "1 alua"<font></font>
                   prio                     alua<font></font>
                   failback                 immediate<font></font>
                   rr_weight                uniform<font></font>
                   no_path_retry            18<font></font>
                   rr_min_io_rq             1<font></font>
                   detect_prio              yes<font></font>
                   fast_io_fail_tmo         10<font></font>
                   dev_loss_tmo             "infinity"<font></font>
                 }<font></font>
}</code></pre><br>
     :<br>
<br>
<pre><code class="bash hljs">systemctl restart multipathd</code></pre><br>
<img src="https://habrastorage.org/webt/ez/1c/fs/ez1cfs3-mar5uivpfekvtgomway.png"><br>
<i>. 1 ‚Äî   -  .</i><br>
<br>
<img src="https://habrastorage.org/webt/j_/6r/ll/j_6rll3gmnpqzwhwz_uffranfgo.png"><br>
<i>. 2 ‚Äî   -   .</i><br>
</div>
                    </div><br>
<a name="pwr-mgmt"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration de gestion de l'alimentation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous permet d'effectuer, par exemple, une r√©initialisation mat√©rielle de la machine, si le moteur ne peut pas recevoir de r√©ponse de l'h√¥te pendant une longue p√©riode. </font><font style="vertical-align: inherit;">Mis en ≈ìuvre via l'agent de cl√¥ture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calculez -&gt; H√¥tes -&gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√îTE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √âditez -&gt; Gestion de l'alimentation, puis activez "Activer la gestion de l'alimentation" et ajoutez l'agent - "Ajouter un agent de cl√¥ture" -&gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous indiquons le type (par exemple, ilo4 doit √™tre sp√©cifi√© pour iLO5), le nom / l'adresse de l'interface ipmi, ainsi que le nom d'utilisateur / mot de passe. </font><font style="vertical-align: inherit;">Il est recommand√© de cr√©er un utilisateur distinct (par exemple, oVirt-PM) et, dans le cas d'iLO, de lui accorder des privil√®ges:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'identifier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console distante</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alimentation virtuelle et r√©initialisation</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©dias virtuels</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer les param√®tres iLO</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administrer les comptes d'utilisateurs</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne demandez pas pourquoi, il est choisi empiriquement. </font><font style="vertical-align: inherit;">L'agent de cl√¥ture de console n√©cessite un ensemble de droits plus restreint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la configuration des listes de contr√¥le d'acc√®s, il convient de garder √† l'esprit que l'agent ne s'ex√©cute pas sur le moteur, mais sur l'h√¥te "voisin" (le soi-disant Power Management Proxy), c'est-√†-dire que s'il n'y a qu'un seul n≈ìud dans le cluster, la gestion de l'alimentation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonctionnera </font><b><font style="vertical-align: inherit;">pas</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a name="ssl-cert"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration SSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les instructions officielles compl√®tes se trouvent dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Annexe D: oVirt et SSL - Remplacement du certificat SSL / TLS oVirt Engine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le certificat peut provenir soit de notre CA d'entreprise, soit d'une autorit√© de certification commerciale externe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque importante: le certificat est con√ßu pour se connecter au gestionnaire, il n'affectera pas l'interaction entre le moteur et les n≈ìuds - ils utiliseront des certificats auto-sign√©s √©mis par le moteur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exigences:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certificat de l'AC √©mettrice au format PEM, avec toute la cha√Æne jusqu'√† l'AC racine (de l'√©metteur subordonn√© au d√©but √† la racine √† la fin);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certificat Apache √©mis par l'autorit√© de certification √©mettrice (√©galement compl√©t√© par toute la cha√Æne de certificats de l'autorit√© de certification)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cl√© priv√©e pour Apache, pas de mot de passe.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que notre autorit√© de certification de publication ex√©cute CentOS, appel√©e subca.example.com, et que les demandes, les cl√©s et les certificats se trouvent dans le r√©pertoire / etc / pki / tls /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous effectuons des sauvegardes et cr√©ons un r√©pertoire temporaire:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp /etc/pki/ovirt-engine/keys/apache.key.nopass /etc/pki/ovirt-engine/keys/apache.key.nopass.`date +%F`<font></font>
$ sudo cp /etc/pki/ovirt-engine/certs/apache.cer /etc/pki/ovirt-engine/certs/apache.cer.`date +%F`<font></font>
$ sudo mkdir /opt/certs<font></font>
$ sudo chown mgmt.mgmt /opt/certs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√©l√©chargez des certificats, ex√©cutez-les depuis notre poste de travail ou transf√©rez-les d'une autre mani√®re pratique:</font></font><br>
<br>
<pre><code class="bash hljs">[myuser@mydesktop] $ scp -3 causer@subca.example.com:/etc/pki/tls/cachain.pem mgmt@ovirt.example.com:/opt/certs<font></font>
[myuser@mydesktop] $ scp -3 causer@subca.example.com:/etc/pki/tls/private/ovirt.key mgmt@ovirt.example.com:/opt/certs<font></font>
[myuser@mydesktop] $ scp -3 causer@subca.example.com/etc/pki/tls/certs/ovirt.crt mgmt@ovirt.example.com:/opt/certs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, vous devriez voir les 3 fichiers:</font></font><br>
<br>
<pre><code class="bash hljs">$ ls /opt/certs<font></font>
cachain.pem  ovirt.crt  ovirt.key</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installation de certificat</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous copions des fichiers et mettons √† jour les listes de confiance:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo cp /opt/certs/cachain.pem /etc/pki/ca-trust/<span class="hljs-built_in">source</span>/anchors<font></font>
$ sudo update-ca-trust<font></font>
$ sudo rm /etc/pki/ovirt-engine/apache-ca.pem<font></font>
$ sudo cp /opt/certs/cachain.pem /etc/pki/ovirt-engine/apache-ca.pem<font></font>
$ sudo cp /opt/certs/ovirt03.key /etc/pki/ovirt-engine/keys/apache.key.nopass<font></font>
$ sudo cp /opt/certs/ovirt03.crt /etc/pki/ovirt-engine/certs/apache.cer<font></font>
$ sudo systemctl restart httpd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter / mettre √† jour des fichiers de configuration:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/engine.conf.d/99-custom-truststore.conf</code></pre><br>
<pre><code class="plaintext hljs">ENGINE_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"<font></font>
ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD=""</code></pre><br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf</code></pre><br>
<pre><code class="plaintext hljs">SSL_CERTIFICATE=/etc/pki/ovirt-engine/certs/apache.cer<font></font>
SSL_KEY=/etc/pki/ovirt-engine/keys/apache.key.nopass</code></pre><br>
<pre><code class="bash hljs">$ sudo vim /etc/ovirt-imageio-proxy/ovirt-imageio-proxy.conf</code></pre><br>
<pre><code class="plaintext hljs"># Key file for SSL connections<font></font>
ssl_key_file = /etc/pki/ovirt-engine/keys/apache.key.nopass<font></font>
# Certificate file for SSL connections<font></font>
ssl_cert_file = /etc/pki/ovirt-engine/certs/apache.cer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous red√©marrons tous les services concern√©s:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl restart ovirt-provider-ovn.service<font></font>
$ sudo systemctl restart ovirt-imageio-proxy<font></font>
$ sudo systemctl restart ovirt-websocket-proxy<font></font>
$ sudo systemctl restart ovirt-engine.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Termin√©! </font><font style="vertical-align: inherit;">Il est temps de se connecter au gestionnaire et de v√©rifier que la connexion est prot√©g√©e par un certificat SSL sign√©.</font></font><br>
<br>
<a name="backup-mgr"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archivage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O√π sans elle! </font><font style="vertical-align: inherit;">Dans cette section, nous aborderons l'archivage des gestionnaires; l'archivage des machines virtuelles est un probl√®me distinct. </font><font style="vertical-align: inherit;">Nous allons faire des copies d'archives une fois par jour et les mettre sur NFS, par exemple, sur le m√™me syst√®me o√π nous avons plac√© les images ISO - mynfs01.example.com:/exports/ovirt-backup. </font><font style="vertical-align: inherit;">Il n'est pas recommand√© de stocker des archives sur la m√™me machine o√π Engine s'ex√©cute. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez et activez les autofs:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install autofs<font></font>
$ sudo systemctl <span class="hljs-built_in">enable</span> autofs<font></font>
$ sudo systemctl start autofs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez un script:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim /etc/cron.daily/make.oVirt.backup.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le contenu suivant:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
datetime=`date +<span class="hljs-string">"%F.%R"</span>`<font></font>
backupdir=<span class="hljs-string">"/net/mynfs01.example.com/exports/ovirt-backup"</span>
filename=<span class="hljs-string">"<span class="hljs-variable">$backupdir</span>/`hostname --short`.`date +"</span>%F.%R<span class="hljs-string">"`"</span>
engine-backup --mode=backup --scope=all --file=<span class="hljs-variable">$filename</span>.data --<span class="hljs-built_in">log</span>=<span class="hljs-variable">$filename</span>.<span class="hljs-built_in">log</span>
<span class="hljs-comment">#uncomment next line for autodelete files older 30 days </span>
<span class="hljs-comment">#find $backupdir -type f -mtime +30 -exec rm -f {} \;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous rendons le fichier ex√©cutable:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo chmod a+x /etc/cron.daily/make.oVirt.backup.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, chaque soir, nous recevrons l'archive des param√®tres du gestionnaire.</font></font><br>
<br>
<a name="cockpit"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface de gestion d'h√¥te</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cockpit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une interface d'administration moderne pour les syst√®mes Linux. </font><font style="vertical-align: inherit;">Dans ce cas, il joue un r√¥le proche de l'interface Web ESXi. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/587/d56/5c8/587d565c8e0250045773c2772b3fb112.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">3 - apparence du panneau. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'installe tr√®s simplement, vous avez besoin de packages cockpit et du plugin cockpit-ovirt-dashboard:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install cockpit cockpit-ovirt-dashboard -y</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allumer le cockpit:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl <span class="hljs-built_in">enable</span> --now cockpit.socket</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuration du pare-feu:</font></font><br>
<br>
<pre><code class="bash hljs">sudo firewall-cmd --add-service=cockpit<font></font>
sudo firewall-cmd --add-service=cockpit --permanent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant vous connecter √† l'h√¥te: https: // [IP h√¥te ou FQDN]: 9090</font></font><br>
<br>
<a name="vlans"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VLAN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En savoir plus sur les r√©seaux dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il existe de nombreuses possibilit√©s, nous d√©crivons ici la connexion de r√©seaux virtuels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour connecter d'autres sous-r√©seaux, ils doivent d'abord √™tre d√©crits dans la configuration: R√©seau -&gt; R√©seaux -&gt; Nouveau, ici seul le nom est un champ obligatoire; la case √† cocher VM Network, qui permet aux machines d'utiliser ce r√©seau, est activ√©e et pour activer la balise, activez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activer le balisage VLAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entrez le num√©ro VLAN et cliquez sur OK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant aller dans Calcul -&gt; H√¥tes -&gt; kvmNN -&gt; Interfaces r√©seau -&gt; Configurer les h√¥tes des r√©seaux h√¥tes. Faites glisser le r√©seau ajout√© du c√¥t√© droit des r√©seaux logiques non attribu√©s vers la gauche dans R√©seaux logiques attribu√©s: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/kn/wn/wqknwnvkf13ojuxjidpxuc6s9fq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4 - avant d'ajouter un r√©seau. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/2j/ei/gc/2jeigcdyhds6kfqqrvs-2gtt4zk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. 5 - apr√®s l'ajout d'un r√©seau.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour connecter plusieurs r√©seaux √† l'h√¥te en bloc, il est pratique de leur attribuer une ou plusieurs √©tiquettes lors de la cr√©ation de r√©seaux et d'ajouter des r√©seaux par √©tiquettes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le r√©seau cr√©√©, les h√¥tes passent √† l'√©tat Non op√©rationnel jusqu'√† ce que le r√©seau soit ajout√© √† tous les n≈ìuds du cluster. </font><font style="vertical-align: inherit;">Ce probl√®me est d√ª √† l'indicateur Tout exiger sur l'onglet Cluster lors de la cr√©ation d'un nouveau r√©seau. </font><font style="vertical-align: inherit;">Dans le cas o√π le r√©seau n'est pas n√©cessaire sur tous les n≈ìuds du cluster, ce sympt√¥me peut √™tre d√©sactiv√©, puis le r√©seau lorsqu'il est ajout√© √† l'h√¥te sera √† droite dans la section Non requis et vous pouvez choisir de le connecter √† un h√¥te sp√©cifique. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/10/ey/zr10eyeksh3-j_kqd1ezkcgytnw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure. </font><font style="vertical-align: inherit;">6 - s√©lection d'un signe d'une exigence de r√©seau.</font></font></i><br>
<br>
<a name="hpe"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√©cifique √† HPE</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque tous les fabricants disposent d'outils qui am√©liorent la convivialit√© de leurs produits. </font><font style="vertical-align: inherit;">En utilisant HPE comme exemple, AMS (Agentless Management Service, amsd pour iLO5, hp-ams pour iLO4) et SSA (Smart Storage Administrator, travaillant avec un contr√¥leur de disque), etc. sont utiles.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecter le r√©f√©rentiel HPE</font></font></b>
                        <div class="spoiler_text">     HPE:<br>
<br>
<pre><code class="bash hljs">$ sudo rpm --import https://downloads.linux.hpe.com/SDR/hpePublicKey2048_key1.pub<font></font>
$ sudo vim /etc/yum.repos.d/mcp.repo</code></pre><br>
 :<br>
<br>
<pre><code class="plaintext hljs">[mcp]<font></font>
name=Management Component Pack<font></font>
baseurl=http://downloads.linux.hpe.com/repo/mcp/centos/$releasever/$basearch/current/<font></font>
enabled=1<font></font>
gpgkey=file:///etc/pki/rpm-gpg/GPG-KEY-mcp<font></font>
<font></font>
[spp]<font></font>
name=Service Pack for ProLiant<font></font>
baseurl=http://downloads.linux.hpe.com/SDR/repo/spp/RHEL/$releasever/$basearch/current/<font></font>
enabled=1<font></font>
gpgkey=file:///etc/pki/rpm-gpg/GPG-KEY-mcp</code></pre><br>
       ():<br>
<br>
<pre><code class="bash hljs">$ sudo yum --disablerepo=<span class="hljs-string">"*"</span> --enablerepo=<span class="hljs-string">"mcp"</span> list available<font></font>
$ yum info amsd</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installation et lancement:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install amsd ssacli<font></font>
$ sudo systemctl start amsd</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un exemple d'un utilitaire de contr√¥leur de disque</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/6_/bh/qw/6_bhqwnjgtqbx7eugqzur06mxxo.png"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout pour le moment. </font><font style="vertical-align: inherit;">Dans les articles suivants, je pr√©vois de d√©crire certaines op√©rations et applications de base. </font><font style="vertical-align: inherit;">Par exemple, comment cr√©er VDI dans oVirt.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502156/index.html">Affaire Rambler c. NGINX: Table ronde sur les risques criminels li√©s √† la num√©risation 16 mai</a></li>
<li><a href="../fr502158/index.html">Comment organiser les tests afin d'acc√©l√©rer et de stabiliser les versions des produits. Partie 2</a></li>
<li><a href="../fr502160/index.html">Le d√©veloppement d'applications mobiles personnalis√©es est peu co√ªteux: r√©alit√© ou illusion</a></li>
<li><a href="../fr502166/index.html">Fant√¥mes Windows 3.1</a></li>
<li><a href="../fr502176/index.html">Aller: D√©s√©rialisation JSON avec une saisie incorrecte, ou comment contourner les erreurs de d√©veloppeur d'API</a></li>
<li><a href="../fr502180/index.html">Le jour o√π le p√©rim√®tre a disparu. Solutions de s√©curit√© de Microsoft et partenaires</a></li>
<li><a href="../fr502182/index.html">Encore une fois √† propos de MikroTik ou du SOCKS5 tant attendu</a></li>
<li><a href="../fr502186/index.html">S√©minaire en ligne. S√©curit√© de l'information: SOC mis en quarantaine</a></li>
<li><a href="../fr502196/index.html">Dans l'approche des math√©matiques il y a un si√®cle, on trouve de nouvelles cl√©s pour d√©m√™ler la nature du temps</a></li>
<li><a href="../fr502200/index.html">Entropie: comment les arbres de d√©cision prennent des d√©cisions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>