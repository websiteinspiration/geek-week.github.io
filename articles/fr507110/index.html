<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚úàÔ∏è üè≥Ô∏è‚Äçüåà üé± Comment trouver des erreurs dans un projet C #, fonctionnant sous Linux et macOS üî∑ üë¥üèΩ üë©üèº‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio est un analyseur de code statique bien connu qui vous permet de trouver de nombreuses erreurs d√©licates cach√©es dans la source. Le test b√™t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment trouver des erreurs dans un projet C #, fonctionnant sous Linux et macOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Image 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio est un analyseur de code statique bien connu qui vous permet de trouver de nombreuses erreurs d√©licates cach√©es dans la source. </font><font style="vertical-align: inherit;">Le test b√™ta de la nouvelle version est r√©cemment termin√©, dans lequel il est possible d'analyser des projets C # pour Linux et macOS. </font><font style="vertical-align: inherit;">De plus, l'analyseur peut d√©sormais √™tre int√©gr√© √† JetBrains Cross-Platform IDE - Rider. </font><font style="vertical-align: inherit;">Cet article vous permettra de vous familiariser avec ces fonctionnalit√©s sur l'exemple de v√©rification du projet open source RavenDB.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, mon coll√®gue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">note</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'ouverture d'un test b√™ta d'une nouvelle version de l'analyseur statique PVS-Studio que nous d√©veloppons. </font><font style="vertical-align: inherit;">Le test b√™ta est maintenant termin√© et la nouvelle version peut √™tre t√©l√©charg√©e en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le m√™me article, nous verrons comment analyser les projets C # sous Linux / macOS √† l'aide de l'interface de la console et de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Apr√®s cela, nous effectuerons une analyse traditionnelle de certaines op√©rations int√©ressantes de l'analyseur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Image 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour v√©rification, un projet RavenDB ouvert a √©t√© choisi, dont le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©f√©rentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> totalise pr√®s de 5 000 fichiers de code source. </font><font style="vertical-align: inherit;">Il s'agit d'une base de donn√©es NoSQL assez populaire. </font><font style="vertical-align: inherit;">Les d√©tails peuvent √™tre trouv√©s sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est facile de deviner que j'ai √©t√© attir√© par sa taille, car dans un projet aussi grand et, sans aucun doute, s√©rieux, il y aura probablement quelque chose d'int√©ressant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface de ligne de commande</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, r√©fl√©chissez √† la mani√®re d'analyser via la console. </font><font style="vertical-align: inherit;">Cette section, √† mon avis, sera particuli√®rement int√©ressante pour ceux qui souhaitent int√©grer l'analyseur dans le syst√®me CI. </font><font style="vertical-align: inherit;">L'√©quipe qui d√©marre l'analyse a un certain nombre d'options int√©ressantes, mais dans le cas g√©n√©ral, tout est assez trivial. </font><font style="vertical-align: inherit;">Pour analyser RavenDB, je vais dans le dossier du projet et saisis ce qui suit dans la console:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur -t (abr√©viation de target) est utilis√© pour sp√©cifier une solution ou un fichier de projet √† v√©rifier. </font><font style="vertical-align: inherit;">La ligne pr√©sent√©e ci-dessus d√©marre l'analyse et, √† la suite du travail, forme un fichier contenant les erreurs trouv√©es. </font><font style="vertical-align: inherit;">C'est simple, non?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cavalier</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de l'analyseur dans Rider est √† peu pr√®s la m√™me que dans Visual Studio. </font><font style="vertical-align: inherit;">L'interface simple et intuitive du plugin vous permet de v√©rifier le projet en quelques clics. </font><font style="vertical-align: inherit;">Ce n'est pas une exag√©ration - pour effectuer une analyse RavenDB, je n'ai eu qu'√† cliquer sur le menu principal Outils, pointer sur ¬´PVS-Studio¬ª et cliquer sur ¬´V√©rifier la solution / le projet actuel¬ª.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Image 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©sultats de l'analyse seront affich√©s en bas de la fen√™tre sur l'onglet PVS-Studio (enfin, lequel d'autre? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Image 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme pour le plug-in pour Visual Studio, un double-clic sur un avertissement affichera l'emplacement auquel il est associ√©. Tout est pratique et compr√©hensible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus important encore, l'outil PVS-Studio indique non seulement des erreurs, mais poss√®de √©galement une infrastructure qui facilite la mise en ≈ìuvre de la m√©thodologie d'analyse statique, m√™me dans un grand projet ancien.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'id√©e g√©n√©rale est la suivante. L'utilisateur a d√©marr√© l'analyseur et a re√ßu de nombreux avertissements. √âtant donn√© qu'un projet d√©velopp√© depuis de nombreuses ann√©es, est vivant, se d√©veloppe et fait de l'argent, il est fort probable qu'il n'y aura pas beaucoup d'avertissements dans le rapport indiquant des d√©fauts critiques. En d'autres termes, les bogues critiques ont d√©j√† √©t√© corrig√©s d'une mani√®re ou d'une autre de mani√®re plus co√ªteuse ou gr√¢ce aux commentaires des clients. En cons√©quence, tout ce que l'analyseur trouve maintenant peut √™tre consid√©r√© comme une dette technique, ce qui n'est pas pratique pour essayer de l'√©liminer imm√©diatement. Il est rationnel d'ignorer ces avertissements pour l'instant, mais d'√©crire du nouveau code effectuant d√©j√† une analyse r√©guli√®re.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez demander √† PVS-Studio de consid√©rer ces avertissements comme non pertinents (reporter la dette technique pour plus tard) et de ne plus les afficher. L'analyseur cr√©e un fichier sp√©cial o√π il stocke des informations sur les erreurs jusqu'ici inint√©ressantes. Et maintenant, PVS-Studio √©mettra des avertissements uniquement sur le code nouveau ou modifi√©. De plus, tout cela est mis en ≈ìuvre intelligemment. Si, par exemple, une ligne vide est ajout√©e au d√©but d'un fichier, l'analyseur comprend que, en fait, rien n'a chang√© et restera silencieux. Ce fichier de balisage peut √™tre int√©gr√© dans le syst√®me de contr√¥le de version. Le fichier est volumineux, mais ce n'est pas effrayant, car il est souvent inutile de le poser.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©sormais, tous les programmeurs verront des avertissements li√©s uniquement au code nouveau ou modifi√©. Ainsi, l'analyseur peut commencer √† utiliser ce qu'on appelle le lendemain. Et il sera possible de revenir plus tard √† la dette technique, de corriger progressivement les erreurs et de configurer l'analyseur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour supprimer les avertissements sur le code existant dans Rider, allez simplement dans le menu sup√©rieur dans Outils-&gt; PVS-Studio et cliquez sur "Supprimer tous les messages".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Image 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la fen√™tre qui appara√Æt, vous avertissant que toutes les op√©rations en cours tomberont dans la liste de suppression, cliquez sur ¬´Ok¬ª. </font><font style="vertical-align: inherit;">En cons√©quence, un fichier de suppression sera cr√©√© dans le dossier du projet, qui sera pris en compte par l'analyseur lors des travaux ult√©rieurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que Rider dispose d√©j√† d'un analyseur qui met en √©vidence avec succ√®s certaines erreurs. </font><font style="vertical-align: inherit;">Ainsi, une s√©rie d'avertissements de PVS-Studio pointe vers un code qui semble suspect du point de vue de l'√©diteur. </font><font style="vertical-align: inherit;">N√©anmoins, PVS-Studio trouve assez souvent des erreurs qui pourraient √©chapper √† l'≈ìil sensible de l'analyseur de JetBrains. </font><font style="vertical-align: inherit;">C'est pourquoi la solution la plus efficace est de leur permettre de travailler en √©quipe.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Image 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et pour le dessert</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, comme promis, nous allons consid√©rer quels avertissements int√©ressants l'analyseur a affich√©s en fonction des r√©sultats de la v√©rification. Le projet contient un grand nombre de fichiers de code source, il n'√©tait donc pas surprenant d'y trouver de nombreux moments suspects. Il n'y a rien √† faire - tout le monde fait des erreurs, mais il est important de tout mettre en ≈ìuvre pour les d√©tecter et les corriger en temps opportun. L'analyse statique peut grandement simplifier cette t√¢che. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la suite de la v√©rification, environ mille avertissements ont √©t√© affich√©s:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Image 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez en savoir plus sur les niveaux d'avertissement en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, tous les d√©clencheurs n'indiquent pas des erreurs super effrayantes. </font><font style="vertical-align: inherit;">S'il en √©tait ainsi, il serait peu probable qu'au moins quelque chose fonctionne dans le projet :). </font><font style="vertical-align: inherit;">Mais il est important de comprendre que si l‚Äôanalyseur ¬´jure¬ª, le code semble √©trange et doit √™tre soigneusement √©tudi√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, le projet a trouv√© de nombreux points positifs int√©ressants. </font><font style="vertical-align: inherit;">N√©anmoins, je ne voudrais pas que l'article soit tr√®s volumineux, nous n'en consid√©rerons donc que quelques-uns.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juste un ch√®que suppl√©mentaire?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expression 'dirpath == null' est toujours fausse. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette op√©ration peut √™tre envisag√©e de diff√©rentes mani√®res. D'une part, un contr√¥le suppl√©mentaire n'est bien s√ªr pas tr√®s bon, mais en soi ce n'est pas une erreur. D'un autre c√¥t√©, cela vaut la peine d'√™tre consid√©r√©: ce code fonctionne-t-il vraiment comme le programmeur l'avait pr√©vu? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que le d√©veloppeur ne savait vraiment pas que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne retournerait jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si ce n'est pas le cas, alors nous pouvons faire une hypoth√®se sur ce qu'il voulait r√©aliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devrait √™tre appel√© lorsqu'il n'est pas possible d'obtenir un parent pour le r√©pertoire en question. Si c'est le cas, v√©rifiez la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logique. </font><font style="vertical-align: inherit;">Cependant, nous devons consid√©rer non pas le r√©sultat de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais la valeur retourn√©e par la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinon, le retour de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent l√®ve</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une exception lors de l'appel √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null typique</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet 'item' a √©t√© utilis√© apr√®s avoir √©t√© v√©rifi√© par rapport √† null. V√©rifiez les lignes: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code semble √©trange en raison de ce qui se passe lorsque l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©l√©ment est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vraiment </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En effet, si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©galement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition est vraie et une tentative d'obtention de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.Id l√®vera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une exception. Et si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peut pas √™tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"c'est simplement superflu. C'est parce qu'il n'est v√©rifi√© que lorsque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eh bien, si soudainement l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©l√©ment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peut pas √™tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors la condition enti√®re perd son sens et ne fait qu'ajouter une imbrication inutile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense qu'ici, peut-√™tre le mauvais op√©rateur logique est s√©lectionn√©. Si vous remplacez "||" par "&amp;&amp;" dans la condition, le code commence imm√©diatement √† sembler logique. Eh bien, aucun probl√®me ne peut survenir dans ce cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©veloppement d'un tel plan sont des repr√©sentants typiques d'erreurs tr√®s dangereuses dans la th√©orie d√©tect√©es par l'analyseur En toute honn√™tet√©, il convient de noter que l'analyseur int√©gr√© √† Rider marque √©galement ce fragment comme potentiellement dangereux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore un ch√®que?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '_continuationState.Count&gt; 0' est toujours vraie. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, dans la condition externe, il est v√©rifi√© que le nombre d'√©l√©ments dans la collection est sup√©rieur √† 1, puis sur la ligne suivante, l'op√©rateur ternaire v√©rifie que leur nombre est sup√©rieur √† 0. Il semble que l'une des v√©rifications devrait √™tre diff√©rente. </font><font style="vertical-align: inherit;">D'une mani√®re ou d'une autre, ce code semble tr√®s suspect et doit √™tre soigneusement √©tudi√© et trait√© si n√©cessaire.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE possible</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet 'node.Indexer' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† null. V√©rifiez les lignes: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est un autre endroit que PVS-Studio et Rider consid√®rent suspect. Certes, la formulation est quelque peu diff√©rente: l'analyseur JetBrains met simplement en surbrillance le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le commentaire ¬´Possible NullReferenceException¬ª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux examinateurs affirment qu'une exception peut en effet √™tre lev√©e dans ce fragment. Je dois dire que l'avertissement de PVS-Studio indique non seulement qu'une erreur est possible ici, mais explique √©galement pourquoi il avait une telle opinion. Cela semble un peu, mais agr√©able.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, ce n'est pas un fait qu'il y a vraiment une erreur. </font><font style="vertical-align: inherit;">Il est possible que si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer soit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exactement sp√©cifi√©. </font><font style="vertical-align: inherit;">Dans ce cas, une situation est autoris√©e lorsque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer ne sont</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas tous deux </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuls</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce n'est que dans ce cas que le fonctionnement donn√© des deux analyseurs peut √™tre consid√©r√© comme faux. </font><font style="vertical-align: inherit;">Par cons√©quent, il vaut la peine d'analyser soigneusement toutes les options possibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si vous creusez plus profond√©ment?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression 'command! = Null' est toujours vrai. AsyncDocumentSession.Load.cs (175) Raven.Client Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
avertissement est √©mis car la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thode CreateRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne renvoie jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En fait, regardez simplement son code pour voir ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, cette v√©rification n'est pas un tel probl√®me, m√™me s'il se peut que la m√©thode utilis√©e pour retourner null dans certaines circonstances, mais maintenant elle l√®ve une exception. </font><font style="vertical-align: inherit;">Qui sait, il est possible qu'au lieu de cette v√©rification de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il y ait maintenant un try-catch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez avoir une question tr√®s raisonnable: o√π est l'exception lev√©e ici? </font><font style="vertical-align: inherit;">S'ils ne le sont pas, nous avons encore juste un ch√®que suppl√©mentaire, et il ne peut y avoir d'erreur ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais h√©las, lorsque la m√©thode est ex√©cut√©e, une exception peut en effet √™tre lev√©e, de plus, deux fois. </font><font style="vertical-align: inherit;">Tout d'abord dans la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, dans le constructeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copier-coller traditionnel</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deux fragments de code similaires ont √©t√© trouv√©s. C'est peut-√™tre une faute de frappe. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client Je </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
doute beaucoup qu'au moins quelqu'un verrait l'√©trange ici en regardant le code. La fonction se compose de 14 conditions similaires et toutes les variables se terminent par Updated. M√™me lorsqu'une petite partie est donn√©e ici, l'erreur n'est pas imm√©diatement visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cerveau humain refuse litt√©ralement de chercher quoi que ce soit dans un tel code. Dans le m√™me temps, PVS-Studio a facilement d√©couvert qu'il est attribu√©, tr√®s probablement, c'est compl√®tement faux, il devrait:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est logique que la ligne du bas √† droite de l'op√©rateur d'affectation soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je suis s√ªr que sans analyse statique, cette bizarrerie ne serait trouv√©e que si quelque chose d'assez grave s'√©tait bris√© √† cause de cela. </font><font style="vertical-align: inherit;">Le programmeur pourra remarquer qu'un probl√®me est cach√© dans cette fonction, sauf s'il le sait √† l'avance.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh √ßa "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peut-√™tre le '??' L'op√©rateur fonctionne d'une mani√®re diff√©rente de celle attendue. Sa priorit√© est inf√©rieure √† la priorit√© des autres op√©rateurs dans sa partie gauche. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, il reste la possibilit√© que ce ne soit pas du tout une erreur, c'est ainsi que cela √©tait pr√©vu. Et pourtant, cet endroit a l'air tr√®s suspect. Apr√®s tout, il est logique de supposer que l'id√©e de la fonction n'est pas de renvoyer 0 avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je pense qu'il y a vraiment une erreur li√©e aux priorit√©s des op√©rateurs. Dans ce cas, vous devez mettre les parenth√®ses:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, si tout d'un coup tout est vraiment planifi√©, alors cela vaut peut-√™tre la peine de le signaler explicitement - alors l'analyseur et les programmeurs qui liront le code n'auront aucune question:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais c'est une question de go√ªt, bien s√ªr.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passer des param√®tres</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordre incorrect possible des arguments pass√©s √† la m√©thode 'ValidateLicense': 'newLicense' et 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arguments transmis √† la m√©thode dans un ordre suspect. </font><font style="vertical-align: inherit;">En fait, jetez un ≈ìil √† l'annonce:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est tr√®s agr√©able que PVS-Studio puisse trouver m√™me de telles erreurs. </font><font style="vertical-align: inherit;">Ceci est un excellent exemple de la question des avantages de l'analyse statique sur l'analyse dynamique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nonobstant ce qui pr√©c√®de, j'ai d'abord sugg√©r√© qu'il importait peu dans quel ordre ces arguments √©taient transmis. </font><font style="vertical-align: inherit;">Bien s√ªr, dans ce cas, les noms n'auraient pas √©t√© choisis correctement, mais que pouvez-vous faire. </font><font style="vertical-align: inherit;">Cependant, la structure interne de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugg√®re que ces param√®tres ont toujours des significations diff√©rentes. </font><font style="vertical-align: inherit;">Le code de cette fonction peut √™tre consult√© en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne continuez jamais</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬´GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, out long value, out bool delete)¬ª est toujours fausse. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette m√©thode peut √™tre pleinement envisag√©e en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un avertissement indique qu'un appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans cette boucle est inaccessible. Et si c'est le cas, alors le fragment est vraiment √©trange. Mais c'est peut-√™tre juste un faux positif? Pourtant, Rider ne le jure pas. </font><i><font style="vertical-align: inherit;">Jetez un</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
≈ìil √† la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âvidemment, cette m√©thode ne peut retourner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que si la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le code consid√©r√© pr√©c√©demment, exactement le pointeur nul est pass√© √† la place de ce param√®tre. </font><font style="vertical-align: inherit;">Ainsi, l'appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">vraiment inaccessible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce moment peut √™tre √† la fois une omission inoffensive et un probl√®me associ√© √† une erreur de condition. </font><font style="vertical-align: inherit;">D'une mani√®re ou d'une autre, vous devriez y pr√™ter attention.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire confiance mais v√©rifier</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours vraie si elle est √©valu√©e: Attributs! = Null. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fragment extr√™mement √©trange. </font><font style="vertical-align: inherit;">Habituellement, les v√©rifications superflues sont au moins en quelque sorte s√©par√©es - ici la correspondance de la variable avec le pointeur nul est v√©rifi√©e directement dans les lignes suivantes. </font><font style="vertical-align: inherit;">Il semble que le code, tr√®s probablement, ne correspond pas du tout √† ce que le programmeur voulait.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nullable qui n'est jamais nul</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyseur Avertissement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression ¬´ suspend.HasValue ¬ª est toujours vrai. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre </font><font style="vertical-align: inherit;">v√©rification </font><font style="vertical-align: inherit;">"extra" apparemment inoffensive. </font><font style="vertical-align: inherit;">Bien qu'il ne soit pas encore clair pourquoi l'analyseur le consid√®re comme tel. </font><i><font style="vertical-align: inherit;">Tournez-vous</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
vers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, parfois cette fonction retourne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oui, et Rider n'a pas jug√© cette v√©rification inutile. </font><font style="vertical-align: inherit;">La licorne a-t-elle √©chou√©?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Image 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si vous regardez la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, si le param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera appel√©e </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je me demande ce qu'il fait? </font><font style="vertical-align: inherit;">:) Eh bien, de sorte qu'il ne fait aucun doute:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous r√©sumons. Le d√©veloppeur appelle la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il pense probablement que la m√©thode n'obtiendra peut-√™tre pas la valeur n√©cessaire. Eh bien, en cons√©quence, il renvoie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √Ä l'int√©rieur, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">appel√©</font></i><font style="vertical-align: inherit;"> . En cas de probl√®me, il retournera null ou l√®vera une exception. La seconde se produit si le param√®tre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">d√©fini sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De plus, c'est sa valeur par d√©faut. Dans le m√™me temps, lors de l'appel √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si vous regardez le code ci-dessus, il n'est tout simplement pas transmis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons une fois de plus le code de la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont l'analyseur a jur√© le fragment:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que, de par leur conception, le thread ne doit pas √™tre interrompu ici si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas pu obtenir la valeur. En fait, apr√®s un bloc avec une v√©rification de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diverses actions sont effectu√©es et une valeur est retourn√©e. Je crois que, par conception, ces actions sont effectu√©es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ind√©pendamment du</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> succ√®s de la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Que se passera-t-il r√©ellement? Un thread d'ex√©cution sera interrompu par une exception. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, vous devez passer un appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme deuxi√®me </font><font style="vertical-align: inherit;">valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requise </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, tout fonctionnera vraiment comme pr√©vu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit plus t√¥t, il semble parfois que l'analyseur se trompe (quel p√©ch√© √† cacher, parfois cela arrive). </font><font style="vertical-align: inherit;">√âgalement assez souvent, l'avertissement semble insignifiant. </font><font style="vertical-align: inherit;">Il semblerait qu'il y ait un contr√¥le suppl√©mentaire ici, et d'accord. </font><font style="vertical-align: inherit;">Eh bien, ou mieux encore - nous le supprimons et aucun probl√®me - l'avertissement dispara√Ætra! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me dans les cas o√π l'op√©ration semble √©trange et incompr√©hensible, ne la marquez pas √† la h√¢te comme fausse. </font><font style="vertical-align: inherit;">Vous devez essayer de comprendre pourquoi l'analyseur consid√®re que l'endroit est probl√©matique et prendre une d√©cision apr√®s cela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bizarreries</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : le </font><font style="vertical-align: inherit;">param√®tre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'numberOfResults' est toujours r√©√©crit dans le corps de la m√©thode avant d'√™tre utilis√©. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le param√®tre transmis √† la fonction n'est pas utilis√©, mais est imm√©diatement remplac√©. </font><font style="vertical-align: inherit;">Pourquoi est-il n√©cessaire ici? </font><font style="vertical-align: inherit;">Ils voulaient le faire passer par ref? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'√©tais curieux de voir comment cette m√©thode est utilis√©e dans le code existant. </font><font style="vertical-align: inherit;">J'esp√©rais que comme c'√©tait priv√©, il ne devait pas y en avoir trop. </font><font style="vertical-align: inherit;">Gr√¢ce √† Rider, j'ai facilement trouv√© o√π l'appel √©tait pass√©. </font><font style="vertical-align: inherit;">C'√©tait le seul endroit:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable est affect√©e de 0, puis elle est transmise √† la m√©thode, dont le r√©sultat lui est affect√©. </font><font style="vertical-align: inherit;">Et √† l'int√©rieur de la m√©thode, ce param√®tre n'est utilis√© en aucune fa√ßon. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">Pourquoi tout √ßa?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Image 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√©rateur logique incorrect</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expression 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' est toujours fausse. </font><font style="vertical-align: inherit;">Probablement le '||' </font><font style="vertical-align: inherit;">L'op√©rateur doit √™tre utilis√© ici. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√©thode compl√®te peut √™tre consult√©e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fois, nous avons une erreur √©vidente, qui consiste √† utiliser le mauvais op√©rateur logique. </font><font style="vertical-align: inherit;">Dans sa forme actuelle, la v√©rification du nombre d'arguments ne fonctionne tout simplement pas, car il n'y a pas de valeur inf√©rieure √† 2 et sup√©rieure √† 3. Les v√©ritables intentions du d√©veloppeur sont facilement r√©v√©l√©es par le premier argument pass√© au constructeur d'exceptions:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode d'essai √©trange</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours vraie si elle est √©valu√©e: isMethod. QueryParser.cs (1797) Raven.Server La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
m√©thode compl√®te peut √™tre vue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La construction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method (champ, m√©thode out var)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m'a rappel√© les m√©thodes standard comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De telles m√©thodes essaient d'obtenir le r√©sultat et de l'√©crire dans la variable out, et l'indicateur du succ√®s de l'op√©ration est la valeur de retour. Le code utilisant ces fonctions v√©rifie g√©n√©ralement la valeur de retour, puis effectue certaines op√©rations en fonction de celle-ci. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä mon avis, la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© ici de cette fa√ßon. Le r√©sultat de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en outre, est la valeur de retour de la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui l'appelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyseur indique que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod sera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toujours </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sa v√©rification dans la condition n'a pas de sens. Cela signifie que la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne renvoie jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Quelle est alors l'utilit√© d'une telle construction? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, assurez-vous que l'analyseur ne s'est pas tromp√©:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, la valeur de retour de cette m√©thode est toujours </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et si tout √©tait planifi√© tel quel, alors ... c'est √©trange, mais cela n'a pas d'importance, en principe. Mais sinon? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont le code peut √™tre affich√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l√®ve des exceptions dans certains cas. Cela se produit lorsqu'une m√©thode ne peut pas effectuer correctement sa t√¢che. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que le code appelant la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method n'est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas con√ßu pour lever des exceptions. Tr√®s probablement, il est suppos√© que lorsqu'il n'est pas possible d'obtenir correctement la valeur de la variable out, la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retourne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cependant, avec l'impl√©mentation actuelle, une exception sera lev√©e √† la place.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quoi qu'il en soit, il convient de pr√™ter attention √† ce fragment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null! = null?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours fausse si elle est √©valu√©e: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
variable se voit attribuer un pointeur nul, puis apr√®s quelques lignes, elle v√©rifie son in√©galit√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans ce cas, le code qui v√©rifie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devient vide de sens </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, une exception ne sera jamais lev√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est logique de supposer que quelque chose ne fonctionne pas comme il se doit, car le fragment a l'air tr√®s √©trange. </font><font style="vertical-align: inherit;">Soit la v√©rification n'est pas du tout n√©cessaire ici, soit elle est en quelque sorte mise en ≈ìuvre de mani√®re incorrecte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez envisager de d√©clencher et, d'autre part, aller du contraire. </font><font style="vertical-align: inherit;">Essayons d'imaginer une situation dans laquelle cette r√©ponse est fausse. </font><font style="vertical-align: inherit;">Je pense que cela n'est possible que si la valeur de la variable peut √™tre modifi√©e en appelant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cependant, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un champ priv√© et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une file d'attente standard qui est initialis√©e dans la m√™me classe. </font><font style="vertical-align: inherit;">Par cons√©quent, il est hautement douteux qu'un appel √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puisse en quelque sorte affecter la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par cons√©quent, le d√©clencheur n'est probablement pas faux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premier ou nul</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146 D√©r√©f√©rence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nulle possible de 'mainSchema'. Les 'Tables.FirstOrDefault' peuvent renvoyer la valeur nulle par d√©faut. DatabaseSchema.cs (31) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L' </font><font style="vertical-align: inherit;">op√©ration </font><font style="vertical-align: inherit;">, √† premi√®re vue, peut sembler incompr√©hensible. En effet, qu'est-ce que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a √† voir avec </font><i><font style="vertical-align: inherit;">cela</font></i><font style="vertical-align: inherit;"> ? Pour expliquer clairement pourquoi l'analyseur ne jure que, vous devez regarder la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un appel √† la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut √™tre d√ª au fait que la collection peut ne pas contenir d'√©l√©ments qui correspondent √† la condition sp√©cifi√©e. Dans ce cas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et, par cons√©quent, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renverra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableSchema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un type de r√©f√©rence. C'est pourquoi PVS-Studio dit que dans ce code, une tentative de d√©r√©f√©rencer un pointeur nul peut se produire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut √™tre utile de v√©rifier un tel cas afin que l'ex√©cution ne s'interrompe pas avec une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exception NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si l'option dans laquelle </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> impossible, il est inutile d'utiliser</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toujours vrai</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est toujours vraie. </font><font style="vertical-align: inherit;">L'op√©rateur '&amp;&amp;' devrait probablement √™tre utilis√© ici. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre exemple d'une situation o√π le mauvais op√©rateur logique est tr√®s probablement s√©lectionn√©. </font><font style="vertical-align: inherit;">Dans ce cas, la condition est toujours vraie, car la variable n'est certainement pas √©gale √† au moins une des valeurs auxquelles elle est compar√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je crois que "||" </font><font style="vertical-align: inherit;">doit √™tre remplac√© par "&amp;&amp;". </font><font style="vertical-align: inherit;">Ensuite, l'√©crit aura un sens. </font><font style="vertical-align: inherit;">Si l'op√©rateur logique est n√©anmoins choisi correctement, alors l'une des conditions devrait probablement √™tre une comparaison d'autres variables. </font><font style="vertical-align: inherit;">D'une mani√®re ou d'une autre, ce fragment semble tr√®s suspect et doit √™tre analys√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je tiens √† remercier tous ceux qui sont arriv√©s dans cet endroit. L'article √©tait assez long, mais j'esp√®re que vous souhaitiez travailler avec moi pour comprendre la nouvelle version de l'analyseur PVS-Studio et √©tudier les erreurs trouv√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de se rappeler que le d√©veloppeur doit se fixer comme objectif principal de ne pas r√©duire le nombre d'op√©rations. Pas pour obtenir un journal des erreurs vide, vous devez utiliser PVS-Studio. Lutter contre le positif, c'est comme combattre les sympt√¥mes d'une maladie dont souffre le code source.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous regardez les messages de l'analyseur, vous devez toujours essayer de comprendre pourquoi tel ou tel avertissement est √©mis. </font><font style="vertical-align: inherit;">Ce n'est qu'en r√©alisant la logique par laquelle l'analyseur a √©mis un avertissement que nous pouvons conclure s'il indique une erreur ou non. </font><font style="vertical-align: inherit;">C'est dans ce cas que vous ne combattrez pas avec le sympt√¥me, mais avec la maladie. </font><font style="vertical-align: inherit;">Et c'est ainsi que votre code deviendra plus propre et plus sain. </font><font style="vertical-align: inherit;">Et bien s√ªr, il y aura beaucoup moins de probl√®mes avec une si bonne source. </font><font style="vertical-align: inherit;">Bien que ce soit mieux, je vous souhaite de ne pas les avoir du tout :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Image 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment trouver des erreurs dans un projet C # fonctionnant sous Linux et macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr507086/index.html">Convertir le script Bash en code C # pour envoyer des SMS via le modem USB HUAWEI E3372</a></li>
<li><a href="../fr507090/index.html">Comment une √©quipe technique peut-elle construire sa startup ou le chemin de la surveillance fonctionnelle √† la plateforme AIOps</a></li>
<li><a href="../fr507092/index.html">Nous vous invitons √† la deuxi√®me mitap Zabbix en ligne</a></li>
<li><a href="../fr507104/index.html">La grande division de l'importation: clarifier l'incertitude avec l'importation dans Typescript</a></li>
<li><a href="../fr507106/index.html">Comment est la mise en ≈ìuvre de DNS sur HTTPS</a></li>
<li><a href="../fr507112/index.html">PayOnline | Acquisition d'Internet pour les entreprises</a></li>
<li><a href="../fr507114/index.html">Ode Excel: 34 ans de magie</a></li>
<li><a href="../fr507116/index.html">"Udalenka". Notes du d√©veloppeur de bureau d'hier. Partie 2</a></li>
<li><a href="../fr507124/index.html">PDB n'est pas seulement une fourrure pr√©cieuse</a></li>
<li><a href="../fr507132/index.html">Vladimir Kitov: ¬´Il est impossible de comprendre comment des scientifiques pionniers pr√©voyaient l'informatisation universelle dans les ann√©es 1950!¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>