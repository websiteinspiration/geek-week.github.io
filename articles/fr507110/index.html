<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍✈️ 🏳️‍🌈 🎱 Comment trouver des erreurs dans un projet C #, fonctionnant sous Linux et macOS 🔷 👴🏽 👩🏼‍🤝‍👨🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio est un analyseur de code statique bien connu qui vous permet de trouver de nombreuses erreurs délicates cachées dans la source. Le test bêt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment trouver des erreurs dans un projet C #, fonctionnant sous Linux et macOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Image 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio est un analyseur de code statique bien connu qui vous permet de trouver de nombreuses erreurs délicates cachées dans la source. </font><font style="vertical-align: inherit;">Le test bêta de la nouvelle version est récemment terminé, dans lequel il est possible d'analyser des projets C # pour Linux et macOS. </font><font style="vertical-align: inherit;">De plus, l'analyseur peut désormais être intégré à JetBrains Cross-Platform IDE - Rider. </font><font style="vertical-align: inherit;">Cet article vous permettra de vous familiariser avec ces fonctionnalités sur l'exemple de vérification du projet open source RavenDB.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, mon collègue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> écrit une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">note</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'ouverture d'un test bêta d'une nouvelle version de l'analyseur statique PVS-Studio que nous développons. </font><font style="vertical-align: inherit;">Le test bêta est maintenant terminé et la nouvelle version peut être téléchargée en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le même article, nous verrons comment analyser les projets C # sous Linux / macOS à l'aide de l'interface de la console et de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Après cela, nous effectuerons une analyse traditionnelle de certaines opérations intéressantes de l'analyseur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Image 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vérification, un projet RavenDB ouvert a été choisi, dont le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> totalise près de 5 000 fichiers de code source. </font><font style="vertical-align: inherit;">Il s'agit d'une base de données NoSQL assez populaire. </font><font style="vertical-align: inherit;">Les détails peuvent être trouvés sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est facile de deviner que j'ai été attiré par sa taille, car dans un projet aussi grand et, sans aucun doute, sérieux, il y aura probablement quelque chose d'intéressant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface de ligne de commande</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, réfléchissez à la manière d'analyser via la console. </font><font style="vertical-align: inherit;">Cette section, à mon avis, sera particulièrement intéressante pour ceux qui souhaitent intégrer l'analyseur dans le système CI. </font><font style="vertical-align: inherit;">L'équipe qui démarre l'analyse a un certain nombre d'options intéressantes, mais dans le cas général, tout est assez trivial. </font><font style="vertical-align: inherit;">Pour analyser RavenDB, je vais dans le dossier du projet et saisis ce qui suit dans la console:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur -t (abréviation de target) est utilisé pour spécifier une solution ou un fichier de projet à vérifier. </font><font style="vertical-align: inherit;">La ligne présentée ci-dessus démarre l'analyse et, à la suite du travail, forme un fichier contenant les erreurs trouvées. </font><font style="vertical-align: inherit;">C'est simple, non?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cavalier</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de l'analyseur dans Rider est à peu près la même que dans Visual Studio. </font><font style="vertical-align: inherit;">L'interface simple et intuitive du plugin vous permet de vérifier le projet en quelques clics. </font><font style="vertical-align: inherit;">Ce n'est pas une exagération - pour effectuer une analyse RavenDB, je n'ai eu qu'à cliquer sur le menu principal Outils, pointer sur «PVS-Studio» et cliquer sur «Vérifier la solution / le projet actuel».</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Image 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les résultats de l'analyse seront affichés en bas de la fenêtre sur l'onglet PVS-Studio (enfin, lequel d'autre? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Image 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme pour le plug-in pour Visual Studio, un double-clic sur un avertissement affichera l'emplacement auquel il est associé. Tout est pratique et compréhensible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus important encore, l'outil PVS-Studio indique non seulement des erreurs, mais possède également une infrastructure qui facilite la mise en œuvre de la méthodologie d'analyse statique, même dans un grand projet ancien.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée générale est la suivante. L'utilisateur a démarré l'analyseur et a reçu de nombreux avertissements. Étant donné qu'un projet développé depuis de nombreuses années, est vivant, se développe et fait de l'argent, il est fort probable qu'il n'y aura pas beaucoup d'avertissements dans le rapport indiquant des défauts critiques. En d'autres termes, les bogues critiques ont déjà été corrigés d'une manière ou d'une autre de manière plus coûteuse ou grâce aux commentaires des clients. En conséquence, tout ce que l'analyseur trouve maintenant peut être considéré comme une dette technique, ce qui n'est pas pratique pour essayer de l'éliminer immédiatement. Il est rationnel d'ignorer ces avertissements pour l'instant, mais d'écrire du nouveau code effectuant déjà une analyse régulière.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez demander à PVS-Studio de considérer ces avertissements comme non pertinents (reporter la dette technique pour plus tard) et de ne plus les afficher. L'analyseur crée un fichier spécial où il stocke des informations sur les erreurs jusqu'ici inintéressantes. Et maintenant, PVS-Studio émettra des avertissements uniquement sur le code nouveau ou modifié. De plus, tout cela est mis en œuvre intelligemment. Si, par exemple, une ligne vide est ajoutée au début d'un fichier, l'analyseur comprend que, en fait, rien n'a changé et restera silencieux. Ce fichier de balisage peut être intégré dans le système de contrôle de version. Le fichier est volumineux, mais ce n'est pas effrayant, car il est souvent inutile de le poser.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Désormais, tous les programmeurs verront des avertissements liés uniquement au code nouveau ou modifié. Ainsi, l'analyseur peut commencer à utiliser ce qu'on appelle le lendemain. Et il sera possible de revenir plus tard à la dette technique, de corriger progressivement les erreurs et de configurer l'analyseur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour supprimer les avertissements sur le code existant dans Rider, allez simplement dans le menu supérieur dans Outils-&gt; PVS-Studio et cliquez sur "Supprimer tous les messages".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Image 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la fenêtre qui apparaît, vous avertissant que toutes les opérations en cours tomberont dans la liste de suppression, cliquez sur «Ok». </font><font style="vertical-align: inherit;">En conséquence, un fichier de suppression sera créé dans le dossier du projet, qui sera pris en compte par l'analyseur lors des travaux ultérieurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que Rider dispose déjà d'un analyseur qui met en évidence avec succès certaines erreurs. </font><font style="vertical-align: inherit;">Ainsi, une série d'avertissements de PVS-Studio pointe vers un code qui semble suspect du point de vue de l'éditeur. </font><font style="vertical-align: inherit;">Néanmoins, PVS-Studio trouve assez souvent des erreurs qui pourraient échapper à l'œil sensible de l'analyseur de JetBrains. </font><font style="vertical-align: inherit;">C'est pourquoi la solution la plus efficace est de leur permettre de travailler en équipe.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Image 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et pour le dessert</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, comme promis, nous allons considérer quels avertissements intéressants l'analyseur a affichés en fonction des résultats de la vérification. Le projet contient un grand nombre de fichiers de code source, il n'était donc pas surprenant d'y trouver de nombreux moments suspects. Il n'y a rien à faire - tout le monde fait des erreurs, mais il est important de tout mettre en œuvre pour les détecter et les corriger en temps opportun. L'analyse statique peut grandement simplifier cette tâche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la suite de la vérification, environ mille avertissements ont été affichés:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Image 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez en savoir plus sur les niveaux d'avertissement en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, tous les déclencheurs n'indiquent pas des erreurs super effrayantes. </font><font style="vertical-align: inherit;">S'il en était ainsi, il serait peu probable qu'au moins quelque chose fonctionne dans le projet :). </font><font style="vertical-align: inherit;">Mais il est important de comprendre que si l’analyseur «jure», le code semble étrange et doit être soigneusement étudié. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, le projet a trouvé de nombreux points positifs intéressants. </font><font style="vertical-align: inherit;">Néanmoins, je ne voudrais pas que l'article soit très volumineux, nous n'en considérerons donc que quelques-uns.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juste un chèque supplémentaire?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expression 'dirpath == null' est toujours fausse. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette opération peut être envisagée de différentes manières. D'une part, un contrôle supplémentaire n'est bien sûr pas très bon, mais en soi ce n'est pas une erreur. D'un autre côté, cela vaut la peine d'être considéré: ce code fonctionne-t-il vraiment comme le programmeur l'avait prévu? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être que le développeur ne savait vraiment pas que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne retournerait jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si ce n'est pas le cas, alors nous pouvons faire une hypothèse sur ce qu'il voulait réaliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devrait être appelé lorsqu'il n'est pas possible d'obtenir un parent pour le répertoire en question. Si c'est le cas, vérifiez la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logique. </font><font style="vertical-align: inherit;">Cependant, nous devons considérer non pas le résultat de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais la valeur retournée par la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinon, le retour de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent lève</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une exception lors de l'appel à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null typique</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet 'item' a été utilisé après avoir été vérifié par rapport à null. Vérifiez les lignes: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code semble étrange en raison de ce qui se passe lorsque l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vraiment </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En effet, si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> également </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition est vraie et une tentative d'obtention de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.Id lèvera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une exception. Et si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peut pas être </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"c'est simplement superflu. C'est parce qu'il n'est vérifié que lorsque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eh bien, si soudainement l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peut pas être </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors la condition entière perd son sens et ne fait qu'ajouter une imbrication inutile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense qu'ici, peut-être le mauvais opérateur logique est sélectionné. Si vous remplacez "||" par "&amp;&amp;" dans la condition, le code commence immédiatement à sembler logique. Eh bien, aucun problème ne peut survenir dans ce cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le développement d'un tel plan sont des représentants typiques d'erreurs très dangereuses dans la théorie détectées par l'analyseur En toute honnêteté, il convient de noter que l'analyseur intégré à Rider marque également ce fragment comme potentiellement dangereux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore un chèque?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '_continuationState.Count&gt; 0' est toujours vraie. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, dans la condition externe, il est vérifié que le nombre d'éléments dans la collection est supérieur à 1, puis sur la ligne suivante, l'opérateur ternaire vérifie que leur nombre est supérieur à 0. Il semble que l'une des vérifications devrait être différente. </font><font style="vertical-align: inherit;">D'une manière ou d'une autre, ce code semble très suspect et doit être soigneusement étudié et traité si nécessaire.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE possible</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'objet 'node.Indexer' a été utilisé avant d'être vérifié par rapport à null. Vérifiez les lignes: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est un autre endroit que PVS-Studio et Rider considèrent suspect. Certes, la formulation est quelque peu différente: l'analyseur JetBrains met simplement en surbrillance le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer.DeclaringType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le commentaire «Possible NullReferenceException». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux examinateurs affirment qu'une exception peut en effet être levée dans ce fragment. Je dois dire que l'avertissement de PVS-Studio indique non seulement qu'une erreur est possible ici, mais explique également pourquoi il avait une telle opinion. Cela semble un peu, mais agréable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, ce n'est pas un fait qu'il y a vraiment une erreur. </font><font style="vertical-align: inherit;">Il est possible que si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer soit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exactement spécifié. </font><font style="vertical-align: inherit;">Dans ce cas, une situation est autorisée lorsque </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer ne sont</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas tous deux </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuls</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce n'est que dans ce cas que le fonctionnement donné des deux analyseurs peut être considéré comme faux. </font><font style="vertical-align: inherit;">Par conséquent, il vaut la peine d'analyser soigneusement toutes les options possibles.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si vous creusez plus profondément?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression 'command! = Null' est toujours vrai. AsyncDocumentSession.Load.cs (175) Raven.Client Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
avertissement est émis car la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode CreateRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne renvoie jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En fait, regardez simplement son code pour voir ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, cette vérification n'est pas un tel problème, même s'il se peut que la méthode utilisée pour retourner null dans certaines circonstances, mais maintenant elle lève une exception. </font><font style="vertical-align: inherit;">Qui sait, il est possible qu'au lieu de cette vérification de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il y ait maintenant un try-catch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez avoir une question très raisonnable: où est l'exception levée ici? </font><font style="vertical-align: inherit;">S'ils ne le sont pas, nous avons encore juste un chèque supplémentaire, et il ne peut y avoir d'erreur ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais hélas, lorsque la méthode est exécutée, une exception peut en effet être levée, de plus, deux fois. </font><font style="vertical-align: inherit;">Tout d'abord dans la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, dans le constructeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copier-coller traditionnel</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deux fragments de code similaires ont été trouvés. C'est peut-être une faute de frappe. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client Je </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
doute beaucoup qu'au moins quelqu'un verrait l'étrange ici en regardant le code. La fonction se compose de 14 conditions similaires et toutes les variables se terminent par Updated. Même lorsqu'une petite partie est donnée ici, l'erreur n'est pas immédiatement visible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cerveau humain refuse littéralement de chercher quoi que ce soit dans un tel code. Dans le même temps, PVS-Studio a facilement découvert qu'il est attribué, très probablement, c'est complètement faux, il devrait:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est logique que la ligne du bas à droite de l'opérateur d'affectation soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je suis sûr que sans analyse statique, cette bizarrerie ne serait trouvée que si quelque chose d'assez grave s'était brisé à cause de cela. </font><font style="vertical-align: inherit;">Le programmeur pourra remarquer qu'un problème est caché dans cette fonction, sauf s'il le sait à l'avance.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh ça "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peut-être le '??' L'opérateur fonctionne d'une manière différente de celle attendue. Sa priorité est inférieure à la priorité des autres opérateurs dans sa partie gauche. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il reste la possibilité que ce ne soit pas du tout une erreur, c'est ainsi que cela était prévu. Et pourtant, cet endroit a l'air très suspect. Après tout, il est logique de supposer que l'idée de la fonction n'est pas de renvoyer 0 avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Je pense qu'il y a vraiment une erreur liée aux priorités des opérateurs. Dans ce cas, vous devez mettre les parenthèses:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, si tout d'un coup tout est vraiment planifié, alors cela vaut peut-être la peine de le signaler explicitement - alors l'analyseur et les programmeurs qui liront le code n'auront aucune question:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais c'est une question de goût, bien sûr.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passer des paramètres</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordre incorrect possible des arguments passés à la méthode 'ValidateLicense': 'newLicense' et 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arguments transmis à la méthode dans un ordre suspect. </font><font style="vertical-align: inherit;">En fait, jetez un œil à l'annonce:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est très agréable que PVS-Studio puisse trouver même de telles erreurs. </font><font style="vertical-align: inherit;">Ceci est un excellent exemple de la question des avantages de l'analyse statique sur l'analyse dynamique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nonobstant ce qui précède, j'ai d'abord suggéré qu'il importait peu dans quel ordre ces arguments étaient transmis. </font><font style="vertical-align: inherit;">Bien sûr, dans ce cas, les noms n'auraient pas été choisis correctement, mais que pouvez-vous faire. </font><font style="vertical-align: inherit;">Cependant, la structure interne de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suggère que ces paramètres ont toujours des significations différentes. </font><font style="vertical-align: inherit;">Le code de cette fonction peut être consulté en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne continuez jamais</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, out long value, out bool delete)» est toujours fausse. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette méthode peut être pleinement envisagée en cliquant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un avertissement indique qu'un appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans cette boucle est inaccessible. Et si c'est le cas, alors le fragment est vraiment étrange. Mais c'est peut-être juste un faux positif? Pourtant, Rider ne le jure pas. </font><i><font style="vertical-align: inherit;">Jetez un</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
œil à la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Évidemment, cette méthode ne peut retourner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que si la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le code considéré précédemment, exactement le pointeur nul est passé à la place de ce paramètre. </font><font style="vertical-align: inherit;">Ainsi, l'appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">vraiment inaccessible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce moment peut être à la fois une omission inoffensive et un problème associé à une erreur de condition. </font><font style="vertical-align: inherit;">D'une manière ou d'une autre, vous devriez y prêter attention.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire confiance mais vérifier</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours vraie si elle est évaluée: Attributs! = Null. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un fragment extrêmement étrange. </font><font style="vertical-align: inherit;">Habituellement, les vérifications superflues sont au moins en quelque sorte séparées - ici la correspondance de la variable avec le pointeur nul est vérifiée directement dans les lignes suivantes. </font><font style="vertical-align: inherit;">Il semble que le code, très probablement, ne correspond pas du tout à ce que le programmeur voulait.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nullable qui n'est jamais nul</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyseur Avertissement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression « suspend.HasValue » est toujours vrai. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre </font><font style="vertical-align: inherit;">vérification </font><font style="vertical-align: inherit;">"extra" apparemment inoffensive. </font><font style="vertical-align: inherit;">Bien qu'il ne soit pas encore clair pourquoi l'analyseur le considère comme tel. </font><i><font style="vertical-align: inherit;">Tournez-vous</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
vers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, parfois cette fonction retourne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oui, et Rider n'a pas jugé cette vérification inutile. </font><font style="vertical-align: inherit;">La licorne a-t-elle échoué?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Image 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si vous regardez la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, si le paramètre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera appelée </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Je me demande ce qu'il fait? </font><font style="vertical-align: inherit;">:) Eh bien, de sorte qu'il ne fait aucun doute:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous résumons. Le développeur appelle la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il pense probablement que la méthode n'obtiendra peut-être pas la valeur nécessaire. Eh bien, en conséquence, il renvoie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . À l'intérieur, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">appelé</font></i><font style="vertical-align: inherit;"> . En cas de problème, il retournera null ou lèvera une exception. La seconde se produit si le paramètre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">défini sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De plus, c'est sa valeur par défaut. Dans le même temps, lors de l'appel à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si vous regardez le code ci-dessus, il n'est tout simplement pas transmis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons une fois de plus le code de la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont l'analyseur a juré le fragment:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que, de par leur conception, le thread ne doit pas être interrompu ici si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a pas pu obtenir la valeur. En fait, après un bloc avec une vérification de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diverses actions sont effectuées et une valeur est retournée. Je crois que, par conception, ces actions sont effectuées </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indépendamment du</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> succès de la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Que se passera-t-il réellement? Un thread d'exécution sera interrompu par une exception. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, vous devez passer un appel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme deuxième </font><font style="vertical-align: inherit;">valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requise </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ensuite, tout fonctionnera vraiment comme prévu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai dit plus tôt, il semble parfois que l'analyseur se trompe (quel péché à cacher, parfois cela arrive). </font><font style="vertical-align: inherit;">Également assez souvent, l'avertissement semble insignifiant. </font><font style="vertical-align: inherit;">Il semblerait qu'il y ait un contrôle supplémentaire ici, et d'accord. </font><font style="vertical-align: inherit;">Eh bien, ou mieux encore - nous le supprimons et aucun problème - l'avertissement disparaîtra! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Même dans les cas où l'opération semble étrange et incompréhensible, ne la marquez pas à la hâte comme fausse. </font><font style="vertical-align: inherit;">Vous devez essayer de comprendre pourquoi l'analyseur considère que l'endroit est problématique et prendre une décision après cela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bizarreries</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : le </font><font style="vertical-align: inherit;">paramètre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'numberOfResults' est toujours réécrit dans le corps de la méthode avant d'être utilisé. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le paramètre transmis à la fonction n'est pas utilisé, mais est immédiatement remplacé. </font><font style="vertical-align: inherit;">Pourquoi est-il nécessaire ici? </font><font style="vertical-align: inherit;">Ils voulaient le faire passer par ref? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'étais curieux de voir comment cette méthode est utilisée dans le code existant. </font><font style="vertical-align: inherit;">J'espérais que comme c'était privé, il ne devait pas y en avoir trop. </font><font style="vertical-align: inherit;">Grâce à Rider, j'ai facilement trouvé où l'appel était passé. </font><font style="vertical-align: inherit;">C'était le seul endroit:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable est affectée de 0, puis elle est transmise à la méthode, dont le résultat lui est affecté. </font><font style="vertical-align: inherit;">Et à l'intérieur de la méthode, ce paramètre n'est utilisé en aucune façon. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">Pourquoi tout ça?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Image 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opérateur logique incorrect</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expression 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' est toujours fausse. </font><font style="vertical-align: inherit;">Probablement le '||' </font><font style="vertical-align: inherit;">L'opérateur doit être utilisé ici. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
méthode complète peut être consultée </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fois, nous avons une erreur évidente, qui consiste à utiliser le mauvais opérateur logique. </font><font style="vertical-align: inherit;">Dans sa forme actuelle, la vérification du nombre d'arguments ne fonctionne tout simplement pas, car il n'y a pas de valeur inférieure à 2 et supérieure à 3. Les véritables intentions du développeur sont facilement révélées par le premier argument passé au constructeur d'exceptions:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode d'essai étrange</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours vraie si elle est évaluée: isMethod. QueryParser.cs (1797) Raven.Server La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
méthode complète peut être vue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La construction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Method (champ, méthode out var)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m'a rappelé les méthodes standard comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De telles méthodes essaient d'obtenir le résultat et de l'écrire dans la variable out, et l'indicateur du succès de l'opération est la valeur de retour. Le code utilisant ces fonctions vérifie généralement la valeur de retour, puis effectue certaines opérations en fonction de celle-ci. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À mon avis, la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisé ici de cette façon. Le résultat de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">méthode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en outre, est la valeur de retour de la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui l'appelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyseur indique que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod sera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toujours </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sa vérification dans la condition n'a pas de sens. Cela signifie que la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne renvoie jamais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Quelle est alors l'utilité d'une telle construction? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, assurez-vous que l'analyseur ne s'est pas trompé:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, la valeur de retour de cette méthode est toujours </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et si tout était planifié tel quel, alors ... c'est étrange, mais cela n'a pas d'importance, en principe. Mais sinon? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont le code peut être affiché </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lève des exceptions dans certains cas. Cela se produit lorsqu'une méthode ne peut pas effectuer correctement sa tâche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que le code appelant la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method n'est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas conçu pour lever des exceptions. Très probablement, il est supposé que lorsqu'il n'est pas possible d'obtenir correctement la valeur de la variable out, la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retourne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cependant, avec l'implémentation actuelle, une exception sera levée à la place.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quoi qu'il en soit, il convient de prêter attention à ce fragment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null! = null?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une partie de l'expression conditionnelle est toujours fausse si elle est évaluée: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug La </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
variable se voit attribuer un pointeur nul, puis après quelques lignes, elle vérifie son inégalité </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans ce cas, le code qui vérifie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devient vide de sens </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De plus, une exception ne sera jamais levée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est logique de supposer que quelque chose ne fonctionne pas comme il se doit, car le fragment a l'air très étrange. </font><font style="vertical-align: inherit;">Soit la vérification n'est pas du tout nécessaire ici, soit elle est en quelque sorte mise en œuvre de manière incorrecte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez envisager de déclencher et, d'autre part, aller du contraire. </font><font style="vertical-align: inherit;">Essayons d'imaginer une situation dans laquelle cette réponse est fausse. </font><font style="vertical-align: inherit;">Je pense que cela n'est possible que si la valeur de la variable peut être modifiée en appelant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cependant, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un champ privé et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une file d'attente standard qui est initialisée dans la même classe. </font><font style="vertical-align: inherit;">Par conséquent, il est hautement douteux qu'un appel à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puisse en quelque sorte affecter la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par conséquent, le déclencheur n'est probablement pas faux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premier ou nul</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146 Déréférence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nulle possible de 'mainSchema'. Les 'Tables.FirstOrDefault' peuvent renvoyer la valeur nulle par défaut. DatabaseSchema.cs (31) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L' </font><font style="vertical-align: inherit;">opération </font><font style="vertical-align: inherit;">, à première vue, peut sembler incompréhensible. En effet, qu'est-ce que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a à voir avec </font><i><font style="vertical-align: inherit;">cela</font></i><font style="vertical-align: inherit;"> ? Pour expliquer clairement pourquoi l'analyseur ne jure que, vous devez regarder la fonction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un appel à la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut être dû au fait que la collection peut ne pas contenir d'éléments qui correspondent à la condition spécifiée. Dans ce cas, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et, par conséquent, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renverra </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableSchema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un type de référence. C'est pourquoi PVS-Studio dit que dans ce code, une tentative de déréférencer un pointeur nul peut se produire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il peut être utile de vérifier un tel cas afin que l'exécution ne s'interrompe pas avec une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exception NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si l'option dans laquelle </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> impossible, il est inutile d'utiliser</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toujours vrai</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement de l'analyseur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l' </font><font style="vertical-align: inherit;">expression </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est toujours vraie. </font><font style="vertical-align: inherit;">L'opérateur '&amp;&amp;' devrait probablement être utilisé ici. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre exemple d'une situation où le mauvais opérateur logique est très probablement sélectionné. </font><font style="vertical-align: inherit;">Dans ce cas, la condition est toujours vraie, car la variable n'est certainement pas égale à au moins une des valeurs auxquelles elle est comparée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je crois que "||" </font><font style="vertical-align: inherit;">doit être remplacé par "&amp;&amp;". </font><font style="vertical-align: inherit;">Ensuite, l'écrit aura un sens. </font><font style="vertical-align: inherit;">Si l'opérateur logique est néanmoins choisi correctement, alors l'une des conditions devrait probablement être une comparaison d'autres variables. </font><font style="vertical-align: inherit;">D'une manière ou d'une autre, ce fragment semble très suspect et doit être analysé.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, je tiens à remercier tous ceux qui sont arrivés dans cet endroit. L'article était assez long, mais j'espère que vous souhaitiez travailler avec moi pour comprendre la nouvelle version de l'analyseur PVS-Studio et étudier les erreurs trouvées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de se rappeler que le développeur doit se fixer comme objectif principal de ne pas réduire le nombre d'opérations. Pas pour obtenir un journal des erreurs vide, vous devez utiliser PVS-Studio. Lutter contre le positif, c'est comme combattre les symptômes d'une maladie dont souffre le code source.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous regardez les messages de l'analyseur, vous devez toujours essayer de comprendre pourquoi tel ou tel avertissement est émis. </font><font style="vertical-align: inherit;">Ce n'est qu'en réalisant la logique par laquelle l'analyseur a émis un avertissement que nous pouvons conclure s'il indique une erreur ou non. </font><font style="vertical-align: inherit;">C'est dans ce cas que vous ne combattrez pas avec le symptôme, mais avec la maladie. </font><font style="vertical-align: inherit;">Et c'est ainsi que votre code deviendra plus propre et plus sain. </font><font style="vertical-align: inherit;">Et bien sûr, il y aura beaucoup moins de problèmes avec une si bonne source. </font><font style="vertical-align: inherit;">Bien que ce soit mieux, je vous souhaite de ne pas les avoir du tout :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Image 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment trouver des erreurs dans un projet C # fonctionnant sous Linux et macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr507086/index.html">Convertir le script Bash en code C # pour envoyer des SMS via le modem USB HUAWEI E3372</a></li>
<li><a href="../fr507090/index.html">Comment une équipe technique peut-elle construire sa startup ou le chemin de la surveillance fonctionnelle à la plateforme AIOps</a></li>
<li><a href="../fr507092/index.html">Nous vous invitons à la deuxième mitap Zabbix en ligne</a></li>
<li><a href="../fr507104/index.html">La grande division de l'importation: clarifier l'incertitude avec l'importation dans Typescript</a></li>
<li><a href="../fr507106/index.html">Comment est la mise en œuvre de DNS sur HTTPS</a></li>
<li><a href="../fr507112/index.html">PayOnline | Acquisition d'Internet pour les entreprises</a></li>
<li><a href="../fr507114/index.html">Ode Excel: 34 ans de magie</a></li>
<li><a href="../fr507116/index.html">"Udalenka". Notes du développeur de bureau d'hier. Partie 2</a></li>
<li><a href="../fr507124/index.html">PDB n'est pas seulement une fourrure précieuse</a></li>
<li><a href="../fr507132/index.html">Vladimir Kitov: «Il est impossible de comprendre comment des scientifiques pionniers prévoyaient l'informatisation universelle dans les années 1950!»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>