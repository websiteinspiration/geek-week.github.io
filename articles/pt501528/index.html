<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöò ‚öîÔ∏è üåì O livro "Bash e seguran√ßa cibern√©tica: ataque, defesa e an√°lise a partir da linha de comando do Linux" üìå üëÇüèΩ üë®‚Äçüë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°, habrozhiteli! A linha de comando pode ser uma ferramenta ideal para seguran√ßa cibern√©tica. A flexibilidade incr√≠vel e a disponibilidade absoluta ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>O livro "Bash e seguran√ßa cibern√©tica: ataque, defesa e an√°lise a partir da linha de comando do Linux"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/501528/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/xx/ml/ir/xxmlirxciwbxahmteiy-9cslfxg.jpeg" align="left" alt="imagem"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√°, habrozhiteli! </font><font style="vertical-align: inherit;">A linha de comando pode ser uma ferramenta ideal para seguran√ßa cibern√©tica. </font><font style="vertical-align: inherit;">A flexibilidade incr√≠vel e a disponibilidade absoluta transformam a interface da linha de comando padr√£o (CLI) em uma solu√ß√£o fundamental se voc√™ tiver a experi√™ncia apropriada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os autores Paul Tronkon e Karl Albing falam sobre ferramentas e truques da linha de comando que ajudam a coletar dados com prote√ß√£o proativa, analisar logs e monitorar o status da rede. </font><font style="vertical-align: inherit;">Os pentesters aprender√£o como realizar ataques usando funcionalidade colossal incorporada a quase qualquer vers√£o do Linux.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para quem √© este livro?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O livro "Bash and cybersecurity" √© destinado a quem deseja aprender a trabalhar com a linha de comando no contexto de seguran√ßa de computadores. </font><font style="vertical-align: inherit;">Nosso objetivo n√£o √© substituir as ferramentas existentes por scripts de linha de comando, mas ensin√°-lo a usar efetivamente a linha de comando para melhorar a funcionalidade existente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao longo do livro, fornecemos exemplos de m√©todos de seguran√ßa, como coleta de dados, an√°lise e teste de penetra√ß√£o. </font><font style="vertical-align: inherit;">O objetivo desses exemplos √© demonstrar os recursos da linha de comando e apresentar alguns dos m√©todos fundamentais usados ‚Äã‚Äãnas ferramentas de n√≠vel superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este livro n√£o √© uma introdu√ß√£o √† programa√ß√£o, embora alguns conceitos gerais sejam abordados na Parte I.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento de log em tempo real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A capacidade de analisar uma revista ap√≥s a ocorr√™ncia de um evento √© uma habilidade importante. </font><font style="vertical-align: inherit;">Mas √© igualmente importante poder extrair informa√ß√µes do arquivo de log em tempo real para detectar a√ß√µes maliciosas ou suspeitas no momento em que ocorrem. </font><font style="vertical-align: inherit;">Neste cap√≠tulo, consideraremos m√©todos para a leitura de lan√ßamentos no di√°rio, √† medida que s√£o criados e formatados para exibir an√°lises e gerar alertas com base em indicadores de amea√ßas conhecidos para a opera√ß√£o de um sistema ou rede (indicadores de comprometimento).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento de log de texto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de monitorar o log em tempo real √© usar o comando tail com o par√¢metro ‚Äìf - ele l√™ o arquivo continuamente e os exibe em stdout √† medida que novas linhas s√£o adicionadas. Como nos cap√≠tulos anteriores, por exemplo, usaremos o log de acesso do servidor web Apache, mas os m√©todos descritos s√£o relevantes para qualquer log de texto. Para rastrear o log de acesso do Apache usando o comando tail, digite o seguinte: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sa√≠da do comando tail pode ser passada para o comando grep, para que apenas os registros correspondentes a determinados crit√©rios sejam exibidos. O exemplo a seguir rastreia o log de acesso do Apache e exibe entradas correspondentes a um endere√ßo IP espec√≠fico:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | grep '10.0.0.152'<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ tamb√©m pode usar express√µes regulares. Neste exemplo, apenas os registros retornando o c√≥digo de status HTTP 404 "P√°gina n√£o encontrada" ser√£o exibidos; a op√ß√£o -i √© adicionada para ignorar mai√∫sculas e min√∫sculas de caracteres: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i 'HTTP/.*" 404'</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para limpar informa√ß√µes estranhas, a sa√≠da deve ser passada para o comando recortar. Este exemplo monitora o log de acesso para consultas que levam ao c√≥digo de status 404 e, em seguida, usa o m√©todo de corte para exibir apenas a data / hora e a p√°gina solicitada: </font><font style="vertical-align: inherit;">
Em seguida, para remover colchetes e aspas duplas, voc√™ pode direcionar a sa√≠da para tr -d ' [] "'.</font></font><br>
<br>
<code>$ tail -f access.log | egrep --line-buffered 'HTTP/.*" 404' | cut -d' ' -f4-7<br>
[29/Jul/2018:13:10:05 -0400] "GET /test<br>
[29/Jul/2018:13:16:17 -0400] "GET /test.txt<br>
[29/Jul/2018:13:17:37 -0400] "GET /favicon.ico</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: a op√ß√£o --line-buffering do comando egrep √© usada aqui. </font><font style="vertical-align: inherit;">Isso for√ßa o egrep a imprimir em stdout toda vez que ocorre uma quebra de linha. </font><font style="vertical-align: inherit;">Sem esse par√¢metro, o buffer ocorrer√° e a sa√≠da n√£o ser√° enviada ao comando cut at√© que o buffer esteja cheio. </font><font style="vertical-align: inherit;">N√£o queremos esperar tanto tempo. </font><font style="vertical-align: inherit;">Esta op√ß√£o permite que o comando egrep escreva cada linha √† medida que for encontrada.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUFFERS DE LINHA DE COMANDO </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que acontece durante o buffer? </font><font style="vertical-align: inherit;">Imagine que o egrep encontra muitas strings correspondentes ao padr√£o especificado. </font><font style="vertical-align: inherit;">Nesse caso, o egrep ter√° muita sa√≠da. </font><font style="vertical-align: inherit;">Mas a sa√≠da (de fato, qualquer entrada ou sa√≠da) √© muito mais cara (leva mais tempo) do que o processamento de dados (pesquisa de texto). </font><font style="vertical-align: inherit;">Assim, quanto menos chamadas de E / S, mais eficiente o programa ser√°.</font></font><br>
<br>
     grep       ,  ,          .         .  grep       .   ,  grep   50    .   ,     50  ,     ,     .   50  !<br>
<br>
       egrep, ,             .  egrep       ,     ,     .    ,    ,   ,      ,      .      ,     .<br>
<br>
    ,    ,  tail -f        (    ),       . ,       ¬´ ¬ª,      .     .          .<br>
<br>
   ,        egrep     ,     .        ,   .</blockquote><br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode usar os comandos tail e egrep para monitorar o log e exibir quaisquer entradas que correspondam a padr√µes conhecidos de atividades suspeitas ou mal-intencionadas, geralmente chamadas de IOC. Voc√™ pode criar um sistema simples de detec√ß√£o de intrus√µes (IDS). Primeiro, crie um arquivo contendo os padr√µes de express√£o regular para o IOC, conforme mostrado no Exemplo 8.1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo 8.1 ioc.txt </font><b><font style="vertical-align: inherit;">(1)</font></b><font style="vertical-align: inherit;"> Este modelo (../) √© um indicador de um ataque de diret√≥rio indireto: um invasor tenta sair do diret√≥rio de trabalho atual e acessar arquivos que n√£o s√£o acess√≠veis a ele. </font><b><font style="vertical-align: inherit;">(2) Os</font></b><font style="vertical-align: inherit;"> arquivos etc / passwd e etc / shadow do Linux s√£o usados ‚Äã‚Äãpara autentica√ß√£o do sistema e nunca devem ser acessados ‚Äã‚Äãatrav√©s de um servidor web. </font><b><font style="vertical-align: inherit;">(3)</font></b></font><br>
<br>
<code>\.\./ <b>(1)</b><br>
etc/passwd <b>(2)</b><br>
etc/shadow<br>
cmd\.exe <b>(3)</b><br>
/bin/sh<br>
/bin/bash<br>
</code><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servir os arquivos cmd.exe, / bin / sh ou / bin / bash √© uma indica√ß√£o da conex√£o reversa retornada pelo servidor da web. Uma conex√£o reversa geralmente indica uma tentativa bem-sucedida de opera√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que os IOCs devem estar no formato regex, pois ser√£o usados ‚Äã‚Äãposteriormente pelo comando egrep. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O arquivo ioc.txt pode ser usado com a op√ß√£o egrep -f. Este par√¢metro diz ao egrep para pesquisar os padr√µes de express√£o regular no arquivo especificado. Isso permite que voc√™ use o comando tail para monitorar o arquivo de log e, √† medida que cada registro √© adicionado, a linha de leitura ser√° comparada com todos os modelos no arquivo IOC, exibindo qualquer registro correspondente. Aqui est√° um exemplo:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i -f ioc.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o comando tee pode ser usado para exibir simultaneamente avisos na tela e salv√°-los para processamento posterior em seu pr√≥prio arquivo: </font><font style="vertical-align: inherit;">
Novamente, a op√ß√£o --line-buffered √© necess√°ria para garantir que n√£o haja problemas causados ‚Äã‚Äãpelo buffer da sa√≠da do comando.</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep --line-buffered -i -f ioc.txt |<br>
tee -a interesting.txt</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoramento de log do Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° mencionado, voc√™ deve usar o comando wevtutil para acessar eventos do Windows. </font><font style="vertical-align: inherit;">Embora esse comando seja universal, ele n√£o possui uma funcionalidade como cauda, ‚Äã‚Äãque pode ser usada para recuperar novos registros recebidos. </font><font style="vertical-align: inherit;">Mas existe uma sa√≠da - use um script bash simples que possa fornecer a mesma funcionalidade (Exemplo 8.2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo 8.2 </font><font style="vertical-align: inherit;">wintail.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# wintail.sh<font></font>
#<font></font>
# :<font></font>
#    tail   Windows<font></font>
#<font></font>
# : ./wintail.sh<font></font>
#<font></font>
<font></font>
WINLOG=<span class="hljs-string">"Application"</span> (<span class="hljs-number">1</span>)<font></font>
<font></font>
LASTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (2)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span>
      CURRENTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (3)</span>
      <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"$CURRENTLOG"</span> != <span class="hljs-string">"$LASTLOG"</span> ]]<font></font>
      then<font></font>
            echo <span class="hljs-string">"$CURRENTLOG"</span>
            echo <span class="hljs-string">"----------------------------------"</span>
            LASTLOG=<span class="hljs-string">"$CURRENTLOG"</span><font></font>
      fi<font></font>
done</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Essa vari√°vel define o log do Windows que voc√™ deseja rastrear. Para obter uma lista dos logs atualmente dispon√≠veis no sistema, voc√™ pode usar o comando wevtutil el. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui, o wevtutil √© executado para solicitar o arquivo de log especificado. O par√¢metro c: 1 retorna apenas uma entrada de log. O par√¢metro rd: true permite que o comando leia a entrada de log mais recente. Por fim, f: text retorna o resultado em texto sem formata√ß√£o, n√£o no formato XML, o que facilita a leitura do resultado na tela. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As pr√≥ximas linhas executam o comando wevtutil novamente e a entrada de log rec√©m-recebida √© comparada √† √∫ltima impressa na tela. </font><font style="vertical-align: inherit;">Se eles diferirem um do outro, isso significa que houve altera√ß√µes no log. </font><font style="vertical-align: inherit;">Nesse caso, uma nova entrada √© exibida. </font><font style="vertical-align: inherit;">Se os registros comparados forem os mesmos, nada acontecer√° e o comando wevtutil voltar√° e come√ßar√° a procurar e comparar novamente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de histograma em tempo real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O comando tail -f fornece o fluxo de dados atual. </font><font style="vertical-align: inherit;">Mas e se voc√™ quiser contar o n√∫mero de linhas que foram adicionadas ao arquivo por um determinado per√≠odo de tempo? </font><font style="vertical-align: inherit;">Voc√™ pode observar esse fluxo de dados, iniciar um cron√¥metro e realizar a contagem por um per√≠odo especificado; </font><font style="vertical-align: inherit;">ent√£o a contagem deve ser interrompida e os resultados relatados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este trabalho pode ser dividido em dois processos de script: um script ler√° as linhas e o outro assistir√° o tempo. O temporizador notifica o contador de linha usando um mecanismo de comunica√ß√£o padr√£o entre processos POSIX chamado sinal. Um sinal √© uma interrup√ß√£o do software e existem v√°rios tipos de sinais. Alguns deles s√£o fatais - eles levam ao final do processo (por exemplo, uma exce√ß√£o em uma opera√ß√£o de ponto flutuante). A maioria desses sinais pode ser ignorada ou capturada. A a√ß√£o √© executada quando um sinal √© capturado. Muitos desses sinais t√™m uma finalidade predefinida no sistema operacional. Usaremos um dos dois sinais dispon√≠veis para os usu√°rios. Este √© o sinal SIGUSR1 (o outro √© SIGUSR2).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os scripts do shell podem detectar interrup√ß√µes usando o comando trap interno. Utilizando-o, voc√™ pode selecionar um comando que determine qual a√ß√£o voc√™ deseja executar quando um sinal for recebido e uma lista de sinais que acionam uma chamada para este comando. Por exemplo: </font></font><br>
<br>
<code>trap warnmsg SIGINT</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso faz com que o comando warnmsg (nosso pr√≥prio script ou fun√ß√£o) seja chamado sempre que o shell script receber um sinal SIGINT, por exemplo, quando voc√™ pressionar Ctrl + C para interromper um processo em execu√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo 8.3 mostra um script que executa uma contagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo 8.3 looper.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# looper.sh<font></font>
#<font></font>
# :<font></font>
#    <font></font>
#<font></font>
# : ./looper.sh [filename]<font></font>
# filename ‚Äî  ,   ,<font></font>
#  : log.file<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">interval</span> <span class="hljs-params">()</span>                                           <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      echo $(date <span class="hljs-string">'+%y%m%d %H%M%S'</span>) $cnt                       (<span class="hljs-number">2</span>)<font></font>
      cnt=<span class="hljs-number">0</span><font></font>
}<font></font>
<font></font>
declare -i cnt=<span class="hljs-number">0</span>
<span class="hljs-function">trap interval <span class="hljs-title">SIGUSR1</span>                                          <span class="hljs-params">(<span class="hljs-number">3</span>)</span>

shopt -s <span class="hljs-title">lastpipe</span>                                              <span class="hljs-params">(<span class="hljs-number">4</span>)</span>

tail -f --pid</span>=$$ ${<span class="hljs-number">1</span>:-log.file} | <span class="hljs-function"><span class="hljs-keyword">while</span> read <span class="hljs-title">aline</span>             <span class="hljs-params">(<span class="hljs-number">5</span>)</span>
<span class="hljs-keyword">do</span>
     let cnt++
done</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A fun√ß√£o de intervalo ser√° chamada ap√≥s o recebimento de cada sinal. Obviamente, o intervalo deve ser definido antes que possamos nome√°-lo e usar armadilha em nossa express√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O comando date √© chamado para fornecer um registro de data e hora para o valor da vari√°vel cnt que estamos imprimindo. Depois que o contador √© exibido, redefinimos esse valor para 0 para iniciar a contagem regressiva do pr√≥ximo intervalo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora que o intervalo est√° definido, podemos indicar que a fun√ß√£o √© chamada sempre que nosso processo recebe o sinal SIGUSR1. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© um passo muito importante. Geralmente, quando h√° um pipeline de comandos (por exemplo, ls-l | grep rwx | wc), partes do pipeline (cada comando) s√£o executadas em sub-redes e cada processo termina com seu pr√≥prio identificador de processo. Isso pode ser um problema para esse cen√°rio, porque o loop while estar√° em um subshell com um identificador de processo diferente. Qualquer que seja o processo iniciado, o script looper.sh n√£o saber√° o identificador do processo do loop while para enviar um sinal para ele. Al√©m disso, alterar o valor da vari√°vel cnt no subshell n√£o altera o valor cnt no processo principal; portanto, o sinal para o processo principal define o valor a cada vez. Voc√™ pode resolver esse problema com o comando shopt, que define o par√¢metro (-s) como lastpipe. Diz ao shell para n√£o criar um subshell para o √∫ltimo comando no pipeline,e execute este comando no mesmo processo que o pr√≥prio script. No nosso caso, isso significa que o comando tail ser√° executado em um subshell (isto √©, em outro processo), e o loop while se tornar√° parte do processo principal do script. Nota: esta op√ß√£o de shell est√° dispon√≠vel apenas na vers√£o 4.x do bash e superior e apenas para shells n√£o interativos (ou seja, scripts).</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este √© o comando tail -f com outro par√¢metro --pid. N√≥s especificamos o identificador do processo, que, ap√≥s a conclus√£o deste processo, completar√° o comando tail. N√≥s especificamos o ID do processo do script de shell atual $$ a ser exibido. Esta a√ß√£o permite limpar processos e n√£o deixar o comando tail executado em segundo plano (se, por exemplo, esse script for executado em segundo plano; Exemplo 8.4). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script tailcount.sh inicia e para o script com um cron√¥metro (temporizador) e conta os intervalos de tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo 8.4 tailcount.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# tailcount.sh<font></font>
#<font></font>
# :<font></font>
#    n <font></font>
#<font></font>
# : ./tailcount.sh [filename]<font></font>
#     filename:  looper.sh<font></font>
#<font></font>
<font></font>
#  ‚Äî    <font></font>
<span class="hljs-function">function <span class="hljs-title">cleanup</span> <span class="hljs-params">()</span>
</span>{<font></font>
      [[ -n $LOPID ]] &amp;&amp; kill $LOPID          (<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function">trap cleanup <span class="hljs-title">EXIT</span>                             <span class="hljs-params">(<span class="hljs-number">2</span>)</span>
bash looper.sh $1 &amp;                           <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
LOPID</span>=$!                                      (<span class="hljs-number">4</span>)<font></font>
#   <font></font>
sleep <span class="hljs-number">3</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span><font></font>
      kill -SIGUSR1 $LOPID<font></font>
      sleep <span class="hljs-number">5</span>
done &gt;&amp;<span class="hljs-number">2</span>                                      (<span class="hljs-number">5</span>)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como esse script executar√° outros scripts, ele dever√° ser limpo ap√≥s o trabalho. Se o identificador do processo foi armazenado no LOPID, a vari√°vel armazenar√° o valor; portanto, a fun√ß√£o enviar√° um sinal para esse processo usando o comando kill. Se voc√™ n√£o especificar um sinal espec√≠fico no comando kill, o sinal SIGTERM ser√° enviado por padr√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O comando EXIT n√£o √© um sinal. Este √© um caso especial quando a instru√ß√£o trap diz ao shell para chamar esta fun√ß√£o (neste caso, limpeza) se o shell que est√° executando esse script est√° prestes a desligar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora o verdadeiro trabalho come√ßa. O script looper.sh √© iniciado, o qual ser√° executado em segundo plano: para que esse script funcione durante todo o ciclo (sem esperar pelo comando para concluir o trabalho), ele √© desconectado do teclado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui, o identificador do processo de script que acabamos de iniciar em segundo plano √© armazenado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esse redirecionamento √© simplesmente uma precau√ß√£o. Todas as sa√≠das provenientes de um loop while ou de declara√ß√µes kill / sleep (embora n√£o esperemos que elas) n√£o devem ser misturadas com nenhuma sa√≠da da fun√ß√£o looper.sh, que, embora funcione em segundo plano, ainda as envia para stdout. Portanto, redirecionamos os dados de stdout para stderr.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resumir, vemos que, embora a fun√ß√£o looper.sh tenha sido colocada em segundo plano, seu identificador de processo √© armazenado em uma vari√°vel de shell. A cada cinco segundos, o script tailcount.sh envia um sinal SIGUSR1 para esse processo (que √© executado na fun√ß√£o looper.sh), que, por sua vez, chama o script looper.sh para imprimir o n√∫mero atual de linhas fixas nele e reiniciar a contagem. Ap√≥s sair, o script tailcount.sh ser√° limpo enviando um sinal SIGTERM para a fun√ß√£o looper.sh para interromp√™-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a ajuda de dois scripts - um script que executa a contagem de linhas e um script com um cron√¥metro (timer) que controla o primeiro script - voc√™ pode obter a sa√≠da (o n√∫mero de linhas por um determinado per√≠odo), com base na qual o pr√≥ximo script criar√° um histograma. √â chamado assim:</font></font><br>
<br>
<code>bash tailcount.sh | bash livebar.sh</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script livebar.sh l√™ dados de stdin e imprime a sa√≠da em stdout, uma linha para cada linha de entrada (Exemplo 8.5). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo 8.5 </font><font style="vertical-align: inherit;">livebar.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# livebar.sh<font></font>
#<font></font>
# :<font></font>
#    ¬´¬ª <font></font>
#<font></font>
# :<font></font>
# &lt;output from other script or program&gt; | bash livebar.sh<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">pr_bar</span> <span class="hljs-params">()</span>                                         <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      local raw maxraw scaled<font></font>
      raw=$<span class="hljs-number">1</span>
      maxraw=$<span class="hljs-number">2</span><font></font>
      ((scaled=(maxbar*raw)/maxraw))<font></font>
      ((scaled == <span class="hljs-number">0</span>)) &amp;&amp; scaled=<span class="hljs-number">1</span> #   
      <span class="hljs-keyword">for</span>((i=<span class="hljs-number">0</span>; i&lt;scaled; i++)) ; <span class="hljs-keyword">do</span> printf <span class="hljs-string">'#'</span> ; done<font></font>
      printf <span class="hljs-string">'\n'</span><font></font>
<font></font>
} # pr_bar<font></font>
<font></font>
maxbar=<span class="hljs-number">60</span>     #         (<span class="hljs-number">2</span>)<font></font>
MAX=<span class="hljs-number">60</span>
<span class="hljs-function"><span class="hljs-keyword">while</span> read dayst timst qty
<span class="hljs-keyword">do</span>
      <span class="hljs-title">if</span> <span class="hljs-params">(( qty &gt; MAX )</span>)                                   <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
      then
           let MAX</span>=$qty+$qty/<span class="hljs-number">4</span>    #   <font></font>
           echo <span class="hljs-string">"                      **** rescaling: MAX=$MAX"</span><font></font>
      fi<font></font>
      printf <span class="hljs-string">'%6.6s %6.6s %4d:'</span> $dayst $timst $qty         (<span class="hljs-number">4</span>)<font></font>
      pr_bar $qty $MAX<font></font>
done<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A fun√ß√£o pr_bar exibe uma sequ√™ncia de hashtags que s√£o dimensionadas com base nos par√¢metros fornecidos para o tamanho m√°ximo. </font><font style="vertical-align: inherit;">Esse recurso pode parecer familiar, como o usamos anteriormente no script histogram.sh. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esse √© o maior tamanho de linha de hashtag que podemos permitir (sem quebra de linha). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual ser√° o tamanho dos valores a serem exibidos? Sem saber disso com anteced√™ncia (embora esses dados possam ser fornecidos ao script como argumento), o script rastrear√° o m√°ximo. Se esse valor m√°ximo for excedido, o valor come√ßar√° a "escalar" e as linhas que agora s√£o exibidas, e as linhas futuras tamb√©m ser√£o escaladas para um novo m√°ximo. O script adiciona 25% ao valor m√°ximo, portanto, n√£o √© necess√°rio escalar o valor se o pr√≥ximo novo valor a cada vez aumentar em apenas 1-2%. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf define a largura m√≠nima e m√°xima dos dois primeiros campos a serem impressos. </font><font style="vertical-align: inherit;">S√£o carimbos de data e hora que ser√£o truncados se a largura for excedida. </font><font style="vertical-align: inherit;">Para exibir o valor inteiro, especifique sua largura de quatro caracteres. </font><font style="vertical-align: inherit;">Nesse caso, apesar das restri√ß√µes, todos os valores ser√£o impressos. </font><font style="vertical-align: inherit;">Se o n√∫mero de caracteres nos valores for menor que quatro, os ausentes ser√£o complementados com espa√ßos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como esse script √© lido pelo stdin, voc√™ pode execut√°-lo para ver como ele se comporta. </font><font style="vertical-align: inherit;">Aqui est√° um exemplo:</font></font><br>
<br>
<pre><code class="java hljs">$ bash  livebar.sh
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>
                       **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
^C</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste exemplo, a entrada √© misturada com a sa√≠da. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode colocar entrada em um arquivo e redirecion√°-lo para um script para ver apenas a sa√≠da:</font></font><br>
<br>
<pre><code class="java hljs">$ bash livebar.sh &lt; testdata.txt<font></font>
bash livebar.sh &lt; x.data<font></font>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################<font></font>
                 **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
$</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬ªMais informa√ß√µes sobre o livro podem ser encontradas no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site da editora</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conte√∫do</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trecho</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Para Khabrozhiteley desconto de 25% no cupom - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bash</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ap√≥s o pagamento da vers√£o impressa do livro, um livro eletr√¥nico √© enviado por e-mail.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501516/index.html">Vamos desligar o aspirador ?! Alexey Lesovsky</a></li>
<li><a href="../pt501520/index.html">C # 8 e validade nula. Como vivemos com isso</a></li>
<li><a href="../pt501522/index.html">Webinars gratuitos do Skillbox: escrevendo jogos em PHP, Unity e Unreal Engine</a></li>
<li><a href="../pt501524/index.html">Segredos de sincronizar os campos eletromagn√©ticos da Terra e um organismo vivo</a></li>
<li><a href="../pt501526/index.html">Por que o ingl√™s canadense √© considerado "sujo" e o que Keanu Reeves tem a ver com isso?</a></li>
<li><a href="../pt501534/index.html">Agora, com o COVID-19, tamb√©m h√° uma erup√ß√£o cut√¢nea</a></li>
<li><a href="../pt501536/index.html">Feito sob medida: uma hist√≥ria sobre como uma linha de c√≥digo se transformou em quilotons de carv√£o</a></li>
<li><a href="../pt501538/index.html">Recuo em Python - Op√ß√£o de Solu√ß√£o</a></li>
<li><a href="../pt501544/index.html">Smartphone perfeito</a></li>
<li><a href="../pt501546/index.html">"Por que estou passando por isso?" - psic√≥logos explicam como encontrar significado isoladamente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>