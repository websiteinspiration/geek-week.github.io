<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🔧 🧚🏿 🚑 C++ быстрее и безопаснее Rust, Yandex сделала замеры 🔻 🖐🏾 👃🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=": C++ . Rust. "Go Rust, Mail.Ru Group ".
 

 , ,  Rust. . , :
  2019 C++ CoreHard, antoshkka C++. , Rust , .

 ISO C++, C++. C++. Rust. .
 

 13:00 22...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C++ быстрее и безопаснее Rust, Yandex сделала замеры</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492410/"><p>: C++           .              Rust.   "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Go  Rust, Mail.Ru Group  </a>".</p><br>
<p>    ,    ,  <del></del>  Rust.       .  , :</p><br>
<blockquote> 2019      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">C++ CoreHard</a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">antoshkka</a>    C++.   , Rust  ,        .</blockquote><p>      ISO        C++,        C++.          C++.          Rust.   .</p><a name="habracut"></a><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">13:00</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">22:35</a>.</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fT3OALUyuhs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h1 id="oglavlenie"></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №1.   Rust    C++</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №2.  Rust      </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №3.    Rust   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №4. Rust  C++</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №5. C → ++ — noop, C → Rust — PAIN!!!!!!!</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №6. unsafe    Rust</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №7. Rust     </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> №8.  Rust  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a></li>
</ul><br>
<a name="para_1"></a><br>
<h1 id="mif-1-arifmetika-v-rust-nichut-ne-bezopasney-c"> №1.   Rust    C++.</h1><br>
<p>          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">pub fn square(num: i32) -&gt; i32 {
    return num * num
}</code></pre><br>
 </td>
<td><pre><code class="cpp">auto square(std::int32_t num) {
    return num * num;
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::square:
  mov eax, edi
  imul eax, edi
  ret</code></pre><br>
 </td>
<td><pre><code class="plaintext">square(int): # @square(int)
  mov eax, edi
  imul eax, edi
  ret</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">13:35</a>):</p><br>
<blockquote>   . !     .   C++  Rust     .</blockquote><p>  ,         ,       .   ,      ,    .        ,    Rust   [-2147483648, 2147483647],    C++  [-46340, 46340].    ? ?</p><br>
<p>  -46340  46340 —     ,     <code>std::int32_t</code>.        - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">signed overflow</a>.    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PVS-Studio</a>.     ,    ,    CI      ,    :</p><br>
<pre><code class="bash">runtime error: signed integer overflow: 46341 * 46341 cannot be represented in type 'int'
runtime error: signed integer overflow: -46341 * -46341 cannot be represented in type 'int'</code></pre><br>
<p> Rust          . </p><br>
<p> ,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">13:58</a>):</p><br>
<blockquote>          ,   C++          .   .     C++    .   Rust'   ,       .        .  Rust'   ,           ,     ,   .     ,     , Rust     .     -   .</blockquote><p>  ,     Rust,    ,    Rust  LLVM —    ,    Clang. , Rust «»     C++         .          ,   ,  .            C++        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>.    .</p><br>
<p>  ,        int'a:</p><br>
<pre><code class="cpp">unsigned MAX_INT = 2147483647;

int hash_code(std::string x) {
    int h = 13;
    for (unsigned i = 0; i &lt; 3; i++) {
        h += h * 27752 + x[i];
    }
    if (h &lt; 0) h += MAX_INT;
    return h;
}</code></pre><br>
<blockquote>  ,  ,   «bye»,     ( ,       )    .    ,   ,   ,    MAX_INT     .</blockquote><p>  PVS-Studio,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a>.   27752  3 ,  ,       ,      -  .</p><br>
<p>   Rust    (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:playground</a>):</p><br>
<pre><code class="rust">fn hash_code(x: String) -&gt; i32 {
    let mut h = 13i32;
    for i in 0..3 {
        h += h * 27752 + x.as_bytes()[i] as i32;
    }
    if h &lt; 0 {
        h += i32::max_value();
    }
    return h;
}

fn main() {
    let h = hash_code("bye".to_string());
    println!("hash: {}", h);
}</code></pre><br>
<p>     Debug  Release  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>,        : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">wrapping*</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">saturating*</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">overflowing*</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">checked*</a>.</p><br>
<p> ,             . </p><br>
<p>   —    ,         C++    .     .           ,      ,         «»  ,      .</p><br>
<a name="para_2"></a><br>
<h1 id="mif-2-plyusy-rust-tolko-v-analize-vremeni-zhizni-obektov"> №2.  Rust      .</h1><br>
<p>     (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">pub fn foo(max: i32,
           num: i32) -&gt; i32 {
    return max * num
}

pub fn bar(max: i32,
           num: i32) -&gt; i32 {
    return bar(max, num) *
           bar(max, num)
}</code></pre><br>
 </td>
<td><pre><code class="cpp">auto foo(std::int32_t max,
         std::int32_t num) {
    return max * num;
}

std::int32_t bar(std::int32_t max,
                 std::int32_t num) {
    return bar(max, num) *
           bar(max, num);
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::foo:
  mov eax, edi
  imul eax, esi
  ret
example::bar:
  ret</code></pre><br>
 </td>
<td><pre><code class="plaintext">foo(int, int): # @foo(int, int)
  mov eax, edi
  imul eax, esi
  ret
bar(int, int): # @bar(int, int)
  ret</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">15:15</a>):</p><br>
<blockquote> Rust'   C++    ,   <code>bar</code>   .      -,    -  .      …   ,  Rust    ,          , UB —   ,     , -   .  -  ,    - . --   . </blockquote><p>    . -      ,   NOP   <code>bar</code>   C++,    Rust.    LLVM.</p><br>
<p>  LLVM IR    ,   (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>code</td>
<td><pre><code class="rust">#[no_mangle]
pub fn bar(max: i32, num: i32) -&gt; i32 {
    return bar(max, num) * bar(max, num)
}</code></pre><br>
 </td>
</tr>
<tr>
<td>asm</td>
<td><pre><code class="plaintext">bar:
    ret</code></pre><br>
 </td>
</tr>
<tr>
<td>IR</td>
<td><pre><code class="plaintext">define i32 @bar(i32 %max, i32 %num) unnamed_addr #0 !dbg !5 {
start:
  ret i32 undef, !dbg !8
}</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p><code>ret i32 undef</code> —   ,  LLVM.</p><br>
<p>  LLVM    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">2006 </a>.    ,          ,  LLVM      .  ,  .  LLVM 6   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">llvm.sideeffect</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">2019 </a>  rustc    <code>-Z insert-sideeffect</code>,   <code>llvm.sideeffect</code>     .      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>). ,          stable rustc  .</p><br>
<p> C++          ,      LLVM   Rust  C.</p><br>
<p>,  ,      LLVM,     : "        ".   ,     Rust   ,   ,      .</p><br>
<a name="para_3"></a><br>
<h1 id="mif-3-vyzovy-funkciy-v-rust-bezdumno-trogayut-pamyat"> №3.    Rust   .</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">16:00</a>):</p><br>
<blockquote>   .     Rust.    <code>bar</code>      <code>foo</code>.  ,  Rust    :    -  ,       .  C++  . Rust    . -   . </blockquote><p>  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">fn foo(max: i32,
       num: i32) -&gt; i32 {
    return max * num
}

pub fn bar(max: i32,
           num: i32) -&gt; i32 {
    return foo(max, num) *
           foo(max, num)
}</code></pre><br>
 </td>
<td><pre><code class="cpp">auto foo(std::int32_t max,
         std::int32_t num) {
    return max * num;
}

std::int32_t bar(std::int32_t max,
                 std::int32_t num) {
    return foo(max, num) *
           foo(max, num);
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::bar:
    push    rax
    mov     eax, edi
    imul    eax, esi
    jo      .LBB0_1
    imul    eax, eax
    jo      .LBB0_5
    pop     rcx
    ret
.LBB0_1:
    lea     rdi, [rip + str.0]
    lea     rdx, [rip + .L...]
    jmp     .LBB0_2
.LBB0_5:
    lea     rdi, [rip + str.0]
    lea     rdx, [rip + .L...]
.LBB0_2:
    mov     esi, 33
    call    qword ptr [rip +..]
    ud2</code></pre><br>
 </td>
<td><pre><code class="plaintext">bar(int, int): # @bar(int, int)
    mov     eax, edi
    imul    eax, esi
    jo      .LBB1_3
    imul    eax, eax
    jo      .LBB1_3
    ret
.LBB1_3:
    ud2</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p>   Rust ,       .       <code>-ftrapv</code>  C++  <code>-C overflow-checks=on</code>  Rust,      .   C++    <code>ud2</code>,    "Illegal instruction (core dumped)",  Rust     <code>core::panicking::panic</code>,       .    <code>core::panicking::panic</code>     :</p><br>
<pre><code class="plaintext">$ ./signed_overflow 
thread 'main' panicked at 'attempt to multiply with overflow', signed_overflow.rs:6:12
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</code></pre><br>
<p>    "" ,   ?     x86-64 ,      16 ,  <code>call</code>  8-    ,   .   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">push rax</a>.      Rust,   C++(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">extern "C" { fn foo(); }

pub fn bar(max: i32,
           num: i32) -&gt; i32 {
    let z = max * num;
    unsafe { foo(); }
    return z
}</code></pre><br>
 </td>
<td><pre><code class="cpp">extern "C" void foo();

std::int32_t bar(std::int32_t max,
                 std::int32_t num) {
    auto z = max * num;
    foo();
    return z;
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::bar:
    push    rbx
    mov     ebx, edi
    imul    ebx, esi
    jo      .LBB0_2
    call    qword ptr [rip + foo..]
    mov     eax, ebx
    pop     rbx
    ret</code></pre><br>
 </td>
<td><pre><code class="plaintext">bar(int, int): # @bar(int, int)
    push    rbx
    mov     ebx, edi
    imul    ebx, esi
    jo      .LBB0_1
    call    foo
    mov     eax, ebx
    pop     rbx
    ret</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p> C++,  Rust    ,   <code>push rbx</code>   . Q.E.D.</p><br>
<p>    ,   C++        <code>-ftrapv</code>,       .    ,  Rust        <code>-C overflow-checks=on</code>,     (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>)     C++,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>   .    <code>-ftrapv</code>  gcc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">  2008 </a>.</p><br>
<a name="para_4"></a><br>
<h1 id="mif-4-rust-medlennee-c"> №4. Rust  C++.</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">18:10</a>):</p><br>
<blockquote>  Rust ...</blockquote><p>      ,   Rust',      .    ,  "" ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">17:30</a>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">pub struct Stats {
    x: u32,
    y: u32,
    z: u32,
}

pub fn sum(a: &amp;Stats,
           b: &amp;Stats) -&gt; Stats {
    return Stats {
        x: a.x + b.x,
        y: a.y + b.y,
        z: a.z + b.z
    };
}</code></pre><br>
 </td>
<td><pre><code class="cpp">struct Stats {
    std::uint32_t x,
                  y,
                  z;
};

auto sum(const Stats&amp; a,
         const Stats&amp; b) {
    return Stats {
        a.x + b.x,
        a.y + b.y,
        a.z + b.z
    };
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::sum:
  mov ecx, dword ptr [rdx]
  mov r8d, dword ptr [rdx + 4]
  add ecx, dword ptr [rsi]
  add r8d, dword ptr [rsi + 4]
  mov edx, dword ptr [rdx + 8]
  add edx, dword ptr [rsi + 8]
  mov rax, rdi
  mov dword ptr [rdi], ecx
  mov dword ptr [rdi + 4], r8d
  mov dword ptr [rdi + 8], edx
  ret</code></pre><br>
 </td>
<td><pre><code class="plaintext">sum(Stats const&amp;, Stats const&amp;):
  mov eax, dword ptr [rsi]
  add eax, dword ptr [rdi]
  mov ecx, dword ptr [rsi + 4]
  add ecx, dword ptr [rdi + 4]
  mov edx, dword ptr [rsi + 8]
  add edx, dword ptr [rdi + 8]
  shl rcx, 32
  or rax, rcx
  ret</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p> ,           ,  ,    →  . </p><br>
<p> 2019   CppCon    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">There Are No Zero-cost Abstractions</a>  Chandler Carruth.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">17:30</a>   - ,  <code>std::unique_ptr</code>     (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>).    -            <code>noexcept</code>, rvalue ,   <code>std::move</code>.   Rust      .      .    Rust      <code>extern "Rust"</code>  <code>unsafe</code>,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>):</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Rust</th>
<th>C++</th>
</tr>
<tr>
<td><pre><code class="rust">extern "Rust" {
    fn bar(k: &amp;i32);
    fn baz(_: Box&lt;i32&gt;);
}

pub fn foo(mut ptr: Box&lt;i32&gt;) {
    if *ptr &gt; 42 {
        unsafe { bar(&amp;*ptr) };
        *ptr = 42;
    }
    unsafe { baz(ptr) }
}</code></pre><br>
 </td>
<td><pre><code class="cpp">void bar(int* ptr)
    noexcept;

// Takes ownership.
void baz(std::unique_ptr&lt;int&gt;&amp;&amp; ptr)
    noexcept;

void foo(std::unique_ptr&lt;int&gt;&amp;&amp; ptr) {
    if (*ptr &gt; 42) {
      bar(ptr.get());
      *ptr = 42;
    }
    baz(std::move(ptr));
}</code></pre><br>
 </td>
</tr>
<tr>
<td><pre><code class="plaintext">example::foo:
    push    rbx
    mov     rbx, rdi
    cmp     dword ptr [rdi], 43
    jl      .LBB0_2
    mov     rdi, rbx
    call    qword ptr [rip + bar..]
    mov     dword ptr [rbx], 42
.LBB0_2:
    mov     rdi, rbx
    pop     rbx
    jmp     qword ptr [rip + baz..]
</code></pre><br>
 </td>
<td><pre><code class="plaintext">foo(std::unique_ptr&lt;...&gt;&amp;&amp;):
    pushq   %rbx
    movq    %rdi, %rbx
    movq    (%rdi), %rdi
    cmpl    $43, (%rdi)
    jl      .LBB0_2
    callq   bar(int*)
    movq    (%rbx), %rax
    movl    $42, (%rax)
.LBB0_2:
    movq    %rbx, %rdi
    popq    %rbx
    jmp     baz(...)
</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p>   Rust   .        <code>noexcept</code>, rvalue   <code>std::move</code>.      .    ,  ,     .</p><br>
<p>  2019 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Rust    C++   Benchmarks Game</a>.    C++    .             .       .</p><br>
<a name="para_5"></a><br>
<h1 id="mif-5-c--s--noop-c--rust--pain"> №5. C → ++ — noop, C → Rust — PAIN!!!!!!!</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">18:30</a>):</p><br>
<blockquote>     ,     Rust  ,        .     ,   ,    .  ++        ,        .  Rust'         -     . </blockquote><p>             .</p><br>
<p>,     Rust     ,   ,      .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  Starcraft</a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>   .</p><br>
<p> ,   Rust    cargo,            .   ,      ,      .  2020     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">crates.io</a>   40 000 . </p><br>
<p>            :</p><br>
<pre><code class="plaintext"># Cargo.toml
[dependencies]
flate2 = "1.0"</code></pre><br>
<p>          cargo  .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">flate2</a>  ,           miniz,   C,         Rust.  flate2   .</p><br>
<a name="para_6"></a><br>
<h1 id="mif-6-unsafe-otklyuchaet-vse-proverki-rust"> №6. unsafe    Rust.</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">19:14</a>):</p><br>
<blockquote>  <code>unsafe</code>    Rust',     ,     ,        .</blockquote><p>          Rust' .</p><br>
<p>,       <code>unsafe</code> —   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>   Rust ,  <code>unsafe</code> :</p><br>
<ol>
<li>  ;</li>
<li>   unsafe ;</li>
<li>     ;</li>
<li>   unsafe ;</li>
<li>    <code>union</code>.</li>
</ol><br>
<p>      Rust     .      lifetime-,    <code>unsafe</code>    .           ,    ,     - .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">You can’t "turn off the borrow checker" in Rust</a>.</p><br>
<p> <code>unsafe</code>     " ,  ".   ,           ,      . ,   .     ,   <code>malloc</code>  NULL       ,   Rust      .      ,  ,  , <code>malloc</code>,    : " ,  ;  ,   ,       ".           <code>unsafe</code>.</p><br>
<a name="para_7"></a><br>
<h1 id="mif-7-rust-ne-pomozhet-s-sishnymi-bibliotekami"> №7. Rust     .</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">19:25</a>):</p><br>
<blockquote>             C++     ,      , -    -    , -    null    .        .     Rust    .  -   .    Rust    ,       ,        C++.</blockquote><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">  Microsoft</a>, 70%             ,  Rust     .  ,        Rust.</p><br>
<p>  ,   <code>unsafe</code>  Rust,     ,   …    ,     ,    .  ,  ,   Rust   .</p><br>
<p>,  ,     ,    Rust   C++       ,  Rust   .   Rust             .          ,  <code>unsafe</code>    .</p><br>
<p>   <code>unsafe</code>    :</p><br>
<pre><code class="rust">// Warning: Calling this method with an out-of-bounds index is undefined behavior.
unsafe fn unchecked_get_elem_by_index(elems: &amp;[u8], index: usize) -&gt; u8 {
    *elems.get_unchecked(index)
}</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><code>slice::get_unchecked</code></a> —   <code>unsafe</code> ,            .      <code>get_elem_by_index</code>     ,     ,     .          <code>unsafe</code>(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:playground</a>):</p><br>
<pre><code class="rust">// Warning: Calling this method with an out-of-bounds index is undefined behavior.
unsafe fn unchecked_get_elem_by_index(elems: &amp;[u8], index: usize) -&gt; u8 {
    *elems.get_unchecked(index)
}

fn main() {
    let elems = &amp;[42];
    let elem = unsafe { unchecked_get_elem_by_index(elems, 0) };
    dbg!(elem);
}</code></pre><br>
<p>   ,   ,       .        <code>unsafe</code>.</p><br>
<p>  ,    <code>unsafe</code>      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:playground</a>):</p><br>
<pre><code class="rust">// Warning: Calling this method with an out-of-bounds index is undefined behavior.
unsafe fn unchecked_get_elem_by_index(elems: &amp;[u8], index: usize) -&gt; u8 {
    *elems.get_unchecked(index)
}

fn get_elem_by_index(elems: &amp;[u8], index: usize) -&gt; Option&lt;u8&gt; {
    if index &lt; elems.len() {
        let elem = unsafe { unchecked_get_elem_by_index(elems, index) };
        Some(elem)
    } else {
        None
    }
}

fn main() {
    let elems = &amp;[42];
    let elem = get_elem_by_index(elems, 0);
    dbg!(&amp;elem);
}</code></pre><br>
<p>        ,       .  ,         Rust (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><code>slice::get</code></a>),  ,     <code>unsafe</code>  Rust       .    <code>unchecked_get_elem_by_index</code>    ,   C.</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"> LTO</a>       :</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>C</td>
<td><pre><code class="cpp">#include &lt;stdint.h&gt;

uint32_t mul(uint32_t a, uint32_t b) {
    return a * b;
}</code></pre><br>
 </td>
</tr>
<tr>
<td>Rust</td>
<td><pre><code class="rust">#[link(name="mul", kind="static")]
extern {
    fn mul(a: u32, b: u32) -&gt; u32;
}

#[inline(never)]
#[no_mangle]
fn multiply(a: u32, b: u32) -&gt; u32 {
    unsafe { mul(a, b) }
}

fn main() {
    println!("42*42 = {}!", multiply(42,42));
    println!("87*31 = {}!", multiply(87,31));
}</code></pre><br>
 </td>
</tr>
<tr>
<td>asm</td>
<td><pre><code class="plaintext">000000000002eda0 &lt;multiply&gt;:
   2eda0:   89 f8                   mov    %edi,%eax
   2eda2:   0f af c6                imul   %esi,%eax
   2eda5:   c3                      retq</code></pre><br>
 </td>
</tr>
</tbody></table></div><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>     .     ,    C(<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">link:godbolt</a>),    ,   Rust.</p><br>
<a name="para_8"></a><br>
<h1 id="mif-8-bezopasnost-rust-ne-dokazana"> №8.  Rust  .</h1><br>
<p> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">20:38</a>):</p><br>
<blockquote>      X.       .            X,    ,      .  . .  .    ,          X,       .</blockquote><p> 2018  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"></a>,    Rust,  , ,     .    ,           <code>unsafe</code>       <code>safe</code> ,     ,          .</p><br>
<p>  ,       (),   unsafe,     ,        .</p><br>
<p>            ,  Mutex, RwLock, thread::spawn.     .  ,  Rust         ; ,  Mutex   ,      ,   ,       . ? .</p><br>
<a name="conclusion"></a><br>
<h1 id="zaklyuchenie"></h1><br>
<p>        , <strong></strong>          .      " - C++"   ,     C++,      .</p><br>
<p>        , ,  ,     .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"> </a>   .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar492396/index.html">لماذا أخطأنا في مؤشرات LED وما يجب تغييره</a></li>
<li><a href="../ar492398/index.html">نقوم بتكوين أجهزتنا للعمل عن بعد ، والبودكاست ، والفيديو والبث</a></li>
<li><a href="../ar492404/index.html">Flutter + arduino nano 33 BLE sense = مستشعر BLE بسيط جدًا</a></li>
<li><a href="../ar492406/index.html">البث الصوتي للمهوس: زوجان من البرامج التي أثبتت جدواها حول إدارة المشاريع وتحليل التكنولوجيا و GTD</a></li>
<li><a href="../ar492408/index.html">انخفض حضور Yandex المكتبي: ما حدث في عام 2019 وكيف سيؤثر في عام 2020</a></li>
<li><a href="../ar492414/index.html">تشريح نظام NSI</a></li>
<li><a href="../ar492420/index.html">Wechat أو تطبيق شامل حقًا. ماذا يمكن للمطور أن يفعل به</a></li>
<li><a href="../ar492422/index.html">اسكوبار فولد 2 - عملية احتيال مستمرة</a></li>
<li><a href="../ar492424/index.html">الزاوي: طريقة أخرى لإلغاء الاشتراك</a></li>
<li><a href="../ar492426/index.html">كيفية تجاوز مناجم تكنولوجيا المعلومات</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>