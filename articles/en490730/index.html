<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê§ üÖ±Ô∏è üî≥ Intel x86 Root of Trust: loss of trust üö™ ü§ûüèº üöê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image: shutterstock
 
 Here comes the moment that Intel‚Äôs system architects, engineers and security experts may have feared most: an error was found i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Intel x86 Root of Trust: loss of trust</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/490730/"><img src="https://habrastorage.org/webt/hg/oy/c4/hgoyc4kd5xlruwd43mkczw6v0ui.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shutterstock</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Here comes the moment that Intel‚Äôs system architects, engineers and security experts may have feared most: an error was found in the unwritable memory area (ROM) of the Intel Converged Security and Management Engine, and this error casts doubt on all the company's efforts to create the root of confidence and the foundation of security on its platforms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the point here is not even that the errors of the firmware (firmware), which are "wired" in the on-board memory of Mask ROM of microprocessors and chipsets, cannot be fixed, but rather that the error found destroys the trust chain of the entire platform as a whole, allowing compromise its hardware base.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Positive Technologies specialists found a hardware error in the Intel hardware, as well as an error in the Intel CSME firmware, which manifests itself at a very early stage in the operation of this subsystem, in its boot ROM (boot ROM). It is known that it is Intel CSME that provides initial authentication of a system based on Intel chips, downloading and checking all the rest of the firmware of modern platforms. For example, Intel CSME, interacting with the CPU microcode, ensures the authenticity of the UEFI BIOS firmware via BootGuard technology. In addition, Intel CSME downloads and verifies the firmware of the Power Management Controller, which controls the voltage supply to each hardware unit in Intel chips.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But more importantly, it is Intel CSME that is responsible for the cryptographic base of such hardware protection technologies developed by Intel and used everywhere, such as DRM, fTPM and Intel Identity Protection. The Intel CSME firmware implements a remote certification system for trusted systems called EPID (Enhanced Privacy ID), which allows you to uniquely and anonymously identify each specific instance of a computing system (computer), finding many useful applications, such as protecting digital content, ensuring the security of financial transactions, certification of the Internet of things. In addition, Intel CSME firmware has a TPM software module that allows you to use it to store encryption keys without an additional TPM chip, which is far from every computer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And Intel has tried to make this root of trust as secure as possible. The security system of Intel platforms is designed in such a way that even an arbitrary code execution error in any of the Intel CSME firmware modules does not carry the risk of losing the security root key (aka Chipset Key), but only jeopardizes the specific functions for which the vulnerable module is responsible when This allows you to easily mitigate the risk by changing the encryption keys using the secure version number mechanism of SVN. This was clearly demonstrated in 2017, when an error of arbitrary code execution was found in the BringUP firmware module (bup), described in Intel SA-00086. Then Intel simply performed key regeneration by increasing SVN, and thus easily avoided the risk of compromising EPID-based technologies.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But unfortunately, there are no perfect security systems, and, like any other, Intel's security architecture has its Achilles heel - boot ROM. An error in ROM in the early stages of execution really allows you to control the process of reading the Chipset Key and generating all other encryption keys. One of these keys is used to encrypt an Integrity Control Value Blob (ICVB) data array. Having this key, you can fake the code of any of the Intel CSME firmware modules - and the authentication system will not be able to recognize the fake. This is tantamount to leaking the Intel CSME firmware digital signature private key, but for this particular platform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the moment, the situation with EPID is mitigated by the fact that the Chipset Key is stored inside the platform (in special OTP memory, One-Time Programmable Memory) in an encrypted form and to completely compromise the EPID, it is also necessary to extract the hardware key on which the Chipset Key is stored, which is encrypted in special SKS storage (Secure Key Storage). But this key is not unique to the platform, but one for the entire generation of Intel chipsets. And since a found error in ROM allows you to intercept code execution until locking the hardware key generation mechanism in SKS, and the error in ROM itself cannot be fixed, we believe that this is only a matter of time - when this key will be extracted. And then complete chaos will come: hardware identification will be faked, digital content will be extracted, encrypted information from permanent media will be decrypted.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, Positive Technologies experts found an error in the Intel CSME boot ROM in all currently released Intel chipsets and SoC except Ice Point (10th generation of processors). This error allows you to extract the Chipset Key, as well as to manipulate part of the hardware key and the process of its generation, not allowing, however, at the moment to directly obtain its hardware component (wired in SKS). Moreover, this error in ROM allows you to organize arbitrary code execution at the zero privilege level of Intel CSME. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In more detail we will describe the technical details in a full white paper devoted to this error, which we plan to publish a little later. It should be noted that after our specialists contacted Intel PSIRT with a report on this error, Intel reported that the error was already known ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-0090</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Intel understands that it is impossible to fix an error in ROM in already released equipment, and therefore they simply block all possible ways of its operation. The patch for CVE-2019-0090 corrects only one of the possible attack vectors - through the integrated sensor hub (Integrated Sensors Hub, ISH). We think that there are potentially many ways to exploit this vulnerability in ROM. Some of them may require local access, some physical. To slightly open the veil of secrecy, let's say a few words about the vulnerability itself:</font></font><br>
<br>
<ol>
<li>    ,    boot ROM:    IOMMU   MISA (Minute IA System Agent),    SRAM ( ) Intel CSME   DMA-, <b>  </b>.  ,     ,     .</li>
<li> Intel CSME  boot ROM     (page directory),          IOMMU.  ,  ,    SRAM    DMA-   (DMA    CSME,      )       SRAM      Intel CSME.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The MISA IOMMU parameters are reset when reset is performed for Intel CSME, which after reset starts execution again from boot ROM.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, any platform device that can perform DMA transactions in Intel CSME static memory and at the same time reboot Intel CSME (or just wait for the Intel CSME to wake up) can modify the system tables of Intel CSME pages and thus intercept execution. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posted by Mark Ermolov, Leading Specialist, OS Technologies and Hardware Solutions, Positive Technologies.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490718/index.html">What is the "clean code" in 2020?</a></li>
<li><a href="../en490720/index.html">Motor! or What is game physics</a></li>
<li><a href="../en490722/index.html">Gender holidays in IT. How to note</a></li>
<li><a href="../en490726/index.html">Authentication on network equipment through SSH using public keys</a></li>
<li><a href="../en490728/index.html">Security Week 10: RSA Conference and Cybersecurity Awareness</a></li>
<li><a href="../en490732/index.html">Speech Recognition: A Very Short Introductory Course</a></li>
<li><a href="../en490734/index.html">Easter eggs on topographic maps of Switzerland</a></li>
<li><a href="../en490736/index.html">9 clear tools for learning and pumping English vocabulary</a></li>
<li><a href="../en490738/index.html">Lisk substitution principle</a></li>
<li><a href="../en490740/index.html">Defecting *** s is not just randomization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>