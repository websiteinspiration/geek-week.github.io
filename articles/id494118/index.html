<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÑ üÜô üõåüèΩ COVID-19 Telegram-bot // Kami menjawab pertanyaan FAQ secara otomatis üë®üèΩ‚ÄçüöÄ ‚õπüèª ‚úåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam konteks hype universal tentang Coronavirus, saya memutuskan untuk melakukan setidaknya sesuatu yang bermanfaat (tapi tidak kurang hype). Dalam a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>COVID-19 Telegram-bot // Kami menjawab pertanyaan FAQ secara otomatis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494118/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam konteks hype universal tentang Coronavirus, saya memutuskan untuk melakukan setidaknya sesuatu yang bermanfaat (tapi tidak kurang hype). </font><font style="vertical-align: inherit;">Dalam artikel ini saya akan berbicara tentang cara membuat dan menggunakan Telegram Bot menggunakan metode NLP Berbasis Aturan dalam 2,5 jam (itulah yang membuat saya perlu) untuk menjawab pertanyaan FAQ menggunakan kasus COVID-19 sebagai contoh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam pekerjaan, kita akan menggunakan Python tua yang baik, API Telegram, beberapa pustaka NLP standar, serta Docker.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e4/tw/68e4twfyppio_uy1o1dojajfeca.jpeg"><br>
<a name="habracut"></a><br>
<blockquote><img src="https://habrastorage.org/webt/fi/0x/4z/fi0x4z2nhcc3-3bdzugakb4csji.png" align="left"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menit Perawatan UFO</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pandemi COVID-19, infeksi pernafasan akut yang berpotensi parah yang disebabkan oleh coronavirus SARS-CoV-2 (2019-nCoV), telah secara resmi diumumkan di dunia. </font><font style="vertical-align: inherit;">Ada banyak informasi tentang Habr√© tentang topik ini - selalu ingat bahwa Habr√© dapat diandalkan / bermanfaat, dan sebaliknya.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mendesak Anda untuk kritis terhadap informasi apa pun yang dipublikasikan.</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber resmi</font></font></b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">C   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">C </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  ()</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"> </a></li>
<li>       </li>
</ul><br>
     ,      .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuci tangan, rawat orang yang Anda cintai, tinggal di rumah kapan saja memungkinkan dan bekerja dari jarak jauh. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca publikasi tentang: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coronavirus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerja jarak jauh</font></font></a></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kata Pengantar Singkat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini menjelaskan proses membuat Bot Telegram sederhana menjawab pertanyaan FAQ pada COVID-19. </font><font style="vertical-align: inherit;">Teknologi pengembangan sangat sederhana dan serbaguna, dan dapat digunakan untuk kasus lain. </font><font style="vertical-align: inherit;">Saya menekankan sekali lagi bahwa saya tidak berpura-pura sebagai Negara Seni, tetapi hanya menawarkan solusi sederhana dan efektif yang dapat digunakan kembali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena saya percaya bahwa pembaca artikel ini sudah memiliki pengalaman dengan Python, kami akan menganggap bahwa Anda sudah menginstal Python 3.X dan alat pengembangan yang diperlukan (PyCharm, VS Code), Anda dapat membuat Bot di Telegram melalui BotFather, dan oleh karena itu, saya akan melewatkan hal-hal ini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Konfigurasi API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang perlu Anda instal adalah library wrapper untuk API Telegram " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Perintah standar untuk ini adalah:</font></font><br>
<br>
<pre><code class="python hljs">pip install python-telegram-bot --upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami akan membangun kerangka kerja program kecil kami dengan mendefinisikan "penangan" untuk acara Bot berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mulai - perintah peluncuran Bot;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help - help command (bantuan);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pesan - pemrosesan pesan teks;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kesalahan - kesalahan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanda tangan dari penangan akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment"># </span>
    <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, dengan analogi dengan contoh dari dokumentasi perpustakaan, kami mendefinisikan fungsi utama di mana kami menetapkan semua penangan ini dan memulai bot:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_answer</span>():</span>
    <span class="hljs-string">"""Start the bot."""</span>
    <span class="hljs-comment"># Create the Updater and pass it your bot's token.</span>
    <span class="hljs-comment"># Make sure to set use_context=True to use the new context based callbacks</span>
    <span class="hljs-comment"># Post version 12 this will no longer be necessary</span>
    updater = Updater(<span class="hljs-string">"Token"</span>, use_context=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Get the dispatcher to register handlers</span><font></font>
    dp = updater.dispatcher<font></font>
<font></font>
    <span class="hljs-comment"># on different commands - answer in Telegram</span>
    dp.add_handler(CommandHandler(<span class="hljs-string">"start"</span>, start))<font></font>
    dp.add_handler(CommandHandler(<span class="hljs-string">"help"</span>, help))<font></font>
<font></font>
    <span class="hljs-comment"># on noncommand i.e message - echo the message on Telegram</span><font></font>
    dp.add_handler(MessageHandler(Filters.text, message))<font></font>
<font></font>
    <span class="hljs-comment"># log all errors</span><font></font>
    dp.add_error_handler(error)<font></font>
<font></font>
    <span class="hljs-comment"># Start the Bot</span><font></font>
    updater.start_polling()<font></font>
<font></font>
    <span class="hljs-comment"># Run the bot until you press Ctrl-C or the process receives SIGINT,</span>
    <span class="hljs-comment"># SIGTERM or SIGABRT. This should be used most of the time, since</span>
    <span class="hljs-comment"># start_polling() is non-blocking and will stop the bot gracefully.</span><font></font>
    updater.idle()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    get_answer()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menarik perhatian Anda pada kenyataan bahwa ada 2 mekanisme cara meluncurkan bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polling Standar - polling berkala Bot menggunakan alat API Telegram standar untuk acara baru ( </font></font><code>updater.start_polling()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webhook - kami memulai server kami dengan titik akhir, tempat peristiwa dari bot tiba, memerlukan HTTPS.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang sudah Anda perhatikan, untuk kesederhanaan kami menggunakan Polling standar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Kami mengisi penangan standar dengan logika</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan yang sederhana, mengisi awal dan membantu penangan dengan jawaban standar, kita mendapatkan sesuatu seperti ini:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /start is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
!
        COVID-19.
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /help is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
     (  COVID-19).
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, ketika pengguna mengirim / memulai atau / membantu perintah, mereka akan menerima jawaban yang ditentukan oleh kami. </font><font style="vertical-align: inherit;">Saya menarik perhatian Anda pada fakta bahwa teks diformat dalam Markdown</font></font><br>
<br>
<pre><code class="python hljs">parse_mode=telegram.ParseMode.MARKDOWN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, tambahkan logging kesalahan ke penangan kesalahan:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Log Errors caused by Updates."""</span>
    logger.warning(<span class="hljs-string">'Update "%s" caused error "%s"'</span>, update, context.error)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, mari kita periksa apakah Bot kita berfungsi. </font><font style="vertical-align: inherit;">Menyalin seluruh kode yang ditulis dalam satu file, misalnya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.py</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tambahkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impor yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperlukan </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan file dan pergi ke Telegram ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jangan lupa untuk memasukkan Token Anda ke dalam kode</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Kami menulis perintah / mulai dan / membantu dan bersukacita:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/jf/bo/hnjfbobptb1e1no0h-nl5cdegt4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Kami memproses pesan dan menghasilkan respons</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang perlu kita jawab adalah Basis Pengetahuan. </font><font style="vertical-align: inherit;">Hal paling sederhana yang dapat Anda lakukan adalah membuat file json sederhana dalam bentuk nilai Key-Value, di mana Key adalah teks dari pertanyaan yang diajukan, dan Value adalah jawaban untuk pertanyaan itu. </font><font style="vertical-align: inherit;">Contoh Basis Pengetahuan:</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"      ?"</span>: <span class="hljs-string">"  ‚Äî  .     -     ,     ,     ,        .    ,      ,   .        ,     ."</span>,
  <span class="hljs-attr">"   ?"</span>: <span class="hljs-string">"  :\n     \n    \n    \n     \n\n         ,    ."</span>,
  <span class="hljs-attr">"  ?"</span>: <span class="hljs-string">" :\n- (    , , )\n- (  )"</span>,<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma untuk menjawab pertanyaan adalah sebagai berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mendapatkan teks pertanyaan dari pengguna;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lemasi semua kata dalam teks pengguna;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tidak dengan jelas membandingkan teks yang dihasilkan dengan semua pertanyaan lemmatized dari basis pengetahuan ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jarak Levenshtein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memilih pertanyaan yang paling "mirip" dari basis pengetahuan;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengirim jawaban untuk pertanyaan yang dipilih kepada pengguna.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengimplementasikan rencana kami, kami membutuhkan perpustakaan: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuzzywuzzy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (untuk perbandingan fuzzy) dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pymorphy2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (untuk lemmatization). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat file baru dan terapkan algoritma yang terdengar:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fuzzywuzzy <span class="hljs-keyword">import</span> fuzz
<span class="hljs-keyword">import</span> pymorphy2<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
morph = pymorphy2.MorphAnalyzer()<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"faq.json"</span>) <span class="hljs-keyword">as</span> json_file:<font></font>
    faq = json.load(json_file)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_question</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-comment">#  </span>
    text = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> text.split())<font></font>
    questions = list(faq.keys())<font></font>
    scores = list()<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-comment">#    </span>
        norm_question = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> question.split())
        <span class="hljs-comment">#       </span><font></font>
        scores.append(fuzz.token_sort_ratio(norm_question.lower(), text.lower()))<font></font>
    <span class="hljs-comment"># </span><font></font>
    answer = faq[questions[scores.index(max(scores))]]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> answer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum menulis penangan pesan, kami akan menulis fungsi yang menyimpan riwayat korespondensi dalam file tsv:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_data</span>(<span class="hljs-params">user, question, answer</span>):</span><font></font>
    username = user.username<font></font>
    full_name = user.full_name<font></font>
    id = user.id<font></font>
<font></font>
    str = <span class="hljs-string">"""{username}\t{full_name}\t{id}\t{question}\t{answer}\n"""</span>.format(username=username,<font></font>
                                                                 full_name=full_name,<font></font>
                                                                 id=id,<font></font>
                                                                 question=question,<font></font>
                                                                 answer=answer)<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/data/dump.tsv"</span>, <span class="hljs-string">"a"</span>) <span class="hljs-keyword">as</span> myfile:<font></font>
        myfile.write(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, kami menggunakan metode yang kami tulis dalam pesan teks pesan penangan pesan:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Answer the user message."""</span>
    <span class="hljs-comment"># </span><font></font>
    answer = classify_question(update.message.text)<font></font>
    <span class="hljs-comment">#  </span><font></font>
    dump_data(update.message.from_user, update.message.text, answer)<font></font>
    <span class="hljs-comment"># </span>
    update.message.reply_text(answer)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, sekarang pergi ke Telegram dan nikmati tulisannya:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/fj/2h/idfj2hjue-vkxmusxsd6hibl-zu.jpeg" width="300"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Konfigurasikan Docker dan gunakan aplikasi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dikatakan klasik: "Jika Anda mengeksekusi, maka itu indah untuk dieksekusi.", Sehingga kami memiliki segalanya sebagai orang, kami akan mengonfigurasikan containerization menggunakan Docker Compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk ini kita perlu:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat Dockerfile - mendefinisikan gambar wadah dan titik masuk;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat docker-compose.yml - meluncurkan banyak wadah menggunakan Dockerfile tunggal (dalam kasus kami itu tidak perlu, tetapi jika Anda memiliki banyak layanan, itu akan berguna.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat boot.sh (skrip bertanggung jawab langsung untuk meluncurkan).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, isi Dockerfile:</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
FROM python:3.6.6-slim<font></font>
<font></font>
#  <font></font>
WORKDIR /home/alex/covid-bot<font></font>
<font></font>
#  requirements.txt<font></font>
COPY requirements.txt ./<font></font>
<font></font>
# Install required libs<font></font>
RUN pip install --upgrade pip -r requirements.txt; exit 0<font></font>
<font></font>
#      <font></font>
COPY data data<font></font>
<font></font>
#   <font></font>
COPY app.py faq.json reply_generator.py boot.sh  ./<font></font>
<font></font>
#   <font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<font></font>
<font></font>
# <font></font>
RUN chmod +x boot.sh<font></font>
<font></font>
#  <font></font>
ENTRYPOINT ["./boot.sh"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isi dari docker-compose.yml:</font></font><br>
<br>
<pre><code class="plaintext hljs"># docker-compose<font></font>
version: '2'<font></font>
#  <font></font>
services:<font></font>
  bot:<font></font>
    restart: unless-stopped<font></font>
    image: covid19_rus_bot:latest<font></font>
    container_name: covid19_rus_bot<font></font>
    #    boot.sh<font></font>
    environment:<font></font>
      - SERVICE_TYPE=covid19_rus_bot<font></font>
    # volume      <font></font>
    volumes: <font></font>
        - ./data:/data<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isi dari boot.sh:</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
if [ -n $SERVICE_TYPE ]<font></font>
then<font></font>
  if [ $SERVICE_TYPE == "covid19_rus_bot" ]<font></font>
  then<font></font>
    exec python app.py<font></font>
    exit<font></font>
  fi<font></font>
else<font></font>
  echo -e "SERVICE_TYPE not set\n"<font></font>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami siap, untuk memulai semua ini, Anda perlu menjalankan perintah berikut di folder proyek:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker build -t covid19_rus_bot:latest .<font></font>
sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu dia, bot kami sudah siap.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alih-alih sebuah kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang diharapkan, semua kode tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini, yang ditunjukkan oleh saya, dapat diterapkan dalam hal apa pun untuk menjawab pertanyaan FAQ, sesuaikan basis pengetahuan! Mengenai basis pengetahuan, itu juga dapat ditingkatkan dengan mengubah struktur Kunci dan Nilai menjadi array, sehingga setiap pasangan akan menjadi array pertanyaan potensial pada satu topik dan array jawaban potensial untuk mereka (untuk berbagai jawaban, Anda dapat memilih secara acak). Secara alami, pendekatan Berbasis Aturan tidak terlalu fleksibel untuk penskalaan, tetapi saya yakin bahwa pendekatan ini akan tahan terhadap basis pengetahuan dengan sekitar 500 pertanyaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka yang telah membaca sampai akhir saya mengundang Anda untuk mencoba Bot saya di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id494094/index.html">3D lakukan sendiri. Bagian 1: piksel dan garis</a></li>
<li><a href="../id494096/index.html">Penggunaan intranet. Pengalaman, kesalahan, rekomendasi</a></li>
<li><a href="../id494098/index.html">Pendekatan imperatif terhadap data reaktif pada contoh Jetbrains KTor dan R2DBC</a></li>
<li><a href="../id494100/index.html">Apa yang Anda butuhkan untuk membuat model ideal pusat pendidikan untuk melatih spesialis IT</a></li>
<li><a href="../id494114/index.html">Cara mengurangi angka dan meningkatkan pembacaan kode di react-redux, redux-saga</a></li>
<li><a href="../id494124/index.html">Merakit komputer 8-bit: cara mengurangi jumlah chip menjadi enam</a></li>
<li><a href="../id494126/index.html">ILMU TOP Februari Sepuluh Media: Feminis Kepiting Zombi, Salamander Prasejarah, dan Pecandu Alkohol yang Berlebihan</a></li>
<li><a href="../id494128/index.html">Hackspace Neuron - tempat pertemuan bagi para peretas di Moskow</a></li>
<li><a href="../id494130/index.html">Apa yang terjadi pada acara online: beberapa statistik kami</a></li>
<li><a href="../id494132/index.html">Befunge compiler dengan Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>