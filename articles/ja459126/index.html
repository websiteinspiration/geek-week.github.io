<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍⚖️ 🔇 👨🏾 Raspberry Pi Robot Tank with Intel Neural Computer Stick 2 👐🏿 🤾🏻 ✍🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="したがって、ラズベリータンクの開発には新たな段階が訪れました。
 
 では、前のシリーズ、それはボックスのうちセマンティックセグメンテーションは、ラズベリーのためにあまりにも大変だったことが判明しました。
 
 ブレーンストーミングと解説により、次の開発領域を特定できました。
 
 

- 希望の画...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Raspberry Pi Robot Tank with Intel Neural Computer Stick 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459126/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラズベリータンクの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発には新たな段階が訪れました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、前のシリーズ、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それはボックスのうちセマンティックセグメンテーションは、ラズベリーのためにあまりにも大変だったことが判明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブレーンストーミングと解説により、次の開発領域を特定できました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 希望の画像サイズに合わせて独自のE-netネットワークをトレーニングする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニューラルネットワークの起動をRaspberry自体から特別なハードウェアに移行します。ハードウェアの中でIntel Movidius（別名Neural Compute Stick、別名NCS）が最も頻繁に言及されていました。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロボットに新しい鉄片を取り付けることは、ロボット工学で最も興味深いことであるため、ニューラルネットワークのトレーニングの骨の折れる作業は、より良い時期まで延期されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数日-そして私の手の中のインテルの奇跡の鉄片。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かなり大きいので、ラズベリーの下のUSBコネクタに差し込むことはできません。</font><font style="vertical-align: inherit;">右のUSBポートがカメラの三脚で覆い隠され、左上の部分がGPSモジュールで占められていたため、それほど多くのオプションはありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、GPSがケーブルに取り付けられ、折り返され、ケーブルが三脚に巻き付けられ、NCSがケーブルを交換しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このハードウェアの部分で完成しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/an/a1/rrana1u2e0uwupybfu4txj6hmmk.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インテルNCS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intelは最近、NCSの2番目のバージョンをリリースしました。APIは以前のバージョンと完全に互換性がなく、ユーザーはインターネットに多大な労力を費やしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、以前のバージョンに関するナレッジベース全体は、現在のところ情報提供のゴミにすぎません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいエディションはOpenVinoフレームワークを提供します。これには、OpenCVなど、ニューラルネットワークを操作するためのさまざまなツールが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCS2とOpenVinoに関する紹介記事をいくつか示します。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インテル自体から</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データサイエンスIに向けて</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データサイエンスIIに向けて</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyImageSearch</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCSを使い始めるのは非常にスムーズでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intelは当初Raspbianをサポートしていたため、タンバリンと踊る必要はありませんでした。</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紹介ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も非常に明確で、OpenVinoフレームワークのインストールによって問題が発生することはありませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenVinoにOpenCV 4.1が含まれていることは素晴らしいボーナスであることがわかりました。これにより、Raspberryで以前のバージョンのOpenCVを自分でビルドする必要があったため、時間を節約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCS2自体の外観は次のとおり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ww/dc/by/wwdcbyyaogekp33qbtehz6zp3mo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。さらに興味深いことになりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCSは独自のニューラルネットワーク形式のみをサポートしていますが、Intelは、最も人気のあるフレームワーク（Tensorflow、Caffe、Torch）のグラフを変換するためのOpenVinoの一部としてModel Optimizerツールを提供しています。これについての詳細は次になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、Intelは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデル動物園</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も提供</font><font style="vertical-align: inherit;">しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中には、道路セグメンテーションの2つのモデルがありました。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よりシンプルな</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のより雑多な</font></font></a></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NCSのニューラルネットワーク</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスでニューラルネットワークを実行するには、いくつかの手順を実行する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスを初期化</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MYRIADの名前、プラグインのアイデアとプラグインの動的読み込み、プログラムで指定する必要があるパス-暗い過去から明確に伸びています。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> openvino.inference_engine <span class="hljs-keyword">import</span> IENetwork, IEPlugin<font></font>
<font></font>
ncs_plugin = IEPlugin(device=<span class="hljs-string">"MYRIAD"</span>, plugin_dirs=<span class="hljs-string">"/opt/intel/openvino/inference_engine/lib/armv7l"</span>)
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルをダウンロード</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、モデルをデバイスにアップロードする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは大変な作業です。</font><font style="vertical-align: inherit;">セグメンテーションに使用したその小さなモデルの読み込みには、約15秒かかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
良いニュースは、モデルを一度ダウンロードするだけで済み、複数のモデルをダウンロードできることです。</font></font><br>
<br>
<pre><code class="python hljs">        model = IENetwork(model=xml_path, weights=bin_path)<font></font>
        net = ncs_plugin.load(network=model)<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">計算を実行</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでモデルを使用できます。</font></font><br>
<br>
<pre><code class="python hljs">    input_blob = next(iter(model.inputs))<font></font>
    out_blob = next(iter(model.outputs))<font></font>
    n, c, h, w = model.inputs[input_blob].shape<font></font>
    images = np.ndarray(shape=(n, c, h, w))<font></font>
    images[<span class="hljs-number">0</span>] = image<font></font>
    res = net.infer(inputs={input_blob: images})<font></font>
    res = res[out_blob]<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シングルプロセス</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
突然、2つの異なるプロセスから同時にNCSを使用できないことがわかりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遅れている人はモデルをロードできません：</font></font><br>
<br>
<pre><code class="bash hljs">E: [ncAPI] [    684447] resetAll:348     Failed to connect to stalled device, rc: X_LINK_ERROR<font></font>
E: [ncAPI] [    691700] ncDeviceOpen:672        Failed to find suitable device, rc: X_LINK_DEVICE_NOT_FOUND<font></font>
Traceback (most recent call last):<font></font>
    net = ncs_plugin.load(network=model)<font></font>
  File <span class="hljs-string">"ie_api.pyx"</span>, line 395, <span class="hljs-keyword">in</span> openvino.inference_engine.ie_api.IEPlugin.load<font></font>
  File <span class="hljs-string">"ie_api.pyx"</span>, line 406, <span class="hljs-keyword">in</span> openvino.inference_engine.ie_api.IEPlugin.load<font></font>
RuntimeError: Can not init USB device: NC_ERROR<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GoogleもIntelのサポートフォーラムもどちらが問題であるかを理解することを可能にしませんでした-デバイスは本当に排他的であるか、または私はそれを調理する方法がわかりません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVinoセグメンテーション</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、OpenVinoはそのまま、道路分割モデルと例を提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト結果は多少矛盾しています。曲がって認識されることもありますが、大多数は正常です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enetはうまく機能しましたが、NCSの下でEnetを実行する必要があるので、今あるもので試してみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gk/ll/sm/gkllsmwznf3smcft_gyxk_gdaos.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、OpenVinoからモデルについてさらに学び、再トレーニングすることはそれほど簡単ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザー</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は興味を持ってい</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">が</font></a><font style="vertical-align: inherit;">、Intelの人はモデルのコードとデータはクローズされていると厳密に言っており、希望する人</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はPyTorch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">同様のニューラルネットワークを利用し</font></a><font style="vertical-align: inherit;">、トレーニングし、変換して使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
速度の利点は非常に重要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enetセグメンテーションに6秒かかった場合、このモデルは1つの画像を処理するのに0.8秒かかりました（モデルをデバイスにロードするのに14秒かかりましたが、同時に実行されました）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向の分類</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対応する記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
説明されているように、戦車は移動方向を決定するために、単純なニューラルネットワークを使用し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ニューラルネットワークはKerasでトレーニングされ、この形式の組み込みアダプターを備えたTensorflowを介してRaspberryで実行されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常にシンプルで、Raspberryでも許容可能な速度の結果を示します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（0.35秒/画像）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでも、Intelグランドがあれば、より良い結果を期待できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IntelのModel Optimizerが変換用に受け入れる形式には、Tensorflowがありますが、Kerasはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KerasをTFに変換することは非常に人気のあることであり、このトピックに関する十分な資料があり、私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に導かれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ著者が持っている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より広範な記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、特にKerasモデルがOpenVinoでどのように実行されるかについてのトピック。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Intel</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニュアルを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用することもでき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、ソースをコンパイルして、KerasモデルをTFに変換するためのスクリプトを入手しました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.python.framework.graph_util <span class="hljs-keyword">import</span> convert_variables_to_constants
<span class="hljs-keyword">from</span> keras <span class="hljs-keyword">import</span> backend <span class="hljs-keyword">as</span> K
<span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> load_model
<span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> model_from_json<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_keras_model</span>(<span class="hljs-params">json_file, model_file</span>):</span>
    jf = open(json_file, <span class="hljs-string">'r'</span>)<font></font>
    loaded_model_json = jf.read()<font></font>
    jf.close()<font></font>
    loaded_model = model_from_json(loaded_model_json)<font></font>
    loaded_model.load_weights(model_file)<font></font>
    <span class="hljs-keyword">return</span> loaded_model<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">freeze_session</span>(<span class="hljs-params">session, keep_var_names=None, output_names=None, clear_devices=True</span>):</span><font></font>
    graph = session.graph<font></font>
    <span class="hljs-keyword">with</span> graph.as_default():<font></font>
        freeze_var_names = list(set(v.op.name <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> tf.global_variables()).difference(keep_var_names <span class="hljs-keyword">or</span> []))<font></font>
        output_names = output_names <span class="hljs-keyword">or</span> []<font></font>
        output_names += [v.op.name <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> tf.global_variables()]
        <span class="hljs-comment"># Graph -&gt; GraphDef ProtoBuf</span><font></font>
        input_graph_def = graph.as_graph_def()<font></font>
        <span class="hljs-keyword">if</span> clear_devices:
            <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> input_graph_def.node:<font></font>
                node.device = <span class="hljs-string">""</span><font></font>
        frozen_graph = convert_variables_to_constants(session, input_graph_def,<font></font>
                                                      output_names, freeze_var_names)<font></font>
        <span class="hljs-keyword">return</span> frozen_graph<font></font>
<font></font>
<font></font>
model = load_keras_model(<span class="hljs-string">'./model.json'</span>, <span class="hljs-string">'./model.h5'</span>)<font></font>
frozen_graph = freeze_session(K.get_session(),<font></font>
                              output_names=[out.op.name <span class="hljs-keyword">for</span> out <span class="hljs-keyword">in</span> model.outputs])<font></font>
tf.train.write_graph(frozen_graph, <span class="hljs-string">"."</span>, <span class="hljs-string">"ktf_model.pb"</span>, as_text=<span class="hljs-literal">False</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じコード</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がgithubにあり</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のTFモデルは、OpenVino形式にさらに抽出されます。</font></font><br>
<br>
<pre><code class="bash hljs">python mo_tf.py --input_model <span class="hljs-string">"model/ktf_model.pb"</span> --log_level=DEBUG -b1 --data_type FP16</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストの結果、画像の分類には0.007秒かかることがわかりました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この結果は非常に喜ばしいものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのトレーニング済みモデル（Keras、TF、OpenVino）も</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップロードさ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">れ</font></a><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物体認識</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロボットが困難な人生の中で解決しなければならないのは、セグメンテーションタスクだけではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初めに猫検出器がありましたが、後にMobileSSDとOpenCV-DNNに基づくユニバーサル検出器に成長しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、NCSで同じタスクを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intelの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model_zoo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">MobileSSD</font></a><font style="vertical-align: inherit;">に基づいた特定度の狭い検出器で十分ですが、正確な類似体はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このネットワークは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サポートされているTFモデルのリストに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互換性があると記載されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、これを書いている時点では、MobileSSD 2018_01_28のバージョンがここに示されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、OpenCVはこのモデルの読み取りを拒否します。</font></font><br>
<br>
<pre><code class="bash hljs">cv2.error: OpenCV(4.1.0-openvino) /home/jenkins/workspace/OpenCV/OpenVINO/build/opencv/modules/dnn/src/tensorflow/tf_importer.cpp:530: <font></font>
error: (-2:Unspecified error) Const input blob <span class="hljs-keyword">for</span> weights not found <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> <span class="hljs-string">'getConstBlob'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（しかし、Jenkinsを使用していることがわかりました）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、OpenVinoへの変換も成功しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenCV-DNN（11_06_2017）と互換性のあるモバイルSSDのバージョンを変換しようとすると、次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">[E0919 main.py:317] Unexpected exception happened during extracting attributes <span class="hljs-keyword">for</span> node FeatureExtractor/MobilenetV1/Conv2d_13_pointwise_1_Conv2d_2_1x1_256/Relu6.<font></font>
Original exception message: operands could not be broadcast together with remapped shapes [original-&gt;remapped]: (0,) and<font></font>
 requested shape (1,0,10,256)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような何か、技術的にはOpenVinoとOpenCV-DNNは同じパッケージに含まれていますが、使用されているニューラルネットワークのバージョンとは互換性がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、両方のアプローチを同時に使用する場合は、2つのバージョンのMobileSSDをドラッグする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
速度に関しては、比較はNCSに有利です。0.1秒対1.7。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
品質に関して...（これはNCSの問題ではなく、モバイルSSDの進化の問題です）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rz/58/zz/rz58zzzllyd5i3gubv99nz5-b6m.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像分類</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タンクは、ImagenetのInceptionを使用して、Tensorflowを通じて画像を分類できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私は2015-12-05に別の時期にInceptionを使用しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グーグルからの連中が無駄にパンを食べているわけではなく、すでに4つのバージョンを作成しているので、私は人生をはるかに遅れていることがわかりました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、Intelの人たちはその背後にいるわけではなく、4つのバージョンすべてがOpenVinoでサポートされていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inceptionのさまざまなバージョンを説明</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">する記事</font></a><font style="vertical-align: inherit;">です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ささいなことはしません。最後の4番目にすぐにダウンロードします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルの上の猫とラップトップで写真を分類します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のバージョンの結果を覚えています：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラップトップ、ラップトップコンピュータ62％</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノートブック、ノートブックコンピュータ11％</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13秒</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫はどこ？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font><font style="vertical-align: inherit;">InceptionをOpenVinoに変換する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を読みます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変換が成功し、NCSで分類子を開始します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラップトップ、ラップトップコンピュータ85％</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノートブック、ノートブックコンピュータ8％</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.2秒</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また猫がいない</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Tensorflowを必要とするすべてのシナリオはNCSを使用して再現されました。これは、Tensorflowの使用を拒否できることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とにかく、このフレームワークはラズベリーにとって重いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCSがニューラルネットワークを消化する速度により、視野を広げることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、セマンティックセグメンテーションと分類など、ロボットがすでに実行しているタスクがありますが、オブジェクトのセグメンテーションや、検出されたオブジェクトを含むビデオのリアルタイムでの送信などもあります。</font><font style="vertical-align: inherit;">（これは裸のラズベリーでは考えられなかったでしょう）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マルチプロセッシングの問題はやや混乱しますが、解決できない場合でも、別のサービスとしてNCSをラップするという形で常にオプションがあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel OpenVino Intro</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspbianインストールガイド</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVinoモデル動物園-説明付きの既製モデルのリスト</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVinoモデルをダウンロードできるリソース</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上のOpenVino用のタンクリポジトリファームウェア</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459112/index.html">Google Chromeの理解HTMLからPDFへの変換機能</a></li>
<li><a href="../ja459116/index.html">胸腺修復に一歩近づく</a></li>
<li><a href="../ja459118/index.html">Huaweiのモスクワオフィスでの新しいネットワークの設計と実装方法、パート2</a></li>
<li><a href="../ja459120/index.html">UNO-1000 / 2000シリーズモジュラーエンベデッドコンピューター</a></li>
<li><a href="../ja459122/index.html">Alexey Savvateev：不完全な市場（2014年）と集団的評判を分析したジャンチロルのノーベル賞</a></li>
<li><a href="../ja459128/index.html">現実世界の日本語インターフェース</a></li>
<li><a href="../ja459130/index.html">マイクロサービスでの穏やかなエラー処理</a></li>
<li><a href="../ja459134/index.html">BDDの使用経験</a></li>
<li><a href="../ja459136/index.html">偽の青い錠剤</a></li>
<li><a href="../ja459138/index.html">Huaweiの秘密鍵がCiscoルーターのファームウェアに入った方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>