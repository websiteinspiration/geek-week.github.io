<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛹🏿 🎓 🤮 Serveur Web WSGI unique utilisant ESP8266. Partie 1 🔅 🔈 👣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! 
 
 Cet article est la première partie de mon tutoriel sur le développement d'un serveur WSGI plutôt inhabituel. Dans cet article, je ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Serveur Web WSGI unique utilisant ESP8266. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486752/"><img src="https://habrastorage.org/webt/2g/wi/wb/2gwiwbq1_ed0lwgklvoy8kqsayi.png" align="left"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour à tous! </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est la première partie de mon tutoriel sur le développement d'un serveur WSGI plutôt inhabituel. </font><font style="vertical-align: inherit;">Dans cet article, je vais expliquer la partie théorique de mon idée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le public principal est les développeurs novices qui connaissent Python mais veulent connaître le zen du protocole http. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prêt? </font><font style="vertical-align: inherit;">Allons sous le chat.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intro </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, cet article est un accompagnement textuel de ma vidéo (j'essaie de maintenir un blog vidéo). Si vous êtes intéressé, une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vidéo sur Youtube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avez-vous déjà eu l'idée d'écrire un programme que personne d'autre n'a écrit? Quelque chose au point de la folie unique, absolument (ou presque absolu) inutile, mais intéressant? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non? Eh bien, Dieu merci, les gens normaux me lisent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai conçu un projet unique et très intéressant, dont la mise en œuvre me permettra, ainsi qu'au lecteur, de comprendre en pratique le fonctionnement de http et du serveur web. Ce projet plongera le lecteur dans le monde de la folie des spécifications http, du paradoxe des expressions régulières et des imperfections des pilotes :-). Ce qui vous permettra de connaître toute la douleur du développement de bas niveau et de profiter des besoins simples des utilisateurs stupides</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Au fait, vous serez peut-être surpris, mais l'idée de ce projet n'est pas née de nulle part. </font><font style="vertical-align: inherit;">Le fait est que j'ai un Raspberry PI Zero sans Wi-Fi et NodeMCU avec wi-fi. </font><font style="vertical-align: inherit;">J'ai donc pensé - est-il possible d'écrire un serveur Web sur Django et d'héberger sur un Raspberry PI tout en se connectant au réseau via le Wi-Fi. </font><font style="vertical-align: inherit;">Une personne normale aurait pensé à acheter une framboise avec Wi-Fi ou à connecter un adaptateur Wi-Fi à une framboise. </font><font style="vertical-align: inherit;">J'ai eu l'idée de connecter l'ESP8266 à la framboise, mais comme l'ESP8266 ne peut pas fonctionner comme adaptateur réseau, l'idée m'est venue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fuh, j'espère que je me suis justifié. </font><font style="vertical-align: inherit;">Maintenant au point</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Théorie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un serveur Web est une chose assez compliquée qui fonctionne à un bas niveau avec les sockets, analyse les requêtes http brutes, analyse les en-têtes, gère les connexions, équilibre la charge, etc. Et il est préférable de garder ce module complexe séparé, car l'application Web fonctionne déjà avec des concepts de niveau supérieur de modèles, de contrôleurs et de vues. Les deux composantes sont nécessaires et importantes pour le travail du web, mais les domaines de connaissances nécessaires à leur développement ne se chevauchent pas beaucoup, il est donc préférable pour eux de se connaître le moins possible l'un de l'autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous le savez, il existe de nombreuses applications compatibles avec les serveurs Web écrits en Python (Gunicorn, Bojern, CherryPy, mais pas beaucoup d'entre elles). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, il existe de nombreux frameworks Web qui peuvent fonctionner avec n'importe lequel de ces serveurs Web.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment cela peut-il arriver? C'est simple - nous avons besoin d'une norme et cette norme est appelée WSGI </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8ba/d1c/7a9/8bad1c7a923c50240e6ebb6fbce51465.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 1 WSGI</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
WSGI fait partie de la spécification PEP et vous permet d'utiliser divers cadres et applications Web sans presque aucun souci de compatibilité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et l'illustration suivante illustre parfaitement mon idée d'un serveur Web Python </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a34/c40/ccd/a34c40ccd0f6ed6e94d812addf8a0fcd.png" alt="image"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 2</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Le lecteur pourrait remarquer ESP8266 dans l'image - non, je ne placerai pas le serveur Web sur cet appareil, car ce serait trop banal par rapport à mon idée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ESP8266 clignote avec le firmware AT d'origine et n'accepte que les commandes AT. Mais le plus important, à l'aide des commandes AT, il peut lever le sosket vers le nord, qui recevra les requêtes http du client (réception via WiFi) et les diffusera via le port série</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le port série, ESP transmet 2 paramètres importants - l'ID de socket, indiquant que nous retournerons une réponse au client. L'ESP8266, en passant, prend en charge un maximum de 4 connexions de socket simultanées. Et bien sûr la requête http </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre serveur web python 3 analyse http en repliant les en-têtes dans un objet d'environnement spécial et lève l'objet d'application en lui passant la méthode start_response avec laquelle notre application retournera la réponse et le dictionnaire d'environnement qui contient tous les en-têtes nécessaires et le corps de la requête http (méthodes nécessaires et les clés de dictionnaire d'environnement requises sont un élément clé de la spécification WSGI)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que le framework traite la demande et génère une réponse, il extrait la méthode start_response, dans cette méthode, nous obtenons les paramètres nécessaires pour générer la réponse http, construire la chaîne html brute et transférer le </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tout au client </font><font style="vertical-align: inherit;">via le port série dans ESP8266. </font><font style="vertical-align: inherit;">ESP8266, à son tour </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, J'ai trouvé la bonne façon de flasher ESP8266 AT avec le firmware d'usine dans un excellent article, un lien vers lequel vous trouverez sous le numéro 2 dans la section URL utiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les commandes AT, la communication avec ESP8266 est la suivante (j'utilise le shell ESPloter pour la communication) </font><font style="vertical-align: inherit;">Je suppose que l'ESP8266 dispose du WiFi. </font><font style="vertical-align: inherit;">Si le Wi-Fi n'est pas augmenté - il est également facile de le faire via ESPloter</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commande AT + CIPMUX = 1 - ouvre une connexion multiple</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commande AT + CIPSERVER = 1,80 (port 80, que nous ouvrons)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir entré ces commandes, nous avons élevé le serveur TCP à ESP8266 et pouvons recevoir des demandes du client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 renvoyons </font><font style="vertical-align: inherit;">également la réponse au client avec 2 commandes </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">Commande </font><font style="vertical-align: inherit;">AT + CIPSEND = numéro de socket, nombre d'octets Une </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fois cette commande terminée, le terminal attendra un message du nombre d'octets spécifié. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous entrerons suffisamment de caractères, la session de transmission se terminera et nous devrons entrer une nouvelle commande </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AT + CIPCLOSE = numéro prise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cela, le navigateur termine la session et affiche le texte transmis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout pour aujourd'hui. </font><font style="vertical-align: inherit;">J'espère que la semaine prochaine j'ajouterai et exposerai la partie pratique. </font><font style="vertical-align: inherit;">J'ai un certain nombre de problèmes, principalement avec le fonctionnement du terminal et l'analyse http, mais ils semblent être résolubles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remercier! </font><font style="vertical-align: inherit;">Jusqu'à.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL utiles</font></font></h3> <br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Let`s Build A Web Server</font></a><font style="vertical-align: inherit;"> m'a beaucoup aidé dans ce projet.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'article </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Restaurer le micrologiciel AT sur l'ESP8266</font></a><font style="vertical-align: inherit;"> m'a aidé à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flasher ESP8266</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne sous-estimez pas la puissance de la documentation officielle. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemples de commandes AT</font></font></a></li>
</ol></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486752/">https://habr.com/ru/post/fr486752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486740/index.html">Écriture d'une API dans Rust à l'aide de macros procédurales</a></li>
<li><a href="../fr486742/index.html">Entretien avec Anatoly Wasserman sur l'avenir</a></li>
<li><a href="../fr486744/index.html">Un correcteur de posture intelligent fabriqué au pays a été mis en vente. Nous avons regardé le nouveau produit - IBACK</a></li>
<li><a href="../fr486746/index.html">Écrivez, ne coupez pas. Ce que j'ai commencé à manquer dans les publications de Habr</a></li>
<li><a href="../fr486750/index.html">La série "For All Mankind": d'une histoire alternative à la poubelle</a></li>
<li><a href="../fr486754/index.html">JIRA: règles pour la préparation en temps opportun de délicieux logiciels. TLDR 2: gestion des exigences</a></li>
<li><a href="../fr486756/index.html">Python pour le testeur: comment les petits scripts pandas c aident à tester de grands ensembles de données</a></li>
<li><a href="../fr486760/index.html">Security Week 06: trackers publicitaires dans les applications mobiles</a></li>
<li><a href="../fr486762/index.html">Hébergement de chevet: la pratique effrayante de l'hébergement à domicile</a></li>
<li><a href="../fr486764/index.html">Bricolage Schema.org: personnalisation de la micro-mise en page sans programmeur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>