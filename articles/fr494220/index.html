<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçü§ù‚Äçüë®üèª ‚úñÔ∏è ü§ôüèΩ OpenToonz: √† l'int√©rieur et √† l'ext√©rieur üçó üéé üõå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√®s de quatre ans se sont √©coul√©s depuis que PVS-Studio a v√©rifi√© le code source d'OpenToonz. Ce projet est un outil tr√®s puissant pour cr√©er une ani...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>OpenToonz: √† l'int√©rieur et √† l'ext√©rieur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/494220/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dea/ccf/6dd/deaccf6dded129be42e3f458e2457c48.png" alt="image1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pr√®s de quatre ans se sont √©coul√©s depuis que PVS-Studio a v√©rifi√© le code source d'OpenToonz. </font><font style="vertical-align: inherit;">Ce projet est un outil tr√®s puissant pour cr√©er une animation en deux dimensions. </font><font style="vertical-align: inherit;">Depuis le dernier contr√¥le, avec son aide, des ≈ìuvres d'animation telles que Mary et la fleur de sorci√®re, Batman Ninja, Promare et d'autres ont √©t√© cr√©√©es. </font><font style="vertical-align: inherit;">√âtant donn√© que les grands studios continuent d'utiliser Toonz, pourquoi ne pas v√©rifier √† nouveau la qualit√© du code source?</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez vous familiariser avec l'analyse pr√©c√©dente des erreurs dans l'article " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mauvais code d'un package pour cr√©er des animations 2D de Toonz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">En g√©n√©ral, il ne semble pas que la qualit√© du code se soit beaucoup am√©lior√©e, donc l'impression g√©n√©rale n'est pas meilleure. </font><font style="vertical-align: inherit;">En outre, bon nombre des m√™mes erreurs ont √©t√© trouv√©es que dans l'article pr√©c√©dent. </font><font style="vertical-align: inherit;">Nous ne les examinerons pas √† nouveau, car il y a beaucoup de choix.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, vous devez comprendre que la pr√©sence d'erreurs n'emp√™che pas n√©cessairement l'utilisation active et productive du produit logiciel. Tr√®s probablement, les erreurs trouv√©es se trouvent dans des parties du code rarement utilis√©es ou compl√®tement inutilis√©es, sinon elles auraient √©t√© identifi√©es dans le processus d'utilisation de l'application et corrig√©es. Cependant, cela ne signifie pas que l'analyse statique est redondante. C'est juste que le sens de l'analyse statique n'est pas de rechercher des erreurs anciennes et non pertinentes, mais de r√©duire le co√ªt du processus de d√©veloppement. De nombreuses erreurs lors de l'√©criture de code peuvent √™tre d√©tect√©es imm√©diatement, et non pendant le fonctionnement du logiciel. En cons√©quence, avec l'utilisation r√©guli√®re d'un analyseur statique, les erreurs sont corrig√©es √† un stade pr√©coce. Cela permet aux d√©veloppeurs de gagner du temps et de l'argent pour l'entreprise et am√©liore la perception du produit par les utilisateurs. D'accord, il est d√©sagr√©able de se d√©sabonner constamment aux d√©veloppeurs,qu'une chose ou l'autre ne fonctionne pas.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N1 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comportement </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">ind√©fini</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">V√©rifiez l'op√©rateur de d√©calage ¬´&lt;&lt;¬ª. </font><font style="vertical-align: inherit;">L'op√©rande gauche '(- 1)' est n√©gatif.</font></font><br>
<br>
<pre><code class="cpp hljs">decode_mcu_AC_refine (j_decompress_ptr cinfo, JBLOCKROW *MCU_data)<font></font>
{<font></font>
  <span class="hljs-keyword">int</span> p1, m1;<font></font>
  p1 = <span class="hljs-number">1</span> &lt;&lt; cinfo-&gt;Al;    <font></font>
  m1 = (<span class="hljs-number">-1</span>) &lt;&lt; cinfo-&gt;Al; <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On ne sait pas exactement ce que l'auteur du code voulait r√©aliser ici. </font><font style="vertical-align: inherit;">L'utilisation d'op√©rateurs de d√©calage avec des nombres n√©gatifs conduit √† un comportement ind√©fini. </font><font style="vertical-align: inherit;">La fa√ßon dont le comportement des op√©rateurs de d√©calage est d√©crit dans la norme semble un peu d√©routant √† premi√®re vue, mais n√©anmoins, v√©rifions-le: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Le type du r√©sultat est celui de l'op√©rande gauche promu. </font><font style="vertical-align: inherit;">Le comportement n'est pas d√©fini si l'op√©rande droit est n√©gatif, ou sup√©rieur ou √©gal √† la longueur en bits de l'op√©rande gauche promu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. La valeur de E1 &lt;&lt; E2 correspond aux positions de bits E2 d√©cal√©es vers la gauche E2; les bits lib√©r√©s sont remplis de z√©ro. Si E1 a un type non sign√©, la valeur du r√©sultat est E1 * 2 ^ E2, modulo r√©duit un de plus que la valeur maximale repr√©sentable dans le type de r√©sultat. Sinon, si E1 a un type sign√© et une valeur non n√©gative et que E1 * 2 ^ E2 est repr√©sentable dans le type de r√©sultat, alors c'est la valeur r√©sultante; sinon, le comportement n'est pas d√©fini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le comportement n'est pas d√©fini si l'op√©rande droit ou gauche a une valeur n√©gative. Si l'op√©rande est de type sign√©, de valeur non n√©gative et s'inscrit dans le type r√©sultant, le comportement sera normal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N2 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation du mod√®le 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e. </font><font style="vertical-align: inherit;">Il y a une probabilit√© de pr√©sence d'erreur logique. </font><font style="vertical-align: inherit;">V√©rifier les lignes: 156, 160. cameracapturelevelcontrol.cpp 156</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CameraCaptureLevelHistogram::mousePressEvent</span><span class="hljs-params">(QMouseEvent* event)</span> </span>{
  <span class="hljs-keyword">if</span> (event-&gt;button() != Qt::LeftButton) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (m_currentItem == Histogram) {<font></font>
    m_histogramCue = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (m_currentItem == None) <span class="hljs-keyword">return</span>;<font></font>
  QPoint pos = event-&gt;pos();<font></font>
  <span class="hljs-keyword">if</span> (m_currentItem == BlackSlider)  <span class="hljs-comment">// &lt;=</span><font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_black;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == GammaSlider)<font></font>
    m_offset = pos.x() - SIDE_MARGIN - gammaToHPos(m_gamma, m_black, m_white);<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == BlackSlider)  <span class="hljs-comment">// &lt;=</span><font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_white;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == ThresholdSlider)<font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_threshold;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_offset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> re√ßoit des valeurs diff√©rentes en fonction de la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_currentItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cependant, la duplication de la v√©rification sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlackSlider est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inutile, et √† partir du corps de la condition, vous pouvez voir que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_white</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est impliqu√©e dans le calcul </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Examinons les valeurs possibles pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_currentItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs">  LevelControlItem m_currentItem;<font></font>
<font></font>
  <span class="hljs-keyword">enum</span> LevelControlItem {<font></font>
    None = <span class="hljs-number">0</span>,<font></font>
    BlackSlider,<font></font>
    WhiteSlider,<font></font>
    GammaSlider,<font></font>
    ThresholdSlider,<font></font>
    Histogram,<font></font>
    NumItems<font></font>
  };</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/664/caa/09b/664caa09b6eca7a582ae4441c232e61e.png" alt="image3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WhiteSlider</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est √©galement </font><i><font style="vertical-align: inherit;">possible</font></i><font style="vertical-align: inherit;"> , pour laquelle la v√©rification n'est tout simplement pas effectu√©e. </font><font style="vertical-align: inherit;">Ainsi, il est tout √† fait possible que certains des sc√©narios de comportement aient √©t√© perdus en raison d'une erreur de copier-coller. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N3 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'utilisation du </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">mod√®le</font></a><font style="vertical-align: inherit;"> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e. </font><font style="vertical-align: inherit;">Il y a une probabilit√© de pr√©sence d'erreur logique. </font><font style="vertical-align: inherit;">V√©rifier les lignes: 784, 867. tpalette.cpp 784</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TPalette::loadData</span><span class="hljs-params">(TIStream &amp;is)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> tagName;
  <span class="hljs-keyword">while</span> (is.openChild(tagName)) {
    <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"version"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"stylepages"</span>) { <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">while</span> (!is.eos()) {
        <span class="hljs-keyword">if</span> (....){<font></font>
          ....<font></font>
        }<font></font>
        ....<font></font>
        is.closeChild();<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"refImgPath"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"animation"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"stylepages"</span>) { <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">int</span> key = <span class="hljs-string">'0'</span>;
      <span class="hljs-keyword">while</span> (!is.eos()) {
        <span class="hljs-keyword">int</span> styleId = <span class="hljs-number">0</span>;<font></font>
        ....<font></font>
      }<font></font>
    } <font></font>
      ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre erreur similaire. </font><font style="vertical-align: inherit;">Ici, les m√™mes conditions ont des corps diff√©rents, mais il </font><font style="vertical-align: inherit;">n'est plus </font><font style="vertical-align: inherit;">possible de conclure sur les options possibles pour la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tagName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tr√®s probablement, une option a √©t√© manqu√©e, et √† la fin, nous avons du code qui ne sera jamais ex√©cut√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N4 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expression 'chancount == 2' est toujours vraie. </font><font style="vertical-align: inherit;">psd.cpp 720</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TPSDReader::readImageData</span><span class="hljs-params">(...., <span class="hljs-keyword">int</span> chancount)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (depth == <span class="hljs-number">1</span> &amp;&amp; chancount == <span class="hljs-number">1</span>) { <span class="hljs-comment">// &lt;= 1</span><font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depth == <span class="hljs-number">8</span> &amp;&amp; chancount &gt; <span class="hljs-number">1</span>) {<font></font>
    ....<font></font>
    <span class="hljs-keyword">for</span> (....) {
      <span class="hljs-keyword">if</span> (chancount &gt;= <span class="hljs-number">3</span>) {<font></font>
        ....<font></font>
        <span class="hljs-keyword">if</span> (chancount == <span class="hljs-number">4</span>)  <font></font>
          ....<font></font>
        <span class="hljs-keyword">else</span><font></font>
          ....<font></font>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (chancount &lt;= <span class="hljs-number">2</span>)  <span class="hljs-comment">// &lt;= 2</span><font></font>
      {<font></font>
        ....<font></font>
        <span class="hljs-keyword">if</span> (chancount == <span class="hljs-number">2</span>) <span class="hljs-comment">// &lt;= 3</span><font></font>
          ....<font></font>
        <span class="hljs-keyword">else</span><font></font>
          ....<font></font>
      }<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_headerInfo.depth == <span class="hljs-number">8</span> &amp;&amp; chancount == <span class="hljs-number">1</span>) {<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une petite erreur logique s'est gliss√©e dans ces v√©rifications. </font><font style="vertical-align: inherit;">Dans le test sous le num√©ro un, le nombre de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changements est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compar√© √† 1, et dans le test num√©ro 2, il est v√©rifi√© que cette variable est inf√©rieure ou √©gale √† 2. Par cons√©quent, la seule valeur de nombre de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changements</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> possible </font><font style="vertical-align: inherit;">est 2 </font><font style="vertical-align: inherit;">√† la condition sous le num√©ro </font><font style="vertical-align: inherit;">3. Cette erreur peut ne pas conduire √† un fonctionnement incorrect du programme, mais cela complique la lecture et la compr√©hension du code. </font><font style="vertical-align: inherit;">Par exemple, on ne sait pas pourquoi la branche else alors ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, la fonction consid√©r√©e dans ce fragment prend un peu plus de 300 lignes de code et se compose de tels tas de conditions et de boucles.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/725/c28/39a/725c2839a5774ec76b0143ec64531fda.png" alt="image4.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N5 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V614</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variable non initialis√©e 'precSegmentIndex' utilis√©e. </font><font style="vertical-align: inherit;">Pensez √† v√©rifier le cinqui√®me argument r√©el de la fonction 'insertBoxCorners'. </font><font style="vertical-align: inherit;">rasterselection.cpp 803</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">TStroke <span class="hljs-title">getIntersectedStroke</span><span class="hljs-params">(TStroke &amp;stroke, TRectD bbox)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> precSegmentIndex, currentSegmentIndex, startSegmentIndex,<font></font>
      precChunkIndex = <span class="hljs-number">-1</span>;<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....) {<font></font>
    insertBoxCorners(bbox, points, outPoints, currentSegmentIndex,<font></font>
                     precSegmentIndex);<font></font>
    ....<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertBoxCorners</span><span class="hljs-params">(...., <span class="hljs-keyword">int</span> currentSegmentIndex, <span class="hljs-keyword">int</span> precSegmentIndex)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">bool</span> sameIndex = (precSegmentIndex == currentSegmentIndex);<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> segmentIndex = precSegmentIndex;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre, une erreur a √©t√© commise ici m√™me lors de l'initialisation des variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precChunkIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le d√©veloppeur pouvait s'attendre √† ce que l'initialisation du dernier √©l√©ment -1 s'initialise avec la m√™me valeur que les autres variables d√©clar√©es sur la m√™me ligne. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N6 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envisagez d'inspecter l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">expression</font></a><font style="vertical-align: inherit;"> 's! = "" &amp;&amp; s == "color"'. </font><font style="vertical-align: inherit;">L'expression est excessive ou contient une erreur d'impression. </font><font style="vertical-align: inherit;">cleanupparameters.cpp 416</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CleanupParameters::loadData</span><span class="hljs-params">(TIStream &amp;is, <span class="hljs-keyword">bool</span> globalParams)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> s = is.getTagAttribute(<span class="hljs-string">"sharpness"</span>);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....)<font></font>
  {<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"lineProcessing"</span>)<font></font>
    ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; isDouble(s)) <font></font>
      ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; isDouble(s))<font></font>
      ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; s == <span class="hljs-string">"color"</span>) <span class="hljs-comment">// &lt;=</span><font></font>
      ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"despeckling"</span>) {<font></font>
    ....  <font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette erreur, m√™me plut√¥t un d√©faut, ne conduit en soi qu'√† une comparaison inutile. </font><font style="vertical-align: inherit;">Cependant, si nous regardons le code dans son ensemble, il deviendra clair que la comparaison suppl√©mentaire est apparue √† la suite du copier-coller des conditions pr√©c√©dentes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bcc/077/857/bcc077857a8341d45e6fcf504129353c.png" alt="image5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces nouilles, qui occupent des dizaines ou plus de lignes de code, peuvent bien contenir d'autres erreurs logiques, et leur recherche avec ce formatage peut se transformer en tourment. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N7 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V772 L'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appel d'un op√©rateur de suppression pour un pointeur vide entra√Ænera un comportement ind√©fini. </font><font style="vertical-align: inherit;">pluginhost.cpp 1327</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_interface</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *interf)</span> </span>{
  <span class="hljs-keyword">if</span> (interf) <span class="hljs-keyword">delete</span> interf;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, le message de l'analyseur lui-m√™me est d√©j√† assez exhaustif: appeler l'op√©rateur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suppression</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur un pointeur vers un type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conduit √† un comportement ind√©fini. </font><font style="vertical-align: inherit;">Si une fonction universelle √©tait n√©cessaire pour supprimer les interfaces, cela pourrait valoir la peine d'en faire un passe-partout.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;class T&gt;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_interface</span><span class="hljs-params">(T *interf)</span> </span>{
  <span class="hljs-keyword">if</span> (interf) <span class="hljs-keyword">delete</span> interf;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N8 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il est √©trange que l'op√©rateur 'sizeof ()' √©value la taille d'un pointeur vers une classe, mais pas la taille de l'objet de classe 'm_xshHandle'. </font><font style="vertical-align: inherit;">tstageobjectcmd.cpp 455</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DVAPI</span> <span class="hljs-title">TStageObjectParams</span> {</span><font></font>
  ....<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RemovePegbarNodeUndo</span> <span class="hljs-title">final</span> :</span> <span class="hljs-keyword">public</span> TUndo {<font></font>
  ....<font></font>
  TXsheetHandle *m_xshHandle;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">sizeof</span> *<span class="hljs-keyword">this</span> + <span class="hljs-keyword">sizeof</span>(TStageObjectParams) + <span class="hljs-keyword">sizeof</span>(m_xshHandle);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">assez courante</font></a><font style="vertical-align: inherit;"> qui peut survenir √† la fois par inattention et par ignorance. </font><font style="vertical-align: inherit;">Ici, tr√®s probablement, la question √©tait inattentive, car dans le premier mandat, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©tait n√©anmoins d√©f√©renc√©e. </font><font style="vertical-align: inherit;">Si vous avez besoin de la taille d'un objet, vous devez toujours vous rappeler que le pointeur d'un objet doit √™tre d√©r√©f√©renc√©. </font><font style="vertical-align: inherit;">Sinon, nous obtenons simplement la taille du pointeur lui-m√™me.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">return</span> <span class="hljs-keyword">sizeof</span> *<span class="hljs-keyword">this</span> + <span class="hljs-keyword">sizeof</span>(TStageObjectParams) + <span class="hljs-keyword">sizeof</span>(*m_xshHandle);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N9 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il est √©trange que l'op√©rateur 'sizeof ()' √©value la taille d'un pointeur vers une classe, mais pas la taille de l'objet de classe 'this'. </font><font style="vertical-align: inherit;">shaderfx.cpp 107</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RectF</span> {</span>
  GLfloat m_val[<span class="hljs-number">4</span>];<font></font>
  ....<font></font>
  <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> RectF &amp;rect) <span class="hljs-keyword">const</span> {
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">memcmp</span>(m_val, rect.m_val, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">this</span>)) == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, √©videmment, ils ont oubli√© de d√©r√©f√©rencer le pointeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par cons√©quent, nous obtenons non pas la taille de l'objet, mais la taille du pointeur. </font><font style="vertical-align: inherit;">Par cons√©quent, seuls les 4 ou 8 premiers octets sont compar√©s (en fonction de la profondeur de bits). </font><font style="vertical-align: inherit;">La version correcte du code:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">return</span> (<span class="hljs-built_in">memcmp</span>(m_val, rect.m_val, <span class="hljs-keyword">sizeof</span>(*<span class="hljs-keyword">this</span>)) == <span class="hljs-number">0</span>);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N10 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V554</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilisation incorrecte de unique_ptr. </font><font style="vertical-align: inherit;">La m√©moire allou√©e avec ¬´nouveau []¬ª sera nettoy√©e √† l'aide de ¬´supprimer¬ª. </font><font style="vertical-align: inherit;">screensavermaker.cpp 29</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">makeScreenSaver</span><span class="hljs-params">(TFilePath scrFn, TFilePath swfFn,
                     <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> screenSaverName)</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">stat</span> <span class="hljs-title">results</span>;</span><font></font>
....<font></font>
  <span class="hljs-keyword">int</span> swfSize = results.st_size;
  <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">char</span>&gt; <span class="hljs-title">swf</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[swfSize])</span></span>;<font></font>
....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On oublie souvent que le type par lequel unique_ptr est instanci√© d√©pend de la suppression ou de la suppression de []. Par cons√©quent, si vous instanciez le pointeur comme dans le fragment consid√©r√©, lors de l'allocation de m√©moire via new [], un comportement ind√©fini peut se produire, car la lib√©ration se fera par suppression. Pour √©viter cela, vous devez ajouter des crochets au type de pointeur: std :: unique_ptr &lt;char []&gt;. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N11 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V521</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> De telles expressions utilisant l'op√©rateur ¬´,¬ª sont dangereuses. Assurez-vous que l'expression ¬´m_to, m_from = it-&gt; first.getNumber ()¬ª est correcte. flipbook.cpp 509</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadImagesPopup</span> <span class="hljs-title">final</span> :</span> <span class="hljs-keyword">public</span> FileBrowserPopup {<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> m_from, m_to, ....;<font></font>
  ....<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LoadImagesPopup::onFilePathClicked</span><span class="hljs-params">(....)</span> </span>{<font></font>
  TLevel::Iterator it;<font></font>
  ....<font></font>
  it = level-&gt;begin();<font></font>
  m_to, m_from = it-&gt;first.getNumber();  <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">for</span> (; it != level-&gt;end(); ++it) m_to = it-&gt;first.getNumber();<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (m_from == <span class="hljs-number">-2</span> &amp;&amp; m_to == <span class="hljs-number">-2</span>) m_from = m_to = <span class="hljs-number">1</span>;<font></font>
<font></font>
  m_minFrame = m_from;<font></font>
  m_maxFrame = m_to;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que le programmeur s'attendait √† ce que vous puissiez attribuer une valeur √† plusieurs variables en les √©crivant simplement avec une virgule. Cependant, l'op√©rateur "," en C ++ fonctionne diff√©remment. Dans ce document, le premier op√©rande est ex√©cut√© et le r√©sultat est "r√©initialis√©", puis le deuxi√®me op√©rande est calcul√©. Et, bien que la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_to soit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initialis√©e dans un cycle suivant, si quelque chose se passe mal ou que quelqu'un refacture de mani√®re inexacte, il est possible que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_to</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne re√ßoive pas de valeur. Et en g√©n√©ral, en tout cas, ce code a l'air √©trange. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N12 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V532</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envisagez d'inspecter l'instruction du mod√®le '* pointer ++'. Signifiait probablement: '(* pointeur) ++'. trop.cpp 140</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-title">class</span> <span class="hljs-title">Q</span>&gt;
<span class="hljs-title">void</span> <span class="hljs-title">doGammaCorrect</span>(<span class="hljs-title">TRasterPT</span>&lt;T&gt; <span class="hljs-title">raster</span>, <span class="hljs-title">double</span> <span class="hljs-title">gamma</span>) {</span>
  <span class="hljs-function">Gamma_Lut&lt;Q&gt; <span class="hljs-title">lut</span><span class="hljs-params">(....)</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> j;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; raster-&gt;getLy(); j++) {<font></font>
    T *pix    = raster-&gt;pixels(j);<font></font>
    T *endPix = pix + raster-&gt;getLx();<font></font>
    <span class="hljs-keyword">while</span> (pix &lt; endPix) {<font></font>
      pix-&gt;r = lut.m_table[pix-&gt;r];<font></font>
      pix-&gt;b = lut.m_table[pix-&gt;b];<font></font>
      pix-&gt;g = lut.m_table[pix-&gt;g];<font></font>
      *pix++; <span class="hljs-comment">// &lt;=</span><font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un petit d√©faut, qui peut encore plus troubler la personne lisant le code. L'incr√©ment, comme pr√©vu, d√©place le pointeur. Cependant, apr√®s cela, il y a un d√©r√©f√©rencement insignifiant. Mieux vaut simplement √©crire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pix ++</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N13 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V773</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La fonction a √©t√© quitt√©e sans rel√¢cher le pointeur ¬´autoCloseUndo¬ª. Une fuite de m√©moire est possible. vectortapetool.cpp 575</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">joinLineToLine</span><span class="hljs-params">(....)</span> </span>{<font></font>
  ....<font></font>
  UndoAutoclose *autoCloseUndo = <span class="hljs-number">0</span>;<font></font>
  ....<font></font>
  autoCloseUndo = <span class="hljs-keyword">new</span> UndoAutoclose(....);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
  TUndoManager::manager()-&gt;add(autoCloseUndo);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y avait plus de 20 avertissements de ce type. Souvent, √† la fin de la fonction, la m√©moire est lib√©r√©e, mais pour un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plus t√¥t, </font><font style="vertical-align: inherit;">cette √©tape n√©cessaire est ignor√©e. C'est donc ici. √Ä la fin, le pointeur est pass√© √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TUndoManager :: manager () -&gt; add ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui s'occupe de supprimer le pointeur, mais il y a un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ci-dessus </font><font style="vertical-align: inherit;">pour lequel vous avez oubli√© d'appeler cette m√©thode. Il est donc toujours utile de se souvenir de vos pointeurs chaque fois que vous quittez la fonction, et pas seulement d'entrer la suppression quelque part √† la fin du bloc ou avant le dernier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, si pour une version abr√©g√©e du code, cette erreur semble √©vidente, alors dans un code r√©el et plus compliqu√©, la recherche d'un tel probl√®me peut √™tre difficile. Ici, l'analyseur statique toujours fatigu√© vous aidera. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N14 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522 Le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©r√©f√©rencement de la ¬´r√©gion¬ª du pointeur nul pourrait avoir lieu. palettecmd.cpp 94</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isStyleUsed</span><span class="hljs-params">(<span class="hljs-keyword">const</span> TVectorImageP vi, <span class="hljs-keyword">int</span> styleId)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> regionCount = vi-&gt;getRegionCount();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; regionCount; i++) {<font></font>
    TRegion *region = vi-&gt;getRegion(i);<font></font>
    <span class="hljs-keyword">if</span> (region || region-&gt;getStyle() != styleId) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous pouvons supposer que le d√©veloppeur a m√©lang√© les r√®gles de l'√©valuation des courts-circuits et a pens√© que si la premi√®re v√©rification du pointeur renvoie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faux</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le d√©r√©f√©rencement d'un tel pointeur nul ne se produira pas. Cependant, pour l'op√©rateur "||" c'est tout le contraire. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragment N15 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V561</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il vaut probablement mieux attribuer une valeur √† la variable 'ca' que de la d√©clarer √† nouveau. D√©claration pr√©c√©dente: xshcellmover.cpp, ligne 319. xshcellmover.cpp 323 </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V561</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il est probablement pr√©f√©rable d'attribuer une valeur √† la variable 'cb' que de la d√©clarer √† nouveau. D√©claration pr√©c√©dente: xshcellmover.cpp, ligne 320. xshcellmover.cpp 324xshcellmover.cpp 323</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
  <span class="hljs-keyword">int</span> ca       = m_cellsMover.getStartPos().x;
  <span class="hljs-keyword">int</span> cb       = m_cellsMover.getPos().x;<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!m_cellsMover.getOrientation()-&gt;isVerticalTimeline()) {
    <span class="hljs-keyword">int</span> ca = m_cellsMover.getStartPos().y;
    <span class="hljs-keyword">int</span> cb = m_cellsMover.getPos().y;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ca != cb) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre un autre copier-coller, mais avec une essence de l'erreur pas tr√®s ordinaire. L'appel √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©t√© remplac√© par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais ils ont oubli√© de supprimer le type de la variable au d√©but de la ligne, en raison de laquelle un nouveau rapport local se produit. En cons√©quence, au lieu de changer l'orientation de la position pour le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initiaux </font><font style="vertical-align: inherit;">, de nouveaux </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> locaux </font><i><font style="vertical-align: inherit;">sont cr√©√©s</font></i><font style="vertical-align: inherit;"> , avec lesquels rien ne se passe. Mais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> externes </font><font style="vertical-align: inherit;">continuent d'exister avec des valeurs pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion N1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de la r√©daction de l'article, il est devenu int√©ressant pour moi de pousser et d'essayer de faire quelque chose dans ce programme. </font><font style="vertical-align: inherit;">Peut - </font><font style="vertical-align: inherit;">√™tre que </font><font style="vertical-align: inherit;">j'√©tais le </font><font style="vertical-align: inherit;">comportement de la </font><font style="vertical-align: inherit;">chance, mais √©trange ne tarde pas √† venir: hang, afficher ma manipulation de la tablette apr√®s l'affaissement et le carr√© √©trange en appuyant sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les touches Ctrl + Z</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Malheureusement, je n'ai pas pu r√©p√©ter ce comportement.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35d/a67/350/35da67350bc54eb9cbada817d91a04c8.png" alt="image6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais en fait, malgr√© ce comportement et inculquant l'habitude d'appuyer r√©guli√®rement sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + S</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , OpenToonz impressionne par son √©chelle et ses fonctionnalit√©s. </font><font style="vertical-align: inherit;">Pourtant, ce n'est pas en vain que les grands studios l'utilisent √©galement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et mon art en bonus:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/a95/8e3/e88a958e3dd8c85b3894de88f140b7e0.gif" alt="image7.gif"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion N2</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans le cas d'OpenToonz, il est √©vident qu'essayer de corriger toutes les erreurs d√©tect√©es par l'analyseur √† la fois sera une grosse t√¢che qui bloquera le processus de d√©veloppement. </font><font style="vertical-align: inherit;">Pour de tels cas, il y a l'approche de ¬´suppression de masse¬ª, lorsque la dette technique est entr√©e dans la base de suppresseur de l'analyseur et que des travaux suppl√©mentaires avec l'analyseur sont effectu√©s sur la base de nouvelles r√©ponses. </font><font style="vertical-align: inherit;">Eh bien, si le temps appara√Æt, vous pouvez r√©gler la dette technique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Je vous rappelle que les d√©veloppeurs de projets open source peuvent utiliser l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">option de licence gratuite PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien de traduction: Victoria Khanieva. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">OpenToonz</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494202/index.html">Classement des quartiers de Moscou par prix de location avec Python</a></li>
<li><a href="../fr494204/index.html">Bloc-notes avec oscilloscope et g√©n√©rateur de fr√©quence (carte son)</a></li>
<li><a href="../fr494206/index.html">Les probl√®mes biologiques du bugfix</a></li>
<li><a href="../fr494210/index.html">Installer Ubuntu sur Microsoft Surface Pro</a></li>
<li><a href="../fr494214/index.html">Comment le coronavirus aide les g√©ants de l'informatique √† conqu√©rir le monde</a></li>
<li><a href="../fr494222/index.html">Avez-vous cess√© de travailler en quarantaine?</a></li>
<li><a href="../fr494224/index.html">Toutes les routes m√®nent √† Fullstack</a></li>
<li><a href="../fr494226/index.html">Position convenue</a></li>
<li><a href="../fr494228/index.html">L'impression 3D dans la cr√©ation du Boeing 777</a></li>
<li><a href="../fr494230/index.html">AI vs COVID-19: Exp√©rience du Hubei et de la Floride</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>