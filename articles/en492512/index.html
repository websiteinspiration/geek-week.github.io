<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèº ‚¨ÜÔ∏è üòÉ CSS: adventures in the land of translucency üß• üîº ‚öæÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I was asked to correct one landing page. Among what I found in his code was an image on top of which two translucent elements overlapping it ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CSS: adventures in the land of translucency</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/492512/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recently I was asked to correct one landing page. </font><font style="vertical-align: inherit;">Among what I found in his code was an image on top of which two translucent elements overlapping it were located. </font><font style="vertical-align: inherit;">Both with the same RGB color values ‚Äã‚Äãin the property </font></font><code>background-color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It looked something like this:</font></font><br>
<br>
<pre><code class="css hljs">&lt;<span class="hljs-selector-tag">img</span> <span class="hljs-selector-tag">src</span>='<span class="hljs-selector-tag">myImage</span><span class="hljs-selector-class">.jpg</span>'/&gt;<font></font>
&lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">class</span>='<span class="hljs-selector-tag">over1</span>'&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;<font></font>
&lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">class</span>='<span class="hljs-selector-tag">over2</span>'&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There was no need to use two such elements. This could be needed unless due to the fact that only one such element did not sufficiently tint the image. For some reason, the author of the page decided that adding another translucent element superimposed on the image was better than increasing the value of the </font></font><code>opacity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first </font><font style="vertical-align: inherit;">parameter </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
As a result, I decided to get rid of one of the layers and set the parameter of the </font><font style="vertical-align: inherit;">remaining one so that the external image looked the same as the previous one. All this is good, but the question arose: how to adjust the parameter of the </font><font style="vertical-align: inherit;">remaining element so that the result is the same as when applying two translucent layers?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/me/tx/cc/metxcc2agwozcl_q4gzhx_ykbrm.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><code>opacity</code><font style="vertical-align: inherit;"></font><code>opacity</code><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you read </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> my article on the composition of masks, then you may have already guessed how to choose the appropriate value. </font><font style="vertical-align: inherit;">After all, the same formula is used here, which was used there for the composition of translucent elements using </font></font><code>mask-composite: add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If there are two layers with transparency values ‚Äã‚Äãequal to </font></font><code>a0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then the value of the resulting indicator is calculated as follows:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">a0</span> + <span class="hljs-selector-tag">a1</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">a0</span>*<span class="hljs-selector-tag">a1</span>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can find an interactive demo, looking at which you can compare how the image looks, toned with two layers, the properties of </font></font><code>opacity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which ( </font></font><code>a0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) can be controlled with the help of sliders, and the same image toned by a layer property </font></font><code>opacity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which is calculated according to the formula </font></font><code>a0 + a1 ‚Äî a0*a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83b/c99/eb4/83bc99eb44f523b59264a2fc532a2355.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The options for tinting an image, two copies of which are displayed next to each other.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It is interesting that the areas in which two translucent elements are located, and one such element, look the same if the image below them is not displayed (you can disable the image output using the checkbox located at the bottom of the screen). But if an image is displayed under these layers, then its two options are slightly different. Perhaps this difference is just the result of optical illusion, maybe some parts of the images seem lighter or darker to me than they really are.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They definitely do not look different if you do not display them next to each other, but simply switch between two layers whose property values</font></font><code>opacity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are equal to</font></font><code>a0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and one layer, the value of </font></font><code>opacity</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which is found by the formula </font></font><code>a0 + a1 ‚Äî a0*a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> relevant example.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72f/d16/5af/72fd165af05a7055d2e46dfa5cce9136.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variants of image tinting with the ability to switch between one and two translucent layers.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This example can be extended to more layers. </font><font style="vertical-align: inherit;">In this case, first calculate the transparency of the new layer, equivalent to the transparency of the two lower layers. </font><font style="vertical-align: inherit;">Then find the transparency of the layer, equivalent to the transparency of the new layer, and the layer immediately above it. </font><font style="vertical-align: inherit;">This operation is repeated until all layers have been processed.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/421/27f/70b/42127f70bd24978c73aa3942ca859fcf.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reducing several translucent layers to one layer</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Similar experiments made me think about how to calculate the parameters of an opaque background image, which is equivalent to an opaque layer (</font></font><code>c0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and a translucent layer superimposed on it (</font></font><code>c1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whose transparency is set to</font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). In this case, the final image, which is a single layer, can be found by processing the original image channel by channel, while the color values ‚Äã‚Äãof the resulting channels are calculated by the following formula:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">ch0</span> + (<span class="hljs-selector-tag">ch1</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">ch0</span>)*<span class="hljs-selector-tag">a</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here </font></font><code>ch0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the channel of the opaque lower layer ( </font></font><code>red</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>green</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>blue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- for red, green and blue colors), </font></font><code>ch1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the corresponding channel of the upper translucent layer, and the indicator </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is an indicator that sets the transparency of the same translucent layer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you express these arguments in the form of SCSS-code, you get the following:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-comment">/*       */</span>
<span class="hljs-keyword">@function</span> res-ch($ch0, $ch1, $a) {
&nbsp;&nbsp;<span class="hljs-keyword">@return</span> $ch0 + ($ch1 - $ch0)*$a<font></font>
}<font></font>
<font></font>
@function res-col($c0, $c1, $a) {<font></font>
&nbsp;&nbsp;$<span class="hljs-selector-tag">ch</span>: '<span class="hljs-selector-tag">red</span>' '<span class="hljs-selector-tag">green</span>' '<span class="hljs-selector-tag">blue</span>'; <span class="hljs-comment">/*   */</span>
&nbsp;&nbsp;$<span class="hljs-selector-tag">nc</span>: <span class="hljs-selector-tag">length</span>($<span class="hljs-selector-tag">ch</span>); <span class="hljs-comment">/*   */</span>
&nbsp;&nbsp;$<span class="hljs-selector-tag">ch-list</span>: ();<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">@for</span> $i from <span class="hljs-number">0</span> to $nc {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;$<span class="hljs-selector-tag">fn</span>: <span class="hljs-selector-tag">nth</span>($<span class="hljs-selector-tag">ch</span>, $<span class="hljs-selector-tag">i</span> + 1);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;$<span class="hljs-selector-tag">ch-list</span>: $<span class="hljs-selector-tag">ch-list</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-selector-tag">res-ch</span>(<span class="hljs-selector-tag">call</span>($<span class="hljs-selector-tag">fn</span>, $<span class="hljs-selector-tag">c0</span>), <span class="hljs-selector-tag">call</span>($<span class="hljs-selector-tag">fn</span>, $<span class="hljs-selector-tag">c1</span>), $<span class="hljs-selector-tag">a</span>);<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">@return</span> RGB($ch-list)<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an interactive example. </font><font style="vertical-align: inherit;">By experimenting with it, you can compare how the two layers look and their equivalent, presented as a single layer. </font><font style="vertical-align: inherit;">Here you can select the RGB color values ‚Äã‚Äãof two layers, as well as the transparency level of the second layer.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f1/bc8/1c1/2f1bc81c1831e013901bf58a90da128d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Results of applying a translucent layer to an opaque layer</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depending on the device, operating system and browser, you will see that the color panels in this example look the same ... or not. The formula is correct, but how exactly the two source layers are processed in different environments may vary.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de1/1a6/557/de11a65577247c6283786036f669f22d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The left part of the image is the expected result of reducing two layers to one. The right side shows how, when two layers are combined (from the upper right part of the image), the layer shown at the bottom right can look different than expected.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I asked Twitter users to send me screenshots made using the</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simplified test version of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this example. Judging by the feedback I received, it seems that the two panels always look the same in mobile browsers (both Android and iOS), as well as in the Firefox browser, regardless of the operating system. Almost always, panels look the same on Windows, although I got answers indicating that Chrome and Chromium Edge sometimes render panels differently than expected.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about WebKit-based browsers running on macOS and Linux, it can be noted that the results are very heterogeneous. In most cases, the color of the panels is slightly different. But using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sRGB color profile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> helps make the panels look the same. The most interesting thing begins if this example is considered in a system that uses two monitors. Dragging a window from one monitor to another can lead to the fact that the difference between the panels is either visible or not visible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted that in real scenarios the difference is very small, and that a pair of such panels is unlikely to be next to each other. But even if there is a difference, no one will know about it until he tests the page in different environments. In any case, only a web developer can probably do this. In addition, there is a feeling that the colors of ordinary opaque elements can also look different when using different devices, operating systems and browsers. For example, the color </font></font><code>#ffa800</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is widely used on css-tricks.com, looks different on my laptops with Ubuntu and Windows. But after all, the eyes of different people can perceive the same colors in different ways. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dear readers!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Have you encountered problems with different browsers, operating systems or devices displaying different colors of web pages?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492502/index.html">MIP * = RE: epoch-making evidence from the field of computer science that caused the domino effect in physics and mathematics</a></li>
<li><a href="../en492504/index.html">What happens when a JS module is imported twice?</a></li>
<li><a href="../en492506/index.html">3 ways to render large lists in Angular</a></li>
<li><a href="../en492508/index.html">Book Kubernetes for DevOps</a></li>
<li><a href="../en492510/index.html">ES6 modules in the browser: are they ready or not?</a></li>
<li><a href="../en492514/index.html">How to establish a legally significant electronic document flow of counterparties in Russia and Kazakhstan?</a></li>
<li><a href="../en492518/index.html">Virus outbreak requires remote work, which means digital signing of documents</a></li>
<li><a href="../en492520/index.html">Parameterized 3D modeling of the bearing cup in nanoCAD Plus 20</a></li>
<li><a href="../en492522/index.html">Remote Team Communication</a></li>
<li><a href="../en492524/index.html">How I earned $ 1,000,000 without experience and connections, and then spent them to make my translator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>