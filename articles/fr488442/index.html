<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😣 ☢️ ⌛️ Code moderne pour effectuer des requêtes HTTP dans Swift 5 à l'aide de Combine et les utiliser dans SwiftUI. Partie 1 ⏺️ 🤶🏼 🍡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'interrogation HTTPest l'une des compétences les plus importantes que vous devez acquérir lors du développement d' iOSapplications. Dans les versions...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Code moderne pour effectuer des requêtes HTTP dans Swift 5 à l'aide de Combine et les utiliser dans SwiftUI. Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488442/"><img src="https://habrastorage.org/webt/uk/tq/y4/uktqy4xvl1cqefjbmvzdzydqj-g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interrogation </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est l'une des compétences les plus importantes que vous devez acquérir lors du développement d' </font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">applications. Dans les versions antérieures </font></font><code>Swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(avant la version 5), que vous ayez généré ces requêtes à partir de zéro ou que vous utilisiez le cadre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamofire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bien connu </font><font style="vertical-align: inherit;">, vous vous êtes retrouvé avec du code complexe et déroutant du </font></font><code>callback </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type&nbsp; </font></font><code>completionHandler: @escaping(Result&lt;T, APIError&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'apparition dans </font></font><code>Swift 5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le nouveau cadre de la programmation réactive fonctionnelle </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en conjonction avec l'existant </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous fournit tous les outils nécessaires à l'écriture indépendante de code très compact pour récupérer des données sur Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, conformément au concept, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous allons créer des «éditeurs»</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour sélectionner des données sur Internet, auxquelles nous pouvons facilement «souscrire» à l'avenir et utiliser lors de la conception </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec&nbsp; </font></font><code>UIKit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et avec l'aide&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il semble plus concis et plus efficace, car l'action des "éditeurs"&nbsp; </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne se limite pas à des exemples de données et s'étend plus loin jusqu'au contrôle de l'interface utilisateur ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Le fait est que </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la séparation des données est&nbsp; </font></font><code>View </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effectuée à l'aide de </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes avec des </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés, dont les modifications&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suivent AUTOMATIQUEMENT et «redessinent» complètement les leurs </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ces&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes, vous pouvez très simplement mettre une certaine logique métier de l'application, si certains d'entre eux</font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriétés sont le résultat de la </font><font style="vertical-align: inherit;">transformation synchrones et / ou asynchrones d' </font><font style="vertical-align: inherit;">autres </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriétés qui peuvent être modifiés directement ces éléments « actifs » de l'interface utilisateur ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) en </font><font style="vertical-align: inherit;">tant que zones de texte </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Stepper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Toggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour clarifier les enjeux, je vais donner des exemples précis. Maintenant, de nombreux services tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposent </font><font style="vertical-align: inherit;">des agrégateurs de nouvelles pour&nbsp; </font><font style="vertical-align: inherit;">offrir aux utilisateurs de choisir différents ensembles d'articles en fonction de ce qui les intéresse. Dans le cas de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrégateur d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> actualités&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org,</font></a><font style="vertical-align: inherit;"> il peut s'agir des dernières nouvelles, ou des nouvelles dans une catégorie - «sport», «santé», «science», «technologie», «entreprise», ou des nouvelles d'une source d'information spécifique «CNN» , ABC news, Bloomberg, etc. L'utilisateur «exprime» généralement ses désirs de services sous la forme </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui lui est nécessaire </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, en utilisant le cadre&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez</font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes utilisant un code très compact (dans la plupart des cas pas plus de 10-12 lignes) une fois pour former une dépendance synchrone et / ou asynchrone de la liste d'articles&nbsp; </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous la forme d'un "abonnement" de </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font><font style="vertical-align: inherit;">"passives" à des </font><font style="vertical-align: inherit;">propriétés "actives" </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cet «abonnement» sera valide pendant tout le «cycle de vie» de l'instance de&nbsp; </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe. Et ensuite, </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;vous donnerez à l'utilisateur la possibilité de gérer uniquement les </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font><font style="vertical-align: inherit;">«actives» </font><font style="vertical-align: inherit;">dans le formulaire </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-à-dire CE qu'il veut voir: qu'il s'agisse d'articles avec les dernières nouvelles ou d'articles dans la section «santé». L'apparition des articles eux-mêmes avec les dernières nouvelles ou articles dans la section "santé" sur le vôtre </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sera fournie AUTOMATIQUEMENT par ces&nbsp; </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes et leurs propriétés "passives" @Published. Dans du code</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;vous n'aurez jamais besoin de demander explicitement une sélection d'articles, car les </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes qui jouent un rôle sont </font><font style="vertical-align: inherit;">responsables de leur affichage correct et synchrone à l'écran&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais vous montrer comment cela fonctionne avec&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">données de</font></a><font style="vertical-align: inherit;"> films </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">TMDb</font></a><font style="vertical-align: inherit;"> dans une série d'articles. Dans les trois cas, le même schéma d'utilisation fonctionnera approximativement&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car dans les applications de ce type, vous devez toujours créer des LISTES de films ou d'articles, choisissez les «IMAGES» (images) qui les accompagnent, RECHERCHEZ les bases de données des films ou articles nécessaires à l'aide de la barre de recherche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'accès à ces services, des erreurs peuvent se produire, par exemple, du fait que vous avez spécifié la mauvaise clé </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou dépassé le nombre autorisé de demandes ou autre chose. Vous devez gérer ce type d'erreur, sinon vous courez le risque de laisser l'utilisateur complètement à perte avec un écran vide. Par conséquent, vous devez être en mesure non seulement de sélectionner des </font></font><code>&nbsp;Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;données sur Internet à l' </font><font style="vertical-align: inherit;">aide </font><font style="vertical-align: inherit;">, mais également de signaler les erreurs qui peuvent survenir lors de l'échantillonnage et de contrôler leur apparence à l'écran. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commencer à développer notre stratégie en développant une application qui interagit avec l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">agrégateur d'</font></a><font style="vertical-align: inherit;"> actualités&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> . Je dois dire que dans cette application, il </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera utilisé dans une mesure minimale sans fioritures et uniquement pour montrer comment </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec ses "éditeurs"</font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et "abonnement" sont </font></font><code>Subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affectés </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est recommandé de vous inscrire sur le site Web </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de recevoir la clé </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nécessaire pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">répondre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à toute demande au service </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous devez le placer dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la structure </font></font><code>APIConstants</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code d'application de cet article est sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API et modèle de données de service </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org vous</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permet de sélectionner des informations sur les articles d'actualité </font></font><code> [Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et leurs sources&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Notre modèle de données sera très simple, il se trouve dans le fichier&nbsp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Articles.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">import</span> Foundation<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NewsResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> totalResults: <span class="hljs-type">Int?</span>
    <span class="hljs-keyword">let</span> articles: [<span class="hljs-type">Article</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Article</span>: <span class="hljs-title">Codable</span>, <span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">let</span> title: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> author: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> urlToImage: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> publishedAt: <span class="hljs-type">Date?</span>
    <span class="hljs-keyword">let</span> source: <span class="hljs-type">Source</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SourcesResponse</span>: <span class="hljs-title">Codable</span> </span>{
    <span class="hljs-keyword">let</span> status: <span class="hljs-type">String</span>
    <span class="hljs-keyword">let</span> sources: [<span class="hljs-type">Source</span>]<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Source</span>: <span class="hljs-title">Codable</span>,<span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">let</span> id: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> description: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> country: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> category: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">let</span> url: <span class="hljs-type">String?</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'article </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra l'identifiant </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le titre </font></font><code> title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la description </font></font><code>&nbsp;description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, l'auteur </font></font><code>author</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, l'URL de «l'image» </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la date de publication </font></font><code>publishedAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la source de publication </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Au-dessus des articles se </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouve un complément </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel nous ne nous intéresserons qu'à la propriété </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est un tableau d'articles. La structure racine </font></font><code>NewsResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la structure </font></font><code>&nbsp;Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui nous permettra littéralement deux lignes de code décodant les </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données dans le modèle. La structure&nbsp; </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;devrait également être la suivante </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, si nous voulons faciliter l'affichage d'un tableau d'articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous forme de liste&nbsp; </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dans </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le protocole </font></font><code>Identifiable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nécessite la présence d'un bien</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nous fournirons avec un identifiant unique artificiel </font></font><code>UUID()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La source d'informations&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra un identifiant </font></font><code> id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un nom </font></font><code> name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une description&nbsp; </font></font><code>description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un pays </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une catégorie de source de publication </font></font><code>category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une URL de site </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Au-dessus des sources d'informations,&nbsp; </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il existe un complément&nbsp; </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel nous ne nous intéresserons qu'à une propriété </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est un tableau de sources d'informations. La structure racine </font></font><code>SourcesResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la structure&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui nous permettra de décoder très facilement les </font></font><code> JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">données dans un modèle. La structure&nbsp; </font></font><code>Source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;devrait également être </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, si nous voulons faciliter l'affichage d'un tableau de sources d'information </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous la forme d'une liste </font></font><code>&nbsp;List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dans</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le protocole </font></font><code>Identifiable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nécessite la présence de la propriété </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nous avons déjà, donc aucun effort supplémentaire ne sera requis de notre part. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez maintenant ce dont nous avons besoin&nbsp; </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le service&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et placez-le dans le fichier&nbsp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.swift</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La partie centrale de la nôtre </font></font><code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;est une classe </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui présente deux méthodes pour sélectionner les données de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrégateur de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> news&nbsp;&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> - articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et sources d'information </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp; - sélection d'articles en&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction du paramètre </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Une sélection de sources d'informations </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour un pays particulier </font></font><code> country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces méthodes renvoient non seulement un tableau d'articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ou un tableau de sources d'informations </font></font><code>&nbsp;[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais les "éditeurs" correspondants du&nbsp; </font></font><code>Publisher </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveau cadre </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Les deux éditeurs ne renvoient aucune erreur - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et si une erreur d'échantillonnage ou de codage s'est toujours produite, un tableau vide d'articles </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;ou de sources d'informations est&nbsp; </font><font style="vertical-align: inherit;">renvoyé&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans aucun message expliquant pourquoi ces tableaux étaient vides.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels articles ou sources d'informations nous voulons sélectionner sur le serveur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous indiquerons en utilisant l'énumération</font></font><code>enum Endpoint:</code><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Endpoint</span> </span>{
    <span class="hljs-keyword">case</span> topHeadLines
    <span class="hljs-keyword">case</span> articlesFromCategory(<span class="hljs-number">_</span> category: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> articlesFromSource(<span class="hljs-number">_</span> source: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> search (searchFilter: <span class="hljs-type">String</span>)
    <span class="hljs-keyword">case</span> sources (country: <span class="hljs-type">String</span>)<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> baseURL:<span class="hljs-type">URL</span> {<span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://newsapi.org/v2/"</span>)!}<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">path</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> <span class="hljs-keyword">self</span> {
        <span class="hljs-keyword">case</span> .topHeadLines, .articlesFromCategory:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"top-headlines"</span>
        <span class="hljs-keyword">case</span> .search,.articlesFromSource:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"everything"</span>
        <span class="hljs-keyword">case</span> .sources:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"sources"</span><font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les dernières nouvelles&nbsp; </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'actualité d'une certaine catégorie (sport, santé, science, business, technologie)&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'actualité d'une source d'information spécifique (CNN, ABC News, Fox News, etc.) </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toute nouvelle&nbsp; </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui remplit une certaine condition </font></font><code>searchFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources d'information </font></font><code>.sources (country:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour un pays particulier </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour faciliter l'initialisation de l'option dont nous avons besoin, nous ajouterons un </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">initialiseur </font></font><code>init?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à l' </font><font style="vertical-align: inherit;">énumération </font><font style="vertical-align: inherit;">pour diverses listes d'articles et de sources d'informations en fonction de l'index </font></font><code>index&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de la ligne </font></font><code> text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui a différentes significations pour différentes options d'énumération:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">init</span>? (index: <span class="hljs-type">Int</span>, text: <span class="hljs-type">String</span> = <span class="hljs-string">"sports"</span>) {
        <span class="hljs-keyword">switch</span> index {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">self</span> = .topHeadLines
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">self</span> = .search(searchFilter: text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">self</span> = .articlesFromCategory(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">self</span> = .articlesFromSource(text)
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">self</span> = .sources (country: text)
        <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons à la classe </font></font><code> NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et considérons plus en détail la première méthode&nbsp; </font></font><code>fetchArticles (from endpoint: Endpoint)-&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui sélectionne les articles en </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction du paramètre </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ne renvoie aucune erreur - </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {              <span class="hljs-comment">// 0</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher()<font></font>
        }<font></font>
           <span class="hljs-keyword">return</span>
            <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)        <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                       <span class="hljs-comment">// 2</span>
            .decode(type: <span class="hljs-type">NewsResponse</span>.<span class="hljs-keyword">self</span>,                    <span class="hljs-comment">// 3</span>
                    decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
            .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.articles}                                   <span class="hljs-comment">// 4</span>
            .replaceError(with: [])                             <span class="hljs-comment">// 5</span>
            .receive(on: <span class="hljs-type">RunLoop</span>.main)                          <span class="hljs-comment">// 6</span>
            .eraseToAnyPublisher()                              <span class="hljs-comment">// 7</span>
    }</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la base du </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;formulaire </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de demande la liste d'articles souhaitée </font></font><code>endpoint.absoluteURL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en cas d'échec, puis renvoyer un tableau vide d'articles</font></font><code>[Article]()</code></li>
<li> «» <code>dataTaskPublisher(for:)</code>,     <code>Output </code>  <code>(data: Data, response: URLResponse)</code>, &nbsp; <code>Failure</code>&nbsp;-&nbsp;<code>URLError</code>,</li>
<li>  <code>map { }</code>       <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>data</code>,&nbsp;</li>
<li> <code>JSON </code>&nbsp;<code>data</code>   ,   &nbsp;<code>NewsResponse</code>,    <code>articles:&nbsp;[Atricle]</code></li>
<li>  <code>map { }&nbsp;</code>        -&nbsp;<code>articles</code>,&nbsp;</li>
<li>  -        <code>[ ]</code>,</li>
<li>   <code>main </code>,          <code>UI</code>,</li>
<li>«»  «»   <code>eraseToAnyPublisher()</code>    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tâche de sélection des sources d'information est assignée à la deuxième méthode - </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est une copie sémantique exacte de la première méthode, sauf que cette fois au lieu d'articles, </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous choisirons des sources d'information </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources.absoluteURL <span class="hljs-keyword">else</span> {      <span class="hljs-comment">// 0</span>
                       <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher()<font></font>
           }<font></font>
              <span class="hljs-keyword">return</span>
               <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>:url)      <span class="hljs-comment">// 1</span>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.data}                                     <span class="hljs-comment">// 2</span>
               .decode(type: <span class="hljs-type">SourcesResponse</span>.<span class="hljs-keyword">self</span>,               <span class="hljs-comment">// 3</span>
                       decoder: <span class="hljs-type">APIConstants</span> .jsonDecoder)<font></font>
               .<span class="hljs-built_in">map</span>{$<span class="hljs-number">0</span>.sources}                                  <span class="hljs-comment">// 4</span>
               .replaceError(with: [])                           <span class="hljs-comment">// 5</span>
               .receive(on: <span class="hljs-type">RunLoop</span>.main)                        <span class="hljs-comment">// 6</span>
               .eraseToAnyPublisher()                            <span class="hljs-comment">// 7</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il nous renvoie "l'éditeur" </font></font><code>AnyPublisher &lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une valeur sous forme de tableau de sources d'informations </font></font><code>[Source] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et l'absence d'erreur </font></font><code>&nbsp;Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;(en cas d'erreur, un tableau de sources vide est retourné&nbsp; </font></font><code>[ ]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons identifier la partie commune de ces deux méthodes, l'organiser comme une </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction </font></font><code>fetch(_ url: URL) -&gt; AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui renvoie&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«l'éditeur» en </font></font><code>AnyPublisher&lt;T, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction de </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//     URL</span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetch</span>&lt;T: Decodable&gt;<span class="hljs-params">(<span class="hljs-number">_</span> url: URL)</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">Error</span>&gt; {
                   <span class="hljs-type">URLSession</span>.shared.dataTaskPublisher(<span class="hljs-keyword">for</span>: url)             <span class="hljs-comment">// 1</span>
                    .<span class="hljs-built_in">map</span> { $<span class="hljs-number">0</span>.data}                                          <span class="hljs-comment">// 2</span>
                    .decode(type: <span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>, decoder: <span class="hljs-type">APIConstants</span>.jsonDecoder) <span class="hljs-comment">// 3</span>
                    .receive(on: <span class="hljs-type">RunLoop</span>.main)                               <span class="hljs-comment">// 4</span>
                    .eraseToAnyPublisher()                                   <span class="hljs-comment">// 5</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela simplifiera les deux méthodes précédentes:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-comment">//   </span>
     <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticles</span><span class="hljs-params">(from endpoint: Endpoint)</span></span>
                                     -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">Never</span>&gt; {
         <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = endpoint.absoluteURL <span class="hljs-keyword">else</span> {
                     <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Article</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
         }<font></font>
         <span class="hljs-keyword">return</span> fetch(url)                                          <span class="hljs-comment">// 1</span>
             .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">NewsResponse</span>) -&gt; [<span class="hljs-type">Article</span>] <span class="hljs-keyword">in</span>        <span class="hljs-comment">// 2</span>
                             <span class="hljs-keyword">return</span> response.articles }<font></font>
                .replaceError(with: [<span class="hljs-type">Article</span>]())                    <span class="hljs-comment">// 3</span>
                .eraseToAnyPublisher()                              <span class="hljs-comment">// 4</span><font></font>
     }<font></font>
    <font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchSources</span><span class="hljs-params">(<span class="hljs-keyword">for</span> country: String)</span></span>
                                       -&gt; <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Source</span>], <span class="hljs-type">Never</span>&gt; {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url = <span class="hljs-type">Endpoint</span>.sources(country: country).absoluteURL
            <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-type">Just</span>([<span class="hljs-type">Source</span>]()).eraseToAnyPublisher() <span class="hljs-comment">// 0</span><font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> fetch(url)                                         <span class="hljs-comment">// 1</span>
            .<span class="hljs-built_in">map</span> { (response: <span class="hljs-type">SourcesResponse</span>) -&gt; [<span class="hljs-type">Source</span>] <span class="hljs-keyword">in</span>     <span class="hljs-comment">// 2</span><font></font>
                            response.sources }<font></font>
               .replaceError(with: [<span class="hljs-type">Source</span>]())                    <span class="hljs-comment">// 3</span>
               .eraseToAnyPublisher()                             <span class="hljs-comment">// 4</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les «éditeurs» ainsi obtenus ne livrent rien tant que quelqu'un ne s'y «abonne» pas. </font><font style="vertical-align: inherit;">Nous pouvons le faire lors de la conception </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Éditeurs" </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans </font></font><code> SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Liste d'articles.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant un peu sur la logique de fonctionnement </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;seule abstraction des «changements externes» auxquels ils répondent </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est les «éditeurs» </font></font><code>Publisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les «changements externes» peuvent être compris comme une minuterie </font></font><code> Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une notification avec </font></font><code>NotificationCenter </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou votre objet modèle, qui en utilisant le protocole </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut être transformé en une seule «source de vérité» externe (source de vérité).&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aux "éditeurs" ordinaires, tapez </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>NotificationCenter</code> <code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réagissez en utilisant la méthode </font></font><code>onReceive (_: perform:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Un exemple d'utilisation de "l'éditeur" que </font></font><code>Timer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous présenterons plus loin dans le troisième article sur la création d'une application pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous allons nous concentrer sur la façon de faire notre modèle pour&nbsp;</font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"source de vérité" externe (source de vérité). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons d'abord comment les </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«éditeurs» résultants devraient fonctionner dans un exemple spécifique d'affichage de divers types d'articles: </font></font><br>
<br>
<code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- les dernières nouvelles,&nbsp; </font></font><code>.articlesFromCategory(_ category: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- les nouvelles pour une catégorie spécifique, </font></font><code>&nbsp;.articlesFromSource(_ source: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- les nouvelles pour une source d'information spécifique, </font></font><code>.search (searchFilter: String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- les nouvelles sélectionnées par une certaine condition. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/ua/uv/zruauv9msu2nulm2ksuflhtxusi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon l' </font></font><code> Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisateur </font><font style="vertical-align: inherit;">qui </font><font style="vertical-align: inherit;">choisit, nous devons mettre à jour la liste des articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sélectionnés sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ce faire, nous allons créer une classe très simple </font></font><code>&nbsp;ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui implémente un protocole </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;avec trois&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés:</font></font><br>
&nbsp;<br>
<img src="https://habrastorage.org/webt/ty/xj/cs/tyxjcsfctbxerl9oiyr6ljvda8c.png"><br>
<br>
<ul>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,        <code>View</code>),&nbsp;&nbsp;</li>
<li><code>@Published var searchString: String</code> —  ,             &nbsp;&nbsp;(     «»,        <code>View</code>&nbsp;    <code>TextField</code>),</li>
<li><code>@Published var articles: [Article]</code>&nbsp;-    ( «»,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NewsAPI.org</a>,  «»).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dès que nous définissons des&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;propriétés </font></font><code>indexEndpoint&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code> searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous pouvons commencer à les utiliser à la fois comme propriétés simples&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et comme "éditeurs"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans une classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez non seulement déclarer les propriétés qui nous intéressent, mais également prescrire la logique métier de leur interaction. Dans ce but, lors de l'initialisation d'une instance d'une classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dans, </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons créer un «abonnement» qui agira tout au long du «cycle de vie» de l'instance de la classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et reproduira la dépendance de la liste d'articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur l'index&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et la chaîne de recherche </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous étendons la chaîne des "éditeurs" </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en sortie "éditeur"</font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont la valeur est une liste d'articles&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ensuite, nous «nous y abonnons» en utilisant l'opérateur </font></font><code>assign&nbsp;(to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et obtenons la liste des articles dont nous avons besoin en </font></font><code>articles </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tant </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;que propriété de </font><font style="vertical-align: inherit;">«sortie»&nbsp; </font><font style="vertical-align: inherit;">qui définit </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons tirer la chaîne PAS simplement des propriétés&nbsp; </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, à savoir des "éditeurs" </font></font><code> $indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui participent à la création </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec l'aide de </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et nous les changerons là en utilisant les éléments de l'interface utilisateur&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>TextField</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment allons-nous procéder? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons déjà une fonction dans notre arsenal </font></font><code>fetchArticles (from: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est dans la classe&nbsp; </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et renvoie un "éditeur" </font></font><code>AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, selon la valeur</font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et nous ne pouvons que d'une manière ou d'une autre utiliser les valeurs des "éditeurs"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les transformer en argument de </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cette fonction.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, combinez les "éditeurs"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, l' </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opérateur existe </font></font><code>Publishers.CombineLatest </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/pg/wd/cipgwdfx2fxmlevrmkf8nnkc6u4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour créer un nouvel «éditeur» sur la base des données reçues de l'ancien «éditeur» </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;, l'opérateur est utilisé&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ln/s7/ur/lns7urzc9l64o8mswhliuggsyp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous «souscrivons» à cet «éditeur» nouvellement reçu à l'aide d'un «abonné» très simple&nbsp; </font></font><code>assign (to: \.articles, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et attribuons le reçu de « éditeur "valeur pour le&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tableau&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/io/xi/suioxibgc3t31oewzgkbfaljina.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous venons de créer un </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" éditeur "ASYNCHRONE et" souscrit "à lui, à la suite de</font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Abonnement» et cela est facile à vérifier si nous gardons notre «abonnement» dans une constante </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ig/ml/gwigml-zqpprclh76lzfnjhvzda.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La propriété principale d'un </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«abonnement» est que dès qu'il quitte son périmètre, la mémoire qu'il occupe est automatiquement libérée. Par conséquent, dès qu'il sera </font></font><code>init( ) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terminé, cet «abonnement» sera supprimé </font></font><code>ARC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et sans avoir le temps d'attribuer les informations asynchrones reçues avec un délai à la baie </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L'information asynchrone n'a tout simplement nulle part où «atterrir», dans son sens littéral, «la terre est passée de sous ses pieds». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour enregistrer un tel «abonnement», il est nécessaire de créer une </font></font><code> init() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font><font style="vertical-align: inherit;">AU-DELÀ de l'initialiseur </font></font><code>var&nbsp;cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui enregistrera notre&nbsp; </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«abonnement» dans cette variable tout au long du «cycle de vie» de l'instance de classe&nbsp;  </font></font><code>ArticlesViewMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, nous supprimons la constante </font></font><code>let subscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et nous nous souvenons de notre </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«abonnement» dans la variable&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à l'aide de l'opérateur </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/gt/xw/mygtxwz7uhcurfyfnblva9irfku.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«Abonnement» à l '«éditeur» ASYNCHRONE que nous avons créé dans </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera conservé tout au long du «cycle de vie» de l'instance de classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons changer arbitrairement le sens de «éditeurs»&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et / ou&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et toujours grâce à la «souscription» créée, nous aurons un éventail d'articles correspondant aux valeurs de ces deux éditeurs&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans aucun effort supplémentaire. Cette&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe est généralement appelée&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de réduire le nombre d'appels au serveur lors de la saisie d'une chaîne de recherche </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous ne devons pas utiliser «l'éditeur» de la chaîne de recherche elle-même&nbsp;</font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et sa version modifiée </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/ir/2z/khir2z1rrmou-hks2rtfuq31bnm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avons </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour nos articles, commençons à créer l'interface utilisateur ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Pour </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se synchroniser </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec le </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;modèle, une </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable est </font><font style="vertical-align: inherit;">utilisée </font><font style="vertical-align: inherit;">qui fait référence à une instance de la classe de ce modèle. C'est cette paire - la&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;classe et la&nbsp; </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable qui fait référence à l'instance de cette classe - qui contrôle le changement dans l'interface utilisateur ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) dans&nbsp; </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ajoutons à la structure une </font></font><code>ContentView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;instance de la classe </font></font><code>ArticleViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous la forme d'une variable </font></font><code>var articleViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la remplaçons </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par une liste d'articles </font></font><code>ArticlesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans laquelle nous plaçons les articles&nbsp; </font></font><code>articlesViewModel.articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtenus de notre&nbsp;</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En conséquence, nous obtenons une liste d'articles pour un index fixe et par défaut&nbsp; </font></font><code>indexEndpoint = 0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-à-dire pour les </font></font><code>.topHeadLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;dernières nouvelles: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/_f/j-/je_fj-0m2xews-ih7vptprkdpoy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez un </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">élément à </font><font style="vertical-align: inherit;">notre écran&nbsp; </font><font style="vertical-align: inherit;">pour contrôler quel ensemble d'articles nous voulons afficher. Nous utiliserons le&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changement d'index </font></font><code>$articlesViewModel.indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La présence d'un symbole est&nbsp; </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obligatoire, car cela signifie une modification de la valeur fournie par&nbsp; </font></font><code>@Published&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"l'éditeur". La «souscription» à cet «éditeur» est déclenchée immédiatement, que nous avons initiée </font></font><code>init ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la «sortie»&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«l'éditeur» </font></font><code>&nbsp;articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;changera et nous verrons une liste d'articles différente à l'écran: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/sd/pp/zxsdppfkp5y0nuk-j99uhovvmu8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, nous pouvons recevoir des tableaux d'articles pour les trois options - «topHeadLines», «recherche "Et" de la catégorie ":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/yc/a_/jmyca_mvm0n2___cswvcamuuqqm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mais pour une chaîne de recherche fixe et par défaut </font></font><code>searchString = "sports"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(là où elle est requise): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/pi/tw/zqpitwdhh3fsnciz9p2scvn1sas.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, pour l'option,&nbsp; </font></font><code>"search"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;vous devez fournir à l'utilisateur un champ de texte </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour entrer la chaîne de recherche: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/d1/uu/xkd1uu0tmepthmsjlkzu--wlwse.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, l'utilisateur peut rechercher n'importe quelle actualité par la chaîne de recherche tapée: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x4/ch/5a/x4ch5apliuwesqxjzeds58ab1t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'option,&nbsp; </font></font><code>"from category"&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est nécessaire de fournir l'utilisateur la possibilité de choisir une catégorie et nous commençons par catégorie </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/8e/3v/2i8e3vvly1r_ipfuflxwbtepglq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
par conséquent, l'utilisateur peut rechercher des nouvelles de la catégorie choisie de nouvelles - </font></font><code>science</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code> health</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,&nbsp; </font></font><code>business</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>technology</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p_/pn/li/p_pnli0chxenoalmms3ltch-iwo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
on peut voir comment un simple&nbsp; </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;modèle qui a deux contrôlées par l' </font><font style="vertical-align: inherit;">utilisateur </font></font><code>@Published </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caractéristiques - </font></font><code>indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et</font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- vous permet de sélectionner un large éventail d'informations sur le site Web&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des sources d'information</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment fonctionnera </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;«l'éditeur» de sources d'informations reçues dans la classe NewsAPI </font></font><code>fetchSources (for country: String)&nbsp;-&gt; AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous obtiendrons une liste de sources d'informations pour différents pays: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/oh/le/hrohle3hq8pkyhnjf6frali7yao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... et la possibilité de les rechercher par nom: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/ea/ll/kgeallzwaxnkvekct18th7knkyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... ainsi que des informations détaillées sur la source sélectionnée: son nom, catégorie, pays, brève description et lien vers le site:&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k_/b7/9w/k_b79wirynz07feigtlhgdeyik4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous cliquez sur le lien, nous irons sur le site Web de ce source d'information. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que tout cela fonctionne, vous avez besoin d'un </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle </font><font style="vertical-align: inherit;">extrêmement simple&nbsp; </font><font style="vertical-align: inherit;">qui n'a que deux </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font><font style="vertical-align: inherit;">contrôlées par l'utilisateur </font><font style="vertical-align: inherit;">- </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/id/4b/rsid4bb5xmkjdkwuptkmwvhi-yc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, nous utilisons le même schéma: lors de l'initialisation d'une instance d'une classe de </font></font><code>SourcesViewModel </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe dans</font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous créons un «abonnement» qui fonctionnera tout au long du «cycle de vie» de l'instance de classe </font></font><code>&nbsp;SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et nous assurerons que la liste des sources d'informations dépend&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du pays&nbsp; </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de la chaîne de recherche </font></font><code>&nbsp;searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'aide,&nbsp; </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous tirons la chaîne des "éditeurs" </font></font><code>$searchString </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>$country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la sortie "éditeur" </font></font><code>AnyPublisher&lt;[Source], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont la valeur est une liste de sources d'information. Nous «nous y abonnons» en utilisant l'opérateur </font></font><code>assign&nbsp;(to: \.sources, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous obtenons la liste des sources d'information dont nous avons besoin&nbsp; </font></font><code>sources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. et rappelez-vous </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"l'abonnement" </font><font style="vertical-align: inherit;">reçu&nbsp; </font><font style="vertical-align: inherit;">dans une variable en&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisant l'opérateur </font></font><code>.store ( in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avons </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour nos sources d'informations, commençons à créer </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. B </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour synchroniser </font></font><code> View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;Le modèle utilise une </font></font><code>@ObservedObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable qui fait référence à une instance de la classe de ce modèle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez l' </font></font><code>ContentViewSources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;instance de classe </font><font style="vertical-align: inherit;">à la structure&nbsp; </font></font><code>SourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous la forme d'une variable </font></font><code>var sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, supprimez&nbsp; </font></font><code>Text ("Hello, World!")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et placez la vôtre </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour chacune des 3&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font></font><code>&nbsp;sourcesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;:</font></font><br>
<br>
&nbsp;<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zone de texte&nbsp; </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour la barre de recherche&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li>&nbsp;<code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;pour le pays </font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liste des&nbsp; </font></font><code>SourcesList&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sources d'information</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/td/tk/kn/tdtkknev57l3b5avb8y0uheu7fa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, nous obtenons ce dont nous avons besoin </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/gg/ly/jwgglycniqr2e-jhpifypfzx4m8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur cet écran, nous gérons uniquement la chaîne de recherche en utilisant la zone de texte </font></font><code>SearchView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le «pays» avec&nbsp; </font></font><code>Picker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et le reste se fait AUTOMATIQUEMENT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La liste des sources d'informations </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient un minimum d'informations sur chaque source - le nom </font></font><code>source.name </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une brève description </font></font><code>source.description</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sj/zi/1z/sjzi1zh-7leadeujwarkuka_ii8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... mais elle vous permet d'obtenir des informations plus détaillées sur la source sélectionnée en utilisant le lien </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel </font></font><code>destination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous indiquons&nbsp; </font></font><code>DetailSourceView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quelles données source sont la source d'informations&nbsp; </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et l'instance de classe requise </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce qui permet obtenir une liste de ses articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/j_/uh/ixj_uheqhclwopwidsihztunn5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyez avec quelle élégance nous obtenons la liste des articles pour la source d'information sélectionnée dans la liste des sources&nbsp; </font></font><code>SourcesList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Notre vieil ami nous aide - une classe&nbsp; </font></font><code>ArticlesViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour laquelle nous devons définir les deux </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font><font style="vertical-align: inherit;">«d'entrée»&nbsp; </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">index&nbsp; </font></font><code>indexEndpoint = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, c'est-à-dire une option&nbsp; </font></font><code>.articlesFromSource (_source:String)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correspondant à la sélection d'articles pour une source fixe </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaîne&nbsp; </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;comme source elle-même (ou plutôt son identifiant) </font></font><code>source.id&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/ia/xi/lr/iaxilr4rlcyippxuvkbd46kequ4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, si vous regardez l'intégralité de l'application </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsApp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous ne verrez nulle part que nous demandons explicitement une sélection d'articles ou de sources d'informations sur le site Web&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous ne gérons que des&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;données, mais </font></font><code>View Model </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faisons notre travail: sélectionne les articles et les sources d'information dont nous avons besoin.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez l'image </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour l'article </font></font><code>Article</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le modèle de l'article&nbsp; </font></font><code>Article&nbsp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient une </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image </font></font><code>urlToImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui l' </font><font style="vertical-align: inherit;">accompagne&nbsp; </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/ny/fv/omnyfvhlcegrhltunqvjvyaq6l4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur cette base,&nbsp; </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous devrons à l'avenir obtenir les images elles-mêmes </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sur le site Web&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous connaissons déjà cette tâche. </font><font style="vertical-align: inherit;">Dans la classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en utilisant la fonction, </font></font><code>fetchImage(for url: URL?) -&gt; AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">créez un «éditeur»&nbsp;  </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec la valeur de l'image&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et aucune erreur&nbsp; </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(en fait, si des erreurs se produisent, l'image est retournée </font></font><code> nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Vous pouvez vous «abonner» à cet «éditeur» pour recevoir des images&nbsp; </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;lors de la conception de l'interface utilisateur ( </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Les données source pour la fonction </font></font><code>fetchImage(for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que nous avons:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/do/a-/hg/doa-hg5idk0ukdghj0snu0-nubm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons en détail comment se déroule la formation avec l'aide de </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"l'éditeur" </font></font><code>AnyPublisher &lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, si nous savons </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">égal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, retournez </font></font><code>Just(nil)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basé sur la </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forme de "l'éditeur" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont la valeur de sortie </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une erreur </font></font><code>&nbsp;Failure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous </font><font style="vertical-align: inherit;">ne </font><font style="vertical-align: inherit;">prenons </font><font style="vertical-align: inherit;">que les données </font></font><code>map {}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour un traitement ultérieur&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la forme </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si l'erreur de retour des étapes précédentes se produit </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous fournissons le résultat au </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flux, car nous supposons une utilisation ultérieure dans la conception </font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Effacez» le TYPE de «l'éditeur» et renvoyez la copie </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous voyez que le code est assez compact et bien lisible, il n'y en a pas </font></font><code>callbacks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons à créer&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;pour l'image </font></font><code>UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il s'agit d'une classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui implémente le protocole </font></font><code>ObservableObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, avec deux&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés:</font></font><br>
<br>
<ul>
<li><code>@Published url: URL?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sont des </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">images</font></font></li>
<li><code>@Published var image: UIImage?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;est l'image elle-même de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/li/o6/kr/lio6krhn0v1eyeiwg_cgpwcigia.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, lors de l'initialisation d'une instance de la classe,&nbsp; </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;nous devons étirer la chaîne de l'entrée "éditeur"&nbsp; </font></font><code>$url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;à la sortie "éditeur" </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, à laquelle nous nous </font><font style="vertical-align: inherit;">&nbsp;"abonnerons" </font><font style="vertical-align: inherit;">plus tard et obtiendrons l'image dont nous avons besoin </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/gi/2s/bagi2swivajzz0pkgqzzsswudww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nous utilisons l'opérateur </font></font><code>&nbsp;flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un "abonné" très simple&nbsp; </font></font><code>assign (to: \image, on: self)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour l'assigner aux reçus de "l'éditeur" "Valeurs de la propriété </font></font><code>@Published image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eq/3k/4-/eq3k4-0pbruhk4qbcu8hmyinfmg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore dans la variable&nbsp; </font><font style="vertical-align: inherit;">" souscription "est </font></font><code>cancellableSet </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stockée en </font></font><code>AnyCancellable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisant l'opérateur&nbsp; </font></font><code>store(in: &amp;self.cancellableSet)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de ce «téléchargeur d'images» est que vous téléchargez une image à partir de quelque chose d'autre que celle à </font></font><code> nil URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">condition qu'elle ne précharge pas, c'est-à-dire</font></font><code>image == nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si pendant le processus de téléchargement une erreur est détectée, l'image sera absente, c'est-à-dire qu'elle </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restera égale </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous montrons l'image avec l'aide </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'une instance de la </font></font><code>imageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;classe </font><font style="vertical-align: inherit;">utilise pour cela </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si l'image de son image n'est pas égale </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors elle est affichée en utilisant </font></font><code> Image (...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais si elle est égale </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors en fonction de ce qu'elle est égale </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, soit rien n'est affiché </font></font><code>EmptyView()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, soit un rectangle </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un texte rotatif T </font><font style="vertical-align: inherit;">s'affiche </font></font><code>ext("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/nq/yi/mhnqyirurke0w6yibfxm86gap1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette logique fonctionne très bien pour le cas quand vous savez avec certitude que pour&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, autre que&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous obtenez une image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, comme c'est le cas avec la base de données de films&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org, l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agrégateur de nouvelles&nbsp; </font><font style="vertical-align: inherit;">&nbsp; est différent. Les articles de certaines sources d'information en donnent une différente de l'&nbsp; </font></font><code>nil&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image, mais l'accès est fermé, et nous obtenons un rectangle </font></font><code>Rectangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec du texte en rotation </font></font><code>Text("Loading...")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui ne sera jamais remplacé: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/tq/lp/shtqlpz4wx-iobt19-wv9j2pb7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette situation, si l' </font></font><code>&nbsp;URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image est différente de&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors l'égalité de l'&nbsp; </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image&nbsp; </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut signifier que l'image se charge , et le fait qu'une erreur s'est produite lors du chargement et que nous n'obtiendrons jamais d'image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Afin de distinguer ces deux situations, nous en ajoutons </font><font style="vertical-align: inherit;">une de plus </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;aux deux </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés </font><font style="vertical-align: inherit;">existantes </font><font style="vertical-align: inherit;">de la classe&nbsp; </font><font style="vertical-align: inherit;">:&nbsp;</font></font><br>
<br>
<code>&nbsp;@Published var noData = false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- il s'agit d'une valeur booléenne avec laquelle nous indiquerons l'absence de données d'image due à une erreur lors de la sélection: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/jc/sq/kpjcsqugrsfzyghmefnge0unscy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la création d'un "abonnement", nous </font></font><code> init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interceptons toutes les erreurs </font></font><code> Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui se produisent lors du chargement de l'image et accumulons leur présence dans la&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriété </font></font><code>self.noData = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si le téléchargement a réussi, nous obtenons l'image </font></font><code>image</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">
Nous créons le </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
«Publisher»&nbsp; </font></font><code>AnyPublisher&lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;sur la base de la&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;fonction </font></font><code>fetchImageErr (for url: URL?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/ek/jf/7fekjfrbihaieypuxaovub1-op8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous commençons à créer une méthode </font></font><code>fetchImageErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en initialisant le «publisher»&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui peut être utilisé pour obtenir de manière asynchrone une seule valeur TYPE à l' </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aide d'une fermeture. La fermeture a un paramètre - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est une fonction de TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) → Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Nous transformerons le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/ch/_u/iuch_uvhdkz42-mfyuiuq3jiosg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
résultat </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en</font></font><code>AnyPublisher &lt;UIImage?, Error&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec l'aide de l'opérateur "Erase TYPE" </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous allons effectuer les étapes suivantes, en </font><font style="vertical-align: inherit;">prenant en compte toutes les </font><font style="vertical-align: inherit;">erreurs possibles (nous ne nommerai pas les </font><font style="vertical-align: inherit;">erreurs, il est tout simplement important pour nous de savoir qu'il ya une erreur): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0. vérification </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et&nbsp; </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: le </font><font style="vertical-align: inherit;">cas échéant, puis renvoyer l'erreur, sinon, le </font><font style="vertical-align: inherit;">transfert </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus par chaîne, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. créez un "éditeur" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dont l'entrée est - </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la valeur de sortie </font></font><code>Output</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et une erreur&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. analysez en utilisant le </font></font><code> tryMap { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;tuple résultant </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: s'il </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est dans la plage </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors pour un traitement ultérieur, nous prenons uniquement les données&nbsp; </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sinon, nous "jetons" une erreur (quoi qu'il arrive),</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. nous </font></font><code>map { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convertirons les données </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font></font><code>UIImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. livrons le résultat au </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flux, car nous supposons que nous les utiliserons plus tard dans la conception </font></font><code>UI</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - nous nous «abonnons» à «l'éditeur» reçu en utilisant </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ses fermetures </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 5. si nous </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;trouvons une erreur </font><font style="vertical-align: inherit;">dans la fermeture&nbsp; </font></font><code>error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous signalons en l'utilisant </font></font><code>promise (.failure(error)))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - 6. dans la fermeture,&nbsp; </font></font><code>receiveValue </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous vous informons de la réception réussie d'un tableau d'articles en utilisant </font></font><code> promise (.success($0))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7. nous nous souvenons de l '«abonnement» reçu dans la variable&nbsp; </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour assurer sa viabilité pendant la «durée de vie» de l'instance de classe </font></font><code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8. nous «effaçons» le «éditeur» TYPE et renvoyer l'instance </font></font><code>AnyPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous revenons à l' </font></font><code>ArticleImage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">endroit où nous allons utiliser la nouvelle&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font></font><code>noData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">S'il n'y a pas de données d'image, nous n'afficherons rien, c'est-à-dire </font></font><code>EmptyView ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3k/wr/v_/3kwrv_cecjy2f8jea3rgnnpkzri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, nous </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regrouperons</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> toutes nos possibilités d'affichage des données de l' </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">agrégateur d'</font></a><font style="vertical-align: inherit;"> actualités </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> dans </font></font><code>TabView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/xb/ra/yqxbraupq1d0tgeygy2lb05o4xo.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher les erreurs lors de la récupération et du décodage des données JSON à partir du serveur&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'accès au serveur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , des&nbsp; </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">erreurs</font></a><font style="vertical-align: inherit;"> peuvent se produire, par exemple, du fait que vous avez spécifié la mauvaise clé </font></font><code>API-key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou, ayant un tarif développeur qui ne coûte rien, a dépassé le nombre autorisé de demandes ou autre chose. Dans le même temps, le serveur&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;vous fournit le </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code et le message correspondant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/2n/zv/_f2nzv5bndlu8auo9cygjyk9fta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est nécessaire de gérer ce type d'erreur de serveur. Sinon, l'utilisateur de votre application sera dans une situation où soudainement, sans raison, le serveur&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;cessera de traiter toutes les demandes, laissant l'utilisateur complètement perdu avec un écran vide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'à présent, lors de la sélection d'articles&nbsp; </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de sources d'informations&nbsp; </font></font><code>[Source]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le serveur&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;nous avons ignoré toutes les erreurs et, en cas d'apparition, nous avons renvoyé des tableaux vides </font></font><code>[Article]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et&nbsp; </font><font style="vertical-align: inherit;">par conséquent&nbsp; </font></font><code>[Source]()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer avec la gestion des erreurs, </font></font><code>fetchArticles (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;créons </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;une autre méthode </font><font style="vertical-align: inherit;">dans la classe </font><font style="vertical-align: inherit;">basée sur la </font><font style="vertical-align: inherit;">méthode de </font><font style="vertical-align: inherit;">sélection d'articles&nbsp; </font><font style="vertical-align: inherit;">existante </font></font><code>fetchArticlesErr (from endpoint: Endpoint) -&gt; AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui renverra non seulement un tableau d'articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais aussi une erreur possible&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetchArticlesErr</span><span class="hljs-params">(from endpoint: Endpoint)</span></span> -&gt;
                            <span class="hljs-type">AnyPublisher</span>&lt;[<span class="hljs-type">Article</span>], <span class="hljs-type">NewsError</span>&gt; {<font></font>
<font></font>
. . . . . . . .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette méthode, ainsi que la méthode </font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, accepte </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et renvoie le «publisher» </font><font style="vertical-align: inherit;">à l'entrée </font><font style="vertical-align: inherit;">avec une valeur sous la forme d'un tableau d'articles </font></font><code>[Article]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais au lieu de l'absence d'erreur </font></font><code>Never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous pouvons avoir une erreur définie par l'énumération </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x9/es/ey/x9eseyq8jbapjkmgdoj7aggc6f0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par créer une nouvelle méthode en initialisant le «publisher»&nbsp; </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui peut être utiliser pour obtenir de manière asynchrone une seule valeur TYPE à l' </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aide d'une fermeture. </font><font style="vertical-align: inherit;">La fermeture a un paramètre - </font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est une fonction de TYPE&nbsp; </font></font><code>(Result&lt;Output, Failure&gt;) -&gt; Void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Nous transformerons le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/bw/ct/3wbwctuso0qweiz3a8qk_h1aiom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
reçu </font></font><code>Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en "éditeur" dont nous avons besoin en&nbsp; </font></font><code>AnyPublisher &lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisant l'opérateur "TYPE Erase" </font></font><code>eraseToAnyPublisher()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin dans la nouvelle méthode, </font></font><code>fetchArticlesErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous allons répéter toutes les étapes que nous avons suivies dans la méthode&nbsp;</font></font><code>fetchArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais nous prendrons en compte toutes les erreurs possibles:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/xz/i0/pbxzi0rn5-cuandt3rtu74ofj8s.png"><br>
<br>
<ul>
<li>0.   endpoint&nbsp; <code>URL endpoint.absoluteURL </code>    , <code> url </code> <code>nil</code>:  <code>nil</code>,    <code>.urlError</code>,   —  <code>url</code>   ,</li>
<li>1.  «» <code>dataTaskPublisher(for:)</code>,     — <code>url</code>,    <code>Output</code>   <code>(data: Data, response: URLResponse)</code>  &nbsp;<code>URLError</code>,</li>
<li>2.    <code>tryMap { }</code>&nbsp;  <code>(data: Data, response: URLResponse)</code>:  <code>response.statusCode</code>    <code>200...299</code>,       &nbsp;<code>data</code>.    «»  <code>.responseError</code>,  &nbsp;&nbsp;<code>data</code>,    <code>String</code>,    ,</li>
<li>3. <code> JSON</code>    ,   &nbsp;<code>NewsResponse</code>,</li>
<li>4.    <code>main</code> ,         <code>UI</code></li>
<li>«»   «»   <code>sink</code>    <code>receiveCompletion</code>  <code>receiveValue</code>,<br>
 <ul>
<li>5.&nbsp; &nbsp;&nbsp;<code>receiveCompletion</code>&nbsp;  <code>error</code>,       <code>promise (.failure(...)))</code>,</li>
<li> 6.&nbsp;&nbsp;&nbsp;<code>receiveValue</code>         <code>promise (.success($0.articles))</code>,</li>
</ul>&nbsp;</li>
<li>7.&nbsp;  «»  &nbsp;<code>var subscriptions</code>,       « »   <code>NewsAPI</code>,</li>
<li>8. «»  «»    <code>AnyPublisher</code>.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que l '"éditeur"&nbsp; </font></font><code>dataTaskPublisher(for:)</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diffère</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de son prototype </font></font><code>dataTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en ce qu'en cas d'erreur de serveur lorsqu'il n'est </font></font><code>response.statusCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;pas dans la plage </font></font><code>200...299</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il fournit toujours la valeur réussie sous la forme d'un tuple </font></font><code>(data: Data, response: URLResponse)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et non d'une erreur dans le formulaire </font></font><code>(Error, URLResponse?)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dans ce cas, les informations réelles sur l'erreur du serveur sont contenues dans </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. "Publisher" </font></font><code>dataTaskPublisher(for:)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;délivre une erreur&nbsp; </font></font><code>URLError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si une erreur se produit côté client (impossibilité de contacter le serveur, interdiction du système de sécurité </font></font><code>ATS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous voulons afficher les erreurs dans </font></font><code>SwiftUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors nous avons besoin de celle correspondante </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que nous appellerons&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/1o/qy/em1oqy5ob60o8xzmz_-kpdvzs4a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la classe </font></font><code>&nbsp;ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui implémente le protocole </font></font><code>ObservableObject </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cette fois nous avons QUATRE&nbsp; </font></font><code>@Published</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriétés:</font></font><br>
<br>
<ol>
<li><code>@Published var indexEndpoint: Int</code> —   <code>Endpoint</code> (    «»,     <code> View</code>),&nbsp;</li>
<li><code>@Published var searchString: String</code> —   ,    &nbsp;<code>Endpoint</code>:    «» ,       (      «»,        <code>View</code>),&nbsp;</li>
<li>&nbsp;<code>@Published var articles: [Article]</code>&nbsp;-    ( «»,        &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NewsAPI.org&nbsp;</a>)</li>
<li>&nbsp;&nbsp;<code>@Published var articlesError: NewsError?</code>&nbsp;-  ,      &nbsp;    &nbsp;<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NewsAPI.org&nbsp;</a>.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous initialisez une instance d'une classe </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous devons à nouveau étendre une chaîne à partir des "éditeurs" d'entrée </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la sortie de "l'éditeur"&nbsp; </font></font><code>AnyPublisher&lt;[Article],NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, à laquelle nous avons "signé" avec "l'abonné" </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et nous obtenons beaucoup d'articles </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou d'erreur&nbsp; </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre classe, </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons déjà construit une fonction&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui renvoie un «éditeur»&nbsp; </font></font><code>AnyPublisher&lt;[Article], NewsError&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en fonction de la valeur </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et nous avons seulement besoin d'utiliser en quelque sorte les valeurs des «éditeurs»&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de les transformer en argument pour cette fonction </font></font><code>endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous allons combiner les "éditeurs"&nbsp; </font></font><code>$indexEndpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et&nbsp; </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il existe un opérateur </font></font><code>Publishers.CombineLatest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5i/lz/zh/5ilzzh6h5_aity8uvzd6eladg7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous devons définir le type d'erreur TYPE "éditeur" égal au requis&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/85/tt/oe85tthmperdfzf6yqiy5fmy2b4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous voulons utiliser la fonction&nbsp; </font></font><code>fetchArticlesErr (from endpoint: Endpoint) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de notre classe </font></font><code>NewsAPI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Comme d'habitude, nous le ferons avec l'aide d'un opérateur&nbsp; </font></font><code>flatMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui crée un nouvel «éditeur» sur la base des données reçues de l'ancien «éditeur»: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bh/bu/kx/bhbukxfbhg2q9otl4rp-ksponec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous «souscrivons» à cet «éditeur» nouvellement reçu avec l'aide d'un «abonné» </font></font><code>sink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et utilisons ses fermetures </font></font><code>receiveCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>receiveValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin de recevoir de "l'éditeur" soit la valeur d'un tableau d'articles&nbsp; </font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soit une erreur </font></font><code>articlesError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/x8/iy/cqx8iyvnwanwmv1vselki10ytv4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Naturellement, il faut se souvenir de "l'abonnement" résultant dans une </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">variable </font><font style="vertical-align: inherit;">externe </font></font><code>cancellableSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sinon, nous ne pourrons pas obtenir la valeur de manière asynchrone</font></font><code>articles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou une erreur </font></font><code>articlesError </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">après la fin </font></font><code>init()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/wh/_a/khwh_ao98y7zy9cdpenc0nzvntq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de réduire le nombre d'appels au serveur lors de la saisie d'une chaîne de recherche </font></font><code>searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous ne devons pas utiliser l '"éditeur" de la barre de recherche elle </font></font><code>$searchString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">même&nbsp; </font><font style="vertical-align: inherit;">, mais sa version modifiée </font></font><code>validString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/op/ss/flopssp-pjixvbtesqabmpp1h2s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"S'abonner" à l' "éditeur" ASYNCHRONE que nous avons créé </font></font><code>init( )</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera persister tout au long du «cycle de vie» de l'instance de classe&nbsp; </font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/iw/k4/ntiwk4eju6aneam-1wlymjqyu9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nous procédons à la correction de la nôtre </font></font><code> UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afin d'y afficher d'éventuelles erreurs d'échantillonnage de données. Dans </font></font><code>SwiftU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I, dans la structure existante, nous&nbsp; </font></font><code>ContentVieArticles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;utilisons un autre, juste obtenu&nbsp; </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en ajoutant simplement les lettres «Err» dans le nom. Ceci est une instance de la classe.&nbsp;&nbsp;</font></font><code>ArticlesViewModelErr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui «capture» l'erreur de sélection et / ou de décodage des données d'article du serveur&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/vy/uv/kwvyuvbthb08tcalkcdpnucqfbq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous ajoutons également l'affichage d'un message d'urgence&nbsp; </font></font><code>Alert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;en cas d'erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, si la mauvaise clé API est:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">APIConstants</span> </span>{
    <span class="hljs-comment">// News  API key url: https://newsapi.org</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> apiKey: <span class="hljs-type">String</span> = <span class="hljs-string">"API_KEY"</span> <font></font>
    <font></font>
   .  .  .  .  .  .  .  .  .  .  .  .  .<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... alors nous recevrons le message suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/ws/si/nbwssihj8ldlqqtcbti4tjwcv7o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la limite de demandes a été épuisée, nous recevrons le message suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cz/de/ux/czdeuxquiscc-6qklciy5a0w3jm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenant à la méthode de sélection des articles&nbsp; </font></font><code>[Article] </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec une erreur possible&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous pouvons simplifier son code si nous utilisons&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;"l'éditeur" </font></font><code>AnyPublisher&lt;T,NewsError&gt;,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui, basé sur l'ensemble,&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reçoit des </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informations de </font><font style="vertical-align: inherit;">manière asynchrone </font><font style="vertical-align: inherit;">, le place directement dans le </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;et signale une erreur&nbsp; </font></font><code>NewsError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/v7/m9/lcv7m9fmdbq20ih5phivj7hl1go.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comme nous le savons, ce code est très facile à utiliser pour obtenir un «éditeur» spécifique si les données source </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont un </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">agrégateur de</font></a></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nouvelles&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewsAPI.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;ou un pays&nbsp;</font></font><code>country</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> source d'information, et la sortie nécessite différents modèles - par exemple, une liste d'articles ou de sources d'information:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ff/4q/igff4qjqmxcxloixsshjbc36uxy.png"><br>
<br>
<img src="https://habrastorage.org/webt/bh/o_/7n/bho_7nbyxpl5yxth1ihweasjbec.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons appris à quel point il est facile de répondre aux </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demandes avec l'aide de </font></font><code> Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son </font></font><code>URLSession</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«éditeur» </font></font><code>dataTaskPublisher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Codable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si vous n'avez pas besoin de suivre les erreurs, vous obtenez un </font></font><code> Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code à 5 lignes </font><font style="vertical-align: inherit;">très simple </font><font style="vertical-align: inherit;">pour "l'éditeur" </font></font><code>AnyPublisher&lt;T, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui reçoit de manière asynchrone les </font></font><code>JSON </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informations et les place directement dans le </font></font><code>Codable </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle en </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;fonction des données données&nbsp; </font></font><code>url</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/r_/6w/2ir_6wkuga1u9jcxsmqijle480e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ce code est très facile à utiliser pour obtenir un éditeur spécifique, si les données source </font></font><code>url </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont, par exemple </font></font><code>Endpoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la sortie nécessite différents modèles - par exemple, un ensemble d'articles ou une liste de sources d'informations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous devez prendre en compte les erreurs, le code de&nbsp; </font></font><code>Generic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"l'éditeur" sera un peu plus compliqué, mais ce sera quand même un code très simple sans aucun rappel:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/4d/ep/fi4depxf-hbngki4p5y3ktunbny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant la technologie d'exécution des </font></font><code>HTTP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requêtes à l'aide </font></font><code>Combine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pouvez-vous créer un «éditeur» </font></font><code>AnyPublisher&lt;UIImage?, Never&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui sélectionne de manière asynchrone les données et reçoit une image UIImage? basé sur </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Les </font></font><code>ImageLoade</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">téléchargeurs d' </font><font style="vertical-align: inherit;">images </font><font style="vertical-align: inherit;">r sont mis en mémoire cache pour éviter la récupération répétée de données asynchrones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes sortes de «éditeurs» obtenus peuvent très facilement être «mis au travail» dans les classes ObservableObject, qui utilisent leurs propriétés @Published pour contrôler votre interface utilisateur conçue à l'aide de SwiftUI. Ces classes jouent généralement le rôle du modèle d'affichage, car elles ont les propriétés @Published dites «d'entrée» qui correspondent aux éléments d'interface utilisateur actifs (TextField, Stepper, zones de texte Picker, boutons radio Toggle, etc.) et les propriétés @Published «de sortie». , constitué principalement d'éléments d'interface utilisateur passifs (textes, images, formes géométriques Circle (), Rectangle (), etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette idée imprègne l'ensemble de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agrégateur d'actualités </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">NewsAPI.org</font></a><font style="vertical-align: inherit;"> présentée dans cet article. assez universel et a été utilisé lorsque</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">développer une application pour la </font></font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base de données de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">films </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">TMDb</font></a><font style="vertical-align: inherit;"> et l'agrégateur de nouvelles&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacker News</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui seront discutées dans de futurs articles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code d'application de cet article est sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Je veux attirer votre attention sur le fait que si vous utilisez le simulateur pour l'application présentée dans cet article, sachez que </font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le simulateur fonctionne avec une erreur. Vous pouvez utiliser</font></font><code>NavigationLink</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le simulateur une seule fois. </font><font style="vertical-align: inherit;">Ceux. </font><font style="vertical-align: inherit;">vous avez utilisé le lien, êtes revenu en arrière, cliquez sur le même lien - et rien ne se passe. </font><font style="vertical-align: inherit;">Tant que vous n'utiliserez pas un autre lien, le premier ne fonctionnera pas, mais le second deviendra inaccessible. </font><font style="vertical-align: inherit;">Mais cela n'est observé que sur le simulateur, sur un vrai appareil, tout fonctionne bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Certaines sources d'information utilisent encore à la </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>https</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des "images" de leurs articles. </font><font style="vertical-align: inherit;">Si vous voulez vraiment voir ces «images», mais ne pouvez pas contrôler la source de leur apparence, vous devez configurer le système de sécurité </font></font><code>ATS ( App Transport Security)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour recevoir ces </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«images», mais ce n'est bien sûr pas une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bonne idée</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez utiliser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des options plus sécurisées</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Références:</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    HTTP   Swift 5   Combine     SwiftUI.  1 .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modern Networking in Swift 5 with URLSession, Combine and Codable.</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">URLSession.DataTaskPublisher’s failure type</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Combine: Asynchronous Programming with Swift</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«SwiftUI &amp; Combine:  »</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Introducing Combine — WWDC 2019 — Videos — Apple Developer. session 722</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(  722 «  Combine»   )</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Combine in Practice — WWDC 2019 — Videos — Apple Developer. session 721</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(  721 «  Combine»   )</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488428/index.html">Comment prédisons-nous l'avenir de la recherche Yandex: des corrections de bugs aux requêtes de découverte</a></li>
<li><a href="../fr488432/index.html">Snoop Project, un outil incroyable pour l'intelligence Internet, que les utilisateurs de RuNet attendent depuis si longtemps - est disponible</a></li>
<li><a href="../fr488436/index.html">Créez rapidement de la musique chiptune open source</a></li>
<li><a href="../fr488438/index.html">L'histoire des formats audio de film: la réponse allemande aux cassettes compactes - comment s'est passé le développement</a></li>
<li><a href="../fr488440/index.html">Lords of DOOM: comment deux gars ont créé un jeu de tir culte et secoué l'industrie du jeu vidéo</a></li>
<li><a href="../fr488446/index.html">Instrumentation russe: nous avons tourné votre design sur les doigts</a></li>
<li><a href="../fr488448/index.html">Faites un tour à l'Université ITMO: nos master classes, ateliers, conférences et concours étudiants</a></li>
<li><a href="../fr488450/index.html">Comment fonctionne une nouvelle génération de services bancaires en ligne</a></li>
<li><a href="../fr488456/index.html">Activités du projet dans les universités et avantages qu'elles procurent</a></li>
<li><a href="../fr488458/index.html">FunCode Backend Java / Kotlin Challenge: les gagnants sont annoncés</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>