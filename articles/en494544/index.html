<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèø ‚ôøÔ∏è üë©üèø‚Äçüç≥ Parsing photos from cian.ru using Selenium üö£ ü§∑üèæ ‚èØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear Khabrovites, in this small example I want to show how you can parse a page, the data on which is loaded using javascript widgets. Moreover,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Parsing photos from cian.ru using Selenium</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494544/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello dear Khabrovites, in this small example I want to show how you can parse a page, the data on which is loaded using javascript widgets. Moreover, even if the page in this example is easy to save, you still can‚Äôt parse all the necessary photos from it because of these widgets. In this case, I use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cian.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as an </font><font style="vertical-align: inherit;">example </font><font style="vertical-align: inherit;">, which has its own </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which I will not use, instead I will use Selenium. I do not work at cian.ru, I just use this site as an example. The code in the parser is simple and designed for beginners.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A short introduction - when at my leisure I looked at examples of repairs in cian.ru, I thought it would be nice to save the photos I liked, but manually saving them would be a long time, besides this is not our method, so I decided to write this parser.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The parser is written in python3 from the distribution of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anaconda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chromedriver binary,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I installed separately from these links. </font><font style="vertical-align: inherit;">(And of course, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Chrome browser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> must be installed on the system </font><font style="vertical-align: inherit;">)</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Below is the full parser code, then I will analyze the main points separately.</font></font></p><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.chrome.options <span class="hljs-keyword">import</span> Options
<span class="hljs-keyword">from</span> selenium.common.exceptions <span class="hljs-keyword">import</span> NoSuchElementException
<span class="hljs-keyword">import</span> chromedriver_binary 
<span class="hljs-keyword">import</span> urllib
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
print(<span class="hljs-string">'start...'</span>)<font></font>
<font></font>
site = <span class="hljs-string">"https://www.cian.ru/sale/flat/222059642/"</span><font></font>
<font></font>
chrome_options = Options()<font></font>
chrome_options.add_argument(<span class="hljs-string">"--headless"</span>)<font></font>
<font></font>
driver = webdriver.Chrome(options=chrome_options)<font></font>
<span class="hljs-comment">#driver = webdriver.Chrome()</span><font></font>
driver.get(site)<font></font>
<font></font>
i = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:   
    <span class="hljs-keyword">try</span>:<font></font>
        url = driver.find_element_by_xpath(<span class="hljs-string">"//div[contains(@class, 'fotorama__active')]/img"</span>).get_attribute(<span class="hljs-string">'src'</span>)
    <span class="hljs-keyword">except</span> NoSuchElementException:
        <span class="hljs-keyword">break</span>        <font></font>
<font></font>
    i += <span class="hljs-number">1</span><font></font>
    print(i, url)<font></font>
<font></font>
    driver.find_element_by_xpath(<span class="hljs-string">"//div[@class='fotorama__arr fotorama__arr--next']"</span>).click()<font></font>
<font></font>
    name = url.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">-1</span>]<font></font>
    urllib.request.urlretrieve(url, name)<font></font>
<font></font>
    time.sleep(<span class="hljs-number">2</span>)<font></font>
<font></font>
print(<span class="hljs-string">'done.'</span>)</code></pre><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">https://www.cian.ru/sale/flat/222059642/</a>    .      <code>driver</code>        <code>get</code>.  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Headless Chrome</a>, ..   <code>webdriver.Chrome()</code>      <code>--headless</code>,         ,      ,     <code>chrome_options</code>     ,     .</p><br>
<pre><code class="python hljs">site = <span class="hljs-string">"https://www.cian.ru/sale/flat/222059642/"</span><font></font>
<font></font>
chrome_options = Options()<font></font>
chrome_options.add_argument(<span class="hljs-string">"--headless"</span>)<font></font>
<font></font>
driver = webdriver.Chrome(options=chrome_options)<font></font>
<span class="hljs-comment">#driver = webdriver.Chrome()</span>
driver.get(site)</code></pre><br>
<p>      ,    ,        , ..        "next".</p><br>
<p><img src="https://habrastorage.org/webt/cg/1d/df/cg1ddfpfsda6ozsadz1t0ob2p48.png"></p><br>
<p>     <code>url</code>   ,  <code>try/except</code>   <code>NoSuchElementException</code>,   ,      Selenium    .</p><br>
<pre><code class="python hljs">    <span class="hljs-keyword">try</span>:<font></font>
        url = driver.find_element_by_xpath(<span class="hljs-string">"//div[contains(@class, 'fotorama__active')]/img"</span>).get_attribute(<span class="hljs-string">'src'</span>)
    <span class="hljs-keyword">except</span> NoSuchElementException:
        <span class="hljs-keyword">break</span>       </code></pre><br>
<p>           .</p><br>
<pre><code class="python hljs">    driver.find_element_by_xpath(<span class="hljs-string">"//div[@class='fotorama__arr fotorama__arr--next']"</span>).click()</code></pre><br>
<p>         <code>urllib</code>.</p><br>
<pre><code class="python hljs">    name = url.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">-1</span>]<font></font>
    urllib.request.urlretrieve(url, name)</code></pre><br>
<p>      ,         . (        Selenium)</p><br>
<pre><code class="python hljs">    time.sleep(<span class="hljs-number">2</span>)</code></pre><br>
<p>      Selenium,  ,    ,  -         .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494532/index.html">TTA processor. Part 2</a></li>
<li><a href="../en494534/index.html">No masks, but you hold 1/2</a></li>
<li><a href="../en494536/index.html">Epistemic standards of inventions</a></li>
<li><a href="../en494538/index.html">Twitch streamers earn thousands of dollars in a dream</a></li>
<li><a href="../en494542/index.html">Rainbow proof demonstrates the presence of standard components in graphs</a></li>
<li><a href="../en494546/index.html">Modeling the universe: celestial mechanics clearly</a></li>
<li><a href="../en494548/index.html">Karasic programming language</a></li>
<li><a href="../en494552/index.html">About bad employers good employees: passions after the week off</a></li>
<li><a href="../en494554/index.html">SDL 2.0 Lesson Cycle: Lesson 6 - Downloading Fonts with SDL_ttf</a></li>
<li><a href="../en494560/index.html">Accurate driving: how and why automotive innovations provoke accidents - study</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>