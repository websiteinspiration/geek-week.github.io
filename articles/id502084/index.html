<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”» ğŸ¯ ğŸ‘©ğŸ½â€ğŸ³ Memeriksa portal layanan publik regional yang dimuat melalui dalang ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸ•• ğŸš</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Anda, juga, dengan penasaran menonton "epik American Wild West tentang pendistribusian bidang tanah - duluan dan tempel bendera untuk dipe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Memeriksa portal layanan publik regional yang dimuat melalui dalang</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo, Habr! Anda, juga, dengan penasaran menonton "epik American Wild West tentang pendistribusian bidang tanah - duluan dan tempel bendera untuk dipertaruhkan" atau bahkan mungkin ikut serta di dalamnya. Lebih tepatnya dalam versi modernnya - jadilah yang pertama mengajukan permohonan untuk layanan publik agar dapat menerima uang untuk anak-anak atau mendapatkan izin untuk meninggalkan rumah. Melihat semua ini, saya ingin berbagi pengalaman </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tim kami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam pengujian dan berpartisipasi dalam persiapan portal layanan regional untuk penyediaan layanan "Catatan Kelas Pertama". Ini juga sangat mirip dengan efek habra dan, saya pikir, dekat dengan apa yang terjadi beberapa hari yang lalu dengan portal federal gosuslugi.ru, tetapi pada skala regional.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melewati tantangan ini di Khabarovsk pada bulan Januari tahun ini dan baru-baru ini berpartisipasi dalam persiapan layanan serupa untuk mengeluarkan izin berburu di wilayah lain. Di bawah ini adalah sedikit pengalaman yang akan memberi Anda kesempatan untuk melihat masalah mempersiapkan pekerjaan portal layanan publik regional untuk periode puncak dari perspektif lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai permulaan - foto bus hitam, yang bertugas di sekolah selama tiga hari sepanjang waktu, di mana penulis baris ini mengkonfirmasi gilirannya di antara orang tuanya tiga tahun lalu. Setidaknya orang tua kita berkumpul. Menonton di musim dingin di Khabarovsk pada -30 derajat masih menyenangkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o8/vh/rb/o8vhrboqvtrufnftfwxsxb1rgm4.png" alt="gambar"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam proses mempersiapkan rekaman puncak di kelas satu, beberapa tim bekerja, karena </font><font style="vertical-align: inherit;">dengan satu atau lain cara, ia terlibat di dalamnya: operator pusat data, operator dan pengembang sistem informasi portal regional, operator dan pengembang sistem informasi pendidikan terintegrasi, dukungan teknis untuk pengguna portal regional. </font><font style="vertical-align: inherit;">Kami di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iondv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melakukan tugas terakhir, secara independen memantau kesehatan portal dan mendukung pengguna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peran kami dalam persiapan adalah untuk mengatur pengujian dan rekomendasi tentang konfigurasi caching di nginx, yah, kami juga menyiapkan instruksi untuk pengguna dengan "perilaku" yang direkomendasikan.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagi yang belum tahu tentang masalah menulis di kelas 1</font></font></b>
                        <div class="spoiler_text">         ,    .  .          ,     ,   -     (      ,   â€”      ),    ,  -     ,   ,            .  ,       ,      ,     â€“    ,        .           .<br>
<br>
     1-          ,    .           0:00 ,        10:00 26 . ,    â€“       .        10:00 ,       â€”    ,      - .<br>
<br>
            .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"></a>    .   2017 .     .         ,    ,    .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layanan untuk sumber daya yang diminta sebagai tugas teknis</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah dalam layanan seperti "menulis ke kelas 1" dalam indikator integral beban (atau probabilitas kueri) cenderung ke "fungsi delta" (fungsi,, fungsi Dirac) terlihat jelas pada grafik dalam bentuk puncak. Pada saat ini, ada beberapa peningkatan panggilan dalam waktu singkat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/uc/c6/0lucc67w9pr4uh2ig1swg5tgtq0.png" alt="Î´-fungsi dan statistik permintaan puncak"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengalaman kami mengatakan bahwa tugas utama pelatihan bukanlah untuk meningkatkan sumber daya. Tugasnya adalah meminimalkan jumlah permintaan potensial per detik, meregangkannya untuk beberapa periode dan menyiapkan sistem untuk muatan yang tersisa. Dalam hal ini, perlu untuk menemukan dan mempercepat kemacetan - ini akan memberikan efek terbesar sesuai dengan prinsip-prinsip teori sistem terikat (prinsip Goldratt). Dan jika tidak, itu adalah kemacetan yang akan gagal. Seluruh sistem harus bekerja darinya: prinsip "drum-buffer-rope."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara fisik tidak mungkin untuk menumpahkan seluruh volume dalam 10 menit dari jam pasir dalam 1 menit - jelas bahwa mereka akan runtuh. </font><font style="vertical-align: inherit;">Begitu pula untuk penyediaan layanan. </font><font style="vertical-align: inherit;">Itu tidak mengejutkan siapa pun - ketika giliran MFC dan skandal untuk menerima layanan, tetapi mengejutkan semua orang - mengapa portal turun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada berbagai pola perilaku penanganan beban dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teori antrian</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat menahan pengguna, mis. </font><font style="vertical-align: inherit;">menambah antrian;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anda bisa menolak untuk melayani mereka yang datang kemudian, misalnya, sampai yang sebelumnya diproses;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anda dapat mencoba meningkatkan produktivitas tanpa henti.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kegunaan ada di antara keduanya. Memang, untuk layanan dengan sumber daya terbatas yang disediakan oleh suatu wilayah atau negara, tidak hanya kecepatan yang penting, tetapi, pertama-tama, pelestarian keadilan sosial - yaitu kondisi yang sama untuk semua. Pada saat yang sama - jika pengguna belum menerima apa yang dia butuhkan, dia memulai permintaan baru. Dalam kasus ini, permintaan tumbuh dalam longsoran salju, membentuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model serangan "</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> efek tumpukan anjing </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">"</font></a><font style="vertical-align: inherit;"> (efek tumpukan anjing, penyerbuan cache, hit miss storm) - pengguna telah membatalkan permintaan dan memulai permintaan baru, sementara yang sebelumnya masih dalam antrian untuk diproses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proses ini memperkuat fakta bahwa seluruh keluarga berpartisipasi dalam pengajuan - ayah dan ibu mengisi aplikasi pada saat yang sama, dan seringkali mengirimkan aplikasi beberapa kali untuk keandalan. </font><font style="vertical-align: inherit;">Dan selain itu, sering juga di beberapa tab dan beberapa browser. </font><font style="vertical-align: inherit;">Oleh karena itu, beban puncak yang diharapkan biasanya masuk akal untuk dikalikan 2-3 kali, dari jumlah mereka yang benar-benar mendaftar untuk layanan tersebut.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retret keadilan</font></font></b>
                        <div class="spoiler_text">,   Â«Â»,            .   ?  Â«Â»    ,    .   .     â€”        ,     .        Â« Â».        .          .<br>
</div>
                    </div><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisasi penyediaan layanan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menghitung jumlah pelamar yang diharapkan berdasarkan kombinasi data pada jumlah total aplikasi yang diajukan tahun lalu dan data per menit untuk wilayah lain. </font><font style="vertical-align: inherit;">Biasanya, puncak aplikasi jatuh pada 5-10 menit, termasuk karena portal hampir tidak merespons selama tiga hingga lima menit pertama, dan kemudian pengguna mengisi formulir dari 1 hingga 5 menit (jangan heran, banyak yang mengisi dari telepon bahkan dalam kondisi "gugup") . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Model perhitungan perkiraan untuk aplikasi bersyarat 1000 per jam adalah sebagai berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puncak dari 5 hingga 10 menit dari awal dan 80% aplikasi akan diajukan di bawah aturan Paretto</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Secara konvensional, kami merencanakan 160 aplikasi per menit atau 3 aplikasi per detik.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan, pengiriman pertama terjadi setelah satu menit dan 45 detik, dan puncak aplikasi berubah dari 4 menit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengurangi beban pada ESIA dan sistem dari menghasilkan sesi otorisasi, instruksi menyarankan agar pengguna masuk terlebih dahulu dan memperpanjang masa sesi. </font><font style="vertical-align: inherit;">Bahkan, 50% disahkan dalam 1 jam, dan ~ 90% dalam setengah jam. </font><font style="vertical-align: inherit;">Kami temui sebelumnya bahwa pengguna mulai masuk ke portal 10 menit sebelum dimulainya layanan - dan otorisasi mulai bekerja dengan tidak stabil. </font><font style="vertical-align: inherit;">Sulit untuk mengatakan alasannya. </font><font style="vertical-align: inherit;">Mungkin alasannya adalah bahwa ketika pekerjaan teknis dilakukan di Moskow pada malam hari, di Khabarovsk kita baru saja memulai hari kerja.</font></font><br>
 <br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mundur tentang instruksi dan pengaturan organisasi</font></font></b>
                        <div class="spoiler_text">            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"></a>.<br>
<br>
         ,    Â« Â»     . ..      .       ,   -   .. <br>
<br>
    ,        ,         ,    .        -        .      ,       ,      .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak mungkin untuk menghapus "fungsi delta" ketika formulir dimuat kembali pada pukul 00:00. Inti dari prosedur ini adalah bahwa layanan muncul pada waktu tertentu. Tetapi Anda dapat mencoba untuk mengurangi jumlah permintaan browser pada semua rute pengguna yang diharapkan dan dengan demikian meninggalkan beban pada sistem hanya dari yang diperlukan - formulir, direktori dinamis dan pengiriman aplikasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengaturan nginx sendiri cukup standar. Di sini lebih penting untuk memilih batasan yang dapat ditahan oleh sistem. Ambil mereka - yaitu mulai permintaan antrian ketika server diharapkan mencapai batas kemampuannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah, dan yang paling penting, kami memaksakan caching (proxy_cache) dan meningkatkan masa pakai data "kadaluwarsa" dalam nginx untuk semua jalur statis dan, jika mungkin, halaman dinamis di mana tidak ada sesi. By the way, ini adalah kesalahan umum ketika caching - menulis ke data cache (kadang-kadang bahkan statika) di mana sesi orang lain disimpan, hasilnya biasanya untuk menghapus cookie ini dari header jika server tidak dapat memisahkan tipe data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di browser untuk pengguna, sepertinya memperbarui halaman dari file yang diunduh dari disk atau memori. Tetapi bahkan ketika pengguna mendapatkannya dari server, mereka diambil dari cache nginx. Direktori itu sendiri, tentu saja, di-cache dalam sistem itu sendiri.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/oq/nv/qioqnv0ofdjd5e0ygculnetdta4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini mengurangi jumlah permintaan potensial dari 89 permintaan menjadi 14 dan volume dari 2,1 MB (untuk 1000 pengguna yang memperbarui halaman, ini merupakan potensi puncak dari 4-8 Gbit / dtk) menjadi 38 Kb (kita semua ingat webpack, tetapi untuk platform entrprise ini bukan selalu mudah dilakukan). Menurut hasil dari bagian ini, masih perlu untuk cache tidak hanya dalam sistem, tetapi juga di nginx beberapa direktori dari bentuk dan pengklasifikasi dinamis yang tidak digunakan pada saat puncak dan memaksa masa pakai untuk mereka. Dan dengan peningkatan beban, biasanya masuk akal untuk meletakkan halaman statis penuh utama dengan mengarahkan pengguna ke layanan yang diinginkan atau membuat sumber daya terpisah untuk layanan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengurangi beban pengiriman, draft dan pengisian data otomatis untuk anak dinonaktifkan. Semua pengguna memiliki kecepatan entri data yang berbeda, yang menghilangkan tampilan formulir yang benar-benar siap untuk pengiriman dan menghindari fungsi delta untuk mengirim aplikasi - semua 1000 dalam satu menit. Pada saat yang sama, keadilan sosial dipertahankan, meskipun, tentu saja, keluhan muncul. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan menjelaskan optimasi sistem itu sendiri - selama pengujian beban, kemacetan diidentifikasi - terutama dalam permintaan DBMS dan indeks dan permintaan itu sendiri dioptimalkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin optimasi yang paling penting adalah menyederhanakan formulir. Apa yang paling mempengaruhi kecepatan ketika diimplementasikan dalam formulir?</font></font><br>
<br>
<ul>
<li>   â€”   ,        ,      .    â€”       5-10 (   iPhone         )   5-       375 /  (1       10 ,     <code>application/x-www-form-urlencoded </code>â€“  20 ),  100      625 /.           100/      â€”        .   ,      Â«  Â».    â€”     ?     ,     .    ,      ?</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panduan canggih. </font><font style="vertical-align: inherit;">Beban biasanya meningkat dengan menggunakan direktori alamat FIAS atau CLADR. </font><font style="vertical-align: inherit;">Masalahnya di sini adalah karena ukuran - FIAS membutuhkan hingga 40GB dalam database dan butuh waktu untuk mencarinya. </font><font style="vertical-align: inherit;">Sepersepuluh detik, tetapi dikalikan dengan 1000 permintaan secara bersamaan, memuat sistem apa pun. </font><font style="vertical-align: inherit;">Tanpa persiapan khusus, mungkin dalam bentuk layanan web yang terpisah dan pada sumber daya yang terpisah, sulit untuk menahan beban - oleh karena itu, mereka sering menggunakan bidang teks biasa untuk alamat.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baiklah, mari kita beralih ke tes.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muat pengujian dalam persiapan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengujian dilakukan melalui dalang - dengan meniru tindakan pengguna di peramban Crominium. </font><font style="vertical-align: inherit;">Yanedeks.tank dan JMeter mengalahkan perlindungan terhadap serangan, karena mereka menghasilkan banyak jenis permintaan yang sama. </font><font style="vertical-align: inherit;">Selain itu, tes ini lemah bertepatan dengan profil pertanyaan nyata ketika mengubah perilaku sistem yang sedang dimuat. </font><font style="vertical-align: inherit;">Selain itu, server meminta cache, dan sulit untuk mereproduksi bagian dari proses di dalamnya (misalnya, otorisasi). </font><font style="vertical-align: inherit;">Ngomong-ngomong, dari salah satu seminar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devDV</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami memiliki presentasi dengan presentasi tentang penggunaan dalang untuk pengujian, termasuk </font><font style="vertical-align: inherit;">memuat, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan ke video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulainya, kami menyusun profil perilaku pengguna dan membagi prosedur menjadi beberapa tahapan utama:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> otorisasi massal di ESIA</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memperbarui satu kali formulir layanan,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pakan massal </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk setiap tahap kami melakukan tes terpisah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tahun lalu, ada kesulitan pada tahap otorisasi di ESIA, tetapi mengujinya dalam skala penuh sulit. Sistem ini eksternal, perlindungan terhadap serangan dan larangan otorisasi dipicu. Namun demikian, dimungkinkan untuk merumuskan profil pengujian untuk memverifikasi dengan tepat kemacetan sistem yang diuji - biasanya ini adalah jumlah sesi yang diotorisasi secara simultan dan nilai otorisasi yang direncanakan per menit, yang dapat disesuaikan dengan rekomendasi.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam pengujian, pembungkus penting untuk mengatur beberapa utas, kami menggunakan 'puppeteer-cluster'. Tetapi biasanya lebih rumit untuk menangani pengecualian dan mengubah perilaku portal di bawah elemen tata letak yang sering terungkap yang muncul dua kali. Atau elemen tidak muncul jika beberapa data tidak memuat seperti yang diharapkan. Ini semua adalah kesalahan yang akan dilihat pengguna dan memuat ulang halaman - yang berarti mereka akan membuat beban tambahan. Ada dua cara: menerapkan penanganan pengecualian dalam tes. Atau modifikasi portal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes itu sendiri sederhana. Di bawah ini adalah bagian dari mengklik tombol "Login" pada portal layanan untuk memasukkan data ke ESIA.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">await</span> page.waitForSelector(AUTH_AVAIL,{<span class="hljs-attr">timeout</span>:OPT_ELEM_WAIT_TIME});
<span class="hljs-keyword">const</span> needAuth = <span class="hljs-keyword">await</span> page.$(ELEM_AUTH_IN);
<span class="hljs-keyword">if</span> (!needAuth) <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  `</span>));<font></font>
        <font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(AUTH_BUT, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.click(AUTH_BUT);
<span class="hljs-keyword">await</span> waitNewUrl(page, <span class="hljs-string">'https://esia.gosuslugi.ru/idp/rlogin?cc=bp'</span>, OPT_PAGE_WAIT_TIME);
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#mobileOrEmail'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">let</span> text = <span class="hljs-keyword">await</span> elemGetText(page, <span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt; div.detected &gt; div.left &gt; div.this-user'</span>);
<span class="hljs-keyword">if</span> (text) <font></font>
   text = text.replace(<span class="hljs-regexp">/ -\(\)/g</span>, <span class="hljs-string">''</span>);        
<span class="hljs-keyword">if</span> (text &amp;&amp; text.indexOf(user) === <span class="hljs-number">-1</span>) {
  <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'div.click-to-another &gt; a'</span>);
  <span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#authnFrm &gt; div.login-slils-box &gt; div &gt;'</span> +
                <span class="hljs-string">' div.detected &gt; div.left &gt; div.this-user'</span>, OPT_ELEMENT_INVISIBLE);<font></font>
}<font></font>
<span class="hljs-keyword">await</span> page.waitForSelector(<span class="hljs-string">'#password'</span>, OPT_ELEMENT_VISIBLE);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#mobileOrEmail'</span>, user);
<span class="hljs-keyword">await</span> page.type(<span class="hljs-string">'#password'</span>, pwd);
<span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#loginByPwdButton'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifikasi memperbarui formulir aplikasi sambil menunggu pengguna "membuka catatan." Tes reboot pada dasarnya adalah satu langkah, tetapi penting untuk memeriksa jenis kesalahan yang dikembalikan - jaringan adalah masalah, kesalahan nginx, kesalahan server, dan apakah formulir memenuhi kriteria. Dan kesulitannya adalah untuk menghasilkan volume maksimum permintaan dalam jumlah waktu paling sedikit dan tidak termasuk dalam batasan perlindungan (namun, selama pengujian dapat diubah, di sisi lain, itu juga merupakan pemeriksaan dari pengaturan jaringan dan infrastruktur server dan WAF). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes semacam itu pada dalang membutuhkan banyak sumber daya untuk bekerja. Secara de facto ternyata Anda membutuhkan setidaknya 2 core terhadap inti 1 dari subsistem front-end dan saluran yang sangat luas. Tetapi ketika menyewa mereka di cloud - ini cukup terjangkau. Kami menggunakan Yandex.cloud.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam pengujian, otorisasi pertama kali diterapkan dalam ESIA untuk setiap aliran secara terpisah. </font><font style="vertical-align: inherit;">Setelah itu, browser terpisah diluncurkan untuk setiap utas dan dalam kerangka satu contoh sejumlah pembaruan dilakukan. </font><font style="vertical-align: inherit;">Setelah itu, instance restart. </font><font style="vertical-align: inherit;">Pemeriksaan itu sendiri dapat mencakup jalur tipikal, misalnya, halaman utama, bentuk layanan. </font><font style="vertical-align: inherit;">Tetapi lebih sering itu hanya cukup untuk sepenuhnya memperbarui layanan dan memeriksa direktori yang diperlukan agar layanan dapat dikirimkan - semua seperti dalam instruksi untuk pengguna. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/8w/vk/oe8wvknrrkkw1hn3vb4ke0oh8sw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebuah fragmen tes untuk membuka main dan menyegarkan halaman.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">await</span> page.setViewport(PUP_OPT);
  <span class="hljs-keyword">await</span> page.goto(BASE_URL);
  <span class="hljs-keyword">await</span> page.setCookie(...cookies[worker.id]);
  <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/nd/lk/form/dnv.htm`</span>);<font></font>
  rdyRefresh++;<font></font>
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#       <span class="hljs-subst">${data}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
  getErr++;<font></font>
  <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
}<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_REFRESH - <span class="hljs-number">1</span>; i++) {
  <span class="hljs-keyword">const</span> filenameIter = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
   <span class="hljs-keyword">try</span> {
       <span class="hljs-keyword">await</span> page.reload({<span class="hljs-attr">waitUntil</span>: [<span class="hljs-string">"networkidle0"</span>, <span class="hljs-string">"domcontentloaded"</span>]});<font></font>
        rdyRefresh++;<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">if</span> (!err.message.includes(<span class="hljs-string">'Navigation failed because browser'</span>)) {
           <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);<font></font>
           getErr++;<font></font>
           <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filenameIter});<font></font>
        }<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memuat dengan mengirimkan aplikasi, seluruh siklus verifikasi dilaksanakan - dengan memuat ulang formulir dan verifikasi input semua data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pecahan.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; AMOUNT_RESEND; i++) {
   <span class="hljs-keyword">const</span> filename = path.join(BASE_DIR, PIC_DIR, <span class="hljs-string">`<span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>.png`</span>);
  <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">await</span> page.goto(<span class="hljs-string">'https://uslugi27.ru/nd/lk/form/dnv.htm'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      1  <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
      getErr++;<font></font>
      <span class="hljs-keyword">continue</span>;<font></font>
 }<font></font>
 <span class="hljs-keyword">try</span> {
     <span class="hljs-keyword">const</span> FORM_PREF = <span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; '</span>;
     <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data`</span>);
<span class="hljs-comment">// &lt;â€¦&gt;</span>
     <span class="hljs-keyword">await</span> page.type(<span class="hljs-string">`<span class="hljs-subst">${FORM_PREF}</span>fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input`</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// &lt;â€¦&gt;</span>
  } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#      <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
      <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});
     <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-primary.pull-right.next'</span>);
      <span class="hljs-keyword">await</span> clickDelayed(page,<span class="hljs-string">`#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(1) &gt; div &gt; div`</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div:nth-child(5) &gt; fieldset &gt; div &gt; div:nth-child(2) &gt; div &gt; div'</span>);
       <span class="hljs-keyword">await</span> page.click(<span class="hljs-string">'#createForm &gt; div.col_100.controls &gt; button.btn.btn-success.pull-right.submit'</span>);<font></font>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">`#     <span class="hljs-subst">${data}</span>-<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${err.message}</span>`</span>);
    <span class="hljs-keyword">await</span> page.screenshot({<span class="hljs-attr">path</span>: filename});<font></font>
    sendErr++;<font></font>
    <span class="hljs-keyword">continue</span>;<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ngomong-ngomong, tes bisa dipercepat jika Anda memasukkan semua data bukan dari dalang oleh halaman tunggu.tipe konstruksi, tetapi transfer logika ini ke browser itu sendiri. Tetapi kemudian kompleksitas kesalahan penangkapan meningkat. Seperti itu</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset.petgroup.ungroupped-attrs &gt; div &gt; div:nth-child(4) &gt; div.col-md-9.attr-data'</span>).click();
 <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#createForm &gt; div:nth-child(4) &gt; fieldset:nth-child(2) &gt; div &gt; div:nth-child(1) &gt; div.col-md-9.attr-data &gt; input'</span>).value = <span class="hljs-string">''</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama pengujian, kami menyediakan beberapa ribu otorisasi ESIA dan sekitar 16 ribu aplikasi yang dikirim. Bagaimana pemulihan sistem informasi pendidikan yang produktif setelah sejumlah pernyataan - bahkan tidak bertanya. Ini adalah kisah yang sangat berbeda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil utama yang terlihat dari proses ini adalah bahwa media lokal sudah bosan pada hari-hari pendaftaran di kelas satu. Layanan telah meninggalkan area media. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara paralel, kami membuat dasbor untuk memantau fungsionalitas formulir berdasarkan Grafana: jumlah aplikasi, jumlah panggilan, metrik Yandex, dll. Tetapi kita akan meninggalkan topik ini untuk waktu berikutnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baiklah, saya ingin mengucapkan selamat kepada semua orang yang terhubung dengan topik peningkatan kualitas penyediaan layanan negara bagian dan kota dalam bentuk elektronik. </font><font style="vertical-align: inherit;">Pekerjaan persiapan tanpa akhir ini tidak sia-sia - setelah semua, pada bulan April dan Mei jumlah aplikasi yang diajukan meningkat secara signifikan.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502068/index.html">110 volt di komputer Anda</a></li>
<li><a href="../id502070/index.html">Sejarah Pentax (artikel plus video)</a></li>
<li><a href="../id502072/index.html">Docking ISS menggunakan JavaScript dan kompas</a></li>
<li><a href="../id502076/index.html">Robot Troli 2.0. Bagian 1. Navigasi otonom dari robot rumahan berdasarkan ROS</a></li>
<li><a href="../id502080/index.html">Metode Kanban: Contoh PNZ No. 1, proses studi-pengukuran dalam startup</a></li>
<li><a href="../id502086/index.html">Menyiapkan Minio sehingga pengguna hanya dapat bekerja dengan embernya</a></li>
<li><a href="../id502088/index.html">Kisah kelebihan dan waktu yang hilang. Menurut py3</a></li>
<li><a href="../id502092/index.html">Dukungan teknologi dan peraturan untuk layanan kepercayaan digital di Federasi Rusia</a></li>
<li><a href="../id502098/index.html">Bagaimana kami membangun B2B</a></li>
<li><a href="../id502102/index.html">AutoML hebat dan kuat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>