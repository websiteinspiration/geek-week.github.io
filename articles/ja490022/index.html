<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏽 🔜 👩🏼 PowerShellを使用してREST APIを操作する 🤳🏼 👀 🤚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="あなたの多くは、おそらくREST APIを使用してさまざまなインフラストラクチャを操作しています。そして、ますます多くの人々がPowerShellを習得して日常的なタスクを自動化しているので、それを使用してREST APIを操作し始めませんか？
 
 今日、あなたの注意は、自動化の大ファンであるad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PowerShellを使用してREST APIを操作する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/490022/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの多くは、おそらくREST APIを使用してさまざまなインフラストラクチャを操作しています。そして、ますます多くの人々がPowerShellを習得して日常的なタスクを自動化しているので、それを使用してREST APIを操作し始めませんか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、あなたの注意は、自動化の大ファンである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adamtheautomator.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の作者であるAdam Bertramによる記事の翻訳に招待さ</font><font style="vertical-align: inherit;">れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
猫へようこそ。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/f8/oh/cvf8ohe9fwocpf9kg4sc2r4ejls.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例として、APIは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swagger petstore APIになります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まともなマニュアルである必要があるため、システムの要件について説明します。</font><font style="vertical-align: inherit;">この例は、Windows PowerShell v5.1で作成されています。</font><font style="vertical-align: inherit;">この例はv6以降でも機能する可能性があります。MacまたはLinux OSでは可能ですが、これは正確ではありません（テストされていません）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいモジュール用のフォルダーとファイルの準備</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のスクリプトを書き始める前に、モジュールのファイル構造を準備する必要があります。</font><font style="vertical-align: inherit;">ここではもちろん、誰もが彼の好きなことを自由に行うことができます。簡単にするために、2つのファイルと1つのフォルダーの最も単純な構造を作成します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShellマニフェストファイル（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.psd1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）には、新しいモジュールに関する情報が格納されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShellモジュールファイル自体（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.psm1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）には、すべてのコマンドレットが格納されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、これらのファイルの両方が置かれるフォルダ。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブ</font><i><font style="vertical-align: inherit;">Cの</font></i><i><font style="vertical-align: inherit;">ソース</font></i><font style="vertical-align: inherit;">ディレクトリ</font><font style="vertical-align: inherit;">に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetStore</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フォルダー</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し</font><i><font style="vertical-align: inherit;">ます</font></i><i><font style="vertical-align: inherit;">。</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Type</span> Directory <span class="hljs-literal">-Path</span> C:\Source\PetStore\
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、モジュールのマニフェストファイルを作成します。これは、モジュールの</font><font style="vertical-align: inherit;">すべての要件とモジュールに関するすべての情報を書き留めることができるメタデータを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含む.psd1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実際、そのようなファイルを手動で作成することを禁止する人は誰もいませんが、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-ModuleManifestコマンドレット</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してこれを行うことができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">もちろん、必要なパラメーターを指定する必要があります。</font><font style="vertical-align: inherit;">ドライブCの新しいフォルダーに</font><i><font style="vertical-align: inherit;">Petstore.psd1</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
というマニフェストファイルを作成します</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Use splatting technique to make it more readable</span>
<span class="hljs-comment">#         </span><font></font>
<font></font>
 <span class="hljs-variable">$ModuleManifestParams</span> = <span class="hljs-selector-tag">@</span>{<font></font>
 	Path        	= <span class="hljs-string">"C:\Source\PetStore\PetStore.psd1"</span> 
<span class="hljs-comment"># Notice that the psd1 file has the same name as the folder it resides in</span>
<span class="hljs-comment">#      ,   </span><font></font>
<font></font>
 	Guid        	= [<span class="hljs-type">GUID</span>]::NewGuid().Guid 
<span class="hljs-comment"># A unique GUID for the module for identification</span>
<span class="hljs-comment"># GUID  </span><font></font>
<font></font>
 	Author      	= <span class="hljs-string">"Your Name Here"</span> 
<span class="hljs-comment"># Optional -   ()</span><font></font>
<font></font>
     CompanyName 	= <span class="hljs-string">"Company Name here"</span> 
<span class="hljs-comment"># Optional -  ()</span><font></font>
<font></font>
 	ModuleVersion   = <span class="hljs-string">"0.0.1"</span> 
<span class="hljs-comment"># Semantic versioning as recommended best practice for PowerShell modules</span>
<span class="hljs-comment">#    ,      ( , ..  )</span><font></font>
<font></font>
 	Description 	= <span class="hljs-string">"A PowerShell module to interact with the HttpBin API"</span> 
<span class="hljs-comment"># A short description of what the module does</span>
<span class="hljs-comment">#  ,    </span><font></font>
 }<font></font>
 <font></font>
 <span class="hljs-comment"># Run New-ModuleManifest with the splatted parameters</span>
 <span class="hljs-comment">#          </span><font></font>
<font></font>
 <span class="hljs-built_in">New-ModuleManifest</span> @ModuleManifestParams
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張子が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.psm1の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール自体のファイルには、</font><font style="vertical-align: inherit;">必要なすべての関数が含まれています。</font><font style="vertical-align: inherit;">任意のPowerShellエディターで、新しいファイルを作成し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブに配置し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIエンドポイントのURIの規定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
厳密に言えば、これはオプションの操作ですが、それは良いことだ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し実際</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .psm1ファイルに変数としてAPIエンドポイントの基本リソース識別子（ベースURI）を書く-これは、将来（バージョンからバージョンへの移行）を含め、多くのことを簡素化します。</font><font style="vertical-align: inherit;">さて、データ形式としてはJSONを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようになります。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$script:PetStoreBaseUri</span> = <span class="hljs-string">"https://petstore.swagger.io/v2"</span>
 <span class="hljs-variable">$script:PetstoreInvokeParams</span> = <span class="hljs-selector-tag">@</span>{<font></font>
 	ContentType = <span class="hljs-string">"application/json"</span><font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、この変数を</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-RestMethod呼び出しの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある関数で使用できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="powershell hljs">PS51&gt; <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-string">"<span class="hljs-variable">$script:PetStoreBaseUri</span>/pet/&lt;petid&gt;"</span> @script:PetstoreInvokeParams
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の関数を作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、エンドポイント</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://petstore.swagger.io/v2/pet/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からペット</font><font style="vertical-align: inherit;">情報</font><font style="vertical-align: inherit;">を受け取る関数を作成し</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-PetstorePetと</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼びます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-title">Get-PetstorePet</span></span> {
 	<span class="hljs-function">[<span class="hljs-type">cmdletbinding</span>()]</span>
 	<span class="hljs-keyword">param</span>(<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipeline</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">int</span><span class="hljs-type">64</span>]<span class="hljs-variable">$PetID</span><font></font>
 	)<font></font>
 	<span class="hljs-keyword">Begin</span> {
     	<span class="hljs-comment"># Using the module-scoped API endpoint URI to create a function-specific URL to query</span>
	<span class="hljs-comment">#   URI,   ,      URL,    </span><font></font>
<font></font>
     	<span class="hljs-variable">$Uri</span> = <span class="hljs-string">"<span class="hljs-variable">$script:PetStoreBaseUri</span>/pet/{petId}"</span><font></font>
 	}<font></font>
 	<span class="hljs-keyword">Process</span> {
     	<span class="hljs-comment"># Create a temporary variable from the Uri variable </span>
	<span class="hljs-comment">#       URI</span><font></font>
<font></font>
contain int the PetId <span class="hljs-keyword">parameter</span>
     	<span class="hljs-variable">$TempUri</span> = <span class="hljs-variable">$Uri</span> <span class="hljs-operator">-replace</span> <span class="hljs-string">"\{petId\}"</span>, <span class="hljs-variable">$PetId</span><font></font>
         	<font></font>
     	<span class="hljs-comment"># Call the API endpoint using the $TempUri</span>
	<span class="hljs-comment">#        API-</span><font></font>
<font></font>
     	<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$TempUri</span> <span class="hljs-literal">-Method</span> Get @script:PetStoreInvokeParams<font></font>
 	}<font></font>
 }<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このエンドポイントの特定のREST APIパラメーターと一致</font><font style="vertical-align: inherit;">
するように</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetId</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターを定義しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このエンドポイントの例のパラメーターの完全なリストは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">関数で</font><b><font style="vertical-align: inherit;">ValueFromPipeline</font></b><font style="vertical-align: inherit;">と</font><b><font style="vertical-align: inherit;">ValueFromPipelineByPropertyName</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用</font><font style="vertical-align: inherit;">して、パイプラインからパラメーターにパラメーターを渡すことができます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Define pet id's to fetch </span>
<span class="hljs-comment">#   ,   </span><font></font>
<font></font>
 <span class="hljs-variable">$PetIds</span> = <span class="hljs-selector-tag">@</span>(<span class="hljs-number">100</span>,<span class="hljs-number">101</span>,<span class="hljs-number">102</span>,<span class="hljs-number">103</span>)
 <span class="hljs-variable">$PetIds</span> | <span class="hljs-built_in">Get-PetstorePet</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールをインポートする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Import-Module</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを実行します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="powershell hljs">PS51&gt; <span class="hljs-built_in">Import-Module</span> C:\Source\Petstore
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-PetstorePet関数の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実行を開始することができ</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="powershell hljs">PS51&gt; <span class="hljs-built_in">Get-PetstorePet</span> <span class="hljs-literal">-PetId</span> <span class="hljs-number">123</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいエントリを追加する</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドキュメントで</font></a><font style="vertical-align: inherit;">説明されて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いる</font></a><font style="vertical-align: inherit;">ように、新しいペットを追加するには、リクエストの本文をJSON形式で記述する必要があります。</font><font style="vertical-align: inherit;">ええと、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-PetstorePet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を使用して新しいペットを追加するのは</font><b><font style="vertical-align: inherit;">当然</font></b><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShellはオブジェクトの方法を知っているので、すべてを積み上げるのではなく、ハッシュテーブルを作成し、それをJSONに変換します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$BodyJson</span> = <span class="hljs-selector-tag">@</span>{<font></font>
 	id    	= <span class="hljs-variable">$PetId</span>
 	category  = <span class="hljs-selector-tag">@</span>{<font></font>
     	id   = <span class="hljs-variable">$CategoryId</span>
     	name = <span class="hljs-variable">$CategoryName</span><font></font>
 	}<font></font>
 	name  	= <span class="hljs-variable">$PetName</span>
 	photoUrls = <span class="hljs-variable">$PhotoUrls</span>
 	tags  	= <span class="hljs-variable">$Tags</span>
 	status	= <span class="hljs-variable">$Status</span>
 } | <span class="hljs-built_in">ConvertTo-Json</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、包括的なJSONを作成するよりもはるかに単純で短いものです。</font><font style="vertical-align: inherit;">ハッシュプレートに基づいて、コマンドに必要なパラメーターを定義します。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-keyword">param</span>(
         	<span class="hljs-comment"># Id of the pet that you'll create</span>
		<span class="hljs-comment"># ID ,   </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
           	[<span class="hljs-type">Alias</span>(<span class="hljs-string">"Id"</span>)] 
<span class="hljs-comment"># This is an alias so that we can use it with pipeline properly by piping output from other Functions in this module</span>
<span class="hljs-comment">#  ,      ,  ,           </span><font></font>
<font></font>
     	[<span class="hljs-built_in">int</span><span class="hljs-type">64</span>]<span class="hljs-variable">$PetId</span>,<font></font>
 <font></font>
         	<span class="hljs-comment"># Category ID of the pet to create</span>
		<span class="hljs-comment"># ID ,      </span>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">int</span><span class="hljs-type">64</span>]<span class="hljs-variable">$CategoryId</span>,<font></font>
 <font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$CategoryName</span>,<font></font>
 <font></font>
         	<span class="hljs-comment"># Name of the pet</span>
		<span class="hljs-comment">#  </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$PetName</span>,<font></font>
 <font></font>
         	<span class="hljs-comment"># Urls to photos of the pet</span>
		<span class="hljs-comment"># URLs   </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>[]]<span class="hljs-variable">$PhotoUrls</span>,<font></font>
 <font></font>
         	<span class="hljs-comment"># Objects with tags containing Id and Name properties</span>
		<span class="hljs-comment">#   ,  ID  Name</span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-type">PSCustomObject</span>[]]<span class="hljs-variable">$Tags</span>,<font></font>
 <font></font>
         	<span class="hljs-comment"># Status of the pet "Available","Taken" etc.</span>
		<span class="hljs-comment">#   (,   .)</span>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Status</span><font></font>
 <font></font>
 	)<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ブロックは</font><font style="vertical-align: inherit;">前のコマンド</font><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">まったく同じであるため、URIをわずかに変更することで再利用できます（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメーターは</font><font style="vertical-align: inherit;">ここで</font><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">不要になるため）。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-keyword">Begin</span> {
 	<span class="hljs-variable">$Uri</span> = <span class="hljs-string">"<span class="hljs-variable">$script:PetStoreBaseUri</span>/pet"</span><font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font><font style="vertical-align: inherit;">、JSON形式を使用して投稿リクエストを作成し、</font><b><font style="vertical-align: inherit;">Invoke-RestMethod</font></b><font style="vertical-align: inherit;">を使用してREST APIエンドポイントに送信</font><font style="vertical-align: inherit;">する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックを定義します</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-keyword">Process</span> {
 	<span class="hljs-comment"># Create the JSON that we'll post to the endpoint</span>
        <span class="hljs-comment">#  JSON   post-  </span><font></font>
<font></font>
 	<span class="hljs-variable">$BodyObject</span> = <span class="hljs-selector-tag">@</span>{<font></font>
     	id    	= <span class="hljs-variable">$PetId</span>
     	category  = <span class="hljs-variable">$Category</span>
     	name  	= <span class="hljs-variable">$PetName</span>
     	photoUrls = <span class="hljs-variable">$PhotoUrls</span>
     	tags  	= <span class="hljs-variable">$Tags</span>
     	status	= <span class="hljs-variable">$Status</span><font></font>
 	}<font></font>
             	<font></font>
 	<span class="hljs-comment"># This will remove properties with a null value since it may mess around with some API's</span>
	<span class="hljs-comment">#  ,     null,   </span><font></font>
<font></font>
 	<span class="hljs-variable">$BodyObject</span>.psobject.properties | ? {<span class="hljs-variable">$_</span>.Value <span class="hljs-operator">-eq</span> <span class="hljs-variable">$Null</span>} | <span class="hljs-keyword">Foreach</span> {
     	<span class="hljs-variable">$BodyObject</span>.psobject.properties.Remove(<span class="hljs-variable">$_</span>.Name)<font></font>
 	}<font></font>
 <font></font>
 	<span class="hljs-variable">$BodyJson</span> = <span class="hljs-variable">$BodyObject</span> | <span class="hljs-built_in">ConvertTo-Json</span><font></font>
 <font></font>
 	<span class="hljs-comment"># Call the API endpoint using the $TempUri</span>
	<span class="hljs-comment">#   ,  $TempUri</span><font></font>
<font></font>
 	<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$Script:Uri</span> <span class="hljs-literal">-Method</span> POST <span class="hljs-literal">-Body</span> <span class="hljs-variable">$BodyJson</span> @PetStoreInvokeParams<font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">nullの</font></i><font style="vertical-align: inherit;">値を持つ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ BodyObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロパティ</font><font style="vertical-align: inherit;">
を削除したことに注意し</font><font style="vertical-align: inherit;">てください。一部のREST APIは、そのような値をフィードしようとすると気に入らない場合があります。</font><font style="vertical-align: inherit;">
ペットを追加する機能は次のようになります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-title">Add-PetstorePet</span></span> {
 	<span class="hljs-function">[<span class="hljs-type">cmdletbinding</span>()]</span>
 	<span class="hljs-keyword">param</span>(<font></font>
        <font></font>
         <span class="hljs-comment"># Id of the pet that you'll create</span>
         <span class="hljs-comment"># ID ,   </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
<font></font>
     	[<span class="hljs-type">Alias</span>(<span class="hljs-string">"Id"</span>)] 
        <span class="hljs-comment"># This is an alias so that we can use it with pipeline properly by piping output from other Functions in this module</span>
       <span class="hljs-comment">#  ,      ,  ,           </span><font></font>
<font></font>
     	[<span class="hljs-built_in">int</span><span class="hljs-type">64</span>]<span class="hljs-variable">$PetId</span>,<font></font>
<font></font>
       	<span class="hljs-comment"># hash containing Id and name of category</span>
        <span class="hljs-comment">#   ID ,      ,   -</span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">hashtable</span>]<span class="hljs-variable">$Category</span>,<font></font>
 <font></font>
         <span class="hljs-comment"># Name of the pet</span>
         <span class="hljs-comment">#  </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$PetName</span>,<font></font>
 <font></font>
        <span class="hljs-comment"># Urls to photos of the pet</span>
        <span class="hljs-comment"># URLs   </span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>[]]<span class="hljs-variable">$PhotoUrls</span>,<font></font>
 <font></font>
         <span class="hljs-comment"># Objects with tags containing Id and Name properties</span>
         <span class="hljs-comment">#   ,  ID  Name</span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-type">PSCustomObject</span>[]]<span class="hljs-variable">$Tags</span>,<font></font>
 <font></font>
         <span class="hljs-comment"># Status of the pet "Available","Taken" etc.</span>
         <span class="hljs-comment">#   (,   .)</span><font></font>
<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Status</span><font></font>
 <font></font>
 	)<font></font>
 	<span class="hljs-keyword">Begin</span> {
     	<span class="hljs-variable">$Uri</span> = <span class="hljs-string">"<span class="hljs-variable">$script:PetStoreBaseUri</span>/pet"</span><font></font>
 	}<font></font>
 	<span class="hljs-keyword">Process</span> {
     	<span class="hljs-comment"># Create the JSON that we'll post to the endpoint</span>
        <span class="hljs-comment">#  JSON   post-   </span><font></font>
<font></font>
     	<span class="hljs-variable">$BodyObject</span> = <span class="hljs-selector-tag">@</span>{<font></font>
         	id    	= <span class="hljs-variable">$PetId</span>
         	category  = <span class="hljs-variable">$Category</span>
         	name  	= <span class="hljs-variable">$PetName</span>
         	photoUrls = <span class="hljs-variable">$PhotoUrls</span>
         	tags  	= <span class="hljs-variable">$Tags</span>
         	status	= <span class="hljs-variable">$Status</span><font></font>
     	}<font></font>
 <font></font>
     	<span class="hljs-variable">$BodyObject</span>.psobject.properties | ? {<span class="hljs-variable">$_</span>.Value <span class="hljs-operator">-eq</span> <span class="hljs-variable">$Null</span>} | <span class="hljs-keyword">Foreach</span> {
         	<span class="hljs-variable">$BodyObject</span>.psobject.properties.Remove(<span class="hljs-variable">$_</span>.Name)<font></font>
     	}<font></font>
 <font></font>
     	<span class="hljs-variable">$BodyJson</span> = <span class="hljs-variable">$BodyObject</span> | <span class="hljs-built_in">ConvertTo-Json</span><font></font>
 <font></font>
     	<span class="hljs-comment"># Call the API endpoint using the $TempUri</span>
        <span class="hljs-comment">#   ,  $TempUri</span><font></font>
<font></font>
       <font></font>
    	 <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$Uri</span> <span class="hljs-literal">-Method</span> POST <span class="hljs-literal">-Body</span> <span class="hljs-variable">$BodyJson</span> @script:PetStoreInvokeParams<font></font>
 <font></font>
 	}<font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールを再度インポートして、関数を実行します。</font></font><br>
<br>
<pre><code class="powershell hljs">PS51&gt; <span class="hljs-built_in">Import-Module</span> C:\Source\Petstore <span class="hljs-literal">-Force</span>
 PS51&gt; <span class="hljs-built_in">Add-PetstorePet</span> <span class="hljs-literal">-PetName</span> Fido <span class="hljs-literal">-PetId</span> <span class="hljs-number">1</span> <span class="hljs-literal">-PhotoUrls</span> <span class="hljs-string">"http://somesite.com/picture.jpg"</span>
 PS51&gt; <span class="hljs-built_in">Get-PetstorePet</span> <span class="hljs-literal">-PetId</span> <span class="hljs-number">1</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新機能を書く</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで関数に慣れました。このアプローチに基づいて、REST APIで動作する他のメソッドの関数を作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-PetstorePet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に</font><font style="vertical-align: inherit;">基づい</font><font style="vertical-align: inherit;">て、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove-PetstorePet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除関数を作成できます。</font><font style="vertical-align: inherit;">これを行うには、適切な名前を付け、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-RestMethodコマンド</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">呼び出されるメソッドを次のメソッドに置き換え</font></font><code>DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-title">Remove-PetstorePet</span></span> {
     <span class="hljs-function">[<span class="hljs-type">cmdletbinding</span>()]</span>
 	<span class="hljs-keyword">param</span>(<font></font>
     	[<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>, <span class="hljs-type">ValueFromPipeline</span>, <span class="hljs-type">ValueFromPipelineByPropertyName</span>)]<font></font>
     	[<span class="hljs-type">Alias</span>(<span class="hljs-string">"Id"</span>)]<font></font>
     	[<span class="hljs-built_in">int</span><span class="hljs-type">64</span>]<span class="hljs-variable">$PetId</span><font></font>
 	)<font></font>
 	<span class="hljs-keyword">Begin</span> {
     	<span class="hljs-variable">$Uri</span> = <span class="hljs-string">"<span class="hljs-variable">$script:PetStoreBaseUri</span>/pet/{petId}"</span><font></font>
 	}<font></font>
 	<span class="hljs-keyword">Process</span> {
    	 <span class="hljs-comment"># Create a temporary variable from the Uri variable containing the PetId parameter</span>
         <span class="hljs-comment">#       URI</span><font></font>
<font></font>
     	<span class="hljs-variable">$TempUri</span> = <span class="hljs-variable">$Uri</span> <span class="hljs-operator">-replace</span> <span class="hljs-string">"\{petId\}"</span>, <span class="hljs-variable">$PetId</span><font></font>
     	<font></font>
     	<span class="hljs-comment"># Call the API endpoint using the $TempUri</span>
        <span class="hljs-comment">#   ,  $TempUri</span><font></font>
        <font></font>
     	<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$TempUri</span> <span class="hljs-literal">-Method</span> DELETE @script:PetStoreInvokeParams <font></font>
<font></font>
        <span class="hljs-comment"># NOTICE how we replaced GET with DELETE</span>
        <span class="hljs-comment">#  ,     GET  DELETE</span><font></font>
 <font></font>
 	}<font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイプライン入力</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を受け入れるように構成されているので、</font><font style="vertical-align: inherit;">ペットのパイプを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove-PetstorePet関数に</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単に整理でき</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="powershell hljs">PS51&gt; <span class="hljs-built_in">Get-PetstorePet</span> <span class="hljs-literal">-PetId</span> <span class="hljs-number">1</span> | <span class="hljs-built_in">Remove-PetstorePet</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的に</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらくお気づきのように、REST API用のPowerShellモジュールを作成する場合、多くは再利用に結びついています。</font><font style="vertical-align: inherit;">多くのREST APIはswagger APIに非常に類似しているため、モジュールを再利用してさまざまなAPIを操作することはかなり可能です。</font><font style="vertical-align: inherit;">パイプラインのサポートにより、作業がさらに簡素化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、もしあなたがあなたのオートメーションの実践から共有する何かを持っているなら、コメントへようこそ。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490010/index.html">音楽の正しさをチェックするための型システムの検査</a></li>
<li><a href="../ja490012/index.html">ストレージのアラートとエラー、それらに対処する方法？</a></li>
<li><a href="../ja490014/index.html">プロのようなJavaScriptツリーの揺れ</a></li>
<li><a href="../ja490018/index.html">片手でモバイルアプリケーションを設計する方法</a></li>
<li><a href="../ja490020/index.html">PVS-Studioの例によるIT分野での英語への翻訳</a></li>
<li><a href="../ja490024/index.html">PhpStormプラグインでルーチンを取り除く</a></li>
<li><a href="../ja490026/index.html">Elasticsearchがデータを整理する方法：データの共有、クリーニング、バックアップ</a></li>
<li><a href="../ja490028/index.html">検索と評価：候補者のための検索と評価ツール</a></li>
<li><a href="../ja490032/index.html">主なものに関する古い曲：なぜバックアップが必要なのか、ここでHPE StoreOnceがどのように役立つのか</a></li>
<li><a href="../ja490034/index.html">RaffeisenbankでのML REPAミートアップ：放送を続ける</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>