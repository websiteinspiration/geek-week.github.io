<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”® ğŸ”° â˜ï¸ ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ç”¨ã®é›»å ±ãƒœãƒƒãƒˆ ğŸ« ğŸ¦ ğŸ§–ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®è¨˜äº‹ã«åŸºã¥ã„ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ç”¨ã®ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ãƒœãƒƒãƒˆï¼ˆè¨˜äº‹ã¯ç§ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚èª­ã‚“ã ã ã‘ã§ã™ï¼‰ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«PowerShellã§ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ãƒœãƒƒãƒˆã‚’ä½œæˆã—ãŸçµŒé¨“ã‚’å…±æœ‰ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ã€ã„ãã¤ã‹ã®å†™çœŸãŒã‚ã‚Šã¾ã™ã€‚å»ºè¨­çš„ãªæ‰¹è©•ã¯æ­“è¿ã•ã‚Œã¾ã™ï¼ˆ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ç”¨ã®é›»å ±ãƒœãƒƒãƒˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483660/"><img src="https://habrastorage.org/webt/f-/dc/ax/f-dcaxuxg0id5fqzmenau-wyi4c.jpeg" alt="ç”»åƒ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã«åŸºã¥ã„ã¦ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ç”¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ãƒœãƒƒãƒˆ</font></a><font style="vertical-align: inherit;">ï¼ˆè¨˜äº‹ã¯ç§ã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚èª­ã‚“ã ã ã‘ã§ã™ï¼‰ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«PowerShellã§ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ãƒœãƒƒãƒˆã‚’ä½œæˆã—ãŸçµŒé¨“ã‚’å…±æœ‰ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ã€ã„ãã¤ã‹ã®å†™çœŸãŒã‚ã‚Šã¾ã™ã€‚å»ºè¨­çš„ãªæ‰¹è©•ã¯æ­“è¿ã•ã‚Œã¾ã™ï¼ˆä¸»ãªã“ã¨ã¯ã€ã€ŒPowerShellã‚’ä½¿ç”¨ã™ã‚‹ç†ç”±ã¯ä½•ã§ã™ã‹ï¼Ÿãã‚Œã¯perlã«ã‚ã‚‹ã¹ãã ã£ãŸã€ã¨è¨€ã†ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã¯PowerShellã‚’åˆã‚ã¦ä½¿ç”¨ã™ã‚‹æ–¹ã«é©ã—ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€çµŒé¨“è±Šå¯Œãªç®¡ç†è€…ã¯ã“ã“ã§å½¹ç«‹ã¤æƒ…å ±ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½¼ã¯è¨˜äº‹ã‚’ç°¡å˜ãªã‚‚ã®ã‹ã‚‰è¤‡é›‘ãªã‚‚ã®ã¾ã§ã€éƒ¨åˆ†çš„ã«çµ„ã¿ç«‹ã¦ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚ãŠãã‚‰ãç›—ä½œãŒç™ºç”Ÿã—ã¾ã™ã€è­¦æˆ’ã—ã¦ãã ã•ã„ï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã§ã‚µãƒ¼ãƒ“ã‚¹ã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ï¼ˆåœæ­¢ã€é–‹å§‹ï¼‰ã—ã€ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒ­ã‚°ã‚„ãã®ä»–ã®æƒ…å ±ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">VPNã¨ãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ãªã—ã§ã€ç§ãŒã‚„ã‚ŠãŸã„ã“ã¨ã¯ã™ã¹ã¦ï¼ˆå®Ÿéš›ã«ã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒï¼‰ã€åœ°ä¸‹é‰„ã®ä¸­ã€åº—ã®ä¸­ã€ã¾ãŸã¯ã‚½ãƒ•ã‚¡ã®ä¸Šã«æ¨ªãŸã‚ã£ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ï¼ˆã‚‚ã¡ã‚ã‚“ã€è†ã®ä¸Šã«æ›¸ã‹ã‚ŒãŸï¼‰è¦ä»¶ã®ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegramãƒœãƒƒãƒˆã§ã‚¿ã‚¹ã‚¯ã®è¿½åŠ /å¤‰æ›´ãŒç°¡å˜</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ã¾ãŸã¯ä¸¦åˆ—åŒ– </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›´æ„Ÿçš„ãªç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°‘ãªãã¨ã‚‚ã‚ã‚‹ç¨‹åº¦ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ã‚‹æ™‚ç‚¹ã§ã€è¨­å®šã‚’åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¥ã‚Œã‚‹ã“ã¨ãŒæ±ºå®šã•ã‚Œã¾ã—ãŸ-ç§ãŸã¡ã®å ´åˆã¯xmlï¼ˆã“ã“ã§ã¯èª°ã‹ãŒjsonã§ã™ã¹ã¦ã‚’ã‚„ã‚ã†ã¨è¨€ã†ã“ã¨ãŒã§ãã¾ã™ãŒã€ç§ãŸã¡ã¯xmlã§ãã‚Œã‚’è¡Œã£ã¦æº€è¶³ã—ã¾ã—ãŸï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼š</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ1ï¼šã‚·ãƒ³ãƒ—ãƒ«ãªé›»å ±ãƒœãƒƒãƒˆ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŸã¡ã¯ã€ãƒœãƒƒãƒˆãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ãªãï¼‰ã‚’æ¢ã—ã¦ã„ã‚‹- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BotFatherï¼ˆ@BotFatherï¼‰ </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é›»å ±ã§ã¯ã€</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/qz/oa/gpqzoakmx6j1swm_q2zbrajcpae.jpeg" alt="ãƒœãƒƒãƒˆãƒ•ã‚¡ãƒ¼ã‚¶ãƒ¼"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ã€…ã¯ã€æ›¸ãè¾¼ã¿</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ newbot</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ¬¡ã«ã€æˆ‘ã€…ã¯ã€Œãƒœãƒƒãƒˆã€ï¼ˆHaaaabr_botï¼‰ã§çµ‚ã‚ã‚‹ã¹ãã€ãƒœãƒƒãƒˆï¼ˆç§ã®å ´åˆã€ç§ã¯ç‰¹ã«è¨˜äº‹ã®ãŸã‚ã«Haaaabrã¨å‘¼ã°ã‚Œã‚‹ï¼‰ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®åå‰ã‚’æ€ã„ä»˜ãã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¾Œã“ã®BotFatherã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ia/er/vm/iaervmphz5nsdm4tjwysrtr-zd4.jpeg" alt="ç”»åƒ"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ãƒœãƒƒãƒˆã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€èª¬æ˜ã‚’å…¥åŠ›ã—ã€ã‚³ãƒãƒ³ãƒ‰ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã§ãã¾ã™ãŒã€ç§ã¯</font><font style="vertical-align: inherit;">é¢å€’</font><font style="vertical-align: inherit;">ã™ãã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ã¦â€‹â€‹å¿œç­”ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒœãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSã‚³ãƒ¼ãƒ‰ã‚’éƒ¨åˆ†çš„ã«è¨˜è¿°ã—ã€å‚ç…§ç”¨ã«å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚’å®šæœŸçš„ã«æŒ¿å…¥ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‚è€ƒã¾ã§ã«ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram Bot API API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘¼ã³å‡ºã—ã®èª¬æ˜</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŒå¿…è¦ã§ã™ã€‚2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå¿…è¦ã§ã™ï¼š</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUpdates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ãƒœãƒƒãƒˆï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ã«ã‚ˆã‚‹</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sendMessage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡</font><font style="vertical-align: inherit;">-ãƒœãƒƒãƒˆï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒã˜å ´æ‰€ã§ã€æ¬¡ã®ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegram Bot APIã¸ã®ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã¯HTTPSçµŒç”±ã§æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€æ¬¡ã®å½¢å¼ã§æç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">api.telegram.org/bot&lt;token&gt;</font></a><font style="vertical-align: inherit;"> / </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">METHOD_NAME</font></font></a> </blockquote><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰‹é †1-ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</font></font></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¤‰æ•°ã®</font><u><font style="vertical-align: inherit;">å—ä¿¡</font></u></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€</font><i><font style="vertical-align: inherit;">$ URL_get</font></i><font style="vertical-align: inherit;">ã¸ã®å‘¼ã³å‡ºã—ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL_get</span></code></pre><br>
<code> ok result<br>
 -- ------<br>
True {} </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚ªããªã„ã€‚</font><font style="vertical-align: inherit;">ãƒœãƒƒãƒˆã«ä½•ã‹ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ub/kn/jd/ubknjd-kciskp6cvbjd9ejj9umm.jpeg" alt="ã“ã‚“ã«ã¡ã¯"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦èª­ã‚“ã§ãã ã•ã„ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span> <font></font>
<font></font>
<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL_get</span> </code></pre><br>
<br>
<code>ok result <br>
 -- ------ <br>
True {@{update_id=635172027; message=}, @{update_id=635172028; message=}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚‚ã¡ã‚ã‚“ã€æˆ‘ã€…ã¯çµæœãŒå¿…è¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æœ€å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã®ã¿é–¢å¿ƒãŒã‚ã‚‹ã¨ã™ãã«è¨€ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã®ã§ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL_get</span><font></font>
<font></font>
<span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-variable">$data</span>.update_id 
<span class="hljs-variable">$data</span>.message.chat.id
<span class="hljs-variable">$data</span>.message.text
<span class="hljs-variable">$data</span>.message.chat.first_name
<span class="hljs-variable">$data</span>.message.chat.last_name
<span class="hljs-variable">$data</span>.message.chat.type
<span class="hljs-variable">$data</span>.message.chat.username </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUpdates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰</font><font style="vertical-align: inherit;">ã®</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—</font><font style="vertical-align: inherit;">ã¦ã€ã™ã¹ã¦åŒã˜ã‚ˆã†ã«è¡Œã‚ã‚Œ</font><font style="vertical-align: inherit;">ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€æœªç¢ºèªã®æœ€ã‚‚å¤ã„ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‹ã‚‰å§‹ã¾ã‚‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒè¿”ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">updateUpdatesãŒãã®update_idã‚ˆã‚Šé«˜ã„ã‚ªãƒ•ã‚»ãƒƒãƒˆã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã™ãã«ã€æ›´æ–°ã¯ç¢ºèªã•ã‚ŒãŸã¨è¦‹ãªã•ã‚Œã¾ã™</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡Œã†</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL_get</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ã™ã¹ã¦ã‚’1ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§ã‚µã‚¤ã‚¯ãƒ«ã«æŠ•å…¥ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL_get</span><font></font>
<font></font>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-variable">$data</span>.update_id
    <span class="hljs-variable">$data</span>.message.chat.id
    <span class="hljs-variable">$data</span>.message.text
    <span class="hljs-variable">$data</span>.message.chat.first_name
    <span class="hljs-variable">$data</span>.message.chat.last_name
    <span class="hljs-variable">$data</span>.message.chat.type
    <span class="hljs-variable">$data</span>.message.chat.username<font></font>
<font></font>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL_get</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>    
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿ä¸Šã’æ©Ÿèƒ½ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">ãªãœãªã‚‰ </font><font style="vertical-align: inherit;">é–¢æ•°ã‹ã‚‰ã„ãã¤ã‹ã®å€¤ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™-HashTableï¼ˆåå‰ä»˜ã/é€£æƒ³é…åˆ—ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span><span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-comment">#$data.update_id</span>
    <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
    <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
    <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
    <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
<font></font>
    <span class="hljs-comment">#   text </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$text</span>)<font></font>
    {<font></font>
        <span class="hljs-comment"># confirm</span>
        <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
<font></font>
        <span class="hljs-comment"># HashTable</span>
        <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-comment">#   </span>
    getUpdates <span class="hljs-variable">$URL_get</span><font></font>
<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>    
} </code></pre><br>
</div></div><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ†ãƒƒãƒ—2-ãƒ‡ãƒ¼ã‚¿ã®</font></font></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã«ã¯ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sendMessage</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ã‚½ãƒƒãƒ‰</font><font style="vertical-align: inherit;">ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chat_id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã‚ˆã³</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">text</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</font><font style="vertical-align: inherit;">ãŒå¿…è¦ã§ã™ï¼ˆæ®‹ã‚Šã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://core.telegram.org/bots/api#sendmessageã§ã™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–¢æ•°ã‚’ã™ãã«è¨˜éŒ²ã™ã‚‹</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span>    
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Šå‘¼ã³å‡ºã™ã“ã¨ã«ã‚ˆã£ã¦</font></font><br>
<br>
<pre><code class="powershell hljs">sendMessage <span class="hljs-variable">$URL_set</span> &lt;__id&gt; <span class="hljs-string">"123"</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚«ãƒ¼ãƒˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ†ãƒƒãƒ—3-ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹</font></font></u><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä»¥ä¸‹ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡ã™ã‚‹ãŸã‚ã®ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-comment">#$data.update_id</span>
    <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
    <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
    <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
    <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
<font></font>
    <span class="hljs-comment">#   text </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$text</span>)<font></font>
    {<font></font>
        <span class="hljs-comment"># confirm</span>
        <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
<font></font>
        <span class="hljs-comment"># HashTable</span>
        <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span>   <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>)<font></font>
    {<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id (<span class="hljs-built_in">Get-Random</span>(<span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>))<font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>
} </code></pre><br>
</div></div><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ return.text</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã€ãŸã¨ãˆã°</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switchã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã«</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åŸºã¥ã„ã¦ã€ã•ã‚‰ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ§‹ç¯‰ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<pre><code class="powershell hljs"><span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
{<font></font>
    <span class="hljs-string">"**"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">", <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>["</span>f_name<span class="hljs-string">"])"</span> }
    <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
    default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
} </code></pre> <br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµµæ–‡å­—ï¼š</font></font></b><div class="spoiler_text">  Get-Random  emoji,          ,  PS   <br>
<img src="https://habrastorage.org/webt/ra/r6/4g/rar64gloyqqnimwf7m3lds23hs0.jpeg" alt="Get-Random"><br>
</div></div> <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ2ï¼šãƒœã‚¿ãƒ³ãŒå¿…è¦</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é›»å ±ãƒœãƒƒãƒˆã«ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã®ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ï¼ˆã“ã®ã‚¢ã‚¤ã‚³ãƒ³ã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</font></font><img src="https://habrastorage.org/webt/ug/5v/bz/ug5vbz4hhz5cajcrg4auifrhw2y.jpeg" alt="ã‚¢ã‚¤ã‚³ãƒ³"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆã¯ãã‚Œã‚’è¡Œã„ã¾ã—ãŸâ€”ã‚³ãƒãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆãŒã‚ã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯ã‚µãƒ¼ãƒ“ã‚¹ã®åå‰ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦æ¸¡ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã•ã‚‰ã«ç§»å‹•ã—ã€ãƒœã‚¿ãƒ³æ©Ÿèƒ½ã‚’æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚</font><i><font style="vertical-align: inherit;">reply_markup</font></i><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã—ã¦</font><i><font style="vertical-align: inherit;">sendMessage</font></i><font style="vertical-align: inherit;">ã‚’</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‘¼ã³å‡ºã—</font><font style="vertical-align: inherit;">ã¾ã™</font><i><font style="vertical-align: inherit;">ã€‚</font></i><font style="vertical-align: inherit;"> 
ã“ã®æ©Ÿèƒ½ã§ã¯ã€</font><i><font style="vertical-align: inherit;">InlineKeyboardMarkup</font></i><font style="vertical-align: inherit;">ã‚¿ã‚¤ãƒ—</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">https://core.telegram.org/bots/api#inlinekeyboardmarkup</font></a><font style="vertical-align: inherit;">ã‚’ä½¿ç”¨ã—</font><i><font style="vertical-align: inherit;">ã¾ã—ãŸ</font></i><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
èª¬æ˜ã‹ã‚‰ã€</font><i><font style="vertical-align: inherit;">inline_keyboard</font></i><font style="vertical-align: inherit;">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</font><font style="vertical-align: inherit;">ã¯ãƒœã‚¿ãƒ³ã®é…åˆ—ã®é…åˆ—ã§ã‚ã‚‹</font><font style="vertical-align: inherit;">ã“ã¨ãŒ</font><i><font style="vertical-align: inherit;">ã‚ã‹ã‚Š</font></i><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆInlineKeyboardButtonã®é…åˆ—ã®é…åˆ—ï¼‰</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ†ã‚¹ãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment">#   callback_data  ,    </span>
<span class="hljs-variable">$button1</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test1"</span>; callback_data = <span class="hljs-string">"Test1_CD"</span>}
<span class="hljs-variable">$button2</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test2"</span>; callback_data = <span class="hljs-string">"Test2_CD"</span>}<font></font>
<font></font>
<span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$button1</span>, <span class="hljs-variable">$button2</span>))}<font></font>
<font></font>
<span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
    parse_mode = <span class="hljs-string">"Markdown"</span>
    reply_markup = <span class="hljs-variable">$keyboard</span>
    chat_id = ******** <span class="hljs-comment">#     Telegram ID</span>
    text = <span class="hljs-string">"Test Text"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL_set</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¨ãƒ©ãƒ¼ï¼š</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-RestMethodï¼š{"ok"ï¼šfalseã€ "error_code"ï¼š400ã€ "description"ï¼š "Bad Requestï¼šfield \" inline_keyboard \ "of of the InlineKeyboardMarkup be be a Array of Arrays"} </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡Œï¼š21æ–‡å­—ï¼š1 </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">$ json</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¤‰æ•°ã®å†…å®¹ã®ç¢ºèª</font><font style="vertical-align: inherit;">
ï¼šå‡ºåŠ›ï¼š</font></font><i><font style="vertical-align: inherit;"></font></i> <br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-attr">"reply_markup"</span>:  {
                         <span class="hljs-attr">"inline_keyboard"</span>:  [
                                                 <span class="hljs-string">"System.Collections.Hashtable System.Collections.Hashtable"</span><font></font>
                                             ]<font></font>
                     },<font></font>
    <span class="hljs-attr">"chat_id"</span>:  **********,
    <span class="hljs-attr">"text"</span>:  <span class="hljs-string">"Test Text"</span>,
    <span class="hljs-attr">"parse_mode"</span>:  <span class="hljs-string">"Markdown"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã©ã†ã‚„ã‚‰ãã‚Œã¯ã€ãƒ†ãƒ¬ã‚°ãƒ©ãƒ APIã®HashTableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ "System.Collections.Hashtable System.Collections.Hashtable"ï¼‰ã‚’ã‚ã¾ã‚Šæ¸¡ã—ã¦ã„ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">å°‘ã—ã‚°ãƒ¼ã‚°ãƒ«ã¨ç´”åˆ©ç›Š-Jsonã«å¤‰æ›ã™ã‚‹ã¨ãã€å¤‰æ›æ·±åº¦ã‚’è¨­å®šã—ã¾ã™</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment">#   callback_data  ,    </span>
<span class="hljs-variable">$button1</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test1"</span>; callback_data = <span class="hljs-string">"Test1_CD"</span>}
<span class="hljs-variable">$button2</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test2"</span>; callback_data = <span class="hljs-string">"Test2_CD"</span>}<font></font>
<font></font>
<span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$button1</span>, <span class="hljs-variable">$button2</span>))}<font></font>
<font></font>
<span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
    parse_mode = <span class="hljs-string">"Markdown"</span>
    reply_markup = <span class="hljs-variable">$keyboard</span><font></font>
    chat_id = ********<font></font>
    text = <span class="hljs-string">"Test Text"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL_set</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒœã‚¿ãƒ³ã‚’</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wf/8x/e7/wf8xe7gkgmydxrbyftj_fph58fo.jpeg" alt="ãƒœã‚¿ãƒ³"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å–å¾—ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ãƒœã‚¿ãƒ³</font><font style="vertical-align: inherit;">ã‚’é€ä¿¡ã™ã‚‹æ©Ÿèƒ½ã‚’ä½œæˆã—ã€ãƒœã‚¿ãƒ³ã®é…åˆ—ã‚’å…¥åŠ›ã«é€ä¿¡ã—ã¾ã™</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment">#   callback_data  ,    </span>
<span class="hljs-variable">$button1</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test1"</span>; callback_data = <span class="hljs-string">"Test1_CD"</span>}
<span class="hljs-variable">$button2</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Test2"</span>; callback_data = <span class="hljs-string">"Test2_CD"</span>}
<span class="hljs-variable">$buttons</span> = (<span class="hljs-variable">$button1</span>, <span class="hljs-variable">$button2</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-variable">$buttons</span>)}
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span><font></font>
        chat_id = ********<font></font>
        text = <span class="hljs-string">"Test Text"</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL_set</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> </code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¤ãƒƒãƒãƒ–ãƒ­ãƒƒã‚¯ã‚’å°‘ã—å¤‰æ›´ã—ã¦ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-comment">#$data.update_id</span>
    <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
    <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
    <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
    <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
<font></font>
    <span class="hljs-comment">#   text </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$text</span>)<font></font>
    {<font></font>
        <span class="hljs-comment"># confirm</span>
        <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
<font></font>
        <span class="hljs-comment"># HashTable</span>
        <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
        <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
    }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span>   <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-variable">$buttons</span>)}
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>)<font></font>
    {<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
        <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>["</span>chat_id<span class="hljs-string">"])"</span>
        <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
        {<font></font>
            <span class="hljs-string">"**"</span> {
                <span class="hljs-variable">$button1</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Project1"</span>; callback_data = <span class="hljs-string">"Project1_CD"</span>}
                <span class="hljs-variable">$button2</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Project2"</span>; callback_data = <span class="hljs-string">"Project2_CD"</span>}
                <span class="hljs-variable">$buttons</span> = (<span class="hljs-variable">$button1</span>, <span class="hljs-variable">$button2</span>)
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available projects:"</span>
                <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
            }<font></font>
            <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
            default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
        } <font></font>
 <font></font>
<font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>
}</code></pre> <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Šåº¦ã¯ã€ã€Œã“ã‚“ã«ã¡ã¯ã€ãƒœãƒƒãƒˆã‹ã‚‰ã„ãã¤ã‹ã®ãƒœã‚¿ãƒ³ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç¾åœ¨ã®psé–¢æ•°getUpdatesã¯ã€</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$text</span>)...</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€ãƒ†ã‚­ã‚¹ãƒˆã¯è¿”ã•ã‚Œãªã„ãŸã‚ã€é–¢æ•°ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/cb/la/mkcblawc0-d6uppcfqnkvgzrabo.jpeg" alt="ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¦</font><i><font style="vertical-align: inherit;">$ãƒ‡ãƒ¼ã‚¿ã®</font></i><font style="vertical-align: inherit;">å†…å®¹ã‚’ç¢ºèªã—</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font></i><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-variable">$data</span>
<span class="hljs-comment">&lt;#
    $chat_id = $data.message.chat.id
    $text = $data.message.text
    $f_name = $data.message.chat.first_name
    $l_name = $data.message.chat.last_name
    $type = $data.message.chat.type
    $username = $data.message.chat.username

    #   text 
    if($text)
    {
        # confirm
        Invoke-RestMethod "$($URL)?offset=$($($data.update_id)+1)" -Method Get | Out-Null

        # HashTable
        $ht = @{}
        $ht["chat_id"] = $chat_id
        $ht["text"] = $text
        $ht["f_name"] = $f_name
        $ht["l_name"] = $l_name
        $ht["username"] = $username
        return $ht
    }
#&gt;</span><font></font>
}<font></font>
<font></font>
getUpdates <span class="hljs-variable">$URL_get</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚‚ã†å±Šãã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ä»£ã‚ã‚Šã«ã€ç¾åœ¨ã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callback_query</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font><font style="vertical-align: inherit;">ç·¨é›†æ©Ÿèƒ½</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
getUpdates <span class="hljs-variable">$URL_get</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹å ´åˆ</font><font style="vertical-align: inherit;">
ã€é–¢æ•°ã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ã‚­ã‚¹ãƒˆã‚’</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸå ´åˆã¯ã€</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callback_dataã‚’</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ†ã‚¹ãƒˆã®æ®µéšã§ã€æ¬¡ã®å‘¼ã³å‡ºã—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<pre><code class="powershell hljs">sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id) <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èµ·å‹•-RestMethodï¼š{ã€ŒOKã€ï¼šå½ã€ã€ŒERROR_CODEã€ï¼š400ã€ã€Œèª¬æ˜ã€ï¼šã€Œä¸æ­£ãªè¦æ±‚ã¯ï¼šè§£æã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€ãƒã‚¤ãƒˆã§å§‹ã¾ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®çµ‚ã‚ã‚Šã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ãŒ8ã‚ªãƒ•ã‚»ãƒƒãƒˆã€}</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã®ã§</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parse_modeãŒã‚ã‚‹</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚»ãƒƒãƒˆã§</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Markdownã‚’</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡ã—ã¾ã™</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$return</span>.callback_data = â€œProject1_CDâ€</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€ä¿¡ã™ã‚‹å‰ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">//core.telegram.org/bots/api#formatting-options</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã¾ãŸã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã€Œ_ã€ã‚’å‰Šé™¤ã—ã¦</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ãã ã•ã„</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs"><span class="hljs-comment"># Token</span>
<span class="hljs-variable">$token</span> = <span class="hljs-string">"***********************"</span>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-comment"># timeout sec</span>
<span class="hljs-variable">$timeout</span> = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span><font></font>
<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
    <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$null</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span>   <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-variable">$buttons</span>)}
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span>
    <span class="hljs-comment">#$return</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
    {<font></font>
<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
        <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>["</span>chat_id<span class="hljs-string">"])"</span>
        <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
        {<font></font>
            <span class="hljs-string">"**"</span> {
                <span class="hljs-variable">$button1</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Project1"</span>; callback_data = <span class="hljs-string">"Project1CD"</span>}
                <span class="hljs-variable">$button2</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-string">"Project2"</span>; callback_data = <span class="hljs-string">"Project2CD"</span>}
                <span class="hljs-variable">$buttons</span> = (<span class="hljs-variable">$button1</span>, <span class="hljs-variable">$button2</span>)
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available projects:"</span>
                <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
            }<font></font>
            <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
            default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
        }  <font></font>
<font></font>
    }<font></font>
    <span class="hljs-comment">#     </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    {<font></font>
        sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id) <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span><font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ3ï¼šæ§‹æˆã‚’è¡Œã†</font></font></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã‚’æ§‹æˆã«å…¥ã‚Œã‚‹æ™‚ãŒæ¥ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã“ã§ã¯ã™ã¹ã¦ãŒå˜ç´”ã§ã™-xmlã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">config</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">token</span>&gt;</span>***********************<span class="hljs-tag">&lt;/<span class="hljs-name">token</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">timeout</span> <span class="hljs-attr">desc</span>=<span class="hljs-string">"bot check timeout in seconds"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">system</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">tasks</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">" "</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"c:\Temp\Habr\reboot_all.ps1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">" "</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"c:\Temp\Habr\status.ps1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ipconfig1"</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"ipconfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ipconfig2"</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"ipconfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ipconfig3"</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"ipconfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ipconfig4"</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"ipconfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">task</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ipconfig5"</span> <span class="hljs-attr">script</span>=<span class="hljs-string">"ipconfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">tasks</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¿ã‚¹ã‚¯ã«ã¤ã„ã¦èª¬æ˜ã—ã€å„ã‚¿ã‚¹ã‚¯ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŸã¡ã¯ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-built_in">xml</span>]<span class="hljs-variable">$xmlConfig</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> (<span class="hljs-string">"c:\Temp\Habr\telegram_bot.xml"</span>)
<span class="hljs-variable">$token</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.token
<span class="hljs-variable">$timeout</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.timeout.<span class="hljs-string">'#text'</span><font></font>
<font></font>
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
{<font></font>
    <span class="hljs-variable">$task</span>.name   <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$task</span>.script <span class="hljs-comment"># </span>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«é…ç½®ã™ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs">[<span class="hljs-built_in">xml</span>]<span class="hljs-variable">$xmlConfig</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> (<span class="hljs-string">"c:\Temp\Habr\telegram_bot.xml"</span>)
<span class="hljs-variable">$token</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.token
<span class="hljs-variable">$timeout</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.timeout.<span class="hljs-string">'#text'</span><font></font>
<font></font>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
    <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$null</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span>   <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">"inline_keyboard"</span> = <span class="hljs-selector-tag">@</span>(,<span class="hljs-variable">$buttons</span>)}
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
    {<font></font>
<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
        <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>["</span>chat_id<span class="hljs-string">"])"</span>
        <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
        {<font></font>
            <span class="hljs-string">"**"</span> {<font></font>
<font></font>
                <span class="hljs-comment">#  </span>
                <span class="hljs-variable">$buttons</span> = <span class="hljs-selector-tag">@</span>()
                <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
                {<font></font>
                    <span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}
                    <span class="hljs-variable">$buttons</span> += <span class="hljs-variable">$button</span><font></font>
                }<font></font>
                <font></font>
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
                <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
            }<font></font>
            <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
            default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
        } <font></font>
 <font></font>
<font></font>
    }<font></font>
    <span class="hljs-comment">#     </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    {<font></font>
        sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id) <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã€Œhelloã€ã¨æ›¸ãã¨ã€ãƒœãƒƒãƒˆã¯xmlãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã«å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">callback_dataã«ã‚³ãƒãƒ³ãƒ‰ã¾ãŸã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡¨é¢çš„ãªå¤‰æ›´ã‚’è¡Œã†å ´åˆã¯ã€1è¡Œã‚ãŸã‚Š3ã€œ4å€‹ã®ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚ãã†ã§ãªã„å ´åˆã€ãƒœã‚¿ãƒ³ã¯å®Œå…¨ã«è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/ou/e_/qooue_7hsolqk_36nwxicfs_kt0.jpeg" alt="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã€‚1è¡Œã‚ãŸã‚Š3ã¤ã®ãƒœã‚¿ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ˆæœ€å¤§ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¦‚ç•¥çš„ã«ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰é…åˆ—ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/sf/el/gcsfelyplaffrofxzcjtpyovtuw.jpeg" alt="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒœã‚¿ãƒ³[i]-ãƒ•ã‚©ãƒ¼ãƒ ã®é…åˆ—ï¼ˆé€£æƒ³ï¼‰</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¡Œ[1-3]ã¯ã€ãƒœã‚¿ãƒ³ã®é…åˆ—ã‚’æ ¼ç´ã™ã‚‹ï¼ˆãƒœã‚¿ãƒ³ã‹ã‚‰ã®ï¼‰é…åˆ—ã§ã™ï¼ˆã“ã‚Œã¯é‡è¦ã§ã™ï¼‰ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¯Line'ovã®é…åˆ—ã§ã™ã€‚</font><i><font style="vertical-align: inherit;">sendKeyboard</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
é–¢æ•°ã‚’å¤‰æ›´ã™ã‚‹</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="powershell hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{    <font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-comment">#    ArrayList, .       -  </span>
    <span class="hljs-variable">$lines</span> = <span class="hljs-number">3</span> <font></font>
    <font></font>
    <span class="hljs-variable">$buttons_line</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buttons</span>.Count; <span class="hljs-variable">$i</span>++)<font></font>
    {<font></font>
        <span class="hljs-comment">#     (line).    3 -  line  keyboard</span>
        <span class="hljs-variable">$buttons_line</span>.Add(<span class="hljs-variable">$buttons</span>[<span class="hljs-variable">$i</span>]) | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-comment">#   -      0</span>
        <span class="hljs-keyword">if</span>( (<span class="hljs-variable">$i</span> + <span class="hljs-number">1</span> )%<span class="hljs-variable">$lines</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span> )<font></font>
        {<font></font>
            <span class="hljs-comment">#     keyboard</span>
            <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))
            <span class="hljs-variable">$buttons_line</span>.Clear()<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-comment">#    </span>
    <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))    <font></font>
    <font></font>
    <span class="hljs-comment">#$keyboard = @{"inline_keyboard" = @(,$buttons)}</span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span>    <font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŸã¡ã¯ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/de/bm/cu/debmcuonvv9pedmpe0s6pfcik-y.jpeg" alt="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰_ãƒ†ãƒ¬ã‚°ãƒ©ãƒ "><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs">[<span class="hljs-built_in">xml</span>]<span class="hljs-variable">$xmlConfig</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> (<span class="hljs-string">"c:\Temp\Habr\telegram_bot.xml"</span>)
<span class="hljs-variable">$token</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.token
<span class="hljs-variable">$timeout</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.timeout.<span class="hljs-string">'#text'</span><font></font>
<font></font>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
    <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$null</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span>   <font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-comment">#    ArrayList, .       -  </span>
	<span class="hljs-variable">$lines</span> = <span class="hljs-number">3</span> <font></font>
<font></font>
    <span class="hljs-variable">$buttons_line</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buttons</span>.Count; <span class="hljs-variable">$i</span>++)<font></font>
    {<font></font>
        <span class="hljs-comment">#     (line).    3 -  line  keyboard</span>
        <span class="hljs-variable">$buttons_line</span>.Add(<span class="hljs-variable">$buttons</span>[<span class="hljs-variable">$i</span>]) | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-comment">#   -      0</span>
        <span class="hljs-keyword">if</span>( (<span class="hljs-variable">$i</span> + <span class="hljs-number">1</span> )%<span class="hljs-variable">$lines</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span> )<font></font>
        {<font></font>
            <span class="hljs-comment">#     keyboard</span>
            <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))
            <span class="hljs-variable">$buttons_line</span>.Clear()<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-comment">#    </span>
    <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span>
    <span class="hljs-comment">#$return.text = ""</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
    {<font></font>
<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
        <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
        {<font></font>
            <span class="hljs-string">"**"</span> {<font></font>
<font></font>
                <span class="hljs-comment">#  </span>
                <span class="hljs-variable">$buttons</span> = <span class="hljs-selector-tag">@</span>()
                <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
                {<font></font>
                    <span class="hljs-variable">$i</span>++
                    <span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}
                    <span class="hljs-variable">$buttons</span> += <span class="hljs-variable">$button</span><font></font>
                }<font></font>
                <font></font>
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
                <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
            }<font></font>
            <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
            default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
        } <font></font>
 <font></font>
<font></font>
    }<font></font>
    <span class="hljs-comment">#     </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    {<font></font>
        <span class="hljs-comment">#sendMessage $URL_set $($return.chat_id) $($return.callback_data)</span>
        <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id) <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)"</span><font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span><font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ4ï¼šã‚¿ã‚¹ã‚¯ã¨ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒœã‚¿ãƒ³ãŒå®Ÿè¡Œã™ã‚‹æ™‚é–“ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ã§ã¯ã€ã‚¸ãƒ§ãƒ–ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$script</span> = <span class="hljs-string">"ipconfig"</span>
<span class="hljs-variable">$script_block</span> = { <span class="hljs-keyword">Param</span>(<span class="hljs-variable">$script</span>) ; <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-variable">$script</span> }
<span class="hljs-variable">$job_name</span> = <span class="hljs-string">"TestJob"</span>
<span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> <span class="hljs-variable">$script_block</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$script</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$job_name</span> | <span class="hljs-built_in">Out-Null</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦5ç§’å¾Œã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚</font></font><br>
<pre><code class="powershell hljs">
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$job</span> <span class="hljs-keyword">in</span> (<span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Where</span> {<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-eq</span> <span class="hljs-string">"Completed"</span>} ))<font></font>
{<font></font>
    <span class="hljs-variable">$output</span> = <span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-ID</span> <span class="hljs-variable">$job</span>.Id | <span class="hljs-built_in">Receive-Job</span>
    <span class="hljs-variable">$output</span>
    <span class="hljs-variable">$job</span> | <span class="hljs-built_in">Remove-Job</span><font></font>
} <font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$å‡ºåŠ›</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯localhostã§ipconfigã‚’è¿”ã™ã¯ãšã§ã™</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®callback_dataãƒ–ãƒ­ãƒƒã‚¯ã«è¿½åŠ ã—ã¦ãã ã•ã„</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-comment">#     </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
    {<font></font>
        <span class="hljs-variable">$script</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)
        <span class="hljs-variable">$job_name</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id)<font></font>
<font></font>
        <span class="hljs-variable">$script_block</span> = { <span class="hljs-keyword">Param</span>(<span class="hljs-variable">$script</span>) ; <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-variable">$script</span> } <font></font>
<font></font>
        <span class="hljs-comment"># Job</span>
        <span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> <span class="hljs-variable">$script_block</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$script</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$job_name</span> | <span class="hljs-built_in">Out-Null</span>        <font></font>
<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã“ã‚Œã¯ä»¥ä¸‹ã§ã™</font></font><br>
<br>
<pre><code class="powershell hljs">
        <span class="hljs-comment"># ,  job'  </span>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$job</span> <span class="hljs-keyword">in</span> (<span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Where</span> {<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-eq</span> <span class="hljs-string">"Completed"</span>} ))<font></font>
        {<font></font>
            <font></font>
            <span class="hljs-variable">$output</span> = <span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-ID</span> <span class="hljs-variable">$job</span>.Id | <span class="hljs-built_in">Receive-Job</span><font></font>
      <font></font>
            <span class="hljs-comment">#   ,   job</span>
            sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$output</span><font></font>
<font></font>
            <span class="hljs-variable">$job</span> | <span class="hljs-built_in">Remove-Job</span><font></font>
<font></font>
            <span class="hljs-comment">#    </span>
            <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
            sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span>
        } </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒã‚§ãƒƒã‚¯ã€ã‚¨ãƒ©ãƒ¼ã®æ¤œå‡º</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-RestMethodï¼š{"ok"ï¼šfalseã€ "error_code"ï¼š400ã€ "description"ï¼š "Bad Requestï¼šmessage is too long"}</font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é•·ã•ãŒ4096æ–‡å­—ã‚’è¶…ãˆã‚‹ã“ã¨ã¯ã§ããªã„ã¨ã„ã†æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚ªãƒ¼ã‚±ãƒ¼...</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$output</span>.Length</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é•·ã•39ã¨è¨€ã„</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã™ã€‚ä½•ãŒæ‚ªã„ã®ã‹é•·ã„é–“è€ƒãˆãŸçµæœã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’è©¦ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$string</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$output</span>)<font></font>
{<font></font>
    <span class="hljs-variable">$text</span> = <span class="hljs-string">"<span class="hljs-variable">$text</span>`n<span class="hljs-variable">$string</span>"</span><font></font>
} <font></font>
sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span> </code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ãŸã¡ã¯ã™ã¹ã¦ã‚’ä¸€ç·’ã«è©¦ã—ã¾ã™</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs">[<span class="hljs-built_in">xml</span>]<span class="hljs-variable">$xmlConfig</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> (<span class="hljs-string">"c:\Temp\Habr\telegram_bot.xml"</span>)
<span class="hljs-variable">$token</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.token
<span class="hljs-variable">$timeout</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.timeout.<span class="hljs-string">'#text'</span><font></font>
<font></font>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
    <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$null</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$lines</span> = <span class="hljs-number">3</span>
    <span class="hljs-comment">#    ArrayList, .       -  </span>
    <span class="hljs-variable">$buttons_line</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buttons</span>.Count; <span class="hljs-variable">$i</span>++)<font></font>
    {<font></font>
        <span class="hljs-comment">#     (line).    3 -  line  keyboard</span>
        <span class="hljs-variable">$buttons_line</span>.Add(<span class="hljs-variable">$buttons</span>[<span class="hljs-variable">$i</span>]) | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-comment">#   -      0</span>
        <span class="hljs-keyword">if</span>( (<span class="hljs-variable">$i</span> + <span class="hljs-number">1</span> )%<span class="hljs-variable">$lines</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span> )<font></font>
        {<font></font>
            <span class="hljs-comment">#     keyboard</span>
            <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))
            <span class="hljs-variable">$buttons_line</span>.Clear()<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-comment">#    </span>
    <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span>
    <span class="hljs-comment">#$return.text = ""</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
    {<font></font>
<font></font>
        <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
        <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
        <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
        {<font></font>
            <span class="hljs-string">"**"</span> {<font></font>
<font></font>
                <span class="hljs-comment">#  </span>
                <span class="hljs-variable">$buttons</span> = <span class="hljs-selector-tag">@</span>()
                <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
                {<font></font>
                    <span class="hljs-variable">$i</span>++
                    <span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}
                    <span class="hljs-variable">$buttons</span> += <span class="hljs-variable">$button</span><font></font>
                }<font></font>
                <font></font>
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
                <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
            }<font></font>
            <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
            default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
        } <font></font>
 <font></font>
<font></font>
    }<font></font>
         <span class="hljs-comment">#     </span>
        <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
        {<font></font>
            <span class="hljs-variable">$script</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)
            <span class="hljs-variable">$job_name</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id)
            <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$script</span> <span class="hljs-variable">$job_name</span>"</span><font></font>
<font></font>
            <span class="hljs-variable">$script_block</span> = { <span class="hljs-keyword">Param</span>(<span class="hljs-variable">$script</span>) ; <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-variable">$script</span> }<font></font>
<font></font>
            <span class="hljs-comment"># Job</span>
            <span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> <span class="hljs-variable">$script_block</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$script</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$job_name</span> | <span class="hljs-built_in">Out-Null</span><font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment"># ,  job'  </span>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$job</span> <span class="hljs-keyword">in</span> (<span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Where</span> {<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-eq</span> <span class="hljs-string">"Completed"</span>} ))<font></font>
        {<font></font>
            <font></font>
            <span class="hljs-variable">$output</span> = <span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-ID</span> <span class="hljs-variable">$job</span>.Id | <span class="hljs-built_in">Receive-Job</span><font></font>
      <font></font>
            <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
            <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$string</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$output</span>)<font></font>
            {<font></font>
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"<span class="hljs-variable">$text</span>`n<span class="hljs-variable">$string</span>"</span><font></font>
            }<font></font>
            <span class="hljs-comment">#   ,   job</span>
            sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span><font></font>
<font></font>
            <span class="hljs-variable">$job</span> | <span class="hljs-built_in">Remove-Job</span><font></font>
<font></font>
            <span class="hljs-comment">#    </span>
            <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
            sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span><font></font>
        } <font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span><font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<img src="https://habrastorage.org/webt/uc/0j/tj/uc0jtjsbxbvszrfqikmiebepq3m.jpeg" alt="å‡ºåŠ›"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€å°‘ã—ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’</font><font style="vertical-align: inherit;">èª¿æ•´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚xmlæ§‹æˆã«</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°ã—ã„è¡Œã‚’è¿½åŠ ã—ã€ãã‚Œã‚’</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font><font style="vertical-align: inherit;">å‘¼ã³</font><font style="vertical-align: inherit;">ã€ãƒœãƒƒãƒˆã¨é€šä¿¡ã§ãã‚‹äººã®chat_idã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="xml hljs">	<span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">token</span>&gt;</span>*********************************<span class="hljs-tag">&lt;/<span class="hljs-name">token</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">timeout</span> <span class="hljs-attr">desc</span>=<span class="hljs-string">"bot check timeout in seconds"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span>111111111, 222222222<span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">system</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€</font><i><font style="vertical-align: inherit;">users</font></i><font style="vertical-align: inherit;">é…åˆ—ã‚’å–å¾—ã—</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font></i><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$users</span> = ((<span class="hljs-variable">$xmlConfig</span>.config.system.users).Split(<span class="hljs-string">","</span>)).Trim() </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ãƒã‚§ãƒƒã‚¯</font></font><br>
<br>
<pre><code class="powershell hljs">     <span class="hljs-keyword">if</span>(<span class="hljs-variable">$users</span> <span class="hljs-operator">-contains</span> <span class="hljs-variable">$return</span>.chat_id)<font></font>
    { <font></font>
...<font></font>
    }</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“</font></font></b><div class="spoiler_text"><pre><code class="powershell hljs">[<span class="hljs-built_in">xml</span>]<span class="hljs-variable">$xmlConfig</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> (<span class="hljs-string">"c:\Temp\Habr\telegram_bot.xml"</span>)
<span class="hljs-variable">$token</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.token
<span class="hljs-variable">$timeout</span> = <span class="hljs-variable">$xmlConfig</span>.config.system.timeout.<span class="hljs-string">'#text'</span>
<span class="hljs-variable">$users</span> = ((<span class="hljs-variable">$xmlConfig</span>.config.system.users).Split(<span class="hljs-string">","</span>)).Trim()<font></font>
<font></font>
<span class="hljs-comment"># Telegram URLs</span>
<span class="hljs-variable">$URL_get</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/getUpdates"</span>
<span class="hljs-variable">$URL_set</span> = <span class="hljs-string">"https://api.telegram.org/bot<span class="hljs-variable">$token</span>/sendMessage"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUpdates</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$URL</span>
    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$json</span>.result | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Last</span> <span class="hljs-number">1</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
    <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$null</span><font></font>
<font></font>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>.callback_query)<font></font>
    {  <font></font>
        <span class="hljs-variable">$callback_data</span> = <span class="hljs-variable">$data</span>.callback_query.data
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.callback_query.from.id
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.callback_query.from.last_name
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.callback_query.from.username<font></font>
    }<font></font>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$data</span>.message)<font></font>
    {<font></font>
        <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$data</span>.message.chat.id
        <span class="hljs-variable">$text</span> = <span class="hljs-variable">$data</span>.message.text
        <span class="hljs-variable">$f_name</span> = <span class="hljs-variable">$data</span>.message.chat.first_name
        <span class="hljs-variable">$l_name</span> = <span class="hljs-variable">$data</span>.message.chat.last_name
        <span class="hljs-variable">$type</span> = <span class="hljs-variable">$data</span>.message.chat.type
        <span class="hljs-variable">$username</span> = <span class="hljs-variable">$data</span>.message.chat.username<font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"chat_id"</span>] = <span class="hljs-variable">$chat_id</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"text"</span>] = <span class="hljs-variable">$text</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"f_name"</span>] = <span class="hljs-variable">$f_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"l_name"</span>] = <span class="hljs-variable">$l_name</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$username</span>
    <span class="hljs-variable">$ht</span>[<span class="hljs-string">"callback_data"</span>] = <span class="hljs-variable">$callback_data</span>
    <span class="hljs-comment"># confirm</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$URL</span>)?offset=<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$data</span>.update_id)+1)"</span> <span class="hljs-literal">-Method</span> Get | <span class="hljs-built_in">Out-Null</span><font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$ht</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  HashTable,      </span>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{<font></font>
        text = <span class="hljs-variable">$text</span>
        <span class="hljs-comment">#    Markdown</span>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        chat_id = <span class="hljs-variable">$chat_id</span><font></font>
    }<font></font>
    <span class="hljs-comment">#      json</span>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span>
    <span class="hljs-comment">#   Invoke-RestMethod,        Invoke-WebRequest</span>
    <span class="hljs-comment"># Method Post - ..  ,   Get</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span> | <span class="hljs-built_in">Out-Null</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendKeyboard</span><span class="hljs-params">(<span class="hljs-variable">$URL</span>, <span class="hljs-variable">$buttons</span>, <span class="hljs-variable">$chat_id</span>, <span class="hljs-variable">$text</span>)</span></span><font></font>
{<font></font>
    <font></font>
    <span class="hljs-variable">$keyboard</span> = <span class="hljs-selector-tag">@</span>{}
    <span class="hljs-variable">$lines</span> = <span class="hljs-number">3</span>
    <span class="hljs-comment">#    ArrayList, .       -  </span>
    <span class="hljs-variable">$buttons_line</span> = <span class="hljs-built_in">New-Object</span> System.Collections.ArrayList
    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buttons</span>.Count; <span class="hljs-variable">$i</span>++)<font></font>
    {<font></font>
        <span class="hljs-comment">#     (line).    3 -  line  keyboard</span>
        <span class="hljs-variable">$buttons_line</span>.Add(<span class="hljs-variable">$buttons</span>[<span class="hljs-variable">$i</span>]) | <span class="hljs-built_in">Out-Null</span>
        <span class="hljs-comment">#   -      0</span>
        <span class="hljs-keyword">if</span>( (<span class="hljs-variable">$i</span> + <span class="hljs-number">1</span> )%<span class="hljs-variable">$lines</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span> )<font></font>
        {<font></font>
            <span class="hljs-comment">#     keyboard</span>
            <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))
            <span class="hljs-variable">$buttons_line</span>.Clear()<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-comment">#    </span>
    <span class="hljs-variable">$keyboard</span>[<span class="hljs-string">"inline_keyboard"</span>] += <span class="hljs-selector-tag">@</span>(,<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$buttons_line</span>))<font></font>
<font></font>
    <span class="hljs-variable">$ht</span> = <span class="hljs-selector-tag">@</span>{ <font></font>
        parse_mode = <span class="hljs-string">"Markdown"</span>
        reply_markup = <span class="hljs-variable">$keyboard</span>
        chat_id = <span class="hljs-variable">$chat_id</span>
        text = <span class="hljs-variable">$text</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$json</span> = <span class="hljs-variable">$ht</span> | <span class="hljs-built_in">ConvertTo-Json</span> <span class="hljs-literal">-Depth</span> <span class="hljs-number">5</span>
    <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-variable">$URL</span> <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> <span class="hljs-string">'application/json; charset=utf-8'</span> <span class="hljs-literal">-Body</span> <span class="hljs-variable">$json</span><font></font>
    <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) <span class="hljs-comment">#  </span><font></font>
{<font></font>
    <span class="hljs-variable">$return</span> = getUpdates <span class="hljs-variable">$URL_get</span><font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$users</span> <span class="hljs-operator">-contains</span> <span class="hljs-variable">$return</span>.chat_id)<font></font>
    {<font></font>
<font></font>
        <span class="hljs-comment">#   </span>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
        {<font></font>
            <span class="hljs-comment">#write-host $return.chat_id</span>
            <span class="hljs-comment"># http://apps.timwhitlock.info/emoji/tables/unicode#block-1-emoticons</span>
            <span class="hljs-comment">#sendMessage $URL_set $return.chat_id (Get-Random("", "", "", ""))</span>
            <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
            {<font></font>
                <span class="hljs-string">"**"</span> {<font></font>
<font></font>
                    <span class="hljs-comment">#  </span>
                    <span class="hljs-variable">$buttons</span> = <span class="hljs-selector-tag">@</span>()
                    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
                    {<font></font>
                        <span class="hljs-variable">$i</span>++
                        <span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}
                        <span class="hljs-variable">$buttons</span> += <span class="hljs-variable">$button</span><font></font>
                    }<font></font>
                <font></font>
                    <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
                    <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                    sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                    <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
                }<font></font>
                <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }<font></font>
                default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
            } <font></font>
 <font></font>
<font></font>
        }<font></font>
        <span class="hljs-comment">#     </span>
        <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$return</span>.callback_data)<font></font>
        {<font></font>
            <span class="hljs-variable">$script</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.callback_data)
            <span class="hljs-variable">$job_name</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$return</span>.chat_id)
            <span class="hljs-built_in">write-host</span> <span class="hljs-string">"<span class="hljs-variable">$script</span> <span class="hljs-variable">$job_name</span>"</span><font></font>
<font></font>
            <span class="hljs-variable">$script_block</span> = { <span class="hljs-keyword">Param</span>(<span class="hljs-variable">$script</span>) ; <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-variable">$script</span> }<font></font>
<font></font>
            <span class="hljs-comment"># Job</span>
            <span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> <span class="hljs-variable">$script_block</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$script</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$job_name</span> | <span class="hljs-built_in">Out-Null</span><font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment"># ,  job'  </span>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$job</span> <span class="hljs-keyword">in</span> (<span class="hljs-built_in">Get-Job</span> | <span class="hljs-built_in">Where</span> {<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-eq</span> <span class="hljs-string">"Completed"</span>} ))<font></font>
        {<font></font>
            <font></font>
            <span class="hljs-variable">$output</span> = <span class="hljs-built_in">Get-Job</span> <span class="hljs-literal">-ID</span> <span class="hljs-variable">$job</span>.Id | <span class="hljs-built_in">Receive-Job</span><font></font>
      <font></font>
            <span class="hljs-variable">$text</span> = <span class="hljs-variable">$null</span>
            <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$string</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$output</span>)<font></font>
            {<font></font>
                <span class="hljs-variable">$text</span> = <span class="hljs-string">"<span class="hljs-variable">$text</span>`n<span class="hljs-variable">$string</span>"</span><font></font>
            }<font></font>
            <span class="hljs-comment">#   ,   job</span>
            sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span><font></font>
<font></font>
            <span class="hljs-variable">$job</span> | <span class="hljs-built_in">Remove-Job</span><font></font>
<font></font>
            <span class="hljs-comment">#    </span>
            <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
            sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$job</span>.Name <span class="hljs-variable">$text</span><font></font>
        }<font></font>
<font></font>
<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$return</span>.text)<font></font>
        {<font></font>
            sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"  ?    !"</span><font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-built_in">Start-Sleep</span> <span class="hljs-literal">-s</span> <span class="hljs-variable">$timeout</span>
}</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ãƒ¼ãƒˆ5ï¼šçµè«–</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒœãƒƒãƒˆã®æ©Ÿèƒ½ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™-ä½•ã‹ä¾¿åˆ©ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã—</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã™ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ã§ã®æ“ä½œã«ã¯ã€Invoke-Commandã«ç¶šã„ã¦Write-Outputã‚’ä½¿ç”¨ã—ã¾ã™</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$hostname</span> = <span class="hljs-string">"hostname"</span>
<span class="hljs-variable">$service</span> = <span class="hljs-string">"MSSQLSERVER"</span>
<span class="hljs-variable">$output</span> = <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> <span class="hljs-variable">$hostname</span> <span class="hljs-literal">-ScriptBlock</span>{<span class="hljs-keyword">param</span>(<span class="hljs-variable">$service</span>); (<span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$service</span>).Status} <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$service</span> 
<span class="hljs-built_in">write-output</span> <span class="hljs-variable">$output</span>.Value </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®å ´åˆã€ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ãƒœãƒƒãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã«å¯¾ã™ã‚‹é©åˆ‡ãªæ¨©é™ãŒå¿…è¦ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãŸã€ãƒ­ã‚®ãƒ³ã‚°æ©Ÿèƒ½ã«ã¯è§¦ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€ã“ã“ã§ã¯ã€ã™ã¹ã¦ãŒç°¡å˜ã§ã€æ€ã„ã®ã¾ã¾ã«ã€èª°ãŒãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã‹ã€ã—ãªã„ã‹ã¯è‡ªç”±ã«æ±ºå®šã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¢ºã‹ã«èª°ã‹ãŒ4096æ–‡å­—ã‚’è¶…ãˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å•é¡Œã‚’æŠ±ãˆã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯Substringã¨é€ä¿¡ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦è§£æ±ºã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦æœ€å¾Œã«-ä¸–ç•Œä¸­ã®ã©ã“ã‹ã‚‰ã§ã‚‚ï¼ˆã»ã¨ã‚“ã©ã©ã“ã‹ã‚‰ã§ã‚‚ï¼‰ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯è‰¯ã„ã§ã™ãŒã€ä½•ã‹ãŒã†ã¾ãã„ã‹ãªã„ã¨ã„ã†ãƒªã‚¹ã‚¯ãŒå¸¸ã«ã‚ã‚Šã¾ã™ï¼ˆæ‚ªã„äººãŒãƒœãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã€ç‰¹å®šã®å˜èªã«å¯¾ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰Exitã‚’è¿½åŠ ã—ã¾ã—ãŸ</font></font><br>
<br>
<pre><code class="powershell hljs">             <span class="hljs-keyword">switch</span> <span class="hljs-operator">-Wildcard</span> (<span class="hljs-variable">$return</span>[<span class="hljs-string">"text"</span>])<font></font>
            {<font></font>
                <span class="hljs-string">"**"</span> {<font></font>
<font></font>
                    <span class="hljs-comment">#  </span>
                    <span class="hljs-variable">$buttons</span> = <span class="hljs-selector-tag">@</span>()
                    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$task</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$xmlConfig</span>.config.tasks.task)<font></font>
                    {<font></font>
                        <span class="hljs-variable">$i</span>++
                        <span class="hljs-variable">$button</span> = <span class="hljs-selector-tag">@</span>{ <span class="hljs-string">"text"</span> = <span class="hljs-variable">$task</span>.name; callback_data = <span class="hljs-variable">$task</span>.script}
                        <span class="hljs-variable">$buttons</span> += <span class="hljs-variable">$button</span><font></font>
                    }<font></font>
                <font></font>
                    <span class="hljs-variable">$text</span> = <span class="hljs-string">"Available tasks:"</span>
                    <span class="hljs-variable">$chat_id</span> = <span class="hljs-variable">$return</span>.chat_id<font></font>
                    sendKeyboard <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$buttons</span> <span class="hljs-variable">$chat_id</span> <span class="hljs-variable">$text</span>
                    <span class="hljs-comment">#sendMessage $URL_set $return.chat_id ", $($return["f_name"])" </span><font></font>
                }<font></font>
                <span class="hljs-string">"* ?*"</span> { sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">""</span> }
                <span class="hljs-string">"!"</span> {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"bb"</span> ; <span class="hljs-keyword">Exit</span>}<font></font>
                default {sendMessage <span class="hljs-variable">$URL_set</span> <span class="hljs-variable">$return</span>.chat_id <span class="hljs-string">"<span class="hljs-variable">$</span>(Get-Random("</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">", "</span><span class="hljs-string">"))"</span>}<font></font>
            }  <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŒè¨€ã„ãŸã‹ã£ãŸã®ã¯ãã‚Œã ã‘ã§ã™ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja483648/index.html">ã‚¸ãƒ§ãƒ¼ã‚¸ã‚¢å·ã®ITãƒ“ã‚¸ãƒã‚¹ã®ã‚ªãƒ•ã‚·ãƒ§ã‚¢ï¼šãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯ã¨è½ã¨ã—ç©´</a></li>
<li><a href="../ja483650/index.html">èµ¤é“ã«è¿‘ã„ã‚³ã‚¹ãƒ¢ãƒ‰ãƒ­ãƒ¼ãƒ -ã‚¦ã‚§ãƒ³ãƒãƒ£ãƒ³ãƒˆãƒ­ãƒ”ã‚«ãƒ«ã‚³ã‚¹ãƒ¢ãƒ‰ãƒ­ãƒ¼ãƒ </a></li>
<li><a href="../ja483652/index.html">å¯èƒ½ã§ã‚ã‚Œã°ç§ã«å˜˜ã‚’ã¤ãï¼šç¤¾ä¼šæŠ€è¡“çš„ãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹æ©Ÿèƒ½</a></li>
<li><a href="../ja483654/index.html">é›†ä¼šã§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯1å¯¾1ã§ã€ãªãœã†ã¾ãã„ã‹ãªã„ã®ã‹ã€ã©ã†ã‚„ã£ã¦ãã‚Œã‚’ä¿®æ­£ã—ã‚ˆã†ã¨ã™ã‚‹ã®ã‹ï¼Ÿ</a></li>
<li><a href="../ja483656/index.html">å°å£²ã§ã®Tableauã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja483662/index.html">Cisco Threat Responseã¨Cisco Stealthwatch Enterpriseã®çµ±åˆ</a></li>
<li><a href="../ja483664/index.html">TensorFlowã®Kerasæ©Ÿèƒ½API</a></li>
<li><a href="../ja483666/index.html">Volodyaã¨ã‚ªã‚¾ãƒ³ç™ºç”Ÿå™¨ã«ã¤ã„ã¦</a></li>
<li><a href="../ja483668/index.html">å…ˆé€±ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸–ç•Œã‹ã‚‰ã®æ–°é®®ãªé£Ÿæã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆNo. 397ï¼ˆ2020å¹´1æœˆ6æ—¥ã€œ12æ—¥ï¼‰</a></li>
<li><a href="../ja483670/index.html">MACã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã™ã¹ã¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>