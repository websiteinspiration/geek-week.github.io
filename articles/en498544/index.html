<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèΩ ü•á üìö Red Team Tactics: Advanced Process Monitoring Techniques in Offensive Operations üî∫ üéì üì©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again. On the eve of the Pentest. Penetration Testing Practice ‚Äù translated another interesting material for you.
 
 
 
 In this article, we are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Red Team Tactics: Advanced Process Monitoring Techniques in Offensive Operations</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498544/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello again. </font><font style="vertical-align: inherit;">On the eve of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Pentest. </font><font style="vertical-align: inherit;">Penetration Testing Practice ‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> translated another interesting material for you.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/av/qe/wo/avqewourhsmerqakgy0q9hqbk-e.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we are going to understand the capabilities of well-known process monitoring utilities and demonstrate how to use the technology underlying these tools for Red Team offensive operations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A good technical understanding of the system that we rely on is a key criterion for making decisions about what the next step of the operation will be. The collection and analysis of data on running processes in compromised systems gives us a wealth of information and helps us understand how the IT infrastructure of the target organization works. In addition, periodically requested process data help us respond to environmental changes and receive trigger signals when an investigation begins.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to be able to collect detailed data about processes at compromised endpoints, we created a set of tools that brought together the power of advanced process utilities and C2 frameworks (such as Cobalt Strike). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tools (and their source code) can be </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">found here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Internal System Utilities</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, we will figure out which utilities can be used to collect information about computer processes on Windows. </font><font style="vertical-align: inherit;">We then learn how these utilities collect information so that they can later be used in Red Team toolkits.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Windows operating system is equipped with many ready-made utilities for administering the system. Although most of the tools provided are suitable for basic system administration purposes, some of them do not have the necessary functions for advanced troubleshooting and monitoring. For example, the Windows task manager gives us basic information about all the processes running in the system, but what if we need more detailed information, such as object descriptors, network connections, or modules loaded as part of a specific process? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To collect such information there is a more advanced tool. For example, system utilities of the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Sysinternals</font></a><font style="vertical-align: inherit;"> package</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. As a Red Team member with extensive experience in network and system administration, I have always been a big fan of Sysinternals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When troubleshooting a slow-running server system or an infected client computer, I most often started troubleshooting using tools such as Process Explorer or Procmon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the point of view of digital forensics, these tools also seem very useful for conducting basic dynamic analysis of malware samples and searching for artifacts in infected systems. So why are these tools so popular among system administrators as well as security professionals? Let's figure it out, delving into some process information that we can get using the Process Explorer tool.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using Process Explorer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing we see when starting </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Explorer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a list / tree of all running processes of the system. </font><font style="vertical-align: inherit;">This gives us information about the names of processes, their identifiers, the context of the user and the level of integrity of the process and version information. </font><font style="vertical-align: inherit;">Additional information can also be reflected by adjusting the columns accordingly. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/9s/fk/9d9sfkhmwl222wp8vlzcuhcw85y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we use the bottom panel, we can view all the modules loaded by a particular process, or switch to viewing descriptors to get acquainted with all the named descriptor objects that are used by the process:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/ss/ei/bassei2hnk4jg_kuyl2xd3maihg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browsing the modules can be useful when searching for malicious libraries loaded in the process, or for Red Team it is an active security product (for example, EDR) that has implemented an API connection module in user mode. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/f0/sn/lyf0snflh_begeau_5pjbtwhtis.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Switching to viewing descriptors allows you to get acquainted with the type and name of all named objects used in the process. This can be useful to find out which files and registry keys are open, which named pipes are used for interprocess communication. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 If you double-click on the process name, a window with more detailed information will appear. Let's look at some tabs to learn about the additional properties of the object: </font><i><font style="vertical-align: inherit;">Image</font></i></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/cr/k-/mxcrk-tik-hny6ailuno3pksvs4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 tab</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">displays information about the binary path, working directory, and command line options. In addition, it displays information about the user context, the parent process, the type of image (x86 or x64) and much more. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-i/_o/bu/-i_obubvbxw47snh32g2ysmp7yg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tab </font><font style="vertical-align: inherit;">contains information about running threads in the process. When you select a stream and then click on it, the stack button will reflect the call stack for this particular stream. To view threads / calls launched in kernel mode, Process Explorer uses the kernel driver, which is installed when working in elevated mode.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the DFIR point of view, thread information is useful for detecting injections into memory, for example, when there is a threat of file-free viruses. </font><font style="vertical-align: inherit;">Thus, streams that are not backed by files on the disk can signal suspicious behavior. </font><font style="vertical-align: inherit;">For more information on threads and memory, I highly recommend paying attention to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Hacker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tool </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3w/_s/0s/3w_s0sra5w6xq4_jf56lbg7czu4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Another interesting tab in Process Explorer is the TCP / IP tab. </font><font style="vertical-align: inherit;">On it you will see all the network connections associated with this process. </font><font style="vertical-align: inherit;">From an attack point of view, this can be useful for understanding when a connection is made from a compromised system. </font><font style="vertical-align: inherit;">An incoming PowerShell remote session or RDP session may signal that an investigation has already begun.</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the methods discussed for attack</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Now that we have learned a bit of interesting things about processes, and about the information that we can collect about them using Process Explorer, you may wonder how to access this information from our favorite C2 frameworks. Of course, we could use PowerShell, as this would give us the opportunity to use a powerful scripting language and Windows API. However, today PowerShell is under the constant supervision of the security service, so we try to avoid this method. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cobalt Strike,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we can use the ps command in the context of beacons. This command displays basic information about the process based on all processes running in the system. In combination with a script </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">@r3dQu1nn ProcessColor</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, this method is likely to be the best for obtaining process data.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The output from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command is </font><font style="vertical-align: inherit;">useful for quickly sorting running processes, but they do not contain detailed information that would help you better understand the system. </font><font style="vertical-align: inherit;">To collect more detailed information, we created our own utilities for obtaining information about processes. </font><font style="vertical-align: inherit;">With their help, we can collect and enrich information obtained from compromised systems.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ps Tools </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 It is not easy to replicate the functionality and information provided by a tool such as Process Explorer. First we need to find out how these tools work under the hood (and in user mode), then we need to understand how to better reflect this information in the console, and not in the graphical interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After analyzing the source code, it became clear that many low-level tools for providing system information are largely based on the native </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API </font><font style="vertical-align: inherit;">. Although the API and its associated structures are not fully documented, this API allows you to collect a lot of information about the Windows system. So using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQuerySystemInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as a starting point for collecting information about the processes running in the system, we will use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEB of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> individual processes to collect detailed information about each of them. </font><font style="vertical-align: inherit;">Using the </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NtQueryInformationProcess</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API </font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">,</font></a></i><font style="vertical-align: inherit;"> we can read the structure </font></font><code>PROCESS_BASIC_INFORMATION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using the process descriptor and find it </font></font><code>PebBaseAddress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Then we use the </font></font><code>NtReadVirtualMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API to read the structure </font></font><code>RTL_USER_PROCESS_PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which will allow us to know the parameters </font></font><code>ImagePathName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the </font></font><code>CommandLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using these APIs as the foundation of our code, we have written the following tools for obtaining information about processes:</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : shows a detailed list of all processes running on the system.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : displays kernel information, including loaded drivers.</font></font></li>
<li><i>Psc</i>:        TCP-.</li>
<li><i>Psm</i>:          (    , ).</li>
<li><i>Psh</i>:         (,  ,  ).</li>
<li><i>Psw</i>:        .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 All of these tools are written in C as reflective DLLs and can be reflexively embedded into a spawned process using a C2 framework such as Cobalt Strike (or any other framework that supports reflective DLL injections). </font><font style="vertical-align: inherit;">For Cobalt Strike, we have added an aggressor script that can be used to load tools using the Cobalt Strike script manager. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at each specific tool launched in Cobalt Strike in order to demonstrate the functionality and show what information can be collected using it:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 This tool shows a detailed list of all processes running on the system. The output can be compared with the information on the Process Explorer main screen. Psx displays the name of the process, its id, parent PID, creation time, and information related to the binary files of the process (architecture, company name, version, etc.). As you can see, it also displays some interesting information about the active kernel of the system, for example, the base address of the kernel, which is useful when operating the kernel (for example, to calculate the offsets of ROP gadgets). All of this information can be gathered from a normal user context (without elevation of privileges).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ni/jt/be/nijtbefsyhpct-kkpkxpwdp4pvc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 If we have enough permissions to open the process descriptor, you can read additional information, such as the context of the user and the integrity level of his token. </font><font style="vertical-align: inherit;">Enumerating PEB and related structures allows you to get information about the image path and command line parameters: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-d/hu/bm/-dhubmeevabpdhf1_-f_wpq8q9c.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 As you may have noticed, we read and display version information from binary process images, for example, company name and description. </font><font style="vertical-align: inherit;">Knowing the name of the company, you can easily list all the active security products in the system. </font><font style="vertical-align: inherit;">Using this tool, we compare the names of companies of all active processes with a list of well-known suppliers of security products and display the results:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xv/c4/nf/xvc4nflmu_fzxkgjq8wuq5zkd0m.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psk</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 This tool reflects information about the running kernel, including all loaded driver modules. </font><font style="vertical-align: inherit;">Like the Psx tool, it also provides a summary of all loaded kernel modules from well-known security products.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oe/mr/ii/oemrii004bpzkatpi1solktzfvq.png"><br>
 <br>
 <h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psc</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 This tool uses the same methods to display information about active processes as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , except that it displays only processes with an active network connection (IPv4, IPv6 TCP, RDP, ICA):</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/m9/gf/su/m9gfsulxhhfcacdvaofmpmxvdpy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 You can use this tool to get detailed information about a specific process. </font><font style="vertical-align: inherit;">It will display a list of all modules (DLLs) used by the process and the network connection:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/5x/wc/yu5xwczhban43kmlv5kjjg7o8v8.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psh</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 The same as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but instead of loaded modules, it shows a list of process descriptors:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-q/ok/nt/-qokntyj-1pdgaetariouoyi15a.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 The last but not least important </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Psw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tool </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This tool will show a list of processes with active window handles, those that are open on the user's desktop, including window titles. </font><font style="vertical-align: inherit;">This is useful for determining which graphical application interfaces the user opens without having to take screenshots of the desktop:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/ah/zg/tjahzg3ck9ed8-9of7hvv0krrl4.png"><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use cases</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 You may wonder: ‚ÄúAnd how does all this help us in offensive operations?‚Äù </font><font style="vertical-align: inherit;">After gaining access to a compromised asset, we usually use this information for the following purposes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detect security tools on a compromised asset. </font><font style="vertical-align: inherit;">Not only by process information, but also by loaded modules.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecting custom hook engines.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search for opportunities for maneuvers (through network sessions) and escalation of privileges.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the first compromise, you can periodically request similar information about the processes and start creating triggers. </font><font style="vertical-align: inherit;">For example, we automatically enter this information into </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RedELK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Then you can create alerts about suspicious changes in process information, such as:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch a security audit tool or install a new end-point security product.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inbound network connections from the security department through an RDP session or remote PowerShell.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opening a handle by another process on one of our malicious artifacts (for example, a file used to preserve presence).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we showed how tools such as Sysinternals Process Explorer can be used to get detailed information about the processes running on the system, and how this information can help administrators and security professionals troubleshoot and check the system for security problems or performance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same information is also relevant and useful for Red Team, which have access to compromised systems during operation. It helps to better understand the system and the IT infrastructure of your goal, and periodic questioning of such a system allows the Red Team to respond to possible changes in the environment (for example, an investigation trigger).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have replicated some of the functionality provided by tools such as Process Explorer, so we can use the same information in offensive operations. </font><font style="vertical-align: inherit;">To do this, several process monitoring tools have been created that can be used as part of the C2 framework, for example Cobalt Strike. </font><font style="vertical-align: inherit;">We showed how to use these tools and what information you can use to collect them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These tools are available on our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub page</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and are ready to use as part of Cobalt Strike.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Learn more about the course.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498534/index.html">Recognition of documents and persons: a union in the name of freedom or a step towards a digital dictatorship?</a></li>
<li><a href="../en498536/index.html">How to reuse code with symfony 5 bundles? Part 2. We take out the code in the bundle</a></li>
<li><a href="../en498538/index.html">My beautiful toad</a></li>
<li><a href="../en498540/index.html">Infographics using Excel and PowerPoint. Part 2</a></li>
<li><a href="../en498542/index.html">Practical class ‚ÄúSearching malware in IoT‚Äù</a></li>
<li><a href="../en498548/index.html">Creating Your Own Package for Laravel Nova: OptimalImage</a></li>
<li><a href="../en498552/index.html">What mistakes do managers on a remote site</a></li>
<li><a href="../en498556/index.html">Hans Peter Lun and the birth of the hash algorithm</a></li>
<li><a href="../en498560/index.html">Web components in a real project</a></li>
<li><a href="../en498562/index.html">Contrary to quarantine: how we transferred our internships to a remote format</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>