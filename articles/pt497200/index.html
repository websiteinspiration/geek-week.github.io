<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèüÔ∏è ‚ôåÔ∏è ü§ûüèΩ Montamos a rede ZigBee mais simples, programa sob Mbed, comunicamos atrav√©s do MQTT üöâ üíõ üö£üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √© um √≥timo workshop de treinamento b√°sico sobre o uso do m√≥dulo XBee em conjunto com um microcontrolador que possui o Mbed OS. O ZigBee √© ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Montamos a rede ZigBee mais simples, programa sob Mbed, comunicamos atrav√©s do MQTT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo √© um √≥timo workshop de treinamento b√°sico sobre o uso do m√≥dulo XBee em conjunto com um microcontrolador que possui o Mbed OS. O ZigBee √© um padr√£o longo e firmemente enraizado nos sistemas Smart Home (por exemplo, √© usado junto com o Z-Wave no hub Samsung SmartThings, consulte o nosso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), √© caracterizado por baixo consumo de energia, facilidade de uso e, mais interessante, a capacidade de criar redes mesh autoconfigur√°veis. Voc√™ ver√° no workshop que realmente √© assim - examinaremos a estrutura dessa rede por meio de um utilit√°rio visualizador conveniente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sup√µe-se que voc√™ j√° saiba o que √© o ZigBee e para que serve. </font><font style="vertical-align: inherit;">Agora voc√™ deseja conectar seu primeiro m√≥dulo XBee e resolver seus problemas, sem precisar programar o m√≥dulo, mas apenas us√°-lo como interface de comunica√ß√£o. </font><font style="vertical-align: inherit;">No final, enviaremos todos os dados atrav√©s de um gateway MQTT improvisado em qualquer lugar, mesmo para um servidor local, at√© para a Internet. </font><font style="vertical-align: inherit;">Decidimos mostrar tudo no exemplo do Mbed como o RTOS mais simples e acess√≠vel para iniciantes. </font><font style="vertical-align: inherit;">Voc√™ ficar√° convencido de que tudo funciona "pronto para uso" e poder√° come√ßar imediatamente a fazer seu projeto, mesmo antes de estar lidando apenas com o Arduino.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O manual consistir√° nas seguintes partes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o e configura√ß√£o do m√≥dulo XBee</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte os m√≥dulos √† rede</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuramos o m√≥dulo sem remov√™-lo da blindagem</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recupera√ß√£o de dados</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviando dados</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criando um Gateway MQTT Simples</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas primeiro, uma lista de componentes: o que √© desej√°vel ter para fazer todas as op√ß√µes acima.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Componentes Necess√°rios</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duas placas compat√≠veis com Mbed. </font><font style="vertical-align: inherit;">Recomendamos a placa de treinamento STM32 Nucleo como relativamente barata e popular para fins educacionais. </font><font style="vertical-align: inherit;">O processo de programa√ß√£o √© simplificado ao m√°ximo: colete o programa em um IDE gratuito on-line, fa√ßa o download do firmware montado e "solte" na placa, que aparecer√° no sistema como uma unidade flash. </font><font style="vertical-align: inherit;">Qual modelo espec√≠fico a ser adotado n√£o √© importante, mas n√£o o modelo mais antigo, preste aten√ß√£o √† quantidade de mem√≥ria. </font><font style="vertical-align: inherit;">Por exemplo, F401RE - damos apenas por defini√ß√£o, para que voc√™ n√£o se confunda com sua diversidade e, a princ√≠pio, c√≥digos alfab√©ticos incompreens√≠veis de processadores STM.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  ¬´¬ª ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um conversor USB-UART com conector para XBee. </font><font style="vertical-align: inherit;">√â necess√°rio para a configura√ß√£o inicial. </font><font style="vertical-align: inherit;">Os m√≥dulos XBee n√£o est√£o equipados com uma interface USB (eles n√£o t√™m nada a ver com isso). </font><font style="vertical-align: inherit;">O USB √© necess√°rio √∫nica e exclusivamente para a comunica√ß√£o entre o m√≥dulo e o computador e, no dispositivo, ele pode funcionar em um UART muito mais simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O espa√ßamento dos slots dos m√≥dulos XBee √© de 2,0 mm - para os eletr√¥nicos n√£o √© padr√£o no sistema m√©trico (costumamos ver a etapa 2.54 de acordo com os padr√µes americanos). </font><font style="vertical-align: inherit;">Portanto, infelizmente, esses m√≥dulos n√£o s√£o inseridos na placa de ensaio e eles sempre precisam de um adaptador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qualquer adaptador √© adequado aqui, pegamos este da Waveshare:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o e configura√ß√£o do m√≥dulo XBee</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A coisa mais simples que voc√™ pode fazer com o m√≥dulo √© conect√°-lo ao computador diretamente via USB. </font><font style="vertical-align: inherit;">N√≥s teremos acesso imediato aos seus par√¢metros de configura√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale o XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabalhar com o XBee, existe um programa oficial do XCTU. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">download</font></a><font style="vertical-align: inherit;"> e instale. </font><font style="vertical-align: inherit;">A documenta√ß√£o diz que no Ubuntu voc√™ precisa adicionar um usu√°rio a um grupo </font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para trabalhar com portas que n√£o s√£o de um superusu√°rio - fa√ßa isso se voc√™ ainda n√£o o fez:</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fa√ßa o download do arquivo zip a partir do link, ele conter√° um arquivo </font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele precisa ser execut√°vel (via </font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no console ou: bot√£o direito do mouse - Propriedades - Permiss√µes) e executado </font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â importante iniciar a instala√ß√£o n√£o a partir da raiz (sem </font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), caso contr√°rio, haver√° problemas mais tarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A configura√ß√£o √© mais ou menos assim:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programa XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a instala√ß√£o, voc√™ pode iniciar o programa executando o arquivo </font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no diret√≥rio em que instalou o programa (por padr√£o - </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A apar√™ncia ser√° a seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste programa, voc√™ pode adicionar o m√≥dulo existente conectado √† porta USB atrav√©s de um adaptador. Clique no bot√£o Discover com uma lupa. Uma janela √© exibida solicitando que voc√™ selecione uma porta - como voc√™ pode ver, o programa detectou corretamente a porta no sistema </font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, este √© o nosso adaptador USB-UART.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A janela sugere marcar a pesquisa. </font><font style="vertical-align: inherit;">Obviamente, existe uma tenta√ß√£o de verificar tudo de uma vez para encontrar com certeza o seu m√≥dulo. </font><font style="vertical-align: inherit;">Mas a pesquisa continuar√° por um longo tempo. </font><font style="vertical-align: inherit;">Na pr√°tica, faz sentido deixar as caixas marcadas por padr√£o e escolher as op√ß√µes mais comuns para a velocidade de transfer√™ncia de dados, como na figura abaixo. </font><font style="vertical-align: inherit;">Geralmente, os novos m√≥dulos s√£o padronizados para 9600 e, para fins de treinamento, isso √© mais do que suficiente, a velocidade aqui n√£o √© cr√≠tica para n√≥s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, se tudo der certo, voc√™ ser√° solicitado a selecionar o m√≥dulo encontrado: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pequeno erro foi notado: √†s vezes o m√≥dulo n√£o estava em uma velocidade n√£o padr√£o, a redefini√ß√£o manual do m√≥dulo com o bot√£o Redefinir durante a pesquisa e a redefini√ß√£o da taxa de transmiss√£o para o padr√£o (9600) ajudaram.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterar par√¢metros do m√≥dulo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, estamos envolvidos na configura√ß√£o do m√≥dulo. Muitos par√¢metros ser√£o eliminados, a maioria dos quais √© inicialmente incompreens√≠vel. Felizmente, apenas alguns deles precisar√£o ser alterados para um in√≠cio r√°pido. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID de rede - PAN ID.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Uma chave de rede comum, deve ser a mesma para todos os dispositivos para que eles estejam conectados √† rede de forma independente. Coloque qualquer n√∫mero, no nosso caso, fizemos 42. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE - Coordenador ativado.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se houver 1, esse m√≥dulo atua como coordenador. Se for 0, o m√≥dulo atua como um roteador (roteador) - na verdade, ele simplesmente garante que os pacotes passem pela rede por si pr√≥prios. A maioria dos hosts geralmente s√£o roteadores. Precisamos de um coordenador e dois roteadores em nossa rede, ent√£o coloque um aqui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m a fun√ß√£o "Dispositivo final" - este √© um m√≥dulo que n√£o realiza trabalhos de transfer√™ncia de pacotes, mas apenas se comunica com outros roteadores e executa sua funcionalidade √∫til. Geralmente, ele est√° no modo de suspens√£o e acorda em intervalos definidos e descobre se h√° alguma mensagem. Esse m√≥dulo pode ser alimentado por uma bateria, enquanto o roteador e o coordenador devem estar sempre ‚Äúonline‚Äù e, como resultado, precisam de energia constante para manter toda a rede. N√£o consideraremos esse exemplo agora, pois √© mais interessante para todos atribuir a fun√ß√£o de roteadores e observar como a rede mudar√° automaticamente sua configura√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP - API ativado.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo de opera√ß√£o. Os m√≥dulos XBee podem operar em dois modos: AT ou API. O modo AT √© mais f√°cil para iniciantes, √© uma substitui√ß√£o transparente da porta serial e trabalha com o m√≥dulo atrav√©s dos comandos AT. No entanto, o modo API √© muito mais rico em funcionalidades, permite configurar m√≥dulos remotamente, cont√©m o endere√ßo do remetente, retorna o status de entrega do pacote e muito mais. Al√©m disso, as bibliotecas para interagir com o XBee pressup√µem que o dispositivo seja usado no modo API. Portanto, substitua-o imediatamente pelo modo API, isso √© feito configurando a unidade no campo correspondente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O nome do m√≥dulo √© Node Identifier.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Uma op√ß√£o √∫til para dar ao seu m√≥dulo um nome leg√≠vel por humanos. Vamos dar esse nome - coordenador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, voc√™ pode atualizar as configura√ß√µes no m√≥dulo pressionando o bot√£o com um l√°pis:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Conecte os m√≥dulos √† rede</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora veremos que tipo de rede obteremos se configurarmos tr√™s m√≥dulos. </font><font style="vertical-align: inherit;">O programa XCTU possui um visualizador de rede bastante conveniente, veremos claramente a topologia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos configurar todos os tr√™s m√≥dulos por vez, com os seguintes par√¢metros:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAN ID - n√∫mero total, por exemplo 42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP (API ativado) - definido como 1 (funciona no modo API)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI (Node Identifier) ‚Äã‚Äã- forne√ßa nomes compreens√≠veis aos m√≥dulos (coordenador, l√¢mpada e interruptor, se estivermos executando, por exemplo, um modelo do sistema Smart Home).</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE (ativa√ß√£o do coordenador) - defina um dos m√≥dulos como 1, ele ser√° o coordenador.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, aplique energia a todos os m√≥dulos. Posicione-os assim: o coordenador estar√° no conversor USB-UART e os outros dois (roteadores) estar√£o localizados nas placas XBee Shield na parte superior do Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ fez tudo com cuidado, o belo vai acontecer. Os m√≥dulos se conectam automaticamente √† rede. Voc√™ pode se comunicar com roteadores remotamente atrav√©s do coordenador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se parece com isso. Clique no bot√£o "Descobrir n√≥s de r√°dio na mesma rede". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ ver√° que dois m√≥dulos foram detectados e adicionados automaticamente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E voc√™ pode alterar seus par√¢metros em tempo real!&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que ainda √© √≥timo: agora voc√™ pode ver o mapa de rede se alternar para o modo de trabalho em rede no canto superior direito.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de espalhar os n√≥s da rede com o mouse, voc√™ ver√° um tri√¢ngulo. </font><font style="vertical-align: inherit;">Observe que o tr√°fego para o m√≥dulo mais √† direita pode ser de duas maneiras. </font><font style="vertical-align: inherit;">E se voc√™ mover os m√≥dulos no espa√ßo, ver√° que a imagem mudou e agora, talvez, outro m√≥dulo se tornar√° "extremo". </font><font style="vertical-align: inherit;">Essa √© a ess√™ncia de uma rede autoconfigur√°vel.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Configure o m√≥dulo XBee sem remov√™-lo da blindagem</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, ser√° mais interessante trabalhar com o m√≥dulo XBee n√£o atrav√©s de um computador, mas controlando-o usando um programa no microcontrolador. </font><font style="vertical-align: inherit;">Ou seja, conect√°-lo √† placa STM32Nucleo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos discutir como o m√≥dulo XBee pode se comunicar com o microcontrolador. </font><font style="vertical-align: inherit;">E vamos come√ßar com uma pequena tarefa: como configurar um m√≥dulo sem remov√™-lo do escudo de expans√£o? </font><font style="vertical-align: inherit;">Voc√™ deve admitir que mover o m√≥dulo para a frente e para tr√°s √© inconveniente, ao mesmo tempo em que voc√™ deseja experimentar os par√¢metros e √© estranho por que voc√™ precisa de um m√≥dulo USB-UART separado, porque, em teoria, existe um na placa STM32Nucleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o √© simples: precisamos transformar a placa Nucleo em uma ponte entre o m√≥dulo XBee e o conversor USB na placa.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o geral da ideia</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O microcontrolador STM32 que usamos possui v√°rias interfaces UART a bordo. Cada uma dessas interfaces representa um canal de comunica√ß√£o. Um deles est√° conectado ao conversor USB-UART para que possamos nos comunicar com o computador via USB no terminal. Dois outros ainda n√£o s√£o usados. Vamos conectar o m√≥dulo XBee a um deles, que tamb√©m possui esse canal de comunica√ß√£o. Voc√™ pode escolher qualquer UART, escolhemos por defini√ß√£o UART1.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pinagem pode ser visualizada em MBed no canto superior direito, pressionando o bot√£o de sele√ß√£o da placa e depois na guia Pinagem. </font><font style="vertical-align: inherit;">Por h√°bito, pode ser bastante dif√≠cil perceber essa imagem colorida. </font><font style="vertical-align: inherit;">Existem muitas coisas aqui, uma vez que a placa possui muitas interfaces e existem dois n√∫meros de pinos: relativos ao microcontrolador (PA_5, PA_6 - numera√ß√£o de pinos) e relativos √† placa (D13, D12 - inscri√ß√µes na placa Nucleo, os mesmos n√∫meros pr√≥ximos aos terminais). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que no microcontrolador, a interface UART1 se comunicar√° com o m√≥dulo XBee e o UART2 - como antes, com o computador. </font><font style="vertical-align: inherit;">O c√≥digo interno redirecionar√° UART1 para UART2 e vice-versa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conex√µes, ficar√° assim:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazendo uma "ponte" a partir de um microcontrolador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, podemos jumpers no escudo definir os n√∫meros aos quais queremos conectar o m√≥dulo ZigBee. O m√≥dulo de comunica√ß√£o TX ser√° conectado ao pino 2 da placa (PA_9 no microcontrolador) e o RX ao pino 8 (tamb√©m conhecido como PA_10). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele ficar√° assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que pegamos √© chamado de Ponte Serial. Esta √© a "ponte" entre os dois canais de comunica√ß√£o. Carregamos o c√≥digo no microcontrolador, que encaminha tudo o que chega √† entrada do computador via UART2, para UART1 e vice-versa. Como se inser√≠ssemos um canal entre duas fontes de informa√ß√£o (o Linuxsoids entender√°). Conectamos um m√≥dulo XBee ao UART1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo √© muito simples, a √∫nica coisa que voc√™ precisa alterar s√£o os n√∫meros de pinos aos quais o dispositivo est√° conectado. Ou seja, crie PA_9 e PA_10, conforme indicado acima.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â importante que, se voc√™ confundir a ordem das conclus√µes - por exemplo, cometa um erro e escreva PA_10, PA_9 em vez de PA_9, PA_10 - na ordem errada, o compilador n√£o reportar√° um erro para voc√™ e o programa exibir√° um erro no console ap√≥s a reinicializa√ß√£o:</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e n√£o seguir√° em frente, ou seja, em princ√≠pio, nada funcionar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de baixar esse c√≥digo e definir corretamente os jumpers na blindagem, voc√™ pode conectar-se com seguran√ßa ao m√≥dulo XBee a partir do computador, como fez anteriormente com o adaptador USB-UART sem remov√™-lo da blindagem. </font><font style="vertical-align: inherit;">Ele ser√° detectado regularmente pelo programa XCTU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo que voc√™ n√£o precise dessa funcionalidade, verifique se o programa est√° funcionando, porque no pr√≥ximo exemplo iremos nos comunicar com o m√≥dulo XBee do microcontrolador, e a conex√£o via UART1 j√° deve estar estabelecida (ou seja, os jumpers est√£o configurados corretamente e os n√∫meros de pinos s√£o indicados no programa) .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Aquisi√ß√£o de dados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos dois exemplos simples: como receber e enviar dados no n√≠vel do microcontrolador, usando o m√≥dulo XBee como uma interface de comunica√ß√£o externa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficial </font><font style="vertical-align: inherit;">dos fabricantes - empresas Digi. </font><font style="vertical-align: inherit;">Encontra-se no reposit√≥rio Mbed, existem coment√°rios √∫teis sobre o uso e a l√≥gica do c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, aprenderemos como obter dados - h√° um exemplo mais f√°cil. </font><font style="vertical-align: inherit;">Teremos um m√≥dulo XBee conectado ao conversor USB-UART, enviaremos uma sauda√ß√£o √† placa Nucleo e ela imprimir√° essa sauda√ß√£o no console. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nesta biblioteca. </font><font style="vertical-align: inherit;">Como sempre, importe-o no compilador online como um programa.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corrigir bibliotecas para m√≥dulos S2C</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que se voc√™ possui m√≥dulos da s√©rie S2C: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
em vez da biblioteca padr√£o, √© necess√°rio usar a corre√ß√£o: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Caso contr√°rio, esses programas n√£o funcionar√£o. </font><font style="vertical-align: inherit;">Ele √© adicionado ao projeto simplesmente removendo a biblioteca XBeeLib de l√° e importando-a para o projeto XBeeLibFix. </font><font style="vertical-align: inherit;">Nada mais precisa ser mudado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o: importe esta biblioteca para o compilador online: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
janela de importa√ß√£o do projeto ser√° exibida. </font><font style="vertical-align: inherit;">L√°, voc√™ precisa escolher o destino - para onde importamos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como projeto de destino, selecione nosso exemplo XBeeZB_Receive_Data. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o qual a biblioteca ser√° importada para o projeto e, em seguida, com um movimento em negrito, exclu√≠mos a vers√£o errada do XBeeLib.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de compila√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, voc√™ importou o exemplo e substituiu a biblioteca, se necess√°rio. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja o c√≥digo de exemplo, √© bastante simples. </font><font style="vertical-align: inherit;">Ele define uma fun√ß√£o de retorno de chamada que √© chamada quando um pacote √© recebido. </font><font style="vertical-align: inherit;">Esta fun√ß√£o imprime o conte√∫do do pacote recebido no console. </font><font style="vertical-align: inherit;">Ent√£o, se lhe enviarmos uma sauda√ß√£o, ela tamb√©m a imprimir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que o exemplo seja compilado, voc√™ precisa escrever no exemplo as conclus√µes pelas quais somos respons√°veis ‚Äã‚Äãpela comunica√ß√£o com o m√≥dulo XBee, porque o programa n√£o sabe a quais conclus√µes conectamos o hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, vamos ao arquivo config.h e as linhas nele:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descomente, e em vez de NC, escrevemos, de acordo com quais conclus√µes conectamos os jumpers:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da mesma forma, modificamos as linhas:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s escrevemos:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ encontrar um erro durante a compila√ß√£o que n√£o consegue encontrar </font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, basta atualizar a biblioteca Mbed na √°rvore do projeto (clique com o bot√£o direito do mouse em -&gt; Atualizar) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, o programa ser√° compilado com √™xito e voc√™ poder√° baix√°-lo para o quadro.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo em execu√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de examinar o console, o que a placa Nucleo escreve, voc√™ ver√° o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como enviamos dados? </font><font style="vertical-align: inherit;">A op√ß√£o mais f√°cil: atrav√©s do console no programa XCTU. </font><font style="vertical-align: inherit;">Selecione no menu principal do programa: Ferramentas - Enviar pacotes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na parte inferior, h√° uma janela com as palavras Enviar pacotes. </font><font style="vertical-align: inherit;">Crie um novo pacote clicando no "mais" √† direita. </font><font style="vertical-align: inherit;">Uma janela para criar um novo pacote ser√° exibida. </font><font style="vertical-align: inherit;">Selecione a guia HEX l√°. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digite o envio de dados: </font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(usando o bot√£o "Enviar pacote selecionado" √† direita da lista de pacotes) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ ver√° o resultado no console do m√≥dulo de escuta:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que ele apenas imprimiu a √∫ltima parte do conjunto de bytes que voc√™ enviou. </font><font style="vertical-align: inherit;">Essa √© a carga √∫til real da mensagem. </font><font style="vertical-align: inherit;">Observe tamb√©m que se voc√™ enviar "apenas bytes" (qualquer combina√ß√£o aleat√≥ria de bytes), o receptor n√£o os emitir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ colocar um conjunto de bytes:&nbsp; </font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
em qualquer conversor HEX-ASCIII (por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), verifique se isso significa "Ol√° XBee!" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma tarefa muito simples para execu√ß√£o independente: modifique o c√≥digo de exemplo para exibir o texto da mensagem em ASCII, n√£o em HEX, e voc√™ poder√° ler este texto no terminal.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Enviando dados</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por analogia com o exemplo anterior, agora consideramos o envio de dados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo est√° aqui, como no exemplo anterior. </font><font style="vertical-align: inherit;">Somente com a diferen√ßa que estamos abrindo no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XBeeZB_Send_Data.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de compila√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â importante que, se voc√™ tiver um m√≥dulo S2C (est√° claramente escrito nele), </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
conecte novamente a biblioteca com uma corre√ß√£o, caso contr√°rio nada funcionar√° para voc√™. Como fazer isso √© descrito no exemplo anterior.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, para obter uma compila√ß√£o bem-sucedida, voc√™ precisa especificar os pinos do controlador usados, basta copi√°-los do exemplo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos o pr√≥prio c√≥digo de exemplo. Ele </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa v√°rios m√©todos para enviar dados. Escolha o mais simples: envie dados ao coordenador. Nem precisamos registrar o endere√ßo do coordenador, porque ele j√° est√° registrado na rede. Portanto, sem alterar a amostra, comentamos enquanto todas as linhas no final:</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E quando voc√™ come√ßar, ver√°: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(se n√£o o vir, basta reiniciar o quadro) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como posso garantir que os dados cheguem ao coordenador? Por exemplo, o XCTU possui o modo de console de rede. Ativado pelo bot√£o no canto superior direito. Nesse modo, voc√™ ver√° todos os pacotes na rede. Obviamente, ao mesmo tempo, voc√™ deve ter uma conex√£o serial com o coordenador. E n√£o se esque√ßa de clicar no bot√£o Abrir no canto superior esquerdo para torn√°-lo verde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode ver informa√ß√µes detalhadas sobre cada pacote na rede, selecionando-o na lista √† esquerda: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rolando at√© o final do conte√∫do do pacote, voc√™ ver√° uma linha com o texto "send_data_to_coordinator":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode tentar outros m√©todos de envio de dados, mas l√° (por exemplo, para enviar para um n√≥ selecionado separado), √© necess√°rio registrar o endere√ßo do n√≥. </font><font style="vertical-align: inherit;">Voc√™ pode ver os endere√ßos de todos os m√≥dulos no programa XCTU. </font><font style="vertical-align: inherit;">Como registrar endere√ßos espec√≠ficos √© descrito exaustivamente no exemplo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Fazemos o gateway MQTT</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo est√° √≥timo, mas agora eu gostaria de trabalhar de alguma forma com esses dados fora da rede XBee, por exemplo, na Internet. </font><font style="vertical-align: inherit;">Uma maneira de fazer isso √© colocar o tradutor do XBee no popular protocolo MQTT. </font><font style="vertical-align: inherit;">Ent√£o, da maneira usual, podemos assinar notifica√ß√µes de eventos e enviar comandos da interface do usu√°rio, e esse programa pode ser localizado em qualquer lugar (se voc√™ usar um servidor MQTT externo e n√£o local), e n√£o apenas em nosso computador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° uma instru√ß√£o. </font><font style="vertical-align: inherit;">Em resumo, o programa iniciado no computador trocar√° dados do coordenador da rede por meio de uma conex√£o USB. </font><font style="vertical-align: inherit;">Ela transmitir√° esses dados para o protocolo MQTT.</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale e configure o XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O programa que usaremos como gateway MQTT √© chamado XBMQ, √© aberto e gratuito. </font><font style="vertical-align: inherit;">Existe em duas vers√µes:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vers√£o Java ser√° considerada, embora isso n√£o seja muito fundamental: n√£o a programaremos de qualquer maneira, apenas a instalaremos e a usaremos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que o programa funcione, voc√™ precisar√° da biblioteca RXTX, que pode ser instalada simplesmente a partir do reposit√≥rio:</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, claro, voc√™ precisa do JDK (Java Development Kit). </font><font style="vertical-align: inherit;">Ele existe em duas vers√µes - do Oracle e OpenJDK, a segunda √© recomendada. </font><font style="vertical-align: inherit;">Provavelmente, o OpenJDK j√° est√° instalado no seu sistema; caso contr√°rio, reinstale-o. </font><font style="vertical-align: inherit;">O Java precisa no m√°ximo 8, pois </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.xml.bind foi exclu√≠do do Java 11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e voc√™ precisa escolher uma alternativa com o JDK-8 como op√ß√£o padr√£o ou criar uma configura√ß√£o para este caso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fa√ßa o download do reposit√≥rio do programa XBMQ:</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o download dos c√≥digos-fonte, coletaremos o arquivo bin√°rio do programa. </font><font style="vertical-align: inherit;">Equipe</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
montar√° um projeto para todos os principais sistemas operacionais. </font><font style="vertical-align: inherit;">O programa compilado final ser√° na pasta </font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora configure este programa. </font><font style="vertical-align: inherit;">Abrir arquivo</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 e veja l√°:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remova o coment√°rio e altere seus par√¢metros. </font><font style="vertical-align: inherit;">Os par√¢metros s√£o os seguintes: porta de conex√£o do coordenador ZigBee, velocidade, t√≥pico raiz (todos os dados ser√£o inseridos), endere√ßo do servidor MQTT, nome de usu√°rio e senha (se o servidor exigir). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste exemplo, apenas o endere√ßo do servidor mudou - para o servidor mqtt local (mosquitto padr√£o do Linux). </font><font style="vertical-align: inherit;">Tudo o resto foi deixado por padr√£o:</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes da pr√≥xima etapa, voc√™ deve instalar e executar o mosquito local no servidor MQTT:&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lan√ßamento do XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, o programa pode ser lan√ßado. </font><font style="vertical-align: inherit;">Depois de conectar o conversor USB-UART com o m√≥dulo coordenador inserido, execute o programa:</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ executa o script, vemos a linha no console:</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por √∫ltimo - este √© exatamente o endere√ßo do nosso coordenador. </font><font style="vertical-align: inherit;">Se voc√™ se inscrever em todos os t√≥picos com um cliente MQTT externo, ver√° imediatamente 2 mensagens:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No t√≥pico </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ser√° 1, este √© o √∫ltimo desejo (um bom exemplo de como esses par√¢metros "especiais" s√£o usados ‚Äã‚Äãna vida real)</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O t√≥pico </font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conter√° a mesma frase de depura√ß√£o ‚ÄúIniciando o Gateway XBMQ ...‚Äù que voc√™ j√° viu no console</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora tente enviar uma mensagem de outro m√≥dulo XBee externo - por exemplo, d√™ um exemplo ao enviar dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, no programa MQTT.fx, se voc√™ assinar todos os t√≥picos (#), ver√° o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A janela do programa MQTT.fx.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ou seja, iniciando o exemplo estudado anteriormente com o envio de uma mensagem ao coordenador, veremos este texto ("send_data_to_coordinator") como parte Pacote MQTT. O t√≥pico pai comum para n√≥s √© o especificado na configura√ß√£o do programa ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ pode alter√°-lo para seu pr√≥prio pa√≠s). Em seguida, vem o endere√ßo do coordenador, depois o endere√ßo do m√≥dulo do qual a mensagem veio. Finalmente, este t√≥pico √© chamado DataOut, porque s√£o dados de sa√≠da.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, voc√™ ver√° essa imagem em qualquer outro cliente MQTT, seja MQTTLens ou mesmo apenas</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns coment√°rios finais:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De uma maneira boa, este programa deve funcionar no modo daemon. </font><font style="vertical-align: inherit;">Existe um arquivo xbmqd para isso, e o README diz como us√°-lo.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se de que, como ela </font></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m a porta, n√£o podemos executar este programa ao mesmo tempo que o XCTU.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode trabalhar com seu sistema usando o protocolo MQTT e gravar programas complexos e interessantes! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - A autora do programa de treinamento na Internet das Coisas acompanha a ‚ÄúSamsung IT Academy‚Äù, especialista em programas de responsabilidade social corporativa no Samsung Research Center</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt497178/index.html">‚Äú1C: ERP‚Äù e ‚Äú1C: CRM‚Äù: funcionalidade e an√°lise comparativa de configura√ß√µes</a></li>
<li><a href="../pt497184/index.html">Um olhar sobre as promissoras dire√ß√µes de desenvolvimento de sistemas de gerenciamento de dados geol√≥gicos, geof√≠sicos e de campo</a></li>
<li><a href="../pt497186/index.html">Como √© a busca de uma vacina para o coronav√≠rus</a></li>
<li><a href="../pt497192/index.html">Como a TI funciona √† dist√¢ncia: dicas para gerenciar equipes distribu√≠das</a></li>
<li><a href="../pt497194/index.html">Tinder sabe mais sobre sua vida √≠ntima do que seus amigos</a></li>
<li><a href="../pt497204/index.html">Digital 2020: tend√™ncias de fixa√ß√£o</a></li>
<li><a href="../pt497206/index.html">Sobre programa√ß√£o orientada a objetos</a></li>
<li><a href="../pt497212/index.html">[Instru√ß√£o] Usando o Google-disk, Google-Site, Google-Form para criar um banco de dados e sistemas de feedback</a></li>
<li><a href="../pt497214/index.html">Engenheiro de dados e cientista de dados: o que eles podem e quanto ganham</a></li>
<li><a href="../pt497216/index.html">Fizemos uma epidemia de coronav√≠rus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>