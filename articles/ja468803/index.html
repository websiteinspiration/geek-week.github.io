<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸🏾 🔵 👩🏽‍🤝‍👨🏻 ワークフローエンジンの作成方法 🎅🏽 🤱 👵🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="DIRECTUMでは、DirectumRX ECMシステムを開発しています。ECMシステムのワークフローモジュールのコア要素はエンジンです。彼は、ライフサイクル中にプロセスインスタンス（インスタンス）の状態を変更する責任があります。ワークフローモジュールの開発を始める前に、次のことを決定する必要があ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ワークフローエンジンの作成方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/468803/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIRECTUMでは、DirectumRX ECMシステムを開発しています。</font><font style="vertical-align: inherit;">ECMシステムのワークフローモジュールのコア要素はエンジンです。</font><font style="vertical-align: inherit;">彼は、ライフサイクル中にプロセスインスタンス（インスタンス）の状態を変更する責任があります。</font><font style="vertical-align: inherit;">ワークフローモジュールの開発を始める前に、次のことを決定する必要があります。既製のエンジンを使用するか、独自のエンジンを作成するか。</font><font style="vertical-align: inherit;">最初は、最初のオプションを選びました。</font><font style="vertical-align: inherit;">私たちはWindows Workflow Foundation（WF）エンジンを採用しましたが、全体的に私たちに適していました。</font><font style="vertical-align: inherit;">しかし、時間の経過とともに、独自のエンジンが必要であることに気付きました。</font><font style="vertical-align: inherit;">これがどのようにして起こったのか、そしてそれから何が起こったのか、私は以下に話します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いエンジン</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なんでwf？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2013年、DirectumRXのワークフローモジュールを開発する時期に、既製のエンジンを採用することにしました。</font><font style="vertical-align: inherit;">Windows Workflow Foundation（WF）、ActiveFlow、K2.NET、WorkflowEngine.NET、cDevWorkflow、NetBpmから表示。</font><font style="vertical-align: inherit;">コストに不満な人もいれば、生の人もいました。その頃には、長い間サポートされていませんでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、選択はWFに落ちました。</font><font style="vertical-align: inherit;">その後、マイクロソフトスタック（WCF、WPF）を積極的に使用し、別のWが私たちを傷つけないことを決定しました。</font><font style="vertical-align: inherit;">もう1つの利点は、マイクロソフトゴールドアプリケーション開発パートナーのステータスでした。これにより、マイクロソフトテクノロジーを使用した製品の開発が可能になりました。</font><font style="vertical-align: inherit;">まあ、一般的に、エンジンの機能は私たちに適しており、ほとんどすべてのケースをカバーしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WFの何が問題になっていますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFを6年間使用して以来、多くの問題を蓄積してきましたが、これらの問題を解決するためのコストは高すぎました。</font><font style="vertical-align: inherit;">独自のエンジン開発を考え始めました。</font><font style="vertical-align: inherit;">それらのいくつかについてお話します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高価な診断とバグ修正</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
年月が経過し、製品の設置数と負荷が増大しました。バグが出現し始め、その診断と修正には多くのリソースが必要でした。これは、コンピテンシーの欠如、以前のエンジンを埋め込むときの設計エラー、WFの機能など、複雑な理由によって促進されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WF DirectumRXを構築するのに十分な基本的な能力があり、同じレベルで単純なバグを処理するのに十分でした。複雑なケースでは、能力は十分ではありませんでした-ログの分析、インスタンスの状態の分析などは困難でした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFのコースにユーザーを送信することは可能でしたが、インスタンスの状態を分析し、その変更をログに関連付ける方法はほとんど教えられていません。そして率直に言って、事実上死んだ技術でスキルをアップグレードしたいという特別な願望は誰にもありませんでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の方法は、適切な能力を持つ人を雇うことです。しかし、イジェフスクでそれを見つけることはそれほど簡単な仕事ではなく、そのレベルが問題を解決するのに十分であるという事実ではありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、WFをサポートするための高いエントリーしきい値に直面しています。いずれにせよ、他の多くの理由がなければ、私たちはこの問題に対処すると思います。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の問題は、プロセス図を作成するときに独自の表記法を使用することでした。</font><font style="vertical-align: inherit;">より視覚的で開発が容易です。</font><font style="vertical-align: inherit;">たとえば、WFは本格的なグラフの実装を許可していません。行き止まりのブロックを描画することはできません。平行分岐を描画する機能があります。</font><font style="vertical-align: inherit;">これに対する見返りは、私たちの回路をWF回路に変換することです。これはそれほど単純ではなく、いくつかの制限を課します。</font><font style="vertical-align: inherit;">デバッグするときは、WF回路の状態を分析する必要がありました。このため、可視性が失われ、ブロックと面を互いに比較して、インスタンスのステップを理解する必要がありました。</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/db/7p/fo/db7pfo4ik9gbjjpge475jbnn8zo.png" alt="画像"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectumRXでの回路の表現</font></font></font></i><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e8/40/o7/e840o7sz-zleiogtdvyzhownh2o.png" alt="画像"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WFでスキーマ</font></font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を表示するまた、WFのドキュメントではインスタンスリポジトリが適切に記述されていないという事実にも遭遇しました。</font><font style="vertical-align: inherit;">上で書いたように、これは、プロセスインスタンスの状態を理解するためにバグを分析するときに必要です。</font><font style="vertical-align: inherit;">また、データの一部が暗号化されているため、分析も妨害されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMSとしてのPostgres</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長年にわたり、ロシアでは輸入代替の傾向があり、プラットフォームの要件の1つに、オープンソースデータベース管理システム（DBMS）または国内生産のDBMSのサポートがますます必要になります。</font><font style="vertical-align: inherit;">ほとんどの場合、それはPostgresです。</font><font style="vertical-align: inherit;">デフォルトでは、WFはMS SQLのみをサポートしています。</font><font style="vertical-align: inherit;">他のデータベースを操作するには、サードパーティのプロバイダーを使用できます。</font><font style="vertical-align: inherit;">DevArtのdotConnectを選択しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
負荷が軽い間、すべてがうまくいきました。</font><font style="vertical-align: inherit;">しかし、システムに負荷をかけた直後に問題が発生しました。</font><font style="vertical-align: inherit;">WFがインスタンスの処理を突然停止して停止した（準備されたトランザクションが終了した）、またはすべてのメッセージがMSMQポイズンキューに送信された、など。</font><font style="vertical-align: inherit;">私たちはこれらすべての問題に対処しましたが、それに多くの時間を費やしました。</font><font style="vertical-align: inherit;">新しいソリューションが出現しないという保証はありませんでした。そのソリューションは同じ金額を費やす必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.netコアに注意</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Microsoftが.Net Coreを発表した後、私たちはソリューションのクロスプラットフォームを達成するために徐々にそれに取り組むことを決定しました。</font><font style="vertical-align: inherit;">MicrosoftはWFを採用しないことを決定しました。これにより、ワークフローモジュールが存在していた形で.Net Coreに転送する方法が妨げられました。</font><font style="vertical-align: inherit;">.Net Coreには非公式のWFポートがあり、その中にWF開発者もいることは認識していますが、それらすべてが100％互換性があるわけではありません。</font><font style="vertical-align: inherit;">もう1つの要因は、.NETの開発をMicrosoftが拒否したことです。</font><font style="vertical-align: inherit;">.Net Coreを支持して。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいエンジン</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題の山、解決策の選択肢、リファクタリングと修正の複雑さ、すべての長所と短所を考慮して、新しいエンジンに切り替えることにしました。</font><font style="vertical-align: inherit;">私たちは既存のものを分析することから始めました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択肢</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンジンを選択する際の主な要件は次のとおりです。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Net Coreで作業します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーラビリティ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存のプロセスインスタンスの変換、変換後も実行を継続する機能</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存の問題を分析するための妥当なコスト</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">異なるDBMSで作業する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、Activity（Activity）がアプリケーションコードをC＃で実行できること、ブロックのデバッグなどが可能であることが必要でした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既存のエンジンの分析の一環として、以下を調べました。</font></font><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コアwf</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フローライト</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K2ワークフロー</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワークフローのコア</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼーベ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワークフローエンジン</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">耐久性のあるタスクフレームワーク</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カムンダ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オルレアンの活動</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レビューしたソリューションにすべての要件を課し、有料ソリューションのコストを追加した結果、エンジンはそれほど高価ではないが、要求に100％適合し、簡単に改良できると考えました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装/アーキテクチャ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前の実装では、WFモジュールは、WFライブラリが接続されているWCFサービスでした。彼はプロセスインスタンスを作成し、プロセスを開始し、ビジネスロジック（開発者が作成したコード）を含むブロックを実行することができました。これはすべてIISアプリケーションでホストされていました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい実装では、マイクロサービスアーキテクチャのトレンドに従って、サービスをすぐに2つに分割することにしました。ワークフロープロセスサービス（WPS）とワークフローブロックサービス（WBS）で、別々にホストすることもできます。このチェーンのもう1つのリンクは、DirectumRXシステムとビジネスロジックを実装するアプリケーションサービスであり、クライアントはそれを使用します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WPSはスキームに従って「ウォーク」し、WBSはブロックを処理し、すべてのステップでビジネスロジックを実行します。</font><font style="vertical-align: inherit;">プロセスを開始するコマンドは、アプリケーションサーバーから送信されます。</font><font style="vertical-align: inherit;">サービス間の相互作用は、RabbitMQを使用して実行されます。</font><font style="vertical-align: inherit;">以下では、それぞれについて詳しく説明します。</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lh/-u/ae/lh-uaeasg_8-9xjjtoif5ff1ycg.png"></div><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wps</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワークフロープロセスサービスは、プロセスの開始とプロセスダイアグラムのバイパスを担当するマイクロサービスです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスリポジトリには、バージョン管理をサポートするプロセス図と、プロセスインスタンスのシリアル化された状態が含まれています。</font><font style="vertical-align: inherit;">MS SQLとPostgresをストレージとして使用できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサービスは、RabbitMQを介して他のサービスから受信したメッセージを処理できます。</font><font style="vertical-align: inherit;">基本的に、メッセージはサービスAPIです。</font><font style="vertical-align: inherit;">サービスが受信できるメッセージのタイプ：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StartProcess-新しいプロセスインスタンスを作成し、クロールを開始します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CompleteBlock-ブロックの完了。このメッセージの後で、サービスはプロセスインスタンスをスキームに沿ってさらに移動します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suspend / ResumeProcess-たとえば、ブロックの処理中のエラーが原因でプロセスインスタンスの実行を中断し、エラーが修正された後で実行を再開します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abort / RestartProcess-プロセスインスタンスの実行を停止して再開します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeleteProcess-プロセスインスタンスを削除します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スキームは、ブロックとブロック間の接続（面）で構成されます。</font><font style="vertical-align: inherit;">各顔には識別子、いわゆる「実行結果」があります。</font><font style="vertical-align: inherit;">ブロックには5つのタイプがあります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StartBlock</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロック</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OrBlock;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndBlock;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FinishBlock。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nu/xw/16/nuxw16yktjqodwjbaxmevmogcgk.png" alt="画像"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WPSでのスキーム</font></font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の表示メッセージがプロセスの開始時に到着すると、サービスはインスタンスを作成し、スキームに沿って「ウォーク」し始めます。スキームに従って「ウォーキング」を担当するクラスは、冗談めかして「ステッパー」と呼ばれます。回路は常にStartBlockで始まります。次に、ストライダーはすべての外向きの顔を取り、それらをアクティブにします。各ブロックは、「AND」ブロックの原理に従って機能します。ブロックをアクティブにするには、すべての入力面がアクティブでなければなりません。次に、アルゴリズムはアクティブ化できるブロックを決定し、WBSメッセージを送信してこれらのブロックをアクティブ化します。 WBSはブロックを処理し、WPSの結果を返します。実行の結果に応じて、ストライダーはアクティブ化のためにブロックから出てくる適切な顔を選択し、プロセスが続行されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発プロセス中に、ブロック間の循環接続に関連する興味深い状況に遭遇しました。これにより、アクティブ化/終了するブロックを決定するときにロジックが追加されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスは自律的です。</font><font style="vertical-align: inherit;">必要なのは、彼にスキーマをJson形式で送信し、独自のブロックハンドラーを記述して、メッセージを交換することだけです。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WBS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワークフローブロックサービスは、ブロック図を処理するサービスです。</font><font style="vertical-align: inherit;">サービスは、タスク、タスクなどのビジネスロジックの本質を認識しています。</font><font style="vertical-align: inherit;">これらのエンティティは、DirectumRX Development Studio（DDS）開発環境に追加できます。</font><font style="vertical-align: inherit;">たとえば、ブロックにはブロックを開始するイベントがあります。</font><font style="vertical-align: inherit;">このイベントハンドラのコードは開発者がDDSで記述し、WBSがこのコードを実行します。</font><font style="vertical-align: inherit;">実際、これはブロックハンドラーの実装であり、独自のものに置き換えることができます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスはブロックの状態を保存します。</font><font style="vertical-align: inherit;">基本的なプロパティ（Id、State）に加えて、ブロックには、ブロックの実行/終了/一時停止に必要な他の情報が含まれる場合があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロックは次の状態にある可能性があります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完了-ブロックの作業が正常に完了した後、この状態になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留中-ブロック内で何らかの作業が行われているとき、たとえばユーザーからの何らかの応答が必要なとき、スタンバイ状態になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中止-プロセスが停止すると、この状態になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一時停止-エラーが発生してプロセスが停止すると、この状態になります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メッセージがブロックの実行に到着すると、ブロックが実行され、WBSはブロックの実行結果を含むメッセージを送信します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーラビリティ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WPSとWBSは複数のインスタンスに展開できます。ある時点では、1つのWPSサービスのみが1つのプロセスインスタンスを処理できます。同じことがブロックの処理にも当てはまります。1つのプロセスインスタンスが一度に処理できるブロックは1つだけです。これは、処理中にプロセスにかけられるロックによって支援されます。 1つのプロセスのプロセス/ブロックを処理するためにキューに複数のメッセージがある場合、メッセージはしばらく延期されます。同時に、各サービスは複数のプロセスインスタンスで同時に作業を実行できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロック（並列分岐）を処理するために、いくつかのメッセージが1つのプロセスに次々と入ってくると、状況が発生することがあります。</font><font style="vertical-align: inherit;">メッセージを延期する必要がある状況の数を減らすために、WBSは一度に複数のメッセージを取得し、次々に実行して、プロセスのブロックのために再実行のためにキューへの送信をバイパスします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変換</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいエンジンへの移行後、疑問が生じました。既存のプロセスインスタンスをどうするか。好まれたオプションは彼らの転換でした、それで彼らは新しいエンジンで働き続けました。利点は明白です。1つのエンジンのみをサポートしているため、古いエンジンをサポートするという問題は解消されます（上記を参照）。しかし、シリアル化されたプロセスインスタンスから必要なデータを取得する方法を理解できないリスクがありました。フォールバックもありました。古いエンジンで既存のインスタンスをファイナライズし、新しいインスタンスで新しいインスタンスを起動することです。このオプションの短所は、前のオプションの長所に続き、両方のエンジンをひねるには追加のリソースが必要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変換のために、プロセスの古い状態をWF形式で取得し、プロセスとブロックの状態を生成する必要がありました。データベース内のプロセスインスタンスのシリアル化された状態を取得し、そこからアクティブなブロックのリスト、フェイスの実行結果を引き出し、仮想的にプロセスを実行するユーティリティを作成しました。その結果、変換時のインスタンスの状態を取得しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFでプロセスインスタンスデータを適切に逆シリアル化する方法に問題が発生しました。</font><font style="vertical-align: inherit;">プロセスインスタンス（インスタンス）WFの状態は、xamlの形式でデータベースに格納されます。</font><font style="vertical-align: inherit;">このxamlの構造の明確な説明が見つからなかったため、すべてを経験的に取得する必要がありました。</font><font style="vertical-align: inherit;">データを手動で解析し、必要な情報を引き出しました。</font><font style="vertical-align: inherit;">このタスクの一部として、別のオプションを考え出しました。WFツールを使用してインスタンスの状態を逆シリアル化し、オブジェクトから情報を取得しようとしました。</font><font style="vertical-align: inherit;">しかし、そのようなオブジェクトの構造は非常に複雑であったため、このアイデアを放棄し、xamlを「手動で」解析することにしました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、変換は成功し、すべてのプロセスインスタンスが新しいエンジンによって処理され始めました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
では、ワークフローエンジンは何を提供してくれましたか？</font><font style="vertical-align: inherit;">実際、記事の冒頭で述べたすべての問題を打ち負かすことができました。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンジンは.NET Coreで記述されています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IISから独立したセルフホストサービスです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト運用として、企業システムで新しいエンジンを積極的に使用し、バグの分析にかかる時間を大幅に短縮できることを確認しています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予備データによると、Postgresで負荷テストを実施しました。WPS+ WBSの束で5000ユーザーの負荷に問題なく対処できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、興味深い作品と同様に、これは興味深い体験です。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おまけとして、私たちは自分自身に適応できる明確でサポートされたコードを得ました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンジンのコストは、サードパーティ製品の購入/改造に費やす必要があるものと同等であることが判明しました。</font><font style="vertical-align: inherit;">現時点では、独自のエンジンを開発する決定は正当化されたと私たちは信じています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、10,000人以上の同時ユーザーの負荷テストも待っています。</font><font style="vertical-align: inherit;">おそらくいくつかの最適化が必要になるでしょうか、それともうまくいくでしょうか？</font><font style="vertical-align: inherit;">;-) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、新しいワークフローを含むDirectumRX 3.2をリリースしました。</font><font style="vertical-align: inherit;">エンジンが顧客にどのように表示されるかを見てみましょう。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468789/index.html">2. Check Point Maestroの一般的な使用例</a></li>
<li><a href="../ja468791/index.html">知っておく価値のある2つの興味深い人間の脳の実験</a></li>
<li><a href="../ja468793/index.html">私たちは暗号通貨天秤座を扱います。細部</a></li>
<li><a href="../ja468797/index.html">目の焦点距離。それは何ですか？（更新）</a></li>
<li><a href="../ja468799/index.html">初心者のための反応または悪いヒントのアンチパターン</a></li>
<li><a href="../ja468805/index.html">System.Console、Mono、NCurses</a></li>
<li><a href="../ja468811/index.html">Technologies Yandex Turbo Pagesとeコマース向けGoogle AMP</a></li>
<li><a href="../ja468815/index.html">Apache、ViewState、および逆シリアル化</a></li>
<li><a href="../ja468817/index.html">公開鍵標準に基づく暗号ワークステーション。SSL証明書を発行します。エピローグ</a></li>
<li><a href="../ja468819/index.html">電報番号開示v.2-ソーシャルエンジニアリング</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>