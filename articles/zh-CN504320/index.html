<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔍 👝 👩🏾‍🚀 使用Linux的PVS-Studio C＃进行单行代码或Nethermind验证 👵🏽 🖤 🎦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文致力于启动针对Linux的PVS-Studio C＃beta测试以及Rider插件。出于如此奇妙的原因，使用这些工具，我们检查了Nethermind产品的源代码，在本文中，我们将介绍一些有趣且有时很有趣的错误。
 
 Nethermind是Linux，Windows，MacOs的.NET Cor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用Linux的PVS-Studio C＃进行单行代码或Nethermind验证</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="图片1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文致力于启动针对Linux的PVS-Studio C＃beta测试以及Rider插件。</font><font style="vertical-align: inherit;">出于如此奇妙的原因，使用这些工具，我们检查了Nethermind产品的源代码，在本文中，我们将介绍一些有趣且有时很有趣的错误。</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是Linux，Windows，MacOs的.NET Core以太坊的快速客户端。</font><font style="vertical-align: inherit;">设置以太坊或dApps专用网络时，可以在项目中使用它。</font><font style="vertical-align: inherit;">Nethermind是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开放源代码</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于GitHub上。</font><font style="vertical-align: inherit;">该项目成立于2017年，并且在不断发展。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你喜欢体力劳动吗？例如，例如在程序代码中查找错误。同意，阅读和分析您编写的网站或整个项目以寻找一些棘手的bug相当繁琐。好吧，如果项目很小，那么假设有5,000条线，但是如果它的规模已经超过了十万或一百万条线呢？而且，它是由不同的程序员编写的，有时不是很容易理解的形式。在这种情况下该怎么办？您是否真的必须睡在某个地方，一个被低估的地方以及100％的时间才能意识到所有这些无尽的线索，以便了解这个令人讨厌的错误在哪里？我怀疑您想这样做。那么该怎么办，也许有现代化的方法可以使它自动化？</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="图3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后像静态代码分析器这样的工具开始起作用。</font><font style="vertical-align: inherit;">静态分析器是用于检测程序源代码中的缺陷的工具。</font><font style="vertical-align: inherit;">与手动验证相比，此工具的优势如下：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几乎不花时间寻找错误的位置（至少肯定比用眼睛寻找失败的复制粘贴要快）；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不累，不像一个人经过一段时间的搜索后需要休息；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道很多人甚至可能不知道的错误模式； </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用诸如数据流分析，符号执行，模式匹配等技术；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使您能够定期和随时进行分析；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，使用静态代码分析器不会替换或取消代码检查。</font><font style="vertical-align: inherit;">但是代码审查变得越来越有效率和有用。</font><font style="vertical-align: inherit;">您可以专注于发现高级错误，转移知识，而不是费力地阅读代码以查找错别字。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您有兴趣阅读更多有关它的内容，那么建议您阅读</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及有关</font><font style="vertical-align: inherit;">PVS-Studio中使用</font><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文章</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于Linux / macOS的PVS-Studio C＃</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，我们正在将C＃分析器移植到.NET Core，并且我们也在积极开发IDE Rider的插件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您有兴趣，可以通过填写</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此页面上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的表格来注册Beta测试</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">安装说明将发送到您的邮件中（不用担心，这很简单）以及使用分析仪的许可。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是带有PVS-Studio插件的Rider的外观：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="图片4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有点愤慨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想说的是，在某些地方很难阅读Nethermind的源代码，因为其中300-500个字符的行很正常。</font><font style="vertical-align: inherit;">是的，所有代码都没有一行格式化。</font><font style="vertical-align: inherit;">例如，这些行包含多个三元运算符和逻辑运算符，并且那里什么也没有。</font><font style="vertical-align: inherit;">通常，享受从王座游戏的最后一个赛季开始。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将解释一些以了解范围。</font><font style="vertical-align: inherit;">我有一台长约82厘米的UltraWide显示器。</font><font style="vertical-align: inherit;">如果您以全屏方式在其上打开IDE，则它将适合340个字符。</font><font style="vertical-align: inherit;">也就是说，我所谈论的界限甚至不合适。</font><font style="vertical-align: inherit;">如果您想看一下它的外观，我在GitHub上留下了指向文件的链接：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件链接</font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接到文件</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接到文件</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
现在想象在这样的部分中发生错误，寻找它会令人愉悦吗？</font><font style="vertical-align: inherit;">我确定不是这样，每个人都知道不可能这样写。</font><font style="vertical-align: inherit;">顺便说一句，这个项目中有一个类似的地方出错。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证结果</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不喜欢0的条件</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能索引超出范围。</font><font style="vertical-align: inherit;">索引“ 0”指向“字节”界限之外。</font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要注意错误，请考虑数组中元素的数量为0的情况。然后，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件</font><font style="vertical-align: inherit;">为true，并且访问数组element时将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引发</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">类型为0</font></i><font style="vertical-align: inherit;">的</font><i><font style="vertical-align: inherit;">indexOutOfRangeException</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他们想在数组为空或0元素等于某个值时立即退出此方法，但似乎他们不小心混淆了“ ||” </font><font style="vertical-align: inherit;">与“ &amp;&amp;”。</font><font style="vertical-align: inherit;">我建议按以下方式解决此问题：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能索引超出范围。</font><font style="vertical-align: inherit;">索引“ 0”指向“ typesInGroup”界限之外。</font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发生类似于上述情况。</font><font style="vertical-align: inherit;">如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的元素数</font><font style="vertical-align: inherit;">等于0，则在访问0元素时，将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抛出IndexOutOfRangeException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的</font><i><font style="vertical-align: inherit;">异常</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅在这种情况下，我才不了解开发人员的需求。</font><font style="vertical-align: inherit;">最有可能的是，</font><font style="vertical-align: inherit;">您需要编写</font><i><font style="vertical-align: inherit;">null</font></i><font style="vertical-align: inherit;">，而不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误或未完成的优化？</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过循环内的常量索引可疑访问'currentLevel.BlockInfos'对象的元素。 Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
乍看之下，该错误是显而易见的-循环旨在</font><font style="vertical-align: inherit;">遍历</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">，但是在访问</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [i]时，他们</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上固定0，</font><font style="vertical-align: inherit;">任务完成。但是不要着急，让我们弄清楚。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">null元素</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlockHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果等于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么我们从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos中获取</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有不相等的元素</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对其进行写入并退出循环。</font><font style="vertical-align: inherit;">事实证明，该循环是多余的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我认为以前有一种算法，他们决定使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行更改/优化</font><font style="vertical-align: inherit;">，但是出了点问题。</font><font style="vertical-align: inherit;">现在，如果条件为假，我们将得到无意义的迭代。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一句，如果编写此文档的开发人员将使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量分析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">，那么他立即意识到有些问题是错误的，并且可以快速修复所有问题。</font><font style="vertical-align: inherit;">此刻，我将像这样重写代码：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取消引用空引用</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解除引用1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在验证是否为null之前，已使用'_logger'对象。检查行：118，118。Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误的顺序错误。首先是要上诉</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有经过是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger检查</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的情况下</font><font style="vertical-align: inherit;">，我们将获得</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的异常</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取消引用2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在验证为空之前使用了'_enode'对象。</font><font style="vertical-align: inherit;">检查行：55、56。Nethermind.JsonRpc AdminModule.cs 55该</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误与上述完全相同，仅这次是罪魁祸首是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我要补充一点，如果您忘记检查是否为null，那么仅在程序崩溃时记住这一点。</font><font style="vertical-align: inherit;">分析仪会提醒您这一点，一切都会好起来的。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们最喜欢的复制粘贴</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '&amp;&amp;'运算符的左侧和右侧有相同的子表达式'a.s2 == b.s2'。</font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此相同条件被检查2次：</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有字段</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此我假设在复制时我们只是忘记将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，参数相等的频率比代码作者期望的更频繁。同时，一些开发人员认为他们不这样做，而是开始在一个完全不同的地方寻找错误，这花费了很多精力和神经。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一下，比较函数中的错误通常是经典的。显然，程序员认为这样的功能很简单，所以他们的写作非常随意和漫不经心。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证明</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。知道了这一点，现在要小心:)！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况二</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004'then</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '语句等效于'else'语句。 Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的任何值，该</font><font style="vertical-align: inherit;">方法将返回相同的值。很难说这是否是一个错误。假设程序员复制了一行并忘记将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode.Success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改</font><font style="vertical-align: inherit;">为其他内容，那么这是一个真正的错误。此外，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。但是代码重构很可能是罪魁祸首，无论如何我们都不在乎</font><i><font style="vertical-align: inherit;">acceptedLocally的</font></i><font style="vertical-align: inherit;">值</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下，条件变成让您坐下来思考是否错误的地方。</font><font style="vertical-align: inherit;">因此，无论如何，这种情况是非常不愉快的。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004'then</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '语句等效于'else'语句。</font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，我们也不关心验证，因为最终我们得到的是相同的东西。</font><font style="vertical-align: inherit;">我们再次坐下来苦苦思索，但是开发人员想在这里写些什么。</font><font style="vertical-align: inherit;">通过使用静态分析并立即修复此类含糊的代码，可以避免浪费时间。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">案例4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两个带有相同条件表达式的'if'语句。第一个'if'语句包含方法return。这意味着第二个“ if”语句是毫无意义的Nethermind.Network.Benchmark InFlowBenchmarks.cs 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只需再次</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按Ctrl + V即可</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们删除了多余的支票，一切都很好。我敢肯定，如果其他一些条件在这里很重要，那么每个人都会在一个写</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过逻辑运算符，一</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">箱5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3030</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期检查。</font><font style="vertical-align: inherit;">'_logger.IsInfo'条件已在第242行中得到验证。Nethermind.Synchronization SyncServer.cs 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与第四种情况一样，将执行额外的检查。</font><font style="vertical-align: inherit;">但是，区别在于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅具有一个属性，而且还具有例如' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '。</font><font style="vertical-align: inherit;">因此，代码可能看起来像这样：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，或者代码重构的所有错误，不再需要检查。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">案例6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">表达式'missingParamsCount！= 0'始终为true。</font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查条件（missingParamsCount！= 0），如果为true，则再次进行计算并将结果分配给变量。</font><font style="vertical-align: inherit;">同意这是一种相当真实的写作方式。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令人困惑的支票</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">V3022</font></a><font style="vertical-align: inherit;">表达式'i == 0'始终为false。</font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们按顺序开始。</font><font style="vertical-align: inherit;">初始化时，变量</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i被</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赋值为1。接下来，变量仅递增；因此，该值将始终传递给函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们看一下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感兴趣</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根据此参数的名称判断，它负责确定某方是否是第一个。</font><font style="vertical-align: inherit;">嗯首先 </font><font style="vertical-align: inherit;">让我们在上面再次查看，发现使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有2个调用</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不要忘了，在这种情况下，倒计时从1变为事实证明，我们有2个选择：要么“第一”的意思指数1下一个元素，或在索引为0。但在任何情况下，这</font><font style="vertical-align: inherit;">将等于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，函数调用应如下所示：</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或像这样：</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，如果开发人员经常使用静态分析器，那么他将编写此代码并看到警告，将迅速修复它并享受生活。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优先权 ？？</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告： </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123也许是“ ??” </font><font style="vertical-align: inherit;">操作员的工作方式与预期不同。</font><font style="vertical-align: inherit;">它的优先级低于其左侧的其他运营商的优先级。</font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123也许是“ ??” </font><font style="vertical-align: inherit;">操作员的工作方式与预期不同。</font><font style="vertical-align: inherit;">它的优先级低于其左侧的其他运营商的优先级。</font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析器建议您检查我们如何使用“ ??”运算符，并了解问题所在，因此建议考虑以下情况。</font><font style="vertical-align: inherit;">我们在这里看这行：</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是常量：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，为清楚起见，我建议重写字符串，替换其值：</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在假设</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（8 + null）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将为null </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们得到了表达（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），这将返回20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，只要</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从价值</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是会回来，</font><font style="vertical-align: inherit;">不管是什么存储在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一行的片段类似。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是问题是，开发人员是否想要这种行为？让我们看一下下面的行：</font></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，与上面</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的部分一样，将</font><i><font style="vertical-align: inherit;">MemorySizes.RefSize</font></i><font style="vertical-align: inherit;">添加到表达式中，但是</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，在第一个“ +”运算符之后有一个括号。</font><font style="vertical-align: inherit;">事实证明，</font><font style="vertical-align: inherit;">我们应该</font><font style="vertical-align: inherit;">向</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加一些表达式，如果它为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么我们将添加另一个</font><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，代码应如下所示：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，这只是一个假设，但是，如果开发人员想要其他行为，则应该明确指出：</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，阅读此代码的人就不必长时间研究这里发生的事情以及程序员想要的东西。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况二</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也许是“ ??” </font><font style="vertical-align: inherit;">操作员的工作方式与预期不同。</font><font style="vertical-align: inherit;">它的优先级低于其左侧的其他运营商的优先级。</font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，该操作的优先级是“ ??”，因此，正如上一次一样，我们考虑这种情况。</font><font style="vertical-align: inherit;">我们在这里看这行：</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假设</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后为清楚起见，请立即更换相关的一切</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">替换一个随机值</font><font style="vertical-align: inherit;">，而不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expectedParameters.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们立即注意到有两项类似的检查，只有一种情况下有括号，而另一种情况下有括号。让我们运行这个例子。首先我们得到（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将返回0，然后从100中减去0并得到100：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们不再完全执行“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”，最后得到（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），而不是。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先它将执行（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），然后得到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。然后，它检查（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），这导致missingParamsCount变量的值为0。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于下一个条件是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于零，因此我们可以假定这是开发人员所寻求的行为。我会说，为什么不放在方括号中并明确表达我的想法呢？通常，此检查可能是由于误解了有时返回0的原因，而这仅仅是拐杖。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再一次，尽管我们可能没有这样做，但我们还是在浪费时间；在编写代码时使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量分析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我希望我能向您传达的是，静态分析仪是您的朋友，而不是邪恶的监督者，他只是在等您犯错。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还应该注意的是，通过一次使用或很少使用分析仪，您当然会发现错误，并且其中一些错误甚至会很快得到解决，但也有一些错误需要您的注意。</font><font style="vertical-align: inherit;">因此，您需要不断使用静态分析仪。</font><font style="vertical-align: inherit;">然后，您将发现更多错误，并在编写程序代码时纠正了这些错误，并且您完全了解要执行的操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个简单的事实是，每个人都会犯错，这很正常。</font><font style="vertical-align: inherit;">我们都从错误中学习，但只能从那些能够注意到和理解的错误中学习。</font><font style="vertical-align: inherit;">因此，请使用现代工具搜索这些错误，例如-PVS-Studio。</font><font style="vertical-align: inherit;">谢谢您的关注。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您想与讲英语的读者分享这篇文章，请使用以下链接：Nikolay Mironov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Linux的PVS-Studio C＃进行单行代码或Nethermind的检查</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN504296/index.html">在Python中生成随机分支</a></li>
<li><a href="../zh-CN504306/index.html">如何在Elbrus上制造用于存储Aerodisk Vostok的俄罗斯硬件</a></li>
<li><a href="../zh-CN504310/index.html">数据二分法：重新考虑与数据和服务的关系</a></li>
<li><a href="../zh-CN504312/index.html">俄语程序和GPL的统一注册。我的五分钱</a></li>
<li><a href="../zh-CN504314/index.html">通过HTTP请求在没有docker client的情况下实现docker pull和docker push命令</a></li>
<li><a href="../zh-CN504326/index.html">叶夫根尼·迪基伊（Evgeny Dikiy）：“在当地，南极洲受到的污染最少，但是全球污染在这里非常明显”</a></li>
<li><a href="../zh-CN504328/index.html">在莫斯科杜马2019年举行的电子投票课程</a></li>
<li><a href="../zh-CN504332/index.html">有用的帖子：所有最相关的课程，广播和技术流</a></li>
<li><a href="../zh-CN504334/index.html">Насколько хорошо вы знаете JavaScript?</a></li>
<li><a href="../zh-CN504338/index.html">USB over IP в домашних условиях</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>