<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏌️ 🚺 👪 我如何使用Node-RED自动化公寓的故事。第二部分 🤱 🌴 🍻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="关于公寓自动化的职位期待已久的延续。在这一部分中，我将讨论照明，多媒体系统和安全传感器。
 
 
 
 灯光
 为了控制照明，使用了几个组件：
 
 

- 电动窗帘
- 可调光照明。
 闪耀
 房间的灯光分为两个区域。我使用ikeev LED可调光灯。我使用三个模块进行控制：
 
 内置调光器FI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>我如何使用Node-RED自动化公寓的故事。第二部分</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/489774/"><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于公寓自动化的职位</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期待已久的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">延续</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这一部分中，我将讨论照明，多媒体系统和安全传感器。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/89/pw/1w/89pw1w8yo0rpgru9rx1cckulooc.png"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">灯光</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了控制照明，使用了几个组件：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电动窗帘</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可调光照明。</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">闪耀</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
房间的灯光分为两个区域。</font><font style="vertical-align: inherit;">我使用ikeev LED可调光灯。</font><font style="vertical-align: inherit;">我使用三个模块进行控制：</font></font><br>
<img src="https://habrastorage.org/webt/4h/94/fp/4h94fp3qxcxmwpmqqi2kmeecuuo.jpeg" alt="内置调光器FIBARO Dimmer 2"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置调光器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO Dimmer 2</font></font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/tn/sh/7ntnshtkobrl2nsbrlijuj5ujre.jpeg" alt="内置双继电器FIBARO双开关2x1.5kW"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置双继电器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO双开关2x1.5kW</font></font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/av/ju/nz/avjunzs_vw57crfbzkqcrlsc-sa.jpeg" alt="内置继电器FIBARO单开关2.5kW"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置继电器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO单开关2.5kW</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
调光器可以自动选择调光方法（在相位的前缘和后缘）并进行校准以实现最小和最大亮度。</font><font style="vertical-align: inherit;">由于我预先为所有插座配备了三线系统，因此不必使用旁路。</font><font style="vertical-align: inherit;">没有电压时，LED灯不会闪烁，也不亮。</font><font style="vertical-align: inherit;">对于可调光模块，我使用铃声开关，以便您可以调节亮度。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/f7/dl/9vf7dlpauw3strd9emtimu-ct7w.png" alt="     "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三线调光器接线图</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
运作方式如下：</font></font><br>
<br>
<ul>
<li>  -    ,       (     ).</li>
<li>      -    ,          —    .         .      ,      .</li>
<li>      ,   ,   .        —   .</li>
<li>   ,         .    ,    1% .</li>
<li>      ,    15   .</li>
<li>    ,   .</li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/yj/wi/w2/yjwiw2pdfhu75m12gjyckm77l4e.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ll/46/nj/ll46nj_cya6jsqp5psnpvs1mzbc.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/dl/9h/jp/dl9hjpmwyo23zbxv7drmykp9sfm.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/kg/cl/md/kgclmdshmkmuagjrnidhbh40mhu.png" alt="  "></a><br>
<font color="#909090">  </font><br>
<br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如我先前所写，我公寓的所有窗户都俯瞰繁华的街道，光线明亮。为了解决夜间或夏季从明亮的太阳发出的灯发出的强光的问题，我使用了电动卷帘。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起初我想购买现成的工具包，但价格很高，而且我不喜欢配色方案。这个想法必须舍弃，并自行组装几套。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在220 V发动机中，选择很小：法国的尚飞或中国的Dooya。尚飞更安静，但也更昂贵，因此选择使用Dooya DM35S发动机。我在“ Aliexpress”上订购了它们以及紧固件。发动机有两个限位开关，可调节最大和最小位置。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qj/yw/06/qjyw064wkqndni2rppwdvzzkdz0.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带座发动机</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下一个问题是用于缠绕窗帘的管道。根据邮件的规则，您可以发送不超过180厘米的包裹，我拥有的窗户之一超过2米。在最近的建筑市场上，我发现了所需直径的铝管-50 mm。将发动机安装在管道中后，仍然可以找到遮光窗帘。在与卖方达成协议后，我从“ Aliexpress”订购了我的尺码的面料，他只向我发送了面料，没有任何机制。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/cy/pm/5jcypmbghomntcc_bolirecpmya.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定组装窗帘的</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
帘使用控制</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIBARO卷帘2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Z-波盲控制模块。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">百叶窗</font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/p-/yn/u2/p-ynu2giqo5wktxhwyb3h7onz0u.jpeg" alt="  "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制模块</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该模块内置在插槽中。对于此类模块，建议立即放置深插座以推动模块，电线和开关。该模块具有足够的设置，包括对警报的响应，功耗的计算，限位开关的校准。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ow/bc/ub/owbcubpc-6tca4tltprsmlj8s74.jpeg" alt=" "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组装好的开关</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
窗帘安装在每个房间和厨房中。您可以通过窗帘旁边的开关或使用界面或脚本来控制窗帘。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当黄昏开始并且路灯打开时，窗帘会自动降低。它们根据工作日和周末每个房间的编程时间上升。如果外面是黑暗的，则在放下窗帘的房间里，光线开始平稳开启。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据下载的生产日历计算工作日和周末。</font><font style="vertical-align: inherit;">您可以使用telegram命令为每个房间重新配置第二天的时间。</font><font style="vertical-align: inherit;">在按照“闹钟”折叠窗帘之前，会收到一条电报消息，其中包含确认，取消和重新安排30分钟的功能。</font><font style="vertical-align: inherit;">如果没有采取措施，窗帘将自动折叠。</font><font style="vertical-align: inherit;">在晴朗的日子里，窗帘会根据房间的灯光和一天中的时间自动设置位置，并检查灯光是否打开。</font><font style="vertical-align: inherit;">收到“度假”命令后，所有房间的所有窗帘均被放下。</font><font color="#909090"><font style="vertical-align: inherit;">窗帘</font></font><font color="#909090"><font style="vertical-align: inherit;">管理方案窗帘管理方案</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/-w/j0/na/-wj0na6ajgmspxvn9ul-vfxesri.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/vj/1h/6z/vj1h6z5-dl53n-44smy6edp89iq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dsvjkFMLkcQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作实例</font></font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多媒体系统</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我在客厅里有许多带各种遥控器的多媒体设备，我想用一个按钮控制它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在互联网上，我发现了用于打开和关闭放大器，电视和HDMI分配器的单独的IR代码。使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto_broadlink</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python脚本</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">，将</font></a><font style="vertical-align: inherit;">它们转码为base64，然后转换为字节数组并写入IR代码库。因此，现在不必知道设备现在处于什么状态：您只需再次发送信号即可。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于我的放大器很旧，并且不知道如何通过HDMI处理4K图像，因此我购买了HDMI分配器。它使您可以将视频和音频信号分成两个单独的HDMI：其中一个连接到放大器，第二个连接到电视。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/u_/4y/ydu_4yehplzjy-aqnc_lohuxbwo.jpeg" alt="   "><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放大器和其他设备</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，我有两个音频和视频源：一台台式计算机和一台服务器。在界面上，您可以使用一个按钮打开所有设备进行播放，仅在一种情况下，将在服务器上的分配器上配置信号接收，在第二种情况下，将通过计算机配置信号接收。将来，计划将游戏机连接到拆分器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果所有人都离开家，则所有多媒体设备都将关闭。</font><font color="#909090"><font style="vertical-align: inherit;">媒体控制现场</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/6e/li/w3/6eliw3ospeig-4jdz0vzibq3scq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
存在系统在6个运动传感器和一个前门打开传感器上运行。</font><font style="vertical-align: inherit;">如果在打开和关闭门后没有触发任何一个占用传感器，则会在一定间隔内将消息发送给Telegram进行确认。</font><font style="vertical-align: inherit;">如果两分钟内未执行任何操作或按下“确定”按钮，则系统将切换到“外出”模式。</font><font style="vertical-align: inherit;">如果此时发生移动，则取消命令并删除消息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我尝试使用BLE，但就我而言，它不能非常稳定地工作，并且严重依赖电话发送器。</font><font color="#909090"><font style="vertical-align: inherit;">自动存在检测</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/r_/if/x8/r_ifx8nmt01pioisfqkdalu35x8.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全传感器</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gidrolock</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
锁定装置安装在水管上</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当控制线短路相时，执行器将关闭分接头；当断开控制线时，它将打开。</font><font style="vertical-align: inherit;">两个驱动器都连接到</font><font style="vertical-align: inherit;">干式触点</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置继电器</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ys/tx/3i/ystx3iuuvzjpm_yso_wthzk_g5u.jpeg" alt=" Gidrolock"><br>
<font color="#909090"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gidrolock</font></font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
继电器</font><font color="#909090"><font style="vertical-align: inherit;">驱动</font></font><font style="vertical-align: inherit;">器由</font><font style="vertical-align: inherit;">位于潜在泄漏区域的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NEO Coolcam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Z-Wave传感器控制</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有传感器都直接与继电器相关联，因此无需控制器参与即可关闭水。</font><font style="vertical-align: inherit;">为防止水龙头变酸，晚上每两周自动将其打开和关闭。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Philio抽烟传感器</font></a><font style="vertical-align: inherit;"> 
时的</font><font color="#909090"><font style="vertical-align: inherit;">驱动器自动化图</font></font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/d6/oi/wi/d6oiwiu4axhpwaizc46i4ongyeq.png" alt="  "></a><br>
<font color="#909090"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭通风，以免引起火灾。</font><font style="vertical-align: inherit;">同时，一条消息被发送到电报聊天室，传感器发出令人作呕的尖叫声。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他传感器和设备</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传感器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6合1多传感器Aeotec多传感器6</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">NEO Coolcam</font></a><font style="vertical-align: inherit;">开幕</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传感器</font></font></a></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权服务器</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该模块是授权服务的简单实现。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有两种http方法：一种将检查请求是否来自内部网络，如果是，它将通过向用户颁发JWT令牌来授权用户。</font><font style="vertical-align: inherit;">JWT令牌使用RSA 256加密，必须在其旁边的文件中注册私钥。</font><font style="vertical-align: inherit;">如果请求不是来自内部网络，则该用户将被重定向到登录页面，该用户必须在其中输入登录名和密码并登录。</font><font style="vertical-align: inherit;">由于不应该划分为用户，因此加密文件（SHA 512）形式的登录文件和密码位于配置文件中。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT服务器</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MQTT服务器是使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aedes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组件实现的</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务器位于两个端口上：内部（用于未经授权与服务器通信）和外部（用于实现WebSocket）。</font><font style="vertical-align: inherit;">所有前端客户端都通过套接字连接，并在授权，订阅主题和发布任何消息期间通过身份验证。</font><font style="vertical-align: inherit;">从授权服务器收到的JWT令牌进来，并使用公共密钥进行了验证。</font><font style="vertical-align: inherit;">对于来自服务器的请求，不会进行验证。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义节点-RED节点</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在编写自动化程序时，需要实现一个额外的节点和两个节点来完成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我必须修改</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node-red-contrib-openzwave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为我的请求仅在7个月后才被接受，但是现在您可以使用npm中的库了。改进包括抛出节点删除事件。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/r4/nu/khr4nu0e2xikiinmz6wcxkslhea.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MQTT节点也已完成。实际上，它的主要改进是提取已连接客户端的ID，并在将其发送到队列时将其写回。在这里，您可以使用子流功能。还应该将任何数据传输到MQTT节点的输入，但是它没有用。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/xu/mb/efxumb_9d6wk07dbzc5ippu3pec.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了控制窗帘和水龙头，需要一个调度节点。</font><font style="vertical-align: inherit;">当时库中可用的功能过于丰富，不支持使用CRON的简单实现。</font><font style="vertical-align: inherit;">我的实现非常简单：可以在节点的输入处制定时间表，也可以在内部设置时间表。</font><font style="vertical-align: inherit;">可以取消时间表。</font><font style="vertical-align: inherit;">在幕后，使用了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点计划</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qa/ku/a1/qakua12yqbuuz8gkchotr2nj4ps.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">面前</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该公寓的每个活动组件都由自动化组成，位于前端。</font><font style="vertical-align: inherit;">每个模块都是独立的，包含用于渲染的所有必要组件。</font><font style="vertical-align: inherit;">模块分为两个集合：静态和Z-Wave。</font><font style="vertical-align: inherit;">模块必须实现一个接口。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">export</span> interface INode {
    <span class="hljs-attr">id</span>: string;<font></font>
    type: NodeTypes;<font></font>
    name: string;<font></font>
    addWidget: ComponentClass&lt;AddProps&gt; | StatelessComponent&lt;AddProps&gt;;<font></font>
    model: INodeModelConstructor;<font></font>
    service?: INodeServiceConstructor;<font></font>
    smallComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    bigComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    dialogEditComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
    dialogViewComponent: ComponentClass&lt;WidgetProps&lt;any&gt;&gt; | StatelessComponent&lt;WidgetProps&lt;any&gt;&gt;;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施实例</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseWidget</span> <span class="hljs-title">implements</span> <span class="hljs-title">INode</span> </span>{
    <span class="hljs-attr">model</span>: INodeModelConstructor = Model;<font></font>
    manufacturerid: string = <span class="hljs-string">'0x0086'</span>;<font></font>
    producttype: string = <span class="hljs-string">'0x1a02'</span>;<font></font>
    productid: string = <span class="hljs-string">'0x0064'</span>;<font></font>
    addWidget: StatelessComponent&lt;AddProps&gt; = AddWidget;<font></font>
    service: INodeServiceConstructor = Service;<font></font>
    smallComponent: StatelessComponent&lt;WidgetProps&lt;Model&gt;&gt; = SmallComponent;<font></font>
    bigComponent: StatelessComponent&lt;WidgetProps&lt;Model&gt;&gt; = BigComponent;<font></font>
    dialogEditComponent: ComponentClass&lt;WidgetProps&lt;Model&gt;&gt; = DialogEditComponent;<font></font>
    dialogViewComponent: ComponentClass&lt;WidgetProps&lt;Model&gt;&gt; = DialogViewComponent;<font></font>
}<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Widget;</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于静态模块（例如，空调），您需要在前端实现数据仓库。</font><font style="vertical-align: inherit;">这种实现很不方便，需要很好地将其更改为一个存储库，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于Z-Wave模块，我组织了一个公共存储库并跟踪了所有更改。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该模块通过两种方式实现显示：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于“大”屏幕（平板电脑，计算机）；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于电话。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据设备的类型，将选择触摸或鼠标控制。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该应用程序是使用webpack + babel构建的：根据当前设置，它是为Firefox，Chrome，Chrome Android的最后两个版本组装的。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码的功能</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source</font></font></b></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
All Flow禁用，以免在日志中引发错误。</font><font style="vertical-align: inherit;">Z-Wave的配置节点被删除：如果找不到Z-Wave控制器，则该节点有问题，并丢弃整个Node-RED。</font><font style="vertical-align: inherit;">它看起来应该像这样：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nt/up/cf/ntupcfzfm3ths5v6h6ys6-hnv2s.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使工作日历加载器正常工作，您需要在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.gov.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上注册，在其中</font><font style="vertical-align: inherit;">获取令牌并在access_token之后输入它：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fj/rs/rh/fjrsrhnxndutit6hgfrwic9kz5c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每15分钟</font><font style="vertical-align: inherit;">
从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">darksky.net</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font><font style="vertical-align: inherit;">一次</font><font style="vertical-align: inherit;">天气预报</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他还需要一个令牌，您需要注册并在预测后输入令牌到坐标：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bf/ka/kz/bfkakzodfw6mpsboylfszwjdurw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要发送电报通知，您需要获取您的机器人，将其输入到“电报”配置节点中，并在必要时编写聊天ID。</font><font style="vertical-align: inherit;">在我的流程的情况下，这是子流程：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mm/gm/xu/mmgmxuevhgbi_i8gosfkcm5tuow.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
源分为正面和反面。</font><font style="vertical-align: inherit;">在后面的部分是：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授权服务器。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT服务器。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义Node-RED模块。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将导出的流保存在一个文件中，该文件可以上传到您自己的帐户或单独的实例中进行测试。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node-RED的项目，您需要在其中安装模块，然后仅加载导出的Flow（模块已在项目中）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份Mongo-base。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github存储库</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的自述文件中找到更多详细的安装信息</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
计划将使用智能手机或壁挂式平板电脑的麦克风进行语音控制。</font><font style="vertical-align: inherit;">我计划将开放源代码系统部署在基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMU Sphinx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的服务器上</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我还计划组装一个模块，以获取和传输管道和电表的读数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还值得考虑使用各种参数的累积统计信息来优化自动化。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目前，我已经实现了房屋几乎完全自动化以满足我的需要-保持房屋内舒适的气候和照明。由于有些自动化，可以从加热元件一侧和从照明一侧减少电力消耗（与没有自动化的相同设备相比，冬天减少1,500₽）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，算法中仍然存在错误，但总有一天我会抓住它们，至少我朝这个方向发展。该系统运行稳定，尽管Z-Wave协议的速度非常低，但我看不到任何刹车。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，系统不会以节省成本为代价来收回成本，还有更多的舒适性问题。</font><font style="vertical-align: inherit;">这样的自动化在诸如关闭和打开窗帘，控制光之类的小事情上非常潮湿。</font><font style="vertical-align: inherit;">当您在普通公寓中时，有时会忘记打开或关闭灯，而根本不会打开窗帘。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我很少用手调节气候系统，但有时您需要打开或关闭空调或调节电池温度。</font><font style="vertical-align: inherit;">总的来说，我对最终的系统感到满意：它减少了花在任何调整上的时间。</font><font style="vertical-align: inherit;">控制器发生故障时，所有功能都将保留在原处（仅自动化会下降）。</font><font style="vertical-align: inherit;">断水功能也将保留。</font><font style="vertical-align: inherit;">如果我决定出售公寓，那么我将轻松删除所有自动化设备。</font><font style="vertical-align: inherit;">或将其放置在适当的位置，但可以增加销量。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489762/index.html">坦克世界解析和数据分析的简单示例</a></li>
<li><a href="../zh-CN489764/index.html">“目的地有很多伪装……”，或者我们使用CANNY 3 tiny和光敏电阻自动控制灯泡</a></li>
<li><a href="../zh-CN489768/index.html">π如何结合碰撞块和量子搜索算法</a></li>
<li><a href="../zh-CN489770/index.html">MinskJS mitap的视频：我的浏览器扩展报告</a></li>
<li><a href="../zh-CN489772/index.html">Yandex的Simferopol中的Hackathon。对话和聊天机器人技术定律</a></li>
<li><a href="../zh-CN489776/index.html">灰烬时代-第136期</a></li>
<li><a href="../zh-CN489778/index.html">新旧CSS。网页设计历史</a></li>
<li><a href="../zh-CN489782/index.html">FizzBu​​zz 2.0：程序员的实用问题</a></li>
<li><a href="../zh-CN489784/index.html">2月27日-新西伯利亚NX Bootcamp学生项目的开始</a></li>
<li><a href="../zh-CN489788/index.html">如何在Nintendo 64上玩？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>