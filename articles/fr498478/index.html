<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚å®Ô∏è ü•ë üî∂ Qu'est-ce que Windows PowerShell et que mange-t-il? Partie 5: Acc√®s aux objets externes üêØ ‚õ™Ô∏è üëçüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les syst√®mes d'exploitation Windows prennent en charge diverses infrastructures d'objets. Vous pouvez utiliser des interfaces de programmation d'appli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Qu'est-ce que Windows PowerShell et que mange-t-il? Partie 5: Acc√®s aux objets externes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498478/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-b/i_/73/-bi_73lwdxmnzvtveeghrwvtqay.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les syst√®mes d'exploitation Windows prennent en charge diverses infrastructures d'objets. </font><font style="vertical-align: inherit;">Vous pouvez utiliser des interfaces de programmation d'applications (API) pour y acc√©der, mais le d√©veloppement d'applications √† part enti√®re n'est pas toujours justifi√©. </font><font style="vertical-align: inherit;">PowerShell poss√®de des applets de commande sp√©ciales qui vous permettent d'acc√©der aux objets .NET, COM, WMI (CIM) et ADSI de mani√®re interactive. </font><font style="vertical-align: inherit;">Dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quatri√®me partie de la s√©rie,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous avons appris les bases en mettant l'accent sur les classes .NET Core, et maintenant nous voulons approfondir le sujet et comprendre les fonctionnalit√©s de l'interaction de PowerShell avec des objets externes.</font></font><a name="habracut"></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Table des mati√®res:</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec JSON, XML et CSV </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec WMI et CIM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec des objets COM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec le service d'annuaire ADSI </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formater la sortie</font></font></a><br>
<br>
<a name="section1"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec JSON, XML et CSV</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les scripts PowerShell, vous devez souvent analyser les donn√©es JSON, XML et CSV. Habituellement, ce besoin survient lorsque vous travaillez avec des services Internet ou avec des fichiers de configuration. Certains administrateurs tentent d'analyser les donn√©es √† l'aide d'expressions r√©guli√®res, mais il n'est pas n√©cessaire de faire de tels sacrifices: PowerShell dispose en outre d'applets de commande sp√©ciales pour la conversion dans les deux sens.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ep/q6/tr/epq6trkxgw_sfw21p1wmfixyrfk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le format JSON vous permet de d√©crire une vari√©t√© d'objets et, en substance, est une table de hachage qui peut √™tre imbriqu√©e. </font><font style="vertical-align: inherit;">La conversion d'un objet JSON en objet .NET en cons√©quence √† l'aide de PowerShell est facile. </font><font style="vertical-align: inherit;">√âtant donn√© que les services Internet donnent g√©n√©ralement une tr√®s longue ligne au lieu d'un fichier magnifiquement format√©, cette conversion peut √©galement √™tre utile pour travailler en mode interactif. </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessous, nous avons utilis√© une variable de texte multiligne pour d√©crire l'objet JSON:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-string">@"
{
   "firstName": "Ivan",
   "lastName": "Danko",
   "address": {
       "streetAddress": "Kremlin",
       "city": "Moscow"
   },
   "phoneNumbers": [
       "+7 495 1234567",
       "+7 499 1234567"
   ]
}
"@</span> | <span class="hljs-built_in">ConvertFrom-Json</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/vu/2j/x6/vu2jx6vrks90qvsuoehs6ky43ke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me inverse est r√©solu de mani√®re similaire:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$file</span> = <span class="hljs-built_in">Get-ChildItem</span> C:\Windows\System32\notepad.exe
<span class="hljs-variable">$file</span>.VersionInfo | <span class="hljs-built_in">ConvertTo-Json</span></code></pre><br>
<img src="https://habrastorage.org/webt/rd/tb/dq/rdtbdqlfwsepqmnggw_2uk7omkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cha√Æne de format JSON r√©sultante est facile √† envoyer √† une autre application sur le r√©seau. </font><font style="vertical-align: inherit;">Il peut s'agir, par exemple, d'un service RESTful. </font><font style="vertical-align: inherit;">Le travail avec les applets de commande ConvertFrom-Csv, ConvertTo-Csv et ConvertTo-Xml est construit de la m√™me mani√®re, nous proposons aux lecteurs de l'√©tudier eux-m√™mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour travailler avec XML et CSV, nous aurons besoin d'autres applets de commande: √† l' </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/hy/m7/jzhym7nqvb5id7fvdys9ao59meq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aide de ces outils, vous devez comprendre que la conversion d'un objet binaire au format texte enregistre uniquement la valeur de ses propri√©t√©s, mais pas les m√©thodes. </font><font style="vertical-align: inherit;">La conversion de donn√©es JSON, XML ou CSV en un objet .NET √† l'aide de PowerShell n'est possible que si elle est valide.</font></font><br>
<br>
<a name="section2"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec WMI et CIM</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows Management Instrumentation (WMI) est une impl√©mentation d√©velopp√©e par Microsoft et adapt√©e √† Windows de la norme WBEM (Web-Based Enterprise Management). Il est bas√© sur l'id√©e de cr√©er une solution universelle pour surveiller l'environnement d'information distribu√© d'une entreprise et g√©rer ses composants. La structure de donn√©es WBEM, quant √† elle, est bas√©e sur le mod√®le commun d'information (CIM), qui met en ≈ìuvre une approche orient√©e objet de la repr√©sentation des syst√®mes informatiques. Le d√©veloppement et la prise en charge de WMI dans Windows ont √©t√© interrompus; Microsoft recommande d'utiliser un m√©canisme similaire pour la gestion de l'infrastructure - les objets CIM. Pour travailler avec eux, des applets de commande sp√©ciales sont apparues dans PowerShell 3.0, que nous consid√©rerons en parall√®le avec leurs homologues WMI. Si le code contient des appels d'applet de commande pour travailler avec WMI, il doit √™tre r√©√©crit si possible.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h6/io/mw/h6iomwnjjrssdkl_tw7gi0mwjhm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cadre du mod√®le CIM (il est √©galement utilis√© en WMI), les donn√©es du syst√®me d'exploitation sont pr√©sent√©es sous forme de classes avec propri√©t√©s et m√©thodes. Les classes sont regroup√©es en ordre hi√©rarchique et li√©es logiquement par technologie d'espace de noms ou zone de gestion. Il existe un espace de noms racine Root qui a des sous-espaces: CIMv2, Default, Secutiry et WMI. Pour l'identification non ambigu√´ d'une instance d'une classe (objet) et la description de l'√©tat de la ressource correspondante, les propri√©t√©s de classe sont utilis√©es, qui sont g√©n√©ralement en lecture seule. Des m√©thodes sont utilis√©es pour g√©rer la ressource. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'instance de classe est accessible par le chemin complet, qui a la forme suivante:</font></font><br>
<br>
<pre><code class="powershell hljs">[\\<span class="hljs-type">ComputerName</span>\<span class="hljs-type">NameSpace</span>][:<span class="hljs-type">ClassName</span>][<span class="hljs-type">.KeyProperty1</span>=<span class="hljs-type">Value1</span>][,<span class="hljs-type">KeyProperty2</span>=<span class="hljs-type">Value2</span>]‚Ä¶]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o√π </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ComputerName est le nom de l'ordinateur; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NameSpace - espace de noms; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClassName - le nom de la classe; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KeyProperty1 = Value1, KeyProperty2 = Value2 - les propri√©t√©s de l'objet et les valeurs par lesquelles il est identifi√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant PowerShell, un simple outil WMI n'existait pas. </font><font style="vertical-align: inherit;">Pour acc√©der aux objets, il fallait √©crire des programmes assez complexes dans des langages de haut niveau (C ++, Visual Basic, Java Script) ou √©tudier le shell WMIC (WMI Command Line, qui est √©galement abandonn√©) avec son propre langage. </font><font style="vertical-align: inherit;">Gr√¢ce √† PowerShell, les objets WMI sont accessibles √† l'utilisateur moyen √† partir de la ligne de commande ou dans des scripts. </font><font style="vertical-align: inherit;">Tout d'abord, connectez-vous au sous-syst√®me WMI et obtenez une liste des classes disponibles √† l'aide de l'applet de commande Get-WmiObject (alias gwmi). </font><font style="vertical-align: inherit;">Pour obtenir une liste des classes CIM, utilisez l'applet de commande Get-CimClass.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-List</span></code></pre><br>
<img src="https://habrastorage.org/webt/g7/1z/wz/g71zwzueejpnyrgwqkoqpxlwn7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons r√©pertori√© les classes sur l'ordinateur local, mais vous pouvez vous connecter √† la t√©l√©commande:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> IP- 
<span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> _</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> IP- <span class="hljs-literal">-List</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> _ <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par d√©faut, les applets de commande Get-CimClass et Get-WmiObject se connectent √† l'espace de noms Root \ CIMV2, qui stocke un grand nombre de classes pour la gestion du syst√®me. </font><font style="vertical-align: inherit;">Pour modifier l'espace de noms, utilisez le param√®tre -Namespace:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-Namespace</span> Root
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Namespace</span> Root <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conna√Ætre le nom de la classe, il n'est pas difficile d'en obtenir des instances. </font><font style="vertical-align: inherit;">La commande suivante renvoie toutes les instances de Win32_Service, c'est-√†-dire </font><font style="vertical-align: inherit;">services enregistr√©s sur la machine locale:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme pour les autres types d'objets, une liste de propri√©t√©s et de m√©thodes s'affiche √† l'aide de Get-Member. </font><font style="vertical-align: inherit;">Les m√©thodes d'objet WMI sont accessibles directement ou √† l'aide de l'applet de commande Invoke-WmiMethod. </font><font style="vertical-align: inherit;">Vous pouvez √©galement utiliser des applets de commande pour les objets WMI pour trier, filtrer, grouper, etc.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/pq/rn/nk/pqrnnkbv1abfqzn5hlnsgunzamu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour obtenir des objets CIM (instances de classes), utilisez l'applet de commande Get-CimInstance. </font><font style="vertical-align: inherit;">Contrairement √† WMI, les objets CIM r√©sultants (objet r√©sultant ou instances de classe) ne contiennent pas de m√©thodes de classe. </font><font style="vertical-align: inherit;">Comme vous ne pouvez pas extraire directement une m√©thode, vous devez appeler l'applet de commande Invoke-CimMethod. </font><font style="vertical-align: inherit;">Consid√©rez la classe Win32_Service - services ex√©cut√©s sur le syst√®me) et son instance pour le service de spouleur sur la machine locale:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> </code></pre><br>
<img src="https://habrastorage.org/webt/qm/jf/cz/qmjfcz-_u-le6js9tibb3qc5y2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardons la structure de l'objet r√©sultant:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/t4/uo/ub/t4uoublc7mxrlb6khyrycfozod4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, les avantages des applets de commande pour travailler avec des objets CIM ne sont pas √©vidents. </font><font style="vertical-align: inherit;">Ils concernent principalement le travail √† distance dans un environnement distribu√© et seront discut√©s en d√©tail dans le dernier article de la s√©rie consacr√©e √† la r√©solution des probl√®mes pratiques d'administration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement une bo√Æte √† outils sp√©cifique √† WMI: le WMI Query Language (WQL), un langage de requ√™te de type SQL. </font><font style="vertical-align: inherit;">Une requ√™te WQL pour rechercher toutes les d√©marrages lors du d√©marrage d'un syst√®me de service ressemble √† ceci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">select</span> * from win32_service <span class="hljs-built_in">where</span> startmode=<span class="hljs-string">"Auto"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä partir de PowerShell, ils sont ex√©cut√©s comme suit:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Query</span> <span class="hljs-string">'select * from win32_service where startmode="Auto"'</span></code></pre><br>
<img src="https://habrastorage.org/webt/wc/y7/wf/wcy7wfk7619yx_9es0cjz9bi4vw.png"><br>
<br>
<a name="section3"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travailler avec des objets COM</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour assurer l'interaction entre les applications sous Windows, une technologie de liaison et d'int√©gration d'objets (Object Linking and Embedding ou OLE) a √©t√© d√©velopp√©e. Plus tard, la technologie OLE Automation est apparue, √† l'aide de laquelle les applications client d'automatisation pouvaient appeler les fonctions d'autres applications - les serveurs d'automatisation. OLE et OLE Automation √©taient bas√©s sur la technologie de base du Component Object Model (COM), qui offre une norme binaire unique pour les composants logiciels. Les objets cr√©√©s √† l'aide de celui-ci et enregistr√©s dans le syst√®me d'exploitation peuvent √™tre utilis√©s dans d'autres applications √† l'aide de fichiers ex√©cutables ou de biblioth√®ques dynamiques.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers le milieu des ann√©es 90, au lieu de OLE, un autre terme a commenc√© √† √™tre utilis√© - ActiveX. </font><font style="vertical-align: inherit;">Avant l'av√®nement de la plate-forme .NET, la technologie ActiveX √©tait consid√©r√©e comme la cl√©, et les objets COM sont toujours activement utilis√©s pour int√©grer des applications dans Windows - de nombreux produits Microsoft et tiers sont des serveurs d'automatisation et permettent d'acc√©der √† leurs services via eux. </font><font style="vertical-align: inherit;">Pour acc√©der aux objets, ProgID est utilis√© - un identificateur symbolique qui leur est attribu√© lors de l'inscription dans le registre Windows. </font><font style="vertical-align: inherit;">Il a la forme suivante:</font></font><br>
<br>
<pre><code class="powershell hljs">_..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version n'est g√©n√©ralement pas indiqu√©e:</font></font><br>
<br>
<pre><code class="powershell hljs">_.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques exemples de ProgID disponibles: InternetExplorer.Application (application Internet Explorer), Word.Application (application Microsoft Word), WScript.Shell (classe Shell de l'h√¥te de script Windows ou mod√®le d'objet serveur de script WSH). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez cr√©er une instance de l'objet √† l'aide de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">applet de commande New-Object</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©crite dans l'article pr√©c√©dent </font><font style="vertical-align: inherit;">et voir sa structure √† l'aide de Get-Member:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Shell
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/bk/s5/fh/bks5fhq3q-yhle1fwb4-vjkqpk0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour travailler avec des objets, des propri√©t√©s et des m√©thodes sont utilis√©es. </font><font style="vertical-align: inherit;">Dites, pour cr√©er un raccourci sur le bureau de l'utilisateur, vous devez appeler la m√©thode CreateShortcut ():</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> = <span class="hljs-variable">$myshell</span>.CreateShortcut(<span class="hljs-string">"<span class="hljs-variable">$Home</span>\Desktop\Home.lnk"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que le raccourci est √©galement un objet COM:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/05/d8/4_/05d84_-mbzmfuffczrmr76khfyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il nous reste √† remplir ses propri√©t√©s et √† √©conomiser:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span>.TargetPath = <span class="hljs-variable">$Home</span>
<span class="hljs-variable">$link</span>.Save()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette fa√ßon, nous avons cr√©√© un raccourci sur le bureau de l'utilisateur actif, et maintenant nous analyserons le travail avec les services d'automatisation externes en utilisant l'exemple de l'objet COM Shell.Application. </font><font style="vertical-align: inherit;">Avec lui, vous pouvez automatiser certaines actions dans l'Explorateur Windows:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Shell.Application</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou pour faire court:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-com</span> Shell.Application
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/__/iu/qy/__iuqyjf29nliwugz-jybihkfj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'objet Shell.Application a plusieurs m√©thodes de gestion de fen√™tres diff√©rentes. </font><font style="vertical-align: inherit;">Par exemple, pour afficher le contenu d'un r√©pertoire donn√©, Explore () est utilis√©:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Explore(<span class="hljs-string">"c:\"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me d'aide est appel√© √† l'aide de la m√©thode Help ():</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Help()</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe √©galement trois m√©thodes pour appeler les bo√Ætes de dialogue de recherche: FindFiles (), FindComputer () et FindPrinter ().</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.FindFiles()
<span class="hljs-variable">$myshell</span>.FindComputer()
<span class="hljs-variable">$myshell</span>.FindPrinter()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez ouvrir la bo√Æte de dialogue de lancement du programme √† l'aide de la m√©thode FileRun (), et pour appeler la fen√™tre de r√©glage de la date / heure, vous avez besoin de la m√©thode SetTime (). </font><font style="vertical-align: inherit;">Il existe, par exemple, des m√©thodes pour appeler la fen√™tre des param√®tres de la barre des t√¢ches, des √©l√©ments du panneau de contr√¥le indiquant l'un des fichiers cpl disponibles, pour g√©rer les fen√™tres ouvertes:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.MinimizeAll()
<span class="hljs-variable">$myshell</span>.UndoMinimizeAll()
<span class="hljs-variable">$myshell</span>.TileHorizontally()
<span class="hljs-variable">$myshell</span>.TileVertically()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La m√©thode Windows () vous permet d'acc√©der √† la collection de fen√™tres ouvertes dans Explorer ou dans Internet Explorer. </font><font style="vertical-align: inherit;">Voyons les propri√©t√©s et m√©thodes disponibles pour cette collection:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Windows() | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/dq/ls/yo/dqlsyokgkrtk6rc-okuskmpwsvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe d'autres objets COM utiles, dont le nombre d√©pend du logiciel install√© dans le syst√®me. </font><font style="vertical-align: inherit;">Il √©tait une fois, le principal outil d'automatisation de Windows √©tait consid√©r√© comme le serveur de script WSH, dont le mod√®le objet comprend des objets COM: con√ßu pour fonctionner avec les fonctions r√©seau de WScript.Network et WScript.Shell que nous avons d√©j√† mentionn√©es. </font><font style="vertical-align: inherit;">Ce dernier cr√©e non seulement des raccourcis sur le bureau, avec son aide, vous pouvez, par exemple, afficher des fen√™tres d'informations avec des messages et des boutons, basculer entre les applications, lancer des programmes ou simuler des frappes.</font></font><br>
<br>
<a name="section4"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation du service d'annuaire ADSI</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, un catalogue fait r√©f√©rence √† une source d'informations dans laquelle les donn√©es sur certains objets sont stock√©es. Par service d'annuaire, nous entendons une partie d'un syst√®me informatique distribu√© qui vous permet d'acc√©der et de manipuler des objets stock√©s. Un service d'annuaire peut combiner des donn√©es sur les objets r√©seau et les services qui les manipulent - il repr√©sente un point d'entr√©e unique pour interagir avec les ressources r√©seau. Il peut y avoir de nombreux services de ce type dans un r√©seau informatique h√©t√©rog√®ne: un SAM local (Security Account Manager) pour les ordinateurs hors domaine, Active Directory, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interaction avec diff√©rents services d'annuaire n√©cessite diff√©rents outils, ce qui cr√©e certains inconv√©nients. √Ä partir de Windows 2000, Microsoft a introduit la technologie ADSI (Active Directory Service Interface) unifi√©e pour les syst√®mes d'exploitation qui ne d√©pend pas d'un protocole d'acc√®s r√©seau sp√©cifique. Pour rechercher des objets, un espace de noms est d√©fini pour le r√©pertoire. √âtant donn√© que diff√©rents services d'annuaire utilisent diff√©rentes m√©thodes de d√©nomination, ADSI d√©finit une convention qui identifie de mani√®re unique tout objet. Le concept de cha√Ænes de liaison en deux parties ou ADsPath est introduit. La premi√®re partie du nom d√©finit le service d'annuaire (fournisseur ADSI) et la seconde - l'emplacement de l'objet dans l'annuaire. Voici des exemples de d√©signation de diff√©rents fournisseurs ADSI: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© pour les services d'annuaire bas√©s sur LDAP, y compris </font><font style="vertical-align: inherit;">pour Active Directory; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinNT: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√© pour les ordinateurs locaux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a aucune applet de commande sp√©ciale pour travailler avec ADSI dans PowerShell. </font><font style="vertical-align: inherit;">√Ä la place, l'op√©rateur de transtypage [ADSI] est utilis√© suivi d'une cha√Æne de liaison. </font><font style="vertical-align: inherit;">Par exemple, pour se connecter √† l'utilisateur Ivanov √† partir du domaine test.ru, la construction suivante est n√©cessaire:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"LDAP://CN=Ivanov,DC=TEST,DC=RU"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour travailler avec des comptes locaux, vous devrez vous connecter √† l'ordinateur avec le nom correspondant (pour vous connecter √† l'ordinateur local, utilisez simplement le point au lieu du nom):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$computer</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://."</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, cr√©ez un nouvel utilisateur, Ivanov, sur la machine locale:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-variable">$computer</span>.Create(<span class="hljs-string">"user"</span>,<span class="hljs-string">"Ivanov"</span>)
<span class="hljs-variable">$user</span>.Put(<span class="hljs-string">"Description"</span>,<span class="hljs-string">"  PowerShell"</span>)
<span class="hljs-variable">$user</span>.SetInfo()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connectez-vous maintenant √† celui-ci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user1</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://./Ivanov,user"</span>
<span class="hljs-variable">$user1</span>.Description</code></pre><br>
<img src="https://habrastorage.org/webt/pb/9l/5m/pb9l5mpw09oocoetnw3x4iawzmm.png"><br>
<br>
<a name="section5"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatage de sortie</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le travail interactif n√©cessite souvent l'affichage de donn√©es. Dans d'autres shells, les commandes et les utilitaires eux-m√™mes participent au formatage de la sortie, mais les objets binaires renvoy√©s par les fonctions et les applets de commande ne savent g√©n√©ralement pas comment proc√©der. Dans PowerShell, la sortie est format√©e par quatre applets de commande sp√©ciales qui alimentent les objets via le pipeline. Des informations plus d√©taill√©es peuvent √™tre obtenues √† l'aide de Get-Help: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formate la sortie sous la forme d'un tableau dont les colonnes contiennent les valeurs des propri√©t√©s de l'objet ou les valeurs calcul√©es. La possibilit√© de regrouper des donn√©es est prise en charge; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-List</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affiche l'objet sous la forme d'une liste de propri√©t√©s, chacune √©tant affich√©e sur une nouvelle ligne. La possibilit√© de regrouper des donn√©es est prise en charge; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format personnalis√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formate la sortie √† l'aide d'une vue personnalis√©e; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Wide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formate les objets sous la forme d'un tableau large dans lequel une seule propri√©t√© de chaque objet est affich√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si aucune des applets de commande r√©pertori√©es n'est appel√©e, le module de mise en forme appropri√© au type de donn√©es affich√©es est utilis√©. Les r√®gles d'affichage sont stock√©es dans des fichiers de configuration au format XML avec l'extension .ps1xml, qui se trouvent dans le r√©pertoire $ PSHome. Une liste d'entre eux peut √™tre obtenue √† l'aide de la commande suivante:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">dir</span> <span class="hljs-variable">$pshome</span>\*format*.ps1xm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La modification manuelle des fichiers de configuration n'est pas recommand√©e; il est pr√©f√©rable de cr√©er les v√¥tres et de les inclure dans la liste des fichiers t√©l√©charg√©s √† l'aide de l'applet de commande Update-FormatData. Si le formateur par d√©faut pour le type souhait√© n'est pas d√©fini, PowerShell affiche les propri√©t√©s de l'objet √† l'√©cran dans une liste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci conclut la description de l'utilisation des objets dans PowerShell, et le dernier article de la s√©rie sera consacr√© √† la r√©solution des probl√®mes pratiques de gestion d'un environnement d'informations r√©parties d'une entreprise. Dans ce document, tous les outils d√©crits nous sont utiles. L'accent sera principalement mis sur les objets CIM et leur comparaison avec WMI. Les pi√®ces pass√©es peuvent √™tre trouv√©es sur les liens ci-dessous.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 1:   Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 2:     Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 3:      ,  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 4:   ,  </a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498458/index.html">Appels vid√©o avec arri√®re-plan virtuel et outils open source</a></li>
<li><a href="../fr498462/index.html">D√©filement infini avec des banni√®res, ou comment faire avec trois vues</a></li>
<li><a href="../fr498466/index.html">Comment les lasers et les capteurs aident √† garder les juges nerveux</a></li>
<li><a href="../fr498472/index.html">Image Docker d'une seule page</a></li>
<li><a href="../fr498476/index.html">Accessibilit√© Comment rendre l'application accessible aux utilisateurs handicap√©s</a></li>
<li><a href="../fr498482/index.html">Situation: les fournisseurs am√©ricains sont invit√©s √† supprimer les seuils de t√©l√©chargement des donn√©es - ce qui en fin de compte</a></li>
<li><a href="../fr498484/index.html">Wi-Fi 6 et Huawei P40: o√π est la connexion?</a></li>
<li><a href="../fr498486/index.html">Comment d√©velopper la s√©mantique de langue anglaise pour la publicit√© de recherche dans une niche √©troite</a></li>
<li><a href="../fr498490/index.html">Un syst√®me de certification efficace qui vous permettra de devenir un meilleur leader</a></li>
<li><a href="../fr498492/index.html">Ch√©rie, nous tuons la bureaucratie: comment la num√©risation change le dialogue entre les fournisseurs et X5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>