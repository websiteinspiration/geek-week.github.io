<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§í üî¨ üîë Update RouterOS on your MikroTik üéΩ üåé ü§òüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the evening of March 10, Mail.ru support service began to receive complaints from users about the inability to connect to Mail.ru IMAP / SMTP serve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Update RouterOS on your MikroTik</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/492094/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/3g/2d/e9/3g2de9kzpmcrx2conlbddund3xw.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the evening of March 10, Mail.ru support service began to receive complaints from users about the inability to connect to Mail.ru IMAP / SMTP servers through email programs. </font><font style="vertical-align: inherit;">At the same time, some of the connections did not pass, and some show a certificate error. </font><font style="vertical-align: inherit;">The error is caused by the fact that the ‚Äúserver‚Äù issues a self-signed TLS certificate.</font></font><br>
<a name="habracut"></a>&nbsp;<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/7g/ek/ki7gekkwh6sqysnyuyb3x-punie.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In two days, more than 10 complaints came from users from a variety of networks and with a variety of devices, which made it unlikely that a single provider would have a problem on the network. </font><font style="vertical-align: inherit;">A more detailed analysis of the problem revealed that there is a substitution of the imap.mail.ru server (as well as other mail servers and services) at the DNS level. </font><font style="vertical-align: inherit;">Further, with the active assistance of our users, we found that the reason was an incorrect entry in the cache of their router, which in combination is a local DNS resolver, and which in many (but not all) cases turned out to be the MikroTik device, which is very popular in small corporate networks and at small Internet providers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the problem</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In September 2019, researchers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">found</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> several vulnerabilities in the MikroTik RouterOS (CVE-2019-3976, CVE-2019-3977, CVE-2019-3978, CVE-2019-3979) that allowed the DNS cache poisoning attack, i.e. </font><font style="vertical-align: inherit;">the ability to spoof DNS records in the router‚Äôs DNS cache, and CVE-2019-3978 allows an attacker not to wait for someone from the internal network to ask for a record on his DNS server to poison the resolver cache, but to initiate such a request through the port itself 8291 (UDP and TCP). </font><font style="vertical-align: inherit;">The vulnerability was fixed by MikroTik in versions of RouterOS 6.45.7 (stable) and 6.44.6 (long-term) on October 28, 2019, however, according to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">studies,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> most users have not installed patches at the moment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is obvious that now this problem is being actively exploited ‚Äúlive‚Äù.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why is it dangerous</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An attacker can replace the DNS record of any host accessed by a user on the internal network, thus intercepting traffic to him. </font><font style="vertical-align: inherit;">If sensitive information is transmitted without encryption (for example, via http: // without TLS) or the user agrees to accept a fake certificate, the attacker can receive all the data that is sent through the connection, for example, login or password. </font><font style="vertical-align: inherit;">Unfortunately, practice shows that if a user has the opportunity to accept a fake certificate, then he will use it.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why SMTP and IMAP servers, and what saved users</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why did the attackers try to intercept the SMTP / IMAP traffic of the mail applications, and not the web traffic, although most of the users go to the mail via HTTPS browser? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not all SMTP and IMAP / POP3 mail programs protect the user from errors by not allowing him to send a username and password through an insecure or compromised connection, although according to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 8314</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> standard </font><font style="vertical-align: inherit;">adopted back in 2018 (and implemented in Mail.ru much earlier), they should protect the user from intercepting a password through any insecure connection. In addition, while OAuth protocol is very rarely used in email clients (it is supported by Mail.ru mail servers), without it, the login and password are transmitted in each session.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Browsers may be slightly better protected from Man-in-the-Middle attacks. On all critical mail.ru domains, in addition to HTTPS, the HSTS (HTTP strict transport security) policy is included. When HSTS is enabled, a modern browser does not give the user a simple opportunity to accept a fake certificate, even if the user wants it. In addition to HSTS, users were saved by the fact that since 2017, the Mail.ru SMTP, IMAP and POP3 servers prohibit password transmission through an insecure connection, all our users used TLS to access via SMTP, POP3 and IMAP, and therefore you can login and password intercept only if the user himself agrees to accept the spoofed certificate.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For mobile users, we always recommend using Mail.ru applications to access mail, as </font><font style="vertical-align: inherit;">working with mail in them is safer than in browsers or built-in SMTP / IMAP clients.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should be done</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to update the MikroTik RouterOS firmware to a safe version. </font><font style="vertical-align: inherit;">If for some reason this is not possible, it is necessary to filter out traffic on port 8291 (tcp and udp), this will complicate the operation of the problem, although it will not eliminate the possibility of passive injection into the DNS cache. </font><font style="vertical-align: inherit;">Internet service providers should filter this port on their networks to protect corporate users.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All users who accepted a forged certificate should urgently change the password of email and other services for which this certificate was accepted. </font><font style="vertical-align: inherit;">For our part, we will notify users who enter the mail through vulnerable devices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS There is still a related vulnerability described in the post</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LukaSafonov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backport vulnerability in RouterOS threatens hundreds of thousands of devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492078/index.html">The most important and useful materials on the coronavirus COVID-19</a></li>
<li><a href="../en492082/index.html">How to simplify the management of home devices and secure them (share ideas about Kauri Safe Smart Home)</a></li>
<li><a href="../en492086/index.html">Coronavirus vs Russian IT-business: are companies ready to transfer employees to a remote location?</a></li>
<li><a href="../en492088/index.html">Testing the Amazon Lumberyard game engine. Approaches and Tools</a></li>
<li><a href="../en492090/index.html">Scrum - the nuances of using a distributed team</a></li>
<li><a href="../en492100/index.html">Testing video cards to work with KOMPAS-3D</a></li>
<li><a href="../en492102/index.html">Creation of VK chatbot based on VkBotCore C #</a></li>
<li><a href="../en492106/index.html">Typescript: unsound behavior or indulgences of reliability</a></li>
<li><a href="../en492108/index.html">How to get to Silicon Valley: 7 ways for it-startup</a></li>
<li><a href="../en492110/index.html">Using a cloud token with support for Russian cryptography on the Android platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>