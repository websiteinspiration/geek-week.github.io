<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêå üö∂üèæ üïØÔ∏è Using the Nios II processor system without the Nios II processor core üöÑ ü•ö ‚ôøÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last block of articles about the complex for remote debugging of Redd, I showed that working with it is not only working with FPGAs. Not only t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Using the Nios II processor system without the Nios II processor core</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496508/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the last block of articles about the complex for remote debugging of Redd, I showed that working with it is not only working with FPGAs. </font><font style="vertical-align: inherit;">Not only that, FPGAs are just a very interesting, but still very specific part of the complex. </font><font style="vertical-align: inherit;">Its main part is FTDI bridges and other USB things. </font><font style="vertical-align: inherit;">The topic did not arouse much interest, but nevertheless, now everyone knows which particular hardware is in the complex. </font><font style="vertical-align: inherit;">And again we can return to the consideration of an interesting topic - FPGA.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We continue the tradition of the previous block and continue to look for optional parts. </font><font style="vertical-align: inherit;">Today we will learn how to do without the Nios II processor core. </font><font style="vertical-align: inherit;">Yes Yes. </font><font style="vertical-align: inherit;">In the Nios II processor system, the processor core itself is an important, but not mandatory element. </font><font style="vertical-align: inherit;">We will practice making the system without it, taking all control functions to the level of the central processor of the Redd complex.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/z7/7g/yoz77gtnqpihpkzncrygij1gjv4.png"><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Previous cycle articles</font></font></b><div class="spoiler_text"><ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  ¬´¬ª  ,   Redd,      .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  ¬´¬ª  ,   Redd.  2.  .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">          .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">     Redd     .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">              Redd.</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> ,       .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    Redd.  1:  .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    Redd.  2:      .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  :        .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    Redd,    FTDI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">     Redd</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">       Redd</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> USB-  Windows 10   </a></li>
</ol><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why is the processor core necessary and why not</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I already noted in the theoretical part of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of the previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , when working with the Redd complex, all non-standard equipment is an auxiliary thing. </font><font style="vertical-align: inherit;">It is used short-term, only at the project stage and is not alienated to the Customer. </font><font style="vertical-align: inherit;">Accordingly, it is unlikely that individual developers will be allocated to this. </font><font style="vertical-align: inherit;">And it makes no sense to work with him, to study too many additional things.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is why, instead of the development approach through Verilog (or VHDL, or some other specific language), I suggested just creating a Nios II system based on ready-made devices, connecting them with buses. Instead of control machines, I chose the processor core, since the development language for it is closer to modern system programmers. Of course, if there are not enough cubes to create a system, the missing ones have to be added. But then they can be reused in other projects, so the finished library will be typed very quickly.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach has many advantages. And actually, we have already fixed this approach in practice. But when I think over new examples that I want to bring to the discussion, the lack of FPGA memory comes to the fore. I would like to give more memory for FIFO, but the program and data for the processor also need to be stored somewhere. And the fourth Cyclone does not have that much memory. Everyone may not be enough. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second problem - we already made a system for communication between the Nios II processor and the central processor in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of the previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It also takes up memory for its FIFOs, plus - its use clutters up the pictures, hiding the essence described in the article. If you can refuse this case, it is better to refuse (though this refusal is not always possible).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But who will manage the system? And how can data be thrown without a processor core? Meet me! Component </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera JTAG-to-Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/ni/ox/mdnioxxjtzwmss03mfug9ms6mg8.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On one side, it is connected to the standard JTAG bus (namely, the standard one, you do not need anything external, it is enough to work through the standard USB-Blaster). The other is connected to the AVALON bus, providing access to all devices. Exactly the same access was provided by the processor core. Initially, this unit was designed for the initial debugging of its own cores in order to whip up from the host machine. But no one forbids using it for other tasks, because the JTAG adapter in the Redd complex is constantly present!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, a system based on this block cannot be productive for transactions. The JTAG channel is not fast in itself, but also the USB-Blaster adapter used in the Redd complex based on the microcontroller makes it completely leisurely. But how to make a quick wizard - we already know. No one forbids for each case to choose what is more convenient for him. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In projects that are planned for future articles, management speed is not critical. There will be an analyzer, which will be given the command to copy data to SDRAM, after which it will go into itself until the RAM is full or until the command stops working. These commands will be executed in microseconds or tens of milliseconds - there is not much difference.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, data transfer through JTAG will go slower than through FT245. </font><font style="vertical-align: inherit;">But then again, we already know how to pump everything through the FT245. </font><font style="vertical-align: inherit;">Knowing the new option does not forbid us to choose the old one. </font><font style="vertical-align: inherit;">But then, having become acquainted with the new option, we will get the opportunity to make the system even slower, but easier to develop and more economical in terms of resources. </font><font style="vertical-align: inherit;">More techniques, good and different! </font><font style="vertical-align: inherit;">Therefore, we proceed to the experiments.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About the manufacture of hardware (as opposed to software) in the network there are many articles. Typically, in all examples, the internal FPGA memory, LEDs, and buttons are added to the system. Our organization, like the whole country, has now urgently gone to a remote place, so I don‚Äôt even have anyone to ask to connect the oscilloscope to the complex connector, so in the example I will limit myself to only memory. Who will repeat the experiments on ordinary breadboard models can add a GPIO to the output to control the LEDs, and a GPIO to the input to watch the operation of the buttons. We create a processor system (how I do it, I described </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), but instead of the processor we put the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera JTAG-to-Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block </font><font style="vertical-align: inherit;">. He is taken here:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/tj/ej/litjejrc7axnujctk5gsn8_fz2m.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, we add memory so that there is at least something on which we will check the work today. </font><font style="vertical-align: inherit;">Next, we connect all this with buses, automatically assign addresses and get something like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/pb/lz/ukpblzh5ocdc_kz_7f50ccjwbie.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reset</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signal is </font><font style="vertical-align: inherit;">switched very non-standard. </font><font style="vertical-align: inherit;">This is due to the fact that I do not want to spend time on its physical production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actually, for today's equipment - that's all. </font><font style="vertical-align: inherit;">We generate the system, assign the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leg </font><font style="vertical-align: inherit;">(we do not use other legs today). </font><font style="vertical-align: inherit;">I remind you that </font><font style="vertical-align: inherit;">I make the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reset</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leg </font><font style="vertical-align: inherit;">virtual (Virtual Pin), the procedure is described in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (search for the phrase Virtual Pin). </font><font style="vertical-align: inherit;">As a result, it should turn out: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/jw/x-/wf/jwx-wfq6iryqg8wem0tb8e5mvie.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We collect, fill in the FPGA ... We proceed to the experiments.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programming via TCL scripts</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, all the textbooks that talk about working with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altera JTAG-to-Avalon-MM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block </font><font style="vertical-align: inherit;">say that work should be done using TCL scripts. Before rushing into the abyss of the unknown, it is better to get your hand on a well-documented one, so we will not be an exception and we will start experiments with them too. About what TCL is, there are many articles on Habr√©. I will give a link to one of them, since it is associated with the FPGA: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://habr.com/en/post/308962/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The Intel FPGA (former Altera website) has a whole online course for working with this language. To learn how to issue commands on it, in the development environment, you can run the System Console: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/uq/yh/dmuqyhixms3bbpnt1h11uo3mjx0.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, a gorgeous environment will open.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1v/ad/ce/1vadce19ywpugqolqevimuhmoss.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can work wonders, up to the development of GUI applications. But within the framework of the article we will touch on this matter only superficially (why - I will explain a little later). We just try to give a couple of teams. Which teams? To do this, you need to find and download the document </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzing and Debugging Designs with System Console</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as always, I give names, but not links, since links always change). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will try to experiment with the teams from this group of the document: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kz/sq/lq/kzsqlqednll8qlz2bk9tduwtzuq.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To begin with, take a look at the messages issued to us. Since I downloaded the ‚Äúfirmware‚Äù remotely, the system itself found a remote JTAG server: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cs/h9/q0/csh9q0sb6jmw28upyiulmazyd1s.png"> <br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will issue the commands in this window: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/hv/ci/pohvci4a2uaqgkqjtcw2jmq59a4.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, let's try to write a constant to the memory. To do this, you would give the command:</font></font><br>
<br>
<pre><code class="plaintext hljs">master_write_32</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
but the trouble is that its first argument is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;service_path&gt;</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Therefore, before submitting a useful command, you must first learn how </font><font style="vertical-align: inherit;">to receive </font><font style="vertical-align: inherit;">this </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service_path</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We are looking for the appropriate site in the documentation: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/mk/4c/gjmk4cvunxnafdoq9uvk2_4zgfk.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Great! </font><font style="vertical-align: inherit;">We try to submit the appropriate command using the example from the document.</font></font><br>
<br>
<pre><code class="plaintext hljs">% get_service_paths master<font></font>
/devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somehow it's hard to enter manually. </font><font style="vertical-align: inherit;">Option:</font></font><br>
<pre><code class="plaintext hljs">% lindex [get_service_paths master] 0<font></font>
/devices/10CL006(Y|Z)|10CL010(Y|Z)| ..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not any better. </font><font style="vertical-align: inherit;">It would be useful only if there were several devices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good. </font><font style="vertical-align: inherit;">Let's try the full version of the example from the document:</font></font><br>
<br>
<pre><code class="plaintext hljs">% set m_path [lindex [get_service_paths master] 0]<font></font>
/devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And now - try the record:</font></font><br>
<br>
<pre><code class="plaintext hljs">% master_write_32 $m_path 0x0 0x01234567<font></font>
error: master_write_32: /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master is not an open master service<font></font>
    while executing<font></font>
"master_write_32 $m_path 0x0 0x01234567"<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We continue to study the instructions ... </font></font><br>
<br>
<pre><code class="plaintext hljs">% open_service master $m_path<font></font>
<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Will it work now?</font></font><br>
<pre><code class="plaintext hljs">% master_write_32 $m_path 0x0 0x01234567<font></font>
<font></font>
% master_write_32 $m_path 0x4 0x89abcdef<font></font>
<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No error messages. </font><font style="vertical-align: inherit;">We try to read:</font></font><br>
<br>
<pre><code class="plaintext hljs">% master_read_32 $m_path 0x0 0x2<font></font>
0x01234567 0x89abcdef<font></font>
%</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Works! </font><font style="vertical-align: inherit;">We learned to write and read memory. </font><font style="vertical-align: inherit;">Device registers are also projected onto it, so in the future we will be able to manage devices.</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total, the correct sequence of actions looks like this: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
set m_path [lindex [get_service_paths master] 0] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
open_service master $ m_path </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_write_32 $ m_path 0x0 0x01234567 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_write_32 $ m_path 0x4 0x89abcdef </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_read_32 $ m_path 0x0 0x2</font></font></b></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those who are interested in the capabilities of the System Console and the TCL language can study descriptions, examples, and video materials, which are quite numerous on the network, and within the framework of this article, I will pass on to what I personally could not find on the network ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moving from TCL to C ++</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TCL is a fairly powerful language. It is always useful to study it, especially if you plan to work closely with FPGAs. In general, fluency in another powerful programming language is a big plus for the developer. But this is the whole. And in particular, the need to know another language runs counter to the principles that were formulated </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . We believe that the Redd complex is an auxiliary complex that should be easily mastered by system developers in broad-based languages. That is, proficiency in an additional language is always welcome, but should not be a prerequisite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I decided to find how you can work with the JTAG bridge from the good old C / C ++. Perhaps I'm blind, however, having spent a lot of time on exercises with the compilation of search queries, I have not achieved anything worthwhile. The most interesting thing is that many of the requests gave me a link to my </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article about the fun quartel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but it shows how the System Console is called from a Java program, and the script file must be created in advance, which will obviously spoil the performance even more, and without that not very high due to the JTAG serial link and the slow adapter. Nevertheless, those who work in Java can refresh that article in memory and adopt methods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finding nothing, I decided to use the principle shown in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one of my articles from the PSoC series</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The essence of the approach is simple: if there is no documentation, we study what comes with the delivery. And complete with Quartus is a lot of TCL scripts. It was by studying them that I was imbued with the power of the language. But on the other hand, I was imbued with the thought of how much time will be spent on its development. Yes, now there is not much work, but, firstly, it is still there, and secondly, when you read these lines, I really hope that the world has returned to high-speed life. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, I found a very interesting file: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C: \ intelFPGA_lite \ 17.1 \ quartus \ bin64 \ tcl_server.tcl</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Judging by its contents, it creates a server through which you can call functions that we have already accessed. </font><font style="vertical-align: inherit;">That is, we can well write our client, which will connect over the network and begin to issue commands ... This client can be written in my favorite C ++. </font><font style="vertical-align: inherit;">That is, the issue will be resolved. </font><font style="vertical-align: inherit;">Therefore, we proceed to the analysis of this file.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiments with the tcl_server.tcl file on the local machine</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We continue to move from a well-documented to a hidden goal in the dark. </font><font style="vertical-align: inherit;">We are trying to learn everything from Windows (on my home machine), however, already being connected to a remote JTAG server (on the Redd complex in the office). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first, the investigation went the wrong way. </font><font style="vertical-align: inherit;">There is such an interesting design in the file:</font></font><br>
<br>
<pre><code class="plaintext hljs">if { [info exists env(QUARTUS_ENABLE_TCL_SERVER)]  } {<font></font>
	if { $env(QUARTUS_ENABLE_TCL_SERVER) == 1 } {<font></font>
		_q_setup_server $_q_port<font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, I drove the word </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QUARTUS_ENABLE_TCL_SERVER</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> into a search engine. There were not many results. Only two. Of these, only one is worthwhile: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.intel.com/content/www/us/en/programmable/quartushelp/13.0/mergedProjects/eda/synthesis/synplicity/eda_pro_synplty_setup.htm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Overjoyed, I created the appropriate environment variable, but the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat ‚Äìa</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">showed that no server appeared on port 2589. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good. Then I tried to run this entire script through the System Console, using this menu item: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ja/73/q3/ja73q3sjl9bqkz_tms_wltjjuoa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And I got an error:</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ng/pl/cw/ngplcwiavd9qhwjenx318c6lkei.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I am a simple person. Not finding on my machine a description of this disgrace (but finding it on github and suspecting that we had a simple message output), I made a copy of the script file and deleted the corresponding line: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/9r/bw/oc/9rbwoc9olediep17g-fhyefcfuo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Along the way, I removed the check for the environment variable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QUARTUS_ENABLE_TCL_SERVER described above</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since anyway we have to run the script manually. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After which the script was launched, the listening port 2589 appeared in the system. You can connect to it via Telnet. Once again I remind you that at the moment I am conducting experiments on a Windows home machine. We will move to the remote machine a little later. So, we are connected: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xc/sp/2s/xcsp2sg8qr2nj4mbvlunqd5c1bk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We receive an empty terminal window. Having knocked a couple of times on the key, we see that they hear us, but do not understand: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/gp/zl/mdgpzlxyw5nroocpngdyeemrpwg.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We ask for help.</font></font><br>
<br>
<pre><code class="plaintext hljs">help<font></font>
1 couldn't find help for command . Try help help.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Already better. </font><font style="vertical-align: inherit;">Clarify the request. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will show only a fragment of the answer:</font></font><br>
<br>
<pre><code class="plaintext hljs">help help <font></font>
&lt;‚Ä¶&gt;<font></font>
get_service_paths<font></font>
get_service_types<font></font>
get_services_to_add<font></font>
get_version<font></font>
&lt;‚Ä¶&gt;<font></font>
master_read_16<font></font>
master_read_32<font></font>
master_read_8<font></font>
master_read_memory<font></font>
master_read_to_file<font></font>
master_write_16<font></font>
master_write_32<font></font>
master_write_8<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Familiar words! </font><font style="vertical-align: inherit;">Well, let's try to enter the line we already know:</font></font><br>
<br>
<pre><code class="plaintext hljs">get_service_paths master<font></font>
1 Error: Invalid command<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sorry! </font><font style="vertical-align: inherit;">But we were just allowed to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">issue the get_service_paths</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check the script for the presence of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invalid command line</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And she was discovered there! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About the middle of this design:</font></font><br>
<br>
<pre><code class="plaintext hljs">	set ecmd [lindex $line 0]<font></font>
	if { $ecmd != "project" &amp;&amp; $ecmd != "device" &amp;&amp; <font></font>
	$ecmd != "cmp" &amp;&amp; $ecmd != "sim" &amp;&amp; $ecmd != "show_main_window"<font></font>
	&amp;&amp; $ecmd != "hide_main_window" &amp;&amp; $ecmd != "get_version" <font></font>
	&amp;&amp; $ecmd != "help" &amp;&amp; $ecmd != "convert" <font></font>
	&amp;&amp; $ecmd != "import_assignments_from_maxplus2" } {<font></font>
		set res "Error: Invalid command";<font></font>
	} elseif [catch { set res [eval $line] } result] {<font></font>
		set res "Error: $result";<font></font>
	} <font></font>
	if { $res == "" } {<font></font>
		set res " "<font></font>
	}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that this script only processes a small number of commands from the terminal. </font><font style="vertical-align: inherit;">This is actually a very useful check. </font><font style="vertical-align: inherit;">In the future, we will be able to do the processing of script commands in this place. </font><font style="vertical-align: inherit;">As we master the TCL language, we will be able to bring more and more code to the script level, and only call it from an external program (this will obviously be faster than driving all the lines through the network). </font><font style="vertical-align: inherit;">Well, those commands that are not recognized are still just thrown directly into the interpreter. </font><font style="vertical-align: inherit;">Ideally, we will slowly study TCL and gradually move on to it completely. </font><font style="vertical-align: inherit;">If this works out. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the meantime, stop the execution of the script (closing the System Console) and replace the specified section with this:</font></font><br>
<br>
<pre><code class="plaintext hljs">	set ecmd [lindex $line 0]<font></font>
	if [catch { set res [eval $line] } result] {<font></font>
		set res "Error: $result";<font></font>
	} <font></font>
	if { $res == "" } {<font></font>
		set res " "<font></font>
	}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We run the script for execution, connect, try to run our reference sequence of commands:</font></font><br>
<br>
<pre><code class="plaintext hljs">set m_path [lindex [get_service_paths master] 0]<font></font>
1 /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master<font></font>
open_service master $m_path<font></font>
1 Error: can't read "m_path": no such variable<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variables made by us are forgotten. </font><font style="vertical-align: inherit;">On the one hand, disgusting. </font><font style="vertical-align: inherit;">But on the other hand, we are going to feed the lines programmatically, so packing the name into an argument is not so problematic. </font><font style="vertical-align: inherit;">We are trying to submit a detailed command where not a variable will be used, but its value.</font></font><br>
<br>
<pre><code class="plaintext hljs">open_service master /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We got the result 1. Excellent! </font><font style="vertical-align: inherit;">Continuing the experiments!</font></font><br>
<br>
<pre><code class="plaintext hljs">master_write_32 /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master  0x0 0x01234567<font></font>
<font></font>
master_write_32 /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master 0x4 0x89abcdef<font></font>
<font></font>
master_read_32 /devices/10CL006(Y|Z)|10CL010(Y|Z)|..@1#..@1#1-5.4.2.1#192.168.10.146/(link)/JTAG/alt_sld_fab_sldfabric.node_0/phy_0/master_0.master 0x0 0x2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get the answer:</font></font><br>
<br>
<pre><code class="plaintext hljs">1 0x01234567 0x89abcdef
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 is the result of executing a function. </font><font style="vertical-align: inherit;">Next are the read data. </font><font style="vertical-align: inherit;">That is, access through the network is not ideal, but there is!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experiments with tcl_server.tcl on a remote machine</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, we can already run the program and start working with the processor system, but we add network slowness to the slowness of the JTAG equipment. </font><font style="vertical-align: inherit;">Of course, it is better to run the working program on a remote machine so that it works there with the localhost address. </font><font style="vertical-align: inherit;">So it will be clearly faster. </font><font style="vertical-align: inherit;">And just then, the execution will go on the central processor of the Redd complex, which was originally planned. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Which file to run? </font><font style="vertical-align: inherit;">Break some amount of documentation, find out what </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quartus_sh is</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Good. </font><font style="vertical-align: inherit;">While we will not have fun with scripts, but, as in Windows, we will try to issue commands in interactive mode. </font><font style="vertical-align: inherit;">Looking ahead, I‚Äôll say that it will be fun ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we give the command:</font></font><br>
<br>
<pre><code class="plaintext hljs">user@redd:~$ sudo /opt/intelFPGA/18.1/qprogrammer/bin/quartus_sh -s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are offered to submit tcl-lines: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/tp/mn/astpmnipd97bl34s7rp5lefls7w.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But our favorite commands lead to an error:</font></font><br>
<br>
<pre><code class="plaintext hljs">tcl&gt; get_service_paths master<font></font>
invalid command name "get_service_paths"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that you need to load the missing library by submitting two commands:</font></font><br>
<br>
<pre><code class="plaintext hljs">load_package systemconsole <font></font>
initialize_systemconsole<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
True, the following team that is already familiar to us will give an error even with libraries: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/oj/rn/05/ojrn05otrtauugalg01qtwqeuyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh, and for a long time I was looking for a reason! </font><font style="vertical-align: inherit;">I rummaged through all the libraries, rummaged through a sea of ‚Äã‚Äãarticles on search engines, there is no such team. </font><font style="vertical-align: inherit;">But there are others. </font><font style="vertical-align: inherit;">But they do not work. </font><font style="vertical-align: inherit;">But at least there is. </font><font style="vertical-align: inherit;">I accidentally found an inconspicuous document with a solution. </font><font style="vertical-align: inherit;">Turns out we need the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">claim_path</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Hello and cross-platform again and again. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This sequence will lead us to success:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set m_path [lindex [get_service_paths master] 0] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
set claim_path [claim_service master $ m_path mylib] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_write_32 $ claim_path 0x0 0x01234567 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_write_32 $ claim_path 0x4 0x89abcdef </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master_read_32 $ claim_path 0x0 0x2</font></font></blockquote><br>
<img src="https://habrastorage.org/webt/xm/7q/sb/xm7qsbfyud2q74yxwx_kjrzu8u8.png"> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checking via Telnet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the interactive mode, everything works, we check the work through the script that creates the server. </font><font style="vertical-align: inherit;">Add the missing lines to it (the very two lines loading the library) and run: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user @ redd: ~ $ sudo /opt/intelFPGA/18.1/qprogrammer/bin/quartus_sh -t tcl_server1.tcl</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It crashes. </font><font style="vertical-align: inherit;">The listening socket does not appear. </font><font style="vertical-align: inherit;">It turns out that we need to add a line that does not allow us to exit the server open function:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b6/hd/z2/b6hdz2spmvzd98t_hrwx9w7cbxe.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Same text:</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">proc _q_setup_server {port} {<font></font>
	global _q_lsock;<font></font>
	if [catch { set _q_lsock [socket -server _q_accept $port] } emsg] {<font></font>
	}<font></font>
	vwait forever<font></font>
	return;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We run the correct script and try to connect to the resulting server via Telnet: </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xx/hu/ds/xxhudsysoe239ce13hnmarpwg28.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We issue such commands (the commands are in bold, the answers are in plain text, as in the case of Windows, we substitute the phrases from the previous answers for the variables): </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lindex [get_service_paths master]</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1 {/ devices /10CL006(Y|Z)|10CL010(Y|Z)|..@1#1-5.4.2.1/(link)/JTAG/(110:132 v1 # 0) / phy_0 / master} </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">claim_service master {/ devices /10CL006(Y|Z)|10CL010(Y|Z)|..@1#1-5.4.2.1/(link)/JTAG/(110:132 v1 # 0) / phy_0 / master} mylib</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1 / channels / remote1 / mylib / master_1 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master_write_32 / channels / remote1 / mylib / master_1 0x0 0x01234567</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master_write_32 / channels / remote1 / mylib / master_1 0x4 0x89abcdef</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1 </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master_read_32 / channels / remote1 / mylib / master_1 0x0 0x2</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 0x01234567 0x89abcdef </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything works!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And then the forester came and dispersed everyone ... Or not all?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
While I was working on the article, I managed to find an interesting technique that does not require writing a script that provides access through the network. C has a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">(in Windows - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_popen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). It allows you to open a child process from the console program by capturing its input or output stream. As a result, on Windows, you can open the system console with the following arguments: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C: \ intelFPGA_lite \ 17.1 \ quartus \ sopc_builder \ bin \ system-console.exe --disable_readline ‚Äìcli</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
And you can </font><b><font style="vertical-align: inherit;">issue</font></b><font style="vertical-align: inherit;"> commands without any network. But the trouble is that I did not find how to send commands and receive answers at the same time. The argument to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_popen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">can only be </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">but not both at once. There is a technique specific to Windows, but it will be far from cross-platform. It is possible, as in the article with Quartusel, to submit scripts as an argument to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system-console</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> program </font><font style="vertical-align: inherit;">, and to take the answer as a stream, but each launch will not be very fast ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Linux, initializing the functions of the system console is also slow, so it is better to do it once. It seems that Google says that in Linux the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function has the </font><font style="vertical-align: inherit;">argument ‚Äúr +‚Äù, which opens a bidirectional channel. Then we can open </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quartus_sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and communicate with it, but I'm not very strong on Linux, and Google finds links to forums where there is not a solution, but heated debate about whether it is possible in all assemblies.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I will not bring the program today. </font><font style="vertical-align: inherit;">Implementation of Telnet functions may be unnecessary, but I do not know how to make an ideal program that intercepts both streams. </font><font style="vertical-align: inherit;">If someone provides ready-made solutions in the comments, I will be grateful. </font><font style="vertical-align: inherit;">First of all - under Debian, so as not to drive large streams of data over the network. </font><font style="vertical-align: inherit;">In the meantime, we restrict ourselves to a working concept.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We got acquainted with the methodology for developing processor systems based on Nios II that do not directly contain the processor core. Such systems cannot be recommended as universal, since their speed leaves much to be desired, but in some cases the speed of the control core is not an important factor. But the achieved savings of internal RAM FPGA in such systems comes to the fore. It is for them that the described technique is recommended. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The classic approach to programming such systems is TCL scripts, but within the framework of the concept of the Redd complex, an approach for programming in C ++ was developed and described in the article. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The source tcl_server.tcl script from the Quartus version 17.1 Lite distribution kit can be downloaded </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The version obtained after editing -</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">An example project for FPGAs can be taken </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496498/index.html">We raise our full-fledged Minecraft game server with mini-games. Part 1. Select and install the server</a></li>
<li><a href="../en496500/index.html">COVID-19 in terms of physics</a></li>
<li><a href="../en496502/index.html">Utility for human shadow connecting non-admin to RDP user sessions in WinServer 2012R2</a></li>
<li><a href="../en496504/index.html">Hanwha collaborative robots and their use in the fight against coronavirus</a></li>
<li><a href="../en496506/index.html">The tale of how hCaptcha broke avito.ru</a></li>
<li><a href="../en496510/index.html">How NOT to become a Game Designer</a></li>
<li><a href="../en496512/index.html"># 05 - And a whole byte is not enough ... | Anime</a></li>
<li><a href="../en496514/index.html">IPIP IPsec VPN tunnel between Linux machine and Mikrotik behind NAT provider</a></li>
<li><a href="../en496516/index.html">Telegram bot in python vs COVID-19</a></li>
<li><a href="../en496518/index.html">How did we get to the remote</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>