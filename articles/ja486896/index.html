<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🎨 📳 🈸 MAG250でのUIDおよびストーカー認証 🍿 👩🏾‍🤝‍👨🏻 🌗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私はStalkerポータルでのメディアコンソールの認証のトピックに長い間興味を持っていましたが、それはそれ以前ではありませんでした。ある日、Infomir MAG250プレフィックスを誤って取得して、この問題に取り組むことにしました。
 
 トレーニング
 まず、接頭辞を分解し、ケーブルをコネクタに...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MAG250でのUIDおよびストーカー認証</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486896/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はStalkerポータルでのメディアコンソールの認証のトピックに長い間興味を持っていましたが、それはそれ以前ではありませんでした。</font><font style="vertical-align: inherit;">ある日、Infomir MAG250プレフィックスを誤って取得して、この問題に取り組むことにしました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレーニング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、接頭辞を分解し、ケーブルをコネクタにはんだ付けして、コンピュータに接続しました。</font><font style="vertical-align: inherit;">ターミナルプログラムを立ち上げて、おなじみのU-Bootに満足しました。</font><font style="vertical-align: inherit;">ブートプロセスは、任意のキーを押すことによっても中断される可能性があります（通常、製造元はそのようなチップを無効にし、U-Bootを目的の状態にするために多くの時間を費やす必要があります）。</font><font style="vertical-align: inherit;">root権限でのアクセスは、ssh経由でも利用できました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/4t/p6/o-4tp67pijj-mwgwzsxy7tcq0fu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールには、256 MB DRAMと2つのフラッシュドライブ、NOR 1 MBとNAND 256 MBが搭載されています。</font><font style="vertical-align: inherit;">NORでは、U-Bootがプロセスに読み込まれ、NANDからカーネルとファイルシステムが読み込まれます。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getuid（）関数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレフィックスはStalkerポータルで自身を承認し、タイプ、ファームウェアバージョン、ハードウェアバージョン、シリアル番号などの情報を送信します。しかし、私は特にgSTB.GetUID（）関数が発行したdevice_idパラメーターに興味がありました。一見すると、SHA256やMD5のようなハッシュでした。公式ドキュメント</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soft.infomir.com/stbapi/JS/v343/gSTB.html#.GetUIDを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照すると</font><font style="vertical-align: inherit;">、この関数は最大2つのパラメーターをとることができますが、最初に興味があったのはパラメーターなしのオプションです。 IDBにstbappをロードすると、この関数を簡単に見つけることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/5q/ln/ev5qlnsrhnbb2d61izfqbwqktp4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し進んで、面白い瞬間を見ます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k7/gr/ow/k7growkphe0iah5oqaidlljtgpe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、プログラムは0x41バイトのメモリを割り当て、それを無効にし、ドライバ関数/ dev / stapi / stevt_ioctlを呼び出して、このメモリの一部とパラメータ0xC004C919を渡します。</font><font style="vertical-align: inherit;">したがって、特定のstevt_ioctlドライバーがUIDの生成を担当します。</font><font style="vertical-align: inherit;">これを確認するために、このコードをすばやくスケッチし</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mo/fa/no/mofanof9n_oicnlia9xzepfbbpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ました。コンソールで実行すると、おなじみのUIDが表示されました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stevt_ioctl</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、/ root / modulesにあるstapi_ioctl_stripped.koドライバーを分解することです。</font><font style="vertical-align: inherit;">ドライバーをIDAにロードし、ハンドラー0xC004C919 ioctl（この関数はcalcHashと呼びます）を見つけます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yh/0x/ph/yh0xphq5q-bouv83w_vdpsl10js.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深い点が3つあります。</font><font style="vertical-align: inherit;">最初に、0x41バイトのメモリがユーザー空間からカーネル空間にコピーされます（これはユーザーが送信するものであり、この場合はゼロで構成されます）</font><b><font style="vertical-align: inherit;">。get_mem_type</font></b><font style="vertical-align: inherit;">関数が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出されます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（カーネル自体の途中）と結果（ここでも0x41バイト）がユーザーのアドレス領域にコピーされます。</font><font style="vertical-align: inherit;">get_mem_type関数のアドレスを見つけるために、私は2つの可能性を見つけました：/ proc / kallsysmsファイルを見て、アクセスが制限されていないことを期待するか、そうでなければ、レジスターr0の値を正しい場所に返すドライバー自体のアセンブリーをアセンブラーに書き込みます。</font><font style="vertical-align: inherit;">/ proc / kallsysmsを調べたところ、驚きましたが、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_mem_type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0x8080E380 </font><font style="vertical-align: inherit;">関数のアドレスを見つけました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">芯</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに分析するには、カーネルを分析する必要があります。カーネル自体は製造元のファームウェアにありますが、U-Bootを使用してダンプを削除する</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jy/pw/rk/jypwrkvsciffckeuityrrpxw0gk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
か、目的のパーティションをマウントする</font><font style="vertical-align: inherit;">こともできます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-Boot情報に基づいて、カーネルは0x80800000にロードされ、エントリポイントは0x80801000にあります。 IDAにカーネル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をロードし</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">get_mem_type</font></b><font style="vertical-align: inherit;">関数を見つけます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを分析した後、このセクションを発見しました。このセクションは、おそらくUIDを返していました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d3/fq/tf/d3fqtfjotcjbowla35u8ww7rzzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、UIDは0x80D635ECに格納されます。次に、この値が形成されるIDAを探します。これは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">init_board_extra</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に含まれてい</font><b><font style="vertical-align: inherit;">ました</font></b><font style="vertical-align: inherit;">（完全なリストは翻訳しません）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cl/ws/l2/clwsl2szmjouku6qbpyucp2g2hc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これは、対象のハッシュが計算されるr4レジスタのアドレスにある同じ未知の値です（ちなみに、fill_hashはSHA256によって解決されました）。</font><font style="vertical-align: inherit;">私はそれが何であるかを本当に知りたくて、アセンブラーですぐに挿入を作成しました。それは、printk関数を介して、メモリの内容をレジスタr2のアドレスに返しました。</font><font style="vertical-align: inherit;">このようにカーネルを変更した後、私は新しいuImageを作成してUSBドライブにアップロードしました。</font><font style="vertical-align: inherit;">そして、ターミナルのU-Bootセットで：</font></font><br>
<br>
<pre><code class="plaintext hljs">usb start<font></font>
fatload usb 0:1 80000000 uImage<font></font>
bootm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、最後のチームの後、そのような悲しみが私を待っていました、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/pw/js/xypwjsvafjdefnqk9q4u18npeji.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-Bootは私の新しいカーネルの発送を丁寧に拒否しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U-Bootの編集</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-Bootにカーネルをブートするように説得するために、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド自体を使用してメモリにパッチを当てることにしました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">まず、0xA0000000にあるNORフラッシュのフルダンプを作成しました。</font><font style="vertical-align: inherit;">ダンプをIDAに送り込んだ後、U-Bootが自身をコピーしたメモリアドレスを発見しました。</font><font style="vertical-align: inherit;">0x8FD00000でした。</font><font style="vertical-align: inherit;">ここでも、メモリのこの部分をダンプしてIDAを実行しているので、署名をチェックする関数を簡単に見つけました。</font><font style="vertical-align: inherit;">すべてが正しかった場合、彼女は0を返しました。さらに、彼女は2つの異なる場所で呼び出されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/tq/eb/ontqebdlazmflevjnrx2kx9nnkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数が正確に何をするかは、私には興味がありませんでした。</font><font style="vertical-align: inherit;">彼女はちょうどこのように0を返す必要がありました：</font></font><br>
<br>
<pre><code class="plaintext hljs">mov #0x0, r0<font></font>
rts<font></font>
nop</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
U-Bootの対応するコードは次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">usb start<font></font>
mw.l 8fd0ec08 000b200a;<font></font>
mw.l 8fd0ec0c 00900009<font></font>
fatload usb 0:1 80000000 uImage<font></font>
bootm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、U-Bootは問題なくカーネルをロードしました。</font></font><br>
<br>
<pre><code class="plaintext hljs">EF0F3A38FF7FD567012016J04501200:1a:79:23:7e:2MAG250pq8UK0DAOQD1JzpmBx1Vwdb58f9jP7SN</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全な分析</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、UIDは何で構成されていますか？それは、8バイトの不明な数、コンソールのシリアル番号、MACアドレス、コンソールのタイプ、ゴミの一部でした。それがどんな種類の未知の数であったか、そしてゴミがどこから来たかを知ることはまだ残っています。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再びinit_board_extra</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に戻りました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードセクションから不明な番号が取得されました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8g/hu/u2/8ghuu2d4buowz6plm_feo1hi9pk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、__ ioremap関数を使用して、カーネルは0x00000000（フラッシュのNORアドレス）の物理メモリにアクセスし、0x0Fを0x00000000に書き込み、次に0x98を0x000000AAに書き込み、0x000000C2から始まる8バイトを読み取りました。で、それ何？これらは、カーネルがNORと通信するためのCFIプロトコルコマンドです。 0x0FはNORを元の状態に戻し、0x98スイッチコマンドを使用してCFIを変更しました。このモジュールでは、アドレス0x000000C2はセキュリティコード領域または64ビットの一意のデバイス番号です。それら。不明な番号は一意のNORフラッシュ番号です。以下はCFI識別のダンプです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5y/y_/ez/5yy_eziyuvoq3pirbxmfecrjfqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のように設定すると、U-Bootで直接ダンプを作成できます</font></font><br>
<pre><code class="plaintext hljs">mw.w a0000000 f0<font></font>
mw.w a00000aa 98<font></font>
md.b a1000000 100<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ガベージの一部は、カーネル自体に縫い込まれた通常の32バイトの文字セットであり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n3/dz/tb/n3dztbcvv-kjjud2dhvkg25lrni.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、このガベージは</font><font style="vertical-align: inherit;">、バイトの位置を単に変更する</font><font style="vertical-align: inherit;">暗号化関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">swap_pairs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用する前に処理</font><font style="vertical-align: inherit;">されました</font></font><br>
<br>
<pre><code class="plaintext hljs">[0x00000003]&lt;-&gt;[0x0000000F]<font></font>
[0x00000005]&lt;-&gt;[0x0000001F]<font></font>
[0x00000009]&lt;-&gt;[0x00000002]<font></font>
[0x0000000A]&lt;-&gt;[0x0000001D]<font></font>
[0x00000010]&lt;-&gt;[0x00000015]<font></font>
[0x00000004]&lt;-&gt;[0x00000013]<font></font>
[0x0000000D]&lt;-&gt;[0x00000018]</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受け取った情報に基づいて、私はメーカーのデータベースに各ID NORフラッシュと対応するシリアル番号とMACアドレスに関する情報が含まれていると思い込んでいます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これをすべて選択することは不可能ですが、プレフィックスを完全にエミュレートする独自のソフトウェアを作成できます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486880/index.html">悲惨な結果をもたらした翻訳者の間違い</a></li>
<li><a href="../ja486884/index.html">日本の製薬会社がニューラルネットワークを使用して合成された医薬品のテストを開始</a></li>
<li><a href="../ja486888/index.html">本「オブジェクト指向アプローチ。5番目の整数。編」</a></li>
<li><a href="../ja486890/index.html">自己啓発：2つの椅子に座らずに3つ目の椅子を見つけた方法</a></li>
<li><a href="../ja486892/index.html">Contact Picker API、または連絡先をブラウザーと共有する方法</a></li>
<li><a href="../ja486902/index.html">Swift 5.1のプロトコル指向プログラミング</a></li>
<li><a href="../ja486904/index.html">SonarQubeでのソースコードの品質管理のステータスを開発者に示す</a></li>
<li><a href="../ja486908/index.html">Wulfric Ransomwareは存在しない暗号化プログラムです</a></li>
<li><a href="../ja486912/index.html">Lowkiq。なぜそれをしたのですか？</a></li>
<li><a href="../ja486914/index.html">8. Fortinet Getting Started v6.0。ユーザーと協力する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>