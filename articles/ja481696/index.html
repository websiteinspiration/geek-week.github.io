<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âš¾ï¸ ğŸ‘©ğŸ¼â€ğŸ“ ğŸ‘ ruleguardï¼šGoã®å‹•çš„ãƒã‚§ãƒƒã‚¯ ğŸ¤ğŸ¾ ğŸ‘©ğŸ¿â€âœˆï¸ ğŸ§•ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®è¨˜äº‹ã§ã¯ã€é™çš„è§£æã®æ–°ã—ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãŠã‚ˆã³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚go-ruleguardã“ã‚Œã¯gogrepã€ãƒªãƒ³ã‚¿ãƒ¼å†…ã§ã®ä½¿ç”¨ã«é©å¿œã—ã¾ã™ã€‚
 

ç‰¹å¾´çš„ãªæ©Ÿèƒ½ï¼šç‰¹åˆ¥ãªGoã®ã‚ˆã†ãªDSLã®é™çš„åˆ†æã®ãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€æœ€åˆruleguardã«ä¸€é€£ã®è¨ºæ–­ã«å¤‰ã‚ã‚Šã¾ã™ã€‚ãŠãã‚‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ruleguardï¼šGoã®å‹•çš„ãƒã‚§ãƒƒã‚¯</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481696/"><p><img src="https://habrastorage.org/webt/b5/p-/sq/b5p-sqgr-9b1e5mimtxaftmryau.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€é™çš„è§£æã®æ–°ã—ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãŠã‚ˆã³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go-ruleguard</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>gogrep</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒªãƒ³ã‚¿ãƒ¼å†…ã§ã®ä½¿ç”¨ã«</font><font style="vertical-align: inherit;">é©å¿œ</font><font style="vertical-align: inherit;">ã—ã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹å¾´çš„ãªæ©Ÿèƒ½ï¼šç‰¹åˆ¥ãªGoã®ã‚ˆã†ãªDSLã®é™çš„åˆ†æã®ãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€æœ€åˆ</font></font><code>ruleguard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ä¸€é€£ã®è¨ºæ–­ã«å¤‰ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŠãã‚‰ãã€ã“ã‚Œã¯Goã®ã‚«ã‚¹ã‚¿ãƒ æ¤œæŸ»ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®æœ€ã‚‚ç°¡å˜ã«æ§‹æˆå¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã®1ã¤ã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŠã¾ã‘ã¨ã—ã¦ã€ç§ãŸã¡ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/analysis</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰ä»»è€…</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã¤ã„ã¦è©±ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></p><a name="habracut"></a><br>
<h1 id="rasshiryaemost-staticheskogo-analiza"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™çš„åˆ†æã®æ‹¡å¼µæ€§</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goã«ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤šãã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªãƒ³ã‚¿ãƒ¼</font><font style="vertical-align: inherit;">ãŒã‚ã‚Š</font><font style="vertical-align: inherit;">ã€ãã®ä¸€éƒ¨ã¯æ‹¡å¼µã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ã€ãƒªãƒ³ã‚¿ãƒ¼ã‚’æ‹¡å¼µã™ã‚‹ã«ã¯ã€ç‰¹åˆ¥ãªãƒªãƒ³ã‚¿ãƒ¼APIã‚’ä½¿ç”¨ã—ã¦Goã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸»ãªæ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚Goãƒ—ãƒ©ã‚°ã‚¤ãƒ³</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãƒ¢ãƒãƒªã‚¹ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¢ãƒãƒªã‚¹ã¯ã€ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ï¼ˆå€‹äººã®ãƒã‚§ãƒƒã‚¯ã‚’å«ã‚€ï¼‰ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ®µéšã§ä½¿ç”¨ã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>revive</code></a>         . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go-critic</code></a>      ,        .    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/ast</code></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/types</code></a>  Go,  API .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/analysis</code></a>    ,  ""     ,          .</p><br>
<div class="spoiler"><b class="spoiler_title">  `loader`  `go/packages`</b><div class="spoiler_text"><hr><br>
<p>     Go,       AST  ,   ,     ,      "".  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/loader</code></a>,   ""     .    ,     deprecated   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/packages</code></a>. <code>go/packages</code>    API ,  ,    .</p><br>
<p>            ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/analysis</code></a>  <code>go/packages</code> ,         â€”    .      <code>go/analysis</code>       .      , , <code>go/analysis</code>           ,             .</p><br>
<p><code>go/analysis</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<hr></div></div><br>
<h1 id="chto-zhe-takoe-ruleguard">   ruleguard?</h1><br>
<p><img src="https://habrastorage.org/webt/zp/ym/rj/zpymrjjb8zkqa_c069ccd-yf3xg.png"></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go-ruleguard</code></a> â€”    ,          .</p><br>
<p> <code>ruleguard</code>   ,   <code>gorules</code> ,    ,     .       <code>ruleguard</code>.</p><br>
<p>        ,    <code>gorules</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>  <code>ruleguard</code>  :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/quasilyte/go-ruleguard/analyzer"</span>
    <span class="hljs-string">"golang.org/x/tools/go/analysis/singlechecker"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {<font></font>
    singlechecker.Main(analyzer.Analyzer)<font></font>
}</code></pre><br>
<p>  <code>analyzer</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>ruleguard</code></a>,      ,       .</p><br>
<h1 id="ruleguard-vs-revive">ruleguard VS revive</h1><br>
<p> ,   : ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>runtime.GC()</code></a>   .  revive      ,   <code>"call-to-gc"</code>.</p><br>
<div class="spoiler"><b class="spoiler_title"> call-to-gc (70   )</b><div class="spoiler_text"><hr><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> rule<font></font>
<font></font>
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"go/ast"</span><font></font>
<font></font>
    <span class="hljs-string">"github.com/mgechev/revive/lint"</span><font></font>
)<font></font>
<font></font>
<span class="hljs-comment">// CallToGCRule lints calls to the garbage collector.</span>
<span class="hljs-keyword">type</span> CallToGCRule <span class="hljs-keyword">struct</span>{}<font></font>
<font></font>
<span class="hljs-comment">// Apply applies the rule to given file.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *CallToGCRule)</span> <span class="hljs-title">Apply</span><span class="hljs-params">(file *lint.File, _ lint.Arguments)</span> []<span class="hljs-title">lint</span>.<span class="hljs-title">Failure</span></span> {
    <span class="hljs-keyword">var</span> failures []lint.Failure<font></font>
    onFailure := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(failure lint.Failure)</span></span> {<font></font>
        failures = <span class="hljs-built_in">append</span>(failures, failure)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> gcTriggeringFunctions = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">bool</span>{
        <span class="hljs-string">"runtime"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">bool</span>{<span class="hljs-string">"GC"</span>: <span class="hljs-literal">true</span>},<font></font>
    }<font></font>
<font></font>
    w := lintCallToGC{onFailure, gcTriggeringFunctions}<font></font>
    ast.Walk(w, file.AST)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> failures<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Name returns the rule name.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *CallToGCRule)</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"call-to-gc"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> lintCallToGC <span class="hljs-keyword">struct</span> {<font></font>
    onFailure             <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(lint.Failure)</span></span>
    gcTriggeringFunctions <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">bool</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w lintCallToGC)</span> <span class="hljs-title">Visit</span><span class="hljs-params">(node ast.Node)</span> <span class="hljs-title">ast</span>.<span class="hljs-title">Visitor</span></span> {<font></font>
    ce, ok := node.(*ast.CallExpr)<font></font>
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> w <span class="hljs-comment">// nothing to do, the node is not a call</span><font></font>
    }<font></font>
<font></font>
    fc, ok := ce.Fun.(*ast.SelectorExpr)<font></font>
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// nothing to do, the call is not of the form pkg.func(...)</span><font></font>
    }<font></font>
<font></font>
    id, ok := fc.X.(*ast.Ident)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> !ok {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// in case X is not an id (it should be!)</span><font></font>
    }<font></font>
<font></font>
    fn := fc.Sel.Name<font></font>
    pkg := id.Name<font></font>
    <span class="hljs-keyword">if</span> !w.gcTriggeringFunctions[pkg][fn] {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// it isn't a call to a GC triggering function</span><font></font>
    }<font></font>
<font></font>
    w.onFailure(lint.Failure{<font></font>
        Confidence: <span class="hljs-number">1</span>,<font></font>
        Node:       node,<font></font>
        Category:   <span class="hljs-string">"bad practice"</span>,<font></font>
        Failure:    <span class="hljs-string">"explicit call to the garbage collector"</span>,<font></font>
    })<font></font>
<font></font>
    <span class="hljs-keyword">return</span> w<font></font>
}</code></pre><br>
<hr></div></div><br>
<p>    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go-ruleguard</code></a>:</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> gorules<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/quasilyte/go-ruleguard/dsl/fluent"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">callToGC</span><span class="hljs-params">(m fluent.Matcher)</span></span> {<font></font>
    m.Match(<span class="hljs-string">`runtime.GC()`</span>).Report(<span class="hljs-string">`explicit call to the garbage collector`</span>)<font></font>
}</code></pre><br>
<p> ,  ,    â€” <code>runtime.GC</code>  ,       .</p><br>
<p>  :   ?       ,  ,             . ,     .</p><br>
<h1 id="quick-start">Quick start</h1><br>
<p> <code>go-critic</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>rangeExprCopy</code></a>,        .</p><br>
<p>     <strong></strong> :</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> xs [<span class="hljs-number">2048</span>]<span class="hljs-keyword">byte</span>
<span class="hljs-keyword">for</span> _, x := <span class="hljs-keyword">range</span> xs { <span class="hljs-comment">// Copies 2048 bytes</span>
    <span class="hljs-comment">// Loop body.</span>
}</code></pre><br>
<p>       :</p><br>
<pre><code class="diff hljs">  var xs [2048]byte
<span class="hljs-deletion">- for _, x := range xs {  // Copies 2048 bytes</span>
<span class="hljs-addition">+ for _, x := range &amp;xs { // No copy</span><font></font>
    // Loop body.<font></font>
  }</code></pre><br>
<p> ,     ,      .  ,  Go   ,                 <code>go-critic</code>.</p><br>
<p>      <code>gorules</code> ( <code>rules.go</code>):</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> gorules<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/quasilyte/go-ruleguard/dsl/fluent"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> _<span class="hljs-params">(m fluent.Matcher)</span></span> {<font></font>
    m.Match(<span class="hljs-string">`for $_, $_ := range $x { $*_ }`</span>,
            <span class="hljs-string">`for $_, $_ = range $x { $*_ }`</span>).<font></font>
            Where(m[<span class="hljs-string">"x"</span>].Addressable &amp;&amp; m[<span class="hljs-string">"x"</span>].Type.Size &gt;= <span class="hljs-number">128</span>).<font></font>
            Report(<span class="hljs-string">`$x copy can be avoided with &amp;$x`</span>).<font></font>
            At(m[<span class="hljs-string">"x"</span>]).<font></font>
            Suggest(<span class="hljs-string">`&amp;$x`</span>)<font></font>
}</code></pre><br>
<p>    <code>for-range</code>,      (     ).   <code>$x</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>addressable</code></a>          .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Report()</code></a>  ,    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Suggest()</code></a>  <code>quickfix</code> ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">gopls</a> (LSP),   ,  <code>ruleguard</code>    <code>-fix</code> (    ). <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>At()</code></a>   <strong></strong> <code>quickfix</code>    .   ,   <code>$x</code>  <code>&amp;$x</code>,     .</p><br>
<p> <code>Report()</code>,  <code>Suggest()</code>,  ,        <code>Match()</code> .   <code>$$</code>  "  " ( <code>$0</code>   ).</p><br>
<p>  <code>rangecopy.go</code>:</p><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> example<font></font>
<font></font>
<span class="hljs-comment">// sizeof(builtins[...]) = 240 on x86-64</span>
<span class="hljs-keyword">var</span> builtins = [...]<span class="hljs-keyword">string</span>{
    <span class="hljs-string">"append"</span>, <span class="hljs-string">"cap"</span>, <span class="hljs-string">"close"</span>, <span class="hljs-string">"complex"</span>, <span class="hljs-string">"copy"</span>,
    <span class="hljs-string">"delete"</span>, <span class="hljs-string">"imag"</span>, <span class="hljs-string">"len"</span>, <span class="hljs-string">"make"</span>, <span class="hljs-string">"new"</span>, <span class="hljs-string">"panic"</span>,
    <span class="hljs-string">"print"</span>, <span class="hljs-string">"println"</span>, <span class="hljs-string">"real"</span>, <span class="hljs-string">"recover"</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">builtinID</span><span class="hljs-params">(name <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">int</span></span> {
    <span class="hljs-keyword">for</span> i, s := <span class="hljs-keyword">range</span> builtins {
        <span class="hljs-keyword">if</span> s == name {
            <span class="hljs-keyword">return</span> i<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
}</code></pre><br>
<p>    <code>ruleguard</code>:</p><br>
<pre><code class="bash hljs">$ ruleguard -rules rules.go -fix rangecopy.go<font></font>
rangecopy.go:12:20: builtins copy can be avoided with &amp;builtins</code></pre><br>
<p>      <code>rangecopy.go</code>,    ,   <code>ruleguard</code>     <code>-fix</code>.</p><br>
<p>       <code>gorules</code> :</p><br>
<pre><code class="plaintext hljs">$ ruleguard -c 1 -e 'm.Match(`return -1`)' rangecopy.go<font></font>
rangecopy.go:17:2: return -1<font></font>
16      }<font></font>
17      return -1<font></font>
18  }</code></pre><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/analysis/singlechecker</code></a>     <code>-c</code>,          .     :     <code>-c=-1</code>,   " ",  <code>-c=0</code>      (,    ).</p><br>
<p>     <code>gorules</code>:</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,     . ,  <code>map[$t]$t</code>   ,        ,  <code>*[$len]$elem</code>     .</li>
<li>      ,<br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</li>
<li>      ,    .        .      ,       . ,   ,    <code>$x=$x+$y</code>  <code>$x+=$y</code>,    <code>$y=1</code>    <code>$x++</code>,   <code>$x+=1</code>.</li>
</ul><br>
<p>    DSL    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>docs/gorules.md</code></a>.</p><br>
<h1 id="eschyo-bolshe-primerov">  </h1><br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> gorules<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/quasilyte/go-ruleguard/dsl/fluent"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">exampleGroup</span><span class="hljs-params">(m fluent.Matcher)</span></span> {
        <span class="hljs-comment">//     json.Decoder.</span>
        <span class="hljs-comment">// . http://golang.org/issue/36225</span>
        m.Match(<span class="hljs-string">`json.NewDecoder($_).Decode($_)`</span>).<font></font>
                Report(<span class="hljs-string">`this json.Decoder usage is erroneous`</span>)<font></font>
<font></font>
        <span class="hljs-comment">//   unconvert,    .</span>
        m.Match(<span class="hljs-string">`time.Duration($x) * time.Second`</span>).<font></font>
                Where(m[<span class="hljs-string">"x"</span>].Const).<font></font>
                Suggest(<span class="hljs-string">`$x * time.Second`</span>)<font></font>
<font></font>
        <span class="hljs-comment">//   fmt.Sprint()    String(),</span>
        <span class="hljs-comment">//   $x  .</span>
        m.Match(<span class="hljs-string">`fmt.Sprint($x)`</span>).<font></font>
                Where(m[<span class="hljs-string">"x"</span>].Type.Implements(<span class="hljs-string">`fmt.Stringer`</span>)).<font></font>
                Suggest(<span class="hljs-string">`$x.String()`</span>)<font></font>
<font></font>
        <span class="hljs-comment">//   .</span>
        m.Match(<span class="hljs-string">`!($x != $y)`</span>).Suggest(<span class="hljs-string">`$x == $y`</span>)<font></font>
        m.Match(<span class="hljs-string">`!($x == $y)`</span>).Suggest(<span class="hljs-string">`$x != $y`</span>)<font></font>
}</code></pre><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Report()</code></a>,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Suggest()</code></a>.       .</p><br>
<p>       . ,    <code>Pure</code>  <code>Const</code>:</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Var.Pure</code></a> ,      .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Var.Const</code></a> ,         (,  ).</li>
</ul><br>
<p> <code>package-qualified</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Where()</code></a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>Import()</code></a>.  ,      ,          .</p><br>
<h1 id="goanalysis-quickfix-actions"><code>go/analysis</code> quickfix actions</h1><br>
<p> <code>quickfix</code>    <code>go/analysis</code>.</p><br>
<p>  <code>go/analysis</code>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.   ,       .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,            ,   ,  .</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go/analysis/doc/suggested_fixes.md</code></a>.</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p><img src="https://habrastorage.org/webt/m3/bs/zw/m3bszwzp2nwkxrnxdnenypatyjk.png"></p><br>
<p> <code>ruleguard</code>   ,   ,         , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> issue</a>.</p><br>
<p>       <code>ruleguard</code>,  :</p><br>
<ul>
<li>     Go.</li>
<li>       <code>-fix</code>.</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>-json</code></a>  .</li>
</ul><br>
<p>   <code>ruleguard</code>   :</p><br>
<ul>
<li> <code>ruleguard</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>go-critic</code></a>      .</li>
<li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Applied Go code similarity analysis</a> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>).</li>
<li>    DSL. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">sub-matches</a>    .</li>
</ul><br>
<h1 id="poleznye-ssylki-i-resursy">   </h1><br>
<ul>
<li>    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>rules.go</code></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code> dsl/fluent</code></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code> ruleguard</code></a></li>
<li>    AST: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><code>mvdan/gogrep</code></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   NoVerify</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481680/index.html">TodoMVCã¯dapã§æ›¸ã„ã¦ã„ã¾ã™ã€‚ãƒ‘ãƒ¼ãƒˆ2</a></li>
<li><a href="../ja481684/index.html">Powerbankã®ãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ï¼Ÿ</a></li>
<li><a href="../ja481688/index.html">ãªãœJavaã‚’å­¦ã³ã€ãã‚Œã‚’åŠ¹ç‡çš„ã«è¡Œã†æ–¹æ³•ã€‚Yandexãƒ¬ãƒãƒ¼ãƒˆ</a></li>
<li><a href="../ja481692/index.html">ã‚¤ãƒ³ãƒ†ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ãŸã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ãƒ¢ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹</a></li>
<li><a href="../ja481694/index.html">PostgreSQLã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ãƒ‘ã‚¹</a></li>
<li><a href="../ja481698/index.html">ãƒãƒ¼ãƒãƒ£ãƒ«ãƒªã‚¢ãƒªãƒ†ã‚£å†…ãŠã‚ˆã³ãã®å‘¨è¾ºã§ã®WebRTCã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°</a></li>
<li><a href="../ja481700/index.html">å”æ¯1äººã«ã¤ã„ã¦</a></li>
<li><a href="../ja481702/index.html">ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼ã‹ã‚‰ãƒ‰ãƒ­ãƒ¼ãƒ³ã¾ã§ã€‚ç‰©äº‹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¯ã©ã®ã‚ˆã†ã«ã—ã¦ç”Ÿã¾ã‚Œã€30å¹´å¾Œã«ã¯ãªãœã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒèµ·å‹•ã—ãŸã®ã‹</a></li>
<li><a href="../ja481704/index.html">ã“ã‚Œã¯æ¨™æº–ã§ã™-2ï¼šæ³•ç·šãƒãƒƒãƒ—ãŒãƒ™ã‚¤ã‚¯ã•ã‚Œã‚‹æ–¹æ³•</a></li>
<li><a href="../ja481706/index.html">ãƒ¬ãƒ¼ã‚¹ã§å¤±ã‚ã‚ŒãŸé‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã¨ãã®è‡´å‘½çš„ãªé–“é•ã„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>