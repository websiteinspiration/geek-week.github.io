<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèª ü¶ã üóíÔ∏è Trolley Robot 2.0. Partie 1. Navigation autonome d'un robot domestique bas√© sur ROS üë∂üèΩ üë© üó®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le projet a √©t√© construit sur la base d'un autre projet bien connu dans ses cercles - linorobot (linorobot.org), en utilisant des composants disponibl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Trolley Robot 2.0. Partie 1. Navigation autonome d'un robot domestique bas√© sur ROS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502076/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le projet a √©t√© construit sur la base d'un autre projet bien connu dans ses cercles - linorobot (linorobot.org), en utilisant des composants disponibles pour un simple profane. </font><font style="vertical-align: inherit;">Les objectifs qui ont √©t√© fix√©s: r√©aliser un mouvement autonome du robot √† la maison en utilisant des composants √† faible co√ªt, √©valuer les performances des mini-PC aux fins indiqu√©es, configurer la pile de navigation pour se d√©placer dans les espaces √©troits du Khrouchtchev.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OGxB34-heds" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La liste des composants dans les solides est la suivante:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">framboise pi 3b - 2800 r .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lidar rplidar a1 - 7500 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ponts √©lectriques l298n -2pcs - 400 rub.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paire de roues avec encodeurs de type A et B - 2000 r. </font><font style="vertical-align: inherit;">(210 tr / min - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teenzy 3.2 - 2100 r.;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imu 9250 (9150 ou 6050) - 240 p .;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banque de puissance √† 10000mH - 1500 r.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 piles 18650 et support -600 p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convertisseur abaisseur dc-dc c 5V √† 3,3V - 20p.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un morceau de contreplaqu√©, parquet -? </font><font style="vertical-align: inherit;">frotter.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total: 17160 p. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Le co√ªt peut √™tre r√©duit en rempla√ßant teenzy par arduino mega 2560 (600 p.), Et lidar en rempla√ßant kinect v.1 (1000 p.): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/vb/v4/ecvbv42ipnldzd5vhureodavsqi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il convient de noter que le premier kinect a une visibilit√© minimale (zone aveugle) de 0,5 m, ce qui peut nuire √† la navigation dans des conditions exigu√´s et il est plut√¥t encombrant. </font><font style="vertical-align: inherit;">Le lidar a une zone aveugle de moins de 0,2 m. Kinect v.2 ne conviendra pas √† la framboise 3b (il n'a pas d'usb 3.0). </font><font style="vertical-align: inherit;">Arduino mega est inf√©rieur √† teenzy en taille (et certaines caract√©ristiques), en plus, vous devrez retravailler l√©g√®rement le code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, le ¬´design¬ª ressemble √† ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/ru/x9/ourux9icibrxsh4ruai61e3wkx4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yg/bh/0h/ygbh0hlvz8juq6qi4e9tarrhznq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de beaut√© ici, bien s√ªr, mais ce n'est pas tout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du robot lui-m√™me, il est hautement souhaitable d'avoir un PC externe sur lequel seront lanc√©s des coques graphiques pour visualiser les actions du robot (rviz, gazebo).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assemblage de robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est peint en d√©tail sur le site Web du projet - un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , alors insistons sur les points qui causent des difficult√©s. </font><font style="vertical-align: inherit;">Vous devez d'abord consid√©rer que les encodeurs de la paire de roues sont aliment√©s en 3,3 V et, lorsque 5 V sont appliqu√©s, √©chouent parfaitement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script d'installation de linorobot est correctement install√© sur ubuntu 16.04, ubuntu 18.04. </font><font style="vertical-align: inherit;">Versions ROS: ROS cin√©tique ou ROS m√©lodique. </font><font style="vertical-align: inherit;">Sur framboise 3b, vous devez d'abord cr√©er un fichier d'√©change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principal code teenzy est en cours de route:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware/lib/config<font></font>
nano lino_base_config.h<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et vers√© dedans avec la commande:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/teensy/firmware<font></font>
platformio run --target upload<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ensembles de commandes ci-dessus seront utilis√©s assez souvent, il est donc logique de les ajouter aux alias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison des difficult√©s d'assemblage du robot, la corr√©lation correcte des contacts connect√©s allant de l298n √† teenzy peut √™tre g√™nante. </font><font style="vertical-align: inherit;">Malgr√© le sch√©ma de connexion extr√™mement clair, les roues peuvent se comporter diff√©remment et doivent exp√©rimenter, en choisissant l'affectation des broches correcte dans le code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, cela s'est av√©r√© comme ceci:</font></font><br>
<br>
<pre><code class="bash hljs">/// ENCODER PINS
<span class="hljs-comment">#define MOTOR1_ENCODER_A 14</span>
<span class="hljs-comment">#define MOTOR1_ENCODER_B 15 </span><font></font>
<font></font>
<span class="hljs-comment">#define MOTOR2_ENCODER_A 11</span>
<span class="hljs-comment">#define MOTOR2_ENCODER_B 12 </span><font></font>
//MOTOR PINS<font></font>
<span class="hljs-comment">#ifdef USE_L298_DRIVER</span>
  <span class="hljs-comment">#define MOTOR_DRIVER L298</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR1_PWM 21</span>
  <span class="hljs-comment">#define MOTOR1_IN_A 1</span>
  <span class="hljs-comment">#define MOTOR1_IN_B 20</span><font></font>
<font></font>
  <span class="hljs-comment">#define MOTOR2_PWM 5</span>
  <span class="hljs-comment">#define MOTOR2_IN_A 8</span>
  <span class="hljs-comment">#define MOTOR2_IN_B 6</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me point est de prescrire la sp√©cification des roues du robot:</font></font><br>
<br>
<pre><code class="bash hljs">//define your robot<span class="hljs-string">' specs here
#define MAX_RPM 210               // motor'</span>s maximum RPM
<span class="hljs-comment">#define COUNTS_PER_REV 1365       // wheel encoder's no of ticks per rev</span>
<span class="hljs-comment">#define WHEEL_DIAMETER 0.065       // wheel's diameter in meters</span>
<span class="hljs-comment">#define PWM_BITS 8                // PWM Resolution of the microcontroller</span>
<span class="hljs-comment">#define LR_WHEELS_DISTANCE 0.235  // distance between left and right wheels</span>
<span class="hljs-comment">#define FR_WHEELS_DISTANCE 0.30   // distance between front and rear wheels. Ignore this if you're on 2WD/ACKERMANN</span>
<span class="hljs-comment">#define MAX_STEERING_ANGLE 0.415  // max steering angle. This only applies to Ackermann st</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPM peut √™tre trouv√© dans la sp√©cification de roue, mais CPR (COUNTS_PER_REV) est la valeur calcul√©e. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPR = PPR x 4. PPR de nos roues 341. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR peut √™tre visualis√© dans les sp√©cifications ou ex√©cuter le code sur le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">robot roslaunch linorobot minimal.launch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et tourner la roue √† 360 degr√©s. PPR sera √©gal √† la valeur num√©rique qui sera affich√©e √† l'√©cran apr√®s la rotation de la roue: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/7z/ks/be7zksecqhlyuyv-e_dkxqdyrwe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* PPR = abs (RECENT_COUNT - INITIAL_COUNT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc CPR = 1364. Vous devez √©galement d√©finir WHEEL_DIAMETER et LR_WHEELS_DISTANCE en m√®tres. De plus, LR_WHEELS_DISTANCE est la distance entre les axes centraux des roues, et non pas de bord √† bord. D'autres indicateurs peuvent √™tre ignor√©s si le robot est √† deux roues, diff√©rentiel (pas omni). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisi√®me point qui peut poser des probl√®mes - l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©talonnage imu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour ce faire, en suivant les instructions, il est n√©cessaire de fixer le robot dans certaines positions. Les conseils seront dans le code lors de l'ex√©cution du </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script rosrun imu_calib do_calib</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : une </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/fj/9e/ggfj9eg71ilp0baj7rvshjl-fmw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fois termin√©, imu_calib.yaml avec les param√®tres sera g√©n√©r√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est pr√©f√©rable d'effectuer l'√©talonnage, malgr√© le fait qu'il existe un fichier par d√©faut avec les param√®tres imu. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* De plus, il s'est av√©r√© que l'√©talonnage imu peut affecter la direction du mouvement du robot par t√©l√©op√©ration (gauche au lieu de droite et vice versa, alors que le mouvement de va-et-vient √©tait correct). La situation n'a pas √©t√© r√©solue par le r√©arrangement des broches dans le code. Imu lui-m√™me a √©t√© fix√© et calibr√© avec des supports invers√©s, comme fix√© √† l'arri√®re de la base du robot. Son (imu) flip suppl√©mentaire sans recalibrage a r√©solu le probl√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quatri√®me point - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©talonnage pid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le site Web du projet, la proc√©dure de mise en ≈ìuvre de l'ajustement est d√©crite en d√©tail - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il sera difficile pour un d√©butant de comprendre ce que c'est et comment travailler avec. </font><font style="vertical-align: inherit;">En g√©n√©ral, une r√©gulation pid est n√©cessaire pour garantir que le robot se d√©place uniform√©ment, sans secousses / freinage brusque. </font><font style="vertical-align: inherit;">Trois param√®tres en sont responsables: p, i, d. </font><font style="vertical-align: inherit;">Leurs valeurs sont contenues dans le code principal t√©l√©charg√© sur teenzy:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define K_P 2.0 // P constant angle</span>
<span class="hljs-comment">#define K_I 0.3 // I constant</span>
<span class="hljs-comment">#define K_D 0.1 // D constant</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez les exp√©rimenter en ex√©cutant sur le robot:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot minimal.launch
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin sur le PC externe dans trois terminaux diff√©rents:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun lino_pid pid_configure<font></font>
rosrun teleop_twist_keyboard teleop_twist_keyboard.py<font></font>
rqt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d√©pla√ßant les curseurs p, d, i dans le terminal rqt, puis en contr√¥lant le robot dans le terminal teleop_twist_keyboard, vous pouvez obtenir les r√©sultats n√©cessaires sans avoir √† t√©l√©charger le code avec les nouveaux param√®tres pid √† chaque fois dans teenzy: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/9m/ef/qr9mefipf7mqz9vwqqyqkktkeug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c'est-√†-dire que tout se passe √† la vol√©e et √† ce moment-l√† dans le firmware teenzy peut avoir des significations compl√®tement diff√©rentes. </font><font style="vertical-align: inherit;">* Vous ne pouvez pas vous concentrer sur les graphiques, car </font><font style="vertical-align: inherit;">visuellement, et ainsi on comprendra COMMENT le robot se d√©place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils recommandent de commencer par d√©finir les valeurs p = 1,0, d = 0,1, i = 0,1. </font><font style="vertical-align: inherit;">Dans notre cas, les valeurs sont les suivantes (obtenues exp√©rimentalement) p = 2,0, i = 0,3, d = 0,1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ces valeurs doivent √™tre d√©finies dans le code et remplies dans teenzy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas non plus de d√©finir le code (DEBUG 0 au lieu de DEBUG 1):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#define DEBUG 0</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Odom√©trie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'orientation du robot et la navigation ult√©rieure, les donn√©es lidar, imu et encodeur de roue sont utilis√©es. Si l'√©talonnage imu est effectu√© correctement, que le lidar est correctement install√© et que les valeurs de l'encodeur sont correctes, il ne devrait y avoir aucun probl√®me d'odom√©trie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour v√©rifier que l'odom√©trie est correcte, vous devez rouler un peu sur le robot via teleop et voir les valeurs dans la rubrique odom, cela est √©crit sur la page du projet - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et regardez √©galement dans la coque visuelle de rviz: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/td/si/rrtdsilkdlggf3ifjhk1uhl8bz0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
une cellule de rviz mesure 1 m, il est donc conseill√© au robot de passer ce compteur √† la fois dans l'√©diteur visuel et en nature. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, la distance parcourue est affich√©e dans l'indicateur w: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/oj/l6/i1ojl6vg5jyugymjwgk-5cfsrlm.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle doit √©galement tendre √† 1 m. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il en va de m√™me pour les angles de rotation du robot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/uf/bv/l0ufbvhsko99na50frablnrvsc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* En rviz et en direct, le robot doit tourner selon les m√™mes angles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'odom√©trie d'un lidar est d√©finie de la m√™me mani√®re - un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien: la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> distance entre le lidar et le mur le plus proche, en direct et en direct, doit correspondre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TF</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ROS, une attention particuli√®re est accord√©e aux transformations - tf. </font><font style="vertical-align: inherit;">D'une mani√®re g√©n√©rale, ce concept d√©crit la corr√©lation des objets les uns par rapport aux autres dans l'espace. </font><font style="vertical-align: inherit;">Pour que les objets ne pendent pas en l'air et que le programme comprenne comment ils sont pr√©sent√©s les uns par rapport aux autres, il est n√©cessaire de faire attention au r√©glage tf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le projet, toutes les connexions tf sont d√©j√† configur√©es les unes par rapport aux autres et il vous suffit d'ajuster les indicateurs, par exemple, d'indiquer comment se trouve le lidar. </font><font style="vertical-align: inherit;">Cela est n√©cessaire pour que le robot comprenne que l'obstacle ne s'est pas pos√© directement devant lui, mais devant le lidar, qui est s√©par√© du centre du robot √† une certaine distance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allons dans le r√©pertoire appropri√©:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch<font></font>
nano bringup.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base elle-m√™me est situ√©e √† une distance de 0,065 m du sol:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_footprint_to_base_link"</span> args=<span class="hljs-string">"0 0 0.065 0 0 0  /base_footprint /base_link "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans laser.launch, vous devez d√©finir l'emplacement du lidar par rapport au centre de la base du robot:</font></font><br>
<br>
<pre><code class="bash hljs">roscd linorobot/launch/include<font></font>
nano laser.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, le lidar est d√©cal√© le long de l'axe x: -0,08, y: 0,04 et "monte" au-dessus de la base (axe z): 0,08m:</font></font><br>
<br>
<pre><code class="bash hljs">&lt;node pkg=<span class="hljs-string">"tf2_ros"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"static_transform_publisher"</span> name=<span class="hljs-string">"base_link_to_laser"</span>
args=<span class="hljs-string">"-0.08 0.04 0.08 0 0 0  /base_link /laser "</span>/&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En rviz, cet emplacement peut √™tre observ√© visuellement: bien </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1v/rz/gj/1vrzgjmhx-gf-jar7jxfbhcovte.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
que non loin du lidar, </font><font style="vertical-align: inherit;">nous ajusterons </font><font style="vertical-align: inherit;">sa fr√©quence pour qu'il donne plus de points (par d√©faut, il donne 4k), cela aidera √† construire la carte:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> linorobot/launch/include/lidar<font></font>
nano rplidar.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter un param√®tre:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"scan_mode"</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Boost"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et changer </font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"angle_compensate"</span>    <span class="hljs-attr">type</span>=<span class="hljs-string">"bool"</span>   <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant 8k est √† notre disposition: L' </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/u0/fq/zfu0fqd4d7nwmuv50am1qhwqxbm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
emplacement physique du lidar sur le robot est √©galement important:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/46/mw/vq/46mwvqq3kj7nxpskvoadm7xe738.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construire un plan de salle 2D</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur le site du projet, il est propos√© de construire un plan de salle en lan√ßant dans deux terminaux:</font></font><br>
<br>
<pre><code class="bash hljs">roslaunch linorobot bringup.launch<font></font>
roslaunch linorobot slam.launch<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, la pratique a montr√© que le slam, qui accompagne le projet par d√©faut, refuse de fonctionner lorsque le mode lidar est √† 8k: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/xa/a5/zexaa5f_1byvgcvvvkvcr7cowbi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
alors qu'en mode 4k, les cartes ne sont pas tr√®s r√©ussies, elles sont tr√®s bruyantes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, il est pr√©f√©rable d'utiliser un autre slam - hector-slam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment l'installer est indiqu√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s l'installation, la proc√©dure de cr√©ation d'une carte sera la m√™me, mais au lieu de roslaunch linorobot slam.launch, ex√©cutez roslaunch my_hector_mapping my_launch.launch Les </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cartes sont plus propres, mais il est pr√©f√©rable de les modifier dans un √©diteur graphique, supprimant celles inutiles, surtout si le lidar est entr√© en collision avec des miroirs lors de la construction de la carte : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cn/zo/jv/cnzojvfwpkwgldoo3mylfwwh-yg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas de sauvegarder le plan des chambres:</font></font><br>
<br>
<pre><code class="bash hljs">rosrun map_server map_saver -f my-map
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Les cartes sont mieux obtenues dans un cr√©puscule agr√©able, ce qui tirera le meilleur parti du lidar budg√©taire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä suivre.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502054/index.html">R√©seau de neurones convolutifs et son int√©gration dans iOS (partie 2)</a></li>
<li><a href="../fr502066/index.html">Commandes de console simples que tout le monde devrait conna√Ætre</a></li>
<li><a href="../fr502068/index.html">110 volts sur votre ordinateur</a></li>
<li><a href="../fr502070/index.html">L'histoire de Pentax (article plus vid√©o)</a></li>
<li><a href="../fr502072/index.html">Amarrage de l'ISS √† l'aide de JavaScript et d'une boussole</a></li>
<li><a href="../fr502080/index.html">M√©thode Kanban: Exemple PNZ n ¬∞ 1, le processus de mesure-√©tude dans une startup</a></li>
<li><a href="../fr502084/index.html">V√©rification du portail des services publics r√©gionaux sous charge par le biais de marionnettistes</a></li>
<li><a href="../fr502086/index.html">Configuration de Minio pour que l'utilisateur ne puisse travailler qu'avec son bucket</a></li>
<li><a href="../fr502088/index.html">Une histoire d'exc√®s et de temps perdu. Selon py3</a></li>
<li><a href="../fr502092/index.html">Assistance technologique et r√©glementaire pour les services de confiance num√©rique dans la F√©d√©ration de Russie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>