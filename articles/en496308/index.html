<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏿 🚵🏼 🕔 Create seamless noise maps 🤸🏻 ☝🏽 🌃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating a seamless image in Photoshop is easy: crop the image, grab the trimmed right and bottom parts, and then glue them to the left and top using ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Create seamless noise maps</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496308/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b72/cbf/259/b72cbf2592b2e142259d2cc3f7b13d6f.jpg" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creating a seamless image in Photoshop is easy: crop the image, grab the trimmed right and bottom parts, and then glue them to the left and top using the Fade tool. But for the proper implementation of seamless noise maps, you have to think carefully. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you have a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" title="Hugo elias on perlin noise" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic understanding of Perlin noise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then you know that it consists of interpolated random numbers. It is mainly used in two dimensions. But it is also useful in one dimension (for example, when moving), in three dimensions (cylindrical and spherical transformation of 3D objects), and even in four or five dimensions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Four-dimensional noise can be used to create a seamless 2D image. It is not very common for us to think in four dimensions, so we will take one dimension at a time.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my examples,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I used </font><font style="vertical-align: inherit;">two-octave </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" title="Simplex noise on Wikipedia" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplex noise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Simplex noise is faster in large dimensions, and due to its triangular nature, it looks better.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wrote a small function </font></font><code>drawNoise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to create a canvas and process a pixel array in a loop.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One-dimensional seamless noise</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In one dimension, noise is an infinite smooth line (my implementation of noise starts with two, so I use a constant as the second parameter). </font><font style="vertical-align: inherit;">Here we see that these are just interpolated random numbers.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// one dimensional line</span>
fNoiseScale = <span class="hljs-number">.02</span>;<font></font>
drawNoise(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i,x,y</span>)</span>{
    <span class="hljs-keyword">var</span> v = Simplex.noise(
         <span class="hljs-number">123</span>+x*fNoiseScale<font></font>
        ,<span class="hljs-number">137</span> <span class="hljs-comment">// we just need one dimension so this parameter is a constant</span><font></font>
    );<font></font>
    <span class="hljs-keyword">return</span> v*iSize&gt;y?<span class="hljs-number">255</span>:<span class="hljs-number">0</span>;<font></font>
}).img();</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fee/37f/7e1/fee37f7e153a8615cbd8fd6930d61fec.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One-dimensional noise</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
You can use this in animation, recalculating the noise value every millisecond, but you can also create a loop and calculate all the values ​​in advance. </font><font style="vertical-align: inherit;">The values ​​in the image above do not loop around the edges. </font><font style="vertical-align: inherit;">But implementing repeatability is quite simple, just one more dimension and loop ... or circle, for that.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One-dimensional loop</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For most of you, Perlin’s noise looks something like the image below.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/129/aad/02b129aadc25be9d0e74688ff1c702ff.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we drew a circle here and counted the noise values ​​on this circle, we would get a one-dimensional loop.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88a/6d9/247/88a6d9247a7dd2a9cbab6cf9ee08463b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noise with a circle to create a one-dimensional loop. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In code, it looks like this:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// one dimensional loop</span>
drawNoise(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i,x,y</span>)</span>{
    <span class="hljs-keyword">var</span> fNX = x/iSize <span class="hljs-comment">// we let the x-offset define the circle</span>
        ,fRdx = fNX*<span class="hljs-number">2</span>*<span class="hljs-built_in">Math</span>.PI <span class="hljs-comment">// a full circle is two pi radians</span>
        ,a = fRdsSin*<span class="hljs-built_in">Math</span>.sin(fRdx)<font></font>
        ,b = fRdsSin*<span class="hljs-built_in">Math</span>.cos(fRdx)<font></font>
        ,v = Simplex.noise(<font></font>
             <span class="hljs-number">123</span>+a*fNoiseScale<font></font>
            ,<span class="hljs-number">132</span>+b*fNoiseScale<font></font>
        )<font></font>
    ;<font></font>
    <span class="hljs-keyword">return</span> v*iSize&gt;y?<span class="hljs-number">255</span>:<span class="hljs-number">0</span>;<font></font>
}).img().div(<span class="hljs-number">2</span>);</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3da/43d/f64/3da43df64f677b0f55cfbcdc38a01c3e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You probably already understood what we're going to. </font><font style="vertical-align: inherit;">To loop a two-dimensional image, we need a three-dimensional (at least) noise map.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cylindrical card</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noise Perlin was originally created for continuous 3D-texturing (the film "Tron"). </font><font style="vertical-align: inherit;">The image map is not a sheet of paper wrapped around an object, but is calculated by its location in a three-dimensional noise field. </font><font style="vertical-align: inherit;">Therefore, when cutting the object, we can still calculate the map for the newly created surface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Before we reach our ultimate goal of a seamless image, we first create an image that seamlessly joins left and right. </font><font style="vertical-align: inherit;">This is similar to a two-dimensional circle for a one-dimensional loop, but with one additional dimension: a cylinder.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// three dimensional cylindrical map</span>
drawNoise(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i,x,y</span>)</span>{
    <span class="hljs-keyword">var</span> fNX = x/iSize<font></font>
        ,fRdx = fNX*<span class="hljs-number">2</span>*<span class="hljs-built_in">Math</span>.PI<font></font>
        ,a = fRdsSin*<span class="hljs-built_in">Math</span>.sin(fRdx)<font></font>
        ,b = fRdsSin*<span class="hljs-built_in">Math</span>.cos(fRdx)<font></font>
        ,v = Simplex.noise(<font></font>
             <span class="hljs-number">123</span>+a*fNoiseScale<font></font>
            ,<span class="hljs-number">132</span>+b*fNoiseScale<font></font>
            ,<span class="hljs-number">312</span>+y*fNoiseScale <span class="hljs-comment">// similar to the one dimensional loop but we add a third dimension defined by the image y-offset</span><font></font>
        )<font></font>
    ;<font></font>
    <span class="hljs-keyword">return</span> v*<span class="hljs-number">255</span>&lt;&lt;<span class="hljs-number">0</span>;<font></font>
}).img().div(<span class="hljs-number">2</span>);</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddc/f0b/55b/ddcf0b55bddba6cbc880300442a8b99e.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cylindrical noise map</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spherical map image</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You might think that it would be convenient to use a sphere to create a seamless image, but you are mistaken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will make a small digression and show how the spherical image map is calculated and what it looks like.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// three dimensional spherical map</span>
<span class="hljs-built_in">document</span>.body.addChild(<span class="hljs-string">'h2'</span>).innerText = <span class="hljs-string">'three dimensional spherical map'</span>;<font></font>
fNoiseScale = <span class="hljs-number">.1</span>;
<span class="hljs-keyword">var</span> oSpherical = drawNoise(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i,x,y</span>)</span>{
    <span class="hljs-keyword">var</span>  fNX = (x+<span class="hljs-number">.5</span>)/iSize <span class="hljs-comment">// added half a pixel to get the center of the pixel instead of the top-left</span>
        ,fNY = (y+<span class="hljs-number">.5</span>)/iSize<font></font>
        ,fRdx = fNX*<span class="hljs-number">2</span>*<span class="hljs-built_in">Math</span>.PI<font></font>
        ,fRdy = fNY*<span class="hljs-built_in">Math</span>.PI <span class="hljs-comment">// the vertical offset of a 3D sphere spans only half a circle, so that is one Pi radians</span>
        ,fYSin = <span class="hljs-built_in">Math</span>.sin(fRdy+<span class="hljs-built_in">Math</span>.PI) <span class="hljs-comment">// a 3D sphere can be seen as a bunch of cicles stacked onto each other, the radius of each of these is defined by the vertical position (again one Pi radians)</span>
        ,a = fRdsSin*<span class="hljs-built_in">Math</span>.sin(fRdx)*fYSin<font></font>
        ,b = fRdsSin*<span class="hljs-built_in">Math</span>.cos(fRdx)*fYSin<font></font>
        ,c = fRdsSin*<span class="hljs-built_in">Math</span>.cos(fRdy)<font></font>
        ,v = Simplex.noise(<font></font>
             <span class="hljs-number">123</span>+a*fNoiseScale<font></font>
            ,<span class="hljs-number">132</span>+b*fNoiseScale<font></font>
            ,<span class="hljs-number">312</span>+c*fNoiseScale<font></font>
        )<font></font>
    ;<font></font>
    <span class="hljs-keyword">return</span> v*<span class="hljs-number">255</span>&lt;&lt;<span class="hljs-number">0</span>;<font></font>
}).img();</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/351/5ec/a8f3515eccdd052b51d6e76b530d96ba.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spherical noise map</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/493/7c2/9e7/4937c29e770cc3bcf0790d9ab03d18a7.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sphere with noise</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubic panoramic map</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sphere we created can also be used as a panorama if you place a camera in the center of the sphere. </font><font style="vertical-align: inherit;">But the best way would be to use a cubic panorama, because it has much fewer faces. </font><font style="vertical-align: inherit;">The sphere is projected onto the six sides of the cube, as shown in this sketch.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b23/c53/119/b23c53119cd34d46d5643b7765a3db8d.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Superimposing a sphere on a cube</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For each pixel on the surface of the cube, we need to calculate the intersection between the viewpoint C in the center and the sphere. It may seem complicated, but it's actually pretty simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We can consider the CA line as a vector. And vectors can be normalized so that their direction does not change, but the length decreases to 1. Due to this, all vectors together will look like a sphere. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalization is also quite simple, we just need to divide the values ​​of the vector by xyz by the total length of the vector. The length of the vector can be calculated using the Pythagorean theorem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the code below, the normalization calculation is first performed on one face. </font><font style="vertical-align: inherit;">Then the noise is computed simultaneously for all six edges, because to get the position of the next face, you just need to flip the values ​​along xyz.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// 3D panoramical cube map</span>
<span class="hljs-built_in">document</span>.body.addChild(<span class="hljs-string">'h2'</span>).innerText = <span class="hljs-string">'3D panoramical cube map'</span>;
<span class="hljs-comment">// we're not using the drawNoise function because our canvas is rectangular</span>
<span class="hljs-keyword">var</span> mCubemap = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>)<font></font>
    ,iW = <span class="hljs-number">6</span>*iSize;<font></font>
mCubemap.width = iW;<font></font>
mCubemap.height = iSize;<font></font>
<span class="hljs-keyword">var</span>  iHSize = iSize/<span class="hljs-number">2</span> <span class="hljs-comment">// half the size of the cube</span>
    ,oCtx = mCubemap.getContext(<span class="hljs-string">'2d'</span>)<font></font>
    ,oImgData = oCtx.getImageData(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,iW,iSize)<font></font>
    ,aPixels = oImgData.data<font></font>
    ,aa = <span class="hljs-number">123</span>
    ,bb = <span class="hljs-number">231</span>
    ,cc = <span class="hljs-number">321</span><font></font>
;<font></font>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>,l=iSize*iSize;i&lt;l;i++) {
    <span class="hljs-keyword">var</span>  x = i%iSize        <span class="hljs-comment">// x position in image</span>
        ,y = (i/iSize)&lt;&lt;<span class="hljs-number">0</span>    <span class="hljs-comment">// y position in image</span>
        ,a = -iHSize + x+<span class="hljs-number">.5</span>    <span class="hljs-comment">// x position on the cube plane, the added .5 is to get the center of the pixel</span>
        ,b = -iHSize + y+<span class="hljs-number">.5</span> <span class="hljs-comment">// y position on the cube plane</span>
        ,c = -iHSize        <span class="hljs-comment">// z position of the cube plane</span>
        ,fDistanceAB = <span class="hljs-built_in">Math</span>.sqrt(a*a+b*b) <span class="hljs-comment">// to calculate the vectors length we use Pythagoras twice</span>
        ,fDistanceABC = <span class="hljs-built_in">Math</span>.sqrt(fDistanceAB*fDistanceAB+c*c)<font></font>
        ,fDrds = <span class="hljs-number">.5</span>*fDistanceABC <span class="hljs-comment">// adjust the distance a bit to get a better radius in the noise field</span>
        ,v = <span class="hljs-number">1</span><font></font>
    ;<font></font>
    a /= fDrds; <span class="hljs-comment">// normalize the vector</span>
    b /= fDrds; <span class="hljs-comment">// normalize the vector</span>
    c /= fDrds; <span class="hljs-comment">// normalize the vector</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// since we now know the spherical position for one plane we can derive the positions for the other five planes simply by switching the x, y and z values (the a, b and c variables)</span>
    <span class="hljs-keyword">var</span> aNoisePositions = [<font></font>
         [a,b,c]    <span class="hljs-comment">// back</span>
        ,[-c,b,a]    <span class="hljs-comment">// right</span>
        ,[-a,b,-c]    <span class="hljs-comment">// front</span>
        ,[c,b,-a]    <span class="hljs-comment">// left</span>
        ,[a,c,-b]    <span class="hljs-comment">// top</span>
        ,[a,-c,b]    <span class="hljs-comment">// bottom</span><font></font>
    ];<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">6</span>;j++) {<font></font>
        v = Simplex.noise(<font></font>
             aa + aNoisePositions[j][<span class="hljs-number">0</span>]<font></font>
            ,bb + aNoisePositions[j][<span class="hljs-number">1</span>]<font></font>
            ,cc + aNoisePositions[j][<span class="hljs-number">2</span>]<font></font>
        );<font></font>
        <span class="hljs-keyword">var</span> pos = <span class="hljs-number">4</span>*(y*iW+j*iSize+x); <span class="hljs-comment">// the final position of the rgba pixel</span>
        aPixels[pos] = aPixels[pos+<span class="hljs-number">1</span>] = aPixels[pos+<span class="hljs-number">2</span>] = v*<span class="hljs-number">255</span>&lt;&lt;<span class="hljs-number">0</span>;<font></font>
        aPixels[pos+<span class="hljs-number">3</span>] = <span class="hljs-number">255</span>;<font></font>
    }<font></font>
}<font></font>
oCtx.putImageData(oImgData,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="hljs-built_in">document</span>.body.addChild(<span class="hljs-string">'img'</span>,{<span class="hljs-attr">src</span>:mCubemap.toDataURL(<span class="hljs-string">"image/jpeg"</span>)});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are six sides in one image, plus a screenshot of how it looks when viewed from a cube. </font><font style="vertical-align: inherit;">The source code has a 3D example written in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" title="mr Doob's threejs on github" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">threejs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34e/e00/0ad/34ee000ada4ac534b92d51e92adaad8c.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cubic panoramic map</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb3/1a6/c6f/eb31a6c6ffbe85f0d62377d8997225f8.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seamless 2D Image</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It may seem that a seamless 2D image is easy to implement, but it seems to me that this is the most difficult of the described in the article, because to understand it you need to think in four dimensions. The closest thing to this was a cylindrical map (with horizontal repetition), so we will take it as a basis. In the cylindrical map, we used the horizontal position of the image for the circle; that is, the horizontal position of the image gives us two coordinates x and y in the noise field xyz. The vertical position of the image corresponds to z in the noise field.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We want the image to be seamless and vertical, so if we add another dimension, we can use it to create a second circle and replace the linear value of the z field. </font><font style="vertical-align: inherit;">This is similar to creating two cylinders in a four-dimensional field. </font><font style="vertical-align: inherit;">I tried to visualize this on a sketch, it is inaccurate, but I tried to convey the general principle, and not draw a four-dimensional cylinder.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b72/cbf/259/b72cbf2592b2e142259d2cc3f7b13d6f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sketch of two cylinders in four dimensions</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The code is quite simple: these are just two circles in a four-dimensional noise space.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// four dimensional tile</span>
fNoiseScale = <span class="hljs-number">.003</span>;<font></font>
drawNoise(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i,x,y</span>)</span>{
    <span class="hljs-keyword">var</span>  fNX = x/iSize<font></font>
        ,fNY = y/iSize<font></font>
        ,fRdx = fNX*<span class="hljs-number">2</span>*<span class="hljs-built_in">Math</span>.PI<font></font>
        ,fRdy = fNY*<span class="hljs-number">2</span>*<span class="hljs-built_in">Math</span>.PI<font></font>
        ,a = fRds*<span class="hljs-built_in">Math</span>.sin(fRdx)<font></font>
        ,b = fRds*<span class="hljs-built_in">Math</span>.cos(fRdx)<font></font>
        ,c = fRds*<span class="hljs-built_in">Math</span>.sin(fRdy)<font></font>
        ,d = fRds*<span class="hljs-built_in">Math</span>.cos(fRdy)<font></font>
        ,v = Simplex.noise(<font></font>
             <span class="hljs-number">123</span>+a*fNoiseScale<font></font>
            ,<span class="hljs-number">231</span>+b*fNoiseScale<font></font>
            ,<span class="hljs-number">312</span>+c*fNoiseScale<font></font>
            ,<span class="hljs-number">273</span>+d*fNoiseScale<font></font>
        )<font></font>
    ;<font></font>
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">2</span>*(v <span class="hljs-number">-.5</span>)+<span class="hljs-number">.5</span>,<span class="hljs-number">0</span>),<span class="hljs-number">1</span>)*<span class="hljs-number">255</span>)&lt;&lt;<span class="hljs-number">0</span>;<font></font>
}).img().div(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here is the result:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/421/ea5/5c4/421ea55c40887a7d4fcb846d3ed35db1.jpg" alt="image"></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en496290/index.html">Kotlin / Java console utility using args4j library</a></li>
<li><a href="../en496292/index.html">Neuro-stimulation of the spinal cord allows people paralyzed after spinal injuries to walk</a></li>
<li><a href="../en496300/index.html">Asynchronous code in Startup ASP.NET Core: 4 ways to get around GetAwaiter (). GetResult ()</a></li>
<li><a href="../en496302/index.html">How not to give your company to a hacker while she is away. Tips for SOC Specialists</a></li>
<li><a href="../en496304/index.html">How I keep learning UE4 while making my game</a></li>
<li><a href="../en499818/index.html">Uzbek Telegram Marketing</a></li>
<li><a href="../en499820/index.html">Why we chose Kotlin as one of our target languages. Part 2: Kotlin Multiplatform</a></li>
<li><a href="../en499822/index.html">Wireless access point vs router: what are the differences?</a></li>
<li><a href="../en499824/index.html">The digest of events for HR and IT recruiters in May 2020</a></li>
<li><a href="../en499826/index.html">Distributed blood pressure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>