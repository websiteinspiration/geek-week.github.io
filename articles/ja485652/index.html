<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🎤 🎄 👨‍🏭 Confluenceインラインコメント統計 🛁 🧓🏻 👩🏼‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Confluenceでページコメント統計を収集するにはどうすればよいですか？
 
 そして、なぜこれが必要なのでしょうか？
 
 
 
 なぜそしてなぜ
 私がたまたま働いたプロジェクトでは、要件の準備と承認の次のプロセスが生まれました。
 
 

- ドキュメントにはConfluenceを使用しま...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Confluenceインラインコメント統計</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485652/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confluenceでページコメント統計を収集するにはどうすればよいですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、なぜこれが必要なのでしょうか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c6/7x/uo/c67xuo6sop9dd7mpzxty_i7wj7s.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜそしてなぜ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がたまたま働いたプロジェクトでは、要件の準備と承認の次のプロセスが生まれました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントにはConfluenceを使用しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サプライヤーチームは、テンプレートに従って、ビジネスプロセスとその手順の説明を個別のページの形式で準備しました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">週に一度、準備された一連の説明が校正のために顧客に渡されました。</font></font></li>
<li>             .</li>
<li>    ,   ,     .</li>
<li>          ,     .</li>
<li>                 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
毎週、プロジェクトマネージャーは、配信されたドキュメントのバッチがどれだけうまく機能しているか、および条件付きで準備が整っていると見なすことができるものを理解するタスクを持っています。また、サプライヤチームの参加者は定期的にドキュメントのコメントのステータスを確認し、残りのメンバーと意図的に協力する必要があります。しかし、それらを見つける方法は？各ページを開いて、目で（または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ちょっとしたトリックを使って</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">最初のコメントを探してから、</font><font style="vertical-align: inherit;">すべてのコメントをクリックしてください。お客様のチームは急いでそれらを閉じ、それぞれについて考え、答えを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
毎週のバッチには50〜100の個別のページが含まれており、これを手で行うのはかなりの労力です。そして、あなたがまだ反対側を説得するために議論を集めようとすると、それは非常に悲しくなります。また、ソーステキストが誤って削除された場合のページの不正確な編集に起因するぶら下がりコメントもあります。このようなコメントは解決済みのコメントに表示されますが、再度開くことはできません（ページのテキストに非表示のマーカーを再作成すると、開くことができます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ツールの検索は失敗しました。さらに、Confluenceは顧客側に展開されており、購入は言うまでもなく、プラグインをインストールすることはできません。マクロ開発の専門知識はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある時点で、Confluenceには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST APIが</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、以前に同様の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Jira API</font></a><font style="vertical-align: inherit;">を使用した経験</font><font style="vertical-align: inherit;">があることを思い出しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ブラウザから関数を呼び出して検索および実験したところ、コメントとそのプロパティにアクセスできることがわかりました。</font><font style="vertical-align: inherit;">次に、自動化のためのツールを選択する必要があり、ソリューションを続行できます。</font><font style="vertical-align: inherit;">Bash、Perl、JScriptなどの管理者により近いツールでスクリプトを作成した経験があります。</font><font style="vertical-align: inherit;">私は開発者ではありません。慣れ親しんだツールもありませんでした。</font><font style="vertical-align: inherit;">もっと一般的または適切なものを試したかった。</font><font style="vertical-align: inherit;">次に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Python APIのラッパー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を見つけ、</font><font style="vertical-align: inherit;">それを試すことにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般原則</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は次のように定式化されました。</font><font style="vertical-align: inherit;">特定の毎週の配達に関連するすべてのページを見つける必要があります。</font><font style="vertical-align: inherit;">それらのコメントをリストで収集します。ページ、コメントへのリンク、コメントの作成者と日付、ページのソーステキスト、コメントと回答、作成者と最後の返信の日付、コメントのステータス。</font><font style="vertical-align: inherit;">さらに、各ページの統計、合計コメント数、危険度、オープン数を収集します。</font><font style="vertical-align: inherit;">すべてを特別な統計ページに保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はPythonを使用して、Pythonの基本的な操作を行ってから、いきましょう。</font><font style="vertical-align: inherit;">まず、接続を作成します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> atlassian <span class="hljs-keyword">import</span> Confluence<font></font>
UserLogin = <span class="hljs-string">'xxxxxx'</span>  <span class="hljs-comment"># input("Login: ")</span>
UserPwd = <span class="hljs-string">'xxxxxx'</span>  <span class="hljs-comment"># input("Password: ")</span>
confluenceURL = <span class="hljs-string">'http://wiki.xxxxxx'</span><font></font>
confluence = Confluence(<font></font>
    url=confluenceURL,<font></font>
    username=UserLogin,<font></font>
    password=UserPwd)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タグを使用して、毎週のバッチからページを検索することにしました。</font><font style="vertical-align: inherit;">それらをまとめて配信する方法は別のタスクです。</font></font><br>
<br>
<pre><code class="python hljs">page_label = <span class="hljs-string">'week123'</span>
cql = <span class="hljs-string">'space.key={} and label = "{}" and type = page '</span>
      <span class="hljs-string">'ORDER BY title '</span>.format(<span class="hljs-string">'YYY'</span>, page_label)<font></font>
pages = confluence.cql(cql, expand=<span class="hljs-literal">None</span>, start=<span class="hljs-number">0</span>, limit=<span class="hljs-number">200</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェックするページのリストを取得しました。</font><font style="vertical-align: inherit;">次に、個々のページの処理を開始します。</font><font style="vertical-align: inherit;">コメントとそのパラメーターを含むデータを収集します。</font><font style="vertical-align: inherit;">これらのデータに基づいて、ページ上にあるコメントの数とその条件に関する統計を作成します。</font><font style="vertical-align: inherit;">次に、すべてのページの結果をノックダウンして、結果のフォーマットを開始します。</font><font style="vertical-align: inherit;">ページの本文を作成し、結果を統計表とオープンコメントの詳細リストの形式で作成します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページリスト処理</font></font></b><div class="spoiler_text"><pre><code class="python hljs">statistics = []<font></font>
open_comments = []<font></font>
<span class="hljs-comment">#  - ?</span>
<span class="hljs-keyword">if</span> pages <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
	<span class="hljs-comment">#    ?</span>
	<span class="hljs-keyword">if</span> pages[<span class="hljs-string">'size'</span>] &gt; <span class="hljs-number">0</span>:   
		<span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> pages[<span class="hljs-string">'results'</span>]:  <font></font>
			print(page[<span class="hljs-string">'title'</span>])
			<span class="hljs-comment">#       , </span>
			<span class="hljs-comment"># </span>
			page_comments = page_comments_data(page[<span class="hljs-string">'content'</span>][<span class="hljs-string">'id'</span>])
			<span class="hljs-comment">#    			</span><font></font>
			statistics.append(page_statistics(page_comments))<font></font>
			<span class="hljs-comment">#       </span>
			<span class="hljs-comment">#    .</span>
			<span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> page_comments:
				<span class="hljs-keyword">if</span> comment[<span class="hljs-string">'Result'</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'resolved'</span>, <span class="hljs-string">'nocomment'</span>]:
					<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (comment[<span class="hljs-string">'Result'</span>] == <span class="hljs-string">'dangling'</span> 
							<span class="hljs-keyword">and</span> comment[<span class="hljs-string">'Author'</span>] <span class="hljs-keyword">in</span> excludeNames):<font></font>
						open_comments.append(comment)<font></font>
	<span class="hljs-comment">#       .</span><font></font>
	statistics.append(total_statistics(statistics))<font></font>
<font></font>
<span class="hljs-comment">#    </span>
page_id = confluence.get_page_id(space=<span class="hljs-string">'YYY'</span>, title=page_title)
<span class="hljs-comment">#     ,    .</span>
page_body = (<span class="hljs-string">'&lt;p&gt;&lt;ac:structured-macro ac:name="toc" ac:schema-version="1"'</span>
			 <span class="hljs-string">'/&gt;&lt;/p&gt;'</span>
			 <span class="hljs-string">'&lt;h1&gt;Comments Statistics&lt;/h1&gt;{}'</span>
			 <span class="hljs-string">'&lt;h1&gt;Open Comments List&lt;/h1&gt;{}'</span><font></font>
			 ).format(create_table(statistics), create_table(open_comments))<font></font>
<span class="hljs-comment"># </span>
<span class="hljs-keyword">if</span> page_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
	status = confluence.update_page(<font></font>
		page_id=page_id,<font></font>
		title=page_title,<font></font>
		body=page_body,<font></font>
		representation=<span class="hljs-string">'storage'</span><font></font>
	)<font></font>
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIの機能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ページを処理する方法を理解しましょう。</font><font style="vertical-align: inherit;">デフォルトでは、APIは識別子やページ名などの基本情報のみを返します。</font><font style="vertical-align: inherit;">追加のプロパティはすべて明示的に指定する必要があります。</font><font style="vertical-align: inherit;">呼び出しの結果を分析することで確認できます。</font><font style="vertical-align: inherit;">追加データは、_expandableのセクションまたはサブセクションにあります。</font><font style="vertical-align: inherit;">目的のアイテムを追加して展開し、必要なデータが見つかるまでさらに調べます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題の例</font></font></b><div class="spoiler_text"><pre><code class="json hljs">http:<span class="hljs-comment">//wiki.xxxxxx/rest/api/content/101743895?expand=body,children.comment</span><font></font>
<font></font>
{<font></font>
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"97517865"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"page"</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"current"</span>,
    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"w2019-47 comments status"</span>,
    <span class="hljs-attr">"children"</span>: {
        <span class="hljs-attr">"comment"</span>: {
            <span class="hljs-attr">"results"</span>: [],
            <span class="hljs-attr">"start"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"limit"</span>: <span class="hljs-number">25</span>,
            <span class="hljs-attr">"size"</span>: <span class="hljs-number">25</span>,
            <span class="hljs-attr">"_links"</span>: {}<font></font>
        },<font></font>
        <span class="hljs-attr">"_links"</span>: {},
        <span class="hljs-attr">"_expandable"</span>: {
            <span class="hljs-attr">"attachment"</span>: <span class="hljs-string">"/rest/api/content/97517865/child/attachment"</span>,
            <span class="hljs-attr">"page"</span>: <span class="hljs-string">"/rest/api/content/97517865/child/page"</span><font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">"body"</span>: {
        <span class="hljs-attr">"_expandable"</span>: {
            <span class="hljs-attr">"editor"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"view"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"export_view"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"styled_view"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"storage"</span>: <span class="hljs-string">""</span>,
            <span class="hljs-attr">"anonymous_export_view"</span>: <span class="hljs-string">""</span><font></font>
        }<font></font>
    },<font></font>
    <span class="hljs-attr">"extensions"</span>: {
        <span class="hljs-attr">"position"</span>: <span class="hljs-string">"none"</span><font></font>
    },<font></font>
    <span class="hljs-attr">"_links"</span>: {},
    <span class="hljs-attr">"_expandable"</span>: {
        <span class="hljs-attr">"metadata"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"operations"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"restrictions"</span>: <span class="hljs-string">"/rest/api/content/97517865/restriction/byOperation"</span>,
        <span class="hljs-attr">"history"</span>: <span class="hljs-string">"/rest/api/content/97517865/history"</span>,
        <span class="hljs-attr">"ancestors"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"version"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-attr">"descendants"</span>: <span class="hljs-string">"/rest/api/content/97517865/descendant"</span>,<font></font>
    }<font></font>
}	<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、発行される結果の数、ページネーションにも制限があります。サーバー側（API？）で構成されています。私たちの場合は25です。一部のリクエストでは、明示的に指定することで変更できますが、最上位でのみ機能します。そして、ページへのコメントを明らかにすると、サイズは偽物ですが、すべて同じ25だけが取得されます。この例では、実際には29個ありました。 Confluenceモジュールの個別の関数、ページサイズを指定する機能を備えたget_page_commentsを使用して、コメントの改ページを回避できました。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#   </span>
<span class="hljs-keyword">import</span> re<font></font>
<font></font>
<span class="hljs-comment">#      XML</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">replace_chars2</span>(<span class="hljs-params">in_text</span>):</span>
    text = re.sub(<span class="hljs-string">r'&amp;'</span>, <span class="hljs-string">'&amp;'</span>, in_text)<font></font>
    text = re.sub(<span class="hljs-string">r'\''</span>, <span class="hljs-string">''', text)
    text = re.sub(r'&lt;', '&lt;', text)
    text = re.sub(r'&gt;', '&gt;', text)
    text = re.sub(r'"', '"', text)
    return text
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の落とし穴は、特殊文字の保存と発行の機能で待っていました。</font><font style="vertical-align: inherit;">ページまたはコメントの本文は、いくつかのビューで取得できます。内部XML-ストレージ、マクロ出力のない中間HTML-ビュー、およびマクロ出力のあるHTML-export_view。</font><font style="vertical-align: inherit;">ただし、ページタイトルのタイトルと、originalSelectionの元のコメントテキストは、常に読み取り可能な形式で表示されます。</font><font style="vertical-align: inherit;">なぜなら </font><font style="vertical-align: inherit;">将来的には、これらのデータは統計情報とともにページの本文に分類され、一部の文字が変換エラーにつながりました。</font><font style="vertical-align: inherit;">上記の交換手順を書かなければなりませんでした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページコメント</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にページを解析します。</font><font style="vertical-align: inherit;">これは、ページをロードし、そのデータを収集してから、回答のあるコメントのリストを引き出し、それらを通信に収集する1つの手順です。</font><font style="vertical-align: inherit;">結果は辞書のリストで、リストの各要素は回答付きの1つのコメントに対応します。</font><font style="vertical-align: inherit;">そして、この解説のすべての属性は、辞書の対応するフィールドにあります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単一ページ処理</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_comments_data</span>(<span class="hljs-params">page_identifier</span>):</span>
	<span class="hljs-comment">#,      ,  , </span>
	<span class="hljs-comment">#   , </span>
	<span class="hljs-comment">#  ,    ,    </span>
	<span class="hljs-comment">#   ().</span>
    expand_text = (<span class="hljs-string">'body.storage,extensions.inlineProperties'</span>
                   <span class="hljs-string">',extensions.resolution,version,children.comment'</span>
                   <span class="hljs-string">',children.comment.version,children.comment.body.storage'</span><font></font>
                   )<font></font>
	<span class="hljs-comment">#    .     .</span><font></font>
    conf_page = confluence.get_page_by_id(page_identifier, <font></font>
						expand=<span class="hljs-string">'body.storage'</span>)<font></font>
    page_title = replace_chars2(conf_page[<span class="hljs-string">'title'</span>])
	<span class="hljs-comment">#   .</span>
    link_base = conf_page[<span class="hljs-string">'_links'</span>][<span class="hljs-string">'base'</span>]<font></font>
    page_link = link_base + conf_page[<span class="hljs-string">'_links'</span>][<span class="hljs-string">'webui'</span>]<font></font>
    page_code = <span class="hljs-string">'&lt;a href="{}"&gt;{}&lt;/a&gt;'</span>.format(page_link, page_title)
	<span class="hljs-comment">#  </span><font></font>
    page_comments = confluence.get_page_comments(content_id=page_identifier, <font></font>
						start=<span class="hljs-number">0</span>, limit=<span class="hljs-number">1000</span>,<font></font>
    comments = []<font></font>
	<span class="hljs-comment">#   </span>
    <span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> page_comments[<span class="hljs-string">'results'</span>]:
		<span class="hljs-comment">#      - .</span>
        <span class="hljs-keyword">if</span> comment[<span class="hljs-string">'extensions'</span>][<span class="hljs-string">'location'</span>] == <span class="hljs-string">'footer'</span>:
            <span class="hljs-keyword">continue</span>
		<span class="hljs-comment"># </span>
        comment_text = comment[<span class="hljs-string">'body'</span>][<span class="hljs-string">'storage'</span>][<span class="hljs-string">'value'</span>]<font></font>
        comment_result = comment[<span class="hljs-string">'extensions'</span>][<span class="hljs-string">'resolution'</span>][<span class="hljs-string">'status'</span>]<font></font>
        comment_link = <span class="hljs-string">'&lt;a href="{}"&gt;{}&lt;/a&gt;'</span>\<font></font>
			.format(link_base + comment[<span class="hljs-string">'_links'</span>][<span class="hljs-string">'webui'</span>], <span class="hljs-string">'link'</span>)
		<span class="hljs-comment"># </span>
        comment_link = re.sub(<span class="hljs-string">r'&amp;focusedCommentId='</span>, <span class="hljs-string">'&amp;focusedCommentId='</span>, <font></font>
							comment_link)<font></font>
		<span class="hljs-comment"># </span>
        created_when = re.sub(<span class="hljs-string">r'\.000\+'</span>, <span class="hljs-string">' GMT+'</span>, <font></font>
						re.sub(<span class="hljs-string">r'T'</span>, <span class="hljs-string">' '</span>, comment[<span class="hljs-string">'version'</span>][<span class="hljs-string">'when'</span>]))<font></font>
        created_by = comment[<span class="hljs-string">'version'</span>][<span class="hljs-string">'by'</span>][<span class="hljs-string">'displayName'</span>]<font></font>
        orig_text = replace_chars2(comment[<span class="hljs-string">'extensions'</span>]<font></font>
						[<span class="hljs-string">'inlineProperties'</span>][<span class="hljs-string">'originalSelection'</span>])
		<span class="hljs-comment">#    /.</span>
        thread = <span class="hljs-string">'&lt;b&gt;To text: &lt;/b&gt;{}&lt;br/&gt;&lt;b&gt;At: &lt;/b&gt;{}&lt;br/&gt;&lt;b&gt;By: '</span>
				 <span class="hljs-string">'&lt;/b&gt;{}&lt;br/&gt;{}'</span>.format(orig_text, created_when, created_by, <font></font>
										comment_text)<font></font>
        last_by = <span class="hljs-string">''</span>
        last_when = <span class="hljs-string">''</span>
		<span class="hljs-comment"># </span>
        answers = comment[<span class="hljs-string">'children'</span>][<span class="hljs-string">'comment'</span>][<span class="hljs-string">'size'</span>]
        <span class="hljs-keyword">if</span> answers &gt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> comment[<span class="hljs-string">'children'</span>][<span class="hljs-string">'comment'</span>][<span class="hljs-string">'results'</span>]:
				<span class="hljs-comment"># </span>
                last_when = re.sub(<span class="hljs-string">r'\.000\+'</span>, <span class="hljs-string">' GMT+'</span>, <font></font>
								re.sub(<span class="hljs-string">r'T'</span>, <span class="hljs-string">' '</span>, message[<span class="hljs-string">'version'</span>][<span class="hljs-string">'when'</span>]))<font></font>
                last_by = message[<span class="hljs-string">'version'</span>][<span class="hljs-string">'by'</span>][<span class="hljs-string">'displayName'</span>]
				<span class="hljs-comment"># </span>
                thread += (<span class="hljs-string">'&lt;br/&gt;===next===&lt;br/&gt;&lt;b&gt;At: &lt;/b&gt;{}&lt;br/&gt;&lt;b&gt;By: '</span>
						   <span class="hljs-string">'&lt;/b&gt;{}&lt;br/&gt;{}'</span>.format(last_when, last_by, <font></font>
										message[<span class="hljs-string">'body'</span>][<span class="hljs-string">'storage'</span>][<span class="hljs-string">'value'</span>])<font></font>
                           )<font></font>
		<span class="hljs-comment">#  .</span>
        row_comm = {<span class="hljs-string">"Page"</span>: page_code, 
                    <span class="hljs-string">"Comment"</span>: comment_link, <span class="hljs-string">"Thread"</span>: thread, 
					<span class="hljs-string">"Result"</span>: comment_result, <span class="hljs-string">"Answers count"</span>: answers,
                    <span class="hljs-string">"Creation Date"</span>: created_when, <span class="hljs-string">"Author"</span>: created_by, 
					<span class="hljs-string">"Last Date"</span>: last_when, <span class="hljs-string">"Last Author"</span>: last_by}<font></font>
        comments.append(row_comm)<font></font>
	<span class="hljs-comment">#   ,   , </span>
	<span class="hljs-comment">#     .	</span>
    <span class="hljs-keyword">if</span> len(comments) == <span class="hljs-number">0</span>:<font></font>
        row_comm = {<span class="hljs-string">"Page"</span>: page_code, 
                    <span class="hljs-string">"Comment"</span>: <span class="hljs-string">'nolink'</span>, <span class="hljs-string">"Thread"</span>: <span class="hljs-string">'nocomment'</span>, 
					<span class="hljs-string">"Result"</span>: <span class="hljs-string">'nocomment'</span>, <span class="hljs-string">"Answers count"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"Creation Date"</span>: <span class="hljs-string">'never'</span>, <span class="hljs-string">"Author"</span>: <span class="hljs-string">'nobody'</span>, 
					<span class="hljs-string">"Last Date"</span>: <span class="hljs-string">'never'</span>, <span class="hljs-string">"Last Author"</span>: <span class="hljs-string">'nobody'</span>}<font></font>
        comments.append(row_comm)<font></font>
    <span class="hljs-keyword">return</span> comments
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統計とテーブル</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明確にするために、統計を収集し、表の形式で作成するデータを提示します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統計処理</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page_statistics</span>(<span class="hljs-params">comments_data</span>):</span>
    open_count = <span class="hljs-number">0</span>
    dang_count = <span class="hljs-number">0</span><font></font>
    comment_count = len(comments_data)<font></font>
    <span class="hljs-keyword">if</span> comment_count &gt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> comments_data:
			<span class="hljs-comment">#    </span>
            <span class="hljs-keyword">if</span> comment[<span class="hljs-string">'Result'</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'resolved'</span>, <span class="hljs-string">'nocomment'</span>]:
                <span class="hljs-keyword">if</span> comment[<span class="hljs-string">'Result'</span>] <span class="hljs-keyword">in</span> [<span class="hljs-string">'open'</span>, <span class="hljs-string">'reopened'</span>]:<font></font>
                    open_count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> comment[<span class="hljs-string">'Result'</span>] == <span class="hljs-string">'dangling'</span> 
						<span class="hljs-keyword">and</span> comment[<span class="hljs-string">'Author'</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> excludeNames:<font></font>
                    dang_count += <span class="hljs-number">1</span>
    res_dict = {<span class="hljs-string">'Page'</span>: comments_data[<span class="hljs-number">0</span>][<span class="hljs-string">'Page'</span>], 
				<span class="hljs-string">'Total'</span>: comment_count, 
				<span class="hljs-string">'Resolved'</span>: comment_count - open_count - dang_count,
                <span class="hljs-string">'Dangling'</span>: dang_count, <span class="hljs-string">'Open'</span>: open_count}
    <span class="hljs-keyword">return</span> res_dict<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">total_statistics</span>(<span class="hljs-params">stat_data</span>):</span>
    total_comment = <span class="hljs-number">0</span>
    total_resolved = <span class="hljs-number">0</span>
    total_open = <span class="hljs-number">0</span>
    total_dangling = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> statRow <span class="hljs-keyword">in</span> stat_data:<font></font>
        total_comment += statRow[<span class="hljs-string">'Total'</span>]<font></font>
        total_resolved += statRow[<span class="hljs-string">'Resolved'</span>]<font></font>
        total_open += statRow[<span class="hljs-string">'Open'</span>]<font></font>
        total_dangling += statRow[<span class="hljs-string">'Dangling'</span>]<font></font>
    res_dict = {<span class="hljs-string">'Page'</span>: <span class="hljs-string">'All Pages Total'</span>, <span class="hljs-string">'Type'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'Jira'</span>: <span class="hljs-string">''</span>, 
				<span class="hljs-string">'Status'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'Total'</span>: total_comment,
                <span class="hljs-string">'Resolved'</span>: total_resolved, 
				<span class="hljs-string">'Dangling'</span>: total_dangling, <span class="hljs-string">'Open'</span>: total_open}
    <span class="hljs-keyword">return</span> res_dict
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルの形式でデータを作成するには、もう1つの手順を実行します。</font><font style="vertical-align: inherit;">辞書のリストからテーブルのHTMLコードを形成し、見出しとして、辞書キーの名前から行を追加し、行番号を含む列を追加します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_table</span>(<span class="hljs-params">tab_data</span>):</span>
    tab_start = <span class="hljs-string">'&lt;table style="width: 100.00%;"&gt;&lt;colgroup&gt;&lt;col /&gt;'</span>
				<span class="hljs-string">'&lt;col /&gt;&lt;/colgroup&gt;&lt;tbody&gt;'</span>
    tab_end = <span class="hljs-string">'&lt;/tbody&gt;&lt;/table&gt;'</span>
    tab_code = tab_start + <span class="hljs-string">'&lt;tr&gt;'</span>
    row_num = <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> len(tab_data) &gt; <span class="hljs-number">0</span>:<font></font>
        tab_code += <span class="hljs-string">'&lt;th&gt;Num&lt;/th&gt;'</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> tab_data[<span class="hljs-number">0</span>].keys():<font></font>
            tab_code += <span class="hljs-string">'&lt;th&gt;{}&lt;/th&gt;'</span>.format(key)<font></font>
        tab_code += <span class="hljs-string">'&lt;/tr&gt;'</span>
        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> tab_data:<font></font>
            tab_code += <span class="hljs-string">'&lt;tr&gt;&lt;td&gt;{}&lt;/td&gt;'</span>.format(row_num)<font></font>
            row_num += <span class="hljs-number">1</span>
            <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> row.values():<font></font>
                tab_code += <span class="hljs-string">'&lt;td&gt;{}&lt;/td&gt;'</span>.format(field)<font></font>
            tab_code += <span class="hljs-string">'&lt;/tr&gt;'</span>
    tab_code += tab_end + <span class="hljs-string">'\n'</span>
    <span class="hljs-keyword">return</span> tab_code
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべて準備が整いました。</font><font style="vertical-align: inherit;">スクリプトにラベルを付けて実行すると、次のようなページが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-1/if/af/-1ifafmgt3mqvbayphkq7opy4mq.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、これが最終的に判明したすべてではありません。</font><font style="vertical-align: inherit;">Jiraでページの解析とタスク番号を含むマクロの検索がありました。</font><font style="vertical-align: inherit;">Jiraにはタスク番号による自動ラベル付けと、それらからConfluenceへのリンクがありました。</font><font style="vertical-align: inherit;">毎週の配達リストの比較と検証がありました。</font><font style="vertical-align: inherit;">Excelでのコメントの保存と、週ごとのいくつかのExcelファイルからの共通データの収集がありました。</font><font style="vertical-align: inherit;">そして最近、Wordからのコメントの解析が追加されました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485642/index.html">Angularアプリケーションの動作が遅い主な理由</a></li>
<li><a href="../ja485644/index.html">WebGPUアプリケーション開発</a></li>
<li><a href="../ja485646/index.html">これまでに会ったことのない役立つPythonのヒント。パート2</a></li>
<li><a href="../ja485648/index.html">forへのpythonicアプローチ：range（）とenumerate（）ループ</a></li>
<li><a href="../ja485650/index.html">Dockerイメージ削減テクニック</a></li>
<li><a href="../ja485654/index.html">物理学からのアイデアは、AIがより高い次元で機能するのに役立ちます。</a></li>
<li><a href="../ja485656/index.html">機械のスカイネット：工場には労働者なしで未来はありませんか？</a></li>
<li><a href="../ja485660/index.html">DDoS保護会社自身がDDoS攻撃を仕掛けた、その創設者は認めた</a></li>
<li><a href="../ja485664/index.html">Jenkinsジョブでの動的パラメーターの作成、またはタスクをユーザーフレンドリーにする方法</a></li>
<li><a href="../ja485670/index.html">7. Fortinet Getting Started v6.0。ウイルス対策とIPS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>