<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßùüèΩ üíû ‚åõÔ∏è Load testing as a CI service for developers üê† üìá üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the problems that multi-product software vendors often encounter is duplication of the competencies of engineers - developers, testers and infr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Load testing as a CI service for developers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/504290/"><img src="https://habrastorage.org/webt/r5/fa/5g/r5fa5gszksri1ly608-wffhunqu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the problems that multi-product software vendors often encounter is duplication of the competencies of engineers - developers, testers and infrastructure administrators - in almost every team. This also applies to expensive engineers - experts in the field of load testing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of engaging in their direct responsibilities and using their unique experience to build the load testing process, choosing a methodology, optimal metrics and writing self-tests according to load profiles, engineers often have to deploy a test infrastructure from scratch, configure load tools, and embed them in CI-systems, configure monitoring and publication of reports.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can find solutions to some organizational problems in testing that we use at Positive Technologies in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">another article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And in this I‚Äôll talk about the possibility of integrating load tests into a common CI pipeline using the concept of ‚Äúload testing as a service‚Äù. </font><font style="vertical-align: inherit;">You will learn how and which docker images of load sources can be used in the CI pipeline; </font><font style="vertical-align: inherit;">How to connect load sources to your CI project using an assembly template; </font><font style="vertical-align: inherit;">what a demo pipe looks like to run load tests and publish results. </font><font style="vertical-align: inherit;">The article may be useful to software testing engineers and automation engineers at CI who have thought about the architecture of their load system.</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essence of the concept</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The concept of load testing as a service implies the ability to integrate Apache JMeter, Yandex.Tank load tools and own frameworks into an arbitrary continuous integration system. A demo will be for GitLab CI, but the principles are stated common to all CI-systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load testing as a service is a centralized service for conducting load testing. Load tests are run in dedicated agent pools, the results are published automatically in GitLab Pages, Influx DB and Grafana or in test reporting systems (TestRail, ReportPortal, etc.). Automation and scaling are realized as simple as possible - by adding and parameterizing the usual gitlab-ci.yml template in the GitLab CI project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The advantage of the approach is that the entire CI infrastructure, load agents, docker images of load sources, test pipelines and publication of reports are supported by the central automation department (DevOps engineers), and load testing engineers can focus their efforts on test development and analysis of their results, without dealing with infrastructure issues. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For simplicity of description, we assume that the target test application or server is already deployed and configured in advance (for this, automated scripts in Python, SaltStack, Ansible, etc. can be used). Then the whole concept of stress testing as a service fits into three stages: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preparation, testing, publication of reports</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . More details on the diagram (all pictures are clickable):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/uc/no/nj/ucnonjamcikvuob-3njskwev-he.png"></a><br>
<br>
<h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When conducting stress tests, we try to adhere to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standards and methodology of ISTQB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we use the appropriate terminology and recommended metrics. I will give a short list of basic concepts and definitions in load testing. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Load agent (load agent)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the virtual machine on which the application will be launched - the source of the load (Apache JMeter, Yandex.Tank or self-written load module). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The purpose of testing (target)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a server or application installed on the server that will be subjected to load. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A test case</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a set of parameterized steps: user actions and expected reactions to these actions, with fixed network requests and responses, depending on the specified parameters.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile or load plan (profile)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISTQB methodology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Section 4.2.4, p. 43), load profiles determine the metrics critical for a particular test and options for changing load parameters during the test. You can see examples of profiles in the figure. </font><b><font style="vertical-align: inherit;">Test</font></b><font style="vertical-align: inherit;"> is a script with a predefined set of parameters. </font><b><font style="vertical-align: inherit;">Test plan</font></b><font style="vertical-align: inherit;"> - test suite and load profile. </font><b><font style="vertical-align: inherit;">Testrun (testrun)</font></b><font style="vertical-align: inherit;"> - one iteration of running one test with a fully executed load scenario and a received report. </font><b><font style="vertical-align: inherit;">Network Request (request)</font></b><font style="vertical-align: inherit;"> - An HTTP request sent from the agent to the target. </font><b><font style="vertical-align: inherit;">Network response (response)</font></b><font style="vertical-align: inherit;"> - An HTTP response sent from the target to the agent.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/qm/iq/d5/qmiqd5egscabj6hrmlnufxnyv4m.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP response status is a standard response code from the application server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transaction (transaction) - a full cycle of "request - response." </font><font style="vertical-align: inherit;">A transaction is counted from the start of sending a request (request) to the completion of receiving a response (response). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transaction status (transactions status)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - was it possible to successfully complete the cycle "request-response". </font><font style="vertical-align: inherit;">If there was any error in this loop, then the entire transaction is considered unsuccessful. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Response time (latency)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - time from the end of sending a request (request) to the start of receiving a response (response). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metrics of loading (metrics)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the characteristics of the loaded service and the loading agent determined during the process of load testing.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic metrics for measuring load parameters</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some of the most common and recommended </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metrics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">ISTQB</font></a><font style="vertical-align: inherit;"> methodology </font><font style="vertical-align: inherit;">(p. 36, 52) are shown in the table below. </font><font style="vertical-align: inherit;">Similar metrics for the agent and target are shown on the same line.</font></font><br>
<br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Load Agent Metrics</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metrics of the target system or application tested under load</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The number of&nbsp;&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memory </font><font style="vertical-align: inherit;">, </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - "iron" characteristics of the load agent</font></font></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memory, Disk usage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the dynamics of loading the processor, memory and disk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
during testing. </font><font style="vertical-align: inherit;">Usually measured as a percentage of </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
maximum available values.</font></font></td>
</tr>
<tr>
<td><b>Network throughput</b> (on load agent) ‚Äî   <br>
   , <br>
   . <br>
      (bps)</td>
<td><b>Network throughput</b>(on target) ‚Äî     <br>
  .       (bps)</td>
</tr>
<tr>
<td><b>Virtual users</b>‚Äî   , <br>
    <br>
   </td>
<td><b>Virtual users status</b>, Passed/Failed/Total ‚Äî    <br>
     <br>
  ,     .<br>
<br>
 ,      <br>
  ,    . <br>
   ,       <br>
      </td>
</tr>
<tr>
<td><b>Requests per second (minute)</b>‚Äî      ( ).<br>
<br>
   :     . <br>
       </td>
<td><b>Responses per second (minute)</b><br>
 ‚Äî      ( ).<br>
<br>
   :   <br>
       <br>
 </td>
</tr>
<tr>
<td></td>
<td><b>HTTP responses status</b>‚Äî     <br>
  ,   . <br>
, 200 OK   , <br>
 404 ‚Äî    </td>
</tr>
<tr>
<td></td>
<td><b>Latency</b> ( ) ‚Äî    <br>
  (request)     (response). <br>
    (ms)</td>
</tr>
<tr>
<td></td>
<td><b>Transaction response time</b>‚Äî    , <br>
  ¬´ ‚Äî ¬ª. <br>
      (request) <br>
    (response).<br>
<br>
      ( ) <br>
 :  , <br>
,  , , 90- . <br>
    ‚Äî   <br>
  . <br>
    , <br>
    , <br>
     </td>
</tr>
<tr>
<td></td>
<td><b>Transactions per second (minute)</b> ‚Äî   <br>
   (), <br>
       <br>
    . <br>
    </td>
</tr>
<tr>
<td></td>
<td><b>Transactions status</b> , Passed / Failed / Total ‚Äî  <br>
,     .<br>
<br>
    <br>
    <br>
     </td>
</tr>
</tbody>
</table></div><br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The basic scheme of load testing is very simple and consists of three main stages, which I already mentioned: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare - Test - Report</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , that is, preparing test goals and setting parameters for load sources, then performing load tests and, finally, generating and publishing a report about testing. </font><font style="vertical-align: inherit;">
Notes to the scheme:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/o5/s5/z5/o5s5z5f79dpui3ojk5vbwgsayso.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QA.Tester - stress testing expert,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target is the target application for which you need to know its behavior under load.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classifier of entities, stages and steps in the diagram</font></font></h2><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stages and Steps</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's happening</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's at the entrance</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the output</font></font></th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare: test preparation phase</font></font></td>
</tr>
<tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loadparameters</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting and initializing </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
user </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
load parameters, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
selecting metrics and </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
preparing a test plan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(load profile)</font></font></td>
<td>  <br>
  <br>
-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>VM</b></td>
<td>   <br>
   <br>
 </td>
<td>    <br>
   <br>
 </td>
<td>  <br>
 </td>
</tr>
<tr>
<td><b>Env</b></td>
<td>    <br>
  <br>
  </td>
<td>   <br>
 <br>
   <br>
 </td>
<td> : <br>
,   , <br>
   <br>
 </td>
</tr>
<tr>
<td><b>LoadAgents</b></td>
<td>,    <br>
 . <br>
  -  <br>
  </td>
<td>-   <br>
(, JM   )<br>
  <br>
 </td>
<td>   <br>
   <br>
</td>
</tr>
<tr>
<td colspan="4">Test:    .    ,       GitLab CI</td>
</tr>
<tr>
<td><b>Load</b></td>
<td>   <br>
  -<br>
   </td>
<td>  <br>
  <br>
 <br>
-<br>
 </td>
<td>  <br>
 <br>
 <br>
      </td>
</tr>
<tr>
<td><b>RunAgents</b></td>
<td>  <br>
   <br>
  <br>
  <br>
   <br>
  </td>
<td>-<br>
 </td>
<td></td>
</tr>
<tr>
<td><b>Logs</b></td>
<td> ¬´¬ª  <br>
   : <br>
    , <br>
   <br>
 ,    </td>
<td></td>
<td>  <br>
 <br>
 </td>
</tr>
<tr>
<td><b>Metrics</b></td>
<td> ¬´¬ª    </td>
<td></td>
<td>    <br>
  </td>
</tr>
<tr>
<td colspan="4">Report:     </td>
</tr>
<tr>
<td><b>Generator</b></td>
<td>  <br>
   <br>
  ¬´¬ª <br>
  <br>
   <br>
 , <br>
   <br>
</td>
<td>  <br>
 <br>
 <br>
   <br>
   </td>
<td> ¬´¬ª  <br>
 ,   <br>
   <br>
   ,<br>
   </td>
</tr>
<tr>
<td><b>Publish</b></td>
<td>  <br>
  <br>
   <br>
</td>
<td> ¬´¬ª <br>
  ,  <br>
    <br>
</td>
<td>   <br>
   <br>
,  <br>
  </td>
</tr>
</tbody>
</table></div><br>
<h2>    CI-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's move on to the practical part. I want to show how on some projects at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive Technologies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we implemented the concept of load testing as a service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, with the help of our DevOps engineers, we created a dedicated agent pool in GitLab CI to run load tests. In order not to confuse them in templates with others, such as assembly pools, we added tags to these agents, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tags</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : load. You can use any other clear tags. They are set </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">during the registration of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GitLab CI Runners.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to find out the required power by hardware? The characteristics of load agents - a sufficient amount of vCPU, RAM and Disk - can be calculated on the basis that Docker, Python (for Yandex.Tank), GitLab CI agent, Java (for Apache JMeter) must be running on the agent. For Java, JMeter also recommends using a minimum of 512 MB of RAM and, as an upper limit, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80% of the available memory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, based on our experience, we recommend using at least 4 vCPU, 4 GB RAM, 60 GB SSD for load agents. Network card bandwidth is determined based on the requirements of the load profile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We mainly use two load sources - docker images Apache JMeter and Yandex.Tank. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- This is the open source tool of Yandex for stress testing. At the heart of its modular architecture is Phantom's high-performance asynchronous hit-based HTTP request generator. The tank has built-in monitoring of the resources of the tested server using the SSH protocol, can automatically stop the test according to the given conditions, can output the results both to the console and in the form of graphs, you can connect your modules to it to expand the functionality. By the way, we used Tank when it was not mainstream yet. In the article ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank and Automation of Load Testing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù, you can read the story of how, in 2013, we used it to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perform</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> load testing of </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">PT Appllication Firewall</font></a><font style="vertical-align: inherit;"> - one of the products of our company. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache JMeter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is an open source tool for conducting Apache stress testing. It can be used equally well for testing both static and dynamic web applications. JMeter supports a huge number of protocols and ways of interacting with applications: HTTP, HTTPS (Java, NodeJS, PHP, ASP.NET, etc.), SOAP / REST Webservices, FTP, TCP, LDAP, SMTP (S), POP3 (S ) and IMAP (S), databases through JDBC, can execute shell commands and work with Java objects. JMeter has an IDE for creating, debugging, and executing test plans. There is also a CLI for working on the command line of any compatible Java OS (Linux, Windows, Mac OS X). The tool can dynamically generate an HTML test report.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For ease of use within our company, for the ability of testers to change and add the environment, we made docker images of load sources on GitLab CI with publication in the internal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-register on Artifactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This way it turns out faster and easier to connect them in pipelines for load tests. </font><font style="vertical-align: inherit;">How to make docker push in registry via GitLab CI - see the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The basic docker file for Yandex.Tank we took this:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM direvius/yandex-tank<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And for Apache JMeter this one:</font></font><br>
<br>
<pre><code class="bash hljs">Dockerfile <font></font>
1 | FROM vmarrazzo/jmeter<font></font>
2 | ENTRYPOINT [<span class="hljs-string">""</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can read how our continuous integration system works in the article ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automation of development processes: how we implemented DevOps ideas in Positive Technologies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Template and pipeline</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example template for conducting load tests is available in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demo-load</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font><font style="vertical-align: inherit;">. You </font><font style="vertical-align: inherit;">can read the instructions for using the template </font><font style="vertical-align: inherit;">in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readme file</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In the template itself (the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.gitlab-ci.yml file</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) there are notes about what this or that step is responsible for. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The template is very simple and demonstrates the three stages of load testing described above in the diagram: preparation, testing and publication of reports. Responsible for it </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stages directory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Prepare, the Test, and the Report</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Prepare</a>           .       ,     -    docker registry:       Test.         .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Test</a>     ,      .     : Yandex.Tank, Apache JMeter,    .         job-.     :<br>
 <ul>
<li>  Yandex.Tank    .<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">/tests/yandextank.sh</a>,</li>
<li>  Apache JMeter    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">./tests/jmeter.sh</a>.</li>
</ul><br>
:         CI-        .     ,    bash-.   ,       ‚Äî    QA-.               .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">./tests</a>.<br>
 </li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Report</a>      ,    Test,   ,   GitLab Pages    .  GitLab Pages ,      ./public        index.html.     GitLab Pages    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>.<br>
<br>
,   : <ul>
<li> JMeter  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">GitLab Pages</a>,</li>
<li> Yandex.Tank  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">InfluxDB  Grafana</a>.</li>
</ul><br>
   :<ul>
<li>HTML-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">GitLab Pages</a>,</li>
<li> InfluxDB    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Grafana</a>.</li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a demo example, a pipeline with load tests and two load sources (you can disable unnecessary) looks like this: </font><font style="vertical-align: inherit;">
Apache JMeter can generate an HTML report itself, so it‚Äôs more profitable to save it in GitLab Pages using regular tools. </font><font style="vertical-align: inherit;">This is what the Apache JMeter report looks like: </font><font style="vertical-align: inherit;">
In the demo for Yandex.Tank, you will see only a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">fake text report</font></a><font style="vertical-align: inherit;"> in the section for GitLab Pages. </font><font style="vertical-align: inherit;">During testing, the Tank is able to save the results to the InfluxDB database, and from there they can be displayed, for example, in Grafana (the configuration is performed in the file </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">./tests/example-yandextank-test.yml</font></a><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">This is what Tank‚Äôs report looks like in Grafana:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/t6/0f/bx/t60fbxhrvwnju5mubzwmifhjmn0.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/fr/pl/pr/frplprdv1ns3obkqrpn2i4tgetu.png"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/a6/y9/zw/a6y9zw9ej6wcy_g5pk69s1ncrpa.png"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the article I talked about the concept of "load testing as a service" (load testing as a service). The main idea is to use the infrastructure of pre-configured pools of load agents, docker images of load sources, reporting systems and a pipeline uniting them in GitLab CI based on a simple .gitlab-ci.yml template (example </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by reference</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). All this is supported by a small team of automation engineers and is replicated at the request of product teams. I hope this helps you in preparing and implementing a similar scheme in your company. Thank you for attention! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS I want to say a big thank you to my colleagues, Sergey Kurbanov and Nikolay Yusev, for technical assistance with the implementation of the concept of load testing as a service in our company. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Author</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timur Gilmullin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - deputy. </font><font style="vertical-align: inherit;">Head of Technology and Development Processes (DevOps), Positive Technologies</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504264/index.html">Huawei Review Comment: Comment on Wi-Fi 6 posts and get prizes</a></li>
<li><a href="../en504270/index.html">Is Svelte a good choice for widget implementation?</a></li>
<li><a href="../en504276/index.html">Top 10 Developer Books</a></li>
<li><a href="../en504282/index.html">Creation of Enterprise-architecture in NSPK</a></li>
<li><a href="../en504284/index.html">The book ‚ÄúPure Agile. The Basics of Flexibility</a></li>
<li><a href="../en504296/index.html">Generating Random Branches in Python</a></li>
<li><a href="../en504306/index.html">How is Russian hardware made for storage Aerodisk Vostok on Elbrus</a></li>
<li><a href="../en504310/index.html">Dichotomy of data: rethinking the relationship with data and services</a></li>
<li><a href="../en504312/index.html">Unified register of Russian programs and GPL. My five cents</a></li>
<li><a href="../en504314/index.html">Implementation of docker pull and docker push commands without docker client via HTTP requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>