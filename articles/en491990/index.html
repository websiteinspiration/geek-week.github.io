<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèº üíï üê∂ Work with the Chinese chip ADC Hx711 (conclusion) üçá üè© üíµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After some time, a second acquaintance with the initial article caused a feeling of incompleteness in the issue of using this ADC . Yes, certain studi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Work with the Chinese chip ADC Hx711 (conclusion)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491990/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After some time, a second acquaintance with the initial article caused a feeling of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incompleteness in the issue of using this ADC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Yes, certain studies of this product were carried out, weaknesses were found and ways to circumvent these weaknesses were suggested, but there was no question of EXPERIMENTAL, practical application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The work of Andrei Gerasimenko (‚ÄúADC NH711 from 3.3V- do not believe the Chinese documentation and not only ...‚Äù (https // habr.com / ru / post / 438772)), did not require absolute consideration of the weight of the hive. The condition of relativity of the weighted hives eliminated the weighing error, because technical errors arising from changes in external conditions acted on all tracking objects and were automatically excluded from the analysis of the state of the hives. The situation is different with simple weighing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The weaknesses of the transducer in the form of the distribution of the measurement error other than the random distribution and noted by me were also found by Nikopol_86 ("... do not believe the Chinese documentation" Nikopol_86 February 86, at 09:27), which were also theoretical studies. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My application of the moving average method to "calm" the trembling of the last bits of the 24-bit conversion has shown its effectiveness, but there was no ready-made measuring device, taking into account all the above findings. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the final conclusion about the suitability of Hx711 for use in scales, a weighing program was developed based on the circuit diagram: The</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/4h/sy/o5/4hsyo5yiiy4qex1_odr4l86ibtk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
circuit is powered from a conventional standard power supply with a constant 5 volts, 1 ampere.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When developing the program, all previously noted disadvantages of the ADC were taken into account. </font><font style="vertical-align: inherit;">And now about the program embedded in the ATMega16 controller.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 When the power is turned on, the indicator displays: the ADC value read from the load cell in the bottom line, the weight value obtained by normalizing the bottom line ADC values ‚Äã‚Äãis displayed in the top line. </font><font style="vertical-align: inherit;">Usually this is: the top line is 1.015 and the bottom line is 1085. After placing the desired container on the platform, the readings are zeroed by pressing Key2 (packaging), which leads to 0,000 and 0 in the upper and lower lines of the indicator, respectively. </font><font style="vertical-align: inherit;">After that, placing the weighed load on the platform, we read the weight from the top line.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted that the auto-zero function, that is, entering the tare weight into the read weight from the platform at the moment the scales are turned on, is not implemented. Values ‚Äã‚Äãof normalization coefficients are ‚Äúsewn‚Äù into the program in advance (in the controller‚Äôs flash memory), which allows weighing immediately after taking into account the tare weight. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To change the normalization coefficients, a mode for calibrating the scales with a part of the weight (in this case 2 kg) is provided. To enter this mode, you need to free the platform, wait for stable readings and press Key12 and Key17 simultaneously.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The top line displays: ‚ÄúCal: turn Key 12‚Äù, which indicates that the balance enters calibration mode with part of the weight. To continue, you must press Key12. The bottom line shows ‚ÄúPress Tare key‚Äù, which means that the balance is ready to ‚Äúremember‚Äù the value of the container. To continue, press Key2 (Tara). The bottom line displays ‚ÄúPlace 2kg key17‚Äù. Put a 2 kg weight on the platform, wait and press Key17. On the indicator in the upper line is 2,000 and in the lower line is 2130. The balance has switched to weighing mode. Remove the weight and continue weighing. It is important that the new normalization coefficients are recorded in the controller RAM and will be erased (disappear) after turning off the power to the balance.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A similar procedure is convenient, but in the process of work, a 2 kg weight is not always at hand. For this case, a calibration correction procedure is provided. To enter this procedure, it is necessary to turn off the balance, rearrange JP1, so that the output of the controller port is shorted to ground. Turn on the scale. The value of one of the normalization coefficients is added to the top line, for this case it is 5325. Zero the Key2 scales, put the weight we know on the platform and increase it with the Key12 keys, and decrease the value of the weight indicated by the scales with Key17. We achieve equality of the weight laid on the platform and the weight indicated by the scales. After equality is reached, JP1 opens the circuit. IMPORTANT: it is better to close the jumper when the balance is off. Opening only when the power is on.The value of the displayed normalization coefficient also changes during the adjustment process. The inverse relationship, the higher the coefficient, the lower the displayed weight and vice versa. The thing is that the new coefficient value is also written to the internal RAM of the controller. Well, that's all.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These scales were operated in the packaging workshop for 2 work shifts of 8 hours, continuously, ambient temperature 18-22 degrees Celsius. Already the first day of operation showed that changes in weight, due to external factors: heating of the equipment, jumps in the ambient temperature due to the doors being opened, are satisfactory. All fluctuations are in the range of 10-15 grams (average weight of the packaged product is 10 kg), which is acceptable for a given weight. So, the weighing errors allowed by metrology for scales with the largest weighing limit of 15 kg LEL are: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/vj/eb/yzvjebt6nvwwea-efnp38pzvwvy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The entered calibration correction mode is convenient. But it was mainly used when weighing deviated by 5-10 grams per 5 kg of weight. The natural desire is to have precisely zero errors of the scales, but not more necessary, because the error is in the allowable range.</font></font><br>
<br>
<u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a conclusion believe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that the Chinese ADC module based Nh711 chip showed themselves as workable and able to be used as a conventional balance schemes and middle class. The absence of weight correction from the ambient temperature in the microcircuit itself is the most vulnerable point of this module (microcircuit). My practice has shown that for devices operating in conditions with small fluctuations in ambient temperature, the measurement error does not exceed the errors allowed by the metrology. However, the question of using this module for scales operating, for example, on the market, when in summer the temperature is over +30, and in winter up to -15 degrees Celsius, remains open.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Unfortunately, I don‚Äôt have the opportunity to test the scales in a heat chamber and answer this question, so at the end of the article I am attaching a hex file (not for arduino), for the flash memory of the microcontroller. </font><font style="vertical-align: inherit;">The diagram is shown above, the characteristics of the strain gauge are also given. </font><font style="vertical-align: inherit;">If anyone is interested in this ADC module and there is a heat chamber, you can conduct the necessary tests yourself. </font><font style="vertical-align: inherit;">It is advisable to share your results. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File: Scale16_11.hex. </font><font style="vertical-align: inherit;">Link: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud.mail.ru/public/4Edm/43fwpHEPU</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 All the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">best</font></a><font style="vertical-align: inherit;"> !</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en491976/index.html">We turn the UNIT economy for an online store or production</a></li>
<li><a href="../en491980/index.html">The benefits of interviews. Flutter Developer Option</a></li>
<li><a href="../en491984/index.html">Airport Automation at HEL</a></li>
<li><a href="../en491986/index.html">RemoteLoRa - More Than ON / OFF</a></li>
<li><a href="../en491988/index.html">What's New in Red Hat OpenShift 4.2 and 4.3?</a></li>
<li><a href="../en491992/index.html">Analyst Development</a></li>
<li><a href="../en491994/index.html">Migrating from Cocoapods to Swift Package Manager</a></li>
<li><a href="../en491996/index.html">More about Coroutines in C ++</a></li>
<li><a href="../en492000/index.html">Product very first. Burnout</a></li>
<li><a href="../en492002/index.html">Light-Absorbing Wings: The Secret to Super Black Butterflies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>