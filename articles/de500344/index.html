<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¨ üèáüèæ üë≤üèª Smart Home auf R√§dern ... Alice. Teil 2. ZIGBEE üèì üëåüèΩ üöû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fortsetzung des Epos mit Sprachsteuerung
 Im vorherigen Teil wurde die Stimme √ºber Alice von MiLight-Controllern gesteuert. Solche Steuerungen gibt es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smart Home auf R√§dern ... Alice. Teil 2. ZIGBEE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500344/"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortsetzung des Epos mit Sprachsteuerung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im vorherigen Teil wurde die Stimme √ºber Alice von MiLight-Controllern gesteuert. Solche Steuerungen gibt es jedoch nicht in jedem Haus, was unsere F√§higkeiten stark einschr√§nkt. Aus diesem Grund habe ich mich vorgenommen, die Sprachsteuerung auf normale Lampen, Lampen, Kronleuchter usw. auszudehnen, jedoch mit einer minimalen √Ñnderung des Standardbeleuchtungssystems. F√ºr ein solches System ist lediglich der Austausch herk√∂mmlicher Switches durch intelligente Switches nach dem ZigBee-Protokoll und die Installation eines USB-ZigBee-Koordinators CC2531 erforderlich. Nat√ºrlich haben wir aus dem vorherigen Artikel bereits eine intelligente Yandex-S√§ule und ein individuelles Durcheinander.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kosten f√ºr CC2531 kosten 250 Rubel, der Programmierer daf√ºr CC-Debugger Texas Instrument - 500 Rubel. Die Livolo VL-C701Z-11 Touch-Smart-Schalter waren die teuersten - etwa 2000 Rubel pro St√ºck, und wenig sp√§ter wurde um 2000 auch der Aqara Wall Switch ZigBee-Knopfschalter hinzugef√ºgt.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst wollte ich die Switches √ºber den propriet√§ren ZigBee-Gateway-Router Livolo C700ZW-12 steuern, an den offenen Hub anschlie√üen und mit Alice √ºber yandex2mqtt steuern. Ich habe die Dr√ºsen an die Stromversorgung angeschlossen und die Anwendung von Livolo am Telefon eingerichtet. Ich sah die Gateway-Schalter verbunden und alles funktionierte perfekt vom Telefon aus. Der offene Hub mit dem Router konnte jedoch aufgrund des Mangels an erforderlichen Funktionen im offenen Hub nicht zusammengef√ºhrt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich musste das Gateway verlassen und die Switches direkt mit dem CC2531-Dongle zusammenf√ºhren. Und hier hat das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee2mqtt-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekt </font><font style="vertical-align: inherit;">des Freundes Koenkk dabei </font><font style="vertical-align: inherit;">geholfen </font><font style="vertical-align: inherit;">. Infolgedessen ist es uns gelungen, den ZigBee-Koordinator mit intelligenten Switches zu verbinden, deren Funktion zun√§chst anhand von Abfragen im Thema mqtt zur Analyse zu √ºberpr√ºfen und dann das Steuerelement mithilfe von Alice zu konfigurieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie verlief das Setup: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Flashen Sie den CC2531-Sniffer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit der Firmware des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Koordinators und schlie√üen Sie ihn an den USB-Anschluss an. Um Meldungen √ºber einen Stromausfall zu vermeiden, sollten Sie mindestens 2A an ein 5-V-Netzteil anschlie√üen. Wir √ºberpr√ºfen, ob der Stick im System korrekt erkannt wurde: ls -l / dev / serial / by-id zeigt so etwas wie usb-Texas_Instruments_TI_CC2531_USB_CDC ___ 0X00124B0458ED3DDF-if00 -&gt; ../../ttyACM0 an. Das Vorhandensein der letzten Ausgabe "-&gt; ../../ttyACM0" ist in diesem Fall sehr wichtig. Ein Stock kann ohne diesen Teil entscheiden und nichts wird funktionieren. Das Flashen des Sticks hat mir bei einem solchen Problem geholfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Installieren Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zigbee2mqtt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber starten Sie nicht.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Es ist wichtig, /opt/zigbee2mqtt/data/configuration.yaml korrekt zu konfigurieren. Tatsache ist, dass Livolo Smart Switches auf Kanal 26 arbeiten, sodass dieser Kanal explizit in der Datei festgelegt werden muss. Au√üerdem ist es wichtig, auf die Anzahl der Leerzeichen am Anfang der Zeilen der Datei zu achten. Um die Syntax der Konfigurationsdatei zu √ºberpr√ºfen, k√∂nnen Sie den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YAML-Validator verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Nachdem die Konfigurationsdatei korrekt registriert wurde und der Dongle feststeckt, f√ºhren Sie zigbee2mqtt aus. Dann stampfen wir zu den Schaltern, beginnen mit dem Pairing und sehen uns die Konsolenausgabe an. Es wird eine Linie des Datenaustauschs geben, gegenseitige rassharkivaniya zwischen Ger√§ten und schlie√ülich so etwas : </font></font><code>MQTT publish: topic 'zigbee2mqtt/0x001*********a8c9', payload '{"state_left":"OFF","state_right":"OFF","linkquality":60}'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies bedeutet, dass der Switch angeschlossen ist und seinen Status sendet. Wenn Sie ein paar weitere Konsolen betreiben, k√∂nnen Sie das Licht √ºber das mqtt-Thema steuern: ausschalten</font></font><code>- mosquitto_pub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -m OFF -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und drehen - </font></font><code>mosquitto_pub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -m ON -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und Sie k√∂nnen auch das Team in Topeka √ºberpr√ºfen </font></font><code>mosquitto_sub -d -h localhost -t zigbee2mqtt/0x001*********a8c9/left/set -u a**** -P *****</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. F√ºr Livolo und Aqara unterscheiden sich die Themen √ºbrigens nicht nur in den Bezeichnern 0x0 ..., sondern auch in der Struktur. Die Themenstruktur f√ºr unterst√ºtzte Ger√§te finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Nachdem wir √ºberpr√ºft haben, dass wir Ger√§te √ºber mqtt verwalten k√∂nnen, werden wir alles mit Yandex koppeln. Hier ist eine Nuance aufgetaucht. Befehle zum Steuern von Ger√§ten √ºber zigbee2mqtt kamen zu Themen in Form von EIN / AUS, und yandex2mqtt ergab, wie sich herausstellte, 1/0. Die L√∂sung f√ºr dieses Problem bestand darin, die Datei /mnt/data/root/yandex2mqtt/device.js in yandex2mqtt zu bearbeiten. M√ºssen Sie im Fall "Ein" int = val im Schalter ersetzen? zu 'ein': 'aus' anstelle von '1': '0'. Nat√ºrlich mussten die Schaltbefehle im offenen Hub in den entsprechenden Themen korrigiert werden. Ohne dies w√ºrde das Licht auf Milight aufh√∂ren zu funktionieren. Und das Interessanteste kam genau dort ans Licht - da yandex2mqtt und zigbee2mqtt alles auf dem lokalen mqtt-Server ver√∂ffentlichen, scheint es, dass Zenbee-Ger√§te keinen offenen Hub zum Verwalten von Ger√§ten ben√∂tigen.Das Bundle funktioniert direkt - yandex (Alice) -yandex2mqtt-mqtt-zigbee2mqtt-device zigbee. Sogar irgendwie unerwartet. Aber lass uns weitermachen. Wir werden das Thema Ger√§testeuerung in der Konfigurationsdatei /mnt/data/root/yandex2mqtt/config.js in einem neuen virtuellen Ger√§t ablegen, die Liste der Ger√§te im Yandex-Dialogsystem aktualisieren und Sie k√∂nnen Alice treten, um das Licht einzuschalten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Es war auch m√∂glich, ein Paar Xiaomi-Sensoren, einen Leckagesensor und einen Temperatur- / Feuchtigkeits- / Drucksensor an das System anzuschlie√üen. </font><font style="vertical-align: inherit;">Sie werden mit 2032-Batterien betrieben. Nat√ºrlich werden sie nicht gesteuert, aber sie lassen einfach regelm√§√üig Informationen wie </font></font><code>#033[32mzigbee2mqtt:info #033[39m 2020-05-04 21:12:21: MQTT publish: topic 'zigbee2mqtt/0x0015************', payload '{"battery":91,"voltage":2985,"temperature":26.2,"humidity":28.65,"pressure":1006.9,"linkquality":52}' -   #  #033[32mzigbee2mqtt:info #033[39m 2020-05-04 21:21:07: MQTT publish: topic 'zigbee2mqtt/0x001************7', payload '{"battery":100,"voltage":3025,"linkquality":0,"water_leak":true}' </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einen Lecksensor in einem Glas Wasser </font><font style="vertical-align: inherit;">in Themen fallen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bisher gibt es keinen besonderen Vorteil, aber wenn all dies nicht funktioniert und etwas Reaktives wie das Senden von SMS oder Ziffern an eine Web-Schnauze bewirkt, ist es sehr gut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ein kleines Video:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Pb8veRpRMTY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9uNynR_LL-o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500332/index.html">4. Mai Java Digest</a></li>
<li><a href="../de500334/index.html">Twister oder K√ºhlschrank in Pilot Brothers</a></li>
<li><a href="../de500336/index.html">Teil 2: Module und AppStore. ESPboy - ein Gadget f√ºr Retro-Spiele und Experimente mit IoT</a></li>
<li><a href="../de500338/index.html">[√úbersetzung] Absp√ºlen</a></li>
<li><a href="../de500342/index.html">Welche Podcasts haben das ‚ÄûKomitee‚Äú, ‚ÄûHabr‚Äú und Sports.ru?</a></li>
<li><a href="../de500346/index.html">Probleme mit DNS in Kubernetes. √ñffentliche Obduktion</a></li>
<li><a href="../de500348/index.html">COVID-19-Pandemie mit den Augen eines Mathematikers oder warum das klassische SEIRD-Modell nicht funktioniert</a></li>
<li><a href="../de500352/index.html">Wie bekomme ich ein Praktikum auf Facebook und bekomme ein Angebot in London? Stellen Sie einem Facebook-Ingenieur eine Frage</a></li>
<li><a href="../de500354/index.html">Eine neue Methode zum Verfolgen von Daten in Google Tag Manager - Serverseitiges Tagging</a></li>
<li><a href="../de500356/index.html">Direkte Datei√ºbertragung zwischen Ger√§ten √ºber WebRTC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>