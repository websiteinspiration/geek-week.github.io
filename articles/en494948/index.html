<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüöí üí° ü•í Create a VIP mailbox in Zimbra Collaboration Open-Source Edition üë± ‚è≠Ô∏è üê•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In enterprises, a situation often arises when the creation of a so-called VIP mailbox is required, only a certain circle of people can send letters to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Create a VIP mailbox in Zimbra Collaboration Open-Source Edition</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/494948/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In enterprises, a situation often arises when the creation of a so-called VIP mailbox is required, only a certain circle of people can send letters to it. Such mailboxes are typical for any top managers with personal secretaries. Instead of the top manager, all the e-mail is received by the secretary, who then selects really important and necessary messages from the general stream and redirects them to his manager‚Äôs mailbox. An ordinary employee of an enterprise, when trying to send a message to a VIP mailbox, should receive a notification that his message has not been delivered. Such a VIP mailbox can be easily implemented in Zimbra Open-Source Edition using the built-in mail filtering tools called Amavis and cbpolicyd.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/op/xi/ie/opxiieyaijocgswpkt2td6f4-u0.png" alt="image"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amavis coordinates the actions of the Postfix email forwarding agent, Spam Assassin spam filter, ClamAV antivirus and several others. Together, all these utilities provide reliable protection against spam and viruses, as well as phishing emails, which pose a serious threat to the information security of the enterprise. By default, Amavis filters all emails without exception, but the built-in policy restriction functionality allows not only to disable this filtering for any mailboxes, but also to limit the list of people who can send emails to mailboxes in principle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, take the mailbox of the CEO ceo@example.ru, for which it is necessary to limit the circle of people who can send messages directly. The list will be limited to the top management of the company in the form of CTO, CIO and CFO, as well as a personal secretary. For this, we will take advantage of Amavis policy restrictions. Using the command </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmprov ma ceo@example.ru + amavisWhitelistSender secretary@example.ru cto@example.ru cio@example.ru cfo@example.ru</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we will add to the white list addresses that can write emails to the CEO directly, and with using the command </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmprov ma ceo@example.ru amavisBlacklistSender example.ru</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we add the rest to the black list. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to make sure that everything is done correctly, you can run the command</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmprov -l ga ceo@example.ru | grep amavis | grep sender</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The team‚Äôs output will show both those who are allowed to send messages to the CEO, and those to whom sending messages to his email address is prohibited. However, in addition to users of an enterprise‚Äôs domain, letters to the CEO‚Äôs mailbox can also come from domains on the external Internet. Therefore, a reasonable step would be the introduction of an unconditional ban on receiving emails from the external Internet for this mailbox. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These restrictions can be introduced by using cbpolicyd, the policy service built into the Zimbra Collaboration Suite Open-Source Edition. In order to use it, you must first activate the corresponding module in Zimbra OSE. To do this, enter the command</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmprov ms mail.example.ru + zimbraServiceEnabled cbpolicyd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Run this command on the MTA host if your Zimbra OSE runs on a multi-server infrastructure. You will also need to open access to cbpolicyd through the web interface. To do this, enter the command </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ln -s / opt / zimbra / data / cbpolicyd / share / webui / opt / zimbra / httpd / htdocs /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will create a symbolic link in the Apache server. In addition, you need to add the </font><font style="vertical-align: inherit;">information about the database to which you want to connect to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/zimbra/cbpolicyd/share/webui/includes/config.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">. To do this, in any text editor, add the line </font><b><font style="vertical-align: inherit;">$ DB_DSN = "sqlite: /opt/zimbra/data/cbpolicyd/db/cbpolicyd.sqlitedb"</font></b><font style="vertical-align: inherit;"> to this file</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;. After that, all that remains is to restart Zimbra OSE and the Apache web server using the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmcontrol restart</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmapachectl restart commands</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the web interface for administering cbpolicyd is available at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mail.example.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 7780 / webui / index.php, however, it should be noted that it may not be available due to the firewall settings. Configure it to access the cbpolicyd web interface. After you enter the cbpolicyd web interface, you need to create two groups: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users_local_only</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for users who can receive mail only from users of the local domain, as well as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local_domain</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for the local domain and enable them by unchecking the "Disabled". After that, you need to add participants to the groups. In our case, we will add ceo@example.ru to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users_local_only</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> group </font><font style="vertical-align: inherit;">and the example.ru domain to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local_domain</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> group </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zr/wr/qi/zrwrqig_whywr6pyw7fo7qdwkdg.png"><br>
<br>
<img src="https://habrastorage.org/webt/xa/fd/11/xafd11cwayuoukj5mh6moi7lpis.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's get down to the policy settings. We will call our ‚ÄúReceiving Local Only‚Äù and indicate in it the user groups to which it will be distributed, and the domains that are considered local. The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_local_only</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><b><font style="vertical-align: inherit;">local_domain</font></b><font style="vertical-align: inherit;"> groups should be specified as them</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and also indicate the priority of applying the policy. This is necessary for cases when several policies are applied to the same mailbox at once. Based on priority, cbpolicyd decides which policy will be applied and which will be ignored. In our case, you can set the priority to 100 and in the future, if additional overlapping policies appear, adjust it. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/go/px/it/gopxits8bjhued_4dom3c3hyr2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another important point is the configuration of the action when the policy is triggered. In other words, if we forbade the CEO‚Äôs mailbox to receive letters from any external domains, then we need to decide what will happen to the letters that will continue to be sent to his mailbox. We suggest simply rejecting such emails using the </font><b><font style="vertical-align: inherit;">REJECT</font></b><font style="vertical-align: inherit;"> option</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After making the changes, it remains only to apply the policies and restart cbpolicyd using the commands </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmprov ms mail.example.ru zimbraCBPolicydAccessControlEnabled TRUE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zmcbpolicydctl restart</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, using the built-in tools of Zimbra Collaboration Suite Open-Source Edition, we created a VIP mailbox, which only a few people can send letters to. </font><font style="vertical-align: inherit;">Using this template, you can expand the number of VIP mailboxes, as well as the number of accounts that can send them letters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For all questions related to the Zextras Suite, you can contact the representative of the company "Zextras" Ekaterina Triandafilidi by e-mail katerina@zextras.com</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494932/index.html">Operating a Large Distributed System: What I Learned</a></li>
<li><a href="../en494934/index.html">6 mistakes in English words that are terribly enraging</a></li>
<li><a href="../en494938/index.html">Happy backup day! Don't forget about him</a></li>
<li><a href="../en494940/index.html">DevOps - what is it, why, and how much is it in demand?</a></li>
<li><a href="../en494942/index.html">CGI at home with Unreal Engine and iPhone</a></li>
<li><a href="../en494950/index.html">Some storage trends to look out for</a></li>
<li><a href="../en494956/index.html">Data Byte Life</a></li>
<li><a href="../en494964/index.html">Neural networks and trading. Practical implementation</a></li>
<li><a href="../en494966/index.html">SCRUM: a poem about love and pain</a></li>
<li><a href="../en494968/index.html">Underwater Internet Cables: Who Routes Them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>