<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↙️ 🥁 🏿 Capturas de tela automáticas do iOS usando o XCTestplan e o Xcode 11 👩🏼‍⚖️ 👩🏾‍🎨 👩🏿‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existem várias aplicações móveis no Raiffeisenbank que devem funcionar em uma ampla variedade de dispositivos e sistemas operacionais; portanto, tenta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Capturas de tela automáticas do iOS usando o XCTestplan e o Xcode 11</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/502626/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem várias aplicações móveis no Raiffeisenbank que devem funcionar em uma ampla variedade de dispositivos e sistemas operacionais; portanto, tentamos automatizar os processos de rotina nos testes. Este artigo nos pareceu útil e decidimos traduzi-lo. </font></font></i><font style="vertical-align: inherit;"><font color="grey"><font style="vertical-align: inherit;">fonte da foto: unsplash.com</font></font><font style="vertical-align: inherit;"> 
Se o seu aplicativo for multilíngue, universal e projetado para diferentes dispositivos, você poderá gastar muito tempo criando capturas de tela para cada configuração. Imagine que você tem quatro idiomas, suporte para iPad e iPhone e precisa salvar 4 telas cada - estas são 32 capturas de tela. O processo deve ser automatizado para não perder tempo toda vez que as interfaces são atualizadas.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/zh/ny/9i/zhny9ihqeamema_yinthkbx9cgg.png"></a><br>
<font color="grey"><font style="vertical-align: inherit;"></font></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A ferramenta XCTestPlan, que apareceu no Xcode 11, permite criar várias configurações para testes. </font><font style="vertical-align: inherit;">Atualmente, as configurações são usadas com mais frequência para determinar como os testes serão executados, incluindo a escolha do idioma para o aplicativo. </font><font style="vertical-align: inherit;">Neste artigo, você aprenderá como usar o XCTestPlan para automatizar capturas de tela.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar o XCTestplan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos definir um destino UITests separado para automatizar a criação de capturas de tela, o que é especialmente útil se você não planeja executar seus principais testes com essas configurações. Para criar um novo destino, selecione </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquivo -&gt; Novo -&gt; Destino</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e crie um novo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pacote de Teste de UI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Depois disso, você precisará adicionar um novo plano </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTest a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esse destino. Para fazer isso, você pode usar o menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produto -&gt; Plano de teste -&gt; Novo plano de teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou, no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor de esquema,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selecionar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Converter para usar planos de teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se você fizer isso através do menu, precisará garantir que o novo alvo esteja na guia `Testar '.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como queremos definir apenas as configurações de idioma, podemos deixar inalteradas as configurações compartilhadas e simplesmente adicionar uma nova configuração para cada idioma que suportamos. </font><font style="vertical-align: inherit;">É assim que as configurações de um aplicativo que suporta inglês, alemão e francês são: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e73/6c7/f4b/e736c7f4b030915e123f137711f1a73f.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa é toda a configuração e o lançamento necessários do XCTestplan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automação de capturas de tela</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seus testes de interface do usuário criando capturas de tela praticamente não diferem dos testes usuais, exceto que eles criarão anexos. Você também pode adicionar verificações XCTAssert para que os testes falhem se algo der errado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro ponto importante: pode ser necessário </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">waitForExpectations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caso a sua interface do usuário não esteja pronta no momento em que a captura de tela </font><font style="vertical-align: inherit;">for feita ( </font><b><font style="vertical-align: inherit;">teclado mostrando</font></b><font style="vertical-align: inherit;"> / ocultando, conclusão da animação). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo está um exemplo com todos os métodos auxiliares:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">testScreenshots</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">let</span> app = <span class="hljs-type">XCUIApplication</span>()
    <span class="hljs-keyword">let</span> searchButton = app.buttons[<span class="hljs-string">"search"</span>]<font></font>
    searchButton.tap()<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> keyboard = app.keyboards.firstMatch<font></font>
    waitForExistence(of: keyboard)<font></font>
    app.typeText(<span class="hljs-string">"Cupertino"</span>)<font></font>
    add(takePromoShot(name: <span class="hljs-string">"Search"</span>))<font></font>
    <font></font>
    <span class="hljs-keyword">let</span> firstResult = app.cells.firstMatch<font></font>
    firstResult.tap()<font></font>
    waitForDisappearance(of: keyboard)<font></font>
    add(takePromoShot(name: <span class="hljs-string">"Result"</span>))<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">waitForExistence</span><span class="hljs-params">(of element: XCUIElement)</span></span> {
    <span class="hljs-keyword">let</span> predicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"exists == TRUE"</span>)<font></font>
    expectation(<span class="hljs-keyword">for</span>: predicate, evaluatedWith: element, handler: <span class="hljs-literal">nil</span>)<font></font>
    waitForExpectations(timeout: <span class="hljs-number">5.0</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">waitForDisappearance</span><span class="hljs-params">(of element: XCUIElement)</span></span> {
    <span class="hljs-keyword">let</span> predicate = <span class="hljs-type">NSPredicate</span>(format: <span class="hljs-string">"exists == FALSE"</span>)<font></font>
    expectation(<span class="hljs-keyword">for</span>: predicate, evaluatedWith: element, handler: <span class="hljs-literal">nil</span>)<font></font>
    waitForExpectations(timeout: <span class="hljs-number">5.0</span>, handler: <span class="hljs-literal">nil</span>)<font></font>
}<font></font>
</code></pre><br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">takePromoShot</span><span class="hljs-params">(name: String)</span></span> -&gt; <span class="hljs-type">XCTAttachment</span> {
    <span class="hljs-keyword">let</span> lang = <span class="hljs-type">Locale</span>.preferredLanguages[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">let</span> screenshot = <span class="hljs-type">XCUIScreen</span>.main.screenshot()
    <span class="hljs-keyword">let</span> attachment = <span class="hljs-type">XCTAttachment</span>(screenshot: screenshot)<font></font>
    attachment.lifetime = .keepAlways<font></font>
    attachment.name = <span class="hljs-string">"\(lang)-\(name)"</span>
    <span class="hljs-keyword">return</span> attachment<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preste atenção ao último recurso. </font><font style="vertical-align: inherit;">Ele pega o nome do instantâneo, adiciona o identificador de idioma, captura uma captura de tela e retorna um XCTAttachment com o valor do parâmetro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.keepAlways</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Isso é importante porque, por padrão, as capturas de tela capturadas durante os testes são excluídas se os testes forem bem-sucedidos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Lifiteme é</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um parâmetro importante, pois garante que a captura de tela seja salva após a conclusão do teste. </font><font style="vertical-align: inherit;">Durante os testes de interface do usuário, as capturas de tela são feitas constantemente. </font><font style="vertical-align: inherit;">Eles são muito úteis quando você precisa determinar por que e quando o teste caiu; </font><font style="vertical-align: inherit;">mas, por padrão, as capturas de tela serão excluídas se os testes forem bem-sucedidos. </font><font style="vertical-align: inherit;">Assim, quando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testScreenshots ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for bem-sucedido, você terá apenas as capturas de tela necessárias.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barra de status habitual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos desenvolvedores prefere ver nas telas uma barra de status com a hora certa, um sinal de rede completo e outros detalhes. </font><font style="vertical-align: inherit;">No Xcode 11, isso é ainda mais fácil. </font><font style="vertical-align: inherit;">Existe um utilitário </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xcrun simctl status_bar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que permite especificar essas configurações. </font><font style="vertical-align: inherit;">Isso pode ser adicionado como </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fase de construção</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">xcrun simctl status_bar booted override --time 9:41 --operatorName <span class="hljs-string">' '</span> --cellularMode active --cellularBar 4 --wifiBars 3 --batteryState charged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após esse comando, a barra de status terá a mesma aparência dos materiais de marketing da Apple. </font><font style="vertical-align: inherit;">Infelizmente, a equipe não trabalha em um dispositivo real, apenas em um simulador. </font><font style="vertical-align: inherit;">Observe também que o simulador que você usa deve estar em execução antes de iniciar os testes para coletar capturas de tela.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coletando as capturas de tela resultantes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora podemos executar nossos testes de interface do usuário. </font><font style="vertical-align: inherit;">Quando eles passarem, veremos os resultados no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navegador de relatórios</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no Xcode. </font><font style="vertical-align: inherit;">Também haverá testes contendo procedimentos agrupados por configurações de idioma. </font><font style="vertical-align: inherit;">Os procedimentos que possuem anexos são marcados com um clipe de papel. </font><font style="vertical-align: inherit;">As próprias imagens podem ser abertas no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QuickLook</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/4c8/412/fce/4c8412fce1f89e4da3cc3ceddc79d858.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A coleta separada de todas as imagens resultantes pode consumir muito tempo, principalmente se o seu aplicativo suportar muitos idiomas. </font><font style="vertical-align: inherit;">Infelizmente, esses anexos não aparecem como png ou jpg entre os resultados do teste (outra alteração no Xcode 11). </font><font style="vertical-align: inherit;">Mas você pode analisar os resultados do teste e encontrar o JSON que aponta para os anexos reais e os coleta. </font><font style="vertical-align: inherit;">Isso pode ser feito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usando o utilitário xcparse.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">É instalado usando o Homebrew e iniciado pelo comando:</font></font><br>
<br>
<pre><code class="bash hljs">xcparse screenshots /path/to/Test.xcresult /path/to/outputDirectory</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinalizadores adicionais agruparão arquivos por dispositivo, SO ou configuração. </font><font style="vertical-align: inherit;">Os nomes de nossos arquivos contêm um identificador de idioma, para que você possa simplesmente classificá-los por nome.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A abordagem descrita já nos permitiu economizar tempo suficiente, especialmente em situações em que havia um requisito para oferecer suporte ao dispositivo com uma nova resolução ou a interface foi significativamente atualizada. </font><font style="vertical-align: inherit;">No WWDC20, gostaria de ver a escolha dos dispositivos como parte da configuração do XCTestplan, mas, por enquanto, você deve escolher manualmente ou usar um script que colete as capturas de tela necessárias na AppStore.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt502604/index.html">Uma introdução ao TLS para Patrik Patrick (Parte 1)</a></li>
<li><a href="../pt502608/index.html">Como começamos o mercado de aplicativos no serviço SaaS</a></li>
<li><a href="../pt502614/index.html">Melhores práticas do Kubernetes. Definindo consultas e limites de recursos</a></li>
<li><a href="../pt502620/index.html">Contabilidade de dinheiro</a></li>
<li><a href="../pt502624/index.html">Como eles funcionam no Facebook? Valores e contratação em uma empresa</a></li>
<li><a href="../pt502628/index.html">O mito da web semântica</a></li>
<li><a href="../pt502630/index.html">As mensagens que você excluiu há alguns anos ainda podem ser armazenadas no seu smartphone</a></li>
<li><a href="../pt502634/index.html">Telemedicina. Três startups de tecnologia. O produto é um, mas destinos diferentes</a></li>
<li><a href="../pt502636/index.html">Negócios e cyberpunk: misture, mantenha, use</a></li>
<li><a href="../pt502638/index.html">Como desenvolver um blog no Instagram em 2020: análise do caso de Sasha Mitroshina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>