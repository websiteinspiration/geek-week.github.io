<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏼 🔙 👨🏻‍🔧 Utilisation de RabbitMQ avec MonsterMQ Partie 1 🧖🏽 👩🏾‍🚀 👩‍👩‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est destiné à ceux qui ne sont pas encore familiarisés avec les files d'attente et RabbitMQ. Ceux qui savent déjà comment travailler avec ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Utilisation de RabbitMQ avec MonsterMQ Partie 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488850/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet article est destiné à ceux qui ne sont pas encore familiarisés avec les files d'attente et RabbitMQ. </font><font style="vertical-align: inherit;">Ceux qui savent déjà comment travailler avec RabbitMQ et veulent seulement explorer les possibilités qu'offre MonsterMQ, je recommande de visiter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page du projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur github.com, où la description décrit en détail comment vous pouvez utiliser MonsterMQ sans décrire les bases de travailler avec RabbitMQ. </font><font style="vertical-align: inherit;">Le reste de cet article couvrira les bases du fonctionnement de RabbitMQ avec MonsterMQ.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RabbitMQ est un courtier de messages. Il reçoit, stocke et transmet des messages à ses clients. Les clients expéditeurs et destinataires de messages peuvent servir, par exemple, des applications écrites en PHP. La communication entre le client et RabbitMQ se fait selon certaines règles appelées AMQP (Advanced Message Queuing Protocol). Par exemple, la communication entre votre navigateur et le serveur Web sur lequel se trouve cet article suit également certaines règles, elles sont appelées HTTP (HyperText Transfer Protocol) - un protocole de transfert hypertexte. HTTP et AMQP sont des protocoles client-serveur, c'est-à-dire qu'ils impliquent la présence d'un client et d'un serveur. RabbitMQ est un serveur AMQP, et MonsterMQ est une bibliothèque qui vous permet d'écrire rapidement un client AMQP en PHP, qui communiquera avec le serveur AMQP.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMQP et RabbitMQ utilisent les termes suivants: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produire - signifie envoyer des messages, Producteur (fournisseur) - celui qui envoie les messages. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/093/98a/3af/09398a3afdf46d8e58c6c2f253037017.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consommer - signifie recevoir des messages. </font><font style="vertical-align: inherit;">Consommateur - celui qui reçoit des messages. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/918/3b0/d5e/9183b0d5e55eccdd919dee359a50d776.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La file d'attente est la file d'attente. </font><font style="vertical-align: inherit;">Avant d'atteindre le consommateur et après avoir été envoyé par le fournisseur, le message est stocké dans une file d'attente à l'intérieur de RabbitMQ. </font><font style="vertical-align: inherit;">La file d'attente est un tampon qui stocke les messages. </font><font style="vertical-align: inherit;">De nombreux fournisseurs peuvent envoyer des messages dans une file d'attente et de nombreux consommateurs peuvent lire les messages d'une file d'attente. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9d5/99c/8b9/9d599c8b96684a7a58e2aec05e6416b4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que le fournisseur, le consommateur et le courtier ne doivent pas nécessairement être sur le même hôte, au contraire, ils sont généralement situés sur différents.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour le monde</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus loin dans cet article, nous écrirons deux programmes en PHP à l'aide de la bibliothèque MonsterMQ, dont l'un enverra des messages, et l'autre les recevra et les affichera sur la console. </font><font style="vertical-align: inherit;">Dans la figure ci-dessous, «P» est le fournisseur, «C» est le consommateur, les cases rouges sont la file d'attente qui est le tampon des messages (chaque case est le message). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2d8/ca1/fc0/2d8ca1fc0dce6c0c23e4524148027680.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Image prise sur le site officiel de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pour poursuivre les travaux, nous devons installer MonsterMQ, pour ce faire, entrez la commande suivante dans la console:</font></font><br>
<br>
<pre><code class="bash hljs">composer require goootlib/monster-mq:dev-master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Vous trouverez plus d'informations sur l'installation de MonsterMQ sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page du projet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur github.com) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette commande installera MonsterMQ dans le dossier actuel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Départ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous appellerons notre expéditeur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le destinataire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">L'expéditeur rejoindra le serveur et enverra le message. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour rejoindre le serveur, écrire le code suivant dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce code, nous rejoignons RabbitMQ fonctionnant sur un serveur local sur un port standard. </font><font style="vertical-align: inherit;">Spécifiez une autre adresse IP et un autre port si RabbitMQ s'exécute sur votre autre adresse. </font><font style="vertical-align: inherit;">Après la connexion, nous appelons également la méthode logIn (), qui démarre la session avec le login et le mot de passe standard. </font><font style="vertical-align: inherit;">Si vous avez un compte avec un nom d'utilisateur et un mot de passe différents configurés dans RabbitMQ, spécifiez-les ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour envoyer un message, nous devons déclarer la file d'attente dans laquelle il sera d'abord placé. </font><font style="vertical-align: inherit;">Après l'annonce de la file d'attente, nous pouvons envoyer un message:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $producer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
   $producer-&gt;publish(<span class="hljs-string">'my-message'</span>, <span class="hljs-string">'test-queue'</span>);<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La déclaration de file d'attente est idempotente, c'est-à-dire qu'elle ne créera pas et ne modifiera pas la file d'attente, si elle existe déjà. </font><font style="vertical-align: inherit;">Après avoir terminé la session et nous rejoindre.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $producer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
   $producer-&gt;publish(<span class="hljs-string">'Test message'</span>, <span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $producer-&gt;disconnect();<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recevoir un message</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contrairement à l'expéditeur, le destinataire continuera de fonctionner afin d'écouter les messages entrants. </font><font style="vertical-align: inherit;">Dans le code </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">vous</font></b><font style="vertical-align: inherit;"> devez d'abord faire la même chose que dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notez que dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous déclarons également notre file d'attente, c'est pour que le destinataire déclare la file d'attente si elle est démarrée avant l'expéditeur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'indiquer au serveur que nous souhaitons en recevoir un message, ainsi que de démarrer un cycle qui attendra et traitera les messages entrants, nous écrirons le code suivant:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
<font></font>
   $consumer-&gt;consume(<span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $consumer-&gt;wait(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$message, $channelNumber</span>) <span class="hljs-title">use</span> (<span class="hljs-params">$consumer</span>)</span>{
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"Message - {$message} received on channel {$channelNumber}"</span>;<font></font>
   });<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lancement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous pouvons exécuter les deux scripts en tant que destinataire:</font></font><br>
<br>
<pre><code class="bash hljs">php receive.php</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donc expéditeur:</font></font><br>
<br>
<pre><code class="bash hljs">php send.php</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le destinataire transmettra à la console le message qu'il recevra de RabbitMQ (qui à son tour le recevra de send.php) et le numéro de canal utilisé. </font><font style="vertical-align: inherit;">Il continuera à être exécuté jusqu'à ce que vous fermiez le terminal ou jusqu'à ce que vous arrêtiez de l'exécuter en appuyant sur Ctrl + C. </font><font style="vertical-align: inherit;">En lançant l'expéditeur dans un autre terminal, vous pouvez observer comment les messages sont remis au destinataire et affichés dans la console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous voulez voir qui, pour le moment, RabbitMQ contient des files d'attente et combien de messages y sont, vous pouvez le faire en tant qu'utilisateur privilégié en utilisant </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rabbitmqctl</font></font></b><br>
<pre><code class="bash hljs">sudo rabbitmqctl list_queues</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur Windows, n'utilisez pas sudo</font></font><br>
<pre><code class="bash hljs">rabbitmqctl.bat list_queues</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes maintenant prêts à passer à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prochaine partie de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos leçons.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488836/index.html">Quelques aspects de l'utilisation de Dictionary lors du développement d'applications chargées</a></li>
<li><a href="../fr488842/index.html">Attraper un électron: observer un processus qui prend un quintillionième de seconde</a></li>
<li><a href="../fr488844/index.html">Frontières pour les gardes-frontières: un tribunal américain a établi des règles pour contrôler les appareils - discuter de la situation</a></li>
<li><a href="../fr488846/index.html">Postgresso 19</a></li>
<li><a href="../fr488848/index.html">CTO all startup</a></li>
<li><a href="../fr488852/index.html">Configuration de la fonction de perte pour un réseau neuronal basée sur des données sismiques</a></li>
<li><a href="../fr488854/index.html">10. Mise en route de Fortinet v6.0. Escorte</a></li>
<li><a href="../fr488856/index.html">Eh bien CRM et CRM. Tout est plus facile que vous ne le pensez.</a></li>
<li><a href="../fr488860/index.html">Substitution à l'importation et construction navale</a></li>
<li><a href="../fr488866/index.html">Validation des images avec Gitlab CI / CD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>