<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô üéª üè™ Docking the ISS using JavaScript and compass ‚ôèÔ∏è üî° üë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The SpaceX company, founded by the notorious Ilon Mask, released a simulator for the manual docking of the Crew Dragon spacecraft with the ISS. If eve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Docking the ISS using JavaScript and compass</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502072/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The SpaceX company, founded by the notorious Ilon Mask, released a simulator for the manual docking of the Crew Dragon spacecraft with the ISS. If everything goes according to plan, the docking will take place on May 27, 2020. It will take place in fully automatic mode, but the crew will be able to switch to manual control. Actually, it is the manual mode that is reproduced in the simulator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simulator itself is located on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and is a rather problematic toy for the first ridge ... The </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
space shuttle </font><font style="vertical-align: inherit;">tries </font><font style="vertical-align: inherit;">to fly the wrong way ... And the accuracy with which you need to get into the gateway is 20 cm ... along three axes, as well as angular velocity, displacement speed etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Patriotic feelings began to play in me and somehow it became a shame for the former space power, and I took this simulator as a challenge. </font><font style="vertical-align: inherit;">Since Musk decided to show the complexity of the docking, and what difficulties their engineers went through to create an automatic docking program, I decided to write, in my free time, a JavaScript program that easily connects Dragon and the ISS in this simulator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How do you like that, Elon Musk? </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/381/073/975/3810739751dee69351aa8074842a815a.jpg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Smoking is bad for your health</font></font></i><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention! </font><font style="vertical-align: inherit;">This algorithm is "banter", and was not intended for use in real conditions. </font><font style="vertical-align: inherit;">The author is not responsible for any direct or indirect losses incurred by your spacecraft or other objects using this algorithm.</font></font></h3><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, a little history. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is a well-known fact that our reusable space shuttle Buran was very similar to an American shuttle. And it‚Äôs also known that he flew only once, unlike the American ‚Äúcounterparts‚Äù. But few people know that his only flight was unmanned. He himself took off, he landed and he did all this in very bad weather conditions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
American Shuttles always landed only in manual mode. This was surprising given the fact that computers used to be no more powerful than a calculator. That, in theory, it should not be difficult, thought last night.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But let's get to the point. What is a simulator on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SpaceX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> website </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the start, we see general information that the deviation in all parameters should be within 0.2 meters (20 cm). Given the size of the station and the ship, this is a pretty serious limitation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We start the simulator and see. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gh/tu/qj/ghtuqjki-jnmg4rcgsgbb4-z_7e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Above, to the right and below the central circle is the angular deviation of the ship along three axes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Green - current value. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blue - the speed per second with which it changes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Left offset relative to the gateway in meters. There is no displacement speed ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The controllers at the bottom of the screen are buttons with their duplication on the keyboard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So we‚Äôll start with them the analysis of the program as the least interesting.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The layout of the keyboard buttons. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/mj/f3/tymjf3jo-mvb95qdanuqjfs6wt8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The left block is responsible for the offset relative to the gateway, but the right one for the offset relative to the axes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We write, or find on the network, a code that can emulate keyboard clicks on document. </font><font style="vertical-align: inherit;">In my case, the code looked like this.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">simulateKey</span>(<span class="hljs-params">keyCode, type, modifiers</span>) </span>{
    <span class="hljs-keyword">var</span> evtName = (<span class="hljs-keyword">typeof</span> (type) === <span class="hljs-string">"string"</span>) ? <span class="hljs-string">"key"</span> + type : <span class="hljs-string">"keydown"</span>;
    <span class="hljs-keyword">var</span> modifier = (<span class="hljs-keyword">typeof</span> (modifiers) === <span class="hljs-string">"object"</span>) ? modifier : {};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"HTMLEvents"</span>);<font></font>
    event.initEvent(evtName, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<font></font>
    event.keyCode = keyCode;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> modifiers) {<font></font>
        event[i] = modifiers[i];<font></font>
    }<font></font>
    <span class="hljs-built_in">document</span>.dispatchEvent(event);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyPress</span>(<span class="hljs-params">keyCode</span>) </span>{<font></font>
    simulateKey(keyCode)<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> simulateKey(keyCode, <span class="hljs-string">"up"</span>), <span class="hljs-number">15</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We write the button codes:</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> _accelerator = <span class="hljs-number">69</span>;
<span class="hljs-keyword">let</span> _brake = <span class="hljs-number">81</span>;
<span class="hljs-keyword">let</span> _translateLeft = <span class="hljs-number">65</span>;
<span class="hljs-keyword">let</span> _translateRigth = <span class="hljs-number">68</span>;
<span class="hljs-keyword">let</span> _translateUp = <span class="hljs-number">87</span>;
<span class="hljs-keyword">let</span> _translateDown = <span class="hljs-number">83</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> _left = <span class="hljs-number">37</span>;
<span class="hljs-keyword">let</span> _rigth = <span class="hljs-number">39</span>;
<span class="hljs-keyword">let</span> _up = <span class="hljs-number">38</span>;
<span class="hljs-keyword">let</span> _down = <span class="hljs-number">40</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> _rollRigth = <span class="hljs-number">105</span>;
<span class="hljs-keyword">let</span> _rollLeft = <span class="hljs-number">103</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any control system involves work in a cycle. </font><font style="vertical-align: inherit;">Let's make it the easiest, in increments of 200 milliseconds. </font><font style="vertical-align: inherit;">We‚Äôll organize a counter for one, we‚Äôll still need it.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params"></span>) </span>{<font></font>
<font></font>
    index++;<font></font>
    setTimeout(A, <span class="hljs-number">200</span>);<font></font>
}<font></font>
<font></font>
A();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's go back to the structure of the site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Its interesting feature is that the ISS is drawn on canvas, but the information about the state of our spacecraft is drawn with the usual markup. It feels like the developers of the site assumed that there would be similar enthusiasts who want to "automate" the game and give them such an opportunity ... Or maybe by marking it up, it was stupid, easier to do. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b4/v-/wt/b4v-wtysubcrqaqfrkvfnpf_yjg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And so, let's add a couple more light lines in order to get information about the state of our spacecraft.</font></font><br>
<br>
<pre><code class="javascript hljs">
    <span class="hljs-keyword">let</span> range = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#range .rate"</span>).outerText.split(<span class="hljs-string">' '</span>));<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#y-range .distance"</span>).outerText.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">let</span> zDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#z-range .distance"</span>).outerText.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);<font></font>
<font></font>
    <span class="hljs-keyword">let</span> rollError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#roll .error"</span>).outerText);
    <span class="hljs-keyword">let</span> pitchError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#pitch .error"</span>).outerText);
    <span class="hljs-keyword">let</span> yawError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#yaw .error"</span>).outerText);<font></font>
<font></font>
    <span class="hljs-keyword">let</span> rate = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#rate .rate"</span>).outerText.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, I pulled out not everything. </font><font style="vertical-align: inherit;">I pulled out only the offset values, but I didn‚Äôt take the rate of change of the values, and that's why ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, this is the third iteration of the algorithm. </font><font style="vertical-align: inherit;">At first, it is a simple option, which every 200 milliseconds takes information about the condition of the ship and adjusts it to 0. It </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
looked like this.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (rollError !== -rollSpeed) {
        <span class="hljs-keyword">const</span> rollLimit = (<span class="hljs-built_in">Math</span>.abs(rollError) / <span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; rollError &amp;&amp; rollSpeed &lt; rollLimit) {<font></font>
            keyPress(_rollRigth);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rollError &lt; <span class="hljs-number">-0</span> &amp;&amp; -rollLimit &lt; rollSpeed) {<font></font>
            keyPress(_rollLeft);<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And in fact, he was quite a worker. </font><font style="vertical-align: inherit;">Especially for angular displacements. </font><font style="vertical-align: inherit;">And for the displacement along the axes, I used this option.</font></font><br>
<br>
<pre><code class="javascript hljs">   <span class="hljs-keyword">const</span> zLimit = (<span class="hljs-built_in">Math</span>.abs(yawError) / <span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; zDistance &amp;&amp; zSpeed &lt; zLimit) {<font></font>
            keyPress(_translateDown);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (zDistance &lt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-number">-1</span> &lt; zSpeed) {<font></font>
            keyPress(_translateUp);<font></font>
        }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The speed of the ship's displacement relative to each axis is not displayed, but it is not difficult to calculate.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">carculateSpeed</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> yDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#y-range .distance"</span>).outerText.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">let</span> zDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#z-range .distance"</span>).outerText.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);<font></font>
<font></font>
    ySpeed = yPrev - yDistance;<font></font>
    yPrev = yDistance;<font></font>
<font></font>
    zSpeed = zPrev - zDistance;<font></font>
    zPrev = zDistance;<font></font>
    setTimeout(carculateSpeed, <span class="hljs-number">1000</span>);<font></font>
}<font></font>
carculateSpeed();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And it turned out pretty tolerably. Classic feedback control circuit. And while the ship was at a distance from the ISS, we flew quite smoothly to ourselves [as it seemed to me then]. But problems began near the ship itself. In fact, the ship was very sausage and it was physically impossible to get an accuracy of 0.2 meters. The fact is that the mixing of our ship took place ... let's say in continuous space (with great accuracy), but we saw only tenths of it. And of course, trying to respond to them every 200 milliseconds, we got very strong regulatory actions. We have poked the buttons too many times at the slightest deviation. And the closer to the ship, the stronger the offset values ‚Äã‚Äãstarted to jump and we actually rocked the ship even more ... Increasing the amplitude of its movement ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was necessary somewhere to take the missing accuracy. In the second iteration in solving this problem, I myself tried to calculate already only on the basis of speed displacement. And yes, it seemed to work out pretty well, too, but this did not solve the problem with the movement ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is the essence of the problem of movement? Well, look, we find in outer space and by clicking on the control buttons we give acceleration to the ship in one plane or another. But as soon as we release the button, the movement does not stop. In outer space, due to the vacuum, there is no resistance. And as soon as we gave an impulse (by pressing a button) the ship began to move at this speed ... And it needs to be stopped somehow. Stopping in the simulator is quite easy - you need to give a reverse impulse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But at the second iteration of the solution, the increased accuracy of the error did not give me an answer on how to adjust the speed ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here we needed a ‚Äúcompass‚Äù. The captain of any ship / vessel must calculate the route in advance. If he gives the command to slow down after he enters the port, then he is unlikely to moor jewelry. And we just need this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to calculate the route, captains usually do this with a compass with a discrete state of its tips. And we will do the same. We will calculate the route for a second ahead, which will include five iterations of button presses or not.</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-keyword">if</span> (index % <span class="hljs-number">5</span> === <span class="hljs-number">0</span>) {<font></font>
        calculatePath(roll, rollError);<font></font>
        calculatePath(pitch, pitchError);<font></font>
        calculatePath(yaw, yawError);<font></font>
        calculatePath(y, yDistance);<font></font>
        calculatePath(z, zDistance);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carculatePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">, based on their current deviation value, calculates 5 steps which in theory should reduce this deviation to 0. Not necessarily at this iteration, but each time we should approach the treasured zero in our own more detailed grid.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculatePath</span>(<span class="hljs-params">data, value</span>) </span>{<font></font>
    data.path = [];<font></font>
    <span class="hljs-keyword">if</span> (data.prev === value) {<font></font>
        data.speed = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; value + data.speed * (i + <span class="hljs-number">1</span>)) {<font></font>
            data.speed -= <span class="hljs-number">0.1</span>;<font></font>
            data.path.push(<span class="hljs-number">-1</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value + data.speed * (i + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">-0</span>) {<font></font>
            data.speed += <span class="hljs-number">0.1</span>;<font></font>
            data.path.push(<span class="hljs-number">1</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; data.speed) {<font></font>
                data.speed -= <span class="hljs-number">0.1</span>;<font></font>
                data.path.push(<span class="hljs-number">-1</span>);<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.speed &lt; <span class="hljs-number">0</span>) {<font></font>
                data.speed += <span class="hljs-number">0.1</span>;<font></font>
                data.path.push(<span class="hljs-number">1</span>);<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                data.path.push(<span class="hljs-number">0</span>);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            data.path.push(<span class="hljs-number">0</span>);<font></font>
        }<font></font>
    }<font></font>
    data.prev = value;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all, we calculate the route every "equal" second </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(index% 5 === 0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and now you just need to go this course.</font></font><br>
<br>
<pre><code class="javascript hljs">
 <span class="hljs-keyword">let</span> rollStep = roll.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; rollStep) {<font></font>
        keyPress(_rollLeft);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rollStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_rollRigth);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> pitchStep = pitch.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; pitchStep) {<font></font>
        keyPress(_up);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pitchStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_down);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yawStep = yaw.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; yawStep) {<font></font>
        keyPress(_left);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (yawStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_rigth);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yStep = y.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; yStep) {<font></font>
        keyPress(_translateRigth);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (yStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_translateLeft);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> zStep = z.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; zStep) {<font></font>
        keyPress(_translateUp);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (zStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_translateDown);<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only calculation that has survived since the first iteration is the approach to the ship. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all, okay, we are moving forward at a relatively low speed</font></font><br>
<br>
<pre><code class="javascript hljs">    <span class="hljs-keyword">const</span> rangeLimit = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max((<span class="hljs-built_in">Math</span>.abs(range) / <span class="hljs-number">100</span>), <span class="hljs-number">0.05</span>), <span class="hljs-number">2</span>);
    <span class="hljs-keyword">if</span> (-rate &lt; rangeLimit) {<font></font>
        keyPress(_accelerator);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (-rangeLimit &lt; -rate) {<font></font>
        keyPress(_brake);<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the spoiler is the full code. </font><font style="vertical-align: inherit;">You can check its performance yourself on the website </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iss-sim.spacex.com</font></font></a><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full code</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">simulateKey</span>(<span class="hljs-params">keyCode, type, modifiers</span>) </span>{
    <span class="hljs-keyword">var</span> evtName = (<span class="hljs-keyword">typeof</span> (type) === <span class="hljs-string">"string"</span>) ? <span class="hljs-string">"key"</span> + type : <span class="hljs-string">"keydown"</span>;
    <span class="hljs-keyword">var</span> modifier = (<span class="hljs-keyword">typeof</span> (modifiers) === <span class="hljs-string">"object"</span>) ? modifier : {};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"HTMLEvents"</span>);<font></font>
    event.initEvent(evtName, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<font></font>
    event.keyCode = keyCode;<font></font>
<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> modifiers) {<font></font>
        event[i] = modifiers[i];<font></font>
    }<font></font>
    <span class="hljs-built_in">document</span>.dispatchEvent(event);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyPress</span>(<span class="hljs-params">keyCode</span>) </span>{<font></font>
    simulateKey(keyCode)<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> simulateKey(keyCode, <span class="hljs-string">"up"</span>), <span class="hljs-number">15</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">let</span> _accelerator = <span class="hljs-number">69</span>;
<span class="hljs-keyword">let</span> _brake = <span class="hljs-number">81</span>;
<span class="hljs-keyword">let</span> _translateLeft = <span class="hljs-number">65</span>;
<span class="hljs-keyword">let</span> _translateRigth = <span class="hljs-number">68</span>;
<span class="hljs-keyword">let</span> _translateUp = <span class="hljs-number">87</span>;
<span class="hljs-keyword">let</span> _translateDown = <span class="hljs-number">83</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> _left = <span class="hljs-number">37</span>;
<span class="hljs-keyword">let</span> _rigth = <span class="hljs-number">39</span>;
<span class="hljs-keyword">let</span> _up = <span class="hljs-number">38</span>;
<span class="hljs-keyword">let</span> _down = <span class="hljs-number">40</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> _rollRigth = <span class="hljs-number">105</span>;
<span class="hljs-keyword">let</span> _rollLeft = <span class="hljs-number">103</span>;<font></font>
<font></font>
<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<font></font>
<font></font>
roll = {<font></font>
    <span class="hljs-attr">path</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    <span class="hljs-attr">prev</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>,<font></font>
}<font></font>
<font></font>
pitch = {<font></font>
    <span class="hljs-attr">path</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    <span class="hljs-attr">prev</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>,<font></font>
}<font></font>
<font></font>
yaw = {<font></font>
    <span class="hljs-attr">path</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    <span class="hljs-attr">prev</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>,<font></font>
}<font></font>
<font></font>
z = {<font></font>
    <span class="hljs-attr">path</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    <span class="hljs-attr">prev</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>,<font></font>
}<font></font>
<font></font>
y = {<font></font>
    <span class="hljs-attr">path</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    <span class="hljs-attr">prev</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>,<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculatePath</span>(<span class="hljs-params">data, value</span>) </span>{<font></font>
    data.path = [];<font></font>
    <span class="hljs-keyword">if</span> (data.prev === value) {<font></font>
        data.speed = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; value + data.speed * (i + <span class="hljs-number">1</span>)) {<font></font>
            data.speed -= <span class="hljs-number">0.1</span>;<font></font>
            data.path.push(<span class="hljs-number">-1</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value + data.speed * (i + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">-0</span>) {<font></font>
            data.speed += <span class="hljs-number">0.1</span>;<font></font>
            data.path.push(<span class="hljs-number">1</span>);<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; data.speed) {<font></font>
                data.speed -= <span class="hljs-number">0.1</span>;<font></font>
                data.path.push(<span class="hljs-number">-1</span>);<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.speed &lt; <span class="hljs-number">0</span>) {<font></font>
                data.speed += <span class="hljs-number">0.1</span>;<font></font>
                data.path.push(<span class="hljs-number">1</span>);<font></font>
            } <span class="hljs-keyword">else</span> {<font></font>
                data.path.push(<span class="hljs-number">0</span>);<font></font>
            }<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            data.path.push(<span class="hljs-number">0</span>);<font></font>
        }<font></font>
    }<font></font>
    data.prev = value;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> range = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#range .rate"</span>).textContent.split(<span class="hljs-string">' '</span>));<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#y-range .distance"</span>).textContent.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">let</span> zDistance = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#z-range .distance"</span>).textContent.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);<font></font>
<font></font>
    <span class="hljs-keyword">let</span> rollError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#roll .error"</span>).textContent);
    <span class="hljs-keyword">let</span> pitchError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#pitch .error"</span>).textContent);
    <span class="hljs-keyword">let</span> yawError = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#yaw .error"</span>).textContent);<font></font>
<font></font>
    <span class="hljs-keyword">let</span> rate = <span class="hljs-built_in">parseFloat</span>($(<span class="hljs-string">"#rate .rate"</span>).textContent.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (index % <span class="hljs-number">5</span> === <span class="hljs-number">0</span>) {<font></font>
        calculatePath(roll, rollError);<font></font>
        calculatePath(pitch, pitchError);<font></font>
        calculatePath(yaw, yawError);<font></font>
        calculatePath(y, yDistance);<font></font>
        calculatePath(z, zDistance);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> rollStep = roll.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; rollStep) {<font></font>
        keyPress(_rollLeft);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rollStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_rollRigth);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> pitchStep = pitch.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; pitchStep) {<font></font>
        keyPress(_up);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pitchStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_down);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yawStep = yaw.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; yawStep) {<font></font>
        keyPress(_left);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (yawStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_rigth);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> yStep = y.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; yStep) {<font></font>
        keyPress(_translateRigth);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (yStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_translateLeft);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">let</span> zStep = z.path[index % <span class="hljs-number">5</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt; zStep) {<font></font>
        keyPress(_translateUp);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (zStep &lt; <span class="hljs-number">0</span>) {<font></font>
        keyPress(_translateDown);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> rangeLimit = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max((<span class="hljs-built_in">Math</span>.abs(range) / <span class="hljs-number">100</span>), <span class="hljs-number">0.05</span>), <span class="hljs-number">2</span>);
    <span class="hljs-keyword">if</span> (-rate &lt; rangeLimit) {<font></font>
        keyPress(_accelerator);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (-rangeLimit &lt; -rate) {<font></font>
        keyPress(_brake);<font></font>
    }<font></font>
<font></font>
    index++;<font></font>
    setTimeout(A, <span class="hljs-number">200</span>);<font></font>
}<font></font>
<font></font>
A();</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actually everything. </font><font style="vertical-align: inherit;">Thank you all for reading :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xa/xl/zi/xaxlziqi_qis1rowni6attl0tro.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, I did a little highpan and poked fun. </font><font style="vertical-align: inherit;">Do not take the article seriously, I just wanted to feel like an astronaut [or space flyer], like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yuri Gagarin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... Although this is more likely the engineering work of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Pavlovich Korolev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , who unfortunately never visited the space he dreamed about ...</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502054/index.html">Convolutional neural network and its integration in iOS (part 2)</a></li>
<li><a href="../en502056/index.html">How to Build a Smart Home and Not Go Crazy</a></li>
<li><a href="../en502066/index.html">Simple console commands that everyone should know</a></li>
<li><a href="../en502068/index.html">110 volts on your computer</a></li>
<li><a href="../en502070/index.html">The history of Pentax (article plus video)</a></li>
<li><a href="../en502076/index.html">Trolley Robot 2.0. Part 1. Autonomous navigation of a home robot based on ROS</a></li>
<li><a href="../en502080/index.html">Kanban method: Example PNZ No. 1, the measurement-study process in a startup</a></li>
<li><a href="../en502084/index.html">Checking the portal of regional public services under load through puppeteer</a></li>
<li><a href="../en502086/index.html">Setting up Minio so that the user can only work with his bucket</a></li>
<li><a href="../en502088/index.html">A tale of excess and lost time. According to py3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>