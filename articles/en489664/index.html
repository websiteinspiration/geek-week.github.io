<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëé ü§õüèº üßñüèΩ NPS, conveyor, automatic computing and again ... coroutines üêô üë¶üèª üßí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Again about coroutines
 In my previous article, dear Habr, I only touched on the problems of knowledge of modern programming. The ensuing discussio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>NPS, conveyor, automatic computing and again ... coroutines</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489664/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Again about coroutines</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my previous article, dear Habr, I only touched on the problems of knowledge of modern programming. The ensuing discussion only confirmed the spontaneous fears that arose: the notorious ‚Äútheoretical foundations‚Äù immediately became a source of disagreement. The fact that they (disagreements) might not exist or they would be of a different nature does not seem to bother the bulk of "real" programmers. Moreover, perhaps it is not particularly interesting, because programmers are stimulated mainly by one interest - code, code, and only code. Well, almost "as the doctor prescribed" [1] ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Touching on the subject of corutin in my article and comments, I did not at all dream about how much they are in the ‚Äúcurrent‚Äù trend. Amazed, however, the "backing tracks" of my comments with or without. For what, they say, programmers? However, it seems to me that everything became clear after reading the article about the newly approved C ++ 20 and the prospects for its further development [2]. To my amazement, it turned out that coroutines are in the forefront of the present and future innovations of my beloved C ++ (see also the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CppCoro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, tell me, is it possible to take seriously and / or calmly a brow who, it seems, imagines himself to be anyone? Hit what is called! :(</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The background of my acquaintance with coroutines (I will call them all the same in the old way) is as follows. There was a need to parallelize, but something suitable was not. I had to invent, studying the available literature. As a result, coroutines were rejected immediately, and threads later. The reason is that both of them are structural methods of parallelizing programs, and not computational models. But I didn‚Äôt want that.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The description of what I finally came to is given in my previous articles on Habr√©. This conversation is far from over, but for now, how have coroutines been remembered, since they have already become the subject of such a heated discussion? The only thing is the ‚Äúpoints‚Äù of stopping / switching processes. Unlike threads, they made it possible to predict the behavior of processes that simulate parallel operation. In theory, this also reduced system losses for the implementation of parallelism. But, nevertheless, in sum, all this fundamentally something did not change. And since the ‚Äúdots‚Äù were simply imitated by the states of the automaton programming (AP) model, my acquaintance with coroutines was completed for seven.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But I could not assume that the incarnation of coroutines, now called coroutines, would so overtake me. From this, and mine, possibly unjustified ‚Äúattacks‚Äù on them, for which I absolutely sincerely apologize to the apologists of Corutin. Probably hurried. Nevertheless, the newly discovered circumstances did not affect my attitude to coroutines. For the new code, for reasoning in their favor, I never saw anything fundamentally new. However, I want to note that coroutines are nevertheless closer and clearer to me than threads, because contain, as I said above, an analog of the set of internal states of finite automata (CA).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, stop repenting. </font><font style="vertical-align: inherit;">Let us return to automata that completely cover the ‚Äúcoroutine theme‚Äù. </font><font style="vertical-align: inherit;">Next, I will present the capabilities of the AP associated with the modeling of parallel models that are quite well-known in theory and practice - tiered parallel and pipeline models of algorithms. </font><font style="vertical-align: inherit;">Their automatic solution, in my opinion, looks more visual, natural and simple than it would be based on the same coroutines.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Tier-parallel and pipeline forms of algorithms</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose you need to calculate the expression: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y = (((a + b) * (c + d)) + ((e * f) + (q + h))). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, let the operation execution time be defined, defined in arbitrary units of discrete time ‚Äî measures where addition takes 1 measure, and multiplication takes 5 measures. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the logic of calculating the expression, the execution time of the operations, and the number of intermediate variables, in one embodiment, the distribution of operations by tiers and the number of tiers itself can look, for example, as follows: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t1 = a + b; t2 = c + d; t3 = e * f; t4 = q + h; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tier0: t1; t2; t3; t4; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tier1: t5 = t1 * t2; t6 = t3 + t4; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tier2: t7 = t5 + t6;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Graphically this is shown in fig. 1, which shows two options for the distribution of calculations in tiers and affixed calculation time in ticks. Their comparison shows that in the general case, a decrease in the number of tiers does not automatically mean a reduction in the computation time. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/z8/3v/mnz83viq523btod82i4vgotp5yi.jpeg" alt="image"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 1. Tier-parallel form of calculating an expression.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
But one more option can be considered, which is already represented by a multitude of tier-parallel forms that solve a single problem. In fig. Figure 2 shows just such a solution. The computation time has decreased. Parallelization of NPS can also be attractive taking into account their execution on multiprocessor systems. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/xq/kg/abxqkgiggx-qyvkm8jra-bo0xro.jpeg" alt="image"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 2. Parallel NPS</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you rotate the JPF graph, then you can get the scheme of pipeline computing. </font><font style="vertical-align: inherit;">In it, the elements of the conveyor will be tiers, the operating time of which is reduced to the slowest tier. </font><font style="vertical-align: inherit;">In fig. </font><font style="vertical-align: inherit;">Figure 3 shows such a pipelining scheme of the original expression. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/um/ah/1rumah082yimeiqe0csndeauofy.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. </font><font style="vertical-align: inherit;">3. Pipeline model</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Since for this example the discrete conveyor time is 5 clock cycles, the calculation time will be even worse than the worst version of the NPS. </font><font style="vertical-align: inherit;">Advantages of the pipeline only in the continuity of the calculations.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. An automaton model for calculating expressions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you remove the restrictions on the synchronization of operations, then the NPS can be turned into a circuit that will generate the result as a pipeline, but without restrictions related to the sequence and time of operations. Such a logical network diagram with a demonstration of the addition operation (the implementation of multiplication is similar) in the form of a spacecraft network model is shown in Fig. 4. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/-4/-c/tf-4-cwnottehdr8cownolbacrm.jpeg" alt="image"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4. Calculations of expressions based on a network of finite state machines</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can see that the network will constantly produce a result with a delay of 7 clock cycles, i.e. as well as the fastest NPS model (Fig. 7). Its disadvantages include output instability associated with data races. For example, a simultaneous change in the value of variables in pairs of variables g, h and e, f will lead to a change in t4 at the next clock cycle, after one clock cycle to a change in variable t6 and another clock cycle to the output variable t7 (see Fig. 1 and Fig. 4) . At the same time, after 5 clock cycles, the variable t3 will change, which will lead to a change and the output of the finally established values ‚Äã‚Äãof the variables t6, t7. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ju/yk/iz/juykiznycz_4f_o-fl62ce-snee.jpeg" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5. Modeling of NPS with a network of automata</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fig. </font><font style="vertical-align: inherit;">Figure 5 shows how the introduction of an additional block makes it possible to simulate the computation of NPS. </font><font style="vertical-align: inherit;">Similarly, you can simulate the model of pipelined computing, as well as block the change in output associated with data races.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Conclusions </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would be strange to doubt that the above ‚Äúpictures‚Äù cannot be realized using coroutines. That's just, to be honest, I would not want to do this. For me, it‚Äôs much easier to create automata that implement the necessary operations, and then, changing only their number and the relationships between them, implement the calculation of any expression. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will not tire of repeating that I am attracted to the concept of visual programming implemented in the Stateflow package in MATLAB. Here you can also create the necessary automaton operations, and then, using them as standard blocks, ‚Äúdraw‚Äù a calculation scheme for any expression, which after compilation will turn into a working program (for example, in the same C ++). At the same time, during the design process, visualization and debugging tools will be available that are specific to the automated programming technology.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
True, the question may arise - why permanent links to a certain unknown environment of the CPSU, if there is Stateflow? But we‚Äôll talk about this separately yet ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is an ungrateful thing to make predictions, but nevertheless, based on my experience, I will express an seditious thought: as high-level languages ‚Äã‚Äãused to negate assembly language programming, so visual programming sooner or later and not less crowding out programming in high-level languages. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Literature</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1. Programmers, let's study the sources of classical programs. [Electronic resource], Access mode: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/488808</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> free. Yaz. Russian (date of treatment 02.22.2020). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. C ++ 20 approved! What to expect and what to prepare for C ++ 23 developers. [Electronic resource], Access mode:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/company/yandex/blog/488588</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> free. </font><font style="vertical-align: inherit;">Yaz. </font><font style="vertical-align: inherit;">Russian </font><font style="vertical-align: inherit;">(date of treatment 02.20.2020).</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489650/index.html">Automation of a journalist. Part 1: Tasks and Calendars</a></li>
<li><a href="../en489652/index.html">The digest of fresh materials from the world of the front-end for the last week No. 403 (February 17 - 23, 2020)</a></li>
<li><a href="../en489656/index.html">Bad experience creating and administering a scientific journal site</a></li>
<li><a href="../en489660/index.html">Why NoSQL Databases Are a Bad Solution for Modern Applications</a></li>
<li><a href="../en489662/index.html">PHP Digest No. 174 (February 10 - 24, 2020)</a></li>
<li><a href="../en489666/index.html">Overloading in C ++. Part II Operator Overload</a></li>
<li><a href="../en489668/index.html">CPU limits and aggressive throttling in Kubernetes</a></li>
<li><a href="../en489672/index.html">We revive the hexapod. Part two</a></li>
<li><a href="../en489674/index.html">Angular: a clear introduction to NGRX</a></li>
<li><a href="../en489676/index.html">We make a clone of the food delivery service using Nuxt.js, GraphQL, Strapi and Stripe. Part 1/7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>