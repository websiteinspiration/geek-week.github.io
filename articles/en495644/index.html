<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïù üö≠ ‚úñÔ∏è TS Total Sight. Event collection, incident analysis, and threat response automation tool üç∂ üõ∂ üå¨Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, in past articles we got to know the work of ELK Stack. And now we will discuss the possibilities that can be realized by an informatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TS Total Sight. Event collection, incident analysis, and threat response automation tool</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tssolution/blog/495644/"><img src="https://habrastorage.org/webt/rc/xp/9w/rcxp9w0twqz6ejzwb65i2gvgs5c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Good afternoon, in past articles we got to know the work of ELK Stack. And now we will discuss the possibilities that can be realized by an information security specialist in using these systems. What logs can and should be made in elasticsearch. Let's consider what statistics can be obtained by setting up dashboards and whether there is a profit in this. How it is possible to implement automation of information security processes using the ELK stack. We compose the architecture of the system. In sum, the implementation of all the functionality is a very big and difficult task, so the solution was singled out in a separate name - TS Total Sight.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, solutions consolidating and analyzing information security incidents in one logical place are gaining popularity. As a result, a specialist receives statistics and a front line of actions to improve the security status of an organization. </font><font style="vertical-align: inherit;">We set this task for ourselves in using the ELK stack, as a result we allocated the main functionality in 4 sections:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statistics and visualization;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS incident detection;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prioritization of incidents;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automation of information security processes.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we consider in more detail separately.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Incident Detection</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main task in using elasticsearch in our case is to collect only information security incidents. </font><font style="vertical-align: inherit;">It is possible to collect information security incidents from any means of protection if they support at least some modes of log forwarding, the standard is syslog or scp saving to a file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can give standard examples of security features and not only where to configure log forwarding:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Any means of NGFW (Check Point, Fortinet);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Any vulnerability scanners (PT Scanner, OpenVas);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Application Firewall (PT AF);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netflow analyzers (Flowmon, Cisco StealthWatch);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AD server.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After setting up log forwarding and configuration files in Logstash, you can correlate and compare with incidents coming from various security tools. To do this, it is convenient to use indexes in which we will store all incidents related to a specific device. In other words, one index is all incidents to one device. There are 2 ways to implement such a distribution. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first option</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is to configure the Logstash config. To do this, it is necessary to duplicate the log for certain fields into a separate unit with another type. And then later use this type. In the example, logs are cloned using the Check Point IPS firewall blade.</font></font><br>
<br>
<pre><code class="javascript hljs">filter {
    <span class="hljs-keyword">if</span> [product] == <span class="hljs-string">"SmartDefense"</span> {<font></font>
        clone {<font></font>
	    clones =&gt; [<span class="hljs-string">"CloneSmartDefense"</span>]<font></font>
	    add_field =&gt; {<span class="hljs-string">"system"</span> =&gt; <span class="hljs-string">"checkpoint"</span>}<font></font>
	}<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to save such events in a separate index, depending on the log fields, for example, such as Destination IP attack signatures. </font><font style="vertical-align: inherit;">You can use a similar construction:</font></font><br>
<br>
<pre><code class="javascript hljs">output {
    <span class="hljs-keyword">if</span> [type] == <span class="hljs-string">"CloneSmartDefense"</span>{<font></font>
    {<font></font>
         elasticsearch {<font></font>
    	 hosts =&gt; [<span class="hljs-string">",&lt;IP_address_elasticsearch&gt;:9200"</span>]<font></font>
    	 index =&gt; <span class="hljs-string">"smartdefense-%{dst}"</span>
    	 user =&gt; <span class="hljs-string">"admin"</span>
    	 password =&gt; <span class="hljs-string">"password"</span><font></font>
  	 }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And in this way, you can save all incidents to the index, for example, by IP address, or by the domain name of the machine. </font><font style="vertical-align: inherit;">In this case, we save in the index </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúsmartdefense -% {dst}‚Äù</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , at the IP address of the signature. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, different products will have different fields for logs, which will lead to chaos and unnecessary memory consumption. </font><font style="vertical-align: inherit;">And here it will be necessary either carefully in the Logstash config settings to replace the fields with previously conceived ones, which will be the same for all types of incidents, which is also a difficult task. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Second implementation option</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is writing a script or process that will access the elastic database in real time, pull out the necessary incidents, and save it to a new index, this is a difficult task, but it allows you to work with the logs as you please, and correlate directly with incidents from others security features. This option allows you to configure the work with logs as useful as possible for your case with maximum flexibility, but here there is a problem in finding a specialist who can implement this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And of course, the most important question, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">but what can be generally traced and discovered</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There may be several options, and depending on what security features are used in your infrastructure, a couple of examples:</font></font><br>
<br>
<ol>
<li>                NGFW   .     IPS    .     (  )  IPS,             ‚Äî     ,          . </li>
<li>        ,     .</li>
<li>           .</li>
</ol><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most obvious and understandable reason for which you need ELK Stack is the storage and visualization of logs, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it was shown how you can create logs from various devices using Logstash. </font><font style="vertical-align: inherit;">After the logs go to Elasticsearch, you can configure the dashboards, which were also mentioned </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with the necessary information and statistics for you through visualization. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examples:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threat Prevention events dashboard with the most critical events. </font><font style="vertical-align: inherit;">Here you can reflect which IPS signatures were detected, where they come from geographically.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/nm/0m/wn/nm0mwngtnjs-db8_6199sxqerze.png"></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dashboard on the use of the most critical applications for which information can merge.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/u7/_j/uv/u7_juvhviuwb8m8rzz1ueggcg28.png"></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scan results from any security scanner.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/8z/v4/6o/8zv46okroywtqej_myiybzgr4us.png"></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logs with Active Directory by user.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/pj/ye/4a/pjye4andkxdupw_w7v7yxiupas4.png"></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPN connection dashboard.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this case, if you configure dashboards to update every few seconds, you can get a fairly convenient system for monitoring events in real time, which can then be used to quickly respond to IS incidents if you put dashboards on a separate screen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incident prioritization</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In conditions of large infrastructure, the number of incidents can be off the charts, and specialists will not be able to manage all incidents on time. </font><font style="vertical-align: inherit;">In this case, it is necessary first of all to single out those incidents that pose a great threat. </font><font style="vertical-align: inherit;">Therefore, the system must prioritize incidents according to their danger in relation to your infrastructure. </font><font style="vertical-align: inherit;">It is advisable to set up an alert in the mail or telegram of event data. </font><font style="vertical-align: inherit;">Prioritization can be implemented using regular Kibana tools by setting visualization. </font><font style="vertical-align: inherit;">But with a notification it‚Äôs harder, by default this functionality is not included in the base version of Elasticsearch, only in a paid one. </font><font style="vertical-align: inherit;">Therefore, either buy a paid version, or again, write the process yourself which will notify specialists in real time by mail or telegram.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automation of information security processes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And one of the most interesting parts is the automation of actions on information security incidents. Previously, we implemented this functionality for Splunk, a little more detail, you can read in this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The basic idea is that the IPS policy is never tested or optimized, although in some cases it is an essential part of information security processes. For example, a year after the implementation of NGFW and the absence of actions to optimize IPS, you will accumulate a large number of signatures with the Detect action, which will not be blocked, which greatly reduces the state of information security in the organization. The following are some examples of what can be automated:</font></font><br>
<br>
<ol>
<li>  IPS  Detect  Prevent.       Prevent,    ,      .       .    ,   NGFW   REST API.      ,      Elastcisearch   API     NGFW.</li>
<li>   IP         ,         IP    Firewall.      REST API.</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run a host scan with a vulnerability scanner if this host has a large number of signatures via IPS or other security tools, if it is OpenVas, then you can write a script that will connect via ssh to the security scanner and start scanning.</font></font></li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/ia/cx/-s/iacx-skj-1bfyhxfkha2etwnaoc.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TS Total Sight</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In total, the implementation of all the functionality is a very big and difficult task. </font><font style="vertical-align: inherit;">Without programming skills, you can configure the minimum functionality, which may be enough for use in the product. </font><font style="vertical-align: inherit;">But if you are interested in all the functionality, you can pay attention to TS Total Sight. </font><font style="vertical-align: inherit;">You can find more details on our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As a result, the whole scheme of work and architecture will look like this:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/ou/j1/j0ouj15a6otjzkmagoq4xhgy4_o.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We examined what can be implemented using ELK Stack. </font><font style="vertical-align: inherit;">In subsequent articles, we will separately consider in more detail the functionality of TS Total Sight! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So stay tuned ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facebook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TS Solution Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Zen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495624/index.html">Why the Xbox Series X will be the main purchase of 2020</a></li>
<li><a href="../en495634/index.html">Everyone does it: why employees are the main threat to corporate information security and how to deal with it</a></li>
<li><a href="../en495636/index.html">Creating Python bindings for C / C ++ libraries using SIP. Part 2</a></li>
<li><a href="../en495638/index.html">Comma in English: 5 rules and top 3 errors</a></li>
<li><a href="../en495642/index.html">Start collecting errors in copy functions</a></li>
<li><a href="../en495646/index.html">What non-stressful podcasts to listen to on the weekend</a></li>
<li><a href="../en495658/index.html">Where to get audio for machine learning: a selection of open libraries licensed under Creative Commons</a></li>
<li><a href="../en495660/index.html">NVMe over Fiber Channel. What is it and where is it needed?</a></li>
<li><a href="../en495662/index.html">Protecting and Hacking the Xbox 360 (Part 2)</a></li>
<li><a href="../en495670/index.html">Migrating from a seamless Data Lake to a distributed Data Mesh</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>