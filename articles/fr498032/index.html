<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≥ üòÉ üé∂ Calcul rapide de formules √† partir d'Excel en C # üì∞ üëäüèª üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä quelle fr√©quence apprenez-vous des clients qu'ils enverront des donn√©es √† Excel ou vous demanderont d'importer ou de t√©l√©charger dans un format comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Calcul rapide de formules √† partir d'Excel en C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/498032/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä quelle fr√©quence apprenez-vous des clients qu'ils enverront des donn√©es √† Excel ou vous demanderont d'importer ou de t√©l√©charger dans un format compatible avec Excel? </font><font style="vertical-align: inherit;">Je suis s√ªr que dans la plupart des domaines, Excel est l'un des outils les plus populaires, puissants et √† la fois simples et pratiques. </font><font style="vertical-align: inherit;">Mais le point le plus probl√©matique est toujours l'int√©gration de ces donn√©es avec divers syst√®mes automatis√©s. </font><font style="vertical-align: inherit;">Notre √©quipe a √©t√© invit√©e √† envisager la possibilit√© d'effectuer des calculs de donn√©es √† l'aide des param√®tres d'un fichier Excel personnalis√©.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/to/wx/8gtowxbs0dnpmjvr59epns8b0sq.jpeg" alt="Calcul rapide de formules √† partir d'Excel en C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous devez choisir une biblioth√®que productive pour travailler avec des fichiers Excel ou si vous cherchez une solution pour calculer des donn√©es financi√®res complexes (et pas seulement) avec un outil pratique pour g√©rer et visualiser des formules hors de la bo√Æte, bienvenue √† cat.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En √©tudiant les exigences d'un nouveau projet dans l'entreprise, nous avons trouv√© un point tr√®s int√©ressant: ¬´La solution d√©velopp√©e devrait √™tre capable de calculer le co√ªt du produit (√† savoir le balcon) lors du changement de configuration et d'afficher instantan√©ment le nouveau co√ªt sur l'interface. Il est n√©cessaire de permettre de t√©l√©charger un fichier Excel avec toutes les fonctions de calcul et les listes de prix des composants. ¬ª Le client avait besoin de d√©velopper un portail pour concevoir la configuration des balcons en fonction des tailles, des formes, des types de vitrage et des mat√©riaux utilis√©s, des types de fixations, ainsi que de nombreux autres param√®tres connexes qui sont utilis√©s pour calculer le co√ªt exact de production et les indicateurs de fiabilit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous formalisons les exigences d'entr√©e afin qu'il soit plus facile de comprendre dans quel contexte il √©tait n√©cessaire de r√©soudre le probl√®me:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calcul rapide des prix sur l'interface lors du changement des param√®tres du balcon;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calcul rapide des donn√©es de conception, y compris de nombreuses configurations diff√©rentes de balcons et offres individuelles, fournies par un fichier de calcul s√©par√©;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä long terme - le d√©veloppement de fonctionnalit√©s √† l'aide de diverses op√©rations consommatrices de ressources (t√¢ches d'optimisation des param√®tres, etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout cela est sur un serveur distant avec sortie via API, car </font><font style="vertical-align: inherit;">Toutes les formules sont la propri√©t√© intellectuelle du client et ne doivent pas √™tre visibles par des tiers;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux de donn√©es d'entr√©e en pointe: l'utilisateur peut modifier fr√©quemment et rapidement les param√®tres pour s√©lectionner la configuration du produit en fonction de ses besoins.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble tr√®s inhabituel et super tentant, commen√ßons!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solutions cl√© en main et pr√©paration des donn√©es</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toute recherche pour r√©soudre des probl√®mes complexes commence par la navigation sur StackOverflow, GitHub et de nombreux forums √† la recherche de solutions pr√™tes √† l'emploi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plusieurs solutions pr√™tes √† l'emploi ont √©t√© s√©lectionn√©es qui prenaient en charge la lecture des donn√©es √† partir de fichiers Excel, ainsi que la possibilit√© d'effectuer des calculs bas√©s sur des formules sp√©cifi√©es dans la biblioth√®que. </font><font style="vertical-align: inherit;">Parmi ces biblioth√®ques, il existe √† la fois des solutions totalement gratuites et des d√©veloppements commerciaux.&nbsp;</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioth√®que</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licence</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/JanKallman/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licence publique g√©n√©rale GNU Library&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/EPPlusSoftware/EPPlus/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Licence non commerciale Polyform 1.0.0 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.epplussoftware.com/LicenseOverview</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )&nbsp;</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi</font></font></a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/tonyqus/npoi/wiki</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache License 2.0</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fl√®che</font></font></strong></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.e-iceblue.com/Introduce/excel-for-net-introduce.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.e-iceblue.com/Tutorials/Spire.XLS/Spire.XLS-Program-Guide/Spire.XLS-Program-Guide-Content.html</a></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.e-iceblue.com/Tutorials/Licensing/License-Agreement.html</a>&nbsp;</td>
</tr>
<tr>
<td><strong>Excel Interop</strong><i>(Microsoft.Office.Interop.Excel)</i></td>
<td>n/a</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docs.microsoft.com/ru-ru/dotnet/api/microsoft.office.interop.excel._workbook?view=excel-pia</a></td>
<td><i>  Excel     </i></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©tape suivante consiste √† √©crire des tests de charge et √† mesurer le temps d'ex√©cution de chaque biblioth√®que. Pour ce faire, pr√©parez les donn√©es de test. Nous cr√©ons un nouveau fichier Excel, d√©finissons 10 cellules pour les param√®tres d'entr√©e et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formule </font><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rappelez-vous ce moment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) pour obtenir un r√©sultat qui utilise tous les param√®tres d'entr√©e. Dans la formule, nous essayons d'utiliser toutes les fonctions math√©matiques possibles de diverses complexit√© de calcul et de les combiner de mani√®re d√©licate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que c'est aussi de l'argent (le co√ªt du produit), il est important de regarder l'exactitude des r√©sultats. Dans ce cas, nous prendrons les valeurs r√©sultantes obtenues √† l'aide d' </font><strong><font style="vertical-align: inherit;">Excel Interop</font></strong><font style="vertical-align: inherit;"> comme r√©f√©rence</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parce que Les donn√©es ainsi obtenues sont calcul√©es via le noyau Excel et correspondent aux valeurs que les clients voient lors du d√©veloppement de formules et du calcul manuel des co√ªts.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme runtime de r√©f√©rence, nous utiliserons du code natif √©crit manuellement en C # pur pour afficher la m√™me formule √©crite dans Excel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formule d'essai initiale traduite:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous formons un flux de donn√©es d'entr√©e al√©atoires pour N it√©rations (dans ce cas, nous utilisons 10 000 vecteurs). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons les calculs pour chaque vecteur de param√®tres d'entr√©e sur l'ensemble du flux, obtenons les r√©sultats et mesurons le temps d'initialisation de la biblioth√®que et le calcul g√©n√©ral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour comparer la pr√©cision des r√©sultats, nous utilisons deux indicateurs - l'√©cart type et le pourcentage de valeurs correspondantes avec un certain degr√© de pr√©cision epsilon. Si vous g√©n√©rez au hasard une liste de valeurs d'entr√©e avec un point flottant apr√®s le point d√©cimal, vous devez d√©terminer la pr√©cision des param√®tres d'entr√©e - cela vous permettra d'obtenir les r√©sultats corrects. Sinon, les nombres al√©atoires peuvent avoir une grande diff√©rence d'ordres de grandeur - cela peut grandement affecter la pr√©cision des r√©sultats et affecter l'estimation de l'erreur du r√©sultat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que Initialement, nous supposons qu'il est n√©cessaire de fonctionner avec des valeurs constantes du co√ªt des mat√©riaux, ainsi qu'avec certaines constantes de diff√©rents domaines de connaissance, nous pouvons accepter que tous les param√®tres d'entr√©e auront des valeurs pr√©cises √† 3 d√©cimales pr√®s. Id√©alement, vous devez sp√©cifier une plage de valeurs valide pour chacun des param√®tres et les utiliser uniquement pour g√©n√©rer des valeurs al√©atoires, mais puisque la formule de test a √©t√© compil√©e au hasard sans aucune justification math√©matique et physique, il n'est donc pas possible de calculer une telle plage de valeurs pour les 10 param√®tres dans un d√©lai raisonnable. Par cons√©quent, dans les calculs, il est parfois possible d'obtenir une erreur de calcul. Nous excluons ces vecteurs de donn√©es d'entr√©e d√©j√† au moment du calcul pour les indicateurs de pr√©cision,mais nous consid√©rerons ces erreurs comme une caract√©ristique distincte.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture de test&nbsp;</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour chaque biblioth√®que distincte, sa propre classe a √©t√© cr√©√©e qui impl√©mente une interface </font></font><code>ITestExecutor </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui comprend 3 m√©thodes - </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Execute </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">public interface ITestExecutor<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void SetUp();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//   ,           <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;double Execute(double[] p);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//    ,      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;void TearDown();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©thodes </font></font><code>SetUp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>TearDown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√©es une seule fois dans le processus de test de la biblioth√®que et ne sont pas prises en compte lors de la mesure des calculs de temps sur l'ensemble des donn√©es d'entr√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, l'algorithme de test se r√©sumait √† ce qui suit:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©paration des donn√©es (nous formons un flux de vecteurs d'entr√©e d'une pr√©cision donn√©e);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allocation de m√©moire pour les donn√©es r√©sultantes (un tableau de r√©sultats pour chaque biblioth√®que, un tableau avec le nombre d'erreurs);&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialisation des biblioth√®ques;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtention des r√©sultats de calcul pour chacune des biblioth√®ques avec sauvegarde du r√©sultat dans un tableau pr√©-pr√©par√© et enregistrement du temps d'ex√©cution;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ach√®vement des travaux avec le code des biblioth√®ques;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyse des donn√©es:</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une repr√©sentation graphique de cet algorithme est pr√©sent√©e ci-dessous.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/yg/e0/slyge0dloc1dednqql-hgga6um4.png" alt="Organigramme des tests de performance et de pr√©cision des biblioth√®ques de support Excel"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sultats de la premi√®re it√©ration</font></font></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indice</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Originaire de</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fl√®che</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interop√©ration Excel</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temps d'initialisation (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">257</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">266</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1653</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mer </font><font style="vertical-align: inherit;">temps pour 1 passage (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0002</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,4086</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,6847</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,9782</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38.8423</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moy. </font><font style="vertical-align: inherit;">d√©viation</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000394</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000395</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000237</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,000631</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©cision</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,99%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,92%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,97%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99,84%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreurs</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,52%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,94%</font></font></td>
</tr>
</tbody></table></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi les r√©sultats de EPPlus 5 et EPPlus 4 sont-ils combin√©s?</font></font></b>
                        <div class="spoiler_text">      EPPlus      .    ,       ,         .    ,         .     EPPlus 5     ,       .          ,      EPPlus,    .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re it√©ration des tests a montr√© un bon r√©sultat, dans lequel les leaders parmi les biblioth√®ques sont imm√©diatement devenus visibles. </font><font style="vertical-align: inherit;">Comme le montrent les donn√©es ci-dessus, le leader absolu dans cette situation est la biblioth√®que EPPlus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©sultats ne sont pas impressionnants par rapport au code natif, mais vous pouvez vivre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela aurait pu √™tre arr√™t√©, mais apr√®s avoir discut√© avec les clients, les premiers doutes se sont gliss√©s: les r√©sultats √©taient trop bons.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zp/7s/ry/zp7sryxdmhkg5rp8xfhwf537kti.jpeg"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctionnalit√©s de travail avec la biblioth√®que Spire</font></font></b>
                        <div class="spoiler_text">     Spire  ,             InvalidCastException.      ,          Excel-    ,     ,      ,     .                    try...catch.       ,         .<br>
</div>
                    </div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rake de la premi√®re it√©ration des tests</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessus, je vous ai demand√© d'attirer votre attention sur un point qui a jou√© un r√¥le important dans l'obtention de r√©sultats. Nous soup√ßonnions que les formules utilis√©es dans le vrai fichier Excel du client seraient loin d'√™tre primitives, avec de nombreuses d√©pendances √† l'int√©rieur, mais nous ne soup√ßonnions pas que cela pourrait grandement affecter les indicateurs. N√©anmoins, au d√©but, lors de la compilation des donn√©es de test, je ne l'avais pas pr√©vu, et les donn√©es du client (au moins les informations selon lesquelles au moins 120 param√®tres d'entr√©e sont utilis√©s dans le fichier final) ont laiss√© entendre que nous devons penser et ajouter des formules avec des d√©pendances entre les cellules .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous commen√ßons √† pr√©parer de nouvelles donn√©es pour la prochaine it√©ration de tests. </font><font style="vertical-align: inherit;">Arr√™tons-nous sur 10 param√®tres d'entr√©e et ajoutons 4 nouvelles formules suppl√©mentaires en fonction uniquement des param√®tres et 1 formule d'agr√©gation, qui est bas√©e sur ces quatre cellules avec des formules et s'appuiera √©galement sur les valeurs des donn√©es d'entr√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nouvelle formule qui sera utilis√©e pour les tests ult√©rieurs:</font></font><br>
<br>
<pre><code class="plaintext hljs">public double Execute(double[] p)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price1 = Math.Pow(p[0] * p[8] / p[4] * Math.Sin(p[5]) * Math.Cos(p[2]) +<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Math.Abs(p[1] - (p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8]))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Math.Sqrt(p[0] * p[0] + p[1] * p[1]) / 2.0 * Math.PI, p[9]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price2 = p[4] * p[5] * p[2] / Math.Max(1, Math.Abs(p[7]));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price3 = Math.Abs(p[7] - p[3]) * p[2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price4 = Math.Sqrt(Math.Abs(p[1] * p[2] + p[3] * p[4] + p[5] * p[6]) + 1.0);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price5 = p[0] * Math.Cos(p[1]) + p[2] * Math.Sin(p[1]);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sum = p[0] + p[1] + p[2] + p[3] + p[4] + p[5] + p[6] + p[7] + p[8] + p[9];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var price6 = sum / Math.Max(1, Math.Abs((p[0] + p[1] + p[2] + p[3]) / 4.0))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ sum / Math.Max(1, Math.Abs((p[4] + p[5] + p[6] + p[7] + p[8] + p[9]) / 6.0));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var pricingAverage = (price1 + price2 + price3 + price4 + price5 + price6) / 6.0;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return pricingAverage / Math.Max(1, Math.Abs(price1 + price2 + price3 + price4 + price5 + price6));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, la formule r√©sultante s'est av√©r√©e √™tre beaucoup plus compliqu√©e, ce qui a naturellement affect√© les r√©sultats - pas pour le mieux. </font><font style="vertical-align: inherit;">Un tableau avec les r√©sultats est pr√©sent√© ci-dessous:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indice</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Originaire de</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 4 </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus 5</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NPOI</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fl√®che</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interop√©ration Excel</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temps d'initialisation (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">241</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1640</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mer </font><font style="vertical-align: inherit;">temps pour 1 passage (ms)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,9174 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 124%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,8996 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 177%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,7647 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 11%)</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(+ 30%)</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moy. </font><font style="vertical-align: inherit;">d√©viation</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.000000</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©cision</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,00%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreurs</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xg/l5/ye/xgl5yefp3_meak1f4qzj1mctjsm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remarque: Parce que </font><font style="vertical-align: inherit;">Excel Interop est trop volumineux, a d√ª √™tre exclu du graphique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montrent les r√©sultats, la situation est devenue totalement impropre √† une utilisation en production. </font><font style="vertical-align: inherit;">Un peu triste, faites le plein de caf√© et plongez la t√™te plus profond√©ment dans l'√©tude - directement dans la g√©n√©ration de code.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nv/d_/kh/nvd_khyfluufkuwh64vikgafdpe.jpeg"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©n√©ration de code</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous n'avez soudainement jamais fait face √† une t√¢che similaire, nous effectuerons une br√®ve excursion.&nbsp;</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La g√©n√©ration de code</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un moyen de r√©soudre un probl√®me en g√©n√©rant dynamiquement du code source bas√© sur des donn√©es d'entr√©e avec une compilation et une ex√©cution ult√©rieures. </font><font style="vertical-align: inherit;">Il y a √† la fois une g√©n√©ration de code statique qui se produit pendant la construction du projet (je peux citer T4MVC comme exemple, qui cr√©e un nouveau code bas√© sur des mod√®les et des m√©tadonn√©es qui peuvent √™tre utilis√©s lors de l'√©criture du code d'application principal), et du code dynamique qui s'ex√©cute pendant l'ex√©cution.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre t√¢che est de former une nouvelle fonction bas√©e sur les donn√©es source (formules d'Excel), qui re√ßoit le r√©sultat bas√© sur le vecteur des valeurs d'entr√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, vous devez:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lisez la formule du fichier;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collectez toutes les d√©pendances;</font></font></li>
<li>       C#;</li>
<li>     ;</li>
<li>            ;</li>
<li>     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les biblioth√®ques pr√©sent√©es conviennent √† la lecture de formules, cependant, la biblioth√®que </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s'est av√©r√©e √™tre l'interface la plus pratique pour une telle fonctionnalit√© </font><font style="vertical-align: inherit;">. Apr√®s avoir fouill√© un peu dans le code source de cette biblioth√®que, j'ai d√©couvert des classes publiques pour former une liste de jetons et sa transformation ult√©rieure en arbre d'expression. Bingo, je pensais! Un arbre d'expression pr√™t √† l'emploi de la bo√Æte est id√©al, il suffit de le parcourir et de former notre code C #.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais un gros probl√®me m'attendait lorsque j'ai commenc√© √† √©tudier les n≈ìuds de l'arbre d'expression r√©sultant. Certains n≈ìuds, notamment l'appel aux fonctions Excel, ont encapsul√© des informations sur la fonction utilis√©e et ses param√®tres d'entr√©e et n'ont fourni aucun acc√®s ouvert √† ces donn√©es. Par cons√©quent, le travail avec l'arborescence d'expression termin√©e a d√ª √™tre report√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous descendons d'un niveau plus bas et essayons de travailler avec la liste des jetons. Tout est assez simple ici: nous avons des jetons de type et de valeur. Parce que on nous donne une fonction et nous devons former une fonction, alors nous pouvons √† la place convertir les jetons d'arbre en l'√©quivalent en C #. L'essentiel de cette approche est d'organiser des fonctions compatibles. La plupart des fonctions math√©matiques √©taient d√©j√† compatibles - telles que le calcul du cosinus, du sinus, l'obtention de la racine et l'augmentation d'une puissance. Mais les fonctions d'agr√©gation - telles que la valeur maximale, le minimum, le montant - devaient √™tre finalis√©es. La principale diff√©rence est que dans Excel, ces fonctions fonctionnent avec une plage de valeurs. Pour simplifier le prototype, nous allons cr√©er des fonctions qui prennent une liste de param√®tres en entr√©e, en √©tendant auparavant la plage de valeurs dans une liste lin√©aire.De cette fa√ßon, nous obtenons la conversion correcte et compatible de la syntaxe Excel √† la syntaxe C #.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous trouverez ci-dessous le code principal pour convertir une liste de jetons d'une formule Excel en un code C # valide.</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformToSharpCode(string formula, ParsingContext parsingContext)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize basic compile components, e.g. lexer<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var lexer = new Lexer(parsingContext.Configuration.FunctionRepository, parsingContext.NameValueProvider);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// List of dependency variables that can be filled during formula transformation<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var variables = new Dictionary&lt;string, string&gt;();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;using (var scope = parsingContext.Scopes.NewScope(RangeAddress.Empty))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take resulting code line<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var compiledResultCode = TransformToSharpCode(formula, parsingContext, scope, lexer, variables);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Define dependency variables in reverse order.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (var variableDefinition in variables.Reverse())<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"var {variableDefinition.Key} = {variableDefinition.Value};");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Take the result<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.AppendLine($"return {compiledResultCode};");<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
private string TransformToSharpCode(ICollection&lt;Token&gt; tokens, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var output = new StringBuilder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;foreach (Token token in tokens)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token.TokenType)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Function:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(BuildFunctionName(token.Value));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.OpeningParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append("(");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ClosingParenthesis:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(")");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Comma:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(", ");<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.ExcelAddress:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var address = token.Value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(TransformAddressToSharpCode(address, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Decimal:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Integer:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Boolean:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case TokenType.Operator:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output.Append(token.Value);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return output.ToString();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La nuance suivante dans la conversion √©tait l'utilisation de constantes Excel - ce sont des fonctions, donc en C #, elles doivent √©galement √™tre envelopp√©es dans une fonction.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reste √† r√©soudre une seule question: la conversion des r√©f√©rences de cellule en param√®tre. Dans le cas o√π le jeton contient des informations sur la cellule, nous d√©terminons d'abord ce qui est stock√© dans cette cellule. S'il s'agit d'une formule, d√©veloppez-la r√©cursivement. Si la constante est remplac√©e par un lien analogique C #, de la forme </font></font><code>p[row, column]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o√π il </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut s'agir d'un tableau √† deux dimensions ou d'une classe d'acc√®s index√©e pour un mappage de donn√©es correct. Avec une gamme de cellules, nous faisons de m√™me, il suffit de pr√©-√©tendre la gamme en cellules individuelles et de les traiter s√©par√©ment. Ainsi, nous couvrons les principales fonctionnalit√©s lors de la traduction d'une fonction Excel.&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/kk/hz/gwkkhzpfeudqdzcbfsgsdzdtolo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le code pour convertir un lien vers une cellule de feuille de calcul Excel en un code C # valide:</font></font><br>
<br>
<pre><code class="plaintext hljs">private string TransformAddressToSharpCode(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Try to parse excel range of addresses<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Currently, reference to another worksheet in address string is not supported<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rangeParts = excelAddress.Split(':');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (rangeParts.Length == 1)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(excelAddress, parsingContext, scope, lexer, variables);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Parse excel range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[0], out int startRowIndex, out int startColumnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(rangeParts[1], out int endRowIndex, out int endColumnIndex);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var rowDelta = endRowIndex - startRowIndex;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var columnDelta = endColumnIndex - startColumnIndex;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var allAccessors = new List&lt;string&gt;(Math.Abs(rowDelta * columnDelta));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO This part of code doesn't support reverse-ordered range address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (var rowIndex = startRowIndex; rowIndex &lt;= endRowIndex; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var columnIndex = startColumnIndex; columnIndex &lt;= endColumnIndex; columnIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Unpack single excel address<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allAccessors.Add(UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return string.Join(", ", allAccessors);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(string excelAddress, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ParseAddressToIndexes(excelAddress, out int rowIndex, out int columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return UnpackExcelAddress(rowIndex, columnIndex, parsingContext, scope, lexer, variables);<font></font>
}<font></font>
<font></font>
private string UnpackExcelAddress(int rowIndex, int columnIndex, ParsingContext parsingContext, ParsingScope scope, ILexer lexer, Dictionary&lt;string, string&gt; variables)<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = parsingContext.ExcelDataProvider.GetRangeFormula(_worksheet.Name, rowIndex, columnIndex);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (string.IsNullOrWhiteSpace(formula))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// When excel address doesn't contain information about any excel formula, we should just use external input data parameter provider.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $"p[{rowIndex},{columnIndex}]";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When formula is provided, try to identify that variable is not defined yet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// TODO Worksheet name is not included in variable name, potentially that can cause conflicts<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Extracting and reusing calculations via local variables improves performance for 0.0045ms<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var cellVariableId = $"C{rowIndex}R{columnIndex}";<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;if (variables.ContainsKey(cellVariableId))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// When variable does not exist, transform new formula and register that to variable scope<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;variables.Add(cellVariableId, TransformToSharpCode(formula, parsingContext, scope, lexer, variables));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return cellVariableId;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'√† encapsuler le code converti r√©sultant dans une fonction statique, lier l'assembly aux fonctions de compatibilit√© et compiler l'assembly dynamique. </font><font style="vertical-align: inherit;">Chargez-le en m√©moire, obtenez un lien vers notre fonction - et vous pouvez l'utiliser.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous √©crivons une classe wrapper pour tester et ex√©cuter des tests avec mesure du temps.&nbsp;</font></font><br>
<br>
<pre><code class="plaintext hljs">public void SetUp()<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize excel package by EPPlus library<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_package = new ExcelPackage(new FileInfo(_fileName));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_workbook = _package.Workbook;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_worksheet = _workbook.Worksheets[1];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_inputRange = new ExcelRange[10];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;for (int rowIndex = 0; rowIndex &lt; 10; rowIndex++)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_inputRange[rowIndex] = _worksheet.Cells[rowIndex + 1, 2];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Access to result cell and extract formula string<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_resultRange = _worksheet.Cells[11, 2];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var formula = _resultRange.Formula;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Initialize parsing context and setup data provider<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var parsingContext = ParsingContext.Create();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;parsingContext.ExcelDataProvider = new EpplusExcelDataProvider(_package);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Transform Excel formula to CSharp code<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;var sourceCode = TransformToSharpCode(formula, parsingContext);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;// Compile CSharp code to IL dynamic assembly via helper wrappers<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_code = CodeGenerator.CreateCode&lt;double&gt;(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sourceCode,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// List of used namespaces<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System", // Required for Math functions<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ExcelCalculations.PerformanceTests" // Required for Excel function wrappers stored at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new string[]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add reference to current compiled assembly, that is required to use Excel function wrappers located at ExcelCompiledFunctions static class<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"....\\bin\\Debug\\ExcelCalculations.PerformanceTests.exe"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Notify that this source code should use parameter;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Use abstract p parameter - interface for values accessing.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CodeParameter("p", typeof(IExcelValueProvider))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, nous avons un prototype de cette solution et la marquons comme </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-I</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apr√®s avoir ex√©cut√© les tests, nous obtenons le r√©sultat tant attendu. L'acc√©l√©ration est presque 300 fois. D√©j√† pas mal, mais le code r√©sultant est encore 16 fois plus lent que le code natif. Cela pourrait-il √™tre mieux? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, vous pouvez! Essayons d'am√©liorer le r√©sultat car nous remplacerons tous les liens vers des cellules suppl√©mentaires par des formules avec des variables. Notre test utilise plusieurs utilisations de cellules d√©pendantes dans la formule, donc dans la premi√®re version du traducteur, nous avons re√ßu plusieurs calculs des m√™mes donn√©es. Par cons√©quent, il a √©t√© d√©cid√© d'utiliser des variables interm√©diaires dans les calculs. Apr√®s avoir d√©velopp√© le code en utilisant la g√©n√©ration de variables d√©pendantes, nous avons obtenu une augmentation des performances de 2 fois de plus. Cette am√©lioration s'appelle</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-II</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le tableau de comparaison est pr√©sent√© ci-dessous:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioth√®que</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mer </font><font style="vertical-align: inherit;">temps (ms)</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coef. </font><font style="vertical-align: inherit;">ralentissements</font></font></strong></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Originaire de</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,00004</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-II</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,003</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlusCompiled, Mark-I</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0061</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seize</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPPlus</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,2089</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3023</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ces conditions et dans les d√©lais impartis pour la t√¢che, nous avons obtenu un r√©sultat qui nous rapproche des performances du code natif avec un l√©ger d√©calage - 8 fois, par rapport √† la version d'origine - un d√©calage de plusieurs ordres de grandeur, 3028 fois. </font><font style="vertical-align: inherit;">Mais est-il possible d'am√©liorer le r√©sultat et de se rapprocher le plus possible du code natif, si vous supprimez les d√©lais et combien cela sera-t-il appropri√©?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ma r√©ponse est oui, mais, malheureusement, je n'ai plus eu le temps de mettre en ≈ìuvre ces techniques. </font><font style="vertical-align: inherit;">Je consacrerai peut-√™tre un article s√©par√© √† ce sujet. </font><font style="vertical-align: inherit;">Pour le moment, je ne peux parler que des principales id√©es et options, en les √©crivant sous la forme de courts r√©sum√©s qui ont √©t√© v√©rifi√©s par transformation inverse. </font><font style="vertical-align: inherit;">Par conversion inverse, j'entends la d√©gradation du code natif √©crit √† la main dans le sens du code g√©n√©r√©. </font><font style="vertical-align: inherit;">Cette approche vous permet de v√©rifier certaines th√®ses assez rapidement et ne n√©cessite pas de changements importants dans le code. </font><font style="vertical-align: inherit;">Cela vous permet √©galement de r√©pondre √† la question de savoir comment les performances du code natif se d√©t√©rioreront dans certaines conditions, ce qui signifie que si le code g√©n√©r√© est automatiquement am√©lior√© dans la direction oppos√©e, nous pouvons obtenir une am√©lioration des performances avec un coefficient similaire.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sum√©s</font></font></h2><br>
<ol>
<li>  ,                     ;</li>
<li>           inline      ;</li>
<li> -     Sum, Max, Min   ;</li>
<li>  Sum  inline     ;</li>
<li>   (         )    .</li>
</ol><br>
<h1></h1><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong></strong></td>
<td><strong>Native</strong></td>
<td><strong>EPPlus Compiled, Mark-II</strong></td>
<td><strong>EPPlus 4</strong><strong>EPPlus 5</strong></td>
<td><strong>NPOI</strong></td>
<td><strong>Spire</strong></td>
<td><strong>Excel Interop</strong></td>
</tr>
<tr>
<td><strong>  ()</strong></td>
<td>0</td>
<td>239</td>
<td>241</td>
<td>368</td>
<td>722</td>
<td>1640</td>
</tr>
<tr>
<td><strong>.   1  ()</strong></td>
<td>0,0004</td>
<td>0,003</td>
<td>0,9174</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,8996</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,7647</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50,7194</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moy. </font><font style="vertical-align: inherit;">d√©viation</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,035884</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©cision</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">98,79%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n / a</font></font></td>
</tr>
<tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erreurs</font></font></strong></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,28%</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,3%</font></font></td>
</tr>
</tbody></table></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kd/py/vy/kdpyvy0-qfqtfbwgtvbwjo28coo.png" alt="Calcul rapide de formules √† partir d'Excel en C #"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour r√©sumer les √©tapes, nous avons un m√©canisme pour convertir les formules directement √† partir d'un document Excel personnalis√© en code de travail sur le serveur. </font><font style="vertical-align: inherit;">Cela vous permet d'utiliser l'incroyable flexibilit√© de l'int√©gration d'Excel avec n'importe quelle solution d'entreprise sans perdre la puissante interface utilisateur avec laquelle un grand nombre d'utilisateurs sont habitu√©s √† travailler. </font><font style="vertical-align: inherit;">√âtait-il possible de d√©velopper une interface aussi pratique avec le m√™me ensemble d'outils pour analyser et visualiser les donn√©es que dans Excel pour une p√©riode de d√©veloppement aussi courte? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et quelles ont √©t√© les int√©grations les plus inhabituelles et int√©ressantes avec les documents Excel que vous avez d√ª mettre en ≈ìuvre?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498022/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 341 (du 13 au 19 avril)</a></li>
<li><a href="../fr498024/index.html">Construire des villes en un clic de souris avec Houdini et Python</a></li>
<li><a href="../fr498026/index.html">FOSS News n ¬∞ 12 - revue des nouvelles gratuites et open source du 13 au 19 avril 2020</a></li>
<li><a href="../fr498028/index.html">Simulation de pand√©mie Python COVID-19</a></li>
<li><a href="../fr498030/index.html">Sauvegarde: o√π, comment et pourquoi?</a></li>
<li><a href="../fr498034/index.html">L'avion de conception moderne est mieux prot√©g√© que vous ne le pensez contre les menaces biologiques (COVID-19)</a></li>
<li><a href="../fr498036/index.html">Mark Andriessen: Il est temps de cr√©er pour nous-m√™mes (il est temps de construire)</a></li>
<li><a href="../fr498038/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 411 (13-19 avril 2020)</a></li>
<li><a href="../fr498042/index.html">Analyser, pas valider</a></li>
<li><a href="../fr498046/index.html">Les chercheurs d√©veloppent une approche pour r√©duire les biais dans les ensembles de donn√©es de vision par ordinateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>