<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€âœˆï¸ ğŸ£ ğŸ‘¨ğŸ¿â€ğŸ¤ Smart Home: Membangun Grafik Air dan Listrik di Home Assistant â›ˆï¸ ğŸ“© ğŸª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setiap kali saya menerima tagihan untuk listrik dan air, saya bertanya-tanya - apakah keluarga saya benar-benar mengkonsumsi begitu banyak? Ya, kamar ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smart Home: Membangun Grafik Air dan Listrik di Home Assistant</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/lf/i3/wjlfi38qar57vvhqgpwuzdalerw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap kali saya menerima tagihan untuk listrik dan air, saya bertanya-tanya - apakah keluarga saya benar-benar mengkonsumsi begitu banyak? Ya, kamar mandi memiliki lantai berpemanas dan ketel, tetapi mereka tidak terus menyala. Kami juga tampaknya menghemat air (meskipun kami juga suka cipratan di kamar mandi). Beberapa tahun yang lalu, saya sudah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menghubungkan meter air</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listrik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke rumah pintar, tapi ini macet. Tangan sampai pada analisis konsumsi hanya sekarang, tentang yang, pada kenyataannya, artikel ini tentang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya baru saja beralih ke Home Assistant sebagai sistem rumah pintar. Salah satu alasannya adalah hanya kesempatan untuk mengatur pengumpulan sejumlah besar data dengan kemungkinan membangun berbagai jenis grafik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Informasi yang dijelaskan dalam artikel ini bukanlah hal baru, semua hal ini dengan saus yang berbeda telah dijelaskan di Internet. </font><font style="vertical-align: inherit;">Tetapi setiap artikel, sebagai suatu peraturan, hanya menggambarkan satu pendekatan atau aspek. </font><font style="vertical-align: inherit;">Saya harus membandingkan semua pendekatan ini dan memilih sendiri yang paling cocok. </font><font style="vertical-align: inherit;">Artikel itu masih tidak memberikan informasi yang komprehensif tentang pengumpulan data, tetapi ini adalah semacam sinopsis tentang bagaimana saya melakukannya. </font><font style="vertical-align: inherit;">Jadi kritik konstruktif dan saran untuk perbaikan dipersilahkan.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perumusan masalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, tujuan latihan hari ini adalah untuk mendapatkan grafik konsumsi air dan listrik yang indah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setiap jam selama 2 hari</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setiap hari selama 2 minggu</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(opsional) mingguan dan bulanan</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sinilah beberapa kesulitan menunggu kita:</font></font><br>
<br>
<ul>
<li>  ,  ,  .         . <br>
<br>
  ,     ,     .  home assistant,  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">mini-graph-card</a>,     :<br>
<br>
<ul>
<li>        (     ,         )</li>
<li>       (   ,      )</li>
</ul></li>
<li> ,  home assistant        SQLite <s>( , ,    MySQL  Postgres)</s>,        . , ,               json   <br>
<br>
<pre><code class="json hljs">{<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"old_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"aafc8ca305ba4e49ad4c97f0eddd8893"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}, <span class="hljs-attr">"new_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"0de64b8af6f14bb9a419dcf3b200ef56"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}}</code></pre><br>
     (    ,    ),         .      SDM220      10-15 ,         8.      ,      . ..         100-200  .      ,      (    home assistant  raspberry PI),            .</li>
<li>  ,      .           <s> </s>   .           (RS232/RS485/Modbus/Zigbee)   .<br>
<br>
         (    ),      X -  .            .         ,        . , ,        home assistant,          ,             (  home assistant).</li>
</ul><br>
<h2> 1</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, mari kita lihat apa yang asisten rumah disediakan di luar kotak. Mengukur konsumsi selama periode adalah fungsi yang sangat dituntut. Tentu saja, itu direalisasikan sejak lama dalam bentuk komponen khusus - utility_meter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inti dari komponen adalah bahwa di dalamnya dimulai variabel current_accumulated_value, dan ulang setelah periode tertentu (jam / minggu / bulan). Komponen itu sendiri memonitor variabel yang masuk (nilai semacam sensor), berlangganan perubahan nilai itu sendiri - Anda baru saja mendapatkan hasil yang selesai. Hal ini dijelaskan hanya dalam beberapa baris di file konfigurasi.</font></font><br>
<br>
<pre><code class="python hljs">utility_meter:<font></font>
  water_cold_hour_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: hourly<font></font>
  water_cold_day_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: daily<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini sensor.water_meter_cold adalah nilai saat ini dari penghitung dalam liter, yang saya dapatkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">langsung dari potongan besi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oleh mqtt. Desain menciptakan 2 sensor baru water_cold_hour_um dan water_cold_day_um, yang mengakumulasikan pembacaan setiap jam dan harian, mengatur ulang mereka setelah suatu periode. Berikut bagan baterai setengah jam. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/u3/fk/leu3fkbgddojjis_lmcawt6gcv4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode grafik per jam dan harian untuk lovelace-UI terlihat seperti ini:</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, masalah dari pendekatan ini terletak pada algoritma ini. Seperti yang saya sebutkan, untuk setiap nilai input (pembacaan meter saat ini untuk setiap liter berikutnya), catatan 1kb dihasilkan dalam database. Setiap meteran utilitas juga menghasilkan nilai baru, yang juga menambahkan hingga ke basis data. Jika saya ingin mengumpulkan bacaan per jam / harian / mingguan / bulanan, dan untuk beberapa penambah air, dan bahkan menambahkan banyak meter listrik - ini akan banyak data. Yah, lebih tepatnya, tidak ada banyak data, tetapi karena asisten rumah menulis ke database banyak informasi yang tidak perlu, ukuran database akan tumbuh dengan pesat. Saya takut bahkan untuk memperkirakan ukuran basis untuk grafik mingguan dan bulanan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, meteran utilitas saja tidak menyelesaikan tugas. </font><font style="vertical-align: inherit;">Grafik nilai yang diberikan meteran utilitas adalah fungsi yang meningkat secara monoton yang diatur ulang ke 0 setiap jam. </font><font style="vertical-align: inherit;">Kami membutuhkan grafik konsumsi yang ramah pengguna, berapa liter yang dimakan selama periode tersebut. </font><font style="vertical-align: inherit;">Komponen grafik sejarah standar tidak tahu bagaimana melakukan ini, tetapi komponen kartu grafik mini eksternal dapat membantu kami. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah kode kartu untuk lovelace-UI:</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_hour_um<font></font>
        group_by: hour<font></font>
        hours_to_show: <span class="hljs-number">48</span>
        name: <span class="hljs-string">"Hourly water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">1</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain pengaturan standar seperti nama sensor, jenis grafik, warna (Saya tidak suka oranye standar), penting untuk dicatat pengaturan 3:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group_by: jam - bagan akan dihasilkan dengan kolom disejajarkan di awal jam</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points_per_hour: 1 - satu bar untuk setiap jam</font></font></li>
<li>  , aggregate_func: max â€”       .         </li>
</ul><br>
<img src="https://habrastorage.org/webt/yj/du/c7/yjduc7nhxnq18qvcityd_ul91y0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan memperhatikan sejumlah kolom di sebelah kiri - ini adalah perilaku standar komponen jika tidak ada data. Dan tidak ada data - saya hanya menyalakan pengumpulan data meteran utilitas hanya beberapa jam yang lalu hanya demi artikel ini (saya akan membahas pendekatan saya saat ini nanti). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam gambar ini, saya ingin menunjukkan bahwa kadang-kadang tampilan data berfungsi, dan bilah benar-benar mencerminkan nilai yang benar. Tapi itu belum semuanya. Kolom yang dipilih untuk interval 11 hingga 12 di pagi hari untuk beberapa alasan menampilkan 19 liter, meskipun pada bagan bergigi sedikit lebih tinggi untuk periode yang sama kita melihat konsumsi 62 liter dari sensor yang sama. Baik bug atau tangan bengkok. Tetapi saya tidak mengerti mengapa data di sebelah kanan terputus - konsumsi di sana normal, yang juga terlihat pada jadwal yang sulit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, saya tidak dapat mencapai kredibilitas dari pendekatan ini - grafik hampir selalu menunjukkan semacam bid'ah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode yang sama untuk sensor hari.</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_day_um<font></font>
        group_by: interval<font></font>
        hours_to_show: <span class="hljs-number">360</span>
        name: <span class="hljs-string">"Daily water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">0.0416666666</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa parameter group_by diatur ke interval, dan parameter points_per_hour mengatur semuanya. </font><font style="vertical-align: inherit;">Dan ini adalah masalah lain dari komponen ini - points_per_hour bekerja dengan baik pada grafik dalam satu jam atau kurang, tetapi menjijikkan pada interval besar. </font><font style="vertical-align: inherit;">Jadi untuk mendapatkan satu kolom dalam satu hari, saya harus memasukkan nilai 1/24 = 0,04166666. </font><font style="vertical-align: inherit;">Saya tidak berbicara tentang grafik mingguan dan bulanan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendekatan 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya mencari tahu asisten rumah, saya menemukan video ini di sini:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-0HrYFCRH0M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seorang teman mengumpulkan data konsumsi dari beberapa jenis outlet Xiaomi. Tugasnya sedikit lebih mudah - hanya menampilkan nilai konsumsi untuk hari ini, kemarin dan bulan ini. Tidak diperlukan jadwal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita kesampingkan diskusi tentang integrasi manual dari nilai daya sesaat - Saya sudah menulis tentang "akurasi" pendekatan ini. Tidak jelas mengapa dia tidak menggunakan nilai konsumsi akumulasi, yang sudah dikumpulkan oleh outlet yang sama. Menurut pendapat saya, integrasi di dalam potongan besi akan bekerja lebih baik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari video, kami mengambil gagasan untuk menghitung konsumsi secara manual untuk periode tersebut. Petani hanya menghitung nilai untuk hari ini dan kemarin, tapi kami akan melangkah lebih jauh dan mencoba menggambar grafik. Inti dari metode yang diusulkan dalam kasus saya adalah sebagai berikut.</font></font><br>
<br>
<ul>
<li>  ___,      </li>
<li>     (   )          .         â€”    ,         . </li>
<li>  â€œâ€  ___     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini dapat dilakukan </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melalui ...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asisten rumah sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda harus menulis beberapa kode lebih banyak dari pada pendekatan sebelumnya. </font><font style="vertical-align: inherit;">Untuk memulai, mari kita mulai dari â€œvariabelâ€ ini. </font><font style="vertical-align: inherit;">Di luar kotak, kami tidak memiliki entitas "variabel", tetapi Anda dapat menggunakan layanan broker mqtt. </font><font style="vertical-align: inherit;">Kami akan mengirimkan nilai dengan flag retain = true di sana - ini akan menyimpan nilai di dalam broker, dan Anda dapat menariknya kapan saja, bahkan ketika asisten rumah reboot. </font><font style="vertical-align: inherit;">Saya langsung membuat counter jam dan hari.</font></font><br>
<br>
<pre><code class="python hljs">- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour"</span><font></font>
  name: water_hour<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
  name: water_hour_begin<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day"</span><font></font>
  name: water_day<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
  name: water_day_begin<font></font>
  unit_of_measurement: l</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua keajaiban terjadi dalam otomatisasi, yang berjalan setiap jam dan setiap malam, masing-masing.</font></font><br>
<br>
<pre><code class="python hljs">- id: water_new_hour<font></font>
  alias: water_new_hour<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time_pattern<font></font>
      minutes: <span class="hljs-number">0</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_hour_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true<font></font>
<font></font>
- id: water_new_day<font></font>
  alias: water_new_day<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time<font></font>
      at: <span class="hljs-string">"00:00:00"</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_day_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua otomasi melakukan 2 tindakan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai untuk interval dihitung sebagai perbedaan antara nilai awal dan akhir</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbarui nilai dasar untuk interval berikutnya</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafik dalam kasus ini dipecahkan oleh grafik sejarah yang biasa:</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/nn/ah/rpnnahsspezbcydtjmhlu6kb53w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada prinsipnya, ini sudah apa yang Anda butuhkan. </font><font style="vertical-align: inherit;">Keuntungan dari metode ini adalah bahwa data dihasilkan satu kali per interval. </font><font style="vertical-align: inherit;">Itu </font><font style="vertical-align: inherit;">hanya 24 entri per hari untuk grafik per jam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, ini masih tidak menyelesaikan masalah umum dari basis yang berkembang. </font><font style="vertical-align: inherit;">Jika saya ingin jadwal konsumsi bulanan, saya harus menyimpan data selama setidaknya satu tahun. </font><font style="vertical-align: inherit;">Dan karena asisten rumah hanya menyediakan satu pengaturan untuk durasi penyimpanan untuk seluruh database, ini berarti bahwa SEMUA data dalam sistem harus disimpan selama satu tahun penuh. </font><font style="vertical-align: inherit;">Sebagai contoh, selama setahun saya mengonsumsi 200 meter kubik air, yang berarti 200.000 catatan dalam database. </font><font style="vertical-align: inherit;">Dan jika Anda memperhitungkan sensor lain, angkanya menjadi tidak senonoh sama sekali.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendekatan 3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untungnya, orang pintar sudah menyelesaikan masalah ini dengan menulis basis data InfluxDB. Basis data ini dioptimalkan secara khusus untuk menyimpan data berbasis waktu dan ideal untuk menyimpan nilai sensor yang berbeda. Sistem ini juga menyediakan bahasa query seperti SQL yang memungkinkan Anda memilih nilai dari database, dan kemudian menggabungkannya dengan berbagai cara. Akhirnya, data yang berbeda dapat disimpan pada waktu yang berbeda. Misalnya, bacaan yang sering berubah seperti suhu atau kelembaban dapat disimpan hanya untuk beberapa minggu, sementara bacaan harian konsumsi air dapat disimpan selama setahun penuh.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain InfluxDB, orang pintar juga menemukan Grafana, sistem pembuatan bagan berdasarkan data dari InfluxDB. </font><font style="vertical-align: inherit;">Grafana dapat menggambar berbagai jenis grafik, menyesuaikannya secara rinci, dan, yang paling penting, grafik ini dapat "macet" pada asisten rumah UI-lovelace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dapatkan inspirasi di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Artikel-artikel menjelaskan secara rinci proses menginstal dan menghubungkan InfluxDB dan Grafana ke asisten rumah. </font><font style="vertical-align: inherit;">Saya akan fokus pada pemecahan masalah spesifik saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, pertama-tama, mari kita mulai menambahkan nilai penghitung di influxDB. </font><font style="vertical-align: inherit;">Sepotong konfigurasi asisten rumah (dalam contoh ini, saya akan bersenang-senang tidak hanya dengan dingin, tetapi juga dengan air panas):</font></font><br>
<br>
<pre><code class="python hljs">influxdb:<font></font>
  host: localhost<font></font>
  max_retries: <span class="hljs-number">3</span><font></font>
  default_measurement: state<font></font>
  database: homeassistant<font></font>
  include:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Matikan penyimpanan data yang sama ke database internal asisten rumah agar tidak mengembang lagi:</font></font><br>
<br>
<pre><code class="python hljs">recorder:<font></font>
  purge_keep_days: <span class="hljs-number">10</span>
  purge_interval: <span class="hljs-number">1</span><font></font>
  exclude:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami sekarang pergi ke konsol InfluxDB dan mengatur basis data kami. Secara khusus, Anda perlu mengkonfigurasi berapa lama data ini atau itu akan disimpan. Ini diatur oleh yang disebut kebijakan penyimpanan - ini mirip dengan basis data di dalam basis data utama, dengan setiap basis data internal memiliki pengaturannya sendiri. Secara default, semua data disimpan dalam kebijakan retensi yang disebut autogen, data ini akan disimpan selama seminggu. Saya ingin data per jam disimpan selama sebulan, mingguan selama setahun, dan bulanan tidak boleh dihapus sama sekali. Buat kebijakan penyimpanan yang tepat</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"month"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">30</span>d <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"year"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">52</span>w <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"infinite"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> INF <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, sebenarnya, trik utamanya adalah pengumpulan data menggunakan kueri berkelanjutan. </font><font style="vertical-align: inherit;">Ini adalah mekanisme yang secara otomatis memulai kueri pada interval yang ditentukan, mengumpulkan data untuk kueri ini, dan menambahkan hasilnya ke nilai baru. </font><font style="vertical-align: inherit;">Mari kita lihat contoh (saya menulis di kolom agar mudah dibaca, tetapi sebenarnya saya harus memasukkan perintah ini dalam satu baris)</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> CONTINUOUS <span class="hljs-keyword">QUERY</span> cq_water_hourly <span class="hljs-keyword">ON</span> homeassistant 
<span class="hljs-keyword">BEGIN</span> 
  <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">value</span> 
  <span class="hljs-keyword">INTO</span> homeassistant.month.water_meter_hour 
  <span class="hljs-keyword">FROM</span> homeassistant.autogen.l 
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id fill(previous) 
<span class="hljs-keyword">END</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perintah ini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat kueri berkelanjutan bernama cq_water_cold_hourly di database homeassistant</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan akan dieksekusi setiap jam (waktu (1 jam))</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan akan mengambil semua data dari pengukuran 'homeassistant.autogen.l (liter), termasuk pembacaan air dingin dan panas</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data teragregasi akan dikelompokkan berdasarkan entity_id, yang akan membuat nilai terpisah untuk air dingin dan panas.</font></font></li>
<li>               ,      max(value) </li>
<li>     homeassistant.month.water_meter_hour,  month   retention policy     .               entity_id     value</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di malam hari atau ketika tidak ada orang di rumah tidak ada konsumsi air, dan karenanya tidak ada entri baru di homeassistant.autogen.l juga. Untuk menghindari nilai yang hilang dalam kueri reguler, Anda dapat menggunakan isian (sebelumnya). Ini akan memaksa InfluxDB untuk menggunakan nilai jam terakhir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, kueri berkelanjutan memiliki kekhasan: trik isian (sebelumnya) tidak berfungsi dan rekaman tidak dibuat. Selain itu, ini adalah beberapa masalah yang tidak dapat diatasi yang telah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dibahas selama lebih dari setahun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kami akan menangani masalah ini nanti, dan biarkan isi (sebelumnya) dalam kueri terus-menerus - itu tidak mengganggu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa apa yang terjadi (tentu saja, Anda perlu menunggu beberapa jam):</font></font><br>
<br>
<pre><code class="python hljs">&gt; select * <span class="hljs-keyword">from</span> homeassistant.month.water_meter_hour group by entity_id<font></font>
...<font></font>
name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 value<font></font>
----                 -----<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T01:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370511</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370513</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370527</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370605</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370635</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370699</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370761</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370767</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370810</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370818</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370827</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370849</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370921</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap dicatat bahwa nilai-nilai dalam database disimpan dalam UTC, oleh karena itu dalam daftar ini mereka berbeda dengan 3 jam - nilai-nilai untuk jam 7 pagi dalam output InfluxDB sesuai dengan nilai-nilai untuk jam 10 pagi dalam grafik di atas. </font><font style="vertical-align: inherit;">Perhatikan juga bahwa antara 2 dan 5 pagi sama sekali tidak ada catatan - ini adalah fitur yang sama dari permintaan berkelanjutan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, nilai agregat juga merupakan urutan yang meningkat secara monoton, hanya catatan yang lebih jarang - satu kali per jam. </font><font style="vertical-align: inherit;">Tapi ini bukan masalah - kita bisa menulis kueri lain yang akan menghasilkan data yang benar untuk bagan.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">difference</span>(<span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>)) 
<span class="hljs-keyword">FROM</span> homeassistant.month.water_meter_hour 
<span class="hljs-keyword">WHERE</span> entity_id=<span class="hljs-string">'water_meter_cold'</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &gt;= <span class="hljs-keyword">now</span>() <span class="hljs-number">-24</span>h 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id <font></font>
fill(previous)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan mendekripsi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari database homeassistant.month.water_meter_hour, kami mengekstrak data untuk entity_id = 'water_meter_cold' untuk hari terakhir (waktu&gt; = sekarang () -24jam). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang saya sebutkan dalam urutan homeassistant.month.water_meter_hour beberapa entri mungkin hilang. </font><font style="vertical-align: inherit;">Kami akan membuat ulang data ini dengan menjalankan kueri dengan GROUP BY time (1h). </font><font style="vertical-align: inherit;">Pengisian waktu ini (sebelumnya) akan bekerja sesuai kebutuhan, menghasilkan data yang hilang (fungsi akan mengambil nilai sebelumnya)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hal terpenting dalam permintaan ini adalah fungsi perbedaan, yang akan menghitung perbedaan antara tanda jam. </font><font style="vertical-align: inherit;">Dengan sendirinya, itu tidak berfungsi dan membutuhkan fungsi agregat. </font><font style="vertical-align: inherit;">Biarkan itu menjadi max () yang digunakan sebelumnya.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil eksekusi terlihat seperti ini</font></font><br>
<br>
<pre><code class="python hljs">name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 difference<font></font>
----                 ----------<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">2</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T03:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T04:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">14</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">78</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">30</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">64</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">62</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">6</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">43</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">8</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">9</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">22</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">72</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari 2 hingga 5 pagi (UTC) tidak ada konsumsi. </font><font style="vertical-align: inherit;">Namun demikian, kueri akan mengembalikan nilai konsumsi yang sama karena untuk mengisi (sebelumnya), dan fungsi perbedaan akan mengurangi nilai ini dari dirinya sendiri dan kita akan mendapatkan 0 pada output, yang sebenarnya diperlukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu-satunya yang tersisa adalah membuat jadwal. </font><font style="vertical-align: inherit;">Untuk melakukan ini, buka Grafana, buka beberapa dasbor yang ada (atau buat baru), buat panel baru. </font><font style="vertical-align: inherit;">Pengaturan bagan akan seperti ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ux/q0/c8/uxq0c834j1eq4h7ey4qazk4cc7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menampilkan data pada air dingin dan panas pada satu grafik. </font><font style="vertical-align: inherit;">Permintaannya persis sama dengan yang saya jelaskan di atas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter tampilan diatur sebagai berikut. </font><font style="vertical-align: inherit;">Saya akan memiliki grafik dengan garis, yang berjalan dengan tangga. </font><font style="vertical-align: inherit;">Saya akan menjelaskan parameter Stack tepat di bawah. </font><font style="vertical-align: inherit;">Ada beberapa opsi tampilan di bawah ini, tetapi tidak begitu menarik.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/rd/5x/bird5xpaysckqtigczjerbp5mti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menambahkan jadwal yang diterima ke asisten rumah yang Anda butuhkan:</font></font><br>
<br>
<ul>
<li>    . -         </li>
<li>     ,    share</li>
<li>      embed</li>
<li>  current time range â€”       URL </li>
<li>  .     light</li>
<li>  URL    lovelace-UI</li>
</ul><br>
<pre><code class="python hljs">      - type: iframe<font></font>
        id: graf_water_hourly<font></font>
        url: <span class="hljs-string">"http://192.168.10.200:3000/d-solo/rZARemQWk/water?orgId=1&amp;panelId=2&amp;from=now-2d&amp;to=now&amp;theme=light"</span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap perhatikan bahwa rentang waktu (2 hari terakhir) ditetapkan di sini, dan bukan di pengaturan dasbor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafiknya terlihat seperti ini. Saya belum pernah menggunakan air panas dalam 2 hari terakhir, jadi hanya grafik air dingin yang diambil. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/e7/hk/mse7hkckiwjjm_b5ppli9dakd2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak memutuskan sendiri jadwal mana yang paling saya sukai, garis step, atau bar nyata. Karena itu, saya hanya akan memberikan contoh grafik konsumsi harian, hanya kali ini dalam kolom. Permintaan dibangun dengan cara yang sama seperti yang dijelaskan di atas. Parameter tampilan adalah sebagai berikut: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ns/se/jt/nssejtoburugxcldedjuj0cvywm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grafik ini terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zd/yl/hj/zdylhjfnrdonlnkezr3n4dlwdwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi tentang parameter Stack. Dalam grafik ini, kolom air dingin digambar di atas kolom air panas. Tinggi total sesuai dengan total konsumsi air dingin dan panas selama periode tersebut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua grafik yang ditampilkan adalah dinamis. Anda dapat mengarahkan mouse ke tempat tujuan dan melihat detail dan nilai pada titik tertentu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, beberapa sendok tar tidak bisa melakukannya. Pada grafik batang (berbeda dengan grafik dengan garis langkah), bagian tengah batang tidak di tengah hari, tetapi pada pukul 00:00. Itu setengah kiri kolom digambar di tempat hari sebelumnya. Jadi grafik untuk hari Sabtu dan Minggu ditarik sedikit ke kiri daripada zona kebiruan. Sampai saya menemukan cara untuk memenangkannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah lain adalah ketidakmampuan untuk bekerja dengan benar pada interval bulanan. </font><font style="vertical-align: inherit;">Faktanya adalah bahwa panjang jam / hari / minggu adalah tetap, tetapi panjang bulan berbeda setiap kali. </font><font style="vertical-align: inherit;">InfluxDB hanya dapat bekerja secara berkala. </font><font style="vertical-align: inherit;">Sejauh ini, otak saya sudah cukup untuk menetapkan interval tetap 30 hari. </font><font style="vertical-align: inherit;">Ya, grafik akan melayang sedikit sepanjang tahun dan kolom tidak akan persis sesuai dengan bulan. </font><font style="vertical-align: inherit;">Tapi karena hal ini menarik bagi saya hanya sebagai perangkat layar, maka saya setuju dengan itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melihat setidaknya dua solusi:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skor pada jadwal bulanan dan batasi hingga mingguan. </font><font style="vertical-align: inherit;">52 bar mingguan untuk tahun ini terlihat cukup bagus</font></font></li>
<li>     â„–2,       .     .          â€”    .</li>
</ul><br>
<br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak tahu mengapa, tetapi saya lamban pada jenis grafik seperti itu. Mereka menunjukkan bahwa hidup dalam ayunan penuh dan semuanya berubah. Kemarin banyak, hari ini tidak cukup, besok akan menjadi sesuatu yang lain. Masih bekerja dengan rumah tangga pada topik konsumsi. Tetapi bahkan dengan selera saat ini, hanya angka besar dan tidak bisa dipahami dalam pembayaran sudah berubah menjadi gambaran konsumsi yang cukup jelas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun hampir 20 tahun berkarier sebagai programmer, saya praktis tidak bersinggungan dengan database. Oleh karena itu, pemasangan basis data eksternal tampak sangat musykil dan tidak dapat dipahami. Semuanya diubah oleh </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel tersebut</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ternyata meniduri alat yang cocok dilakukan dalam beberapa klik, dan dengan alat khusus tugas grafik menjadi sedikit lebih mudah.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam tajuk utama, saya menyebutkan konsumsi listrik. </font><font style="vertical-align: inherit;">Sayangnya, saat ini saya tidak dapat memberikan grafik tunggal. </font><font style="vertical-align: inherit;">Satu penghitung SDM120 sudah mati, dan yang lainnya buggy saat mengakses melalui Modbus. </font><font style="vertical-align: inherit;">Namun, ini tidak mempengaruhi topik artikel ini - grafik akan dibuat dengan cara yang sama seperti untuk air. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini, saya mengutip pendekatan yang saya coba sendiri. </font><font style="vertical-align: inherit;">Tentunya ada beberapa cara lain untuk mengatur pengumpulan dan visualisasi data yang tidak saya ketahui. </font><font style="vertical-align: inherit;">Ceritakan pada saya di komentar, itu akan sangat menarik bagi saya. </font><font style="vertical-align: inherit;">Saya akan senang untuk membangun kritik dan ide-ide baru. </font><font style="vertical-align: inherit;">Saya berharap materi yang disajikan juga akan membantu seseorang.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id492298/index.html">Polygons Another World: IBM PC</a></li>
<li><a href="../id492302/index.html">Stand cerdas dengan smartphone untuk penguji - proyek startup dari akselerator Universitas ITMO</a></li>
<li><a href="../id492306/index.html">Lidars di CES</a></li>
<li><a href="../id492308/index.html">Neuron dan pemodelannya</a></li>
<li><a href="../id492312/index.html">Serialisasi avro di Kafka</a></li>
<li><a href="../id492318/index.html">Bagaimana coronavirus memengaruhi industri TI</a></li>
<li><a href="../id492320/index.html">Covid-19, masyarakat Anda dan Anda dalam hal ilmu data</a></li>
<li><a href="../id492322/index.html">Raspberry Pi + Fedora (aarch64) = Wi-Fi Hotspot (atau router raspberry dengan topi biru)</a></li>
<li><a href="../id492324/index.html">Kami membahas DAPATKAN IT Act - RUU AS baru yang dapat menyebabkan larangan enkripsi E2E</a></li>
<li><a href="../id492326/index.html">Analisis popularitas video YouTube dari peserta Eurovision 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>