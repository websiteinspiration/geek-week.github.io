<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>▶️ 🔸 👴🏽 約束のあるエレガントな非同期プログラミング 🛀🏿 🤱 🚰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！
 
 プロミス（プロミス）は、JavaScriptの比較的新しい機能であり、前のアクションが完了するまでアクションの実行を遅らせたり、失敗したアクションの実行に応答したりできます。これは、非同期操作のシーケンスの正しい決定に役立ちます。この記事では、プロミスの仕組み、Web APIでの...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>約束のあるエレガントな非同期プログラミング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488762/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロミス（プロミス）は、JavaScriptの比較的新しい機能であり、前のアクションが完了するまでアクションの実行を遅らせたり、失敗したアクションの実行に応答したりできます。</font><font style="vertical-align: inherit;">これは、非同期操作のシーケンスの正しい決定に役立ちます。</font><font style="vertical-align: inherit;">この記事では、プロミスの仕組み、Web APIでのプロミスの使用方法、独自のプロミスを作成する方法について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件：基本的なコンピューターリテラシー、JSの基礎に関する知識。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的：約束とは何か、どのように使用されるかを理解します。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約束とは何ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの最初の記事で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を簡単に確認し</font><font style="vertical-align: inherit;">ました。ここでは</font><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">約束</font></a><font style="vertical-align: inherit;">をより詳しく検討します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本質的に、promiseは操作の中間状態を表すオブジェクトです。将来的に結果が返されることを「約束」します。操作がいつ完了し、いつ結果が返されるかは正確にはわかりませんが、操作が完了すると、コードが結果に対して何らかの処理を行うか、エラーを適切に処理することが保証されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、非同期操作にかかる時間（それほど長くはかかりません！）は、その完了に対する即時の応答の可能性ほど関心がありません。そしてもちろん、残りのコードがブロックされていないことを知っておくのは良いことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も一般的なpromiseの1つは、promiseを返すWeb APIです。架空のビデオチャットアプリケーションを見てみましょう。アプリケーションには、ユーザーの友達のリストが表示されたウィンドウがあり、ユーザーの名前（またはアバター）の横にあるボタンをクリックすると、ビデオ通話が開始されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンハンドラは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">getUserMedia（）を</font></a><font style="vertical-align: inherit;">呼び出します</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーのカメラとマイクにアクセスします。 getUserMedia（）がユーザーにアクセス許可（デバイスの使用、ユーザーが複数のマイクまたはカメラを持っている場合に使用するデバイス、とりわけ音声通話のみ）を求める瞬間から、getUserMedia（）はユーザーの決定だけでなくリリースも期待しますデバイスが現在使用されている場合。また、ユーザーがすぐに応答しない場合があります。このすべてが時間の大きな遅延につながる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインスレッドからデバイスの使用許可を要求すると、ブラウザーはgetUserMedia（）が完了するまでブロックされます。それは受け入れられません。約束がないと、ユーザーがマイクとカメラの使用を許可するまで、ブラウザのすべてが「クリック不可」になります。したがって、ユーザーの決定を待って</font><font style="vertical-align: inherit;">ソース（カメラとマイク）から作成されたストリームの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaStream</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返す代わりに</font><font style="vertical-align: inherit;">、getUserMedia（）は、MediaStreamが利用可能になるとすぐに処理するという約束を返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオチャットアプリケーションのコードは次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span> <span class="hljs-title">CallButton</span>(<span class="hljs-params">evt</span>)</span>{<font></font>
    setStatusMessage(<span class="hljs-string">'Calling...'</span>)<font></font>
    navigator.mediaDevices.getUserMedia({<span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>})<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">chatStream</span> =&gt;</span> {<font></font>
        selfViewElem.srcObject = chatStream<font></font>
        chatStream.getTracks().forEach(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> myPeerConnection.addTrack(track, chatStream))<font></font>
        setStatusMessage(<span class="hljs-string">'Connected'</span>)<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {<font></font>
        setStatusMessage(<span class="hljs-string">'Failed to connect'</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数は、setStatusMessage（）を呼び出すことから始まり、メッセージ「Calling ...」を表示します。これは、呼び出しが行われようとしていることを示すインジケータとして機能します。次に、getUserMedia（）が呼び出され、ビデオとオーディオのトラックを含むストリームがリクエストされます。ストリームが形成されると、「セルフビュー」と呼ばれるカメラからのストリームを表示するビデオ要素がインストールされ、オーディオトラックが</font><font style="vertical-align: inherit;">別のユーザーへの接続である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTCPeerConnection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">追加され</font><font style="vertical-align: inherit;">ます。その後、ステータスが「接続済み」に更新されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
getUserMedia（）が失敗した場合、catchブロックが起動されます。 setStatusMessage（）を使用してエラーメッセージを表示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオストリームがまだ受信されていない場合でも、getUserMedia（）の呼び出しが返されることに注意してください。</font><font style="vertical-align: inherit;">handleCallButton（）関数がそれを呼び出したコードに制御を戻したとしても、getUserMedia（）が実行を完了するとすぐに、ハンドラーを呼び出します。</font><font style="vertical-align: inherit;">アプリケーションがブロードキャストの開始を「理解」するまで、getUserMedia（）はスタンバイモードになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注：これについて詳しくは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「信号とビデオ通話」の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事をご覧ください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この記事では、例で使用したコードよりも完全なコードを提供します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバック関数の問題</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
promiseが優れたソリューションである理由を理解するには、コールバックを作成する従来の方法を調べて、問題が何であったかを確認すると便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例として、ピザの注文を検討してください。</font><font style="vertical-align: inherit;">ピザの注文が成功するには、いくつかのステップが順番に実行されなければなりません。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詰め物を選択します。</font><font style="vertical-align: inherit;">長い間考えてみると時間がかかり、気が変わってカレーを注文すると失敗します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご注文を承ります。</font><font style="vertical-align: inherit;">ピザの調理には時間がかかり、レストランに必要な材料がない場合は失敗する可能性があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピザを買って食べます。</font><font style="vertical-align: inherit;">たとえば、注文の支払いができない場合、ピザの受け取りが失敗することがあります。</font></font></li>
</ol><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバック関数</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用する古いスタイルの疑似コードは次の</font><font style="vertical-align: inherit;">ようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{<font></font>
    placeOrder(toppings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{<font></font>
        collectOrder(order, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
            eatPizza(pizza)<font></font>
        }, failureCallback)<font></font>
    }, failureCallback)<font></font>
}, failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなコードは読みにくく、保守が困難です（しばしば「コールバックの地獄」または「コールバックの地獄」と呼ばれます）。</font><font style="vertical-align: inherit;">failureCallback（）関数は、各ネストレベルで呼び出す必要があります。</font><font style="vertical-align: inherit;">他にも問題があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは約束を使います</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
約束はコードをよりクリーンに、理解し、サポートしやすくします。</font><font style="vertical-align: inherit;">非同期のpromiseを使用して疑似コードを書き換えると、次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{
    <span class="hljs-keyword">return</span> placeOrder(toppings)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{
    <span class="hljs-keyword">return</span> collectOrder(order)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
    eatPizza(pizza)<font></font>
})<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これははるかに優れています-何が起こるかを確認します.1つの.catch（）ブロックを使用してすべてのエラーを処理します。関数はメインストリームをブロックしません（ピザを待っている間にビデオゲームをプレイできます）、各操作は前の操作が完了した後に実行されることが保証されています。</font><font style="vertical-align: inherit;">すべてのpromiseはpromiseを返すため、.thenチェーンを使用できます。</font><font style="vertical-align: inherit;">いいでしょう？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
矢印関数を使用すると、疑似コードをさらに簡略化できます。</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span><font></font>
    placeOrder(toppings)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span><font></font>
    collectOrder(order)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span><font></font>
    eatPizza(pizza)     <font></font>
)<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または次のようにも：</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span> placeOrder(toppings))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> collectOrder(order))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span> eatPizza(pizza))<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、（）=&gt; xが（）=&gt; {return x}と同じであるため機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うこともできます（関数は単にパラメーターを渡すため、階層化は必要ありません）。</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings().then(placeOrder).then(collectOrder).then(eatPizza).catch(failureCallback)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなコードは読みにくく、疑似コードよりも複雑な構成で使用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注：疑似コードは、今後の記事で説明するasync / awaitを使用して改善することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的に、プロミスはイベントリスナーに似ていますが、いくつかの違いがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約束は1回だけ実行されます（成功または失敗）。</font><font style="vertical-align: inherit;">操作の完了後に、2回実行したり、成功から失敗に切り替えたり、その逆を行ったりすることはできません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promiseが完了し、その結果を処理するためのコールバック関数を追加すると、関数が追加される前にイベントが発生したにもかかわらず、この関数が呼び出されます。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的なpromiseの構文：実際の例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのWeb APIは潜在的に複雑なタスクを実行する関数で約束を使用するため、約束を知ることは重要です。最新のWebテクノロジーを使用するには、プロミスを使用する必要があります。後で、独自のpromiseを作成する方法を学習しますが、ここでは、Web APIにあるいくつかの簡単な例を見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の例では、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetch（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドを使用</font><font style="vertical-align: inherit;">してネットワークから画像を取得し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blob（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を使用して応答本文のコンテンツを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blob</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブジェクトに変換し、</font><font style="vertical-align: inherit;">このオブジェクトを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;img&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素内に表示します</font><font style="vertical-align: inherit;">。この例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の記事の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例とよく似て</font><font style="vertical-align: inherit;">いますが、少し異なる方法で実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注：次の例は、単にファイルから実行した場合（つまり、file：// URLを使用した場合）は機能しません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルサーバー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubページ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのオンラインソリューションを使用</font><font style="vertical-align: inherit;">して実行する必要があり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.まず、</font><font style="vertical-align: inherit;">受け取る</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">アップロードし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">&lt;body&gt;の</font></a><font style="vertical-align: inherit;">最後に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要素</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">
3. &lt;script&gt;要素内に、次の行を追加します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise = fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータとして画像のURLを取得するfetch（）メソッドを使用して、ネットワークから画像を取得します。 2番目のパラメーターとして、設定でオブジェクトを指定できますが、ここでは単純なオプションに限定します。 fetch（）によって返されたpromiseをpromise変数に格納します。前述のように、promiseは中間状態を表すオブジェクトです。特定の状態の正式名称は保留中です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. promiseが正常に完了した結果（この場合、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Response</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がを返す</font><font style="vertical-align: inherit;">）を処理するために、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">.then（）</font></a><font style="vertical-align: inherit;">メソッドを呼び出します</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">.then（）ブロック内のコールバック関数（しばしばexecutorと呼ばれる）は、promiseが正常に完了し、Responseオブジェクトが返されたときにのみ起動されます-彼らは、promiseが完了した（フルフィルド、フルフィルド）と言います。</font><font style="vertical-align: inherit;">応答はパラメーターとして渡されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">.then（）ブロックの操作は、AddEventListener（）イベントリスナーの操作に似ています。</font><font style="vertical-align: inherit;">イベントが発生した後でのみ（promiseの実行後）トリガーされます。</font><font style="vertical-align: inherit;">2つの違いは、リスナーは複数の呼び出し用に設計されているのに対し、.then（）は1回しか呼び出せないことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
応答を受け取ったら、blob（）メソッドを呼び出して、応答をBlobオブジェクトに変換します。</font><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs">response =&gt; response.blob()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...これは以下の短いエントリーです：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>)</span>{
    <span class="hljs-keyword">return</span> response.blob()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK、十分な言葉。</font><font style="vertical-align: inherit;">最初の行の後に以下を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise2 = promise.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. .then（）を呼び出すたびに、新しいプロミスが作成されます。</font><font style="vertical-align: inherit;">これは非常に便利です。blob（）もpromiseを返すため、2番目のpromiseで.then（）を呼び出すことでBlobオブジェクトを処理できます。</font><font style="vertical-align: inherit;">メソッドを呼び出して結果を返すよりも複雑なことをしたいので、関数の本体を中括弧で囲む必要があります（そうしないと、例外がスローされます）：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの最後に次を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise3 = promise2.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.実行中の関数の本体を埋めましょう。</font><font style="vertical-align: inherit;">中かっこに次の行を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
<span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image.src = objectURL<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、URL.createObjectURL（）メソッドを呼び出して、2番目のpromiseを返すBlobパラメータとして渡します。</font><font style="vertical-align: inherit;">オブジェクトへのリンクを取得します。</font><font style="vertical-align: inherit;">次に、&lt;img&gt;要素を作成し、src属性にオブジェクトリンクの値を設定し、それをDOMに追加して、画像がページに表示されるようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTMLを保存してブラウザーにロードすると、期待どおりに画像が表示されます。</font><font style="vertical-align: inherit;">よくやった！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">これらの例は多少不自然であることに気づいたでしょう。</font><font style="vertical-align: inherit;">fetch（）メソッドとblob（）メソッドを使用せずに、&lt;img&gt;に対応するURL、coffee.jpgを割り当てることができます。</font><font style="vertical-align: inherit;">この方法で、簡単な例を使用してPromiseの操作を説明しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失敗応答</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何かを忘れました-promiseの1つが失敗した（拒否される）場合のエラーハンドラーがありません。</font><font style="vertical-align: inherit;">.catch（）メソッドを使用してエラーハンドラーを追加できます。</font><font style="vertical-align: inherit;">そうしよう：</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> errorCase = promise3.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この動作を確認するには、間違った画像URLを指定して、ページをリロードしてください。</font><font style="vertical-align: inherit;">エラーメッセージがコンソールに表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、.catch（）ブロックを追加しないと、コンソールにエラーメッセージも表示されます。</font><font style="vertical-align: inherit;">ただし、.catch（）を使用すると、エラーを思いどおりに処理できます。</font><font style="vertical-align: inherit;">実際のアプリケーションでは、.catch（）ブロックが画像を再取得するか、デフォルトの画像を表示するか、ユーザーに別の画像を選択するか、何か他のことをするよう依頼する場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">時計の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックのマージ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、コードの記述に使用したアプローチは最適ではありません。</font><font style="vertical-align: inherit;">各段階で何が起こっているかを理解できるように、私たちは意図的にこの方法を採用しました。</font><font style="vertical-align: inherit;">前に示したように、.then（）ブロック（および.catch（）ブロック）を組み合わせることができます。</font><font style="vertical-align: inherit;">コードは次のように書き換えることができます（</font><font style="vertical-align: inherit;">GitHubの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-chained.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も参照してください</font><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
promiseから返された値は、.then（）ブロックの次の関数エグゼキューターにパラメーターとして渡されることに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">promiseの.then（）/。catch（）ブロックは、同期try ... catchブロックの非同期の同等物です。</font><font style="vertical-align: inherit;">注意：同期try ... catchは非同期コードでは機能しません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約束の用語の結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在庫を取り、将来使用できる短いガイドを書いてみましょう。</font><font style="vertical-align: inherit;">知識を統合するために、前のセクションを数回読むことをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.約束が作成されたとき、彼らはそれが期待の状態にあると言います。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.約束が戻されると、彼らはそれが完了した（解決された）と言います：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.正常に完了したプロミスは履行済みと呼ばれます。</font><font style="vertical-align: inherit;">これは、promiseの最後に.then（）からチェーンを介して取得できる値を返します。</font><font style="vertical-align: inherit;">.then（）ブロックの実行中の関数には、promiseによって返された値が含まれています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.失敗した約束は拒否されたと呼ばれます。</font><font style="vertical-align: inherit;">理由、つまり約束の拒否につながったエラーメッセージが返されます。</font><font style="vertical-align: inherit;">この理由は、Promiseの最後にある.catch（）ブロックを通じて取得できます。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの約束の後でコードを実行する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promiseの使用の基本を学びました。次に、より高度な機能を見てみましょう。 .then（）からのチェーンは問題ありませんが、複数のpromiseブロックを1つずつ呼び出したい場合はどうでしょうか。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、標準のPromise.all（）メソッドを使用して行うことができます。このメソッドは、promiseの配列をパラメーターとして取り、配列内のすべてのpromiseが満たされたときに新しいpromiseを返します。次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([a,b,c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
        ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのpromiseが満たされた場合、.then（）ブロックの配列エグゼキューターがパラメーターとして渡されます。少なくとも1つの約束が満たされない場合、ブロック全体が拒否されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは非常に役立ちます。ユーザーインターフェイスにページのコンテンツを動的に入力するための情報を受け取ったとします。多くの場合、すべての情報を受け取ってページに表示する方が、情報を部分的に表示するよりも後のほうが合理的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の例を見てみましょう</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページテンプレート</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">ダウンロード</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">し</font></a><font style="vertical-align: inherit;">、終了タグ&lt;/ body&gt;の前に&lt;script&gt;タグを配置します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.ソースファイル（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coffee.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tea.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">description.txt）を</font></a><font style="vertical-align: inherit;">ダウンロードします。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）またはあなたのものと交換してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.スクリプトでは、最初にPromise.all（）に渡すpromiseを返す関数を定義します。</font><font style="vertical-align: inherit;">これは、3つのfetch（）オペレーションの完了後にPromise.all（）を実行すると簡単に実行できます。</font><font style="vertical-align: inherit;">次のことができます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> a = fetch(url1)
<span class="hljs-keyword">let</span> b = fetch(url2)
<span class="hljs-keyword">let</span> c = fetch(url3)<font></font>
<font></font>
<span class="hljs-built_in">Promise</span>.all([a, b, c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
    ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
promiseが満たされると、「values」変数には、完了した各fetch（）オペレーションから1つずつ、3つのResponseオブジェクトが含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これは望ましくありません。</font><font style="vertical-align: inherit;">fetch（）オペレーションがいつ完了してもかまいません。</font><font style="vertical-align: inherit;">本当に必要なのはロードされたデータです。</font><font style="vertical-align: inherit;">これは、画像と有効なテキスト文字列を表す有効なblobを受け取った後で、Promise.all（）ブロックを実行することを意味します。</font><font style="vertical-align: inherit;">これを行う関数を書くことができます。</font><font style="vertical-align: inherit;">以下を&lt;script&gt;要素に追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation '</span> + e.message)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少し複雑に見えるので、コードを1つずつ見ていきましょう</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。1.まず、関数を宣言し、URLと結果のファイルのタイプを渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.関数の構造は、最初の例で見たものと似ています。fetch（）関数を呼び出して、特定のURLにあるファイルを取得し、デコードされた（読み取り）応答本文を返す別のpromiseにファイルを転送します。</font><font style="vertical-align: inherit;">前の例では、これは常にblob（）メソッドでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. 2つの違いがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初に、2番目のリターンプロミスは値のタイプによって異なります。</font><font style="vertical-align: inherit;">実行中の関数内では、if ... else ifステートメントを使用して、デコードする必要があるファイルのタイプに応じてpromiseを返します（この場合、blobとテキストのどちらかを選択しますが、例は他のタイプで機能するように簡単に拡張できます）。</font></font></li>
<li>-,     «return»   fetch().       ,     (..   ,  blob()  text(),  ,  ,   ).  ,  return     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.最後に、.catch（）メソッドを呼び出して、.all（）に渡された配列のpromiseで発生する可能性のあるエラーを処理します。いずれかの約束が拒否された場合、catchブロックは問題がどのような約束であったかを知らせます。 .all（）ブロックは引き続き実行されますが、エラーが発生した結果は表示されません。 .all（）を拒否する場合は、末尾に.catch（）ブロックを追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数内のコードは非同期で、promiseに基づいているため、関数全体がpromiseのように機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.次に、関数を3回呼び出して、画像とテキストの受信とデコードのプロセスを開始し、各プロミスを変数に入れます。以下を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.次に、Promise.all（）ブロックを宣言して、3つすべてのPromiseが満たされた後にのみコードを実行します。</font><font style="vertical-align: inherit;">.then（）内に空のexecutor関数を含むブロックを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([coffee, tea, description]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータとしてpromiseの配列を受け取ることがわかります。</font><font style="vertical-align: inherit;">請負業者は、3つの約束がすべて満たされた後にのみ開始します。</font><font style="vertical-align: inherit;">これが発生すると、各promiseの結果（デコードされた応答本文）が配列に配置されます。これは、[coffee-results、tea-results、description-results]として表すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.最後に、以下をエグゼキューターに追加します（ここでは、かなり単純な同期コードを使用して結果を変数に入れ（BLOBからURLオブジェクトを作成）、ページに画像とテキストを表示します）。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(values)
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
<span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
<span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
<span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image1.src = objectURL1<font></font>
image2.src = objectURL2<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image1)
<span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
para.textContent = descText<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(para)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更を保存してページを再読み込みします。すべてのユーザーインターフェイスコンポーネントが読み込まれていることがわかりますが、あまり魅力的ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。問題がある場合は、コードのバージョンを当社のバージョンと比較でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードがあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。このコードを改善するために、表示された要素をループし、それぞれを受信およびデコードしてから、Promise.all（）内の結果をループし、タイプに応じてさまざまな関数を起動して各結果を表示できます。これにより、任意の数の要素を操作できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、typeプロパティを明示的に指定しなくても、結果のファイルのタイプを判別できます。これは、例えば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPプロトコルの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Type</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダーを確認</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">ための</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">response.headers.get（ 'content-type'）</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">約束を満たした/拒否した後にコードを実行する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、プロミスが実行されたか拒否されたかに関係なく、プロミスの完了後にコードを実行する必要がある場合があります。</font><font style="vertical-align: inherit;">以前は、次のように、.then（）ブロックと.catch（）ブロックの両方に同じコードを含める必要がありました。</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
    runFinalCode()<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のブラウザーでは、.finally（）メソッドを使用できます。これにより、Promiseの完了後にコードを実行できるため、繰り返しを避け、コードをより洗練されたものにすることができます。</font><font style="vertical-align: inherit;">前の例のコードは、次のように書き換えることができます。</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
})<font></font>
.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチの使用方法は、実際の例- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモpromise-finally.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で確認できます。</font><font style="vertical-align: inherit;">前の例のPromise.all（）と同じように機能しますが、fetchAndDecode（）関数でチェーンの最後にfinally（）を追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`There has been a problem with your fetch operation for resource "<span class="hljs-subst">${url}</span>": <span class="hljs-subst">${e.message}</span>`</span>)<font></font>
    }).finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`fetch attempt for "<span class="hljs-subst">${url}</span>" finished.`</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルを取得する各試行の完了に関するメッセージを受け取ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">次に、（）/ catch（）/ finally（）は、同期try（）/ catch（）/ finally（）と非同期で同等です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自分の約束を書く</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
良い知らせは、あなたはすでにそれを行う方法を知っているということです。</font><font style="vertical-align: inherit;">複数のpromiseを.then（）と組み合わせるか、それらを組み合わせて特定の機能を提供する場合、独自の非同期およびpromiseベースの関数を作成します。</font><font style="vertical-align: inherit;">前の例のfetchAndDecode（）関数を例にとります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまなpromiseベースのAPIを組み合わせて特定の機能を作成することは、promiseを処理する最も一般的な方法であり、最新のAPIの柔軟性と能力を示しています。</font><font style="vertical-align: inherit;">ただし、別の方法があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンストラクタの約束（）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promise（）コンストラクターを使用して、独自のpromiseを作成できます。これは、「オーバーサイズ」する必要がある古い非同期APIからのコードがある状況で必要になる場合があります。これは、既存の古いコード、ライブラリ、または「フレームワーク」と新しいプロミスベースのコードの両方を同時に処理できるようにするために行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単な例を見てみましょう。ここでは、setTimeout（）呼び出しをpromiseでラップしています。これにより、関数が2秒で開始され、文字列「Success！」で（resolve（）呼び出しを使用して）promiseが実行されます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        resolve(<span class="hljs-string">'Success!'</span>)<font></font>
    }, <span class="hljs-number">2000</span>)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
resolve（）およびreject（）は、新しいプロミスを実行または拒否するために呼び出される関数です。</font><font style="vertical-align: inherit;">この場合、約束は文字列「Success！」で満たされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このpromiseを呼び出すときに、それに.then（）ブロックを追加して、「Success！」行をさらに操作できます。</font><font style="vertical-align: inherit;">したがって、メッセージに1行出力できます。</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise<font></font>
.then(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {<font></font>
    alert(message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... とか、ぐらい：</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise.then(alert)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時計の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブデモ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与えられた例はそれほど柔軟ではありません-promiseは単純な行でのみ満たすことができ、エラーハンドラーはありません-reject（）（実際にはsetTimeout（）はエラーハンドラーを必要としないため、この場合は問題になりません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">なぜ（）ではなく（）を解決するのですか？</font><font style="vertical-align: inherit;">現時点では、答えはこれです：説明するのは難しいです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは約束の拒否に取り組みます</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
reject（）メソッドを使用して拒否されたプロミスを作成できます-resolve（）と同じように、reject（）は単純な値を取りますが、resolve（）とは異なり、単純な値は結果ではなく、拒否の理由、つまり </font><font style="vertical-align: inherit;">.catch（）ブロックに渡されるエラー。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例を拡張して、promiseを拒否するための条件と、成功メッセージ以外のメッセージを受信する機能を追加します。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">前の例を見て</font></a><font style="vertical-align: inherit;">、次のように書き直して</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ください</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">message, interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span>(message === <span class="hljs-string">''</span> || <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>){<font></font>
            reject(<span class="hljs-string">'Message is empty or not a string'</span>)<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(interval &lt; <span class="hljs-number">0</span> || <span class="hljs-keyword">typeof</span> interval !== number){<font></font>
            reject(<span class="hljs-string">'Interval is negative or not a number'</span>)<font></font>
        } <span class="hljs-keyword">else</span>{<font></font>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
                resolve(message)<font></font>
            }, interval)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、関数に2つの引数を渡します-メッセージと間隔（時間遅延）。</font><font style="vertical-align: inherit;">関数では、Promiseオブジェクトを返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promiseコンストラクターでは、if ... else構造を使用していくつかのチェックを実行します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、メッセージを確認します。</font><font style="vertical-align: inherit;">空であるか文字列でない場合は、promiseを拒否してエラーを報告します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、時間遅延をチェックします。</font><font style="vertical-align: inherit;">負の数または数値でない場合は、約束を拒否してエラーを報告します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、両方の引数に問題がなければ、setTimeout（）を使用して、一定時間（間隔）後にメッセージを表示します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
timeoutPromise（）はpromiseを返すため、.then（）、. catch（）などを追加して機能を向上させることができます。</font><font style="vertical-align: inherit;">そうしよう：</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise(<span class="hljs-string">'Hello there!'</span>, <span class="hljs-number">1000</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {<font></font>
    alert(message)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: '</span> + e)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更を保存してコードを実行すると、1秒後にメッセージが表示されます。</font><font style="vertical-align: inherit;">次に、空の文字列をメッセージとして渡すか、負の数を間隔として渡します。</font><font style="vertical-align: inherit;">約束を拒否した結果、エラーメッセージが表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意。</font><font style="vertical-align: inherit;">この例のバージョンは、GitHub- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom-promise2.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）にあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より現実的な例。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検討した例では、概念を簡単に理解できますが、完全に非同期ではありません。この例の非同期はsetTimeout（）を使用してシミュレートされていますが、合理的なワークフローや適切なエラー処理などを備えた関数を作成するためのpromiseの有用性は依然として示されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promise（）コンストラクターを使用する便利な非同期アプリケーションの一例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idbライブラリー（使いやすさを備えたIndexedDB）です。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ジェイク・アーチボルド。</font><font style="vertical-align: inherit;">このライブラリを使用すると、Promiseを使用して、古いスタイルで記述されたIndexedDB API（クライアント側でデータを格納および取得するためのAPIコールバック関数に基づく）を使用できます。</font><font style="vertical-align: inherit;">メインライブラリファイルを見ると、上で調べたのと同じ手法を使用していることがわかります。</font><font style="vertical-align: inherit;">次のコードは、多くのIndexedDBメソッドで使用される基本的なクエリモデルをpromise互換モデルに変換します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisifyRequest</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>)</span>{<font></font>
        request.onsuccess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(request.result)<font></font>
        }<font></font>
<font></font>
        request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            reject(request.error)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、必要に応じて、promiseを実行または拒否するいくつかのイベントハンドラーが追加されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエスト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が成功する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、成功ハンドラはリクエストの結果でpromiseを実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエスト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が失敗する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、onerrorハンドラーはリクエストのエラーを含むpromiseを拒否します。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promiseは、関数が返す値や関数にかかる時間がわからない場合に、非同期アプリケーションを作成する優れた方法です。これらを使用すると、深くネストされたコールバック関数を使用せずに一連の非同期操作を処理でき、同期try ... catchステートメントのエラー処理スタイルをサポートします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Promiseは最新のすべてのブラウザでサポートされています。 1つの例外は、Opera MiniとIE11、およびその以前のバージョンです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、Promiseのすべての機能からはほど遠く、最も興味深く有用な機能のみを検討しました。 Promiseについて詳しく知りたい場合は、他の機能やテクニックについても学びます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のWeb APIのほとんどはプロミスに基づいているため、プロミスを知る必要があります。</font><font style="vertical-align: inherit;">これらのWeb APIの中で、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Audio API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Media Capture and Streams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの</font><font style="vertical-align: inherit;">名前を付けることができます</font><font style="vertical-align: inherit;">。プロミスはますます人気が高まるため、それらの研究と理解は、最新のJavaScriptを習得するための重要なステップです。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">「誰もが知っておくべきJavaScriptの約束の一般的な間違い」</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
も参照してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
清聴ありがとうございました。</font><font style="vertical-align: inherit;">
建設的な批判は大歓迎です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488750/index.html">恐竜ウォーク：20世紀の2台の大型コンピューター</a></li>
<li><a href="../ja488752/index.html">Golang + Phaser3 = MMORPG-私たちは世界の無限の世代の基盤を作ります</a></li>
<li><a href="../ja488754/index.html">一括：バンドルサイズの自動チェック</a></li>
<li><a href="../ja488756/index.html">新しいgooglesheets4パッケージを使用してRでGoogle Sheets API（Google Sheets API v4）を操作する方法</a></li>
<li><a href="../ja488758/index.html">DEFCON会議27.インターネット詐欺の認識</a></li>
<li><a href="../ja488766/index.html">アートとテクノロジー：マサチューセッツ大学ローウェル校</a></li>
<li><a href="../ja488768/index.html">血まみれの地獄、または英語で培養された人と間違われると誓う方法</a></li>
<li><a href="../ja488770/index.html">KOMPAS-3D APIの操作→レッスン17→テキストドキュメント</a></li>
<li><a href="../ja488776/index.html">Visual Studio 2019 for Macのアクセシビリティの強化</a></li>
<li><a href="../ja488778/index.html">データ構造：すべてを実行できるリスト*</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>