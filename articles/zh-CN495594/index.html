<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚣🏻 🤰🏻 🕵🏿 开始在软件上赚钱：创建小型数字业务 🎧 🏆 👩🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="坐在自由职业者上，我多次看到收集数据库的任务。他们最经常要求在Google Yandex地图上收集有关公司或特定要求的信息。
 
 有需求，让我们创建要约，但首先要做的是。
 
 在本文中，我建议开发一个Telegram机器人，该机器人将使用城市名称（将在其中进行搜索）和一个请求（将通过其进行搜索，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>开始在软件上赚钱：创建小型数字业务</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495594/"><img src="https://habrastorage.org/webt/hn/do/t7/hndot78f5tlzjqujos6-i7j8mnu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
坐在自由职业者上，我多次看到收集数据库的任务。</font><font style="vertical-align: inherit;">他们最经常要求在Google Yandex地图上收集有关公司或特定要求的信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有需求，让我们创建要约，但首先要做的是。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我建议开发一个Telegram机器人，该机器人将使用城市名称（将在其中进行搜索）和一个请求（将通过其进行搜索，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如：酒吧，咖啡厅，餐厅等）。</font><font style="vertical-align: inherit;">我们意识到有机会进行捐赠，为收集数据库付费并通过邮件数据库将其发送给客户。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
二手技术：</font></font><br>
<br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电报API;</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex API；</font></font></a></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">付款API。</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择这些技术或工具是为了易于使用，具有快速实施和自动化任务的能力。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该程序不是商业性的。</font><font style="vertical-align: inherit;">作为一个例子实现 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex规则</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁止保存数据</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于规则和法律，可以说同样的话：与其说是通过遵守，不如说是通过违反来证明它们的多重性。</font><font style="vertical-align: inherit;">©Dube</font></font></blockquote></blockquote><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">训练</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了方便起见，我们将项目分为3个文件。</font><font style="vertical-align: inherit;">创建</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bot.py</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yandex.py</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send_email.py</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实作</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.py</font></font></b><div class="spoiler_text"><ul>
<li> :<br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> xlwt, xlrd
<span class="hljs-keyword">from</span> xlutils.copy <span class="hljs-keyword">import</span> copy <span class="hljs-keyword">as</span> xlcopy</code></pre><br>
</li>
<li>   Yandex API  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> ,     .    <i><b>maps api</b></i>  <i><b>location api</b></i> .<br>
 api :<br>
<pre><code class="python hljs">apikey = <span class="hljs-string">'*******-***-****-****-************'</span>
apikey_location = <span class="hljs-string">'********-****-****-****-************'</span></code></pre><br>
</li>
<li>  -  :<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sum_taken_object</span>(<span class="hljs-params">all_informations</span>):</span>
    <span class="hljs-keyword">try</span>:<font></font>
        found = str(all_informations[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'ResponseMetaData'</span>][<span class="hljs-string">'SearchResponse'</span>][<span class="hljs-string">'found'</span>])
    <span class="hljs-keyword">except</span> KeyError:<font></font>
        found = <span class="hljs-string">'-'</span>
    <span class="hljs-keyword">return</span> found</code></pre><br>
</li>
<li>  :<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_all_infomations</span>(<span class="hljs-params">text, city</span>):</span><font></font>
    value_low_upp, point = get_location(city)<font></font>
    low = value_low_upp[<span class="hljs-number">0</span>].split(<span class="hljs-string">','</span>)<font></font>
    upp = value_low_upp[<span class="hljs-number">1</span>].split(<span class="hljs-string">','</span>)<font></font>
    informations = requests.get(<span class="hljs-string">'https://search-maps.yandex.ru/v1/?'</span>
                                <span class="hljs-string">'apikey='</span>+apikey+<span class="hljs-string">'&amp;'</span>
                                <span class="hljs-string">'text='</span>+text+<span class="hljs-string">'&amp;'</span>
                                <span class="hljs-string">'lang=ru_RU&amp;'</span>
                                <span class="hljs-string">'ll='</span>+point[<span class="hljs-number">0</span>]+<span class="hljs-string">'&amp;'</span>
                                <span class="hljs-string">'bbox='</span>+low[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+low[<span class="hljs-number">0</span>]+<span class="hljs-string">'~'</span>+upp[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+upp[<span class="hljs-number">0</span>]+<span class="hljs-string">'&amp;'</span>
                                <span class="hljs-string">'results=500'</span>)
    <span class="hljs-keyword">return</span> informations.json()</code></pre>  <i><b>requests.get</b></i>  <i><b>bbox</b></i>     ,  <i><b>ll</b></i>    .     <i><b>ll</b></i>  <i><b>bbox</b></i>,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>.<br>
<blockquote> ,   500    . <blockquote>        - 500, .   .</blockquote></blockquote><br>
</li>
<li>   :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_location</span>(<span class="hljs-params">city</span>):</span>
    location = requests.get(<span class="hljs-string">'https://geocode-maps.yandex.ru/1.x/?'</span>
                            <span class="hljs-string">'apikey='</span>+apikey_location+<span class="hljs-string">'&amp;'</span>
                            <span class="hljs-string">'geocode='</span>+city.title()+<span class="hljs-string">'&amp;'</span>
                            <span class="hljs-string">'format=json'</span>)<font></font>
    loc = location.json()<font></font>
    loc = loc[<span class="hljs-string">'response'</span>][<span class="hljs-string">'GeoObjectCollection'</span>][<span class="hljs-string">'featureMember'</span>]<font></font>
    point = loc[<span class="hljs-number">0</span>][<span class="hljs-string">'GeoObject'</span>][<span class="hljs-string">'Point'</span>][<span class="hljs-string">'pos'</span>].split()<font></font>
    value_lower = loc[<span class="hljs-number">0</span>][<span class="hljs-string">'GeoObject'</span>][<span class="hljs-string">'boundedBy'</span>][<span class="hljs-string">'Envelope'</span>][<span class="hljs-string">'lowerCorner'</span>].split()<font></font>
    value_upper = loc[<span class="hljs-number">0</span>][<span class="hljs-string">'GeoObject'</span>][<span class="hljs-string">'boundedBy'</span>][<span class="hljs-string">'Envelope'</span>][<span class="hljs-string">'upperCorner'</span>].split()<font></font>
    value_low_upp = [value_lower[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+value_lower[<span class="hljs-number">0</span>], value_upper[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+value_upper[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">return</span> value_low_upp, point</code></pre>       .<br>
</li>
<li>  - :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_information_limit</span>(<span class="hljs-params">text,city</span>):</span><font></font>
    value_low_upp, point = get_location(city)<font></font>
    low = value_low_upp[<span class="hljs-number">0</span>].split(<span class="hljs-string">','</span>)<font></font>
    upp = value_low_upp[<span class="hljs-number">1</span>].split(<span class="hljs-string">','</span>)<font></font>
    info = requests.get(<span class="hljs-string">'https://search-maps.yandex.ru/v1/?'</span>
                        <span class="hljs-string">'apikey='</span>+apikey+<span class="hljs-string">'&amp;'</span>
                        <span class="hljs-string">'text='</span>+text+<span class="hljs-string">'&amp;'</span>
                        <span class="hljs-string">'lang=ru_RU&amp;'</span>
                        <span class="hljs-string">'ll='</span>+point[<span class="hljs-number">0</span>]+<span class="hljs-string">'&amp;'</span>
                        <span class="hljs-string">'bbox='</span>+low[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+low[<span class="hljs-number">0</span>]+<span class="hljs-string">'~'</span>+upp[<span class="hljs-number">1</span>]+<span class="hljs-string">','</span>+upp[<span class="hljs-number">0</span>]+<span class="hljs-string">'&amp;'</span>
                        <span class="hljs-string">'results=5&amp;'</span>
                        <span class="hljs-string">'skip=5'</span>)<font></font>
    information = info.json()<font></font>
    information = information[<span class="hljs-string">'features'</span>]<font></font>
    list = {}<font></font>
    i = <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> information:
        <span class="hljs-keyword">try</span>:<font></font>
            coordinates = str(key[<span class="hljs-string">'geometry'</span>][<span class="hljs-string">'coordinates'</span>])
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            coordinates = <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">try</span>:<font></font>
            name = str(key[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'name'</span>])
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            name = <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">try</span>:<font></font>
            address = str(key[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'address'</span>])
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            address = <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">try</span>:<font></font>
            url = str(key[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'url'</span>])
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            url = <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">try</span>:<font></font>
            phones = key[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'Phones'</span>]
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            phones = <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">try</span>:<font></font>
            hours = str(key[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'Hours'</span>][<span class="hljs-string">'text'</span>])
        <span class="hljs-keyword">except</span> KeyError:<font></font>
            hours = <span class="hljs-string">'-'</span><font></font>
<font></font>
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> phones:
            <span class="hljs-keyword">try</span>:<font></font>
                phones = k[<span class="hljs-string">'formatted'</span>]
            <span class="hljs-keyword">except</span> TypeError:
                <span class="hljs-keyword">pass</span><font></font>
<font></font>
        list[<span class="hljs-string">'object'</span>+str(i)] = {<span class="hljs-string">'coordinates'</span>:coordinates,<span class="hljs-string">'name'</span>:name,<span class="hljs-string">'address'</span>:address,<span class="hljs-string">'url'</span>:url,<span class="hljs-string">'phones'</span>:phones,<span class="hljs-string">'hours'</span>:hours}<font></font>
        i += <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> list</code></pre>     <b>5</b> .    - ,      <i><b>resul</b></i>, <i><b>skip</b></i>   <i><b>requests.get</b></i>. <br>
</li>
<li>    Excel :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_exl</span>(<span class="hljs-params">text, city_name</span>):</span>
    <span class="hljs-keyword">try</span>:<font></font>
        name_excel_BD = creat_excel_file(name=<span class="hljs-string">'{}_{}'</span>.format(text, city_name))<font></font>
        read_book = xlrd.open_workbook(name_excel_BD)  <span class="hljs-comment">#   </span>
        write_book = xlcopy(read_book)  <span class="hljs-comment">#    ,      </span>
        write_sheet = write_book.get_sheet(<span class="hljs-number">0</span>)  <span class="hljs-comment">#     </span>
        <span class="hljs-comment"># index = read_book.sheet_by_index(0).nrows #   </span>
        url_maps = <span class="hljs-string">'https://yandex.ru/maps/org/'</span><font></font>
        info = get_all_infomations(text=text, city=city_name)<font></font>
<font></font>
        <span class="hljs-keyword">for</span> number, inf <span class="hljs-keyword">in</span> enumerate(info[<span class="hljs-string">'features'</span>]):
            <span class="hljs-keyword">try</span>:<font></font>
                name_object = inf[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'name'</span>]
            <span class="hljs-keyword">except</span> KeyError:<font></font>
                name_object = <span class="hljs-string">'-'</span>
            <span class="hljs-keyword">try</span>:<font></font>
                address = inf[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'address'</span>]
            <span class="hljs-keyword">except</span> KeyError:<font></font>
                address = <span class="hljs-string">'-'</span>
            <span class="hljs-keyword">try</span>:<font></font>
                time_work = inf[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'Hours'</span>][<span class="hljs-string">'text'</span>]
            <span class="hljs-keyword">except</span> KeyError:<font></font>
                time_work = <span class="hljs-string">'-'</span>
            <span class="hljs-keyword">try</span>:<font></font>
                id_organization = inf[<span class="hljs-string">'properties'</span>][<span class="hljs-string">'CompanyMetaData'</span>][<span class="hljs-string">'id'</span>]
            <span class="hljs-keyword">except</span> KeyError:<font></font>
                id_organization = <span class="hljs-string">'-'</span><font></font>
<font></font>
            write_sheet.write(int(number), <span class="hljs-number">0</span>, city_name)  <span class="hljs-comment"># </span>
            write_sheet.write(int(number), <span class="hljs-number">1</span>, name_object)  <span class="hljs-comment">#  </span>
            write_sheet.write(int(number), <span class="hljs-number">2</span>, address)  <span class="hljs-comment"># </span>
            write_sheet.write(int(number), <span class="hljs-number">3</span>, time_work)  <span class="hljs-comment">#  </span>
            write_sheet.write(int(number), <span class="hljs-number">4</span>, url_maps + str(id_organization))  <span class="hljs-comment"># Url  </span>
        write_book.save(name_excel_BD)  <span class="hljs-comment">#  </span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, name_excel_BD
    <span class="hljs-keyword">except</span> TypeError <span class="hljs-keyword">or</span> KeyError <span class="hljs-keyword">as</span> err:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre><br>
</li>
<li>  Excel:<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">creat_excel_file</span>(<span class="hljs-params">name</span>):</span>
    book = xlwt.Workbook(<span class="hljs-string">'utf8'</span>)<font></font>
    book.add_sheet(<span class="hljs-string">'_{}'</span>.format(name))<font></font>
    book.save(<span class="hljs-string">'BD_{}.xls'</span>.format(name))
    <span class="hljs-keyword">return</span> <span class="hljs-string">'BD_{}.xls'</span>.format(name)</code></pre><br>
</li>
</ul><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send_email.py</font></font></b><div class="spoiler_text"><ul>
<li> :<br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment">#   coding: utf8</span><font></font>
<font></font>
<span class="hljs-keyword">from</span> smtplib <span class="hljs-keyword">import</span> SMTP_SSL
<span class="hljs-keyword">from</span> email.mime.multipart <span class="hljs-keyword">import</span> MIMEMultipart
<span class="hljs-keyword">from</span> email.mime.base <span class="hljs-keyword">import</span> MIMEBase
<span class="hljs-keyword">from</span> email <span class="hljs-keyword">import</span> encoders
<span class="hljs-keyword">import</span> os</code></pre><br>
</li>
<li>     :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_mail</span>(<span class="hljs-params">name_file, to_address</span>):</span><font></font>
    filepath = name_file<font></font>
    address_from = <span class="hljs-string">"********@gmail.com"</span><font></font>
    address_to = to_address<font></font>
    password = <span class="hljs-string">'************'</span>
    mail_adr = <span class="hljs-string">'smtp.gmail.com'</span>
    mail_port = <span class="hljs-number">465</span><font></font>
<font></font>
    <span class="hljs-comment"># Compose attachment</span>
    part = MIMEBase(<span class="hljs-string">'application'</span>, <span class="hljs-string">"octet-stream"</span>)<font></font>
    part.set_payload(open(filepath, <span class="hljs-string">"rb"</span>).read())<font></font>
    encoders.encode_base64(part)<font></font>
    part.add_header(<span class="hljs-string">'Content-Disposition'</span>, <span class="hljs-string">"attachment"</span>, filename=<span class="hljs-string">"%s"</span> % os.path.basename(filepath))<font></font>
<font></font>
    <span class="hljs-comment"># Compose message</span><font></font>
    msg = MIMEMultipart()<font></font>
    msg[<span class="hljs-string">'From'</span>] = address_from<font></font>
    msg[<span class="hljs-string">'To'</span>] = address_to<font></font>
    msg.attach(part)<font></font>
<font></font>
    <span class="hljs-comment"># Send mail</span><font></font>
    smtp = SMTP_SSL(mail_adr)<font></font>
    smtp.set_debuglevel(<span class="hljs-number">1</span>)<font></font>
    smtp.connect(host=mail_adr, port=mail_port)<font></font>
    smtp.login(address_from, password)<font></font>
    smtp.sendmail(address_from, address_to, msg.as_string())<font></font>
    smtp.quit()</code></pre>    Gmail,        Google –    «<b> ,      </b>»  ,         Gmail.<img src="https://habrastorage.org/webt/kc/zw/qy/kczwqy_gvegqyv85jjvak_ekrx4.png"><br>
</li>
</ul><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bot.py</font></font></b><div class="spoiler_text"><ul>
<li> :<br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> telebot
<span class="hljs-keyword">from</span> telebot.types <span class="hljs-keyword">import</span> LabeledPrice
<span class="hljs-keyword">import</span> re<font></font>
<font></font>
<span class="hljs-keyword">import</span> yandex
<span class="hljs-keyword">from</span> send_email <span class="hljs-keyword">import</span> send_mail</code></pre><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> token    :<br>
<br>
<pre><code class="python hljs">token = <span class="hljs-string">'*********:**********************************'</span>
bot = telebot.TeleBot(token)</code></pre><br>
</li>
<li>  :<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">@bot.message_handler(commands=['start', 'donation'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_welcom</span>(<span class="hljs-params">message</span>):</span>
    <span class="hljs-keyword">if</span> message.text == <span class="hljs-string">'/start'</span>:<font></font>
        keyboard = telebot.types.InlineKeyboardMarkup()<font></font>
        keyboard.row(telebot.types.InlineKeyboardButton(<span class="hljs-string">' '</span>, callback_data=<span class="hljs-string">'bd_get'</span>))<font></font>
        bot.send_message(message.chat.id, <span class="hljs-string">' : '</span>, reply_markup=keyboard)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> message.text == <span class="hljs-string">'/donation'</span>:<font></font>
        bot.send_invoice(message.chat.id,<font></font>
                         title=<span class="hljs-string">'Donation'</span>,<font></font>
                         description=<span class="hljs-string">'   .'</span>,<font></font>
                         invoice_payload=<span class="hljs-string">'donation'</span>,<font></font>
                         provider_token=<span class="hljs-string">'*********:TEST:*******'</span>,<font></font>
                         currency=<span class="hljs-string">'RUB'</span>,<font></font>
                         prices=[LabeledPrice(label=<span class="hljs-string">'Donation'</span>, amount=<span class="hljs-number">10000</span>)],<font></font>
                         start_parameter=<span class="hljs-string">'pay_start'</span>,<font></font>
                         photo_url=<span class="hljs-string">'https://cdn.imgbin.com/22/0/5/imgbin-donation-computer-icons-'</span>
                                   <span class="hljs-string">'fundraising-justgiving-charitable-organization-donation-'</span>
                                   <span class="hljs-string">'5Yehm9UecF2cRWrqtms4e6emn.jpg'</span>,<font></font>
                         photo_height=<span class="hljs-number">512</span>,  <span class="hljs-comment"># !=0/None or picture won't be shown</span>
                         photo_width=<span class="hljs-number">512</span>,<font></font>
                         photo_size=<span class="hljs-number">512</span>,<font></font>
                         is_flexible=<span class="hljs-literal">False</span>)</code></pre> <i><b>IF</b></i>   <i><b>/start</b></i>,  <i><b>IF</b></i>   <i><b>/donation</b></i>.<br>
  <i><b>invoice_payload</b></i>  ,      .<br>
<br>
 <i><b>bot.send_invoice</b></i>   <b>token</b>   .   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a>.<br>
<blockquote>     token .     ,    .         token.<br>
: <i><b>123:TEST:XXXX</b></i><br>
: <i><b>123:LIVE:XXXX</b></i><br>
</blockquote></li>
<li>      :<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">@bot.pre_checkout_query_handler(func=lambda query: True)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkout</span>(<span class="hljs-params">message</span>):</span>
    bot.answer_pre_checkout_query(message.id, ok=<span class="hljs-literal">True</span>,<font></font>
                                  error_message=<span class="hljs-string">"   CVV  , "</span>
                                                <span class="hljs-string">"      . "</span>
                                                <span class="hljs-string">"    , "</span>
                                                <span class="hljs-string">"   ."</span>)</code></pre>..   digital ,      ,  <i><b>ok</b></i>  <i><b>True</b></i>.         .<br>
<br>
     , ,  .    ,           ,    .      ,   <i><b>ok=True</b></i>    <i><b>False</b></i>       ,     <i><b>error_message</b></i>.<br>
</li>
<li>   :<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">@bot.message_handler(content_types=['successful_payment'])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">got_payment</span>(<span class="hljs-params">message</span>):</span>
    <span class="hljs-keyword">if</span> message.json[<span class="hljs-string">'successful_payment'</span>][<span class="hljs-string">'invoice_payload'</span>].split(<span class="hljs-string">','</span>)[<span class="hljs-number">0</span>] == <span class="hljs-string">'buy'</span>:<font></font>
        email = message.json[<span class="hljs-string">'successful_payment'</span>][<span class="hljs-string">'order_info'</span>][<span class="hljs-string">'email'</span>]<font></font>
        bot.send_message(message.chat.id,<font></font>
                         <span class="hljs-string">'!     : `{} {}`.\n'</span>
                         <span class="hljs-string">'   (`{}`)     .\n\n'</span> \
                         <span class="hljs-string">'     @_'</span>\<font></font>
                         .format(message.successful_payment.total_amount / <span class="hljs-number">100</span>,<font></font>
                                 message.successful_payment.currency,<font></font>
                                 email),<font></font>
                        parse_mode=<span class="hljs-string">'Markdown'</span>)<font></font>
        request_text = message.json[<span class="hljs-string">'successful_payment'</span>][<span class="hljs-string">'invoice_payload'</span>].split(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>]<font></font>
        city = message.json[<span class="hljs-string">'successful_payment'</span>][<span class="hljs-string">'invoice_payload'</span>].split(<span class="hljs-string">','</span>)[<span class="hljs-number">2</span>]<font></font>
        write_in_BD, name_excel_BD = yandex.write_exl(text=request_text, city_name=city)<font></font>
        <span class="hljs-keyword">if</span> write_in_BD == <span class="hljs-literal">True</span>:<font></font>
            send_mail(name_file=name_excel_BD, to_address=email)<font></font>
<font></font>
    <span class="hljs-keyword">elif</span> message.json[<span class="hljs-string">'successful_payment'</span>][<span class="hljs-string">'invoice_payload'</span>] == <span class="hljs-string">'donation'</span>:<font></font>
        bot.send_video(message.chat.id, <span class="hljs-string">'https://media0.giphy.com/media/QAsBwSjx9zVKoGp9nr/giphy.gif'</span>)</code></pre><br>
</li>
<li>    <i><b>InlineKeyboardMarkup</b></i>:<br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">@bot.callback_query_handler(func=lambda call: True)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">callback_key</span>(<span class="hljs-params">message</span>):</span>
    <span class="hljs-keyword">if</span> message.data == <span class="hljs-string">'bd_get'</span>:<font></font>
        input_city(message)<font></font>
    <span class="hljs-keyword">elif</span> re.search(<span class="hljs-string">r'bd_yes/'</span>,message.data):<font></font>
        location = re.sub(<span class="hljs-string">'bd_yes/'</span>,<span class="hljs-string">''</span>,message.data)<font></font>
        bot.answer_callback_query(message.id, text=location, show_alert=<span class="hljs-literal">False</span>)<font></font>
        input_text(message, city=location)<font></font>
    <span class="hljs-keyword">elif</span> message.data == <span class="hljs-string">'bd_no'</span>:<font></font>
        input_city(message)<font></font>
    <span class="hljs-keyword">elif</span> re.search(<span class="hljs-string">r'pay'</span>, message.data):<font></font>
        info_get_bd_limit = re.split(<span class="hljs-string">r'/'</span>,message.data)<font></font>
        sent_text = info_get_bd_limit[<span class="hljs-number">1</span>]<font></font>
        sent_city = info_get_bd_limit[<span class="hljs-number">2</span>]<font></font>
        found = info_get_bd_limit[<span class="hljs-number">3</span>]<font></font>
        bot.answer_callback_query(message.id, text=<span class="hljs-string">''</span>, show_alert=<span class="hljs-literal">False</span>)<font></font>
        pay(message, text=sent_text, city=sent_city, found=found)</code></pre><br>
</li>
<li>    :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pay</span>(<span class="hljs-params">message, text, city, found</span>):</span><font></font>
    bot.send_invoice(message.from_user.id,<font></font>
                     title=<span class="hljs-string">' '</span>,<font></font>
                     description=<span class="hljs-string">'    .\n'</span>
                                 <span class="hljs-string">': '</span>+text+<span class="hljs-string">'\n: '</span>+city+<span class="hljs-string">'\n- : '</span>+found,<font></font>
                     invoice_payload=<span class="hljs-string">'buy,{},{}'</span>.format(text, city),<font></font>
                     provider_token=<span class="hljs-string">'*********:TEST:*******'</span>,<font></font>
                     currency=<span class="hljs-string">'RUB'</span>,<font></font>
                     prices=[LabeledPrice(label=<span class="hljs-string">' '</span>, amount=<span class="hljs-number">20000</span>)],<font></font>
                     start_parameter=<span class="hljs-string">'pay_start'</span>,<font></font>
                     photo_url=<span class="hljs-string">'https://encrypted-tbn0.gstatic.com/images?q=tbn:'</span>
                               <span class="hljs-string">'ANd9GcRVUs3eGt4U9YSXZrsbOkJoNEdpcYUdq0vEzM-ci_oIxEWs1FK0'</span>,<font></font>
                     photo_height=<span class="hljs-number">300</span>,<font></font>
                     photo_width=<span class="hljs-number">300</span>,<font></font>
                     photo_size=<span class="hljs-number">300</span>,<font></font>
                     need_email=<span class="hljs-literal">True</span>,<font></font>
                     is_flexible=<span class="hljs-literal">False</span>)</code></pre> <i><b>need_email</b></i> ,       ,     .<br>
</li>
<li>   ,     :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_city</span>(<span class="hljs-params">message</span>):</span>
    bot.send_message(message.from_user.id, <span class="hljs-string">' :'</span>)<font></font>
    bot.register_next_step_handler_by_chat_id(message.from_user.id, get_city)<font></font>
    bot.answer_callback_query(message.id, text=<span class="hljs-string">' '</span>, show_alert=<span class="hljs-literal">False</span>)</code></pre><br>
</li>
<li>   ,    :<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_city</span>(<span class="hljs-params">message</span>):</span><font></font>
    get_location, get_location_point = yandex.get_location(message.text)<font></font>
    keyboard = telebot.types.InlineKeyboardMarkup()<font></font>
    keyboard.row(telebot.types.InlineKeyboardButton(<span class="hljs-string">''</span>, callback_data=<span class="hljs-string">'bd_yes/'</span>+message.text),<font></font>
                 telebot.types.InlineKeyboardButton(<span class="hljs-string">''</span>, callback_data=<span class="hljs-string">'bd_no'</span>))<font></font>
    bot.send_location(message.chat.id, get_location_point[<span class="hljs-number">1</span>], get_location_point[<span class="hljs-number">0</span>], reply_markup=keyboard)</code></pre><br>
</li>
<li>   ,    :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_text</span>(<span class="hljs-params">message, city=None</span>):</span>
    <span class="hljs-keyword">global</span> location_city<font></font>
    location_city = city<font></font>
    info_message_id = bot.send_message(message.from_user.id, <span class="hljs-string">'  ( ): '</span>)<font></font>
    bot.register_next_step_handler_by_chat_id(message.from_user.id, get_bd_limit)</code></pre><br>
</li>
<li>   -         :<br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_bd_limit</span>(<span class="hljs-params">message</span>):</span><font></font>
    information = yandex.get_information_limit(message.text, location_city)<font></font>
    <span class="hljs-keyword">if</span> information:<font></font>
        found = yandex.sum_taken_object(yandex.get_all_infomations(message.text, location_city))<font></font>
        bot.send_message(message.from_user.id, <span class="hljs-string">'    .\n'</span>
                                               <span class="hljs-string">'   5   .'</span>)<font></font>
        i = <span class="hljs-number">1</span>
        text = <span class="hljs-string">''</span>
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> information.items():<font></font>
            name = value[<span class="hljs-string">'name'</span>]<font></font>
            address = value[<span class="hljs-string">'address'</span>]<font></font>
            url = value[<span class="hljs-string">'url'</span>]<font></font>
            phones = value[<span class="hljs-string">'phones'</span>]<font></font>
            hours = value[<span class="hljs-string">'hours'</span>]<font></font>
            text = text + <span class="hljs-string">''</span> + str(i) + <span class="hljs-string">') : '</span>+name+<span class="hljs-string">'\n: '</span>+address+<span class="hljs-string">'\n: '</span>+url+\
                                        <span class="hljs-string">'\n: '</span>+phones+<span class="hljs-string">'\n : '</span>+hours+<span class="hljs-string">'\n----------\n'</span>
            i += <span class="hljs-number">1</span>
        bot.send_message(message.from_user.id, text, disable_web_page_preview=<span class="hljs-literal">True</span>)<font></font>
<font></font>
        keyboard = telebot.types.InlineKeyboardMarkup()<font></font>
        keyboard.row(telebot.types.InlineKeyboardButton(<span class="hljs-string">' 200 .'</span>,<font></font>
                                                        callback_data=<span class="hljs-string">'pay/'</span> + message.text+<span class="hljs-string">'/'</span>+location_city+<span class="hljs-string">'/'</span>+found))<font></font>
        bot.send_message(message.from_user.id, <span class="hljs-string">'     : '</span> + found+<span class="hljs-string">''</span>
                                                <span class="hljs-string">'\n\n      .'</span>, reply_markup=keyboard)
    <span class="hljs-keyword">else</span>:<font></font>
        bot.send_message(message.from_user.id, <span class="hljs-string">'     !'</span>)
</code></pre><br>
</li>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"></a> Telegram:<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">try</span>:<font></font>
        bot.polling(none_stop=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<font></font>
        time.sleep(<span class="hljs-number">15</span>)</code></pre><br>
</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，Telegram支持</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8种</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支付系统。</font><font style="vertical-align: inherit;">对于俄罗斯市场，最受欢迎的是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex Cash</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sberbank</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我建议您使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tranzzo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为 </font><font style="vertical-align: inherit;">使用它可以保存卡数据，并</font><font style="vertical-align: inherit;">在确认密码后的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小时</font><font style="vertical-align: inherit;">内使用指纹进行付款</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用</font><font style="vertical-align: inherit;">来自</font><b><font style="vertical-align: inherit;">Sberbank</font></b><font style="vertical-align: inherit;">的测试</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令牌</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计费过程会中断，而当使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex Cash时，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一切都很好。</font><font style="vertical-align: inherit;">我不知道这与什么有关，而是一个事实。</font></font></blockquote><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a43/901/d62/a43901d62e70eb4940f739419d0588e8.gif" width="250" alt="图片"></div></td>
<td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a4/eb1/cd1/1a4eb1cd12296b3abe1f19d7d42f8290.gif" width="250" alt="图片"></div></td>
</tr>
</tbody></table></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这篇文章不仅旨在展示实现小型数字业务的可能性，而且还可以激发您的企业家，开始产生可以应用此功能的新想法。 </font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他获得的收入是：鼓手-面包，而乐福者-什么都没有。</font></font></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495572/index.html">硬件生态系统社区为电子行业的所有人发起播客</a></li>
<li><a href="../zh-CN495576/index.html">带有micropython的esp8266 MK上的自推式平台</a></li>
<li><a href="../zh-CN495580/index.html">黄瓜JVM-不只是BDD</a></li>
<li><a href="../zh-CN495588/index.html">从零开始在Unity中创建类似于Rogue的游戏：地牢生成器</a></li>
<li><a href="../zh-CN495592/index.html">如何使用字典（不仅限于此）</a></li>
<li><a href="../zh-CN495596/index.html">在办公室的远程工作。RDP，Port Knocking，Mikrotik：简单又安全</a></li>
<li><a href="../zh-CN495602/index.html">从核心数据开始！难以用简单的语言表达[第二部分]</a></li>
<li><a href="../zh-CN495604/index.html">Symfony 4 + Twig的临时本地化</a></li>
<li><a href="../zh-CN495606/index.html">“社会监督。” 得分1：0，对我们有利</a></li>
<li><a href="../zh-CN495608/index.html">[Infographic]人类历史中大流行病的可视化</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>