<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¢ üñïüèΩ üñ®Ô∏è How to reduce overhead when handling exceptions in C ++ ü§¥üèº üë¥üèø üôåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Runtime error handling is very important in many situations that we encounter when developing software - from incorrect user input to damaged network ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to reduce overhead when handling exceptions in C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/488244/"><img src="https://habrastorage.org/webt/ml/92/sj/ml92sjlj3hq1paudqwokbods74m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Runtime error handling is very important in many situations that we encounter when developing software - from incorrect user input to damaged network packets. The application should not crash if the user suddenly downloaded PNG instead of PDF, or disconnected the network cable when updating the software. The user expects that the program will work no matter what happens and either handle emergency situations in the background or offer him to choose an option to solve the problem by means of a message sent through a friendly interface.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exception handling can be a confusing, complex task, and, which is fundamentally important for many C ++ developers, it can greatly slow down the application. But, as in many other cases, there are several ways to solve this problem. Next, we will delve into the exception handling process in C ++, deal with its pitfalls and see how this can affect the speed of your application. In addition, we will look at alternatives that can be used to reduce overhead.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I will not urge you to stop using the exceptions completely. </font><font style="vertical-align: inherit;">They should be applied, but applied precisely when it is impossible to avoid it: for example, how to report an error that occurred inside the constructor? </font><font style="vertical-align: inherit;">We will mainly consider using exceptions to handle runtime errors. </font><font style="vertical-align: inherit;">Using the alternatives that we will talk about will allow you to develop more reliable and easily maintainable applications.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quick performance test</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How much slower are exceptions in C ++ compared to the usual mechanisms for controlling the progress of a program? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exceptions are obviously slower than simple break or return operations. </font><font style="vertical-align: inherit;">But let's find out how much slower! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the example below, we have written a simple function that randomly generates numbers and, on the basis of checking one generated number, gives / does not give an error message. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We tested several implementation options for error handling:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Throw an exception with an integer argument. </font><font style="vertical-align: inherit;">Although this is not particularly applied in practice, it is the easiest way to use exceptions in C ++. </font><font style="vertical-align: inherit;">So we get rid of excessive complexity in the implementation of our test.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Throw out std :: runtime_error, which can send a text message. </font><font style="vertical-align: inherit;">This option, unlike the previous one, is much more often used in real projects. </font><font style="vertical-align: inherit;">Let's see if the second option will give a tangible increase in overhead costs compared to the first.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empty return.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Return C style int error code</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To run the tests, we used the simple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google benchmark library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">She repeatedly ran each test in a cycle. </font><font style="vertical-align: inherit;">Next, I will describe how everything happened. </font><font style="vertical-align: inherit;">Impatient readers can immediately jump to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">results</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Test code </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our super complex random number generator:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> randomRange = <span class="hljs-number">2</span>;  <span class="hljs-comment">//     0  2.</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> errorInt = <span class="hljs-number">0</span>; 	<span class="hljs-comment">//    ,    0.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRandom</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> random() % randomRange;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Test functions:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithBasicException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-number">-2</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithMessageException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! Who goes there?"</span>);<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithReturn</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exitWithErrorCode</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's it, now we can use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google benchmark library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithBasicException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithBasicException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">int</span> ex) {
        	<span class="hljs-comment">//  ,    .</span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithMessageException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithMessageException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::runtime_error &amp;ex) {
        	<span class="hljs-comment">//  ,    </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithReturn</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {<font></font>
    	exitWithReturn();<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithErrorCode</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> err = exitWithErrorCode();
    	<span class="hljs-keyword">if</span> (err &lt; <span class="hljs-number">0</span>) {
        	<span class="hljs-comment">// `handle_error()` ‚Ä¶  - </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithBasicException);<font></font>
BENCHMARK(BM_exitWithMessageException);<font></font>
BENCHMARK(BM_exitWithReturn);<font></font>
BENCHMARK(BM_exitWithErrorCode);<font></font>
<font></font>
<span class="hljs-comment">//  !</span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For those who want to touch the beautiful, we have posted the full code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">results</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the console, we see different test results, depending on the compilation options: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1407 ns         1407 ns       491232<font></font>
BM_exitWithMessageException   1605 ns         1605 ns       431393<font></font>
BM_exitWithReturn              142 ns          142 ns      5172121<font></font>
BM_exitWithErrorCode           144 ns          143 ns      5069378<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Release -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1092 ns         1092 ns       630165<font></font>
BM_exitWithMessageException   1261 ns         1261 ns       547761<font></font>
BM_exitWithReturn             10.7 ns         10.7 ns     64519697<font></font>
BM_exitWithErrorCode          11.5 ns         11.5 ns     62180216<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Launched on 2015 MacBook Pro 2.5GHz i7) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The results are amazing! </font><font style="vertical-align: inherit;">Look at the huge gap between code speed with and without exceptions (empty return and errorCode). </font><font style="vertical-align: inherit;">And with compiler optimization, this gap is even bigger! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Undoubtedly, this is a great test. </font><font style="vertical-align: inherit;">The compiler may be doing quite a bit of code optimization for tests 3 and 4, but the gap is big anyway. </font><font style="vertical-align: inherit;">Thus, this allows us to estimate the overhead when using exceptions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to the zero-cost model, in most implementations of try blocks in C ++, there is no additional overhead. </font><font style="vertical-align: inherit;">But the catch-block works much slower. </font><font style="vertical-align: inherit;">Using our simple example, we can see how slowly throwing and catching exceptions can work. </font><font style="vertical-align: inherit;">Even on such a small call stack! </font><font style="vertical-align: inherit;">And with increasing stack depth, overhead will increase linearly. </font><font style="vertical-align: inherit;">That's why it is so important to try to catch the exception as close as possible to the code that threw it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, we found out that exceptions work slowly. </font><font style="vertical-align: inherit;">Then maybe stop it? </font><font style="vertical-align: inherit;">But not everything is so simple.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why does everyone keep using exceptions?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The benefits of exceptions are well documented in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technical Report on C ++ Performance (chapter 5.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote>        ,      ,     errorCode- [  ],       .  ,                .          ,              .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Once again: the main idea is the inability to ignore and forget about the exception. This makes exceptions a very powerful built-in C ++ tool, capable of replacing the difficult processing through error code, which we inherited from the C language. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, exceptions are very useful in situations that are not directly related to the program, for example, ‚Äúthe hard disk is full ‚ÄùOr‚Äú network cable is damaged. ‚Äù In such situations, exceptions are ideal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But what is the best way to deal with error handling directly related to the program? </font><font style="vertical-align: inherit;">In any case, we need a mechanism that would unambiguously indicate to the developer that he should check the error, provide him with sufficient information about it (if it arose), transmitting it in the form of a message or in some other format. </font><font style="vertical-align: inherit;">It seems that we are again returning to the built-in exceptions, but just now we will talk about an alternative solution.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Expected</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to overhead, exceptions have one more drawback: they work sequentially: an exception must be caught and processed as soon as it is thrown, it is impossible to postpone it for later. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What can we do about it? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out there is a way. Professor Andrei Alexandrescu came up with a special class for us called Expected. It allows you to create an object of class T (if everything goes fine) or an object of class Exception (if an error occurs). That is, either this or that. Or or. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In essence, this is a wrapper over the data structure, which in C ++ is called union. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, we illustrated his idea as follows:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>&gt;
<span class="hljs-title">class</span> <span class="hljs-title">Expected</span> {</span>
<span class="hljs-keyword">private</span>:
	<span class="hljs-comment">//  union:  ,   .     </span>
	<span class="hljs-keyword">union</span> {<font></font>
    	T value;<font></font>
    	Exception exception;<font></font>
	};<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
	<span class="hljs-comment">//    `Expected`   T,   .</span>
	Expected(<span class="hljs-keyword">const</span> T&amp; value) ...<font></font>
<font></font>
	<span class="hljs-comment">//    `Expected`   Exception,  -   </span>
	Expected(<span class="hljs-keyword">const</span> Exception&amp; ex) ...<font></font>
<font></font>
	<span class="hljs-comment">//    :    </span>
	<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hasError</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//   T</span>
	T <span class="hljs-title">value</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//        (  Exception)</span>
	Exception <span class="hljs-title">error</span><span class="hljs-params">()</span> ...
}</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A full implementation will certainly be more difficult. </font><font style="vertical-align: inherit;">But the main idea of ‚Äã‚ÄãExpected is that in the same object (Expected &amp; e) we can receive data for the regular operation of the program (which will have the type and format known to us: T &amp; value) and error data ( Exception &amp; ex). </font><font style="vertical-align: inherit;">Therefore, it is very easy to check what came to us once again (for example, using the hasError method). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, now no one will force us to handle the exception right this second. </font><font style="vertical-align: inherit;">We will not have a throw () call or catch block. </font><font style="vertical-align: inherit;">Instead, we can refer to our Exception object at our convenience.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance Test for Expected</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will write similar performance tests for our new class:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 5. Expected! Testcase 5 </span><font></font>
<font></font>
<span class="hljs-function">Expected&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">exitWithExpected</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! If you want..."</span>);  <span class="hljs-comment">//  : return,   throw!</span><font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Benchmark.</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithExpected</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> expected = exitWithExpected();<font></font>
<font></font>
    	<span class="hljs-keyword">if</span> (expected.hasError()){
        	<span class="hljs-comment">// Handle in our own time.</span><font></font>
    	}<font></font>
    	<span class="hljs-comment">// Or we can use the value...</span>
    	<span class="hljs-comment">// else {</span>
    	<span class="hljs-comment">// 	doSomethingInteresting(expected.value());</span>
    	<span class="hljs-comment">// }</span><font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithExpected);<font></font>
<font></font>
<span class="hljs-comment">// </span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drumroll!!! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected            147 ns          147 ns      4685942<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Release -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected           57.5 ns         57.5 ns     11873261<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not bad! </font><font style="vertical-align: inherit;">For our std :: runtime_error without optimization, we were able to reduce the operating time from 1605 to 147 nanoseconds. </font><font style="vertical-align: inherit;">With optimization, everything looks even better: a drop from 1261 to 57.5 nanoseconds. </font><font style="vertical-align: inherit;">This is more than 10 times faster than with -O0 and more than 20 times faster than with -O2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So compared to the built-in exceptions, Expected works many times faster, and also gives us a more flexible error handling mechanism. </font><font style="vertical-align: inherit;">In addition, it has semantic purity and eliminates the need to sacrifice error messages and deprive users of quality feedback.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exceptions are not absolute evil. </font><font style="vertical-align: inherit;">And sometimes it‚Äôs good at all, since they work extremely effectively for their intended purpose: in exceptional circumstances. </font><font style="vertical-align: inherit;">We only begin to encounter problems when we use them where much more effective solutions are available. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our tests, despite the fact that they are quite simple, showed: you can greatly reduce overhead if you do not catch exceptions (slow catch-block) in cases where it is enough to simply send data (using return).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we also briefly introduced the Expected class and how we can use it to speed up the error handling process. </font><font style="vertical-align: inherit;">Expected makes it easy to track the progress of the program, and also allows us to be more flexible and send messages to users and developers.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488230/index.html">Introduction to SSD. Part 3. Form factor</a></li>
<li><a href="../en488232/index.html">approx. tech: QATOK # 2</a></li>
<li><a href="../en488234/index.html">Using QubesOS for Windows 7</a></li>
<li><a href="../en488240/index.html">An endless cycle that was not: the story of the Holy Grail bug</a></li>
<li><a href="../en488242/index.html">VueJS + TS Project Integration with SonarQube</a></li>
<li><a href="../en488246/index.html">VoiceOver on iOS: each control behaves differently</a></li>
<li><a href="../en488250/index.html">To the question of Linux (L)</a></li>
<li><a href="../en488252/index.html">How to reduce the cost of developing new products using SLS</a></li>
<li><a href="../en488254/index.html">Cloud Security Responsibility Distribution Model</a></li>
<li><a href="../en488256/index.html">Homemade recuperator for a country house with an efficiency of 80%</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>