<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚽 ✍🏿 🤯 インダストリアルニンジャの後、Positive Hack Days 9でPLCがハッキングされた方法 🦓 👨‍💻 💸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前回のPHDays 9では、ガスポンププラントをハッキングするためのコンテスト、インダストリアルニンジャコンテストを開催しました。同じ工業プロセスをエミュレートするさまざまな安全パラメーター（セキュリティなし、低セキュリティ、高セキュリティ）を持つ3つのスタンドがサイトにありました：空気が圧力下でバ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>インダストリアルニンジャの後、Positive Hack Days 9でPLCがハッキングされた方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/460615/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/qt/2p/3g/qt2p3gfe43jhcxqqpuer8lzvgvc.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前回のPHDays 9では、ガスポンププラントをハッキングするためのコンテスト、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インダストリアルニンジャ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテストを開催しました</font><font style="vertical-align: inherit;">。同じ工業プロセスをエミュレートするさまざまな安全パラメーター（セキュリティなし、低セキュリティ、高セキュリティ）を持つ3つのスタンドがサイトにありました：空気が圧力下でバルーンにポンプで送られ（その後降下）されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さまざまな安全パラメーターにもかかわらず、スタンドのハードウェアは同じでした。SiemensSimatic S7-300 PLC。緊急ブローオフボタンと圧力測定装置（PLCデジタル入力（DI）に接続）。ポンプおよびブリード用のバルブ（PLC（DO）のデジタル出力に接続）-下の図を参照してください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2u/fq/om/2ufqommgoloxmjwohpy2sphrbha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PLCは、圧力の読み取り値とそのプログラムに応じて、ボールのブローまたは膨張（対応するバルブの開閉）を決定しました。しかし、すべてのスタンドで手動制御モードが提供され、制限なしでバルブの状態を制御することが可能になりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタンドは、このモードを有効にすることの複雑さによって区別されました。保護されていないスタンドではそれが最も簡単でしたが、高セキュリティスタンドではそれがより困難でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2日間で、6つの問題のうち5つが解決されました。 1位の参加者は233ポイントを獲得しました（コンテストの準備に1週間費やしました）。 3人の勝者：私は-a1exdandy、II-Rubikoid、III-Zeを配置します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、PHDays期間中は、参加者のいずれも3つのスタンドすべてを克服することができなかったため、オンラインコンテストに参加することを決定し、6月上旬に最も困難なタスクを公開しました。</font><font style="vertical-align: inherit;">参加者は1か月でタスクを完了し、フラグを見つけ、ソリューションを詳細かつ興味深い内容で説明する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カットの下では、1か月に送信された課題に対する最適なソリューションの分析を公開します。これは、PHDaysの間にコンテストで1位になったデジタルセキュリティ会社のAlexey Kovrizhnykh（a1exdandy）によって発見されました。</font><font style="vertical-align: inherit;">以下に、そのテキストとコメントを示します。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期分析</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、タスクにはファイルを含むアーカイブがありました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">block_upload_traffic.pcapng</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB100.bin</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hints.txt</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hints.txtファイルには、タスクを解決するために必要な情報とヒントが含まれています。</font><font style="vertical-align: inherit;">その内容は次のとおりです。</font></font><br>
<br>
<blockquote><ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Petrovichは昨日、PlcSimからStep7でブロックをダウンロードできると私に言った。</font></font></li>
<li>    Siemens Simatic  S7-300.</li>
<li> PlcSim —   ,        Siemens S7.</li>
</ol></blockquote><br>
<pre> DB100.bin,   ,    DB100 :<font></font>
00000000: 0100 0102 6e02 0401 0206 0100 0101 0102  ....n...........<font></font>
00000010: 1002 0501 0202 2002 0501 0206 0100 0102  ...... .........<font></font>
00000020: 0102 7702 0401 0206 0100 0103 0102 0a02  ..w.............<font></font>
00000030: 0501 0202 1602 0501 0206 0100 0104 0102  ................<font></font>
00000040: 7502 0401 0206 0100 0105 0102 0a02 0501  u...............<font></font>
00000050: 0202 1602 0501 0206 0100 0106 0102 3402  ..............4.<font></font>
00000060: 0401 0206 0100 0107 0102 2602 0501 0202  ..........&amp;.....<font></font>
00000070: 4c02 0501 0206 0100 0108 0102 3302 0401  L...........3...<font></font>
00000080: 0206 0100 0109 0102 0a02 0501 0202 1602  ................<font></font>
00000090: 0501 0206 0100 010a 0102 3702 0401 0206  ..........7.....<font></font>
000000a0: 0100 010b 0102 2202 0501 0202 4602 0501  ......".....F...<font></font>
000000b0: 0206 0100 010c 0102 3302 0401 0206 0100  ........3.......<font></font>
000000c0: 010d 0102 0a02 0501 0202 1602 0501 0206  ................<font></font>
000000d0: 0100 010e 0102 6d02 0401 0206 0100 010f  ......m.........<font></font>
000000e0: 0102 1102 0501 0202 2302 0501 0206 0100  ........#.......<font></font>
000000f0: 0110 0102 3502 0401 0206 0100 0111 0102  ....5...........<font></font>
00000100: 1202 0501 0202 2502 0501 0206 0100 0112  ......%.........<font></font>
00000110: 0102 3302 0401 0206 0100 0113 0102 2602  ..3...........&amp;.<font></font>
00000120: 0501 0202 4c02 0501 0206 0100            ....L.......</pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前から判断すると、block_upload_traffic.pcapngファイルには、PLCへのブロックロードトラフィックのダンプが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会議中の競技会場でのトラフィックのこのダンプは、取得するのが少し難しいことは注目に値します。</font><font style="vertical-align: inherit;">これを行うには、TeslaSCADA2のプロジェクトファイルのスクリプトを理解する必要がありました。</font><font style="vertical-align: inherit;">これにより、RC4で暗号化されたダンプの場所と、それを復号化するために使用するキーを理解することができました。</font><font style="vertical-align: inherit;">サイトのデータブロックのダンプは、S7プロトコルクライアントを使用して取得できます。</font><font style="vertical-align: inherit;">これには、Snap7パッケージのデモクライアントを使用しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラフィックダンプからの信号処理ユニットの抽出</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ダンプの内容を見ると、信号処理ブロックOB1、FC1、FC2、およびFC3が送信されていることがわかり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sz/43/yd/sz43ydme-e17zhg3yuudd1xxmva.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。これらのブロックを削除</font><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">必要があります。</font><font style="vertical-align: inherit;">これは、たとえば、トラフィックをpcapng形式からpcapに変換した後、次のスクリプトで実行できます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/env python2</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">from</span> scapy.all <span class="hljs-keyword">import</span> *<font></font>
<font></font>
packets = rdpcap(<span class="hljs-string">'block_upload_traffic.pcap'</span>)<font></font>
s7_hdr_struct = <span class="hljs-string">'&gt;BBHHHHBB'</span><font></font>
s7_hdr_sz = struct.calcsize(s7_hdr_struct)<font></font>
tpkt_cotp_sz = <span class="hljs-number">7</span>
names = iter([<span class="hljs-string">'OB1.bin'</span>, <span class="hljs-string">'FC1.bin'</span>, <span class="hljs-string">'FC2.bin'</span>, <span class="hljs-string">'FC3.bin'</span>])<font></font>
buf = <span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> packet <span class="hljs-keyword">in</span> packets:
    <span class="hljs-keyword">if</span> packet.getlayer(IP).src == <span class="hljs-string">'10.0.102.11'</span>:<font></font>
        tpkt_cotp_s7 = str(packet.getlayer(TCP).payload)<font></font>
        <span class="hljs-keyword">if</span> len(tpkt_cotp_s7) &lt; tpkt_cotp_sz + s7_hdr_sz:
            <span class="hljs-keyword">continue</span><font></font>
        s7 = tpkt_cotp_s7[tpkt_cotp_sz:]<font></font>
        s7_hdr = s7[:s7_hdr_sz]<font></font>
        param_sz = struct.unpack(s7_hdr_struct, s7_hdr)[<span class="hljs-number">4</span>]<font></font>
        s7_param = s7[<span class="hljs-number">12</span>:<span class="hljs-number">12</span>+param_sz]<font></font>
        s7_data = s7[<span class="hljs-number">12</span>+param_sz:]
        <span class="hljs-keyword">if</span> s7_param <span class="hljs-keyword">in</span> (<span class="hljs-string">'\x1e\x00'</span>, <span class="hljs-string">'\x1e\x01'</span>):  <span class="hljs-comment"># upload</span>
            buf += s7_data[<span class="hljs-number">4</span>:]
        <span class="hljs-keyword">elif</span> s7_param == <span class="hljs-string">'\x1f'</span>:
            <span class="hljs-keyword">with</span> open(next(names), <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
                f.write(buf)<font></font>
            buf = <span class="hljs-string">''</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信したブロックを調べると、それらが常にバイト70 70（pp）で始まることがわかります。</font><font style="vertical-align: inherit;">次に、それらを分析する方法を学ぶ必要があります。</font><font style="vertical-align: inherit;">タスクのヒントは、これにはPlcSimを使用する必要があることを示しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックから人間が読み取れる命令を取得する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、Simatic Managerソフトウェアを使用して、繰り返し命令（= Q 0.0）でいくつかのブロックをロードしてS7-PlcSimをプログラムし、結果のPLCエミュレーターをexample.plcファイルに保存します。</font><font style="vertical-align: inherit;">ファイルの内容を確認することで、以前に発見した署名70 70によって、読み込まれたブロックの先頭を簡単に特定できます。</font><font style="vertical-align: inherit;">ブロックの前に、明らかに、ブロックサイズが4バイトのリトルエンディアン値の形式で書き込まれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/01/vp/ra/01vpra5veml-vbfozvhainxy-ig.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
plcファイルの構造に関する情報を受け取った後、PLC S7プログラムを読み取るための次のアクションプランが表示されました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simatic Managerを使用して、ダンプから取得したものと同様のブロック構造をS7-PlcSimで作成します。</font><font style="vertical-align: inherit;">ブロックサイズは一致している必要があり（ブロックに適切な数の命令を入力することで実現）、それらの識別子（OB1、FC1、FC2、FC3）を一致させる必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLCをファイルに保存します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受信したファイルのブロックの内容を、トラフィックダンプのブロックに置き換えます。</font><font style="vertical-align: inherit;">ブロックの先頭は、シグネチャによって決定されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果のファイルがS7-PlcSimにアップロードされ、Simatic Managerでブロックのコンテンツが表示されます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロックは、たとえば次のコードで置き換えることができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'original.plc'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    plc = f.read()<font></font>
blocks = []<font></font>
<span class="hljs-keyword">for</span> fname <span class="hljs-keyword">in</span> [<span class="hljs-string">'OB1.bin'</span>, <span class="hljs-string">'FC1.bin'</span>, <span class="hljs-string">'FC2.bin'</span>, <span class="hljs-string">'FC3.bin'</span>]:
    <span class="hljs-keyword">with</span> open(fname, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
        blocks.append(f.read())<font></font>
<font></font>
i = plc.find(<span class="hljs-string">b'pp'</span>)
<span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> blocks:<font></font>
    plc = plc[:i] + block + plc[i+len(block):]<font></font>
    i = plc.find(<span class="hljs-string">b'pp'</span>, i + <span class="hljs-number">1</span>)<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">'target.plc'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    f.write(plc)</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレクセイはもっと複雑かもしれないが、それでも正しい道を進んだ。</font><font style="vertical-align: inherit;">参加者はNetToPlcSimを使用してPlcSimがネットワーク経由で通信し、Snap7を介してPlcSimにブロックをロードし、開発環境を使用してこれらのブロックをPlcSimからプロジェクトとしてダウンロードすると想定しました。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のファイルをS7-PlcSimで開くと、Simatic Managerを使用して上書きされたブロックを読み取ることができます。主なデバイス管理機能は、ブロックFC1に記録されています。変数＃TEMP0は特別な注目を集めており、オンにすると、ビットメモリM2.2およびM2.3の値に基づいてPLC制御が手動モードに切り替えられるようです。 ＃TEMP0はFC3によって設定されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/02/tq/pt/02tqptegvjst2hzny9d8sc4rmva.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するには、FC3関数を分析し、論理ユニットを返すために必要なことを理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
競技会場の低セキュリティスタンドにあるPLC信号処理ユニットも同じ方法で配置されましたが、＃TEMP0変数の値を設定するには、DB1に私の忍者の方法で行を書き込むだけで十分でした。</font><font style="vertical-align: inherit;">ブロック内の値のチェックは明確に整理されており、ブロックプログラミング言語に関する深い知識は必要ありません。</font><font style="vertical-align: inherit;">明らかに、高セキュリティレベルでは、手動制御を実現することははるかに難しく、STL言語の複雑さ（S7 PLCをプログラミングする方法の1つ）を理解する必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆ブロックFC3</font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STL表現でのFC3ブロックの内容：</font></font></b><div class="spoiler_text"><pre><code class="python hljs">      L     B<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP13</span>
      T     <span class="hljs-comment">#TEMP15</span>
      L     P<span class="hljs-comment">#DBX 0.0</span>
      T     <span class="hljs-comment">#TEMP4</span><font></font>
      CLR   <font></font>
      =     <span class="hljs-comment">#TEMP14</span>
M015: L     <span class="hljs-comment">#TEMP4</span><font></font>
      LAR1  <font></font>
      OPN   DB   <span class="hljs-number">100</span><font></font>
      L     DBLG<font></font>
      TAR1  <font></font>
      &lt;=D   <font></font>
      JC    M016<font></font>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP0</span>
      L     <span class="hljs-comment">#TEMP6</span>
      L     W<span class="hljs-comment">#16#0</span><font></font>
      &lt;&gt;I   <font></font>
      JC    M00d<font></font>
      L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
M00d: L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#1</span><font></font>
      ==I   <font></font>
      JC    M007<font></font>
      L     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#2</span><font></font>
      ==I   <font></font>
      JC    M008<font></font>
      L     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#3</span><font></font>
      ==I   <font></font>
      JC    M00f<font></font>
      L     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#4</span><font></font>
      ==I   <font></font>
      JC    M00e<font></font>
      L     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#5</span><font></font>
      ==I   <font></font>
      JC    M011<font></font>
      L     <span class="hljs-comment">#TEMP5</span>
      L     W<span class="hljs-comment">#16#6</span><font></font>
      ==I   <font></font>
      JC    M012<font></font>
      JU    M010<font></font>
M007: +AR1  P<span class="hljs-comment">#1.0</span>
      L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR2  <font></font>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span><font></font>
      JL    M003<font></font>
      JU    M001<font></font>
      JU    M002<font></font>
      JU    M004<font></font>
M003: JU    M005<font></font>
M001: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP0</span><font></font>
      JU    M006<font></font>
M002: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP1</span><font></font>
      JU    M006<font></font>
M004: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP2</span><font></font>
      JU    M006<font></font>
M00f: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      T     <span class="hljs-comment">#TEMP11</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9</span>
      TAR1  <span class="hljs-comment">#TEMP4</span>
      OPN   DB   <span class="hljs-number">101</span>
      L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
      L     <span class="hljs-comment">#TEMP11</span><font></font>
      +AR1  <font></font>
      LAR2  <span class="hljs-comment">#TEMP9</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     <span class="hljs-comment">#TEMP4</span><font></font>
      LAR1  <font></font>
      JU    M006<font></font>
M008: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP3</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span><font></font>
      JL    M009<font></font>
      JU    M00b<font></font>
      JU    M00a<font></font>
      JU    M00c<font></font>
M009: JU    M005<font></font>
M00b: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#TEMP0</span><font></font>
      JU    M006<font></font>
M00a: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#TEMP1</span><font></font>
      JU    M006<font></font>
M00c: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#TEMP2</span><font></font>
      JU    M006<font></font>
M00e: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10</span>
      TAR1  <span class="hljs-comment">#TEMP4</span>
      LAR1  <span class="hljs-comment">#TEMP9</span>
      LAR2  <span class="hljs-comment">#TEMP10</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      AW    <font></font>
      INVI  <font></font>
      T     <span class="hljs-comment">#TEMP12</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      OW    <font></font>
      L     <span class="hljs-comment">#TEMP12</span><font></font>
      AW    <font></font>
      T     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP0</span>
      L     MB   <span class="hljs-number">101</span>
      T     <span class="hljs-comment">#TEMP1</span>
      L     MB   <span class="hljs-number">102</span>
      T     <span class="hljs-comment">#TEMP2</span>
      L     <span class="hljs-comment">#TEMP4</span><font></font>
      LAR1  <font></font>
      JU    M006<font></font>
M011: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10</span>
      TAR1  <span class="hljs-comment">#TEMP4</span>
      LAR1  <span class="hljs-comment">#TEMP9</span>
      LAR2  <span class="hljs-comment">#TEMP10</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      -I    <font></font>
      T     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP0</span>
      L     MB   <span class="hljs-number">101</span>
      T     <span class="hljs-comment">#TEMP1</span>
      L     MB   <span class="hljs-number">102</span>
      T     <span class="hljs-comment">#TEMP2</span>
      L     <span class="hljs-comment">#TEMP4</span><font></font>
      LAR1  <font></font>
      JU    M006<font></font>
M012: L     <span class="hljs-comment">#TEMP15</span>
      INC   <span class="hljs-number">1</span>
      T     <span class="hljs-comment">#TEMP15</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10</span>
      TAR1  <span class="hljs-comment">#TEMP4</span>
      LAR1  <span class="hljs-comment">#TEMP9</span>
      LAR2  <span class="hljs-comment">#TEMP10</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      ==I   <font></font>
      JCN   M013<font></font>
      JU    M014<font></font>
M013: L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
      T     <span class="hljs-comment">#TEMP4</span>
      L     B<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP6</span><font></font>
      JU    M006<font></font>
M014: L     <span class="hljs-comment">#TEMP4</span><font></font>
      LAR1  <font></font>
      L     <span class="hljs-comment">#TEMP13</span>
      L     L<span class="hljs-comment">#1</span><font></font>
      +I    <font></font>
      T     <span class="hljs-comment">#TEMP13</span><font></font>
      JU    M006<font></font>
M006: L     <span class="hljs-comment">#TEMP0</span>
      T     MB   <span class="hljs-number">100</span>
      L     <span class="hljs-comment">#TEMP1</span>
      T     MB   <span class="hljs-number">101</span>
      L     <span class="hljs-comment">#TEMP2</span>
      T     MB   <span class="hljs-number">102</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     <span class="hljs-comment">#TEMP6</span>
      +     <span class="hljs-number">1</span>
      T     <span class="hljs-comment">#TEMP6</span><font></font>
      JU    M005<font></font>
M010: L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
      L     <span class="hljs-number">0</span>
      T     <span class="hljs-comment">#TEMP6</span>
      TAR1  <span class="hljs-comment">#TEMP4</span>
M005: TAR1  <span class="hljs-comment">#TEMP4</span><font></font>
      CLR   <font></font>
      =     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#TEMP13</span>
      L     L<span class="hljs-comment">#20</span><font></font>
      ==I   <font></font>
      S     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#TEMP15</span><font></font>
      ==I   <font></font>
      A     <span class="hljs-comment">#TEMP16</span><font></font>
      JC    M017<font></font>
      L     <span class="hljs-comment">#TEMP13</span>
      L     L<span class="hljs-comment">#20</span><font></font>
      &lt;I    <font></font>
      S     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#TEMP15</span><font></font>
      ==I   <font></font>
      A     <span class="hljs-comment">#TEMP16</span><font></font>
      JC    M018<font></font>
      JU    M019<font></font>
M017: SET   <font></font>
      =     <span class="hljs-comment">#TEMP14</span><font></font>
      JU    M016<font></font>
M018: CLR   <font></font>
      =     <span class="hljs-comment">#TEMP14</span><font></font>
      JU    M016<font></font>
M019: CLR   <font></font>
      O     <span class="hljs-comment">#TEMP14</span>
      =     <span class="hljs-comment">#RET_VAL</span><font></font>
      JU    M015<font></font>
M016: CLR   <font></font>
      O     <span class="hljs-comment">#TEMP14</span>
      =     <span class="hljs-comment">#RET_VAL</span></code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードは非常に膨大であり、STLに慣れていない人にとっては、複雑に見えるかもしれません。この記事のフレームワーク内で各命令を分解しても意味がありません。詳細な手順とSTL言語機能については、対応するマニュアルを参照してください：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S7-300およびS7-400プログラミングのステートメントリスト（STL）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここで、処理後に同じコードを与えます-ラベルと変数の名前を変更し、作業のアルゴリズムとSTL言語のいくつかの構成を説明するコメントを追加します。</font><font style="vertical-align: inherit;">検討中のブロックには、内容がわかっているDB100ブロックにあるバイトコードを実行する仮想マシンが実装されていることをすぐに指摘します。</font><font style="vertical-align: inherit;">仮想マシン命令は、1バイトの操作コードと1バイトの引数であり、各引数に1バイトです。</font><font style="vertical-align: inherit;">説明されているすべての指示には2つの引数があります。コメントでそれらの値をXとYとして指定しました。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理後のコード</font></font></b><div class="spoiler_text">]<br>
<pre><code class="perl hljs"><span class="hljs-comment">#   </span>
      L     B<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#CHECK_N        #    </span>
      T     <span class="hljs-comment">#COUNTER_N      #    </span>
      L     P<span class="hljs-comment">#DBX 0.0</span>
      T     <span class="hljs-comment">#POINTER        #    </span><font></font>
      CLR   <font></font>
      =     <span class="hljs-comment">#PRE_RET_VAL</span><font></font>
<font></font>
<span class="hljs-comment">#     -</span>
LOOP: L     <span class="hljs-comment">#POINTER</span><font></font>
      LAR1  <font></font>
      OPN   DB   <span class="hljs-number">100</span><font></font>
      L     DBLG<font></font>
      TAR1  <font></font>
      &lt;=D                   <span class="hljs-comment">#      </span><font></font>
      JC    FINISH<font></font>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#REG0</span>
      L     <span class="hljs-comment">#TEMP6</span>
      L     W<span class="hljs-comment">#16#0</span><font></font>
      &lt;&gt;I   <font></font>
      JC    M00d<font></font>
      L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
<font></font>
<span class="hljs-comment">#  switch - case    </span>
M00d: L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#1</span><font></font>
      ==I   <font></font>
      JC    OPCODE_1<font></font>
      L     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#2</span><font></font>
      ==I   <font></font>
      JC    OPCODE_2<font></font>
      L     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#3</span><font></font>
      ==I   <font></font>
      JC    OPCODE_3<font></font>
      L     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#4</span><font></font>
      ==I   <font></font>
      JC    OPCODE_4<font></font>
      L     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#5</span><font></font>
      ==I   <font></font>
      JC    OPCODE_5<font></font>
      L     <span class="hljs-comment">#OPCODE</span>
      L     W<span class="hljs-comment">#16#6</span><font></font>
      ==I   <font></font>
      JC    OPCODE_6<font></font>
      JU    OPCODE_OTHER<font></font>
<font></font>
<span class="hljs-comment">#   01:    DB101[X]   Y</span>
<span class="hljs-comment"># OP01(X, Y): REG[Y] = DB101[X]</span>
OPCODE_1: +AR1  P<span class="hljs-comment">#1.0</span>
      L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR2  <font></font>
      L     B [AR1,P<span class="hljs-comment">#0.0]   #   X (  DB101)</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]   #   Y ( )</span>
      JL    M003            <span class="hljs-comment">#  switch - case    Y</span>
      JU    M001            <span class="hljs-comment">#      .</span>
      JU    M002            <span class="hljs-comment">#      </span>
      JU    M004            <span class="hljs-comment">#     </span><font></font>
M003: JU    LOOPEND<font></font>
M001: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#REG0           #   DB101[X]  REG[0]</span><font></font>
      JU    PRE_LOOPEND<font></font>
M002: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#REG1           #   DB101[X]  REG[1]</span><font></font>
      JU    PRE_LOOPEND<font></font>
M004: OPN   DB   <span class="hljs-number">101</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#REG2           #   DB101[X]  REG[2]</span><font></font>
      JU    PRE_LOOPEND<font></font>
<font></font>
<span class="hljs-comment">#   02:   X   Y</span>
<span class="hljs-comment"># OP02(X, Y): REG[Y] = X</span>
OPCODE_2: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP3</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span><font></font>
      JL    M009<font></font>
      JU    M00b<font></font>
      JU    M00a<font></font>
      JU    M00c<font></font>
M009: JU    LOOPEND<font></font>
M00b: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#REG0</span><font></font>
      JU    PRE_LOOPEND<font></font>
M00a: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#REG1</span><font></font>
      JU    PRE_LOOPEND<font></font>
M00c: L     <span class="hljs-comment">#TEMP3</span>
      T     <span class="hljs-comment">#REG2</span><font></font>
      JU    PRE_LOOPEND<font></font>
<font></font>
<span class="hljs-comment">#  03    ,   </span><font></font>
...<font></font>
<font></font>
<span class="hljs-comment">#   04:   X  Y</span>
<span class="hljs-comment"># OP04(X, Y): REG[0] = 0; REG[X] = (REG[X] == REG[Y])</span>
OPCODE_4: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7          #   - X</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9          # REG[X]</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10         # REG[Y]</span>
      TAR1  <span class="hljs-comment">#POINTER</span>
      LAR1  <span class="hljs-comment">#TEMP9          # REG[X]</span>
      LAR2  <span class="hljs-comment">#TEMP10         # REG[Y]</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      AW    <font></font>
      INVI  <font></font>
      T     <span class="hljs-comment">#TEMP12         # ~(REG[Y] &amp; REG[X])</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      OW    <font></font>
      L     <span class="hljs-comment">#TEMP12</span>
      AW                    <span class="hljs-comment"># (~(REG[Y] &amp; REG[X])) &amp; (REG[Y] | REG[X]) -    </span>
      T     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#REG0</span>
      L     MB   <span class="hljs-number">101</span>
      T     <span class="hljs-comment">#REG1</span>
      L     MB   <span class="hljs-number">102</span>
      T     <span class="hljs-comment">#REG2</span>
      L     <span class="hljs-comment">#POINTER</span><font></font>
      LAR1  <font></font>
      JU    PRE_LOOPEND<font></font>
<font></font>
<span class="hljs-comment">#   05:   Y  X</span>
<span class="hljs-comment"># OP05(X, Y): REG[0] = 0; REG[X] = REG[X] - REG[Y]</span>
OPCODE_5: +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9          # REG[X]</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10         # REG[Y]</span>
      TAR1  <span class="hljs-comment">#POINTER</span>
      LAR1  <span class="hljs-comment">#TEMP9</span>
      LAR2  <span class="hljs-comment">#TEMP10</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span>
      -I                    <span class="hljs-comment"># ACCU1 = ACCU2 - ACCU1, REG[X] - REG[Y]</span>
      T     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     DW<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#REG0</span>
      L     MB   <span class="hljs-number">101</span>
      T     <span class="hljs-comment">#REG1</span>
      L     MB   <span class="hljs-number">102</span>
      T     <span class="hljs-comment">#REG2</span>
      L     <span class="hljs-comment">#POINTER</span><font></font>
      LAR1  <font></font>
      JU    PRE_LOOPEND<font></font>
<font></font>
<span class="hljs-comment">#   06:  #CHECK_N    X  Y</span>
<span class="hljs-comment"># OP06(X, Y): #CHECK_N += (1 if REG[X] == REG[Y] else 0)</span>
OPCODE_6: L     <span class="hljs-comment">#COUNTER_N</span>
      INC   <span class="hljs-number">1</span>
      T     <span class="hljs-comment">#COUNTER_N</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP7          #  REG[X]     </span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP7</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP9          #  REG[X]  </span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      T     <span class="hljs-comment">#TEMP8</span>
      L     P<span class="hljs-comment">#M 100.0</span><font></font>
      LAR2  <font></font>
      L     <span class="hljs-comment">#TEMP8</span>
      L     C<span class="hljs-comment">#8</span><font></font>
      *I    <font></font>
      +AR2  <font></font>
      TAR2  <span class="hljs-comment">#TEMP10         # REG[Y]</span>
      TAR1  <span class="hljs-comment">#POINTER</span>
      LAR1  <span class="hljs-comment">#TEMP9          # REG[Y]</span>
      LAR2  <span class="hljs-comment">#TEMP10         # REG[X]</span>
      L     B [AR1,P<span class="hljs-comment">#0.0]</span>
      L     B [AR2,P<span class="hljs-comment">#0.0]</span><font></font>
      ==I   <font></font>
      JCN   M013<font></font>
      JU    M014<font></font>
M013: L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
      T     <span class="hljs-comment">#POINTER</span>
      L     B<span class="hljs-comment">#16#0</span>
      T     <span class="hljs-comment">#TEMP6</span><font></font>
      JU    PRE_LOOPEND<font></font>
M014: L     <span class="hljs-comment">#POINTER</span><font></font>
      LAR1  <font></font>
<span class="hljs-comment">#   #CHECK_N</span>
      L     <span class="hljs-comment">#CHECK_N</span>
      L     L<span class="hljs-comment">#1</span><font></font>
      +I    <font></font>
      T     <span class="hljs-comment">#CHECK_N</span><font></font>
      JU    PRE_LOOPEND<font></font>
<font></font>
PRE_LOOPEND: L     <span class="hljs-comment">#REG0</span>
      T     MB   <span class="hljs-number">100</span>
      L     <span class="hljs-comment">#REG1</span>
      T     MB   <span class="hljs-number">101</span>
      L     <span class="hljs-comment">#REG2</span>
      T     MB   <span class="hljs-number">102</span>
      +AR1  P<span class="hljs-comment">#1.0</span>
      L     <span class="hljs-comment">#TEMP6</span>
      +     <span class="hljs-number">1</span>
      T     <span class="hljs-comment">#TEMP6</span><font></font>
      JU    LOOPEND<font></font>
<font></font>
OPCODE_OTHER: L     P<span class="hljs-comment">#DBX 0.0</span><font></font>
      LAR1  <font></font>
      L     <span class="hljs-number">0</span>
      T     <span class="hljs-comment">#TEMP6</span>
      TAR1  <span class="hljs-comment">#POINTER</span><font></font>
<font></font>
LOOPEND: TAR1  <span class="hljs-comment">#POINTER</span><font></font>
      CLR   <font></font>
      =     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#CHECK_N</span>
      L     L<span class="hljs-comment">#20</span><font></font>
      ==I   <font></font>
      S     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#COUNTER_N</span><font></font>
      ==I   <font></font>
      A     <span class="hljs-comment">#TEMP16</span>
<span class="hljs-comment">#   ,  #CHECK_N == #COUNTER_N == 20</span><font></font>
      JC    GOOD<font></font>
      L     <span class="hljs-comment">#CHECK_N</span>
      L     L<span class="hljs-comment">#20</span><font></font>
      &lt;I    <font></font>
      S     <span class="hljs-comment">#TEMP16</span>
      L     <span class="hljs-comment">#COUNTER_N</span><font></font>
      ==I   <font></font>
      A     <span class="hljs-comment">#TEMP16</span><font></font>
      JC    FAIL<font></font>
      JU    M019<font></font>
GOOD: SET   <font></font>
      =     <span class="hljs-comment">#PRE_RET_VAL</span><font></font>
      JU    FINISH<font></font>
FAIL: CLR   <font></font>
      =     <span class="hljs-comment">#PRE_RET_VAL</span><font></font>
      JU    FINISH<font></font>
M019: CLR   <font></font>
      O     <span class="hljs-comment">#PRE_RET_VAL</span>
      =     <span class="hljs-comment">#RET_VAL</span><font></font>
      JU    LOOP<font></font>
FINISH: CLR   <font></font>
      O     <span class="hljs-comment">#PRE_RET_VAL</span>
      =     <span class="hljs-comment">#RET_VAL</span></code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシン命令についてのアイデアを得たので、DB100ブロックのバイトコードを解析するための小さな逆アセンブラーを作成します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> string<font></font>
alph = string.ascii_letters + string.digits<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">'DB100.bin'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    m = f.read()<font></font>
<font></font>
pc = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> pc &lt; len(m):<font></font>
    op = m[pc]<font></font>
    <span class="hljs-keyword">if</span> op == <span class="hljs-number">1</span>:<font></font>
        print(<span class="hljs-string">'R{} = DB101[{}]'</span>.format(m[pc + <span class="hljs-number">2</span>], m[pc + <span class="hljs-number">1</span>]))<font></font>
        pc += <span class="hljs-number">3</span>
    <span class="hljs-keyword">elif</span> op == <span class="hljs-number">2</span>:<font></font>
        c = chr(m[pc + <span class="hljs-number">1</span>])<font></font>
        c = c <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> alph <span class="hljs-keyword">else</span> <span class="hljs-string">'?'</span>
        print(<span class="hljs-string">'R{} = {:02x} ({})'</span>.format(m[pc + <span class="hljs-number">2</span>], m[pc + <span class="hljs-number">1</span>], c))<font></font>
        pc += <span class="hljs-number">3</span>
    <span class="hljs-keyword">elif</span> op == <span class="hljs-number">4</span>:<font></font>
        print(<span class="hljs-string">'R0 = 0; R{} = (R{} == R{})'</span>.format(<font></font>
            m[pc + <span class="hljs-number">1</span>], m[pc + <span class="hljs-number">1</span>], m[pc + <span class="hljs-number">2</span>]))<font></font>
        pc += <span class="hljs-number">3</span>
    <span class="hljs-keyword">elif</span> op == <span class="hljs-number">5</span>:<font></font>
        print(<span class="hljs-string">'R0 = 0; R{} = R{} - R{}'</span>.format(<font></font>
            m[pc + <span class="hljs-number">1</span>], m[pc + <span class="hljs-number">1</span>], m[pc + <span class="hljs-number">2</span>]))<font></font>
        pc += <span class="hljs-number">3</span>
    <span class="hljs-keyword">elif</span> op == <span class="hljs-number">6</span>:<font></font>
        print(<span class="hljs-string">'CHECK (R{} == R{})\n'</span>.format(<font></font>
            m[pc + <span class="hljs-number">1</span>], m[pc + <span class="hljs-number">2</span>]))<font></font>
        pc += <span class="hljs-number">3</span>
    <span class="hljs-keyword">else</span>:<font></font>
        print(<span class="hljs-string">'unk opcode {}'</span>.format(op))
        <span class="hljs-keyword">break</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、次の仮想マシンコードが取得されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンコード</font></font></b><div class="spoiler_text"><pre><code class="python hljs">R1 = DB101[<span class="hljs-number">0</span>]<font></font>
R2 = <span class="hljs-number">6</span>e (n)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">1</span>]<font></font>
R2 = <span class="hljs-number">10</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">20</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">2</span>]<font></font>
R2 = <span class="hljs-number">77</span> (w)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">3</span>]<font></font>
R2 = <span class="hljs-number">0</span>a (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">16</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">4</span>]<font></font>
R2 = <span class="hljs-number">75</span> (u)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">5</span>]<font></font>
R2 = <span class="hljs-number">0</span>a (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">16</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">6</span>]<font></font>
R2 = <span class="hljs-number">34</span> (<span class="hljs-number">4</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">7</span>]<font></font>
R2 = <span class="hljs-number">26</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">4</span>c (L)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">8</span>]<font></font>
R2 = <span class="hljs-number">33</span> (<span class="hljs-number">3</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">9</span>]<font></font>
R2 = <span class="hljs-number">0</span>a (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">16</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">10</span>]<font></font>
R2 = <span class="hljs-number">37</span> (<span class="hljs-number">7</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">11</span>]<font></font>
R2 = <span class="hljs-number">22</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">46</span> (F)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">12</span>]<font></font>
R2 = <span class="hljs-number">33</span> (<span class="hljs-number">3</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">13</span>]<font></font>
R2 = <span class="hljs-number">0</span>a (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">16</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">14</span>]<font></font>
R2 = <span class="hljs-number">6</span>d (m)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">15</span>]<font></font>
R2 = <span class="hljs-number">11</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">23</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">16</span>]<font></font>
R2 = <span class="hljs-number">35</span> (<span class="hljs-number">5</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">17</span>]<font></font>
R2 = <span class="hljs-number">12</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">25</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">18</span>]<font></font>
R2 = <span class="hljs-number">33</span> (<span class="hljs-number">3</span>)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = (R1 == R2)<font></font>
CHECK (R1 == R0)<font></font>
<font></font>
R1 = DB101[<span class="hljs-number">19</span>]<font></font>
R2 = <span class="hljs-number">26</span> (?)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
R2 = <span class="hljs-number">4</span>c (L)<font></font>
R0 = <span class="hljs-number">0</span>; R1 = R1 - R2<font></font>
CHECK (R1 == R0)</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、このプログラムは、DB101の各文字を特定の値と等しいかどうかをチェックするだけです。</font><font style="vertical-align: inherit;">すべてのチェックに合格するための最後の行：n0w u 4r3 7h3 m4573r。</font><font style="vertical-align: inherit;">このラインがDB101ブロックに配置されている場合、PLCの手動制御がアクティブになり、バルーンを爆発または収縮させることができます。 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です！</font><font style="vertical-align: inherit;">アレクセイは産業忍者にふさわしい高いレベルの知識を示しました:)私たちは受賞者に記念品を送りました。</font><font style="vertical-align: inherit;">参加者のみなさん、ありがとうございました！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460599/index.html">OpenStreetMap No. 468の世界からのニュース（2019年7月2日-2019年7月8日）</a></li>
<li><a href="../ja460603/index.html">V2G。電気自動車は電力の生産と消費のバランスをとるのに役立ちます</a></li>
<li><a href="../ja460605/index.html">自動写真スタジオ、パート1</a></li>
<li><a href="../ja460607/index.html">Androidのハッキングツールを備えた攻撃的なセキュリティアプリストア</a></li>
<li><a href="../ja460611/index.html">フェイルオーバー：完璧主義は私たちを台無しにし...怠惰</a></li>
<li><a href="../ja460617/index.html">RTOSに関する真実。記事＃30。Nucleus SEの初期化と起動手順</a></li>
<li><a href="../ja460621/index.html">Tic Tac Toe、パート4：HTTPを使用したFlaskバックエンドとのやり取り</a></li>
<li><a href="../ja460623/index.html">ジュリアン・アサンジの拷問について</a></li>
<li><a href="../ja460625/index.html">私はTelegramのJavaScript開発者のための競争で1位にならなかったので</a></li>
<li><a href="../ja460627/index.html">vGPU-使用は無視できません</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>