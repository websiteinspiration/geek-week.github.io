<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÇ üë©üèΩ‚Äç‚öñÔ∏è üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø Como funciona a renderiza√ß√£o de jogos em 3D: texturiza√ß√£o e filtragem de textura üî∫ üôå üë®üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No terceiro artigo sobre renderiza√ß√£o em jogos 3D, descobriremos o que acontece com o mundo 3D ap√≥s o processamento do v√©rtice e a rasteriza√ß√£o da cen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como funciona a renderiza√ß√£o de jogos em 3D: texturiza√ß√£o e filtragem de textura</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499540/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a4/fee/0c7/2a4fee0c701c2b2200faf2b8c6929832.jpg" alt="imagem"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No terceiro artigo sobre renderiza√ß√£o em jogos 3D, descobriremos o que acontece com o mundo 3D ap√≥s o processamento do v√©rtice e a rasteriza√ß√£o da cena. </font><font style="vertical-align: inherit;">A texturiza√ß√£o √© um dos est√°gios mais importantes da renderiza√ß√£o, apesar de apenas calcular e alterar as cores de uma grade bidimensional de blocos multicoloridos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos efeitos visuais nos jogos modernos se resume ao uso deliberado de texturas - sem eles, os jogos pareceriam chatos e sem vida. </font><font style="vertical-align: inherit;">Ent√£o, vamos ver como tudo funciona! </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1: processamento de v√©rtices </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2: rasteriza√ß√£o e rastreamento de raios</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com um simples</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode pegar qualquer jogo tridimensional mais vendido lan√ßado no ano passado e dizer com confian√ßa que todos eles t√™m algo em comum: eles usam </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapas de textura</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou apenas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texturas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Esse √© um termo t√£o comum que, ao pensar em texturas, a maioria das pessoas apresenta a mesma figura: um simples quadrado ou ret√¢ngulo plano contendo uma imagem de uma superf√≠cie (grama, pedra, metal, tecido, rosto, etc.). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por√©m, quando usadas e combinadas usando c√°lculos complexos, essas imagens simples em uma cena 3D podem criar imagens incrivelmente realistas. Para entender como isso √© poss√≠vel, vamos deslig√°-los completamente e ver como ser√£o os objetos do mundo 3D sem texturas.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vimos nos artigos anteriores, o mundo 3D √© composto de v√©rtices - formas simples que se movem e depois colorem. Eles s√£o usados ‚Äã‚Äãpara criar primitivas, que por sua vez s√£o compactadas em uma grade bidimensional de pixels. Como n√£o usaremos texturas, precisamos colorir esses pixels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos m√©todos que pode ser aplicado √© chamado de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreamento simples</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a cor do primeiro v√©rtice da primitiva √© obtida e, em seguida, essa cor √© aplicada a todos os pixels cobertos pela figura na varredura. Parece algo como isto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0b/f5c/61b/a0bf5c61be539c776d00fa1b11177ced.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, a chaleira parece irrealista, e n√£o menos importante por causa das cores irregulares da superf√≠cie. As cores saltam de um n√≠vel para outro, n√£o h√° transi√ß√µes suaves. Uma solu√ß√£o para o problema pode ser usar o </font></font><em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreamento Gouraud</font></font></a></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse processo, as cores dos v√©rtices s√£o obtidas, ap√≥s o qual a cor muda ao longo da superf√≠cie do tri√¢ngulo. Para isso, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© usada interpola√ß√£o linear</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parece complicado, mas, na realidade, isso significa que se, por exemplo, um lado do primitivo tiver uma cor de 0,2 vermelho e o outro 0,8 vermelho, o meio da figura ter√° uma cor no meio entre 0,2 e 0,8 (ou seja, 0,5).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse processo √© bastante simples e essa √© sua principal vantagem, porque simplicidade significa velocidade. Muitos jogos 3D mais antigos usavam essa t√©cnica porque o equipamento de computa√ß√£o era limitado em suas capacidades.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/128/447/3c8/1284473c8e1e2ce7d32dbf2202065afe.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barrett e Cloud em toda a grandeza do sombreamento de Gouraud (Final Fantasy VII, 1997)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mas mesmo essa solu√ß√£o tem problemas - se a luz cair bem no meio do tri√¢ngulo, seus cantos (e v√©rtices) podem n√£o transmitir essa propriedade. </font><font style="vertical-align: inherit;">Isso significa que o brilho criado pela luz pode ser completamente perdido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora o sombreamento simples e o sombreamento de Gouraud ocupem o devido lugar nas ferramentas de renderiza√ß√£o, os exemplos mostrados acima s√£o candidatos claros ao aprimoramento da textura. </font><font style="vertical-align: inherit;">E para entender bem o que acontece quando a textura √© sobreposta √† superf√≠cie, voltaremos no tempo ... j√° em 1996.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breve hist√≥ria do jogo e da GPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° cerca de 23 anos, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id Software</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lan√ßou o Quake, e se tornou um marco importante. </font><font style="vertical-align: inherit;">Embora este n√£o tenha sido o primeiro jogo a usar pol√≠gonos e texturas 3D para renderizar ambientes, foi definitivamente um dos primeiros a us√°-los efetivamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas ela fez outra coisa tamb√©m - ela mostrou o que pode ser feito usando o OpenGL (essa API de gr√°ficos estava na primeira vers√£o da √©poca) e tamb√©m ajudou muito a primeira gera√ß√£o de placas gr√°ficas como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendition Verite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3Dfx Voodoo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a86/9a9/667/a869a966718cfc8ddf4b6d7618b2fdbf.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Picos de ilumina√ß√£o e texturas simples. </font><font style="vertical-align: inherit;">Limpe 1996, limpe Quake. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelos padr√µes modernos, o Voodoo era extremamente simples: sem suporte a gr√°ficos 2D, sem processamento de v√©rtice, apenas o processamento de pixel mais simples. </font><font style="vertical-align: inherit;">No entanto, ela era linda:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66c/509/911/66c5099113c9b08098b73ce31436ecb8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Museu VGA</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ela tinha um chip inteiro (TMU) para obter um pixel de uma textura e outro chip (FBI) para depois mistur√°-lo com um pixel raster. O mapa pode executar alguns processos adicionais, por exemplo, a implementa√ß√£o de efeitos de neblina ou transpar√™ncia, mas isso, em ess√™ncia, termina com seus recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se observarmos a arquitetura subjacente √† estrutura e opera√ß√£o da placa gr√°fica, veremos como esses processos funcionam.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/c83/ee4/064c83ee4f63da2be0d5a968c33df0d5.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifica√ß√£o 3Dfx. Fonte: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falconfly Central</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O chip do FBI recebeu dois valores de cores e os misturou; um deles pode ser um valor de uma textura. O processo de mixagem √© matematicamente bastante simples, mas varia um pouco, dependendo do que √© mixado e da API usada para executar as instru√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se observarmos o que o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direct3D nos oferece</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em rela√ß√£o √†s fun√ß√µes e opera√ß√µes de mixagem, veremos que cada pixel √© multiplicado pela primeira vez por um n√∫mero de 0,0 a 1,0. Isso determina quanto a cor do pixel afetar√° o resultado final. Em seguida, duas cores de pixel alteradas s√£o adicionadas, subtra√≠das ou multiplicadas; em algumas fun√ß√µes, √© executada uma opera√ß√£o l√≥gica na qual, por exemplo, o pixel mais brilhante √© sempre selecionado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa1/c8b/c8a/aa1c8bc8a2e35a1867c5f6028d958fa8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog de tecnologia do Taking Initiative</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A imagem acima mostra como isso funciona na pr√°tica; observe que o valor </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alfa</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do pixel √© usado como um coeficiente para o </font><font style="vertical-align: inherit;">pixel </font><font style="vertical-align: inherit;">esquerdo </font><font style="vertical-align: inherit;">. Este n√∫mero indica a quantidade de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transpar√™ncia do</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outros est√°gios, o valor de neblina √© aplicado (√© retirado da tabela criada pelo programador e, em seguida, s√£o executados os mesmos c√°lculos de mistura); realizando verifica√ß√µes e altera√ß√µes na visibilidade e transpar√™ncia; no final, a cor do pixel √© gravada na mem√≥ria da placa gr√°fica.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que voc√™ precisa dessa excurs√£o pela hist√≥ria? </font><font style="vertical-align: inherit;">Bem, apesar da relativa simplicidade do design (especialmente se comparado aos monstros modernos), esse processo descreve os princ√≠pios fundamentais da texturiza√ß√£o: pegamos os valores das cores e as misturamos para que os modelos e ambientes pare√ßam como deveriam em uma situa√ß√£o espec√≠fica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os jogos modernos fazem a mesma coisa, a √∫nica diferen√ßa √© o n√∫mero de texturas usadas e a complexidade dos c√°lculos de mistura. </font><font style="vertical-align: inherit;">Juntos, eles simulam os efeitos visuais encontrados nos filmes ou a intera√ß√£o da ilumina√ß√£o com diferentes materiais e superf√≠cies.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No√ß√µes b√°sicas de texturiza√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√≥s, uma textura √© uma imagem 2D plana sobreposta aos pol√≠gonos que comp√µem a estrutura 3D no quadro. No entanto, para um computador, esse √© apenas um pequeno bloco de mem√≥ria na forma de uma matriz 2D. Cada elemento da matriz indica o valor da cor de um dos pixels na imagem da textura (normalmente denominada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texels</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pixels de textura). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada v√©rtice do pol√≠gono possui um conjunto de duas coordenadas (geralmente denotadas como </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u, v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), informando ao computador qual pixel da textura est√° associado a ele. O pr√≥prio v√©rtice possui um conjunto de tr√™s coordenadas ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x, y, z</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), e o processo de vincular texels aos v√©rtices √© chamado de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapeamento de textura</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver como isso acontece, vejamos a ferramenta que j√° usamos v√°rias vezes nesta s√©rie de artigos - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebGL de renderiza√ß√£o em tempo real</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por enquanto, tamb√©m descartamos a coordenada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos </font><font style="vertical-align: inherit;">v√©rtices e consideramos tudo em um plano.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e1/d20/fbb/8e1d20fbb308d78a19a2e54d5da96900.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da esquerda para a direita: as coordenadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u, v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><font style="vertical-align: inherit;">textura, diretamente ligadas √†s coordenadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x, y</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos </font><font style="vertical-align: inherit;">v√©rtices </font><font style="vertical-align: inherit;">dos </font><font style="vertical-align: inherit;">cantos. Na segunda imagem, as coordenadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o aumentadas nos v√©rtices superiores </font><font style="vertical-align: inherit;">, mas, como a textura ainda est√° anexada a elas, ela se estende verticalmente. A textura j√° foi alterada na imagem correta: os valores de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aumentaram, mas como resultado, a textura foi compactada e depois repetida.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Isso aconteceu porque, apesar de, de fato, a textura ter se tornado mais alta devido ao aumento do valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ela ainda deve se encaixar no primitivo - na verdade, a textura parcialmente repetida. Esta √© uma maneira de implementar o efeito frequentemente encontrado em jogos 3D: </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repetir texturas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Exemplos desse efeito podem ser vistos em cenas com paisagens pedregosas ou gramadas, bem como com paredes de tijolos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos mudar a cena para que haja mais primitivas e retornar novamente a profundidade da cena. A vista de paisagem cl√°ssica √© mostrada abaixo, mas agora a textura da caixa √© copiada e repetida para todas as primitivas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9e/9e1/0cb/a9e9e10cb533b78330f90fd7eaea3891.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A textura da caixa em seu formato gif original tem um tamanho de 66 KB e uma resolu√ß√£o de 256 x 256 pixels. A resolu√ß√£o inicial da parte do quadro coberta pelas texturas da caixa √© de 1900 x 680, ou seja, do ponto de vista da ‚Äú√°rea‚Äù de pixel, essa √°rea deve exibir apenas 20 texturas de caixa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas √© √≥bvio que vemos muito mais do que vinte caixas, e isso significa que a textura da caixa √† dist√¢ncia deve ser </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menor que 256 x 256 pixels. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eles foram submetidos a um processo chamado </font><em><font style="vertical-align: inherit;">‚Äúminifica√ß√£o de textura‚Äù</font></em><font style="vertical-align: inherit;"> (sim, essa palavra existe em ingl√™s!). Agora, vamos repetir, mas desta vez aproxime a c√¢mera de uma das gavetas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/404/c02/f70/404c02f70291916245ec931642c79860.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o se esque√ßa que a textura tem um tamanho de apenas 256 x 256 pixels, mas aqui vemos uma textura que √© maior que a metade da imagem, com uma largura de 1900 pixels. </font><font style="vertical-align: inherit;">Essa textura foi submetida a uma opera√ß√£o de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"amplia√ß√£o da textura"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses dois processos de textura ocorrem constantemente em jogos 3D, porque quando a c√¢mera se move pela cena, os modelos se aproximam ou se afastam, e todas as texturas aplicadas √†s primitivas devem ser dimensionadas juntamente com os pol√≠gonos. </font><font style="vertical-align: inherit;">Do ponto de vista da matem√°tica, esse √© um pequeno problema; de fato, mesmo os chips gr√°ficos integrados mais simples podem fazer esse trabalho facilmente. </font><font style="vertical-align: inherit;">No entanto, reduzir e ampliar as texturas s√£o novos desafios que precisam ser abordados de alguma forma.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mini-c√≥pias de texturas aparecem em cena</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro problema a resolver para texturas √© a dist√¢ncia. Se retornarmos √† primeira imagem com uma paisagem de caixas, as caixas localizadas perto do horizonte ter√£o um tamanho de apenas alguns pixels. Portanto, tentar compactar uma imagem de 256 x 256 pixels em um espa√ßo t√£o pequeno √© in√∫til por dois motivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, a textura menor ocupa menos mem√≥ria da placa gr√°fica, o que √© conveniente, porque voc√™ pode tentar ajust√°-la em um cache menor. Isso significa que √© menos prov√°vel que seja exclu√≠do do cache, ou seja, o uso repetido dessa textura fornecer√° um desempenho aprimorado, porque os dados estar√£o na mem√≥ria pr√≥xima. Pela segunda raz√£o, retornaremos em breve, porque est√° associado ao mesmo problema que surge em texturas pr√≥ximas √† c√¢mera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o padr√£o para o problema da necessidade de compactar texturas grandes em pequenas primitivas √© usar </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texturas mip (mipmaps)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Essas s√£o vers√µes em tamanho reduzido da textura original; eles podem ser gerados pelo pr√≥prio mecanismo (usando os comandos de API apropriados) ou pr√©-criados pelos designers de jogos. Cada n√≠vel subsequente de textura mip tem metade do tamanho em compara√ß√£o com o anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, para a textura da caixa, as dimens√µes ser√£o: 256 x 256 ‚Üí 128 x 128 ‚Üí 64 x 64 ‚Üí 32 x 32 ‚Üí 16 x 16 ‚Üí 8 x 8 ‚Üí 4 x 4 ‚Üí 2 x 2 ‚Üí 1 x 1.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/074/973/1ea/0749731eae53d112d545c0297ac14584.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas as texturas mip s√£o empacotadas juntas, portanto a textura tem o mesmo nome de arquivo, mas aumenta em tamanho. A textura √© compactada de tal maneira que as coordenadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u, v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o apenas determinam qual texel √© sobreposto no pixel no quadro, mas tamb√©m com qual textura mip. Em seguida, os programadores escrevem um renderizador, com base no valor da profundidade de pixel do quadro, que determina qual textura mip usar. Por exemplo, se o valor for muito alto, o pixel estar√° muito distante, o que significa que voc√™ pode usar uma pequena textura mip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leitores atentos podem notar a falta de texturas mip - eles t√™m que pagar por elas aumentando o tamanho das texturas. A textura original da caixa era de 256 x 256 pixels, mas como voc√™ pode ver na imagem acima, a textura com texturas mip agora tem um tamanho de 384 x 256. Sim, possui muito espa√ßo vazio, mas n√£o importa como embalamos texturas menores, em geral o tamanho da textura de um lado aumentar√° em pelo menos 50%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas isso √© verdade apenas para texturas mip criadas anteriormente; se o mecanismo de jogo estiver programado para ger√°-los corretamente, o aumento n√£o ser√° superior a 33% do tamanho da textura original. Portanto, devido a um pequeno aumento na quantidade de mem√≥ria para armazenar texturas mip, obtemos um ganho em desempenho e qualidade visual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° uma compara√ß√£o de imagens com as texturas mip desativadas / ativadas:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/b67/e71/e96b67e71c3f41aed3ce09ed728f98ea.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No lado esquerdo da imagem, as texturas das caixas foram usadas "como est√£o", o que levou ao aparecimento de granularidade e ao chamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moir√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† dist√¢ncia. </font><font style="vertical-align: inherit;">√Ä direita, o uso de texturas mip permitia transi√ß√µes mais suaves e, no horizonte, a textura da caixa fica emba√ßada em uma cor uniforme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, quem quer que as texturas emba√ßadas estragem o cen√°rio de seu jogo favorito?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bilinear, trilinear, anisotr√≥pico - tudo isso √© para mim uma letra chinesa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O processo de sele√ß√£o de um pixel de uma textura para sobrepor-se a um pixel em um quadro √© chamado de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texturas de amostragem</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, em um mundo ideal, haveria uma textura que corresponde idealmente ao primitivo para o qual foi projetado, independentemente do tamanho, posi√ß√£o, dire√ß√£o e assim por diante. </font><font style="vertical-align: inherit;">Em outras palavras, a amostragem da textura seria um simples mapeamento de pixel texel individual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, como n√£o √© assim, h√° v√°rios fatores a serem considerados na amostragem de texturas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A textura foi reduzida ou ampliada?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A textura √© uma fonte ou textura mip?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em que √¢ngulo a textura √© exibida?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos analis√°-los em ordem. O primeiro fator √© bastante √≥bvio: se a textura foi aumentada, no primitivo haver√° mais texels cobrindo o pixel no primitivo do que o necess√°rio; ao diminuir, o oposto √© verdadeiro - agora cada texel deve cobrir v√°rios pixels. E isso √© um problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo fator n√£o causa problemas, porque as texturas mip s√£o usadas para contornar o problema de amostrar as texturas de primitivas long√≠nquas; portanto, a √∫nica tarefa √© exibir as texturas em √¢ngulo. E sim, isso tamb√©m √© um problema. Por qu√™? Porque todas as texturas s√£o imagens geradas para visualiza√ß√£o ‚Äúestritamente na frente‚Äù. Falando em linguagem matem√°tica, a textura normal da superf√≠cie corresponde √† nominal da superf√≠cie na qual a textura √© atualmente exibida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se os texels s√£o muito poucos ou muitos, ou est√£o localizados em √¢ngulo, √© necess√°rio um processo adicional chamado </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"filtragem de textura"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se esse processo n√£o for usado, obtemos o seguinte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/792/a12/552/792a125529b7f3baa79c072fdf42acba.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui substitu√≠mos a textura da caixa por uma textura com a letra R, para mostrar mais claramente em que confus√£o a imagem se transforma sem filtrar as texturas! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIs gr√°ficas como Direct3D, OpenGL e Vulkan fornecem o mesmo conjunto de tipos de filtragem, mas usam nomes diferentes para eles. </font><font style="vertical-align: inherit;">De fato, todos eles se resumem ao seguinte:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amostragem no ponto pr√≥ximo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtragem linear de textura</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filtragem de textura anisotr√≥pica</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, a </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amostragem do ponto mais pr√≥ximo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><em><font style="vertical-align: inherit;">√©</font></em><font style="vertical-align: inherit;"> um filtro, pois, com ele, apenas o texel mais pr√≥ximo do pixel de textura necess√°rio √© amostrado (por exemplo, copiado da mem√≥ria) e, em seguida, √© misturado com a cor original do pixel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui a filtragem linear vem em nosso aux√≠lio. As coordenadas </font><font style="vertical-align: inherit;">texel </font><font style="vertical-align: inherit;">necess√°rias </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u, v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o transferidas para o equipamento de amostragem, mas, em vez de levar o texel mais pr√≥ximo dessas coordenadas, o amostrador usa </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quatro</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texels. S√£o texels localizados acima, abaixo, √† esquerda e √† direita do texel que s√£o selecionados por amostragem dos pontos mais pr√≥ximos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esses quatro texels s√£o ent√£o misturados usando uma f√≥rmula com pesos. No Vulkan, por exemplo, a f√≥rmula √© assim:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57b/9bb/63c/57b9bb63cc81fa5721b007717f6b200a.png"></div><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> denota a cor texel, onde </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o resultado da filtra√ß√£o e 1-4 √© a cor de quatro texels amostrados. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valores </font><em><font style="vertical-align: inherit;">alfa</font></em><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beta</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o obtidos dependendo de qu√£o longe o ponto com coordenadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u, v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° do meio da textura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente para os envolvidos com gr√°ficos 3D, isso acontece automaticamente no chip gr√°fico. Na verdade, √© exatamente isso que o chip TMF do cart√£o 3dfx Voodoo fez: ele amostrou quatro texels e depois os misturou. No Direct3D, esse processo tem um nome estranho </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a filtragem bilinear.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mas desde os dias do Quake e do chip TMU, as placas gr√°ficas j√° aprenderam a executar a filtragem bilinear em apenas um ciclo de clock (√© claro, se a textura j√° estiver localizada na mem√≥ria mais pr√≥xima). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A filtragem linear pode ser usada junto com as texturas mip e, se voc√™ quiser complicar a filtragem, pode pegar quatro texels da textura e depois mais quatro do pr√≥ximo n√≠vel da textura mip, misturando todos eles. E como √© chamado no Direct3D? </font><font style="vertical-align: inherit;">Filtragem </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trilinear</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De onde vieram os </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"tr√™s"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nesse processo </font><font style="vertical-align: inherit;">? Portanto, n√£o sabemos ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫ltimo m√©todo de filtragem que vale a pena mencionar √© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anisotr√≥pico</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De fato, √© uma melhoria no processo realizado por filtragem bilinear ou trilinear. Inicialmente, calcula</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o grau de anisotropia da</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> superf√≠cie primitiva (e este √© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um processo surpreendentemente complexo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - esse valor aumenta a altera√ß√£o na propor√ß√£o da primitiva devido √† sua orienta√ß√£o:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/247/dfe/e60/247dfee60846988a5e94a1020d9ecef6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A figura acima mostra o mesmo quadrado primitivo com comprimentos laterais iguais; mas girando gradualmente, ele se transforma em um ret√¢ngulo e sua largura muda mais do que sua altura. Portanto, a primitiva √† direita tem um maior grau de anisotropia do que √† esquerda (e no caso de um quadrado, o grau √© zero). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitos jogos 3D modernos permitem ativar a filtragem anisotr√≥pica e depois alterar seu n√≠vel (de 1x para 16x), mas o que realmente muda? Este par√¢metro controla o n√∫mero m√°ximo de amostras texel adicionais que s√£o coletadas em cada amostra linear inicial. Suponha que uma filtragem bilinear anisotr√≥pica de 8x esteja ativada no jogo. Isso significa que, em vez de quatro valores texel, ele ter√° 32 valores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A diferen√ßa ao usar a filtragem anisotr√≥pica √© claramente vis√≠vel:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df7/302/372/df7302372c6dc0d34730ba572f695063.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√° at√© a imagem acima e compare a amostragem dos pontos mais pr√≥ximos com uma filtragem trilinear anisotr√≥pica m√°xima de 16x. Surpreendentemente suave! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, para essa beleza suave das texturas, voc√™ precisa pagar com desempenho: nas configura√ß√µes m√°ximas, a filtragem trilinear anisotr√≥pica receber√° 128 amostras da textura para cada pixel de renderiza√ß√£o. Mesmo com as melhores GPUs modernas, isso n√£o pode ser alcan√ßado em um ciclo de clock. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ usar, por exemplo, o AMD </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Radeon RX 5700 XT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cada um dos blocos de texturiza√ß√£o dentro do processador pode usar at√© 32 endere√ßos texel em um ciclo de clock e, no pr√≥ximo ciclo de clock, carregar 32 valores texel da mem√≥ria (cada um com tamanho de 32 bits) e misturar quatro deles em mais um tato. Ou seja, misturar 128 amostras de texel em uma requer pelo menos 16 ciclos de rel√≥gio.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa4/abf/cf4/fa4abfcf4411b6cc2622c8e77986ab3c.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU AMD RDNA Radeon RX 5700 com tecnologia de processo de 7 nan√¥metros</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se a velocidade do clock do 5700 XT for de 1605 MHz, dezesseis ciclos levar√£o apenas 10 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nanossegundos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A execu√ß√£o desses ciclos para cada pixel em um quadro 4K usando apenas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unidade de textura levar√° apenas 70 milissegundos. √ìtimo, parece que o desempenho n√£o √© grande coisa! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo em 1996, o 3Dfx Voodoo e cart√µes semelhantes rapidamente lidaram com texturas. No m√°ximo, eles podiam distribuir 1 texel com filtragem bilinear por ciclo e com uma frequ√™ncia de chip TMU de 50 MHz, isso significava que 50 milh√µes de texels poderiam ser processados ‚Äã‚Äãpor segundo. Um jogo rodando a 800 x 600 e 30 fps requer apenas 14 milh√µes de texels com filtragem bilinear por segundo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, isso √© verdade apenas sob a suposi√ß√£o de que todas as texturas est√£o na mem√≥ria mais pr√≥xima e apenas um texel corresponde a cada pixel. </font><font style="vertical-align: inherit;">Vinte anos atr√°s, a id√©ia da necessidade de sobrepor v√°rias texturas em um primitivo era completamente estranha, mas hoje √© um padr√£o. </font><font style="vertical-align: inherit;">Vamos ver por que isso tudo muda.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar ilumina√ß√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender por que a texturiza√ß√£o se tornou t√£o importante, d√™ uma olhada nesta cena do Quake:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/dcf/ee4/bdadcfee4354ea561b9239e1ca5a143b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma imagem sombria, porque a escurid√£o era a atmosfera do jogo, mas vemos que a escurid√£o n√£o √© a mesma em todos os lugares - alguns fragmentos de paredes e pisos s√£o mais leves que outros, o que cria uma sensa√ß√£o de leveza nessas √°reas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As primitivas que comp√µem as paredes e o piso s√£o sobrepostas com as mesmas texturas, mas h√° outra textura chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúmapa de luz‚Äù</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> misturada com os valores dos texels antes de serem aplicados aos pixels do quadro. Nos tempos do Quake, os mapas de ilumina√ß√£o eram calculados com anteced√™ncia e criados pelo mecanismo do jogo. Eles foram usados ‚Äã‚Äãpara gerar n√≠veis de ilumina√ß√£o est√°ticos e din√¢micos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vantagem de seu uso √© que c√°lculos complexos de ilumina√ß√£o foram executados com texturas em vez de v√©rtices, o que melhorou significativamente a apar√™ncia da cena √† custa de custos de baixa velocidade. Obviamente, a imagem √© imperfeita: no ch√£o, √© percept√≠vel que a borda entre as √°reas iluminadas e as sombras √© muito n√≠tida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De muitas maneiras, um mapa de luz √© apenas outra textura (n√£o se esque√ßa de que todos s√£o conjuntos de dados 2D regulares), portanto, esta cena √© um dos primeiros exemplos de uso de estruturas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√∫ltiplas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como o nome indica, este √© um processo no qual duas ou mais texturas s√£o sobrepostas em uma primitiva. O uso de mapas de ilumina√ß√£o no Quake tornou-se uma maneira de superar as limita√ß√µes do sombreamento Gouraud, mas no processo de aumentar o leque de recursos das placas gr√°ficas, os m√©todos de aplica√ß√£o da multi-extens√£o tamb√©m se expandiram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O 3Dfx Voodoo, como muitos outros cart√µes daquela √©poca, era limitado na quantidade de opera√ß√µes que ele poderia realizar em um √∫nico </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passe de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renderiza√ß√£o. De fato, um passe √© um ciclo completo de renderiza√ß√£o: do processamento de v√©rtices √† rasteriza√ß√£o do quadro e, em seguida, alterando os pixels e gravando-os no buffer de quadros pronto. Vinte anos atr√°s, os jogos quase sempre usavam a renderiza√ß√£o de uma passagem.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a55/0b6/bc9/a550b6bc98c07f1c90276e1aa3721819.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nvidia GeForce 2 Ultra, por volta do final de 2000. Imagem: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wikimedia</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Isso aconteceu porque o segundo processamento de v√©rtice apenas para a aplica√ß√£o de texturas adicionais era muito caro em termos de desempenho. Depois do Voodoo, tivemos que esperar alguns anos quando as placas gr√°ficas ATI Radeon e Nvidia GeForce 2 apareceram, capazes de multi-extens√£o em uma passagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas GPUs tinham v√°rias unidades de textura na √°rea de processamento de pixels (ou seja, no </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pipeline</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), portanto, obter um texel com filtragem bilinear de duas texturas separadas se tornou a tarefa mais simples. Isso aumentou ainda mais a popularidade dos mapas de ilumina√ß√£o e permitiu que os jogos os tornassem totalmente din√¢micos, alterando os valores de ilumina√ß√£o dependendo das condi√ß√µes do ambiente de jogo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas com algumas texturas, muito mais poderia ser feito, ent√£o vamos explorar suas capacidades.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para mudar a altura √© normal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta s√©rie de artigos sobre renderiza√ß√£o em 3D, n√£o falamos sobre como o papel da GPU afeta todo o processo (falaremos sobre isso, mas n√£o agora!). Mas se voc√™ voltar √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parte 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e ler sobre todo o complexo processo de processamento de v√©rtices, poder√° pensar que essa √© a parte mais dif√≠cil de todo o trabalho que a GPU deve executar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante muito tempo, os programadores de jogos fizeram todo o poss√≠vel para reduzir essa carga. Eles tiveram que usar todos os tipos de truques para garantir a mesma qualidade de imagem que ao usar v√°rios v√©rtices, mas n√£o os processam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria desses truques usava texturas chamadas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapas de altura</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapas normais.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esses dois conceitos est√£o conectados pelo fato de que o √∫ltimo pode ser criado a partir do primeiro, mas, por enquanto, vejamos apenas uma t√©cnica chamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"mapeamento de resposta"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e3/db2/5b6/1e3db25b6ecefc0dd3f75c84f767800c.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagens criadas em uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renderiza√ß√£o de demonstra√ß√£o por Emil Persson</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A textura em relevo √© desativada / ativada A textura em relevo</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
usa uma matriz 2D chamada ‚Äúmapa de altura‚Äù que parece uma vers√£o estranha da textura original. </font><font style="vertical-align: inherit;">Por exemplo, a imagem acima mostra uma textura de tijolo realista sobreposta em duas superf√≠cies planas. </font><font style="vertical-align: inherit;">A textura e seu mapa de altura s√£o assim:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a1/87f/221/7a187f2215bcf0723bd4d4f820350858.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As cores do mapa de altura indicam as normais da superf√≠cie dos tijolos (descrevemos as normais na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parte 1 de uma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√©rie de artigos). Quando o processo de renderiza√ß√£o atinge o est√°gio de aplica√ß√£o da textura de tijolo na superf√≠cie, uma s√©rie de c√°lculos √© executada para alterar a cor da textura de tijolo com base em suas normais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado disso, os tijolos parecem tridimensionais, apesar de continuarem completamente planos. Se voc√™ observar atentamente, especialmente nas bordas dos tijolos, poder√° ver as limita√ß√µes dessa t√©cnica: a textura parece levemente distorcida. Mas este √© um truque r√°pido que permite adicionar mais detalhes da superf√≠cie, de modo que a texturiza√ß√£o em relevo √© muito popular.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mapa normal √© semelhante a um mapa de altura, apenas as cores da textura s√£o as pr√≥prias normais. Em outras palavras, c√°lculos para converter o mapa de altura em normal n√£o s√£o necess√°rios. Voc√™ pode fazer uma pergunta: como as cores podem descrever um vetor no espa√ßo? A resposta √© simples: cada texel possui um conjunto de valores de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r, g, b</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (vermelho, verde, azul) e esses valores correspondem diretamente aos valores de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x, y, z</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do vetor normal.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1f/105/c3b/c1f105c3b93c455ba7661489770172c9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O diagrama esquerdo mostra a mudan√ßa na dire√ß√£o das normais em uma superf√≠cie irregular. Para descrever as mesmas normais com uma textura plana (contorno do meio), atribu√≠mos cores a elas. Nesse caso, usamos os valores </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r, g, b</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (0,255.0) para o vetor direcionado para cima e aumentamos o valor de vermelho para inclina√ß√£o para a esquerda e azul para inclina√ß√£o para a direita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se de que essa cor n√£o se mistura com o pixel original, simplesmente informa ao processador em qual dire√ß√£o o normal indica, para que possa calcular corretamente os √¢ngulos entre a c√¢mera, as fontes de luz e a superf√≠cie texturizada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As vantagens da texturiza√ß√£o em relevo e dos mapas normais s√£o totalmente aparentes quando a ilumina√ß√£o din√¢mica √© usada na cena e quando o processo de renderiza√ß√£o calcula o efeito da altera√ß√£o da ilumina√ß√£o pixel por pixel, e n√£o para cada v√©rtice. Hoje, os jogos modernos usam um conjunto de texturas para melhorar a qualidade desse truque.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/d59/660/3efd596604528593b16923297f10f044.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ryan Benno,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Surpreendentemente, essa parede de apar√™ncia realista √© apenas uma superf√≠cie plana, os detalhes de tijolos e cimento de alvenaria n√£o s√£o feitos usando milh√µes de pol√≠gonos. Em vez disso, apenas cinco texturas e o uso ponderado dos c√°lculos s√£o suficientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mapa de altura foi usado para gerar a proje√ß√£o de sombras com tijolos, e um mapa normal foi usado para simular todas as pequenas altera√ß√µes na superf√≠cie. A textura da rugosidade foi usada para alterar a maneira como a luz √© refletida em v√°rios elementos da parede (por exemplo, o tijolo liso reflete a luz de maneira mais uniforme do que o cimento bruto).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √∫ltimo cart√£o, nomeado na imagem AO, cria uma parte do processo chamado oclus√£o ambiental: examinaremos essa t√©cnica em mais detalhes nos artigos a seguir, mas, por enquanto, digamos que isso ajude a aumentar o realismo das sombras.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mapeamento de textura √© um processo cr√≠tico.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A texturiza√ß√£o √© absolutamente essencial ao desenvolver jogos. Tomemos, por exemplo, o jogo de 2019 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kingdom Come: Deliverance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um RPG em primeira pessoa que se passa na Bo√™mia no s√©culo XV. Os designers procuraram criar o mundo mais realista desse per√≠odo. E para imergir o jogador na vida h√° centenas de anos, √© melhor implementar uma paisagem historicamente precisa, edif√≠cios, roupas, penteados, itens do dia-a-dia e muito mais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada textura nesta imagem do jogo foi criada manualmente por artistas e tamb√©m gra√ßas a um mecanismo de renderiza√ß√£o controlado por programadores. Alguns deles s√£o pequenos, com detalhes simples e, portanto, s√£o ligeiramente filtrados ou processados ‚Äã‚Äãcom outras texturas (por exemplo, asas de galinha).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2e/7d0/24a/e2e7d024ad0c700d26390940caf339ed.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outros t√™m alta resolu√ß√£o e muitos pequenos detalhes; </font><font style="vertical-align: inherit;">eles passam por filtragem anisotr√≥pica e se misturam com mapas normais e outras texturas - basta olhar para o rosto da pessoa em primeiro plano. </font><font style="vertical-align: inherit;">A diferen√ßa nos requisitos de textura de cada objeto de cena √© levada em considera√ß√£o pelos programadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso acontece hoje em muitos jogos, porque os jogadores esperam n√≠veis cada vez mais altos de detalhes e realismo. </font><font style="vertical-align: inherit;">As texturas est√£o se tornando maiores, e mais e mais delas s√£o sobrepostas na superf√≠cie, mas o processo de amostragem de texels e sobreposi√ß√£o de pixels em pixels permanece essencialmente o mesmo dos dias do Quake. </font><font style="vertical-align: inherit;">As melhores tecnologias nunca morrem, n√£o importa quantos anos tenham!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499524/index.html">Quarkus: atualiza√ß√µes de aplicativos com o helloworld do JBoss EAP Quickstart</a></li>
<li><a href="../pt499528/index.html">Uma ponte matem√°tica "impressionante" que se estende al√©m do Grande Teorema de Fermat</a></li>
<li><a href="../pt499532/index.html">Palavras em n√∫meros: an√°lise de blog gr√°tis habravebinary com Yandex.Metrica</a></li>
<li><a href="../pt499534/index.html">Guia de desenvolvimento de servi√ßos de back-end do Python</a></li>
<li><a href="../pt499536/index.html">Growbox como um m√©todo de conhecer a si mesmo</a></li>
<li><a href="../pt499542/index.html">Top Fakapov Cyan</a></li>
<li><a href="../pt499544/index.html">Aprenda redes neurais no Planilhas Google</a></li>
<li><a href="../pt499546/index.html">Desenvolvimento de firmware para uma c√¢mera de v√≠deo anal√≥gica EVR-Y2022F</a></li>
<li><a href="../pt499548/index.html">M√°scara - cuidar dos outros ou uma ilus√£o de seguran√ßa?</a></li>
<li><a href="../pt499550/index.html">Solu√ß√µes de baixo c√≥digo para ecossistemas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>