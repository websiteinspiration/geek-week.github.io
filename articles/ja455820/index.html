<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦🏽 🙋🏾 🈹 VMware vSphereでのVMパフォーマンス分析。パート2：メモリ 🎨 🦁 👩‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="パート1. CPUについて
 パート3.ストレージについて
 
 この記事では、vSphereのランダムアクセスメモリ（RAM）のパフォーマンスカウンターについて説明します。
 メモリはプロセッサよりもますます明確であるように見えます。VMにパフォーマンスの問題がある場合、気づかないようにするのは困...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>VMware vSphereでのVMパフォーマンス分析。パート2：メモリ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/455820/"><img src="https://habrastorage.org/webt/el/am/7y/elam7yyhc6vrowmmrt5ofxgj-r0.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1. CPUについて</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3.ストレージについて</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この記事では、vSphereのランダムアクセスメモリ（RAM）のパフォーマンスカウンターについて説明します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メモリはプロセッサよりもますます明確であるように見えます。VMにパフォーマンスの問題がある場合、気づかないようにするのは困難です。</font><font style="vertical-align: inherit;">しかし、それらが現れた場合、それらに対処することははるかに困難です。</font><font style="vertical-align: inherit;">しかし、まず最初に。</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理論のビット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンのRAMは、VMが実行されているサーバーのメモリから取得されます。</font><font style="vertical-align: inherit;">これは非常に明白です:)。</font><font style="vertical-align: inherit;">サーバーのRAMがすべての人にとって十分でない場合、ESXiはメモリ再利用技術の適用を開始します。</font><font style="vertical-align: inherit;">そうしないと、VMオペレーティングシステムがRAMアクセスエラーでクラッシュします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiを適用する手法は、RAMの負荷に応じて決定されます。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリの状態</font></font></b><br>
</td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国境</font></font></b><br>
</td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行動</font></font></b><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高い</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFreeの400％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上限に達した後、メモリの大きなページは小さなページに分割されます（TPSは標準モードで動作します）。</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">晴れ</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFreeの100％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリの大きなページは小さなページに分割され、TPSは強制的に動作します。</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">柔らかい</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFreeの64％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPS +バルーン</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハード</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFreeの32％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPS +圧縮+スワップ</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFreeの16％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">圧縮+スワップ+ブロック</font></font><br>
</td>
</tr>
</tbody></table></div><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
minFree </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ソース</font></a><font style="vertical-align: inherit;">は、ハイパーバイザーが機能するために必要なRAMです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXi 4.1以前では、minFreeはデフォルトで修正されていました-サーバーRAMの6％（パーセントはESXiのMem.MinFreePctオプションで変更できました）。</font><font style="vertical-align: inherit;">以降のバージョンでは、minFreeサーバーのメモリボリュームが増加したため、固定パーセンテージ値としてではなく、ホストのメモリサイズに基づいて計算され始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
minFree値（デフォルト）は次のように計算されます。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFree用に予約されたメモリの割合</font></font></b><br>
</td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリ範囲</font></font></b><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0〜4 GB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4〜12 GB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12〜28 GB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残りのメモリ</font></font><br>
</td>
</tr>
</tbody></table></div><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たとえば、RAMが128 GBのサーバーの場合、MinFree値は次のようになります</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。MinFree= 245.76 + 327.68 + 327.68 + 1024 = 1925.12 MB = 1.88 GB </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際の値は数百MB異なる場合があり、サーバーとRAMから。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minFree用に予約されたメモリの割合</font></font></b><br>
</td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリ範囲</font></font></b><br>
</td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 GBの値</font></font></b><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0〜4 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">245.76 MB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4〜12 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">327.68 MB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12〜28 GB</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">327.68 MB</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1％</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残りのメモリ（100 GB）</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1024 MB</font></font><br>
</td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、生産スタンドでは、高と見なすことができます。テストスタンドおよび開発スタンドの場合、クリア/ソフト条件が許容される場合があります。ホストメモリに残っているMinFreeが64％未満の場合、その上で実行されているVMでパフォーマンスの問題が確実に発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各状態で、TPSから特定のメモリ再利用技術が適用されます。これは、実際にはVMのパフォーマンスに影響を与えず、スワッピングで終了します。それらについて詳しく説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">透過的なページ共有（TPS）。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TPSは、大まかに言えば、サーバー上の仮想マシンのRAMのページの重複排除です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiは、仮想マシンRAMの同一ページを検索し、ページのハッシュ合計をカウントして比較し、重複ページを削除して、サーバーの物理メモリ内の同じページへのリンクに置き換えます。その結果、物理メモリの消費量が削減され、パフォーマンスをほとんどまたはまったく失うことなく、メモリの一部の再サブスクリプションを実現できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ul/fz/1i/ulfz1i0bomyhsarceziylov-o6i.jpeg"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このメカニズムは、4 kBページ（小さいページ）でのみ機能します。サイズが2 MBのページ（ラージページ）では、ハイパーバイザーは重複排除を試みません。このサイズの同じページを見つける可能性はあまり高くありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、ESXiはメモリを大きなページに割り当てます。大きなページの小さなページへの分割は、High状態のしきい値に達したときに始まり、Clear状態に達したときに強制されます（ハイパーバイザーの状態の表を参照）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホストのRAMがいっぱいになるのを待たずにTPSを機能させたい場合は、詳細オプションESXiで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Mem.AllocGuestLargePage」の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を0 </font><font style="vertical-align: inherit;">に設定する必要があり</font><font style="vertical-align: inherit;">ます（デフォルトは1）。次に、仮想マシンへのメモリの大きなページの割り当てが無効になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2014年12月以降、すべてのESXiリリースで、理論的には1つのVMから別のVMのRAMにアクセスできる脆弱性が発見されたため、VM間のTPSはデフォルトで無効になっています。詳細はこちら。私が満たしていないTPS脆弱性の悪用の実際的な実装に関する情報。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TPSポリシーは</font><font style="vertical-align: inherit;">、ESXiの</font><font style="vertical-align: inherit;">詳細オプション</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Mem.ShareForceSalting」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">制御されます</font><font style="vertical-align: inherit;">：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0-VM間TPS。 TPSは、さまざまなVMのページで機能します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1-VMXで同じ値「sched.mem.pshare.salt」を持つVMのTPS。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2（デフォルト）-VM内TPS。 TPSはVM内のページに対して機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大きなページをオフにして、テストベンチでInter-VM TPSを有効にすることは間違いなく理にかなっています。同じタイプのVMが多数あるスタンドにも使用できます。たとえば、VDIを備えたスタンドでは、物理メモリの節約は数十パーセントに達する可能性があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリバルーニング。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バルーニングは、TPSほど害がなく、VMオペレーティングシステムに対して透過的ではありません。しかし、バルーニングを適切に使用すれば、生活し、仕事をすることさえできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vmware Toolsとともに、バルーンドライバー（別名vmmemctl）と呼ばれる特別なドライバーがVMにインストールされます。ハイパーバイザーが物理メモリを使い果たし、ソフト状態になると、ESXiはVMにこのバルーンドライバーを介して未使用のRAMを返すように要求します。次に、ドライバはオペレーティングシステムレベルで動作し、そこから空きメモリを要求します。ハイパーバイザーは、バルーンドライバーが取得した物理メモリのページを確認し、仮想マシンからメモリを取得して、ホストに返します。 OSレベルではバルーンドライバーがメモリを占有しているため、OSの動作に問題はありません。デフォルトでは、バルーンドライバーはVMメモリの最大65％を使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VMにVMware Toolsがインストールされていないか、バルーニングが無効になっている場合（お勧めしませんが、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">KB</font></a><font style="vertical-align: inherit;">があります）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:)、ハイパーバイザーはすぐに、より厳格なメモリ分離方法に切り替えます。結論：VMware ToolsがVM上にあることを確認してください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/pm/s1/eypms1ugdkmhr0r4odhga1locao.png"> <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バルーンドライバーの動作は、VMware Toolsを介してOSから確認できます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリ圧縮</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この手法は、ESXiがハードに達したときに使用されます。名前が示すように、ESXiは4 KBのRAMページを2 KBに圧縮して、サーバーの物理メモリの一部の領域を解放しようとしています。この手法では、最初にページをクリーンアップする必要がないため、VMの仮想メモリのページのコンテンツへのアクセス時間が大幅に増加します。すべてのページを圧縮できるとは限らず、プロセス自体に時間がかかる場合があります。したがって、この手法は実際にはあまり効果的ではありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリスワッピング。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短いフェーズの後、メモリ圧縮ESXiはほぼ必然的に（VMが他のホストに移動しないかシャットダウンした場合）、スワッピングに移行します。また、メモリがほとんど残っていない場合（低状態）、ハイパーバイザーはメモリのVMページの割り当ても停止するため、ゲストVMで問題が発生する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがスワッピングの仕組みです。仮想マシンをオンにすると、拡張子が.vswpのファイルが作成されます。サイズは、VMの非予約RAMと同じです。これは、構成済みメモリと予約済みメモリの違いです。スワッピングを使用する場合、ESXiは仮想マシンのメモリページをこのファイルにアンロードし、サーバーの物理メモリの代わりにそれを使用して作業を開始します。もちろん、そのような「RAM」メモリは、.vswpが高速ストレージ上にある場合でも、実際のメモリよりも数桁遅くなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バルーニングとは異なり、VMから未使用のページが選択されると、VM内のOSまたはアプリケーションによってアクティブに使用されているページは、スワッピング中にディスクに移動できます。</font><font style="vertical-align: inherit;">その結果、ハングするまでVMのパフォーマンスが低下します。</font><font style="vertical-align: inherit;">VMは正式に機能し、少なくともOSから正しく無効にすることができます。</font><font style="vertical-align: inherit;">忍耐強い</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
場合</font><font style="vertical-align: inherit;">;）</font><font style="vertical-align: inherit;">VMがスワップに移行した場合-これは異常な状況であり、可能であれば回避するのが最善です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的な仮想マシンのメモリパフォーマンスカウンター</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから私たちは主なものに行きました。メモリの状態を監視するために、VMには次のカウンターがあります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -前の測定期間にVMがアクセスしたRAMの量（Kバイト）を示します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">率はアクティブと同じですが、構成されたVMメモリの割合として表示されます。これは、次の式を使用して計算されます。アクティブ÷仮想マシン構成のメモリサイズ。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
高使用率とアクティブは、それぞれ、VMパフォーマンスの問題を必ずしも示しているわけではありません。 VMが積極的にメモリを使用する（少なくともそれにアクセスする）場合、これは十分なメモリがないことを意味しません。むしろ、これはOSで何が起こるかを確認する機会です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VMのメモリ使用量に標準のアラームがあります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8u/ca/n8/8ucan84mevajwvlnr-4ov9boyro.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-TPSを使用して重複排除されたVMのRAMの量（VM内またはVM間）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">許可-VM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に割り当てられたホストの物理メモリの量（Kバイト）。共有を含みます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消費</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（許可-共有）</font><b><font style="vertical-align: inherit;">-VM</font></b><font style="vertical-align: inherit;">がホストから消費する物理メモリの量（Kバイト）。 Sharedは含まれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VMのメモリの一部がホストの物理メモリからではなく、スワップファイルから割り当てられている場合、またはメモリがバルーンドライバーを介してVMから取得された場合、この量は許可および消費では考慮されません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GrantedとConsumedの高い値は完全に正常です。オペレーティングシステムは、ハイパーバイザーからメモリを徐々に取り除き、元に戻しません。時間が経つにつれて、VMがアクティブに動作している場合、これらのカウンターの値は構成されたメモリの量に近づき、そこに残ります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ゼロを含むVMのRAMの量（Kバイト）。このようなメモリは無料のハイパーバイザーと見なされ、他の仮想マシンに与えることができます。ゲストOSがnullメモリに書き留めた後、ゲストOSは消費済みに戻り、戻りません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予約済みオーバーヘッド-VM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が動作するためにハイパーバイザーによって予約されたVM内のRAMの量（Kバイト）。これは少量ですが、ホストで使用できる必要があります。そうしないと、VMが起動しません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バルーン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -バルーンドライバーを使用してVMから取得したRAMの量（KB）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">圧縮</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">圧縮</font></b><font style="vertical-align: inherit;">できたRAMの容量（KB）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スワップ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-RAMの量（KB）。サーバーの物理メモリが不足したためにディスクに移動されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バルーンおよびその他のメモリ再利用技術のカウンターはゼロです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、150 GBのRAMを備えた、正常に機能しているVMのメモリカウンターを含むグラフです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0l/pp/w3/0lppw3nz9iqzcnuergtxiseb67s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下のグラフでは、VMに明らかな問題があります。</font><font style="vertical-align: inherit;">グラフは、このVMについて、RAMを操作するために説明されているすべての手法が使用されたことを示しています。</font><font style="vertical-align: inherit;">このVMのバルーンは、消費よりもはるかに大きくなります。</font><font style="vertical-align: inherit;">実際、VMは生きているより死んでいる可能性が高いです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f4/ic/xk/f4icxkpxpykxua_gp-sirlzuu_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESXTOP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CPUと同様に、ホストの状況と、最大2秒の間隔でのダイナミクスをすばやく評価する場合は、ESXTOPを使用する価値があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：ESXTOPメモリ画面は、この（フィールドB、D、H、J、K、L、Oが選択されている）のような「M」キーとルックスと呼ばれる</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rm/wj/4k/rmwj4krvvizdtcizkrid0zjuml8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のパラメータは、我々にとって興味深いものになる。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memのオーバーコミット平均</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -のためにホスト上のメモリ・サブスクリプションの平均値1、5、15分。ゼロを超える場合、これは何が起こっているかを確認する機会ですが、必ずしも問題の存在を示すものではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMEM / MB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMKMEM / MB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーの物理メモリとVMkernelで使用可能なメモリに関する情報。ここの興味深いところから、minfree値（MB単位）、メモリからのホストの状態（この場合は高）を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列をなして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUMA / MB、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NUMAノード（ソケット）ごとのRAMの分布を確認できます。この例では、分布は不均一であり、原則としてあまり良くありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、メモリ再利用手法の一般的なサーバー統計を示します</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。PSHARE/ MB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらはTPS統計です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWAP / MB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スワップの使用に関する統計。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZIP / MB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリページの圧縮の統計。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMCTL / MB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バルーンドライバーの使用統計。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個々のVMについては、次の情報が必要になる場合があります。聴衆を困らせないように、私はVM名を隠しました:)。 ESXTOPメトリックがvSphereのカウンターに似ている場合は、対応するカウンターを引用します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEMSZ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、VMに構成されているメモリの量（MB）です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MEMSZ = GRANT + MCTLSZ + SWCUR +そのまま。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRANT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -MB単位で付与されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCHD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -MB </font><b><font style="vertical-align: inherit;">単位で</font></b><font style="vertical-align: inherit;">アクティブ。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCTL？</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -VMバルーンドライバーにインストールされます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCTLSZ-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バルーン（MB）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCTLGT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ESXiがバルーンドライバー（Memctlターゲット）を介してVMから削除するRAM（MB）の量です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCTLMAX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ESXiがバルーンドライバーを介してVMから削除できるRAM（MB）の最大量。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWCUR-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スワップファイルからVMに与えられたRAMの現在の量（MB）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWGT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ESXiがスワップファイル（スワップターゲット）からVMに提供するRAM（MB）の量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ESXTOPを使用して、NUMA VMトポロジに関する詳細情報を確認できます。</font><font style="vertical-align: inherit;">これを行うには、フィールドD、G：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/7y/zd/ff7yzdsjedyntnpj4duwv0c731m.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NHN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -VMが配置されているNUMAノードを</font><font style="vertical-align: inherit;">選択します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここで、1つのNUMAノードに適合しないワイドVMにすぐに気付くことができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRMEM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -VMがリモートNUMAノードから</font><b><font style="vertical-align: inherit;">取得する</font></b><font style="vertical-align: inherit;">メモリのメガバイト数。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLMEM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -VMがローカルNUMAノードから</font><b><font style="vertical-align: inherit;">取得する</font></b><font style="vertical-align: inherit;">メモリのメガバイト数。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N％L-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルNUMAノード上のVMメモリの割合（80％未満の場合、パフォーマンスの問題が発生する可能性があります）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハイパーバイザー上のメモリ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパーバイザーのCPUカウンターが通常は特に重要でない場合、状況はメモリーとは逆になります。</font><font style="vertical-align: inherit;">VMのメモリ使用率が高いことは必ずしもパフォーマンスの問題を示しているわけではありませんが、ハイパーバイザーのメモリ使用率が高い場合、メモリ管理技術者が起動し、VMのパフォーマンスに問題が発生します。</font><font style="vertical-align: inherit;">ホストメモリ使用量アラームを監視する必要があり、VMがスワップに入ることが許可されません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h2/x_/59/h2x_59kddpe84yzudcq03fq1rmc.png"><br>
<br>
<img src="https://habrastorage.org/webt/oc/w7/c9/ocw7c9vmbrqogjhmtpbotng4-6y.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入れ替え</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VMがスワップに入ると、パフォーマンスが大幅に低下します。ホスト上に空きRAMが出現すると、バルーニングと圧縮のトレースはすぐに消えますが、仮想マシンはスワップからサーバーのRAMに急いで戻る必要はありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXi 6.0より前のバージョンでは、VMをスワップから解放するための信頼性が高く高速な唯一の方法は、再起動（より正確には、コンテナーのオン/オフを切り替える）でした。 ESXi 6.0以降、公式ではありませんが、スワップからVMを取り出すための実用的で信頼性の高い方法が登場しました。カンファレンスの1つで、CPUスケジューラーの責任者であるVMwareエンジニアの1人となんとか話し合うことができました。彼はこの方法が非常に効果的で安全であることを確認しました。私たちの経験では、彼との問題にも気づかなかった。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際にスワップからVMを出力するためのコマンド</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダンカンエッピング。</font><font style="vertical-align: inherit;">詳細な説明は繰り返さず、その使用例を示します。</font><font style="vertical-align: inherit;">スクリーンショットに示されているように、VMで指定されたSwapコマンドを実行してからしばらくすると、表示されなくなります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e5/lm/7e/e5lm7e0e6i_yxrrlm7dfwixptv0.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESXiでRAMを管理するためのヒント</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、RAMによるVMパフォーマンスの問題を回避するためのヒントをいくつか紹介します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生産的なクラスターでRAMをオーバーサブスクライブしないでください。</font><font style="vertical-align: inherit;">DRS（および管理者）が操作する余地があり、VMが移行中にスワップに移動しないように、クラスターに20〜30％の空きメモリを確保することを常にお勧めします。</font><font style="vertical-align: inherit;">また、フォールトトレランスのマージンも忘れないでください。</font><font style="vertical-align: inherit;">1つのサーバーに障害が発生し、HAを使用してVMを再起動すると、一部のマシンもスワップに移行するのは不愉快です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度に統合されたインフラストラクチャでは、ホストメモリの半分以上でVMを作成しないでください。</font><font style="vertical-align: inherit;">これにより、DRSは問題なく仮想マシンをクラスターサーバー全体に分散できます。</font><font style="vertical-align: inherit;">もちろん、このルールは普遍的ではありません:)。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホストメモリ使用量アラームに注意してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMにVMware Toolsを配置し、バルーニングをオフにしないでください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VDIおよびテスト環境では、VM間TPSを有効にし、ラージページを無効にすることを検討してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMでパフォーマンスの問題が発生している場合は、リモートNUMAノードのメモリを使用しているかどうかを確認します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スワップからVMをできるだけ早く取得します！</font><font style="vertical-align: inherit;">とりわけ、VMがスワップにある場合、明らかな理由により、ストレージシステムが影響を受けます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RAMについては以上です。</font><font style="vertical-align: inherit;">詳細を詳しく知りたい方のための関連記事を以下に示します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はその話に専念します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">http://www.yellow-bricks.com/2015/03/02/what-happens-at-which-vsphere-memory-state/</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">http://www.yellow-bricks.com/2013/06/14/how-does-mem-minfreepct-work-with-vsphere-5-0-and-up/</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://www.vladan.fr/vmware-transparent-page-sharing-tps-explained/</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">http://www.yellow-bricks.com/2016/06/02/memory-pages-swapped-can-unswap/</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://kb.vmware.com/s/article/1002586</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://www.vladan.fr/what-is-vmware-memory-ballooning/</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://kb.vmware.com/s/article/2080735</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://kb.vmware.com/s/article/2017642</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://labs.vmware.com/vmtj/vmware-esx-memory-resource-management-swap</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://blogs.vmware.com/vsphere/2013/10/understanding-vsphere-active-memory.html</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://www.vmware.com/support/developer/converter-sdk/conv51_apireference/memory_counters.html</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://docs.vmware.com/en/VMware-vSphere/6.5/vsphere-esxi-vcenter-server-65-monitoring-performance-guide.pdf</a><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455802/index.html">メールニュースレターを通じてオリンピックを組み立てる方法。ケースブラックスター</a></li>
<li><a href="../ja455806/index.html">アルバムの誕生と死：過去100年間で音楽フォーマットがどのように変化したかを理解しています</a></li>
<li><a href="../ja455808/index.html">Pythonを使用してFTS Webサイトのレジスターから抽出を取得する</a></li>
<li><a href="../ja455812/index.html">GolangとgRPCでのマイクロサービスアーキテクチャの構築、パート2（Docker）</a></li>
<li><a href="../ja455816/index.html">Googleアシスタントのクールなアクションを作成する方法。Just AIによるライフハック</a></li>
<li><a href="../ja455826/index.html">リモート制御の自動散水</a></li>
<li><a href="../ja455828/index.html">科学者は新しいエキゾチックな形の同期を発見しました</a></li>
<li><a href="../ja455830/index.html">.NET開発者の目を通してGoを見てください。1週目</a></li>
<li><a href="../ja455832/index.html">単一のSQL調査の履歴</a></li>
<li><a href="../ja455834/index.html">Linuxサーバーのベンチマーク：5つのオープンツール</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>