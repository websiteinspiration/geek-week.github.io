<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👁️ 👶 ⛳️ Linuxでの小さなディスクから大きなディスクへの置き換え ✌️ 😰 🏒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは。Linuxアドミニストレーターコースの新しいグループの立ち上げを見越して、学生とコースメンターであるREG.RU企業向け製品のテクニカルサポートスペシャリストであるRoman Travinが書いた有用な資料を公開しています。
 
 
 
 この記事では、アレイとファイルシステム...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linuxでの小さなディスクから大きなディスクへの置き換え</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/486084/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">みなさん、こんにちは。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxアドミニストレーター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コースの新しいグループの立ち上げを見越し</font><font style="vertical-align: inherit;">て、学生とコースメンターであるREG.RU企業向け製品のテクニカルサポートスペシャリストであるRoman Travinが書いた有用な資料</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を</font></a><font style="vertical-align: inherit;">公開しています。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/uo/ar/_j/uoar_jhfy1k5vvnqceiil6cbe10.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この記事では、アレイとファイルシステムをさらに拡張して、ディスクを交換して情報を新しい大きなディスクに転送する2つのケースについて説明します。最初のケースは、同じMBR / MBRまたはGPT / GPTマークアップを持つディスクの交換に関係します。2番目のケースは、biosbootパーティションを持つGPTマークアップをインストールする必要がある2 TBより大きいディスクのMBRマークアップを持つディスクの交換に関係します。どちらの場合も、データの転送先のディスクはすでにサーバーにインストールされています。ルートパーティションに使用されるファイルシステムはext4です。</font></font><br>
<br>
<hr><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケース1：小さいドライブを大きいドライブ（最大2 TB）で置き換える</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報を転送して、現在のドライブをより大きなドライブ（最大2 TB）に交換します。</font><font style="vertical-align: inherit;">この場合、システムがインストールされた240 GB SSD（RAID-1）ディスクが2つと、システムを転送する必要がある1 TB SATAディスクが2つあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のディスクレイアウトを検討してください。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
sdd              8:48   0 931,5G  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在使用されているファイルシステム領域を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># df -h</span><font></font>
          % C <font></font>
devtmpfs                32G            0   32G            0% /dev<font></font>
tmpfs                   32G            0   32G            0% /dev/shm<font></font>
tmpfs                   32G         9,6M   32G            1% /run<font></font>
tmpfs                   32G            0   32G            0% /sys/fs/cgroup<font></font>
/dev/mapper/vg0-root   204G         1,3G  192G            1% /<font></font>
/dev/md126            1007M         120M  837M           13% /boot<font></font>
tmpfs                  6,3G            0  6,3G            0% /run/user/0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクを交換する前にファイルシステムのサイズがに搭載204 GB、2つのソフトウェアmd126アレイが使用される</font></font><code>/boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>md127</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのように使用される</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理ボリューム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VGグループのために</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VG0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.アレイからディスクパーティションを削除する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイの状態を確認する</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sda1[0] sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sda2[0] sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/2 pages [0KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムは、2つのアレイを使用し：</font></font><code>md126</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（マウントポイント</font></font><code>/boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） -パーティションで構成さ</font></font><code>/dev/sda1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdb1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>md127</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（LVM用の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スワップ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルシステムのルート） -から成る</font></font><code>/dev/sda2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdb2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アレイで使用される最初のディスクのパーティションを不良としてマークします。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --fail /dev/sda1<font></font>
<font></font>
mdadm /dev/md127 --fail /dev/sda2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイからブロックデバイス/ dev / sdaのセクションを削除します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --remove /dev/sda1<font></font>
<font></font>
mdadm /dev/md127 --remove /dev/sda2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイからディスクを削除すると、ブロックデバイスに関する情報は次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
sdd              8:48   0 931,5G  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクを取り外した後のアレイの状態。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/1] [_U]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/1] [_U]<font></font>
      bitmap: 1/2 pages [4KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.パーティションテーブルを新しいディスクにコピーする</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドを使用して、ディスクで使用されているパーティションテーブルを確認できます。</font></font><br>
<br>
<pre><code class="bash hljs">fdisk -l /dev/sdb | grep <span class="hljs-string">'Disk label type'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MBRの出力は次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">Disk label <span class="hljs-built_in">type</span>: dos</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPTの場合：</font></font><br>
<br>
<pre><code class="bash hljs">Disk label <span class="hljs-built_in">type</span>: gpt</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MBRのマークアップテーブルをコピー：</font></font><br>
</b><br>
<pre><code class="bash hljs">sfdisk -d /dev/sdb | sfdisk /dev/sdc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコマンドでは</font><font style="vertical-align: inherit;">、ディスク</font><b><font style="vertical-align: inherit;">から</font></b><b><font style="vertical-align: inherit;">その</font></b><font style="vertical-align: inherit;">マークアップが</font><b><font style="vertical-align: inherit;">され</font></b><font style="vertical-align: inherit;">ているコピー</font><font style="vertical-align: inherit;">示さ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">先秒である</font></b><font style="vertical-align: inherit;">コピー。</font></font><b><font style="vertical-align: inherit;"></font></b> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：GPTの場合は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブがドライブである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ために</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、マークアップにコピーする</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブがドライブで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のマークアップをコピーします。</font><font style="vertical-align: inherit;">ディスクを混同すると、最初は正常なマークアップが上書きされて破棄されます。</font></font><br>
</blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPTのマークアップテーブルをコピーする：</font></font><br>
</b><br>
<pre><code class="bash hljs">sgdisk -R /dev/sd /dev/sdb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ランダムなUUIDをディスクに割り当てます（GPTの場合）。</font></font><br>
<br>
<pre><code class="bash hljs">
sgdisk -G /dev/sdc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドを実行すると、パーティションがディスクに表示され</font></font><code> /dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
sdd              8:48   0 931,5G  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクション</font></font><code>/dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実行した後</font><font style="vertical-align: inherit;">、ディスク上のシステム内のパーティションが</font><font style="vertical-align: inherit;">定義され</font><font style="vertical-align: inherit;">て</font><font style="vertical-align: inherit;">いない場合は、コマンドを実行してパーティションテーブルを再度読み取ります。</font></font><br>
<br>
<pre><code class="bash hljs">sfdisk -R /dev/sdc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のディスクがMBRテーブルを使用しており、情報を2 TBを超えるディスクに転送する必要がある場合、新しいディスクはbiosbootパーティションを使用してGPTマークアップを手動で作成する必要があります。</font><font style="vertical-align: inherit;">このケースは、この記事のパート2で検討されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.新しいディスクのパーティションをアレイに追加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクパーティションを対応するアレイに追加します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --add /dev/sdc1<font></font>
<font></font>
mdadm /dev/md127 --add /dev/sdc2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクションが追加されていることを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、配列の同期を待ちます。 </font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdc1[2] sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdc2[2] sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/1] [_U]<font></font>
      [==&gt;..................]  recovery = 10.6% (24859136/233206784) finish=29.3min speed=118119K/sec<font></font>
      bitmap: 2/2 pages [8KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーティリティを使用して、同期プロセスを継続的に監視できます</font></font><code>watch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">watch -n 2 cat /proc/mdstat</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータ</font></font><code>-n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、進捗状況を確認するためにコマンドを実行する必要がある間隔を秒単位で示し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の交換用ドライブについて、手順1〜3を繰り返します。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アレイで使用されている2番目のディスクのパーティションを不良としてマークします。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --fail /dev/sdb1<font></font>
<font></font>
mdadm /dev/md127 --fail /dev/sdb2<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><code> /dev/sdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイから</font><font style="vertical-align: inherit;">
ブロックデバイスのセクションを削除</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --remove /dev/sdb1<font></font>
<font></font>
mdadm /dev/md127 --remove /dev/sdb2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイからディスクを削除すると、ブロックデバイスに関する情報は次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクを取り外した後のアレイの状態。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdc1[2]<font></font>
      1047552 blocks super 1.2 [2/1] [U_]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdc2[2]<font></font>
      233206784 blocks super 1.2 [2/1] [U_]<font></font>
      bitmap: 1/2 pages [4KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MBRマークアップテーブルをディスクからディスク</font></font><code>/dev/sd </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">コピーします</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">sfdisk -d /dev/sd | sfdisk /dev/sdd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドを実行すると、パーティションがディスクに表示され</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
├─sdd1           8:49   0     1G  0 part  <font></font>
└─sdd2           8:50   0 222,5G  0 part  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイにディスクパーティションを追加します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --add /dev/sdd1<font></font>
<font></font>
mdadm /dev/md127 --add /dev/sdd2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクションが追加されていることを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
├─sdd1           8:49   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdd2           8:50   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、配列の同期を待ちます。 </font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdd1[3] sdc1[2]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdd2[3] sdc2[2]<font></font>
      233206784 blocks super 1.2 [2/1] [U_]<font></font>
      [&gt;....................]  recovery =  0.5% (1200000/233206784) finish=35.4min speed=109090K/sec<font></font>
      bitmap: 2/2 pages [8KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.新しいドライブにGRUBをインストールします</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSの場合：</font></font><br>
<br>
<pre><code class="bash hljs">grub2-install /dev/sdX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debian / Ubuntuの場合：</font></font><br>
<br>
<pre><code class="bash hljs">grub-install /dev/sdX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どこ</font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のブロックデバイスの文字です。</font><font style="vertical-align: inherit;">この場合、GRUBを</font></font><code>/dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">にインストール</font><font style="vertical-align: inherit;">し</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.ルートパーティションのファイルシステム（ext4）の拡張</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいディスク</font></font><code>/dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用可能な931.5 GB。</font><font style="vertical-align: inherit;">パーティションテーブルが小さいボリュームがセクションに、CDからコピーされているという事実による</font></font><code> /dev/sdc2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdd2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">222.5ギガバイトご利用いただけます。</font></font><br>
<br>
<pre><code class="bash hljs">sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
├─sdd1           8:49   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdd2           8:50   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは必要である：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各ドライブのセクション2を拡張し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">md127配列を拡張し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PV（物理ボリューム）を展開し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LV（論理ボリューム）vg0-rootを拡張し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルシステムを拡張します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ユーティリティを使用して</font><font style="vertical-align: inherit;">、セクション</font></font><code>/dev/sdc2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を最大値に</font><font style="vertical-align: inherit;">展開し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">コマンド</font></font><code>parted /dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1）</font><font style="vertical-align: inherit;">を実行</font><font style="vertical-align: inherit;">し、コマンド</font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（2）</font><font style="vertical-align: inherit;">で現在のパーティションテーブルを表示します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ao/zx/xc/aozxxc_zhq42me4qblnij5bib4y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、セクション2の最後は240 GBで終わります。</font><font style="vertical-align: inherit;">コマンド</font></font><code>resizepart</code> <code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">セクションを展開してみましょう</font><font style="vertical-align: inherit;">。2はセクション番号（3）です。</font><font style="vertical-align: inherit;">1000 GBなどのデジタル形式で値を示します。または、ディスク共有の表示-100％を使用します。</font><font style="vertical-align: inherit;">ここでも、セクションのサイズが新しいことを確認します（4）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクに対して上記の手順を繰り返します</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">セクションの拡張後、</font></font><code>/dev/sdc2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それら</font></font><code>/dev/sdd2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は930.5 GBに等しくなりました。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk                                                 </span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 930,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
├─sdd1           8:49   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdd2           8:50   0 930,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">md127</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">を最大に</font><font style="vertical-align: inherit;">拡張し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm --grow /dev/md127 --size=max</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイが拡張されていることを確認してください。</font><font style="vertical-align: inherit;">現在、そのサイズは930.4 GBになっています。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0 931,5G  0 disk  <font></font>
├─sdc1           8:33   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc2           8:34   0 930,5G  0 part  <font></font>
  └─md127        9:127  0 930,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0 931,5G  0 disk  <font></font>
├─sdd1           8:49   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdd2           8:50   0 930,5G  0 part  <font></font>
  └─md127        9:127  0 930,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理ボリューム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の拡張を行います</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">拡張する前に、PVの現在の状態を確認してください。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># pvscan</span><font></font>
  PV /dev/md127   VG vg0             lvm2 [222,40 GiB / 0    free]<font></font>
  Total: 1 [222,40 GiB] / <span class="hljs-keyword">in</span> use: 1 [222,40 GiB] / <span class="hljs-keyword">in</span> no VG: 0 [0   ]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、PV </font></font><code>/dev/md127</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は222.4 GBのスペースを使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドでPVを展開します。</font></font><br>
<br>
<pre><code class="bash hljs">pvresize /dev/md127</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PV延長の結果を確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[</font></font><pre><code class="bash hljs">root@localhost ~]<span class="hljs-comment"># pvscan</span><font></font>
  PV /dev/md127   VG vg0             lvm2 [930,38 GiB / 707,98 GiB free]<font></font>
  Total: 1 [930,38 GiB] / <span class="hljs-keyword">in</span> use: 1 [930,38 GiB] / <span class="hljs-keyword">in</span> no VG: 0 [0   ]</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">論理ボリュームの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
拡張</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">拡張の前に、LV（1）の現在のステータスを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lvscan</span>
  ACTIVE            <span class="hljs-string">'/dev/vg0/swap'</span> [&lt;16,00 GiB] inherit<font></font>
  ACTIVE            <span class="hljs-string">'/dev/vg0/root'</span> [&lt;206,41 GiB] inherit</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LV </font></font><code>/dev/vg0/root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は206.41 GBを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンド（2）でLVを拡張します。</font></font><br>
<br>
<pre><code class="bash hljs">lvextend -l +100%FREE /dev/mapper/vg0-root</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行されたアクション（3）を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lvscan </span>
  ACTIVE            <span class="hljs-string">'/dev/vg0/swap'</span> [&lt;16,00 GiB] inherit<font></font>
  ACTIVE            <span class="hljs-string">'/dev/vg0/root'</span> [&lt;914,39 GiB] inherit
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、LVを拡張すると、占有されているディスク容量は914.39 GBになりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/6r/qh/vd6rqhe3wvbukzdfachz7xf4ehk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVボリュームは増加しましたが（4）、ファイルシステムはまだ204 GBを占めています（5）。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ファイルシステムの拡張を実行します。</font></font></i><br>
<br>
<pre><code class="bash hljs">resize2fs /dev/mapper/vg0-root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンド実行後にファイルシステムのサイズを確認してください。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># df -h</span><font></font>
          % C <font></font>
devtmpfs                32G            0   32G            0% /dev<font></font>
tmpfs                   32G            0   32G            0% /dev/shm<font></font>
tmpfs                   32G         9,5M   32G            1% /run<font></font>
tmpfs                   32G            0   32G            0% /sys/fs/cgroup<font></font>
/dev/mapper/vg0-root   900G         1,3G  860G            1% /<font></font>
/dev/md126            1007M         120M  837M           13% /boot<font></font>
tmpfs                  6,3G            0  6,3G            0% /run/user/0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルートファイルシステムのサイズは900 GBに増加します。</font><font style="vertical-align: inherit;">手順が完了したら、古いディスクを取り出すことができます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケース2：小さいドライブを大きいドライブ（2TB以上）で置き換える</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在のディスクを、情報を保存してより大きなディスク（2 x 3TB）に交換します。</font><font style="vertical-align: inherit;">この場合、システムがインストールされた2 x 240 GB SSD（RAID-1）ディスクと2 x 3 TB SATAディスクがあり、システムを転送する必要があります。</font><font style="vertical-align: inherit;">現在のドライブはMBRパーティションテーブルを使用します。</font><font style="vertical-align: inherit;">新しいディスクの容量は2 TBを超えるため、MBRは2 TBを超えるディスクを処理できないため、GPTテーブルを使用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のディスクレイアウトを表示します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
sdd              8:48   0   2,7T  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクで使用されているパーティションテーブルを確認します</font></font><code>/dev/sda</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># fdisk -l /dev/sda | grep 'Disk label type'</span>
Disk label <span class="hljs-built_in">type</span>: dos</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスク</font></font><code>/dev/sdb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は同様のパーティションテーブルを使用します。</font><font style="vertical-align: inherit;">システムの使用済みディスク容量を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># df -h</span><font></font>
          % C <font></font>
devtmpfs                16G            0   16G            0% /dev<font></font>
tmpfs                   16G            0   16G            0% /dev/shm<font></font>
tmpfs                   16G         9,5M   16G            1% /run<font></font>
tmpfs                   16G            0   16G            0% /sys/fs/cgroup<font></font>
/dev/mapper/vg0-root   204G         1,3G  192G            1% /<font></font>
/dev/md126            1007M         120M  837M           13% /boot<font></font>
tmpfs                  3,2G            0  3,2G            0% /run/user/0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、ファイルシステムのルートは204 GBです。</font><font style="vertical-align: inherit;">ソフトウェアRAIDの現在の状態を確認します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. GPTパーティションテーブルとディスクパーティションをインストールする</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクターごとにディスクのレイアウトを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># parted /dev/sda print</span><font></font>
: ATA KINGSTON SVP200S (scsi)<font></font>
 /dev/sda: 240GB<font></font>
  (./.): 512B/512B<font></font>
 : msdos<font></font>
Disk Flags: <font></font>
<font></font>
                  <font></font>
 1     1049kB  1076MB  1075MB  primary                    , raid<font></font>
 2     1076MB  240GB   239GB   primary                    raid<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい3TBドライブで、3つのパーティションを作成する必要があります。 </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"></font><code>bios_grub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BIOSとの互換性のための</font><font style="vertical-align: inherit;">CATEGORY </font><font style="vertical-align: inherit;">2MiB GPTサイズ、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にマウントするRAIDアレイのパーティション</font></font><code>/boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAIDアレイのパーティション</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。LVルート</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVスワップが存在し</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">（CentOSの場合）、</font><font style="vertical-align: inherit;">（Debian / Ubuntuの場合）を</font><font style="vertical-align: inherit;">
使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">parted</font></i><font style="vertical-align: inherit;">ユーティリティ</font><i><font style="vertical-align: inherit;">を</font></i><font style="vertical-align: inherit;">インストールします</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">parted</font></i><font style="vertical-align: inherit;"> 
を使用し</font><font style="vertical-align: inherit;">て次のコマンドを実行し、ディスクをパーティション分割します。</font><font style="vertical-align: inherit;">
コマンドを実行し、</font><font style="vertical-align: inherit;">ディスクレイアウトの編集モードに入ります。</font><font style="vertical-align: inherit;">
GPTパーティションテーブルを作成します。</font></font><code>yum install -y parted</code><font style="vertical-align: inherit;"></font><code>apt install -y parted</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>parted /dev/sdc</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">(parted) mktable gpt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのセクション</font></font><code>bios_grub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション</font><font style="vertical-align: inherit;">を作成し</font><font style="vertical-align: inherit;">、フラグを設定します。</font></font><br>
<br>
<pre><code class="bash hljs">(parted) mkpart primary 1MiB 3MiB<font></font>
(parted) <span class="hljs-built_in">set</span> 1 bios_grub on  </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのセクションを作成し、それにフラグを設定します。</font><font style="vertical-align: inherit;">パーティションはRAIDアレイのブロックとして使用され、にマウントされ</font></font><code>/boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">(parted) mkpart primary ext2 3MiB 1028MiB<font></font>
(parted) <span class="hljs-built_in">set</span> 2 boot on</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVMが配置される配列ブロックとしても使用される3つのセクションを作成します。</font></font><br>
<br>
<pre><code class="bash hljs">(parted) mkpart primary 1028MiB 100% </code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、フラグの設定は不要ですが、必要に応じて以下のコマンドで設定することが可能です。</font></font><br>
<br>
<pre><code class="bash hljs">(parted) <span class="hljs-built_in">set</span> 3 raid on</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成したテーブルを確認してください。</font></font><br>
<br>
<pre><code class="bash hljs">(parted) p                                                                <font></font>
: ATA TOSHIBA DT01ACA3 (scsi)<font></font>
 /dev/sdc: 3001GB<font></font>
  (./.): 512B/4096B<font></font>
 : gpt<font></font>
Disk Flags: <font></font>
<font></font>
                  <font></font>
 1     1049kB  3146kB  2097kB                    primary  bios_grub<font></font>
 2     3146kB  1077MB  1074MB                    primary  <font></font>
 3     1077MB  3001GB  3000GB                    primary<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドライブに新しいランダムなGUIDを割り当てます。</font></font><br>
<br>
<pre><code class="bash hljs">sgdisk -G /dev/sdd
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.最初のディスクのパーティションをアレイから削除する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイの状態を確認する</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sda1[0] sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sda2[0] sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/2 pages [0KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムは、2つのアレイを使用する：md126は（ポイント/ブートマウント） -から成る</font></font><code>/dev/sda1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdb1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>md127</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（のためのLVM </font></font><code>swap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とファイルシステムのルート） -から成る</font></font><code>/dev/sda2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdb2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アレイで使用される最初のディスクのパーティションを不良としてマークします。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --fail /dev/sda1<font></font>
<font></font>
mdadm /dev/md127 --fail /dev/sda2</code></pre><br><font style="vertical-align: inherit;"></font><code>/dev/sda</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイから</font><font style="vertical-align: inherit;">
ブロックデバイスのセクションを削除</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --remove /dev/sda1<font></font>
<font></font>
mdadm /dev/md127 --remove /dev/sda2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディスクを取り外した後、アレイの状態を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/1] [_U]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/1] [_U]<font></font>
      bitmap: 2/2 pages [8KB], 65536KB chunk<font></font>
<font></font>
unused devices: &lt;none&gt;<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.新しいディスクのパーティションをアレイに追加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、同期のために新しいディスクのパーティションをアレイに追加することです。</font><font style="vertical-align: inherit;">ディスクレイアウトの現在の状態を確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
sdd              8:48   0   2,7T  0 disk  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクション</font></font><code>/dev/sdc1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><font style="vertical-align: inherit;">セクションで</font><font style="vertical-align: inherit;">あり、</font></font><code>bios_grub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列の作成には関与しません。</font><font style="vertical-align: inherit;">配列の場合のみ</font></font><code>/dev/sdc2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">含まれ</font></font><code>/dev/sdc3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これらのセクションを対応する配列に追加します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --add /dev/sdc2<font></font>
<font></font>
mdadm /dev/md127 --add /dev/sdc3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アレイの同期を待ちます。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdc2[2] sdb1[1]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 0/1 pages [0KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdc3[2] sdb2[1]<font></font>
      233206784 blocks super 1.2 [2/1] [_U]<font></font>
      [&gt;....................]  recovery =  0.2% (619904/233206784) finish=31.2min speed=123980K/sec<font></font>
      bitmap: 2/2 pages [8KB], 65536KB chunk<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイにパーティションを追加した後のディスクのパーティション分割。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0   2,7T  0 disk  </code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 2番目のディスクのパーティションをアレイから削除する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各アレイで使用されている2番目のディスクのパーティションを不良としてマークします。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --fail /dev/sdb1<font></font>
<font></font>
mdadm /dev/md127 --fail /dev/sdb2<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><code>/dev/sda</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アレイから</font><font style="vertical-align: inherit;">
ブロックデバイスのセクションを削除</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --remove /dev/sdb1<font></font>
<font></font>
mdadm /dev/md127 --remove /dev/sdb2<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. GPTマークアップテーブルをコピーしてアレイを同期する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPTマークアップテーブルをコピーする</font></font><code>sgdisk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、パッケージに含まれて</font><font style="vertical-align: inherit;">いるユーティリティを使用</font><font style="vertical-align: inherit;">して、ディスクパーティションとGPTテーブルを操作します</font></font><code>gdisk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">CentOSの</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール</font></font><code>gdisk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">yum install -y gdisk</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール</font></font><code>gdisk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のDebian / Ubuntuのために：</font></font><br>
<br>
<pre><code class="bash hljs">apt install -y gdisk</code></pre><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：GPTの場合</font><font style="vertical-align: inherit;">、ディスク</font><b><font style="vertical-align: inherit;">れた</font></b><font style="vertical-align: inherit;">マークアップがコピーさである</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示され</font><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">第二の</font></b><font style="vertical-align: inherit;">ディスクはディスクである</font><b><font style="vertical-align: inherit;">、そこから</font></b><font style="vertical-align: inherit;">マークアップが</font><b><font style="vertical-align: inherit;">されている</font></b><font style="vertical-align: inherit;">コピー。</font><font style="vertical-align: inherit;">ディスクを混同すると、最初は正常なマークアップが上書きされて破棄されます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPTマークアップテーブルをコピーします。</font></font><br>
<br>
<pre><code class="bash hljs">sgdisk -R /dev/sdd /dev/sdc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テーブルをディスクに転送した後のディスクのパーティション分割</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0   2,7T  0 disk  <font></font>
├─sdd1           8:49   0     2M  0 part  <font></font>
├─sdd2           8:50   0     1G  0 part  <font></font>
└─sdd3           8:51   0   2,7T  0 part  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ソフトウェアRAIDアレイに参加している各パーティションを追加します。</font></font><br>
<br>
<pre><code class="bash hljs">mdadm /dev/md126 --add /dev/sdd2<font></font>
<font></font>
mdadm /dev/md127 --add /dev/sdd3</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイの同期を待っています。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># cat /proc/mdstat </span><font></font>
Personalities : [raid1] <font></font>
md126 : active raid1 sdd2[3] sdc2[2]<font></font>
      1047552 blocks super 1.2 [2/2] [UU]<font></font>
      bitmap: 1/1 pages [4KB], 65536KB chunk<font></font>
<font></font>
md127 : active raid1 sdd3[3] sdc3[2]<font></font>
      233206784 blocks super 1.2 [2/1] [U_]<font></font>
      [&gt;....................]  recovery =  0.0% (148224/233206784) finish=26.2min speed=148224K/sec<font></font>
      bitmap: 2/2 pages [8KB], 65536KB chunk<font></font>
unused devices: &lt;none&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPTマークアップを2番目の新しいディスクにコピーすると、マークアップは次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
├─sda1           8:1    0     1G  0 part  <font></font>
└─sda2           8:2    0 222,5G  0 part  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
├─sdb1           8:17   0     1G  0 part  <font></font>
└─sdb2           8:18   0 222,5G  0 part  <font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0   2,7T  0 disk  <font></font>
├─sdd1           8:49   0     2M  0 part  <font></font>
├─sdd2           8:50   0     1G  0 part  <font></font>
│ └─md126        9:126  0  1023M  0 raid1 /boot<font></font>
└─sdd3           8:51   0   2,7T  0 part  <font></font>
  └─md127        9:127  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、GRUBを新しいドライブにインストールします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSのインストール：</font></font><br>
<br>
<pre><code class="bash hljs">grub2-install /dev/sdX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debian / Ubuntuのインストール：</font></font><br>
<br>
<pre><code class="bash hljs">grub-install /dev/sdX</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここ</font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、ドライブ文字は、</font><font style="vertical-align: inherit;">ここで</font><font style="vertical-align: inherit;">はドライブ</font></font><code>/dev/sdc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>/dev/sdd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイに関する情報を更新します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSの場合：</font></font><br>
<br>
<pre><code class="bash hljs">mdadm --detail --scan --verbose &gt; /etc/mdadm.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debian / Ubuntuの場合：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"DEVICE partitions"</span> &gt; /etc/mdadm/mdadm.conf<font></font>
<font></font>
mdadm --detail --scan --verbose | awk <span class="hljs-string">'/ARRAY/ {print}'</span> &gt;&gt; /etc/mdadm/mdadm.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像の更新</font></font><code>initrd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSの場合：</font></font><br>
<br>
<pre><code class="bash hljs">dracut -f -v --regenerate-all</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debian / Ubuntuの場合：</font></font><br>
<br>
<pre><code class="bash hljs">update-initramfs -u -k all</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRUB構成の更新。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CentOSの場合：</font></font><br>
<br>
<pre><code class="bash hljs">grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debian / Ubuntuの場合：</font></font><br>
<br>
<pre><code class="bash hljs">update-grub</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手順が完了したら、古いディスクを取り外すことができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.ルートパーティションのファイルシステム（ext4）の拡張</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムを2 x 3TB（RAID-1）ディスクに移動した後、ファイルシステムを拡張する前にディスクをパーティション分割します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
│ └─md127        9:127  0  1023M  0 raid1 /boot<font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
  └─md126        9:126  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0   2,7T  0 disk  <font></font>
├─sdd1           8:49   0     2M  0 part  <font></font>
├─sdd2           8:50   0     1G  0 part  <font></font>
│ └─md127        9:127  0  1023M  0 raid1 /boot<font></font>
└─sdd3           8:51   0   2,7T  0 part  <font></font>
  └─md126        9:126  0 222,4G  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今セクション</font></font><code>/dev/sdc3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code> /dev/sdd3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.7 TB </font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">占めます。</font><font style="vertical-align: inherit;">GPTテーブルを使用してディスクの新しいパーティションを作成したため、3つのパーティションのサイズはすぐに最大可能なディスク領域に設定されました。この場合、パーティションを拡張する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは必要である：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">md126配列を拡張し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PV（物理ボリューム）を展開し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LV（論理ボリューム）vg0-rootを拡張し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルシステムを拡張します。</font></font></li>
</ol><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.アレイ</font></font><code>md126</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を最大まで</font><font style="vertical-align: inherit;">拡張します</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br>
<pre><code class="bash hljs">mdadm --grow /dev/md126 --size=max
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アレイを拡張した後</font></font><code>md126</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、占有スペースのサイズは2.7 TBに増加しました。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lsblk</span><font></font>
NAME           MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<font></font>
sda              8:0    0 223,6G  0 disk  <font></font>
sdb              8:16   0 223,6G  0 disk  <font></font>
sdc              8:32   0   2,7T  0 disk  <font></font>
├─sdc1           8:33   0     2M  0 part  <font></font>
├─sdc2           8:34   0     1G  0 part  <font></font>
│ └─md127        9:127  0  1023M  0 raid1 /boot<font></font>
└─sdc3           8:35   0   2,7T  0 part  <font></font>
  └─md126        9:126  0   2,7T  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
sdd              8:48   0   2,7T  0 disk  <font></font>
├─sdd1           8:49   0     2M  0 part  <font></font>
├─sdd2           8:50   0     1G  0 part  <font></font>
│ └─md127        9:127  0  1023M  0 raid1 /boot<font></font>
└─sdd3           8:51   0   2,7T  0 part  <font></font>
  └─md126        9:126  0   2,7T  0 raid1 <font></font>
    ├─vg0-root 253:0    0 206,4G  0 lvm   /<font></font>
    └─vg0-swap 253:1    0    16G  0 lvm   [SWAP]<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理ボリュームの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張</font><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張の前に、占有スペースPV /の現在の値を確認します</font></font><code>dev/md126</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># pvs</span><font></font>
  PV         VG  Fmt  Attr PSize   PFree<font></font>
  /dev/md126 vg0 lvm2 a--  222,40g    0 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコマンドでPVを展開します。</font></font><br>
<br>
<pre><code class="bash hljs">pvresize /dev/md126
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了したアクションを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># pvs</span><font></font>
  PV         VG  Fmt  Attr PSize  PFree<font></font>
  /dev/md126 vg0 lvm2 a--  &lt;2,73t 2,51t</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス論理ボリュームvg0-root</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を拡張してい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PV拡大後、VGの占有スペースを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># vgs</span>
  VG  <span class="hljs-comment">#PV #LV #SN Attr   VSize  VFree</span>
  vg0   1   2   0 wz--n- &lt;2,73t 2,51t</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVが占めるスペースを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lvs</span><font></font>
  LV   VG  Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<font></font>
  root vg0 -wi-ao---- &lt;206,41g                                                    <font></font>
  swap vg0 -wi-ao----  &lt;16,00g            </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vg0-rootボリュームは206.41 GBを占有します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LVを最大ディスク容量まで拡張します。</font></font><br>
<br>
<pre><code class="bash hljs">lvextend -l +100%FREE /dev/mapper/vg0-root </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張後のLVスペースの確認。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># lvs</span><font></font>
  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<font></font>
  root vg0 -wi-ao----   2,71t                                                    <font></font>
  swap vg0 -wi-ao---- &lt;16,00g</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルシステムの拡張（ext4）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のファイルシステムのサイズを確認します。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># df -h</span><font></font>
          % C <font></font>
devtmpfs                16G            0   16G            0% /dev<font></font>
tmpfs                   16G            0   16G            0% /dev/shm<font></font>
tmpfs                   16G         9,6M   16G            1% /run<font></font>
tmpfs                   16G            0   16G            0% /sys/fs/cgroup<font></font>
/dev/mapper/vg0-root   204G         1,4G  192G            1% /<font></font>
/dev/md127            1007M         141M  816M           15% /boot<font></font>
tmpfs                  3,2G            0  3,2G            0% /run/user/0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ dev / mapper / vg0-rootボリュームは、LV拡張の後に204 GBを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルシステムの拡張。</font></font><br>
<br>
<pre><code class="bash hljs">resize2fs /dev/mapper/vg0-root 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張後のファイルシステムのサイズを確認してください。</font></font><br>
<br>
<pre><code class="bash hljs">[root@localhost ~]<span class="hljs-comment"># df -h</span><font></font>
          % C <font></font>
devtmpfs                16G            0   16G            0% /dev<font></font>
tmpfs                   16G            0   16G            0% /dev/shm<font></font>
tmpfs                   16G         9,6M   16G            1% /run<font></font>
tmpfs                   16G            0   16G            0% /sys/fs/cgroup<font></font>
/dev/mapper/vg0-root   2,7T         1,4G  2,6T            1% /<font></font>
/dev/md127            1007M         141M  816M           15% /boot<font></font>
tmpfs                  3,2G            0  3,2G            0% /run/user/0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルシステムのサイズは、ボリュームのボリューム全体によって増加します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486070/index.html">ACLスイッチの詳細</a></li>
<li><a href="../ja486072/index.html">SQLハウツー：クエリで直接whileループを記述する、または「基本的な3方向」</a></li>
<li><a href="../ja486076/index.html">地上からFPVクワッドコプターへ：はじめに</a></li>
<li><a href="../ja486080/index.html">ご紹介しましょう：Veeam Availability Suite v10</a></li>
<li><a href="../ja486082/index.html">ダガズ：テクノロジーの総和</a></li>
<li><a href="../ja486092/index.html">マリーナアレックス、ビジネス大学アジリティのCEO：「アジャイルはITの外にあります。アジャイル-IT以上</a></li>
<li><a href="../ja486094/index.html">下院民主党、シリコンバレーと戦う</a></li>
<li><a href="../ja486098/index.html">テクノロジーの負債がプロジェクトをいかに殺すか</a></li>
<li><a href="../ja486100/index.html">拡張可能な分散型アプリケーションを作成するにはどうすればよいですか？ブロックチェーンを少なくする</a></li>
<li><a href="../ja486106/index.html">Raspberry Pi TVのアダプティブバックライト-Ambilight Analog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>