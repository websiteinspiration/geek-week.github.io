<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🚒 💜 🛳️ Async / attendre dans Unity 👬 🐨 📻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, Khabrovsk. Il reste très peu de temps avant le début du cours "Développeur de jeux sur Unity" , à cet égard, nous avons préparé pour vous une a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Async / attendre dans Unity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/506962/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salut, Khabrovsk. </font><font style="vertical-align: inherit;">Il reste très peu de temps avant le début du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Développeur de jeux sur Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , à cet égard, nous avons préparé pour vous une autre traduction intéressante.</font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/37/kv/yt/37kvytgqxylnrra818g7eckd5ly.png"><br>
<hr><br>
<code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity fonctionne déjà </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sans</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plugins ni </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wrappers corutin qui simulent le comportement asynchrone, en vérifiant l'achèvement sur chaque image. </font><font style="vertical-align: inherit;">Mais c'est quand même une sorte de magie. </font><font style="vertical-align: inherit;">Allons un peu plus loin dans ce sujet. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Remarque: pour le moment, je n'ai pas une compréhension idéale de tous les détails de la hotte </font></font><code>async/await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en C #, donc je vais essayer de compléter ce qui précède, à mesure que ma compréhension s'approfondit.)</font></font></i><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple</font></font></h4><br>
<img src="https://habrastorage.org/webt/ps/8i/so/ps8isowfho7xsjl99bnyzfh_5fo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que j'ai besoin d'un bouton qui, lorsqu'il est cliqué, jouerait une animation de boîte classique. Mais il y a un hic: le bouton doit entrer dans un état inactif (s'assombrir de </font></font><code>.interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'à ce que la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> boîte termine sa rotation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour des raisons de propreté du code, je veux en utiliser une </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui attend la fin de la rotation de la boîte, et ajouter immédiatement une ligne qui restaure </font></font><code>interactable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, au lieu de quelque chose comme créer un objet contenant de la coroutine, vérifier l'état sur chaque trame pour démarrer cette tâche. Avoir un code linéaire évident en un seul endroit est un gros plus en termes de lisibilité. Un tel code est agréable à écrire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code simple et compact suivant implémente la tâche requise. (</font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> les méthodes apparaissent également dans la liste des délégués Unity, ne vous inquiétez pas.)</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<br>
<img src="https://habrastorage.org/webt/m-/or/ad/m-orad9ixe4ebtae_f6hm0ast1w.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici quelques questions que vous auriez dû poser:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Qui» «exécute» le </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reste de la méthode? </font><font style="vertical-align: inherit;">Comme par magie, il est vérifié dans la trame suivante, alors que l'appel </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'est effectué qu'une seule fois, et il n'y a pas de </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coroutines à redémarrer.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le timing de chaque run?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que c'est </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">Cela semble être la clé de tout ce qui se passe ici. </font><font style="vertical-align: inherit;">Je suppose que vous en avez l'habitude </font></font><code>yield return null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans les coroutines. </font><font style="vertical-align: inherit;">Une bonne supposition serait d'essayer à nouveau dans le cadre suivant, mais vous le dites via l'énumérateur C #. </font><font style="vertical-align: inherit;">La formulation du rendement est similaire, et même le comportement est similaire.</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte de synchronisation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consultez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cet article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur la façon dont le reste du programme peut être capturé et poursuivi comme nous le voulons (par exemple, dans quel thread? Dans le thread appelant ou dans le thread qui lance la tâche?) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous remarquerez qu'il existe également dans Unity un tel concept, mais il ne nous est pas visible à première vue.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparé à un programme C # classique</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout n'est pas tout à fait le même que dans les programmes C # réguliers. Un regard sur la documentation officielle </font></font><code>await. await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implique un retour à l'appelant de l'objet </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L'appelant peut continuer jusqu'à ce qu'il ait besoin du résultat de l'exécution, et il ne peut plus se permettre de faire autre chose à ce stade (peu importe si la tâche est multithread ou non), sauf </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Cette chaîne peut continuer jusqu'à ce que vous y arriviez enfin </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Là où, si nous nous rencontrons également </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il y a une autre attente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> générée par le compilateur, qui demande immédiatement le résultat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revenons maintenant au nôtre </font></font><code>SpinAndDisableButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Où va le retour </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Dans Unity, nous n'avons pas</font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car il est profondément caché dans le code moteur. En fait, la question est la même que celle qui joue </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc. Il s'agit d'une </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API qui prend en charge le code moteur dans le cycle de jeu pour fournir un rendu ordonné des objets et de tout ce qui est exécuté dans le cadre. Mais avant, cela ne nous dérangeait pas, car jusqu'à présent ces points d'entrée sont revenus </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, il </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie le point d'exécution à quelqu'un dans l'espoir qu'il puisse continuer à partir de ce point plus tard, à un certain point, automatiquement. Ensuite, la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boucle de jeu continue</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jusqu'à</font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attend. </font><font style="vertical-align: inherit;">Sinon, nous ne verrions pas du tout la boîte tournante, si nous attendions vraiment que la boîte termine l'animation, car l'animation ne pourrait pas se terminer si le changement d'image ne se poursuivait pas. </font><font style="vertical-align: inherit;">Alors, que se passera-t-il dans la prochaine image? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est le pseudocode que nous souhaitons recevoir dans un cadre différent de celui dans lequel nous avons appuyé sur le bouton et ainsi désactivé:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">for</span> ( )<font></font>
{<font></font>
    <span class="hljs-keyword">if</span>(  )<font></font>
    {<font></font>
    	 .<font></font>
    }<font></font>
  <font></font>
     .<font></font>
         .<font></font>
        .<font></font>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Débogage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluez plus de journaux dans le code et nous essaierons le débogage étape par étape.</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> UnityEngine.UI;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SpinBox</span> : <span class="hljs-title">MonoBehaviour</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> Button button;
    <span class="hljs-keyword">public</span> Animation ani;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SpinAndDisableButton</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Started async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
        ani.Play();<font></font>
        button.interactable = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">while</span> (ani.isPlaying == <span class="hljs-literal">true</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> Task.Yield();<font></font>
        }<font></font>
        button.interactable = <span class="hljs-literal">true</span>;<font></font>
        Debug.Log(<span class="hljs-string">$"Finished async <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LateUpdate</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">$"Late Update <span class="hljs-subst">{Time.frameCount}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ordre de mise à jour est le suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ku/rp/b7/kurpb70kzx35oellcgqqwor5eow.png"><br>
<br>
<img src="https://habrastorage.org/webt/1c/k8/ef/1ck8ef1r0hmycnkfcubqfa4kwec.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le cadre dans lequel nous commençons l'animation est précédé par, </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parce que le clic de souris vient de </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>GraphicRaycaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de UGUI Unity, qui, comme il s'est avéré, a l'ordre d'exécution dans l' </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un de vos scripts ci-dessus.</font></font></li>
<li><code>while</code>   <b> </b>      ,   <b></b> <code>Update</code>,   <code>LateUpdate</code>.     ,     !</li>
<li>      ,    ,      ,   <code>Awaiting</code>,    UGUI   ,   ,  <code>await</code> ,        -   </li>
<li>         <code>Update</code>  -   . <code>await</code>     .</li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il reste à démystifier «l'objet en attente», que je n'ai pas entièrement résolu, mais au moins je vois comment cela fonctionne, car il a été intentionnellement encodé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la première image, où j'ai cliqué sur le bouton, il n'y a rien d'étrange. </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(la même magie </font></font><code>MonoBehaviour Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><code>EventSystem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise l' </font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API et voit mon clic, après quoi il scanne mon bouton sur la toile et voit qu'il peut faire quelque chose. Ensuite, il est appelé </font></font><code>public async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et atteint cette ligne. (Vous pouvez également les utiliser </font></font><code>ExecuteEvents</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manuellement! Il s'agit d'une </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe d' </font><font style="vertical-align: inherit;">assistance </font><font style="vertical-align: inherit;">.) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/6q/yb/ut6qybougoh8yuhav3o2gpn8hly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'image suivante, où la magie opère, la pile d'appels peut nous montrer précisément qui traite la vérification pour nous toutes les quelques images. Je ne comprends pas très bien ce qui se passe ici. (bien que cela fonctionne) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fr/gw/uj/frgwujptlworykklroix5o0m4sk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand j'ai vérifié</font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, beaucoup semble être appelé à partir du code moteur, donc je ne peux que deviner. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/qh/vm/reqhvmmgmoxuzm6i-e-9ts49txm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a quelque chose appelé là </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">bas </font><font style="vertical-align: inherit;">qui représente chacune de vos affaires inachevées attendues. </font><font style="vertical-align: inherit;">Je suppose que le retour est </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correctement enregistré de manière «ludique», ce qui est compatible avec le paradigme du personnel et garantit que tout le code sécurisé est verrouillé dans le thread principal afin que vous puissiez pleinement faire quelque chose après tout </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car cela se fera au bon moment dans le cadre .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task.Yield ()</font></font></h4><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette méthode a une description très confuse: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task.yield?view=netframework-4.8</font></font></a></i><br>
<blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">YieldAwaitable</a><br>
<br>
 ,  ,          .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SynchronizationContext</a>   NULL,     .     ,     ,    .<br>
<br>
<b></b><br>
<br>
   <code>await Task.Yield()</code>;   ,     .      ( SynchronizationContext),         .   ,  ,         ,    .  ,    UI     UI,    ,    ,     .     ,  <code>await Task.Yield()</code>;   UI .      « ,    ContinueWith»   «   .NET».</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'anglais n'est pas ma langue maternelle, et je pense que ni C # </font></font><code>yield return</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ni ne </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reflètent la fonction qu'ils remplissent. Mais passons à la définition de la méthode. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6k/-f/oi/6k-foipgostpw8fxs9c9znoz7jo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le cas d'utilisation prévu dans la note semble indiquer que la méthode n'est pas vraiment </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais vous souhaitez la transformer </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous devez donc </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(vous attendre) quelque part, c'est donc </font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un bouc émissaire idéal. Au lieu de terminer immédiatement la méthode (rappelez-vous que l'async ne transformera pas par magie la méthode en asynchrone, cela dépend du contenu de la méthode), maintenant vous la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forcez</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à être asynchrone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais dans notre cas, le destinataire du contexte n'est pas un contexte ordinaire, mais </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Maintenant</font></font><code>Task.Yield()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a une fonction plus utile qui continue effectivement de fonctionner dans le cadre suivant. </font><font style="vertical-align: inherit;">S'il était ordinaire </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, je suppose qu'il pourrait produire une boucle infinie dans notre exemple, car il continuera de continuer </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encore et encore. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il retourne </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que l'appelant peut utiliser pour continuer. </font><font style="vertical-align: inherit;">Comme en témoigne notre journal, «En attente» a été enregistré au début de chaque image, car le contexte (le code à côté </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) a été enregistré dans cet aviateur. </font></font><code>UnitySynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fait de la magie, attend le cadre et utilise cet aveyter pour continuer, puis il atteint </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et retourne un nouveau </font></font><code>YieldAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela continuera probablement à ajouter du nouveau </font></font><code>WorkRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code plus tôt dans chaque trame en tant que tâche en attente jusqu'à ce </font></font><code>while</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'il devienne</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un package </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UniTask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> populaire </font><font style="vertical-align: inherit;">qui élimine complètement </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et introduit un nouveau type de tâche plus légère </font></font><code>UniTask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui se lie directement à l' </font></font><code>PlayerLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API. </font><font style="vertical-align: inherit;">Ensuite, vous pouvez choisir l'heure à laquelle la vérification doit avoir lieu dans la trame suivante. </font><font style="vertical-align: inherit;">(Initialisation? Mise à jour tardive?) Mais, en fait, vous savez ce qui </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne sans plugin. </font><font style="vertical-align: inherit;">Cela sera utile avec Addressables dans la mesure du </font></font><code>AsyncOperationHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possible. </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que vous pouvez utiliser avec </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regarder</font></font></h3><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7eKi6NKri6I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est une bonne conversation, qui montre que cela </font></font><code>Await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne déjà bien, mais il y a des avantages à la coroutine raisonnablement utilisée. </font><font style="vertical-align: inherit;">Vous pouvez prêter plus d'attention à cette diapositive pour la trier un peu si vous êtes toujours confus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/md/kw/8cmdkwfptrr0hr-y6twos_oto7u.png"><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous créons un shooter en réseau dans l'espace en une heure et demie.</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506940/index.html">La route de l'idéal: un petit guide pour les programmeurs et leurs dirigeants</a></li>
<li><a href="../fr506950/index.html">Qu'est-ce que l'école 21 et pourquoi est-elle ainsi conçue?</a></li>
<li><a href="../fr506952/index.html">Portail API: que rechercher lors de la conception. Expérience Wrike</a></li>
<li><a href="../fr506954/index.html">Un autre article sur Rails et ELK</a></li>
<li><a href="../fr506956/index.html">Technologie quantique et santé</a></li>
<li><a href="../fr506964/index.html">Développement Android: revue de carrière pour mai 2020</a></li>
<li><a href="../fr506976/index.html">Présentation des scanners 3D Solutionix D500 et D700</a></li>
<li><a href="../fr506980/index.html">Fin de partie HackTheBox. Procédure pas à pas Xen Lab. Pentest Active Directory</a></li>
<li><a href="../hi486176/index.html">कॉर्पोरेट ईमेल पत्राचार मेमो</a></li>
<li><a href="../hi486178/index.html">FOSS News No. 1 - 27 जनवरी - 2 फरवरी, 2020 के लिए स्वतंत्र और मुक्त स्रोत समाचार की समीक्षा</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>