<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐พ ๐ง๐ฟ โซ๏ธ [ุงูุฌุฒุก 1/2] ุฏููู FFmpeg ู SDL ุฃู ููููุฉ ูุชุงุจุฉ ูุดุบู ููุฏูู ูู ุฃูู ูู 1000 ุณุทุฑ ๐ ๐ง ๐๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ุงููุนูููุงุช ูุฏููุฉ ุจุงููุนู ุ ุฅูุง ุฃู ุงููุงุฏุฉ ุงูุฃุตููุฉ ูุง ุชุฒุงู ูุตุฏุฑ ุฅููุงู ุดุงุฆุน ููุญุชูู ูููุฏ ูุฎุชูู ุญูู ููุถูุน FFmpeg. ููุน ุฐูู ุ ูุง ุชูุฌุฏ ุญุชู ุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>[ุงูุฌุฒุก 1/2] ุฏููู FFmpeg ู SDL ุฃู ููููุฉ ูุชุงุจุฉ ูุดุบู ููุฏูู ูู ุฃูู ูู 1000 ุณุทุฑ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/edison/blog/500402/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><div style="text-align:center;"><img width="780" height="325" src="https://habrastorage.org/webt/8g/lm/9b/8glm9bxivqkvscmah31ojdjmzci.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ุงููุนูููุงุช ูุฏููุฉ ุจุงููุนู ุ ุฅูุง ุฃู ุงููุงุฏุฉ ุงูุฃุตููุฉ ูุง ุชุฒุงู ูุตุฏุฑ ุฅููุงู ุดุงุฆุน ููุญุชูู ูููุฏ ูุฎุชูู ุญูู ููุถูุน FFmpeg. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุง ุชูุฌุฏ ุญุชู ุงูุขู ุชุฑุฌูุฉ ูุงููุฉ ููุฃุตู ุฅูู ุงูุฑูุณูุฉ. </font><font style="vertical-align: inherit;">ูุญู ูุตุญุญ ุงูุฅุบูุงู ุงููุฒุนุฌ ุ ูุฃูู ูุชุฃุฎุฑ ุฃูุถู ูู ุนุฏูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนูู ุงูุฑุบู ูู ูุญุงููุชูุง ุ ุฅูุง ุฃู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตุนูุจุงุช ุงูุชุฑุฌูุฉ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃูุฑ ูุง ููุฑ ููู ูู ูุซู ูุฐุง ุงููุต ุงูุถุฎู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุงูุฅุจูุงุบ ุนู ุงูุฃุฎุทุงุก (ูููุถู ุฃู ูููู ุฐูู ูู ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ) - ุณูุนูู ูุนูุง ุจุดูู ุฃูุถู.</font></font><a name="menu"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฏูู ุงููุญุชููุงุช</font></font></h3><div class="scrollable-table"><table>
<tbody><tr>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฒุก ุงูุฃูู</font></font></th>
<th align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฒุก 2</font></font></th>
</tr>
<tr>
<td align="left"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏูุฉ </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 1: ุฅูุดุงุก SCREENCAPS </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 2: ุนุฑุถ ูู </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 3: ุงููุนุจ ุงูุตูุช </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 4: ุงูููุงุถูุน ูุชุนุฏุฏุฉ </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 5: ูุฒุงููุฉ ุงูููุฏูู</font></font></a><br>
</td>
<td align="left"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> 6:  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> 7: </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> 1.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> 2.  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a></td>
</tr>
</tbody></table></div><a name="habracut"></a><a name="preamble"></a><blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅุฏูุณูู ุจุฑูุฌูุงุช - ุชุทููุฑ ุงูููุจ"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="ุฅุฏูุณูู ุจุฑูุฌูุงุช - ุชุทููุฑ ุงูููุจ"></a><br clear="right">
     EDISON.<br>
<br>
        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">     </a>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">      C  C++</a>.<br>
<br>
     ! ;-)</blockquote><br>
<h2> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช">โ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 1: ุฅูุดุงุก ููุทุงุช ุดุงุดุฉ">โ</a></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: ุชู ุชุญุฏูุซ ูุฐุง ุงูุฏููู ุงุนุชุจุงุฑูุง ูู ูุจุฑุงูุฑ 2015. </font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููุชุจุฉ ุฑุงุฆุนุฉ ูุฅูุดุงุก ุชุทุจููุงุช ุงูููุฏูู ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ ููุฃุบุฑุงุถ ุงูุนุงูุฉ. ูุชููู FFmpeg ุฑูุชูู ูุนุงูุฌุฉ ุงูููุฏูู ุจุงููุงูู ุ ุญูุซ ูููู ุจุฌููุน ุนูููุงุช ูู ุงูุชุดููุฑ ูุงูุชุดููุฑ ูุงููุถุงุนูุฉ ูุฅุฒุงูุฉ ุชุนุฏุฏ ุงูุฅุฑุณุงู. ููุง ูุจุณุท ุฅูู ุญุฏ ูุจูุฑ ุฅูุดุงุก ุชุทุจููุงุช ุงููุณุงุฆุท. ูู ุดูุก ุจุณูุท ูุณุฑูุน ุ ููุชูุจ ุจูุบุฉ C ุ ููููู ูู ุชุดููุฑ ุฃู ุจุฑูุงูุฌ ุชุฑููุฒ ูุชููุฑ ุงูููู ุชูุฑูุจูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชุฑููุฒ ุจุนุถ ุงูุชูุณููุงุช ุงูุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุตูุฏ ุงููุญูุฏ ูู ุฃู ุงููุซุงุฆู ููููุฏุฉ ูู ุงูุบุงูุจ. ููุงู ุจุฑูุงูุฌ ุชุนูููู ูุงุญุฏ ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฃุตู ุ ููุง ุฑุงุจุท ูุตูุญุฉ ููุจ ุบูุฑ ููุฌูุฏุฉ ุจุงููุนู - ูุชุฑุฌู ุงูููุงุญุธุงุช</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ุ ูุงูุชู ุชุบุทู ุฃุณุงุณูุงุช FFmpeg ูุงูุชูููุฏ ุงูุชููุงุฆู ูุฃุญูุงุถ doxygen. ููุง ุฃูุซุฑ. ูุฐูู ุ ูุฑุฑุช ุจุดูู ูุณุชูู ูุนุฑูุฉ ููููุฉ ุงุณุชุฎุฏุงู FFmpeg ูุฅูุดุงุก ุชุทุจููุงุช ููุฏูู ูุตูุช ุฑูููุฉ ุนุงููุฉ ุ ููู ููุณ ุงูููุช ุชูุซูู ุงูุนูููุฉ ูุชูุฏูููุง ูู ุดูู ูุชุงุจ ูุฏุฑุณู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุจุฑูุงูุฌ FFplay ุงูุฐู ูุฃุชู ูุน FFmpeg. ุฅูู ุจุณูุท ุ ููุชูุจ ูู C ุ ูููุฐ ูุดุบู ููุฏูู ูุงูู ุจุงุณุชุฎุฏุงู FFmpeg. ุฏุฑุณู ุงูุฃูู ูู ูุณุฎุฉ ูุญุฏุซุฉ ูู ุงูุฏุฑุณ ุงูุฃุตูู ููุงุฑุชู ุจูููู ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฃุตู ุ ุฑุงุจุท ุฅูู ุตูุญุฉ ููุจ ูุนุทูุฉ ุจุงููุนู - ููุงุญุธุฉ ูุชุฑุฌู</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - ููุช ุจุณุญุจ ุจุนุถ ุงููุทุน ูู ููุงู. ูุฃูุถูุง ูู ุณูุณูุฉ ูู ุฏุฑูุณู </font><b><font style="vertical-align: inherit;">ุณุฃุนุฑุถ</font></b><font style="vertical-align: inherit;"> ุนูููุฉ ุฅูุดุงุก ูุดุบู ููุฏูู ูุนูู ุนูู ุฃุณุงุณ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffplay.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุจุฑูุณ ุจููุงุฑุฏ. ุณููุฏู ูู ุฏุฑุณ ููุฑุฉ ุฌุฏูุฏุฉ (ุฃู ุญุชู ููุฑุชูู) ูุน ุดุฑุญ ูุชุทุจูููุง. ูุฃุชู ูู ูุตู ูุน ูุงุฆูุฉ C ุ ูุงูุชู ููููู ุชุฌููุนูุง ูุชุดุบูููุง ุจููุณู. ุณุชุนุฑุถ ูููุงุช ุงููุตุฏุฑ ููููุฉ ุนูู ูุฐุง ุงูุจุฑูุงูุฌ ุ ูููููุฉ ุนูู ุฃุฌุฒุงุฆู ุงููุฑุฏูุฉ ุ ูุณุชูุถุญ ุฃูุถูุง ุงูุชูุงุตูู ุงููููุฉ ุงูุซุงูููุฉ ุงูุชู ูู ูุชู ุชูุงูููุง ูู ูุฐุง ุงูุฏููู. ุนูุฏูุง ููุชูู ุ ุณูููู ูุฏููุง ูุดุบู ููุฏูู ูุนูู ููุชูุจูุง ูู ุฃูู ูู 1000 ุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏ ุฅูุดุงุก ุงููุดุบู ุ ุณูุณุชุฎุฏู SDL ูุฅุฎุฑุงุฌ ููู ูุณุงุฆุท ุงูุตูุช ูุงูููุฏูู. SDL ูู ููุชุจุฉ ูุณุงุฆุท ูุชุนุฏุฏุฉ ููุชุงุฒุฉ ุนุจุฑ ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ุชูุณุชุฎุฏู ูู ุจุฑุงูุฌ ุชุดุบูู MPEG ูุจุฑุงูุฌ ุงููุญุงูุงุฉ ูุงูุนุฏูุฏ ูู ุฃูุนุงุจ ุงูููุฏูู. ุณุชุญุชุงุฌ ุฅูู ุชูุฒูู ููุชุจุงุช SDL ูุชุซุจูุชูุง ุนูู ูุธุงูู ูุชุฌููุน ุงูุจุฑุงูุฌ ูู ูุฐุง ุงูุฏููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนูููู ููุฃุดุฎุงุต ุงูุฐูู ูุฏููู ุฎุจุฑุฉ ุจุฑูุฌุฉ ุฌูุฏุฉ. ุนูู ุงูุฃูู ุ ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ C ุ ูุฃู ูููู ูุฏูู ุฃูุถูุง ููู ูููุงููู ูุซู ููุงุฆู ุงูุงูุชุธุงุฑ ุ ููุงุฆูุงุช ุงููุฒุงููุฉ ุ ููุง ุฅูู ุฐูู. ูุฌุจ ุฃู ูููู ููุงู ุจุนุถ ุงูููู ูููุณุงุฆุท ุงููุชุนุฏุฏุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฃุดูุงุก ูุซู ุงูุทูู ุงูููุฌู ููุง ุดุงุจู. ููุน ุฐูู ุ ููุณ ูู ุงูุถุฑูุฑู ุฃู ุชููู ูุนูููุง ูู ูุฐู ุงูุฃููุฑ ุ ุญูุซ ุณูุชู ุดุฑุญ ุงูุนุฏูุฏ ูู ุงูููุงููู ูู ุณูุงู ุงูุฏุฑูุณ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุชุชุฑุฏุฏ ูู ุฃู ุชุฑุณู ูู ุฑุณุงุฆู ุฎุทุฃ ุ ุฃุณุฆูุฉ ุ ุชุนูููุงุช ุ ุฃููุงุฑ ุ ููุฒุงุช ุ ุฃูุง ูุงู ุ ูู Dranger Doggy Gmail dot Com.</font></font><a name="screencaps"></a><br>
<br>
<hr><hr><hr><hr><hr><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img align="right" width="420" height="125" src="https://habrastorage.org/webt/co/i3/m0/coi3m0tliby9r5uxtiydjoeaqkm.png"></a><br clear="left">
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฑุฃ ุฃูุถุง ุนูู ูุฏููุฉ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุดุฑูุฉ ุฅุฏูุณูู:</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FFmpeg ุฏููู ููุจุงู</font></font></b></a><br>
<hr><hr><hr><hr><hr><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 1: ุฅูุดุงุก Screencaps </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ููุฏูุฉ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 2: ุงูุนุฑุถ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุฉ ุงููุงููุฉ: tutorial01.c</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial01.c</span>
<span class="hljs-comment">// Code based on a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101 </span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span><font></font>
<font></font>
<span class="hljs-comment">// A small sample program that shows how to use libavformat and libavcodec to</span>
<span class="hljs-comment">// read video from a file.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial01 tutorial01.c -lavformat -lavcodec -lswscale -lz</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed</span>
<span class="hljs-comment">// your system).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// tutorial01 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to write the first five frames from "myvideofile.mpg" to disk in PPM</span>
<span class="hljs-comment">// format.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SaveFrame</span><span class="hljs-params">(AVFrame *pFrame, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span> iFrame)</span> </span>{<font></font>
  FILE *pFile;<font></font>
  <span class="hljs-keyword">char</span> szFilename[<span class="hljs-number">32</span>];
  <span class="hljs-keyword">int</span>  y;<font></font>
  <font></font>
  <span class="hljs-comment">// Open file</span>
  <span class="hljs-built_in">sprintf</span>(szFilename, <span class="hljs-string">"frame%d.ppm"</span>, iFrame);<font></font>
  pFile=fopen(szFilename, <span class="hljs-string">"wb"</span>);
  <span class="hljs-keyword">if</span>(pFile==<span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  <font></font>
  <span class="hljs-comment">// Write header</span>
  <span class="hljs-built_in">fprintf</span>(pFile, <span class="hljs-string">"P6\n%d %d\n255\n"</span>, width, height);<font></font>
  <font></font>
  <span class="hljs-comment">// Write pixel data</span>
  <span class="hljs-keyword">for</span>(y=<span class="hljs-number">0</span>; y&lt;height; y++)<font></font>
    fwrite(pFrame-&gt;data[<span class="hljs-number">0</span>]+y*pFrame-&gt;linesize[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, width*<span class="hljs-number">3</span>, pFile);<font></font>
  <font></font>
  <span class="hljs-comment">// Close file</span><font></font>
  fclose(pFile);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{
  <span class="hljs-comment">// Initalizing these to NULL prevents segfaults!</span>
  AVFormatContext   *pFormatCtx = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">int</span>               i, videoStream;<font></font>
  AVCodecContext    *pCodecCtxOrig = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodecContext    *pCodecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec           *pCodec = <span class="hljs-literal">NULL</span>;<font></font>
  AVFrame           *pFrame = <span class="hljs-literal">NULL</span>;<font></font>
  AVFrame           *pFrameRGB = <span class="hljs-literal">NULL</span>;<font></font>
  AVPacket          packet;<font></font>
  <span class="hljs-keyword">int</span>               frameFinished;
  <span class="hljs-keyword">int</span>               numBytes;
  <span class="hljs-keyword">uint8_t</span>           *buffer = <span class="hljs-literal">NULL</span>;
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span> = <span class="hljs-title">NULL</span>;</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please provide a movie file\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, argv[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, argv[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span>
  videoStream=<span class="hljs-number">-1</span>;
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++)
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO) {<font></font>
      videoStream=i;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  <span class="hljs-keyword">if</span>(videoStream==<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Didn't find a video stream</span><font></font>
  <font></font>
  <span class="hljs-comment">// Get a pointer to the codec context for the video stream</span><font></font>
  pCodecCtxOrig=pFormatCtx-&gt;streams[videoStream]-&gt;codec;<font></font>
  <span class="hljs-comment">// Find the decoder for the video stream</span><font></font>
  pCodec=avcodec_find_decoder(pCodecCtxOrig-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(pCodec==<span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Codec not found</span><font></font>
  }<font></font>
  <span class="hljs-comment">// Copy context</span><font></font>
  pCodecCtx = avcodec_alloc_context3(pCodec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(pCodecCtx, pCodecCtxOrig) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Open codec</span>
  <span class="hljs-keyword">if</span>(avcodec_open2(pCodecCtx, pCodec, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Could not open codec</span><font></font>
  <font></font>
  <span class="hljs-comment">// Allocate video frame</span><font></font>
  pFrame=av_frame_alloc();<font></font>
  <font></font>
  <span class="hljs-comment">// Allocate an AVFrame structure</span><font></font>
  pFrameRGB=av_frame_alloc();<font></font>
  <span class="hljs-keyword">if</span>(pFrameRGB==<span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// Determine required buffer size and allocate buffer</span><font></font>
  numBytes=avpicture_get_size(PIX_FMT_RGB24, pCodecCtx-&gt;width,<font></font>
			      pCodecCtx-&gt;height);<font></font>
  buffer=(<span class="hljs-keyword">uint8_t</span> *)av_malloc(numBytes*<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">uint8_t</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// Assign appropriate parts of buffer to image planes in pFrameRGB</span>
  <span class="hljs-comment">// Note that pFrameRGB is an AVFrame, but AVFrame is a superset</span>
  <span class="hljs-comment">// of AVPicture</span><font></font>
  avpicture_fill((AVPicture *)pFrameRGB, buffer, PIX_FMT_RGB24,<font></font>
		 pCodecCtx-&gt;width, pCodecCtx-&gt;height);<font></font>
  <font></font>
  <span class="hljs-comment">// initialize SWS context for software scaling</span><font></font>
  sws_ctx = sws_getContext(pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   pCodecCtx-&gt;pix_fmt,<font></font>
			   pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   PIX_FMT_RGB24,<font></font>
			   SWS_BILINEAR,<font></font>
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span><font></font>
			   );<font></font>
<font></font>
  <span class="hljs-comment">// Read frames and save first five frames to disk</span>
  i=<span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span>(av_read_frame(pFormatCtx, &amp;packet)&gt;=<span class="hljs-number">0</span>) {
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet.stream_index==videoStream) {
      <span class="hljs-comment">// Decode video frame</span><font></font>
      avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet);<font></font>
      <font></font>
      <span class="hljs-comment">// Did we get a video frame?</span>
      <span class="hljs-keyword">if</span>(frameFinished) {
	<span class="hljs-comment">// Convert the image from its native format to RGB</span>
	sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
		  pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
		  pFrameRGB-&gt;data, pFrameRGB-&gt;linesize);<font></font>
	<font></font>
	<span class="hljs-comment">// Save the frame to disk</span>
	<span class="hljs-keyword">if</span>(++i&lt;=<span class="hljs-number">5</span>)<font></font>
	  SaveFrame(pFrameRGB, pCodecCtx-&gt;width, pCodecCtx-&gt;height, <font></font>
		    i);<font></font>
      }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// Free the packet that was allocated by av_read_frame</span><font></font>
    av_free_packet(&amp;packet);<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">// Free the RGB image</span><font></font>
  av_free(buffer);<font></font>
  av_frame_free(&amp;pFrameRGB);<font></font>
  <font></font>
  <span class="hljs-comment">// Free the YUV frame</span><font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <font></font>
  <span class="hljs-comment">// Close the codecs</span><font></font>
  avcodec_close(pCodecCtx);<font></font>
  avcodec_close(pCodecCtxOrig);<font></font>
<font></font>
  <span class="hljs-comment">// Close the video file</span><font></font>
  avformat_close_input(&amp;pFormatCtx);<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑุฉ ุนุงูุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชูู ูููุงุช ุงูุฃููุงู ุนูู ุงูุนุฏูุฏ ูู ุงูููููุงุช ุงูุฑุฆูุณูุฉ. ุฃููุงู ุ ูุณูู ุงูููู ููุณู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุงููุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููุญุฏุฏ ููุน ุงูุญุงููุฉ ููููุฉ ุชูุซูู ุงูุจูุงูุงุช ูู ุงูููู. ุฃูุซูุฉ ุงูุญุงููุงุช ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quicktime</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุนูุงูุฉ ุนูู ุฐูู ุ ููุงู ุงูุนุฏูุฏ ูู ุณูุงุณู ุงููุญุงุฏุซุงุช ูู ุงูููู ุ ุนูู ูุฌู ุงูุฎุตูุตุ ุนุงุฏุฉ ูุง ูููู ููุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏูู ุงูุตูุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏูู ุงูููุฏูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ("ุฏูู" ูู ูููุฉ ูุถุญูุฉ ูู "ุณูุณูุฉ ูู ุนูุงุตุฑ ุงูุจูุงูุงุช ุงููุชุงุญุฉ ููููุง ูููุฎุทุท ุงูุฒููู.") ุชุณูู ุนูุงุตุฑ ุงูุจูุงูุงุช ูู ุฏูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุทุงุฑุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุชู ุชุฑููุฒ ูู ุฏูู ุจูุงุณุทุฉ ููุน ูุงุญุฏ ุฃู ุขุฎุฑ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑูุงูุฌ ุงูุชุฑููุฒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุญุฏุฏ ุจุฑูุงูุฌ ุงูุชุฑููุฒ ููููุฉ ุงูุจูุงูุงุช ุงููุนููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diruyutsya </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏูุณูุจุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุงุฌุนุฉ - ููู ููุง ุฌุงุก ุงุณู ุจุฑูุงูุฌ ุงูุชุฑููุฒ. </font><font style="vertical-align: inherit;">ุฃูุซูุฉ ุจุฑุงูุฌ ุงูุชุฑููุฒ ูู DivX ู MP3. </font><font style="vertical-align: inherit;">ุซู ุชุชู ูุฑุงุกุฉ ุงูุญุฒู ูู ุงูุฏูู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุฒู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนุจุงุฑุฉ ุนู ุฃุฌุฒุงุก ูู ุงูุจูุงูุงุช ุงูุชู ูููู ุฃู ุชุญุชูู ุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฌุฒุงุก ูู ุงูุจูุงูุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชู ุชู ูู ุชุดููุฑูุง ูู ุฅุทุงุฑุงุช ุฎุงู ุ ูุงูุชู ูููููุง ูุนุงูุฌุชูุง ุฃุฎูุฑูุง ูู ุชุทุจูููุง. </font><font style="vertical-align: inherit;">ูุฃุบุฑุงุถูุง ุ ุชุญุชูู ูู ุญุฒูุฉ ุนูู ุฅุทุงุฑุงุช ูุงููุฉ (ุฃู ุนุฏุฉ ุฅุทุงุฑุงุช ุฅุฐุง ูุงูุช ุตูุชูุฉ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุนูู ูุน ุชุฏููุงุช ุงูููุฏูู ูุงูุตูุช ุจุณูุท ููุบุงูุฉ ุญุชู ุนูู ุงููุณุชูู ุงูุฃุณุงุณู:</font></font><br>
<br>
<pre><code class="vbscript hljs"><span class="hljs-number">10</span> OPEN video_stream FROM video.avi
<span class="hljs-number">20</span> READ packet FROM video_stream INTO frame
<span class="hljs-number">30</span> <span class="hljs-keyword">IF</span> frame <span class="hljs-keyword">NOT</span> COMPLETE <span class="hljs-keyword">GOTO</span> <span class="hljs-number">20</span>
<span class="hljs-number">40</span> <span class="hljs-keyword">DO</span> SOMETHING <span class="hljs-keyword">WITH</span> frame
<span class="hljs-number">50</span> <span class="hljs-keyword">GOTO</span> <span class="hljs-number">20</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนุฏ ุงูุนูู ูุน ุงููุณุงุฆุท ุงููุชุนุฏุฏุฉ ุจุงุณุชุฎุฏุงู FFmpeg ุฃูุฑูุง ุจุณูุทูุง ููุบุงูุฉ ููุง ูู ุงูุญุงู ูู ูุฐุง ุงูุจุฑูุงูุฌ ุ ุนูู ุงูุฑุบู ูู ุฃู ุฎุทูุฉ "MAKE [...]" ูู ุจุนุถ ุงูุจุฑุงูุฌ ูููู ุฃู ุชููู ุตุนุจุฉ ููุบุงูุฉ. </font><font style="vertical-align: inherit;">ูู ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุ ุณููุชุญ ุงูููู ููุญุณุจ ุฏูู ุงูููุฏูู ุจุฏุงุฎูู ุ ูุณูููู "MAKE [...]" ุจูุชุงุจุฉ ุงูุฅุทุงุฑ ุฅูู ููู PPM.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญ ุงูููู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ููุจู ูู ุดูุก ุ ุฏุนูุง ูุฑู ูุง ูุญุฏุซ ุฃููุงู ุนูุฏ ูุชุญ ุงูููู. </font><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู FFmpeg ุ ูููู ุฃููุงู ุจุชููุฆุฉ ุงูููุชุจุฉ ุงููุทููุจุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ffmpeg/swscale.h&gt;</span></span><font></font>
...<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, charg *argv[])</span> </span>{<font></font>
av_register_all();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณุฌู ูุฐุง ุฌููุน ุชูุณููุงุช ุงููููุงุช ูุจุฑุงูุฌ ุงูุชุฑููุฒ ุงููุชุงุญุฉ ูู ุงูููุชุจุฉ ุ ูุฐูู ุณูุชู ุงุณุชุฎุฏุงููุง ุชููุงุฆููุง ุนูุฏ ูุชุญ ููู ุจุงูุชูุณูู / ุจุฑูุงูุฌ ุงูุชุฑููุฒ ุงูููุงุณุจ. </font><font style="vertical-align: inherit;">ูุงุญุธ ุฃูู ุชุญุชุงุฌ ุฅูู ุงูุงุชุตุงู ุจู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_register_all</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ูุฐูู ูููู ุจุฐูู ููุง ุจุดูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุฆูุณู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู ุ ููููู ุชุณุฌูู ุชูุณููุงุช ุงููููุงุช ูุจุฑุงูุฌ ุงูุชุฑููุฒ ุงูุงูุชูุงุฆูุฉ ููุท ุ ูููู ุนุงุฏุฉู ูุง ููุฌุฏ ุณุจุจ ูุญุฏุฏ ููููุงู ุจุฐูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชุญ ุงูููู ุงูุขู:</font></font><br>
<br>
<pre><code class="cpp hljs">AVFormatContext *pFormatCtx = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
<span class="hljs-comment">// Open video file</span>
<span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, argv[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุญุตู ุนูู ุงุณู ุงูููู ูู ุงููุณูุทุฉ ุงูุฃููู. </font><font style="vertical-align: inherit;">ุชููู ูุฐู ุงููุธููุฉ ุจูุฑุงุกุฉ ุฑุฃุณ ุงูููู ูุชุฎุฒูู ูุนูููุงุช ุชูุณูู ุงูููู ูู ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFormatContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชู ูุฑุฑูุง ุจูุง. </font><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงู ุงููุณูุทุงุช ุงูุซูุงุซุฉ ุงูุฃุฎูุฑุฉ ูุชุญุฏูุฏ ุชูุณูู ุงูููู ูุญุฌู ุงููุฎุฒู ุงููุคูุช ููุนููุงุช ุงูุชูุณูู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุถุจุทูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู NULL ุฃู 0 ุ </font><font style="vertical-align: inherit;">ููุชุดู </font><b><font style="vertical-align: inherit;">libavformat</font></b><font style="vertical-align: inherit;"> ูู ุดูุก ุชููุงุฆููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชูุธุฑ ูุฐู ุงููุธููุฉ ููุท ูู ุงูุฑุฃุณ ุ ูุฐุง ูุญุชุงุฌ ุงูุขู ุฅูู ุงูุชุญูู ูู ูุนูููุงุช ุงูุชุฏูู ูู ุงูููู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Retrieve stream information</span>
<span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชููู ูุฐู ุงููุธููุฉ ุจุชูุฑูุฑ </font><font style="vertical-align: inherit;">ุจูุงูุงุช ุตุงูุญุฉ </font><font style="vertical-align: inherit;">ุฅูู </font><b><font style="vertical-align: inherit;">ุชูุงุฑุงุช </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFormatCtx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt; </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุชุนุฑู ุนูู ูุธููุฉ ุชุตุญูุญ ุฃุฎุทุงุก ููุงุณุจุฉ ุ ุชูุถุญ ููุง ูุง ุจุฏุงุฎููุง:</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Dump information about file onto standard error</span>
av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, argv[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู </font><b><font style="vertical-align: inherit;">ุชูุงุฑุงุช </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFormatCtx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt; </font><font style="vertical-align: inherit;">ูู ูุฌุฑุฏ ูุฌููุนุฉ ูู ูุคุดุฑุงุช ุญุฌู </font><b><font style="vertical-align: inherit;">pFormatCtx</font></b><font style="vertical-align: inherit;"> -&gt; </font><b><font style="vertical-align: inherit;">nb_streams</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุณูุณุชูุฑ ูู ุฐูู ุญุชู ูุฌุฏ ุฏูู ุงูููุฏูู:</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> i;<font></font>
AVCodecContext *pCodecCtxOrig = <span class="hljs-literal">NULL</span>;<font></font>
AVCodecContext *pCodecCtx = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
<span class="hljs-comment">// Find the first video stream</span>
videoStream=<span class="hljs-number">-1</span>;
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++)
  <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO) {<font></font>
    videoStream=i;<font></font>
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
<span class="hljs-keyword">if</span>(videoStream==<span class="hljs-number">-1</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Didn't find a video stream</span><font></font>
<font></font>
<span class="hljs-comment">// Get a pointer to the codec context for the video stream</span>
pCodecCtx=pFormatCtx-&gt;streams[videoStream]-&gt;codec;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชูุฌุฏ ูุนูููุงุช ุญูู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ูู ุงูุฏูู ูู ููุงู ูุณูู " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุงู ุจุฑูุงูุฌ ุงูุชุฑููุฒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">ูุญุชูู ุนูู ุฌููุน ุงููุนูููุงุช ุญูู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ุงูุฐู ูุณุชุฎุฏูู ุงูุฏูู ุ ููุฏููุง ุงูุขู ูุคุดุฑ ุนููู. </font><font style="vertical-align: inherit;">ูููู ูุง ูุฒุงู ูุชุนูู ุนูููุง ุงูุนุซูุฑ ุนูู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ุงูุญูููู ููุชุญู:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodec *pCodec = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
<span class="hljs-comment">// Find the decoder for the video stream</span><font></font>
pCodec=avcodec_find_decoder(pCodecCtx-&gt;codec_id);<font></font>
<span class="hljs-keyword">if</span>(pCodec==<span class="hljs-literal">NULL</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Codec not found</span><font></font>
}<font></font>
<span class="hljs-comment">// Copy context</span><font></font>
pCodecCtx = avcodec_alloc_context3(pCodec);<font></font>
<span class="hljs-keyword">if</span>(avcodec_copy_context(pCodecCtx, pCodecCtxOrig) != <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
}<font></font>
<span class="hljs-comment">// Open codec</span>
<span class="hljs-keyword">if</span>(avcodec_open2(pCodecCtx, pCodec)&lt;<span class="hljs-number">0</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Could not open codec</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฌู ููุงุญุธุฉ ุฃูู ูุง ููููู ุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุจุงุดุฑุฉ </font><font style="vertical-align: inherit;">ูู ุฏูู ุงูููุฏูู! </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vcodec_copy_context</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ููุณุฎ ุงูุณูุงู ุฅูู ูููุน ุฌุฏูุฏ (ุจุงูุทุจุน ุ ุจุนุฏ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ูู).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุฒู ุงูุจูุงูุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ููุงู ูุชุฎุฒูู ุงูุฅุทุงุฑ:</font></font><br>
<br>
<pre><code class="cpp hljs">AVFrame *pFrame = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
<span class="hljs-comment">// Allocate video frame</span>
pFrame=av_frame_alloc();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃููุง ูุฎุทุท ูุฅุฎุฑุงุฌ ูููุงุช PPM ุงููุฎุฒูุฉ ูู RGB 24 ุจุช ุ ูุณูุญุชุงุฌ ุฅูู ุชุญููู ุฅุทุงุฑูุง ูู ุชูุณููู ุฅูู RGB. </font><font style="vertical-align: inherit;">ุณูู ุชูุนู FFmpeg ููุง. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุนุธู ุงููุดุงุฑูุน (ุจูุง ูู ุฐูู ูุฐุง ุงููุดุฑูุน) ุ ุชุญุชุงุฌ ุฅูู ุชุญููู ุฅุทุงุฑ ุงูุจุฏุก ุฅูู ุชูุณูู ูุนูู. </font><font style="vertical-align: inherit;">ุญุฏุฏ ุฅุทุงุฑูุง ููุฅุทุงุฑ ุงููุญูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Allocate an AVFrame structure</span><font></font>
pFrameRGB=av_frame_alloc();<font></font>
<span class="hljs-keyword">if</span>(pFrameRGB==<span class="hljs-literal">NULL</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ุฃููุง ุงุฎุชุฑูุง ุงูุฅุทุงุฑ ุ ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ููุงู ูุงุณุชูุนุงุจ ุงูุจูุงูุงุช ุงูุฃูููุฉ ุนูุฏ ุชุญูููู. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avpicture_get_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุญุตูู ุนูู ุงูุฃุญุฌุงู ุงูููุงุณุจุฉ ูุชุฎุตูุต ุงููุณุงุญุฉ ุงููุงุฒูุฉ ูุฏูููุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">uint8_t</span> *buffer = <span class="hljs-literal">NULL</span>;
<span class="hljs-keyword">int</span> numBytes;
<span class="hljs-comment">// Determine required buffer size and allocate buffer</span><font></font>
numBytes=avpicture_get_size(PIX_FMT_RGB24, pCodecCtx-&gt;width,<font></font>
                            pCodecCtx-&gt;height);<font></font>
buffer=(<span class="hljs-keyword">uint8_t</span> *)av_malloc(numBytes*<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">uint8_t</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_malloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font><b><font style="vertical-align: inherit;">ูุธูุฑ</font></b><font style="vertical-align: inherit;"> ูู C-function </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู FFmpeg ุ ููู ุนุจุงุฑุฉ ุนู ุบูุงู ุจุณูุท ุญูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููุฑ ูุญุงุฐุงุฉ ูุนูุงููู ุงูุฐุงูุฑุฉ ุ ุฅูุฎ. </font><font style="vertical-align: inherit;">ุจุงูููุงุณุจุฉ ุ ูุฐุง ูุง ูุญูู ุถุฏ ุชุณุฑุจ ุงูุฐุงูุฑุฉ ุฃู ุงูุชุญุฑูุฑ ุงููุฒุฏูุฌ ุฃู ุงููุดุงูู ุงูุฃุฎุฑู ุงูุชู ุชุญุฏุซ ูุน </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณุชุฎุฏู ุงูุขู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avpicture_fill</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑุจุท ุงูุฅุทุงุฑ </font><b><font style="vertical-align: inherit;">ุจุงููุฎุฒู</font></b><font style="vertical-align: inherit;"> ุงููุคูุช ุงููุฎุตุต ุญุฏูุซูุง. </font><font style="vertical-align: inherit;">ูููุง ูุชุนูู ุจู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุฌููุนุฉ ูุฑุนูุฉ ูู ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุจุฏุงูุฉ ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุงุซูุฉ ูุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Assign appropriate parts of buffer to image planes in pFrameRGB</span>
<span class="hljs-comment">// Note that pFrameRGB is an AVFrame, but AVFrame is a superset</span>
<span class="hljs-comment">// of AVPicture</span><font></font>
avpicture_fill((AVPicture *)pFrameRGB, buffer, PIX_FMT_RGB24,<font></font>
                pCodecCtx-&gt;width, pCodecCtx-&gt;height);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญู ุจุงููุนู ุนูู ุฎุท ุงูููุงูุฉ! </font><font style="vertical-align: inherit;">ุงูุขู ูุญู ูุณุชุนุฏูู ูููุฑุงุกุฉ ูู ุงูุฏูู!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุงุกุฉ ุงูุจูุงูุงุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ููุฑุงุกุฉ ุฏูู ุงูููุฏูู ุจุฃูููู ุ ููุฑุฃ ุงูุญุฒูุฉ ุงูุชุงููุฉ ุ ูููู ุชุดููุฑูุง ูู ุฅุทุงุฑูุง ุ ูุจูุฌุฑุฏ ุงูุชูุงู ูู ุงูุชุดููุฑ ุ ูู ุจุชุญููู ุงูุฅุทุงุฑ ูุญูุธู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span> = <span class="hljs-title">NULL</span>;</span>
<span class="hljs-keyword">int</span> frameFinished;<font></font>
AVPacket packet;<font></font>
<span class="hljs-comment">// initialize SWS context for software scaling</span><font></font>
sws_ctx = sws_getContext(pCodecCtx-&gt;width,<font></font>
    pCodecCtx-&gt;height,<font></font>
    pCodecCtx-&gt;pix_fmt,<font></font>
    pCodecCtx-&gt;width,<font></font>
    pCodecCtx-&gt;height,<font></font>
    PIX_FMT_RGB24,<font></font>
    SWS_BILINEAR,<font></font>
    <span class="hljs-literal">NULL</span>,
    <span class="hljs-literal">NULL</span>,
    <span class="hljs-literal">NULL</span><font></font>
    );<font></font>
<font></font>
i=<span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span>(av_read_frame(pFormatCtx, &amp;packet)&gt;=<span class="hljs-number">0</span>) {
  <span class="hljs-comment">// Is this a packet from the video stream?</span>
  <span class="hljs-keyword">if</span>(packet.stream_index==videoStream) {
	<span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet);<font></font>
    <font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {
    <span class="hljs-comment">// Convert the image from its native format to RGB</span>
        sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
		  pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
		  pFrameRGB-&gt;data, pFrameRGB-&gt;linesize);<font></font>
	<font></font>
        <span class="hljs-comment">// Save the frame to disk</span>
        <span class="hljs-keyword">if</span>(++i&lt;=<span class="hljs-number">5</span>)<font></font>
          SaveFrame(pFrameRGB, pCodecCtx-&gt;width, <font></font>
                    pCodecCtx-&gt;height, i);<font></font>
    }<font></font>
  }<font></font>
    <font></font>
  <span class="hljs-comment">// Free the packet that was allocated by av_read_frame</span><font></font>
  av_free_packet(&amp;packet);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุดูุก ูุนูุฏ: </font><font style="vertical-align: inherit;">ููุฑุฃ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_read_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุงูุญุฒูุฉ ููุญูุธูุง ูู ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูููู ููุท ุจุชูุฒูุน ุจููุฉ ุงูุญุฒูุฉ - ุญูุซ ุชุฒูุฏูุง FFmpeg ุจุงูุจูุงูุงุช ุงูุฏุงุฎููุฉ ุงูุชู ุชุดูุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูููุง packet.data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุคุฏู ูุฐุง ุฅูู ุชุญุฑูุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_free_packet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุจูููู </font><font style="vertical-align: inherit;">. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู avcodec_decode_video</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุชุญููู ุงูุญุฒูุฉ ุฅูู ุฅุทุงุฑ. ููุน ุฐูู ุ ูุฏ ูุง ุชุชููุฑ ูุฏููุง ุฌููุน ุงููุนูููุงุช ุงูุชู ูุญุชุงุฌูุง ููุฅุทุงุฑ ุจุนุฏ ูู ุชุดููุฑ ุงูุญุฒูุฉ ุ ูุจุงูุชุงูู ูุฅู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_decode_video</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frameFinished</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูุฏูุง ูููู ูุฏููุง ุงูุฅุทุงุฑ ุงูุชุงูู. ุฃุฎูุฑูุง ุ ูุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sws_scale</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ููุชุญููู ูู </font><nobr><b><font style="vertical-align: inherit;">ุชูุณูููุง</font></b></nobr><font style="vertical-align: inherit;"> ุงูุฎุงุต ( </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pCodecCtx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt;</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pix_fmt</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ูู RGB. ุชุฐูุฑ ุฃูู ููููู</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฑุณุงู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุคุดุฑ</font><b><font style="vertical-align: inherit;"> AVFrame</font></b><font style="vertical-align: inherit;"> ุฅูู ูุคุดุฑ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AVPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฃุฎูุฑูุง ุ ูููู ุจุชูุฑูุฑ ุงููุนูููุงุช ุญูู ุงูุฅุทุงุฑ ูุงูุงุฑุชูุงุน ูุงูุนุฑุถ ููุธููุฉ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SaveFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุญุฏุซ ุนู ุงูุญุฒู. ูู ุงููุงุญูุฉ ุงููููุฉ ุ ูููู ุฃู ุชุญุชูู ุงูุญุฒูุฉ ุนูู ุฌุฒุก ููุท ูู ุงูุฅุทุงุฑ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุจุชุงุช ุงูุจูุงูุงุช ุงูุฃุฎุฑู. ููุน ุฐูู ุ ูุถูู ูุญูู FFmpeg ุฃู ุงูุญุฒู ุงูุชู ูุชููุงูุง ุชุญุชูู ุฅูุง ุนูู ุฅุทุงุฑ ูุงูู ุฃู ุญุชู ุนุฏุฉ ุฅุทุงุฑุงุช.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูู ูุง ุชุจูู ุงูููุงู ุจู ูู ุงุณุชุฎุฏุงู ูุธููุฉ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SaveFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุชุงุจุฉ ูุนูููุงุช RGB ุฅูู ููู PPM. ุนูู ุงูุฑุบู ูู ุฃููุง ูุชุนุงูู ุจุดูู ุณุทุญู ูุน ุชูุณูู PPM ููุณู ุ ุตุฏูููู ุ ูู ุดูุก ูุนูู ููุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SaveFrame</span><span class="hljs-params">(AVFrame *pFrame, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">int</span> iFrame)</span> </span>{<font></font>
  FILE *pFile;<font></font>
  <span class="hljs-keyword">char</span> szFilename[<span class="hljs-number">32</span>];
  <span class="hljs-keyword">int</span>  y;<font></font>
  <font></font>
  <span class="hljs-comment">// Open file</span>
  <span class="hljs-built_in">sprintf</span>(szFilename, <span class="hljs-string">"frame%d.ppm"</span>, iFrame);<font></font>
  pFile=fopen(szFilename, <span class="hljs-string">"wb"</span>);
  <span class="hljs-keyword">if</span>(pFile==<span class="hljs-literal">NULL</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  <font></font>
  <span class="hljs-comment">// Write header</span>
  <span class="hljs-built_in">fprintf</span>(pFile, <span class="hljs-string">"P6\n%d %d\n255\n"</span>, width, height);<font></font>
  <font></font>
  <span class="hljs-comment">// Write pixel data</span>
  <span class="hljs-keyword">for</span>(y=<span class="hljs-number">0</span>; y&lt;height; y++)<font></font>
    fwrite(pFrame-&gt;data[<span class="hljs-number">0</span>]+y*pFrame-&gt;linesize[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, width*<span class="hljs-number">3</span>, pFile);<font></font>
  <font></font>
  <span class="hljs-comment">// Close file</span><font></font>
  fclose(pFile);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุจุชูููุฐ ููู ููุงุณู ููุชูุญ ุ ููุง ุฅูู ุฐูู ุ ุซู ูุณุฌู ุจูุงูุงุช RGB. ุงูููู ููุชูุจ ุณุทุฑุง. ููู PPM ูู ุจุจุณุงุทุฉ ููู ูุชู ููู ุชูุฏูู ูุนูููุงุช RGB ูุฎุท ุทููู. ุฅุฐุง ููุช ุชุนุฑู ุฃููุงู HTML ุ ูุณูููู ุงูุฃูุฑ ูุซู ูุถุน ุนูุงูุฉ ุนูู ุฃููุงู ูู ุจูุณู ูู ุงูููุงูุฉ ุงูุฃููู ุฅูู ุงูููุงูุฉ ุ ูุซู </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># ff0000 # ff0000 ....</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุซู ุดุงุดุฉ ุญูุฑุงุก. (ูู ุงููุงูุน ุ ูุชู ุชุฎุฒูููุง ุจุชูุณูู ุซูุงุฆู ูุจุฏูู ูุงุตู ุ ูููู ุขูู ุฃู ุชููู ูุฏ ุงุณุชูุนุจุช ุงูููุฑุฉ.) ูุดูุฑ ุงูุนููุงู ุฅูู ูุฏู ุงุชุณุงุน ุงูุตูุฑุฉ ูุงุฑุชูุงุนูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุญุฌู ุงูุฃูุตู ูููู RGB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุนุฏ ุฅูู ูุธููุชูุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฑุฆูุณูุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). ุจูุฌุฑุฏ ุงูุงูุชูุงุก ูู ุงููุฑุงุกุฉ ูู ุฏูู ุงูููุฏูู ุ ูุญุชุงุฌ ููุท ููุณุญ ูู ุดูุก:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Free the RGB image</span><font></font>
av_free(buffer);<font></font>
av_free(pFrameRGB);<font></font>
<font></font>
<span class="hljs-comment">// Free the YUV frame</span><font></font>
av_free(pFrame);<font></font>
<font></font>
<span class="hljs-comment">// Close the codecs</span><font></font>
avcodec_close(pCodecCtx);<font></font>
avcodec_close(pCodecCtxOrig);<font></font>
<font></font>
<span class="hljs-comment">// Close the video file</span><font></font>
avformat_close_input(&amp;pFormatCtx);<font></font>
<font></font>
<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุชุฑู ุ ูุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_free</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฐุงูุฑุฉ ุงููุฎุตุตุฉ ุจุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcode_alloc_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_malloc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ุฑูุฒ! </font><font style="vertical-align: inherit;">ุงูุขู ุ ุฅุฐุง ููุช ุชุณุชุฎุฏู Linux ุฃู ููุตุฉ ูุดุงุจูุฉ ุ ููู ุจุชุดุบูู:</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial01 tutorial01.c -lavutil -lavformat -lavcodec -lz -lavutil -lm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงู ูุฏูู ุฅุตุฏุงุฑ ูุฏูู ูู FFmpeg ุ ููุฏ ุชุญุชุงุฌ ุฅูู ุฅุฒุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-lavutil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial01 tutorial01.c -lavformat -lavcodec -lz -lm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุฃู ุชูุชุญ ูุนุธู ุจุฑุงูุฌ ุงูุฑุณููุงุช ุชูุณูู PPM. </font><font style="vertical-align: inherit;">ุชุญูู ูู ุจุนุถ ูููุงุช ุงูุฃููุงู ุงูุชู ุชู ุนูู ููุทุงุช ุงูุดุงุดุฉ ุจุงุณุชุฎุฏุงู ุจุฑูุงูุฌูุง.</font></font><a name="outputting"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 2: ุนุฑุถ ุงูุดุงุดุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 1: ุฅูุดุงุก ููุทุงุช ุดุงุดุฉ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 3: ุชุดุบูู ุงูุตูุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุฉ ุงููุงููุฉ: tutorial02.c</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial02.c</span>
<span class="hljs-comment">// A pedagogical video player that will stream through every video frame as fast as it can.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// gcc -o tutorial02 tutorial02.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial02 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the video stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
  AVFormatContext *pFormatCtx = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">int</span>             i, videoStream;<font></font>
  AVCodecContext  *pCodecCtxOrig = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodecContext  *pCodecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec         *pCodec = <span class="hljs-literal">NULL</span>;<font></font>
  AVFrame         *pFrame = <span class="hljs-literal">NULL</span>;<font></font>
  AVPacket        packet;<font></font>
  <span class="hljs-keyword">int</span>             frameFinished;
  <span class="hljs-keyword">float</span>           aspect_ratio;
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span> = <span class="hljs-title">NULL</span>;</span><font></font>
<font></font>
  SDL_Overlay     *bmp;<font></font>
  SDL_Surface     *screen;<font></font>
  SDL_Rect        rect;<font></font>
  SDL_Event       event;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, argv[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, argv[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span>
  videoStream=<span class="hljs-number">-1</span>;
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++)
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO) {<font></font>
      videoStream=i;<font></font>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  <span class="hljs-keyword">if</span>(videoStream==<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Didn't find a video stream</span><font></font>
  <font></font>
  <span class="hljs-comment">// Get a pointer to the codec context for the video stream</span><font></font>
  pCodecCtxOrig=pFormatCtx-&gt;streams[videoStream]-&gt;codec;<font></font>
  <span class="hljs-comment">// Find the decoder for the video stream</span><font></font>
  pCodec=avcodec_find_decoder(pCodecCtxOrig-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(pCodec==<span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Codec not found</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Copy context</span><font></font>
  pCodecCtx = avcodec_alloc_context3(pCodec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(pCodecCtx, pCodecCtxOrig) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Open codec</span>
  <span class="hljs-keyword">if</span>(avcodec_open2(pCodecCtx, pCodec, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Could not open codec</span><font></font>
  <font></font>
  <span class="hljs-comment">// Allocate video frame</span><font></font>
  pFrame=av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(pCodecCtx-&gt;width, pCodecCtx-&gt;height, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(pCodecCtx-&gt;width, pCodecCtx-&gt;height, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  bmp = SDL_CreateYUVOverlay(pCodecCtx-&gt;width,<font></font>
				 pCodecCtx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
<font></font>
  <span class="hljs-comment">// initialize SWS context for software scaling</span><font></font>
  sws_ctx = sws_getContext(pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   pCodecCtx-&gt;pix_fmt,<font></font>
			   pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   PIX_FMT_YUV420P,<font></font>
			   SWS_BILINEAR,<font></font>
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span><font></font>
			   );<font></font>
<font></font>
<font></font>
<font></font>
  <span class="hljs-comment">// Read frames and save first five frames to disk</span>
  i=<span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span>(av_read_frame(pFormatCtx, &amp;packet)&gt;=<span class="hljs-number">0</span>) {
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet.stream_index==videoStream) {
      <span class="hljs-comment">// Decode video frame</span><font></font>
      avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet);<font></font>
      <font></font>
      <span class="hljs-comment">// Did we get a video frame?</span>
      <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
	SDL_LockYUVOverlay(bmp);<font></font>
<font></font>
	AVPicture pict;<font></font>
	pict.data[<span class="hljs-number">0</span>] = bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
	pict.data[<span class="hljs-number">1</span>] = bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
	pict.data[<span class="hljs-number">2</span>] = bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
<font></font>
	pict.linesize[<span class="hljs-number">0</span>] = bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
	pict.linesize[<span class="hljs-number">1</span>] = bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
	pict.linesize[<span class="hljs-number">2</span>] = bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
<font></font>
	<span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
	sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
		  pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
		  pict.data, pict.linesize);<font></font>
<font></font>
	SDL_UnlockYUVOverlay(bmp);<font></font>
	<font></font>
	rect.x = <span class="hljs-number">0</span>;<font></font>
	rect.y = <span class="hljs-number">0</span>;<font></font>
	rect.w = pCodecCtx-&gt;width;<font></font>
	rect.h = pCodecCtx-&gt;height;<font></font>
	SDL_DisplayYUVOverlay(bmp, &amp;rect);<font></font>
      <font></font>
      }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-comment">// Free the packet that was allocated by av_read_frame</span><font></font>
    av_free_packet(&amp;packet);<font></font>
    SDL_PollEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">// Free the YUV frame</span><font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <font></font>
  <span class="hljs-comment">// Close the codec</span><font></font>
  avcodec_close(pCodecCtx);<font></font>
  avcodec_close(pCodecCtxOrig);<font></font>
  <font></font>
  <span class="hljs-comment">// Close the video file</span><font></font>
  avformat_close_input(&amp;pFormatCtx);<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL ูุงูููุฏูู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฑุณู ุนูู ุงูุดุงุดุฉ ุณูุณุชุฎุฏู SDL. SDL ุชุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุจูุฉ ูุจุงุดุฑุฉ ุจุณูุทุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฅููุง ููุชุจุฉ ููุชุงุฒุฉ ูุชุนุฏุฏุฉ ุงููุณุงุฆุท ุนุจุฑ ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ุชุณุชุฎุฏู ูู ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน. ููููู ุงูุญุตูู ุนูู ุงูููุชุจุฉ ุนูู ุงููููุน ุงูุฑุณูู ุฃู ุชูุฒูู ุญุฒูุฉ ุงููุทูุฑ ููุธุงู ุงูุชุดุบูู ุงูุฎุงุต ุจู ุ ุฅู ูุฌุฏ. ุณุชุญุชุงุฌ ุฅูู ููุชุจุงุช ูุชุฌููุน ุงูููุฏ ูู ูุฐุง ุงูุฏุฑุณ (ุฌููุน ุงูุฏุฑูุณ ุงูุฃุฎุฑู ุ ุจุงูููุงุณุจุฉ ุ ูุฐุง ููุทุจู ุฃูุถูุง). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฏู SDL ุงูุนุฏูุฏ ูู ุงูุทุฑู ููุฑุณู ุนูู ุงูุดุงุดุฉ. ุฅุญุฏู ุงูุทุฑู ูุนุฑุถ ุงูุฃููุงู ูู ูุง ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุชุฑุงูุจ YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุณููุง ุ ููุง ุญุชู YUV ุ ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YCbCr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุจุนุถ ุงููุงุณ ุ ุจุงูููุงุณุจุฉ ุ ูุตุงุจูู ุจุญุฑูู ุดุฏูุฏุฉ ุนูุฏูุง ูุทูู ุนูู "YCbCr" ุงุณู "YUV". ุจุดูู ุนุงู ุ YUV ูู ุชูุณูู ุชูุซููู ุ ู YCbCr ูู ุชูุณูู ุฑููู. ูุนูู FFmpeg ู SDL ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููุญุฏุงุช ุงููุงูุฑู YCbCr ูู YUV ุ ูููู ูุฐุง ูู. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุทุฑููุฉ ูุชุฎุฒูู ุจูุงูุงุช ุงูุตูุฑุฉ ุงูุฃูููุฉ ูุซู RGB. ุจุดูู ุชูุฑูุจู ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูููู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณุทูุน</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููููุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (ูุฐุง ุฃูุซุฑ ุชุนููุฏูุง ูู RGB ูุฃูู ูุชู ุชุฌุงูู ุฌุฒุก ูู ูุนูููุงุช ุงูููู ุ ูููููู ุงูุญุตูู ุนูู ููุงุณ ูุงุญุฏ ููุท ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ููุงุณูู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุงูุจ YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู SDL ููุจู ูุฌููุนุฉ ุจูุงูุงุช YUV ุงูุฎุงู ููุนุฑุถูุง. ููุจู 4 ุฃููุงุน ูุฎุชููุฉ ูู ุชูุณููุงุช YUV ุ ููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YV12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูุฃุณุฑุน ูููุง. ููุฌุฏ ุชูุณูู YUV ุขุฎุฑ ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV420P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุทุงุจู ูุน YV12 ุ ุจุงุณุชุซูุงุก ุฃูู </font><font style="vertical-align: inherit;">ูุชู ุชุจุฏูู </font><font style="vertical-align: inherit;">ุตูุงุฆู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 420 ูุนูู ุฃูู ุชู ุฃุฎุฐ ุนููุงุช ููู ุจูุณุจุฉ 4: 2: 0 ุ ุฃู ุฃูู ููู 4 ููุงุณุงุช ููุณุทูุน ููุงู ููุงุณ ููู ูุงุญุฏ ุ ูุฐูู ูุชู ุชูุฒูุน ูุนูููุงุช ุงูุฃููุงู ุนูู ุฃุฑุจุงุน. ูุฐู ุทุฑููุฉ ุฌูุฏุฉ ูุชูููุฑ ุนุฑุถ ุงููุทุงู ุงูุชุฑุฏุฏู ูุฃู ุงูุนูู ุงูุจุดุฑูุฉ ูุง ุชุฒุงู ูุง ุชูุงุญุธ ูุฐู ุงูุชุบููุฑุงุช. ูุดูุฑ ุงูุญุฑู ุงููุงุชููู "P" ูู ุงูุงุณู ุฅูู ุฃู ุงูุชูุณูู ูู "ูุณุชูู" ุ ููุง ูุนูู ุจุจุณุงุทุฉ ุฃู ุงูููููุงุช ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุตูุงุฆู ูููุตูุฉ. </font><font style="vertical-align: inherit;">ูููู ูู FFmpeg ุชุญููู ุงูุตูุฑ ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV420P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููู ุฃูุฑ ูููุฏ ููุบุงูุฉ ุ ูุฃู ุงูุนุฏูุฏ ูู ุชุฏููุงุช ุงูููุฏูู ูุฎุฒูุฉ ุจุงููุนู ุจูุฐุง ุงูุชูุณูู ุฃู ูุชู ุชุญููููุง ุจุณูููุฉ ุฅูููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจุงูุชุงูู ุ ูุฅู ุฎุทุชูุง ุงูุญุงููุฉ ูู ุงุณุชุจุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุงูุฉ SaveFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูู ุงูุฏุฑุณ ุงูุณุงุจู ูุนุฑุถ </font><b><font style="vertical-align: inherit;">ุฅุทุงุฑูุง</font></b><font style="vertical-align: inherit;"> ุจุฏูุงู ูู ุฐูู. </font><font style="vertical-align: inherit;">ูููู ุนููู ุฃููุงู ุงูุชุนุฑู ุนูู ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ ูููุชุจุฉ SDL. </font><font style="vertical-align: inherit;">ููุจุฏุก ุ ูู ุจุชูุตูู ุงูููุชุจุงุช ูุชููุฆุฉ SDL:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุจุฑ SDL_Init</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุงูููุชุจุฉ ุจุดูู ุฃุณุงุณู </font><b><font style="vertical-align: inherit;">ุจุงููุธุงุฆู ุงูุชู ุณูุณุชุฎุฏููุง</font></b><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_GetError</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ุจุงูุทุจุน ุ ูุฐู ูู </font><b><font style="vertical-align: inherit;">ูุธููุชูุง</font></b><font style="vertical-align: inherit;"> ุงูููุงุณุจุฉ ูุชุตุญูุญ ุงูุฃุฎุทุงุก.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ุงูุนุฑุถ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ููุงู ุนูู ุงูุดุงุดุฉ ูุชุฑุชูุจ ุงูุนูุงุตุฑ. </font><font style="vertical-align: inherit;">ุชุณูู ุงูููุทูุฉ ุงูุฑุฆูุณูุฉ ูุนุฑุถ ุงูุตูุฑ ุจุงุณุชุฎุฏุงู SDL </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณุทุญ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Surface *screen;<font></font>
<font></font>
screen = SDL_SetVideoMode(pCodecCtx-&gt;width, pCodecCtx-&gt;height, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span>(!screen) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ูููุง ุจุฅุนุฏุงุฏ ุดุงุดุฉ ุจุนุฑุถ ูุงุฑุชูุงุน ูุนูููู. </font><font style="vertical-align: inherit;">ุงูุฎูุงุฑ ุงูุชุงูู ูู ุนูู ุงูุจุช ููุดุงุดุฉ - 0 - ูุฐู ูููุฉ ุฎุงุตุฉ ุชุนูู "ููุณ ุงูุนุฑุถ ุงูุญุงูู". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูููู ุจุฅูุดุงุก </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุงูุจ YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ูุฐู ุงูุดุงุดุฉ ุญุชู ูุชููู ูู ุฅุฎุฑุงุฌ ุงูููุฏูู ุฅููู ุ ูุชูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWSContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฏููุง </font><font style="vertical-align: inherit;">ูุชุญููู ุจูุงูุงุช ุงูุตูุฑุฉ ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV420</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Overlay     *bmp = <span class="hljs-literal">NULL</span>;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SWSContext</span> *<span class="hljs-title">sws_ctx</span> = <span class="hljs-title">NULL</span>;</span><font></font>
<font></font>
bmp = SDL_CreateYUVOverlay(pCodecCtx-&gt;width, pCodecCtx-&gt;height,<font></font>
                           SDL_YV12_OVERLAY, screen);<font></font>
<font></font>
<span class="hljs-comment">// initialize SWS context for software scaling</span><font></font>
sws_ctx = sws_getContext(pCodecCtx-&gt;width,<font></font>
                         pCodecCtx-&gt;height,<font></font>
			 pCodecCtx-&gt;pix_fmt,<font></font>
			 pCodecCtx-&gt;width,<font></font>
			 pCodecCtx-&gt;height,<font></font>
			 PIX_FMT_YUV420P,<font></font>
			 SWS_BILINEAR,<font></font>
			 <span class="hljs-literal">NULL</span>,
			 <span class="hljs-literal">NULL</span>,
			 <span class="hljs-literal">NULL</span>
			 );</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุฐูุฑูุง ุ ูุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YV12</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนุฑุถ ุงูุตูุฑุฉ ูุงูุญุตูู ุนูู ุจูุงูุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV420</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู FFmpeg.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฑุถ ุงูุตูุฑ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุณูุง ุ ูุงู ุฐูู ุณููุง ุจูุง ููู ุงูููุงูุฉ! ุงูุขู ูุญู ุจุญุงุฌุฉ ููุท ูุฅุธูุงุฑ ุงูุตูุฑุฉ. ุฏุนูุง ูุฐูุจ ุนูู ุทูู ุงูุทุฑูู ุฅูู ุงูููุงู ุงูุฐู ุญุตููุง ุนูู ุงูููุทุฉ ุงูููุงุฆูุฉ. ูููููุง ุงูุชุฎูุต ูู ูู ุดูุก ูุฏููุง ูุฅุทุงุฑ RGB ูุณูููู ุจุงุณุชุจุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SaveFrame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุฑูุฒ ุงูุนุฑุถ ุงูุฎุงุต ุจูุง. ูุนุฑุถ ุงูุตูุฑุฉ ุ ุณูููู ุจุฅูุดุงุก ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุนููู ูุคุดุฑุงุช ุงูุจูุงูุงุช ูุญุฌู ุงูุฎุท ููุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฑุงูุจ YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฎุงุต ุจูุง </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
    SDL_LockYUVOverlay(bmp);<font></font>
<font></font>
    AVPicture pict;<font></font>
    pict.data[<span class="hljs-number">0</span>] = bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
<font></font>
    pict.linesize[<span class="hljs-number">0</span>] = bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
<font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(bmp);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุจุฏุงูุฉ ุ ูุญุธุฑ ุงูุชุฑุงูุจ ุ ูุฃููุง ูุฎุทุท ูููุชุงุจุฉ ุนููู. ูุฐู ุนุงุฏุฉ ุฌูุฏุฉ ุจุญูุซ ูุง ุชูุฌุฏ ูุดุงูู ูู ููุช ูุงุญู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุชูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจููุฉ </font><b><font style="vertical-align: inherit;">AVPicture</font></b><font style="vertical-align: inherit;"> ุ ููุง ูู ููุถุญ ุฃุนูุงู ุ ุนูู ูุคุดุฑ ุจูุงูุงุช ุ ููู ุนุจุงุฑุฉ ุนู ุตููู ูู 4 ูุคุดุฑุงุช. ูุธุฑูุง ูุฃููุง ูุชุนุงูู ููุง ูุน </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV420P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููุฏููุง 3 ูููุงุช ููุท ูุจุงูุชุงูู 3 ูุฌููุนุงุช ุจูุงูุงุช ููุท. ูุฏ ุชุญุชูู ุงูุชูุณููุงุช ุงูุฃุฎุฑู ุนูู ูุคุดุฑ ุฑุงุจุน ูููุงุฉ ุฃููุง ุฃู ุฃู ุดูุก ุขุฎุฑ. ุญุฌู ุงูุฎุท ูู ูุง ูุจุฏู. ุงูููุงูู ุงููุชุดุงุจูุฉ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุงูุจ YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุชุบูุฑุงุช ููุจูุณู ูุงูุงุฑุชูุงุนุงุช. (ูุบูุงุช ุ ูุบูุงุช - ุฅุฐุง ุชู ุงูุชุนุจูุฑ ุนููุง ูู ุญูุซ SDL ููุฅุดุงุฑุฉ ุฅูู ุนุฑุถ ุฎุท ุจูุงูุงุช ูุนูู.) ูุฐุง ุ ูุฅููุง ูุดูุฑ ุฅูู ุซูุงุซ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุงุฆู pict.data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ุงูุชุฑุงูุจ ูุฏููุง ุ ูุฐูู ุนูุฏูุง ููุชุจ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุตูุฑุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุญู ูุณุฌู ุจุงููุนู ูู ุชุฑุงูุจูุง ุ ูุงูุฐู ุจุงูุทุจุน ูุฏูู ุจุงููุนู ุงููุณุงุญุฉ ุงููุงุฒูุฉ ุงููุฎุตุตุฉ ูู ุนูู ูุฌู ุงูุชุญุฏูุฏ. </font><font style="vertical-align: inherit;">ุจููุณ ุงูุทุฑููุฉ ุ ูุญุตู ุนูู ูุนูููุงุช ุญุฌู ุงูุฎุท ูุจุงุดุฑุฉ ูู ุชุฑุงูุจูุง. </font><font style="vertical-align: inherit;">ูุบูุฑ ุชูุณูู ุงูุชุญููู ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIX_FMT_YUV420P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sws_scale</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุง ูุงู ูู ูุจู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุณู ุตูุฑุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููุง ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ุชุญุฏูุฏ SDL ุจุญูุซ ูุนุฑุถ ุญููุง ุงูุจูุงูุงุช ุงูุชู ูุฏููุงูุง ูู. </font><font style="vertical-align: inherit;">ูููู ุฃูุถูุง ุจุชูุฑูุฑ ูุณุชุทูู ุฅูู ูุฐู ุงููุธููุฉ ุ ููุง ูุดูุฑ ุฅูู ุงูููุงู ุงูุฐู ูุฌุจ ุฃู ูุฐูุจ ุฅููู ุงููููู ุ ุฅูู ุฃู ุนุฑุถ ูุงุฑุชูุงุน ูุฌุจ ุฃู ูุชู ุชุญุฌููู. </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูุฅู ูููุงุณ SDL ูุชุทูุฑ ุจุงููุณุจุฉ ููุง ุ ููุฐุง ูููู ุฃู ูุณุงุนุฏ GPU ุงูุฎุงุต ุจู ุนูู ุงูุชูุณุน ุจุดูู ุฃุณุฑุน:</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Rect rect;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(frameFinished) {
    <span class="hljs-comment">/* ... code ... */</span>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
              pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(bmp);<font></font>
	rect.x = <span class="hljs-number">0</span>;<font></font>
	rect.y = <span class="hljs-number">0</span>;<font></font>
	rect.w = pCodecCtx-&gt;width;<font></font>
	rect.h = pCodecCtx-&gt;height;<font></font>
	SDL_DisplayYUVOverlay(bmp, &amp;rect);<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูุชู ุนุฑุถ ุงูููุฏูู ูุฏููุง! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนูุง ูุธูุฑ ููุฒุฉ ุฃุฎุฑู ูู SDL: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุงู ุงูุฃุญุฏุงุซ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุชู ุชูููู SDL ุจุทุฑููุฉ ุชุคุฏู ุฅูู ุฅุฏุฎุงู ุญุฏุซ ุนูุฏ ุฅุฏุฎุงู ุงููุงูุณ ุฃู ุชุญุฑููู ูู ุชุทุจูู SDL ุฃู ุฅุฑุณุงู ุฅุดุงุฑุฉ ุฅููู. ูุชุญูู ุงูุจุฑูุงูุฌ ุจุนุฏ ุฐูู ูู ูุฐู ุงูุฃุญุฏุงุซ ุฅุฐุง ูุงู ุงูุบุฑุถ ููู ูุนุงูุฌุฉ ุฅุฏุฎุงู ุงููุณุชุฎุฏู. ูููู ูุจุฑูุงูุฌู ุฃูุถูุง ุฅูุดุงุก ุฃุญุฏุงุซ ูุฅุฑุณุงู ุฃุญุฏุงุซ SDL ุฅูู ุงููุธุงู. ูุฐุง ูููุฏ ุจุดูู ุฎุงุต ููุจุฑูุฌุฉ ูุชุนุฏุฏุฉ ุงูุฎููุท ุจุงุณุชุฎุฏุงู SDL ุ ูุงูุฐู ุณูุฑุงู ูู ุงูุฏุฑุณ ุฑูู 4. ูู ุจุฑูุงูุฌูุง ุ ุณูููู ุจูุญุต ุงูุฃุญุฏุงุซ ููุฑูุง ุจุนุฏ ูุนุงูุฌุฉ ุงูุญุฒูุฉ. ูู ุงูููุช ุงูุญุงูู ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชุนุงูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุน ุญุฏุซ </font><b><font style="vertical-align: inherit;">SDL_QUIT ุญุชู</font></b><font style="vertical-align: inherit;"> ูุชููู ูู ุงูุฎุฑูุฌ:</font></font><br>
<br>
<pre><code class="cpp hljs">SDL_Event       event;<font></font>
<font></font>
    av_free_packet(&amp;packet);<font></font>
    SDL_PollEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุฐุง ูุนูุด! ูุชุฎูุต ูู ูู ุงูููุงูุฉ ุงููุฏููุฉ ููุญู ุนูู ุงุณุชุนุฏุงุฏ ูุชุฌููุนูุง. ุฅุฐุง ููุช ุชุณุชุฎุฏู Linux ุฃู ุดูุก ูุซู Linux ุ ูุฅู ุฃูุถู ุทุฑููุฉ ููุชุฑุฌูุฉ ุจุงุณุชุฎุฏุงู ููุชุจุงุช SDL ูู:</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial02 tutorial02.c -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฑุถ sdl-config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุจุณุงุทุฉ ุงูุนูุงูุงุช ุงููุงุฒูุฉ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชูููู ููุชุจุงุช SDL ุจุดูู ุตุญูุญ. </font><font style="vertical-align: inherit;">ูุฏ ุชุถุทุฑ ุฅูู ุงูููุงู ุจุดูุก ุขุฎุฑ ูุฌุนู ูุฐุง ุงูุชุฌููุน ุนูู ูุธุงูู ุ </font><font style="vertical-align: inherit;">ูุฑุฌู ุงูุชุญูู ูู ูุซุงุฆู SDL ููุธุงูู ุนู ุฃู ุฑุฌู ุฅุทูุงุก. </font><font style="vertical-align: inherit;">ุจูุฌุฑุฏ ุชุฌููุนูุง ุ ุงุณุชูุฑ ูู ุงูุชุดุบูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฐุง ูุญุฏุซ ุนูุฏ ุชุดุบูู ูุฐุง ุงูุจุฑูุงูุฌุ </font><font style="vertical-align: inherit;">ูุจุฏู ุฃู ุงูููุฏูู ุจุงูุฌููู! </font><font style="vertical-align: inherit;">ูู ุงููุงูุน ุ ูุญู ุจุจุณุงุทุฉ ูุนุฑุถ ุฌููุน ุฅุทุงุฑุงุช ุงูููุฏูู ุจุฃุณุฑุน ูุง ูููู ุงุณุชุฎุฑุงุฌูุง ูู ููู ุงููููู. </font><font style="vertical-align: inherit;">ููุณ ูุฏููุง ุงูุฑูุฒ ุงูุขู ููุนุฑูุฉ ูุชู ูุญุชุงุฌ ุฅูู ุนุฑุถ ุงูููุฏูู. </font><font style="vertical-align: inherit;">ูู ุงูููุงูุฉ (ูู ุงูุฏุฑุณ ุฑูู 5) ุณูุจุฏุฃ ุจูุฒุงููุฉ ุงูููุฏูู. </font><font style="vertical-align: inherit;">ููู ูู ุงูููุช ุงูุญุงุถุฑ ููุชูุฏ ุดูุฆูุง ููููุง ุจููุณ ุงููุฏุฑ: ุงูุตูุช!</font></font><a name="sound"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 3: ุชุดุบูู ุงูุตูุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 2: ุงูุนุฑุถ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 4: ููุงุถูุน ูุชุนุฏุฏุฉ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุฉ ุงููุงููุฉ: tutorial03.c</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial03.c</span>
<span class="hljs-comment">// A pedagogical video player that will stream through every video frame as fast as it can</span>
<span class="hljs-comment">// and play audio (out of sync).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial03 tutorial03.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial03 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDL_AUDIO_BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIO_FRAME_SIZE 192000</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;<font></font>
<font></font>
PacketQueue audioq;<font></font>
<font></font>
<span class="hljs-keyword">int</span> quit = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span>
</span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(AVCodecContext *aCodecCtx, <span class="hljs-keyword">uint8_t</span> *audio_buf, <span class="hljs-keyword">int</span> buf_size)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">static</span> AVPacket pkt;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> *audio_pkt_data = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> audio_pkt_size = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">static</span> AVFrame frame;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(aCodecCtx, &amp;frame, &amp;got_frame, &amp;pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      audio_pkt_data += len1;<font></font>
      audio_pkt_size -= len1;<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       aCodecCtx-&gt;channels,<font></font>
					       frame.nb_samples,<font></font>
					       aCodecCtx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt.data)<font></font>
      av_free_packet(&amp;pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;audioq, &amp;pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    audio_pkt_data = pkt.data;<font></font>
    audio_pkt_size = pkt.size;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  AVCodecContext *aCodecCtx = (AVCodecContext *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> audio_buf[(MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> audio_buf_size = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> audio_buf_index = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(audio_buf_index &gt;= audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(aCodecCtx, audio_buf, <span class="hljs-keyword">sizeof</span>(audio_buf));
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	audio_buf_size = <span class="hljs-number">1024</span>; <span class="hljs-comment">// arbitrary?</span>
	<span class="hljs-built_in">memset</span>(audio_buf, <span class="hljs-number">0</span>, audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	audio_buf_size = audio_size;<font></font>
      }<font></font>
      audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = audio_buf_size - audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)audio_buf + audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    audio_buf_index += len1;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
  AVFormatContext *pFormatCtx = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">int</span>             i, videoStream, audioStream;<font></font>
  AVCodecContext  *pCodecCtxOrig = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodecContext  *pCodecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec         *pCodec = <span class="hljs-literal">NULL</span>;<font></font>
  AVFrame         *pFrame = <span class="hljs-literal">NULL</span>;<font></font>
  AVPacket        packet;<font></font>
  <span class="hljs-keyword">int</span>             frameFinished;
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span> = <span class="hljs-title">NULL</span>;</span><font></font>
  <font></font>
  AVCodecContext  *aCodecCtxOrig = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodecContext  *aCodecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec         *aCodec = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
  SDL_Overlay     *bmp;<font></font>
  SDL_Surface     *screen;<font></font>
  SDL_Rect        rect;<font></font>
  SDL_Event       event;<font></font>
  SDL_AudioSpec   wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, argv[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, argv[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<font></font>
    <font></font>
  <span class="hljs-comment">// Find the first video stream</span>
  videoStream=<span class="hljs-number">-1</span>;<font></font>
  audioStream=<span class="hljs-number">-1</span>;
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++) {
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
       videoStream &lt; <span class="hljs-number">0</span>) {<font></font>
      videoStream=i;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
       audioStream &lt; <span class="hljs-number">0</span>) {<font></font>
      audioStream=i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(videoStream==<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Didn't find a video stream</span>
  <span class="hljs-keyword">if</span>(audioStream==<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
   <font></font>
  aCodecCtxOrig=pFormatCtx-&gt;streams[audioStream]-&gt;codec;<font></font>
  aCodec = avcodec_find_decoder(aCodecCtxOrig-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!aCodec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Copy context</span><font></font>
  aCodecCtx = avcodec_alloc_context3(aCodec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(aCodecCtx, aCodecCtxOrig) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
  wanted_spec.freq = aCodecCtx-&gt;sample_rate;<font></font>
  wanted_spec.format = AUDIO_S16SYS;<font></font>
  wanted_spec.channels = aCodecCtx-&gt;channels;<font></font>
  wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
  wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
  wanted_spec.callback = audio_callback;<font></font>
  wanted_spec.userdata = aCodecCtx;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  avcodec_open2(aCodecCtx, aCodec, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
  <span class="hljs-comment">// audio_st = pFormatCtx-&gt;streams[index]</span><font></font>
  packet_queue_init(&amp;audioq);<font></font>
  SDL_PauseAudio(<span class="hljs-number">0</span>);<font></font>
<font></font>
  <span class="hljs-comment">// Get a pointer to the codec context for the video stream</span><font></font>
  pCodecCtxOrig=pFormatCtx-&gt;streams[videoStream]-&gt;codec;<font></font>
  <font></font>
  <span class="hljs-comment">// Find the decoder for the video stream</span><font></font>
  pCodec=avcodec_find_decoder(pCodecCtxOrig-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(pCodec==<span class="hljs-literal">NULL</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Codec not found</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Copy context</span><font></font>
  pCodecCtx = avcodec_alloc_context3(pCodec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(pCodecCtx, pCodecCtxOrig) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Open codec</span>
  <span class="hljs-keyword">if</span>(avcodec_open2(pCodecCtx, pCodec, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Could not open codec</span><font></font>
  <font></font>
  <span class="hljs-comment">// Allocate video frame</span><font></font>
  pFrame=av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(pCodecCtx-&gt;width, pCodecCtx-&gt;height, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(pCodecCtx-&gt;width, pCodecCtx-&gt;height, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  bmp = SDL_CreateYUVOverlay(pCodecCtx-&gt;width,<font></font>
				 pCodecCtx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
<font></font>
  <span class="hljs-comment">// initialize SWS context for software scaling</span><font></font>
  sws_ctx = sws_getContext(pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   pCodecCtx-&gt;pix_fmt,<font></font>
			   pCodecCtx-&gt;width,<font></font>
			   pCodecCtx-&gt;height,<font></font>
			   PIX_FMT_YUV420P,<font></font>
			   SWS_BILINEAR,<font></font>
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span>,
			   <span class="hljs-literal">NULL</span><font></font>
			   );<font></font>
<font></font>
  <span class="hljs-comment">// Read frames and save first five frames to disk</span>
  i=<span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span>(av_read_frame(pFormatCtx, &amp;packet)&gt;=<span class="hljs-number">0</span>) {
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet.stream_index==videoStream) {
      <span class="hljs-comment">// Decode video frame</span><font></font>
      avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet);<font></font>
      <font></font>
      <span class="hljs-comment">// Did we get a video frame?</span>
      <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
	SDL_LockYUVOverlay(bmp);<font></font>
<font></font>
	AVPicture pict;<font></font>
	pict.data[<span class="hljs-number">0</span>] = bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
	pict.data[<span class="hljs-number">1</span>] = bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
	pict.data[<span class="hljs-number">2</span>] = bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
<font></font>
	pict.linesize[<span class="hljs-number">0</span>] = bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
	pict.linesize[<span class="hljs-number">1</span>] = bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
	pict.linesize[<span class="hljs-number">2</span>] = bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
<font></font>
	<span class="hljs-comment">// Convert the image into YUV format that SDL uses	</span>
	sws_scale(sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
		  pFrame-&gt;linesize, <span class="hljs-number">0</span>, pCodecCtx-&gt;height,<font></font>
		  pict.data, pict.linesize);<font></font>
	<font></font>
	SDL_UnlockYUVOverlay(bmp);<font></font>
	<font></font>
	rect.x = <span class="hljs-number">0</span>;<font></font>
	rect.y = <span class="hljs-number">0</span>;<font></font>
	rect.w = pCodecCtx-&gt;width;<font></font>
	rect.h = pCodecCtx-&gt;height;<font></font>
	SDL_DisplayYUVOverlay(bmp, &amp;rect);<font></font>
	av_free_packet(&amp;packet);<font></font>
      }<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet.stream_index==audioStream) {<font></font>
      packet_queue_put(&amp;audioq, &amp;packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(&amp;packet);<font></font>
    }<font></font>
    <span class="hljs-comment">// Free the packet that was allocated by av_read_frame</span><font></font>
    SDL_PollEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      quit = <span class="hljs-number">1</span>;<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Free the YUV frame</span><font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <font></font>
  <span class="hljs-comment">// Close the codecs</span><font></font>
  avcodec_close(pCodecCtxOrig);<font></font>
  avcodec_close(pCodecCtx);<font></font>
  avcodec_close(aCodecCtxOrig);<font></font>
  avcodec_close(aCodecCtx);<font></font>
  <font></font>
  <span class="hljs-comment">// Close the video file</span><font></font>
  avformat_close_input(&amp;pFormatCtx);<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ุงูุขู ุชุดุบูู ุงูุตูุช ูู ุงูุชุทุจูู. </font><font style="vertical-align: inherit;">ุชููุฑ ููุง SDL ุฃูุถูุง ุทุฑููุง ูุชุดุบูู ุงูุตูุช. </font><font style="vertical-align: inherit;">ูุชู </font><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู </font><font style="vertical-align: inherit;">ุงููุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_OpenAudio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ููุชุญ ุฌูุงุฒ ุงูุตูุช ููุณู. </font><font style="vertical-align: inherit;">ูุชุทูุจ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃูุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจููุฉ </font><b><font style="vertical-align: inherit;">SDL_AudioSpec</font></b><font style="vertical-align: inherit;"> ุ ูุงูุชู ุชุญุชูู ุนูู ุฌููุน ุงููุนูููุงุช ุญูู ุงูุตูุช ุงูุฐู ุณูููู </font><b><font style="vertical-align: inherit;">ุจุชุดุบููู</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ุฃู ููุถุญ ููููุฉ ุชูููู ูุฐุง ุ ููุถุญ ุฃููุงู ููููุฉ ูุนุงูุฌุฉ ุงูููุจููุชุฑ ููุตูุช ุจุดูู ุนุงู. </font><font style="vertical-align: inherit;">ูุชููู ุงูุตูุช ุงูุฑููู ูู ุฏูู ุทููู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนููุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูููุง ููุซู ูุนูู ูุญุฏุฏ ูููุฌุฉ ุตูุชูุฉ. ูุชู ุชุณุฌูู ุงูุฃุตูุงุช ุจูุนุฏู ุฃุฎุฐ ุนููุงุช ูุญุฏุฏ ุ ูุงูุฐู ูุดูุฑ ุจุจุณุงุทุฉ ุฅูู ูุฏู ุณุฑุนุฉ ุชุดุบูู ูู ุนููุฉ ุ ูููุงุณ ุจุนุฏุฏ ุงูุนููุงุช ูู ุงูุซุงููุฉ. ุชุฑุฏุฏุงุช ุฃุฎุฐ ุงูุนููุงุช ุงูุชูุฑูุจูุฉ ูู </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22050</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44100</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนููุฉ ูู ุงูุซุงููุฉุ ููู ุณุฑุนุฉ ุงููุณุชุฎุฏูุฉ ููุฅุฐุงุนุฉ ูCDุ ุนูู ุงูุชูุงูู. ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุฃู ุชุญุชูู ูุนุธู ุงูุตูุช ุนูู ุฃูุซุฑ ูู ููุงุฉ ูุงุญุฏุฉ ูุตูุช ุงูุงุณุชุฑูู ุฃู ุงูุตูุช ุงููุญูุทู ุ ูุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช ุงูุนููุฉ ูู ุงูุงุณุชุฑูู ุ ูุณุชุฃุชู ุงูุนููุงุช ุงุซููู ูู ูู ูุฑุฉ. ุนูุฏูุง ูุญุตู ุนูู ุงูุจูุงูุงุช ูู ููู ุงููููู ุ ูุง ูุนุฑู ุนุฏุฏ ุงูุนููุงุช ุงูุชู ุณูุญุตู ุนูููุง ุ ููู FFmpeg ูุง ููุชุฌ ุนููุงุช ููุณูุฑุฉ - ููุฐุง ูุนูู ุฃูุถูุง ุฃูู ูู ููุตู ุนููุฉ ุงูุงุณุชุฑูู ุฃูุถูุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุทุฑููุฉ ุชุดุบูู ุงูุตูุช ูู SDL ูู ููุง ููู. </font><font style="vertical-align: inherit;">ูุชู ุชูููู ูุนููุงุช ุงูุตูุช: ุชุฑุฏุฏ ุฃุฎุฐ ุงูุนููุงุช ุ ุนุฏุฏ ุงููููุงุช ุ ุฅูุฎ. </font><font style="vertical-align: inherit;">ููุฐูู ุชุนููู ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู ูุจูุงูุงุช ุงููุณุชุฎุฏู. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุจุฏุฃ ูู ุชุดุบูู ุงูุตูุช ุ ุณุชุณุชุฏุนู SDL ุจุงุณุชูุฑุงุฑ ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู ูุฐู ูุชุทูุจ ูููุง ููุก ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู ุจุนุฏุฏ ูุนูู ูู ูุญุฏุงุช ุงูุจุงูุช. </font><font style="vertical-align: inherit;">ุจุนุฏ ูุถุน ูุฐู ุงููุนูููุงุช ูู ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_AudioSpec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_OpenAudio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ูุงูุฐู ุณููุชุญ ุฌูุงุฒ ุงูุตูุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนูุฏ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุง ุจููุฉ </font><b><font style="vertical-align: inherit;">AudioSpec</font></b><font style="vertical-align: inherit;"> ุฃุฎุฑู </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุฐู ูู ุงูุฎุตุงุฆุต ุงูุชู ุณูุณุชุฎุฏููุง ุจุงููุนู - ููุณ ููุงู ูุง ูุถูู ุฃููุง ุณูุญุตู ุจุงูุถุจุท ุนูู ูุง ุทูุจูุงู!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏ ุงูุตูุช</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุท ุถุนูุง ูู ุงูุงุนุชุจุงุฑ ูู ุงูููุช ุงูุญุงูู ุ ูุฃูู ููุณ ูุฏููุง ุฃู ูุนูููุงุช ุญูู ุฏูู ุงูุตูุช ุญุชู ุงูุขู! </font><font style="vertical-align: inherit;">ุฏุนูุง ูุนูุฏ ุฅูู ุงูููุงู ูู ุงูููุฏ ุงูุฎุงุต ุจูุง ุญูุซ ูุฌุฏูุง ุฏูู ุงูููุฏูู ููุนุฑูุฉ ุฃู ุฏูู ูู ุฏูู ุงูุตูุช:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Find the first video stream</span>
videoStream=<span class="hljs-number">-1</span>;<font></font>
audioStream=<span class="hljs-number">-1</span>;
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i &lt; pFormatCtx-&gt;nb_streams; i++) {
  <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO<font></font>
     &amp;&amp;<font></font>
       videoStream &lt; <span class="hljs-number">0</span>) {<font></font>
    videoStream=i;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
     audioStream &lt; <span class="hljs-number">0</span>) {<font></font>
    audioStream=i;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">if</span>(videoStream==<span class="hljs-number">-1</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Didn't find a video stream</span>
<span class="hljs-keyword">if</span>(audioStream==<span class="hljs-number">-1</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ูููููุง ุงูุญุตูู ุนูู ุฌููุน ุงููุนูููุงุช ุงูุชู ูุฑูุฏูุง ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVCodecContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูุฏูู ุ ุชูุงููุง ููุง ูุนููุง ูุน ุฏูู ุงูููุฏูู:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodecContext *aCodecCtxOrig;<font></font>
AVCodecContext *aCodecCtx;<font></font>
<font></font>
aCodecCtxOrig=pFormatCtx-&gt;streams[audioStream]-&gt;codec;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ููุช ุชุชุฐูุฑ ุ ูู ุงูุฏุฑูุณ ุงูุณุงุจูุฉ ุ ูุง ูุฒุงู ูุชุนูู ุนูููุง ูุชุญ ุจุฑูุงูุฌ ุชุฑููุฒ ุงูุตูุช ููุณู. </font><font style="vertical-align: inherit;">ุงูู ุณูู:</font></font><br>
<br>
<pre><code class="cpp hljs">AVCodec         *aCodec;<font></font>
<font></font>
aCodec = avcodec_find_decoder(aCodecCtx-&gt;codec_id);<font></font>
<span class="hljs-keyword">if</span>(!aCodec) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}<font></font>
<span class="hljs-comment">// Copy context</span><font></font>
aCodecCtx = avcodec_alloc_context3(aCodec);<font></font>
<span class="hljs-keyword">if</span>(avcodec_copy_context(aCodecCtx, aCodecCtxOrig) != <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
}<font></font>
<span class="hljs-comment">/* set up SDL Audio here */</span><font></font>
<font></font>
avcodec_open2(aCodecCtx, aCodec, <span class="hljs-literal">NULL</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุณูุงู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ูุญุชูู ุนูู ุฌููุน ุงููุนูููุงุช ุงููุงุฒูุฉ ูุชูููู ุงูุตูุช ูุฏููุง:</font></font><br>
<br>
<pre><code class="cpp hljs">wanted_spec.freq = aCodecCtx-&gt;sample_rate;<font></font>
wanted_spec.format = AUDIO_S16SYS;<font></font>
wanted_spec.channels = aCodecCtx-&gt;channels;<font></font>
wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
wanted_spec.callback = audio_callback;<font></font>
wanted_spec.userdata = aCodecCtx;<font></font>
<font></font>
<span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
  <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุณุชุนุฑุถ ูู ุนูุตุฑ:</font></font><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freq</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><b><font style="vertical-align: inherit;">ุงูุชูุฑุงุฑ</font></b><font style="vertical-align: inherit;"> ): ูุนุฏู ุฃุฎุฐ ุงูุนููุงุช ุ ููุง ูู ููุถุญ ุณุงุจููุง.</font></font></li>
<li><b>format</b> ():  SDL ,      . ยซ<b>S</b>ยป  ยซ<b>S16SYS</b>ยป  ยซยป, <b>16</b> ,      16 ,  ยซ<b>SYS</b>ยป ,       ,    .  ,   <b>avcodec_decode_audio2</b>   .</li>
<li><b>channels</b> ():  .</li>
<li><b>silence</b> ():  ,  .   0.</li>
<li><b>samples</b> ():    ,    ,  SDL  ,     .    -  512  8192; FFplay,  ,  1024.</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุฏ ุงูุงุชุตุงู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (callback): ููุง ูููู ุจุชูุฑูุฑ ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู ุงูุญููููุฉ. </font><font style="vertical-align: inherit;">ุณูุชุญุฏุซ ุฃูุซุฑ ุนู ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู ูุงุญููุง.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุงูุงุช ุงููุณุชุฎุฏู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">ุณุชุนุทู</font></b><font style="vertical-align: inherit;"> SDL ุฑุฏ ุงูุงุชุตุงู ุงูุฎุงุต ุจูุง ุจูุคุดุฑ ุฎุงูู ูุฃู ุจูุงูุงุช ูุณุชุฎุฏู ูุฑูุฏูุง. </font><font style="vertical-align: inherit;">ูุฑูุฏ ุฃู ูุนููู ุจุณูุงู ุงูุชุฑููุฒ ุงูุฎุงุต ุจูุง ุ </font><font style="vertical-align: inherit;">ุฃูู ููููุง ุณูููู ูู ุงููุงุถุญ ููุงุฐุง.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุฎูุฑูุง ุ ุงูุชุญ ุงูุตูุช ุจุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_OpenAudio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฆู ุงูุงูุชุธุงุฑ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุงูุถุฑูุฑู! ุงูุขู ูุญู ุนูู ุงุณุชุนุฏุงุฏ ูุงุณุชุฎุฑุงุฌ ุงููุนูููุงุช ุงูุตูุชูุฉ ูู ุงูุฏูู. ูููู ูุงุฐุง ุชูุนู ุจูุฐู ุงููุนูููุงุชุ ุณูุณุชูุจู ุงูุญุฒู ุจุงุณุชูุฑุงุฑ ูู ููู ุงููููู ุ ูููู ูู ููุณ ุงูููุช ุ ุณุชุณุชุฏุนู SDL ูุธููุฉ ุฑุฏ ุงูุงุชุตุงู! ุณูููู ุงูุญู ูู ุฅูุดุงุก ููุน ูู ุงููููู ุงูุนุงููู ุงูุฐู ูููููุง ูู ุฎูุงูู ุฅุฏุฑุงุฌ ุงูุญุฒู ุงูุตูุชูุฉ ุจุญูุซ ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฏุนุงุก</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุตูุช ูุฏููุง </font><font style="vertical-align: inherit;">ุดูุก ูุงุณุชูุจุงู ุงูุจูุงูุงุช ุงูุตูุชูุฉ! ูุฐุง ุ ูุฐุง ูุง ุณููุนูู ูุฅูุดุงุก ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุญุฒู. ูุญุชูู FFmpeg ุนูู ุจููุฉ ูููุณุงุนุฏุฉ ูู ูุฐุง: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVPacketList</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููู ูุฌุฑุฏ ูุงุฆูุฉ ูุฑุชุจุทุฉ ููุญุฒู. ูููุง ููู ูููู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฏููุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูุฌุจ ุฃู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดูุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูู ุฃู </font><b><font style="vertical-align: inherit;">nb_packets</font></b><font style="vertical-align: inherit;"> ูุฎุชูู ูู ุงูุญุฌู - ูุดูุฑ ุงูุญุฌู ุฅูู ุญุฌู ุงูุจุงูุช ุงูุฐู ูุญุตู ุนููู ูู </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฌู ุงูุญุฒูุฉ -&gt;</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุงุญุธ ุฃู ูุฏููุง ูุชุบูุฑ ููุชุบูุฑ ุดุฑุท. </font><font style="vertical-align: inherit;">ูุฐูู ูุฃู SDL ูููู ุจุนูููุฉ ุงูุตูุช ูุฏูู ูููุตู. </font><font style="vertical-align: inherit;">ุฅุฐุง ูู ููู ุจุญุธุฑ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุจุดูู ุตุญูุญ ุ ููููููุง ุจุงููุนู ุฅุชูุงู ุจูุงูุงุชูุง. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุฑู ููู ูุชู ุชูููุฐ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุนุฑู ูู ูุจุฑูุฌ ูุญุชุฑู ููุณู ููููุฉ ุฅูุดุงุก ููุงุฆู ุงูุงูุชุธุงุฑ ุ ูููููุง ุณููุถุญ ุฃูุถูุง ููููุฉ ุงูููุงู ุจุฐูู ุจุญูุซ ูุณูู ุนููู ุชุนูู ูุธุงุฆู SDL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูููู ุจุฅูุดุงุก ุฏุงูุฉ ูุชููุฆุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ูู ุจุฅูุดุงุก ูุธููุฉ ููุถุน ุงููุงุฆูุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฏููุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู SDL_LockMutex</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุญุธุฑ ูุงุฆู ุงููุฒุงููุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุญุชู ูุชููู ูู ุฅุถุงูุฉ ุดูุก ูุง ุ ุซู ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondSignal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุฅุฑุณุงู ุฅุดุงุฑุฉ ุฅูู ุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get ุงูุฎุงุตุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุง </font><font style="vertical-align: inherit;">(ุฅุฐุง ูุงูุช ุชุชููุน ุฐูู) ูู ุฎูุงู ุงููุชุบูุฑ ุงูุดุฑุทู ูุฅุฎุจุงุฑู ุจูุฌูุฏ ุจูุงูุงุช ููููู ุงุณุชูุฑุงุฑูุง ุ ููุฒูุฏ ูู ูุชุญ ุงููุคุฎุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅููู ุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุงุจูุฉ </font><font style="vertical-align: inherit;">. ูุงุญุธ ููู ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondWait</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุฅูุดุงุก ูุชูุฉ ุงููุธุงุฆู (ุฃู ุชููู ูุคูุชูุง ุญุชู ูุญุตู ุนูู ุงูุจูุงูุงุช) ุฅุฐุง </font><b><font style="vertical-align: inherit;">ุฃุฎุจุฑูุงูุง</font></b><font style="vertical-align: inherit;"> ุจุฐูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">int</span> quit = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span> </span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุชุฑูู ุ ูููุง ุจูู ุงููุธููุฉ ูู ุฏูุฑุฉ ุฃุจุฏูุฉ ุ ูุฐูู ุณูุญุตู ุจุงูุชุฃููุฏ ุนูู ุจุนุถ ุงูุจูุงูุงุช ุฅุฐุง ุฃุฑุฏูุง ููุนูุง. </font><font style="vertical-align: inherit;">ูุชุฌูุจ ุงูุชูุฑุงุฑ ุฅูู ุงูุฃุจุฏ ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondWait</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). </font><font style="vertical-align: inherit;">ุจุดูู ุฃุณุงุณู ุ ูู ูุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุนูู CondWait</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูุชุธุงุฑ ุฅุดุงุฑุฉ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondSignal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () (ุฃู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondBroadcast</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ()) ุซู </font><b><font style="vertical-align: inherit;">ุงููุชุงุจุนุฉ</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุจุฏู ุฃููุง ููุนูุงูุง ูู ูุงุฆู ูุชุญุฑู - ุฅุฐุง ุฃูุณููุง ุจุงูููู ุ </font><font style="vertical-align: inherit;">ููู ุชุชููู </font><font style="vertical-align: inherit;">ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุถุน</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฏููุง ูู </font><b><font style="vertical-align: inherit;">ูุถุน</font></b><font style="vertical-align: inherit;"> ุฃู ุดูุก ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ! </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุง ููุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CondWait</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุฃูุถูุง ุจุงููุณุจุฉ ููุง ูู ุฅูุบุงุก ุญุธุฑ ูุงุฆู ุงููุฒุงููุฉ ุงูุฐู ููุฏูู ูู ุ ุซู ุญุงูู ูุฑุฉ ุฃุฎุฑู ูููู ุจูุฌุฑุฏ ุงุณุชูุงููุง ููุฅุดุงุฑุฉ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุฅุทูุงุฆู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฑู ุฃูุถูุง ุฃู ูุฏููุง ูุชุบูุฑูุง ุนุงููุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฅููุงุน</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุญูู ููู ููุชุฃูุฏ ูู ุฃููุง ูู ููู ุจุชุนููู ุฅุดุงุฑุฉ ุฎุฑุฌ ูู ุงูุจุฑูุงูุฌ (ูุนุงูุฌ SDL ุฅุดุงุฑุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TERM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชููุงุฆููุง </font><font style="vertical-align: inherit;">ุ ููุง ุฅูู ุฐูู). </font><font style="vertical-align: inherit;">ุฎูุงู ุฐูู ุ ุณูู ูุณุชูุฑ ุงูุฎูุท ุฅูู ุงูุฃุจุฏ ุ ูุนูููุง ุฃู ููุชู ุงูุจุฑูุงูุฌ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุชู -9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">  SDL_PollEvent(&amp;event);
  <span class="hljs-keyword">switch</span>(event.type) {
  <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
    quit = <span class="hljs-number">1</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุถุน ุนูุงูุฉ ุงูุฎุฑูุฌ ุนูู 1.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุทุนู ุงูุญุฒู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจูู ููุท ูุชูููู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฏููุง:</font></font><br>
<br>
<pre><code class="cpp hljs">PacketQueue audioq;<font></font>
main() {<font></font>
...<font></font>
  avcodec_open2(aCodecCtx, aCodec, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
  packet_queue_init(&amp;audioq);<font></font>
  SDL_PauseAudio(<span class="hljs-number">0</span>);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจุฏุฃ SDL_PauseAudio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุฃุฎูุฑูุง ูุญุฏุฉ ุงูุตูุช. </font><font style="vertical-align: inherit;">ุชุณุชูุณุฎ ุงูุตูุช ุฅุฐุง ูู ุชุชููู ุงูุจูุงูุงุช ุ </font><font style="vertical-align: inherit;">ููู ูุฐุง ูุง ูุญุฏุซ ุนูู ุงูููุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ุ ูุฏููุง ูุงุฆูุฉ ุงูุชุธุงุฑ ุชู ุชูููููุง ุ ููุญู ุงูุขู ุนูู ุงุณุชุนุฏุงุฏ ูุฅุฑุณุงู ุญุฒู ููุง. </font><font style="vertical-align: inherit;">ููุชูู ุฅูู ุฏูุฑุฉ ูุฑุงุกุฉ ุงูุญุฒูุฉ ุงูุฎุงุตุฉ ุจูุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span>(av_read_frame(pFormatCtx, &amp;packet)&gt;=<span class="hljs-number">0</span>) {
  <span class="hljs-comment">// Is this a packet from the video stream?</span>
  <span class="hljs-keyword">if</span>(packet.stream_index==videoStream) {
    <span class="hljs-comment">// Decode video frame</span><font></font>
    ....<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet.stream_index==audioStream) {<font></font>
    packet_queue_put(&amp;audioq, &amp;packet);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    av_free_packet(&amp;packet);<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูุง ูุทูู ุงูุญุฒูุฉ ุจุนุฏ ูุถุนูุง ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </font><font style="vertical-align: inherit;">ุณูููู ุจุฅุตุฏุงุฑู ูุงุญููุง ุนูุฏูุง ูููู ุจูู ุงูุชุดููุฑ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฑุฏุงุฏ ุงูุญุฒู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฏุนูุง ูุฌุนู ุฃุฎูุฑูุง ูุธููุฉ ุชุณุฌูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุตูุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฌูุจ ุงูุญุฒู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุจุฏู ุฑุฏ ุงูุงุชุตุงู ูุงูุชุงูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span></span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุงูุงุช ุงููุณุชุฎุฏู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูู ุงููุคุดุฑ ุงูุฐู ูุฏููุงู SDL ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงููุฎุฒู ุงููุคูุช ุงูุฐู </font><b><font style="vertical-align: inherit;">ุณููุชุจ</font></b><font style="vertical-align: inherit;"> ููู ุงูุจูุงูุงุช ุงูุตูุชูุฉ ุ ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุญุฌู ูุฐุง ุงููุฎุฒู ุงููุคูุช. </font><font style="vertical-align: inherit;">ูุฐุง ูู ุงูุฑูุฒ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  AVCodecContext *aCodecCtx = (AVCodecContext *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;<font></font>
<font></font>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> audio_buf_size = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> audio_buf_index = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(audio_buf_index &gt;= audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span><font></font>
      audio_size = audio_decode_frame(aCodecCtx, audio_buf,<font></font>
                                      <span class="hljs-keyword">sizeof</span>(audio_buf));
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(audio_buf, <span class="hljs-number">0</span>, audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	audio_buf_size = audio_size;<font></font>
      }<font></font>
      audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = audio_buf_size - audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)audio_buf + audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    audio_buf_index += len1;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุงูุน ุ ูุฐู ุญููุฉ ุจุณูุทุฉ ุชุณุชุฎุฑุฌ ุงูุจูุงูุงุช ูู ูุธููุฉ ุฃุฎุฑู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุจูุงูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ </font><b><font style="vertical-align: inherit;">audio_decode_frame</font></b><font style="vertical-align: inherit;"> () </font><font style="vertical-align: inherit;">ุ </font><b><font style="vertical-align: inherit;">ูุชุญูุธ</font></b><font style="vertical-align: inherit;"> ุงููุชูุฌุฉ ูู ูุฎุฒู ูุคูุช ูุชูุณุท โโุ ูุชุญุงูู ูุชุงุจุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bytes ูู ุงูุฏูู ูุชุชููู ุงููุฒูุฏ ูู ุงูุจูุงูุงุช ุฅุฐุง ูู ููู ูุฏููุง ูุง ูููู ูู ุงูุจูุงูุงุช ุฃู ุญูุธูุง ูููุช ูุงุญู ุ ุฅุฐุง ุจูู ูุฏููุง ุดูุก. </font><font style="vertical-align: inherit;">ูุจูุบ ุญุฌู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู audio_buf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 ุถุนู ุญุฌู ุฃูุจุฑ ุฅุทุงุฑ ุตูุชู </font><b><font style="vertical-align: inherit;">ุณูุนุทููุงู</font></b><font style="vertical-align: inherit;"> FFmpeg ุ ููุง ูููุญูุง ูุงูุดูุง ุฌูุฏูุง.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุดููุฑ ุงูุตูุช ุงูููุงุฆู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ููุธุฑ ุฅูู ุงูุฏูุงุฎู ูู ูุญุฏุฉ ูู ุชุฑููุฒ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_decode_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(AVCodecContext *aCodecCtx, <span class="hljs-keyword">uint8_t</span> *audio_buf,
                       <span class="hljs-keyword">int</span> buf_size)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">static</span> AVPacket pkt;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> *audio_pkt_data = <span class="hljs-literal">NULL</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> audio_pkt_size = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">static</span> AVFrame frame;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(aCodecCtx, &amp;frame, &amp;got_frame, &amp;pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      audio_pkt_data += len1;<font></font>
      audio_pkt_size -= len1;<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       aCodecCtx-&gt;channels,<font></font>
					       frame.nb_samples,<font></font>
					       aCodecCtx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt.data)<font></font>
      av_free_packet(&amp;pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;audioq, &amp;pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    audio_pkt_data = pkt.data;<font></font>
    audio_pkt_size = pkt.size;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุจุฏุฃ ุงูุนูููุฉ ุจุฑูุชูุง ูู ุงููุงูุน ุจุงููุฑุจ ูู ููุงูุฉ ุงููุธููุฉ ุ ุญูุซ ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packet_queue_get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). ูุฃุฎุฐ ุงูุญุฒูุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุญูุธ ุงููุนูููุงุช ูููุง. ุจุนุฏ ุฐูู ุ ุนูุฏูุง ูููู ูุฏููุง ุงูุญุฒูุฉ ููุนูู ุ ูุฅููุง ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_decode_audio4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ูุงูุฐู ูุดุจู ุฅูู ุญุฏ ูุจูุฑ ุงููุธููุฉ ุงูุดูููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_decode_video</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ุจุงุณุชุซูุงุก ุฃูู ูู ูุฐู ุงูุญุงูุฉ ูููู ุฃู ุชุญุชูู ุงูุญุฒูุฉ ุนูู ุฃูุซุฑ ูู ุฅุทุงุฑ ูุงุญุฏ. ูุฐูู ุ ูุฏ ุชุญุชุงุฌ ุฅูู ุงูุงุชุตุงู ุจู ุนุฏุฉ ูุฑุงุช ููุญุตูู ุนูู ุฌููุน ุงูุจูุงูุงุช ูู ุงูุญุฒูุฉ. ุจุนุฏ ุงุณุชูุงู ุงูุฅุทุงุฑ ุ ูููู ุจุจุณุงุทุฉ ุจูุณุฎู ุฅูู ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู ุงูุฎุงุต ุจูุง ุ ูุน ุงูุชุฃูุฏ ูู ุฃู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฌู ุงูุจูุงูุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุตุบุฑ ูู ุงููุฎุฒู ุงููุคูุช ุงูุตูุชู ุงูุฎุงุต ุจูุง. ูุชุฐูุฑ ุฃูุถูุง ุนู ุฅุฑุณุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_buf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุงูููุน ุงูุตุญูุญ ุ ูุฃู SDL ูุนุทู ูุฎุฒููุง ูุคูุชูุง int 8 ุจุช ุ ููุนุทููุง FFmpeg ุจูุงูุงุช ูู ูุฎุฒู ูุคูุช int 16 ุจุช. ูุฌุจ ุนููู ุฃูุถูุง ูุฑุงุนุงุฉ ุงููุฑู ุจูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">len1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุญุฌู ุงูุญุฒูุฉ ุงูุชู ุงุณุชุฎุฏููุงูุง ุ ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููุฏุงุฑ ุงูุจูุงูุงุช ุงูุฎุงู ุงูุชู ุชู ุฅุฑุฌุงุนูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูููู ูุฏููุง ุจุนุถ ุงูุจูุงูุงุช ุ ูุนูุฏ ุนูู ุงูููุฑ ููุนุฑูุฉ ูุง ุฅุฐุง ููุง ุจุญุงุฌุฉ ููุญุตูู ุนูู ุงููุฒูุฏ ูู ุงูุจูุงูุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุฃู ุงูุชูููุง. ุฅุฐุง ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ูุนุงูุฌุฉ ุงูุญุฒูุฉ ุ ูุงูุชุฒู ุจูุง. ุฅุฐุง ุฃูููุช ุงูุญุฒูุฉ ุ ูุฃุทูููุง ุฃุฎูุฑูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุดูุก! ููุฏ ููููุง ุงูุตูุช ูู ุญููุฉ ุงููุฑุงุกุฉ ุงูุฑุฆูุณูุฉ ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ูุงูุชู ุชุชู ูุฑุงุกุชูุง ุจุนุฏ ุฐูู ุจูุงุณุทุฉ ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_callback</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงูุฐู ูููู ูุฐู ุงูุจูุงูุงุช ุฅูู SDL ุ ููููู SDL ุฅูู ุจุทุงูุฉ ุงูุตูุช ุงูุฎุงุตุฉ ุจู. ุงููุถู ูุฏูุง ูุชุฌููุน:</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial03 tutorial03.c -lavutil -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gip-gip-hooray! </font><font style="vertical-align: inherit;">ูุง ูุฒุงู ุงูููุฏูู ูุญูู ุจุฃูุตู ุณุฑุนุฉ ุ ูููู ุงูุตูุช ููุฏ ุงูุชุดุบูู ุจุงููุนู ููุง ููุจุบู. </font><font style="vertical-align: inherit;">ููุงุฐุง ูุฐุงุ </font><font style="vertical-align: inherit;">ูุนู ุ ูุฃู ูุนูููุงุช ุงูุตูุช ููุง ุชุฑุฏุฏ ุฃุฎุฐ ุนููุงุช - ูููู ุจุถุฎ ูุนูููุงุช ุงูุตูุช ุจุงูุณุฑุนุฉ ุงูุชู ูุชุถุญ ุจูุง ุ ูููู ูุชู ุชุดุบูู ุงูุตูุช ุจุจุณุงุทุฉ ูู ูุฐุง ุงูุฏูู ููููุง ูุชุฑุฏุฏ ุฃุฎุฐ ุงูุนููุงุช. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญู ุฌุงูุฒูู ุชูุฑูุจูุง ููุฒุงููุฉ ุงูููุฏูู ูุงูุตูุช ุ ูููู ุฃููุงู ูุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ุฅุนุงุฏุฉ ุชูุธูู ุตุบูุฑุฉ ููุจุฑูุงูุฌ. </font><font style="vertical-align: inherit;">ูุฌุญุช ุทุฑููุฉ ุทุงุจูุฑ ุงูุตูุช ูุชุดุบููู ุจุงุณุชุฎุฏุงู ุฏูู ูููุตู ุจุดูู ุฌูุฏ ููุบุงูุฉ: ููุฏ ุฌุนูุช ุงูุดูุฑุฉ ุฃูุซุฑ ูุงุจููุฉ ููุฅุฏุงุฑุฉ ูุฃูุซุฑ ููุทููุง. </font><font style="vertical-align: inherit;">ูุจู ุฃู ูุจุฏุฃ ูุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช ุ ูุญุชุงุฌ ุฅูู ุชุจุณูุท ุงูุฑูุฒ. </font><font style="vertical-align: inherit;">ูู ุงูุณูุณูุฉ ุงูุชุงููุฉ ุณูู ููุชุฌ ุชุฏููุงุช ุงูุชุญูู!</font></font><a name="threads"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 4: ููุงุถูุน ูุชุนุฏุฏุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 3: ุชุดุบูู ุงูุตูุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 5: ูุฒุงููุฉ ุงูููุฏูู"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุฉ ุงููุงููุฉ ููุจุฑูุงูุฌ ุงูุชุนูููู .04 ุฌ</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial04.c</span>
<span class="hljs-comment">// A pedagogical video player that will stream through every video frame as fast as it can,</span>
<span class="hljs-comment">// and play audio (out of sync).</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial04 tutorial04.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial04 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the video stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDL_AUDIO_BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIO_FRAME_SIZE 192000</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIOQ_SIZE (5 * 16 * 1024)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_VIDEOQ_SIZE (5 * 256 * 1024)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_REFRESH_EVENT (SDL_USEREVENT)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_QUIT_EVENT (SDL_USEREVENT + 1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VIDEO_PICTURE_QUEUE_SIZE 1</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  SDL_Overlay *bmp;<font></font>
  <span class="hljs-keyword">int</span> width, height; <span class="hljs-comment">/* source height &amp; width */</span>
  <span class="hljs-keyword">int</span> allocated;<font></font>
} VideoPicture;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span><font></font>
<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  <span class="hljs-keyword">int</span>             videoStream, audioStream;<font></font>
  AVStream        *audio_st;<font></font>
  AVCodecContext  *audio_ctx;<font></font>
  PacketQueue     audioq;<font></font>
  <span class="hljs-keyword">uint8_t</span>         audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_size;
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_index;<font></font>
  AVFrame         audio_frame;<font></font>
  AVPacket        audio_pkt;<font></font>
  <span class="hljs-keyword">uint8_t</span>         *audio_pkt_data;
  <span class="hljs-keyword">int</span>             audio_pkt_size;<font></font>
  AVStream        *video_st;<font></font>
  AVCodecContext  *video_ctx;<font></font>
  PacketQueue     videoq;<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span>;</span><font></font>
<font></font>
  VideoPicture    pictq[VIDEO_PICTURE_QUEUE_SIZE];<font></font>
  <span class="hljs-keyword">int</span>             pictq_size, pictq_rindex, pictq_windex;<font></font>
  SDL_mutex       *pictq_mutex;<font></font>
  SDL_cond        *pictq_cond;<font></font>
  <font></font>
  SDL_Thread      *parse_tid;<font></font>
  SDL_Thread      *video_tid;<font></font>
<font></font>
  <span class="hljs-keyword">char</span>            filename[<span class="hljs-number">1024</span>];
  <span class="hljs-keyword">int</span>             quit;<font></font>
} VideoState;<font></font>
<font></font>
SDL_Surface     *screen;<font></font>
SDL_mutex       *screen_mutex;<font></font>
<font></font>
<span class="hljs-comment">/* Since we only have one decoding thread, the Big Struct
   can be global in case we need it. */</span><font></font>
VideoState *global_video_state;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span>
</span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(global_video_state-&gt;quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">uint8_t</span> *audio_buf, <span class="hljs-keyword">int</span> buf_size)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
  AVPacket *pkt = &amp;is-&gt;audio_pkt;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(is-&gt;audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(is-&gt;audio_ctx, &amp;is-&gt;audio_frame, &amp;got_frame, pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	is-&gt;audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       is-&gt;audio_ctx-&gt;channels,<font></font>
					       is-&gt;audio_frame.nb_samples,<font></font>
					       is-&gt;audio_ctx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, is-&gt;audio_frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      is-&gt;audio_pkt_data += len1;<font></font>
      is-&gt;audio_pkt_size -= len1;<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data)<font></font>
      av_free_packet(pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">/* next packet */</span>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;audioq, pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_pkt_data = pkt-&gt;data;<font></font>
    is-&gt;audio_pkt_size = pkt-&gt;size;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(is-&gt;audio_buf_index &gt;= is-&gt;audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(is, is-&gt;audio_buf, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_buf));
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	is-&gt;audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(is-&gt;audio_buf, <span class="hljs-number">0</span>, is-&gt;audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	is-&gt;audio_buf_size = audio_size;<font></font>
      }<font></font>
      is-&gt;audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)is-&gt;audio_buf + is-&gt;audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    is-&gt;audio_buf_index += len1;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Uint32 <span class="hljs-title">sdl_refresh_timer_cb</span><span class="hljs-params">(Uint32 interval, <span class="hljs-keyword">void</span> *opaque)</span> </span>{<font></font>
  SDL_Event event;<font></font>
  event.type = FF_REFRESH_EVENT;<font></font>
  event.user.data1 = opaque;<font></font>
  SDL_PushEvent(&amp;event);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* 0 means stop timer */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* schedule a video refresh in 'delay' ms */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">schedule_refresh</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> delay)</span> </span>{<font></font>
  SDL_AddTimer(delay, sdl_refresh_timer_cb, is);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_display</span><span class="hljs-params">(VideoState *is)</span> </span>{<font></font>
<font></font>
  SDL_Rect rect;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">float</span> aspect_ratio;
  <span class="hljs-keyword">int</span> w, h, x, y;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-keyword">if</span>(is-&gt;video_ctx-&gt;sample_aspect_ratio.num == <span class="hljs-number">0</span>) {<font></font>
      aspect_ratio = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      aspect_ratio = av_q2d(is-&gt;video_ctx-&gt;sample_aspect_ratio) *<font></font>
	is-&gt;video_ctx-&gt;width / is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(aspect_ratio &lt;= <span class="hljs-number">0.0</span>) {<font></font>
      aspect_ratio = (<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;width /<font></font>
	(<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    h = screen-&gt;h;<font></font>
    w = ((<span class="hljs-keyword">int</span>)rint(h * aspect_ratio)) &amp; <span class="hljs-number">-3</span>;
    <span class="hljs-keyword">if</span>(w &gt; screen-&gt;w) {<font></font>
      w = screen-&gt;w;<font></font>
      h = ((<span class="hljs-keyword">int</span>)rint(w / aspect_ratio)) &amp; <span class="hljs-number">-3</span>;<font></font>
    }<font></font>
    x = (screen-&gt;w - w) / <span class="hljs-number">2</span>;<font></font>
    y = (screen-&gt;h - h) / <span class="hljs-number">2</span>;<font></font>
    <font></font>
    rect.x = x;<font></font>
    rect.y = y;<font></font>
    rect.w = w;<font></font>
    rect.h = h;<font></font>
    SDL_LockMutex(screen_mutex);<font></font>
    SDL_DisplayYUVOverlay(vp-&gt;bmp, &amp;rect);<font></font>
    SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
      <span class="hljs-comment">/* Now, normally here goes a ton of code
	 about timing, etc. we're just going to
	 guess at a delay for now. You can
	 increase and decrease this value and hard code
	 the timing - but I don't suggest that ;)
	 We'll learn how to do it for real later.
      */</span>
      schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
      <font></font>
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}<font></font>
      <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">alloc_picture</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-comment">// we already have one make another, bigger/smaller</span><font></font>
    SDL_FreeYUVOverlay(vp-&gt;bmp);<font></font>
  }<font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  SDL_LockMutex(screen_mutex);<font></font>
  vp-&gt;bmp = SDL_CreateYUVOverlay(is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
  SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  vp-&gt;width = is-&gt;video_ctx-&gt;width;<font></font>
  vp-&gt;height = is-&gt;video_ctx-&gt;height;<font></font>
  vp-&gt;allocated = <span class="hljs-number">1</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame)</span> </span>{<font></font>
<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">int</span> dst_pix_fmt;<font></font>
  AVPicture pict;<font></font>
<font></font>
  <span class="hljs-comment">/* wait until we have space for a new pic */</span><font></font>
  SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
  <span class="hljs-keyword">while</span>(is-&gt;pictq_size &gt;= VIDEO_PICTURE_QUEUE_SIZE &amp;&amp;<font></font>
	!is-&gt;quit) {<font></font>
    SDL_CondWait(is-&gt;pictq_cond, is-&gt;pictq_mutex);<font></font>
  }<font></font>
  SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;quit)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// windex is set to 0 initially</span><font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
<font></font>
  <span class="hljs-comment">/* allocate or resize the buffer! */</span>
  <span class="hljs-keyword">if</span>(!vp-&gt;bmp ||<font></font>
     vp-&gt;width != is-&gt;video_ctx-&gt;width ||<font></font>
     vp-&gt;height != is-&gt;video_ctx-&gt;height) {<font></font>
    SDL_Event event;<font></font>
<font></font>
    vp-&gt;allocated = <span class="hljs-number">0</span>;<font></font>
    alloc_picture(is);<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">/* We have a place to put our picture on the queue */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
<font></font>
    SDL_LockYUVOverlay(vp-&gt;bmp);<font></font>
    <font></font>
    dst_pix_fmt = PIX_FMT_YUV420P;<font></font>
    <span class="hljs-comment">/* point pict at the queue */</span><font></font>
<font></font>
    pict.data[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    pict.linesize[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(is-&gt;sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_ctx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(vp-&gt;bmp);<font></font>
    <span class="hljs-comment">/* now we inform our display thread that we have a pic ready */</span>
    <span class="hljs-keyword">if</span>(++is-&gt;pictq_windex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
      is-&gt;pictq_windex = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
    is-&gt;pictq_size++;<font></font>
    SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">video_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
  <span class="hljs-keyword">int</span> frameFinished;<font></font>
  AVFrame *pFrame;<font></font>
<font></font>
  pFrame = av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(is-&gt;video_ctx, pFrame, &amp;frameFinished, packet);<font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }      <font></font>
    }<font></font>
    av_free_packet(packet);<font></font>
  }<font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stream_component_open</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> stream_index)</span> </span>{<font></font>
<font></font>
  AVFormatContext *pFormatCtx = is-&gt;pFormatCtx;<font></font>
  AVCodecContext *codecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec *codec = <span class="hljs-literal">NULL</span>;<font></font>
  SDL_AudioSpec wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index &lt; <span class="hljs-number">0</span> || stream_index &gt;= pFormatCtx-&gt;nb_streams) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codec = avcodec_find_decoder(pFormatCtx-&gt;streams[stream_index]-&gt;codec-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!codec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codecCtx = avcodec_alloc_context3(codec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(codecCtx, pFormatCtx-&gt;streams[stream_index]-&gt;codec) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(codecCtx-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
    <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
    wanted_spec.freq = codecCtx-&gt;sample_rate;<font></font>
    wanted_spec.format = AUDIO_S16SYS;<font></font>
    wanted_spec.channels = codecCtx-&gt;channels;<font></font>
    wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
    wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
    wanted_spec.callback = audio_callback;<font></font>
    wanted_spec.userdata = is;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(avcodec_open2(codecCtx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(codecCtx-&gt;codec_type) {
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_AUDIO:<font></font>
    is-&gt;audioStream = stream_index;<font></font>
    is-&gt;audio_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;audio_ctx = codecCtx;<font></font>
    is-&gt;audio_buf_size = <span class="hljs-number">0</span>;<font></font>
    is-&gt;audio_buf_index = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(&amp;is-&gt;audio_pkt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_pkt));<font></font>
    packet_queue_init(&amp;is-&gt;audioq);<font></font>
    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_VIDEO:<font></font>
    is-&gt;videoStream = stream_index;<font></font>
    is-&gt;video_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;video_ctx = codecCtx;<font></font>
    packet_queue_init(&amp;is-&gt;videoq);<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);<font></font>
    is-&gt;sws_ctx = sws_getContext(is-&gt;video_ctx-&gt;width, is-&gt;video_ctx-&gt;height,<font></font>
				 is-&gt;video_ctx-&gt;pix_fmt, is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height, PIX_FMT_YUV420P,<font></font>
				 SWS_BILINEAR, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span><font></font>
				 );<font></font>
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decode_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> video_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> audio_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  is-&gt;videoStream=<span class="hljs-number">-1</span>;<font></font>
  is-&gt;audioStream=<span class="hljs-number">-1</span>;<font></font>
<font></font>
  global_video_state = is;<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, is-&gt;filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
<font></font>
  is-&gt;pFormatCtx = pFormatCtx;<font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, is-&gt;filename, <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++) {
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
       video_index &lt; <span class="hljs-number">0</span>) {<font></font>
      video_index=i;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
       audio_index &lt; <span class="hljs-number">0</span>) {<font></font>
      audio_index=i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(audio_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, audio_index);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(video_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, video_index);<font></font>
  }   <font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;videoStream &lt; <span class="hljs-number">0</span> || is-&gt;audioStream &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: could not open codecs\n"</span>, is-&gt;filename);
    <span class="hljs-keyword">goto</span> fail;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// main decode loop</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// seek stuff goes here</span>
    <span class="hljs-keyword">if</span>(is-&gt;audioq.size &gt; MAX_AUDIOQ_SIZE ||<font></font>
       is-&gt;videoq.size &gt; MAX_VIDEOQ_SIZE) {<font></font>
      SDL_Delay(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(av_read_frame(is-&gt;pFormatCtx, packet) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>(is-&gt;pFormatCtx-&gt;pb-&gt;error == <span class="hljs-number">0</span>) {<font></font>
	SDL_Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">/* no error; wait for user input */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      } <span class="hljs-keyword">else</span> {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;videoStream) {<font></font>
      packet_queue_put(&amp;is-&gt;videoq, packet);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;audioStream) {<font></font>
      packet_queue_put(&amp;is-&gt;audioq, packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(packet);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">/* all done - wait for it */</span>
  <span class="hljs-keyword">while</span>(!is-&gt;quit) {<font></font>
    SDL_Delay(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
<font></font>
 fail:<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){<font></font>
    SDL_Event event;<font></font>
    event.type = FF_QUIT_EVENT;<font></font>
    event.user.data1 = is;<font></font>
    SDL_PushEvent(&amp;event);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
<font></font>
  SDL_Event       event;<font></font>
<font></font>
  VideoState      *is;<font></font>
<font></font>
  is = av_mallocz(<span class="hljs-keyword">sizeof</span>(VideoState));<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  screen_mutex = SDL_CreateMutex();<font></font>
<font></font>
  av_strlcpy(is-&gt;filename, argv[<span class="hljs-number">1</span>], <span class="hljs-keyword">sizeof</span>(is-&gt;filename));<font></font>
<font></font>
  is-&gt;pictq_mutex = SDL_CreateMutex();<font></font>
  is-&gt;pictq_cond = SDL_CreateCond();<font></font>
<font></font>
  schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
<font></font>
  is-&gt;parse_tid = SDL_CreateThread(decode_thread, is);<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;parse_tid) {<font></font>
    av_free(is);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
<font></font>
    SDL_WaitEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> FF_QUIT_EVENT:
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      is-&gt;quit = <span class="hljs-number">1</span>;<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> FF_REFRESH_EVENT:<font></font>
      video_refresh_timer(event.user.data1);<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
}</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑุฉ ุนุงูุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุฑุฉ ุงูุฃุฎูุฑุฉ ุ ุฃุถููุง ุฏุนู ุงูุตูุช ุจุงุณุชุฎุฏุงู ููุฒุงุช ุงูุตูุช SDL. </font><font style="vertical-align: inherit;">ุฃุทูู SDL ุฎูุทูุง ูุฅุฌุฑุงุก ุนูููุงุช ุฑุฏ ูููุธููุฉ ุงูุชู ุญุฏุฏูุงูุง ูู ูู ูุฑุฉ ูุงูุช ููุงู ุญุงุฌุฉ ุฅูู ุตูุช. </font><font style="vertical-align: inherit;">ุงูุขู ุณููุนู ุงูุดูุก ููุณู ูุน ุนุฑุถ ุงูููุฏูู. </font><font style="vertical-align: inherit;">ููุฐุง ูุฌุนู ุงูุดูุฑุฉ ุฃูุซุฑ ูููุฐุฌูุฉ ูุฃุณูู ููุนูู ูุนูุง - ุฎุงุตุฉ ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฅุถุงูุฉ ุงูุชุฒุงูู. </font><font style="vertical-align: inherit;">ุฅุฐูุ ุฃูู ูุจุฏุฃุ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุญุธ ุฃู ูุธููุชูุง ุงูุฑุฆูุณูุฉ ุชุชุนุงูู ูุซูุฑูุง: ููู ุชูุฑ ุนุจุฑ ุญููุฉ ุงูุฃุญุฏุงุซ ุ ูุชูุฑุฃ ุงูุญุฒู ูุชููู ุจูู ุชุดููุฑ ุงูููุฏูู. ูุง ุณููุนูู ูู ุชูุณูู ูู ุดูุก ุฅูู ุฃุฌุฒุงุก: ุณูููู ูุฏููุง ุชูุงุฑ ูุณุคูู ุนู ูู ุญุฒู ุงูุจูุงูุงุช ุ ุซู ุชุชู ุฅุถุงูุฉ ูุฐู ุงูุญุฒู ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุฑุงุกุชูุง ูู ูุจู ุชุฏููุงุช ุงูุตูุช ูุงูููุฏูู ุงูููุงุจูุฉ. ููุฏ ูููุง ุจุงููุนู ุจุถุจุท ุฏูู ุงูุตูุช ููุง ูู ูุทููุจ ุ ูุน ุชุฏูู ุงูููุฏูู ุ ุณูููู ุงูุฃูุฑ ุฃูุซุฑ ุตุนูุจุฉ ุฅูู ุญุฏ ูุง ุ ุญูุซ ุณูุชุนูู ุนูููุง ุงูุชุฃูุฏ ูู ุนุฑุถ ุงูููุฏูู ุจููุฑุฏูุง. ุณูุถูู ุฑูุฒ ุงูุนุฑุถ ุงููุนูู ุฅูู ุงูุญููุฉ ุงูุฑุฆูุณูุฉ. ูููู ุจุฏูุงู ูู ุนุฑุถ ุงูููุฏูู ูู ูู ูุฑุฉ ูููุฐ ูููุง ุงูุญููุฉ ุ ูุฏูุฌ ุนุฑุถ ุงูููุฏูู ูู ุญููุฉ ุงูุญุฏุซ. ุชุชูุซู ุงูููุฑุฉ ูู ูู ุชุดููุฑ ุงูููุฏูู ุ ูุญูุธ ุงูุฅุทุงุฑ ุงููุณุชูู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุฃุฎุฑู ุ ุซู ุฅูุดุงุก ุญุฏุซ ุฎุงุต ุจู ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FF_REFRESH_EVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ุ ุงูุชู ูุถูููุง ุฅูู ูุธุงู ุงูุฃุญุฏุงุซ ุ ูุนูุฏูุง ุชุฑู ุญููุฉ ุงูุญุฏุซ ูุฏููุง ูุฐุง ุงูุญุฏุซ ุ ุณุชุนุฑุถ ุงูุฅุทุงุฑ ุงูุชุงูู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. ูู ูุง ููู ุชูุถูุญ ููุงุณุจ ูู ASCII ููุง ูุญุฏุซ:</font></font><br>
<br>
<div style="text-align:center;"><img width="335" height="221" src="https://habrastorage.org/webt/nf/ej/gq/nfejgqoqpypds3quordh_x2qgwa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุณุจุจ ุงูุฑุฆูุณู ูููู ุงูุชุญูู ูู ุนุฑุถ ุงูููุฏูู ูู ุฎูุงู ุญููุฉ ุงูุฃุญุฏุงุซ ูู ุฃูู ูู ุฎูุงู ุชุฏูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_Delay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููููุง ุงูุชุญูู ุจุฏูุฉ ุนูุฏ ุธููุฑ ุฅุทุงุฑ ุงูููุฏูู ุงูุชุงูู ุนูู ุงูุดุงุดุฉ. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุฒุงูู ุงูููุฏูู ุฃุฎูุฑูุง ูู ุงูุฏุฑุณ ุงูุชุงูู ุ ูุง ุนููู ุณูู ุฅุถุงูุฉ ุฑูุฒ ูุฌุฏููุฉ ุชุญุฏูุซ ุงูููุฏูู ุงูุชุงูู ุจุญูุซ ุชุธูุฑ ุงูุตูุฑุฉ ุงูุตุญูุญุฉ ุนูู ุงูุดุงุดุฉ ูู ุงูููุช ุงูููุงุณุจ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุจุณูุท ุงูุฑูุฒ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ูุณุญ ุงูุฑูุฒ ููููุงู. ูุฏููุง ูู ูุฐู ุงููุนูููุงุช ุญูู ุจุฑุงูุฌ ุชุฑููุฒ ุงูุตูุช ูุงูููุฏูู ุ ูุณูููู ุจุฅุถุงูุฉ ููุงุฆู ุงูุชุธุงุฑ ุ ููุฎุงุฒู ูุคูุชุฉ ุ ูุงููู ุฃุนูู ูุงุฐุง ุฃูุถูุง. ูู ูุฐู ุงูุฃุดูุงุก ูู ููุญุฏุฉ ููุทููุฉ ูุนููุฉ ุ ููู - ูููููู. ูุฐุง ุ ูุนุชุฒู ุฅูุดุงุก ุจููุฉ ูุจูุฑุฉ ุชุญุชูู ุนูู ูู ูุฐู ุงููุนูููุงุช ุชุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoState</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span><font></font>
<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  <span class="hljs-keyword">int</span>             videoStream, audioStream;<font></font>
  AVStream        *audio_st;<font></font>
  AVCodecContext  *audio_ctx;<font></font>
  PacketQueue     audioq;<font></font>
  <span class="hljs-keyword">uint8_t</span>         audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_size;
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_index;<font></font>
  AVPacket        audio_pkt;<font></font>
  <span class="hljs-keyword">uint8_t</span>         *audio_pkt_data;
  <span class="hljs-keyword">int</span>             audio_pkt_size;<font></font>
  AVStream        *video_st;<font></font>
  AVCodecContext  *video_ctx;<font></font>
  PacketQueue     videoq;<font></font>
<font></font>
  VideoPicture    pictq[VIDEO_PICTURE_QUEUE_SIZE];<font></font>
  <span class="hljs-keyword">int</span>             pictq_size, pictq_rindex, pictq_windex;<font></font>
  SDL_mutex       *pictq_mutex;<font></font>
  SDL_cond        *pictq_cond;<font></font>
  <font></font>
  SDL_Thread      *parse_tid;<font></font>
  SDL_Thread      *video_tid;<font></font>
<font></font>
  <span class="hljs-keyword">char</span>            filename[<span class="hljs-number">1024</span>];
  <span class="hljs-keyword">int</span>             quit;<font></font>
} VideoState;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ูุฑู ุชูููุญุงุช ุนูุง ุณูุญุตู ุนููู ูู ุงูููุงูุฉ. ุฃููุงู ุ ูุฑู ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ - ุณูุงู ุงูุชูุณูู ููุคุดุฑุงุช ุฏูู ุงูุตูุช ูุงูููุฏูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุงุฆูุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุงุจูุฉ </font><font style="vertical-align: inherit;">. ุซู ูุฑู ุฃู ุจุนุถ ูุฐู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุตูุชูุฉ ูุชู ููููุง ุฅูู ูุฐู ุงูุจููุฉ. ูุงูุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุตุตุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><b><font style="vertical-align: inherit;">audio_buf</font></b><font style="vertical-align: inherit;"> ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_buf_size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููุง ุฅูู ุฐูู) ููุญุตูู ุนูู ูุนูููุงุช ุญูู ุงูุตูุช ุงูุฐู ูุงู ูุง ูุฒุงู ููุฌูุฏูุง (ุฃู ููููุฏูุง). ุฃุถููุง ุทุงุจูุฑูุง ุขุฎุฑ ููููุฏูู ููุฎุฒููุง ูุคูุชูุง (ูุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููุงุฆูุฉ ุงูุชุธุงุฑ ุ ููุฐุง ูุง ูุญุชุงุฌ ุฅูู ุฃู ููุงุฆู ุงูุชุธุงุฑ ุจุงูุธุฉ) ููุฅุทุงุฑุงุช ุงูุชู ุชู ูู ุชุดููุฑูุง (ูุญููุธุฉ ูุชุฑุงูุจ). ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุฑุฉ ุงูููุฏูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ูุฐุง ูู ุตูุนูุง (ุณูุฑู ูุง ุณูููู ููู ุนูุฏูุง ูุตู ุฅููู). ููููู ุฃูุถูุง ููุงุญุธุฉ ุฃููุง ูุฏ ุฎุตุตูุง ูุคุดุฑุงุช ูุชูุงุฑูู ุฅุถุงูููู ุณููุดุฆููุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุนูุงูุฉ ุฎุฑูุฌ ูุงุณู ููู ูููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ุ ูุนูุฏ ุงูุขู ุฅูู ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ููุฑู ููู ูุบูุฑ ูุฐุง ุจุฑูุงูุฌูุง. ูููู ุจุฅุนุฏุงุฏ ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoState ุงูุฎุงุต</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุง </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
<font></font>
  SDL_Event       event;<font></font>
<font></font>
  VideoState      *is;<font></font>
<font></font>
  is = av_mallocz(<span class="hljs-keyword">sizeof</span>(VideoState));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_mallocz</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูู ูุธููุฉ ุฌูุฏุฉ ูู ุดุฃููุง ุชุฎุตูุต ุฐุงูุฑุฉ ููุง </font><b><font style="vertical-align: inherit;">ูุตูุฑูุง</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ูููู ุจุชููุฆุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃููุงููุง ููุฎุฒู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุนุฑุถ ุงููุคูุช ( </font><b><font style="vertical-align: inherit;">pictq</font></b><font style="vertical-align: inherit;"> ) ุ ูุธุฑูุง ูุฃู ุญููุฉ ุงูุญุฏุซ ุชุณุชุฏุนู ูุธููุฉ ุงูุนุฑุถ ุงูุฎุงุตุฉ ุจูุง - ุชุฐูุฑ ุ ุณุชููู ูุธููุฉ ุงูุนุฑุถ ุจุงุณุชุฑุฏุงุฏ ุงูุฅุทุงุฑุงุช ุงูุชู ุชู ูู ุชุดููุฑูุง ูุณุจููุง ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pictq</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูู ุงูููุช ููุณู ุ ุณูุถุน ุฌูุงุฒ ูู ุชุดููุฑ ุงูููุฏูู ูุฏููุง ูุนูููุงุช ููู - ูุง ูุนุฑู ูู ูุตู ุฃููุงู. ุฃุชููู ุฃู ุชููู ุฃู ูุฐู ุญุงูุฉ ุณุจุงู ููุงุณูููุฉ. ูุฐูู ุ ูููู ุจุชูุฒูุนู ุงูุขู ูุจู ุงูุจุฏุก ูู ุฃู ููุงุถูุน. ุฏุนููุง ุฃูุถูุง ูุณุฎ ุงุณู ุงููููู ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoState</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">av_strlcpy(is-&gt;filename, argv[<span class="hljs-number">1</span>], <span class="hljs-keyword">sizeof</span>(is-&gt;filename));<font></font>
<font></font>
is-&gt;pictq_mutex = SDL_CreateMutex();<font></font>
is-&gt;pictq_cond = SDL_CreateCond();</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_strlcpy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุฏุงูุฉ ูู FFmpeg ุชููู ุจุจุนุถ ุนูููุงุช ูุญุต ุงูุญุฏูุฏ ุงูุฅุถุงููุฉ ุฅูู ุฌุงูุจ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strncpy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฎูุทูุง ุงูุฃูู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนูุง ูุฏูุฑ ุฎููุทูุง ูููุนู ุดูุฆูุง ุญูููููุง:</font></font><br>
<br>
<pre><code class="cpp hljs">schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
<font></font>
is-&gt;parse_tid = SDL_CreateThread(decode_thread, is);<font></font>
<span class="hljs-keyword">if</span>(!is-&gt;parse_tid) {<font></font>
  av_free(is);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schedule_refresh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุธููุฉ ุณูุญุฏุฏูุง ูุงุญููุง. ูุง ุชูุนูู ูู ุฅุฎุจุงุฑ ุงููุธุงู ุจุฅูุชุงุฌ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FF_REFRESH_EVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุนุฏ ุงูุนุฏุฏ ุงููุญุฏุฏ ูู ุงููููู ุซุงููุฉ. ุณูุคุฏู ูุฐุง ุจุฏูุฑู ุฅูู ุงุณุชุฏุนุงุก ูุธููุฉ ุชุญุฏูุซ ุงูููุฏูู ุนูุฏูุง ูุฑุงูุง ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุญุฏุซ. ูููู ุงูุขู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CreateThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู SDL_CreateThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจุฐูู ููุท - ููู ูููุฏ ุณูุณูุฉ </font><b><font style="vertical-align: inherit;">ุฑุณุงุฆู</font></b><font style="vertical-align: inherit;"> ุฌุฏูุฏุฉ ููุง ุญู ุงููุตูู ุงููุงูู ุฅูู ูู ุฐุงูุฑุฉ ุงูุนูููุฉ ุงูุฃุตููุฉ ุ ููุจุฏุฃ ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฐู ูุชู ุชูููุฐู ุจูุงุณุทุฉ ุงููุธููุฉ ุงูุชู ูููุญูุง ููุง. ุณุชููู ูุฐู ุงููุธููุฉ ุฃูุถูุง ุจููู ุงูุจูุงูุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู. ูู ูุฐู ุงูุญุงูุฉ ุ ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decode_thread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () </font><b><font style="vertical-align: inherit;">ููุฑูู</font></b><font style="vertical-align: inherit;"> ุจููุฉ </font><b><font style="vertical-align: inherit;">VideoState ุงูุฎุงุตุฉ</font></b><font style="vertical-align: inherit;"> ุจูุง</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุง ููุฌุฏ ุดูุก ุฌุฏูุฏ ูู ุงููุตู ุงูุฃูู ูู ุงููุธููุฉ ุ ูููู ููุท ุจูุชุญ ุงูููู ูุงูุนุซูุฑ ุนูู ููุฑุณ ุชุฏููุงุช ุงูุตูุช ูุงูููุฏูู. ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูููู ุจู ุจุดูู ูุฎุชูู ูู ุงูุญูุงุธ ุนูู ุณูุงู ุงูุชูุณูู ูู ูููููุง ุงููุจูุฑ. ุจุนุฏ ุงูุนุซูุฑ ุนูู ููุงุฑุณ ุงูุชุฏูู ุงูุฎุงุตุฉ ุจูุง ุ ูุณูู ูุธููุฉ ุฃุฎุฑู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏุฏูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ </font><b><font style="vertical-align: inherit;">stream_component_open</font></b><font style="vertical-align: inherit;"> (). ูุฐู ุทุฑููุฉ ุทุจูุนูุฉ ุฅูู ุญุฏ ูุง ูููุตู ุ ูุจูุง ุฃููุง ูููู ุจุงููุซูุฑ ูู ุงูุฃุดูุงุก ุงูููุงุซูุฉ ูุฅุนุฏุงุฏ ุจุฑูุงูุฌ ุชุฑููุฒ ุงูููุฏูู ูุงูุตูุช ุ ูุฅููุง ูุนูุฏ ุงุณุชุฎุฏุงู ุจุนุถ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ููุง ูุฌุนููุง ูุธููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stream_component_open</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">() ูู ุงูููุงู ุงูุฐู ููุชุดู ููู ูุญุฏุฉ ูู ุงูุชุฑููุฒ ุงูุฎุงุตุฉ ุจูุง ุ ูุชูููู ูุนููุงุช ุงูุตูุช ุ ูุญูุธ ุงููุนูููุงุช ุงููููุฉ ูู ูููููุง ุงููุจูุฑ ูุฅุทูุงู ุชุฏููุงุช ุงูุตูุช ูุงูููุฏูู ุงูุฎุงุตุฉ ุจูุง. ูููู ููุง ุฃูุถูุง ุจุฅุฏุฎุงู ูุนููุงุช ุฃุฎุฑู ุ ูุซู ุงูุงุณุชุฎุฏุงู ุงููุณุฑู ูุจุฑูุงูุฌ ุงูุชุฑููุฒ ุจุฏูุงู ูู ุงููุดู ุงูุชููุงุฆู ุ ุฅูุฎ. ูุซูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stream_component_open</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> stream_index)</span> </span>{<font></font>
<font></font>
  AVFormatContext *pFormatCtx = is-&gt;pFormatCtx;<font></font>
  AVCodecContext *codecCtx;<font></font>
  AVCodec *codec;<font></font>
  SDL_AudioSpec wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index &lt; <span class="hljs-number">0</span> || stream_index &gt;= pFormatCtx-&gt;nb_streams) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codec = avcodec_find_decoder(pFormatCtx-&gt;streams[stream_index]-&gt;codec-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!codec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codecCtx = avcodec_alloc_context3(codec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(codecCtx, pFormatCtx-&gt;streams[stream_index]-&gt;codec) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(codecCtx-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
    <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
    wanted_spec.freq = codecCtx-&gt;sample_rate;<font></font>
    <span class="hljs-comment">/* ...etc... */</span><font></font>
    wanted_spec.callback = audio_callback;<font></font>
    wanted_spec.userdata = is;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(avcodec_open2(codecCtx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(codecCtx-&gt;codec_type) {
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_AUDIO:<font></font>
    is-&gt;audioStream = stream_index;<font></font>
    is-&gt;audio_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;audio_ctx = codecCtx;<font></font>
    is-&gt;audio_buf_size = <span class="hljs-number">0</span>;<font></font>
    is-&gt;audio_buf_index = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(&amp;is-&gt;audio_pkt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_pkt));<font></font>
    packet_queue_init(&amp;is-&gt;audioq);<font></font>
    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_VIDEO:<font></font>
    is-&gt;videoStream = stream_index;<font></font>
    is-&gt;video_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;video_ctx = codecCtx;<font></font>
    <font></font>
    packet_queue_init(&amp;is-&gt;videoq);<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);<font></font>
    is-&gt;sws_ctx = sws_getContext(is-&gt;video_st-&gt;codec-&gt;width, is-&gt;video_st-&gt;codec-&gt;height,<font></font>
				 is-&gt;video_st-&gt;codec-&gt;pix_fmt, is-&gt;video_st-&gt;codec-&gt;width,<font></font>
				 is-&gt;video_st-&gt;codec-&gt;height, PIX_FMT_YUV420P,<font></font>
				 SWS_BILINEAR, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span><font></font>
				 );<font></font>
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ุชูุฑูุจูุง ููุณ ุงูุฑูุฒ ุงูุฐู ูุงู ูุฏููุง ูู ูุจู ุ ุจุงุณุชุซูุงุก ุฃูู ุงูุขู ูุนูู ููุตูุช ูุงูููุฏูู. ูุงุญุธ ุฃูู ุจุฏูุงู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aCodecCtx ุ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููุง ุจุชูููู ูููููุง ุงููุจูุฑ ูุจูุงูุงุช ูุณุชุฎุฏู </font><b><font style="vertical-align: inherit;">ูุงุณุชุฏุนุงุกูุง</font></b><font style="vertical-align: inherit;"> ุงูุตูุชู. ูููุง ุฃูุถูุง ุจุญูุธ ุงูุชุฏููุงุช ููุณูุง ุนูู ุฃููุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_st</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video_st</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฃุถููุง ุฃูุถูุง ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูููุฏูู ุงูุฎุงุตุฉ ุจูุง ููููุง ุจุฅุนุฏุงุฏูุง ุชูุงููุง ูุซู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุช ุงูุฎุงุตุฉ ุจูุง. ุฎูุงุตุฉ ุงูููู ูู ุชุดุบูู ุชุฏููุงุช ุงูููุฏูู ูุงูุตูุช. ุชููู ูุฐู ุงูุจุชุงุช ุจูุง ููู:</font></font><br>
<br>
<pre><code class="cpp hljs">    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;<font></font>
<font></font>
<span class="hljs-comment">/* ...... */</span><font></font>
<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฐูุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_PauseAudio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูู ุงูุฏุฑุณ ุงูุฃุฎูุฑ. </font><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CreateThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุจููุณ ุงูุทุฑููุฉ. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฑุฌุน ุฅูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธููุฉ </font><b><font style="vertical-align: inherit;">video_thread</font></b><font style="vertical-align: inherit;"> (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ุฐูู ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนูุฏ ุฅูู ุงููุตู ุงูุซุงูู ูู </font><b><font style="vertical-align: inherit;">ุฏุงูุฉ decode_thread</font></b><font style="vertical-align: inherit;"> (). ุจุดูู ุฃุณุงุณู ุ ุฅููุง ูุฌุฑุฏ ุญููุฉ ููุฑุงุกุฉ ุงูุญุฒูุฉ ููุถุนูุง ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุตุญูุญุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// seek stuff goes here</span>
    <span class="hljs-keyword">if</span>(is-&gt;audioq.size &gt; MAX_AUDIOQ_SIZE ||<font></font>
       is-&gt;videoq.size &gt; MAX_VIDEOQ_SIZE) {<font></font>
      SDL_Delay(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(av_read_frame(is-&gt;pFormatCtx, packet) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>((is-&gt;pFormatCtx-&gt;pb-&gt;error) == <span class="hljs-number">0</span>) {<font></font>
	SDL_Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">/* no error; wait for user input */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      } <span class="hljs-keyword">else</span> {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;videoStream) {<font></font>
      packet_queue_put(&amp;is-&gt;videoq, packet);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;audioStream) {<font></font>
      packet_queue_put(&amp;is-&gt;audioq, packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(packet);<font></font>
    }<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ููุฌุฏ ุดูุก ุฌุฏูุฏ ุญููุง ููุง ุ ุจุงุณุชุซูุงุก ุฃู ูุฏููุง ุงูุขู ุฃูุตู ุญุฌู ููุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุช ูุงูููุฏูู ุ ููุฏ ุฃุถููุง ุชุฏููู ุฃุฎุทุงุก ุงููุฑุงุกุฉ. ูุญุชูู ุณูุงู ุงูุชูุณูู ุนูู ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ByteIOContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุงุฎู </font><font style="vertical-align: inherit;">ุชุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pb</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ByteIOContext</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุจููุฉ ุชููู ุจุชุฎุฒูู ุฌููุน ุงููุนูููุงุช ุญูู ุงููููุงุช ุฐุงุช ุงููุณุชูู ุงูููุฎูุถ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุงูุชูุฑุงุฑ ุ ูุฏููุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชู ุชูุชุธุฑ ุญุชู ููุชูู ุงูุจุฑูุงูุฌ ุฃู ูุจูุบ ุนูู. ูุฐุง ุงูุฑูุฒ ูููุฏ ูุฃูู ููุถุญ ููููุฉ ุฏูุน ุงูุฃุญุฏุงุซ - ููู ุดูุก ุณูุญุชุงุฌู ูุงุญููุง ูุนุฑุถ ุงูููุฏูู:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">while</span>(!is-&gt;quit) {<font></font>
    SDL_Delay(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
<font></font>
 fail:<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){<font></font>
    SDL_Event event;<font></font>
    event.type = FF_QUIT_EVENT;<font></font>
    event.user.data1 = is;<font></font>
    SDL_PushEvent(&amp;event);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุตู ุนูู ููู ููุฃุญุฏุงุซ ุงููุฎุตุตุฉ ุจุงุณุชุฎุฏุงู ุซุงุจุช SDL </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_USEREVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุฌุจ ุชุนููู ุญุฏุซ ุงููุณุชุฎุฏู ุงูุฃูู ุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_USEREVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ู </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_USEREVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 1</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชุงูู </font><font style="vertical-align: inherit;">ุ ููุง ุฅูู ุฐูู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนุฑูู </font><b><font style="vertical-align: inherit;">FF_QUIT_EVENT</font></b><font style="vertical-align: inherit;"> ูู ุจุฑูุงูุฌูุง ุนูู ุฃูู </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_USEREVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 1</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูููููุง ุฃูุถูุง ุชูุฑูุฑ ุจูุงูุงุช ุงููุณุชุฎุฏู ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูููุง ููุฑุฑ ูุคุดุฑูุง ุฅูู ูููู ูุจูุฑ. ุฃุฎูุฑูุง ุ ูุณูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_PushEvent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). ูู ุชุจุฏูู ุญููุฉ ุงูุญุฏุซ ุ ูููุง ุจูุถุน ูุฐุง ูู ูุณู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_QUIT_EVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ูุงู ูุฏููุง ูู ูุจู. </font><font style="vertical-align: inherit;">ุณูุฑู ุฏูุฑุฉ ุงูุฃุญุฏุงุซ ูุฏููุง ุจูุฒูุฏ ูู ุงูุชูุตูู ุ </font><font style="vertical-align: inherit;">ูู ุงูููุช ุงูุญุงูู ุ ุชุฃูุฏ ููุท ุฃููุง ุนูุฏูุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถุบุท ุนูู FF_QUIT_EVENT ุ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅููุง </font><b><font style="vertical-align: inherit;">ููุชูุทูุง</font></b><font style="vertical-align: inherit;"> ูุงุญููุง </font><b><font style="vertical-align: inherit;">ููุจุฏู</font></b><font style="vertical-align: inherit;"> ุนูุงูุฉ ุงูุฎุฑูุฌ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑ ุงูุงุณุชูุงู: video_thread</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฅุนุฏุงุฏ ุจุฑูุงูุฌ ุงูุชุฑููุฒ ุ ููููู ุจุฏุก ุฏูู ุงูููุฏูู. </font><font style="vertical-align: inherit;">ููุฑุฃ ูุฐุง ุงูุฏูู ุงูุญุฒู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูููุฏูู ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุชุดููุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุฏูู ูู ุฅุทุงุฑุงุช ุ ุซู ูุณุชุฏุนู ูุธููุฉ </font><b><font style="vertical-align: inherit;">queue_picture</font></b><font style="vertical-align: inherit;"> ููุถุน ุงูุฅุทุงุฑ ุงูุฐู ุชูุช ูุนุงูุฌุชู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุฑ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">video_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
  <span class="hljs-keyword">int</span> frameFinished;<font></font>
  AVFrame *pFrame;<font></font>
<font></font>
  pFrame = av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(is-&gt;video_st-&gt;codec, pFrame, &amp;frameFinished, packet);<font></font>
<font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    av_free_packet(packet);<font></font>
  }<font></font>
  av_free(pFrame);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ููู ูุนุธู ูุฐู ุงููุธููุฉ ุงูุขู. </font><font style="vertical-align: inherit;">ููุฏ ูููุง ููุชู ุจูุณุฎ ูุธููุฉ avcodec_decode_video2 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุจุจุณุงุทุฉ ุงุณุชุจุฏุงู ุจุนุถ ุงูุญุฌุฌ ุ </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูุฏููุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVStream</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฎุฒูุฉ ูู ูููููุง ุงููุจูุฑ ุ ูุฐูู ูุญุตู ุนูู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ูู ููุงู. </font><font style="vertical-align: inherit;">ูุณุชูุฑ ููุท ูู ุชููู ุงูุญุฒู ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูููุฏูู ุญุชู ูุฎุจุฑูุง ุดุฎุต ูุง ุจุงูุฎุฑูุฌ ุฃู ูุฌุฏ ุฎุทุฃู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ุงููุธููุฉ ุงูุชู ุชุฎุฒู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pFrame ุงูุฎุงุต</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุง ุงูุฐู ุชู ูู ุชุฑููุฒู </font><font style="vertical-align: inherit;">ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุฑ ูุฏููุง. ูุธุฑูุง ูุฃู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุฑ ุงูุฎุงุตุฉ ุจูุง ุนุจุงุฑุฉ ุนู ุชุฑุงูุจ ูู SDL (ูู ุงูููุชุฑุถ ุฃู ุชุณูุญ ููุธููุฉ ุนุฑุถ ุงูููุฏูู ุจุฃุฏุงุก ุฃูู ูุฏุฑ ูููู ูู ุงูุญุณุงุจ) ุ ูุญุชุงุฌ ุฅูู ุชุญููู ุฅุทุงุฑูุง ุฅูู ุฐูู. ุงูุจูุงูุงุช ุงูุชู ูุฎุฒููุง ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุฑ ูู ุงูุจููุฉ ุงูุชู ุฃูุดุฃูุงูุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  SDL_Overlay *bmp;<font></font>
  <span class="hljs-keyword">int</span> width, height; <span class="hljs-comment">/* source height &amp; width */</span>
  <span class="hljs-keyword">int</span> allocated;<font></font>
} VideoPicture;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุชูู ูููููุง ุงููุจูุฑ ุนูู ูุฎุฒู ูุคูุช ููุฐู ุงููููุงุช ุ ุญูุซ ูููููุง ุชุฎุฒูููุง. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชูุฒูุน </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_Overlay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุฃููุณูุง (ุงูุชุจู ุฅูู ุงูุนูุงูุฉ ุงููุนููุฉ ุ ูุงูุชู ุชูุถุญ ูุง ุฅุฐุง ูููุง ุจุฐูู ุฃู ูุง). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุณุชุฎุฏุงู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฐู ุ ูุฏููุง ูุคุดุฑูู - ููุฑุณ ุงููุชุงุจุฉ ูููุฑุณ ุงููุฑุงุกุฉ. </font><font style="vertical-align: inherit;">ูุชุชุจุน ุฃูุถูุง ุนุฏุฏ ุงูุตูุฑ ุงููุนููุฉ ุงูููุฌูุฏุฉ ูู ุงููุฎุฒู ุงููุคูุช. </font><font style="vertical-align: inherit;">ูููุชุงุจุฉ ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ููุชุธุฑ ุฃููุงู ุญุชู ูุชู ูุณุญ ุงููุฎุฒู ุงููุคูุช ุ ุจุญูุซ ูููู ูุฏููุง ููุงู ูุชุฎุฒูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฏููุง </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุซู ูุชุญูู ููุฑู ูุง ุฅุฐุง ูููุง ุจุชุนููู ุงูุชุฑุงูุจ ูู ููุฑุณูุง ุงูููุงุณูุ </font><font style="vertical-align: inherit;">ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุชุฎุตูุต ุฐุงูุฑุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุนูููุง ุฃูุถูุง ุฅุนุงุฏุฉ ุชุฎุตูุต ุงููุฎุฒู ุงููุคูุช ุฅุฐุง ุชุบูุฑ ุญุฌู ุงููุงูุฐุฉ!</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame)</span> </span>{<font></font>
<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">int</span> dst_pix_fmt;<font></font>
  AVPicture pict;<font></font>
<font></font>
  <span class="hljs-comment">/* wait until we have space for a new pic */</span><font></font>
  SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
  <span class="hljs-keyword">while</span>(is-&gt;pictq_size &gt;= VIDEO_PICTURE_QUEUE_SIZE &amp;&amp;<font></font>
	!is-&gt;quit) {<font></font>
    SDL_CondWait(is-&gt;pictq_cond, is-&gt;pictq_mutex);<font></font>
  }<font></font>
  SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;quit)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// windex is set to 0 initially</span><font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
<font></font>
  <span class="hljs-comment">/* allocate or resize the buffer! */</span>
  <span class="hljs-keyword">if</span>(!vp-&gt;bmp ||<font></font>
     vp-&gt;width != is-&gt;video_st-&gt;codec-&gt;width ||<font></font>
     vp-&gt;height != is-&gt;video_st-&gt;codec-&gt;height) {<font></font>
    SDL_Event event;<font></font>
<font></font>
    vp-&gt;allocated = <span class="hljs-number">0</span>;<font></font>
    alloc_picture(is);<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนูุง ูููู ูุธุฑุฉ ุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุธููุฉ ุงููุฎุตุตุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><b><font style="vertical-align: inherit;">ุชุตููุฑ</font></b><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">alloc_picture</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-comment">// we already have one make another, bigger/smaller</span><font></font>
    SDL_FreeYUVOverlay(vp-&gt;bmp);<font></font>
  }<font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  SDL_LockMutex(screen_mutex);<font></font>
  vp-&gt;bmp = SDL_CreateYUVOverlay(is-&gt;video_st-&gt;codec-&gt;width,<font></font>
				 is-&gt;video_st-&gt;codec-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
  SDL_UnlockMutex(screen_mutex);<font></font>
  vp-&gt;width = is-&gt;video_st-&gt;codec-&gt;width;<font></font>
  vp-&gt;height = is-&gt;video_st-&gt;codec-&gt;height;  <font></font>
  vp-&gt;allocated = <span class="hljs-number">1</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุฃู ุชุชุนุฑู ุนูู ุงููุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_CreateYUVOverlay</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุงูุชู ุงูุชูููุง ุฅูููุง ูู </font><b><font style="vertical-align: inherit;">ุญููุชูุง</font></b><font style="vertical-align: inherit;"> ุงูุฑุฆูุณูุฉ ุฅูู ูุฐุง ุงููุณู. ูุฌุจ ุฃู ูููู ูุฐุง ุงูุฑูุฒ ูุงุถุญูุง ุจุดูู ูุนููู ุญุชู ุงูุขู. ููุน ุฐูู ุ ูุฏููุง ุงูุขู ููู mutex ุ ูุฃู ููุถูุนูู ูุง ููููููุง ูุชุงุจุฉ ุงููุนูููุงุช ุนูู ุงูุดุงุดุฉ ูู ููุช ูุงุญุฏ! ูู ูุณูุญ ุฐูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุฏุฎู ูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธููุฉ </font><b><font style="vertical-align: inherit;">custom_picture</font></b><font style="vertical-align: inherit;"> ุจูุธููุฉ </font><font style="vertical-align: inherit;">ุฃุฎุฑู ุชุนุฑุถ ุงูุตูุฑุฉ. (ููุฏ ุฃูุดุฃูุง ูุฐุง ุงูููู ููุชุบูุฑ </font><font style="vertical-align: inherit;">ุนุงู </font><b><font style="vertical-align: inherit;">ููููุง ุจุชููุฆุชู ุจุดูู </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุฆูุณู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ุงูุธุฑ ุงูููุฏ.) ุชุฐูุฑ ุฃููุง ูุญุงูุธ ุนูู ุงูุนุฑุถ ูุงูุงุฑุชูุงุน ูู ุจููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฃููุง ุจุญุงุฌุฉ ููุชุฃูุฏ ูู ุฃู ุญุฌู ููุทุน ุงูููุฏูู ุงูุฎุงุต ุจูุง ูุง ูุชุบูุฑ ูุณุจุจ ูุง. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุณููุง ุ ููุฏ ูููุง ุจุชุณููุชูุง ุ ููุฏููุง ุชุฑุงูุจ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑุณุฉ ูุฌุงูุฒุฉ ูุงุณุชูุจุงู ุงูุตูุฑุฉ. ุฏุนูุง ูุนูุฏ ุฅูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queue_picture ููููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธุฑุฉ ุนูู ุงูุฑูุฒ ููุณุฎ ุงูุฅุทุงุฑ ุฅูู ุงูุชุฑุงูุจ. ูุฌุจ ุฃู ูููู ูุฐุง ุงูุฌุฒุก ูุฃููููุง ูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame)</span> </span>{<font></font>
<font></font>
  <span class="hljs-comment">/* Allocate a frame if we need it... */</span>
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-comment">/* We have a place to put our picture on the queue */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
<font></font>
    SDL_LockYUVOverlay(vp-&gt;bmp);<font></font>
    <font></font>
    dst_pix_fmt = PIX_FMT_YUV420P;<font></font>
    <span class="hljs-comment">/* point pict at the queue */</span><font></font>
<font></font>
    pict.data[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    pict.linesize[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(is-&gt;sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_st-&gt;codec-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(vp-&gt;bmp);<font></font>
    <span class="hljs-comment">/* now we inform our display thread that we have a pic ready */</span>
    <span class="hljs-keyword">if</span>(++is-&gt;pictq_windex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
      is-&gt;pictq_windex = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
    is-&gt;pictq_size++;<font></font>
    SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุ ูุนุธููุง ูุฌุฑุฏ ุฑูุฒ ุงุณุชุฎุฏููุงู ุณุงุจููุง ูููุก ุชุฑุงูุจ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YUV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุฅุทุงุฑูุง </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุงูุฌุฒุก ุงูุฃุฎูุฑ ุจุจุณุงุทุฉ "ูุถูู" ูููุชูุง ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. </font><font style="vertical-align: inherit;">ุชุนูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ููุชู ุฅุถุงูุฉ ุงูููู ุฅูููุง ุญุชู ุชูุชูุฆ ุ ูุชุญุฏุซ ุงููุฑุงุกุฉ ูููุง ุฃุซูุงุก ูุฌูุฏ ุดูุก ุนูู ุงูุฃูู ูููุง. </font><font style="vertical-align: inherit;">ูุฐููุ ูู ูุฐุง ูุชููู ุนูู ูููุฉ </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุบูุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pictq_size</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุงูุฃูุฑ ุงูุฐู ูุชุทูุจ ููุง ูููุน ุฐูู. </font><font style="vertical-align: inherit;">ูุฐุง ุ ูุงุฐุง ููุนู ููุง: ูู ุจุฒูุงุฏุฉ ูุคุดุฑ ุงูุชุณุฌูู (ูุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุงุจุฏุฃ ูู ุฌุฏูุฏ) ุ ุซู ูู ุจุญุฌุจ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฒูุงุฏุฉ ุญุฌููุง. </font><font style="vertical-align: inherit;">ุงูุขู ุณูุนุฑู ุงููุงุฑุฆ ุฃู ููุงู ุงููุฒูุฏ ูู ุงููุนูููุงุช ุญูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ูุฅุฐุง ูุงู ูุฐุง ูุฌุนู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฏููุง ููุชูุฆุฉ ุ ูุณูุนุฑู ูุณุฌููุง ุนููุง.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฑุถ ุงูููุฏูู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ูุง ูู ููุถูุน ุงูููุฏูู! ููุฏ ุฃููููุง ุงูุขู ุฌููุน ุณูุงุณู ุงููุญุงุฏุซุงุช ุงููุฌุงููุฉ ุ ุจุงุณุชุซูุงุก ุณูุณูุฉ ูุงุญุฏุฉ - ูู ุชุชุฐูุฑ ููู ููุง ูุทูู ุนูู ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schedule_refresh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () </font><font style="vertical-align: inherit;">ููุฐ ููุช ุทููู </font><font style="vertical-align: inherit;">ุ ุฃูู ูุธุฑุฉ ุนูู ูุง ุญุฏุซ ุจุงููุนู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* schedule a video refresh in 'delay' ms */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">schedule_refresh</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> delay)</span> </span>{<font></font>
  SDL_AddTimer(delay, sdl_refresh_timer_cb, is);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_AddTimer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ูู ูุธููุฉ SDL ุชููู ุจุจุณุงุทุฉ </font><b><font style="vertical-align: inherit;">ุจุงุณุชุฏุนุงุก</font></b><font style="vertical-align: inherit;"> ุฏุงูุฉ ูุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ุจุนุฏ ุนุฏุฏ ูุนูู ูู ุงููููู ุซุงููุฉ (ูุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ุชููู ุจุนุถ ุงูุจูุงูุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู). ุณูุณุชุฎุฏู ูุฐู ุงููุธููุฉ ูุฌุฏููุฉ ุชุญุฏูุซุงุช ุงูููุฏูู - ูู ูู ูุฑุฉ ูุณูููุง ุ ุชููู ุจุชุนููู ูุคูุช ูููู ุจุชุดุบูู ุญุฏุซ ุ ูุงูุฐู ุจุฏูุฑู ุณูุคุฏู </font><font style="vertical-align: inherit;">ุฅูู ุงุณุชุฏุนุงุก ูุธููุชูุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฑุฆูุณูุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ููุธููุฉ ุชุณุชุฎุฑุฌ ุฅุทุงุฑูุง ูู ุตูุฑุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุชุนุฑุถ ููุง! ุนููุง! ุซูุงุซุฉ "ุฃู / ุฃู / ุฃู / ุฃู" ูู ุฌููุฉ ูุงุญุฏุฉ! ูุฐุง ุ ูููุนู ุฃูู ุดูุก ููุนูู - ุฃุทูู ูุฐุง ุงูุญุฏุซ. ููุฐุง ูุฑุณููุง ุฅูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> Uint32 <span class="hljs-title">sdl_refresh_timer_cb</span><span class="hljs-params">(Uint32 interval, <span class="hljs-keyword">void</span> *opaque)</span> </span>{<font></font>
  SDL_Event event;<font></font>
  event.type = FF_REFRESH_EVENT;<font></font>
  event.user.data1 = opaque;<font></font>
  SDL_PushEvent(&amp;event);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* 0 means stop timer */</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ุฅุทูุงู ุงูุญุฏุซ ูู ูุจู ุตุฏูููุง ุงููุฏูู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุนุฑูู </font><b><font style="vertical-align: inherit;">FF_REFRESH_EVENT</font></b><font style="vertical-align: inherit;"> ููุง ุนูู ุฃูู </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDL_USEREVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 1</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุนูุฏูุง ูุฑุฌุน 0 ุ ูููู SDL ุจุฅููุงู ุงููุคูุช ุ ูุฐูู ูุง ูุชู ุชูููุฐ ุฑุฏ ุงูุงุชุตุงู ูุฑุฉ ุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุจุนุฏ ุฃู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุชุตููุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจู </font><b><font style="vertical-align: inherit;">FF_REFRESH_EVENT</font></b><font style="vertical-align: inherit;"> ูุฑุฉ ุฃุฎุฑู </font><font style="vertical-align: inherit;">ุ ูุญุชุงุฌ ุฅูู </font><b><font style="vertical-align: inherit;">ูุนุงูุฌุชู</font></b><font style="vertical-align: inherit;"> ูู ุญููุฉ ุงูุฃุญุฏุงุซ ูุฏููุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span>(;;) {<font></font>
<font></font>
  SDL_WaitEvent(&amp;event);<font></font>
  <span class="hljs-keyword">switch</span>(event.type) {
  <span class="hljs-comment">/* ... */</span>
  <span class="hljs-keyword">case</span> FF_REFRESH_EVENT:<font></font>
    video_refresh_timer(event.user.data1);<font></font>
    <span class="hljs-keyword">break</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุงูุฐู ูุฑุณููุง ููุง ุฅูู ูุฐู ุงููุธููุฉ ุ ูุงูุชู ุชุณุชุฎุฑุฌ ุจุงููุนู ุงูุจูุงูุงุช ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุตูุฑ ุงูุฎุงุตุฉ ุจูุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
      <span class="hljs-comment">/* Timing code goes here */</span><font></font>
<font></font>
      schedule_refresh(is, <span class="hljs-number">80</span>);<font></font>
      <font></font>
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูููุช ุงูุญุงูู ุ ูุฐู ุงููุธููุฉ ุจุณูุทุฉ ุฌุฏูุง: ููู ุชุนุงูุฌ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุนูุฏูุง ูููู ูุฏููุง ุดูุก ูุง ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุถุจุท ูุคูุชูุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุนุฑุถ ุฅุทุงุฑ ุงูููุฏูู ุงูุชุงูู ุ ูุชุณุชุฏุนู </font><b><font style="vertical-align: inherit;">video_display</font></b><font style="vertical-align: inherit;"> ูุนุฑุถ ุงูููุฏูู ุนูู ุงูุดุงุดุฉ ุจุงููุนู ุ ุซู ุชุฒูุฏ ุงูุนุฏุงุฏ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุ ูุน ุชูููู ุญุฌูู. ูุฏ ุชูุงุญุธ ุฃููุง ูุง ูููู ุจุฃู ุดูุก ุจุงุณุชุฎุฏุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุฐู ุงููุธููุฉ ุ ูุฅููู ุงูุณุจุจ: ูุฐุง ูู ุงููุณุชูุจู. ูููู ุจุนุฏ ุฐูู ุจูููู. ุณูุณุชุฎุฏูู ูููุตูู ุฅูู ูุนูููุงุช ุงูููุช ุนูุฏูุง ูุจุฏุฃ ูู ูุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช. ููุง ุ ุฃูู ูุธุฑุฉ ุนูู ุงูููุงู ูู ุงูุฑูุฒ ุญูุซ ุชุชู ูุชุงุจุฉ ุงูุชุนููู "ุฑูุฒ ุงูุชูููุช ููุง". ูู ูุฐุง ุงููุณู ุ ุณููุชุดู ูุชู ูุฌุจ ุฃู ูุนุฑุถ ุฅุทุงุฑ ุงูููุฏูู ุงูุชุงูู ุ ุซู ูุฏุฎู ูุฐู ุงููููุฉ ูู ุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏูู ุงูุฒููู.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(). ูู ุงูููุช ุงูุญุงูู ุ ูุฏุฎู ููุท ูููุฉ ููููุฉ 80. ูู ุงููุงุญูุฉ ุงููููุฉ ุ ููููู ุชุฎููู ูุฐู ุงููููุฉ ูุงูุชุญูู ูููุง ูุฅุนุงุฏุฉ ุชุฌููุนูุง ููู ูููู ุ ูููู: 1) ุณุชุจุฏุฃ ูู ุงูุชุจุงุทุค ุจุนุฏ ูุชุฑุฉ ูู ุงูููุช ู 2) ุฅููุง ุบุจูุฉ ุฌุฏูุง. ุนูู ุงูุฑุบู ูู ุฃููุง ูู ุงููุณุชูุจู ุณูุนูุฏ ุฅูู ูุฐู ุงูููุทุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญู ุนูู ูุดู ุงูุฅูุชูุงุก. ูุจูู ุฃู ุชูุนู ุดูุฆูุง ูุงุญุฏูุง ููุท: ุนุฑุถ ุงูููุฏูู! ูููุง ููู ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video_display</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_display</span><span class="hljs-params">(VideoState *is)</span> </span>{<font></font>
<font></font>
  SDL_Rect rect;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">float</span> aspect_ratio;
  <span class="hljs-keyword">int</span> w, h, x, y;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-keyword">if</span>(is-&gt;video_st-&gt;codec-&gt;sample_aspect_ratio.num == <span class="hljs-number">0</span>) {<font></font>
      aspect_ratio = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      aspect_ratio = av_q2d(is-&gt;video_st-&gt;codec-&gt;sample_aspect_ratio) *<font></font>
	is-&gt;video_st-&gt;codec-&gt;width / is-&gt;video_st-&gt;codec-&gt;height;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(aspect_ratio &lt;= <span class="hljs-number">0.0</span>) {<font></font>
      aspect_ratio = (<span class="hljs-keyword">float</span>)is-&gt;video_st-&gt;codec-&gt;width /<font></font>
	(<span class="hljs-keyword">float</span>)is-&gt;video_st-&gt;codec-&gt;height;<font></font>
    }<font></font>
    h = screen-&gt;h;<font></font>
    w = ((<span class="hljs-keyword">int</span>)rint(h * aspect_ratio)) &amp; <span class="hljs-number">-3</span>;
    <span class="hljs-keyword">if</span>(w &gt; screen-&gt;w) {<font></font>
      w = screen-&gt;w;<font></font>
      h = ((<span class="hljs-keyword">int</span>)rint(w / aspect_ratio)) &amp; <span class="hljs-number">-3</span>;<font></font>
    }<font></font>
    x = (screen-&gt;w - w) / <span class="hljs-number">2</span>;<font></font>
    y = (screen-&gt;h - h) / <span class="hljs-number">2</span>;<font></font>
    <font></font>
    rect.x = x;<font></font>
    rect.y = y;<font></font>
    rect.w = w;<font></font>
    rect.h = h;<font></font>
    SDL_LockMutex(screen_mutex);<font></font>
    SDL_DisplayYUVOverlay(vp-&gt;bmp, &amp;rect);<font></font>
    SDL_UnlockMutex(screen_mutex);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃู ุงูุดุงุดุฉ ูููู ุฃู ุชููู ุจุฃู ุญุฌู (ูููุง ุจุชุซุจูุช 640 ร 480 ุ ูููุงู ุทุฑู ูุชูููููุง ุจุญูุซ ูุชู ุชุบููุฑ ุญุฌู ุงููุณุชุฎุฏู) ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุญุฌู ุงูููุทูุฉ ุงููุณุชุทููุฉ ูููููู ุจุดูู ุฏููุงูููู. ูุฐูู ุ ุชุญุชุงุฌ ุฃููุงู ุฅูู ูุนุฑูุฉ ูุณุจุฉ ุงูุนุฑุถ ุฅูู ุงูุงุฑุชูุงุน ูููููู ุ ููุท ุงูุนุฑุถ ููุณูููุง ุนูู ุงูุงุฑุชูุงุน. ุณูููู ูุจุนุถ ุจุฑุงูุฌ ุงูุชุฑููุฒ ูุณุจุฉ ุนุฑุถ ุฅูู ุงุฑุชูุงุน ูุฑุฏูุฉ ููุนููุฉ ุ ููู ุจุจุณุงุทุฉ ุนุฑุถ / ุงุฑุชูุงุน ุจูุณู ูุงุญุฏ ุฃู ุนููุฉ. ูุธุฑูุง ูุฃู ููู ุงูุงุฑุชูุงุน ูุงูุนุฑุถ ูู ุณูุงู ุจุฑูุงูุฌ ุงูุชุฑููุฒ ุงูุฎุงุต ุจูุง ูุชู ููุงุณูุง ุจุงูุจูุณู ุ ูุฅู ูุณุจุฉ ุงูุนุฑุถ ุฅูู ุงูุงุฑุชูุงุน ุงููุนููุฉ ุชุณุงูู ูุณุจุฉ ุงูุนุฑุถ ุฅูู ุงูุงุฑุชูุงุน ูุถุฑูุจุฉ ูู ูุณุจุฉ ุงูุนุฑุถ ุฅูู ุงูุงุฑุชูุงุน ููุนููุฉ. ุณุชุนุฑุถ ุจุนุถ ุจุฑุงูุฌ ุงูุชุฑููุฒ ูุณุจุฉ ุนุฑุถ ุฅูู ุงุฑุชูุงุน 0 ุ ููุง ูุนูู ุฃู ุญุฌู ูู ุจูุณู 1x1. ุซู ูููุณ ุงููููู ุจูุฐู ุงูุทุฑููุฉุจุญูุซ ุชูุงุณุจูุง ุนูู ุงูุดุงุดุฉ ูุฏุฑ ุงูุฅููุงู. ุนูุณ ุงูุจุช</font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp; -3</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุจุณุงุทุฉ ุชูุฑูุจ ุงููููุฉ ุฅูู ุฃูุฑุจ ูุถุงุนู ุฃุฑุจุนุฉ. </font><font style="vertical-align: inherit;">ุซู ูู</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุชูุณูุท</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููููู</font><b><font style="vertical-align: inherit;"> ูุงุณุชุฏุนู SDL_DisplayYUVOverlay</font></b><font style="vertical-align: inherit;"> () ููุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ูุงุฆู ุงูุดุงุดุฉ</font><b><font style="vertical-align: inherit;"> ุงููุชุจูู</font></b><font style="vertical-align: inherit;"> ูููุตูู ุฅููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุดูุกุ </font><font style="vertical-align: inherit;">ูู ุงูุชูููุงุ </font><font style="vertical-align: inherit;">ูุง ุชุฒุงู ุจุญุงุฌุฉ ุฅูู ุฅุนุงุฏุฉ ูุชุงุจุฉ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฑูุฒ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุตูุชู ูุงุณุชุฎุฏุงู</font><b><font style="vertical-align: inherit;"> VideoStruct</font></b><font style="vertical-align: inherit;"> ุงูุฌุฏูุฏ</font><font style="vertical-align: inherit;">ุ ูููู ูุฐู ุชุบููุฑุงุช ุชุงููุฉ ูููู ุฑุคูุชูุง ูู ูููุฐุฌ ุงูุฑูุฒ. </font><font style="vertical-align: inherit;">ุขุฎุฑ ุดูุก ูุชุนูู ุนูููุง ุงูููุงู ุจู ูู ุชุบููุฑ ุฑุฏ ุงูุงุชุตุงู ุงูุฎุงุต ุจูุง ููุธููุฉ ุฑุฏ ุงุชุตุงู ุงูุฎุฑูุฌ ุงูุฏุงุฎูู ูู FFmpeg:</font></font><br>
<br>
<pre><code class="cpp hljs">VideoState *global_video_state;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decode_interrupt_cb</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (global_video_state &amp;&amp; global_video_state-&gt;quit);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุนููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">global_video_state</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ูููู ูุจูุฑ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ูุง ูู ุงูุฃูุฑ! </font><font style="vertical-align: inherit;">ูููู ุจุชุฌููุน:</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial04 tutorial04.c -lavutil -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุณุชูุชุน ุจุงููููู ุฏูู ูุฒุงููุฉ! </font><font style="vertical-align: inherit;">ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ ุ ุณูููู ูู ุงูููุงูุฉ ุจุฅูุดุงุก </font><font style="vertical-align: inherit;">ูุดุบู ููุฏูู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนูู ุญููุง</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><a name="video"></a><br>
<br>
<hr><hr><hr><hr><hr><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏุฑุณ 5: ูุฒุงููุฉ ุงูููุฏูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 4: ููุงุถูุน ูุชุนุฏุฏุฉ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฅูู ุฌุฏูู ุงููุญุชููุงุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุงูุฏุฑุณ 5: ูุฒุงููุฉ ุงูุตูุช"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">โ</font></font></a></h2><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุฉ ุงููุงููุฉ ููุจุฑูุงูุฌ ุงูุชุนูููู 05</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment">// tutorial05.c</span>
<span class="hljs-comment">// A pedagogical video player that really works!</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Code based on FFplay, Copyright (c) 2003 Fabrice Bellard, </span>
<span class="hljs-comment">// and a tutorial by Martin Bohme (boehme@inb.uni-luebeckREMOVETHIS.de)</span>
<span class="hljs-comment">// Tested on Gentoo, CVS version 5/01/07 compiled with GCC 4.1.1</span>
<span class="hljs-comment">// With updates from https://github.com/chelyaev/ffmpeg-tutorial</span>
<span class="hljs-comment">// Updates tested on:</span>
<span class="hljs-comment">// LAVC 54.59.100, LAVF 54.29.104, LSWS 2.1.101, SDL 1.2.15</span>
<span class="hljs-comment">// on GCC 4.7.2 in Debian February 2015</span>
<span class="hljs-comment">// Use</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// gcc -o tutorial05 tutorial05.c -lavformat -lavcodec -lswscale -lz -lm `sdl-config --cflags --libs`</span>
<span class="hljs-comment">// to build (assuming libavformat and libavcodec are correctly installed, </span>
<span class="hljs-comment">// and assuming you have sdl-config. Please refer to SDL docs for your installation.)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Run using</span>
<span class="hljs-comment">// tutorial04 myvideofile.mpg</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// to play the video stream on your screen.</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavcodec/avcodec.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libavformat/avformat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libswscale/swscale.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SDL_thread.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __MINGW32__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> main <span class="hljs-comment">/* Prevents SDL from overriding main() */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">// compatibility with newer API</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> LIBAVCODEC_VERSION_INT &lt; AV_VERSION_INT(55,28,1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_alloc avcodec_alloc_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> av_frame_free avcodec_free_frame</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDL_AUDIO_BUFFER_SIZE 1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIO_FRAME_SIZE 192000</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_AUDIOQ_SIZE (5 * 16 * 1024)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_VIDEOQ_SIZE (5 * 256 * 1024)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_SYNC_THRESHOLD 0.01</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AV_NOSYNC_THRESHOLD 10.0</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_REFRESH_EVENT (SDL_USEREVENT)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FF_QUIT_EVENT (SDL_USEREVENT + 1)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VIDEO_PICTURE_QUEUE_SIZE 1</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PacketQueue</span> {</span><font></font>
  AVPacketList *first_pkt, *last_pkt;<font></font>
  <span class="hljs-keyword">int</span> nb_packets;
  <span class="hljs-keyword">int</span> size;<font></font>
  SDL_mutex *mutex;<font></font>
  SDL_cond *cond;<font></font>
} PacketQueue;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  SDL_Overlay *bmp;<font></font>
  <span class="hljs-keyword">int</span> width, height; <span class="hljs-comment">/* source height &amp; width */</span>
  <span class="hljs-keyword">int</span> allocated;
  <span class="hljs-keyword">double</span> pts;<font></font>
} VideoPicture;<font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span><font></font>
<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  <span class="hljs-keyword">int</span>             videoStream, audioStream;<font></font>
<font></font>
  <span class="hljs-keyword">double</span>          audio_clock;<font></font>
  AVStream        *audio_st;<font></font>
  AVCodecContext  *audio_ctx;<font></font>
  PacketQueue     audioq;<font></font>
  <span class="hljs-keyword">uint8_t</span>         audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * <span class="hljs-number">3</span>) / <span class="hljs-number">2</span>];
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_size;
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>    audio_buf_index;<font></font>
  AVFrame         audio_frame;<font></font>
  AVPacket        audio_pkt;<font></font>
  <span class="hljs-keyword">uint8_t</span>         *audio_pkt_data;
  <span class="hljs-keyword">int</span>             audio_pkt_size;
  <span class="hljs-keyword">int</span>             audio_hw_buf_size;  
  <span class="hljs-keyword">double</span>          frame_timer;
  <span class="hljs-keyword">double</span>          frame_last_pts;
  <span class="hljs-keyword">double</span>          frame_last_delay;
  <span class="hljs-keyword">double</span>          video_clock; <span class="hljs-comment">///&lt;pts of last decoded frame / predicted pts of next decoded frame</span><font></font>
  AVStream        *video_st;<font></font>
  AVCodecContext  *video_ctx;<font></font>
  PacketQueue     videoq;<font></font>
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SwsContext</span> *<span class="hljs-title">sws_ctx</span>;</span><font></font>
<font></font>
  VideoPicture    pictq[VIDEO_PICTURE_QUEUE_SIZE];<font></font>
  <span class="hljs-keyword">int</span>             pictq_size, pictq_rindex, pictq_windex;<font></font>
  SDL_mutex       *pictq_mutex;<font></font>
  SDL_cond        *pictq_cond;<font></font>
  <font></font>
  SDL_Thread      *parse_tid;<font></font>
  SDL_Thread      *video_tid;<font></font>
<font></font>
  <span class="hljs-keyword">char</span>            filename[<span class="hljs-number">1024</span>];
  <span class="hljs-keyword">int</span>             quit;<font></font>
} VideoState;<font></font>
<font></font>
SDL_Surface     *screen;<font></font>
SDL_mutex       *screen_mutex;<font></font>
<font></font>
<span class="hljs-comment">/* Since we only have one decoding thread, the Big Struct
   can be global in case we need it. */</span><font></font>
VideoState *global_video_state;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">packet_queue_init</span><span class="hljs-params">(PacketQueue *q)</span> </span>{
  <span class="hljs-built_in">memset</span>(q, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(PacketQueue));<font></font>
  q-&gt;mutex = SDL_CreateMutex();<font></font>
  q-&gt;cond = SDL_CreateCond();<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_put</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt)</span> </span>{<font></font>
<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">if</span>(av_dup_packet(pkt) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  pkt1 = av_malloc(<span class="hljs-keyword">sizeof</span>(AVPacketList));
  <span class="hljs-keyword">if</span> (!pkt1)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  pkt1-&gt;pkt = *pkt;<font></font>
  pkt1-&gt;next = <span class="hljs-literal">NULL</span>;<font></font>
  <font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!q-&gt;last_pkt)<font></font>
    q-&gt;first_pkt = pkt1;<font></font>
  <span class="hljs-keyword">else</span><font></font>
    q-&gt;last_pkt-&gt;next = pkt1;<font></font>
  q-&gt;last_pkt = pkt1;<font></font>
  q-&gt;nb_packets++;<font></font>
  q-&gt;size += pkt1-&gt;pkt.size;<font></font>
  SDL_CondSignal(q-&gt;cond);<font></font>
  <font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">packet_queue_get</span><span class="hljs-params">(PacketQueue *q, AVPacket *pkt, <span class="hljs-keyword">int</span> block)</span>
</span>{<font></font>
  AVPacketList *pkt1;<font></font>
  <span class="hljs-keyword">int</span> ret;<font></font>
<font></font>
  SDL_LockMutex(q-&gt;mutex);<font></font>
  <font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(global_video_state-&gt;quit) {<font></font>
      ret = <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
<font></font>
    pkt1 = q-&gt;first_pkt;<font></font>
    <span class="hljs-keyword">if</span> (pkt1) {<font></font>
      q-&gt;first_pkt = pkt1-&gt;next;<font></font>
      <span class="hljs-keyword">if</span> (!q-&gt;first_pkt)<font></font>
	q-&gt;last_pkt = <span class="hljs-literal">NULL</span>;<font></font>
      q-&gt;nb_packets--;<font></font>
      q-&gt;size -= pkt1-&gt;pkt.size;<font></font>
      *pkt = pkt1-&gt;pkt;<font></font>
      av_free(pkt1);<font></font>
      ret = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!block) {<font></font>
      ret = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      SDL_CondWait(q-&gt;cond, q-&gt;mutex);<font></font>
    }<font></font>
  }<font></font>
  SDL_UnlockMutex(q-&gt;mutex);<font></font>
  <span class="hljs-keyword">return</span> ret;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_audio_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> hw_buf_size, bytes_per_sec, n;<font></font>
  <font></font>
  pts = is-&gt;audio_clock; <span class="hljs-comment">/* maintained in the audio thread */</span><font></font>
  hw_buf_size = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
  bytes_per_sec = <span class="hljs-number">0</span>;<font></font>
  n = is-&gt;audio_ctx-&gt;channels * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span>(is-&gt;audio_st) {<font></font>
    bytes_per_sec = is-&gt;audio_ctx-&gt;sample_rate * n;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(bytes_per_sec) {<font></font>
    pts -= (<span class="hljs-keyword">double</span>)hw_buf_size / bytes_per_sec;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">audio_decode_frame</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">uint8_t</span> *audio_buf, <span class="hljs-keyword">int</span> buf_size, <span class="hljs-keyword">double</span> *pts_ptr)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">int</span> len1, data_size = <span class="hljs-number">0</span>;<font></font>
  AVPacket *pkt = &amp;is-&gt;audio_pkt;<font></font>
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> n;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">while</span>(is-&gt;audio_pkt_size &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">int</span> got_frame = <span class="hljs-number">0</span>;<font></font>
      len1 = avcodec_decode_audio4(is-&gt;audio_ctx, &amp;is-&gt;audio_frame, &amp;got_frame, pkt);<font></font>
      <span class="hljs-keyword">if</span>(len1 &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* if error, skip frame */</span>
	is-&gt;audio_pkt_size = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
      data_size = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span>(got_frame) {<font></font>
	data_size = av_samples_get_buffer_size(<span class="hljs-literal">NULL</span>, <font></font>
					       is-&gt;audio_ctx-&gt;channels,<font></font>
					       is-&gt;audio_frame.nb_samples,<font></font>
					       is-&gt;audio_ctx-&gt;sample_fmt,<font></font>
					       <span class="hljs-number">1</span>);<font></font>
	assert(data_size &lt;= buf_size);<font></font>
	<span class="hljs-built_in">memcpy</span>(audio_buf, is-&gt;audio_frame.data[<span class="hljs-number">0</span>], data_size);<font></font>
      }<font></font>
      is-&gt;audio_pkt_data += len1;<font></font>
      is-&gt;audio_pkt_size -= len1;<font></font>
      <span class="hljs-keyword">if</span>(data_size &lt;= <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* No data yet, get more frames */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      }<font></font>
      pts = is-&gt;audio_clock;<font></font>
      *pts_ptr = pts;<font></font>
      n = <span class="hljs-number">2</span> * is-&gt;audio_ctx-&gt;channels;<font></font>
      is-&gt;audio_clock += (<span class="hljs-keyword">double</span>)data_size /<font></font>
	(<span class="hljs-keyword">double</span>)(n * is-&gt;audio_ctx-&gt;sample_rate);
      <span class="hljs-comment">/* We have data, return it and come back for more later */</span>
      <span class="hljs-keyword">return</span> data_size;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pkt-&gt;data)<font></font>
      av_free_packet(pkt);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">/* next packet */</span>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;audioq, pkt, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_pkt_data = pkt-&gt;data;<font></font>
    is-&gt;audio_pkt_size = pkt-&gt;size;<font></font>
    <span class="hljs-comment">/* if update, update the audio clock w/pts */</span>
    <span class="hljs-keyword">if</span>(pkt-&gt;pts != AV_NOPTS_VALUE) {<font></font>
      is-&gt;audio_clock = av_q2d(is-&gt;audio_st-&gt;time_base)*pkt-&gt;pts;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">audio_callback</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata, Uint8 *stream, <span class="hljs-keyword">int</span> len)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  <span class="hljs-keyword">int</span> len1, audio_size;
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  <span class="hljs-keyword">while</span>(len &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span>(is-&gt;audio_buf_index &gt;= is-&gt;audio_buf_size) {
      <span class="hljs-comment">/* We have already sent all our data; get more */</span>
      audio_size = audio_decode_frame(is, is-&gt;audio_buf, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_buf), &amp;pts);
      <span class="hljs-keyword">if</span>(audio_size &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-comment">/* If error, output silence */</span>
	is-&gt;audio_buf_size = <span class="hljs-number">1024</span>;
	<span class="hljs-built_in">memset</span>(is-&gt;audio_buf, <span class="hljs-number">0</span>, is-&gt;audio_buf_size);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
	is-&gt;audio_buf_size = audio_size;<font></font>
      }<font></font>
      is-&gt;audio_buf_index = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    len1 = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
    <span class="hljs-keyword">if</span>(len1 &gt; len)<font></font>
      len1 = len;<font></font>
    <span class="hljs-built_in">memcpy</span>(stream, (<span class="hljs-keyword">uint8_t</span> *)is-&gt;audio_buf + is-&gt;audio_buf_index, len1);<font></font>
    len -= len1;<font></font>
    stream += len1;<font></font>
    is-&gt;audio_buf_index += len1;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> Uint32 <span class="hljs-title">sdl_refresh_timer_cb</span><span class="hljs-params">(Uint32 interval, <span class="hljs-keyword">void</span> *opaque)</span> </span>{<font></font>
  SDL_Event event;<font></font>
  event.type = FF_REFRESH_EVENT;<font></font>
  event.user.data1 = opaque;<font></font>
  SDL_PushEvent(&amp;event);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* 0 means stop timer */</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/* schedule a video refresh in 'delay' ms */</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">schedule_refresh</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> delay)</span> </span>{<font></font>
  SDL_AddTimer(delay, sdl_refresh_timer_cb, is);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_display</span><span class="hljs-params">(VideoState *is)</span> </span>{<font></font>
<font></font>
  SDL_Rect rect;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">float</span> aspect_ratio;
  <span class="hljs-keyword">int</span> w, h, x, y;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-keyword">if</span>(is-&gt;video_ctx-&gt;sample_aspect_ratio.num == <span class="hljs-number">0</span>) {<font></font>
      aspect_ratio = <span class="hljs-number">0</span>;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      aspect_ratio = av_q2d(is-&gt;video_ctx-&gt;sample_aspect_ratio) *<font></font>
	is-&gt;video_ctx-&gt;width / is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(aspect_ratio &lt;= <span class="hljs-number">0.0</span>) {<font></font>
      aspect_ratio = (<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;width /<font></font>
	(<span class="hljs-keyword">float</span>)is-&gt;video_ctx-&gt;height;<font></font>
    }<font></font>
    h = screen-&gt;h;<font></font>
    w = ((<span class="hljs-keyword">int</span>)rint(h * aspect_ratio)) &amp; <span class="hljs-number">-3</span>;
    <span class="hljs-keyword">if</span>(w &gt; screen-&gt;w) {<font></font>
      w = screen-&gt;w;<font></font>
      h = ((<span class="hljs-keyword">int</span>)rint(w / aspect_ratio)) &amp; <span class="hljs-number">-3</span>;<font></font>
    }<font></font>
    x = (screen-&gt;w - w) / <span class="hljs-number">2</span>;<font></font>
    y = (screen-&gt;h - h) / <span class="hljs-number">2</span>;<font></font>
    <font></font>
    rect.x = x;<font></font>
    rect.y = y;<font></font>
    rect.w = w;<font></font>
    rect.h = h;<font></font>
    SDL_LockMutex(screen_mutex);<font></font>
    SDL_DisplayYUVOverlay(vp-&gt;bmp, &amp;rect);<font></font>
    SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">double</span> actual_delay, delay, sync_threshold, ref_clock, diff;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
<font></font>
      delay = vp-&gt;pts - is-&gt;frame_last_pts; <span class="hljs-comment">/* the pts from last time */</span>
      <span class="hljs-keyword">if</span>(delay &lt;= <span class="hljs-number">0</span> || delay &gt;= <span class="hljs-number">1.0</span>) {
	<span class="hljs-comment">/* if incorrect delay, use previous one */</span><font></font>
	delay = is-&gt;frame_last_delay;<font></font>
      }<font></font>
      <span class="hljs-comment">/* save for next time */</span><font></font>
      is-&gt;frame_last_delay = delay;<font></font>
      is-&gt;frame_last_pts = vp-&gt;pts;<font></font>
<font></font>
      <span class="hljs-comment">/* update delay to sync to audio */</span><font></font>
      ref_clock = get_audio_clock(is);<font></font>
      diff = vp-&gt;pts - ref_clock;<font></font>
<font></font>
      <span class="hljs-comment">/* Skip or repeat the frame. Take delay into account
	 FFPlay still doesn't "know if this is the best guess." */</span><font></font>
      sync_threshold = (delay &gt; AV_SYNC_THRESHOLD) ? delay : AV_SYNC_THRESHOLD;<font></font>
      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(diff) &lt; AV_NOSYNC_THRESHOLD) {
	<span class="hljs-keyword">if</span>(diff &lt;= -sync_threshold) {<font></font>
	  delay = <span class="hljs-number">0</span>;<font></font>
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diff &gt;= sync_threshold) {<font></font>
	  delay = <span class="hljs-number">2</span> * delay;<font></font>
	}<font></font>
      }<font></font>
      is-&gt;frame_timer += delay;<font></font>
      <span class="hljs-comment">/* computer the REAL delay */</span>
      actual_delay = is-&gt;frame_timer - (av_gettime() / <span class="hljs-number">1000000.0</span>);
      <span class="hljs-keyword">if</span>(actual_delay &lt; <span class="hljs-number">0.010</span>) {
	<span class="hljs-comment">/* Really it should skip the picture instead */</span>
	actual_delay = <span class="hljs-number">0.010</span>;<font></font>
      }<font></font>
      schedule_refresh(is, (<span class="hljs-keyword">int</span>)(actual_delay * <span class="hljs-number">1000</span> + <span class="hljs-number">0.5</span>));<font></font>
      <font></font>
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}<font></font>
      <font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">alloc_picture</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
<font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {
    <span class="hljs-comment">// we already have one make another, bigger/smaller</span><font></font>
    SDL_FreeYUVOverlay(vp-&gt;bmp);<font></font>
  }<font></font>
  <span class="hljs-comment">// Allocate a place to put our YUV image on that screen</span><font></font>
  SDL_LockMutex(screen_mutex);<font></font>
  vp-&gt;bmp = SDL_CreateYUVOverlay(is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height,<font></font>
				 SDL_YV12_OVERLAY,<font></font>
				 screen);<font></font>
  SDL_UnlockMutex(screen_mutex);<font></font>
<font></font>
  vp-&gt;width = is-&gt;video_ctx-&gt;width;<font></font>
  vp-&gt;height = is-&gt;video_ctx-&gt;height;<font></font>
  vp-&gt;allocated = <span class="hljs-number">1</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">int</span> dst_pix_fmt;<font></font>
  AVPicture pict;<font></font>
<font></font>
  <span class="hljs-comment">/* wait until we have space for a new pic */</span><font></font>
  SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
  <span class="hljs-keyword">while</span>(is-&gt;pictq_size &gt;= VIDEO_PICTURE_QUEUE_SIZE &amp;&amp;<font></font>
	!is-&gt;quit) {<font></font>
    SDL_CondWait(is-&gt;pictq_cond, is-&gt;pictq_mutex);<font></font>
  }<font></font>
  SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;quit)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
<font></font>
  <span class="hljs-comment">// windex is set to 0 initially</span><font></font>
  vp = &amp;is-&gt;pictq[is-&gt;pictq_windex];<font></font>
<font></font>
  <span class="hljs-comment">/* allocate or resize the buffer! */</span>
  <span class="hljs-keyword">if</span>(!vp-&gt;bmp ||<font></font>
     vp-&gt;width != is-&gt;video_ctx-&gt;width ||<font></font>
     vp-&gt;height != is-&gt;video_ctx-&gt;height) {<font></font>
    SDL_Event event;<font></font>
<font></font>
    vp-&gt;allocated = <span class="hljs-number">0</span>;<font></font>
    alloc_picture(is);<font></font>
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">/* We have a place to put our picture on the queue */</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
<font></font>
    SDL_LockYUVOverlay(vp-&gt;bmp);<font></font>
    vp-&gt;pts = pts;<font></font>
    <font></font>
    dst_pix_fmt = PIX_FMT_YUV420P;<font></font>
    <span class="hljs-comment">/* point pict at the queue */</span><font></font>
<font></font>
    pict.data[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">0</span>];<font></font>
    pict.data[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">2</span>];<font></font>
    pict.data[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pixels[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    pict.linesize[<span class="hljs-number">0</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">0</span>];<font></font>
    pict.linesize[<span class="hljs-number">1</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">2</span>];<font></font>
    pict.linesize[<span class="hljs-number">2</span>] = vp-&gt;bmp-&gt;pitches[<span class="hljs-number">1</span>];<font></font>
    <font></font>
    <span class="hljs-comment">// Convert the image into YUV format that SDL uses</span>
    sws_scale(is-&gt;sws_ctx, (<span class="hljs-keyword">uint8_t</span> <span class="hljs-keyword">const</span> * <span class="hljs-keyword">const</span> *)pFrame-&gt;data,<font></font>
	      pFrame-&gt;linesize, <span class="hljs-number">0</span>, is-&gt;video_ctx-&gt;height,<font></font>
	      pict.data, pict.linesize);<font></font>
    <font></font>
    SDL_UnlockYUVOverlay(vp-&gt;bmp);<font></font>
    <span class="hljs-comment">/* now we inform our display thread that we have a pic ready */</span>
    <span class="hljs-keyword">if</span>(++is-&gt;pictq_windex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
      is-&gt;pictq_windex = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
    is-&gt;pictq_size++;<font></font>
    SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">synchronize_video</span><span class="hljs-params">(VideoState *is, AVFrame *src_frame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">double</span> frame_delay;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(pts != <span class="hljs-number">0</span>) {
    <span class="hljs-comment">/* if we have pts, set video clock to it */</span><font></font>
    is-&gt;video_clock = pts;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* if we aren't given a pts, set it to the clock */</span><font></font>
    pts = is-&gt;video_clock;<font></font>
  }<font></font>
  <span class="hljs-comment">/* update the video clock */</span><font></font>
  frame_delay = av_q2d(is-&gt;video_ctx-&gt;time_base);<font></font>
  <span class="hljs-comment">/* if we are repeating a frame, adjust clock accordingly */</span>
  frame_delay += src_frame-&gt;repeat_pict * (frame_delay * <span class="hljs-number">0.5</span>);<font></font>
  is-&gt;video_clock += frame_delay;<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">video_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
  <span class="hljs-keyword">int</span> frameFinished;<font></font>
  AVFrame *pFrame;<font></font>
  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  pFrame = av_frame_alloc();<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    pts = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">// Decode video frame</span><font></font>
    avcodec_decode_video2(is-&gt;video_ctx, pFrame, &amp;frameFinished, packet);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>((pts = av_frame_get_best_effort_timestamp(pFrame)) == AV_NOPTS_VALUE) {<font></font>
      pts = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    pts *= av_q2d(is-&gt;video_st-&gt;time_base);<font></font>
<font></font>
    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
      pts = synchronize_video(is, pFrame, pts);<font></font>
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame, pts) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    av_free_packet(packet);<font></font>
  }<font></font>
  av_frame_free(&amp;pFrame);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stream_component_open</span><span class="hljs-params">(VideoState *is, <span class="hljs-keyword">int</span> stream_index)</span> </span>{<font></font>
<font></font>
  AVFormatContext *pFormatCtx = is-&gt;pFormatCtx;<font></font>
  AVCodecContext *codecCtx = <span class="hljs-literal">NULL</span>;<font></font>
  AVCodec *codec = <span class="hljs-literal">NULL</span>;<font></font>
  SDL_AudioSpec wanted_spec, spec;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(stream_index &lt; <span class="hljs-number">0</span> || stream_index &gt;= pFormatCtx-&gt;nb_streams) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codec = avcodec_find_decoder(pFormatCtx-&gt;streams[stream_index]-&gt;codec-&gt;codec_id);<font></font>
  <span class="hljs-keyword">if</span>(!codec) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  codecCtx = avcodec_alloc_context3(codec);<font></font>
  <span class="hljs-keyword">if</span>(avcodec_copy_context(codecCtx, pFormatCtx-&gt;streams[stream_index]-&gt;codec) != <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Couldn't copy codec context"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Error copying codec context</span><font></font>
  }<font></font>
<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(codecCtx-&gt;codec_type == AVMEDIA_TYPE_AUDIO) {
    <span class="hljs-comment">// Set audio settings from codec info</span><font></font>
    wanted_spec.freq = codecCtx-&gt;sample_rate;<font></font>
    wanted_spec.format = AUDIO_S16SYS;<font></font>
    wanted_spec.channels = codecCtx-&gt;channels;<font></font>
    wanted_spec.silence = <span class="hljs-number">0</span>;<font></font>
    wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;<font></font>
    wanted_spec.callback = audio_callback;<font></font>
    wanted_spec.userdata = is;<font></font>
    <font></font>
    <span class="hljs-keyword">if</span>(SDL_OpenAudio(&amp;wanted_spec, &amp;spec) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL_OpenAudio: %s\n"</span>, SDL_GetError());
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
    }<font></font>
    is-&gt;audio_hw_buf_size = spec.size;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(avcodec_open2(codecCtx, codec, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Unsupported codec!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>(codecCtx-&gt;codec_type) {
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_AUDIO:<font></font>
    is-&gt;audioStream = stream_index;<font></font>
    is-&gt;audio_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;audio_ctx = codecCtx;<font></font>
    is-&gt;audio_buf_size = <span class="hljs-number">0</span>;<font></font>
    is-&gt;audio_buf_index = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(&amp;is-&gt;audio_pkt, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(is-&gt;audio_pkt));<font></font>
    packet_queue_init(&amp;is-&gt;audioq);<font></font>
    SDL_PauseAudio(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> AVMEDIA_TYPE_VIDEO:<font></font>
    is-&gt;videoStream = stream_index;<font></font>
    is-&gt;video_st = pFormatCtx-&gt;streams[stream_index];<font></font>
    is-&gt;video_ctx = codecCtx;<font></font>
<font></font>
    is-&gt;frame_timer = (<span class="hljs-keyword">double</span>)av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
    is-&gt;frame_last_delay = <span class="hljs-number">40e-3</span>;<font></font>
    <font></font>
    packet_queue_init(&amp;is-&gt;videoq);<font></font>
    is-&gt;video_tid = SDL_CreateThread(video_thread, is);<font></font>
    is-&gt;sws_ctx = sws_getContext(is-&gt;video_ctx-&gt;width, is-&gt;video_ctx-&gt;height,<font></font>
				 is-&gt;video_ctx-&gt;pix_fmt, is-&gt;video_ctx-&gt;width,<font></font>
				 is-&gt;video_ctx-&gt;height, PIX_FMT_YUV420P,<font></font>
				 SWS_BILINEAR, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span><font></font>
				 );<font></font>
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">decode_thread</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)arg;<font></font>
  AVFormatContext *pFormatCtx;<font></font>
  AVPacket pkt1, *packet = &amp;pkt1;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> video_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> audio_index = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">int</span> i;<font></font>
<font></font>
  is-&gt;videoStream=<span class="hljs-number">-1</span>;<font></font>
  is-&gt;audioStream=<span class="hljs-number">-1</span>;<font></font>
<font></font>
  global_video_state = is;<font></font>
<font></font>
  <span class="hljs-comment">// Open video file</span>
  <span class="hljs-keyword">if</span>(avformat_open_input(&amp;pFormatCtx, is-&gt;filename, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>)!=<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't open file</span><font></font>
<font></font>
  is-&gt;pFormatCtx = pFormatCtx;<font></font>
  <font></font>
  <span class="hljs-comment">// Retrieve stream information</span>
  <span class="hljs-keyword">if</span>(avformat_find_stream_info(pFormatCtx, <span class="hljs-literal">NULL</span>)&lt;<span class="hljs-number">0</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>; <span class="hljs-comment">// Couldn't find stream information</span><font></font>
  <font></font>
  <span class="hljs-comment">// Dump information about file onto standard error</span>
  av_dump_format(pFormatCtx, <span class="hljs-number">0</span>, is-&gt;filename, <span class="hljs-number">0</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// Find the first video stream</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;pFormatCtx-&gt;nb_streams; i++) {
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_VIDEO &amp;&amp;<font></font>
       video_index &lt; <span class="hljs-number">0</span>) {<font></font>
      video_index=i;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type==AVMEDIA_TYPE_AUDIO &amp;&amp;<font></font>
       audio_index &lt; <span class="hljs-number">0</span>) {<font></font>
      audio_index=i;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(audio_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, audio_index);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(video_index &gt;= <span class="hljs-number">0</span>) {<font></font>
    stream_component_open(is, video_index);<font></font>
  }   <font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is-&gt;videoStream &lt; <span class="hljs-number">0</span> || is-&gt;audioStream &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"%s: could not open codecs\n"</span>, is-&gt;filename);
    <span class="hljs-keyword">goto</span> fail;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// main decode loop</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(is-&gt;quit) {
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    <span class="hljs-comment">// seek stuff goes here</span>
    <span class="hljs-keyword">if</span>(is-&gt;audioq.size &gt; MAX_AUDIOQ_SIZE ||<font></font>
       is-&gt;videoq.size &gt; MAX_VIDEOQ_SIZE) {<font></font>
      SDL_Delay(<span class="hljs-number">10</span>);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span>(av_read_frame(is-&gt;pFormatCtx, packet) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span>(is-&gt;pFormatCtx-&gt;pb-&gt;error == <span class="hljs-number">0</span>) {<font></font>
	SDL_Delay(<span class="hljs-number">100</span>); <span class="hljs-comment">/* no error; wait for user input */</span>
	<span class="hljs-keyword">continue</span>;<font></font>
      } <span class="hljs-keyword">else</span> {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }<font></font>
    <span class="hljs-comment">// Is this a packet from the video stream?</span>
    <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;videoStream) {<font></font>
      packet_queue_put(&amp;is-&gt;videoq, packet);<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(packet-&gt;stream_index == is-&gt;audioStream) {<font></font>
      packet_queue_put(&amp;is-&gt;audioq, packet);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      av_free_packet(packet);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment">/* all done - wait for it */</span>
  <span class="hljs-keyword">while</span>(!is-&gt;quit) {<font></font>
    SDL_Delay(<span class="hljs-number">100</span>);<font></font>
  }<font></font>
<font></font>
 fail:<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>){<font></font>
    SDL_Event event;<font></font>
    event.type = FF_QUIT_EVENT;<font></font>
    event.user.data1 = is;<font></font>
    SDL_PushEvent(&amp;event);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>{<font></font>
<font></font>
  SDL_Event       event;<font></font>
<font></font>
  VideoState      *is;<font></font>
<font></font>
  is = av_mallocz(<span class="hljs-keyword">sizeof</span>(VideoState));<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Usage: test &lt;file&gt;\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
  <span class="hljs-comment">// Register all formats and codecs</span><font></font>
  av_register_all();<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Could not initialize SDL - %s\n"</span>, SDL_GetError());
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Make a screen to put our video</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> __DARWIN__</span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
        screen = SDL_SetVideoMode(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>, <span class="hljs-number">24</span>, <span class="hljs-number">0</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-keyword">if</span>(!screen) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"SDL: could not set video mode - exiting\n"</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<font></font>
  }<font></font>
<font></font>
  screen_mutex = SDL_CreateMutex();<font></font>
<font></font>
  av_strlcpy(is-&gt;filename, argv[<span class="hljs-number">1</span>], <span class="hljs-keyword">sizeof</span>(is-&gt;filename));<font></font>
<font></font>
  is-&gt;pictq_mutex = SDL_CreateMutex();<font></font>
  is-&gt;pictq_cond = SDL_CreateCond();<font></font>
<font></font>
  schedule_refresh(is, <span class="hljs-number">40</span>);<font></font>
<font></font>
  is-&gt;parse_tid = SDL_CreateThread(decode_thread, is);<font></font>
  <span class="hljs-keyword">if</span>(!is-&gt;parse_tid) {<font></font>
    av_free(is);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">for</span>(;;) {<font></font>
<font></font>
    SDL_WaitEvent(&amp;event);<font></font>
    <span class="hljs-keyword">switch</span>(event.type) {
    <span class="hljs-keyword">case</span> FF_QUIT_EVENT:
    <span class="hljs-keyword">case</span> SDL_QUIT:<font></font>
      is-&gt;quit = <span class="hljs-number">1</span>;<font></font>
      SDL_Quit();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> FF_REFRESH_EVENT:<font></font>
      video_refresh_timer(event.user.data1);<font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
</code></pre></div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฐูุฑ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูุชุจุช ูุฐุง ุงูุฏููู ููุชู ุ ุชู ุฃุฎุฐ ูู ููุฏ ุงููุฒุงููุฉ ุงูุฎุงุต ุจู ูู ุฅุตุฏุงุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ffplay.c</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุงูููู ูู ุจุฑูุงูุฌ ูุฎุชูู ุชูุงููุง ุ ูุฃุฏุช ุงูุชุญุฏูุซุงุช ูู ููุชุจุงุช FFmpeg (ููู ffplay.c ููุณูุง) ุฅูู ุชุบููุฑุงุช ุฃุณุงุณูุฉ. </font><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ุงูุฑูุฒ ูุง ูุฒุงู ูุนูู ุ ุฅูุง ุฃูู ูุฏูู ุจุงููุนู ุ ูููุงู ุงูุนุฏูุฏ ูู ุงูุชุญุณููุงุช ุงูุฃุฎุฑู ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูู ูุฐุง ุงูุฏููู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ูุชุฒุงูู ุงูููุฏูู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุชู ุงูุขู ุ ูุงู ูุฏููุง ูุดุบู ูููู ุนุฏูู ุงููุงุฆุฏุฉ ุชูุฑูุจูุง. </font><font style="vertical-align: inherit;">ูุนู ุ ุฅููุง ุชุดุบู ุงูููุฏูู ุ ููุนู ุ ุชุดุบู ุงูุตูุช ุ ูููู ูุฐุง ููุณ ุชูุงููุง ูุง ูุณููู ูููููุง. </font><font style="vertical-align: inherit;">ุฅุฐู ูุงุฐุง ููุนู ุจุนุฏ ุฐููุ</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS ู DTS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุณู ุงูุญุธ ุ ุชุญุชูู ุชุฏููุงุช ุงูุตูุช ูุงูููุฏูู ุนูู ูุนูููุงุช ุญูู ูุฏู ุงูุณุฑุนุฉ ููู ุฃู ููุช ูุฌุจ ุชุดุบูููุง. ุชุฏููุงุช ุงูุตูุช ูุฏููุง ูุนุฏู ุฃุฎุฐ ุงูุนููุงุช ุ ูุชุฏููุงุช ุงูููุฏูู ููุง ุฅุทุงุฑุงุช ูู ุงูุซุงููุฉ. ููุน ุฐูู ุ ุฅุฐุง ูููุง ููุท ุจูุฒุงููุฉ ุงูููุฏูู ุนู ุทุฑูู ุญุณุงุจ ุนุฏุฏ ุงูุฅุทุงุฑุงุช ูุงูุถุฑุจ ูู ูุนุฏู ุงูุฅุทุงุฑุงุช ุ ูููุงู ูุฑุตุฉ ุฌูุฏุฉ ูุนุฏู ุชุฒุงููู ูุน ุงูุตูุช. ูุฐูู ุ ุณูุฐูุจ ูู ุงูุงุชุฌุงู ุงูุขุฎุฑ. ูููู ุฃู ุชุญุชูู ุงูุญุฒู ูู </font><i><font style="vertical-align: inherit;">ุงููุทุงุฑ</font></i><font style="vertical-align: inherit;"> ุนูู ูุง ูุณูู </font><i><font style="vertical-align: inherit;">ุฎุชู </font></i></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุช ูู ุงูุชุดููุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูู </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ecoding </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ime </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><i><font style="vertical-align: inherit;">ูุฎุชู </font></i></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุช ุงูุนุฑุถ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ูู </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resentation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ime </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุดุงูุง</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). ูููู ูุฐูู ุงููุนูููู ุ ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ููููุฉ ุชุฎุฒูู ุงูุฃููุงู. ุชุณุชุฎุฏู ุจุนุถ ุงูุชูุณููุงุช ุ ูุซู MPEG ุ ูุง ูุณูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑุงุช B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bed</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ุซูุงุฆู ุงูุงุชุฌุงู ุ ุฅูุฌูุชุฑุง. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซูุงุฆู ุงูุงุชุฌุงู</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). ููุทูู ุนูู ููุนูู ุขุฎุฑูู ูู ุงูุฅุทุงุฑุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I-ุฅุทุงุฑุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P-ุฅุทุงุฑุงุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุงุฎูู</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุท</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุณุงุฆู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููุน</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุต</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redicted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">ุชุญุชูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุทุงุฑุงุช I</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนูู ุงูุตูุฑุฉ ุงููุงููุฉ. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑุงุช P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนุชูุฏ ุนูู ุฅุทุงุฑุงุช I- ู P ุงูุณุงุจูุฉ ูุชุฎุชูู ุนู ุงูุฅุทุงุฑุงุช ุงูุณุงุจูุฉ ุ ุฃู ููููู ุฃูุถูุง ุชุณููุฉ - deltas. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุทุงุฑุงุช B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุดุจู </font><b><font style="vertical-align: inherit;">ุงูุฅุทุงุฑุงุช</font></b><font style="vertical-align: inherit;"> P ุ ูููููุง ุชุนุชูุฏ ุนูู ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ูู ูู ุงูุฅุทุงุฑุงุช ุงูุณุงุจูุฉ ูุงููุงุญูุฉ! ุญูููุฉ ุฃู ุงูุฅุทุงุฑ ูุฏ ูุง ูุญุชูู ุนูู ุงูุตูุฑุฉ ููุณูุง ุ ูููู ุงูุงุฎุชูุงูุงุช ูุน ุงูุฅุทุงุฑุงุช ุงูุฃุฎุฑู - ูุดุฑุญ ููุงุฐุง ูุฏ ูุง ูููู ูุฏููุง ุฅุทุงุฑ ููุชูู ุจุนุฏ ุงุณุชุฏุนุงุก </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avcodec_decode_video2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุชุฑุถ ุฃู ูุฏููุง ูููููุง ููู 4 ุฅุทุงุฑุงุช ูู ูุฐุง ุงูุชุณูุณู: </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IBBP</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุซู ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุงููุนูููุงุช ูู ุงูุฅุทุงุฑ P ุงูุฃุฎูุฑ ูุจู ุฃู ูุชููู ูู ุนุฑุถ ุฃู ูู ุงูุฅุทุงุฑูู ุงูุณุงุจููู B. ูููุฐุง ุงูุณุจุจ ุ ูููู ุชุฎุฒูู ุงูุฅุทุงุฑุงุช ูู ุชุณูุณู ูุง ูุทุงุจู ุชุฑุชูุจ ุงูุนุฑุถ ุงููุนูู: </font></font><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPBB</font></font></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ูุฐุง ูู ุงูุบุฑุถ ูู ุงูุทุงุจุน ุงูุฒููู ููู ุงูุชุดููุฑ ูุงูุทุงุจุน ุงูุฒููู ููุนุฑุถ ุงูุชูุฏููู ููู ุฅุทุงุฑ. ูุฎุจุฑูุง ุงูุทุงุจุน ุงูุฒููู ููู ุงูุดูุฑุฉ ุนูุฏูุง ูุญุชุงุฌ ุฅูู ูู ุดูุฑุฉ ุดูุก ูุง ุ ููุฎุจุฑูุง ุงูุทุงุจุน ุงูุฒููู ููุนุฑุถ ุงูุชูุฏููู ุนูุฏูุง ูุญุชุงุฌ ุฅูู ุนุฑุถ ุดูุก ูุง. ูุฐูู ุ ูู ูุฐู ุงูุญุงูุฉ ุ ูุฏ ูุจุฏู ุงูุฏูู ุงูุฎุงุต ุจูุง ููุง ููู: </font></font><br>
<br>
&nbsp;&nbsp;&nbsp;<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PTS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 4 2 3 </font></font><br>
&nbsp;&nbsp;&nbsp;<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 2 3 4 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏูู:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IPBB </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงุนุฏุฉ ุ ุชุฎุชูู PTS ู DTS ููุท ุนูุฏูุง ูุญุชูู ุงูุฏูู ุงูุฌุงุฑู ุชุดุบููู ุนูู ุฅุทุงุฑุงุช B. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ูุชููู ุญุฒูุฉ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_read_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () ุ ูุฅููุง ุชุญุชูู ุนูู ููู PTS ู DTS ูููุนูููุงุช ุงูููุฌูุฏุฉ ุฏุงุฎู ุงูุญุฒูุฉ. ูููู ูุง ูุญุชุงุฌู ุญููุง ูู PTS ูุฅุทุงุฑูุง ุงูุฎุงู ุงูุฐู ุชู ูู ุชุดููุฑู ุญุฏูุซูุง ุ ููู ูุฐู ุงูุญุงูุฉ ูุนุฑู ูุชู ูุฌุจ ุนุฑุถู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญุณู ุงูุญุธ ุ ูููุฑ ููุง FFmpeg "ุฃูุถู ุทุงุจุน ุฒููู ูููู" ูููููุง ุงูุญุตูู ุนููู ุจุงุณุชุฎุฏุงู ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">av_frame_get_best_effort_timestamp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ().</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฒุงูู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุฃุฌู ุนุฑุถ ุงูุฅุทุงุฑุงุช ุจุฏูุฑูุง ุ ุณูููู ูู ุงูุฌูุฏ ูุนุฑูุฉ ูุชู ูุชู ุนุฑุถ ุฅุทุงุฑ ููุฏูู ูุนูู. </font><font style="vertical-align: inherit;">ูููู ููู ููุนู ุฐูู ุจุงูุถุจุทุ </font><font style="vertical-align: inherit;">ุงูููุฑุฉ ูู: ุจุนุฏ ุฃู ูุนุฑุถ ุงูุฅุทุงุฑ ุ ููุชุดู ูุชู ูุฌุจ ุฅุธูุงุฑ ุงูุฅุทุงุฑ ุงูุชุงูู. </font><font style="vertical-align: inherit;">ุซู ุชููู ููุท ุ ูุจุนุฏ ุฐูู ูููู ุจุชุญุฏูุซ ุงูููุฏูู ุจุนุฏ ูุฐู ุงููุชุฑุฉ ุงูุฒูููุฉ. </font><font style="vertical-align: inherit;">ููุง ูู ูุชููุน ุ ูุชุญูู ูู ูููุฉ PTS ููุฅุทุงุฑ ุงูุชุงูู ุนูู ุณุงุนุฉ ุงููุธุงู ููุฑู ูู ูุฌุจ ุฃู ูููู ููุช ุงูุงูุชุธุงุฑ. </font><font style="vertical-align: inherit;">ูุนูู ูุฐุง ุงูููุฌ ุ ูููู ููุงู ูุดููุชุงู ูุฌุจ ูุนุงูุฌุชููุง.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ุงูุณุคุงู ูู ุ ูุชู ุณุชููู PTS ุงูุชุงููุฉุ ุณุชููู ุฃูู ููููู ุจุจุณุงุทุฉ ุฅุถุงูุฉ ุชุฑุฏุฏ ุงูููุฏูู ุฅูู PTS ุงูุญุงูู - ูุณุชููู ุนูู ุตูุงุจ ูู ุญูุซ ุงููุจุฏุฃ. ููุน ุฐูู ุ ุณุชุชุทูุจ ุจุนุถ ุฃููุงุน ุงูููุฏูู ุฅุทุงุฑุงุช ูุชูุฑุฑุฉ. ูุฐุง ูุนูู ุฃูู ูุฌุจ ุนููู ุชูุฑุงุฑ ุงูุฅุทุงุฑ ุงูุญุงูู ูุนุฏุฏ ูุนูู ูู ุงููุฑุงุช. ูุฏ ูุคุฏู ุฐูู ุฅูู ุนุฑุถ ุงูุจุฑูุงูุฌ ููุฅุทุงุฑ ุงูุชุงูู ูู ููุช ูุฑูุจ ุฌุฏูุง. ูุฌุจ ุฃู ูุคุฎุฐ ูุฐุง ูู ุงูุงุนุชุจุงุฑ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุดููุฉ ุงูุซุงููุฉ ูู ุฃูู ูู ุงูุจุฑูุงูุฌ ุงูุฐู ูุชุจูุงู ูู ุงูููุช ุงูุญุงูู ุ ููุฏูุน ุงูููุฏูู ูุงูุตูุช ุจูุฑุญ ุฅูู ุงูุฃูุงู ุญุชู ูุฒุนุฌูุง ุงูุชุฒุงูู ุนูู ุงูุฅุทูุงู. </font><font style="vertical-align: inherit;">ูุง ุฏุงุนู ููููู ุญูุงู ุฐูู ุฅุฐุง ุนูู ูู ุดูุก ูู ุญุฏ ุฐุงุชู ุจุดูู ูุซุงูู. </font><font style="vertical-align: inherit;">ููู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู ููุณ ูุซุงูููุง ุ ูุซู ุงูุนุฏูุฏ ูู ูููุงุช ุงูููุฏูู. </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูุฏููุง ุซูุงุซุฉ ุฎูุงุฑุงุช: ูุฒุงููุฉ ุงูุตูุช ูุน ุงูููุฏูู ุ ููุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช ุฃู ูุฒุงููุฉ ูู ูู ุงูุตูุช ูุงูููุฏูู ูุน ุณุงุนุฉ ุฎุงุฑุฌูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูุน ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู). </font><font style="vertical-align: inherit;">ุงูุขู ุณูููู ุจูุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุดููุฑ: ุงุณุชูุจุงู ุฅุทุงุฑ PTS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฏุนูุง ููุชุจ ุดูุฆูุง ูุจุงุดุฑุฉู. ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุจุถุนุฉ ุฃุฌุฒุงุก ุฃุฎุฑู ุฅูู ูููููุง ุงููุจูุฑ ุ ูุณููุนู ุฐูู ุจุงูุทุฑููุฉ ุงูุชู ูุญุชุงุฌูุง. ุฃููุงู ุ ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ุณูุณูุฉ ุงูููุฏูู ุงูุฎุงุตุฉ ุจูุง. ูู ุชุชุฐูุฑ ุฃููุง ูุฌูุน ููุง ุงูุญุฒู ุงูุชู ุชู ูุถุนูุง ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ูู ูุจู ุฏูู ูู ุงูุชุดููุฑ ุงูุฎุงุต ุจูุงุ ูู ูุฐุง ุงูุฌุฒุก ูู ุงูุดูุฑุฉ ุ ูุญุชุงุฌ ุฅูู ุงูุญุตูู ุนูู PTS ููุฅุทุงุฑ ุงูุฐู ูุฏูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง avcodec_decode_video2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุงูุทุฑููุฉ ุงูุฃููู ุงูุชู ุชุญุฏุซูุง ุนููุง ูู ุงูุญุตูู ุนูู DTS ูุขุฎุฑ ุญุฒูุฉ ุชูุช ูุนุงูุฌุชูุง ุ ููู ุจุณูุทุฉ ุฌุฏูุง:</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">double</span> pts;<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(;;) {
    <span class="hljs-keyword">if</span>(packet_queue_get(&amp;is-&gt;videoq, packet, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// means we quit getting packets</span>
      <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
    pts = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Decode video frame</span><font></font>
    len1 = avcodec_decode_video2(is-&gt;video_st-&gt;codec,<font></font>
                                pFrame, &amp;frameFinished, packet);<font></font>
    <span class="hljs-keyword">if</span>(packet-&gt;dts != AV_NOPTS_VALUE) {<font></font>
      pts = av_frame_get_best_effort_timestamp(pFrame);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      pts = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    pts *= av_q2d(is-&gt;video_st-&gt;time_base);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุถุน PTS ุนูู ุงูุตูุฑ ุฅุฐุง ูู ูุชููู ูู ุชุญุฏูุฏ ูููุชู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุณูุง ุ ูุงู ุฐูู ุณููุง. ููุงุญุธุฉ ูููุฉ: ููุง ุชุฑู ุ ูุณุชุฎุฏู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int64</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู PTS. ูุฐุง ูุฃูู ูุชู ุชุฎุฒูู PTS ูุนุฏุฏ ุตุญูุญ. ูุฐู ุงููููุฉ ูู ุทุงุจุน ุฒููู ูุชูุงูู ูุน ุงูุจุนุฏ ุงูุฒููู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">timebb</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงู ุงูุฏูู ูุญุชูู ุนูู 24 ุฅุทุงุฑูุง ูู ุงูุซุงููุฉ ุ ูุณุชุดูุฑ PTS ูู 42 ุฅูู ุฃูู ูุฌุจ ุงุณุชุฎุฏุงู ุงูุฅุทุงุฑ ูู ุงูููุงู ุงูุฐู ูุฌุจ ุฃู ูููู ููู ุงูุฅุทุงุฑ 42 ุ ุจุดุฑุท ุฃู ูููู ูุฏููุง ุฅุทุงุฑุงุช ูุณุชุจุฏูุฉ ูู 1/24 ุซุงููุฉ (ุจุงูุทุจุน ุ ูู ูููู ูุฐุง ุจุงูุถุฑูุฑุฉ ูุฐูู ูู ุงูุญูููุฉ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููููุง ุชุญููู ูุฐู ุงููููุฉ ุฅูู ุซูุงูู ุนู ุทุฑูู ุงููุณูุฉ ุนูู ูุนุฏู ุงูุฅุทุงุฑุงุช. ูููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุนุฏุฉ ุงูููุช</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ุงูุฏูู ูุณุงูููุง 1 ููุณูููุง ุนูู ูุนุฏู ุงูุฅุทุงุฑุงุช (ูููุญุชูู ุจูุนุฏู ุฅุทุงุฑุงุช ุซุงุจุช) ุ ูุจุงูุชุงูู ุ ููุญุตูู ุนูู PTS ูู ุซูุงูู ุ ูุถุฑุจ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">time_base</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฏ ูุฐูู: ุชุฒุงูู ูุงุณุชุฎุฏุงู PTS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุชู ุงูุขู ูุฏููุง ูู PTS ุงูุฌุงูุฒุฉ. </font><font style="vertical-align: inherit;">ุงูุขู ุณูู ูุชุนุงูู ูุน ูุดููุชู ุงููุฒุงููุฉ ูุงุชูู ุ ุงูุชู ุชูุช ููุงูุดุชูุง ุฃุนูู ููููุงู. </font><font style="vertical-align: inherit;">ุณูููู ุจุชุญุฏูุฏ ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syncize_video</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชู ุณุชููู ุจุชุญุฏูุซ PTS ูููุฒุงููุฉ ูุน ูู ุดูุก. </font><font style="vertical-align: inherit;">ูุฃุฎูุฑูุง ุ ุณุชุชุนุงูู ูุฐู ุงููุธููุฉ ุฃูุถูุง ูุน ุงูุญุงูุงุช ุงูุชู ูุง ูุญุตู ูููุง ุนูู ูููุฉ PTS ูุฅุทุงุฑูุง. </font><font style="vertical-align: inherit;">ูู ุงูููุช ููุณู ุ ูุญุชุงุฌ ุฅูู ุชุชุจุน ุงูููุนุฏ ุงููุชููุน ููุฅุทุงุฑ ุงูุชุงูู ุญุชู ูุชููู ูู ุชุนููู ูุนุฏู ุงูุชุญุฏูุซ ุจุดูู ุตุญูุญ. </font><font style="vertical-align: inherit;">ูููููุง ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู ูููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฏุงุฎููุฉ </font><font style="vertical-align: inherit;">ุ ุงูุชู ุชุชุนูุจ ููุฏุงุฑ ุงูููุช </font><b><font style="vertical-align: inherit;">ุงููููุถู</font></b><font style="vertical-align: inherit;"> ููููุฏูู. </font><font style="vertical-align: inherit;">ูุถูู ูุฐู ุงููููุฉ ุฅูู ูููููุง ุงููุจูุฑ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoState</span> {</span>
  <span class="hljs-keyword">double</span>          video_clock; <span class="hljs-comment">// pts of last decoded frame / predicted pts of next decoded frame</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุง ููู ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syncize_video</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููู ูุงุถุญุฉ ุฌุฏูุง:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">synchronize_video</span><span class="hljs-params">(VideoState *is, AVFrame *src_frame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">double</span> frame_delay;<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(pts != <span class="hljs-number">0</span>) {
    <span class="hljs-comment">/* if we have pts, set video clock to it */</span><font></font>
    is-&gt;video_clock = pts;<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">/* if we aren't given a pts, set it to the clock */</span><font></font>
    pts = is-&gt;video_clock;<font></font>
  }<font></font>
  <span class="hljs-comment">/* update the video clock */</span><font></font>
  frame_delay = av_q2d(is-&gt;video_st-&gt;codec-&gt;time_base);<font></font>
  <span class="hljs-comment">/* if we are repeating a frame, adjust clock accordingly */</span>
  frame_delay += src_frame-&gt;repeat_pict * (frame_delay * <span class="hljs-number">0.5</span>);<font></font>
  is-&gt;video_clock += frame_delay;<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุชุฑู ุ ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงูุฅุทุงุฑุงุช ุงููุชูุฑุฑุฉ ูู ูุฐู ุงููุธููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ุฏุนูุง ูุญุตู ุนูู PTS ุงูุตุญูุญ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุถุน</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฅุทุงุฑ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุจุงุณุชุฎุฏุงู </font><b><font style="vertical-align: inherit;">queue_picture</font></b><font style="vertical-align: inherit;"> ุจุฅุถุงูุฉ ูุณูุทุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุฏูุฏุฉ </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">// Did we get a video frame?</span>
    <span class="hljs-keyword">if</span>(frameFinished) {<font></font>
      pts = synchronize_video(is, pFrame, pts);<font></font>
      <span class="hljs-keyword">if</span>(queue_picture(is, pFrame, pts) &lt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุชุบูุฑ ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queue_picture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุฃููุง ูููู ุจุชุฎุฒูู ูููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฐู </font><font style="vertical-align: inherit;">ูู ูููู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VideoPicture</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฐู </font><b><font style="vertical-align: inherit;">ููุชุธุฑู</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูุฌุจ ุฃู ูุถูู ูุชุบูุฑ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูู ุงููููู ููุถูู ุฃุณุทุฑ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุฐู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">VideoPicture</span> {</span><font></font>
  ...<font></font>
  <span class="hljs-keyword">double</span> pts;<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">queue_picture</span><span class="hljs-params">(VideoState *is, AVFrame *pFrame, <span class="hljs-keyword">double</span> pts)</span> </span>{<font></font>
  ... stuff ...<font></font>
  <span class="hljs-keyword">if</span>(vp-&gt;bmp) {<font></font>
    ... convert picture ...<font></font>
    vp-&gt;pts = pts;<font></font>
    ... alert <span class="hljs-built_in">queue</span> ...<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูุฏููุง ุงูุตูุฑ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุน ููู PTS ุงูุตุญูุญุฉ ุ ูุฐูู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููุฒุฉ ุชุญุฏูุซ ุงูููุฏูู ูุฏููุง. ููููู ุฃู ุชุชุฐูุฑ ูู ุงูุฏุฑุณ ุงูุฃุฎูุฑ ุฃููุง ุจุจุณุงุทุฉ ุฒูุฑูุงู ููููุง ุจุชุซุจูุช ุชุญุฏูุซ 80 ูููู ุซุงููุฉ. ุญุณููุง ุ ุงูุขู ุณููุชุดู ูุง ูุฌุจ ุฃู ูููู ููุงู ุญููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุณุชุฑุงุชูุฌูุชูุง ูู ุงูุชูุจุค ุจููุช PTS ุงูุชุงูู ุจุจุณุงุทุฉ ุนู ุทุฑูู ููุงุณ ุงูููุช ุจูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงุท</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุญุงููุฉ </font><font style="vertical-align: inherit;">ูุงูุณุงุจูุฉ. ูู ุงูููุช ููุณู ุ ูุญุชุงุฌ ุฅูู ูุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช. ุณูููู ุจุนูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุงุนุฉ ุตูุชูุฉ.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ูููุฉ ุฏุงุฎููุฉ ุชุชุนูุจ ููุถุน ุงูุตูุช ุงูุฐู ูุชู ุชุดุบููู. ุฅูู ูุซู ูุฑุงุกุฉ ุฑูููุฉ ุนูู ุฃู ูุดุบู mp3. ูุธุฑูุง ูุฃููุง ูููู ุจูุฒุงููุฉ ุงูููุฏูู ูุน ุงูุตูุช ุ ูุฅู ุฏูู ุงูููุฏูู ูุณุชุฎุฏู ูุฐู ุงููููุฉ ููุนุฑูุฉ ูุง ุฅุฐุง ูุงู ูุชูุฏููุง ุฌุฏูุง ุฃู ูุชุฃุฎุฑูุง ุฌุฏูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุนูุฏ ุฅูู ุงูุชูููุฐ ูู ููุช ูุงุญู ุ ูููุชุฑุถ ุงูุขู ุฃู ูุฏููุง ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_audio_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูููุญูุง ุงูููุช ุนูู ุงูุณุงุนุฉ ุงูุตูุชูุฉ. ุจูุฌุฑุฏ ุญุตูููุง ุนูู ูุฐู ุงููููุฉ ุ ูุง ุงูุฐู ูุฌุจ ุงูููุงู ุจู ุฅุฐุง ูู ุชุชู ูุฒุงููุฉ ุงูููุฏูู ูุงูุตูุชุ ุณูููู ูู ุงูุญูุงูุฉ ูุญุงููุฉ ุงูููุฒ ุฅูู ุงูุญุฒูุฉ ุงูุตุญูุญุฉ ูู ุฎูุงู ุงูุจุญุซ ุฃู ุฃู ุดูุก ุขุฎุฑ. ุจุฏูุงู ูู ุฐูู ุ ูููู ุจุจุณุงุทุฉ ุจุชุนุฏูู ุงููููุฉ ุงูุชู ูููุง ุจุญุณุงุจูุง ููุชุญุฏูุซ ุงูุชุงูู: ุฅุฐุง ูุงู PTS ุจุนูุฏูุง ุฌุฏูุง ุนู ููุช ุงูุตูุช ุ ูุฅููุง ูุถุงุนู ูุชุฑุฉ ุงูุชุฃุฎูุฑ ุงูููุฏุฑุฉ. ุฅุฐุง ูุงู PTS ูุชูุฏููุง ุฌุฏูุง ุนูู ููุช ุงููุนุจ ุ ููุญู ูููู ุจุงูุชุญุฏูุซ ุจุฃุณุฑุน ููุช ูููู. ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ุงูุชุญุฏูุซ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃู ููุช ุงูุชุฃุฎูุฑ ุ ุณูููู ุจููุงุฑูุชู ูุน ุณุงุนุฉ ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจูุง ุ ุชุงุฑููู </font><b><font style="vertical-align: inherit;">frame_timer</font></b><font style="vertical-align: inherit;"> ููุฏ ุงูุชุดุบูู </font><font style="vertical-align: inherit;">. ููุฎุต ูุคูุช ุงูุฅุทุงุฑ ูุฐุง ุฌููุน ุญุงูุงุช ุงูุชุฃุฎูุฑ ุงูููุฏุฑุฉ ุฃุซูุงุก ุชุดุบูู ุงููููู. ูุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ูุฐุง </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุทุงุฑ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ูุฐุง ูู ุงูููุช ุงูุฐู ูุดูุฑ ุฅูู ููุช ุนุฑุถ ุงูุฅุทุงุฑ ุงูุชุงูู. ูุถูู ุจุจุณุงุทุฉ ุชุฃุฎูุฑูุง ุฌุฏูุฏูุง ุฅูู ูุคูุช ุงูุฅุทุงุฑ ุ ูููุงุฑูู ุจุงูููุช ุนูู ุณุงุนุฉ ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจูุง ุ ููุณุชุฎุฏู ูุฐู ุงููููุฉ ูุชุฎุทูุท ุงูุชุญุฏูุซ ุงูุชุงูู. ูุฏ ูููู ูุฐุง ูุฑุจููุง ุจุนุถ ุงูุดูุก ุ ูุฐุง ุงูุฑุฃ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุนูุงูุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">video_refresh_timer</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *userdata)</span> </span>{<font></font>
<font></font>
  VideoState *is = (VideoState *)userdata;<font></font>
  VideoPicture *vp;<font></font>
  <span class="hljs-keyword">double</span> actual_delay, delay, sync_threshold, ref_clock, diff;<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(is-&gt;video_st) {
    <span class="hljs-keyword">if</span>(is-&gt;pictq_size == <span class="hljs-number">0</span>) {<font></font>
      schedule_refresh(is, <span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      vp = &amp;is-&gt;pictq[is-&gt;pictq_rindex];<font></font>
<font></font>
      delay = vp-&gt;pts - is-&gt;frame_last_pts; <span class="hljs-comment">/* the pts from last time */</span>
      <span class="hljs-keyword">if</span>(delay &lt;= <span class="hljs-number">0</span> || delay &gt;= <span class="hljs-number">1.0</span>) {
	<span class="hljs-comment">/* if incorrect delay, use previous one */</span><font></font>
	delay = is-&gt;frame_last_delay;<font></font>
      }<font></font>
      <span class="hljs-comment">/* save for next time */</span><font></font>
      is-&gt;frame_last_delay = delay;<font></font>
      is-&gt;frame_last_pts = vp-&gt;pts;<font></font>
<font></font>
      <span class="hljs-comment">/* update delay to sync to audio */</span><font></font>
      ref_clock = get_audio_clock(is);<font></font>
      diff = vp-&gt;pts - ref_clock;<font></font>
<font></font>
      <span class="hljs-comment">/* Skip or repeat the frame. Take delay into account
	 FFPlay still doesn't "know if this is the best guess." */</span><font></font>
      sync_threshold = (delay &gt; AV_SYNC_THRESHOLD) ? delay : AV_SYNC_THRESHOLD;<font></font>
      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">fabs</span>(diff) &lt; AV_NOSYNC_THRESHOLD) {
	<span class="hljs-keyword">if</span>(diff &lt;= -sync_threshold) {<font></font>
	  delay = <span class="hljs-number">0</span>;<font></font>
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(diff &gt;= sync_threshold) {<font></font>
	  delay = <span class="hljs-number">2</span> * delay;<font></font>
	}<font></font>
      }<font></font>
      is-&gt;frame_timer += delay;<font></font>
      <span class="hljs-comment">/* computer the REAL delay */</span>
      actual_delay = is-&gt;frame_timer - (av_gettime() / <span class="hljs-number">1000000.0</span>);
      <span class="hljs-keyword">if</span>(actual_delay &lt; <span class="hljs-number">0.010</span>) {
	<span class="hljs-comment">/* Really it should skip the picture instead */</span>
	actual_delay = <span class="hljs-number">0.010</span>;<font></font>
      }<font></font>
      schedule_refresh(is, (<span class="hljs-keyword">int</span>)(actual_delay * <span class="hljs-number">1000</span> + <span class="hljs-number">0.5</span>));
      <span class="hljs-comment">/* show the picture! */</span><font></font>
      video_display(is);<font></font>
      <font></font>
      <span class="hljs-comment">/* update queue for next picture! */</span>
      <span class="hljs-keyword">if</span>(++is-&gt;pictq_rindex == VIDEO_PICTURE_QUEUE_SIZE) {<font></font>
	is-&gt;pictq_rindex = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
      SDL_LockMutex(is-&gt;pictq_mutex);<font></font>
      is-&gt;pictq_size--;<font></font>
      SDL_CondSignal(is-&gt;pictq_cond);<font></font>
      SDL_UnlockMutex(is-&gt;pictq_mutex);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    schedule_refresh(is, <span class="hljs-number">100</span>);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุฑู ุนุฏุฉ ูุญูุตุงุช: ุฃููุงู ุ ูุชุฃูุฏ ูู ุฃู ุงูุชุฃุฎูุฑ ุจูู PTS ุงูุญุงูู ู PTS ุงูุณุงุจู ููุทูู. ุฅุฐุง ูู ุชูู ููุงู ุญุงุฌุฉ ุฅูู ุชุฃุฎูุฑ ุ ููุฏ ุชุฒุงูู ุงูุตูุช ูุงูููุฏูู ููุท ูู ูุฐู ุงููุฑุญูุฉ ูุงุณุชุฎุฏู ุงูุชุฃุฎูุฑ ุงูุฃุฎูุฑ ููุท. ุซู ูุชุฃูุฏ ูู ุงุณุชููุงุก ุญุฏ ุงูุชุฒุงูู ุ ูุฃู ุงูุชุฒุงูู ุงููุซุงูู ูุง ูุญุฏุซ ุฃุจุฏูุง. ูุณุชุฎุฏู FFplay ูููุฉ 0.01 ููุนุชุจุฉ. ูุชุฃูุฏ ุฃูุถูุง ูู ุฃู ุนุชุจุฉ ุงููุฒุงููุฉ ูุง ุชูู ุฃุจุฏูุง ุนู ุงููุชุฑุงุช ุงููุงุตูุฉ ุจูู ููู PTS. ุฃุฎูุฑูุง ุ ูู ุจุชุนููู ุงูุญุฏ ุงูุฃุฏูู ููููุฉ ุงูุชุญุฏูุซ ุนูู 10 ูููู ุซุงููุฉ (ูู ุงููุงูุน ุ ูุจุฏู ุฃูู ูุฌุจ ุนูููู ุชุฎุทู ุงูุฅุทุงุฑ ููุง ุ ูููู ูุง ุฏุงุนู ููููู ุจุดุฃู ุฐูู).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุถููุง ูุฌููุนุฉ ูู ุงููุชุบูุฑุงุช ุฅูู ุงููููู ุงููุจูุฑ ุ ูุฐูู ูุง ุชูุณ ุงูุชุญูู ูู ุงูุฑูุฒ. </font><font style="vertical-align: inherit;">ููุง ุชูุณ ุฃูุถูุง ุชููุฆุฉ ูููุช ุงูุฅุทุงุฑ ูุงูุชุฃุฎูุฑ ุงูุฃููู ููุฅุทุงุฑ ุงูุณุงุจู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stream_component_open</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">    is-&gt;frame_timer = (<span class="hljs-keyword">double</span>)av_gettime() / <span class="hljs-number">1000000.0</span>;<font></font>
    is-&gt;frame_last_delay = <span class="hljs-number">40e-3</span>;</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฒุงููุฉ: ุณุงุนุฉ ุตูุชูุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุญุงู ุงูููุช ูุฅุฏุฑุงู ุงูุณุงุนุฉ ุงูุตูุชูุฉ. </font><font style="vertical-align: inherit;">ูููููุง ุชุญุฏูุซ ุงูููุช ูู ุฏุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_decode_frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุญูุซ ูููู ุจูู ุชุดููุฑ ุงูุตูุช. </font><font style="vertical-align: inherit;">ุชุฐูุฑ ุงูุขู ุฃููุง ูุง ูููู ุฏุงุฆููุง ุจูุนุงูุฌุฉ ุญุฒูุฉ ุฌุฏูุฏุฉ ูู ูู ูุฑุฉ ูุทูู ุนูููุง ูุฐู ุงููุธููุฉ ุ ูุฐูู ููุงู ูุฌุงูุงู ุชุญุชุงุฌุงู ููู ุฅูู ุชุญุฏูุซ ุงูุณุงุนุฉ. </font><font style="vertical-align: inherit;">ุงูููุงู ุงูุฃูู ูู ุงูููุงู ุงูุฐู ูุญุตู ููู ุนูู ุงูุญุฒูุฉ ุงูุฌุฏูุฏุฉ: ููุท ูู ุจุชุซุจูุช ุณุงุนุฉ ุงูุตูุช ุนูู ุญุฒูุฉ PTS. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ุฅุฐุง ูุงูุช ุงูุญุฒูุฉ ุชุญุชูู ุนูู ุนุฏุฉ ุฅุทุงุฑุงุช ุ ูุฅููุง ูุญูุธ ููุช ุชุดุบูู ุงูุตูุช ุนู ุทุฑูู ุญุณุงุจ ุนุฏุฏ ุงูุนููุงุช ูุถุฑุจูุง ูู ุชุฑุฏุฏ ุฃุฎุฐ ุนููุงุช ูุนูู ูู ุงูุซุงููุฉ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุนูุฏูุง ูููู ูุฏููุง ุงูุญุฒูุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">/* if update, update the audio clock w/pts */</span>
    <span class="hljs-keyword">if</span>(pkt-&gt;pts != AV_NOPTS_VALUE) {<font></font>
      is-&gt;audio_clock = av_q2d(is-&gt;audio_st-&gt;time_base)*pkt-&gt;pts;<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจูุฌุฑุฏ ูุนุงูุฌุฉ ุงูุญุฒูุฉ:</font></font><br>
<br>
<pre><code class="cpp hljs">      <span class="hljs-comment">/* Keep audio_clock up-to-date */</span><font></font>
      pts = is-&gt;audio_clock;<font></font>
      *pts_ptr = pts;<font></font>
      n = <span class="hljs-number">2</span> * is-&gt;audio_st-&gt;codec-&gt;channels;<font></font>
      is-&gt;audio_clock += (<span class="hljs-keyword">double</span>)data_size /<font></font>
	(<span class="hljs-keyword">double</span>)(n * is-&gt;audio_st-&gt;codec-&gt;sample_rate);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุถ ุงููุฑูู ุงูุทูููุฉ: ุชู ุชุบููุฑ ูุงูุจ ุงููุธููุฉ ููุชุถูู ุงูุขู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฐุง ุชุฃูุฏ ูู ุชุบููุฑู. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts_ptr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงููุคุดุฑ ุงูุฐู ูุณุชุฎุฏูู ูุฅุนูุงู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_callback</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุญุฒูุฉ ุงูุตูุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุณูุชู ุงุณุชุฎุฏุงู ูุฐุง ูู ุงููุฑุฉ ุงููุงุฏูุฉ ููุฒุงููุฉ ุงูุตูุช ูุน ุงูููุฏูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูููููุง ุชูููุฐ ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_audio_clock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุฎูุฑูุง </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุงููุง ููุณุช ุจูุฐู ุงูุจุณุงุทุฉ ุงูุญุตูู ุนูู ูููุฉ </font></font><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -&gt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_clock</font></font></b></nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุฅุฐุง ููุช ุชููุฑ ูู ุฐูู. </font><font style="vertical-align: inherit;">ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูููู ุจุชุนููู ุตูุช PTS ูู ูู ูุฑุฉ ูููู </font><b><font style="vertical-align: inherit;">ุจูุนุงูุฌุชูุง</font></b><font style="vertical-align: inherit;"> ุ ูููู ุฅุฐุง ูุธุฑุช ุฅูู ูุธููุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio_callback</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุณูุณุชุบุฑู ููู ุฌููุน ุงูุจูุงูุงุช ูู ุงูุญุฒูุฉ ุงูุตูุชูุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช ููุฅุฎุฑุงุฌ ุจุนุถ ุงูููุช. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู ุงููููุฉ ูู ุณุงุนุฉ ุงูุตูุช ูุฏููุง ูุฏ ุชููู ุจุนูุฏุฉ ุฌุฏูุง. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุญุชุงุฌ ุฅูู ุงูุชุญูู ูู ููุฏุงุฑ ูุง ูุชุนูู ุนูููุง ูุชุงุจุชู. </font><font style="vertical-align: inherit;">ููุง ูู ุงูุฑูุฒ ุงููุงูู:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">get_audio_clock</span><span class="hljs-params">(VideoState *is)</span> </span>{
  <span class="hljs-keyword">double</span> pts;
  <span class="hljs-keyword">int</span> hw_buf_size, bytes_per_sec, n;<font></font>
  <font></font>
  pts = is-&gt;audio_clock; <span class="hljs-comment">/* maintained in the audio thread */</span><font></font>
  hw_buf_size = is-&gt;audio_buf_size - is-&gt;audio_buf_index;<font></font>
  bytes_per_sec = <span class="hljs-number">0</span>;<font></font>
  n = is-&gt;audio_st-&gt;codec-&gt;channels * <span class="hljs-number">2</span>;
  <span class="hljs-keyword">if</span>(is-&gt;audio_st) {<font></font>
    bytes_per_sec = is-&gt;audio_st-&gt;codec-&gt;sample_rate * n;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span>(bytes_per_sec) {<font></font>
    pts -= (<span class="hljs-keyword">double</span>)hw_buf_size / bytes_per_sec;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> pts;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุฃู ุชููู ุงูุขู ุณุจุจ ุนูู ูุฐู ุงููุธููุฉ ุ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูู ุดูุก! </font><font style="vertical-align: inherit;">ูููู ุจุชุฌููุน:</font></font><br>
<br>
<pre><code class="bash hljs">gcc -o tutorial05 tutorial05.c -lavutil -lavformat -lavcodec -lswscale -lz -lm \<font></font>
`sdl-config --cflags --libs`</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ุญุฏุซ! </font><font style="vertical-align: inherit;">ููููู ูุดุงูุฏุฉ ุงููููู ุนูู ูุงุนุจ ุนุตุงูู. </font><font style="vertical-align: inherit;">ูู ุงูุฏุฑุณ ุงูุชุงูู ุ ุณูููู ูุธุฑุฉ ุนูู ูุฒุงููุฉ ุงูุตูุช ุ ุซู ุณูุชุนุฑู ุนูู ููููุฉ ุงูุจุญุซ.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏููู FFmpeg ู SDL ุฃู ููููุฉ ูุชุงุจุฉ ูุดุบู ููุฏูู ูู ุฃูู ูู 1000 ุณุทุฑ - ุงูุฌุฒุก 2</font></font></a></h3><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุฌูุงุช ูุฏููุฉ ุงุฏูุณูู:</font></font></h3><div class="scrollable-table"><table>
<tbody><tr>
<td align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img width="360" height="180" src="https://habrastorage.org/webt/fr/yz/q7/fryzq72v0ik0irt2q4orchflxvs.jpeg"></a></td>
<td align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img width="360" height="180" src="https://habrastorage.org/webt/jv/3k/-f/jv3k-f5vi9drztohsh-e0t-puru.jpeg"></a></td>
</tr>
<tr>
<th align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุถู 50 ุงูุชูุงุฒูุง ููุฃูุนุงุจ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุน ุฃูุซุฑ ูู ูููุงุฑ ุฅูุฑุงุฏุงุช</font></font></a></th>
<th align="center"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุณููุฌู Airbnb ูู ุงูููุฑูุณ ุงูุชุงุฌูุ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ุงูููุณุฏ: ูุนู]</font></font></a></th>
</tr>
</tbody></table></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar500386/index.html">ุชูููู ุญู ุนููู ุงูุญุงูู ูุน SwiftUI. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar500390/index.html">ุงูููุงุฐุฌ ุงููุนููุฉ ููุชูุทูู ุงููุบูู ูู ูุฌุงู ุชูููููุฌูุง ุงููุนูููุงุช ูุงูุงุชุตุงูุงุช ุงูุฑูููุฉ. ุงูุฌุฒุก ุงูุฃูู</a></li>
<li><a href="../ar500396/index.html">ูุดุงูู ุฃูุธูุฉ ุงูุชุญูู ูู ุงููุตูู ุงููุณุชููุฉ - ุญูุซ ูู ูุชููุนูุง</a></li>
<li><a href="../ar500398/index.html">ุฃุณุจูุน ุงููุงุฑุงุซูู ุงูุจุนูุฏ 3: ุงูุนูููุงุช ุบูุฑ ุงูุนูููุฉ</a></li>
<li><a href="../ar500400/index.html">ุชูููู ุงูุฎููุท: ุงููุฌุฑุฉ ูู Puppet Enterprise ุฅูู ุจุฑุฌ Ansible. ุงูุฌุฒุก ุงูุฃูู</a></li>
<li><a href="../ar500404/index.html">ููููุฉ ุชูููู ุตุฏุงูุงุช Electron ู Webix. ุงูุฌุฒุก 2. ุฅูุดุงุก ุชุทุจูู ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุนุฑุถ ุงูุฎุงุตุฉ ุจู</a></li>
<li><a href="../ar500406/index.html">ูุตุฉ ุงูุดูู ุงูุฃูู ููุฅูุชุฑูุช: ูุนูุฉ ุงูุฅุดุงุฑุฉ ุงููุดุบููุฉ</a></li>
<li><a href="../ar500408/index.html">ุงูุณุนุงุฏุฉ ูู ุงูููุฑ</a></li>
<li><a href="../ar500410/index.html">ุฅูุดุงุก ุฑุฏ ูุนู ุนููู *</a></li>
<li><a href="../ar500414/index.html">ุขูุฉ 3D CNC ุฃู ูู ุดูุก ูุชู ุจุงููุนู ูุจููุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>