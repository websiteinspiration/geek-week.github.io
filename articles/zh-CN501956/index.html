<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™»ï¸ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ¼ ğŸ’³ æˆ‘ä»¬åœ¨etcd Kubernetes-clusterä¸­ç›´æ¥å¤„ç†æ•°æ®çš„ç»éªŒï¼ˆä¸ä½¿ç”¨K8s APIï¼‰ ğŸ­ ğŸ‘¨ğŸ»â€ğŸ¤ ğŸ‘¨ğŸ¿â€ğŸš€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å®¢æˆ·è¶Šæ¥è¶Šå¤šåœ°å‘æˆ‘ä»¬è¯·æ±‚æä¾›å¯¹Kubernetesé›†ç¾¤çš„è®¿é—®æƒï¼Œä»¥è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼šä¸ºäº†èƒ½å¤Ÿç›´æ¥è¿æ¥åˆ°æŸäº›æ•°æ®åº“æˆ–æœåŠ¡ï¼Œå°†æœ¬åœ°åº”ç”¨ç¨‹åºä¸é›†ç¾¤å†…çš„åº”ç”¨ç¨‹åºè¿æ¥èµ·æ¥â€¦â€¦ 
 
 
 
 ä¾‹å¦‚ï¼Œéœ€è¦è¿›è¡Œè¿æ¥ä»æ‚¨çš„æœ¬åœ°æœºå™¨åˆ°æœåŠ¡memcached.staging.svc.cluster.localã€‚æˆ‘ä»¬ä¸ºè¿™...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬åœ¨etcd Kubernetes-clusterä¸­ç›´æ¥å¤„ç†æ•°æ®çš„ç»éªŒï¼ˆä¸ä½¿ç”¨K8s APIï¼‰</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/501956/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®¢æˆ·è¶Šæ¥è¶Šå¤šåœ°å‘æˆ‘ä»¬è¯·æ±‚æä¾›å¯¹Kubernetesé›†ç¾¤çš„è®¿é—®æƒï¼Œä»¥è®¿é—®é›†ç¾¤å†…çš„æœåŠ¡ï¼šä¸ºäº†èƒ½å¤Ÿç›´æ¥è¿æ¥åˆ°æŸäº›æ•°æ®åº“æˆ–æœåŠ¡ï¼Œå°†æœ¬åœ°åº”ç”¨ç¨‹åºä¸é›†ç¾¤å†…çš„åº”ç”¨ç¨‹åºè¿æ¥èµ·æ¥â€¦â€¦ </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/mh/du/rimhduzpzbuwtylhnil4dorhzw4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œéœ€è¦è¿›è¡Œè¿æ¥ä»æ‚¨çš„æœ¬åœ°æœºå™¨åˆ°æœåŠ¡</font></font><code>memcached.staging.svc.cluster.local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬ä¸ºè¿™ä¸ªæœºä¼šæä¾›äº†å®¢æˆ·ç«¯è¿æ¥åˆ°çš„ç¾¤é›†å†…éƒ¨çš„VPNã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®£å¸ƒäº†Podï¼ŒæœåŠ¡çš„å­ç½‘ï¼Œå¹¶å°†ç¾¤é›†DNSæ¨é€åˆ°å®¢æˆ·ç«¯ã€‚å› æ­¤ï¼Œå½“å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°æœåŠ¡æ—¶</font></font><code>memcached.staging.svc.cluster.local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯·æ±‚å°†è½¬åˆ°ç¾¤é›†çš„DNSï¼Œå¹¶ä½œä¸ºå“åº”ä»ç¾¤é›†æœåŠ¡ç½‘ç»œæ¥æ”¶è¯¥æœåŠ¡çš„åœ°å€æˆ–Podåœ°å€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä½¿ç”¨kubeadmé…ç½®K8sé›†ç¾¤ï¼Œå…¶ä¸­æœåŠ¡å­ç½‘é»˜è®¤</font></font><code>192.168.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºï¼ŒåŠèˆ±ç½‘ç»œä¸º</font></font><code>10.244.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œä½†æœ‰ä¸¤ç‚¹ï¼š</font></font><a name="habracut"></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­</font></font><code>192.168.*.*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘é€šå¸¸ç”¨äºå®¢æˆ·ç«¯çš„åŠå…¬ç½‘ç»œï¼Œç”šè‡³æ›´ç»å¸¸ç”¨äºå¼€å‘äººå‘˜çš„å®¶åº­ç½‘ç»œã€‚</font><font style="vertical-align: inherit;">ç„¶åæˆ‘ä»¬é‡åˆ°äº†å†²çªï¼šå®¶ç”¨è·¯ç”±å™¨åœ¨è¯¥å­ç½‘ä¸Šå·¥ä½œï¼ŒVPNå°†è¿™äº›å­ç½‘ä»ç¾¤é›†æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰å‡ ä¸ªé›†ç¾¤ï¼ˆç”Ÿäº§ï¼Œé˜¶æ®µå’Œ/æˆ–å‡ ä¸ªå¼€å‘é›†ç¾¤ï¼‰ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¿™äº›å®¹å™¨ä¸­çš„podå’ŒæœåŠ¡éƒ½å°†å…·æœ‰ç›¸åŒçš„å­ç½‘ï¼Œè¿™ç»™åŒæ—¶ä½¿ç”¨å¤šä¸ªç¾¤é›†ä¸­çš„æœåŠ¡å¸¦æ¥äº†å¾ˆå¤§çš„å›°éš¾ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘ä»¬å·²ç»é‡‡ç”¨äº†åœ¨ä¸€ä¸ªé¡¹ç›®çš„æ¡†æ¶å†…å¯¹æœåŠ¡å’ŒPodä½¿ç”¨ä¸åŒå­ç½‘çš„åšæ³•-é€šå¸¸ï¼Œä»¥ä¾¿æ‰€æœ‰ç¾¤é›†éƒ½å…·æœ‰ä¸åŒçš„ç½‘ç»œã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘ä¸æƒ³ä»å¤´å¼€å§‹è¿è¡Œå¤§é‡ç¾¤é›†ï¼Œå› ä¸ºå®ƒä»¬è¿è¡Œè®¸å¤šæœåŠ¡ï¼Œæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºç­‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åæˆ‘ä»¬é—®è‡ªå·±ï¼šå¦‚ä½•æ›´æ”¹ç°æœ‰ç¾¤é›†ä¸­çš„å­ç½‘ï¼Ÿ</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœå¯»å†³ç­–</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€å¸¸è§çš„åšæ³•æ˜¯</font><font style="vertical-align: inherit;">ä½¿ç”¨ClusterIPç±»å‹</font><font style="vertical-align: inherit;">é‡æ–°åˆ›å»º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœåŠ¡ã€‚</font><font style="vertical-align: inherit;">æˆ–è€…ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»–ä»¬ä¹Ÿå¯ä»¥å»ºè®®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹è¿‡ç¨‹å­˜åœ¨é—®é¢˜ï¼šé…ç½®å®Œæ‰€æœ‰å†…å®¹åï¼Œpodåœ¨/etc/resolv.confä¸­å°†æ—§IPç”¨ä½œDNSåç§°æœåŠ¡å™¨ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºä»ç„¶æ‰¾ä¸åˆ°è§£å†³æ–¹æ¡ˆï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸ä½¿ç”¨kubeadm reseté‡ç½®æ•´ä¸ªé›†ç¾¤ï¼Œç„¶åå†æ¬¡å°†å…¶åˆå§‹åŒ–ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†è¿™å¹¶ä¸é€‚åˆæ¯ä¸ªäºº...ä»¥ä¸‹æ˜¯é’ˆå¯¹æˆ‘ä»¬æ¡ˆä¾‹çš„æ›´è¯¦ç»†çš„å…¥é—¨è¯´æ˜ï¼š </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¢«æ³•å…°ç»’ä½¿ç”¨ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> äº‘å±‚å’Œé“å—ä¸Šéƒ½æœ‰å›¢ç°‡;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘æƒ³é¿å…åœ¨é›†ç¾¤ä¸­é‡å¤éƒ¨ç½²æ‰€æœ‰æœåŠ¡ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> éœ€è¦ä»¥æœ€å°çš„é—®é¢˜æ¥åšæ‰€æœ‰äº‹æƒ…ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kubernetesç‰ˆæœ¬ä¸º1.16.6ï¼ˆä½†æ˜¯ï¼Œå…¶ä»–ç‰ˆæœ¬çš„å…¶ä»–æ“ä½œå°†ç±»ä¼¼ï¼‰ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸»è¦ä»»åŠ¡æ˜¯å°†å…¶</font></font><code>192.168.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›¿æ¢ä¸º</font><font style="vertical-align: inherit;">ä½¿ç”¨å¸¦æœ‰æœåŠ¡å­ç½‘çš„kubeadméƒ¨ç½²çš„ç¾¤é›†</font></font><code>172.24.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¢°å·§çš„æ˜¯ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œæˆ‘ä»¬å¾ˆæ„Ÿå…´è¶£åœ°çœ‹åˆ°å®ƒå­˜å‚¨åœ¨etcdä¸­çš„æ–¹å¼ä»¥åŠå¦‚ä½•åœ¨Kubernetesä¸­å­˜å‚¨ï¼Œæ ¹æœ¬å¯ä»¥ç”¨å®ƒæ¥å®Œæˆ...å› æ­¤æˆ‘ä»¬æƒ³åˆ°ï¼šâ€œ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆä¸é€šè¿‡æ›¿æ¢æ—§çš„IPåœ°å€ï¼ˆå­ç½‘ï¼‰æ¥æ›´æ–°etcdä¸­çš„æ•°æ®æ¢æ–°çš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Ÿâ€ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¯»æ‰¾ç”¨äºåœ¨etcdä¸­å¤„ç†æ•°æ®çš„ç°æˆå·¥å…·æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°å¯ä»¥å®Œå…¨è§£å†³ä»»åŠ¡çš„ä»»ä½•ä¸œè¥¿ã€‚</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‚¨çŸ¥é“ä»»ä½•ç›´æ¥åœ¨etcdä¸­å¤„ç†æ•°æ®çš„å®ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†éå¸¸æ„Ÿè°¢æ‚¨æä¾›çš„é“¾æ¥ã€‚ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">OpenShift </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etcdhelper</font></font></b><font style="vertical-align: inherit;"></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆä¸ºäº†ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆæ„Ÿè°¢å…¶ä½œè€…ï¼ï¼‰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥å®ç”¨ç¨‹åºèƒ½å¤Ÿè¿æ¥ä½¿ç”¨è¯ä¹¦ETCDä½¿ç”¨è¿™äº›å‘½ä»¤ä¸Šè¯»å‡ºçš„æ•°æ®</font></font><code>ls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ etcdhelper</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹æƒ³æ³•æ˜¯åˆä¹é€»è¾‘çš„ï¼šâ€œæ˜¯ä»€ä¹ˆé˜»ç¢äº†æ·»åŠ æ­¤å®ç”¨ç¨‹åºï¼Œå¢åŠ äº†å‘etcdå†™å…¥æ•°æ®çš„åŠŸèƒ½ï¼Ÿâ€ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒå·²è¢«ç¿»è¯‘æˆetcdhelperä¿®æ”¹åçš„ç‰ˆæœ¬æœ‰ä¸¤ä¸ªæ–°çš„</font></font><code>changeServiceCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font><font style="vertical-align: inherit;">åŠŸèƒ½</font></font><code>changePodCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ‚¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œ</font></font></a></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">çœ‹åˆ°</font></b><font style="vertical-align: inherit;">å¥¹çš„</font><b><font style="vertical-align: inherit;">ä»£ç </font></b><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°åŠŸèƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</font><font style="vertical-align: inherit;">ç®—æ³•</font></font><code>changeServiceCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ä»¥æ›¿æ¢CIDRï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬é€šè¿‡é›†ç¾¤ä¸­æ‰€æœ‰å…·æœ‰ClusterIPç±»å‹çš„æœåŠ¡ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†etcdä¸­çš„å€¼è§£ç ä¸ºGoå¯¹è±¡ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢åœ°å€çš„å‰ä¸¤ä¸ªå­—èŠ‚ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»æ–°å­ç½‘ä¸ºæœåŠ¡åˆ†é…IPåœ°å€ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åˆ›å»ºä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼Œå°†Goå¯¹è±¡è½¬æ¢ä¸ºprotobufï¼Œå°†æ–°æ•°æ®å†™å…¥etcdã€‚</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠŸèƒ½</font></font><code>changePodCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„</font></font><code>changeServiceCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-åªæ˜¯ä¸å¯¹æœåŠ¡è§„èŒƒè¿›è¡Œç¼–è¾‘ï¼Œæˆ‘ä»¬å¯¹èŠ‚ç‚¹è¿›è¡Œäº†å¤„ç†å¹¶å°†å…¶æ›´æ”¹</font></font><code>.spec.PodCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ–°çš„å­ç½‘ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®è·µ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜æ›´æœåŠ¡CIDR</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»»åŠ¡çš„æ‰§è¡Œè®¡åˆ’éå¸¸ç®€å•ï¼Œä½†æ˜¯åœ¨é‡æ–°åˆ›å»ºé›†ç¾¤ä¸­çš„æ‰€æœ‰Podæ—¶éƒ½ä¼šæ¶‰åŠåœæœºæ—¶é—´ã€‚</font><font style="vertical-align: inherit;">åœ¨æè¿°äº†ä¸»è¦æ­¥éª¤ä¹‹åï¼Œæˆ‘ä»¬è¿˜å°†åˆ†äº«æˆ‘ä»¬çš„æƒ³æ³•ï¼Œå³ä»ç†è®ºä¸Šå¦‚ä½•æœ€å°åŒ–è¿™ä¸€ç®€å•æ­¥éª¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡†å¤‡è¡ŒåŠ¨ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶ç»„è£…ä¿®è¡¥çš„etcdhelperï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤‡ä»½etcdå’Œ</font></font><code>/etc/kubernetes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›´æ”¹æœåŠ¡çš„çŸ­æœŸè¡ŒåŠ¨è®¡åˆ’CIDRï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¿®æ”¹apiserverå’Œæ§åˆ¶å™¨ç®¡ç†å™¨æ¸…å•</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡æ–°ç­¾å‘è¯ä¹¦ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> etcdä¸­çš„ClusterIPæœåŠ¡å‘ç”Ÿäº†å˜åŒ–ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡æ–°å¯åŠ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰Podã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®Œæ•´åŠ¨ä½œåºåˆ—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.å®‰è£…etcd-clientè¿›è¡Œæ•°æ®è½¬å‚¨ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">apt install etcd-client</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.æˆ‘ä»¬æ”¶é›†etcdhelperï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬æŠŠgolangï¼š</font></font><br>
<br>
<pre><code class="bash hljs">GOPATH=/root/golang<font></font>
mkdir -p <span class="hljs-variable">$GOPATH</span>/<span class="hljs-built_in">local</span>
curl -sSL https://dl.google.com/go/go1.14.1.linux-amd64.tar.gz | tar -xzvC <span class="hljs-variable">$GOPATH</span>/<span class="hljs-built_in">local</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"export GOPATH=\"<span class="hljs-variable">$GOPATH</span>\""</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export GOROOT="$GOPATH/local/go"'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="$PATH:$GOPATH/local/go/bin"'</span> &gt;&gt; ~/.bashrc</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¿å­˜è‡ªå·±</font></font><code>etcdhelper.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ŒåŠ è½½ä¾èµ–é¡¹ï¼Œæ”¶é›†ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">wget https://raw.githubusercontent.com/flant/examples/master/2020/04-etcdhelper/etcdhelper.go<font></font>
go get go.etcd.io/etcd/clientv3 k8s.io/kubectl/pkg/scheme k8s.io/apimachinery/pkg/runtime<font></font>
go build -o etcdhelper etcdhelper.go</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.å¤‡ä»½etcdï¼š</font></font><br>
<br>
<pre><code class="bash hljs">backup_dir=/root/backup<font></font>
mkdir <span class="hljs-variable">${backup_dir}</span>
cp -rL /etc/kubernetes <span class="hljs-variable">${backup_dir}</span>
ETCDCTL_API=3 etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --key=/etc/kubernetes/pki/etcd/server.key --cert=/etc/kubernetes/pki/etcd/server.crt --endpoints https://192.168.199.100:2379 snapshot save <span class="hljs-variable">${backup_dir}</span>/etcd.snapshot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.åœ¨Kubernetesæ§åˆ¶å¹³é¢æ¸…å•ä¸­æ›´æ”¹æœåŠ¡å­ç½‘ã€‚</font><font style="vertical-align: inherit;">åœ¨æ–‡ä»¶ä¸­</font></font><code>/etc/kubernetes/manifests/kube-apiserver.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶</font></font><code>/etc/kubernetes/manifests/kube-controller-manager.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹å˜å‚æ•°</font></font><code>--service-cluster-ip-range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°æ–°çš„å­ç½‘ï¼š</font></font><code>172.24.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£æ›¿</font></font><code>192.168.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.ç”±äºæˆ‘ä»¬æ­£åœ¨æ›´æ”¹kubeadmä¸ºå…¶é¢å‘apiserverè¯ä¹¦ï¼ˆåŒ…æ‹¬ï¼‰çš„æœåŠ¡å­ç½‘ï¼Œå› æ­¤å¿…é¡»é‡æ–°å‘å¸ƒï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“å‰è¯ä¹¦çš„é¢å‘åŸŸå’ŒIPåœ°å€ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">openssl x509 -noout -ext subjectAltName &lt;/etc/kubernetes/pki/apiserver.crt<font></font>
X509v3 Subject Alternative Name:<font></font>
    DNS:dev-1-master, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:apiserver, IP Address:192.168.0.1, IP Address:10.0.0.163, IP Address:192.168.199.100</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å‡†å¤‡kubeadmçš„æœ€ä½é…ç½®ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">cat kubeadm-config.yaml<font></font>
apiVersion: kubeadm.k8s.io/v1beta1<font></font>
kind: ClusterConfiguration<font></font>
networking:<font></font>
  podSubnet: <span class="hljs-string">"10.244.0.0/16"</span>
  serviceSubnet: <span class="hljs-string">"172.24.0.0/16"</span><font></font>
apiServer:<font></font>
  certSANs:<font></font>
  - <span class="hljs-string">"192.168.199.100"</span> <span class="hljs-comment"># IP-  </span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è®©æˆ‘ä»¬åˆ é™¤æ—§çš„crtå’Œå¯†é’¥ï¼Œå› ä¸ºæ²¡æœ‰å®ƒï¼Œå°†ä¸ä¼šé¢å‘æ–°è¯ä¹¦ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">rm /etc/kubernetes/pki/apiserver.{key,crt}</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡æ–°é¢å‘APIæœåŠ¡å™¨çš„è¯ä¹¦ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubeadm init phase certs apiserver --config=kubeadm-config.yaml</code></pre></li>
<li> ,      :<br>
<br>
<pre><code class="bash hljs">openssl x509 -noout -ext subjectAltName &lt;/etc/kubernetes/pki/apiserver.crt<font></font>
X509v3 Subject Alternative Name:<font></font>
    DNS:kube-2-master, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:172.24.0.1, IP Address:10.0.0.163, IP Address:192.168.199.100</code></pre></li>
<li>    API-   :<br>
<br>
<pre><code class="bash hljs">docker ps | grep k8s_kube-apiserver | awk <span class="hljs-string">'{print $1}'</span> | xargs docker restart</code></pre></li>
<li>    <code>admin.conf</code>:<br>
<br>
<pre><code class="bash hljs">kubeadm alpha certs renew admin.conf</code></pre></li>
<li>    etcd:<br>
<br>
<pre><code class="bash hljs">./etcdhelper -cacert /etc/kubernetes/pki/etcd/ca.crt -cert /etc/kubernetes/pki/etcd/server.crt -key /etc/kubernetes/pki/etcd/server.key -endpoint https://127.0.0.1:2379 change-service-cidr 172.24.0.0/16 </code></pre><br>
<b>!</b>         ,      pod'  <code>/etc/resolv.conf</code>    CoreDNS (kube-dns),  kube-proxy   iptables     .         .</li>
<li>  ConfigMap'    <code>kube-system</code>:<br>
<br>
<pre><code class="bash hljs">kubectl -n kube-system edit cm kubelet-config-1.16</code></pre><br>
â€”   <code>clusterDNS</code>   IP-  kube-dns: <code>kubectl -n kube-system get svc kube-dns</code>.<br>
<br>
<pre><code class="bash hljs">kubectl -n kube-system edit cm kubeadm-config</code></pre><br>
â€”  <code>data.ClusterConfiguration.networking.serviceSubnet</code>   .</li>
<li>     kube-dns,    kubelet   :<br>
<br>
<pre><code class="bash hljs">kubeadm upgrade node phase kubelet-config &amp;&amp; systemctl restart kubelet</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»ç„¶å¯ä»¥é‡æ–°å¯åŠ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰Podï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get pods --no-headers=<span class="hljs-literal">true</span> --all-namespaces |sed -r <span class="hljs-string">'s/(\S+)\s+(\S+).*/kubectl --namespace \1 delete pod \2/e'</span></code></pre></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœæœºæ—¶é—´æœ€å°‘</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…³äºå¦‚ä½•æœ€å¤§ç¨‹åº¦åœ°å‡å°‘åœæœºæ—¶é—´çš„æƒ³æ³•ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ”¹æ§åˆ¶å¹³é¢çš„è¡¨ç¤ºåï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨åç§°</font></font><code>kube-dns-tmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œæ–°åœ°å€</font><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªæ–°çš„kube-dnsæœåŠ¡</font></font><code>172.24.0.10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨etcdhelperï¼Œè¿™ä¸ä¼šä¿®æ”¹KUBE-DNSæœåŠ¡ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨</font></font><code>ClusterDNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°çš„</font><font style="vertical-align: inherit;">kubeletæ›¿æ¢æ‰€æœ‰kubeletä¸­çš„åœ°å€</font><font style="vertical-align: inherit;">ï¼Œè€Œæ—§çš„æœåŠ¡å°†ç»§ç»­ä¸æ–°çš„</font><font style="vertical-align: inherit;">kubelet </font><font style="vertical-align: inherit;">åŒæ—¶å·¥ä½œã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç­‰å¾…å¸¦æœ‰åº”ç”¨ç¨‹åºçš„podå‡ºäºè‡ªç„¶åŸå› è‡ªå·±æˆ–åœ¨çº¦å®šçš„æ—¶é—´æ»šåŠ¨ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ é™¤æœåŠ¡</font></font><code>kube-dns-tmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†å…¶æ›´æ”¹</font></font><code>serviceSubnetCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºkube-dnsæœåŠ¡ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥è®¡åˆ’å°†</font></font><code>kube-dns-tmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å…³é—­æœåŠ¡å’Œæ›´æ¢æœåŠ¡çš„å­ç½‘ä¹‹å‰ï¼Œ</font><font style="vertical-align: inherit;">å°†åœæœºæ—¶é—´æœ€å°åŒ–åˆ°ä¸€åˆ†é’Ÿå·¦å³</font></font><code>kube-dns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¿®æ”¹podNetwork</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ—¶ï¼Œæˆ‘ä»¬å†³å®šçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ç”Ÿæˆçš„etcdhelperä¿®æ”¹podNetworkã€‚</font><font style="vertical-align: inherit;">åŠ¨ä½œé¡ºåºå¦‚ä¸‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¿®å¤äº†é…ç½®</font></font><code>kube-system</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ä¿®å¤äº†kube-controller-managerçš„æ¸…å•ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ç›´æ¥åœ¨etcdä¸­æ›´æ”¹podCIDRï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‡æ–°å¯åŠ¨ç¾¤é›†çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ›´å¤šæœ‰å…³è¿™äº›æ“ä½œçš„ä¿¡æ¯ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.åœ¨åç§°ç©ºé—´ä¸­ä¿®æ”¹ConfigMap </font></font><code>kube-system</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n kube-system edit cm kubeadm-config</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-å›ºå®š</font></font><code>data.ClusterConfiguration.networking.podSubnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ–°çš„å­ç½‘ä¸­</font></font><code>10.55.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">kubectl -n kube-system edit cm kube-proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-æˆ‘ä»¬çº æ­£äº†</font></font><code>data.config.conf.clusterCIDR: 10.55.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.ä¿®æ”¹æ§åˆ¶å™¨ç®¡ç†å‘˜çš„æ¸…å•ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">vim /etc/kubernetes/manifests/kube-controller-manager.yaml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-æˆ‘ä»¬çº æ­£äº†</font></font><code>--cluster-cidr=10.55.0.0/16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.æŸ¥çœ‹å½“å‰å€¼</font></font><code>.spec.podCIDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>.spec.podCIDRs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>.InternalIP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><code>.status.addresses</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºé›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get no -o json | jq <span class="hljs-string">'[.items[] | {"name": .metadata.name, "podCIDR": .spec.podCIDR, "podCIDRs": .spec.podCIDRs, "InternalIP": (.status.addresses[] | select(.type == "InternalIP") | .address)}]'</span></code></pre><br>
<pre><code class="json hljs">[<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-master"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.244.0.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.244.0.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"192.168.199.2"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-master"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.244.0.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.244.0.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"10.0.1.239"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-worker-01f438cf-579f9fd987-5l657"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.244.1.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.244.1.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"192.168.199.222"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-worker-01f438cf-579f9fd987-5l657"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.244.1.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.244.1.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"10.0.4.73"</span><font></font>
  }<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.é€šè¿‡ç›´æ¥å¯¹etcdè¿›è¡Œæ›´æ”¹æ¥æ›¿æ¢podCIDRï¼š</font></font><br>
<br>
<pre><code class="bash hljs">./etcdhelper -cacert /etc/kubernetes/pki/etcd/ca.crt -cert /etc/kubernetes/pki/etcd/server.crt -key /etc/kubernetes/pki/etcd/server.key -endpoint https://127.0.0.1:2379 change-pod-cidr 10.55.0.0/16</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.æ£€æŸ¥podCIDRæ˜¯å¦ç¡®å®å·²æ›´æ”¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">kubectl get no -o json | jq <span class="hljs-string">'[.items[] | {"name": .metadata.name, "podCIDR": .spec.podCIDR, "podCIDRs": .spec.podCIDRs, "InternalIP": (.status.addresses[] | select(.type == "InternalIP") | .address)}]'</span></code></pre><br>
<pre><code class="json hljs">[<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-master"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.55.0.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.55.0.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"192.168.199.2"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-master"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.55.0.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.55.0.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"10.0.1.239"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-worker-01f438cf-579f9fd987-5l657"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.55.1.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.55.1.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"192.168.199.222"</span><font></font>
  },<font></font>
  {<font></font>
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"kube-2-worker-01f438cf-579f9fd987-5l657"</span>,
    <span class="hljs-attr">"podCIDR"</span>: <span class="hljs-string">"10.55.1.0/24"</span>,
    <span class="hljs-attr">"podCIDRs"</span>: [
      <span class="hljs-string">"10.55.1.0/24"</span><font></font>
    ],<font></font>
    <span class="hljs-attr">"InternalIP"</span>: <span class="hljs-string">"10.0.4.73"</span><font></font>
  }<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.åè¿‡æ¥ï¼Œæˆ‘ä»¬å°†é‡æ–°å¼•å¯¼é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.å¦‚æœè‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¦»å¼€äº†æ—§çš„podCIDR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œé‚£ä¹ˆkube-controller-managerå°†æ— æ³•å¯åŠ¨ï¼Œå¹¶ä¸”ç¾¤é›†ä¸­çš„Podä¹Ÿä¸ä¼šè¢«è®¡åˆ’ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œæ›´æ”¹podCIDRå¯ä»¥å˜å¾—æ›´åŠ å®¹æ˜“ï¼ˆä¾‹å¦‚ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åƒè¿™æ ·</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä»¬æƒ³å­¦ä¹ å¦‚ä½•ç›´æ¥ä½¿ç”¨etcdï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåœ¨etcdä¸­ç¼–è¾‘Kuberneteså¯¹è±¡æ˜¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å”¯ä¸€</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯èƒ½çš„é€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">ï¼ˆä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½åœ¨æ²¡æœ‰åœæœºçš„æƒ…å†µä¸‹æ›´æ”¹æœåŠ¡èŒƒå›´</font></font><code>spec.clusterIP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ï¼‰</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡è€ƒè™‘äº†ç›´æ¥åœ¨etcdä¸­å¤„ç†æ•°æ®çš„å¯èƒ½æ€§ï¼Œå³ </font><font style="vertical-align: inherit;">ç»•è¿‡Kubernetes APIã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶ï¼Œè¿™ç§æ–¹æ³•ä½¿æ‚¨å¯ä»¥åšâ€œæ£˜æ‰‹çš„äº‹æƒ…â€ã€‚</font><font style="vertical-align: inherit;">æœ¬æ–‡ä¸­æè¿°çš„æ“ä½œå·²åœ¨çœŸå®çš„K8sé›†ç¾¤ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå®ƒä»¬å‡†å¤‡å¹¿æ³›ä½¿ç”¨çš„çŠ¶æ€æ˜¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PoCï¼ˆæ¦‚å¿µè¯æ˜ï¼‰</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¦‚æœè¦åœ¨ç¾¤é›†ä¸Šä½¿ç”¨etcdhelperå®ç”¨ç¨‹åºçš„ä¿®æ”¹ç‰ˆï¼Œåˆ™åæœè‡ªè´Ÿï¼Œå¹¶æ‰¿æ‹…é£é™©ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èšè‹¯ä¹™çƒ¯</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etcd 3.4.3ï¼šå­˜å‚¨å¯é æ€§å’Œå®‰å…¨æ€§ç ”ç©¶</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesä¸Šçš„Calico for webï¼šäº†è§£å’Œä¸€ç‚¹ç»éªŒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes [åŠå…¶è§£å†³æ–¹æ¡ˆ]æ“ä½œä¸­çš„6ä¸ªæœ‰è¶£çš„ç³»ç»Ÿé”™è¯¯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€ï¼›</font></font></li>
<li> Â«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">      Kubernetes</a>Â».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN501938/index.html">æ™®ç½—ç±³ä¿®æ–¯ï¼ˆPrometheusï¼‰ï¼Œä¸è¦èµ°ï¼šç”¨äºKubernetesçš„6ç§æ›¿ä»£ç›‘è§†å·¥å…·</a></li>
<li><a href="../zh-CN501940/index.html">å…³äºNeutralino.jsçš„ä¸€äº›çŸ¥è¯†</a></li>
<li><a href="../zh-CN501942/index.html">çœ‹æ¿æ–¹æ³•ï¼šå°†æ‚¨çš„è¿‡ç¨‹ç†è§£ä¸ºé›†ä½“å­¦ä¹ è¿‡ç¨‹</a></li>
<li><a href="../zh-CN501948/index.html">ç«è½¦å¦‚ä½•åœ¨è½¦ç«™ä¹‹é—´è¡Œé©¶ï¼šè·¯çº¿åŠŸèƒ½</a></li>
<li><a href="../zh-CN501954/index.html">VRæ˜¯åœ¨ç­‰å¾…Microsoft Kinectè¿˜æ˜¯æ¸¸æˆçš„æœªæ¥-è®©æˆ‘ä»¬ä¸€èµ·è°ˆè°ˆ</a></li>
<li><a href="../zh-CN501960/index.html">æœç´¢ç¼©æ”¾ã€‚å¼¹æ€§æœç´¢ å…¶ä¼˜ç‚¹å’Œå®‰è£…åŸºæœ¬è¦æ±‚</a></li>
<li><a href="../zh-CN501964/index.html">å·¥ä¸šè®¡ç®—æœºæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li>
<li><a href="../zh-CN501968/index.html">Kotlinå¤šå¹³å°ä¸­çš„MVIå»ºç­‘æ¨¡æ¿ï¼Œç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN501970/index.html">åœ¨RPGä¸­åˆ›å»ºè‰¯å¥½çš„åœ°ç‰¢éœ€è¦ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN501976/index.html">å¦‚ä½•å­¦ä¹ æµ‹è¯•è½¯ä»¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>