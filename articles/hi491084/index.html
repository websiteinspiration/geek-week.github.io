<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╗тАНтЪХя╕П ЁЯЩЗЁЯП╝ ЁЯП┤єаБзєаБвєаБ│єаБгєаБ┤єаБ┐ saneex.c: рдорд╛рдирдХ C ++ рдЕрдкрд╡рд╛рджреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬреА рд╕реЗ setjmp / longjmp (C99) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреЛрд╢рд┐рд╢ / рдкрдХрдбрд╝ / рдЕрдВрдд рдореЗрдВ try ЁЯС┤ЁЯП╗ ЁЯПм ЁЯПЗЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЬрдм рд╡рд╣ рдпрд╣ рд╡рд┐рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рддрдХрдиреАрдХреА рд▓реЗрдЦ рд▓рд┐рдЦ рд░рд╣рд╛ рдерд╛, рддреЛ рд╣рдмрд░ рдбрдмреНрд▓реНрдпреВрдПрдЪрдУ рдХреЗ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдХрд╛рд░реНрдпрд╛рд▓рдп рдореЗрдВ рдмрджрд▓ рдЧрдпрд╛ рдФрд░ рдЕрдм рдореБрдЭреЗ рдЗрд╕реЗ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рднреА рд╢рд░реНрдо рдЖ рд░рд╣реА рд╣реИ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>saneex.c: рдорд╛рдирдХ C ++ рдЕрдкрд╡рд╛рджреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬреА рд╕реЗ setjmp / longjmp (C99) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреЛрд╢рд┐рд╢ / рдкрдХрдбрд╝ / рдЕрдВрдд рдореЗрдВ try</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491084/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╡рд╣ рдпрд╣ рд╡рд┐рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рддрдХрдиреАрдХреА рд▓реЗрдЦ рд▓рд┐рдЦ рд░рд╣рд╛ рдерд╛, рддреЛ рд╣рдмрд░ рдбрдмреНрд▓реНрдпреВрдПрдЪрдУ рдХреЗ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдХрд╛рд░реНрдпрд╛рд▓рдп рдореЗрдВ рдмрджрд▓ рдЧрдпрд╛ рдФрд░ рдЕрдм рдореБрдЭреЗ рдЗрд╕реЗ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рднреА рд╢рд░реНрдо рдЖ рд░рд╣реА рд╣реИ ... рд▓реЗрдХрд┐рди рдЖрддреНрдорд╛ рдореЗрдВ рдпрд╣ рдЖрд╢рд╛ рдЧрд░реНрдо рд╣реИ рдХрд┐ рдЖрдИрдЯреА рдХреЗ рд▓реЛрдЧ рдЕрднреА рддрдХ рдирд╣реАрдВ рднрд╛рдЧреЗ рд╣реИрдВ рдФрд░ рд╡рд╣ рдЕрдкрдиреЗ рдкрд╛рдардХ рдХреЛ рдвреВрдВрдвреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╛ рдирд╣реАрдВ?</font></font></p><br>
<hr><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рд╣рдореЗрд╢рд╛ рдорд╛рдирдХ рд╕реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╢рдВрд╕рд╛ рдорд┐рд▓реА, рдФрд░ рд╕реА рдЦреБрдж - рдЕрдкрдиреЗ рд╕рднреА рдЕрддрд┐рд╕реВрдХреНрд╖реНрдорд╡рд╛рдж рдХреЗ рд╕рд╛рде, рдпрд╣ рдЕрднреА рднреА рдЙрди рд▓реЛрдЧреЛрдВ рдХреА рднрд╛рд╡рдирд╛ рдХреЛ рдЙрдбрд╝рд╛ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рдмрд╣реБрдд </font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓ рдЖрдВрдЦреЛрдВ</font></font></del> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдХрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛ рдорд╕реМрджрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╣рд▓реА рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдорд╛рдирдХ (рдПрдПрдирдПрд╕рдЖрдИ рд╕реА, C89 рдЙрд░реНрдл, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд░реНрдл</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдПрдирдПрд╕ X3.159-1989, рдмрд╛рдж рдореЗрдВ, C90 рдФрд░ рдЖрдИрдИрд╕реА 9899: 1990) 145 рдХрд╛рд░реНрдпреЛрдВ рдФрд░ рдореИрдХреНрд░реЛ рд╣реИ, рдЬреЛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ 25 рдмрджрд▓рд╛рд╡ рд╣реЛрддреЗ рд░рд╣рддреЗ рд╣реИрдВ (рдХреА рдХрдореА рдХреЗ рдХрд╛рд░рдг рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдУрд╡рд░рд▓реЛрдб рдХреА рднрд╛рд╖рд╛ рдореЗрдВ), рдФрд░ 26 рд╡рд┐рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рдЧрдгрд┐рддреАрдп рд╣реИрдВред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗ рдПрдВрдб рдЖрд░ рдХреЗ рджреВрд╕рд░реЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 114 рдХрд╛рд░реНрдпреЛрдВ (рдкреНрд▓рд╕ рдЧрдгрд┐рддреАрдп) рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдмрд╛рдХреА рдХреЛ рд╡рд┐рджреЗрд╢реА рдорд╛рдирддреЗ рд╣реБрдПред рдореЗрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">draft┬│ C11 рд╡рд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 348 рдХрд╛рд░реНрдпреЛрдВ рд░рд╣реЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд╕реМ рд╕реЗ рдЕрдзрд┐рдХ рдЧрдгрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ 90 рд╕реЗ рдЕрдзрд┐рдХ рдХрд░ рд░рд╣реЗ рд╣реИрдВ "рднрд╛рд░ рдХреЗ"ред рдЕрдм рдЖрдЗрдП рдмреВрд╕реНрдЯ рдХреЛ рджреЗрдЦреЗрдВ, рдЬрд╣рд╛рдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ 160 рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдЪреВрд░ рдореБрдЭреЗтАж</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдпрд╣ рд╕реМ рдФрд░ рдПрдХ рдЖрдзреЗ рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рд╡рд╣рд╛рдБ рд╣рдореЗрд╢рд╛ рдереЗ: рд╕рд┐рдЧреНрдирд▓ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ, рдкрд░рд┐рд╡рд░реНрддрди рд╕рдВрдмрдВрдзреА рдХрд╛рд░реНрдп (рдЬреЛ рдкреАрдПрдЪрдкреА 25 рд╕рд╛рд▓ рдмрд╛рдж рд╡реНрдпрд╛рдЦреНрдпрд╛ рдкрд╣реБрдВрдЪ рдЧрдпрд╛, рдФрд░ рдбреЗрд▓реНрдлреА, рдореЗрдВ рдЬреЛ рдПрдХ рд╕рдордп рдореЗрдВ рдлрд▓рдлреВрд▓ рд░рд╣рд╛ рдерд╛, рд╡реЗ рдЕрднреА рднреА рдпрд╛рдж рдХрд░ рд░рд╣реЗ рд╣реИрдВ) рдФрд░ рдЗрд╕ рддрд░рд╣ 50 рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ), </font><strong><font style="vertical-align: inherit;">рд╕реНрдЯреНрд░реИрдлрд╝рдЯрд╛рдЗрдо ()</font></strong><font style="vertical-align: inherit;"> (...) рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреИрдирдлрд╝ ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рд░реЗрдЧреБрд▓рд░ рдХрд╛ рд╕рд╕реНрддрд╛ рд╡рд┐рдХрд▓реНрдк)ред</font></font></p><br>
<a name="r4"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рд╣рдореЗрд╢рд╛ </font><strong><font style="vertical-align: inherit;">рд╕реЗрдЯрдЬрдореНрдк </font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдиреНрдЧрдЬрдореНрдк () рд╣реЛрддрд╛ рд╣реИ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдЬреЛ рдЖрдкрдХреЛ рдкреЛрд░реНрдЯреЗрдмрд▓ рд╕реА рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдкрд░реЗ рдЬрд╛рдП рдмрд┐рдирд╛ рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдкрд░рд┐рдЪрд┐рдд рдЕрдкрд╡рд╛рдж рддрдВрддреНрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХреА рдЧрдИ рд╣реИ - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╡реЗрдХ рд╡рд░реНрд▓реНрдб</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рд╕реНрдЯреИрдХ, рд░рдЬрд┐рд╕реНрдЯрд░, рдЕрд╕реЗрдореНрдмрд▓рд░реНрд╕ рдФрд░ рдЕрдиреНрдп </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдЯрд░рд┐рдпрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдФрд░ рдЪреЗрд░реА рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рдЖрдБрдХрдбрд╝рд╛ рд╣реИ ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкреЙрдЗрд▓рд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдирд┐рд░рдВрддрд░ рдирд╣реАрдВ рд╣реИ, рдорд╛рд░реНрдЪ рд╣реИрд░реЗ рдХреЗ рд░реВрдк </font><font style="vertical-align: inherit;">рдореЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рд╕рднреА рдХреЗ рдЖрдзреЗ рд╕рдордп рдореЗрдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлреЗрдВрдХ рджреЗрддреЗ рд╣реИрдВ</font></font></strong> <code>saneex.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )ред</font></font></p><br>
<img src="https://habrastorage.org/webt/cx/fz/jq/cxfzjqci2ud94mxrbl5bwitnobo.png"><a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд┐рдкрд╛ рд╣реБрдЖ рдкрд╛рда</font></font></b><div class="spoiler_text"><p>┬╣  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>  .</p><br>
<p>┬▓ ,  . 270 ,   80&nbsp;тАФ    .                ,     . <del><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">K&amp;R</a>&nbsp;тАФ  , .</del></p><br>
<p>┬│  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">  </a> ,     ANSI  ISO   ,   .    .</p><br>
<p>тБ┤ ,     ┬л┬╗  TinyURL,     URL         ,  ╤Ц .    , -.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">urlex.org</a>.</p></div></div><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╖рдп - рд╕реВрдЪреА:</font></font></strong></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреИрд╕реЗ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setjmp ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font><strong><font style="vertical-align: inherit;">longjmp ()</font></strong><font style="vertical-align: inherit;"> рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ</font></font><strong><font style="vertical-align: inherit;"></font></strong></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдЬрд┐рд╕реНрдЯрд░, рд╕реНрдЯреИрдХ рдФрд░ рдСрд▓-рдСрд▓-рдСрд▓</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрд╢рд┐рдВрдЧ рдЪрд░ рдпрд╛, рд░реВрд╕реА рдореЗрдВ, рдХреНрд▓реЛрдмрд░рд┐рдВрдЧ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">рд╡рд╛рд╖реНрдкрд╢реАрд▓</font></strong><font style="vertical-align: inherit;"> рдХреНрд╡рд╛рд▓рд┐рдлрд╛рдпрд░</font></font><strong><font style="vertical-align: inherit;"></font></strong></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IRL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдорд╛рдорд▓реЗ</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рджрд░реНрд╢рди</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░реАрдХреНрд╖рдг рдХрд╛ рд╡рд╛рддрд╛рд╡рд░рдг</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо</font></font></a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрддреНрд╕рд╡ рдХреЗ рдХреБрд▓рдкрддрд┐ - saneex.c</font></font></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдХреА "рд╕реБрд╡рд┐рдзрд╛рдПрдБ"</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> ┬л ┬╗</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">:   </a></li>
</ul></li>
</ul><br>
<p>,   &nbsp;тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">setjmp()</a>/<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">longjmp()</a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">setjmp.h</a>,      ┬лSJLJ┬╗ (     ,     ).    C89 ,  -,   ,       (   &nbsp;тАФ  ,  &nbsp;тАФ  ).</p><br>
<p>   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">zzeng</a>.   , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>┬╣, ,   , <del>    </del>       ( ,    ),      .</p><br>
<p>┬╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">CException</a>   &nbsp;тАФ  60 , ,   ,  ANSI C,     <strong>finally</strong>   ,     .</p><br>
<p>,    &nbsp;тАФ   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">  </a>   ,    ,     ,   ,          ,     ┬л       ┬╗. (,    ,       -  ┬л┬╗  ,   <strong>errno</strong>      . &nbsp;тАФ   ,   .)</p><br>
<p>     ,  :</p><br>
<ul>
<li>     ,  -    ,             (  ,   &nbsp;тАФ   ,  <code>if (error) return -1;</code>)</li>
<li> -     &nbsp;тАФ     ,             ,    </li>
</ul><br>
<p>    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">    </a>,   .</p><br>
<a name="sjlj"></a><br>
<h2 id="kak-rabotayut-setjmplongjmp">  <strong>setjmp()</strong>/<strong>longjmp()</strong></h2><br>
<a name="matan"></a><br>
<h3 id="registry-stek-i-vse-vse-vsehttplibruanekdoty9600txt">,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">--</a></h3><br>
<p>  , <strong>longjmp()</strong>&nbsp;тАФ   <strong>goto</strong>,  <strong>setjmp()</strong>&nbsp;тАФ <del> </del>     <strong>goto</strong>  run-time. , ┬л<strong>goto</strong>  ┬╗. ,    ,  , <strong>goto</strong>,       &nbsp;тАФ     ,   <strong>goto</strong>   .       ,   - ,     (  &nbsp;тАФ         ┬лtry┬╗).</p><br>
<p>,    ,    , ,  <code>setjmp.h</code>   <del>^W</del> ?  ,   <strong>setjmp()</strong>  ,    <strong>  </strong> (,  , ). ,    <del></del>       ,   <del> </del>    ,         .  .</p><br>
<p> , ,     <strong>setjmp()</strong>&nbsp;тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">fork()</a>  POSIX    .  ,      *nixтАЩ API       WinAPI,    &nbsp;тАФ      ,       .   &nbsp;тАФ ┬л ,   ?┬╗тАж   .</p><br>
<a name="r6"></a><br>
<p>,    ,    &nbsp;тАФ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>,      ()    .   &nbsp;тАФ   (  IntelтАЩ&nbsp;тАФ ), &nbsp;тАФ  ( IntelтАЩ&nbsp;тАФ -, ).  : </p><br>
<pre><code class="plaintext hljs">void sub(int s) {<font></font>
  char buf[256];<font></font>
  sub(2);<font></font>
}<font></font>
<font></font>
int main(int m) {<font></font>
  sub(1);<font></font>
}</code></pre><br>
<p>   &nbsp;тАФ <strong>tcc</strong> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Tiny C Compiler</a>)   - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">. </a>. <strong>tcc</strong>             .      <strong>sub()</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> Intel</a>,    ): </p><br>
<pre><code class="plaintext hljs">sub     esp, 100h       ;     <font></font>
mov     eax, 2          ;  <font></font>
push    eax<font></font>
call    sub_401000      ;  sub()<font></font>
add     esp, 4          ;     (= cdecl)</code></pre><br>
<p>    :</p><br>
<img src="https://habrastorage.org/webt/xt/mz/lc/xtmzlclm6cujy23wvupm7cxmm1k.png"><br>
<p>     &nbsp;тАФ      (  IntelтАж ,  ).     <strong>ESP</strong> (<strong>RSP</strong>  x86_64). <strong>setjmp()</strong>    <strong>ESP</strong>/<strong>RSP</strong>,    ,    <strong>jmp_buf</strong>,    .    <strong>longjmp()</strong>    (      )&nbsp;тАФ    ,       ,    <strong>setjmp()</strong>,        ().    , ┬лundo┬╗   (,   ).</p><br>
<p>   <strong>setjmp()</strong>   <strong>jmp</strong>   <code>FEF8h</code> (<code>FDF0h</code>  ..&nbsp;тАФ     )    ,  : </p><br>
<pre><code class="plaintext hljs">void sub(int s) {<font></font>
  char buf[256];<font></font>
  jmp_buf jmp;<font></font>
  setjmp(jmp);<font></font>
  sub(2);<font></font>
}</code></pre><br>
<p>, ,  тДв:</p><br>
<ul>
<li>    (<strong>setjmp()</strong>  , <strong>longjmp()</strong>  ),  , ,     </li>
<li> ,   <strong>setjmp()</strong>,  ,  ┬л┬╗   &nbsp;тАФ    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">undefined behavior</a> (   )</li>
</ul><br>
<a name="r1"></a><br>
<ul>
<li>     &nbsp;тАФ ,  ,  !&nbsp;тАФ  , ,     ,  <strong>setjmp()</strong>       ,   <strong>longjmp()</strong>  ,       <strong>setjmp()</strong></li>
</ul><br>
<a name="clob"></a><br>
<h3 id="zatiranie-peremennyh-ili-po-russki-clobbering">  , -, clobbering</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>  . : </p><br>
<pre><code class="plaintext hljs">#include &lt;stdlib.h&gt;<font></font>
#include &lt;stdio.h&gt;<font></font>
#include &lt;setjmp.h&gt;<font></font>
<font></font>
int main(void) {<font></font>
  int i;<font></font>
  jmp_buf jmp;<font></font>
  i = rand();<font></font>
  if (setjmp(jmp) == 0) {<font></font>
    i = rand();<font></font>
    printf("%d\n", i);<font></font>
    longjmp(jmp, 1);<font></font>
  } else {<font></font>
    printf("%d\n", i);<font></font>
  }<font></font>
}</code></pre><br>
<p> :      ?</p><br>
<p> :    . <del>-!</del></p><br>
<p>,     <strong>gcc</strong>.    <strong>-O0</strong>,    ,       : </p><br>
<pre><code class="plaintext hljs">; int main(void) {<font></font>
  push    ebp             ;  ( stack frame)<font></font>
  mov     ebp, esp        ; EBP     ESP (  )<font></font>
  sub     esp, E0h<font></font>
  ...<font></font>
  call    _rand           ;    EAX<font></font>
  mov     [ebp-D4h], eax  ;  i = rand();  i   (EBP-D4h)<font></font>
  ...<font></font>
; if (... == 0) {         ;  setjmp()      <font></font>
  call    _rand<font></font>
  mov     [ebp-D4h], eax  ;  i = rand();  <font></font>
; printf("%d\n", i);<font></font>
  mov     eax, [ebp-D4h]  ;  i    <font></font>
  mov     esi, eax<font></font>
  lea     edi, format     ;   "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf<font></font>
  ...<font></font>
; } else {                ;    setjmp()  <font></font>
  mov     eax, [ebp-D4h]  ;   i,    <font></font>
  mov     esi, eax<font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf</code></pre><br>
<p> ,       <strong>i</strong>   (  <code>EBP - D4h</code>).       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>, :</p><br>
<ul>
<li>   256 <strong>char</strong>   <strong>int</strong>  <strong>jmp_buf</strong>,      4  200  ,  20   -  ,         224  (E0h)  100h,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a></li>
<li><strong>ESP</strong>    <strong>setjmp()</strong>  <code>FFF8h - E0h = FF18h</code> ( <code>FEF8h</code>),      <strong>jmp</strong><br>
<ul>
<li>,   ,     </li>
</ul></li>
<li>   <strong>i</strong>,     <strong>i</strong>   (  <code>FF18h</code>)</li>
<li><strong>longjmp()</strong>      <code>FF18h</code>, ,    <strong>i</strong>     ,  - ,      (<strong>jmp</strong>),   <strong>main()</strong> (  )<br>
<ul>
<li>   <strong>ESP</strong>    ,  <strong>longjmp()</strong>       ,   <strong>main()</strong></li>
</ul></li>
</ul><br>
<p>      <strong>-O1</strong>,   : </p><br>
<pre><code class="plaintext hljs">;   stack frame  ,   ESP <font></font>
  sub     esp, E8h<font></font>
  ...<font></font>
  call    _rand<font></font>
  mov     [esp+E8h-DCh], eax  ; i = rand();  ,    -O0<font></font>
  ...<font></font>
; -O1 - ,   else  , <font></font>
; if (setjmp() == 0) ( - ),  <font></font>
;  ;       <font></font>
; if (... == 0) {<font></font>
  call    _rand<font></font>
  mov     esi, eax            ; !  i  <font></font>
; printf("%d\n", i);<font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf<font></font>
  ...<font></font>
; } else {<font></font>
  mov     esi, [esp+E8h-DCh]  ; !  i  <font></font>
  lea     edi, format     ; "%d\n"<font></font>
  mov     eax, 0<font></font>
  call    _printf</code></pre><br>
<p>,  <strong>-O1</strong> <strong>gcc</strong>     : </p><br>
<pre><code class="plaintext hljs">test.c:6:11: warning: variable тАШiтАЩ might be clobbered by тАШlongjmpтАЩ or тАШvforkтАЩ [-Wclobbered]</code></pre><br>
<p>   ?  <strong>i</strong>   ,     ( <strong>if</strong>) <strong>gcc</strong>,   <strong>i</strong>     <strong>printf()</strong>,      <strong>ESI</strong>,     ( <strong>ESI</strong>     <strong>printf()</strong>, . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">ABI, . 22</a>&nbsp;тАФ RDI (<strong>format</strong>), RSI (<strong>i</strong>),&nbsp;тАж). - :</p><br>
<ul>
<li>    <code>ESP + E8h - DCh</code>    <strong>rand()</strong></li>
<li> <strong>ESI</strong>   </li>
<li><strong>printf()</strong> ( )  ()   </li>
<li><strong>longjmp()</strong>   ,     ,         </li>
<li>  <strong>printf()</strong> ( <strong>else</strong>)  ,  ,  ,   <br>
<ul>
<li>       <strong>ESI</strong>,          (,  <strong>printf()</strong>   <strong>longjmp()</strong>)</li>
</ul></li>
</ul><br>
<a name="r2"></a><br>
<p>,      : </p><br>
<pre><code class="plaintext hljs">stack[i] = rand();          // i = rand();   (1)<font></font>
if (setjmp(jmp) == 0) {<font></font>
  ESI = rand();             // i = rand();   (2)<font></font>
  printf("%d\n", ESI);      //   (2)<font></font>
  longjmp(jmp, 1);          // <font></font>
} else {<font></font>
  printf("%d\n", stack[i]); //   (1)<font></font>
  //     :<font></font>
  printf("%d\n", ESI);      //  ,   -<font></font>
                            // "" ( printf()  longjmp())<font></font>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p> ,   ,  <strong>gcc</strong>   <strong>rand()</strong>     <strong>ESI</strong>     (  <strong>-O3</strong>).  <abbr title="StackOverflow.com">SO</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>,    x86_64 (    )   ,  <strong>EAX</strong>.     ?  ,  <strong>gcc</strong>  <strong>printf()</strong>  <strong>else</strong>  <strong>longjmp()</strong>,     <strong>rand()</strong>   <strong>printf()</strong>&nbsp;тАФ   , <strong>i</strong>      .</p><br>
<p>       &nbsp;тАФ   .</p></div></div><br>
<a name="vol"></a><br>
<h3 id="kvalifikator-volatile"> <strong>volatile</strong></h3><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ┬л ┬╗&nbsp;тАФ  <strong>volatile</strong> (&nbsp;тАФ ┬л┬╗).        ,     ,  ,    : </p><br>
<pre><code class="plaintext hljs">volatile int i;</code></pre><br>
<p>   <strong>-O1</strong>    <strong>if</strong>: </p><br>
<pre><code class="plaintext hljs">; :<font></font>
  call    _rand<font></font>
  mov     esi, eax<font></font>
; :<font></font>
  call    _rand<font></font>
  mov     [rsp+E8h-DCh], eax<font></font>
  mov     esi, [rsp+E8h-DCh]<font></font>
;    :<font></font>
  call    _rand<font></font>
  mov     esi, eax<font></font>
  mov     [rsp+E8h-DCh], eax</code></pre><br>
<p> ,      (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>): </p><br>
<pre><code class="plaintext hljs">if (setjmp(jmp) == 0) {<font></font>
  ESI = stack[i] = rand();</code></pre><br>
<a name="irl"></a><br>
<h3 id="sluchai-ispolzovaniya-abbr-titlein-real-lifeirlabbr">  <abbr title="рдЕрд╕рд▓ рдЬрд╝рд┐рдиреНрджрдЧреА рдореЗрдВ">IRL</abbr></h3><br>
<p>,    &nbsp;тАФ             -<strong>volatile</strong>   ,  SJLJ          .        &nbsp;тАФ  ,  SJLJ   <del>  </del>  :</p><br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>        (   &nbsp;тАФ     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">ldir</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>)</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">alexkalmuk</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">-     SJLJ</a> (+ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">dzeban</a>&nbsp;тАФ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  Linux</a></li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   </a> (:     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">Atakua</a>),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   x86emu</a> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">NWOcs</a>)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> libpng</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">libjpeg-turbo</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>)</li>
<li> 2017 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">Skapix</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  <strong>pthreads</strong></a>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">kutelev</a>&nbsp;тАФ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Symbian</a></li>
<li>  <strong>Quake World</strong>    &nbsp;тАФ . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">PatientZero</a> , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a> (     )</li>
</ul><br>
<p> ,   ,  &nbsp;тАФ      ,    ┬л  ┬╗,   ,        ,  -    (). , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">DrMefistO</a>.</p><br>
<p>  <strong>Quake World</strong>     <strong>WinMain()</strong>,      <strong>jmp_buf</strong>,       ,    ┬л <strong>continue</strong>┬╗: </p><br>
<pre><code class="plaintext hljs">// WinQuake/host.c<font></font>
jmp_buf         host_abortserver;<font></font>
<font></font>
void Host_EndGame (char *message, ...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  if (cls.demonum != -1)<font></font>
    CL_NextDemo ();<font></font>
  else<font></font>
    CL_Disconnect ();<font></font>
<font></font>
  longjmp (host_abortserver, 1);<font></font>
}<font></font>
<font></font>
void Host_Error (char *error, ...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  if (cls.state == ca_dedicated)<font></font>
    Sys_Error ("Host_Error: %s\n",string);  // dedicated servers exit<font></font>
<font></font>
  CL_Disconnect ();<font></font>
  cls.demonum = -1;<font></font>
<font></font>
  inerror = false;<font></font>
<font></font>
  longjmp (host_abortserver, 1);<font></font>
}<font></font>
<font></font>
void _Host_Frame (float time)<font></font>
{<font></font>
  static double           time1 = 0;<font></font>
  static double           time2 = 0;<font></font>
  static double           time3 = 0;<font></font>
  int                     pass1, pass2, pass3;<font></font>
<font></font>
  if (setjmp (host_abortserver) )<font></font>
    return;                 // something bad happened, or the server disconnected<font></font>
<font></font>
  ...<font></font>
}<font></font>
<font></font>
// QW/client/sys_win.c<font></font>
int WINAPI WinMain (...)<font></font>
{<font></font>
  ...<font></font>
<font></font>
  while (1)<font></font>
  {<font></font>
    ...<font></font>
    newtime = Sys_DoubleTime ();<font></font>
    time = newtime - oldtime;<font></font>
    Host_Frame (time);<font></font>
    oldtime = newtime;<font></font>
  }<font></font>
<font></font>
  /* return success of application */<font></font>
  return TRUE;<font></font>
}</code></pre><br>
<a name="perf"></a><br>
<h2 id="proizvoditelnost"></h2><br>
<p>  ,     &nbsp;тАФ     .  ,   <strong>setjmp()</strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">glibc</a> ,        .   :</p><br>
<ul>
<li>  ,     ,  SJLJ/<code>saneex.c</code>          </li>
<li> -тАж- (<del>,    </del>) ,    - &nbsp;тАФ     ,     </li>
<li>  ,   &nbsp;тАФ   zero-cost exceptions (, , zero-cost <strong>try</strong>),         <strong>try</strong>,        ()&nbsp;тАФ       <strong>goto</strong>   , ,   ,     ┬л┬╗ , -,  </li>
</ul><br>
<p>┬л┬╗ zero-cost exceptions     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">volatile</a>-,     ,     (      <strong>longjmp()</strong>).   ,         :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> Windows</a>  <abbr title="рд╕рдВрд░рдЪрд┐рдд рдЕрдкрд╡рд╛рдж рд╣реИрдВрдбрд▓рд┐рдВрдЧ">SEH</abbr>  <abbr title="рд╕рджрд┐рд╢ рдЕрдкрд╡рд╛рдж рд╣реИрдВрдбрд▓рд┐рдВрдЧ">VEH</abbr>,    XP.</li>
<li> <strong>gcc</strong>    &nbsp;тАФ    SJLJ,  DWARF,        (DWARF    <strong>clang</strong>).    .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">zzeng</a>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">dwarfstd.org</a>.</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">nuit</a>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">libunwind</a>,      &nbsp;тАФ        ( ).</li>
</ul><br>
<p>,  <code>saneex.c</code>     zero-cost ( &nbsp;тАФ  ),     <strong>setjmp()</strong>,   ? ,  ?    &nbsp;тАФ .</p><br>
<a name="bench"></a><br>
<h3 id="testovaya-sreda"> </h3><br>
<p>    ┬л ┬╗,   <strong>main()</strong>   100      <strong>try</strong>/<strong>catch</strong>      <strong>throw()</strong>.</p><br>
<p>   C:</p><br>
<pre><code class="plaintext hljs">#include &lt;stdio.h&gt;<font></font>
#include &lt;time.h&gt;<font></font>
#include "saneex.h"<font></font>
<font></font>
int main(void) {<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    try {<font></font>
      //  ("" = ):<font></font>
      throw(msgex("A quick fox jumped over a red dog and a nyancat was spawned"));<font></font>
      //  ("" = ):<font></font>
      time(NULL);<font></font>
    } catchall {<font></font>
      fprintf(stderr, "%s\n", curex().message);<font></font>
    } endtry<font></font>
  }<font></font>
}</code></pre><br>
<p>  ++ (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>,        <code>cerr &lt;&lt;</code>  <strong>fprintf()</strong>):</p><br>
<pre><code class="plaintext hljs">#include &lt;iostream&gt;<font></font>
#include &lt;vector&gt;<font></font>
#include &lt;stdexcept&gt;<font></font>
#include &lt;time.h&gt;<font></font>
<font></font>
int main() {<font></font>
  std::vector&lt;int&gt; vec{ 3, 4, 3, 1 };<font></font>
<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    try {<font></font>
      //  ("" = ):<font></font>
      int i{ vec.at(4) };<font></font>
      //  ("" = ):<font></font>
      time(NULL);<font></font>
    }<font></font>
    catch (std::out_of_range &amp; e) {<font></font>
      // &lt;&lt;  fprintf()     25-50%<font></font>
      //std::cerr &lt;&lt; "Accessing a non-existent element: " &lt;&lt; e.what() &lt;&lt; '\n';<font></font>
      fprintf(stderr, "%s\n", e.what());<font></font>
    }<font></font>
    catch (std::exception &amp; e) {<font></font>
      //std::cerr &lt;&lt; "Exception thrown: " &lt;&lt; e.what() &lt;&lt; '\n';<font></font>
      fprintf(stderr, "%s\n", e.what());<font></font>
    }<font></font>
    catch (...) {<font></font>
      //std::cerr &lt;&lt; "Some fatal error\n";<font></font>
      fprintf(stderr, "Some fatal error");<font></font>
    }<font></font>
  }<font></font>
<font></font>
  return 0;<font></font>
}</code></pre><br>
<p>        ( 64-):</p><br>
<ul>
<li>Windows 10 2019 LTSC  PowerShell   <code>Measure-Command { test.exe 2&gt;$null }</code></li>
<li> Live CD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Ubuntu</a>    <strong>time</strong></li>
</ul><br>
<p>      Windows   <strong>__try</strong>/<strong>__except</strong>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">   </a>:</p><br>
<pre><code class="plaintext hljs">#include &lt;windows.h&gt;<font></font>
#include &lt;stdio.h&gt;<font></font>
#include &lt;vector&gt;<font></font>
<font></font>
int filterExpression(EXCEPTION_POINTERS* ep) {<font></font>
  ep-&gt;ContextRecord-&gt;Eip += 8;<font></font>
  return EXCEPTION_EXECUTE_HANDLER;<font></font>
}<font></font>
<font></font>
int main() {<font></font>
  static int zero;<font></font>
  for (int i = 0; i &lt; 100000; i++) {<font></font>
    __try {<font></font>
      zero = 1 / zero;<font></font>
      __asm {<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
        nop<font></font>
      }<font></font>
      printf("Past the exception.\n");<font></font>
    }<font></font>
    __except (filterExpression(GetExceptionInformation())) {<font></font>
      printf("Handler called.\n");<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<p>      &nbsp;тАФ  , : </p><br>
<pre><code class="plaintext hljs">error C2712: Cannot use __try in functions that require object unwinding</code></pre><br>
<p>          ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>.   1100-1300  (Debug  Release, x86)&nbsp;тАФ ,     <abbr title="рджреГрд╢реНрдп рд╕реНрдЯреВрдбрд┐рдпреЛ">VS</abbr>,    ,     g++.</p><br>
<a name="benchres"></a><br>
<h3 id="rezultaty"></h3><br>
<pre><code class="plaintext hljs">тДЦ                     ()┬╣           saneex <font></font>
<font></font>
1.  VS 2019 v16.0.0   Debug     x64   saneex.c        9713  / 8728  = 1.1    1.8 / 1.8<font></font>
2.  VS 2019 v16.0.0   Debug     x64   saneex.c       95    / 46    = 2      4.5 / 2.3<font></font>
3.  VS 2019 v16.0.0   Debug     x64   C++             5449  / 4750┬▓ = 1.6<font></font>
4.  VS 2019 v16.0.0   Debug     x64   C++            21    / 20    = 1<font></font>
5.  VS 2019 v16.0.0   Release   x64   saneex.c        8542┬│ / 182   = 47     1.8 / 0.4<font></font>
6.  VS 2019 v16.0.0   Release   x64   saneex.c       80┬│   / 23    = 3.5    8   / 1.8<font></font>
7.  VS 2019 v16.0.0   Release   x64   C++             4669┬│ / 420   = 11<font></font>
8.  VS 2019 v16.0.0   Release   x64   C++            10┬│   / 13    = 0.8<font></font>
9.  gcc 9.2.1         -O0       x64   saneex.c        71    / 351   = 0.2    0.2 / 0.6<font></font>
10. gcc 9.2.1         -O0       x64   saneex.c       6     / 39    = 0.2    1.5 / 1.1<font></font>
11. g++ 9.2.1         -O0       x64   C++             378   / 630   = 0.6<font></font>
12. g++ 9.2.1         -O0       x64   C++            4     / 37    = 0.1<font></font>
13. gcc 9.2.1         -O3       x64   saneex.c        66    / 360   = 0.2    0.2 / 0.6<font></font>
14. gcc 9.2.1         -O3       x64   saneex.c       5     / 23    = 0.2    1   / 0.6<font></font>
15. g++ 9.2.1         -O3       x64   C++             356   / 605   = 0.6<font></font>
16. g++ 9.2.1         -O3       x64   C++            5     / 38    = 0.1</code></pre><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>┬╣   <strong></strong>       Windows 7 SP1 x64  VS 2017 v15.9.17  gcc  cygwin.</p><br>
<p>┬▓   :  <strong>fprintf()</strong>   <code>cerr &lt;&lt;</code>,    <strong></strong>  3 : 1386/1527 .</p><br>
<p>┬│ VS          ,        .</p></div></div><br>
<p> тАж :</p><br>
<ul>
<li>      /    ┬л┬╗ VS.   &nbsp;тАФ .</li>
<li> <code>cerr &lt;&lt;</code>  <strong>fprintf()</strong>       VS       3-4  ( 3). <abbr title="рдореИрдВ рдХреНрдпрд╛ рдЧрд▓рдд рдХрд░ рд░рд╣рд╛ рд╣реВрдВ"></abbr>?</li>
<li>      <strong>try</strong>   <strong>throw</strong>&nbsp;тАФ  (4-28   100  ).</li>
<li>  ┬л┬╗ Debug  VS,    <code>saneex.c</code> ,      ( 2.3   VS,  5   <strong>gcc</strong>/g++),  <strong>try</strong>  <strong>throw</strong>&nbsp;тАФ ,      .   !</li>
</ul><br>
<p>   тАж    .    !</p><br>
<p>    use-case&nbsp;тАФ    <strong>try</strong>    <strong>throw</strong> (┬л ,  ┬╗),        <strong>setjmp()</strong>,   ,   ,    ,   .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">  </a>,      ,    <strong>setjmp()</strong>       OpenBSD   (1.45)&nbsp;тАФ  Solaris.     2005 .  ┬л┬╗&nbsp;тАФ     ,      .</p><br>
<p>,  тАж</p><br>
<a name="saneex"></a><br>
<h2 id="vinovnik-torzhestva-saneexc"> &nbsp;тАФ <code>saneex.c</code></h2><br>
<p>,     <abbr title="рдзреНрдпрд╛рди рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд┐рддреНрд░"></abbr>:</p><br>
<ul>
<li>    Visual Studio</li>
<li>   , <strong>throw()</strong>   , <strong>finally</strong>   <strong>catch</strong>   (  )</li>
<li>       (  <strong>static</strong>)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>- (<strong>__thread</strong>/<strong>_Thread_local</strong>)</li>
<li> public domain (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">CC0</a>)</li>
</ul><br>
<a name="r5"></a><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">    GitHub</a>.       ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>.    <code>saneex-demo.c</code>  : </p><br>
<pre><code class="plaintext hljs">01.    #include &lt;stdio.h&gt;<font></font>
02.    #include "saneex.h"<font></font>
03.<font></font>
04.    int main(void) {<font></font>
05.      sxTag = "SaneC's Exceptions Demo";<font></font>
06.<font></font>
07.      try {<font></font>
08.        printf("Enter a message to fail with: [] [1] [2] [!] ");<font></font>
09.<font></font>
10.        char msg[50];<font></font>
11.        thrif(!fgets(msg, sizeof(msg), stdin), "fgets() error");<font></font>
12.<font></font>
13.        int i = strlen(msg) - 1;<font></font>
14.        while (i &gt;= 0 &amp;&amp; msg[i] &lt;= ' ') { msg[i--] = 0; }<font></font>
15.<font></font>
16.        if (msg[0]) {<font></font>
17.          errno = atoi(msg);<font></font>
18.          struct SxTraceEntry e = newex();<font></font>
19.          e = sxprintf(e, "Your message: %s", msg);<font></font>
20.          e.uncatchable = msg[0] == '!';<font></font>
21.          throw(e);<font></font>
22.        }<font></font>
23.<font></font>
24.        puts("End of try body");<font></font>
25.<font></font>
26.      } catch (1) {<font></font>
27.        puts("Caught in catch (1)");<font></font>
28.        sxPrintTrace();<font></font>
29.<font></font>
30.      } catch (2) {<font></font>
31.        puts("Caught in catch (2)");<font></font>
32.        errno = 123;<font></font>
33.        rethrow(msgex("calling rethrow() with code 123"));<font></font>
34.<font></font>
35.      } catchall {<font></font>
36.        printf("Caught in catchall, message is: %s\n", curex().message);<font></font>
37.<font></font>
38.      } finally {<font></font>
39.        puts("Now in finally");<font></font>
40.<font></font>
41.      } endtry<font></font>
42.<font></font>
43.      puts("End of main()");<font></font>
44.    }</code></pre><br>
<p>   ,          :</p><br>
<ul>
<li>   &nbsp;тАФ    ,   : </li>
</ul><br>
<pre><code class="plaintext hljs">End of try body<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<ul>
<li>  ,   ,        (<strong>1</strong>),       <code>catch (1)</code> (26.),    : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (1)<font></font>
Your message: 1 hello, habr!<font></font>
    ...at saneex-demo.c:18, code 1<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<ul>
<li>  ,     (30.),   (  ,   )       (33.),       : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (2)<font></font>
Now in finally<font></font>
<font></font>
Uncaught exception (code 123) - terminating. Tag: SaneC's Exceptions Demo<font></font>
Your message: 2 TM! kak tam blok4ain?<font></font>
    ...at saneex-demo.c:18, code 2<font></font>
calling rethrow() with code 123<font></font>
    ...at saneex-demo.c:33, code 123<font></font>
rethrown by ENDTRY<font></font>
    ...at saneex-demo.c:41, code 123</code></pre><br>
<ul>
<li>  <code>!</code>,    ┬л┬╗ (<strong>uncatchable</strong>; 20.)&nbsp;тАФ      <strong>try</strong>   ,    ( <strong>catch</strong>,   <strong>finally</strong>),         &nbsp;тАФ   <strong>abort()</strong>: </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catch (1)<font></font>
Your message: ! it is a good day to die<font></font>
    ...UNCATCHABLE at saneex-demo.c:18, code 0<font></font>
Now in finally<font></font>
<font></font>
Uncaught exception (code 0) - terminating. Tag: SaneC's Exceptions Demo<font></font>
Your message: ! it is a good day to die<font></font>
    ...UNCATCHABLE at saneex-demo.c:18, code 0<font></font>
UNCATCHABLE rethrown by ENDTRY<font></font>
    ...at saneex-demo.c:41, code 0</code></pre><br>
<ul>
<li>,   ,     <strong>catchall</strong> (35.),      : </li>
</ul><br>
<pre><code class="plaintext hljs">Caught in catchall, message is: Your message: 3 we need more gold<font></font>
Now in finally<font></font>
End of main()</code></pre><br>
<a name="sexfeat"></a><br>
<h3 id="ostalnye-fichi"> ┬л┬╗</h3><br>
<a name="sexmt"></a><br>
<p><strong>.</strong>    ,       ( MSVC┬╣),  C11             (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">TLS</a>): </p><br>
<pre><code class="plaintext hljs">#define SX_THREAD_LOCAL _Thread_local</code></pre><br>
<p>┬╣    Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>   open source,  <del> </del> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a>  ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">8  </a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"> </a>.</p><br>
<p><strong>sxTag</strong> (05.)&nbsp;тАФ ,        <strong>stderr</strong>.  &nbsp;тАФ     (<strong>__DATE__</strong> <strong>__TIME__</strong>).</p><br>
<p><strong> SxTraceEntry</strong> (  stack trace).    &nbsp;тАФ   <code>(struct SxTraceEntry) {...}</code>:</p><br>
<ul>
<li><code>newex()</code>&nbsp;тАФ    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>;  <strong>__FILE__</strong>, <strong>__LINE__</strong>    = <strong>errno</strong> (       ,     <strong>fgets()</strong>; 11.)<br>
<ul>
<li>  1  1 ( <strong>setjmp()</strong>  0    ),  <code>catch (0)</code>   </li>
</ul></li>
<li><code>msgex(m)</code>&nbsp;тАФ  <strong>newex()</strong>,      ( )</li>
<li><code>exex(m, e)</code>&nbsp;тАФ  <strong>msgex()</strong>,       ;      <strong>free()</strong> : </li>
</ul><br>
<pre><code class="plaintext hljs">try {<font></font>
  TimeoutException *e = malloc(sizeof(*e));<font></font>
  e-&gt;elapsed = timeElapsed;<font></font>
  e-&gt;limit = MAX_TIMEOUT;<font></font>
  errno = 146;<font></font>
  throw(exex("Connection timed out", e));<font></font>
} catch (146) {<font></font>
  printf("%s after %d\n", curex().message,<font></font>
    //   void *SxTraceEntry.extra:<font></font>
    ((TimeoutException *) curex().extra)-&gt;elapsed);<font></font>
} endtry</code></pre><br>
<p>, ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">designated initializers</a>     C99 (  Visual Studio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">2013+</a>): </p><br>
<pre><code class="plaintext hljs">throw( (struct SxTraceEntry) {.message = "kaboom!"} );</code></pre><br>
<p><strong> :</strong></p><br>
<ul>
<li><code>throw(e)</code>&nbsp;тАФ   <strong>SxTraceEntry</strong></li>
<li><code>rethrow(e)</code>&nbsp;тАФ  <strong>throw()</strong>,     stack trace;     <strong>catch</strong>/<strong>catchall</strong></li>
<li><code>thrif(x, m)</code>&nbsp;тАФ ;  <code>if (x)</code>  <strong>SxTraceEntry</strong>   <strong>x</strong> + <strong>m</strong>  ┬л┬╗ </li>
<li><code>thri(x)</code>&nbsp;тАФ  <strong>thrif()</strong>,    <strong>m</strong></li>
</ul><br>
<p>    ┬л┬╗      &nbsp;тАФ   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a>  <strong>fgets()</strong> (11.),      .   <strong>fgets()</strong>      (    <abbr title="рдлрд╛рдЗрд▓ рд╕рдорд╛рдкреНрдд">EOF</abbr>: <code>./a.out &lt;/dev/null</code>),         .   :</p><br>
<pre><code class="plaintext hljs">thri(read(0xBaaD, buf, nbyte));<font></font>
// errno = 9, "Bad file descriptor"<font></font>
// Assertion error: read(0xBaaD, buf, nbyte);</code></pre><br>
<a name="sexpit"></a><br>
<h3 id="i-osobennosti-realizacii">тАж ┬л ┬╗</h3><br>
<p>     (  !):</p><br>
<ul>
<li>    <strong>endtry</strong>&nbsp;тАФ        ( <strong>try</strong>)   <br>
<ul>
<li>  ,  , ,  <strong>try</strong>   <code>{</code>,  <strong>endtry</strong>  </li>
</ul></li>
<li><strong>  return  try  endtry</strong>&nbsp;тАФ    ,         ;    <abbr title="рдкреБрд▓ рдЕрдиреБрд░реЛрдз">PR</abbr><br>
<ul>
<li>, <strong>goto</strong>      ,    - ? <code>&lt;/sarcasm&gt;</code></li>
</ul></li>
</ul><br>
<p>  ┬л┬╗,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> <strong>volatile</strong>. ┬л┬╗ &nbsp;тАФ       (. <strong>longjmp()</strong>), ,        <strong>try</strong>,        <strong>catch</strong>/<strong>catchall</strong>/<strong>finally</strong>   <strong>endtry</strong>,      <strong>volatile</strong>.      .   : </p><br>
<pre><code class="plaintext hljs">int foo = 1;<font></font>
try {<font></font>
  foo = 2;<font></font>
  //    foo<font></font>
} catchall {<font></font>
  //    !<font></font>
} finally {<font></font>
  //   !<font></font>
} endtry<font></font>
//   !</code></pre><br>
<p> <strong>volatile</strong>     : </p><br>
<pre><code class="plaintext hljs">volatile int foo = 1;<font></font>
try {<font></font>
  ...</code></pre><br>
<a name="sexside"></a><br>
<h3 id="itog-kak-eto-rabotaet">:   </h3><br>
<p>     - () :</p><br>
<ul>
<li><code>struct SxTryContext</code>&nbsp;тАФ    <strong>try</strong>,     &nbsp;тАФ  , <strong>jmp_buf</strong>    ; ,   : </li>
</ul><br>
<pre><code class="plaintext hljs">try {<font></font>
  try {<font></font>
    //  <font></font>
  } endtry<font></font>
} endtry</code></pre><br>
<ul>
<li><code>struct SxTraceEntry</code>&nbsp;тАФ  stack trace,   ,      ;      ,   <strong>try</strong>: </li>
</ul><br>
<pre><code class="plaintext hljs">try {         //  SxTryContext<font></font>
  try {       //  SxTryContext<font></font>
              //  SxTraceEntry<font></font>
    throw(msgex(" !"));<font></font>
              //  SxTraceEntry<font></font>
  } catchall {<font></font>
              //  SxTraceEntry<font></font>
    rethrow(msgex("   !"));<font></font>
              //  SxTraceEntry (*)<font></font>
  } endtry<font></font>
} endtry</code></pre><br>
<p>     <strong>rethrow()</strong>  <strong>throw()</strong>,   <strong>SxTraceEntry</strong> <code>(*)</code>   ,  &nbsp;тАФ    (stack trace  ).  ,        <code>sxAddTraceEntry(e)</code>.</p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рд╢ рдХрд░реЛ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЕрдиреНрдп рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рддрддреНрд╡ рдореИрдХреНрд░реЛрдЬрд╝ (- рдЖрдкрдХреЗ </font></font><abbr title="рдХрдкреНрддрд╛рди рдЬрд╝рд╛рд╣рд┐рд░"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрдУ</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рд╣реИрдВред </font></font><code>{ }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдирдХреЗ рдмрд╛рдж </font><font style="vertical-align: inherit;">рдмреНрд░реИрдХреЗрдЯ </font><font style="vertical-align: inherit;">рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдпрд╣ рд╕рднреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЫрджреНрдо рдХреЛрдб рдХреЛ рдЙрдмрд╛рд▓рддрд╛ рд╣реИ:</font></font></p><br>
<pre><code class="plaintext hljs">try {                             int _sxLastJumpCode = setjmp(add_context()┬╣);<font></font>
                                  bool handled = false;<font></font>
                                  if (_sxLastJumpCode == 0) {<font></font>
  throw(msgex("Mama mia!"));        clearTrace();<font></font>
                                    sxAddTraceEntry(msgex(...));<font></font>
                                    if (count_contexts() == 0) {<font></font>
                                      fprintf(stderr, "Shurik, vs propalo!");<font></font>
                                      sxPrintTrace();<font></font>
                                      exit(curex().code);<font></font>
                                    } else {<font></font>
                                      longjmp(top_context());<font></font>
                                    }<font></font>
} catch (9000) {                  } else if (_sxLastJumpCode == 9000) {<font></font>
                                    handled = true;<font></font>
} catchall {                      } else {<font></font>
                                    handled = true;<font></font>
} finally {                       }<font></font>
                                  //    finally { }<font></font>
} endtry                          remove_context();<font></font>
                                  if (!handled) {<font></font>
                                    //    throw()<font></font>
                                  }</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">┬╣ </font><font style="vertical-align: inherit;">рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_ рдХреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рде рдирд╛рдо рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╡реЗ рд╕рд╛рд░ рд╣реИрдВред</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ, </font><font style="vertical-align: inherit;">рдПрд╕рдЬреЗрдПрд▓рдЬреЗ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреА </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрд╛рдж </font><font style="vertical-align: inherit;">, рдпрд╣рд╛рдБ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдФрд░ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдЫреБрдЯреНрдЯреА рд▓реЗрдиреЗ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЖрдкрдХреЛ рдордВрдЬрд┐рд▓ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi491054/index.html">PKCS # 11 рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GPG рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдИрдореЗрд▓ рдкрддреНрд░рд╛рдЪрд╛рд░ рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi491056/index.html">Ampere Altra - рджреБрдирд┐рдпрд╛ рдХрд╛ рдкрд╣рд▓рд╛ 80-рдХреЛрд░ ARM рдкреНрд░реЛрд╕реЗрд╕рд░ рд╣реИ</a></li>
<li><a href="../hi491058/index.html">рдореГрддреНрдпреБ рджрд░, рдореГрддреНрдпреБ рджрд░, рдХреЛрд░реЛрдирд╛рд╡рд╛рдпрд░рд╕ рдФрд░ рдорддрд╛рди</a></li>
<li><a href="../hi491062/index.html">рдХреЛрдгреАрдп: рдПрдХ рдХрд╕реНрдЯрдо рдлрд╛рд░реНрдо рддрддреНрд╡ рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╛рд░реНрдо рд░рд╛рдЬреНрдп рдЧреБрдЬрд░ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi491076/index.html">рдиреЗрд╕реНрдЯрд░рдЬ рдореЗрдВ рд░реИрдмрд┐рдЯрдПрдордХреНрдпреВ рдХреЗ рд╕рд╛рде рдЪрддреБрд░ рдХрд╛рдо</a></li>
<li><a href="../hi491086/index.html">рд╢реБрд░реБрдЖрдд рдХреА рдЖрдБрдЦреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдмрд┐рдХреНрд╕ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реАред рднрд╛рдЧ 6. рд╕рд░реНрд╡рд░ рдЗрдВрдЯрд░реИрдХреНрд╢рди</a></li>
<li><a href="../hi491088/index.html">GitHub: OSINT рдХреЗ рд▓рд┐рдП рдирдпрд╛ рдУрдкрди рд╕реЛрд░реНрд╕ рд▓рд╛рдЗрдмреНрд░реЗрд░реА</a></li>
<li><a href="../hi491090/index.html">C # рдореЗрдВ рдЯреЗрдХреНрд╕реНрдЯ рдбреЙрдХреНрдпреБрдореЗрдВрдЯреНрд╕ рдХреЛ xml рдореЗрдВ рдмрджрд▓реЗрдВ</a></li>
<li><a href="../hi491092/index.html">рдХреИрд╕реЗ рдХреНрд░реИрд╢ Bandicoot рд╣реИрдХ рдкреНрд▓реЗрд╕реНрдЯреЗрд╢рди</a></li>
<li><a href="../hi491094/index.html">рдореЙрдбрд░реНрди рд▓рд┐рдирдХреНрд╕ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░ рдлрд╛рдпрд░рдмрд░реНрдб 3 рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛: CentOS8 рдФрд░ Ubuntu 19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>