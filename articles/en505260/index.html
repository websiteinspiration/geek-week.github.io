<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö† üå§Ô∏è üàπ Measuring the delay from the keyboard to the photon using an optical sensor üë∫ üßöüèº üå§Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To measure response time or latency on computers and interfaces, I have long been using the Is It Snappy app with a high-speed iPhone camera to count ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Measuring the delay from the keyboard to the photon using an optical sensor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505260/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To measure response time or latency on computers and interfaces, I have long been using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is It Snappy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> app </font><font style="vertical-align: inherit;">with a high-speed iPhone camera to count frames between a key press and a screen change. However, the problem is to determine the exact frames for timing by eye, which is annoying when performing many tests. It also makes it difficult to measure the variability of the results. I have already simplified these tests by </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adding a mode to the keyboard firmware that changes the color of the LED after sending the event via USB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but this only slightly increases the speed and accuracy. I would like something better. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I followed in the footsteps of my friend </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rafa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and made a hardware delay tester, which sends keyboard events, and then with the help of an optical sensor measures the time it takes to change the screen! </font><font style="vertical-align: inherit;">It was quite easy, and in this article I will talk about some of the results, as well as the difficulties of high-quality delay testing and how to make your own tester.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My tester is based on a light sensor with Amazon. </font><font style="vertical-align: inherit;">It is mounted on an adjustable tripod connected to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teensy LC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> microcontroller </font><font style="vertical-align: inherit;">, which presses 'a' and waits for the light level to change, deletes the letter, and then continues to collect samples while holding the button. </font><font style="vertical-align: inherit;">With a short press of a button, it displays a beautiful histogram of the delay, which looks like this:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lat i = 60.3 +/- 9.3, a = 60, d = 59 (n = 65, q = 41) | </font><font style="vertical-align: inherit;">239_ |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This line shows the average delay of inserts ( </font></font><code>i=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), deletions ( </font></font><code>d=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and their combined ( </font></font><code>a=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), standard deviation of insertion time ( </font></font><code>+/-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), the number of measurements ( </font></font><code>n=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and quality ( </font></font><code>q=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), as well as a small ascii-histogram, where each symbol represents a fragment (bucket ) in 10 ms, and the numbers from 1 to 9 proportionally represent how full this bucket is. The symbol </font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">means a bucket with at least one sample, but it is not enough to fill one ninth bucket, so this is a delay tail with a small number of random samples. Here's what it looks like (in the photo monitors were in portrait mode, but all the tests were done in landscape mode): </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/415/1f5/016/4151f5016c68014682c8e09eac08b240.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I also made it so that pressing the button again displays all the measurement results, for example,</font></font><code>[35, 35, 33, 44]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so that you can generate a graph:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/326/7b9/7ef/3267b97ef54e907c5d656dd0b7ae75d2.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor response time</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I'll start with my favorite set of results:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sublime Text, macOS, distraction-free full-screen mode on two 4k monitors:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 35.3 +/- 4.7, a = 36, d = 36 (n = 67, q = 99) | </font><font style="vertical-align: inherit;">193 | </font><font style="vertical-align: inherit;">Dell P2415Q top</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 52.9 +/- 5.0, a = 53, d = 54 (n = 66, q = 45) | </font><font style="vertical-align: inherit;">_391 | </font><font style="vertical-align: inherit;">Dell P2415Q bottom</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 65.1 +/- 5.0, a = 64, d = 63 (n = 109, q = 111) | </font><font style="vertical-align: inherit;">_292 | </font><font style="vertical-align: inherit;">HP Z27 top</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 79.7 +/- 5.0, a = 80, d = 80 (n = 98, q = 114) | </font><font style="vertical-align: inherit;">89_ | </font><font style="vertical-align: inherit;">HP Z27 bottom</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is something to see here:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, I like that the single-line format of a fixed-width histogram allows you to put all the results side by side in a text file and flag them for comparison.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see the expected 16 ms difference between the response time at the top and bottom of the screen due to the scan time of the lines for frames at 60 Hz.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The standard deviation is not much different from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6 ms</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from a uniform distribution of results with a screen refresh time of 16 ms.</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The HP Z27 has a response time of approximately 30 ms longer than the Dell P2415Q! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And this measurement is until the very beginning of the display of the symbol. </font><font style="vertical-align: inherit;">I'm pretty sure the full display also takes longer on the Z27. </font><font style="vertical-align: inherit;">That is, on Z27 in the Sublime editor, almost half of the entire delay is an extra delay from the monitor!</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All measurements in the rest of this article were made on my Dell P2415Q. </font><font style="vertical-align: inherit;">Both monitors have a ‚Äúfast‚Äù response time, the Z27 has an even faster response time setting, but it only affects the transition time from start to finish (transition time) and introduces ugly ghost tracks, not helping to reduce the initial delay.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Measurement difficulties</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In most of the well-known methods, measuring delay quality is actually more difficult than you think. </font><font style="vertical-align: inherit;">To get realistic results, I put more effort into it than most experimenters, but everything failed for the first few times, so I had to fix the errors.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actual end-to-end delay measurement</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main reason for using a hardware tester is that there are many incomplete and false methods for measuring end-to-end delay. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a well-known and really excellent article called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúWe print with pleasure‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with good analysis and beautiful graphs. It compares the delay of various text editors on different operating systems. But the author implemented measurements through simulating input events and screen scraping using system APIs. I myself did not take repeated measurements, so I can not point out anything specifically wrong, but there are a lot of potential problems with this approach. For example, checking the screen buffer on the CPU can unjustifiably penalize applications that render on the GPU, due to copies of the window buffer in some cases where capture may work. Simulating input can go a different way than real keystrokes. Despite this, even in the case of really high-quality measurements and objective results (and we can‚Äôt really be sure of this without checking them on the through test),these results do not tell us the full response time from start to finish, which is important for a real experience.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1000 Hz USB Polling</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the sources of delay that users experience, but which my tester does not measure, is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyboard latency</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Many keyboards can double the response time I measured ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">like my previous keyboard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) due to 8-millisecond USB polling intervals, slow keyboard grid scan speed, slow firmware, and controversial mechanical design. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To build a delay tester with a low dispersion for emulating the keyboard, you can‚Äôt just take any microcontroller - usually there is a default poll with a frequency of 125 Hz. </font><font style="vertical-align: inherit;">My </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teensy LC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> microcontroller </font><font style="vertical-align: inherit;">is one of the few that uses 1000 Hz by default.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuring a good signal level</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first, when I designed my tester for response time, I did not measure the signal strength at all. In the end, I got confused: in the same application, on the same screen in slightly different scenarios, completely different results were obtained. I did some testing and found out that sometimes the signal is very weak on small fonts with poor placement of sensors, so the sensor works only at the end of the output of the symbol, although it should work at the beginning (this is its own difficult subjective choice).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I knew that the reason should be the time of a complete transition from the beginning to the end of the display, because even before writing the firmware, I played with a simple poll of the optical sensor every millisecond, using the Arduino plotter to output the results. Just typing and deleting characters to look at the signal. You may notice that in some combinations of the optical sensor and the monitor, the full transition takes almost 100 ms. But the video recording with </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is It Snappy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gives the impression that the full transition on the Z27 monitor takes only about 20 ms. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d32/500/02b/d3250002bac009103ed40a5c47cb56bc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For correction, I added a measurement of signal strength from peak to peak after a full transition to verify that I get adequate measurement resolution for my threshold in five steps to the beginning of the transition. This is the number you see after</font></font><code>q=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As it turned out, it is very important to set a large font size and high screen brightness.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strong scatter from small differences</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is possible that seemingly insignificant differences in the measurement object will lead to serious delay differences. For example, I wanted to see if there is a significant difference between the response time of Sublime and VSCode when selecting text in a small file compared to a large file with a complex selection grammar and an autocomplete popup. Of course, there is a difference. But when I noticed some variation in the values, I ran a few more tests and found that the response time is very different between entering 'a' on an empty line and entering 'a' after the previous 'a' ('aa'). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are the results of creating a new line after the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3469th</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> line in the large </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">parser.rs</font></a><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">with 6199 lines. All results are obtained after a similar positioning of the sensor closer to the bottom of the Dell monitor.</font></font><br>
<br>
<pre>lat i= 40.2 +/-   4.1, a= 40, d= 39 (n= 38,q= 90) |  _89           | sublime small .txt<font></font>
<font></font>
lat i= 41.2 +/-   6.9, a= 41, d= 42 (n= 54,q= 92) |   992          | sublime aa parser.rs<font></font>
lat i= 43.6 +/-   6.1, a= 43, d= 42 (n= 48,q=100) |   492          |<font></font>
lat i= 52.2 +/-   6.0, a= 52, d= 52 (n= 26,q=100) |    49          |<font></font>
lat i= 44.3 +/-   5.6, a= 43, d= 42 (n= 45,q=100) |   391          |<font></font>
lat i= 42.7 +/-   7.6, a= 42, d= 42 (n= 46,q=100) |  _491          |<font></font>
<font></font>
lat i= 48.1 +/-   6.8, a= 49, d= 50 (n= 43,q= 89) |   269          | sublime a parser.rs<font></font>
lat i= 43.9 +/-   5.4, a= 48, d= 52 (n= 32,q= 97) |   197          |<font></font>
lat i= 47.8 +/-   8.4, a= 49, d= 49 (n= 29,q= 97) |   197_         |<font></font>
lat i= 46.1 +/-   6.8, a= 47, d= 49 (n= 42,q= 97) |   196_         |<font></font>
<font></font>
lat i= 63.3 +/-   9.3, a= 63, d= 62 (n= 68,q=118) |    _963__      | vscode aa parser.rs<font></font>
lat i= 63.6 +/-   7.6, a= 64, d= 65 (n= 71,q=139) |    _49__     _ |<font></font>
lat i= 62.3 +/-   6.3, a= 61, d= 59 (n= 52,q=132) |    _791        |<font></font>
lat i= 62.0 +/-   5.8, a= 61, d= 60 (n= 40,q=111) |    _49_        |<font></font>
lat i= 61.9 +/-   9.7, a= 62, d= 61 (n= 35,q=111) |     981_       |<font></font>
<font></font>
lat i= 53.1 +/-   7.7, a= 51, d= 49 (n= 54,q=116) |   _79__        | vscode a parser.rs<font></font>
lat i= 52.2 +/-   6.3, a= 52, d= 51 (n= 41,q=133) |    692         |<font></font>
lat i= 53.2 +/-   7.8, a= 52, d= 52 (n= 57,q=134) |    591_        |<font></font>
lat i= 52.1 +/-   7.1, a= 52, d= 52 (n= 55,q=134) |    591_        |</pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I took many measurements at different times and with minor variations to confirm the effect. As you can see, there are some differences between the dimensions in the same scenario, but there are much more variations between simply entering 'a' and adding 'a' after the existing 'a'. Look at the column </font></font><code>a=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which includes the results of both insertion and deletion, so there is the least noise. Sublime enters the second character in the sequence 'aa' faster than the first, and VSCode vice versa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In both editors, 'aa' causes the autocomplete popup window to appear and disappear to select an option between the two lists and the letters 'a'. </font><font style="vertical-align: inherit;">I can assume that Sublime is slower in the case of 'a', because opening and closing the pop-up autofill window takes some time, but I do not have a clear version of why VSCode is slower in the case of 'aa' both during insertion and during deletion.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rassynchron with screen update</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then I noticed that the standard deviations were suspiciously low. Sometimes the standard deviation was 1 ms, although logically it should exceed 4.6 ms due to 16 ms screen refresh intervals. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I looked at my code and realized that measurements accidentally synchronized with screen updates. After each measurement, the firmware waited exactly 300 ms before typing 'a' again or deleting the symbol and making the next measurement. This means that the input data was always sent approximately 300 ms after the screen was updated, rather stably falling into the same update interval. I fixed this problem by adding a random delay of 50 ms between measurements, such a peculiar jittering.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basically, this error caused deviations too low, but could lead to incorrect average values ‚Äã‚Äãif the application skipped the deadline for rendering when the input event arrives at the end of the frame. </font><font style="vertical-align: inherit;">I discovered this during testing for this article and could no longer repeat all previous tests, so in some places you may notice some low deviation values. </font><font style="vertical-align: inherit;">But I rechecked the averages for important tests like Sublime and VSCode.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Text editors</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I tested the response time of several text editors on the same plain text file. </font><font style="vertical-align: inherit;">But as I noted above, the tests were done before the implementation of the rassinhron with updating the screen through jittering. </font><font style="vertical-align: inherit;">Repeated tests were conducted only for Sublime and VSCode.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lat i = 32.5 +/- 4.0, a = 34, d = 35 (n = 38, q = 78) | </font><font style="vertical-align: inherit;">9_ | </font><font style="vertical-align: inherit;">sublime text</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 33.4 +/- 1.4, a = 33, d = 33 (n = 68, q = 23) | </font><font style="vertical-align: inherit;">_9 | </font><font style="vertical-align: inherit;">textedit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 47.6 +/- 7.0, a = 47, d = 47 (n = 71, q = 130) | </font><font style="vertical-align: inherit;">219 | </font><font style="vertical-align: inherit;">vscode</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 34.2 +/- 3.5, a = 34, d = 33 (n = 57, q = 37) | </font><font style="vertical-align: inherit;">9 _ | </font><font style="vertical-align: inherit;">chrome html input</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 33.2 +/- 1.1, a = 33, d = 33 (n = 55, q = 30) | </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">stock mac emacs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 45.6 +/- 7.0, a = 43, d = 41 (n = 35, q = 56) | </font><font style="vertical-align: inherit;">992_ | </font><font style="vertical-align: inherit;">atom</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 35.0 +/- 4.7, a = 35, d = 35 (n = 66, q = 11) | </font><font style="vertical-align: inherit;">9__ | </font><font style="vertical-align: inherit;">xi</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Given the lack of jittering, based on these results, I would say that all editors except VSCode and Atom work equally well. </font><font style="vertical-align: inherit;">And even for these two, with normal typing, a smaller penalty for response time than usual for a monitor or keyboard.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminals</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I also measured the delay in different terminals. </font><font style="vertical-align: inherit;">The Apple terminal and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kitty</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seem to have </font><font style="vertical-align: inherit;">optimal response times, while </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iTerm2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alacritty</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> look a little worse.</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lat i = 53.1 +/- 6.6, a = 54, d = 55 (n = 53, q = 59) | </font><font style="vertical-align: inherit;">291 _ | </font><font style="vertical-align: inherit;">iterm2 gpu render</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 50.5 +/- 2.5, a = 50, d = 50 (n = 56, q = 59) | </font><font style="vertical-align: inherit;">19_ | </font><font style="vertical-align: inherit;">iterm2 no gpu</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 35.8 +/- 7.0, a = 34, d = 33 (n = 73, q = 48) | </font><font style="vertical-align: inherit;">9___ | </font><font style="vertical-align: inherit;">apple terminal</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 35.1 +/- 2.5, a = 34, d = 32 (n = 35, q = 52) | </font><font style="vertical-align: inherit;">9_ | </font><font style="vertical-align: inherit;">apple terminal vim</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 50.4 +/- 3.9, a = 50, d = 49 (n = 60, q = 269) | </font><font style="vertical-align: inherit;">_59 | </font><font style="vertical-align: inherit;">alacritty</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lat i = 36.1 +/- 5.6, a = 35, d = 34 (n = 78, q = 199) | </font><font style="vertical-align: inherit;">9__ | </font><font style="vertical-align: inherit;">kitty</font></font></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to make it</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is the list of parts I used:</font></font><br>
<br>
<ul>
<li><b>$12</b>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">Teensy LC</a>     Teensy&nbsp;3+.   Arduino,  USB- Teensy     1000&nbsp; ( 1 ),      USB-      125&nbsp; ( 8&nbsp;     ). ,      1000&nbsp;.     ,     ,  Teensy&nbsp;3  .<br>
</li>
<li><b>$12</b>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a> (Amazon     ,    ).    ,           .<br>
</li>
<li><b>$13</b>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"></a>         .<br>
</li>
<li>- /   <br>
</li>
<li>    , Teensy  <br>
</li>
<li>    ,     <br>
</li>
<li> USB micro-B   Teensy  </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The device can be assembled in many ways. The bottom line is that you just need to somehow connect the three wires (3V, ground, analog output) from the optical sensor module to the corresponding Teensy pins (3V, ground and any analog pin). The easiest way to do this, which does not even require soldering, if you bought Teensy with pre-soldered pins, is to connect three </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wires with jumpers mom-mom</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Then you just need some kind of switch to run the test. Here, one pin on the Teensy connects to ground, and the other to the digital I / O pin. If you are really lazy, a touch of two wires is enough!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To make sure that the optical sensor module sees only a limited area of ‚Äã‚Äãthe screen, I wrapped it in a small cylinder of electrical tape - and carefully cut off the end with scissors. It turned out a small round window, which can be pressed to the screen with a tripod to minimize external noise and get the cleanest signal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I already made a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pedal case</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with a Teensy LC and a small board inside, and it had an additional </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TRRS connector</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the side </font><font style="vertical-align: inherit;">, which I specially installed, waiting for a similar project in the future where it will be needed. Therefore, it remained to solder the optical sensor to the TRRS cable. Then you can use one of my pedals to control the testing!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I was lucky with soldering, because for one project I just bought magnetic pens, which can also be used in the soldering process. Unfortunately, it turned out that in reality I don‚Äôt have many large pieces of metal on which they can be attached, so in the end I took a cast-iron frying pan for soldering, and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my tungsten cube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for operations on the table </font><font style="vertical-align: inherit;">(it turned out that it was slightly magnetized).</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ccf/ae5/836/ccfae58364a964a71628451dcb1e9feb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I suggest you show your imagination and do something more interesting than just dangling connecting wires. For my pedal, I bought a plastic box at a local electronics store, drilled a few holes on the sides, inserted audio jacks and put a small breadboard to reconfigure the connections. Amazon has tons of pedals for tattoo machines and electric pianos with 1/4 ‚Äùphone jacks, you can choose from. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here are</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> my favorites for silence and tactile sensations. But there are cheaper options that can be unreliable, hard to push or unpleasant to make noise.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I would not recommend using the TRRS socket for the sensor module in my example. </font><font style="vertical-align: inherit;">Although it is good and compact and there are many cables available for it, it later turned out that because of it, too many connections are shorted out when connecting and disconnecting power. </font><font style="vertical-align: inherit;">I tried to minimize this by separating the power and grounding at the opposite ends of the board, but I advise you to take a cable of some better type, maybe a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telephone one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/3d5/fce/cfd/3d5fcecfdc63a4901b487091142a09c1.jpg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To determine the beginning and end of the output of the character on the screen, I do not have the most sophisticated firmware, but I spent some time setting it up to work well and adding various functions, so I recommend starting with it. </font><font style="vertical-align: inherit;">Install </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teensyduino</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then you can download my </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino sketch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which works for the pedal - but you can comment out unnecessary fragments and configure it to use the right contacts. </font><font style="vertical-align: inherit;">Then everything is simple - a long press on the button starts the measurement, and a short press displays the results!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505246/index.html">Print the first tranche with Upwork</a></li>
<li><a href="../en505252/index.html">Avokado project</a></li>
<li><a href="../en505254/index.html">Snake sugar or write your range in JavaScript</a></li>
<li><a href="../en505256/index.html">Successful launch. 39th from the beginning of the year. 14th from the USA. Starlink SpaceX Satellites</a></li>
<li><a href="../en505258/index.html">Dentistry: expectation and reality</a></li>
<li><a href="../en505264/index.html">As I wrote the html parser in php, and what came of it. Part one</a></li>
<li><a href="../en505268/index.html">Personal experience: from frontend developer to leader</a></li>
<li><a href="../en505274/index.html">Deadly sins of site security: what we learned from the vulnerability scanner statistics for the year</a></li>
<li><a href="../en505276/index.html">How we taught ABBYY FineReader PDF to edit whole paragraphs</a></li>
<li><a href="../en505278/index.html">39 abbreviations in English for beginner marketers and seoshnikov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>