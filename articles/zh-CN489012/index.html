<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗾 🍈 👊🏾 Google Cloud Spanner：好，坏，邪恶 🔗 💗 🔂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="嗨哈布罗夫斯克 传统上，我们在预期推出新课程时会继续分享有趣的材料。今天，我们特别为您发布了一篇有关Google Cloud Spanner的文章，其发布时间恰好与AWS for Developers课程的启动相吻合。
 
 
 
 最初发布在Lightspeed HQ博客上。
 
 作为一家为世界...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Google Cloud Spanner：好，坏，邪恶</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489012/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嗨哈布罗夫斯克 </font><font style="vertical-align: inherit;">传统上，我们在预期推出新课程时会继续分享有趣的材料。</font><font style="vertical-align: inherit;">今天，我们特别为您发布了一篇有关Google Cloud Spanner的文章，其发布时间恰好与</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS for Developers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">课程的启动相吻合</font><font style="vertical-align: inherit;">。</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/aj/iu/8h/ajiu8hhn-nlooidazuy-xsxjb6a.png"><br>
<br>
<hr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初发布</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Lightspeed HQ博客上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为一家为世界各地的零售商，餐馆和在线零售商提供许多基于云的POS解决方案的公司，Lightspeed将几种不同类型的数据库平台用于各种交易，分析和搜索案例。</font><font style="vertical-align: inherit;">每个数据库平台都有其优点和缺点，因此，当Google在市场上推出Cloud Spanner时，关系数据库世界中前所未有的有前途的功能，例如几乎无限的水平可扩展性和99.999％的服务水平协议（SLA）， -我们不能错过获得它的机会！</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了全面概述我们在Cloud Spanner方面的经验以及我们使用的评估标准，我们将涵盖以下主题：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的评估标准</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简而言之，云扳手</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的评价</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的发现</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/2m/br/l7/2mbrl7cdprixgrcxqn4dp25yvju.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.我们的评估标准</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在深入研究Cloud Spanner的功能，其与市场上其他解决方案的异同之前，让我们先讨论一下在考虑将Cloud Spanner部署到基础架构中时要考虑的主要用户案例：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代（流行的）传统SQL数据库解决方案</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有OLAP支持的OLTP解决方案如何</font></font></li>
</ul><br>
<blockquote><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了简化并便于比较，本文将Cloud Spanner与MySQL GCP Cloud SQL和Amazon AWS RDS系列解决方案进行了比较。</font></font></i></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Cloud Spanner替代传统的SQL数据库解决方案</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传统的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font><font style="vertical-align: inherit;">环境中</font><font style="vertical-align: inherit;">，当对数据库查询的响应时间接近甚至超过预定义的应用程序阈值时（主要是由于用户和/或查询数量的增加），有几种方法可以将响应时间减少到可接受的水平。但是，大多数这些解决方案都包括手动干预。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，您需要采取的第一步是查看与性能相关的各种数据库参数，并将其配置为与应用程序使用模式最匹配。如果这还不够，您可以选择垂直或水平缩放数据库。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
扩展应用程序通常需要通过添加更多的处理器/内核，更多的RAM，更快的存储等来更新服务器实例。添加更多的硬件资源会导致数据库性能的提高，这主要是通过以下方式进行的：第二，OLTP系统的事务延迟。关系数据库系统（使用多线程方法），例如MySQL，可以很好地垂直扩展。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这种方法有几个缺点，但最明显的是市场上最大的服务器大小。一旦达到最大服务器实例的限制，就只有一种方法：水平扩展。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
水平扩展是一种方法，其中将更多服务器添加到群集，以理想方式通过增加服务器数量线性地提高性能。大多数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传统的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库系统无法很好地横向扩展或根本无法扩展。例如，MySQL可以通过添加从属读取器来横向扩展读取操作，但是不能横向进行写入操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另一方面，由于其性质，Cloud Spanner可以轻松地水平扩展而干扰最小。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
功能齐全的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS即服务</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须从不同角度进行评估。</font><font style="vertical-align: inherit;">作为基础，我们采用了云中最受欢迎的DBMS-Google，GCP Cloud SQL和Amazon，AWS RDS。</font><font style="vertical-align: inherit;">在我们的评估中，我们重点关注以下类别：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能映射：SQL范围，DDL，DML；</font><font style="vertical-align: inherit;">连接库/连接器，事务支持等。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发支持：易于开发和测试。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理支持：实例管理-例如，扩展/缩小和升级实例；</font><font style="vertical-align: inherit;">SLA，备份和还原；</font><font style="vertical-align: inherit;">安全/访问控制。</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将Cloud Spanner用作具有OLAP支持的OLTP</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管Google并未明确宣称Cloud Spanner用于分析处理，但它与其他机制（例如针对OLAP工作负载设计的Apache Impala＆Kudu和YugaByte）具有一些共同点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使Cloud Spanner极少包含具有（或多或少）可用的OLAP功能集的一致的水平可扩展HTAP（混合事务/分析处理）引擎的机会，我们认为也应引起我们的注意。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到这一点，我们检查了以下类别：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据加载，索引和分区支持</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询性能和DML</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.简而言之，Cloud Spanner</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Spanner是一个集群关系数据库管理系统（RDBMS），Google用于其自身的多项服务。</font><font style="vertical-align: inherit;">Google于2017年初向Google Cloud Platform用户公开提供了此功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下是Cloud Spanner的一些属性：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度一致的可伸缩RDBMS群集：使用硬件时间同步来确保数据一致性。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跨表事务支持：事务可以跨多个表-不必限于一个表（与Apache HBase或Apache Kudu不同）。</font></font></li>
<li>    :        (),       .      ,           .       ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>.</li>
<li> :        .          .     ,        , ,       -.</li>
<li>: Cloud Spanner   .         .         .         .     , ,    ,   .         ,    .</li>
</ul><br>
<i>«Cloud Spanner       .  , Cloud Spanner     ,    - ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>».</i><br>
<br>
<ul>
<li>    (SLA):      SLA  99,99%;    99,999% SLA.          ,   - ,  ,    Google     ,     . ( , 99,999%  26,3     .)</li>
<li>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://cloud.google.com/spanner/</a></li>
</ul><br>
<blockquote><i><b>:</b>  Apache Tephra      Apache HBase (    Apache Phoenix   -).</i></blockquote><br>
<h2>3.  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们都阅读了Google关于Cloud Spanner的好处的声明-几乎无限的水平扩展，同时保持了高一致性和很高的SLA。</font><font style="vertical-align: inherit;">尽管无论如何都很难实现这些要求，但我们的目标不是反驳它们。</font><font style="vertical-align: inherit;">相反，让我们关注大多数数据库用户关心的其他事情：奇偶校验和可用性。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将Cloud Spanner评定为可替代MySQL</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Cloud SQL和Amazon AWS RDS是云市场上两个最流行的OLTP DBMS，具有非常大的功能集。</font><font style="vertical-align: inherit;">但是，要将这些数据库扩展到单个节点之外，您需要执行应用程序分区。</font><font style="vertical-align: inherit;">这种方法为应用程序和管理增加了额外的复杂性。</font><font style="vertical-align: inherit;">我们研究了Spanner如何适合将多个段组合到一个实例中的情况，以及可能不得不牺牲哪些功能（如果有）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否支持SQL，DML和DDL以及连接器和库？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，从任何数据库开始时，必须创建一个数据模型。</font><font style="vertical-align: inherit;">如果您认为可以将JDBC Spanner连接到您喜欢的SQL工具，则会发现可以使用它查询数据，但是您不能使用它来创建表或更改（DDL）或任何插入/更新/删除操作（ DML）。</font><font style="vertical-align: inherit;">Google的官方JDBC都不支持。</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“驱动程序当前不支持DML或DDL。” </font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
扳手文档</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用GCP控制台，情况再好不过-您只能发送SELECT查询。幸运的是，社区提供了一个具有DML和DDL支持的JDBC驱动程序，包括事务</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/olavloite/spanner-jdbc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。尽管此驱动程序非常有用，但是缺少Google自己的JDBC驱动程序令人惊讶。幸运的是，Google对客户端库（基于gRPC）提供了相当广泛的支持：C＃，Go，Java，node.js，PHP，Python和Ruby。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
几乎强制使用Cloud Spanner用户界面（由于JDBC中缺少DDL和DML）导致对代码相关领域的某些限制，例如连接池或数据库绑定框架（例如Spring MVC）。通常，在使用JDBC时，您可以自由选择自己喜欢的连接池（例如，HikariCP，DBCP，C3PO等），该连接池已经过测试并且运行良好。对于自定义Spanner API，我们必须依靠我们自己创建的框架/绑定池/会话。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过PC进行主键（PC）设计时，Cloud Spanner的速度非常快，但也会导致一些查询问题。</font></font><br>
<br>
<ul>
<li>      ;               . (       / .)</li>
<li>  UPDATE  DELETE     WHERE, ,      DELETE all —    , : UPDATE xxx WHERE id IN (SELECT id FROM table1)</li>
<li>    - ,      .   ,        .</li>
</ul><br>
<h4> ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google Cloud Spanner内置了对二级索引的支持。这是一个非常好的功能，其他技术中并不总是存在。 Apache Kudu当前根本不支持二级索引，并且Apache HBase不直接支持二级索引，但是可以通过Apache Phoenix添加它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以将Kudu和HBase中的索引建模为具有不同主键组成的单独表，但是在父表和相关索引表上执行的操作的原子性必须在应用程序级别执行，并且在正确的实现中并非无关紧要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如Cloud Spanner评论中所述，其索引可能与MySQL索引不同。</font><font style="vertical-align: inherit;">因此，在建立查询和分析时应格外小心，以确保在需要的地方使用正确的索引。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
视图是数据库中非常流行且有用的对象。</font><font style="vertical-align: inherit;">它们对于大量的用户案例很有用。</font><font style="vertical-align: inherit;">我最喜欢的两个是逻辑抽象级别和安全级别。</font><font style="vertical-align: inherit;">不幸的是，Cloud Spanner不支持提交。</font><font style="vertical-align: inherit;">但是，这仅部分限制了我们，因为对于访问权限，在表示可能是可接受的解决方案的列级别没有粒度。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner文档的一节详细介绍了配额和限制（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扳手/配额</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），尤其是某些应用程序可能会遇到问题：开箱即用的Cloud Spanner每个实例最多限制100个数据库。</font><font style="vertical-align: inherit;">显然，这对于设计为可扩展到100多个数据库的数据库可能是一个严重的障碍。</font><font style="vertical-align: inherit;">幸运的是，在与我们的Google技术代表交谈后，我们发现可以通过Google支持将该限制提高到几乎任何价值。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发支持？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner对编程语言提供了相当不错的支持，以与其API一起使用。</font><font style="vertical-align: inherit;">官方支持的库位于C＃，Go，Java，node.js，PHP，Python和Ruby领域。</font><font style="vertical-align: inherit;">该文档非常详细，但是与其他先进技术一样，与最流行的数据库技术相比，社区是很小的，这可能导致解决不常见用例或问题所花费的时间增加。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么当地的发展支持呢？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们找不到在本地环境中创建Cloud Spanner实例的方法。</font><font style="vertical-align: inherit;">我们得到的最接近的是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CockroachDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Docker映像</font><font style="vertical-align: inherit;">，它在原理上是相似的，但实际上却大不相同。</font><font style="vertical-align: inherit;">例如，CockroachDB可以使用PostgreSQL JDBC。</font><font style="vertical-align: inherit;">由于开发环境应尽可能接近工作环境，因此Cloud Spanner并不理想，因为您需要依赖完整的Spanner实例。</font><font style="vertical-align: inherit;">为了节省成本，您可以为一个区域选择一个实例。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政支持？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建Cloud Spanner实例很容易。</font><font style="vertical-align: inherit;">您只需要在为一个区域创建多区域或实例之间进行选择，即可指定区域和节点数。</font><font style="vertical-align: inherit;">在不到一分钟的时间内，实例将启动并运行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Google控制台的“扳手”页面上可以直接使用几个基本指标。</font><font style="vertical-align: inherit;">可通过Stackdriver获得更详细的视图，您还可以在其中设置阈值指标和警报策略。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得资源？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL提供了广泛且非常详细的用户权限/角色设置。</font><font style="vertical-align: inherit;">您可以轻松配置对特定表的访问，甚至可以仅配置其列的子集。</font><font style="vertical-align: inherit;">Cloud Spanner使用Google身份和访问管理（IAM）工具，该工具仅允许您在很高的级别上设置策略和权限。</font><font style="vertical-align: inherit;">最详细的选项是数据库级别的解决方案，不适用于大多数生产案例。</font><font style="vertical-align: inherit;">此限制迫使您向代码和/或基础结构中添加其他安全措施，以防止未经授权使用Spanner资源。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
简而言之，Cloud Spanner中没有备份。</font><font style="vertical-align: inherit;">尽管Google SLA的高要求可以保证您不会因硬件或数据库故障，人为错误，应用程序缺陷等而丢失任何数据。我们都知道规则：高可用性不能替代合理的备份策略。</font><font style="vertical-align: inherit;">目前，备份数据的唯一方法是以编程方式将其从数据库流式传输到单独的存储环境。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询性能？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用Yahoo!来下载数据和测试查询。云服务基准。下表显示了YCSB B工作负载，其读取率为95％，写入率为5％。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vx/po/h4/vxpoh4penig4qvaa5sj1gvflfvm.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*负载测试是在n1-standard-32计算引擎（CE）（32 vCPU，120 GB内存）上执行的，并且测试实例绝不是测试的瓶颈。</font></font></i><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">**一个YCSB实例中的最大线程数为400。总计，必须运行六个并行的YCSB测试实例才能获得总共2400个线程。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查看测试结果，特别是处理器负载和TPS的组合，我们可以清楚地看到Cloud Spanner的扩展性很好。</font><font style="vertical-align: inherit;">Cloud Spanner集群中的大量节点可以补偿由大量线程创建的大量负载。</font><font style="vertical-align: inherit;">尽管延迟看起来很高，尤其是在使用2400个线程时，但可能需要使用6个较小的计算引擎实例进行重新测试才能获得更准确的数字。</font><font style="vertical-align: inherit;">每个实例将运行一个YCSB测试，而不是一个具有6个并行测试的大型CE实例。</font><font style="vertical-align: inherit;">因此，将更容易地区分Cloud Spanner请求延迟和Cloud Spanner与运行测试的CE实例之间的网络连接所增加的延迟。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud Spanner如何处理OLAP？</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将数据分为物理上和/或逻辑上独立的段（称为分区）是大多数OLAP机制固有的非常流行的概念。分区可以显着提高查询性能和数据库支持。关于分区的进一步深化将在另一篇文章中介绍，因此，让我们仅提及使用分区方案和子分区的重要性。将数据划分为多个分区，甚至进一步细分为子分区的能力，对于分析查询的性能至关重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud Spanner本身不支持分区。它在内部将数据</font><i><font style="vertical-align: inherit;">拆分</font></i><font style="vertical-align: inherit;">为所谓的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拆分</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于主键范围。</font><font style="vertical-align: inherit;">自动执行分离以平衡Cloud Spanner集群中的负载。</font><font style="vertical-align: inherit;">Cloud Spanner的一个非常方便的功能是拆分父表（一个不与另一个表交替的表）的基本负载。</font><font style="vertical-align: inherit;">Spanner自动确定</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拆分是否</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">比其他</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拆分中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">数据读取频率更高的数据</font><font style="vertical-align: inherit;">，并可以决定进一步的拆分。</font><font style="vertical-align: inherit;">因此，请求中可以包含更多节点，这也有效地提高了吞吐量。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载数据中？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
批量数据的Cloud Spanner方法与常规下载相同。</font><font style="vertical-align: inherit;">为了获得最佳性能，您需要遵循一些建议，包括：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按主键对数据进行排序。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将它们除以10 * </font><font style="vertical-align: inherit;">单个节的节</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一组并行加载数据的工作任务。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过此数据下载，将使用所有Cloud Spanner节点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用A YCSB工作负载来生成1000万行的数据集。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4n/-o/nj/4n-onjrzn_2nco-hz8o3vnr42d4.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*负载测试是在n1-standard-32计算引擎（32 vCPU，120 GB内存）上执行的，并且测试实例绝不是测试的瓶颈。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
**不建议将1节点配置用于任何生产负载。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如上所述，Cloud Spanner会根据拆分的负载自动处理拆分，因此在多次连续重复测试之后，结果会有所改善。</font><font style="vertical-align: inherit;">这里介绍的结果是我们收到的最佳结果。</font><font style="vertical-align: inherit;">查看上面的数字，我们可以看到Cloud Spanner如何随着集群中节点数量的增加而扩展（很好）。</font><font style="vertical-align: inherit;">如上所述，突出的数字是极低的平均延迟，与混合工作负载的结果形成对比（读取为95％，写入为5％）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缩放？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一键式任务是增加和减少Cloud Spanner节点的数量。如果要快速加载数据，可以考虑将实例最大化（在我们的示例中，在US-EAST区域中为25个节点），然后在数据库中的所有数据之后减少适合常规加载的节点数注意2 TB /节点的限制。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使数据库较小，我们也被提醒了这一限制。经过几次负载测试后，我们的数据库大小约为155 GB，当缩减为1个节点的实例时，出现以下错误：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_b/ge/bx_bgefdcl_ouf3ldvrdoxglyks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们设法将规模从25个实例减少到2个实例，但被困在两个节点上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以使用REST API自动增加和减少Cloud Spanner集群中的节点数量。</font><font style="vertical-align: inherit;">这对于减少繁忙时间增加的系统负载特别有用。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLAP查询性能？</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初，我们计划为此投入大量时间来评估Spanner。</font><font style="vertical-align: inherit;">经过几次SELECT COUNT之后，我们立即意识到测试会很短，并且Spanner不会成为OLAP引擎。</font><font style="vertical-align: inherit;">无论集群中有多少节点，简单选择10M行表中的行数都需要55至60秒。</font><font style="vertical-align: inherit;">此外，任何需要更多内存来存储中间结果的请求都将失败，并出现OOM错误。</font></font><br>
<br>
<code>SELECT COUNT(DISTINCT(field0)) FROM usertable; — (10M distinct values)-&gt; SpoolingHashAggregateIterator ran out of memory during new row.</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以在Todd Lipcon的文章</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosql-kudu-spanner-slides.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，幻灯片42和43中</font><font style="vertical-align: inherit;">找到一些TPC-H请求的</font><font style="vertical-align: inherit;">数字。这些数字与我们自己的结果一致（不幸的是）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/c2/sh/dic2sh_wvmvfus16nhrbftomm1g.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.我们的发现</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到Cloud Spanner功能的当前状态，很难想象它是现有OLTP解决方案的简单替代，尤其是当您的需求超出需求时。构建考虑到Cloud Spanner缺陷的解决方案将需要花费大量时间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当我们开始评估Cloud Spanner时，我们期望其Spanner的管理功能与其他Google SQL解决方案相同或至少相距不远。但是我们对完全没有备份以及对资源访问的控制非常有限感到惊讶。更不用说缺少视图，缺少本地开发环境，不支持的序列，没有DML和DDL支持的JDBC等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那么，需要扩展事务数据库的人去哪儿了？似乎市场上没有适合所有用例的单一解决方案。有很多封闭式和开放源代码解决方案（本文中提到了其中的一些解决方案），每种解决方案都有其优点和缺点，但是没有一个提供SaaS的99.999％SLA和高度一致性。如果高SLA是您的主要目标，并且您不希望为多个云环境创建自己的解决方案，则Cloud Spanner可能是您正在寻找的解决方案。但是您必须意识到其所有局限性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公平地说，应该指出的是Cloud Spanner并非仅在2017年春季才向公众发布，因此可以合理地预期它的某些缺点最终可能会消失（我希望），并且一旦发生，它就能改变游戏规则。毕竟，Cloud Spanner不仅仅是Google的第三方项目。 Google将其用作其他Google产品的基础。而且，当Google最近用Cloud Spanner取代了Google Cloud Storage中的Megastore时，它允许Google Cloud Storage与全球对象列表严格一致（这仍然不适用于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon的</font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，仍然有希望……我们希望。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样。</font><font style="vertical-align: inherit;">就像文章的作者一样，我们也继续希望，但是您对此有何看法？</font><font style="vertical-align: inherit;">在评论中写下内容，</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邀请每个人访问我们的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免费网络研讨会，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该框架下，我们将详细讨论</font><font style="vertical-align: inherit;">OTUS </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS for Developers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">课程。</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489000/index.html">如何组装一个很酷的mitap：来自三个“ serial mitapers”的16个技巧。Leader-IT活动＃1</a></li>
<li><a href="../zh-CN489002/index.html">分布式轮对注册表：使用Hyperledger Fabric的经验</a></li>
<li><a href="../zh-CN489004/index.html">带有光盘拨号器的手机</a></li>
<li><a href="../zh-CN489008/index.html">使用Hobot框架在复杂的聊天机器人中进行路由</a></li>
<li><a href="../zh-CN489010/index.html">我们与语言学，个性化，peddesign，ML等项目共享俄罗斯最大的在线培训数据层</a></li>
<li><a href="../zh-CN489014/index.html">《完美算法》一书。贪婪算法和动态规划»</a></li>
<li><a href="../zh-CN489016/index.html">德国格里夫·格里夫（German Gref）：“我们试图组织有关AGI的讨论，但没有一个自尊的科学家来参加”</a></li>
<li><a href="../zh-CN489020/index.html">一种恶意研究</a></li>
<li><a href="../zh-CN489022/index.html">将RabbitMQ与MonsterMQ结合使用第2部分</a></li>
<li><a href="../zh-CN489024/index.html">Webix JavaScript库通过初学者的眼光。第5部分。在用户端使用数据</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>