<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíá ü§¥üèæ ü§¥üèª Como causar um vazamento de mem√≥ria em um aplicativo Angular? üë®‚Äçüë®‚Äçüë¶ üôå ‚õìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O desempenho √© a chave para o sucesso de um aplicativo da web. Portanto, os desenvolvedores precisam saber como ocorrem vazamentos de mem√≥ria e como l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como causar um vazamento de mem√≥ria em um aplicativo Angular?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/503312/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O desempenho √© a chave para o sucesso de um aplicativo da web. Portanto, os desenvolvedores precisam saber como ocorrem vazamentos de mem√≥ria e como lidar com eles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse conhecimento √© especialmente importante quando o aplicativo que o desenvolvedor est√° lidando atinge um determinado tamanho. Se voc√™ n√£o prestar aten√ß√£o suficiente aos vazamentos de mem√≥ria, tudo poder√° acabar com o desenvolvedor entrando na "equipe para eliminar vazamentos de mem√≥ria" (eu precisava fazer parte dessa equipe). </font><font style="vertical-align: inherit;">
Vazamentos de mem√≥ria podem ocorrer por v√°rios motivos. No entanto, acredito que ao usar o Angular, voc√™ pode encontrar um padr√£o que corresponda √† causa mais comum de vazamento de mem√≥ria. Existe uma maneira de lidar com esses vazamentos de mem√≥ria. E a melhor coisa, √© claro, n√£o √© combater problemas, mas evit√°-los.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/bg/op/jz/bgopjzk2msaiedpikpoa1qcv2cm.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© gerenciamento de mem√≥ria?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JavaScript usa um sistema de gerenciamento autom√°tico de mem√≥ria. </font><font style="vertical-align: inherit;">O ciclo de vida da mem√≥ria geralmente consiste em tr√™s etapas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aloca√ß√£o de mem√≥ria necess√°ria.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhe com mem√≥ria alocada, executando opera√ß√µes de leitura e grava√ß√£o.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liberar mem√≥ria depois que ela n√£o √© mais necess√°ria.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MDN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diz que o gerenciamento autom√°tico de mem√≥ria - √© uma fonte potencial de confus√£o. </font><font style="vertical-align: inherit;">Isso pode dar aos desenvolvedores uma falsa sensa√ß√£o de que eles n√£o precisam se preocupar com o gerenciamento de mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ n√£o se importa com o gerenciamento de mem√≥ria, isso significa que, depois que o aplicativo crescer para um determinado tamanho, √© poss√≠vel que haja um vazamento de mem√≥ria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, os vazamentos de mem√≥ria podem ser considerados como a mem√≥ria alocada para o aplicativo, da qual ele n√£o precisa mais, mas n√£o √© liberado. </font><font style="vertical-align: inherit;">Em outras palavras, esses s√£o objetos que falharam ao passar pelas opera√ß√µes de coleta de lixo.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona a coleta de lixo?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o procedimento de coleta de lixo, que √© bastante l√≥gico, tudo o que pode ser considerado "lixo" √© limpo. </font><font style="vertical-align: inherit;">O coletor de lixo limpa a mem√≥ria que o aplicativo n√£o precisa mais. </font><font style="vertical-align: inherit;">Para descobrir de que √°reas da mem√≥ria o aplicativo ainda precisa, o coletor de lixo usa o algoritmo ‚Äúmarcar e varrer‚Äù (algoritmo de marca√ß√£o). </font><font style="vertical-align: inherit;">Como o nome indica, esse algoritmo consiste em duas fases - a fase de marca√ß√£o e a fase de varredura.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Fase de sinaliza√ß√£o</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objetos e links para eles s√£o apresentados na forma de uma √°rvore. </font><font style="vertical-align: inherit;">A raiz da √°rvore √©, na figura a seguir, um n√≥ </font></font><code>root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em JavaScript, este √© um objeto </font></font><code>window</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cada objeto tem uma bandeira especial. </font><font style="vertical-align: inherit;">Vamos nomear essa bandeira </font></font><code>marked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Na fase de sinaliza√ß√£o, primeiro de tudo, todos os sinalizadores </font></font><code>marked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o configurados para um valor </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/433/436/b8a/433436b8a72bc7a207bd66c5b76788f5.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No in√≠cio, os sinalizadores dos objetos marcados s√£o definidos como false e, em</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
seguida, a √°rvore de objetos √© percorrida. </font><font style="vertical-align: inherit;">Todas as bandeiras de</font></font><code>marked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objetos acess√≠veis a partir do n√≥</font></font><code>root</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° definido para</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">E as bandeiras desses objetos que n√£o podem ser alcan√ßados permanecem no valor</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um objeto √© considerado inacess√≠vel se n√£o puder ser alcan√ßado a partir do objeto raiz.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cf/d14/a50/1cfd14a50f9be4e7aa402052982eb253.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetos alcan√ß√°veis ‚Äã‚Äãs√£o marcados como marcado = true, objetos inacess√≠veis como marcado = false</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como resultado, todos os sinalizadores de</font></font><code>marked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objetos inacess√≠veis permanecem no valor</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A mem√≥ria ainda n√£o foi liberada, mas, ap√≥s a conclus√£o da fase de marca√ß√£o, tudo est√° pronto para a fase de limpeza.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fase de limpeza</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mem√≥ria √© limpa precisamente nesta fase do algoritmo. Aqui, todos os objetos inacess√≠veis (aqueles cujo sinalizador </font></font><code>marked</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permanece no valor </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) s√£o destru√≠dos pelo coletor de lixo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a0/75f/f16/8a075ff162428195665afe583a85151f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Årvore de objetos ap√≥s a coleta de lixo. </font><font style="vertical-align: inherit;">Todos os objetos cujo sinalizador marcado est√° definido como false s√£o destru√≠dos pelo coletor de</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
lixo.A coleta de lixo √© executada periodicamente enquanto o programa JavaScript est√° em execu√ß√£o. </font><font style="vertical-align: inherit;">Durante esse procedimento, √© liberada mem√≥ria que pode ser liberada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez a seguinte pergunta surja aqui: ‚ÄúSe o coletor de lixo remover todos os objetos marcados como inacess√≠veis - como criar um vazamento de mem√≥ria?‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ponto aqui √© que o objeto n√£o ser√° processado pelo coletor de lixo se o aplicativo n√£o precisar, mas voc√™ ainda poder√° alcan√ß√°-lo no n√≥ raiz da √°rvore de objetos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O algoritmo n√£o pode saber se o aplicativo usar√° algum peda√ßo de mem√≥ria que pode acessar ou n√£o. </font><font style="vertical-align: inherit;">Somente um programador tem esse conhecimento.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vazamentos de mem√≥ria angular</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria das vezes, vazamentos de mem√≥ria ocorrem ao longo do tempo quando um componente √© repetido repetidamente. </font><font style="vertical-align: inherit;">Por exemplo - por meio de roteamento ou como resultado do uso da diretiva </font></font><code>*ngIf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Digamos, em uma situa√ß√£o em que algum usu√°rio avan√ßado trabalhe com o aplicativo o dia inteiro sem atualizar a p√°gina do aplicativo no navegador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para reproduzir esse cen√°rio, criaremos uma constru√ß√£o de dois componentes. </font><font style="vertical-align: inherit;">Estes ser√£o os componentes </font></font><code>AppComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>SubComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;<span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
&nbsp;&nbsp;<span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;app-sub *ngIf="hide"&gt;&lt;/app-sub&gt;`</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> </span>{<font></font>
&nbsp;&nbsp;hide = <span class="hljs-literal">false</span>;<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.hide = !<span class="hljs-keyword">this</span>.hide, <span class="hljs-number">50</span>);<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O modelo </font></font><code>AppComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do componente usa o componente </font></font><code>app-sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O mais interessante aqui √© que nosso componente usa uma fun√ß√£o </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que alterna o sinalizador a </font></font><code>hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cada 50 ms. Isso resulta em um componente sendo renderizado novamente a cada 50 ms </font></font><code>app-sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ou seja, a cria√ß√£o de novas inst√¢ncias da classe √© realizada </font></font><code>SubComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esse c√≥digo imita o comportamento de um usu√°rio que trabalha o dia inteiro com um aplicativo Web sem atualizar uma p√°gina em um navegador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s, em </font></font><code>SubComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, implementaram diferentes cen√°rios, em cuja utiliza√ß√£o, ao longo do tempo, as mudan√ßas na quantidade de mem√≥ria usada pelo aplicativo come√ßam a aparecer. Observe que o componente</font></font><code>AppComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sempre permanece o mesmo. </font><font style="vertical-align: inherit;">Em cada cen√°rio, descobriremos se estamos lidando com um vazamento de mem√≥ria analisando o consumo de mem√≥ria do processo do navegador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o consumo de mem√≥ria do processo aumentar com o tempo, isso significa que estamos diante de um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Se um processo usa uma quantidade mais ou menos constante de mem√≥ria, isso significa que n√£o h√° vazamento de mem√≥ria ou que o vazamento, embora presente, n√£o se manifesta de maneira bastante √≥bvia.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Cen√°rio 1: enorme para loop</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso primeiro cen√°rio √© representado por um loop que √© executado 100.000 vezes. </font><font style="vertical-align: inherit;">No loop, valores aleat√≥rios s√£o adicionados √† matriz. </font><font style="vertical-align: inherit;">N√£o devemos esquecer que o componente √© renderizado novamente a cada 50 ms. </font><font style="vertical-align: inherit;">D√™ uma olhada no c√≥digo e pense se criamos um vazamento de mem√≥ria ou n√£o.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> </span>{<font></font>
&nbsp;&nbsp;arr = [];<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.arr.push(<span class="hljs-built_in">Math</span>.random());<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora esse c√≥digo n√£o deva ser enviado para produ√ß√£o, ele n√£o cria um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Nomeadamente, o consumo de mem√≥ria n√£o excede o intervalo limitado a um valor de 15 MB. </font><font style="vertical-align: inherit;">Como resultado, n√£o h√° vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Abaixo falaremos sobre por que isso √© assim.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Cen√°rio 2: Assinatura BehaviorSubject</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse cen√°rio, assinamos </font></font><code>BehaviorSubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e atribu√≠mos um valor a uma constante. </font><font style="vertical-align: inherit;">H√° um vazamento de mem√≥ria nesse c√≥digo? </font><font style="vertical-align: inherit;">Como antes, n√£o esque√ßa que o componente √© renderizado a cada 50 ms.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> </span>{<font></font>
&nbsp;&nbsp;subject = <span class="hljs-keyword">new</span> BehaviorSubject(<span class="hljs-number">42</span>);<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.subject.subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> foo = value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, como no exemplo anterior, n√£o h√° vazamento de mem√≥ria.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 Cen√°rio 3: atribuindo um valor a um campo de classe dentro de uma assinatura</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, quase o mesmo c√≥digo √© apresentado como no exemplo anterior. </font><font style="vertical-align: inherit;">A principal diferen√ßa √© que o valor √© atribu√≠do n√£o a uma constante, mas a um campo de classe. </font><font style="vertical-align: inherit;">E agora, voc√™ acha que h√° um vazamento no c√≥digo?</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> </span>{<font></font>
&nbsp;&nbsp;subject = <span class="hljs-keyword">new</span> BehaviorSubject(<span class="hljs-number">42</span>);<font></font>
&nbsp;&nbsp;randomValue = <span class="hljs-number">0</span>;<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.subject.subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.randomValue = value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ acredita que n√£o h√° vazamento aqui - est√° absolutamente certo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No cen√°rio # 1, n√£o h√° assinatura. </font><font style="vertical-align: inherit;">Nos cen√°rios 2 e 3, assinamos o fluxo do objeto observado inicializado em nosso componente. </font><font style="vertical-align: inherit;">Parece que estamos seguros assinando fluxos de componentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas e se adicionarmos servi√ßo ao nosso esquema?</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cen√°rios que usam o servi√ßo</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos cen√°rios a seguir, revisaremos os exemplos acima, mas desta vez assinaremos o fluxo fornecido pelo servi√ßo </font></font><code>DummyService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Aqui est√° o c√≥digo de servi√ßo.</font></font><br>
<br>
<pre><code class="javascript hljs">@Injectable({
&nbsp;&nbsp;<span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DummyService</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;some$ = <span class="hljs-keyword">new</span> BehaviorSubject&lt;number&gt;(<span class="hljs-number">42</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de n√≥s √© um servi√ßo simples. </font><font style="vertical-align: inherit;">Este √© apenas um servi√ßo que fornece stream ( </font></font><code>some$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) na forma de um campo de classe p√∫blica.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Cen√°rio 4: assinando um fluxo e atribuindo um valor a uma constante local</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos recriar aqui o mesmo esquema que j√° foi descrito anteriormente. </font><font style="vertical-align: inherit;">Mas desta vez, assinamos o fluxo </font></font><code>some$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>DummyService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e n√£o o campo do componente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe um vazamento de mem√≥ria? </font><font style="vertical-align: inherit;">Novamente, ao responder a essa pergunta, lembre-se de que o componente √© usado </font></font><code>AppComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e renderizado v√°rias vezes.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> </span>{<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(private dummyService: DummyService) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.dummyService.some$.subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> foo = value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora finalmente criamos um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Mas este √© um pequeno vazamento. </font><font style="vertical-align: inherit;">Por "pequeno vazamento", quero dizer um que, com o tempo, leva a um lento aumento na quantidade de mem√≥ria consumida. </font><font style="vertical-align: inherit;">Esse aumento √© quase impercept√≠vel, mas uma inspe√ß√£o superficial do instant√¢neo da pilha mostrou a presen√ßa de muitas c√≥pias n√£o recuperadas </font></font><code>Subscriber</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 Cen√°rio 5: assinando um servi√ßo e atribuindo um valor a um campo de classe</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui assinamos novamente </font></font><code>dummyService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas desta vez atribu√≠mos o valor resultante ao campo da classe, e n√£o uma constante local.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> </span>{<font></font>
&nbsp;&nbsp;randomValue = <span class="hljs-number">0</span>;<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(private dummyService: DummyService) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.dummyService.some$.subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.randomValue = value;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui finalmente criamos um vazamento de mem√≥ria significativo. </font><font style="vertical-align: inherit;">O consumo de mem√≥ria rapidamente, em um minuto, excedeu 1 GB. </font><font style="vertical-align: inherit;">Vamos falar sobre por que isso √© assim.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OccurQuando ocorreu um vazamento de mem√≥ria?</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ deve ter notado que nos tr√™s primeiros cen√°rios n√£o conseguimos criar um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Esses tr√™s cen√°rios t√™m algo em comum: todos os links s√£o locais para o componente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando assinamos um objeto observ√°vel, ele armazena uma lista de assinantes. </font><font style="vertical-align: inherit;">Nosso retorno de chamada tamb√©m est√° nesta lista, e o retorno de chamada pode se referir ao nosso componente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/49f/92e/bda49f92eb184ad1eb78231a4144b71c.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem vazamento de mem√≥ria</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando um componente √© destru√≠do, ou seja, quando o Angular n√£o possui mais um link, o que significa que o componente n√£o pode ser acessado a partir do n√≥ raiz, o objeto observado e sua lista de assinantes tamb√©m n√£o podem ser alcan√ßados a partir do n√≥ raiz. Como resultado, todo o objeto do componente √© coletado como lixo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enquanto estivermos inscritos em um objeto observ√°vel, cujos links est√£o apenas dentro do componente, n√£o haver√° problemas. Mas quando o servi√ßo entra em a√ß√£o, a situa√ß√£o muda.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/454/6f7/b5b/4546f7b5b2ab2d2858f550740243189e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vazamento de mem√≥ria</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Assim que assinamos um objeto observ√°vel fornecido por um servi√ßo ou outra classe, criamos um vazamento de mem√≥ria. </font><font style="vertical-align: inherit;">Isso ocorre devido ao objeto observado, devido √† sua lista de assinantes. </font><font style="vertical-align: inherit;">Por esse motivo, o retorno de chamada e, portanto, o componente, s√£o acess√≠veis no n√≥ raiz, embora o Angular n√£o tenha uma refer√™ncia direta ao componente. </font><font style="vertical-align: inherit;">Como resultado, o coletor de lixo n√£o toca no objeto correspondente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou esclarecer: voc√™ pode usar essas constru√ß√µes, mas precisa trabalhar com elas corretamente, e n√£o como n√≥s.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalho de assinatura adequado</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar vazamento de mem√≥ria, √© importante cancelar a inscri√ß√£o corretamente do objeto observado, fazendo isso quando a assinatura n√£o for mais necess√°ria. Por exemplo, quando um componente √© destru√≠do. Existem v√°rias maneiras de cancelar a inscri√ß√£o de um objeto observado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A experi√™ncia de aconselhar propriet√°rios de grandes projetos corporativos indica que, nessa situa√ß√£o, √© melhor usar a entidade </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criada pela equipe </font></font><code>new Subject&lt;void&gt;()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em combina√ß√£o com o operador </font></font><code>takeUntil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
&nbsp;&nbsp;<span class="hljs-attr">selector</span>:<span class="hljs-string">'app-sub'</span>,
&nbsp;&nbsp;<span class="hljs-comment">// ...</span><font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnDestroy</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;private destroy$: Subject&lt;<span class="hljs-keyword">void</span>&gt; = <span class="hljs-keyword">new</span> Subject&lt;<span class="hljs-keyword">void</span>&gt;();<font></font>
&nbsp;&nbsp;randomNumber = <span class="hljs-number">0</span>;<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(private dummyService: DummyService) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dummyService.some$.pipe(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;takeUntil(<span class="hljs-keyword">this</span>.destroy$)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).subscribe(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-keyword">this</span>.randomNumber = value);<font></font>
&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;ngOnDestroy(): <span class="hljs-keyword">void</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.destroy$.next();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.destroy$.complete();<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, cancelamos a assinatura da assinatura usando o </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">operador e </font></font><code>takeUntil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap√≥s a destrui√ß√£o do componente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementamos um gancho de ciclo de vida no componente </font></font><code>ngOnDestroy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Toda vez que um componente √© destru√≠do, chamamos </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todos </font></font><code>next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>complete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A chamada √© </font></font><code>complete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito importante porque esta limpa a assinatura de </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, usamos o operador </font></font><code>takeUntil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e transmitimos a ele nosso fluxo </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso garante que a assinatura seja limpa (ou seja, cancelamos a inscri√ß√£o na assinatura) ap√≥s a destrui√ß√£o do componente.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como se lembrar de limpar assinaturas?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â f√°cil esquecer de adicionar o componente </font></font><code>destroy$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e de ligar </font></font><code>next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>complete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no ciclo de vida do Hook </font></font><code>ngOnDestroy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mesmo apesar de ter ensinado isso √†s equipes que trabalham em projetos, muitas vezes eu me esqueci disso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, existe uma regra maravilhosa de linter, que faz parte de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto de regras</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que permite garantir a desinscri√ß√£o adequada das assinaturas. </font><font style="vertical-align: inherit;">Voc√™ pode definir um conjunto de regras como este:</font></font><br>
<br>
<pre><code class="javascript hljs">npm install @angular-extensions/lint-rules --save-dev
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, ele deve estar conectado a </font></font><code>tslint.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs">{
&nbsp;&nbsp;<span class="hljs-string">"extends"</span>: [
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"tslint:recommended"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"@angular-extensions/lint-rules"</span><font></font>
&nbsp;&nbsp;]<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu recomendo que voc√™ use esse conjunto de regras em seus projetos. </font><font style="vertical-align: inherit;">Isso poupar√° muitas horas de depura√ß√£o na localiza√ß√£o de fontes de vazamento de mem√≥ria.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No Angular, √© muito f√°cil criar uma situa√ß√£o que leva a vazamentos de mem√≥ria. </font><font style="vertical-align: inherit;">Mesmo pequenas altera√ß√µes de c√≥digo em locais que, aparentemente, n√£o devem estar relacionados a vazamentos de mem√≥ria, podem levar a s√©rias conseq√º√™ncias adversas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A melhor maneira de evitar vazamentos de mem√≥ria √© gerenciar suas assinaturas corretamente. </font><font style="vertical-align: inherit;">Infelizmente, a opera√ß√£o de limpeza de assinaturas requer grande precis√£o do desenvolvedor. </font><font style="vertical-align: inherit;">Isso √© f√°cil de esquecer. </font><font style="vertical-align: inherit;">Portanto, √© recomend√°vel que voc√™ aplique regras </font></font><code>@angular-extensions/lint-rules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que ajudem a organizar o funcionamento adequado das assinaturas. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reposit√≥rio com o c√≥digo subjacente a este material. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ encontrou vazamentos de mem√≥ria em aplicativos Angular?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503288/index.html">Como pesquisamos candidatos usando o aprendizado de m√°quina</a></li>
<li><a href="../pt503290/index.html">Revis√£o do quadrocopter industrial DJI Matrice 300 RTK</a></li>
<li><a href="../pt503300/index.html">O livro ‚ÄúRick e Morty. Guia para o desenho mais brilhante de todas as gal√°xias ¬ª</a></li>
<li><a href="../pt503302/index.html">Acelerando a cria√ß√£o de um projeto no CMake + GCC: pr√©-compila√ß√£o de arquivos de cabe√ßalho</a></li>
<li><a href="../pt503310/index.html">O que pensam os programadores seniores?</a></li>
<li><a href="../pt503318/index.html">Profiss√£o: Programador. Nem tudo est√° claro</a></li>
<li><a href="../pt503322/index.html">Desenvolvimento de Firmware: Introdu√ß√£o</a></li>
<li><a href="../pt503324/index.html">‚ÄúNo auge‚Äù de Brad Stalberg e Steve Magness: preven√ß√£o de combust√£o espont√¢nea (parte um)</a></li>
<li><a href="../pt503328/index.html">Compilamos o aplicativo Spring Boot em nativo usando o GraalVM</a></li>
<li><a href="../pt503330/index.html">Como aprender com um cientista de dados: as habilidades t√©cnicas mais procuradas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>