<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈚️ 👨🏼‍🔬 ⏭️ LCDスクリーンをブレッドボードLPCXpresso55S69に接続します 😄 ☪️ 👩🏻‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="オールハードウェアプロジェクトの一環として、NXP社のLPC55S69-EVKブレッドボードの画面での作業をマスターする機会がありました。状況の特徴は、このボードが画面なしで標準装備されていることです。そのため、この作品の開発には、私たちの地域で到達できる画面の検索とその接続も含まれていました。
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>LCDスクリーンをブレッドボードLPCXpresso55S69に接続します</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504322/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オールハードウェアプロジェクトの一環として、NXP社のLPC55S69-EVKブレッドボードの画面での作業をマスターする機会がありました。</font><font style="vertical-align: inherit;">状況の特徴は、このボードが画面なしで標準装備されていることです。そのため、この作品の開発には、私たちの地域で到達できる画面の検索とその接続も含まれていました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/os/nm/bk/osnmbkcbpwtomkhj_0wmx3xtcn4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の第2部では、実際に自分の偉業を繰り返すために実行する必要があるアクションについて説明します。</font><font style="vertical-align: inherit;">しかし、最初に、私は仕事の間に沸騰しているすべてを表現します。</font><font style="vertical-align: inherit;">確かに、上記のすべては私の個人的な意見であり、多くの場合、当社の経営陣の意見と一致しません。</font><font style="vertical-align: inherit;">しかし、これらすべてを個人的に経験したソフトウェアエンジニアは、彼自身の意見を持っているかもしれません...そして、ここにあります。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1。</font><font style="vertical-align: inherit;">調査</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設計および回路機能</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そう。一般的に、見た目はすべてかなりきれいに見えるはずです。ブレッドボードには、Arduino Unoと互換性のあるコネクタがあります。また、面白くしています。実際には、2列のコネクタです。 Arduino Unoでは、内側の行のみが互換性があります。外部のものはそれ自体です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/e9/ti/yme9tisxyf1wupqhrjzwvrd6n4k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が簡単でしょうか？ Arduinoと互換性のあるディスプレイを見てみましょう。ボードに置いて、githubにワゴンと小さなカートがあるライブラリを使用します。もちろん、適切なディスプレイを用意しました。ここにそのコネクタがあります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t3/hs/vx/t3hsvxdwirmuu0ujlkgrujpjibg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの2つのボード上のデータバスのD0およびD1接点の位置が一致していないのは、恥ずかしいことです。しかし、それが唯一の問題だったとしたら！もちろん、実際の作業では、対応するバスに接続されているコントローラーポートの種類を理解する必要があります。今、私たちはブレッドボードの説明を取ります...ああ！また、メーカーのウェブサイトのブレッドボードの説明を取得するには、登録する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
想像してみてください。あなたは、新製品の機器を選択するタスクを与えられたエンジニアです。お気に入りの検索エンジンにログインしています。そして彼はあなたに開いているものをあなたに与えました。そして、あなたは与えられたものから選択しました...特別に登録して、閉じた弓を意図的に精練しますか？わたしは・・・しないだろう。では、なぜこのブレッドボードモデルについて書いているのですか？経営陣が、幅広い製品が重要なプロジェクトに特定のボードを導入することを許可したと言います。そして、サポートされている命名法を拡張するために特別に購入されたので、彼らは私にこの手数料を与えました。そうでなければ、私は彼女を見つけられなかっただろう。登録せずにいろいろなことがあるので、もう一度どこかに登録するのは好きではありません！</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とにかく。実際、必要なドキュメントは販売者からダウンロードできます。同じマウサー。開けて…いや。これを説明する必要があります。コネクタのピン配列を説明する表はありません。しかし、図面があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/xq/tf/mrxqtfikg-q9hfkf5bjcq4ydqnw.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポートPIO1_9とPIO1_10について特に不満はないとします。しかし、どのようなコントローラポートがそのようなLED_RED_ARD以降であり、すべての色でそれを超えていますか？さて、そしてこの種の他の多くの脚。ドキュメントの作成者は、なぜこれを行っているのか完全に理解していなかったようです。したがって、回路から回路名を単にコピーしました。これらのチェーンはなぜですか？チェーンの名前は、回路の作成者からの抽象化であり、それ以上のものではありません。対応するコントローラーレッグの名前が必要です！誰もが知っています。ドキュメントの作成者に加えて。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レイアウトスキームを探しています。説明とは異なり、回路はメーカー以外ではダウンロードできません。そして、メーカーはくしゃみごとに登録を要求します。一般的に、Shilohのガイドが欠かすことのできなかった時代を思い出します。ささいなロジックがプログラム可能なロジックに置き換えられたので、彼が役に立たなかったときに私はすでにそれを手に入れました。しかし、子供の頃に受けた心理的トラウマは、人々がそれらを古本屋に連れて行き始めたときに私をそれに連れて行きました。また、クローゼットのある場所を定期的に掃除しているにもかかわらず、同じ怪我のためにこのボリュームを捨てることができなくなっています。しかし、そのような状況にあった国の電子産業は、銅の盆地で覆われていました。または、NXPエンジニアも同じことを夢見ていますか？ブレッドボードのレイアウトの秘密は何ですか？なぜ彼女は登録なしでは会えないのですか？中国人は盗みますか？したがって、ビジネスはコントローラーを販売しています！ブレッドボードを所有するエンジニアが増えるほど、コントローラーが製品に入り、産業規模で購入される可能性が高くなります。理解できません！でも続けましょう……。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常のパラレルデータバスは、2つの異なるGPIOポートの異なる非連続ビットに分散していることがわかりました。これが、必要な連絡先に自分用のベビーベッドを作成する方法です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ks/w5/ww/ksw5wwi8_wfylwbi1crep7apzla.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は2017年に執筆された長い記事がありますが、まだ光を見ていません。そこで、コンスタンティンチゾフのmcucppライブラリの原則を検討します。そこで、コンパイラーは、連続するビット、ブレーク、異なるポートの2つのニブルに対してアセンブラーコードを最適に構築する方法を検討します。その後、回路設計者がそれを実行しないという言葉で停止します。しかし、その記事は私の業績に関するものではありません...私のチェックはただあります。したがって、彼らは私にその出版のための青信号を与えませんでした。たぶん、それは経営者にそれを置く価値があると納得させるコメントで... ...しかし、それにもかかわらず。私が書いたとき、データバスのビットをそれほど巧妙に分散させる回路がまだあるとは想像もできませんでした。 Sportlotoボールミキシング装置が同じようにできるのは事実ではありません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それだけではありません！</font><font style="vertical-align: inherit;">上記のように、LEDラインはデータバスの3ビットに掛かっています。</font><font style="vertical-align: inherit;">パラレルバスでの作業中にディスコがあったのでしょう。</font><font style="vertical-align: inherit;">コネクタの他の列に吊るすことができないのはなぜですか？</font><font style="vertical-align: inherit;">コネクタの幅がArduino部品の2倍であることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のすべては、スクリーン印刷でなければ、とは言えません。</font><font style="vertical-align: inherit;">ボードは、パラレルバスでマークされたシルクスクリーンです。</font><font style="vertical-align: inherit;">そのようなバスがあると思ったのは私ではなく、これはデザイナーが指摘したものです...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェアサポート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、ソフトウェアサポートに移りましょう。ここではすべてがはるかに優れています。 BSPには、2つのライブラリが同時に含まれています（有名なemWinのバイナリコードとlittlevglのソースコード）。これらのライブラリには、アプリケーション例が付属しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All-Hardwareサービスは、プログラマーがこの機器を購入せずに機器を使った作業を感じられるようにするために作成されました。もちろん、プログラマは通常のライブラリとサンプルを使用することをお勧めします。ある種のライブラリを介して画面を操作することを申し出た場合、ユーザーは、前のセクションでハードウェア開発者について述べたのとほぼ同じように私について語ります。既製のソリューションでホイールを再発明する必要はありません！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし問題は、すべての</font><b><font style="vertical-align: inherit;">ターンキー</font></b><font style="vertical-align: inherit;">ソリューションが</font><b><font style="vertical-align: inherit;">Adafruit TFT LCDシールドw /キャップタッチ</font></b><font style="vertical-align: inherit;">ディスプレイ用に設計されていることです。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">SPIポート経由で接続されています（タッチスクリーンはまだ検討されていません。リモートでプッシュしないでください）。</font><font style="vertical-align: inherit;">つまり、パラレルバスでの表示は良好ですが、良好ではありません。</font><font style="vertical-align: inherit;">実装が難しいだけでなく、BSPパッケージの既製のソフトウェアソリューションと完全に互換性がなくなります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面を選択</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の地域で</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adafruit TFT LCDシールド（キャップ​​タッチ付き）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
をすぐに手に入れ</font><font style="vertical-align: inherit;">ましたが、見つかりませんでした。しかし、それはよりトリッキーでした。 Yandex Marketsに、ILA9341コントローラー（Adafrutovskyなど）とSPIインターフェイスを備えたディスプレイを要求しました。大きなリストが発行されました。 Arduino用コネクターとSPIインターフェースを備えたオプションのみがリストにありました。多くのオプションは短いSPIコネクタを使用していましたが、構造上、何かを囲うよりも既製のコネクタを取り付ける方が簡単です。さて、注文しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はクラスノヤルスク自体から旅行していた。配達はアパートへのSDEKでした、それは自己分離の状態で非常に役に立ちます。彼は予定よりも1日早く到着しました...そしてパッケージの中には、記事の冒頭の写真で示したのとまったく同じディスプレイがありました。パラレルバス付き。したがって、その後の人々を信頼してください！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの締め切りはまだ限られているはずなので、注文を実験するのではなく、利用可能なSPIバスから何かを取得することにしました。</font><font style="vertical-align: inherit;">そして、Raspberry Piの会社であるWaveShareからの展示がありました。</font><font style="vertical-align: inherit;">一般的に、彼には彼自身の尊厳があります-彼は広まっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、WaveShareはArduinoコネクタを備えたSPIディスプレイも製造していることが後で明らかになりましたが、それらの接点はAdafrutovskieと完全には互換性がありません。</font><font style="vertical-align: inherit;">C / D信号は他のレッグにあり、Reset_nレッグがあります。</font><font style="vertical-align: inherit;">ただし、Ali Expressでは多くの販売者から入手できます。</font><font style="vertical-align: inherit;">誰かが自分でディスプレイを探している場合-覚えておいてください。</font><font style="vertical-align: inherit;">しかし、Ali Expressでの配信を待つ時間はなかったので、Raspberry Piのディスプレイでの作業はさらに進みます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二部。</font><font style="vertical-align: inherit;">入門</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ0：機器を接続する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オールハードウェアサービスのユーザーの場合は、この手順をスキップできます。</font><font style="vertical-align: inherit;">すべてはすでに私たちの側で行われています。</font><font style="vertical-align: inherit;">しかし、あなたが家でボードを接続するならば、私はそれをする方法をあなたに話している。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/er/sc/-m/ersc-mjduhvdz4jdijahs-rsjki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラマーになってよかった！</font><font style="vertical-align: inherit;">ワイヤーを巻いて、デザイナーが面倒を見ました。</font><font style="vertical-align: inherit;">私の机では、切り替えの結果は次のようになりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/n6/af/pnn6afmekj7urblksunbehmod0g.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順1：タッチスクリーン操作をオフにする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そう。</font><font style="vertical-align: inherit;">MCUXpresso IDEに入り、[ファイル]-&gt; [新規]-&gt; [SDKサンプルのインポート]を選択します。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/lx/7e/vi/lx7eviqzhtd9dvevpssexfrwliw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ボードを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sv/ob/1g/svob1gyurn99jdcxav9smqk1vja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレゼンテーションの便宜上、litegl_example-&gt; litegl_demoプロジェクトを選択します。</font><font style="vertical-align: inherit;">その上で、ステップ3の問題を表示する方が簡単です。しかし、一般的には、もちろん、実際にはlittlegl_terminalを選択することもできます-実験の方が簡単です。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/iu/42/qe/iu42qe3tf60yhvat6cqbacz9pcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
収集、実行...動作しません。</font><font style="vertical-align: inherit;">これは正常です。</font><font style="vertical-align: inherit;">タッチスクリーンを開こうとすると、致命的なエラーが表示されます。</font><font style="vertical-align: inherit;">また、タッチスクリーンは、Adafrutovボードで使用されているものとは異なります。</font><font style="vertical-align: inherit;">この記事では、タッチスクリーンのサポートを削除するだけです。</font><font style="vertical-align: inherit;">少なくともAll-Hardwareプロジェクトの場合、対処する目標はありませんでしたが、純粋に人間的でした。NXP製品と友達にならなかったことはおそらくすでに明らかです。</font><font style="vertical-align: inherit;">オープンなものがもっと好きです。</font><font style="vertical-align: inherit;">したがって、私は彼と一緒に仕事を習得しませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、歌詞は少なくなります！</font><font style="vertical-align: inherit;">これが、プログラムのクラッシュに直接つながる場所です。このプログラム</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lz/og/pt/lzogptf2ivqp7efs-xkys7aro3w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
が呼び出されないようにするには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppTask（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数から一般的なタッチスクリーン初期化呼び出しを削除します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下のスクリーンショットでは、対応する呼び出しがコメント化されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/hj/1l/nvhj1lwtgpjktevsyedjyxsxo6o.png"> <br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ2：初期化を置き換える</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のプログラムを実行します。</font><font style="vertical-align: inherit;">エラーでクラッシュすることはなくなりましたが、画面には何も表示されません。</font><font style="vertical-align: inherit;">このライブラリはILI9341スクリーンコントローラ用に設計されていますが、実際には、私が理解しているように、ILI9488（またはそれと互換性があります）のコストがかかります。</font><font style="vertical-align: inherit;">これらのコントローラーは一連のコマンドでかなり接近していますが、それらの初期化プロセスは多少異なります。</font><font style="vertical-align: inherit;">次に</font><font style="vertical-align: inherit;">、ファイル</font><b><font style="vertical-align: inherit;">fsl_ili9341.cの</font></b><font style="vertical-align: inherit;">関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT9341_Init（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を編集</font><font style="vertical-align: inherit;">します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初は次のようになっています（ファイルツリーでも移動できるようにスクリーンショットを提供しています）：</font><font style="vertical-align: inherit;">
彼女の体を完全に削除します。</font><font style="vertical-align: inherit;">代わりに、次のコードを入力します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/8e/ma/ye8emavfzimth2lupdywj96ebhq.png"> <br>
<br><font style="vertical-align: inherit;"></font><br>
<pre><code class="plaintext hljs">static const uint8_t ILI9488_regValues[] = {<font></font>
<font></font>
      0x01, 0,<font></font>
      0xB1,  1, 0xA0,<font></font>
      0xB4,  1, 0x02,<font></font>
      0xC0,  2, 0x17, 0x15,<font></font>
      0xC1,  1, 0x41,<font></font>
      0xC5,  3, 0x00, 0x0A, 0x80,<font></font>
      0x36,  1, 0x48,<font></font>
      0x3A,  1, 0x55,<font></font>
      0xE9,  1, 0x00,<font></font>
      0xF7,  4, 0xA9 ,0x51, 0x2C, 0x82,<font></font>
      0x11,  0,<font></font>
      TFTLCD_DELAY, 120,<font></font>
      0x29,  0,<font></font>
    // */<font></font>
    };<font></font>
    SDK_DelayAtLeastUs(ILI9341_RESET_CANCEL_MS * 1000U, SDK_DEVICE_MAXIMUM_CPU_CLOCK_FREQUENCY);<font></font>
    int i = 0;<font></font>
    while(i &lt; sizeof(ILI9488_regValues))<font></font>
    {<font></font>
       uint8_t r = ILI9488_regValues[i++];<font></font>
       uint8_t len = ILI9488_regValues[i++];<font></font>
       uint8_t d;<font></font>
       if(r == TFTLCD_DELAY) <font></font>
       {<font></font>
          SDK_DelayAtLeastUs(len * 1000U, SDK_DEVICE_MAXIMUM_CPU_CLOCK_FREQUENCY);<font></font>
       } else <font></font>
       {<font></font>
          writeCommand(r);<font></font>
          for (d=0; d&lt;len; d++) <font></font>
          {<font></font>
               writeData(ILI9488_regValues[i++]);<font></font>
          }<font></font>
       }<font></font>
     }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを機能させるには、</font><font style="vertical-align: inherit;">次の宣言を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fsl_ili9341.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダーファイルに追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<pre><code class="plaintext hljs">#define ILI9488_NOP 0x00<font></font>
#define ILI9488_SOFT_RESET 0x01<font></font>
#define ILI9488_READ_ID 0x04<font></font>
#define ILI9488_READ_NUM_DSI_ERR 0x05<font></font>
#define ILI9488_READ_STATUS 0x00<font></font>
#define ILI9488_READ_PWR_MODE 0x0A<font></font>
#define ILI9488_READ_MADCTL 0x0B<font></font>
#define ILI9488_READ_PIXEL_FMT 0x0C<font></font>
#define ILI9488_READ_IMG_MODE 0x0D<font></font>
#define ILI9488_READ_SIGNAL_MODE 0x0E<font></font>
#define ILI9488_READ_SELF_DIAG_RES 0x0F<font></font>
#define ILI9488_SLEEP_IN 0x10<font></font>
#define ILI9488_SLEEP_OUT 0x11<font></font>
#define ILI9488_PARTIAL_MODE_ON 0x12<font></font>
#define ILI9488_NORMAL_MODE_ON 0x13<font></font>
#define ILI9488_INVERSION_OFF 0x20<font></font>
#define ILI9488_INVERSION_ON 0x21<font></font>
#define ILI9488_ALL_PIXEL_OFF 0x22<font></font>
#define ILI9488_ALL_PIXEL_ON 0x23<font></font>
#define ILI9488_OFF 0x28<font></font>
#define ILI9488_ON 0x29<font></font>
#define ILI9488_COL_ADDR_SET 0x2A<font></font>
#define ILI9488_PAGE_ADDR_SET 0x2B<font></font>
#define ILI9488_MEM_WRITE 0x2C<font></font>
#define ILI9488_MEM_READ 0x2E<font></font>
#define ILI9488_PARTIAL_AREA 0x30<font></font>
#define ILI9488_VSCROLL_DEF 0x33<font></font>
#define ILI9488_TEARING_EFFECT_LINE_OFF 0x34<font></font>
#define ILI9488_TEARING_EFFECT_LINE_ON 0x35<font></font>
#define ILI9488_MEM_ACCESS_CTRL 0x36<font></font>
#define ILI9488_VSCROLL_START_ADDR 0x37<font></font>
#define ILI9488_IDLE_MODE_OFF 0x38<font></font>
#define ILI9488_IDLE_MODE_ON 0x39<font></font>
#define ILI9488_INTERFACE_PIXEL_FMT 0x3A<font></font>
#define ILI9488_MEM_WRITE_CONTINUE 0x3C<font></font>
#define ILI9488_MEM_READ_CONTINUE 0x3E<font></font>
#define ILI9488_WRITE_TEAR_SCAN_LINE 0x44<font></font>
#define ILI9488_READ_TEAR_SCAN_LINE 0x45<font></font>
#define ILI9488_WRITE_BRIGHTNESS_VAL 0x51<font></font>
#define ILI9488_READ_BRIGHTNESS_VAL 0x52<font></font>
#define ILI9488_WRITE_CTRL_VAL 0x53<font></font>
#define ILI9488_READ_CTRL_VAL 0x54<font></font>
#define ILI9488_WRITE_CONTENT_ADAPT_BRIGHTN_CTRL_VAL 0x55<font></font>
#define ILI9488_READ_CONTENT_ADAPT_BRIGHTN_CTRL_VAL 0x56<font></font>
#define ILI9488_WRITE_CABC_MIN_BRIGHTN 0x5E<font></font>
#define ILI9488_READ_CABC_MIN_BRIGHTN 0x5F<font></font>
#define ILI9488_READ_AUTO_BRIGHTN_CTRL_SELF_DIAG_RES 0x68<font></font>
#define ILI9488_READ_ID1 0xDA<font></font>
#define ILI9488_READ_ID2 0xDB<font></font>
#define ILI9488_READ_ID3 0xDC<font></font>
#define TFTLCD_DELAY 0xFF<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステップ3：座標設定関数を編集する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、この手順はWaveShareのディスプレイユーザーにのみ必要であり、クリーンなSPIコネクタを備えたディスプレイ所有者には必要ありません。確認する方法はありません。しかし、既存のディスプレイでは、初期化に変更を加えた後、画面に何かが表示され始めました。確かに、これはその上部に集中しているものです。プログラムを開始するとすぐに、何かがちらつく様子がわかり、次の画像</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/gq/qk/ud/gqqkudu2d19ejnrwhix4qklb9qi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
が表示されます。トレースすると、画面の上部に、高さ全体に実際に分散するはずのものが表示されていることがわかります。多くの実験の結果、問題のあるコードが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEMO_FlushDisplay（）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の本体に集中していることが</font><b><font style="vertical-align: inherit;">わかりました</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/wj/uv/iowjuvmrjezwvoct_lofnvvigdg.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力の座標はそこで明示的に設定され、出力は常に座標0,0から取得されます。どうして？多くの実験の後、私は次の仮定をしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ILI9488コントローラのドキュメントのCOLADDRコマンドの形式は次のとおり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/hw/a9/alhwa9-q4qim8xwv9f8ib-p8v_4.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。引数は下位バイトを介して渡され、ビット23：8はXXとしてマークされていることに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、同じドキュメントから、SPIを使用する場合、これは重要ではないことは明らかです。次に、WaveShareの表示レイアウトを見てください。そして、ループ上のデータは並列に処理されていることがわかります。はいはい！丁度！並行です！しかし、彼らはこれを隠さず、スキームは自由に利用できます！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zc/8c/4w/zc8c4wxqy-prxiohxpgtboq0pak.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これ</font><font style="vertical-align: inherit;">がループのコネクタです：</font><font style="vertical-align: inherit;">並列ビューでは、すべてが2つのシフトレジスタを使用して与えられます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5d/nq/50/5dnq50wm8op_wz3ez95ulzpmyoc.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストローブは、カウンターと他のロジックによって形成されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/uf/t4/ybuft450ayyiartx05p4cgxvj6y.png"> <br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DMAを使用してデータを送信する場合、CS信号は送信全体でリセットされません。</font><font style="vertical-align: inherit;">8ビット後にCS信号がリセットされた場合、8ビットパッケージが残されるという意見があります（私はこのような読みにくい回路の詳細は調べなかったため、意見のみです）。</font><font style="vertical-align: inherit;">それ以外の場合は、16ビット。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、この関数では、座標付きの4バイトではなく、2つの16ビットワード（誤ってフォーマットされる座標）が物理ループに入ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この理論を知って、問題の関数を次のように書き換えます。</font></font><br>
<br>
<pre><code class="plaintext hljs">static void DEMO_FlushDisplay(int32_t x1, int32_t y1, int32_t x2, int32_t y2, const lv_color_t *color_p)<font></font>
{<font></font>
    uint8_t data[4];<font></font>
    const uint8_t *pdata = (const uint8_t *)color_p;<font></font>
    uint32_t send_size   = (x2 - x1 + 1) * (y2 - y1 + 1) * LCD_FB_BYTE_PER_PIXEL;<font></font>
<font></font>
    /*Column addresses*/<font></font>
    DEMO_SPI_LCD_WriteCmd(ILI9341_CMD_COLADDR);<font></font>
    DEMO_SPI_LCD_WriteData (x1 &gt;&gt; 8);<font></font>
    DEMO_SPI_LCD_WriteData (x1);<font></font>
    DEMO_SPI_LCD_WriteData (x2 &gt;&gt; 8);<font></font>
    DEMO_SPI_LCD_WriteData (x2);<font></font>
<font></font>
    /*Page addresses*/<font></font>
    DEMO_SPI_LCD_WriteCmd(ILI9341_CMD_PAGEADDR);<font></font>
    DEMO_SPI_LCD_WriteData (y1 &gt;&gt; 8);<font></font>
    DEMO_SPI_LCD_WriteData (y1);<font></font>
    DEMO_SPI_LCD_WriteData (y2 &gt;&gt; 8);<font></font>
    DEMO_SPI_LCD_WriteData (y2);<font></font>
<font></font>
    /*Memory write*/<font></font>
    DEMO_SPI_LCD_WriteCmd(ILI9341_CMD_GRAM);<font></font>
    DEMO_SPI_LCD_WriteMultiData(pdata, send_size);<font></font>
<font></font>
    lv_flush_ready();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてここに結果があります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/zv/s9/whzvs92ujzx_80ne5fqyfjsutmk.png"> <br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順4：クロックの極性と色を修復する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
写真で本当に気になるのは色です。さらに、All-Hardwareプロジェクトのデモを書き始めたとき、それはある種のカラーブラインドであることがわかりました。私は青か緑を選びました-すべてが大丈夫でした。そして、彼は赤を選びました-彼は黒になりました。いくつかのナンセンス！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、色の問題を分析的にではなく経験的に解決することにすでに慣れています。常にテストテーブルを表示します。テレビ工場での体験に影響します。ターゲットライブラリでは、</font><b><font style="vertical-align: inherit;">DEMO_FlushDisplay（）</font></b><font style="vertical-align: inherit;">関数</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画面の入力幅と高さ40行のブロックを受け取ります。それを3番目のステップでトレースしたときにわかりました。それは素晴らしいことです。実行中のユニットのバッファを上書きするコードをそこに挿入します。画面に16本の縦縞を作りましょう。最初の色は0x0001、2番目の色は0x0002、3番目の色は0x0004 ...となるため、最大で0x8000になります。そして、これが実際の色を与えるのを見てください。以下は、関数に埋め込まれたこの改良を実装するコードです。</font></font><br>
<br>
<pre><code class="plaintext hljs">    {<font></font>
        uint16_t *pdata16 = (uint16_t *)color_p;<font></font>
        int i;<font></font>
        uint32_t send_size16   = (x2 - x1 + 1) * (y2 - y1 + 1);<font></font>
        int wordsPerColor = (x2 - x1 + 1) / 16;<font></font>
        for (i=0;i&lt;send_size16;i++)<font></font>
        {<font></font>
        	int shift = (i / wordsPerColor)%16;<font></font>
        	pdata16 [i] = (1u &lt;&lt; shift);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    /*Memory write*/<font></font>
    DEMO_SPI_LCD_WriteCmd(ILI9341_CMD_GRAM);<font></font>
    DEMO_SPI_LCD_WriteMultiData(pdata, send_size);<font></font>
<font></font>
    lv_flush_ready();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は私を困惑させました。ここにそれがあります：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/ao/fb/bzaofbbmihnfxz_bnd4lvakzuri.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
緑色が引き裂かれるという事実は正常です。再配置されたバイトの典型的なケース。 littlevglライブラリはこれを考慮するだけでなく、このモードでさえデフォルトで有効になっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
意外と違う。左側には4つの緑のストライプがあります。これは、スキーム565に基づく色のバイナリ記録がバイナリ形式でどのように見えるかです：BBBBBGGGGGGRRRRRR（RとBは、ディスプレイコントローラーの設定を介して交換できますが、今は固執しません）。 16ビットをバイトに分割します。 BBBBBGGG GGGRRRRRを取得します。バイトを場所に再配置します。 GGGRRRRR BBBBBGGGGを取得します。つまり、左側は4つではなく、3つの緑のストライプになります。そして右側には、2つではなく3つあります。そして、私たちは4つと2つを持っています！送信中にビットシフトがあります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、このシフトは、WaveShareスキームの機能をライブラリのデータ転送機能に課すことで有罪ですが、実験中にライブラリ自体のエラーも検出しました。</font><font style="vertical-align: inherit;">これが、ソフトウェアの部分ではすべてがはるかに優れていると上記で述べた理由です。</font><font style="vertical-align: inherit;">最初は、ソフトウェアの部分ではすべてが完璧であることを書きたかったのです。</font><font style="vertical-align: inherit;">ああ。</font><font style="vertical-align: inherit;">ハードウェアよりもはるかに優れています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
短い経路では問題は発生しませんが、長い配線では誤動作しました。</font><font style="vertical-align: inherit;">プログラマーがSCK信号のネガティブエッジでデータのクロッキングをオンにしたことがわかります。</font><font style="vertical-align: inherit;">すべては問題ありませんが、シフトレジスタ74HC4094の説明（ちなみに、WaveShareは上の図では「49」と書いていますが、「94」です）とILI9341のドキュメント（Adafrutが表す）は、クロックが正の差にあるはずであると述べています。</font><font style="vertical-align: inherit;">極性はここで</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7p/1t/ao/7p1taoubfypb4ezufcjr_suh6im.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
調整さ</font><font style="vertical-align: inherit;">れます：</font><font style="vertical-align: inherit;">変更：</font></font><br>
<br>
<pre><code class="plaintext hljs">BOARD_LCD_SPI.Control(ARM_SPI_MODE_MASTER | ARM_SPI_CPOL1_CPHA0 | ARM_SPI_DATA_BITS(8), BOARD_LCD_SPI_BAUDRATE);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
に： </font></font><br>
<br>
<pre><code class="plaintext hljs">    BOARD_LCD_SPI.Control(ARM_SPI_MODE_MASTER | ARM_SPI_CPOL0_CPHA0 | ARM_SPI_DATA_BITS(8), BOARD_LCD_SPI_BAUDRATE);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（つまり、CPOL1からCPOL0）。すべてうまくいきますが、Raspberryの画面はまったく機能しなくなります。また、パラメータを試しても意味がありません。画面がまったく機能しないか、データが1ビットシフトしています。しかし、それは正しい-私が書いたとおりです。今すぐ別の編集を行います。それを理解するために、私は一日を費やす必要がありました。ディスプレイの浅いロジックにたくさんのオシロスコープを突き刺さなければなりませんでした。また、WaveShare機器のロジックを描いたところ、正のクロック極性では、8ビットデータがシフトレジスタの出力にラッチされないことがわかりました。選択チップはすぐに削除されます。また、負極性では、16ビットデータが1クロック早くラッチされます。ここに矛盾があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どの出口？</font><font style="vertical-align: inherit;">その通りです。すべてを単一のソリューションにします。</font><font style="vertical-align: inherit;">また、コマンドを16ビット形式で送信します。</font><font style="vertical-align: inherit;">これを行うには、同じファイル内の2つの関数を書き換えます。</font><font style="vertical-align: inherit;">彼らはとても些細なことなので、私は彼らにテキストを与えるだけです、それらをやり直す方法：</font></font><br>
<br>
<pre><code class="plaintext hljs">static void DEMO_SPI_LCD_WriteCmd(uint8_t Data)<font></font>
{<font></font>
    GPIO_PortClear(BOARD_LCD_DC_GPIO, BOARD_LCD_DC_GPIO_PORT, 1u &lt;&lt; BOARD_LCD_DC_GPIO_PIN);<font></font>
    uint8_t temp[2];<font></font>
    temp[0] = 0;<font></font>
    temp [1] = Data;<font></font>
    BOARD_LCD_SPI.Send(temp, 2);<font></font>
    SPI_WaitEvent();<font></font>
}<font></font>
<font></font>
static void DEMO_SPI_LCD_WriteData(uint8_t Data)<font></font>
{<font></font>
    GPIO_PortSet(BOARD_LCD_DC_GPIO, BOARD_LCD_DC_GPIO_PORT, 1u &lt;&lt; BOARD_LCD_DC_GPIO_PIN);<font></font>
    uint8_t temp[2];<font></font>
    temp[0] = 0;<font></font>
    temp [1] = Data;<font></font>
    BOARD_LCD_SPI.Send(temp, 2);<font></font>
    SPI_WaitEvent();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
調整テーブルが正しくなります-左右に3つの緑のストライプ：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5t/sz/wo/5tszwon-ehxarnq2yfajesy_twi.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
補助コードを削除すると、インターフェイスのもっともらしい色が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6f/lf/zj/6flfzjv1gu6dp0ngfrg4nqyywsi.png"> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LPC55S69-EVKブレッドボードが、それを行わない方法を示す最大の例を収集したという著者の私見を知りました。</font><font style="vertical-align: inherit;">また、開発環境の通常のライブラリを使用し、変更をできるだけ少なくして、液晶ディスプレイを選択して画像を表示する方法も学びました。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja504310/index.html">データの二分法：データとサービスとの関係を再考する</a></li>
<li><a href="../ja504312/index.html">ロシアのプログラムとGPLの統一登録。私の5セント</a></li>
<li><a href="../ja504314/index.html">HTTPリクエストを介したDockerクライアントなしのDocker PullおよびDocker Pushコマンドの実装</a></li>
<li><a href="../ja504318/index.html">初心者向けに無料の反復開発ワークショップを実施します</a></li>
<li><a href="../ja504320/index.html">Linux用PVS-Studio C＃を使用した単一行コードまたはNethermind検証</a></li>
<li><a href="../ja504324/index.html">Zabbix 5.0の新機能</a></li>
<li><a href="../ja504326/index.html">エフゲニー・ディキ：「ローカルでは、南極大陸はほとんど汚れていませんが、ここでは地球の汚染が非常に目立ちます」</a></li>
<li><a href="../ja504328/index.html">2019年モスクワ市下院での電子投票レッスン</a></li>
<li><a href="../ja504332/index.html">役立つ投稿：最も関連性の高いすべてのコース、放送、技術ストリーム</a></li>
<li><a href="../ja504334/index.html">JavaScriptをどの程度知っていますか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>