<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👧 🍨 🌀 Stas Afanasyev。ジュノ。io.Reader / io.Writerに基づくパイプライン。パート1 😣 🤹🏻 🥣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="レポートでは、io.Reader / io.Writerの概念、それらが必要な理由、それらを正しく実装する方法、この点でどのような落とし穴があるか、標準およびカスタムのio.Reader / io.Writer実装に基づいてパイプラインを構築する方法について説明します。
 
 
 
 Stanisl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Stas Afanasyev。ジュノ。io.Reader / io.Writerに基づくパイプライン。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/491484/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レポートでは、io.Reader / io.Writerの概念、それらが必要な理由、それらを正しく実装する方法、この点でどのような落とし穴があるか、標準およびカスタムのio.Reader / io.Writer実装に基づいてパイプラインを構築する方法について説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/nv/uj/rdnvujcjwsukejxq_6a9syayawu.jpeg"><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stanislav Afanasyev（以下-SA）：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -こんにちは！私の名前はスターです。私はJuno社のMinskから来ました。家を出る力を見つけて、この雨の日に来てくれてありがとう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は、io.Reader / io.Writerインターフェイスに基づいてパイプラインGoを構築するなどのトピックについてお話ししたいと思います。今日お話しするのは、一般的に、io.Reader / io.Writerインターフェイスの概念、それらが必要な理由、それらを正しく使用する方法、そして最も重要なのは、それらを正しく実装する方法です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのインターフェースのさまざまな実装に基づくパイプラインの構築についても説明します。既存の方法について話し、それらの長所と短所について説明します。私はさまざまな落とし穴に言及します（これは豊富になります）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始める前に、質問に答える必要があります。なぜこれらのインターフェースが必要なのですか？</font><font style="vertical-align: inherit;">Goと緊密に連携している手を上げる（毎日、隔日）... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/pd/f4/d2pdf4kdwdjk_vxkqz6fwckqrgk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしい！</font><font style="vertical-align: inherit;">まだGoコミュニティがあります。</font><font style="vertical-align: inherit;">皆さんの多くは、少なくともこれらのインターフェースを使用した経験があると思います。</font><font style="vertical-align: inherit;">あなたはそれらについてさえ知らないかもしれませんが、あなたは確かにそれらについて何かを聞いたはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、これらのインターフェースは、そのすべての症状における入出力操作の抽象化です。</font><font style="vertical-align: inherit;">第2に、これは、実装の内部の詳細をあまり意識せずに、キューブからのコンストラクターのようなパイプラインを構築できる非常に便利なAPIです。</font><font style="vertical-align: inherit;">少なくともそれは本来意図されたものでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは非常にシンプルなインターフェースです。これは、Readメソッドという1つのメソッドのみで構成されています。概念的には、io.Readerインターフェイスの実装はネットワーク接続にすることができます。たとえば、データがまだない場合でも、そこに表示</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/4n/dc/n-4ndcbxpoxkul6h227ue7hruli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、データが既に存在し、完全に読み取ることができるメモリ内のバッファーにすることができます。ファイル記述子にすることもできます。非常に大きい場合は、このファイルを分割して読み取ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
io.Readerインターフェイスの概念的な実装は、一部のデータへのアクセスです。私が書いたすべてのケースは、Readメソッドでサポートされています。引数は1つだけです。これはスライスバイトです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで1つのポイントを作成します。最近Goに来た人、または類似のAPIがなかった他のテクノロジーから来た人（私もその1つです）は、この署名は少し混乱しています。 Readメソッドは、どういうわけかこのスライスを読み取ったようです。実際、反対のことが当てはまります。Readerインターフェースの実装は内部のデータを読み取り、このスライスにこの実装のデータを入れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Readメソッドによる要求に応じて読み取ることができるデータの最大量は、このスライスの長さと同じです。</font><font style="vertical-align: inherit;">通常の実装では、リクエスト時に返すことができる最大量のデータ、またはこのスライスに収まる最大量を返します。</font><font style="vertical-align: inherit;">これは、読者が好きなように、少なくともバイト単位、少なくとも10単位でReaderを分割して読み取ることができることを示唆しています。</font><font style="vertical-align: inherit;">そして、Readerを呼び出すクライアントは、Readメソッドからの戻り値に従って、どのように生きるかを考えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Readメソッドは2つの値を返します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">差し引かれたバイト数。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">発生した場合はエラー。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの値は、クライアントのさらなる動作に影響を与えます。</font><font style="vertical-align: inherit;">スライドに、このプロセスを示し、表示するgifがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/si/ww/sf/siwwsf6u8mb1nkztg0ltnumkckw.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/p1/hk/mb/p1hkmbpfp8-twtnznjj2ihireaa.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Io.Reader-方法</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データがReaderインターフェースを満たすには、2つの方法があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l0/fm/e7/l0fme7quz_tqzilkfiuiddpgjk4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は最も簡単です。ある種のスライスバイトがあり、それをReaderインターフェイスに適合させたい場合は、このインターフェイスをすでに満たしている標準ライブラリの実装を採用できます。たとえば、バイトパッケージのリーダー。上のスライドでは、このリーダーの作成方法の署名を確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もっと複雑な方法があります-リーダーのインターフェースを自分で実装することです。トリッキーなルール、従わなければならない制限があるドキュメントには約30行あります。それらすべてについて話す前に、興味深いことになりました。「標準実装（標準ライブラリ）が十分でない場合は、どのような場合ですか？ Readerインターフェイスを自分で実装する必要があるのはいつですか？」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この質問に答えるために、私はGithubで最も人気のあるリポジトリを（星の数で）数千個取り、それらを追加して、そこにReaderインターフェースのすべての実装を見つけました。</font><font style="vertical-align: inherit;">スライドには、このインターフェイスが実装されたときの統計（分類）がいくつかあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も人気のあるカテゴリは接続です。</font><font style="vertical-align: inherit;">これは、既存のタイプの独自プロトコルとラッパーの両方の実装です。</font><font style="vertical-align: inherit;">したがって、Brad FitzpatrickにはCamlistoreプロジェクトがあります。statTrackingConnの形式の例があります。これは、一般に、ネットパッケージのcon型に対する通常のラッパーです（この型にメトリックを追加します）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目に人気のあるカテゴリはカスタムバッファです。</font><font style="vertical-align: inherit;">ここでは、唯一の例であるx / netパッケージのdataBufferを気に入っています。</font><font style="vertical-align: inherit;">その特徴は、チャンクにカットされたデータを格納し、減算するとこれらのチャンクを通過することです。</font><font style="vertical-align: inherit;">チャンク内のデータが終了すると、次のチャンクに移動します。</font><font style="vertical-align: inherit;">同時に、彼は長さ、送信されたスライスを埋めることができる場所を考慮します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のカテゴリは、あらゆる種類の進行状況バーで、メトリックの送信で差し引かれたバイト数を数えます...</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデータに基づいて、io.Readerインターフェースを実装する必要性はかなり頻繁に発生すると言えます。</font><font style="vertical-align: inherit;">それでは、ドキュメントにあるルールについて話しましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントのルール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が言ったように、ルールのリスト、そして一般にドキュメントは非常に大きく、膨大です。 3行だけで構成されるインターフェイスの場合、30行で十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の最も重要なルールは、返されるバイト数に関するものです。厳密にゼロ以上、送信されたスライスの長さ以下でなければなりません。どうしてそれが重要ですか？</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1k/kp/xh/1kkpxhahoiicme8z8vbdbq5ajbm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはかなり厳密な契約であるため、クライアントは実装からの金額を信頼できます。標準ライブラリにはラッパーがあります（たとえば、bytes.Bufferおよびbufio）。標準ライブラリにはそのような瞬間があります。ラップされたリーダーを信頼する実装もあれば、信頼しない実装もあります（これについては後で説明します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bufioは何も信頼していません。すべてを完全にチェックします。</font><font style="vertical-align: inherit;">Bytes.Bufferは、到着するすべてのものを完全に信頼します。</font><font style="vertical-align: inherit;">ここで、これに関連して何が起こっているかを示します...次に、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの考えられるケースについて検討します。これらは実装された3つのリーダーです。</font><font style="vertical-align: inherit;">それらは非常に総合的で、理解に役立ちます。</font><font style="vertical-align: inherit;">これらのリーダーはすべて、ReadAllヘルパーを使用して読み取ります。</font><font style="vertical-align: inherit;">彼の署名はスライドの上部に示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/c1/7b/ibc17bdqyrimk3xce2khqwera4w.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader＃1。</font><font style="vertical-align: inherit;">例1</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ReadAllは、Readerインターフェースのある種の実装を取り、それをすべて読み取り、読み取ったデータとエラーを返すヘルパーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の例はReaderで、常に-1とnilをエラーとして返します。つまり、NegativeReaderなどです。それを実行して何が起こるか見てみましょう：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/3h/l-/7n3hl-2vdvmgvmw80eljlorapiw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご存知のように、理由もなくパニックは愚かさのしるしです。しかし、この場合誰がばか-meまたはbyte.Buffer-は、見方によって異なります。このパッケージを書く人とそれに従う人は異なる見方をしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで何が起こったのですか？ Bytes.Bufferは負のバイト数を受け入れ、それが負であることを確認せず、彼が受け取った上限に沿って内部バッファーを遮断しようとしました-そして私たちはスライスの境界から抜け出しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例には2つの問題があります。 1つ目は、署名が負の数を返すことは禁止されておらず、ドキュメントは禁止されていることです。署名にUintが含まれていると、古典的なオーバーフローが発生します（署名された数値が符号なしとして解釈される場合）。そして、これは非常にトリッキーなバグであり、あなたがすでに家で組み立てられている金曜日の夜に確かに起こります。したがって、この場合のパニックは推奨されるオプションです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の「ポイント」は、スタックトレースが何が起こったかをまったく理解できないことです。私たちがスライスの境界を越えたことは明らかです-それで何ですか？そのような多層パイプがあり、そのようなエラーが発生した場合、何が起こったのかすぐにはわかりません。したがって、標準ライブラリのbufioもこの状況で「パニック」になりますが、より美しくなります。彼はすぐにこう書いている：「私は負のバイト数を引いた。他には何もしません-どうすればいいのかわかりません。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、bytes.Bufferはできる限りパニックを起こしています。</font><font style="vertical-align: inherit;">Golangに問題を投稿して、ヒューマンエラーを追加するように依頼しました。</font><font style="vertical-align: inherit;">3日目、私たちはこの決定の見通しについて話し合いました。</font><font style="vertical-align: inherit;">その理由は次のとおりです。歴史的には、さまざまな人々がさまざまな時期にさまざまな調整されていない決定を下すことがありました。</font><font style="vertical-align: inherit;">そして、次のようになります。1つは、実装をまったく信頼しない（すべてをチェックする）場合です。もう1つは、そこから来るものを完全に信頼します。</font><font style="vertical-align: inherit;">これは未解決の問題であり、これについて詳しく説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader＃1。</font><font style="vertical-align: inherit;">例2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の状況：リーダーは常に0とnilを結果として返します。</font><font style="vertical-align: inherit;">契約の観点から見ると、ここではすべてが合法です-問題はありません。</font><font style="vertical-align: inherit;">唯一の注意点：ドキュメントには、送信されたスライスの長さがゼロの場合に加えて、実装が値0とnilを返すことは推奨されていないことが記載されています </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、そのようなリーダーは多くの問題を引き起こす可能性があります。</font><font style="vertical-align: inherit;">では、質問に戻ります。Readerを信頼すべきですか？</font><font style="vertical-align: inherit;">たとえば、bufioにはチェックが組み込まれています。Readerを正確に100回連続して読み取ります。このような値のペアが100回返された場合、単にNoProgressを返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bytes.Bufferには、このようなものはありません。</font><font style="vertical-align: inherit;">この例を実行すると、無限ループが発生します（ReadAllは、Reader自体ではなく、内部でbytes.Bufferを使用します）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xh/br/zu/xhbrzuvnof4dxubt2d26i6q4l_q.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader＃1。</font><font style="vertical-align: inherit;">例2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの例。</font><font style="vertical-align: inherit;">これも非常に総合的ですが、理解に役立ちます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/pe/xp/gapexpzfyhd6za09ss_uuwbrmlk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは常に1とnilを返します。</font><font style="vertical-align: inherit;">ここでも問題はないようです-契約の観点からはすべてが合法です。</font><font style="vertical-align: inherit;">ニュアンスがあります：この例を自分のコンピューターで実行すると、30秒後にフリーズします... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、このリーダーを読み取るクライアント（つまり、bytes.Buffer）がデータの終わりのサインを決して取得しないためです-読み取り、減算...さらに、彼は毎回1バイト減算されます。</font><font style="vertical-align: inherit;">彼にとって、これはある時点で、再配置されたバッファーが終了し、それが実行されることを意味します-状況が繰り返され、バーストするまで無限に実行されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader＃2。</font><font style="vertical-align: inherit;">エラー復帰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Readerインターフェースを実装するための2番目の重要なルールに到達しました。これはエラーの戻りです。</font><font style="vertical-align: inherit;">ドキュメントには、実装が返す必要のある3つのエラーが記載されています。</font><font style="vertical-align: inherit;">それらの中で最も重要なのはEOFです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EOFは、データの終わりのまさにそのサインであり、実装は、データが不足したときに必ず返す必要があります。</font><font style="vertical-align: inherit;">概念的には、これは一般的には間違いではなく、間違いとして行われます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UnexpectedEOFと呼ばれる別の間違いがあります。</font><font style="vertical-align: inherit;">Readerの読み取り中に突然データを読み取れなくなった場合、UnexpectedEOFが返されると考えられていました。</font><font style="vertical-align: inherit;">しかし、実際には、このエラーは、標準ライブラリの1つの場所（ReadAtLeast関数）でのみ使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-c/og/la/-coglawtrylyakbq0kxlc0ob9rs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの間違いは、すでに説明したNoProgressです。</font><font style="vertical-align: inherit;">ドキュメントはそう言っています：これはインターフェースが実装されているという兆候です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Io.Reader＃3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメントには、エラーを正しく返す方法に関する一連のケースが規定されています。</font><font style="vertical-align: inherit;">次の3つのケースが考え</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m1/ef/si/m1efsipabh8oypgch-7_ni2syc8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
られます。バイト数を差し引いて、または個別にエラーを返すことができます。</font><font style="vertical-align: inherit;">ただし、突然Readerでデータがなくなり、[終了記号] EOFをすぐに返すことができない場合（多くの標準ライブラリの実装はそのように機能します）、次の連続する呼び出しにEOFを返すことが想定されます（つまり、手放す必要があります）お客様）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントにとって、これはもうデータがないことを意味します-もう私に来ないでください。</font><font style="vertical-align: inherit;">nilを返し、クライアントがデータを必要とする場合、クライアントは再びあなたのところに来るはずです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Reader。</font><font style="vertical-align: inherit;">間違い</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、Readerによると、これらは主要な重要なルールでした。</font><font style="vertical-align: inherit;">小さなもののセットはまだありますが、それほど重要ではなく、そのような状況にはなりません</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xv/iu/az/xviuazv5segzzd5ganrbinp8xli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Readerに関連するすべてを検討する前に、質問に答える必要があります。重要ですか、カスタム実装でエラーが頻繁に発生しますか？</font><font style="vertical-align: inherit;">この質問に答えるために、私は自分のスプールを1000個のリポジトリに向けました（そして、そこには約550個のカスタム実装があります）。</font><font style="vertical-align: inherit;">最初の100枚を目で確認しました。</font><font style="vertical-align: inherit;">もちろん、これは超分析ではありませんが、それは何ですか...私</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は2つの最も人気のあるエラー</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">特定しました：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EOFを返すことはありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラップされたリーダーへの過度の信頼。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、これは私の観点からの問題です。</font><font style="vertical-align: inherit;">そして、ioパッケージを見ている人から、これは問題ではありません。</font><font style="vertical-align: inherit;">これについてはまた話します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ひとつのニュアンスに戻りたいと思います。</font><font style="vertical-align: inherit;">参照：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/3h/9q/te3h9q46okeg22rijrfyxrmi4da.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントは、0とnilのペアをEOFとして解釈してはなりません。</font><font style="vertical-align: inherit;">これは間違いです！</font><font style="vertical-align: inherit;">Readerにとって、この値はクライアントを手放す機会にすぎません。</font><font style="vertical-align: inherit;">したがって、私が言及した2つの間違いは重要ではないように見えますが、製品に多層パイプラインがあり、真ん中に小さな陰険な「バグル」が忍び込んでいると想像すれば十分です。そうすれば、「地下ノック」は長くはかかりません-保証されます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リーダーによると、基本的にすべて。</font><font style="vertical-align: inherit;">これらは基本的な実装ルールでした。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Writer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パイプラインのもう一方の端には、通常データを書き込むio.Writerがあります。</font><font style="vertical-align: inherit;">非常によく似たインターフェース：これも1つのメソッド（書き込み）で構成されており、シグニチャーは似ています。</font><font style="vertical-align: inherit;">セマンティクスの観点から見ると、Writerインターフェースの方が理解しやすいです。聞いたとおり、このインターフェースは書かれていると思います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fq/ya/ls/fqyalshoz2lwp48cs5u8oa9ymdk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Writeメソッドはスライスバイトを受け取り、それ全体を書き込みます。</font><font style="vertical-align: inherit;">彼は従わなければならない一連のルールも持っています。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの1つ目は、返された書き込みバイト数に関するものです。</font><font style="vertical-align: inherit;">たとえばパニックに陥るなどの重大な結果につながる可能性のある例を1つも見つけられなかったため、それほど厳格ではないと思います。</font><font style="vertical-align: inherit;">次のルールがあるのでこれはそれほど厳密ではありません...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き込まれたデータの量が送信されたデータより少ない場合は常に、Writerの実装でエラーを返す必要があります。</font><font style="vertical-align: inherit;">つまり、部分的な記録はサポートされていません。</font><font style="vertical-align: inherit;">つまり、書き込まれたバイト数はそれほど重要ではありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もう1つのルール：クライアントはまだこのスライスを使用するため、ライターは送信されたスライスを変更してはなりません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライターはこのスライスを保持するべきではありません（リーダーにも同じルールがあります）。</font><font style="vertical-align: inherit;">一部の操作の実装にデータが必要な場合は、このスライドをコピーするだけで済みます。</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/iy/tx/qe/iytxqemg1nabcwxyfzxtgszmjxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リーダーとライターによると、それだけです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デンドログラム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特にこのレポートでは、実装のグラフを生成し、それを樹状図の形式で設計しました。</font><font style="vertical-align: inherit;">今すぐ欲しい人はこのQRコードをたどることができます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/zp/pq/r2zppqu-0snqu80oqyxxpxakkpc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この樹状図には、ioパッケージのすべてのインターフェースのすべての実装があります。</font><font style="vertical-align: inherit;">この樹状図は、パイプラインで何を何に結合できるか、どこで何を読み取ることができるか、どこで書き込むことができるかを簡単に理解するために必要です。</font><font style="vertical-align: inherit;">報告の過程で引き続き参照しますので、QRコードを参照してください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パイプライン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リーダーio.Writerとは何かについて話しました。次に、パイプラインを構築するための標準ライブラリに存在するAPIについて説明します。基本から始めましょう。多分それは誰にとっても面白くないでしょう。ただし、これは非常に重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準入力ストリーム（Stdinから）からデータを読み取ります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zq/tq/4m/zqtq4mfocqntafmpk5m_scirhcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。StdinはGoでosパッケージのファイルタイプのグローバル変数によって表されます。系統樹を見ると、ファイルタイプがReaderおよびWriterインターフェースも実装していることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、Readerに興味があります。 Stdinは、すでに使用したのと同じReadAllヘルパーを使用して読みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このヘルパーに関する1つのニュアンスは注目に値します。ReadAllはReaderを最後まで読み取りますが、話した最後の兆候に従って、EOFによって終了を決定します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stdinから読み取るデータの量を制限します。これを行うには、標準ライブラリにLimitedReaderの実装があり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/dm/hn/qqdmhnj73dfyxpdlrpoffwzimgq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。LimitedReaderが読み取るバイト数を制限する方法に注意してください。この実装であるこのラッパーは、Reader内にあるすべてのものを差し引き、それをラップして、必要なだけ与えると考えるでしょう。しかし、すべてが少し異なって機能します...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LimitedReaderは、引数として指定されたスライスを上限に沿ってトリミングします。</font><font style="vertical-align: inherit;">そして、この切り抜いたスライスをReaderに渡し、Readerがそれをラップします。</font><font style="vertical-align: inherit;">これは、io.Readerインターフェースの実装で読み取られたデータの長さがどのように調整されるかを明確に示しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの終わりを返すエラー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの興味深い点：この実装がどのようにEOFエラーを返すかに注意してください！</font><font style="vertical-align: inherit;">返された名前付きの値はここで使用され、ラップされたリーダーから取得した値によって割り当てられます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラップされたリーダーに必要以上のデータがある場合は、ラップされたリーダーにまだデータがあるため、ラップされたリーダーの値（たとえば、10バイトとnil）を割り当てます。</font><font style="vertical-align: inherit;">しかし、（最後から2番目の行で）減少する変数nは、「底」、つまり必要なものの終わりに到達したことを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の反復では、クライアントは再び来る必要があります-最初の条件では、彼はEOFを受け取ります。</font><font style="vertical-align: inherit;">これは私が述べたケースです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに続けられるように...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kuyjuGk1USY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">広告のビット:)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつもご利用いただきありがとうございます。私たちの記事は好きですか？もっと面白い資料を見たいですか？</font><b><font style="vertical-align: inherit;">私たちがあなたのために私たちが発明したエントリーレベルのサーバーのユニークなアナログで</font></b><font style="vertical-align: inherit;">ある</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ 4.99から</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注文またはお友達</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">に開発者向けのクラウドベースのVPS</font></a><font style="vertical-align: inherit;">をお勧めすることで私たちをサポートして</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ください：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS（KVM）E5-2697 v3（6コア）10GB DDR4 480GB SSD 1Gbpsの真実19ドルから、またはサーバーを分割する方法？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オプションは、RAID1およびRAID10、最大24コア、最大40GB DDR4で利用可能です）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xdは、アムステルダムのEquinix Tier IVデータセンターで2倍安いですか？</font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">オランダでは</font></b><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">199ドルのIntel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV</font></a></b><font style="vertical-align: inherit;">が</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">2つ</font></a></b><font style="vertical-align: inherit;">だけあり</font><b><font style="vertical-align: inherit;">ます！</font></b></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デルR420-2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB-$ 99から！</font></font></b></b><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">インフラストラクチャビルディングの構築方法</font></a><font style="vertical-align: inherit;">について</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">お</font></a><font style="vertical-align: inherit;">読みください</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Dell R730xd E5-2650 v4サーバーを使用するクラスcは、1ペニーで9,000ユーロかかりますか？</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja491470/index.html">株式市場の調整中に資産を保護する方法は？</a></li>
<li><a href="../ja491476/index.html">MEMS加速度計、磁力計、方位角</a></li>
<li><a href="../ja491478/index.html">視覚障害者用の新しいインプラントは脳に直接接続します</a></li>
<li><a href="../ja491480/index.html">CoVirus MVPプロ​​ジェクト-コロナウイルス感染のオンラインマップまたは手にある「赤いボタン」</a></li>
<li><a href="../ja491482/index.html">PowerShell 7.0の紹介</a></li>
<li><a href="../ja491486/index.html">ラップトップの蓋を閉じて、スリープなしで画面をロックするときのカスタムスクリプト</a></li>
<li><a href="../ja491488/index.html">アジャイルであるとはどういう意味ですか？</a></li>
<li><a href="../ja491490/index.html">Gitlab-CIはどのように環境変数を継承しますか？</a></li>
<li><a href="../ja491494/index.html">ソビエト科学の壮大な詐欺：再利用可能な軌道船が一度限りであることが判明した理由</a></li>
<li><a href="../ja491496/index.html">IntelliJ IDEAのヒントとコツ：1.ファイルとフォルダーの比較</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>