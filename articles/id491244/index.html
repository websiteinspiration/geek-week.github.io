<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐧 🌊 🕵🏾 Ableton tidak diperlukan: sambungkan Ableton Push 2 ke VCV Rack 👨🏼‍🌾 🛌🏾 📏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Penciptaan musik, akhir-akhir ini, berjalan dengan cara yang sama seperti foto 10 tahun yang lalu: masing-masing memiliki akun DSLR dan instagram send...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ableton tidak diperlukan: sambungkan Ableton Push 2 ke VCV Rack</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491244/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/vm/8j/qkvm8jnnid3kb_8kybxztptlbfu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penciptaan musik, akhir-akhir ini, berjalan dengan cara yang sama seperti foto 10 tahun yang lalu: masing-masing memiliki akun DSLR dan instagram sendiri. Industri musik sangat senang akan hal ini, karena minat seperti itu menghasilkan banyak uang. Setiap hari, plugin VST baru dan perangkat analog muncul, jumlah kursus tematik berkembang pesat, blog yang didedikasikan untuk produksi musik masuk ke youtube teratas. Dengan latar belakang ini, proyek-proyek sumber terbuka terlihat sangat menarik, memungkinkan siapa saja yang ingin mencoba diri mereka sendiri sebagai produsen tanpa mengeluarkan banyak uang untuk ini. Salah satu proyek tersebut adalah VCV Rack, yang bertujuan untuk membuat kelas alat musik yang paling mahal - synthesizer modular analog - dapat diakses oleh semua orang. Baru-baru ini, ketika saya mendapat ide untuk sebuah lagu,dan di tangan hanya ada laptop linux, saya ingin membuat seluruh lagu di VCV. Dan sepanjang jalan, ada keinginan untuk mengontrol synthesizer menggunakan pengontrol midi dengan cara yang menggunakan modul yang tersedia tidak bekerja. Pada akhirnya, saya memutuskan untuk menulis sebuah plugin untuk menghubungkan Ableton Push 2 ke VCV Rack. Kita akan berbicara tentang apa yang terjadi, dan bagaimana menulis modul kita sendiri untuk VCV di artikel ini.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referensi cepat</font></font></b><div class="spoiler_text">VCV Rack — open source ,   .  VCV  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  </a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    </a>.<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
Ableton Push 2 —    midi-  Ableton,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"> DAW</a>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">API    </a>.<br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/0CdMvkBOUgs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Rak VCV</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap modul dalam VCV terdiri dari dua bagian - audio dan grafik. </font><font style="vertical-align: inherit;">Bagian audio mewarisi dari kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proses</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang disebut untuk setiap sampel, yaitu, dengan frekuensi sampling. </font><font style="vertical-align: inherit;">Omong-omong, frekuensi pengambilan sampel dalam VCV dapat bervariasi dari standar 44,1 kHz hingga 768 kHz, yang memungkinkan emulasi synthesizer modular yang lebih akurat dengan daya komputasi yang memadai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objek dari tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModuleWidget</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bertanggung jawab atas grafik </font><font style="vertical-align: inherit;">, yang mewarisi metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggambar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari struktur dasar </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">VCV menggunakan perpustakaan grafik vektor nanovg. </font><font style="vertical-align: inherit;">Menggambar di dalam metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggambar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itu bisa terjadi baik di dalam batas-batas modul (kelebihan terputus oleh mesin), dan misalnya di framebuffer, yang masih kita gunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi apa yang diperlukan untuk menulis modul Anda untuk VCV?</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyiapkan lingkungan dan menginstal Rack SDK</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Langkah pertama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dijelaskan dengan baik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam dokumentasi dan tidak menyebabkan kesulitan (setidaknya di bawah linux), jadi kami tidak akan memikirkannya.</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat templat plugin</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada skrip helper.py untuk ini di SDK Rack. </font><font style="vertical-align: inherit;">Dia perlu mengatakan createplugin, dan kemudian menentukan nama plugin dan, opsional, informasi tentang itu.</font></font><br>
<br>
<pre><code class="bash hljs">&lt;Rack SDK folder&gt;/helper.py createplugin MyPlugin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika templat plugin dibuat, ia dapat dikompilasi dan diinstal dengan perintah</font></font><br>
<br>
<pre><code class="bash hljs">RACK_DIR=&lt;Rack SDK folder&gt; make install</code></pre><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gambar frontend modul</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap plugin dapat berisi beberapa modul, dan untuk setiap modul Anda perlu menggambar panel utama. Untuk ini, dokumentasi VCV menawarkan kita untuk menggunakan Inkscape atau editor vektor lainnya. Karena modul-modul dalam VCV dipasang pada virtual Eurorack-stand, tingginya selalu 128,5 mm dan lebarnya harus kelipatan 5,08 mm. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elemen antarmuka dasar, seperti soket CV / Gerbang, tombol, dan bola lampu dapat ditandai dalam bentuk vektor. Untuk melakukan ini, gambar lingkaran tempat mereka dari warna yang sesuai ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lebih detail di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), sehingga </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">helper.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kemudian </font><i><font style="vertical-align: inherit;">menghasilkan</font></i><font style="vertical-align: inherit;"> kode untuk markup ini. Secara pribadi, menurut saya ini bukan fitur yang sangat nyaman dan lebih mudah untuk menempatkan elemen langsung dari kode. Ketika gambar dan tata letak siap, Anda perlu menjalankan </font><i><font style="vertical-align: inherit;">helper.py</font></i><font style="vertical-align: inherit;"> lagi</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk membuat templat modul dan mengaitkannya dengan panel depan.</font></font><br>
<br>
<pre><code class="bash hljs">helper.py createmodule MyModule res/MyModule.svg src/MyModule.cpp</code></pre><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menghubungkan tombol dan tikungan</font></font></b></h2><br>
<img src="https://habrastorage.org/webt/oz/wq/z_/ozwqz_ss4sqqdci_q7dxbarbfve.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari tampilan, Ableton Push 2 dilihat oleh komputer sebagai perangkat USB-MIDI biasa, yang membuatnya mudah untuk membuat koneksi antara itu dan VCV Rack. </font><font style="vertical-align: inherit;">Untuk melakukan ini, buat antrian midi input dan port midi keluaran di dalam kelas modul.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode inisialisasi</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AbletonPush2</span> :</span> Module {<font></font>
    midi::Output midiOutput;<font></font>
    midi::InputQueue midiInput;<font></font>
<font></font>
    <span class="hljs-keyword">bool</span> inputConnected;
    <span class="hljs-keyword">bool</span> outputConnected;<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita coba temukan Ableton Push di antara perangkat midi yang tersambung dan sambungkan. </font><font style="vertical-align: inherit;">Karena modul ini dirancang untuk bekerja secara eksklusif dengan Ableton Push, kita tidak perlu membebani pengguna dengan pilihan perangkat dan Anda dapat menemukannya dengan nama saja.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode Koneksi Pengontrol</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">connectPush</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> in_devs = midiInput.getDeviceIds();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; in_devs.size(); i++){
        <span class="hljs-keyword">if</span> (midiInput.getDeviceName(in_devs[i]).find(<span class="hljs-string">"Ableton"</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) {<font></font>
            midiInput.setDeviceId(in_devs[i]);<font></font>
            inputConnected = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
		<font></font>
    <span class="hljs-keyword">auto</span> out_devs = midiOutput.getDeviceIds();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; out_devs.size(); i++){
        <span class="hljs-keyword">if</span> (midiOutput.getDeviceName(out_devs[i]).find(<span class="hljs-string">"Ableton"</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) {<font></font>
            midiOutput.setDeviceId(out_devs[i]);<font></font>
            outputConnected = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang dalam metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proses</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anda dapat secara berkala memeriksa apakah controller terhubung dan bertanya pada antrian midi apakah ada pesan yang masuk. </font><font style="vertical-align: inherit;">Di sini perlu disebutkan apa dan bagaimana umumnya dikodekan dalam standar midi. </font><font style="vertical-align: inherit;">Sebenarnya, ada dua jenis pesan utama, yaitu Note ON / OFF, mentransmisikan nomor note dan gaya tekan, dan CC - Command Control, mentransmisikan nilai numerik dari beberapa parameter variabel. </font><font style="vertical-align: inherit;">Informasi lebih lanjut tentang midi dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode Polling Antrian MIDI</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ProcessArgs &amp;args)</span> <span class="hljs-keyword">override</span> </span>{
    <span class="hljs-keyword">if</span> (sampleCounter &gt; args.sampleRate / updateFrequency) {<font></font>
<font></font>
        <span class="hljs-keyword">if</span> ((!inputConnected) &amp;&amp; (!outputConnected)) {<font></font>
            connectPush();<font></font>
        }<font></font>
<font></font>
	midi::Message msg;<font></font>
	<span class="hljs-keyword">while</span> (midiInput.shift(&amp;msg)) {<font></font>
	    processMidi(msg);<font></font>
	}<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang saya ingin mengajarkan pad controller untuk bersinar dalam warna yang berbeda, sehingga lebih mudah untuk menavigasi mereka. Untuk melakukan ini, kita perlu mengirimnya perintah midi yang sesuai. Pertimbangkan, misalnya, pad nomor 36 (ini adalah pad kiri terendah). Jika Anda mengkliknya, controller akan mengirimkan perintah 0x90 (note on), diikuti oleh nomor note (36) dan angka dari 0 hingga 127, yang berarti kekuatan pers. Dan ketika, sebaliknya, komputer mengirimkan controller 0x90 perintah yang sama dan nomor note yang sama 36, ​​maka angka ketiga akan menunjukkan warna yang pad kiri bawah harus menyala. Jumlah tombol dan bantalan ditunjukkan pada gambar di atas. Push memiliki beberapa kemungkinan untuk bekerja dengan warna, palet, animasi, dan parameter backlighting lainnya. Saya tidak masuk ke rincian dan hanya membawa semua warna yang mungkin dari palet default ke bantalan dan memilih yang saya suka.Tetapi dalam kasus umum, konversi perintah midi ke nilai PWM pada LED, menurut dokumentasi, terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/at/zq/8oatzqvwy_gwqvgu4cmjgjpbknm.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode Kontrol Backlight</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOn</span><span class="hljs-params">(<span class="hljs-keyword">int</span> note, <span class="hljs-keyword">int</span> color)</span></span>{<font></font>
    midi::Message msg;<font></font>
    msg.setNote(note);<font></font>
    msg.setValue(color);<font></font>
    msg.setChannel(<span class="hljs-number">1</span>);<font></font>
    msg.setStatus(<span class="hljs-number">0x9</span>);<font></font>
    midiOutput.sendMessage(msg);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOff</span><span class="hljs-params">(<span class="hljs-keyword">int</span> note)</span></span>{<font></font>
    midi::Message msg;<font></font>
    msg.setNote(note);<font></font>
    msg.setValue(<span class="hljs-number">0</span>);<font></font>
    msg.setChannel(<span class="hljs-number">1</span>);<font></font>
    msg.setStatus(<span class="hljs-number">0x8</span>);<font></font>
    midiOutput.sendMessage(msg);<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami menghubungkan layar</font></font></b></h2><br>
<img src="https://habrastorage.org/webt/os/yl/kv/osylkvou5ba8_aoa3rwhst94uiu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghubungkan layar Anda harus bekerja dengan USB. </font><font style="vertical-align: inherit;">Kontroler itu sendiri tidak tahu cara menggambar apa pun dan tidak tahu apa-apa tentang grafis. </font><font style="vertical-align: inherit;">Yang dia inginkan adalah mengirim bingkai berukuran 160x960 piksel setidaknya setiap 2 detik. </font><font style="vertical-align: inherit;">Semua rendering dilakukan di sisi komputer. </font><font style="vertical-align: inherit;">Untuk memulai, sambungkan dan buka perangkat USB, seperti yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dijelaskan dalam dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilkan Kode Koneksi</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> _MSC_VER</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> _WIN32</span><font></font>
<font></font>
<span class="hljs-comment">// see following link for a discussion of the</span>
<span class="hljs-comment">// warning suppression:</span>
<span class="hljs-comment">// http://sourceforge.net/mailarchive/forum.php?</span>
<span class="hljs-comment">// thread_name=50F6011C.2020000%40akeo.ie&amp;forum_name=libusbx-devel</span><font></font>
<font></font>
<span class="hljs-comment">// Disable: warning C4200: nonstandard extension used:</span>
<span class="hljs-comment">// zero-sized array in struct/union</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> <span class="hljs-meta-keyword">warning</span>(disable:4200)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __linux__</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;libusb-1.0/libusb.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"libusb.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ABLETON_VENDOR_ID 0x2982</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_PRODUCT_ID  0x1967</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> libusb_device_handle* <span class="hljs-title">open_push2_device</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> result;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ((result = libusb_init(<span class="hljs-literal">NULL</span>)) &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: [%d] could not initilialize usblib\n"</span>, result);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
<font></font>
  libusb_set_debug(<span class="hljs-literal">NULL</span>, LIBUSB_LOG_LEVEL_ERROR);<font></font>
<font></font>
  libusb_device** devices;<font></font>
  <span class="hljs-keyword">ssize_t</span> count;<font></font>
  count = libusb_get_device_list(<span class="hljs-literal">NULL</span>, &amp;devices);
  <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"error: [%ld] could not get usb device list\n"</span>, count);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
<font></font>
  libusb_device* device;<font></font>
  libusb_device_handle* device_handle = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
  <span class="hljs-keyword">char</span> ErrorMsg[<span class="hljs-number">128</span>];<font></font>
<font></font>
  <span class="hljs-comment">// set message in case we get to the end of the list w/o finding a device</span>
  <span class="hljs-built_in">sprintf</span>(ErrorMsg, <span class="hljs-string">"error: Ableton Push 2 device not found\n"</span>);<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; (device = devices[i]) != <span class="hljs-literal">NULL</span>; i++)<font></font>
  {<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">libusb_device_descriptor</span> <span class="hljs-title">descriptor</span>;</span>
    <span class="hljs-keyword">if</span> ((result = libusb_get_device_descriptor(device, &amp;descriptor)) &lt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-built_in">sprintf</span>(ErrorMsg,
        <span class="hljs-string">"error: [%d] could not get usb device descriptor\n"</span>, result);
      <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (descriptor.bDeviceClass == LIBUSB_CLASS_PER_INTERFACE<font></font>
      &amp;&amp; descriptor.idVendor == ABLETON_VENDOR_ID<font></font>
      &amp;&amp; descriptor.idProduct == PUSH2_PRODUCT_ID)<font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> ((result = libusb_open(device, &amp;device_handle)) &lt; <span class="hljs-number">0</span>)<font></font>
      {<font></font>
        <span class="hljs-built_in">sprintf</span>(ErrorMsg,
          <span class="hljs-string">"error: [%d] could not open Ableton Push 2 device\n"</span>, result);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((result = libusb_claim_interface(device_handle, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)<font></font>
      {<font></font>
        <span class="hljs-built_in">sprintf</span>(ErrorMsg,
          <span class="hljs-string">"error: [%d] could not claim interface 0 of Push 2 device\n"</span>, result);<font></font>
        libusb_close(device_handle);<font></font>
        device_handle = <span class="hljs-literal">NULL</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span><font></font>
      {<font></font>
        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// successfully opened</span><font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (device_handle == <span class="hljs-literal">NULL</span>)<font></font>
  {<font></font>
    <span class="hljs-built_in">printf</span>(ErrorMsg);<font></font>
  }<font></font>
<font></font>
  libusb_free_device_list(devices, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> device_handle;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close_push2_device</span><span class="hljs-params">(libusb_device_handle* device_handle)</span>
</span>{<font></font>
  libusb_release_interface(device_handle, <span class="hljs-number">0</span>);<font></font>
  libusb_close(device_handle);<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengirimkan frame, Anda harus terlebih dahulu mengirim header 16-byte, dan kemudian 160 baris masing-masing 960 angka 16-bit. </font><font style="vertical-align: inherit;">Pada saat yang sama, menurut dokumentasi, string tidak boleh dikirim dalam 1920 byte, tetapi dalam paket 2048 byte, ditambah dengan nol.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frame Transfer Code</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Push2Display</span> :</span> FramebufferWidget {<font></font>
<font></font>
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frame_header[<span class="hljs-number">16</span>] = {
          <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x88</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>,
          <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span> <font></font>
    };<font></font>
<font></font>
    libusb_device_handle* device_handle;<font></font>
<font></font>
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>* image;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendDisplay</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> * image)</span> </span>{
        <span class="hljs-keyword">int</span> actual_length;<font></font>
     <font></font>
        libusb_bulk_transfer(device_handle, PUSH2_BULK_EP_OUT, frame_header, <span class="hljs-keyword">sizeof</span>(frame_header), &amp;actual_length, TRANSFER_TIMEOUT);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">160</span>; i++)<font></font>
            libusb_bulk_transfer(device_handle, PUSH2_BULK_EP_OUT, &amp;image[(<span class="hljs-number">159</span> - i)*<span class="hljs-number">1920</span>], <span class="hljs-number">2048</span>, &amp;actual_length, TRANSFER_TIMEOUT);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tinggal menggambar dan menulis bingkai ke buffer. </font><font style="vertical-align: inherit;">Untuk melakukan ini, gunakan kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FramebufferWidget</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang mengimplementasikan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drawFramebuffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">VCV Rack out of the box menggunakan perpustakaan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nanovg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jadi cukup mudah untuk menulis grafik di sini. </font><font style="vertical-align: inherit;">Kami mempelajari konteks grafik saat ini dari variabel APP global dan menyimpan kondisinya. </font><font style="vertical-align: inherit;">Selanjutnya, buat bingkai 160x960 kosong dan gambarlah dengan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggambar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Setelah itu, salin framebuffer ke array yang akan dikirim melalui USB, dan kembalikan keadaan konteksnya. </font><font style="vertical-align: inherit;">Pada akhirnya, atur bendera </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kotor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sehingga pada iterasi rendering berikutnya, mesin VCV tidak lupa memperbarui widget kami.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bingkai Rendering Code</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawFramebuffer</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{<font></font>
<font></font>
    NVGcontext* vg = APP-&gt;window-&gt;vg;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (display_connected) {<font></font>
        nvgSave(vg);<font></font>
	glViewport(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">960</span>, <span class="hljs-number">160</span>);<font></font>
        glClearColor(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<font></font>
        glClear(GL_COLOR_BUFFER_BIT|GL_STENCIL_BUFFER_BIT);<font></font>
<font></font>
	nvgBeginFrame(vg, <span class="hljs-number">960</span>,  <span class="hljs-number">160</span>, <span class="hljs-number">1</span>);<font></font>
        draw(vg);<font></font>
        nvgEndFrame(vg);<font></font>
<font></font>
        glReadPixels(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">960</span>, <span class="hljs-number">160</span>, GL_RGB, GL_UNSIGNED_SHORT_5_6_5, image); <font></font>
<font></font>
        <span class="hljs-comment">//  XOR   ,  </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">80</span>*<span class="hljs-number">960</span>; i ++){<font></font>
            image[i * <span class="hljs-number">4</span>] ^= <span class="hljs-number">0xE7</span>;<font></font>
	    image[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] ^= <span class="hljs-number">0xF3</span>;<font></font>
            image[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] ^= <span class="hljs-number">0xE7</span>;<font></font>
	    image[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] ^= <span class="hljs-number">0xFF</span>;<font></font>
        }<font></font>
	    	<font></font>
	sendDisplay(image);<font></font>
<font></font>
	nvgRestore(vg);<font></font>
    }<font></font>
<font></font>
    dirty = <span class="hljs-literal">true</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logika interaksi dan pemetaan parameter</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk tugas saya, saya ingin dapat mengubah pola yang direkam dalam sequencer, dan pada saat yang sama mengontrol serangkaian parameter tertentu, saya sendiri untuk setiap kelompok pola. </font><font style="vertical-align: inherit;">Dengan pemetaan, saya memahami pengikatan parameter dari satu modul dengan parameter dari modul lain atau pengontrol midi. </font><font style="vertical-align: inherit;">Saya menemukan sangat sedikit informasi tentang cara membuat pemetaan dengan indah, jadi saya mengambil sebagian besar kode yang mengimplementasikannya dari modul </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peta MIDI yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dibangun ke dalam VCV </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Singkatnya, untuk setiap kumpulan parameter, sebuah objek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParamHandle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> khusus </font><i><font style="vertical-align: inherit;">dibuat di sana</font></i><font style="vertical-align: inherit;"> , yang </font><font style="vertical-align: inherit;">memberi tahu mesin </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">melalui kruk</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apa yang terhubung dengan apa.</font></font><br>
<br>
<h2><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></b></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah modul yang saya dapatkan pada akhirnya. </font><font style="vertical-align: inherit;">Selain konversi standar midi ke CV, ini memungkinkan Anda untuk mengelompokkan bantalan, menetapkan warna padanya dan mengaitkan parameter modul yang sewenang-wenang dengan Push encoders, menampilkan nama dan nilainya pada tampilan pengontrol. </font><font style="vertical-align: inherit;">Dalam video di bawah ini Anda dapat melihat ikhtisarnya, dan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video ini Anda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat melihat beraksi.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OhdxXv6uHF0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode lengkap tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami berhasil mengujinya hanya di Linux (Ubuntu 18.04), pada MacOS tampilan tidak terhubung karena spesifikasi libusb dan ada penundaan aneh pada antarmuka midi. </font><font style="vertical-align: inherit;">Meskipun demikian, VCV Rack meninggalkan kesan yang sangat baik sebagai kerangka kerja dan sebagai DAW modular, saya berharap VCV akan terus berkembang, dan artikel ini akan membantu orang lain menulis modul mereka sendiri untuk itu.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id491232/index.html">RPA + Machine Learning = Otomasi Cerdas</a></li>
<li><a href="../id491234/index.html">Tiga Trik untuk Bekerja dengan SOLIDWORKS untuk Memodelkan Bagian untuk Pencetakan 3D</a></li>
<li><a href="../id491236/index.html">Pemrograman async di .NET: praktik terbaik</a></li>
<li><a href="../id491238/index.html">Analisis Kode Genetik II</a></li>
<li><a href="../id491240/index.html">Jalan menuju awan: kemarin dan hari ini Adobe</a></li>
<li><a href="../id491246/index.html">Konferensi DEFCON 27. Mobil Anda adalah mobil saya. Bagian 2</a></li>
<li><a href="../id491250/index.html">Lampu LED Gauss Basic</a></li>
<li><a href="../id491252/index.html">5 fitur JSON.stringify yang kurang dikenal ()</a></li>
<li><a href="../id491256/index.html">Pengembangan modul pada iMX8 dari NXP. Fitur transfer jejak DDR</a></li>
<li><a href="../id491258/index.html">IT gadis, dari mana Anda berasal? Mari kita membangun peta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>