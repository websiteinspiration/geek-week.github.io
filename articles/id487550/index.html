<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœ’ï¸ ğŸ“¹ â™“ï¸ Gambar 3D dalam python dengan (hampir) kinerja normal ğŸ‘¨ğŸ½â€ğŸ³ ğŸ§œğŸ¼ ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini dapat dianggap sebagai jawaban untuk yang satu ini , di mana itu adalah pertanyaan untuk menulis hal seperti itu di C ++, yang ditujukan u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gambar 3D dalam python dengan (hampir) kinerja normal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487550/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini dapat dianggap sebagai jawaban untuk yang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satu ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana itu adalah pertanyaan untuk menulis hal seperti itu di C ++, yang ditujukan untuk pemula, yaitu, dengan penekanan pada kode yang mudah dibaca dan bukan kinerja tinggi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah membaca artikel itu, saya punya ide untuk mengulangi program yang ditulis oleh penulis. </font><font style="vertical-align: inherit;">Saya kenal dengan C ++, tapi saya tidak pernah menulis program yang rumit di atasnya, lebih suka python. </font><font style="vertical-align: inherit;">Di sini lahir ide untuk menuliskannya. </font><font style="vertical-align: inherit;">Saya terutama tertarik pada kinerja - saya hampir yakin bahwa beberapa frame per detik adalah batas untuk python. </font><font style="vertical-align: inherit;">Saya salah.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rl/da/y4/rlday4jrxollwpqikmsvgjrsvr0.png" alt="gambar"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/dm/yh/gwdmyhq06z52q1f9eib7blqfszy.png" alt="gambar"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Upaya pertama dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Di sini kode ditulis secara penuh, tidak termasuk perbedaan bahasa, sesuai dengan yang ada di</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haqreu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dan karena ini, renderingnya adalah O (n ^ 2) - pada dasarnya loop bersarang dalam sudut dan jarak:</font></font><br>
<br>
<pre><code class="python hljs">         <span class="hljs-comment"># iterating alpha</span>
        alpha = player.view - player.fov / <span class="hljs-number">2</span>
        mapFB.drawRectangle(player.y - <span class="hljs-number">1</span>, player.x - <span class="hljs-number">1</span>, player.y + <span class="hljs-number">1</span>, player.x + <span class="hljs-number">1</span>, Color(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<font></font>
        rayNum = <span class="hljs-number">0</span>
        <span class="hljs-keyword">while</span> alpha &lt; player.fov / <span class="hljs-number">2</span> + player.view:
            <span class="hljs-comment"># iterating distance</span>
            dist = <span class="hljs-number">0</span><font></font>
            x = player.x<font></font>
            y = player.y<font></font>
            <span class="hljs-keyword">while</span> <span class="hljs-number">0</span> &lt; x &lt; mapFB.w - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt; y &lt; mapFB.h - <span class="hljs-number">1</span>:<font></font>
                  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena itu, kode ini agak lambat (saya berhasil mendapatkan kurang dari 3-4 frame per detik pada generasi ke-8 intel core i5). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara yang jelas untuk mempercepat dan tidak menyulitkan kode adalah mengganti loop dalam dengan operasi kompleksitas linier. Mari kita pertimbangkan segala sesuatu dari sudut pandang matematika: kita perlu menentukan titik perpotongan sinar yang diberikan oleh koordinat pemain dan sudut pandang, dan blok yang ditentukan oleh koordinat dan ukuran (konstan, untuk kesederhanaan). Selanjutnya, Anda harus memilih transfer terdekat dan mengembalikannya. Di bawah ini adalah kode yang sesuai (Kode lengkap ada di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">block_cross</span>(<span class="hljs-params">i, j, k, y_0, alpha, player</span>):</span>
    <span class="hljs-comment"># cell coordinates</span><font></font>
    x_cell = i * H<font></font>
    y_cell = j * H<font></font>
    <span class="hljs-comment"># find collision points</span><font></font>
    collisions = []<font></font>
<font></font>
    <span class="hljs-keyword">if</span> k != <span class="hljs-number">0</span>:<font></font>
        x = (y_cell - y_0) / k<font></font>
        y = y_cell<font></font>
        <span class="hljs-keyword">if</span> x_cell &lt;= x &lt;= x_cell + H <span class="hljs-keyword">and</span> (x - player.x) / cos(alpha) &lt; <span class="hljs-number">0</span>:<font></font>
            collisions.append((x, y))<font></font>
<font></font>
    <span class="hljs-keyword">if</span> k != <span class="hljs-number">0</span>:<font></font>
        x = (y_cell + H - y_0) / k<font></font>
        y = y_cell + H<font></font>
        <span class="hljs-keyword">if</span> x_cell &lt;= x &lt;= x_cell + H <span class="hljs-keyword">and</span> (x - player.x) / cos(alpha) &lt; <span class="hljs-number">0</span>:<font></font>
            collisions.append((x, y))<font></font>
<font></font>
    x = x_cell<font></font>
    y = y_0 + x * k<font></font>
    <span class="hljs-keyword">if</span> y_cell &lt;= y &lt;= y_cell + H <span class="hljs-keyword">and</span> (x - player.x) / cos(alpha) &lt; <span class="hljs-number">0</span>:<font></font>
        collisions.append((x, y))<font></font>
<font></font>
    x = x_cell + H<font></font>
    y = y_0 + (x) * k<font></font>
    <span class="hljs-keyword">if</span> y_cell &lt;= y &lt;= y_cell + H <span class="hljs-keyword">and</span> (x - player.x) / cos(alpha) &lt; <span class="hljs-number">0</span>:<font></font>
        collisions.append((x, y))<font></font>
<font></font>
    <span class="hljs-comment"># select the closest collision for the block</span>
    dist = <span class="hljs-number">1000</span> * H<font></font>
    x = <span class="hljs-literal">None</span>
    y = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">for</span> collision <span class="hljs-keyword">in</span> collisions:<font></font>
        tmp = sqrt((collision[<span class="hljs-number">0</span>] - player.x) ** <span class="hljs-number">2</span> + (collision[<span class="hljs-number">1</span>] - player.y) ** <span class="hljs-number">2</span>)
        <span class="hljs-keyword">if</span> tmp &lt; dist:<font></font>
            dist = tmp;<font></font>
            x = collision[<span class="hljs-number">0</span>]<font></font>
            y = collision[<span class="hljs-number">1</span>]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> x, y, dist
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perubahan sepele seperti 10 baris memberikan akselerasi lebih dari dua kali lipat, yaitu sekitar 5-6 frame per detik. </font><font style="vertical-align: inherit;">Ini bukan lagi tersentak, tetapi gambar bergerak, tetapi masih cukup lambat. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mencari ide tentang mempercepat kode, saya menemukan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cython</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Singkatnya, ini adalah proyek yang memungkinkan Anda untuk memberikan akselerasi signifikan kode python tanpa secara serius mengubahnya. </font><font style="vertical-align: inherit;">Secara singkat tentang dia - di bawah spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tyts</font></font></b><div class="spoiler_text"><pre><code class="python hljs"> cpdef int fun(int num, float val):<font></font>
    cdef int result<font></font>
    <span class="hljs-comment"># do some stuff</span>
    <span class="hljs-keyword">return</span> result
</code></pre><br>
    result  int( int,    ,  ).    ,    .      python-,      cdef â€”        python,   cython.           ,   python â€” , :<br>
<br>
<pre><code class="python hljs"> cpdef int fun(int num, float val):<font></font>
    cdef int result<font></font>
    <span class="hljs-comment"># do some stuff</span>
    <span class="hljs-keyword">return</span> result<font></font>
<font></font>
 cdef int fun2(int *arr, float* arr_2):<font></font>
    cdef int arr_3[<span class="hljs-number">10</span>][<span class="hljs-number">10</span>]
    <span class="hljs-comment"># do some stuff</span>
    <span class="hljs-keyword">return</span> result
</code></pre><br>
 fun2     python,     -  fun â€”  .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cython memberikan beberapa akselerasi, meskipun tidak signifikan - tidak hanya beberapa frame per detik. </font><font style="vertical-align: inherit;">Namun, dalam jumlah relatif ini tidak begitu kecil - 8-9 gambar per detik, yaitu + 40% untuk opsi terbaik dalam python dan + 200% untuk opsi dengan algoritma naif. </font><font style="vertical-align: inherit;">Ini masih gambaran yang sangat gugup, tetapi normal untuk tujuan pendidikan. </font><font style="vertical-align: inherit;">Pada akhirnya, tujuan kami adalah untuk menulisnya sendiri dan menikmati prosesnya, tetapi untuk permainan sebenarnya lebih mudah untuk mengambil perpustakaan seperti pygame, atau umumnya menyisihkan python dan mengambil sesuatu yang lebih cocok. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Akan menarik untuk melihat opsi lain untuk mengoptimalkan kode di komentar.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id487550/">https://habr.com/ru/post/id487550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487538/index.html">.NET Interactive ada di sini! | Pratinjau NET Notebook. 2</a></li>
<li><a href="../id487540/index.html">HighLoad ++, Anastasia Tsymbalyuk, Stanislav Tselovalnikov (Sberbank): bagaimana kami menjadi MDA</a></li>
<li><a href="../id487542/index.html">PRESENT - Enkripsi Blok Sangat Ringan (terjemahan dari PRESENT asli: Sandi Blok Sangat Ringan)</a></li>
<li><a href="../id487544/index.html">Dokumentasi .NET: Apa yang Baru untuk Januari</a></li>
<li><a href="../id487548/index.html">Eksperimen Baru: Memanggil .NET gRPC Services dari Browser dengan gRPC-Web</a></li>
<li><a href="../id487552/index.html">Swift 5.2 - apa yang baru?</a></li>
<li><a href="../id487556/index.html">Berita dari dunia OpenStreetMap No. 497 (01/21 / 2020-27.01.2020)</a></li>
<li><a href="../id487558/index.html">Paul Graham: Anak-Anak dan Startup</a></li>
<li><a href="../id487560/index.html">Bank of America: Kapitalisasi Yandex akan tumbuh sebesar $ 1,4 miliar</a></li>
<li><a href="../id487564/index.html">Paul Graham: "Gagasan Terbaik dalam Pikiran Anda"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>