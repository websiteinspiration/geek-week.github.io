<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçµ üë©üèø‚Äçü§ù‚Äçüë©üèº üêú The domain corp.com is for sale. It is dangerous for hundreds of thousands of corporate computers running Windows ü¶Ü üî® üí™üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Scheme of data leakage through Web Proxy Auto-Discovery (WPAD) in case of name collision (in this case, the collision of the internal domain with the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>The domain corp.com is for sale. It is dangerous for hundreds of thousands of corporate computers running Windows</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/488036/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/qu/ai/hv/quaihvjfjeapqx5lgq2hfvmqov4.png"></a><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheme of data leakage through Web Proxy Auto-Discovery (WPAD) in case of name collision (in this case, the collision of the internal domain with the name of one of the new gTLDs, but the essence is the same). Source: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">University of Michigan study</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , 2016.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Mike O'Connor, one of the oldest domain name investors,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puts up the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> most dangerous and controversial lot in his collection: the</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corp.com</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> domain</font><font style="vertical-align: inherit;">for $ 1.7 million. In 1994, O'Connor bought a lot of simple ones. domain names such as grill.com, place.com, pub.com and others. Among them was corp.com, which Mike kept for 26 years. The investor is already 70 years old and he decided to monetize his long-standing investments.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The whole problem is that corp.com is potentially dangerous for at least 375,000 corporate computers because of the careless configuration of Active Directory during the construction of corporate intranets in the early 2000s based on Windows Server 2000, when the internal root was simply indicated as ‚Äúcorp‚Äù. Until the early 2010s, this was not a problem, but with the increasing number of laptops in the business environment, more and more employees began to move their work computers outside the corporate network. Features of the Active Directory implementation lead to the fact that even without a direct user request to // corp, a number of applications (for example, mail) knock at a familiar address on their own. But in the case of an external network connection in a conditional cafe around the corner, this leads to the fact that the flow of data and requests flows to </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp.com</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now O'Connor really hopes that Microsoft will buy the domain itself and, </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the best traditions of Google, will rot it somewhere in a dark and inaccessible place for outsiders, the</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problem with such a fundamental vulnerability of Windows networks will be solved.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory and name collision</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On enterprise networks, Windows uses the Active Directory directory service. It allows administrators to use group policies to ensure uniform customization of the user work environment, deploy software on multiple computers through group policies, perform authorization, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Active Directory is integrated with DNS and runs on top of TCP / IP. To search for nodes within the network, the protocol uses the Web Proxy Auto-Discovery (WAPD) protocol and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS name devolution function</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (built into the Windows DNS Client). This feature makes it easy to find other computers or servers without having to specify a fully qualified domain name. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, if a company manages an internal network named</font></font><code>internalnetwork.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the employee wants to access the shared drive under the name </font></font><code>drive1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, there is no need to enter </font></font><code> drive1.internalnetwork.example.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Explorer, just type \\ drive1 \ - and the Windows DNS client itself will add the name. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In earlier versions of Active Directory - for example, in Windows 2000 Server - the second level of the corporate domain was specified by default </font></font><code>corp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. And many companies have kept the default value for their internal domain. Even worse, many have begun to build vast networks on top of this erroneous setup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the days of desktop computers, this did not present a particular security problem, because no one pulled these computers out of the corporate network. But what happens when an employee working in a company with a network path</font></font><code>corp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Active Directory takes a corporate laptop - and goes to the local Starbucks? Then the Web proxy auto-discovery (WPAD) proxy protocol and DNS name devolution function come into effect. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/kp/jj/ockpjj4sri-l0oqpjzyfsaqqh5e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is likely that some services on the laptop will continue to knock on the internal domain </font></font><code>corp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but will not find it, and instead, requests will resolve to the corp.com domain from the open Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In practice, this means that the owner of corp.com can passively intercept private requests from hundreds of thousands of computers that accidentally go beyond the corporate environment that uses the designation </font></font><code>corp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for their domain in Active Directory. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/ud/dt/tquddt1gldqkiu27oisq_mqsevu.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leak of WPAD requests in American traffic. From a study by the University of Michigan in 2016, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">source</font></font></a></font></i> <br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why domain is not sold yet</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2014, ICANN experts published a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">large study of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DNS name collisions. </font><font style="vertical-align: inherit;">The study was partially funded by the US Department of Homeland Security because leaks from internal networks threaten not only commercial companies, but also government organizations, including secret services, intelligence agencies, and army units. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mike wanted to sell corp.com last year, but researcher Jeff Schmidt convinced him to postpone the sale based on just the above report. </font><font style="vertical-align: inherit;">The study also found that daily 375,000 computers are trying to contact corp.com without the knowledge of the owners. </font><font style="vertical-align: inherit;">The requests contained attempts to enter corporate intranets and gain access to networks or file resources.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As part of his own experiment, Schmidt, together with JAS Global, imitated on corp.com a method of processing files and requests that uses a local Windows network. With this, they, in fact, opened a portal to hell for any information security specialist:</font></font><br>
<br>
<blockquote>  .     15    [ ] .   ,   JAS   , ,      ¬´   ¬ª,        .<br>
<br>
[     corp.com]       12   ,    .      ,  ,       [ ]          .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schmidt believes that for decades, administrators all over the world have been preparing the most dangerous botnet in history. </font><font style="vertical-align: inherit;">Hundreds of thousands of full-fledged working computers around the world are ready not only to become part of the botnet, but also to provide confidential data about their owners and companies. </font><font style="vertical-align: inherit;">All you need to use it is to control corp.com. </font><font style="vertical-align: inherit;">In this case, any machine that is once connected to the corporate network, whose Active Directory was configured through // corp, becomes a part of the botnet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft "scored" the problem 25 years ago</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you think that MS seemed to be unaware of the ongoing bacchanalia around corp.com, then you are seriously mistaken. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://web.archive.org/web/19971016071741/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mike trolled Microsoft and personally Bill Gates back in 1997</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with a page that brought users of FrontPage '97 beta version to corp.com as the default URL: </font><font style="vertical-align: inherit;">
When Mike got tired of it, corp.com began to redirect users to the sex shop site. In response, he received thousands of angry letters from users, which he redirected through a copy to Bill Gates. </font><font style="vertical-align: inherit;">
By the way, Mike himself, out of curiosity, picked up the mail server and received confidential letters on corp.com. He tried to solve these problems by contacting companies, but they simply did not know how to fix the situation:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/7d/5h/5o/7d5h5o_zzm7l48efs_7d0h3qh0e.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<blockquote>       ,                ,        .       ,      ,    .   , ,    [ ].<br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the side of MS, active actions were not taken, and the company refuses to comment on the situation. Yes, Microsoft over the years has released several Active Directory updates that partially solve the problem of domain name collisions, but they have a number of problems. The company also issued </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recommendations</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on setting up internal domain names, recommendations on owning a second-level domain in order to avoid conflicts, and other tutorials that are usually not read.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But the most important thing is in the updates. </font><font style="vertical-align: inherit;">First: to apply them, you must completely put the company's intranet. </font><font style="vertical-align: inherit;">Second: some applications after such updates may start working more slowly, incorrectly, or stop working altogether. </font><font style="vertical-align: inherit;">It is clear that most companies with a well-established corporate network will not take such risks. </font><font style="vertical-align: inherit;">In addition, many of them do not even realize the full extent of the threat, which is fraught with a redirect of everything and everything on corp.com when moving a machine outside the internal network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The maximum irony is achieved when you look at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schmidt‚Äôs report on the investigation of domain name conflicts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">So, according to his data, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some requests to corp.com come from the intranet of Microsoft itself.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/io/wz/ds/iowzdsubybg7lewxuzpxdrbcyaa.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And what will happen next?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It would seem that the solution to this situation lies on the surface and was described at the beginning of the article: let Microsoft buy its domain from Mike and ban it somewhere in the back of the closet forever. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But not so simple. </font><font style="vertical-align: inherit;">Microsoft was offering O'Connor to buy his toxic domain for companies around the world a few years ago. </font><font style="vertical-align: inherit;">Just </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offered the giant to close such a hole in their own networks of only $ 20 thousand</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the domain is billed for $ 1.7 million. And even if Microsoft decides to buy it at the last moment, will it be in time?</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/eo/dx/cq/eodxcqr_jt4-i2h7pybvhg_n7gq.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en488024/index.html">Fantastic advisory locks and where they live</a></li>
<li><a href="../en488026/index.html">Jewelery, Formlabs 3D Printer and Environmental Care</a></li>
<li><a href="../en488028/index.html">How to start making a game in UE4</a></li>
<li><a href="../en488030/index.html">How to organize skins in symfony</a></li>
<li><a href="../en488034/index.html">What can be done in 48 hours? Interview with the BioHack 2019 bioinformatics hackathon winner</a></li>
<li><a href="../en488038/index.html">Surprise Basket - Save Our Push</a></li>
<li><a href="../en488042/index.html">10/50/99: how to give feedback</a></li>
<li><a href="../en488046/index.html">The book "Development using quantum computers"</a></li>
<li><a href="../en488048/index.html">To illuminate with a searchlight. How to get maximum impact on "social" hackathons?</a></li>
<li><a href="../en488050/index.html">Amazon Neptune First Impressions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>