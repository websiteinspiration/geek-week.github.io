<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏂🏼 🏁 ☃️ 動的配列とカスタムコレクションクラスを操作するためのルール 🤴 🛌🏻 👛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="動的配列とカスタムコレクションクラスを操作
 するためのルール以下は、動的配列を操作するときに遵守するルールです。実際、これは配列を設計するためのガイドですが、すべてのオブジェクト指向言語が動的配列を持っているわけではないため、オブジェクトを設計するためのガイドに入れたくありませんでした。サンプルは...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>動的配列とカスタムコレクションクラスを操作するためのルール</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/484336/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/qy/hx/3d/qyhx3dbaepmsxkx2azb_tmi9dee.jpeg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動的配列とカスタムコレクションクラスを操作</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
するためのルール以下は、動的配列を操作するときに遵守するルールです。</font><font style="vertical-align: inherit;">実際、これは配列を設計するためのガイドですが、すべてのオブジェクト指向言語が動的配列を持っているわけではないため、オブジェクトを設計するためのガイドに入れたくありませんでした。</font><font style="vertical-align: inherit;">サンプルはPHPで記述されていますが、これはJava（すでにご存じかもしれません）に似ていますが、組み込みのコレクションクラスやインターフェースではなく、動的配列を使用しています。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列をリストとして使用する</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのアイテムは同じタイプでなければなりません。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列をリスト（特定の順序での値のコレクション）として使用する場合、すべての値は同じタイプである必要があります。</font></font><br>
<br>
<pre><code class="php hljs">$goodList = [
    <span class="hljs-string">'a'</span>,
    <span class="hljs-string">'b'</span><font></font>
];<font></font>
<font></font>
$badList = [<font></font>
    <span class="hljs-string">'a'</span>,
    <span class="hljs-number">1</span>
];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注釈型リストの一般的なスタイル：</font></font><code>@var array&lt;TypeOfElment&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">インデックスタイプは追加しないでください</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">常ににする必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各要素のインデックスを無視する必要があります</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPは各リスト項目（0、1、2など）に対して新しいインデックスを自動的に作成します。</font><font style="vertical-align: inherit;">ただし、これらのインデックスに依存したり、直接使用したりしないでください。</font><font style="vertical-align: inherit;">クライアントは</font></font><code>iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">プロパティにのみ依存できます</font></font><code>countable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって</font><font style="vertical-align: inherit;">、</font></font><code>foreach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font><font style="vertical-align: inherit;">を自由に使用できますが</font><font style="vertical-align: inherit;">、リストアイテムの循環的な作業に</font></font><code>count()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は使用しないでください</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">// Good loop:</span>
<span class="hljs-keyword">foreach</span> ($list <span class="hljs-keyword">as</span> $element) {<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Bad loop (exposes the index of each element):</span>
<span class="hljs-keyword">foreach</span> ($list <span class="hljs-keyword">as</span> $index =&gt; $element) {<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Also bad loop (the index of each element should not be used):</span>
<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; count($list); $i++) {<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPでは</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、リストにインデックスがない場合、または要素数よりも多くのインデックスがある場合</font><font style="vertical-align: inherit;">、ループ</font><font style="vertical-align: inherit;">がまったく機能しない可能性があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテムを削除する代わりにフィルターを使用する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックス（</font></font><code>unset()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）で</font><font style="vertical-align: inherit;">アイテムを削除することもできますが</font><font style="vertical-align: inherit;">、削除するのでは</font></font><code>array_filter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なく、不要なアイテムのない新しいリスト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">することをお勧めし</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しになりますが、要素のインデックスに依存するべきではありません。</font><font style="vertical-align: inherit;">その</font></font><code>array_filter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用する場合</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">は、フラグパラメータ</font></a><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">、</font></a><font style="vertical-align: inherit;">要素をインデックスでフィルタリングしたり、要素とインデックスでフィルタリングしたり</font><font style="vertical-align: inherit;">しない</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">// Good filter:</span><font></font>
array_filter(<font></font>
    $list, <font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> $element</span>): <span class="hljs-title">bool</span> </span>{ 
        <span class="hljs-keyword">return</span> strlen($element) &gt; <span class="hljs-number">2</span>; <font></font>
    }<font></font>
);<font></font>
<font></font>
<span class="hljs-comment">// Bad filter (uses the index to filter elements as well)</span><font></font>
array_filter(<font></font>
    $list, <font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">int</span> $index</span>): <span class="hljs-title">bool</span> </span>{ 
        <span class="hljs-keyword">return</span> $index &gt; <span class="hljs-number">3</span>;<font></font>
    },<font></font>
    ARRAY_FILTER_USE_KEY<font></font>
);<font></font>
<font></font>
<span class="hljs-comment">// Bad filter (uses both the index and the element to filter elements)</span><font></font>
array_filter(<font></font>
    $list, <font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> $element, <span class="hljs-keyword">int</span> $index</span>): <span class="hljs-title">bool</span> </span>{ 
        <span class="hljs-keyword">return</span> $index &gt; <span class="hljs-number">3</span> || $element === <span class="hljs-string">'Include'</span>;<font></font>
    },<font></font>
    ARRAY_FILTER_USE_BOTH<font></font>
);<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連想配列としての配列の使用</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーが関連性があり、インデックス（0、1、2など）ではない場合、連想配列（一意のキーによって値を抽出できるコレクション）を自由に使用します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのキーは同じタイプでなければなりません。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
連想配列を使用する最初のルール：すべてのキーは同じタイプでなければなりません（ほとんどの場合、これは</font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="php hljs">$goodMap = [
    <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-string">'bar'</span>,
    <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-string">'baz'</span><font></font>
];<font></font>
<font></font>
<span class="hljs-comment">// Bad (uses different types of keys)</span><font></font>
$badMap = [<font></font>
    <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-string">'bar'</span>,
    <span class="hljs-number">1</span> =&gt; <span class="hljs-string">'baz'</span><font></font>
];<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての値は同じタイプでなければなりません。</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことが値に適用されます。値は同じタイプである必要があります。</font></font><br>
<br>
<pre><code class="php hljs">$goodMap = [
    <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-string">'bar'</span>,
    <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-string">'baz'</span><font></font>
];<font></font>
<font></font>
<span class="hljs-comment">// Bad (uses different types of values)</span><font></font>
$badMap = [<font></font>
    <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-string">'bar'</span>,
    <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-number">1</span>
];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注釈タイプの一般的なスタイル：</font></font><code>@var array&lt;TypeOfKy, TypeOfValue&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">連想配列はプライベートのままにする必要があります</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストは、その特性が単純であるため、オブジェクト間で安全に転送できます。</font><font style="vertical-align: inherit;">リストが空の場合でも、クライアントは要素を循環またはカウントできます。</font><font style="vertical-align: inherit;">クライアントはどの値とも一致しないキーに依存できるため、マップの操作はより困難です。</font><font style="vertical-align: inherit;">これは、通常、連想配列は、それらを管理するオブジェクトに関してプライベートのままである必要があることを意味しています。</font><font style="vertical-align: inherit;">クライアントが内部マッピングに直接アクセスできるようにする代わりに、ゲッター（場合によってはセッター）に値を取得させます。</font><font style="vertical-align: inherit;">要求されたキーの値がない場合は、例外をスローします。</font><font style="vertical-align: inherit;">ただし、マップとその値を完全に非公開にできる場合は、それを行ってください。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-comment">// Exposing a list is fine</span><font></font>
<font></font>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> array&lt;User&gt;
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allUsers</span>(<span class="hljs-params"></span>): <span class="hljs-title">array</span>
</span>{
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Exposing a map may be troublesome</span><font></font>
<font></font>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> array&lt;string, User&gt;
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">usersById</span>(<span class="hljs-params"></span>): <span class="hljs-title">array</span>
</span>{ 
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Instead, offer a method to retrieve a value by its key</span><font></font>
<font></font>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@throws</span> UserNotFound
 */</span> 
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">userById</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $id</span>): <span class="hljs-title">User</span>
</span>{ 
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複数のタイプの値を持つ連想配列としてオブジェクトを使用する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
連想配列を使用したいが、その中に異なるタイプの値を格納したい場合は、オブジェクトを使用してください。</font><font style="vertical-align: inherit;">クラスの定義、パブリックタイププロパティの追加、またはコンストラクターとゲッターの追加。</font><font style="vertical-align: inherit;">このようなオブジェクトには、構成またはコマンドオブジェクトが含まれます。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SillyRegisterUserCommand</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> $username;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> $plainTextPassword;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> $wantsToReceiveSpam;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> $answerToIAmNotARobotQuestion;<font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルールの例外</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリとフレームワークでは、配列をより動的に使用する必要がある場合があります。</font><font style="vertical-align: inherit;">次に、以前のルールに従うことは不可能です（そして望ましくありません）。</font><font style="vertical-align: inherit;">例としては、</font><font style="vertical-align: inherit;">データベーステーブルに保存されている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">配列</font></a><font style="vertical-align: inherit;">、Symfonyの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーム構成</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">あります</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムコレクションクラス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カスタムコレクションクラスは</font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>ArrayAccess</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびその他のエンティティ</font><font style="vertical-align: inherit;">を操作するための優れたツールですが、</font><font style="vertical-align: inherit;">コードが混乱することがよくあります。</font><font style="vertical-align: inherit;">初めてコードを見る人は、経験豊富な開発者であっても、PHPマニュアルを参照する必要があります。</font><font style="vertical-align: inherit;">さらに、維持する必要があるより多くのコード（テスト、デバッグなど）を記述する必要があります。</font><font style="vertical-align: inherit;">したがって、ほとんどの場合、正しい型注釈を持つ単純な配列で十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
配列をカスタムコレクションオブジェクトでラップする必要があることを何が示していますか？</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列に関連するロジックの複製。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントは、配列の内容について非常に多くの詳細を処理する必要があります。</font></font><br>
</li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムコレクションクラスを使用して、ロジックの重複を防ぎます。</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じ配列を使用する複数のクライアントが同じタスク（たとえば、フィルター、比較、削減、カウント）を実行する場合、カスタムコレクションクラスを使用して重複を削除できます。</font><font style="vertical-align: inherit;">重複したロジックをコレクションクラスメソッドに転送すると、クライアントはコレクションメソッドを呼び出すだけで同じタスクを実行できます。</font></font><br>
<br>
<pre><code class="php hljs">$names = [<span class="hljs-comment">/* ... */</span>];<font></font>
<font></font>
<span class="hljs-comment">// Found in several places:</span><font></font>
$shortNames = array_filter(<font></font>
    $names, <font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> $element</span>): <span class="hljs-title">bool</span> </span>{ 
        <span class="hljs-keyword">return</span> strlen($element) &lt; <span class="hljs-number">5</span>; <font></font>
    }<font></font>
);<font></font>
<font></font>
<span class="hljs-comment">// Turned into a custom collection class:</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Assert</span>\<span class="hljs-title">Assert</span>;<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Names</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> array&lt;string&gt;
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">array</span> $names;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $names</span>)
    </span>{<font></font>
        Assert::that()-&gt;allIsString($names);<font></font>
        <span class="hljs-keyword">$this</span>-&gt;names = $names;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shortNames</span>(<span class="hljs-params"></span>): <span class="hljs-title">self</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>(<font></font>
            array_filter(<font></font>
                <span class="hljs-keyword">$this</span>-&gt;names, 
                <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-keyword">string</span> $element</span>): <span class="hljs-title">bool</span> </span>{ 
                    <span class="hljs-keyword">return</span> strlen($element) &lt; <span class="hljs-number">5</span>; <font></font>
                }<font></font>
            )<font></font>
        );<font></font>
    }<font></font>
}<font></font>
<font></font>
$names = <span class="hljs-keyword">new</span> Names([<span class="hljs-comment">/* ... */</span>]);<font></font>
$shortNames = $names-&gt;shortNames();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドを使用してコレクションを変換する利点は、この変換に名前が付けられることです。</font><font style="vertical-align: inherit;">簡単でわかりやすい名前を通話</font></font><code>array_filter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">追加でき</font><font style="vertical-align: inherit;">ます。そうしないと、見つけるのが非常に難しくなります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムコレクションクラスを使用して顧客のバインドを解除する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントが配列を循環し、選択された要素からデータの一部を取り、それらを使って何かを行う場合、このクライアントは、対応するすべての型（配列、要素、取得された値、セレクターメソッドなど）に密接に関連付けられます。このようなディープバインディングのため、クライアントを壊さずにこれらのタイプに関連するものを変更することははるかに困難になります。</font><font style="vertical-align: inherit;">この場合、配列をカスタムコレクションクラスでラップして正しい答えを出すこともできます。その場合、必要な計算を内部で実行し、クライアントのコレクションへのバインディングを緩めます。</font></font><br>
<br>
<pre><code class="php hljs">$lines = [];<font></font>
<font></font>
$sum = <span class="hljs-number">0</span>;
<span class="hljs-keyword">foreach</span> ($lines <span class="hljs-keyword">as</span> $line) {
    <span class="hljs-keyword">if</span> ($line-&gt;isComment()) {
        <span class="hljs-keyword">continue</span>;<font></font>
    }<font></font>
<font></font>
    $sum += $line-&gt;quantity();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Turned into a custom collection class:</span><font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lines</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">totalQuantity</span>(<span class="hljs-params"></span>): <span class="hljs-title">int</span>
    </span>{<font></font>
        $sum = <span class="hljs-number">0</span>;<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span> ($lines <span class="hljs-keyword">as</span> $line) {
            <span class="hljs-keyword">if</span> ($line-&gt;isComment()) {
                <span class="hljs-keyword">continue</span>;<font></font>
            }<font></font>
<font></font>
            $sum += $line-&gt;quantity();<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> $sum;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムコレクションクラスのいくつかのルール</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを不変にする</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような変換を実行する場合、コレクションインスタンスへの既存の参照は影響を受けません。</font><font style="vertical-align: inherit;">したがって、この変換を実行するメソッドは、前の例で見たように、クラスの新しいインスタンスを返す必要があります。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Names</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> array&lt;string&gt;
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">array</span> $names;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $names</span>)
    </span>{<font></font>
        Assert::that()-&gt;allIsString($names);<font></font>
        <span class="hljs-keyword">$this</span>-&gt;names = $names;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shortNames</span>(<span class="hljs-params"></span>): <span class="hljs-title">self</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>(
            <span class="hljs-comment">/* ... */</span><font></font>
        );<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、内部配列を変換すると、別のタイプのコレクションまたは単純な配列に変換できます。</font><font style="vertical-align: inherit;">通常どおり、正しいタイプが返されることを確認してください。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客が本当に必要とする行動のみを提供する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニバーサルコレクションを含むライブラリからクラスを拡張するか、ユニバーサルフィルターまたはマップを実装する代わりに、カスタムコレクションクラスごとに削減するのではなく、本当に必要なものだけを実装します。</font><font style="vertical-align: inherit;">ある時点でメソッドの使用を停止した場合は、それを削除してください。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IteratorAggregateおよびArrayIteratorを使用して反復する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPを使用する場合は、インターフェースのすべてのメソッドを実装するのではなく</font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（内部ポインターを保存するなど）、インターフェースのみを実装</font><font style="vertical-align: inherit;">し、内部配列に基づいて</font></font><code>IteratorAggregate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インスタンス</font></font><code>ArrayIterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返すようにします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Names</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IteratorAggregate</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> array&lt;string&gt;
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">array</span> $names;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $names</span>)
    </span>{<font></font>
        Assert::that()-&gt;allIsString($names);<font></font>
        <span class="hljs-keyword">$this</span>-&gt;names = $names;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIterator</span>(<span class="hljs-params"></span>): <span class="hljs-title">Iterator</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayIterator</span>(<span class="hljs-keyword">$this</span>-&gt;names);<font></font>
    }<font></font>
}<font></font>
<font></font>
$names = <span class="hljs-keyword">new</span> Names([<span class="hljs-comment">/* ... */</span>]);<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> ($names <span class="hljs-keyword">as</span> $name) {
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥協</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カスタムコレクションクラス用により多くのコードを記述しているので、クライアントはこの配列（配列だけでなく）を使用する方が簡単です。</font><font style="vertical-align: inherit;">クライアントコードがより明確になり、コレクションが有用な動作を提供する場合、これはカスタムコレクションクラスを維持するための余分な労力を正当化します。</font><font style="vertical-align: inherit;">しかし、動的配列の操作は非常に簡単なので（主に、使用する型を指定する必要がないため）、コレクションクラスを使用することはほとんどありません。</font><font style="vertical-align: inherit;">ただし、一部の開発者は積極的にそれらを使用しているため、今後も可能な使用例を探し続けます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484326/index.html">ジャンプトレーディングでロンドンまたはインターンシップにジャンプ</a></li>
<li><a href="../ja484328/index.html">Paul Grahamが新しいBelプログラミング言語を発表</a></li>
<li><a href="../ja484330/index.html">[Nginx] response_status = 0に勝つ方法</a></li>
<li><a href="../ja484332/index.html">タスク管理に焦点を当てます。管理システムの方法</a></li>
<li><a href="../ja484334/index.html">Kubernetes作業ノード：多くの小規模または大規模のノード？</a></li>
<li><a href="../ja484338/index.html">サムスンのネオンプロジェクト：デジタルバンカー、TVホスト、コンパニオン</a></li>
<li><a href="../ja484340/index.html">1月17日のJavaダイジェスト。新年の最初の2週間</a></li>
<li><a href="../ja484342/index.html">「Toradex Colibri T20（Linux）」用のEclipseおよびGTK +に基づくツールキット</a></li>
<li><a href="../ja484344/index.html">Kubernetesの3レベルの自動スケーリング：それらを効果的に使用する方法</a></li>
<li><a href="../ja484358/index.html">Rのポートフォリオ管理</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>