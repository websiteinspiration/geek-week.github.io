<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📈 🧤 🧗 Debian 10を搭載したラップトップ上のSOCKSでルーターを構築する 🏢 🖐🏽 🤱🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="丸1年（または2年）この主な理由でこの記事の公開を延期しました-私はすでに2つの記事を公開しています。この記事では、Debianを搭載した通常のラップトップからSOCKSにルーターを作成するプロセスについて説明しました。
 
 しかし、それ以来、Debianの安定バージョンがBusterに更新され、...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Debian 10を搭載したラップトップ上のSOCKSでルーターを構築する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丸1年（または2年）この主な理由でこの記事の公開を延期しました-私はすでに2つの記事を公開しています。この記事では、Debianを搭載した通常のラップトップからSOCKSにルーターを作成するプロセスについて説明しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、それ以来、Debianの安定バージョンがBusterに更新され、十分な数の人々から設定を手伝ってほしいという個人的なリクエストが送られてきました。まあ、私自身、それらに記載されている方法では、LinuxをSOSKSでルーティングするように構成するためのすべての複雑さを完全には明らかにしていないと推測しました。さらに、これらはDebian Stretch用に作成されたもので、バスターにアップグレードした後、systemd初期化システムで、サービスの相互作用に小さな変更が見られました。はい、そして記事自体では、systemd-networkdは使用しませんでしたが、複雑なネットワーク構成に最適です。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の変更に加えて、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのサービスが私の構成に追加されました</font><font style="vertical-align: inherit;">-アクセスポイント仮想化のためのサービス</font><font style="vertical-align: inherit;">、ローカルネットワーククライアントの時刻を同期するための</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">DNS接続を暗号化し</font><font style="vertical-align: inherit;">、ローカルネットワーククライアントでの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドバタイズ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を無効にするための</font><b><font style="vertical-align: inherit;">dnscrypt-proxy</font></b><font style="vertical-align: inherit;">、および前述のとおり以前は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でネットワークインターフェースを設定していました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなルータの内部構造の最も単純なブロック図は次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/eq/_f/gyeq_fcjwxnobupmbqn9b-hwqqk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから、私はこれらの記事のサイクルの目的が何であるかを思い出させます：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのOS接続をSOCKSにルーティングし、ラップトップと同じネットワーク上にあるすべてのデバイスの接続もルーティングします。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の場合、ラップトップは完全にモバイルのままである必要があります。</font><font style="vertical-align: inherit;">つまり、デスクトップ環境を使用する機会を与え、物理的な場所に縛られないようにします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後のポイントは、組み込みのワイヤレスインターフェイスを介した接続とルーティングのみです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">もちろん、網羅的なガイドの作成と、私の適度な知識の範囲内での適切なテクノロジーの分析。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で考慮される内容：</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gitの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ダウンロードtun2socksは、プロジェクト</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のリポジトリ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SOCKSへのルートのTCPトラフィックに必要な、と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_apを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -使用して仮想アクセスポイントの設定を自動化するスクリプト</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapdを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスをビルドしてシステムにインストールします</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレスおよび仮想インターフェース、静的ルーティングテーブル、およびパケット転送を構成します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムにsystemdサービスをインストールし、仮想アクセスポイントを構成して起動します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オプションの手順：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーをインストールして、仮想アクセスポイントのクライアントの時刻を同期するように構成します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -DNSクエリを暗号化し、SOCKSにルーティングして、ローカルネットワークのアドバタイズドメインを無効にします。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜこれなのか</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ローカルネットワーク上のTCP接続を保護する1つの方法です。主な利点は、元のゲートウェイを経由する静的ルートが構築されていない場合、すべての接続がSOCKSに行くことです。つまり、ローカルネットワーク上の個々のプログラムまたはクライアントにSOCKSサーバーの設定を指定する必要はありません。これらはすべて、デフォルトでSOCKSに移動します。これは、反対を指定するまでデフォルトのゲートウェイだからです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本質的に、元のルーターの前に2番目の暗号化ルーターをラップトップとして追加し、ラップトップの既に暗号化されたSOCKSリクエストに元のルーターのインターネット接続を使用します。これにより、ローカルネットワーククライアントのリクエストがルーティングされ、暗号化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロバイダーの観点からは、暗号化されたトラフィックで常に同じサーバーに接続されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、すべてのデバイスはラップトップの仮想アクセスポイントに接続します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始める前に</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどすべての設定は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socksをシステムにインストールします</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシンがインターネットに接続されている限り、必要なツールをすべてダウンロードします。</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br>
<pre><code class="bash hljs">apt install git make cmake</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
badvpnパッケージをダウンロードする</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/ambrop72/badvpn
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フォルダがシステムに表示されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">別のビルドフォルダーを作成する</font></font><br>
<br>
<pre><code class="bash hljs">mkdir badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼女に行きます</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">tun2socksを</font></i><font style="vertical-align: inherit;"> 
ビルド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font></i><br>
<br>
<pre><code class="bash hljs">cmake ../badvpn -DBUILD_NOTHING_BY_DEFAULT=1 -DBUILD_TUN2SOCKS=1
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムにインストール</font></font><br>
<br>
<pre><code class="bash hljs">make install
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-DBUILD_NOTHING_BY_DEFAULT =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 </font><font style="vertical-align: inherit;">パラメータ</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリのすべてのコンポーネントのアセンブリを無効にします</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBUILD_TUN2SOCKS = 1の場合</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アセンブリに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンポーネントが含まれます</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make </font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムの</font><i><font style="vertical-align: inherit;">/ usr / local / bin / badvpn-tun2socksに</font></i><i><font style="vertical-align: inherit;">tun2socks</font></i><font style="vertical-align: inherit;">バイナリ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">インストール</font><font style="vertical-align: inherit;">します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemdにtun2socksサービスをインストールする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の内容で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/tun2socks.service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイルを作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=SOCKS TCP Relay<font></font>
<font></font>
[Service]<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/badvpn-tun2socks --tundev tun2socks --netif-ipaddr 172.16.1.1 --netif-netmask 255.255.255.0 --socks-server-addr 127.0.0.1:9050<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--tundev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化する仮想インターフェースの名前を受け入れます</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--netif- </font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipaddr-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想インターフェースが接続されて</font><font style="vertical-align: inherit;">いる「ルーター」</font><i><font style="vertical-align: inherit;">tun2socksの</font></i><font style="vertical-align: inherit;">ネットワークアドレス</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">別の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予約済みサブネット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を作成することをお</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">勧めします</font></a><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--socks-server-addr-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソケットを受け入れます（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレス：</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SOCKSサーバー</font><i><font style="vertical-align: inherit;">ポート</font></i><font style="vertical-align: inherit;">）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたのSOCKSサーバーが認証を必要とする場合は、次のように指定することができ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--passwordパラメータを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、サービスを登録します</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、電源を入れます</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> tun2socks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを開始する前に、仮想ネットワークインターフェイスを提供します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdに移動します</font></font></h2><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
オンに</font><i><font style="vertical-align: inherit;">します</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のネットワークサービスを無効にします。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">disable</span> networking NetworkManager NetworkManager-wait-online</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkManager-wait-online</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がネットワークの可用性に応じて他のサービスを開始</font><i><font style="vertical-align: inherit;">し</font></i><font style="vertical-align: inherit;">続ける</font><font style="vertical-align: inherit;">前に、動作中のネットワーク接続を待機するサービス</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">アナログ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切り替えると、これは無効になり</font><font style="vertical-align: inherit;">ます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐにオンにしましょう：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd-wait-online</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレスネットワークインターフェイスをセットアップする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレスネットワークインターフェイス用の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
設定ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し</font><font style="vertical-align: inherit;">ます</font></font><code>/etc/systemd/network/25-wlp6s0.network</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=wlp6s0<font></font>
<font></font>
[Network]<font></font>
Address=192.168.1.2/24<font></font>
IPMasquerade=yes<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ワイヤレスインターフェイスの名前です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドで識別し</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPMasquerade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">ネットワークインターフェイスでの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスカレード</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とパケット転送</font><font style="vertical-align: inherit;">を含むディレクティブです</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ワイヤレスインターフェイスにIPアドレスを割り当てる責任があります。</font><font style="vertical-align: inherit;">同等のディレクティブ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP = yesを使用すると</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がシステムにデフォルトゲートウェイを作成する</font><font style="vertical-align: inherit;">ため、静的に指定します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その後、すべてのトラフィックは元のゲートウェイを通過し、優れたサブネットの将来の仮想インターフェイスを通過しません。</font><font style="vertical-align: inherit;">次のコマンドで現在のデフォルトゲートウェイを確認できます</font></font><pre><code class="bash hljs">ip r</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートSOCKSサーバーの静的ルートを作成する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SOCKSサーバーがローカルではなくリモートの場合は、静的ルートを作成する必要があります。</font><font style="vertical-align: inherit;">これを行うに</font><font style="vertical-align: inherit;">は、次の内容で作成したワイヤレス構成ファイルの最後に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=0.0.0.0<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲートウェイ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、元のアクセスポイントのデフォルトゲートウェイまたはアドレスです。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宛先</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -SOCKSサーバーのアドレス。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdのwpa_supplicantを構成する</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して安全なアクセスポイントに接続し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ワイヤレスインターフェースを「上げる」とすると、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がサービス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ nameを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はワイヤレスインターフェースの名前です。</font><font style="vertical-align: inherit;">この時点までに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><i><font style="vertical-align: inherit;">し</font></i><font style="vertical-align: inherit;">ていない場合</font><font style="vertical-align: inherit;">、特定の場合、このサービスはシステムで利用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、次のコマンドで作成します。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> wpa_supplicant@wlp6s0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワイヤレスインターフェイスの名前として</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用し</font><b><font style="vertical-align: inherit;">ました</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">あなたの名前は違うかもしれません。</font><font style="vertical-align: inherit;">あなたは彼のチームで見つけることができます</font></font><pre><code class="bash hljs">ip l</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、作成された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ wlp6s0サービス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ワイヤレスインターフェイスが「持ち上げられた」ときに開始</font><font style="vertical-align: inherit;">され</font><i><font style="vertical-align: inherit;">ますが</font></i><font style="vertical-align: inherit;">、今度はファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / wpa_supplicant / wpa_supplicant-wlp6s0で</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセスポイントのSSIDとパスワードを探し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_passphrase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティを使用して作成する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、次のコマンドを実行します。</font></font><br>
<br>
<pre><code class="bash hljs">wpa_passphrase SSID password&gt;/etc/wpa_supplicant/wpa_supplicant-wlp6s0.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はアクセスポイントの名前、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はパスワード、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はワイヤレスインターフェイスの名前です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socksの仮想インターフェースを初期化する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム内の新しい仮想インターフェースを初期化するためのファイルを作成します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.netdev</font></font></i><br>
<br>
<pre><code class="bash hljs">[NetDev]<font></font>
Name=tun2socks<font></font>
Kind=tun<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が初期化されるときに将来の仮想インターフェースに割り当てる</font><font style="vertical-align: inherit;">名前です</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">種類</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は仮想インターフェイスの一種です。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスの名前に基づいて、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tunの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ようなインターフェースを使用していると推測できます</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が仮想ネットワークインターフェースを初期化するために使用する</font><font style="vertical-align: inherit;">ファイル拡張子です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらのインターフェースのアドレスおよびその他のネットワーク設定は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルで</font><font style="vertical-align: inherit;">指定され</font><font style="vertical-align: inherit;">ます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の内容で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=tun2socks<font></font>
<font></font>
[Network]<font></font>
Address=172.16.1.2/24<font></font>
Gateway=172.16.1.1<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前</font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-netdev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルで</font><font style="vertical-align: inherit;">指定した仮想インターフェースの名前</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドレス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -仮想インターフェースに割り当てられるIPアドレス。</font><i><font style="vertical-align: inherit;">tun2socksで</font></i><font style="vertical-align: inherit;">指定したアドレスと同じネットワーク上にある必要があります</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲートウェイ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 「ルーター」のIPアドレス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成時に指定したこと</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にsystemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスを</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェース</font><font style="vertical-align: inherit;">のアドレスは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.1です</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。つまり、これは仮想インターフェースからのすべての接続のゲートウェイです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想アクセスポイントを構成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係をインストールします。</font></font><br>
<br>
<pre><code class="bash hljs">apt install util-linux procps hostapd iw haveged</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
リポジトリ</font><font style="vertical-align: inherit;">をマシンに</font><font style="vertical-align: inherit;">ダウンロード</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/oblique/create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシンのリポジトリフォルダーに移動します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムにインストールします。</font></font><br>
<br>
<pre><code class="bash hljs">make install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
config </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/create_ap.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がシステムに表示されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">編集の主なオプションは次のとおりです。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GATEWAY = 10.0.0.1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個別の予約済みサブネットを作成することをお勧めします。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNS = 1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このパラメーターは仮想systemd-networkdインターフェースによって制御されるため、オフにします。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNSMASQ = 1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ理由でオフにします。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIFI_IFACE = wlp6s0-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラップトップのワイヤレスインターフェイス。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNET_IFACE = tun2socks&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -のために作成された仮想インターフェイス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID = hostapd-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想アクセスポイントの名前。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PASSPHRASE = 12345678-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パスワード。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを有効にすることを忘れないでください：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> create_ap</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkdでDHCPサーバーを有効にする</font></font></h3><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
サービス</font><font style="vertical-align: inherit;">は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムの</font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">ap0</font></i><font style="vertical-align: inherit;">仮想インターフェースを初期化します</font><font style="vertical-align: inherit;">。理論的には、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsmasq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はこのインターフェース</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">ハングしますが</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に組み込みのDHCPサーバーが含まれている</font><font style="vertical-align: inherit;">場合、なぜ追加のサービスをインストールするの</font><font style="vertical-align: inherit;">ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを有効にするには、仮想ポイントのネットワーク設定を定義します。これを行うに</font><font style="vertical-align: inherit;">は、次の内容の</font><font style="vertical-align: inherit;">ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-ap0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=ap0<font></font>
<font></font>
[Network]<font></font>
Address=10.0.0.1/24<font></font>
DHCPServer=yes<font></font>
<font></font>
[DHCPServer]<font></font>
EmitDNS=yes<font></font>
DNS=10.0.0.1<font></font>
EmitNTP=yes<font></font>
NTP=10.0.0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスの後</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sreate_apが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想インターフェイスを初期化</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP0を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムD-NetworkDは、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動的にIPアドレスを割り当て、DHCPサーバを有効にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitDNS = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、アクセスポイントに接続されているデバイスにDNSサーバー設定を渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカルDNSサーバーを使用する予定がない場合-私の場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">設定でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ここで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は元のゲートウェイのアドレスです。次に、ホストとローカルネットワークのDNSクエリは、プロバイダーのサーバーを介して暗号化されません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitNTP =はい</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信NTP設定。</font><b><font style="vertical-align: inherit;">NTP = 10.0.0.1</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
という行についても同様</font><font style="vertical-align: inherit;">です。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTPサーバーのインストールと構成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムにインストールします。</font></font><br>
<br>
<pre><code class="bash hljs">apt install ntp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
config </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ntp.confを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">標準プールのアドレスをコメント化します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#pool 0.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 1.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 2.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 3.debian.pool.ntp.org iburst</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GoogleパブリックNTPなどのパブリックサーバーのアドレスを追加します。</font></font><br>
<br>
<pre><code class="bash hljs">server time1.google.com ibrust<font></font>
server time2.google.com ibrust<font></font>
server time3.google.com ibrust<font></font>
server time4.google.com ibrust<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークからクライアントにサーバーへのアクセスを許可します。</font></font><br>
<br>
<pre><code class="bash hljs">restrict 10.0.0.0 mask 255.255.255.0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロードキャストをネットワークに変換します。</font></font><br>
<br>
<pre><code class="bash hljs">broadcast 10.0.0.255
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、これらのサーバーのアドレスを静的ルーティングテーブルに追加します。</font><font style="vertical-align: inherit;">これを行うには、ワイヤレス構成ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-wlp6s0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">開き</font><font style="vertical-align: inherit;">、最後に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルート</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションを追加し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.0<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.4<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.8<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のように</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホスト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ユーティリティを使用して、NTPサーバーのアドレスを確認でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">host time1.google.com</code></pre><br>
<h2><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をインストールし</font><font style="vertical-align: inherit;">、広告を削除してプロバイダーからDNSトラフィックを隠します</font></font></h2><br>
<pre><code class="bash hljs">apt install dnscrypt-proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホストとローカルネットワークのDNSクエリを提供するには、ソケット</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/lib/systemd/system/dnscrypt-proxy.socketを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次の行を変更します。</font></font><br>
<br>
<pre><code class="bash hljs">ListenStream=0.0.0.0:53<font></font>
ListenDatagram=0.0.0.0:53</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再起動</font></font><code>systemd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
config </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/dnscrypt-proxy/dnscrypt-proxy.tomlを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">編集し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">server_names = [<span class="hljs-string">'adguard-dns'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tun2socksを介してdnscrypt-proxy接続を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルーティングするに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、以下を追加します。</font></font><br>
<br>
<pre><code class="bash hljs">force_tcp = <span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSサーバーにホストを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
する</font><i><font style="vertical-align: inherit;">/etc/resolv.conf構成を</font></i><font style="vertical-align: inherit;">編集し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="bash hljs">nameserver 127.0.0.1<font></font>
nameserver 192.168.1.1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1行目には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxyの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用が含まれ、2行</font><font style="vertical-align: inherit;">目には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーが</font><font style="vertical-align: inherit;">利用できない</font><font style="vertical-align: inherit;">場合に元のゲートウェイが</font><font style="vertical-align: inherit;">使用されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">できた！</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
既存のネットワークサービスを再起動または停止します。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl stop networking NetworkManager NetworkManager-wait-online</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、必要なものをすべて再起動します。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart systemd-networkd tun2socks create_ap dnscrypt-proxy ntp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再起動または再起動すると、ホストとLANデバイスをSOCKSにルーティングする2番目のアクセスポイントができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは出力がどのように見えるかです。</font></font><pre><code class="bash hljs">ip a</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 通常のラップトップ：</font></font><br>
<br>
<pre><code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<font></font>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<font></font>
    inet 127.0.0.1/8 scope host lo<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 ::1/128 scope host <font></font>
       valid_lft forever preferred_lft forever<font></font>
2: tun2socks: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 500<font></font>
    link/none <font></font>
    inet 172.16.1.2/24 brd 172.16.1.255 scope global tun2socks<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::122b:260:6590:1b0e/64 scope link stable-privacy <font></font>
       valid_lft forever preferred_lft forever<font></font>
3: enp4s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000<font></font>
    link/ether e8:11:32:0e:01:50 brd ff:ff:ff:ff:ff:ff<font></font>
4: wlp6s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:85 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 192.168.1.2/24 brd 192.168.1.255 scope global wlp6s0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf85/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
5: ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:86 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 10.0.0.1/24 brd 10.0.0.255 scope global ap0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf86/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的に</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロバイダーには、SOCKSサーバーへの暗号化された接続のみが表示されます。つまり、何も表示されません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それでも彼はあなたのNTP要求を確認しています。これを防ぐには、NTPサーバーの静的ルートを削除します。</font><font style="vertical-align: inherit;">ただし、SOCKSサーバーがNTPを許可しているのは事実ではありません。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイン10で見られる松葉杖</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールからネットワークサービスを再起動しようとすると、エラーで失敗します。</font><font style="vertical-align: inherit;">これは、仮想インターフェイスの形式でその一部が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスに関連付けられ</font><font style="vertical-align: inherit;">ているためです。つまり、それが使用されます。</font><font style="vertical-align: inherit;">ネットワークサービスを再起動するには、最初に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスを停止する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、最後まで読んだら、あなたにとってそれは間違いなく問題ではないと思います！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h4><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxでの静的ルーティング-IBM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd.service-Freedesktop.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks ambrop72 / badvpn wiki github</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oblique / create_ap：このスクリプトは、NATまたはブリッジWiFiアクセスポイントを作成します。</font></font></a><br>
 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy 2-暗号化されたDNSプロトコルをサポートする柔軟なDNSプロキシ。</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja491558/index.html">ロックイースターエッグをもっと見つけよう：神秘的なメッセージから、手を洗って宿題をするための電話まで</a></li>
<li><a href="../ja491560/index.html">端末を敵ではなくアシスタントにする方法は？</a></li>
<li><a href="../ja491562/index.html">FOSSニュースNo. 6-2020年3月2〜8日の無料およびオープンソースニュースのレビュー</a></li>
<li><a href="../ja491564/index.html">Java 14：Record、より簡潔なinstanceof、jpackageラッパー、スイッチラムダとテキストブロック</a></li>
<li><a href="../ja491566/index.html">mlr3パッケージを使用したR言語での機械学習</a></li>
<li><a href="../ja491570/index.html">ICQがMail.Ruを購入した後、古代のユーザーを失った理由</a></li>
<li><a href="../ja491572/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo. 405（2020年3月2日〜8日）</a></li>
<li><a href="../ja491574/index.html">先延ばしを管理するための簡単なトリック</a></li>
<li><a href="../ja491576/index.html">グラフニューラルネットワークとしてのトランスフォーマー</a></li>
<li><a href="../ja491584/index.html">モバイルデベロッパー向けの興味深い資料のダイジェスト＃336（3月2〜9日）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>