<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóìÔ∏è üôèüèΩ üë©‚ÄçüöÄ Praktik terbaik untuk meningkatkan kinerja dalam C # üïî ‚ô¶Ô∏è üôáüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Kami telah menyiapkan terjemahan materi lain yang bermanfaat pada awal kursus "Pengembang C #" . Selamat membaca.
 
 
 
 Karena saya ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Praktik terbaik untuk meningkatkan kinerja dalam C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502498/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font><font style="vertical-align: inherit;">Kami telah menyiapkan terjemahan materi lain yang bermanfaat pada awal kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pengembang C #"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Selamat membaca.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/q4/xs/kv/q4xskv5-ia4gfwlhgm1hx5e1gdc.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena saya baru-baru ini membuat daftar praktik terbaik dalam C # untuk Criteo, saya pikir akan baik untuk membaginya secara publik. Tujuan artikel ini adalah untuk menyediakan daftar templat kode yang tidak lengkap yang harus dihindari, baik karena mereka dipertanyakan, atau karena mereka hanya bekerja dengan buruk. Daftar ini mungkin tampak agak acak karena sedikit dikeluarkan dari konteks, tetapi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semua</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elemennya ada di beberapa titik yang ditemukan dalam kode kami dan menyebabkan masalah dalam produksi. Saya harap ini akan berfungsi sebagai pencegahan yang baik dan mencegah kesalahan Anda di masa depan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan juga bahwa layanan web Criteo bergantung pada kode berkinerja tinggi, maka kebutuhan untuk menghindari kode yang tidak efisien. Dalam sebagian besar aplikasi, tidak akan ada perbedaan nyata yang nyata dengan mengganti beberapa templat ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan yang terakhir, namun tidak kalah pentingnya, beberapa poin (misalnya, </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) telah dibahas dalam banyak artikel, jadi saya tidak akan membahasnya secara rinci. </font><font style="vertical-align: inherit;">Tujuannya adalah untuk membentuk daftar poin yang ringkas yang perlu Anda perhatikan, dan tidak memberikan deskripsi teknis terperinci tentang masing-masing poin.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinkron menunggu kode asinkron</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah mengharapkan tugas yang belum selesai secara sinkron. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hal ini berlaku untuk, tetapi tidak terbatas pada: </font></font><code>Task.Wait, Task.Result, Task.GetAwaiter().GetResult(), Task.WaitAny, Task.WaitAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai generalisasi: hubungan yang sinkron antara dua utas pool dapat menyebabkan penipisan pool. </font><font style="vertical-align: inherit;">Penyebab fenomena ini dijelaskan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurasikan, Tunggu</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika kode Anda dapat dipanggil dari konteks sinkronisasi, gunakan </font></font><code>ConfigureAwait(false)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk masing-masing panggilan tunggu Anda. </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harap perhatikan bahwa ini </font></font><code>ConfigureAwait</code> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hanya berguna saat menggunakan kata kunci </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalnya, kode berikut tidak ada artinya:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//  ConfigureAwait        </span>
<span class="hljs-keyword">var</span> result = ProcessAsync().ConfigureAwait(<span class="hljs-literal">false</span>).GetAwaiter().GetResult();</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batal async</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah gunakan</font></font><code>async void</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pengecualian yang dilemparkan dalam </font></font><code>async void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metode menyebar ke konteks sinkronisasi dan biasanya menyebabkan seluruh aplikasi macet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak dapat mengembalikan tugas dalam metode Anda (misalnya, karena Anda mengimplementasikan antarmuka), pindahkan kode asinkron ke metode lain dan panggil:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title">IInterface</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DoSomething</span>(<span class="hljs-params"></span>)</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">class</span> <span class="hljs-title">Implementation</span> : <span class="hljs-title">IInterface</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoSomething</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//      ,</span>
        <span class="hljs-comment">//      </span><font></font>
        _ = DoSomethingAsync();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">DoSomethingAsync</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">100</span>);<font></font>
    }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hindari async bila memungkinkan </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kebiasaan atau karena ingatan otot, Anda dapat menulis sesuatu seperti:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">CallAsync</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> Client();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> client.GetAsync();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun kode secara semantik benar, menggunakan kata kunci </font></font><code>async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tidak diperlukan di sini dan dapat menghasilkan overhead yang signifikan di lingkungan yang sangat dimuat. </font><font style="vertical-align: inherit;">Cobalah untuk menghindarinya sedapat mungkin:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">CallAsync</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> Client();
    <span class="hljs-keyword">return</span> _client.GetAsync();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, ingatlah bahwa Anda tidak dapat menggunakan optimasi ini ketika kode Anda dibungkus dengan blok (misalnya, </font></font><code> try/catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau </font></font><code>using</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Correct</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> Client())<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> client.GetAsync();<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">Incorrect</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> Client())<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> client.GetAsync();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam versi yang salah ( </font></font><code>Incorrect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), klien dapat dihapus sebelum </font></font><code>GetAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panggilan </font><font style="vertical-align: inherit;">selesai </font><font style="vertical-align: inherit;">, karena tugas di dalam blok menggunakan tidak diharapkan dengan menunggu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbandingan regional</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak memiliki alasan untuk menggunakan perbandingan regional, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selalu gunakan perbandingan ordinal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Meskipun, karena optimasi internal, ini tidak masalah banyak untuk bentuk presentasi data en-AS, perbandingannya adalah urutan besarnya lebih lambat untuk bentuk presentasi daerah lain (dan hingga dua urutan besarnya di Linux!). </font><font style="vertical-align: inherit;">Karena perbandingan string adalah operasi yang sering di sebagian besar aplikasi, overhead meningkat secara signifikan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConcurrentBag </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font><code>&gt;</code></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah gunakan </font></font><code><code>ConcurrentBag&lt;</code>T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tanpa pembandingan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Koleksi ini dirancang untuk kasus penggunaan yang sangat spesifik (saat sebagian besar item dikecualikan dari antrian oleh utas yang mengantri) dan menderita masalah kinerja serius jika digunakan untuk tujuan lain. Jika Anda membutuhkan koleksi benang-aman, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lebih memilih ConcurrentQueue </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font><code>&gt;</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReaderWriterLock / ReaderWriterLockSlim </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font><code>&gt;</code><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah gunakan </font><font style="vertical-align: inherit;">tanpa pembandingan. </font></font><code><code>ReaderWriterLock&lt;T&gt;</code>/ReaderWriterLockSlim&lt;T<code>&gt;</code></code><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meskipun menggunakan jenis sinkronisasi khusus yang primitif saat bekerja dengan pembaca dan penulis bisa menggoda, biayanya jauh lebih tinggi daripada yang sederhana </font></font><code>Monitor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(digunakan dengan kata kunci </font></font><code>lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Jika jumlah pembaca yang melakukan bagian kritis pada saat yang sama tidak terlalu besar, konkurensi tidak akan cukup untuk menyerap peningkatan overhead, dan kode akan bekerja lebih buruk.</font></font><br>
<br>
</h3><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebih suka fungsi lambda daripada kelompok metode</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan kode berikut:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">GetItems</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _list.Where(i =&gt; Filter(i));<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> element</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resharper menyarankan penulisan ulang kode tanpa fungsi lambda, yang mungkin terlihat sedikit lebih bersih:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">GetItems</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _list.Where(Filter);<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> element</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sayangnya, ini mengarah pada alokasi memori dinamis untuk setiap panggilan. </font><font style="vertical-align: inherit;">Bahkan, panggilan dikompilasi sebagai:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">GetItems</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _list.Where(<span class="hljs-keyword">new</span> Predicate&lt;<span class="hljs-keyword">int</span>&gt;(Filter));<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> element</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dapat memiliki dampak yang signifikan terhadap kinerja jika kode ini dipanggil di bagian yang sarat muatan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan fungsi lambda memulai optimisasi kompiler, yang menyimpan delegasi di bidang statis, menghindari alokasi. </font><font style="vertical-align: inherit;">Ini hanya berfungsi jika </font></font><code>Filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">statis. </font><font style="vertical-align: inherit;">Jika tidak, Anda dapat menyimpan sendiri delegasi:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Predicate&lt;<span class="hljs-keyword">int</span>&gt; _filter;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Constructor</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _filter = <span class="hljs-keyword">new</span> Predicate&lt;<span class="hljs-keyword">int</span>&gt;(Filter);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">GetItems</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _list.Where(_filter);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> element</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konversi Enumerasi ke Strings</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memanggil </font></font><code>Enum.ToString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di </font></font><code>.net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cukup mahal, karena refleksi digunakan untuk mengubah dalam, dan memanggil metode virtual pada memprovokasi struktur kemasan. </font><font style="vertical-align: inherit;">Ini harus dihindari sebisa mungkin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pencacahan seringkali dapat diganti dengan string konstan:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">//       Numbers.One, Numbers.Two, ...</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Numbers<font></font>
{<font></font>
    One,<font></font>
    Two,<font></font>
    Three<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Numbers</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> One = <span class="hljs-string">"One"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> Two = <span class="hljs-string">"Two"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> Three = <span class="hljs-string">"Three"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda benar-benar perlu menggunakan enumerasi, coba caching nilai yang dikonversi dalam kamus untuk mengamortisasi overhead.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbandingan Pencacahan</font></font></h2><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: ini tidak lagi relevan di .net core, sejak versi 2.1, optimasi dilakukan oleh JIT secara otomatis.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan enumerasi sebagai flag, mungkin tergoda untuk menggunakan metode ini </font></font><code>Enum.HasFlag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Flags</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Options<font></font>
{<font></font>
    Option1 = <span class="hljs-number">1</span>,<font></font>
    Option2 = <span class="hljs-number">2</span>,<font></font>
    Option3 = <span class="hljs-number">4</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> Options _option;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsOption2Enabled</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _option.HasFlag(Options.Option2);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini menimbulkan dua paket dengan alokasi: satu untuk konversi </font></font><code>Options.Option2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke </font></font><code>Enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan yang lainnya untuk panggilan virtual </font></font><code>HasFlag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk struktur. </font><font style="vertical-align: inherit;">Ini membuat kode ini mahal secara tidak proporsional. </font><font style="vertical-align: inherit;">Sebagai gantinya, Anda harus mengorbankan keterbacaan dan menggunakan operator biner:</font></font><br>
 <br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsOption2Enabled</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> (_option &amp; Options.Option2) == Options.Option2;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementasi metode perbandingan untuk struktur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat menggunakan struktur dalam perbandingan (misalnya, ketika digunakan sebagai kunci untuk kamus), Anda perlu mengganti metode </font></font><code>Equals/GetHashCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Implementasi standar menggunakan refleksi dan sangat lambat. </font><font style="vertical-align: inherit;">Implementasi yang dihasilkan oleh Resharper biasanya cukup bagus. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat mempelajari lebih lanjut tentang ini di sini: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devblogs.microsoft.com/premier-developer/performance-implication-of-default-struct-equality-in-c</font></font></a></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hindari pengemasan yang tidak tepat saat menggunakan struktur dengan antarmuka</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertimbangkan kode berikut:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">IntValue</span> : <span class="hljs-title">IValue</span><font></font>
{<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoStuff</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> IntValue();<font></font>
<font></font>
    LogValue(<span class="hljs-keyword">value</span>);<font></font>
    SendValue(<span class="hljs-keyword">value</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SendValue</span>(<span class="hljs-params">IValue <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogValue</span>(<span class="hljs-params">IValue <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Membuat </font></font><code>IntValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terstruktur bisa menggoda untuk menghindari mengalokasikan memori dinamis. </font><font style="vertical-align: inherit;">Tetapi karena </font></font><code>AddValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>SendValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diharapkan antarmuka, dan antarmuka memiliki semantik referensi, nilai akan dikemas dengan setiap panggilan, meniadakan manfaat dari "optimasi" ini. </font><font style="vertical-align: inherit;">Bahkan, akan ada alokasi memori lebih banyak daripada jika itu </font></font><code>IntValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adalah kelas, karena nilai akan dikemas secara independen untuk setiap panggilan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda menulis API dan mengharapkan beberapa nilai menjadi struktur, coba gunakan metode generik:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> IntValue : IValue<font></font>
{<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoStuff</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = <span class="hljs-keyword">new</span> IntValue();<font></font>
<font></font>
    LogValue(<span class="hljs-keyword">value</span>);<font></font>
    SendValue(<span class="hljs-keyword">value</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> SendValue&lt;T&gt;(T <span class="hljs-keyword">value</span>) <span class="hljs-keyword">where</span> T : IValue<font></font>
{<font></font>
    <span class="hljs-comment">// ...</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> LogValue&lt;T&gt;(T <span class="hljs-keyword">value</span>) <span class="hljs-keyword">where</span> T : IValue<font></font>
{<font></font>
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun konversi metode ini ke universal tampaknya tidak berguna pada pandangan pertama, sebenarnya memungkinkan Anda untuk menghindari pengemasan dengan alokasi dalam kasus ketika itu </font></font><code>IntValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adalah struktur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembatalan Langganan Berlalu Selalu Sebaris</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat Anda membatalkan </font></font><code>CancellationTokenSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, semua langganan akan dieksekusi di dalam utas saat ini. </font><font style="vertical-align: inherit;">Hal ini dapat menyebabkan jeda yang tidak direncanakan atau bahkan kebuntuan tersirat.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span> cts = <span class="hljs-keyword">new</span> CancellationTokenSource();<font></font>
cts.Token.Register(() =&gt; Thread.Sleep(<span class="hljs-number">5000</span>));<font></font>
cts.Cancel(); <span class="hljs-comment">//     5 </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda tidak bisa lepas dari perilaku ini. </font><font style="vertical-align: inherit;">Karena itu, ketika membatalkan </font></font><code>CancellationTokenSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tanyakan pada diri Anda apakah Anda dapat dengan aman membiarkan utas Anda saat ini ditangkap. </font><font style="vertical-align: inherit;">Jika jawabannya tidak, bungkus panggilan </font></font><code>Cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di dalam </font></font><code>Task.Run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk menjalankannya di utas kolam.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelanjutan TaskCompletionSource sering kali sejalan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti langganan </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kelanjutan </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sering kali sejalan. </font><font style="vertical-align: inherit;">Ini adalah optimasi yang baik, tetapi dapat menyebabkan kesalahan implisit. </font><font style="vertical-align: inherit;">Misalnya, pertimbangkan program berikut:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ManualResetEventSlim _mutex = <span class="hljs-keyword">new</span> ManualResetEventSlim();<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Deadlock</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">await</span> ProcessAsync();<font></font>
        _mutex.Wait();<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Task <span class="hljs-title">ProcessAsync</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> tcs = <span class="hljs-keyword">new</span> TaskCompletionSource&lt;<span class="hljs-keyword">bool</span>&gt;();<font></font>
        <font></font>
        Task.Run(() =&gt;<font></font>
        {<font></font>
            Thread.Sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">//  - </span>
            tcs.SetResult(<span class="hljs-literal">true</span>);<font></font>
            _mutex.Set();<font></font>
        });<font></font>
        <font></font>
        <span class="hljs-keyword">return</span> tcs.Task;<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
    {<font></font>
        Deadlock().Wait();<font></font>
        Console.WriteLine(<span class="hljs-string">"Will never get there"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan </font></font><code>tcs.SetResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menyebabkan kelanjutan </font></font><code>await ProcessAsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk dijalankan di utas saat ini. </font><font style="vertical-align: inherit;">Oleh karena itu, pernyataan </font></font><code>_mutex.Wait()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dieksekusi oleh utas yang sama dengan yang seharusnya dipanggil </font></font><code>_mutex.Set()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, yang mengarah ke jalan buntu. </font><font style="vertical-align: inherit;">Ini dapat dihindari dengan melewati parameter </font></font><code>TaskCreationsOptions.RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda tidak punya alasan untuk mengabaikannya, selalu gunakan opsi </font></font><code>TaskCreationsOptions.RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saat membuat </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hati-hati: kode juga akan mengkompilasi jika Anda menggunakan </font></font><code><b>TaskContinuationOptions</b>.RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gantinya </font></font><code><b>TaskCreationOptions</b>.RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi parameter akan diabaikan, dan lanjutan masih akan inline. </font><font style="vertical-align: inherit;">Ini adalah kesalahan yang sangat umum karena </font></font><code>TaskContinuationOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mendahului </font></font><code>TaskCreationOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelengkapan otomatis.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Task.Run / Task.Factory.StartNew</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak memiliki alasan untuk menggunakannya </font></font><code>Task.Factory.StartNew</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, selalu memilih </font></font><code>Task.Run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk menjalankan tugas latar belakang. </font></font><code>Task.Run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menggunakan nilai default yang lebih aman, dan yang lebih penting, itu secara otomatis membongkar tugas yang dikembalikan, yang dapat mencegah kesalahan yang tidak terlihat dengan metode asinkron. </font><font style="vertical-align: inherit;">Pertimbangkan program berikut:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessAsync</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">2000</span>);<font></font>
        Console.WriteLine(<span class="hljs-string">"Processing done"</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">await</span> Task.Factory.StartNew(ProcessAsync);<font></font>
        Console.WriteLine(<span class="hljs-string">"End of program"</span>);<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari kemunculannya, Akhir program akan ditampilkan lebih awal dari Pemrosesan yang dilakukan. </font><font style="vertical-align: inherit;">Ini karena </font></font><code>Task.Factory.StartNew</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">akan kembali </font></font><code><code>Task&lt;Task&gt;</code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan kode hanya mengharapkan tugas eksternal. </font><font style="vertical-align: inherit;">Kode yang benar bisa berupa </font></font><code>await Task.Factory.StartNew(ProcessAsync).Unwrap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, atau </font></font><code>await Task.Run(ProcessAsync)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya ada tiga kasus penggunaan yang valid </font></font><code>Task.Factory.StartNew</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menjalankan tugas di penjadwal lain.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melakukan tugas dalam utas khusus (menggunakan </font></font><code>TaskCreationOptions.LongRunning</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font></li>
<li>       (  <code>TaskCreationOptions.PreferFairness</code>).</li>
</ul><br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   .</a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502486/index.html">Buku "Perlombaan dengan epidemi. Antibiotik terhadap bakteri super "</a></li>
<li><a href="../id502490/index.html">Melanggar kepercayaan yang membatasi. Untuk apa dan apa yang diberikannya</a></li>
<li><a href="../id502492/index.html">Inovasi di Zextras Suite dan Zimbra OSE</a></li>
<li><a href="../id502494/index.html">7 kesalahan satu Black Friday dan bagaimana Magento Cloud bekerja - video</a></li>
<li><a href="../id502496/index.html">Akses Web Mudah ke Aplikasi PHP LabVIEW VI melalui ActiveX Server</a></li>
<li><a href="../id502500/index.html">Evolusi pemindai paspor: dari kerajinan kayu lapis ke bisnis nyata</a></li>
<li><a href="../id502504/index.html">Kelilingi digit pengguna</a></li>
<li><a href="../id502508/index.html">Robot Troli 2.0. Bagian 2. Manajemen dalam rviz dan tanpa Elemen kecantikan di rviz</a></li>
<li><a href="../id502510/index.html">Apa yang harus disimpan di cloud</a></li>
<li><a href="../id502512/index.html">Hasil dari kontes ahli sofa: aturan poking ilmiah</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>