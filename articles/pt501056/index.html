<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🎤 👩🏽 👲🏾 Por que, quando e como usar multithreading e multiprocessing em Python 🙏🏻 🙏🏿 🙇🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saudação, Khabrovsk. No momento, a OTUS abriu um conjunto para o curso de aprendizado de máquina . Em conexão com isso, traduzimos para você um "conto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Por que, quando e como usar multithreading e multiprocessing em Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501056/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saudação, Khabrovsk. </font><font style="vertical-align: inherit;">No momento, a OTUS abriu um conjunto para o curso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprendizado de máquina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Em conexão com isso, traduzimos para você um "conto de fadas" muito interessante. </font><font style="vertical-align: inherit;">Vai.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/mi/su/ev/misuevluvampqjc3br79pgtgscg.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era uma vez, em uma galáxia distante e distante ... Um </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mago sábio e poderoso vivia em uma pequena vila no meio do deserto. </font><font style="vertical-align: inherit;">E o nome deles era Dumbledalf. </font><font style="vertical-align: inherit;">Ele não era apenas sábio e poderoso, mas também ajudou as pessoas que vinham de terras distantes a pedir ajuda a um mago. </font><font style="vertical-align: inherit;">Nossa história começou quando um viajante trouxe ao mago um pergaminho mágico. </font><font style="vertical-align: inherit;">O viajante não sabia o que havia no pergaminho, ele sabia apenas que se alguém pudesse revelar todos os segredos do pergaminho, então esse era Dumbledalf.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capítulo 1: Processo único de thread único</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você ainda não adivinhou, fiz uma analogia com o processador e suas funções. </font><font style="vertical-align: inherit;">Nosso assistente é um processador, e um pergaminho é uma lista de links que levam ao poder e ao conhecimento do Python para dominá-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro pensamento do mago que decifrou a lista sem nenhuma dificuldade foi enviar seu fiel amigo (Garrigorn? Eu sei, eu sei que isso soa horrível) para cada um dos lugares que foram descritos no pergaminho para encontrar e trazer o que ele poderia encontrar lá.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">3</span>]:<font></font>
%%time<font></font>
<font></font>
results = []<font></font>
<span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:
    <span class="hljs-keyword">with</span> urllib.request.urlopen(url) <span class="hljs-keyword">as</span> src:<font></font>
        results.append(src)<font></font>
<font></font>
CPU times: user <span class="hljs-number">135</span> ms, sys: <span class="hljs-number">283</span> µs, total: <span class="hljs-number">135</span> ms<font></font>
Wall time: <span class="hljs-number">12.3</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, simplesmente iteramos os URLs um a um usando o loop for e lemos a resposta. </font><font style="vertical-align: inherit;">Graças ao </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%% time</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e à magia do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , podemos ver que demorou cerca de 12 segundos na minha triste internet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capítulo 2: Multithreading</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não era sem razão que o mago era famoso por sua sabedoria; ele foi rapidamente capaz de encontrar uma maneira muito mais eficaz. Em vez de enviar uma pessoa para cada lugar em ordem, por que não reunir um esquadrão de associados de confiança e enviá-los para diferentes partes do mundo ao mesmo tempo! O mago será capaz de unir todo o conhecimento que eles trazem de uma vez! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É isso mesmo, em vez de visualizar a lista em um loop em sequência, podemos usar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multithreading</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para acessar vários URLs de uma só vez.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<font></font>
In [<span class="hljs-number">2</span>]:<font></font>
urls = [<font></font>
  <span class="hljs-string">'http://www.python.org'</span>,
  <span class="hljs-string">'https://docs.python.org/3/'</span>,
  <span class="hljs-string">'https://docs.python.org/3/whatsnew/3.7.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/tutorial/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/library/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/reference/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/using/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/howto/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/installing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/distributing/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/extending/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/c-api/index.html'</span>,
  <span class="hljs-string">'https://docs.python.org/3/faq/index.html'</span><font></font>
  ]<font></font>
In [<span class="hljs-number">4</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">8.27</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">3.83</span> s<font></font>
In [<span class="hljs-number">5</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">122</span> ms, sys: <span class="hljs-number">14.7</span> ms, total: <span class="hljs-number">137</span> ms<font></font>
Wall time: <span class="hljs-number">1.79</span> s<font></font>
In [<span class="hljs-number">6</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> executor:<font></font>
    results = executor.map(urllib.request.urlopen, urls)<font></font>
<font></font>
CPU times: user <span class="hljs-number">143</span> ms, sys: <span class="hljs-number">3.88</span> ms, total: <span class="hljs-number">147</span> ms<font></font>
Wall time: <span class="hljs-number">1.32</span> s<font></font>
In [ ]:<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito melhor! Quase como ... mágica. O uso de vários encadeamentos pode acelerar significativamente muitas tarefas de E / S. No meu caso, a maior parte do tempo gasto lendo URLs é devido à latência da rede. Os programas vinculados à E / S passam a maior parte de sua vida esperando, você adivinhou, por entrada ou saída (assim como um assistente espera que seus amigos vão a lugares do pergaminho e retornam). Pode ser entrada / saída da rede, banco de dados, arquivo ou do usuário. Essa E / S geralmente leva muito tempo, porque a fonte pode precisar executar o pré-processamento antes de transferir os dados para a E / S. Por exemplo, um processador conta muito mais rápido do que uma conexão de rede transmite dados (a uma velocidade de aproximadamentecomo Flash vs sua avó).</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser muito útil em tarefas como limpar páginas da web.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capítulo 3: Multiprocessamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anos se passaram, a fama do bom mago cresceu e, com ela, a inveja de um mago sombrio e imparcial (Sarumort? Ou talvez Volandeman?). </font><font style="vertical-align: inherit;">Armado com astúcia incomensurável e impulsionado pela inveja, o bruxo das trevas lançou uma terrível maldição sobre Dumbledalf. </font><font style="vertical-align: inherit;">Quando a maldição tomou conta dele, Dumbledalf percebeu que ele tinha apenas alguns momentos para afastá-lo. </font><font style="vertical-align: inherit;">Desesperado, ele vasculhou seus livros de feitiços e rapidamente encontrou um contra-feitiço que deveria funcionar. </font><font style="vertical-align: inherit;">O único problema era que o mago precisava calcular a soma de todos os números primos menores que 1.000.000.Um feitiço estranho, é claro, mas o que temos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mago sabia que calcular o valor seria trivial se ele tivesse tempo suficiente, mas ele não tinha esse luxo. Apesar de ser um grande mago, ele é limitado por sua humanidade e pode verificar a simplicidade apenas um número de cada vez. Se ele decidisse simplesmente adicionar os números primos um após o outro, levaria muito tempo. Quando restaram apenas alguns segundos antes de aplicar a contra-mágica </font><font style="vertical-align: inherit;">, de </font><font style="vertical-align: inherit;">repente ele se lembrou da magia de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocessamento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que havia aprendido com o pergaminho mágico muitos anos atrás. Esse feitiço permitirá que ele se copie para distribuir números entre suas cópias e verificar vários ao mesmo tempo. E no final, tudo o que ele precisa fazer é simplesmente somar os números que ele e suas cópias descobrirão.</font></font><br>
<br>
<pre><code class="python hljs">In [<span class="hljs-number">1</span>]:
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<font></font>
In [<span class="hljs-number">2</span>]:
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">if_prime</span>(<span class="hljs-params">x</span>):</span>
    <span class="hljs-keyword">if</span> x &lt;= <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">elif</span> x &lt;= <span class="hljs-number">3</span>:
        <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">elif</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    i = <span class="hljs-number">5</span>
    <span class="hljs-keyword">while</span> i**<span class="hljs-number">2</span> &lt;= x:
        <span class="hljs-keyword">if</span> x % i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> x % (i + <span class="hljs-number">2</span>) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        i += <span class="hljs-number">6</span>
    <span class="hljs-keyword">return</span> x<font></font>
In [<span class="hljs-number">17</span>]:<font></font>
%%time<font></font>
<font></font>
answer = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000000</span>):<font></font>
    answer += if_prime(i)<font></font>
<font></font>
CPU times: user <span class="hljs-number">3.48</span> s, sys: <span class="hljs-number">0</span> ns, total: <span class="hljs-number">3.48</span> s<font></font>
Wall time: <span class="hljs-number">3.48</span> s<font></font>
In [<span class="hljs-number">18</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">114</span> ms, sys: <span class="hljs-number">4.07</span> ms, total: <span class="hljs-number">118</span> ms<font></font>
Wall time: <span class="hljs-number">1.91</span> s<font></font>
In [<span class="hljs-number">19</span>]:<font></font>
%%time<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
CPU times: user <span class="hljs-number">99.5</span> ms, sys: <span class="hljs-number">30.5</span> ms, total: <span class="hljs-number">130</span> ms<font></font>
Wall time: <span class="hljs-number">1.12</span> s<font></font>
In [<span class="hljs-number">20</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">8</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">729</span> ms ± <span class="hljs-number">3.02</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">21</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">16</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">512</span> ms ± <span class="hljs-number">39.8</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">22</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">32</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">518</span> ms ± <span class="hljs-number">13.3</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [<span class="hljs-number">23</span>]:<font></font>
%%timeit<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">with</span> Pool(<span class="hljs-number">64</span>) <span class="hljs-keyword">as</span> p:<font></font>
        answer = sum(p.map(if_prime, list(range(<span class="hljs-number">1000000</span>))))<font></font>
<font></font>
<span class="hljs-number">621</span> ms ± <span class="hljs-number">10.5</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">1</span> loop each)<font></font>
In [ ]:</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os processadores modernos têm mais de um núcleo, para que possamos acelerar as tarefas usando o multiprocessamento do módulo de processamento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multiprocesso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As tarefas associadas ao processador são programas que, na maioria das vezes em que trabalham, realizam cálculos no processador (cálculos matemáticos triviais, processamento de imagem etc.). </font><font style="vertical-align: inherit;">Se os cálculos puderem ser executados independentemente, teremos a oportunidade de dividi-los entre os núcleos de processador disponíveis, obtendo assim um aumento significativo na velocidade de processamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo o que tem a fazer é:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Determine a função a ser aplicada.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prepare uma lista de elementos aos quais a função será aplicada;</font></font></li>
<li>    <code>multiprocessing.Pool</code>. ,     <code>Pool()</code>,     .   <code>with</code> ,         .</li>
<li>     Pool    <code>map</code>.    map  ,    ,    .</li>
</ol><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Uma função pode ser definida para executar qualquer tarefa que possa ser executada em paralelo. Por exemplo, uma função pode conter código para gravar o resultado de um cálculo em um arquivo.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Então, por que precisamos nos separar</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Se você já tentou melhorar o desempenho de uma tarefa no processador usando multithreading, o resultado é exatamente o oposto. Isso é terrível! Vamos ver como aconteceu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim como um assistente é limitado por sua natureza humana e só pode calcular um número por unidade de tempo, o Python vem com uma coisa chamada</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Global Interpreter Lock (GIL)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O Python tem o prazer de permitir que você crie quantos threads quiser, mas o</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GIL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">garante que apenas um desses threads seja executado a qualquer momento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para uma tarefa relacionada à E / S, essa situação é completamente normal. Um segmento envia uma solicitação para um URL e aguarda uma resposta; somente então esse segmento pode ser substituído por outro, o que enviará outra solicitação para um URL diferente. Como o encadeamento não precisa fazer nada até receber uma resposta, não faz diferença que no momento especificado apenas um encadeamento esteja em execução.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para tarefas executadas no processador, ter vários threads é quase tão inútil quanto mamilos de armadura. Como apenas um encadeamento pode ser executado por unidade de tempo, mesmo se você gerar vários encadeamentos, cada um dos quais receberá um número para verificar a simplicidade, o processador ainda funcionará com apenas um encadeamento. De fato, esses números ainda serão verificados um por um. E a sobrecarga de trabalhar com vários encadeamentos ajudará a reduzir o desempenho, que você pode observar apenas quando usado </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em tarefas executadas no processador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para contornar essa "restrição", usamos o módulo</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em vez de usar threads, o multiprocessamento usa, como você diz ... vários processos. Cada processo recebe seu próprio intérprete pessoal e espaço de memória, para que o GIL não o limite. De fato, cada processo usará seu próprio núcleo de processador e trabalhará com seu próprio número exclusivo, e isso será realizado simultaneamente com o trabalho de outros processos. Que doce deles! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode notar que a carga da CPU será maior quando você a usar </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em comparação com um loop for regular ou mesmo </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso acontece porque seu programa usa não um núcleo, mas vários. E isso é bom! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lembre-se disso</font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele tem sua própria sobrecarga de gerenciar vários processos, o que geralmente é mais sério do que o custo do multithreading. (O multiprocessamento gera intérpretes separados e atribui sua própria área de memória a cada processo, então sim!) Ou seja, como regra, é melhor usar uma versão leve do multithreading quando quiser sair dessa maneira (lembre-se das tarefas relacionadas à E / S). Mas quando o cálculo no processador se torna um gargalo, chega a hora do módulo </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas lembre-se de que com grande poder vem uma grande responsabilidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você gerar mais processos do que seu processador pode processar por unidade de tempo, notará que o desempenho começará a diminuir. </font><font style="vertical-align: inherit;">Isso acontece porque o sistema operacional precisa fazer mais trabalho alterando os processos entre os núcleos do processador, porque há mais processos. </font><font style="vertical-align: inherit;">Na realidade, tudo pode ser ainda mais complicado do que eu disse hoje, mas transmiti a idéia principal. </font><font style="vertical-align: inherit;">Por exemplo, no meu sistema, o desempenho diminuirá quando o número de processos for 16. Isso ocorre porque existem apenas 16 núcleos lógicos no meu processador.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capítulo 4: Conclusão</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nas tarefas relacionadas à E / S, </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode melhorar o desempenho.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nas tarefas relacionadas à E / S, </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">também pode aumentar a produtividade, mas os custos, em regra, são mais altos do que quando usados </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A existência do Python GIL deixa claro para nós que, a qualquer momento em um programa, apenas um thread pode ser executado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nas tarefas relacionadas ao processador, o uso </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode reduzir o desempenho.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nas tarefas relacionadas ao processador, o uso </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode melhorar o desempenho.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os assistentes são incríveis!</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É aí que terminaremos nossa introdução hoje </font></font><code>multithreading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>multiprocessing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no Python. </font><font style="vertical-align: inherit;">Agora vá e ganhe!</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Modelando COVID-19 usando análise de gráficos e análise de dados abertos." </font><font style="vertical-align: inherit;">Lição grátis.</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501044/index.html">Não segure pessoas por idiotas ou por que uma pessoa com experiência em engenharia pode queimar uma torre de celular (vídeo)</a></li>
<li><a href="../pt501046/index.html">Em torno de vantagens sólidas: os 10 principais relatórios da conferência C ++ Russia 2019 Piter</a></li>
<li><a href="../pt501048/index.html">Organização da organização SMB de trabalho remoto no OpenVPN</a></li>
<li><a href="../pt501050/index.html">Instale e ative o LabVIEW Community Edition</a></li>
<li><a href="../pt501052/index.html">O retorno da nave espacial chinesa</a></li>
<li><a href="../pt501058/index.html">A solução de início rápido do Teamcenter ajuda os fabricantes de equipamentos industriais a reduzir o tempo de projeto em 25%</a></li>
<li><a href="../pt501060/index.html">JetBrains .NET Days Online, 13 a 14 de maio</a></li>
<li><a href="../pt501062/index.html">Todos os relatórios da parte on-line gratuita do PHP Russia com falantes estrangeiros podem ser vistos na tradução</a></li>
<li><a href="../pt501064/index.html">Para o voo do navio experimental chinês. Infográficos e colagens.</a></li>
<li><a href="../pt501068/index.html">Deepfakes e deep media: um novo campo de batalha para segurança</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>