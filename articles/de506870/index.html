<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍⚕️ 🔬 🧛🏽 So deaktivieren Sie die Warnung vor den Gefahren des langen Hörens von Audio (Android) 👲🏽 🔔 👊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wahrscheinlich sind viele, die Musik (und nicht nur) von einem Android-Gerät hören, auf diese Warnung gestoßen:
 
 
 In diesem Artikel erfahren Sie, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So deaktivieren Sie die Warnung vor den Gefahren des langen Hörens von Audio (Android)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506870/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wahrscheinlich sind viele, die Musik (und nicht nur) von einem Android-Gerät hören, auf diese Warnung gestoßen:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/gk/oa/_igkoaiik88g5pr8eooiezni-i8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel erfahren Sie, warum und wann diese Warnung auftritt und wie Sie sicherstellen können, dass sie nicht mehr auftritt.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird nur angezeigt, wenn Sie Audio über ein externes Gerät (Kopfhörer / Lautsprecher) hören. Für diejenigen, die dies nicht getroffen haben, eine kleine Erklärung: Stellen Sie sich vor, Sie hören Musik mit Kopfhörern, ziemlich laut. Plötzlich wird der Ton leiser. Sie versuchen, die Lautstärke mit den Tasten am Gehäuse zu erhöhen, aber es funktioniert nicht. Wenn Sie das Gerät aus der Tasche nehmen und entsperren, wird eine solche Warnung angezeigt. Erst nach Vereinbarung mit ihm kann die Lautstärke wieder erhöht werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, die Warnung ist vernünftig, aber sie erscheint in einem unvorhersehbaren Moment, manchmal am unangemessensten: wenn Sie in öffentlichen Verkehrsmitteln sind / fahren / im Winter auf der Straße / wenn Sie schmutzige Hände haben usw. </font><font style="vertical-align: inherit;">In diesen Fällen ist es unpraktisch, das Gerät zu entfernen, die Sperre aufzuheben, die Warnung zu akzeptieren und das Gerät wieder einzusetzen. </font><font style="vertical-align: inherit;">Und wenn die Lautsprecher angeschlossen sind und nicht die Kopfhörer, ist die Nachricht nicht ganz angemessen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum entsteht es?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Warnung ist keine Initiative der Autoren der Plattform. </font><font style="vertical-align: inherit;">Die Sache ist, dass es einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHO-ETU-Standard für</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> „sicheres Zuhören“ (sicheres Zuhören) gibt. </font><font style="vertical-align: inherit;">In Europa und einigen anderen Ländern ist die Umsetzung obligatorisch. </font><font style="vertical-align: inherit;">Der Standard beschreibt, wie lange Sie je nach Lautstärke Audio mit minimalem Risiko für Hörverlust hören können. </font><font style="vertical-align: inherit;">Für einen Erwachsenen beträgt die sichere wöchentliche „Schalldosis“ beispielsweise 1,6 Pa </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> h, was 20 Stunden Hören bei einer Lautstärke von 83 dB entspricht.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lf/lm/xx/lflmxxcutic2hsnxzyh2i_mepyg.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abhängig von mcc (Mobile Country Code) kann der sichere Hörmodus ein- oder ausgeschaltet werden. Dies wird durch den Wert der Ressource bestimmt </font></font><code>R.bool.config_safe_media_volume_enabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Modus aktiviert ist, berechnet das System die Hörzeit bei einer unsicheren Lautstärke (über 85 dB) und speichert den Wert regelmäßig in einer Variablen </font></font><b><code>Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn der Wert 20 Stunden erreicht, wird eine Warnung angezeigt. Nach dem Akzeptieren der Warnung wird der Wert zurückgesetzt und die Zählung erneut gestartet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine solche Implementierung ist recht einfach und berücksichtigt beispielsweise nicht, wie lange der Benutzer diese 20 Stunden gehört hat: möglicherweise in ein paar Tagen oder vielleicht 6-7 Minuten lang für sechs Monate (gemäß dem Standard ist dies keine Bedrohung für das Hören ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die sichere Abhörlogik konzentriert sich auf die Klassenklasse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AudioService.java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">können Sie die entsprechenden Felder darin sehen:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// mMusicActiveMs is the cumulative time of music activity since safe volume was disabled.</span>
<span class="hljs-comment">// When this time reaches UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX, the safe media volume is re-enabled</span>
<span class="hljs-comment">// automatically. mMusicActiveMs is rounded to a multiple of MUSIC_ACTIVE_POLL_PERIOD_MS.</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> mMusicActiveMs;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX = (<span class="hljs-number">20</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">1000</span>); <span class="hljs-comment">// 20 hours</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MUSIC_ACTIVE_POLL_PERIOD_MS = <span class="hljs-number">60000</span>;  <span class="hljs-comment">// 1 minute polling interval</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Feld </font></font><code>mMusicActiveMs </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enthält die Anzahl der Millisekunden, die der Benutzer seit der letzten Bestätigung des Dialogs mit unsicherer Lautstärke abgehört hat. </font><font style="vertical-align: inherit;">Der Anfangswert wird aus der Variablen geladen </font></font><b><code>Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In derselben Variablen wird jede Minute ein neuer mMusicActiveMs-Wert geschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch ein Feld </font></font><code>mSafeMediaVolumeState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das den aktuellen Status des sicheren Abhörsystems enthält:</font></font><br>
<br>
<ul>
<li><code>DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: aus</font></font></li>
<li><code>ACTIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: aktiviert und gleichzeitig das Hörlimit erreicht wurde. Dies bedeutet, dass Sie dem Benutzer nicht erlauben können, die Lautstärke zu erhöhen, bis er mit der Warnung einverstanden ist</font></font></li>
<li><code>INACTIVE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: on, das Limit wurde noch nicht erreicht</font></font></li>
</ul><br>
<pre><code class="java hljs">
<span class="hljs-comment">// mSafeMediaVolumeState indicates whether the media volume is limited over headphones.</span>
<span class="hljs-comment">// It is SAFE_MEDIA_VOLUME_NOT_CONFIGURED at boot time until a network service is connected</span>
<span class="hljs-comment">// or the configure time is elapsed. It is then set to SAFE_MEDIA_VOLUME_ACTIVE or</span>
<span class="hljs-comment">// SAFE_MEDIA_VOLUME_DISABLED according to country option. If not SAFE_MEDIA_VOLUME_DISABLED, it</span>
<span class="hljs-comment">// can be set to SAFE_MEDIA_VOLUME_INACTIVE by calling AudioService.disableSafeMediaVolume()</span>
<span class="hljs-comment">// (when user opts out).</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SAFE_MEDIA_VOLUME_NOT_CONFIGURED = <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SAFE_MEDIA_VOLUME_DISABLED = <span class="hljs-number">1</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SAFE_MEDIA_VOLUME_INACTIVE = <span class="hljs-number">2</span>;  <span class="hljs-comment">// confirmed</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SAFE_MEDIA_VOLUME_ACTIVE = <span class="hljs-number">3</span>;  <span class="hljs-comment">// unconfirmed</span>
<span class="hljs-keyword">private</span> Integer mSafeMediaVolumeState;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Methode zum Überprüfen des Grenzwertüberschreitens sieht folgendermaßen aus:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCheckMusicActive</span><span class="hljs-params">(String caller)</span> </span>{
   <span class="hljs-keyword">synchronized</span> (mSafeMediaVolumeState) {
       <span class="hljs-keyword">if</span> (mSafeMediaVolumeState == SAFE_MEDIA_VOLUME_INACTIVE) {
           <span class="hljs-keyword">int</span> device = getDeviceForStream(AudioSystem.STREAM_MUSIC);<font></font>
<font></font>
           <span class="hljs-keyword">if</span> ((device &amp; mSafeMediaVolumeDevices) != <span class="hljs-number">0</span>) {<font></font>
               sendMsg(mAudioHandler,<font></font>
                   MSG_CHECK_MUSIC_ACTIVE,<font></font>
                   SENDMSG_REPLACE,<font></font>
                   <span class="hljs-number">0</span>,
                   <span class="hljs-number">0</span>,<font></font>
                   caller,<font></font>
                   MUSIC_ACTIVE_POLL_PERIOD_MS);<font></font>
               <span class="hljs-keyword">int</span> index = mStreamStates[AudioSystem.STREAM_MUSIC].getIndex(device);
               <span class="hljs-keyword">if</span> (AudioSystem.isStreamActive(AudioSystem.STREAM_MUSIC, <span class="hljs-number">0</span>) &amp;&amp;<font></font>
                   (index &gt; safeMediaVolumeIndex(device))) {<font></font>
                   <span class="hljs-comment">// Approximate cumulative active music time</span><font></font>
                   mMusicActiveMs += MUSIC_ACTIVE_POLL_PERIOD_MS;<font></font>
                   <span class="hljs-keyword">if</span> (mMusicActiveMs &gt; UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX) {<font></font>
                       setSafeMediaVolumeEnabled(<span class="hljs-keyword">true</span>, caller);<font></font>
                       mMusicActiveMs = <span class="hljs-number">0</span>;<font></font>
                   }<font></font>
                   saveMusicActiveMs();<font></font>
               }<font></font>
           }<font></font>
       }<font></font>
   }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So deaktivieren Sie eine Warnung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das sichere Abhören zu deaktivieren, müssen Sie sicherstellen, dass der Variablen </font></font><code>mSafeMediaVolumeState</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">während der Konfigurationsphase ein Wert zugewiesen wird </font></font><code>DISABLED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen, wo der Wert anfänglich eingestellt ist:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureSafeVolume</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> force, String caller)</span> </span>{<font></font>
   ...<font></font>
   <span class="hljs-keyword">boolean</span> safeMediaVolumeEnabled =<font></font>
           SystemProperties.getBoolean(<span class="hljs-string">"audio.safemedia.force"</span>, <span class="hljs-keyword">false</span>)<font></font>
                   || mContext.getResources().getBoolean(<font></font>
                 com.android.internal.R.bool.config_safe_media_volume_enabled);<font></font>
<font></font>
   <span class="hljs-keyword">boolean</span> safeMediaVolumeBypass =<font></font>
           SystemProperties.getBoolean(<span class="hljs-string">"audio.safemedia.bypass"</span>, <span class="hljs-keyword">false</span>);<font></font>
<font></font>
   <span class="hljs-keyword">int</span> persistedState;
   <span class="hljs-keyword">if</span> (safeMediaVolumeEnabled &amp;&amp; !safeMediaVolumeBypass) {<font></font>
       persistedState = SAFE_MEDIA_VOLUME_ACTIVE;<font></font>
       <span class="hljs-comment">/*  ,  mSafeMediaVolumeState   ACTIVE,  INACTIVE */</span><font></font>
...<font></font>
   } <span class="hljs-keyword">else</span> {<font></font>
       persistedState = SAFE_MEDIA_VOLUME_DISABLED;<font></font>
       mSafeMediaVolumeState = SAFE_MEDIA_VOLUME_DISABLED;<font></font>
   }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen, dass es neben dem Wert der Ressource </font></font><code>R.bool.config_safe_media_volume_enabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zwei Eigenschaften gibt, die das sichere Abhörsystem aktivieren / deaktivieren: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio.safemedia.force</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio.safemedia.bypass</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Warnung zu deaktivieren, müssen Sie den Wert von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audio.safemedia.bypass = true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei system / build.properties festlegen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies erfordert jedoch Root-Rechte. </font><font style="vertical-align: inherit;">Wenn dies nicht der Fall ist, müssen Sie weiter verstehen und nach einem anderen Weg suchen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So deaktivieren Sie die Warnung ohne root</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mal sehen, was passiert, wenn Sie den Warndialog durch Klicken auf OK schließen und versuchen, dies zu reproduzieren:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-keyword">int</span> which)</span> </span>{<font></font>
        mAudioManager.disableSafeMediaVolume();<font></font>
    } </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><code>disableSafeMediaVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instanzmethode </font><font style="vertical-align: inherit;">wird aufgerufen </font></font><code>AudioManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/**
* Only useful for volume controllers.
* <span class="hljs-doctag">@hide</span>
*/</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableSafeMediaVolume</span><span class="hljs-params">()</span> </span>{ … }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist mit einer Anmerkung gekennzeichnet </font></font><code>@hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies bedeutet, dass die Methode trotz des öffentlichen Modifikators nicht in die öffentliche API aufgenommen wird. </font><font style="vertical-align: inherit;">Vor Android 9 konnte dies durch Reflexion leicht umgangen werden. </font><font style="vertical-align: inherit;">Nun kann eine solche Methode immer noch aufgerufen werden, aber mit Hilfe eines Tricks namens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doppelreflexion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> audioManager = getSystemService(Context.AUDIO_SERVICE) <span class="hljs-keyword">as</span> AudioManager
<span class="hljs-keyword">val</span> getDeclaredMethod = Class::<span class="hljs-keyword">class</span>.java.getDeclaredMethod(<span class="hljs-string">"getDeclaredMethod"</span>, String::<span class="hljs-keyword">class</span>.java, arrayOf&lt;Class&lt;*&gt;&gt;()::<span class="hljs-keyword">class</span>.java)
<span class="hljs-keyword">val</span> disableSafeMediaVolumeMethod = getDeclaredMethod.invoke(AudioManager::<span class="hljs-keyword">class</span>.java, <span class="hljs-string">"disableSafeMediaVolume"</span>, arrayOf&lt;Class&lt;*&gt;&gt;()) <span class="hljs-keyword">as</span> Method<font></font>
disableSafeMediaVolumeMethod.invoke(audioManager)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Aufruf wird mit einer Ausnahme beendet. </font></font><br>
<code>java.lang.SecurityException: Only SystemUI can disable the safe media volume: Neither user 10307 nor current process has android.permission.STATUS_BAR_SERVICE.</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Berechtigung STATUS_BAR_SERVICE verfügt über protectedLevel = "Signatur | privilegiert" und funktioniert nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann versuchen Sie es mal. </font><font style="vertical-align: inherit;">Wir werden die Variable überwachen, </font></font><b><code>Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der der aktuelle Wert regelmäßig gespeichert wird </font></font><code>mMusicActiveMs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn sich der Wert 20 Stunden nähert, setzen wir ihn zurück. </font><font style="vertical-align: inherit;">Dann müssen Sie AudioService veranlassen, den neuen Wert aus den Einstellungen zu lesen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie </font></font><b><code>Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">können </font><font style="vertical-align: inherit;">den Wert folgendermaßen lesen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> unsafeMs = Settings.Secure.getInt(contentResolver, <span class="hljs-string">"unsafe_volume_music_active_ms"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleiches mit adb:</font></font><br>
<br>
<pre><code class="bash hljs"> adb shell settings get secure unsafe_volume_music_active_ms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und um den Wert zu schreiben, benötigt die Anwendung eine Berechtigung </font></font><code>android.permission.WRITE_SECURE_SETTINGS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hat protectedLevel = "Signatur | privilegiert | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", was bedeutet, dass es mit adb an die Anwendung zurückgegeben werden kann:</font></font><br>
<br>
<pre><code class="bash hljs">adb shell pm grant com.example.app android.permission.WRITE_SECURE_SETTINGS</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Wert selbst kann folgendermaßen geschrieben werden:</font></font><br>
<br>
<pre><code class="kotlin hljs">Settings.Secure.putInt(contentResolver, <span class="hljs-string">"unsafe_volume_music_active_ms"</span>
, <span class="hljs-number">1</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können dasselbe mit adb tun:</font></font><br>
<br>
<pre><code class="bash hljs">adb shell settings put secure unsafe_volume_music_active_ms 1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist besser, wie im AudioManager auf 1 zurückzusetzen, jedoch nicht auf 0. Da 0 dem Status ACTIVE entspricht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt benötigen Sie AudioService, um den neuen Wert zu lesen und den Wert der lokalen Variablen zu aktualisieren </font></font><code>mMusicActiveMs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">AudioManager.java</font></a><font style="vertical-align: inherit;"> gibt es eine geeignete Methode</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/**
*  <span class="hljs-doctag">@hide</span>
*  Reload audio settings. This method is called by Settings backup
*  agent when audio settings are restored and causes the AudioService
*  to read and apply restored settings.
*/</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reloadAudioSettings</span><span class="hljs-params">()</span> </span>{<font></font>
   …<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird ein Methodenaufruf initiiert, </font></font><code>readAudioSettings </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bei </font></font><code>AudioService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dem das Laden </font></font><code>mMusicActiveMs </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aus den Einstellungen </font><font style="vertical-align: inherit;">erfolgt </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readAudioSettings</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> userSwitch)</span> </span>{<font></font>
...<font></font>
<span class="hljs-keyword">synchronized</span> (mSafeMediaVolumeStateLock) {<font></font>
        mMusicActiveMs = MathUtils.constrain(Settings.Secure.getIntForUser(mContentResolver,<font></font>
                Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS, <span class="hljs-number">0</span>, UserHandle.USER_CURRENT),
                <span class="hljs-number">0</span>, UNSAFE_VOLUME_MUSIC_ACTIVE_MS_MAX);
        <span class="hljs-keyword">if</span> (mSafeMediaVolumeState == SAFE_MEDIA_VOLUME_ACTIVE) {<font></font>
            enforceSafeMediaVolume(TAG);<font></font>
        }<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Methode ist mit Anmerkungen gekennzeichnet </font></font><code>@hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn Sie es mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doppelter Reflexion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aufrufen, wird eine Ausnahme </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ausgelöst </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">java.lang.SecurityException: Berechtigungsverweigerung: Die Einstellung get / set für den Benutzer wird als Benutzer -2 ausgeführt, ruft jedoch von Benutzer 0 aus auf. Dies erfordert android.permission.INTERACT_ACROSS_USERS_FULL </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, die Anmerkung </font></font><code>@hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier ist auch kein Zufall. Natürlich können wir diese Erlaubnis nicht erhalten. Es hat protectedLevel = "Signatur | Installer". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt noch eine Möglichkeit, AudioService dazu zu bringen, den neuen Wert zu lesen - ihn neu zu starten. Sie können den Systemdienst nicht einfach neu starten. Sie müssen entweder das Gerät neu starten oder zu einem anderen Benutzer wechseln und dann zurückkehren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist die Zeit, die Theorie zu testen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren</font></font><code>unsafe_volume_music_active_ms = 71 990 000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Noch 10 Sekunden, in denen Sie Musik mit hoher Lautstärke hören können)</font></font><br>
<br>
<pre><code class="bash hljs">adb shell settings put secure unsafe_volume_music_active_ms 71990000</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten das Gerät neu (Sie können stattdessen zu einem anderen Benutzer wechseln und dann zurückkehren):</font></font><br>
<br>
<pre><code class="bash hljs">adb reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schließen die Kopfhörer an, schalten die Musik lauter ein. </font><font style="vertical-align: inherit;">Innerhalb einer Minute erscheint ein Dialog. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wiederholen wir die gleichen Aktionen, weisen jedoch unsafe_volume_music_active_ms = 1 zu. Schalten Sie die Musik ein und warten Sie eine Minute. </font><font style="vertical-align: inherit;">Der Dialog wird nicht angezeigt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Warnung zu deaktivieren, haben Sie folgende </font><font style="vertical-align: inherit;">
Möglichkeiten </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie über Root-Rechte verfügen</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Legen </font><b><font style="vertical-align: inherit;">Sie</font></b><font style="vertical-align: inherit;"> den Wert von audio.safemedia.bypass = true im Dateisystem / build.properties fest. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ohne Root-Rechte müssen</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie den Wert überwachen </font></font><b><code>Settings.Secure.UNSAFE_VOLUME_MUSIC_ACTIVE_MS</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und verhindern, dass er über </font><font style="vertical-align: inherit;">72.000.000 </font><font style="vertical-align: inherit;">(20 Stunden) steigt ) </font><font style="vertical-align: inherit;">Nach dem Zurücksetzen des Werts müssen Sie das Gerät neu starten (oder zu einem anderen Benutzer wechseln und dann zurückkehren). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code für eine einfache Anwendung geschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die diesen Job ausführt, und erinnere mich an die Notwendigkeit, das Gerät neu zu starten / mich anzumelden.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktualisieren</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerätehersteller können Änderungen am Plattformcode vornehmen. Nach den Kommentaren zu urteilen, verringern einige von ihnen das Standardverhalten. </font><font style="vertical-align: inherit;">Beispielsweise kann eine Warnung einmal angezeigt werden und erst beim nächsten Neustart auftreten.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506852/index.html">Wie Signal Crypto Messenger erfolgreich dem Abhören durch US-Behörden widersteht</a></li>
<li><a href="../de506860/index.html">23. Juni - NX Analyst Meetup # 3. Wir werden Interviews mit Kunden diskutieren und mit komplexen Kunden arbeiten.</a></li>
<li><a href="../de506864/index.html">Kommende Linux 5.8-Version: Millionen Zeilen neuer Code und 14.000 Änderungen</a></li>
<li><a href="../de506866/index.html">Single Insurance Base - System für die Zusammenarbeit mit Versicherungsunternehmen</a></li>
<li><a href="../de506868/index.html">Sam Altman: Ideen generieren</a></li>
<li><a href="../de506872/index.html">Buchen Sie Spring Boot 2: Best Practices für Profis</a></li>
<li><a href="../de506874/index.html">Aus dem Leben eines Programmierers: Geschäftsleute</a></li>
<li><a href="../de506880/index.html">Joel Spolsky: Wie die Stack Overflow-Ära begann</a></li>
<li><a href="../de506886/index.html">Life Hack für Bits</a></li>
<li><a href="../de506888/index.html">Spickzettel für Data Science sortieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>