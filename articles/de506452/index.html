<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍱 🏚️ 🤶🏼 So schützen Sie Ihre öffentliche Website mit ESNI 👩‍👩‍👧‍👧 🧢 🤸🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr, mein Name ist Ilya, ich arbeite im Exness-Plattformteam. Wir entwickeln und implementieren grundlegende Infrastrukturkomponenten, die unse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So schützen Sie Ihre öffentliche Website mit ESNI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/506452/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr, mein Name ist Ilya, ich arbeite im Exness-Plattformteam. </font><font style="vertical-align: inherit;">Wir entwickeln und implementieren grundlegende Infrastrukturkomponenten, die unsere Produktentwicklungsteams nutzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel möchte ich die Erfahrungen mit der Implementierung der verschlüsselten SNI-Technologie (ESNI) in der Infrastruktur öffentlicher Websites teilen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/3v/bq/my3vbqy87t_ep9l7wnjzsghs9oo.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verwendung dieser Technologie erhöht das Sicherheitsniveau bei der Arbeit mit einer öffentlichen Website und entspricht den vom Unternehmen festgelegten internen Sicherheitsstandards. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst möchte ich darauf hinweisen, dass die Technologie nicht standardisiert ist und sich noch im Entwurf befindet. CloudFlare und Mozilla unterstützen sie jedoch bereits (in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwurf01</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Dies hat uns zu einem solchen Experiment motiviert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Theorie</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESNI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist eine Erweiterung des TLS 1.3-Protokolls, mit der Sie SNI in einer TLS-Handshake-Nachricht „Client Hello“ verschlüsseln können. </font><font style="vertical-align: inherit;">So sieht Client Hello mit ESNI-Unterstützung aus (anstelle des üblichen SNI sehen wir ESNI): </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/74d/efd/449/74defd4491b50c470ee3b81651edfb62.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;Um ESNI verwenden zu können, benötigen Sie drei Dinge:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS&nbsp;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kundendienst</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serverseitige Unterstützung.</font></font><br>
</li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erforderlich, zwei DNS-Einträge hinzuzufügen - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TXT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (TXT-Eintrag enthält einen öffentlichen Schlüssel, mit dem der Client SNI verschlüsseln kann) - siehe unten. </font><font style="vertical-align: inherit;">Darüber hinaus sollte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DoH-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unterstützung </font><font style="vertical-align: inherit;">(DNS über HTTPS) vorhanden sein, da die verfügbaren Clients (siehe unten) die ESNI-Unterstützung ohne DoH nicht aktivieren. </font><font style="vertical-align: inherit;">Dies ist logisch, da ESNI die Verschlüsselung des Namens der Ressource impliziert, auf die wir zugreifen. Das heißt, es macht keinen Sinn, über UDP auf DNS zuzugreifen. </font><font style="vertical-align: inherit;">Darüber hinaus </font><font style="vertical-align: inherit;">schützt </font><font style="vertical-align: inherit;">die Verwendung von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in diesem Szenario vor Cache-Vergiftungsangriffen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derzeit sind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mehrere DoH-Anbieter verfügbar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , darunter:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://developers.cloudflare.com/1.1.1.1/dns-over-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloudflare</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opendns</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CloudFlare </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erklärt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Überprüfen Sie meinen Browser → Verschlüsselte SNI → Weitere Informationen), dass ihre Server bereits ESNI unterstützen, dh für CloudFlare-Server in DNS haben wir mindestens zwei Einträge - A und TXT. </font><font style="vertical-align: inherit;">Im folgenden Beispiel fordern wir Google DNS (über HTTPS) an:&nbsp; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eintrag:</font></font><br>
<br>
<pre><code class="plaintext hljs">curl 'https://dns.google.com/resolve?name=www.cloudflare.com&amp;type=A' \<font></font>
-s -H 'accept: application/dns+json'<font></font>
{<font></font>
&nbsp; "Status": 0,<font></font>
&nbsp; "TC": false,<font></font>
&nbsp; "RD": true,<font></font>
&nbsp; "RA": true,<font></font>
&nbsp; "AD": true,<font></font>
&nbsp; "CD": false,<font></font>
&nbsp; "Question": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Answer": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1,<font></font>
&nbsp; &nbsp; &nbsp; "TTL": 257,<font></font>
&nbsp; &nbsp; &nbsp; "data": "104.17.210.9"<font></font>
&nbsp; &nbsp; },<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; &nbsp; "name": "www.cloudflare.com.",<font></font>
&nbsp; &nbsp; &nbsp; "type": 1,<font></font>
&nbsp; &nbsp; &nbsp; "TTL": 257,<font></font>
&nbsp; &nbsp; &nbsp; "data": "104.17.209.9"<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ]<font></font>
}<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TXT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datensatz, die Anforderung wird von der Vorlage </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_esni.FQDN generiert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">curl 'https://dns.google.com/resolve?name=_esni.www.cloudflare.com&amp;type=TXT' \<font></font>
-s -H 'accept: application/dns+json'<font></font>
{<font></font>
&nbsp; "Status": 0,<font></font>
&nbsp; "TC": false,<font></font>
&nbsp; "RD": true,<font></font>
&nbsp; "RA": true,<font></font>
&nbsp; "AD": true,<font></font>
&nbsp; "CD": false,<font></font>
&nbsp; "Question": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; "name": "_esni.www.cloudflare.com.",<font></font>
&nbsp; &nbsp; "type": 16<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Answer": [<font></font>
&nbsp; &nbsp; {<font></font>
&nbsp; &nbsp; "name": "_esni.www.cloudflare.com.",<font></font>
&nbsp; &nbsp; "type": 16,<font></font>
&nbsp; &nbsp; "TTL": 1799,<font></font>
&nbsp; &nbsp; "data": "\"/wEUgUKlACQAHQAg9SiAYQ9aUseUZr47HYHvF5jkt3aZ5802eAMJPhRz1QgAAhMBAQQAAAAAXtUmAAAAAABe3Q8AAAA=\""<font></font>
&nbsp; &nbsp; }<font></font>
&nbsp; ],<font></font>
&nbsp; "Comment": "Response from 2400:cb00:2049:1::a29f:209."<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Bezug auf DNS sollten wir also DoH (vorzugsweise mit DNSSEC) verwenden und zwei Einträge hinzufügen.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kundendienst</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es sich um Browser handelt, ist die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterstützung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> derzeit </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">nur in FireFox implementiert</font></a><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfahren Sie, wie Sie die ESNI- und DoH-Unterstützung in FireFox aktivieren. </font><font style="vertical-align: inherit;">Nachdem der Browser konfiguriert wurde, sollte </font><font style="vertical-align: inherit;">Folgendes angezeigt werden </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f06/6ef/b4c/f066efb4ce235c0abf798652123b1a13.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Überprüfen des Browsers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich sollte TLS 1.3 zur Unterstützung von ESNI verwendet werden, da ESNI eine Erweiterung von TLS 1.3 ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Backend mit ESNI-Unterstützung zu testen, haben wir den Client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unterwegs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementiert </font><font style="vertical-align: inherit;">, aber dazu später mehr.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serverseitige Unterstützung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESNI wird derzeit von Webservern wie Nginx / Apache usw. nicht unterstützt, da sie über OpenSSL / BoringSSL mit TLS arbeiten, wobei ESNI nicht offiziell unterstützt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund haben wir uns entschlossen, eine eigene Front-End-Komponente (ESNI Reverse Proxy) zu erstellen, die die Beendigung von TLS 1.3 mit ESNI und die Weiterleitung von HTTP (S) -Verkehr an Upstreams unterstützt, die ESNI nicht unterstützen. Auf diese Weise können Sie die Technologie in einer vorhandenen Infrastruktur anwenden, ohne die Hauptkomponenten zu ändern. Verwenden Sie daher aktuelle Webserver, die ESNI nicht unterstützen.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Verdeutlichung geben wir ein Diagramm:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b30/035/725/b30035725aca99c4c0085c237a1d1a9e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich stelle fest, dass der Proxy mit der Fähigkeit konzipiert wurde, eine TLS-Verbindung ohne ESNI zu beenden und Clients ohne ESNI zu unterstützen. Das Protokoll für die Kommunikation mit dem Upstream kann entweder HTTP oder HTTPS mit einer TLS-Version unter 1.3 sein (wenn der Upstream 1.3 nicht unterstützt). Dieses Design bietet maximale Flexibilität. </font><font style="vertical-align: inherit;">Wir liehen uns die </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementierung von ESNI Unterstützung auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFlare</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stelle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sofort fest, dass die Implementierung selbst nicht trivial ist, da sie Änderungen in der Standard- </font><b><font style="vertical-align: inherit;">Crypto / TLS-Bibliothek</font></b><font style="vertical-align: inherit;"> impliziert </font><font style="vertical-align: inherit;">und daher </font><font style="vertical-align: inherit;">vor dem Zusammenbau </font><font style="vertical-align: inherit;">ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GOROOT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Patching erfordert </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um ESNI-Schlüssel zu generieren, haben wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esnitool verwendet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (auch die Idee von CloudFlare). Diese Schlüssel werden zum Ver- / Entschlüsseln von SNI verwendet.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben den Build mit go 1.13 unter Linux (Debian, Alpine) und MacOS getestet.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Worte zu den Betriebsfunktionen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der ESNI-Reverse-Proxy bietet Metriken im Prometheus-Format, z. B. RPS, Upstream-Latenz- und Antwortcodes, fehlgeschlagene / erfolgreiche TLS-Handshakes und TLS-Handshake-Dauer. </font><font style="vertical-align: inherit;">Auf den ersten Blick schien dies ausreichend zu sein, um zu bewerten, wie der Proxy mit dem Datenverkehr umgeht.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben auch Stresstests vor dem Gebrauch durchgeführt. </font><font style="vertical-align: inherit;">Ergebnisse unten:</font></font><br>
<br>
<pre><code class="plaintext hljs">wrk -t50 -c1000 -d360s 'https://esni-rev-proxy.npw:443' --timeout 15s<font></font>
Running 6m test @ https://esni-rev-proxy.npw:443<font></font>
&nbsp;&nbsp;50 threads and 1000 connections<font></font>
&nbsp;&nbsp;Thread Stats &nbsp; Avg&nbsp; &nbsp; &nbsp; Stdev &nbsp; &nbsp; Max &nbsp; +/- Stdev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Latency &nbsp; &nbsp; 1.77s &nbsp; &nbsp; 1.21s&nbsp; &nbsp; 7.20s&nbsp; &nbsp; 65.43%<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Req/Sec&nbsp; &nbsp; 13.78&nbsp; &nbsp; &nbsp; 8.84 &nbsp; 140.00 &nbsp; &nbsp; 83.70%<font></font>
&nbsp;&nbsp;206357 requests in 6.00m, 6.08GB read<font></font>
Requests/sec:&nbsp; &nbsp; 573.07<font></font>
Transfer/sec: &nbsp; &nbsp; 17.28MB&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben Lasttests von reiner Qualität durchgeführt, um die Schemata mit und ohne ESNI-Reverse-Proxy zu vergleichen. </font><font style="vertical-align: inherit;">Wir haben den Verkehr vor Ort „gegossen“, um „Störungen“ in den Zwischenkomponenten zu vermeiden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit ESNI-Unterstützung und Proxy für Upstream mit HTTP haben wir also ungefähr 550 Rps von einer Instanz erhalten, mit dem durchschnittlichen CPU / RAM-Verbrauch von ESNI-Reverse-Proxy:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80% CPU-Auslastung (4 vCPU, 4 GB RAM-Hosts, Linux) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">130 MB Mem RSS </font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/lx/ad/em/lxademanjtgdgtbp2zj3dtztoaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Vergleich: RPS für denselben Upstream-Nginx ohne TLS-Terminierung (HTTP-Protokoll) ~ 1100:</font></font><br>
<br>
<pre><code class="plaintext hljs">wrk -t50 -c1000 -d360s 'http://lb.npw:80' –-timeout 15s<font></font>
Running 6m test @ http://lb.npw:80<font></font>
&nbsp;&nbsp;50 threads and 1000 connections<font></font>
&nbsp;&nbsp;Thread Stats &nbsp; Avg&nbsp; &nbsp; &nbsp; Stdev &nbsp; &nbsp; Max &nbsp; +/- Stdev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Latency &nbsp; &nbsp; 1.11s &nbsp; &nbsp; 2.30s &nbsp; 15.00s&nbsp; &nbsp; 90.94%<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Req/Sec&nbsp; &nbsp; 23.25 &nbsp; &nbsp; 13.55 &nbsp; 282.00 &nbsp; &nbsp; 79.25%<font></font>
&nbsp;&nbsp;393093 requests in 6.00m, 11.35GB read<font></font>
&nbsp;&nbsp;Socket errors: connect 0, read 0, write 0, timeout 9555<font></font>
&nbsp;&nbsp;Non-2xx or 3xx responses: 8111<font></font>
Requests/sec: &nbsp; 1091.62<font></font>
Transfer/sec: &nbsp; &nbsp; 32.27MB&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Vorhandensein von Zeitüberschreitungen weist auf einen Mangel an Ressourcen hin (wir haben 4 vCPUs, 4 GB RAM-Hosts, Linux verwendet), und tatsächlich ist der potenzielle RPS höher (wir haben Zahlen von bis zu 2700 RPS für leistungsstärkere Ressourcen erhalten). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassend</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stelle </font><b><font style="vertical-align: inherit;">ich fest,</font></b><font style="vertical-align: inherit;"> dass die ESNI-Technologie vielversprechend aussieht. </font><font style="vertical-align: inherit;">Es gibt noch viele weitere offene Fragen, z. B. Fragen zum Speichern eines öffentlichen ESNI-Schlüssels in DNS und zum Drehen von ESNI-Schlüsseln. Diese Probleme werden aktiv diskutiert, und die neueste Version des Entwurfs (zum Zeitpunkt des Schreibens) von ESNI ist bereits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de506432/index.html">So erstellen Sie ein benutzerdefiniertes Web- oder Mobilprojekt von Grund auf neu: Prozesse, Regeln und ein wenig Blut</a></li>
<li><a href="../de506438/index.html">Über die Übersetzung der Wörter "Wahl" / "wählen" ohne wählen / wählen / wählen</a></li>
<li><a href="../de506442/index.html">Tick ​​Tuck</a></li>
<li><a href="../de506444/index.html">Zukünftige Herausforderungen</a></li>
<li><a href="../de506450/index.html">Erfahrung in der Verwendung der Rutoken-Technologie zur Registrierung und Autorisierung von Benutzern im System (Teil 1)</a></li>
<li><a href="../de506454/index.html">Für was ein Bim-Manager 100.000 bekommt und wie man einer wird</a></li>
<li><a href="../de506456/index.html">Wir empfangen und analysieren das Funksignal des Zahlungsterminals mit SDR</a></li>
<li><a href="../de506460/index.html">Unterschiede des männlichen zum weiblichen Gehirn: Frauen codieren besser?</a></li>
<li><a href="../de506462/index.html">Pushpools und Tachers - wie ich alles getestet habe, was ich gefunden habe</a></li>
<li><a href="../de506472/index.html">Unternehmensschutz für Internetunternehmer: Wo soll ein Unternehmen und ein Konto eröffnet werden, wonach muss gesucht werden?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>