<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎊 💬 👨🏾‍🏫 Externe Aufgaben von Camunda - ein leistungsstarkes Tool zum Erstellen von Anwendungen mit einer stabilen und skalierbaren Architektur 🗂️ ⌛️ 👩🏻‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Tinkoff verwenden wir das Camunda + Spring- Framework, um Geschäftsprozessautomatisierungssysteme zu entwickeln . Wir beschreiben Geschäftsprozesse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Externe Aufgaben von Camunda - ein leistungsstarkes Tool zum Erstellen von Anwendungen mit einer stabilen und skalierbaren Architektur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/490656/"><img src="https://habrastorage.org/webt/sw/nv/az/swnvaz2_ifbzirrprmoucnx0zli.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Tinkoff verwenden wir das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda + Spring-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Framework, um Geschäftsprozessautomatisierungssysteme zu entwickeln </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir beschreiben Geschäftsprozesse mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Business Process Management Notation) in Form von Flussdiagrammen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das am häufigsten verwendete Element in unseren Diagrammen sind </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serviceaufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Zahnradrechteck). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unterstützt zwei Möglichkeiten zur Ausführung von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serviceaufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden eines synchronen Aufrufs von Java-Code.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine externe Aufgabe erstellen.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der zweiten Methode können Sie Aufgaben mit externen Systemen ausführen, z. B. wenn Sie eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda-Anwendung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von einer anderen </font><b><font style="vertical-align: inherit;">aufrufen</font></b><font style="vertical-align: inherit;"> oder sogar Arbeiten an ein externes System delegieren müssen.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/27/tm/sd/27tmsdtlkpfvti2vcgdvjl8xcqk.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel für ein BPMN-Diagramm</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dies ist nützlich, wenn Sie die Logik in mehreren Anwendungen wiederverwenden möchten. </font><font style="vertical-align: inherit;">Oder wenn Sie sich an die Microservice-Architektur halten möchten. </font><font style="vertical-align: inherit;">Trennen Sie beispielsweise Dienste, die sich mit Geschäftsprozessen befassen, von Diensten, die technische Aufgaben wie das Generieren von Berichten oder das Versenden von Nachrichten implementieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammen mit dieser Funktion bietet eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine skalierbare, ausfallsichere Architektur. </font><font style="vertical-align: inherit;">Um zu verstehen, warum dies geschieht, müssen Sie zunächst verstehen, wie die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Anwendungsebene </font><font style="vertical-align: inherit;">funktioniert </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Externe Aufgabe in BPMN</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei einer externen Aufgabe wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Aufgabe erstellt, die von einem externen Handler ausgeführt werden kann. </font><font style="vertical-align: inherit;">Das Wesentliche des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externen Aufgabenmusters</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist:</font></font><br>
<br>
<ol>
<li>,  «»  ,      «».</li>
<li>     <b>camunda</b>   ,       ,       .</li>
<li>     <b>camunda</b>   (/).</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der obigen Abbildung habe ich einen fiktiven Prozess beschrieben, bei dem wir eine Liste der Benutzer erhalten, ihnen eine Anzeige senden und nach 2 Stunden die Anzahl der Bewerbungen nach dem Marketing-Newsletter berechnen möchten. </font><font style="vertical-align: inherit;">Wenn mehr als 10 Anwendungen vorhanden sind, erhöhen Sie die Auswahl für das nächste Mailing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte, dass meine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anwendung </font><font style="vertical-align: inherit;">nur für Geschäftsprozesse verantwortlich ist, und jede andere Anwendung </font><b><font style="vertical-align: inherit;">sollte</font></b><font style="vertical-align: inherit;"> für das Versenden von E-Mails verantwortlich sein. </font><font style="vertical-align: inherit;">In diesem Fall funktioniert das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabenmuster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für mich einwandfrei </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In meinem Prozess erstelle ich einfach eine E-Mail-Newsletter-Aufgabe und warte, bis sie von einem externen Handler abgeschlossen wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Diagramm zu erstellen </font><font style="vertical-align: inherit;">, müssen Sie:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie eine reguläre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ändern Sie den Typ in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serviceaufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setzen Sie die Implementierung auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extern</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geben Sie den Wert des Felds </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thema an</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/qk/sf/0p/qksf0pz_6lglnp8_xu42jxphsmg.png" alt="Bild"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thema</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Name der Warteschlange, in die Aufgaben eines Typs hinzugefügt werden und die ein externer Handler abonniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt, da sich eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Prozess befindet </font><font style="vertical-align: inherit;">, können Sie sie starten, sie wird jedoch nicht ausgeführt, da sie von niemandem verarbeitet wird.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mitarbeiter für externe Aufgaben</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabenmuster ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> insofern </font><font style="vertical-align: inherit;">gut, als Sie die Aufgabenverarbeitung in jeder Sprache mit allen Tools implementieren können, die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP-Anforderungen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausführen </font><b><font style="vertical-align: inherit;">können</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Folgende ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Beispiel aus dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda-</font></font></b></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"> Blog</font></a><font style="vertical-align: inherit;"> . Das Beispiel implementiert einen externen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Handler </font><font style="vertical-align: inherit;">, der alle 20 Sekunden eine </font><font style="vertical-align: inherit;">Liste der Verarbeitungsaufgaben </font><font style="vertical-align: inherit;">von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda anfordert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn es Aufgaben gibt, werden diese </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gesendet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">Camunda</font></b><font style="vertical-align: inherit;"> über den Abschluss der Aufgabe </font><b><font style="vertical-align: inherit;">informiert</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'http://localhost:8080/my-app/rest'</span>;
<span class="hljs-keyword">const</span> workerSettings = {
 <span class="hljs-attr">workerId</span>: <span class="hljs-string">'worker01'</span>, <span class="hljs-comment">// some unique name for the current worker instance</span>
 <span class="hljs-attr">maxTasks</span>: <span class="hljs-number">5</span>,
 <span class="hljs-attr">topics</span>: [<font></font>
   {<font></font>
     <span class="hljs-attr">topicName</span>: <span class="hljs-string">'sendEmail'</span>,
     <span class="hljs-attr">lockDuration</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// How much time the worker thinks he needs to process the task</span>
     <span class="hljs-attr">variables</span>: [<span class="hljs-string">'video'</span>] <span class="hljs-comment">// Which variables should be returned in the response (to avoid additional REST calls to read data)</span><font></font>
   }]};<font></font>
<span class="hljs-keyword">const</span> requestParams = {<span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">headers</span>: {<span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/json'</span>}};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pollExternalTasks</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/fetchAndLock`</span>, {<font></font>
   ...requestParams,<font></font>
   <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(workerSettings)<font></font>
 })<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processExternalTask</span>(<span class="hljs-params">result = []</span>) </span>{
 <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(result.map(<span class="hljs-function"><span class="hljs-params">externalTask</span> =&gt;</span> {<font></font>
   sendEmail(externalTask); <span class="hljs-comment">// Here the actual work would be done</span><font></font>
<font></font>
   <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/<span class="hljs-subst">${externalTask.id}</span>/complete`</span>, {<font></font>
     ...requestParams,<font></font>
     <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({<span class="hljs-attr">workerId</span>: workerSettings.workerId}),<font></font>
   })<font></font>
 }));<font></font>
}<font></font>
<font></font>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
 pollExternalTasks().then(processExternalTask)<font></font>
}, <span class="hljs-number">20000</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie aus dem obigen Code sehen können, die wichtigsten Methoden für den </font><font style="vertical-align: inherit;">Umgang mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externen Aufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetchAndLock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vollständig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die erste Methode fordert eine Liste von Aufgaben an und sichert deren Implementierung. Die zweite Methode informiert über den Abschluss der Aufgabe. </font><font style="vertical-align: inherit;">Neben diesen beiden Methoden gibt es noch andere, die Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der offiziellen Dokumentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nachlesen können </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda externer Task-Client</font></font></h2><br>
<img src="https://habrastorage.org/webt/sf/td/-g/sftd-gp7palq7dtzvgvpjqyj2y0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Verarbeitung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externer Aufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu implementieren, stellte </font><b><font style="vertical-align: inherit;">camunda </font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clients zur Verfügung </font><font style="vertical-align: inherit;">, mit denen Sie externe Aufgabenhandler in nur wenigen Zeilen erstellen können. </font><font style="vertical-align: inherit;">Es gibt auch eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausführliche Anleitung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die die Grundprinzipien der Verarbeitung externer Aufgaben beschreibt - wiederum mit Beispielen in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Beispielimplementierung eines externen Handlers mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExternalTaskClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String... args)</span> </span>{
       <span class="hljs-comment">// bootstrap the client</span><font></font>
       ExternalTaskClient client = ExternalTaskClient.create()<font></font>
           .baseUrl(<span class="hljs-string">"http://localhost:8080/engine-rest"</span>)<font></font>
           .asyncResponseTimeout(<span class="hljs-number">1000</span>)<font></font>
           .build();<font></font>
<font></font>
       <span class="hljs-comment">// subscribe to the topic</span>
       client.subscribe(<span class="hljs-string">"sendEmail"</span>).handler((externalTask, externalTaskService) -&gt; {
           <span class="hljs-keyword">try</span> {<font></font>
               String result = sendEmail(externalTask)<font></font>
               Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
               variables.put(<span class="hljs-string">"result"</span>, result);<font></font>
               externalTaskService.complete(externalTask, variables);<font></font>
               System.out.println(<span class="hljs-string">"The External Task "</span> + externalTask.getId() + <span class="hljs-string">" has been completed!"</span>);<font></font>
           } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
               externalTaskService.handleFailure(externalTask, e.message, e.stackTrace.toString())<font></font>
           }<font></font>
       }).open();<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn für Ihre Aufgabe nicht nur eine synchrone Aktion ausgeführt werden muss, sondern der gesamte Prozess </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestartet werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muss, können Sie dies beispielsweise tun, indem Sie den Prozess über </font><b><font style="vertical-align: inherit;">RuntimeService starten</font></b><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailWorker</span></span>(
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> runtimeService: RuntimeService<font></font>
) {<font></font>
   <span class="hljs-keyword">val</span> builder = ExternalTaskClientBuilderImpl().baseUrl(<span class="hljs-string">"http://localhost:8080"</span>).workerId(<span class="hljs-string">"myWorker"</span>)
   <span class="hljs-keyword">val</span> taskClient = builder.build()
   <span class="hljs-keyword">val</span> engineClient = (builder <span class="hljs-keyword">as</span> ExternalTaskClientBuilderImpl).engineClient<font></font>
<font></font>
   <span class="hljs-meta">@PostConstruct</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient<font></font>
           .subscribe(<span class="hljs-string">"sendEmail"</span>)<font></font>
           .lockDuration(<span class="hljs-number">10000</span>)<font></font>
           .handler { externalTask, externalService -&gt;<font></font>
               runtimeService.startProcessInstanceByKey(<font></font>
                   <span class="hljs-string">"SendEmailProcess"</span>,<font></font>
                   externalTask.getVariable(<span class="hljs-string">"emailId"</span>),<font></font>
                   mapOf(<font></font>
                       <span class="hljs-string">"text"</span> to externalTask.getVariable(<span class="hljs-string">"text"</span>),
                       <span class="hljs-string">"email"</span> to externalTask.getVariable(<span class="hljs-string">"email"</span>)<font></font>
                   )<font></font>
               )<font></font>
           }<font></font>
           .<span class="hljs-keyword">open</span>()<font></font>
   }<font></font>
<font></font>
<font></font>
   <span class="hljs-meta">@PreDestroy</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient.stop()<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Delegate from SendEmailProcess process</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailResultDelegate</span></span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> emailWorker: EmailWorker) {
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doExecute</span><span class="hljs-params">(execution: <span class="hljs-type">DelegateExecution</span>)</span></span> {<font></font>
       emailWorker.engineClient.complete(<font></font>
           execution.readVar(EXTERNAL_TASK_ID),<font></font>
           mapOf(<span class="hljs-string">"result"</span> to <span class="hljs-string">"Success"</span>)<font></font>
       )<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Beispiel </font><font style="vertical-align: inherit;">startet der </font><font style="vertical-align: inherit;">externe Aufgabenhandler ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailWorker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) beim </font><b><font style="vertical-align: inherit;">Empfang</font></b><font style="vertical-align: inherit;"> der Aufgabe den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SendEmailProcess-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prozess </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich vor, dieser Prozess führt einige Aktionen aus, die zum Senden des Newsletters erforderlich sind, und ruft schließlich </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailResultDelegate auf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wodurch die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe abgeschlossen wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architektonische Vorteile externer Aufgaben</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erwähnenswert, dass es eine Möglichkeit gibt, den Prozess in einer anderen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anwendung </font><b><font style="vertical-align: inherit;">auf</font></b><font style="vertical-align: inherit;"> einfachere </font><font style="vertical-align: inherit;">Weise zu starten </font><font style="vertical-align: inherit;">: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST: / rest / Prozessdefinition / key / $ {id} / start</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wenn Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , haben Sie keine Transaktionsgarantien. </font><font style="vertical-align: inherit;">Wir arbeiten aber auch </font><font style="vertical-align: inherit;">mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externen Aufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Was ist dann der Unterschied? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Unterschied besteht darin, dass wir den externen Dienst nicht direkt aufrufen, sondern nur Aufgaben veröffentlichen, die verarbeitet werden können. Stellen Sie sich ein Beispiel vor: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/-3/iv/cv-3ivsxpit3o3q8zosyi1e9jkw.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein externer Handler übernimmt eine Aufgabe, die ihm jetzt zugewiesen ist. Wenn jedoch eine Antwort empfangen wird, wird die Verbindung getrennt. Jetzt auf der Seite der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Aufgabe, die nicht verarbeitet wird, wird blockiert, da der externe Handler keine Antwort erhalten hat. Dies ist jedoch nicht beängstigend: In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gibt es eine Zeitüberschreitung, mit der die Aufgabe wieder in die Warteschlange zurückkehrt und jemand anderes damit umgehen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten wir nun den Fall, in dem ein externer Handler eine Aufgabe empfangen, abgeschlossen und die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vollständige</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode aufgerufen </font><b><font style="vertical-align: inherit;">hat</font></b><font style="vertical-align: inherit;"> , die aufgrund von Netzwerkproblemen fehlgeschlagen ist. Jetzt können Sie nicht mehr verstehen, ob die Aufgabe in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfolgreich abgeschlossen wurde </font><font style="vertical-align: inherit;">oder nicht. Sie können es erneut versuchen, es besteht jedoch die Möglichkeit, dass Netzwerkprobleme weiterhin auftreten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall wäre die beste Lösung, das Problem zu ignorieren. Wenn die Aufgabe erfolgreich abgeschlossen wurde, ist alles in Ordnung. Wenn nicht, steht die Aufgabe nach dem Timeout wieder zur Bearbeitung zur Verfügung. Dies bedeutet jedoch, dass Ihr externer Handler idempotent sein oder Logik zum Deduplizieren von Aufgaben enthalten muss. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein ähnliches Problem kann beim Starten eines neuen Prozesses auftreten. Zuvor sollten Sie vorhandene Instanzen mit denselben Daten überprüfen, z. B. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">businessKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben hoher Fehlertoleranz </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externe Aufgabe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dieser Option können Sie externe Handler einfach skalieren und in einer beliebigen Programmiersprache implementieren. </font><font style="vertical-align: inherit;">Gleichzeitig hilft das Muster, Mikrodienste so zu implementieren, dass sie sich so wenig wie möglich gegenseitig beeinflussen, wodurch ihre Stabilität erhöht wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere Informationen zu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externen Aufgaben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/process-engine/external-tasks/ </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/reference/rest/external -task / </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/ext-client/</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490644/index.html">Einfaches RPM-Repository mit Inotify und Webdav</a></li>
<li><a href="../de490648/index.html">Verwenden von Kata-Containern in Kubernetes</a></li>
<li><a href="../de490650/index.html">Die Hauptfehler bei der Erstellung eines Lebenslaufs durch IT-Anfänger</a></li>
<li><a href="../de490652/index.html">Logistik. Einführung Fast kompliziert</a></li>
<li><a href="../de490654/index.html">Punktierung über Gassensoren der MQ-Serie - tiefes Verständnis des Datenblattes und der Abstimmung</a></li>
<li><a href="../de490660/index.html">Wie haben wir das Wachstum von CityMobile sichergestellt?</a></li>
<li><a href="../de490664/index.html">PHP: array_key_exists sucht 500-mal schneller als in_array</a></li>
<li><a href="../de490668/index.html">Die Geschichte der Transformation vom Produkt zum Projekt und umgekehrt (am Beispiel der Güte in der Region Moskau)</a></li>
<li><a href="../de490670/index.html">Wie man ein Auto dazu bringt, Tests aus Code für Sie zu schreiben</a></li>
<li><a href="../de490674/index.html">Habr Wickley # 41 / Autonomere Autos, prof. Fortran, Yandex, der Schmerz des Roboters, wie man die Website eines Konkurrenten blockiert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>