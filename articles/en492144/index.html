<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùÑÔ∏è üë©üèª‚Äçüéì üë®üèø‚Äçüåæ Swipe management in a game project on Godot Engine üë®üèª‚Äçüé§ üë®‚Äçüë¶‚Äçüë¶ üßïüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all! Today I would like to talk about how to implement swipe management in a game project for Android on the Godot Engine.
 
 
 My name i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Swipe management in a game project on Godot Engine</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492144/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Greetings to all! </font><font style="vertical-align: inherit;">Today I would like to talk about how to implement swipe management in a game project for Android on the Godot Engine.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/773/b8a/443/773b8a4432cd4faa601f0b96aa425352.gif" alt="image"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My name is Peter, and I am one of the active users of the Godot Engine game engine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the Russian-language segment, there is a huge shortage of materials on this tool, which surprises me very much, since it is one of the fastest growing game engines. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, it is in many ways inferior to such engines as Unity, UE, and the like, and you won‚Äôt make a AAA class game on it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However! It is free (full), cross-platform (full), and its weight is about 60 megabytes, as opposed to the same Unity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The engine runs on most devices, even if the latter are from a very budget line. Also, ‚Äúout of the box‚Äù, it is already Russified, has all the necessary tools on board, does not require additional software, and does not eat up all RAM in running form. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I already saw a couple of articles on Habr√© on it, and this is very small, since it is so friendly to the developer that it‚Äôs a big omission to go past it and not try it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The topic of this post is the implementation of swipe management (gestures) in an Android project. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the experience of my use of the engine is quite extensive, and if the topic gets a response, I can arrange an entire training course. By this post I want to at least draw your attention to the engine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a programming language, you can use, again, out of the box, two options: GDScript and C #. I will use the first one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The interface of the main editor looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/08c/413/508/08c41350881b6a2f1b89c16be70cfa7a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In it you can work simultaneously with 3D, 2D, scripts and in general everything that a developer may require. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The engine uses an approach in which your game is a set of scenes nested into each other. And there may be some confusion, because I use the term ‚Äúscene‚Äù for nodes that are just game scenes (situations, windows, game states (menus, games, etc.)), and for other cases I use the term "Prefab" borrowed from Unity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since in this post I will consider a special case, I will not expand on some topics. If something is unclear, there are comments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the main scene for the demonstration, we will have a game. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Its structure looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b02/e02/749/b02e027490b4d5b53a0988584ce5819a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The root node of the game stores nested inside itself: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - world, - stores level data in it </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - level, - a set of environment objects (blocks, rings, obstacles) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - player, - player object </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - InterpolatedCamera, - smooth the camera that watches the player </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - gui, - interface, will not be involved. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Names to objects and structure are arbitrary and this is only a special case.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Near some objects, you can see icons saying that this object is a prefab (nested scene) and a script can also be added to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, clicking on the ‚Äúscript‚Äù icon, we get into the script editor, in fact, the engine‚Äôs operating mode simply switches. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f10/ba8/178/f10ba8178d6fcdd585a2e31fe1d63088.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this operating mode, you can edit the behavior of objects. Actually, in this case it is a script of the world object, which, when loading an object into the game, sets the camera object (InterpolatedCamera) sets the target for tracking.</font></font><br>
<br>
<pre><code class="python hljs">extends Spatial<font></font>
<font></font>
func _ready():<font></font>
	$InterpolatedCamera.target = <span class="hljs-string">'../player/camera'</span> <span class="hljs-comment">#  , ,         (  ).   player  "camera"   pivot.   .         .</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Syntactically, GDScript is similar to Python. You can take a brief training on GDScript in Russian here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDScript Book</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
With the world object, it‚Äôs clear, it just sets the camera‚Äôs tracking target. The next object (already a child of world) is level. Its structure looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6c9/66c/d57/6c966cd5730b9f968c40ea4731c9b910.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, these are simply arranged objects with physical properties that do not have scripts or behavior. In addition to the "cell" objects. These are spinning rings disappearing in contact with the player‚Äôs object. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The player object is most interesting right now, which contains the swipe control logic for touch screens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This prefab looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7b0/463/3ef/7b04633ef9eea50d04dafe2718a8c017.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The root object has a script, which we will get to a little later. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, consider nested objects.</font></font><br>
<br>
<ul>
<li>camera, ‚Äî     ,      ,   .           player.</li>
<li>CollisionShape, ‚Äî    .        ¬´¬ª .        ,     ,   .         .</li>
<li>MeshInstance, ‚Äî    .     ,  .   Blender 3D ,   .</li>
<li>Tween,        .          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, now consider the script itself in the root object. It turns out to be the most voluminous in the whole "game". </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2e8/e97/33d/2e8e9733deb908e37715c9ce68a90187.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, its description and decoding.</font></font><br>
<br>
<pre><code class="python hljs">
extends KinematicBody <span class="hljs-comment">#       </span><font></font>
<font></font>
<span class="hljs-comment">#  </span>
const GRAV = <span class="hljs-number">0.5</span> <span class="hljs-comment">#   (      Y, ..       ,     )</span>
const SPEED = <span class="hljs-number">2</span> <span class="hljs-comment">#  </span>
const SWIPE_SPEED = <span class="hljs-number">30</span> <span class="hljs-comment">#       </span>
const JUMP_SPEED = <span class="hljs-number">10</span> <span class="hljs-comment">#     </span><font></font>
<font></font>
onready var ball = $MeshInstance <span class="hljs-comment">#        </span>
onready var tween = $Tween <span class="hljs-comment">#      </span>
var vel = Vector3() <span class="hljs-comment">#     </span>
var swipe = <span class="hljs-string">''</span> <span class="hljs-comment">#       </span><font></font>
<font></font>
<font></font>
func _ready():<font></font>
	<span class="hljs-keyword">pass</span> <span class="hljs-comment">#        ;    </span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#       (60FPS)  </span>
func _physics_process(delta): <span class="hljs-comment"># delta -  Delta Time ,  ,    </span>
	vel.y -= GRAV <span class="hljs-comment">#      (  )</span>
	vel.z = -SPEED <span class="hljs-comment">#     .   </span>
	ball.rotate_x(-delta * SPEED * <span class="hljs-number">2</span>) <span class="hljs-comment">#     ,   ""</span><font></font>
<font></font>
	<span class="hljs-keyword">if</span> swipe &amp;&amp; swipe != <span class="hljs-string">'swiped'</span>: <span class="hljs-comment">#         </span>
		<span class="hljs-keyword">if</span> swipe == <span class="hljs-string">'up'</span> &amp;&amp; is_on_floor(): <span class="hljs-comment">#        ()</span>
			vel.y = JUMP_SPEED <span class="hljs-comment">#     ,   -  </span>
		<span class="hljs-keyword">elif</span> swipe == <span class="hljs-string">'left'</span> || swipe == <span class="hljs-string">'right'</span>: <span class="hljs-comment">#     </span>
			tween.interpolate_property(self, <span class="hljs-string">"translation"</span>, <span class="hljs-comment">#      </span>
				translation, translation+Vector3(<span class="hljs-number">-2</span> <span class="hljs-keyword">if</span> swipe == <span class="hljs-string">'left'</span> <span class="hljs-keyword">else</span> <span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">0.2</span>, <span class="hljs-comment">#    ,         X.      . -2  ,  2</span>
				Tween.TRANS_CUBIC, Tween.EASE_IN_OUT) <span class="hljs-comment">#     "" </span>
			tween.start() <span class="hljs-comment">#   </span>
		swipe = <span class="hljs-string">'swiped'</span> <span class="hljs-comment">#   ,   </span><font></font>
<font></font>
	vel = move_and_slide(vel, Vector3.UP) <span class="hljs-comment">#       ,                  </span><font></font>
<font></font>
<span class="hljs-comment">#       </span><font></font>
func _input(e):<font></font>
	<span class="hljs-keyword">if</span> e <span class="hljs-keyword">is</span> InputEventScreenDrag: <span class="hljs-comment"># ,       </span>
		<span class="hljs-keyword">if</span> !swipe: <span class="hljs-comment">#       </span>
			<span class="hljs-keyword">if</span> e.relative.y &lt; -SWIPE_SPEED: <span class="hljs-comment">#       Y</span>
				swipe = <span class="hljs-string">'up'</span> <span class="hljs-comment">#     (     )    ( ,          ),     " (UP)"</span>
			<span class="hljs-keyword">elif</span> e.relative.x &lt; -SWIPE_SPEED: <span class="hljs-comment">#      ,     X.     -  </span>
				swipe = <span class="hljs-string">'left'</span>
			<span class="hljs-keyword">elif</span> e.relative.x &gt; SWIPE_SPEED: <span class="hljs-comment">#  ,</span>
				swipe = <span class="hljs-string">'right'</span> <span class="hljs-comment">#  </span><font></font>
<font></font>
	<span class="hljs-keyword">elif</span> e <span class="hljs-keyword">is</span> InputEventScreenTouch: <span class="hljs-comment">#     </span>
		<span class="hljs-keyword">if</span> !e.pressed: <span class="hljs-comment">#      </span>
			swipe = <span class="hljs-string">''</span> <span class="hljs-comment">#   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I described each line, I hope, with scripts everything plus or minus is clear. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If in Russian, then when we move our finger across the screen, we register the direction of movement and speed. If the finger moves at the desired speed, we count the swipe. Based on which axis and in which direction the movement was going, we have three options: UP, LEFT, RIGHT. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We write the received value into a variable, which is immediately picked up by the event of updating the state of the object, and performs the necessary actions with it, after which it marks the event as fulfilled and expects the next. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I took not the easiest way to implement a swipe, but it is quite reliable and works in most situations. Of course, it depends on the genre and type of game.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of the work done, we get an example of how easy it is to implement swipe management in literally ten minutes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In total, it took me about 30 minutes, this is taking into account the creation of models in Blender. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, according to tradition ...</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development Video</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/b8NPIt0TqXU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source code</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  ,  </a><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492128/index.html">Interface Tales of Toxic Grandfather ‚ÄúGet a Rag!‚Äù (s1 e4)</a></li>
<li><a href="../en492130/index.html">Fuzzy math. Relationships and wolf tails</a></li>
<li><a href="../en492134/index.html">Pros and cons of doing business in the USA: impressions after three years of development of two companies</a></li>
<li><a href="../en492138/index.html">Why do we (possibly) overestimate the lethality of COVID-19</a></li>
<li><a href="../en492140/index.html">Hangover March 8: another article on Habr√© about women in IT</a></li>
<li><a href="../en492146/index.html">Alexander Pavlyuk: ‚ÄúI really want building plans to gradually appear in OSM‚Äù</a></li>
<li><a href="../en492148/index.html">How to change hosting</a></li>
<li><a href="../en492150/index.html">Implement it completely. Di-in-js</a></li>
<li><a href="../en492154/index.html">Launch of ExoMars delayed to the next launch window in 2022</a></li>
<li><a href="../en492156/index.html">Subtracted. Want. Do</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>