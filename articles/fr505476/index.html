<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø üëú üëàüèª API CRUD sur Deno et PostegreSQL: travailler avec un dinosaure üõéÔ∏è ü¶É üë®‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. En pr√©vision du d√©but du cours ¬´D√©veloppeur Fullstack JavaScript¬ª , nous souhaitons partager du mat√©riel int√©ressant envoy√© par notre ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>API CRUD sur Deno et PostegreSQL: travailler avec un dinosaure</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/505476/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour √† tous. </font><font style="vertical-align: inherit;">En pr√©vision du d√©but du cours </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´D√©veloppeur Fullstack JavaScript¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous souhaitons partager du mat√©riel int√©ressant envoy√© par notre r√©dacteur ind√©pendant. </font><font style="vertical-align: inherit;">Cet article n'est pas li√© au programme du cours, mais il sera certainement int√©ressant comme une courte revue sur Deno.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/1a/5g/sq/1a5gsqglaelsf8jja4zdr0jslbw.png"><br>
<br>
<hr><br>
<blockquote>"-,    CLI   Deno .    secure runtime ?"<br>
"-"<br>
"-,     ,   ,    -  .   ?"<br>
"-"</blockquote><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous. </font><font style="vertical-align: inherit;">Deno devient de plus en plus c√©l√®bre et populaire, il existe un grand nombre de nouvelles vid√©os et guides de texte sur ce sujet, mais principalement en anglais. </font><font style="vertical-align: inherit;">Plusieurs articles sur Deno ont √©galement √©t√© publi√©s sur Habr√©, par exemple, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais principalement des articles parlent de Deno en termes th√©oriques. </font><font style="vertical-align: inherit;">Aujourd'hui, nous allons essayer de cr√©er un petit CRUD Api, qui peut servir, par exemple, une application todo sur le frontend, et je partagerai avec vous mes impressions de ce dinosaure en vrai codage.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introduction th√©orique </font></font></h1><br>
<img src="https://habrastorage.org/webt/ou/cz/_q/oucz_qc3vym7u2ftdzkcgnt65pi.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ceux qui sont dans le tank, je vais vous dire ce qu'est Deno, si vous n'avez pas lu, par exemple, l'un des articles ci-dessus. Deno est un runtime d'ex√©cution qui s'ex√©cute sur JavaScript et TypeScript (TypeScript est pris en charge, la version du compilateur TypeScript est c√¢bl√©e √† la version Deno, vous ne pouvez la modifier que si vous changez la version Deno), qui est bas√©e sur le moteur V8 et le langage de programmation Rust. Deno a √©t√© cr√©√© par Ryan Dahl, le cr√©ateur de Node.js, et les principales qualit√©s de Deno sont la performance et la s√©curit√©. Deno a √©t√© annonc√© en 2018, et ce que de nombreuses sources oublient de mentionner - a √©t√© grandement influenc√© par Golang (et en effet, il a √©t√© √©crit √† l'origine √† Golang, mais a ensuite d√ª √™tre r√©√©crit √† Rust).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La biblioth√®que standard a √©t√© cr√©√©e sur le mod√®le de la biblioth√®que Go standard, et de nombreux outils ou leurs impl√©mentations sont pass√©s de Golang √† Deno, par exemple, l'absence d'un √©cosyst√®me comme npm et le pompage des biblioth√®ques directement √† partir des ressources Web au stade de la construction initiale (ce qui provoque une sorte de stupeur dans Node. js de d√©veloppeurs qui, tout naturellement, ne connaissaient pas un syst√®me similaire avec Go). </font><font style="vertical-align: inherit;">Alors, pour qui est Deno maintenant? </font><font style="vertical-align: inherit;">Si vous aimez les langages dactylographi√©s, comme les id√©es et les outils de Golang, mais que vous voulez √©crire sur quelque chose de plus simple - il est temps d'essayer Deno en r√©alit√©. </font><font style="vertical-align: inherit;">Cependant, si vous voulez attendre que la plateforme m√ªrisse, plus de biblioth√®ques et de r√©ponses √† StackOverflow appara√Ætront, vous devriez peut-√™tre attendre un peu.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Commencez √† cr√©er </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© la jeunesse de Deno, aucun √©cosyst√®me ne s'est form√© autour de lui (qui, bien s√ªr, ne peut pas encore √™tre compar√© √† l'√©cosyst√®me Node.js), ce qui vous permet de couvrir les besoins de base pour cr√©er votre propre API. </font><font style="vertical-align: inherit;">D√©cidons ce que nous cr√©ons: je veux cr√©er un simple CRUD Api en utilisant Deno et TypeScript sur le backend (car il existe un support TypeScript, pourquoi ne pas l'utiliser), PostgreSQL comme base de donn√©es (en g√©n√©ral, je voulais utiliser MySQL, mais j'ai accidentellement rompu mon acc√®s sur localhost et n'a pas pu le r√©parer. Un fait int√©ressant est que sur l'ip externe, le serveur PHP 7.4 int√©gr√© a pu se connecter √† ma base de donn√©es MySQL, et Deno a montr√© des paquets en panne), et nos demandes ressembleront √† ceci:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√©thode </font></font></b></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Itin√©raires </font></font></b></td>
<td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©sultat d'ex√©cution </font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avoir </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / get</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtenir toutes les t√¢ches </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Publier </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / post</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cr√©er une nouvelle entreprise </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PI√àCE </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mise √† jour d'un cas sp√©cifique </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUPPRIMER </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supprimer le cas par identifiant </font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous avons d√©cid√© du sch√©ma de requ√™te, nous avons lanc√© le serveur PostgreSQL (si vous pouvez le t√©l√©charger </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est un tr√®s bon client GUI </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postico</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nous avons cr√©√© la base de donn√©es crud_api. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Et apr√®s? </font><font style="vertical-align: inherit;">Vous pouvez cr√©er une table avec vos mains en utilisant des requ√™tes SQL ou un client, bien s√ªr, mais je veux voir comment cela se passe avec les migrations de Deno. </font><font style="vertical-align: inherit;">Dans ce cas </font><font style="vertical-align: inherit;">, la </font><font style="vertical-align: inherit;">biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nessia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">utile</font></a><font style="vertical-align: inherit;"> , vous permettant de cr√©er des migrations similaires √† des migrations dans Laravel. </font><font style="vertical-align: inherit;">Mais avant de passer √† la migration, parlons de l'organisation d'un environnement de d√©veloppement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'autre jour, le plugin de d√©veloppement officiel JetBrains Deno est sorti. </font><font style="vertical-align: inherit;">Vous pouvez le trouver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sur Visual Studio, vous devez installer le plug-in Deno et dans le dossier du projet, cr√©ez le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dossier des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> param√®tres </font><i><font style="vertical-align: inherit;">.vscode</font></i><font style="vertical-align: inherit;"> , o√π dans settings.json vous activez la prise en charge de deno (mais cela semblait fonctionner pour moi sans):</font></font><br>
<br>
<pre><code class="json hljs">    <span class="hljs-string">"deno.enable"</span>:<span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout avec la phase pr√©paratoire, on peut revenir aux migrations. </font><font style="vertical-align: inherit;">Nous devons d'abord entrer la commande d'initialisation, en la tirant de la documentation de leur biblioth√®que:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts init
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous cr√©ons un fichier de configuration pour notre biblioth√®que, √† l'aide duquel nous pouvons d√©terminer √† quel SGBD et base de donn√©es vous allez vous connecter. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, trois mod√®les sont cr√©√©s dans le fichier - pour PostgreSQL, MySQL et Sqlite (par d√©faut, les param√®tres pour PostegreSQL sont export√©s). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, notre fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nessie.config.ts</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressemblera √† ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { ClientPostgreSQL} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/nessie/mod.ts"</span>; <font></font>
<font></font>
<span class="hljs-keyword">const</span> migrationFolder = <span class="hljs-string">"./migrations"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> configPg = {
  <span class="hljs-attr">client</span>: <span class="hljs-keyword">new</span> ClientPostgreSQL(migrationFolder, {
    <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">""</span>,<font></font>
  }),<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> configPg;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, vous pouvez maintenant cr√©er un fichier de migration afin de pouvoir le modifier en sp√©cifiant quelle table et quelles donn√©es nous allons cr√©er. </font><font style="vertical-align: inherit;">Pour ce faire, entrez la commande suivante:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts make create_todo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-√™tre que le lecteur inexp√©riment√© a d√©j√† demand√© pourquoi tant de drapeaux. </font><font style="vertical-align: inherit;">C'est la s√©curit√© de Deno - pour ex√©cuter la commande, vous devez sp√©cifier le niveau d'acc√®s que vous lui donnez ( </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c'est le syst√®me de s√©curit√© ing√©nieux que nous attendions</font></font></strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Ces drapeaux provoquent des br√ªlures assez vives dans de nombreux cas - doivent-ils √™tre imprim√©s? </font><font style="vertical-align: inherit;">Ajouter des scripts bash dans lesquels vous les invoquez toujours avec tous les droits? </font><font style="vertical-align: inherit;">Je pense qu'√† un moment donn√©, ce syst√®me va changer, mais pour l'instant, tel qu'il est. </font><font style="vertical-align: inherit;">Ainsi, </font></font><code>.migrations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un fichier de migration devrait appara√Ætre </font><font style="vertical-align: inherit;">dans notre dossier </font><font style="vertical-align: inherit;">, que vous pouvez le modifier au fur et √† mesure. </font><font style="vertical-align: inherit;">Je l'ai √©dit√© comme suit:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> up = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"CREATE TABLE todo (id serial, text text, done boolean)"</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> down = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"DROP TABLE todo"</span><font></font>
};<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, nous pouvons migrer vers la base de donn√©es √† l'aide de la commande suivante:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read https://deno.land/x/nessie/cli.ts migrate
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a une option de migration plus avanc√©e dans nessia, mais j'ai d√©cid√© de rendre les choses un peu plus faciles. </font><font style="vertical-align: inherit;">De plus, nous pouvons proc√©der √† la cr√©ation de notre propre mod√®le.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous travaillons avec le mod√®le</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Nous cr√©ons un dossier </font></font><code>models</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel nous aurons les demandes elles-m√™mes. </font><font style="vertical-align: inherit;">Vous devez d'abord cr√©er un fichier </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel les param√®tres de connexion √† la base de donn√©es seront ajout√©s (oui, nous les avons d√©j√† mentionn√©s dans </font></font><code>nessie.config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais ce fichier a √©t√© utilis√© pour la migration). </font><font style="vertical-align: inherit;">Pour la connexion dans le fichier, </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous utiliserons la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que deno-posgres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par cons√©quent, le fichier de configuration ressemblera √† ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Client } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/postgres/mod.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Client({
  <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
  <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
  <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> client;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien! </font><font style="vertical-align: inherit;">Passons maintenant directement au mod√®le. </font><font style="vertical-align: inherit;">Pour construire des requ√™tes SQL, je vais utiliser la biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le port de la biblioth√®que Knex sur Deno. </font><font style="vertical-align: inherit;">Cela me permettra de d√©terminer par programme quelle requ√™te SQL je vais ex√©cuter. </font><font style="vertical-align: inherit;">Commen√ßons par d√©finir le dialecte avec lequel Dex devra travailler cette fois, et d√©finissons l'interface de nos t√¢ches:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> dex = Dex({ <span class="hljs-attr">client</span>: <span class="hljs-string">"postgres"</span> });<font></font>
<font></font>
interface Todo {<font></font>
  id?: number;   <span class="hljs-comment">//? -     TypeScript</span><font></font>
  text: string;<font></font>
  done: boolean;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, nous pouvons maintenant passer √† la pulpe elle-m√™me. </font><font style="vertical-align: inherit;">Tout d'abord, d√©finissez une demande get qui recevra toutes les t√¢ches. </font><font style="vertical-align: inherit;">J'utiliserai l'ex√©cution de la fonction asynchrone pour me connecter √† la base de donn√©es via wait et obtenir le r√©sultat de la requ√™te:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllTodo</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
  <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √™tes m√™me un peu familier avec TypeScript et c async / wait, vous n'aurez aucune question ici. </font><font style="vertical-align: inherit;">Mais plus encore - nous devons √©crire une post-demande qui ajoutera le cas √† la base de donn√©es.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTodo</span>(<span class="hljs-params">todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> insertQuery = dex.queryBuilder().insert([todo]).into(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">return</span> client.query(insertQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code ci-dessus peut √™tre raccourci, cependant, j'ai essay√© de le rendre aussi simple et expressif que possible, m√™me au d√©triment du nombre de lignes. </font><font style="vertical-align: inherit;">En termes g√©n√©raux, ce qui se passe l√†-bas - √† l'int√©rieur de la fonction, nous cr√©ons une connexion √† la base de donn√©es, ins√©rons - une demande est cr√©√©e, une demande se produit, √† l'int√©rieur de laquelle une nouvelle demande est cr√©√©e, qui renvoie le cas nouvellement cr√©√© ou un objet vide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autres fonctions - √©dition et suppression, je donnerai ensemble. </font><font style="vertical-align: inherit;">Lors de l'√©dition, la m√™me chose se produit pour nous que pour l'ajout d'un cas, sauf que nous avons une mise √† jour dans editTodo. </font><font style="vertical-align: inherit;">Dans la suppression, nous supprimons simplement le bo√Ætier et ne retournons rien:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editTodo</span>(<span class="hljs-params">id: number, todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> editQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).update(todo).where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(editQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteTodo</span>(<span class="hljs-params">id: number</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> deleteQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).delete().where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(deleteQuery);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensationnel. </font><font style="vertical-align: inherit;">Il ne reste plus qu'√† exporter nos fonctions, et vous pouvez commencer √† configurer le serveur et le routage:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> {<font></font>
  addTodo,<font></font>
  getAllTodo,<font></font>
  editTodo,<font></font>
  deleteTodo,<font></font>
};<font></font>
<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Routage et fonctionnement du serveur </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cr√©ez le dossier routes dans lequel nous aurons routes.ts. </font><font style="vertical-align: inherit;">Pour travailler nos routes, nous utiliserons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denotrain</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une biblioth√®que qui a √©t√© inspir√©e par expressJS et qui est autoris√©e √† travailler avec les requ√™tes url, √† configurer le routage et beaucoup de choses utiles. </font><font style="vertical-align: inherit;">Nous importons nos fonctions et notre routeur:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Router } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> { addTodo, getAllTodo, editTodo, deleteTodo } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/models.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> Router();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez les m√©thodes get et post:</font></font><br>
<br>
<pre><code class="javascript hljs">api.get(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> getAllTodo().then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result.rows;
    <span class="hljs-comment">// </span><font></font>
  });<font></font>
});<font></font>
<font></font>
api.post(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> body = {
  <span class="hljs-comment">//  </span>
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> addTodo(body).then(<span class="hljs-function">(<span class="hljs-params">newTodo</span>) =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">201</span>); <span class="hljs-comment">//   "Created"</span>
    <span class="hljs-keyword">return</span> newTodo;<font></font>
  });<font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ctx est la variable responsable du contexte de r√©ponse. </font><font style="vertical-align: inherit;">Je ne sais pas quoi ajouter aux commentaires, √† mon avis, tout est d√©j√† si √©vident. </font><font style="vertical-align: inherit;">Il ne reste plus qu'√† ajouter les m√©thodes de patch et de suppression et d'exporter notre api:</font></font><br>
<br>
<pre><code class="javascript hljs">api.patch(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> todo = {
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> editTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number, todo).then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result;<font></font>
  });<font></font>
});<font></font>
<font></font>
api.delete(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> deleteTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">204</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  });<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> api;<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'√† relever notre serveur. </font><font style="vertical-align: inherit;">Dans le dossier racine, cr√©ez un fichier </font></font><code>server.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel nous importons √©galement Application de denotrain pour augmenter notre serveur:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {Application} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> api <span class="hljs-keyword">from</span> <span class="hljs-string">"./routes/routes.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Application({<span class="hljs-attr">port</span>: <span class="hljs-number">1337</span>}) <span class="hljs-comment">//      1337</span><font></font>
<font></font>
app.use(<span class="hljs-string">"/api/todos"</span>, api) <span class="hljs-comment">//  ,      </span>
app.run() <span class="hljs-comment">//  </span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Il est possible que vous rencontriez des probl√®mes dans l'application. </font><font style="vertical-align: inherit;">Je ne veux pas red√©marrer le serveur compil√© manuellement √† chaque fois, donc j'utilise l'analogue de nodemon - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denomon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui recompilera fid√®lement votre code et red√©marrera le serveur. </font><font style="vertical-align: inherit;">Dans notre cas, la commande suivante convient:</font></font><br>
<br>
<pre><code class="bash hljs">denomon --allow net,<span class="hljs-built_in">read</span> server.ts
 </code></pre><br>
 <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mes impressions </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 J'ai vraiment aim√© √©crire sur Deno. Malgr√© un certain scepticisme dans sa direction, avec l'aide de TypeScript et d'un environnement de d√©veloppement bien construit, vous pouvez obtenir d'excellents r√©sultats en √©crivant un service hautement fiable qui fonctionnera aussi pr√©visible que possible. Il y a encore de la place pour grandir (par exemple, dans la vitesse de recompilation du projet) et il est trop t√¥t pour essayer Deno pour une production s√©rieuse, mais j'esp√®re que le dinosaure pourra adopter le meilleur de Node.js, changer l√©g√®rement les bizarreries de l'architecture et continuer son d√©veloppement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout dans la cr√©ation de notre API. Vous pouvez retrouver l'int√©gralit√© du projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vous pouvez ouvrir Postman et v√©rifier que tout fonctionne correctement. Par tradition, quelques liens utiles: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">microframework REST pour Deno sans d√©pendances </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejs-engine pour Deno</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    Deno</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Deno  Discord</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Chat App  Deno + React</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    Deno  </a><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505460/index.html">Payer pour une formation en codage: les bacheliers russes peuvent gagner une bourse pour √©tudier en vue d'un master en Suisse</a></li>
<li><a href="../fr505462/index.html">Micro-centre de donn√©es: pourquoi avons-nous besoin de centres de donn√©es miniatures?</a></li>
<li><a href="../fr505468/index.html">Archivage des e-mails dans Zimbra Collaboration Suite Open-Source Edition</a></li>
<li><a href="../fr505470/index.html">Notes du gestionnaire des connaissances. Fonctionnement de la gestion des connaissances Exness</a></li>
<li><a href="../fr505472/index.html">Article utile: installez OpenShift, apprenez Kafka, utilisez Ansible sur Google Cloud Platform</a></li>
<li><a href="../fr505478/index.html">Remplacement d'un syst√®me CRM par un syst√®me CRM</a></li>
<li><a href="../fr505488/index.html">12 conseils pour impl√©menter TypeScript dans les applications React</a></li>
<li><a href="../fr505494/index.html">Encadrement d√©veloppeur</a></li>
<li><a href="../fr505496/index.html">Flutter Dev Podcast avec CTO Meduza Boris Goryachev: l'essentiel de l'application Meduz et du d√©veloppement des m√©dias</a></li>
<li><a href="../fr505498/index.html">Comment nous r√©solvons le probl√®me de la m√©moire de pile non initialis√©e dans Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>