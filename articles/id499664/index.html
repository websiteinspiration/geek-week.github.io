<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐇 🌘 👰🏿 Porting APIs ke TypeScript sebagai Pemecah Masalah 😌 👴🏽 🧚🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Frontend Bereaksi dari Program Jalankan telah dikonversi dari JavaScript ke TypeScript. Tetapi backend, ditulis dalam Ruby, tidak menyentuh. Namun, ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Porting APIs ke TypeScript sebagai Pemecah Masalah</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/499664/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frontend Bereaksi dari Program Jalankan telah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dikonversi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari JavaScript ke TypeScript. Tetapi backend, ditulis dalam Ruby, tidak menyentuh. Namun, masalah yang terkait dengan backend ini membuat pengembang proyek berpikir tentang beralih dari Ruby ke TypeScript. Terjemahan dari materi yang kami terbitkan hari ini dikhususkan untuk kisah porting program Execute backend dari Ruby ke TypeScript, dan masalah apa yang membantu menyelesaikannya.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/hu/xl/8o/huxl8onleza7_5gvfndf7s-6sxm.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menggunakan Ruby backend, kadang-kadang kita lupa bahwa beberapa properti API menyimpan array string, bukan string sederhana. Terkadang kami mengubah fragmen API yang diakses di tempat yang berbeda, tetapi lupa memperbarui kode di salah satu tempat ini. Ini adalah masalah umum dari bahasa dinamis yang merupakan ciri khas dari sistem mana pun yang kodenya tidak 100% dicakup oleh pengujian. (Ini, meskipun kurang umum, terjadi ketika kode sepenuhnya dicakup oleh tes.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat yang sama, masalah ini telah menghilang dari frontend sejak kami beralih ke TypeScript. Saya memiliki lebih banyak pengalaman dalam pemrograman server daripada di klien, tetapi, meskipun demikian, saya membuat lebih banyak kesalahan ketika bekerja dengan backend, dan tidak dengan frontend. Semua ini menunjukkan bahwa backend juga harus dikonversi ke TypeScript.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya porting backend dari Ruby ke TypeScript pada Maret 2019 dalam waktu sekitar 2 minggu. Dan semuanya berjalan sebagaimana mestinya! Kami menerapkan kode baru dalam produksi pada 14 April 2019. Itu adalah versi beta yang tersedia untuk sejumlah pengguna. Setelah itu, tidak ada yang rusak. Pengguna bahkan tidak melihat apa pun. Berikut ini adalah grafik yang menggambarkan keadaan basis kode kami sebelum dan segera setelah transisi. Sumbu x mewakili waktu (dalam hari), sumbu y mewakili jumlah baris kode.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b26/90c/6a7/b2690c6a794a02298ad7b124c812d9d5.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menerjemahkan frontend dari JavaScript ke TypeScript, dan menerjemahkan backend dari Ruby ke TypeScript</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Selama proses porting, saya menulis sejumlah besar kode tambahan. Jadi, kami memiliki alat kami sendiri untuk menjalankan tes dengan volume 200 baris. Kami memiliki pustaka 120-line untuk bekerja dengan database, serta pustaka routing yang lebih besar untuk API, yang menghubungkan kode front-end dan back-end.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam infrastruktur kami sendiri, hal yang paling menarik untuk dibicarakan adalah router. Ini adalah pembungkus untuk Express, memastikan aplikasi yang benar dari jenis yang digunakan dalam kode klien dan server. Ini berarti bahwa ketika satu bagian dari API berubah, yang lain bahkan tidak dapat dikompilasi tanpa membuat perubahan untuk menghilangkan perbedaan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah backend handler yang mengembalikan daftar posting blog. </font><font style="vertical-align: inherit;">Ini adalah salah satu fragmen kode serupa yang paling sederhana dalam sistem:</font></font><br>
<br>
<pre><code class="javascript hljs">router.handleGet(api.blog, <span class="hljs-keyword">async</span> () =&gt; {
&nbsp;&nbsp;<span class="hljs-keyword">return</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">posts</span>: blog.posts,<font></font>
&nbsp;&nbsp;}<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita mengubah nama kunci </font></font><code>posts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menjadi </font></font><code>blogPosts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, kita mendapatkan kesalahan kompilasi, teks yang ditunjukkan di bawah ini (di sini, untuk singkatnya, informasi tentang jenis objek dihilangkan.)</font></font><br>
<br>
<pre><code class="javascript hljs">Property <span class="hljs-string">'posts'</span> is missing <span class="hljs-keyword">in</span> type <span class="hljs-string">'...'</span> but required <span class="hljs-keyword">in</span> type <span class="hljs-string">'...'</span>.
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap titik akhir ditentukan oleh objek tampilan </font></font><code>api.someNameHere</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Objek ini dibagikan oleh klien dan server. </font><font style="vertical-align: inherit;">Perhatikan bahwa jenis tidak disebutkan secara langsung dalam deklarasi handler. </font><font style="vertical-align: inherit;">Mereka semua disimpulkan dari argumen </font></font><code>api.blog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan ini berfungsi untuk titik akhir sederhana, seperti titik akhir yang dijelaskan di atas </font></font><code>blog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tetapi cocok untuk titik akhir yang lebih kompleks. </font><font style="vertical-align: inherit;">Misalnya, API titik akhir untuk bekerja dengan pelajaran memiliki kunci bersarang yang mendalam dari tipe logis </font></font><code>.lesson.steps[index].isInteractive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Berkat semua ini, sekarang tidak mungkin untuk melakukan kesalahan berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika kami mencoba mengakses </font></font><code>isinteractive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klien, atau mencoba mengembalikan kunci seperti itu dari server, kode tidak akan dikompilasi. </font><font style="vertical-align: inherit;">Nama kuncinya harus seperti </font></font><code>isInteractive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dengan huruf besar </font></font><code>I</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li>     <code>isInteractive</code>  —   .</li>
<li>    <code>isInteractive</code>    <code>number</code>,  , ,  .</li>
<li>     API, ,  <code>isInteractive</code> —  ,    , ,   ,           , , ,  .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan bahwa semua ini termasuk pembuatan kode. Ini dilakukan dengan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io-ts</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan beberapa ratus baris kode dari router kita sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mendeklarasikan jenis API membutuhkan pekerjaan tambahan, tetapi pekerjaan itu sederhana. Saat mengubah struktur API, kita perlu tahu bagaimana struktur kode berubah. Kami membuat perubahan pada deklarasi API, dan kemudian kompiler mengarahkan kami ke semua tempat di mana kode perlu diperbaiki.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sulit untuk menghargai pentingnya mekanisme ini sampai Anda menggunakannya sebentar. Kita dapat memindahkan objek besar dari satu tempat di API ke tempat lain, mengganti nama kunci, kita dapat membagi objek besar menjadi beberapa bagian, menggabungkan objek kecil menjadi satu objek, membagi atau menggabungkan seluruh titik akhir. Dan kita bisa melakukan semua ini tanpa khawatir tentang fakta bahwa kita lupa membuat perubahan yang sesuai untuk kode klien atau server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah contoh nyata. Baru-baru ini saya menghabiskan sekitar 20 jam pada empat hari libur mendesain ulang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program Jalankan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API </font><font style="vertical-align: inherit;">. Seluruh struktur API telah berubah. Ketika membandingkan klien baru dan kode server dengan yang lama, puluhan ribu perubahan garis dicatat. Saya mendesain ulang kode routing sisi server (seperti di atas</font></font><code>handleGet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Saya menulis ulang semua deklarasi tipe untuk API, membuat banyak dari mereka perubahan struktural besar. Dan, di samping itu, saya menulis ulang semua bagian klien di mana API yang diubah dipanggil. Selama pekerjaan ini, 246 dari 292 file sumber diubah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam sebagian besar pekerjaan ini, saya hanya mengandalkan sistem tipe. Pada jam terakhir dari kasus 20 jam ini, saya mulai menjalankan tes, yang, sebagian besar, berakhir dengan sukses. Pada akhirnya, kami melakukan tes penuh dan menemukan tiga kesalahan kecil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini semua adalah kesalahan logis: kondisi yang secara tidak sengaja mengarahkan program ke tempat yang salah. Biasanya, sistem tipe tidak membantu dalam menemukan kesalahan seperti itu. Butuh beberapa menit untuk memperbaiki kesalahan ini. API yang didesain ulang ini digunakan beberapa bulan yang lalu. Ketika Anda membaca sesuatu</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situs kami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - API inilah yang mengeluarkan materi yang relevan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini tidak berarti bahwa sistem tipe statis menjamin bahwa kode akan selalu benar. Sistem ini tidak memungkinkan untuk melakukan tanpa tes. Tetapi sangat menyederhanakan refactoring. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan memberi tahu Anda tentang pembuatan kode otomatis. Yaitu, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skema</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk menghasilkan definisi tipe dari struktur database kami. Sistem terhubung ke database Postgres, menganalisis tipe kolom dan menulis definisi tipe TypeScript yang sesuai ke file biasa yang </font></font><code>.d.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan oleh aplikasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File dengan tipe skema basis data selalu diperbarui oleh skrip migrasi kami setiap kali diluncurkan. Karena itu, kita tidak harus secara manual mendukung jenis ini. Model menggunakan definisi tipe database untuk memastikan bahwa kode aplikasi dengan benar mengakses semua yang tersimpan dalam database. Tidak ada tabel yang hilang, tidak ada kolom yang hilang, atau entri </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di kolom yang tidak mendukung </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Kami ingat untuk memproses dengan benar </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam kolom yang mendukung </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dan semua ini diperiksa secara statis pada waktu kompilasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini bersama-sama menciptakan rantai transfer informasi yang diketik secara statis yang dapat diandalkan, mulai dari database hingga properti komponen Bereaksi di frontend:</font></font><br>
<br>
<ul>
<li>      ,     (    API)     ,          .</li>
<li>     API    ,   API,      (     )  .</li>
<li>  React-   ,   API,     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengerjakan materi ini, saya tidak dapat mengingat satu pun kasus ketidakkonsistenan dalam kode yang terkait dengan API yang lulus kompilasi. Kami tidak memiliki kegagalan produksi yang muncul karena kode klien dan server terkait dengan API memiliki gagasan berbeda tentang formulir data. Dan semua ini bukan hasil pengujian otomatis. Kami, untuk API itu sendiri, tidak menulis tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menempatkan kita dalam posisi yang sangat menyenangkan: kita dapat berkonsentrasi pada bagian terpenting dari aplikasi. Saya menghabiskan sedikit waktu melakukan konversi jenis. Jauh lebih sedikit daripada yang saya habiskan mengidentifikasi penyebab kesalahan membingungkan yang menembus lapisan kode yang ditulis dalam Ruby atau JavaScript, dan kemudian menyebabkan pengecualian aneh di suatu tempat yang sangat jauh dari sumber kesalahan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah bagaimana proyek terlihat setelah menerjemahkan backend ke TypeScript. </font><font style="vertical-align: inherit;">Seperti yang Anda lihat, banyak kode telah ditulis sejak transisi. </font><font style="vertical-align: inherit;">Kami punya cukup waktu untuk mengevaluasi konsekuensi dari keputusan tersebut.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/298/9b7/9ba/2989b79ba9dc2a646b7ebeac3ba834bd.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TypeScript digunakan di bagian depan dan belakang proyek.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Di sini kita belum mengajukan pertanyaan yang biasa untuk publikasi seperti itu, yaitu untuk mencapai hasil yang sama bukan melalui pengetikan, tetapi melalui penggunaan tes. </font><font style="vertical-align: inherit;">Hasil seperti itu tidak dapat dicapai hanya dengan menggunakan tes. </font><font style="vertical-align: inherit;">Kami, sangat mungkin, akan berbicara lebih banyak tentang ini. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembaca yang budiman! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah Anda menerjemahkan proyek yang ditulis dalam bahasa lain ke dalam TypeScript?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499652/index.html">Apakah ada kehidupan dalam pengembangan setelah dekrit?</a></li>
<li><a href="../id499654/index.html">Bagaimana menerapkan CRM di situs jarak jauh dan menang?</a></li>
<li><a href="../id499656/index.html">Simulasi pengontrol suhu PID</a></li>
<li><a href="../id499658/index.html">Seorang pekerja laki-laki, bukannya penguji? Apakah layak untuk mempelajari Selenium pada tahun 2020?</a></li>
<li><a href="../id499662/index.html">Root-of-Trust untuk IoT dan Tren Keamanan IoT lainnya</a></li>
<li><a href="../id499666/index.html">PEP 572 (Ekspresi Penugasan dalam python 3.8)</a></li>
<li><a href="../id499668/index.html">Ketergantungan JavaScript Road to Hell</a></li>
<li><a href="../id499670/index.html">Я перехожу на JavaScript</a></li>
<li><a href="../id499674/index.html">Langkah lain ke komputer optik</a></li>
<li><a href="../id499676/index.html">90+ alat yang berguna untuk Kubernet: penyebaran, manajemen, pemantauan, keamanan, dan lainnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>