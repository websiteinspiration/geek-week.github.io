<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆎 💆🏾 👩🏾‍🤝‍👨🏻 KubernetesのセキュリティのABC：認証、承認、監査 🚷 🔃 🧦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="遅かれ早かれ、システムの運用はセキュリティの問題を提起します。認証、権利の分離、監査、その他のタスクの確保です。非常に要求の厳しい環境でも標準に準拠できる多くのソリューションがKubernetes用にすでに作成されています...同じ資料が、K8sの組み込みメカニズムのフレームワーク内に実装された基本...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>KubernetesのセキュリティのABC：認証、承認、監査</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/468679/"><img src="https://habrastorage.org/webt/ao/pp/ke/aoppkeeufk5-tv1rmtmtw9oce7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遅かれ早かれ、システムの運用はセキュリティの問題を提起します。認証、権利の分離、監査、その他のタスクの確保です。</font><font style="vertical-align: inherit;">非常に要求の厳しい環境でも標準に準拠できる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多くのソリューション</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がKubernetes用にすでに作成されてい</font><font style="vertical-align: inherit;">ます...同じ資料が、K8sの組み込みメカニズムのフレームワーク内に実装された基本的なセキュリティの側面に当てられています。</font><font style="vertical-align: inherit;">まず第一に、それはセキュリティの問題を研究するための出発点として、Kubernetesに精通し始めた人にとって有用でしょう。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesには2種類のユーザーがあります。</font></font><br>
<br>
<ul>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスアカウント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Kubernetes APIによって管理されるアカウント。</font></font></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -外部の独立したサービスによって制御される「通常の」ユーザー。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのタイプの主な違いは、サービスアカウントの場合、Kubernetes APIに特別なオブジェクトがあり（それらは-と呼ばれます</font></font><code>ServiceAccounts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、名前空間に関連付けられており、タイプがSecretsのオブジェクトのクラスターに格納されている承認データのセットです。このようなユーザー（サービスアカウント）は、Kubernetesクラスタで実行されているKubernetes APIプロセスへのアクセス権を管理することを主な目的としています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般ユーザーは、Kubernetes APIにエントリを持っていません。外部メカニズムによって管理する必要があります。それらは、クラスターの外部に住む人々またはプロセスを対象としています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIへの各リクエストは、サービスアカウントまたはユーザーにバインドされるか、匿名と見なされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザー認証データには以下が含まれます。</font></font><br>
<br>
<ul>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名-ユーザー名（大文字と小文字が区別されます！）;</font></font></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、「ユーザー名よりも一貫性と一意性が高い」機械可読のユーザー識別文字列です。</font></font></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ユーザーが属するグループのリスト。</font></font></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extra-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証メカニズムで使用できる追加フィールド。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesは、X509証明書、ベアラートークン、認証プロキシ、HTTP基本認証など、多数の認証メカニズムを使用できます。</font><font style="vertical-align: inherit;">これらのメカニズムを使用して、多数の認証スキームを実装できます。パスワードを含む静的ファイルからOpenID OAuth2までです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、複数の認証スキームを同時に使用できます。</font><font style="vertical-align: inherit;">デフォルトでは、クラスターは次のものを使用します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> サービスアカウントトークン-サービスアカウント用。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> X509-ユーザー向け。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ServiceAccountsの管理に関する質問はこの記事の範囲を超えていますが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式ドキュメントページ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からこの問題の詳細を学ぶことをお勧めし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">X509証明書の問題についてさらに詳しく検討します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーの証明書（X.509）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書を操作する従来の方法には、次のものが含まれます。 </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> キー生成：</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p ~/mynewuser/.certs/<font></font>
openssl genrsa -out ~/.certs/mynewuser.key 2048</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 証明書リクエスト生成：</font></font><br>
<br>
<pre><code class="bash hljs">openssl req -new -key ~/.certs/mynewuser.key -out ~/.certs/mynewuser.csr -subj <span class="hljs-string">"/CN=mynewuser/O=company"</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesクラスターCAキーを使用して証明書リクエストを処理し、ユーザー証明書を取得します（証明書を取得するには、デフォルトでにあるKubernetesクラスター認証局キーにアクセスできるアカウントを使用する必要があります</font></font><code>/etc/kubernetes/pki/ca.key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="bash hljs">openssl x509 -req -<span class="hljs-keyword">in</span> ~/.certs/mynewuser.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out ~/.certs/mynewuser.crt -days 500</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 構成ファイルの作成：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> クラスターの説明（特定のクラスターインストールのCA証明書ファイルのアドレスと場所を指定します）：</font></font><br>
<br>
<pre><code class="bash hljs">kubectl config <span class="hljs-built_in">set</span>-cluster kubernetes --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.100.200:6443</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または- </font><font style="vertical-align: inherit;">推奨オプションで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ない</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合-ルート証明書を省略できます（kubectlはapi-serverクラスターの正当性をチェックしません）。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl config <span class="hljs-built_in">set</span>-cluster kubernetes  --insecure-skip-tls-verify=<span class="hljs-literal">true</span> --server=https://192.168.100.200:6443</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ユーザーを構成ファイルに追加する：</font></font><br>
<br>
<pre><code class="bash hljs">kubectl config <span class="hljs-built_in">set</span>-credentials mynewuser --client-certificate=.certs/mynewuser.crt  --client-key=.certs/mynewuser.key</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> コンテキストを追加：</font></font><br>
<br>
<pre><code class="bash hljs">kubectl config <span class="hljs-built_in">set</span>-context mynewuser-context --cluster=kubernetes --namespace=target-namespace --user=mynewuser</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> デフォルトのコンテキスト割り当て：</font></font><br>
<br>
<pre><code class="bash hljs">kubectl config use-context mynewuser-context</code></pre></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の操作の後、</font></font><code>.kube/config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォームの構成が</font><font style="vertical-align: inherit;">ファイルに</font><font style="vertical-align: inherit;">作成さ</font><font style="vertical-align: inherit;">れます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
clusters:<font></font>
- cluster:<font></font>
    certificate-authority: /etc/kubernetes/pki/ca.crt<font></font>
    server: https://192.168.100.200:6443<font></font>
  name: kubernetes<font></font>
contexts:<font></font>
- context:<font></font>
    cluster: kubernetes<font></font>
    namespace: target-namespace<font></font>
    user: mynewuser<font></font>
  name: mynewuser-context<font></font>
current-context: mynewuser-context<font></font>
kind: Config<font></font>
preferences: {}<font></font>
users:<font></font>
- name: mynewuser<font></font>
  user:<font></font>
    client-certificate: /home/mynewuser/.certs/mynewuser.crt<font></font>
    client-key: /home/mynewuser/.certs/mynewuser.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アカウントとサーバー間の設定の転送を容易にするために、次のキーの値を編集すると便利です：</font></font><br>
<br>
<ul>
<li> <code>certificate-authority</code></li>
<li> <code>client-certificate</code></li>
<li> <code>client-key</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、base64を使用してファイルに示されているファイルをエンコードし、キーの名前にサフィックスを追加することで、それらを設定に登録できます</font></font><code>-data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">頂いた</font></font><code>certificate-authority-data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kubeadmによる証明書</font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes 1.15</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
のリリースにより、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kubeadmユーティリティで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートされているアルファ版のおかげで、証明書の操作がはるかに簡単になりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、ユーザーキーを使用した構成ファイルの生成は次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">kubeadm alpha kubeconfig user --client-name=mynewuser --apiserver-advertise-address 192.168.100.200</code></pre><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：必要な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アドバタイズアドレス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、デフォルトでにあるapi-server設定で確認できます</font></font><code>/etc/kubernetes/manifests/kube-apiserver.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果の構成はstdoutに出力されます。</font></font><code>~/.kube/config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーアカウントまたは環境変数で指定されたファイルに</font><font style="vertical-align: inherit;">保存する必要があり</font><font style="vertical-align: inherit;">ます</font></font><code>KUBECONFIG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深く掘る</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明されている問題をよりよく理解したい人のために：</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesの公式ドキュメントにある、証明書の操作に関する</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">別の記事</font></a><font style="vertical-align: inherit;">。</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Bitnami</a>,        .</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>    Kubernetes.</li>
</ul><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
認証されたアカウントには、デフォルトでクラスター内で動作する権限がありません。 Kubernetesには、権限を付与するための承認メカニズムがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン1.6より前は、Kubernetesは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABAC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（属性ベースのアクセス制御）</font><font style="vertical-align: inherit;">と呼ばれる認証タイプを使用していました</font><font style="vertical-align: inherit;">。詳細は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式ドキュメントをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このアプローチは現在レガシーと見なされていますが、他のタイプの承認と同時に使用することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスタのアクセス権を分割する実際の（そしてより柔軟な）方法は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBAC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Role-based access control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">と呼ばれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Kubernetes 1.8</font></a><font style="vertical-align: inherit;">以降、安定していると宣言されてい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 RBACは、明示的に許可されていないものを禁止する権利モデルを実装しています。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBACを有効にするに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、パラメータを指定してKubernetes api-serverを実行する必要があります</font></font><code>--authorization-mode=RBAC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。パラメータはapi-server構成のマニフェストに設定されます。これは、デフォルト</font></font><code>/etc/kubernetes/manifests/kube-apiserver.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、セクションの</font><font style="vertical-align: inherit;">パスに沿って配置されます</font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、デフォルトではRBAC </font></font><code>authorization-mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はすでに</font><font style="vertical-align: inherit;">オンになっているので、おそらくこれについて心配する必要はありません。これは値で確認できます</font><font style="vertical-align: inherit;">（すでに説明したで</font></font><code>kube-apiserver.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。ところで、値の中には、許可（他の種類のかもしれ</font></font><code>node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>webhook</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>always allow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、しかし、彼らは材料を考慮した後のまま。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、私たちはすでに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">記事を</font></a><font style="vertical-align: inherit;">公開し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ています</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBACを使用する際の原則と機能についてはかなり詳細に説明しているので、基本と例の簡単なリストに限定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のAPIエンティティは、RBACを介してKubernetesへのアクセスを制御するために使用されます。</font></font><br>
<br>
<ul>
<li> <code>Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>ClusterRole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-アクセス権を説明するための役割：</font></font></li>
<li> <code>Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 名前空間内の権限を説明できます。</font></font></li>
<li> <code>ClusterRole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-そのようなノードとしてオブジェクトクラスタ固有含むクラスタの一部として、非リソースのURL（すなわち、非Kubernetes資源-例えば、</font></font><code>/version</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>/logs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>/api*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li> <code>RoleBinding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして</font></font><code>ClusterRoleBinding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-結合させるために使用される</font></font><code>Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>ClusterRole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ユーザまたはServiceAccountのユーザ、グループに。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エンティティRoleとRoleBindingは名前空間によって制限されます。</font><font style="vertical-align: inherit;">同じ名前空間内にある必要があります。</font><font style="vertical-align: inherit;">ただし、RoleBindingはClusterRoleを参照できます。これにより、一連の標準的なアクセス許可を作成し、それらを使用してアクセスを制御できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
役割は、以下を含むルールセットを使用して権利を記述します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIグループ- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apiGroups </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドキュメント</font></a><font style="vertical-align: inherit;">と結論を</font><font style="vertical-align: inherit;">参照してください</font></font><code>kubectl api-resources</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資源（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソース</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>pod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>namespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>deployment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、など）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動詞（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動詞</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソース名（</font></font><code>resourceNames</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-このタイプのすべてのリソースではなく、特定のリソースへのアクセスを提供する必要がある場合。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesでの承認の詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式のドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページをご覧ください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">代わりに（またはこれに加えて）、その動作を説明する例を示します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RBACエンティティの例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シンプルで</font></font><code>Role</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ポッドのリストとステータスを取得し、名前空間で監視できます</font></font><code>target-namespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1<font></font>
kind: Role<font></font>
metadata:<font></font>
  namespace: target-namespace<font></font>
  name: pod-reader<font></font>
rules:<font></font>
- apiGroups: [""]<font></font>
  resources: ["pods"]<font></font>
  verbs: ["get", "watch", "list"]</code></pre><br><font style="vertical-align: inherit;"></font><code>ClusterRole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドのリストとステータスを取得し、クラスター全体でそれらを監視できるように</font><font style="vertical-align: inherit;">
 する例</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1<font></font>
kind: ClusterRole<font></font>
metadata:<font></font>
  #  "namespace" ,   ClusterRole   <font></font>
  name: pod-reader<font></font>
rules:<font></font>
- apiGroups: [""]<font></font>
  resources: ["pods"]<font></font>
  verbs: ["get", "watch", "list"]</code></pre><br><font style="vertical-align: inherit;"></font><code>RoleBinding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font><code>mynewuser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が名前空間のポッド</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">「読み取る」</font><font style="vertical-align: inherit;">ことができる</font><font style="vertical-align: inherit;">
 例</font></font><code>my-namespace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1<font></font>
kind: RoleBinding<font></font>
metadata:<font></font>
  name: read-pods<font></font>
  namespace: target-namespace<font></font>
subjects:<font></font>
- kind: User<font></font>
  name: mynewuser #     !<font></font>
  apiGroup: rbac.authorization.k8s.io<font></font>
roleRef:<font></font>
  kind: Role #    “Role”  “ClusterRole”<font></font>
  name: pod-reader #  Role,      namespace,<font></font>
                   #   ClusterRole,  <font></font>
                   #   <font></font>
  apiGroup: rbac.authorization.k8s.io</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント監査</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
概略的に、Kubernetesアーキテクチャは次のように表すことができ</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/617/793/499/6177934998b4bf1c5c8816c75beaef3f.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストの処理を担当するKubernetes </font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">主要コンポーネントは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">api-server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。クラスター上のすべての操作はそれを通過します。これらの内部メカニズムの詳細については、記事「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kubectl runの開始時にKubernetesで何が起こるか</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」を参照してください</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。</font></a><font style="vertical-align: inherit;">」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム監査はKubernetesの興味深い機能で、デフォルトではオフになっています。 Kubernetes APIへのすべての呼び出しを記録できます。簡単に推測できるように、このAPIを通じて、クラスターの状態の監視と変更に関連するすべてのアクションが実行されます。その機能の適切な説明は、（いつものように）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> K8s </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドキュメントにあります</font></a><font style="vertical-align: inherit;">。次に、トピックをより簡単な言語で提示してみます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そう、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監査を有効</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にするには、api-serverのコンテナーに3つの必須パラメーターを渡す必要があります。</font></font><br>
<br>
<ul>
<li> <code>--audit-policy-file=/etc/kubernetes/policies/audit-policy.yaml</code></li>
<li> <code>--audit-log-path=/var/log/kube-audit/audit.log</code></li>
<li> <code>--audit-log-format=json</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの3つの必須パラメーターに加えて、ログローテーションからWebhookの説明まで、監査に関連する多くの追加設定があります。</font><font style="vertical-align: inherit;">ログローテーションパラメータの例：</font></font><br>
<br>
<ul>
<li> <code>--audit-log-maxbackup=10</code></li>
<li> <code>--audit-log-maxsize=100</code></li>
<li> <code>--audit-log-maxage=7</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これらについては詳しく説明しません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">詳細は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kube-apiserverのドキュメントに記載さ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、すべてのパラメータは</font></font><code>/etc/kubernetes/manifests/kube-apiserver.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、セクション</font><font style="vertical-align: inherit;">のapi-server構成（デフォルト</font><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">使用してマニフェストに設定されます</font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">3つの必須パラメーターに戻って分析してみましょう。</font></font><br>
<br>
<ol>
<li> <code>audit-policy-file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-監査ポリシーの説明を含むYAMLファイルへのパス。</font><font style="vertical-align: inherit;">その内容に戻りますが、今のところ、api-serverプロセスによる読み取りのためにファイルにアクセスできる必要があります。</font><font style="vertical-align: inherit;">したがって、それをコンテナ内にマウントする必要があります。そのためには、構成の適切なセクションに次のコードを追加できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">  volumeMounts:<font></font>
    - mountPath: /etc/kubernetes/policies<font></font>
      name: policies<font></font>
      readOnly: true<font></font>
  volumes:<font></font>
  - hostPath:<font></font>
      path: /etc/kubernetes/policies<font></font>
      type: DirectoryOrCreate<font></font>
    name: policies</code></pre></li>
<li> <code>audit-log-path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ログファイルへのパス。</font><font style="vertical-align: inherit;">パスはapi-serverプロセスからもアクセスできる必要があるため、同様にそのマウントについて説明します。</font></font><br>
<br>
<pre><code class="plaintext hljs">  volumeMounts:<font></font>
    - mountPath: /var/log/kube-audit<font></font>
      name: logs<font></font>
      readOnly: false<font></font>
  volumes:<font></font>
  - hostPath:<font></font>
      path: /var/log/kube-audit<font></font>
      type: DirectoryOrCreate<font></font>
    name: logs</code></pre></li>
<li> <code>audit-log-format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-監査ログのフォーマット。</font><font style="vertical-align: inherit;">デフォルトではですが</font></font><code>json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、古いテキスト形式（</font></font><code>legacy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）も使用できます。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監査方針</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、ロギングポリシーの説明が記載された前述のファイルについて説明します。</font><font style="vertical-align: inherit;">監査ポリシーの最初の概念-これ</font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ロギングのレベルです</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それらは次のとおりです。</font></font><br>
<br>
<ul>
<li> <code>None</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ログに記録しないでください。</font></font></li>
<li> <code>Metadata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ログリクエストメタデータ：ユーザー、リクエスト時間、ターゲットリソース（ポッド、ネームスペースなど）、アクションタイプ（動詞）など。</font></font></li>
<li> <code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -メタデータとリクエスト本文を記録します。</font></font></li>
<li> <code>RequestResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -メタデータ、リクエスト本文、レスポンス本文をログに記録します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の2つのレベル（</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>RequestResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）は、リソースにアクセスしない（いわゆる非リソースURLへのアクセス）クエリがログに記録されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、すべてのリクエストには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いくつかの段階があり</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<ul>
<li> <code>RequestReceived</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -リクエストがハンドラーによって受信され、まだハンドラーのチェーンに沿って転送されていない段階。</font></font></li>
<li> <code>ResponseStarted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-送信された応答ヘッダー。ただし、応答本文を送信する前。</font><font style="vertical-align: inherit;">長いリクエスト（たとえば</font></font><code>watch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">に対して生成され</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li> <code>ResponseComplete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -応答本文が送信されました。これ以上の情報は送信されません。</font></font></li>
<li> <code>Panic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -緊急事態が検出されるとイベントが生成されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステージをスキップするには、を使用できます</font></font><code>omitStages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポリシーファイルでは、ロギングのレベルが異なるいくつかのセクションを記述できます。ポリシーの説明で見つかった最初の一致ルールが適用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kubeletデーモンは、api-server設定でマニフェストの変更を監視し、変更が検出された場合は、api-serverでコンテナーを再起動します。ただし、重要な詳細があり</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">ポリシーファイルへの変更は無視されます</font></b><font style="vertical-align: inherit;">。ポリシーファイルに変更を加えた後、api-serverを手動で再起動する必要があります。 api-serverは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的なポッド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として起動されるため</font><font style="vertical-align: inherit;">、コマンド</font></font><code>kubectl delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって再起動されることはありません。</font></font><code>docker stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監査ポリシーが変更されているkube-master </font><font style="vertical-align: inherit;">で手動で行う必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">docker stop $(docker ps | grep k8s_kube-apiserver | awk <span class="hljs-string">'{print $1}'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
監査を有効にする場合、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kube-apiserverの負荷が増加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">することを覚えておくことが重要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">特に、リクエストのコンテキストを保存するためのメモリ消費が増加しています。</font><font style="vertical-align: inherit;">ロギングは、応答ヘッダーを送信した後にのみ開始されます。</font><font style="vertical-align: inherit;">また、負荷は監査ポリシーの構成によって異なります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシーの例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を使用して、ポリシーファイルの構造を分析しましょう。</font><font style="vertical-align: inherit;">レベルですべてをログに記録</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
する単純なファイル</font></font><code>policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を次に示します</font></font><code>Metadata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<pre><code class="plaintext hljs">apiVersion: audit.k8s.io/v1<font></font>
kind: Policy<font></font>
rules:<font></font>
- level: Metadata</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポリシーでは、ユーザー（</font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>ServiceAccounts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）とユーザーグループの</font><font style="vertical-align: inherit;">リストを指定できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、これはシステムユーザーを無視する方法ですが、他のすべてをレベルでログに記録します</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: audit.k8s.io/v1<font></font>
kind: Policy<font></font>
rules:<font></font>
  - level: None<font></font>
    userGroups:<font></font>
      - "system:serviceaccounts"<font></font>
      - "system:nodes"<font></font>
    users:<font></font>
      - "system:anonymous"<font></font>
      - "system:apiserver"<font></font>
      - "system:kube-controller-manager"<font></font>
      - "system:kube-scheduler"<font></font>
  - level: Request</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ターゲットを記述することも可能です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前空間（</font></font><code>namespaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動詞（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">動詞</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">資源（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソース</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、すなわち</font></font><code>pod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>configmaps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等）とリソースグループ（</font></font><code>apiGroups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースとリソースグループ（APIグループ、つまりapiGroups）、およびクラスターにインストールされているそれらのバージョンは、次のコマンドを使用して取得できます。</font></font><br>
<br>
<pre><code class="bash hljs">kubectl api-resources<font></font>
kubectl api-versions</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の監査ポリシーは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alibaba Cloudドキュメントの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベストプラクティスのデモとして提供されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: audit.k8s.io/v1beta1<font></font>
kind: Policy<font></font>
#    RequestReceived<font></font>
omitStages:<font></font>
  - "RequestReceived"<font></font>
rules:<font></font>
  #   ,     :<font></font>
  - level: None<font></font>
    users: ["system:kube-proxy"]<font></font>
    verbs: ["watch"]<font></font>
    resources:<font></font>
      - group: "" #  api group   ,   <font></font>
                  #   Kubernetes,  “core”<font></font>
        resources: ["endpoints", "services"]<font></font>
  - level: None<font></font>
    users: ["system:unsecured"]<font></font>
    namespaces: ["kube-system"]<font></font>
    verbs: ["get"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["configmaps"]<font></font>
  - level: None<font></font>
    users: ["kubelet"]<font></font>
    verbs: ["get"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["nodes"]<font></font>
  - level: None<font></font>
    userGroups: ["system:nodes"]<font></font>
    verbs: ["get"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["nodes"]<font></font>
  - level: None<font></font>
    users:<font></font>
      - system:kube-controller-manager<font></font>
      - system:kube-scheduler<font></font>
      - system:serviceaccount:kube-system:endpoint-controller<font></font>
    verbs: ["get", "update"]<font></font>
    namespaces: ["kube-system"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["endpoints"]<font></font>
  - level: None<font></font>
    users: ["system:apiserver"]<font></font>
    verbs: ["get"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["namespaces"]<font></font>
  #     read-only URLs:<font></font>
  - level: None<font></font>
    nonResourceURLs:<font></font>
      - /healthz*<font></font>
      - /version<font></font>
      - /swagger*<font></font>
  #   ,     “”:<font></font>
  - level: None<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["events"]<font></font>
  #   Secret, ConfigMap  TokenReview     ,<font></font>
  #        <font></font>
  - level: Metadata<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
        resources: ["secrets", "configmaps"]<font></font>
      - group: authentication.k8s.io<font></font>
        resources: ["tokenreviews"]<font></font>
  #   get, list  watch   ;   <font></font>
  - level: Request<font></font>
    verbs: ["get", "list", "watch"]<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
      - group: "admissionregistration.k8s.io"<font></font>
      - group: "apps"<font></font>
      - group: "authentication.k8s.io"<font></font>
      - group: "authorization.k8s.io"<font></font>
      - group: "autoscaling"<font></font>
      - group: "batch"<font></font>
      - group: "certificates.k8s.io"<font></font>
      - group: "extensions"<font></font>
      - group: "networking.k8s.io"<font></font>
      - group: "policy"<font></font>
      - group: "rbac.authorization.k8s.io"<font></font>
      - group: "settings.k8s.io"<font></font>
      - group: "storage.k8s.io"<font></font>
  #        API<font></font>
  - level: RequestResponse<font></font>
    resources:<font></font>
      - group: "" # core<font></font>
      - group: "admissionregistration.k8s.io"<font></font>
      - group: "apps"<font></font>
      - group: "authentication.k8s.io"<font></font>
      - group: "authorization.k8s.io"<font></font>
      - group: "autoscaling"<font></font>
      - group: "batch"<font></font>
      - group: "certificates.k8s.io"<font></font>
      - group: "extensions"<font></font>
      - group: "networking.k8s.io"<font></font>
      - group: "policy"<font></font>
      - group: "rbac.authorization.k8s.io"<font></font>
      - group: "settings.k8s.io"<font></font>
      - group: "storage.k8s.io"<font></font>
  #        <font></font>
  - level: Metadata</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの優れた監査ポリシーの例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCEで使用されるプロファイル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
監査イベントにすばやく応答するために</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Webhook</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">記述する</font></b><font style="vertical-align: inherit;">ことができ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">この問題は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公式ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">公開されてい</font><font style="vertical-align: inherit;">ます。この記事の範囲外に置いておきます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、Kubernetesクラスターの基本的なセキュリティメカニズムの概要を示します。これにより、パーソナライズされたユーザーアカウントを作成し、ユーザーの権限を共有し、アクションを記録できます。</font><font style="vertical-align: inherit;">理論的に、あるいはすでに実践されているこのような疑問に直面している人たちにとって、それが役立つことを願っています。</font><font style="vertical-align: inherit;">また、「PS」にリストされているKubernetesのセキュリティのトピックに関する他の資料のリストを読むことをお勧めします-おそらくそれらの中で、あなたに関連する問題に関する必要な詳細を見つけるでしょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33以上のKubernetesセキュリティツール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュリティ専門家のためのKubernetesネットワークポリシーの概要</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesのRBACを理解する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">9       Kubernetes</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">11  ()     Kubernetes</a>».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468657/index.html">サポート付きダンス：サポートのタイプと形式。戦闘で機能する支援システム</a></li>
<li><a href="../ja468663/index.html">自動音声認識タスクでのEnd2 Endアプローチ</a></li>
<li><a href="../ja468665/index.html">かんがい器を買う時が来ていませんか？</a></li>
<li><a href="../ja468673/index.html">ワークショップ「個人データのセキュリティの確保」-10月3日、サンクトペテルブルク</a></li>
<li><a href="../ja468677/index.html">スマートフォンXiaomi Mi Mix Alphaの発表</a></li>
<li><a href="../ja468683/index.html">Dockerサービスの標準化の理論と実践</a></li>
<li><a href="../ja468685/index.html">音響心理学、ロスレス、およびオーディオ標準について他に何を知っていますか</a></li>
<li><a href="../ja468687/index.html">株式市場を規制するための中央銀行の新しい取り組みを分析します：投資家の3つのグループ、初心者向けの制限</a></li>
<li><a href="../ja468689/index.html">シンガポールでのITビジネスの登録：どうすればよいですか？</a></li>
<li><a href="../ja468691/index.html">システムまたはLOLDrivers上の危険なサードパーティドライバー</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>