<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏻 🐣 👨🏻‍⚕️ Pythonインポートの自動化 🎽 😳 ✋🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前 後   

import math import os.path  import requests  # 100500 other imports  print(math.pi) print(os.path.join('my', 'path')) print(requests.get) 

im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Pythonインポートの自動化</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459930/"><div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後</font></font></th>
</tr>
<tr>
<td><pre><code class="python hljs"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> os.path<font></font>
<font></font>
<span class="hljs-keyword">import</span> requests<font></font>
<font></font>
<span class="hljs-comment"># 100500 other imports</span><font></font>
<font></font>
print(math.pi)<font></font>
print(os.path.join(<span class="hljs-string">'my'</span>, <span class="hljs-string">'path'</span>))<font></font>
print(requests.get)</code></pre></td>
<td><pre><code class="python hljs"><span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
print(math.pi)<font></font>
print(os_path.join(<span class="hljs-string">'my'</span>, <span class="hljs-string">'path'</span>))<font></font>
print(requests.get)<font></font>
</code></pre></td>
</tr>
</tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偶然にも、2012年以来、私は唯一のプログラマーとして、オープンソースのブラウザーを開発しています。 Python自体。ブラウザは最も簡単なものではありません。プロジェクトのメイン部分には、1000以上のモジュールと120,000以上のPythonコードがあります。衛星プロジェクトでは、全体で1.5倍になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ある時点で、私は各ファイルの先頭でインポートのフロアをいじるのにうんざりしていたので、この問題に対処することにしました。そのため、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_imports</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリが誕生しました</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pypi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイデアは非常に簡単です。複雑なプロジェクトはすべて、最終的にすべてに名前を付けることについて独自の合意を形成します。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この合意をより正式なルールに変えると、エンティティは、関連付けられた変数の名前で自動的にインポートできます。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、次のように記述</font></font><code>import math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><font style="vertical-align: inherit;">必要はありません</font><font style="vertical-align: inherit;">。</font></font><code>math.pi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合</font></font><code>math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、標準ライブラリモジュールである</font><font style="vertical-align: inherit;">ことはすでに理解でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スマートインポートはPython&gt; = 3.5をサポートしています。ライブラリはテストで完全にカバーされており、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カバレッジ&gt; 95％</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">自分で一年使っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
詳しくは猫にご招待します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的にどのように機能しますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ヘッダー画像のコードは次のように機能します。 </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出し中に、</font></font><code>smart_imports.all()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリは</font><font style="vertical-align: inherit;">呼び出し</font></font><abbr title="抽象構文木"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元の</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font><font style="vertical-align: inherit;">の</font><abbr title="Abstract syntax tree"><font style="vertical-align: inherit;">ASTを</font></abbr><font style="vertical-align: inherit;">構築し</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化されていない変数を見つけます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インポートに必要なモジュール（またはモジュール属性）を名前で検索しようとする一連のルールを通じて、各変数の名前を実行します。</font><font style="vertical-align: inherit;">ルールが必要なエンティティを見つけた場合、次のルールはチェックされません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかったモジュールがロードされ、初期化されて、グローバル名前空間に配置されます（またはこれらのモジュールの必要な属性がそこに配置されます）。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化されていない変数は、新しい構文を含め、コード全体で検索されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自動インポートは、明示的に呼び出されるプロジェクトコンポーネントに対してのみ有効</font></font><code>smart_imoprts.all()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">さらに、スマートインポートの使用は、従来のインポートの使用を禁止しません。</font><font style="vertical-align: inherit;">これにより、ライブラリを徐々に実装し、複雑な循環依存関係を解決できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
細心の注意を払う読者は、ASTモジュールが2回作成されることに気付くでしょう：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPythonは、モジュールのインポート時に初めてビルドします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2回目のsmart_importsは、呼び出し中にそれをビルドします</font></font><code>smart_imports.all()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASTは実際には1回しかビルドできません（そのためには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP-0302に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装されているインポートフックを使用してモジュールのインポートプロセスに統合する必要があります</font><font style="vertical-align: inherit;">が、このソリューションではインポートが遅くなります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どうしてそう思うの？</font></font></b><div class="spoiler_text">    (   ),    ,     CPython  AST    (C-)  .      Python  ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ast</a>.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、各モジュールのASTは、起動ごとに1回だけ作成および分析されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトのインポートルール</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリは追加の設定なしで使用できます。</font><font style="vertical-align: inherit;">デフォルトでは、次のルールに従ってモジュールをインポートします。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名前の正確な一致により、現在のモジュールの隣にあるモジュールを（同じディレクトリで）検索します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準ライブラリのモジュールをチェックします：</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トップレベルパッケージの名前の完全一致。</font></font></li>
<li>            .  <code>os.path</code>      <code>os_path</code>.</li>
</ul></li>
<li>       .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">requests</a>.</li>
</ol><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スマートインポートはプログラムのパフォーマンスには影響しませんが、起動にかかる時間を増やします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ASTの再構築により、最初の実行の時間が約1.5〜2倍増加します。小規模なプロジェクトの場合、これは重要ではありません。大規模なプロジェクトでは、起動時間は、特定のモジュールのインポート時間ではなく、モジュール間の依存構造に影響されます。</font><font style="vertical-align: inherit;">スマートインポートが人気になった</font></font><br>
<br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とき</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私は作業をASTからCに書き直します。これにより、起動コストが大幅に削減されるはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロードを高速化するために、ASTモジュールの処理結果をファイルシステムにキャッシュできます。キャッシュは設定で有効になっています。もちろん、ソースを変更するとキャッシュは無効になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
起動時間は、モジュール検索ルールのリストとそのシーケンスの両方に影響されます。</font><font style="vertical-align: inherit;">一部のルールはモジュールを検索するために標準のPython機能を使用します。</font><font style="vertical-align: inherit;">「カスタム名」ルールを使用して名前とモジュールの対応を明示的に示すことにより、これらの費用を除外できます（以下を参照）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトの構成はすでに説明されています。</font><font style="vertical-align: inherit;">小さなプロジェクトで標準ライブラリを使用するのに十分なはずです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルト設定</font></font></b><div class="spoiler_text"><pre><code class="json hljs">{
    <span class="hljs-attr">"cache_dir"</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">"rules"</span>: [{<span class="hljs-attr">"type"</span>: <span class="hljs-string">"rule_local_modules"</span>},<font></font>
              {<span class="hljs-attr">"type"</span>: <span class="hljs-string">"rule_stdlib"</span>},<font></font>
              {<span class="hljs-attr">"type"</span>: <span class="hljs-string">"rule_predefined_names"</span>},<font></font>
              {<span class="hljs-attr">"type"</span>: <span class="hljs-string">"rule_global_modules"</span>}]<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要に応じて、より複雑な構成をファイルシステムに追加できます。</font><font style="vertical-align: inherit;">（ブラウザーからの）</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複雑な構成の例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出し中、</font></font><code>smart_import.all()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリはファイルシステム上の呼び出しモジュールの位置を決定</font></font><code>smart_imports.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、現在のディレクトリからルートへの方向で</font><font style="vertical-align: inherit;">ファイルの検索を開始します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのようなファイルが見つかった場合、現在のモジュールの構成と見なされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの異なる設定を使用できます（異なるディレクトリに配置します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、多くの構成オプションはありません。</font></font><br>
<br>
<pre><code class="json hljs">{
    <span class="hljs-comment">//     AST.</span>
    <span class="hljs-comment">//     null —   .</span>
    <span class="hljs-attr">"cache_dir"</span>: <span class="hljs-literal">null</span>|<span class="hljs-string">"string"</span>,<font></font>
<font></font>
    <span class="hljs-comment">//       .</span>
    <span class="hljs-attr">"rules"</span>: []<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インポートルール</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成でルールを指定する順序によって、アプリケーションの順序が決まります。</font><font style="vertical-align: inherit;">機能した最初のルールは、インポートのそれ以上の検索を停止します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
構成の例では、ルールが下</font></font><code>rule_predefined_names</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">表示されることがよくあります。</font><font style="vertical-align: inherit;">組み込み関数（たとえば</font></font><code>print</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が</font><font style="vertical-align: inherit;">正しく認識される必要があり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール1：定義済みの名前</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このルールでは</font></font><code>__file__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、などの</font><font style="vertical-align: inherit;">事前定義された名前</font><font style="vertical-align: inherit;">や組み込み関数</font><font style="vertical-align: inherit;">を無視できます</font></font><code>print</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"}]</span>
<span class="hljs-comment"># }</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
<span class="hljs-comment">#        __file__</span>
<span class="hljs-comment">#       </span>
print(__file__)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール2：ローカルモジュール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のモジュール（同じディレクトリ内）の横に、指定された名前のモジュールがあるかどうかを確認します。</font><font style="vertical-align: inherit;">ある場合はインポートします。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_local_modules"}]</span>
<span class="hljs-comment"># }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    :</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># my_package</span>
<span class="hljs-comment"># |-- __init__.py</span>
<span class="hljs-comment"># |-- a.py</span>
<span class="hljs-comment"># |-- b.py</span><font></font>
<font></font>
<span class="hljs-comment"># b.py</span>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
<span class="hljs-comment">#    "a.py"</span>
print(a)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール3：グローバルモジュール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前でモジュールを直接インポートしようとします。</font><font style="vertical-align: inherit;">たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_global_modules"}]</span>
<span class="hljs-comment"># }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#   </span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># pip install requests</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
<span class="hljs-comment">#    requests</span>
print(requests.get(<span class="hljs-string">'http://example.com'</span>))</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール4：カスタム名</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定のモジュールの名前またはその属性に対応します。</font><font style="vertical-align: inherit;">コンプライアンスはルール設定で示されます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_custom",</span>
<span class="hljs-comment">#               "variables": {"my_import_module": {"module": "os.path"},</span>
<span class="hljs-comment">#                             "my_import_attribute": {"module": "random", "attribute": "seed"}}}]</span>
<span class="hljs-comment"># }</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
<span class="hljs-comment">#      </span>
<span class="hljs-comment">#       </span><font></font>
print(my_import_module)<font></font>
print(my_import_attribute)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール5：標準モジュール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前が標準ライブラリのモジュールかどうかを確認します。</font><font style="vertical-align: inherit;">たとえば、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">math</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.pathは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変換され</font></font><code>os_path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュされたリストにモジュールが存在するかどうかをチェックするため、グローバルモジュールのインポートのルールよりも高速に動作します。</font><font style="vertical-align: inherit;">Pythonの各バージョンのリストは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">github.com</font></a><font style="vertical-align: inherit;"> / </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">jackmaney</font></a><font style="vertical-align: inherit;"> / </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">python-stdlib-listにあり</font></a><font style="vertical-align: inherit;">ます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_stdlib"}]</span>
<span class="hljs-comment"># }</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
print(math.pi)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール6：プレフィックスによるインポート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレフィックスに関連付けられたパッケージから、名前でモジュールをインポートします。</font><font style="vertical-align: inherit;">コード全体で複数のパッケージを使用している場合に便利です。</font><font style="vertical-align: inherit;">たとえば、パッケージモジュールに</font></font><code>utils</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はプレフィックスを付けてアクセスできます</font></font><code>utils_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_prefix",</span>
<span class="hljs-comment">#               "prefixes": [{"prefix": "utils_", "module": "my_package.utils"}]}]</span>
<span class="hljs-comment"># }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    :</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># my_package</span>
<span class="hljs-comment"># |-- __init__.py</span>
<span class="hljs-comment"># |-- utils</span>
<span class="hljs-comment"># |-- |-- __init__</span>
<span class="hljs-comment"># |-- |-- a.py</span>
<span class="hljs-comment"># |-- |-- b.py</span>
<span class="hljs-comment"># |-- subpackage</span>
<span class="hljs-comment"># |-- |-- __init__</span>
<span class="hljs-comment"># |-- |-- c.py</span><font></font>
<font></font>
<span class="hljs-comment"># c.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
print(utils_a)<font></font>
print(utils_b)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール7：親パッケージのモジュール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの別の部分（</font></font><code>tests</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはなど</font></font><code>migrations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）に</font><font style="vertical-align: inherit;">同じ名前のサブパッケージがある場合</font><font style="vertical-align: inherit;">、それらが親パッケージの名前でインポートするモジュールを検索できるようにすることができます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_local_modules_from_parent",</span>
<span class="hljs-comment">#               "suffixes": [".tests"]}]</span>
<span class="hljs-comment"># }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    :</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># my_package</span>
<span class="hljs-comment"># |-- __init__.py</span>
<span class="hljs-comment"># |-- a.py</span>
<span class="hljs-comment"># |-- tests</span>
<span class="hljs-comment"># |-- |-- __init__</span>
<span class="hljs-comment"># |-- |-- b.py</span><font></font>
<font></font>
<span class="hljs-comment"># b.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
print(a)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール8：別のパッケージへのバインド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定のパッケージのモジュールの場合、他のパッケージ（構成で指定）で名前を指定してインポートを検索できます。</font><font style="vertical-align: inherit;">私の場合、このルールは、前のルール（親パッケージのモジュール）の作業をプロジェクト全体に拡張したくない場合に役立ちます。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># :</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#    "rules": [{"type": "rule_predefined_names"},</span>
<span class="hljs-comment">#              {"type": "rule_local_modules_from_namespace",</span>
<span class="hljs-comment">#               "map": {"my_package.subpackage_1": ["my_package.subpackage_2"]}}]</span>
<span class="hljs-comment"># }</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#    :</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># my_package</span>
<span class="hljs-comment"># |-- __init__.py</span>
<span class="hljs-comment"># |-- subpackage_1</span>
<span class="hljs-comment"># |-- |-- __init__</span>
<span class="hljs-comment"># |-- |-- a.py</span>
<span class="hljs-comment"># |-- subpackage_2</span>
<span class="hljs-comment"># |-- |-- __init__</span>
<span class="hljs-comment"># |-- |-- b.py</span><font></font>
<font></font>
<span class="hljs-comment"># a.py</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> smart_imports<font></font>
<font></font>
smart_imports.all()<font></font>
<font></font>
print(b)</code></pre></div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自のルールを追加する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のルールを追加するのはとても簡単です：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラス</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_imports.rules.BaseRule</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">継承</font></a><font style="vertical-align: inherit;">し</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なロジックを実現します。</font></font></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">smart_imports.rules.register</font></a><font style="vertical-align: inherit;">メソッドを使用してルールを登録する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルールを構成に追加します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">???</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利益</font></font></li>
</ol><br><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">現在のルールの実装</font></a><font style="vertical-align: inherit;"> 
例が見つかり</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></a> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利益</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各ソースの先頭にあるインポートの複数行リストが表示されなくなりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行数が減少しました。</font><font style="vertical-align: inherit;">ブラウザがスマートインポートに切り替わる前は、6688行がインポートを担当していました。</font><font style="vertical-align: inherit;">移行後、2084が残りました（ファイルごとにsmart_importsの2行+ 130のインポート。関数や同様の場所から明示的に呼び出されます）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素晴らしいボーナスは、プロジェクトでの名前の標準化でした。</font><font style="vertical-align: inherit;">コードが読みやすくなり、書きやすくなりました。</font><font style="vertical-align: inherit;">インポートされたエンティティの名前を考える必要はありません-従うのが簡単ないくつかの明確なルールがあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発計画</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数名でコードプロパティを定義するアイデアが好きなので、スマートインポート内と他のプロジェクトの両方で開発するようにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スマートインポートに関しては、次のことを計画しています。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pythonの新しいバージョンのサポートを追加します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードの型注釈に関する現在のコミュニティの慣行に依存する可能性を探ります。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遅延インポートの可能性を探る。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースによる構成の自動生成およびsmart_importsを使用するためのソースのリファクタリングのためのユーティリティを実装します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cコードの一部を書き換えて、ASTでの作業を高速化します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明示的なインポートなしでコード分析に問題がある場合に、リンターやIDEとの統合を開発する。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、ライブラリとインポートルールのデフォルトの動作についてのあなたの意見にも興味があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテキストシートを圧倒してくれてありがとう:-D</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja459918/index.html">pwnable.kr 03による問題解決-bof。スタックでのバッファオーバーフロー</a></li>
<li><a href="../ja459920/index.html">「非通信定理」を回避する方法は？時空を超えた情報伝達</a></li>
<li><a href="../ja459922/index.html">ベアリングの振動診断中に振動センサーの信号から高周波ノイズを除去</a></li>
<li><a href="../ja459924/index.html">Reactアプリケーションのテストの全サイクル。Auto.ruを報告する</a></li>
<li><a href="../ja459928/index.html">学生のモバイルアプリ開発への道のり</a></li>
<li><a href="../ja459934/index.html">モバイル＃306開発者向けの興味深い資料のダイジェスト（7月8〜14日）</a></li>
<li><a href="../ja459936/index.html">Visual Studioを操作するための9つのトリック</a></li>
<li><a href="../ja459948/index.html">Horizo​​n Zero Dawnのように物理的に正しい体積雲を実装する</a></li>
<li><a href="../ja459952/index.html">バックアップとストレージに関する少しの経験</a></li>
<li><a href="../ja459954/index.html">最大のIT企業の1つがCNCFに参加した理由-クラウドインフラストラクチャを開発するファンド</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>