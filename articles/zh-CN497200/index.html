<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤲🏼 ⛄️ 😀 我们组装最简单的ZigBee网络，在Mbed下编程，通过MQTT进行通信 ⚠️ 🔫 🏓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文是一个很棒的入门级培训班，内容涉及如何将XBee模块与板载Mbed OS的微控制器结合使用。 ZigBee是智能家居系统中长期牢固的标准（例如，它与Samsung SmartThings集线器中的Z-Wave一起使用，请参阅我们的文章），其特点是功耗低，易于使用，并且最有趣的是，它具有创建功能自...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>我们组装最简单的ZigBee网络，在Mbed下编程，通过MQTT进行通信</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/497200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文是一个很棒的入门级培训班，内容涉及如何将XBee模块与板载Mbed OS的微控制器结合使用。 ZigBee是智能家居系统中长期牢固的标准（例如，它与Samsung SmartThings集线器中的Z-Wave一起使用，请参阅我们的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），其特点是功耗低，易于使用，并且最有趣的是，它具有创建功能自配置网状网络。您将在研讨会上看到确实如此-我们将通过便捷的可视化工具查看这种网络的结构。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假定您已经知道ZigBee是什么以及它的用途。</font><font style="vertical-align: inherit;">现在，您想连接第一个XBee模块并解决它的问题，而无需对模块本身进行编程，而只是将其用作通信接口。</font><font style="vertical-align: inherit;">最后，我们将通过一个临时的MQTT网关将所有数据发送到任何地方，甚至到本地服务器，甚至到Internet。</font><font style="vertical-align: inherit;">我们决定将Mbed示例中的所有内容显示为对于初学者RTOS而言最简单，最易访问的示例。</font><font style="vertical-align: inherit;">您将确信一切都“开箱即用”，并且即使在此之前您仅与Arduino打交道，您也可以立即开始制作项目。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该手册将包括以下部分：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBee模块的连接和配置</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将模块连接到网络</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们配置模块时不将其从屏蔽罩中移除</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资料检索</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传送资料</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制作一个简单的MQTT网关</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是首先，要列出一个组件列表：为了完成上述所有操作，需要具备哪些组件。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需组件</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个Mbed兼容板。</font><font style="vertical-align: inherit;">我们建议STM32 Nucleo培训板相对便宜，并且出于教育目的而受欢迎。</font><font style="vertical-align: inherit;">那里的编程过程尽可能地简化：在免费的在线IDE中收集程序，下载组装的固件，然后将其“拖放”到板上，这将在系统中显示为闪存驱动器。</font><font style="vertical-align: inherit;">采取哪种具体模型并不重要，但采取的不是最旧的模型，请注意内存量。</font><font style="vertical-align: inherit;">例如，F401RE-我们仅出于确定性而给出，这样您就不会对它们的种类以及STM处理器的最初令人困惑的字母代码感到困惑。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"> <img src="https://habrastorage.org/webt/ec/y3/nx/ecy3nxhuys7vlrzai3mq4yfzhy8.png" width="350"><br>
</li>
<li> XBee-.      Digi.  «» ,  ,  , MBee,  ,    ,     ,      . /        :      ,      .   /  Pro:      ,      ,   Pro   .<br>
<img src="https://habrastorage.org/webt/r2/ed/ew/r2edew1y1gkdpcw9soz-vunnu9q.png"><img src="https://habrastorage.org/webt/m6/-n/aq/m6-naqf0x0qqrjpj-soxa6aulj0.png"><img src="https://habrastorage.org/webt/t2/x5/ng/t2x5ng0wfuoehd4oujmvhf1spha.png" width="200"><br>
</li>
<li>  XBee Shield V2 ( SeeedStudio).      -     ,        RX  TX XBee-.<br>
<img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><img src="https://habrastorage.org/webt/jk/sv/75/jksv75ger3mv3zfwzfji4tliub0.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个带XBee连接器的USB-UART转换器。</font><font style="vertical-align: inherit;">初始配置需要它。</font><font style="vertical-align: inherit;">XBee模块本身没有配备USB接口（与它们无关）。</font><font style="vertical-align: inherit;">仅在模块和计算机之间进行通信时才需要USB，并且在设备中，USB可以在更简单的UART上工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XBee模块的插槽间距为2.0毫米-在公制系统中，这是电子产品的非标准标准（按美国标准，我们通常习惯于看到步骤2.54）。</font><font style="vertical-align: inherit;">因此，不幸的是，这样的模块没有插入到面包板中，并且它们总是需要适配器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任何适配器都适合这里，我们从Waveshare那里选了一个：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/04/md/y5/04mdy5mhmm6cfwuj-a21a5eqagy.png" width="300"></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBee模块的连接和配置</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以使用模块执行的最简单的操作是通过USB直接将其连接到计算机。</font><font style="vertical-align: inherit;">我们将立即访问其配置参数。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装XCTU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要使用XBee，有一个官方的XCTU程序。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并安装。</font><font style="vertical-align: inherit;">该文档说，在Ubuntu中，您需要将用户添加到组中</font></font><code>dialout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以使用非超级用户的端口-如果尚未这样做，请执行以下操作：</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -a -G dialout &lt;username&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从链接下载zip存档，其中将包含一个文件</font></font><code>.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">需要使其成为可执行文件（通过</font></font><code>chmod +x _</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制台或：鼠标右键-属性-权限）并运行</font></font><code>./40002881_V.run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要的是不要从根目录开始安装（不带</font></font><code>sudo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），否则以后会出现问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
设置看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/44/kg/iz/44kgizj3bjlvchzakcksvrh1i_u.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XCTU程序</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装后，您可以通过</font></font><code>app</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在安装程序的目录中</font><font style="vertical-align: inherit;">运行文件来启动</font><font style="vertical-align: inherit;">程序（默认为- </font></font><code>~/Digi/XCTU-NG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外观如下：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/wz/y0/qrwzy0nbyhomwp8g-k26jrluio4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此程序中，您可以将现有模块通过适配器添加到USB端口。单击带有放大镜的发现按钮。弹出一个窗口，要求您选择端口-如您所见，程序正确检测到系统中存在端口</font></font><code>/dev/ttyUSB0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是我们的USB-UART适配器。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/qr/h1/rsqrh1y2if1z6nr_zl844kdba4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
窗口建议勾选搜索。</font><font style="vertical-align: inherit;">当然，有一种诱惑是一次检查所有以确保找到您的模块。</font><font style="vertical-align: inherit;">但是搜索将持续很长时间。</font><font style="vertical-align: inherit;">实际上，将这些框默认保留为选中状态，并为数据传输速度选择最常用的选项是很有道理的，如下图所示。</font><font style="vertical-align: inherit;">通常，新模块默认为9600，并且出于培训目的，这已经绰绰有余，这里的速度对我们而言并不重要。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l2/dj/ve/l2djvekjunxaxpxesaxo786q3le.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，如果一切成功，则会要求您选择找到的模块：发现</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4z/dq/le/4zdqledgifvp92zr4lvm6bat2km.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一个小错误：有时模块不是以非标准速度运行，在搜索过程中使用重置按钮手动重置模块并将其波特率重置为标准（9600）很有帮助。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改模块参数</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，我们从事模块配置。一堆参数将丢失，大多数参数最初是难以理解的。幸运的是，只需更改其中的一部分即可快速入门。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络ID-PAN ID。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个通用的网络密钥，所有设备都必须相同，以便它们独立连接到网络。输入任意数字，在我们的例子中为</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t7/dg/lk/t7dglkxhvbkban2romlxiu97qpi.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42。CE-启用协调器。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果为1，则此模块充当协调器。如果为0，则该模块充当路由器（Router）-实际上，它只是确保数据包通过自身通过网络。大多数主机通常是路由器。我们的网络中需要一个协调器和两个路由器，因此在这里放置一个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还有一个“终端设备”（终端设备）的角色-一个不执行数据包传输工作，仅与其他路由器通信并执行其有用功能的模块。通常，他只是处于睡眠模式，并按设定的时间间隔醒来，并确定是否有任何消息。这样的模块可以由电池供电，而路由器和协调器应始终处于“在线”状态，因此，需要恒定的功率来维持整个网络的健康。我们现在不考虑这样的示例，因为每个人分配路由器的角色并观察网络将如何自动更改其配置更加有趣。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/zp/e3/0mzpe3yptscx6la-wummlbiixks.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP-API启用。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作模式。 XBee模块可以两种模式运行：AT或API。对于初学者而言，AT模式更容易，它是串行端口的透明替代，并通过AT命令与模块一起使用。但是，API模式的功能要丰富得多，它允许您远程配置模块，包含发件人地址，返回程序包的交付状态等等。另外，用于与XBee交互的库假定该设备在API模式下使用。因此，立即将其替换为API模式，这是通过在相应字段中设置单位来完成的。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ra/wv/ng/rawvngogy6biagddxsxxx08fhao.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块的名称是“节点标识符”。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为模块提供易于理解的名称的便捷选择。我们给它起一个名字-协调员。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xi/h2/fy/xih2fygnbxffyqcyhuwbvn8zhqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，您可以使用铅笔按下按钮将设置刷新到模块中：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/8g/xm/pi8gxmplnffs0qmxtckhrfmxrqe.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.将模块连接到网络</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，如果配置三个模块，我们将看到什么样的网络。</font><font style="vertical-align: inherit;">XCTU程序具有相当方便的网络可视化程序，我们将清楚地看到拓扑。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将使用以下参数依次配置所有三个模块：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAN ID-总数，例如42</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP（启用API）-设置为1（在API模式下工作）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NI（节点标识符）-为模块提供易于理解的名称（协调器，指示灯和开关，例如我们正在做的智能家居系统模型）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CE（启用协调器）-将模块之一设置为1，它将成为协调器。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后为所有模块通电。像这样放置它们：协调器将位于USB-UART转换器中，其他两个（路由器）将位于Nucleo顶部的XBee Shield板上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您仔细地做所有事情，那么美好的事情就会发生。模块将自动连接到网络。您可以通过协调器与路由器进行远程通信。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看起来像这样。单击“发现同一网络中的无线电节点”按钮。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/nf/mx/emnfmxivn4xxt3wtx0pe0f54m8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您将看到自动检测并添加了两个模块：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j3/ev/gf/j3evgfx0nj0xowanzz3ovdctyks.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以即时更改它们的参数！&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仍然很棒：现在，如果您切换到右上角的网络工作模式，则可以看到网络地图。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/2v/ma/sf2vmarm8agrkfjtepgib28sxuq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
用鼠标散布网络节点后，您将看到一个三角形。</font><font style="vertical-align: inherit;">请注意，到达最右边模块的流量有两种方式。</font><font style="vertical-align: inherit;">而且，如果您在太空中移动模块，您会发现情况已经改变，现在，也许另一个模块将变得“极端”。</font><font style="vertical-align: inherit;">这是自配置网络的本质。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.设置XBee模块而不将其从屏蔽罩中卸下</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，不是通过计算机使用XBee模块，而是通过使用微控制器上的程序对其进行控制，将会更加有趣。</font><font style="vertical-align: inherit;">也就是说，将其连接到STM32Nucleo板。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们讨论XBee模块如何与微控制器通信。</font><font style="vertical-align: inherit;">让我们从一个小任务开始：如何配置模块而不将其从扩展挡板中移除？</font><font style="vertical-align: inherit;">您必须承认，来回移动模块很不方便，同时您想尝试参数，这很奇怪为什么需要单独的USB-UART模块，因为理论上STM32Nucleo板上有一个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解决方案很简单：我们需要将Nucleo板变成XBee模块和板上的USB转换器之间的桥梁。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想法的一般描述</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们使用的STM32微控制器板上有多个UART接口。每个这样的接口代表一个通信通道。其中之一连接到USB-UART转换器，因此我们可以通过终端中的USB与计算机进行通信。尚未使用其他两个。我们将XBee模块连接到其中一个，它也具有这样的通信通道。您可以选择任何UART，我们已为确定性UART1选择了它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以通过按板选择按钮，然后在“引脚排列”选项卡上的右上角以MBed形式查看引脚排列。</font><font style="vertical-align: inherit;">出于习惯，很难感知这张彩色图片。</font><font style="vertical-align: inherit;">这里有很多事情，因为开发板有很多接口，并且有两个引脚号：相对于微控制器（PA_5，PA_6-引脚编号）和相对于板（D13，D12-Nucleo板上的铭文，端子附近的编号相同）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/97/dp/mq/97dpmqw9dmy9lcqtb1hf6i_gyz0.png"><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实证明，在微控制器上，UART1接口将与XBee模块和UART2进行通信（与以前一样）与计算机进行通信。</font><font style="vertical-align: inherit;">内部代码会将UART1重定向到UART2，反之亦然。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/vk/5w/rpvk5wsdsb8qnz5i_m7dk8q-wwc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过连接，它看起来像这样：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/g7/cs/tpg7cslaiomjx-ogqje-su3q-7s.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过微控制器搭建“桥梁”</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的案例中，我们可以通过屏蔽板上的跳线设置要连接ZigBee模块的编号。 TX通信模块将连接到开发板的引脚2（微控制器上的PA_9），而RX连接到引脚8（又称为PA_10）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它看起来像这样：</font><font style="vertical-align: inherit;">我们采用</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/ce/3s/ohce3sq3y1_0_jewruer0dmn36a.png"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的代码</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为串行桥。这是两个通信渠道之间的“桥梁”。我们将代码加载到微控制器中，微控制器通过UART2将来自计算机输入的所有内容转发到UART1，反之亦然。就像我们在两个信息源之间插入管道一样（Linuxsoid会理解）。我们将XBee模块连接到UART1。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该代码非常简单，您唯一需要更改的就是设备所连接的引脚号。即，如上所述，将它们设为PA_9和PA_10。</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"mbed.h"</span></span>
<span class="hljs-comment">// Make a serial bridge from a serial I/O device on mbed to the PC</span>
<span class="hljs-function">Serial <span class="hljs-title">pc</span><span class="hljs-params">(USBTX, USBRX)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-function">Serial <span class="hljs-title">device</span><span class="hljs-params">(PA_9, PA_10)</span></span>; <span class="hljs-comment">// tx, rx</span>
<span class="hljs-comment">// Defaults to 9600 baud on each device - use .baud(baudrate) to change</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
&nbsp;pc.<span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello!"</span>);
&nbsp;<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(pc.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device.putc(pc.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(device.readable()) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pc.putc(device.getc());<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要的是，如果您混淆结论的顺序-例如，您犯了一个错误并写了PA_10，PA_9而不是PA_9，PA_10-错误的顺序，编译器将不会向您报告错误，并且程序将在重启后在控制台中显示错误：</font></font><br>
<pre><code class="plaintext hljs">pinmap not found for peripheral</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并且不会继续前进，也就是说，原则上什么都不会起作用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载此代码并正确设置了屏蔽板上的跳线之后，您可以安全地从计算机连接到XBee模块，就像以前使用USB-UART适配器所做的一样，而无需将其从屏蔽板上卸下。</font><font style="vertical-align: inherit;">XCTU程序会定期检测到它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使您不需要此功能，也请检查程序是否正常运行，因为在以下示例中，我们将通过微控制器与XBee模块进行通信，并且应该已经建立了通过UART1的连接（即，正确设置了跳线，并在程序中指示了引脚号）。 。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.数据采集</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看两个简单的示例：如何使用XBee模块作为外部通信接口在微控制器级别接收和发送数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有</font><font style="vertical-align: inherit;">制造商</font><font style="vertical-align: inherit;">的官方</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图书馆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Digi公司。</font><font style="vertical-align: inherit;">它位于Mbed存储库中，其中有关于代码用法和逻辑的有用注释。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们将学习如何获取数据-有一个更简单的示例。</font><font style="vertical-align: inherit;">我们将有一个XBee模块连接到USB-UART转换器，向Nucleo板发送问候语，它将问候语打印到控制台。</font><font style="vertical-align: inherit;">在该库中</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/ic/u5/zgicu5mh8dvsy8y8aegzetdoew8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
打开</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与往常一样，将其作为程序导入到在线编译器中。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复S2C模块的库</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请记住，如果您具有S2C系列模块：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
则需要使用以下修补程序而不是标准库：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBeeLib_Fixed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，这些程序将无法工作。</font><font style="vertical-align: inherit;">只需从那里删除XBeeLib库，然后将其导入XBeeLibFix项目中，即可将其添加到项目中。</font><font style="vertical-align: inherit;">无需更改。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此：将这个库导入到在线编译器中：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/vq/e9/kovqe9zqdl7553_kivabf8bedv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
项目导入窗口将会出现。</font><font style="vertical-align: inherit;">在那里，您需要选择目标-我们导入的位置：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/pt/vt/bxptvt2ctwcv87vl-b1qi5upi4s.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为目标项目，选择示例XBeeZB_Receive_Data。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/lj/hg/7qljhgp7jx5yt9875cqijnfopcs.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，库将被导入到项目中，然后大胆地删除错误版本的XBeeLib。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/iw/hz/or/iwhzor7bqjopgpigyi4_lfiv43e.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译示例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，您导入了示例，并在必要时替换了其中的库。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看一下示例代码，这很简单。</font><font style="vertical-align: inherit;">它定义了一个回调函数，当接收到数据包时将调用该函数。</font><font style="vertical-align: inherit;">此功能将接收到的数据包的内容打印到控制台。</font><font style="vertical-align: inherit;">因此，如果我们给她打招呼，她也会打印出来。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了编译示例，您需要在示例中编写我们负责与XBee模块通信的结论，因为程序不知道我们将硬件连接到了哪些结论。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们转到config.h文件及其中的行：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define RADIO_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX pin connected to the XBee module DIN pin */</span>
<span class="hljs-comment">//#define RADIO_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX pin connected to the XBee module DOUT pin */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取消注释，然后根据连接跳线的结论编写NC而不是NC：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_TX PA_9</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RADIO_RX PA_10</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同样，我们修改以下行：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define DEBUG_TX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial TX for debugging */</span>
<span class="hljs-comment">//#define DEBUG_RX NC /* <span class="hljs-doctag">TODO:</span> specify your setup's Serial RX for debugging (optional) */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们写：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_TX USBTX</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_RX USBRX</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在编译过程中遇到找不到的错误</font></font><code>device.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只需更新项目树中的Mbed库（右键单击它-&gt;更新），</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此后程序将成功编译，您可以将其下载到开发板上。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行示例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看完Nucleo板写的控制台后，您将看到以下内容：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/mk/fb/asmkfbne30jznt7bzqvr2vjhl5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们如何发送数据？</font><font style="vertical-align: inherit;">最简单的选择：通过XCTU程序中的控制台。</font><font style="vertical-align: inherit;">在程序的主菜单中选择：工具-发送数据包。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/9b/7q/ko9b7qwhvwszyezghvzpbs1py74.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在底部有一个窗口，上面有单词Send packet。</font><font style="vertical-align: inherit;">通过单击右侧的“加号”来创建新程序包。</font><font style="vertical-align: inherit;">将出现一个用于创建新软件包的窗口。</font><font style="vertical-align: inherit;">在此处选择“十六进制”选项卡。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cf/wz/jccfwz6aesmjic-ncukw8ot1ls8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此处输入这样的数据发送：（</font></font><br>
<code>7E 00 19 10 01 00 00 00 00 00 00 FF FF FF FE 00 00 48 65 6C 6C 6F 20 58 42 65 65 21 5A</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用数据包列表右侧的“发送所选数据包”按钮），</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您将在侦听模块的控制台中看到结果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/55/tg/mk/55tgmkipu_8dk33yhqdxxqa90du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，它仅打印您发送的字节集的最后一部分。</font><font style="vertical-align: inherit;">这是消息的实际有效负载。</font><font style="vertical-align: inherit;">还要注意，如果发送“仅字节”（字节的任意组合），则接收器将不会输出它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果</font></font><br>
<code>48 65 6C 6C 6F 20 58 42 65 65 21</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在任何HEX-ASCIII转换器中</font><font style="vertical-align: inherit;">放入一组字节：（&nbsp; </font><font style="vertical-align: inherit;">例如，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），请确保其含义为“ Hello XBee！”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独立执行的一个非常简单的任务：修改示例代码，以使其以ASCII而不是HEX的形式显示消息文本，您可以在终端中读取该文本。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.发送数据</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与前面的示例类似，我们现在考虑发送数据。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/5i/ot/bp5iota_umzhimxdl5yhgnmflzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如上例所示，一切都在这里。</font><font style="vertical-align: inherit;">只是有所不同，我们现在打开</font><font style="vertical-align: inherit;">XBeeZB_Send_Data </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译示例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要的是，如果您有一个S2C模块（清楚地写在上面），</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hc/vr/kb/hcvrkbswx5s8hspbos6djkmxfko.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那么您将再次将该库与修订连接，否则将无济于事。上一个示例中介绍了如何执行此操作。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
另外，在这里为了成功进行编译，您需要指定使用的控制器引脚，您可以简单地从前面的示例中复制它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们来看示例代码本身。它</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用几种方法发送数据。选择最简单的方法：将数据发送给协调器。我们甚至不需要注册协调员的地址，因为他已经在网络上注册。因此，在不更改示例的情况下，我们在所有行末尾添加注释：</font></font><br>
<pre><code class="cpp hljs">send_data_to_coordinator(xbee);
<span class="hljs-comment">//send_broadcast_data(xbee);</span>
<span class="hljs-comment">//send_data_to_remote_node(xbee, remoteDevice);</span>
<span class="hljs-comment">//send_explicit_data_to_remote_node(xbee, remoteDevice);</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且，当您开始时，您会看到以下内容：（</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/pp/sj/suppsjbb95cdiavs1svsj1ixctm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果看不到，只需重新启动电路板即可）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何确定数据到达协调器？例如，XCTU具有网络控制台模式。通过右上方的按钮打开。在这种模式下，您将看到网络上的所有数据包。当然，与此同时，您应该与协调器建立串行连接。并且不要忘记单击左上方的“打开”按钮以使其变为绿色。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/st/vy/yzstvyfb4ed2rkbgvmgushy1gkg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过在左侧列表中选择它，可以查看有关网络上每个软件包的详细信息：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/2w/_f/fl2w_fotyjqzbmdpt9tp6fvyyba.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
滚动到软件包内容的末尾，您将看到一行带有文本“ send_data_to_coordinator”的行：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/da/ha/vmdahazkjgs7ttk_d-hg6osq7oi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以尝试其他发送数据的方法，但是在那里（例如，发送到单独的选定节点），您需要注册节点地址。</font><font style="vertical-align: inherit;">您可以在XCTU程序中看到所有模块的地址。</font><font style="vertical-align: inherit;">该示例中详尽描述了如何注册特定地址。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.我们制作了MQTT网关</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都很好，但是现在我想以某种方式在XBee网络之外（例如，在Internet上）使用此数据。</font><font style="vertical-align: inherit;">一种方法是将XBee的翻译器放入流行的MQTT协议中。</font><font style="vertical-align: inherit;">然后，以通常的方式，我们可以订阅事件通知并从用户界面发送命令，并且该程序可以位于任何地方（如果您使用外部MQTT服务器而不是本地MQTT服务器），而不仅位于我们的计算机上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下是说明。</font><font style="vertical-align: inherit;">简而言之，在计算机上启动的程序将通过USB连接从网络协调器交换数据。</font><font style="vertical-align: inherit;">她将这些数据传输到MQTT协议。</font></font><br>
<img src="https://habrastorage.org/webt/t0/yo/dx/t0yodx2oqigqjepdzr0w8exjwaq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置XBMQ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将用作MQTT网关的程序称为XBMQ，它是开放和免费的。</font><font style="vertical-align: inherit;">存在两个版本：</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">爪哇</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点JS</font></font></a><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将考虑使用Java版本，尽管这并不是太基本：我们将不会对其进行编程，只会安装并使用它。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使程序正常工作，您将需要RXTX库，可以从存储库中简单地安装它：</font></font><br>
<pre><code class="bash hljs">sudo apt-get install librxtx-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，您需要JDK（Java开发套件）。</font><font style="vertical-align: inherit;">它有两个版本-来自Oracle和OpenJDK，建议使用第二个版本。</font><font style="vertical-align: inherit;">很可能OpenJDK已经安装在您的系统上；如果没有，请重新安装它。</font><font style="vertical-align: inherit;">Java最多需要8位，因为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 11排除了javax.xml.bind，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且您需要选择JDK-8作为默认选项的替代项，或者为此情况创建配置。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载XBMQ程序的存储库：</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/angryelectron/xbmq-java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载源代码后，我们将收集程序的二进制文件。</font><font style="vertical-align: inherit;">球队</font></font><br>
<pre><code class="bash hljs">ant dist</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将为所有主要操作系统组装一个项目。</font><font style="vertical-align: inherit;">最终的已编译程序将位于文件夹中</font></font><code>dist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在配置该程序。</font><font style="vertical-align: inherit;">打开文件</font></font><pre><code class="plaintext hljs">dist/xbmq.properties</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 并在那里查看：</font></font><br>
<pre><code class="bash hljs"><span class="hljs-comment">#</span>
<span class="hljs-comment"># Xbmq Properties.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#port = /dev/ttyUSB0</span>
<span class="hljs-comment">#baud = 9600</span>
<span class="hljs-comment">#rootTopic = ab123</span>
<span class="hljs-comment">#broker = tcp://test.mosquitto.org:1883</span>
<span class="hljs-comment">#username = user</span>
<span class="hljs-comment">#password = password</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
取消注释并更改您的参数。</font><font style="vertical-align: inherit;">参数如下：ZigBee协调器连接端口，速度，根主题（所有数据都将落入其中），MQTT服务器地址，用户名和密码（如果服务器需要它们）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此示例中，仅服务器地址已更改-更改为本地mqtt服务器（来自Linux的标准mosquitto）。</font><font style="vertical-align: inherit;">默认情况下，其他所有内容均保留：</font></font><br>
<pre><code class="bash hljs"><font></font>
port = /dev/ttyUSB0<font></font>
baud = 9600<font></font>
rootTopic = ab123<font></font>
broker = tcp://127.0.0.1:1883<font></font>
username = user<font></font>
password = password<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在下一步之前，您必须安装并运行本地mosquitto MQTT服务器：&nbsp;</font></font><br>
<pre><code class="bash hljs">sudo apt-get install mosquitto</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XBMQ发布</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，可以启动该程序。</font><font style="vertical-align: inherit;">连接USB-UART转换器并插入协调器模块后，运行程序：</font></font><br>
<pre><code class="bash hljs">./dist/xbmq.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
运行脚本时，我们会在控制台中看到以下行：</font></font><br>
<pre><code class="bash hljs">INFO - Starting XBMQ gateway ab123/0013A2004154EA46</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后-这正是我们协调员的地址。</font><font style="vertical-align: inherit;">如果您使用外部MQTT客户端订阅了所有主题，则将立即看到2条消息：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在主题“ </font></font><code>ab123/0013A2004154EA46/online</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将为1”中，这是“最后的意愿”（这是在现实生活中如何使用这些“特殊”参数的一个很好的例子）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该主题</font></font><code>ab123/0013A2004154EA46/log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将包含您在控制台中已经看到的相同调试短语“ Starting XBMQ gateway ...”。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在尝试从其他外部XBee模块发送消息-例如，以发送数据为例。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，在MQTT.fx程序中，如果您订阅了所有主题（＃），您将看到以下内容：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/56/5l/hy565luregquqnizlxf7pejdn40.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT.fx程序窗口，</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
即通过开始前面研究的示例，向协调器发送消息，我们将看到此文本（“ send_data_to_coordinator”） MQTT软件包。对我们来说，常见的父主题是程序配置中指定的父主题（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ab123</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以将其更改为自己的主题）。接下来是协调器的地址，然后是消息来自的模块的地址。最后，该主题称为DataOut，因为它是传出数据。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，您将在其他任何MQTT客户端中看到这样的图片，无论是MQTTLens还是什至仅仅是</font></font><code>mosquitto_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在控制台中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后几点意见：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以良好的方式，该程序应在守护程序模式下运行。</font><font style="vertical-align: inherit;">为此有一个xbmqd文件，自述文件说明了如何使用它。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，由于它</font></font><code>xbmq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拥有端口，因此我们无法与XCTU同时运行此程序。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，您可以使用MQTT协议与系统一起工作，并编写复杂而有趣的程序！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova-物联网培训计划的作者“三星IT学院”，三星研究中心的企业社会责任计划专家</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN497178/index.html">“ 1C：ERP”和“ 1C：CRM”：功能和配置的比较分析</a></li>
<li><a href="../zh-CN497184/index.html">展望地质，地球物理和野外数据管理系统的发展方向</a></li>
<li><a href="../zh-CN497186/index.html">如何寻找冠状病毒疫苗</a></li>
<li><a href="../zh-CN497192/index.html">IT如何远程工作：管理分布式团队的技巧</a></li>
<li><a href="../zh-CN497194/index.html">与您的朋友相比，Tinder更了解您的私生活</a></li>
<li><a href="../zh-CN497204/index.html">数字2020：固定趋势</a></li>
<li><a href="../zh-CN497206/index.html">关于面向对象的编程</a></li>
<li><a href="../zh-CN497212/index.html">[说明]使用Google磁盘，Google-Site，Google-Form创建数据库和反馈系统</a></li>
<li><a href="../zh-CN497214/index.html">数据工程师和数据科学家：他们能做什么和赚多少钱</a></li>
<li><a href="../zh-CN497216/index.html">我们发生了冠状病毒流行</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>