<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖋️ 🎷 👃🏻 Mikrotik-Firewall-Filter: Skript, das die Grundlage für eine Filterrichtlinie generiert 🙇🏼 🤾🏻 👨🏿‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jeder, der jemals eine Firewall-Filterrichtlinie geschrieben hat, weiß, dass dies keine einfache Angelegenheit ist und viele Fehler mit sich bringt, w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikrotik-Firewall-Filter: Skript, das die Grundlage für eine Filterrichtlinie generiert</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeder, der jemals eine Firewall-Filterrichtlinie geschrieben hat, weiß, dass dies keine einfache Angelegenheit ist und viele Fehler mit sich bringt, wenn mehr als zwei Netzwerkzonen vorhanden sind. </font><font style="vertical-align: inherit;">Das Skript aus diesem Artikel hilft Ihnen in diesem Aufsatz.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Netzwerkzone meine ich eine Reihe von Schnittstellen oder IP-Adressen, für die die Filterregel gilt. </font><font style="vertical-align: inherit;">In meinem Skript werden die Zonen-IP-Adressen der Schnittstelle zugewiesen. </font><font style="vertical-align: inherit;">Das heißt, wenn wir "vertrauenswürdige" IP-Adressen vom lokalen Netzwerk erwarten, ist es seltsam, wenn die entsprechenden Verbindungen vom Anbieter ankommen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie funktioniert es</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles dreht sich um die Beschreibung der Zonen, in denen wir fragen, wie sie miteinander interagieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn in meiner Konfiguration keine anderen Regeln festgelegt sind, wird der gesamte Datenverkehr mit der DROP-Regel gelöscht, sodass die Regeln ACCEPT und REJECT festgelegt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Nächstes durchläuft das Skript in einer Schleife alle Zonenbeschreibungen und erstellt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnittstellenlisten IF- &lt;Zonenname&gt;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-Adresslisten &lt;Zonenname&gt;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definiert die Standard- und leicht von mir ergänzte Filter-, Mangle- und Raw-Konfiguration</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die IP-Verkehrszielzone von der Schnittstelle unterscheidet sich darin, dass ihr Name nicht im Abschnitt für Schnittstellen enthalten ist. </font><font style="vertical-align: inherit;">Somit versteht das Skript, wo wir den Zweck von IP haben und wo sich die Schnittstelle befindet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variablen</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gping - Erlaube Ping in alle Richtungen und beim Weiterleiten. </font><font style="vertical-align: inherit;">Mit anderen Worten, es ist möglich, auch das zu pingen, was durch andere Regeln im Filter geschlossen wurde. </font><font style="vertical-align: inherit;">Nach Wunsch einschließen;)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug - Setzt eine Regel ganz am Anfang der ACCEPT-Stammkette, wodurch alle anderen Regeln unbrauchbar werden. </font><font style="vertical-align: inherit;">Sehr nützlich in der Phase des Debuggens von Regeln. </font><font style="vertical-align: inherit;">Führen Sie die Richtlinie wie gewünscht aus, aktivieren Sie den abgesicherten Modus und deaktivieren Sie diese Regeln. </font><font style="vertical-align: inherit;">Wenn der Router nicht mehr verfügbar ist, werden die Regeln nach 10 Sekunden wieder aktiviert und Sie können sich überlegen, worüber Sie sich geirrt haben.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allout - Ermöglicht den ausgehenden Datenverkehr des Routers. Normalerweise generiert der Router keinen fehlerhaften Datenverkehr. In einer Reihe von Konfigurationen ist dies akzeptabel.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung der Zonen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Beschreibung selbst ist in zwei Blöcke unterteilt: Schnittstellen und IP-Adressen. </font><font style="vertical-align: inherit;">Es gibt spezielle Variablen für Schnittstellen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is_wan: Fügt Regeln für die Verarbeitung von Tunneln und DNS hinzu</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do_masq: Fügt dieser Zone Verkehrsmaskierungsregeln hinzu</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is_lan: Fügt Regeln für die Beantwortung von DHCP und DNS hinzu</font></font></li>
<li>mss:    mss   ,      </li>
<li>ADDoS:     DDoS   .   —     (  ) ,   IP      .   :<br>
<ul>
<li>gen — generic,    ,      .</li>
<li>mngr — managment,     mikrotik (winbox, ssh)</li>
<li>   —   ,    .</li>
</ul><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch zwei spezielle Zonen: rt, dies ist der Router selbst, und alle, da es nicht schwierig ist, "irgendeine Richtung" zu erraten, können nicht alle als Verkehrsquelle angegeben werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptaktion des Skripts besteht darin, eine Reihe von Sprungregeln mit Filterung nach Quelle und Ziel des Datenverkehrs zu erstellen, die durch eine Regel mit ACCEPT oder REJECT beendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Beschreibung der Zone kann reduziert werden, wie im Beispiel für ISP und rt (sollte es immer sein). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die Kette mit Ihrer Regel beenden möchten, fügen Sie einfach benutzerdefinierte (oder was auch immer) in die Zonenbeschreibung ein, anstatt zu akzeptieren oder abzulehnen. Die Sprungkette wird dann von keiner Regel vervollständigt, und Sie können sie selbst erstellen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erläuterung der Regeln aus dem Skript</font></font></h3><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zonen</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">:<span class="hljs-built_in">local</span> gping 1<font></font>
:<span class="hljs-built_in">local</span> debug 0<font></font>
:<span class="hljs-built_in">local</span> zones {
	<span class="hljs-string">"if"</span>={
		<span class="hljs-string">"ISP"</span>={
			<span class="hljs-string">"is_wan"</span>=1;
			<span class="hljs-string">"do_masq"</span>=1;
			<span class="hljs-string">"ADDoS"</span>={<font></font>
				mngr={<font></font>
					dst-limit=<span class="hljs-string">"4/1m,1,src-address/1m40s"</span>;<font></font>
					timeout=<span class="hljs-string">"1d"</span>;<font></font>
					comment=<span class="hljs-string">"Blocking bruteforcing winbox &amp; ssh port"</span>;<font></font>
					excl=[:toarray (<span class="hljs-string">"Trusted"</span>)];<font></font>
				};<font></font>
				gen={<font></font>
					dst-limit=<span class="hljs-string">"50,50,src-address/10s"</span>;<font></font>
					timeout=<span class="hljs-string">"1d"</span>;<font></font>
					comment=<span class="hljs-string">"Blocking potential DDoS"</span>;<font></font>
					excl=[:toarray (<span class="hljs-string">"Trusted"</span>)];<font></font>
				};<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"LAN"</span>={
			<span class="hljs-string">"is_lan"</span>=1;<font></font>
			policy={ <font></font>
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"TUN"</span>={<font></font>
			mss=1400;<font></font>
		};<font></font>
		<span class="hljs-string">"rt"</span>={};<font></font>
	};<font></font>
	<span class="hljs-string">"ip"</span>={
		<span class="hljs-string">"rt"</span>={<font></font>
			policy={<font></font>
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span> <font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"TUN"</span>={
			<span class="hljs-string">"Staff"</span>={
				<span class="hljs-string">"Server"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
			<span class="hljs-string">"Manager"</span>={
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"ISP"</span>={
			<span class="hljs-string">"Trusted"</span>={
				<span class="hljs-string">"rt"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
	};<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt 4 Zonen für Schnittstellen, von denen eine obligatorisch ist:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISP ist für den Anbieter, daher wird empfohlen, zusätzliche Regeln für einige Protokolle zu erstellen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LAN - Für ein lokales Netzwerk gibt es Regeln für LAN und es gibt eine allgemeine Genehmigungsaktion in jede Richtung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TUN - Für die richtigen Tunnel wird die MSS-Korrektur angezeigt.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B 3. IP-Zonen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mitarbeiter und Manager an TUN-Schnittstellen:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mitarbeiter - hat nur Zugriff auf die IP-Zone des Servers</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manager - kann überall hingehen</font></font></li>
</ul><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vertrauenswürdig auf der ISP-Schnittstelle hat Zugriff auf den Router</font></font></li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen-Filter</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"># may/13/2020 10:00:00 by RouterOS 6.46.6</span>
<span class="hljs-comment"># RoS filter generator v 0.9.5</span><font></font>
<font></font>
:<span class="hljs-built_in">local</span> gping 0<font></font>
:<span class="hljs-built_in">local</span> debug 1<font></font>
:<span class="hljs-built_in">local</span> allout 1<font></font>
:<span class="hljs-built_in">local</span> zones {
	<span class="hljs-string">"if"</span>={
		<span class="hljs-string">"ISP"</span>={
			<span class="hljs-string">"is_wan"</span>=1;
			<span class="hljs-string">"do_masq"</span>=1;
			<span class="hljs-string">"ADDoS"</span>={<font></font>
				mngr={<font></font>
					dst-limit=<span class="hljs-string">"4/1m,1,src-address/1m40s"</span>;<font></font>
					timeout=<span class="hljs-string">"1d"</span>;<font></font>
					comment=<span class="hljs-string">"Blocking bruteforcing winbox &amp; ssh port"</span>;<font></font>
					excl=[:toarray (<span class="hljs-string">"Trusted"</span>)];<font></font>
				};<font></font>
				gen={<font></font>
					dst-limit=<span class="hljs-string">"50,50,src-address/10s"</span>;<font></font>
					timeout=<span class="hljs-string">"1d"</span>;<font></font>
					comment=<span class="hljs-string">"Blocking potential DDoS"</span>;<font></font>
					excl=[:toarray (<span class="hljs-string">"Trusted"</span>)];<font></font>
				};<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"LAN"</span>={
			<span class="hljs-string">"is_lan"</span>=1;<font></font>
			policy={ <font></font>
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"TUN"</span>={<font></font>
			mss=1400;<font></font>
		};<font></font>
		<span class="hljs-string">"rt"</span>={};<font></font>
	};<font></font>
	<span class="hljs-string">"ip"</span>={
		<span class="hljs-string">"rt"</span>={<font></font>
			policy={<font></font>
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span> <font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"TUN"</span>={
			<span class="hljs-string">"Staff"</span>={
				<span class="hljs-string">"Server"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
			<span class="hljs-string">"Manager"</span>={
				<span class="hljs-string">"all"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
		<span class="hljs-string">"ISP"</span>={
			<span class="hljs-string">"Trusted"</span>={
				<span class="hljs-string">"rt"</span>=<span class="hljs-string">"accept"</span>;<font></font>
			};<font></font>
		};<font></font>
	};<font></font>
}<font></font>
/ip firewall raw<font></font>
add action=notrack chain=prerouting ipsec-policy=<span class="hljs-keyword">in</span>,ipsec comment=<span class="hljs-string">"Notrack ipsec"</span>
add action=notrack chain=prerouting dst-address-type=multicast comment=<span class="hljs-string">"Notrack multicast"</span><font></font>
/ip firewall filter<font></font>
:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$debug</span>)=0 ) <span class="hljs-keyword">do</span>={<font></font>
	add action=accept chain=forward comment=DEBUG!!! disabled=yes<font></font>
	add action=accept chain=input comment=DEBUG!!! disabled=yes<font></font>
	add action=accept chain=output comment=DEBUG!!! disabled=yes<font></font>
} <span class="hljs-keyword">else</span>={<font></font>
	add action=accept chain=forward comment=DEBUG!!!<font></font>
	add action=accept chain=input comment=DEBUG!!!<font></font>
	add action=accept chain=output comment=DEBUG!!!<font></font>
}<font></font>
add action=accept chain=input comment=<span class="hljs-string">"defconf: accept to local loopback (for CAPsMAN)"</span> dst-address=127.0.0.1 dst-port=5246,5247 protocol=udp src-address-type=<span class="hljs-built_in">local</span>
add action=accept chain=input comment=<span class="hljs-string">"defconf: accept established,related,untracked"</span> connection-state=established,related,untracked<font></font>
add action=drop chain=input comment=<span class="hljs-string">"defconf: drop invalid"</span> connection-state=invalid<font></font>
add action=jump chain=input comment=<span class="hljs-string">"defconf: new input"</span> connection-state=new jump-target=<span class="hljs-keyword">in</span>-new<font></font>
add action=jump chain=input comment=<span class="hljs-string">"defconf: notrack input"</span> jump-target=<span class="hljs-keyword">in</span>-notrack<font></font>
add action=drop chain=input comment=<span class="hljs-string">"defconf: drop all not allowed"</span>
add action=accept chain=output comment=<span class="hljs-string">"defconf: accept established,related,untracked"</span> connection-state=established,related,untracked<font></font>
add action=jump chain=output comment=<span class="hljs-string">"defconf: new output"</span> connection-state=new jump-target=out-new<font></font>
add action=jump chain=output comment=<span class="hljs-string">"defconf: notrack output"</span> jump-target=out-notrack<font></font>
:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$allout</span>)=1 ) <span class="hljs-keyword">do</span>={<font></font>
	add action=accept chain=out-notrack comment=<span class="hljs-string">"defconf: Allow any trafic from rt"</span>
} <span class="hljs-keyword">else</span>={<font></font>
	add action=accept chain=out-notrack comment=<span class="hljs-string">"defconf: Allow any trafic from rt"</span> disabled=yes<font></font>
}<font></font>
add action=drop chain=output comment=<span class="hljs-string">"defconf: drop all not allowed"</span>
add action=accept chain=forward comment=<span class="hljs-string">"defconf: accept in ipsec policy"</span> ipsec-policy=<span class="hljs-keyword">in</span>,ipsec<font></font>
add action=accept chain=forward comment=<span class="hljs-string">"defconf: accept out ipsec policy"</span> ipsec-policy=out,ipsec<font></font>
add action=fasttrack-connection chain=forward comment=<span class="hljs-string">"defconf: fasttrack"</span> connection-mark=no-mark connection-state=established,related<font></font>
add action=accept chain=forward comment=<span class="hljs-string">"defconf: accept established,related, untracked"</span> connection-state=established,related,untracked<font></font>
add action=drop chain=forward comment=<span class="hljs-string">"defconf: drop invalid"</span> connection-state=invalid<font></font>
add action=jump chain=forward comment=<span class="hljs-string">"defconf: new forward"</span> connection-state=new jump-target=fw-new<font></font>
add action=jump chain=forward comment=<span class="hljs-string">"defconf: notrack forward"</span> jump-target=fw-notrack<font></font>
add action=accept chain=forward comment=<span class="hljs-string">"defconf: Accept all forward DSTNATed"</span> connection-nat-state=dstnat<font></font>
add action=drop chain=forward comment=<span class="hljs-string">"defconf: drop all not allowed for forward"</span>
:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$gping</span>)=1 ) <span class="hljs-keyword">do</span>={<font></font>
	add action=accept chain=WAN2RT-STD-PROTO comment=ICMP protocol=icmp disabled=yes<font></font>
} <span class="hljs-keyword">else</span>={<font></font>
	add action=accept chain=WAN2RT-STD-PROTO comment=ICMP protocol=icmp<font></font>
}<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=GRE ipsec-policy=<span class="hljs-keyword">in</span>,ipsec protocol=gre<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=IPSec protocol=ipsec-esp<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=IPSec protocol=ipsec-ah<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=<span class="hljs-string">"IPSec encapsulated"</span> dst-port=500,4500 protocol=udp<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=L2TP dst-port=1701 ipsec-policy=<span class="hljs-keyword">in</span>,ipsec protocol=udp<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=PPtP dst-port=1723 protocol=tcp<font></font>
add action=accept chain=LAN2RT-STD-PROTO comment=DNS dst-port=53 protocol=tcp<font></font>
add action=accept chain=LAN2RT-STD-PROTO comment=NTP,DNS,DHCP dst-port=53,123,67-68 protocol=udp<font></font>
add action=accept chain=LAN2RT-STD-PROTO comment=DHCP dst-port=67-68 protocol=udp<font></font>
add action=accept chain=RT2WAN-STD-PROTO comment=DNS dst-port=53 protocol=tcp<font></font>
add action=accept chain=RT2WAN-STD-PROTO comment=NTP,DNS dst-port=53,123 protocol=udp<font></font>
add action=accept chain=WAN2RT-STD-PROTO comment=IPSec protocol=ipsec-esp<font></font>
add action=accept chain=RT2WAN-STD-PROTO comment=IPSec protocol=ipsec-ah<font></font>
add action=accept chain=RT2WAN-STD-PROTO comment=<span class="hljs-string">"IPSec encapsulated"</span> dst-port=500,4500 protocol=udp<font></font>
add action=reject chain=RT2WAN-STD-PROTO comment=GRE ipsec-policy=out,none protocol=gre reject-with=icmp-admin-prohibited<font></font>
add action=reject chain=RT2WAN-STD-PROTO comment=L2TP dst-port=1701 ipsec-policy=out,none protocol=udp reject-with=icmp-admin-prohibited<font></font>
:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$gping</span>)=1 ) <span class="hljs-keyword">do</span>={<font></font>
	add action=accept chain=fw-new comment=ICMP protocol=icmp<font></font>
	add action=accept chain=<span class="hljs-keyword">in</span>-new comment=ICMP protocol=icmp<font></font>
	add action=accept chain=out-new comment=ICMP protocol=icmp<font></font>
} <span class="hljs-keyword">else</span>={<font></font>
	add action=accept chain=fw-new comment=ICMP protocol=icmp disabled=yes<font></font>
	add action=accept chain=<span class="hljs-keyword">in</span>-new comment=ICMP protocol=icmp disabled=yes<font></font>
	add action=accept chain=out-new comment=ICMP protocol=icmp disabled=yes<font></font>
}<font></font>
/ip firewall filter<font></font>
:foreach zone,conf <span class="hljs-keyword">in</span>=(<span class="hljs-variable">$zones</span>-&gt;<span class="hljs-string">"if"</span>) <span class="hljs-keyword">do</span>={<font></font>
	:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$zone</span>)!=<span class="hljs-string">"rt"</span> ) <span class="hljs-keyword">do</span>={<font></font>
		:<span class="hljs-keyword">if</span> ( [/interface list <span class="hljs-built_in">print</span> count-only <span class="hljs-built_in">where</span> name=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>)] = 0) <span class="hljs-keyword">do</span>={<font></font>
			/interface list add name=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>)<font></font>
		}<font></font>
		add action=jump chain=fw-new <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>)<font></font>
		add action=jump chain=<span class="hljs-keyword">in</span>-new <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>) jump-target=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>)<font></font>
		:foreach ddos,val <span class="hljs-keyword">in</span>=(<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"ADDoS"</span>) <span class="hljs-keyword">do</span>={<font></font>
			:<span class="hljs-keyword">if</span> ( <span class="hljs-variable">$ddos</span>=<span class="hljs-string">"mngr"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) dst-port=22,8291 jump-target=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"AntiDDoS for "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) protocol=tcp<font></font>
			}<font></font>
			:<span class="hljs-keyword">if</span> ( <span class="hljs-variable">$ddos</span>=<span class="hljs-string">"gen"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) jump-target=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"AntiDDoS for "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>)<font></font>
			}<font></font>
			:<span class="hljs-keyword">if</span> ( <span class="hljs-variable">$ddos</span>=<span class="hljs-string">"mngr"</span> || <span class="hljs-variable">$ddos</span>=<span class="hljs-string">"gen"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				:foreach excl <span class="hljs-keyword">in</span>=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"excl"</span>) <span class="hljs-keyword">do</span>={ <font></font>
					add action=<span class="hljs-built_in">return</span> chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Execption for "</span>.<span class="hljs-variable">$excl</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$excl</span>)<font></font>
				}<font></font>
				add action=<span class="hljs-built_in">return</span> chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Limit number incoming connections for "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) dst-limit=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"dst-limit"</span>)<font></font>
				add action=add-src-to-address-list address-list=(<span class="hljs-string">"IP-DDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) address-list-timeout=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"timeout"</span>) chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Add to IP-DDoS-"</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" list from "</span>.<span class="hljs-variable">$zone</span>)<font></font>
			}<font></font>
			:<span class="hljs-keyword">if</span> ( <span class="hljs-variable">$ddos</span>!=<span class="hljs-string">"mngr"</span> &amp;&amp; <span class="hljs-variable">$ddos</span>!=<span class="hljs-string">"gen"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) jump-target=(<span class="hljs-string">"ADDoS-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"AntiDDoS for "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) disabled=yes<font></font>
				:foreach excl <span class="hljs-keyword">in</span>=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"excl"</span>) <span class="hljs-keyword">do</span>={ <font></font>
					add action=<span class="hljs-built_in">return</span> chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Execption for "</span>.<span class="hljs-variable">$excl</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$excl</span>)<font></font>
				}<font></font>
				add action=<span class="hljs-built_in">return</span> chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Limit number incoming connections for "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) dst-limit=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"dst-limit"</span>)<font></font>
				add action=add-src-to-address-list address-list=(<span class="hljs-string">"IP-DDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) address-list-timeout=((<span class="hljs-variable">$val</span>)-&gt;<span class="hljs-string">"timeout"</span>) chain=(<span class="hljs-string">"ADDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>) comment=(<span class="hljs-string">"Add to IP-DDoS-"</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" list from "</span>.<span class="hljs-variable">$zone</span>)<font></font>
			}<font></font>
			/ip firewall raw add action=drop chain=prerouting comment=(<span class="hljs-string">"DROP Banned by "</span>.<span class="hljs-variable">$ddos</span>.<span class="hljs-string">" from "</span>.<span class="hljs-variable">$zone</span>) <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-DDoS-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"-"</span>.<span class="hljs-variable">$ddos</span>)<font></font>
		}<font></font>
	} <span class="hljs-keyword">else</span>={<font></font>
		add action=jump chain=out-new comment=(<span class="hljs-string">"Out plc for rt"</span>) jump-target=<span class="hljs-string">"out-plc-s:rt"</span><font></font>
	}	<font></font>
}<font></font>
:foreach zone,conf <span class="hljs-keyword">in</span>=(<span class="hljs-variable">$zones</span>-&gt;<span class="hljs-string">"if"</span>) <span class="hljs-keyword">do</span>={<font></font>
	:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$zone</span>)!=<span class="hljs-string">"rt"</span> &amp;&amp; (<span class="hljs-variable">$zone</span>)!=<span class="hljs-string">"all"</span>) <span class="hljs-keyword">do</span>={<font></font>
		:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"is_lan"</span>)=1 || (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"is_wan"</span>)=1 ) <span class="hljs-keyword">do</span>={<font></font>
			add action=jump chain=<span class="hljs-keyword">in</span>-notrack comment=(<span class="hljs-string">"In Allow plc for STD LAN PROTO from "</span>.<span class="hljs-variable">$zone</span>) <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) jump-target=LAN2RT-STD-PROTO<font></font>
		}<font></font>
		:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"is_wan"</span>)=1) <span class="hljs-keyword">do</span>={<font></font>
			add action=jump chain=<span class="hljs-keyword">in</span>-notrack comment=(<span class="hljs-string">"In Allow plc for STD WAN PROTO from "</span>.<span class="hljs-variable">$zone</span>) <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) jump-target=WAN2RT-STD-PROTO<font></font>
			add action=jump chain=out-notrack out-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"Out Allow plc for STD WAN PROTO to "</span>.<span class="hljs-variable">$zone</span>) jump-target=RT2WAN-STD-PROTO<font></font>
		}<font></font>
		:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"do_masq"</span>)=1) <span class="hljs-keyword">do</span>={<font></font>
			/ip firewall nat add action=masquerade chain=srcnat out-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"Masquerade traffic going to "</span>.<span class="hljs-variable">$zone</span>)<font></font>
		}<font></font>
		:<span class="hljs-keyword">if</span> ( [:len (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"mss"</span>)]!=0 ) <span class="hljs-keyword">do</span>={<font></font>
			/ip firewall mangle add action=change-mss chain=forward <span class="hljs-keyword">in</span>-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) new-mss=(<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"mss"</span>) passthrough=yes protocol=tcp tcp-flags=syn tcp-mss=((<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"mss"</span>+1).<span class="hljs-string">"-65535"</span>) comment=(<span class="hljs-string">"Fix mss on tunel "</span>.<span class="hljs-variable">$zone</span>)<font></font>
			/ip firewall mangle add action=change-mss chain=forward out-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$zone</span>) new-mss=(<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"mss"</span>) passthrough=yes protocol=tcp tcp-flags=syn tcp-mss=((<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"mss"</span>+1).<span class="hljs-string">"-65535"</span>) comment=(<span class="hljs-string">"Fix mss on tunel "</span>.<span class="hljs-variable">$zone</span>)<font></font>
		}<font></font>
		:foreach src,val <span class="hljs-keyword">in</span>=((<span class="hljs-variable">$zones</span>-&gt;<span class="hljs-string">"ip"</span>)-&gt;$<span class="hljs-string">"zone"</span>) <span class="hljs-keyword">do</span>={<font></font>
			:foreach tgt,policy <span class="hljs-keyword">in</span>=<span class="hljs-variable">$val</span> <span class="hljs-keyword">do</span>={<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)!=<span class="hljs-string">"rt"</span> &amp;&amp; (<span class="hljs-variable">$tgt</span>)!=<span class="hljs-string">"all"</span>) <span class="hljs-keyword">do</span>={<font></font>
					:<span class="hljs-keyword">if</span> ( [:len ((<span class="hljs-variable">$zones</span>-&gt;<span class="hljs-string">"if"</span>)-&gt;$<span class="hljs-string">"tgt"</span>)]=0 ) <span class="hljs-keyword">do</span>={<font></font>
						add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$src</span>) dst-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" to "</span>.<span class="hljs-variable">$tgt</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>)<font></font>
					} <span class="hljs-keyword">else</span>={<font></font>
						add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$src</span>) out-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" to "</span>.<span class="hljs-variable">$tgt</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>)<font></font>
					}<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=accept chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Accept to "</span>.<span class="hljs-variable">$tgt</span>)<font></font>
					}<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=reject chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Reject to "</span>.<span class="hljs-variable">$tgt</span>)<font></font>
					}<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)=<span class="hljs-string">"rt"</span> ) <span class="hljs-keyword">do</span>={<font></font>
					add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$src</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" to rt"</span>) jump-target=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;rt"</span>)<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=accept chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;rt"</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Accept to rt"</span>)<font></font>
					}<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=reject chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;rt"</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Accept to rt"</span>)<font></font>
					}<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)=<span class="hljs-string">"all"</span> ) <span class="hljs-keyword">do</span>={<font></font>
					add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$src</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" to All"</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>)<font></font>
					add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) src-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$src</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" to All"</span>) jump-target=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>)<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=accept chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Accept to All"</span>)<font></font>
						add action=accept chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"In plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Accept to All"</span>)<font></font>
					}<font></font>
					:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
						add action=reject chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Reject to All"</span>)<font></font>
						add action=reject chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&amp;"</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"In plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" &amp; ip "</span>.<span class="hljs-variable">$src</span>.<span class="hljs-string">" Reject to All"</span>)<font></font>
					}<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
		:foreach tgt,policy <span class="hljs-keyword">in</span>=(<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"policy"</span>) <span class="hljs-keyword">do</span>={<font></font>
			:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)!=<span class="hljs-string">"rt"</span> &amp;&amp; (<span class="hljs-variable">$tgt</span>)!=<span class="hljs-string">"all"</span>) <span class="hljs-keyword">do</span>={<font></font>
				:<span class="hljs-keyword">if</span> ( [:len ((<span class="hljs-variable">$zones</span>-&gt;<span class="hljs-string">"if"</span>)-&gt;$<span class="hljs-string">"tgt"</span>)]=0 ) <span class="hljs-keyword">do</span>={<font></font>
					add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) dst-address-list=(<span class="hljs-string">"IP-"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" to "</span>.<span class="hljs-variable">$tgt</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>)<font></font>
				} <span class="hljs-keyword">else</span>={<font></font>
					add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) out-interface-list=(<span class="hljs-string">"IF-"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" to "</span>.<span class="hljs-variable">$tgt</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>)<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=accept chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Accept to "</span>.<span class="hljs-variable">$tgt</span>)<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=reject chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;"</span>.<span class="hljs-variable">$tgt</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Reject to "</span>.<span class="hljs-variable">$tgt</span>)<font></font>
				}<font></font>
			}<font></font>
			:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)=<span class="hljs-string">"rt"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"is_lan"</span>)!=1 &amp;&amp; (<span class="hljs-variable">$conf</span>-&gt;<span class="hljs-string">"is_wan"</span>)!=1 ) <span class="hljs-keyword">do</span>={<font></font>
					add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" to rt"</span>) jump-target=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;rt"</span>)<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=accept chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;rt"</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Accept to rt"</span>)<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=reject chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;rt"</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Reject to rt"</span>)<font></font>
				}<font></font>
			}<font></font>
			:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$tgt</span>)=<span class="hljs-string">"all"</span> ) <span class="hljs-keyword">do</span>={<font></font>
				add action=jump chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" to All"</span>) jump-target=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>)<font></font>
				add action=jump chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>) comment=(<span class="hljs-string">"In plc for if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" to All"</span>) jump-target=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>)<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"accept"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=accept chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Accept to All"</span>)<font></font>
					add action=accept chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"In plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Accept to All"</span>)<font></font>
				}<font></font>
				:<span class="hljs-keyword">if</span> ( (<span class="hljs-variable">$policy</span>)=<span class="hljs-string">"reject"</span>) <span class="hljs-keyword">do</span>={<font></font>
					add action=reject chain=(<span class="hljs-string">"fw-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"Fwd plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Reject to All"</span>)<font></font>
					add action=reject chain=(<span class="hljs-string">"in-plc-s:"</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">"&gt;all"</span>) comment=(<span class="hljs-string">"In plc from if "</span>.<span class="hljs-variable">$zone</span>.<span class="hljs-string">" Reject to All"</span>)<font></font>
				}<font></font>
			}<font></font>
		}<font></font>
	}<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Skript hat mir geholfen, die Konfiguration komplexer Richtlinien erheblich zu vereinfachen. Möglicherweise sind jedoch noch Fehler darin enthalten. </font><font style="vertical-align: inherit;">Konsultieren Sie vor Gebrauch einen Spezialisten. </font><font style="vertical-align: inherit;">Im Falle der Erkennung von Nebenwirkungen schreiben, werden wir korrigieren.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500138/index.html">Kurz über SAFe, LeSS und andere agile Frameworks</a></li>
<li><a href="../de500140/index.html">"Bis zu 10 Tausend": mehr als 25 Bewertungen von Kopfhörern</a></li>
<li><a href="../de500142/index.html">Rechte auf Einrichtungsebene verwalten</a></li>
<li><a href="../de500144/index.html">David O'Brien (Xirus): Metriken! Metriken! Metriken! Teil 1</a></li>
<li><a href="../de500146/index.html">Jobsuche in Deutschland als Produktmanager und mehr. Teil 3/5. Was Sie tun müssen, bevor Sie Lebensläufe versenden</a></li>
<li><a href="../de500150/index.html">ROS und Neural Grid Beggar Robot</a></li>
<li><a href="../de500152/index.html">Wie ich POS-Terminal und FR IKKM-Touch in 1C: Enterprise integriert habe</a></li>
<li><a href="../de500154/index.html">Vertrauliches maschinelles Lernen. PySyft-Bibliothek</a></li>
<li><a href="../de500158/index.html">SwiftUI-Interaktion mit Redux</a></li>
<li><a href="../de500160/index.html">Visuelle Elemente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>