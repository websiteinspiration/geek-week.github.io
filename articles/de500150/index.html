<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òïÔ∏è üö£üèæ üçª ROS und Neural Grid Beggar Robot ‚òÇÔ∏è ü§∑üèº üë©üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Normalerweise stellen sich f√ºr solche Handwerke zwei solche Fragen: "Wie?" und wof√ºr?" Die Ver√∂ffentlichung selbst ist der ersten Frage gewidmet, und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ROS und Neural Grid Beggar Robot</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500150/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Normalerweise stellen sich f√ºr solche Handwerke zwei solche Fragen: "Wie?" und wof√ºr?" Die Ver√∂ffentlichung selbst ist der ersten Frage gewidmet, und ich werde sofort auf die zweite antworten: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe dieses Projekt gestartet, um die Robotik zu beherrschen, beginnend mit dem Raspberry Pi und der Kamera. Wie Sie wissen, besteht eine der besten M√∂glichkeiten, etwas zu lernen, darin, eine technische Aufgabe zu entwickeln und zu versuchen, diese zu erf√ºllen, w√§hrend Sie die erforderlichen F√§higkeiten erwerben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu dieser Zeit hatte ich noch keine guten Ideen auf dem Gebiet der Robotik, also beschloss ich, ein ausschlie√ülich lustiges Projekt zu machen - einen Bettlerroboter. Das Ergebnis ist ein eigenst√§ndiger Roboter auf dem Raspberry Pi und ROS, der mit dem Movidius Neural Cumpute Stick Gesichter erkennt. Er wandert durch den Raum, sucht nach Menschen und sch√ºttelt eine Dose vor ihnen. So sieht dieser Roboter aus:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/wp/nt/ptwpntdd13lkskxbxjuhoyx1oom.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Roboter bewegt sich zuf√§llig durch den Raum, und wenn er eine Person bemerkt, rollt er sich auf ihn zu und sch√ºttelt ein Glas f√ºr kleine Dinge. </font><font style="vertical-align: inherit;">Zum Spa√ü habe ich ihm einen kleinen Gesichtsausdruck hinzugef√ºgt - er wei√ü, wie man seine Augenbrauen bewegt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2x/lm/aw/2xlmaw5tm_hogsuqfuvqwjmeblk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem ersten Versuch versucht der Roboter, sein Gesicht wieder in Sichtweite zu finden, dreht sich zu der Person um und sch√ºttelt die Bank erneut. </font><font style="vertical-align: inherit;">Aber was passiert, wenn Sie in diesem Moment gehen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/8x/xz/ko8xxzvzo_owit62gkv8z3wn1ik.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roboter</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die Idee eines Bettelroboters aus der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitschrift Popular Mechanics √ºbernommen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Prototyp-Autorschaft von Chris Eckert namens Gimme sieht sehr √§sthetisch aus.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/8d6/dbc/3748d6dbcb97d04751dacd866eb94e07.jpg" alt="Bild" width="300" height="300"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wollte mich mehr auf die Funktionalit√§t konzentrieren, deshalb wurde das Geh√§use aus improvisierten Materialien zusammengesetzt. </font><font style="vertical-align: inherit;">Insbesondere PVC-Ecken erwiesen sich als das vielseitigste Material, mit dem Sie nahezu zwei beliebige Teile verbinden k√∂nnen. </font><font style="vertical-align: inherit;">Es scheint, dass der Roboter derzeit zu f√ºnf Prozent aus PVC-Ecken und M3-Schrauben besteht. </font><font style="vertical-align: inherit;">Das Geh√§use selbst besteht aus drei Laminatplattformen, auf denen der Kopf und die gesamte Elektronik montiert sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Basis des Roboters ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und der Code ist in C ++ geschrieben und liegt auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vision</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Realit√§t wahrzunehmen, verwendet der Roboter die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kamera Paspberry Pi Camera Module v2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die √ºber die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspiCam-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek gesteuert werden </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">kann</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Gesichtserkennung habe ich verschiedene Ans√§tze ausprobiert. Die Qualit√§t der klassischen Detektoren von OpenCV hat mich nicht zufrieden gestellt, so dass ich am Ende zu einer eher nicht standardm√§√üigen L√∂sung kam. Erkennung von Personen, die am neuronalen Netzwerk beteiligt sind und auf dem Ger√§t </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movidius Neural Compute Stick (NCS)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unter dem Steuerungsrahmen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVINO ausgef√ºhrt werden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCS ist eine solche Hardware f√ºr den effektiven Start neuronaler Netze, in denen sich mehrere speziell darauf zugeschnittene Vektorprozessoren befinden. Das Ger√§t ist √ºber USB angeschlossen und verbraucht nur 1 Watt Strom. Somit fungiert das NCS als Co-Prozessor f√ºr den Raspberry Pi, der das neuronale Netzwerk nicht zieht. W√§hrend das NCS den n√§chsten Frame verarbeitet, ist der Paspberry-Prozessor f√ºr andere Vorg√§nge frei. Es ist zu beachten, dass f√ºr einen optimalen Betrieb des Ger√§ts eine USB 3.0-Schnittstelle erforderlich ist, die bei √§lteren Versionen von Raspberry nicht verf√ºgbar ist. mit USB 2.0 funktioniert es auch, nur langsamer. Um die Raspberry-USB-Anschl√ºsse nicht zu blockieren, schlie√üe ich das NCS √ºber ein kurzes USB-Kabel an. Ich habe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in meinem vorherigen Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausf√ºhrlich √ºber die Arbeit mit dem Neural Compute Stick geschrieben </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst habe ich versucht zu trainieren</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eigener Gesichtsdetektor mit MobileNet + SSD-Architektur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr offene Datens√§tze. Der Detektor funktionierte wirklich, aber nicht sehr stabil: Mit der unvermeidlichen Verschlechterung der Aufnahmebedingungen (Belichtung und verschwommene Aufnahmen) sank die Qualit√§t des Detektors stark. Nach einiger Zeit erschienen jedoch in OpenVINO vorgefertigte Gesichtsdetektoren, und ich wechselte zu einem Detektor mit der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SqueezeNet light + SSD-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Architektur </font><font style="vertical-align: inherit;">, der nicht nur unter verschiedenen Aufnahmebedingungen besser funktionierte, sondern auch schneller war. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor dem Hochladen des Bildes in das NCS, um die Vorhersagen des Detektors zu erhalten, muss das Bild vorverarbeitet werden. Der Detektor meiner Wahl arbeitet mit Farbbildern</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>300</mn><mo>&amp;#x00D7;</mo><mn>300</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.815ex" height="2.009ex" viewBox="0 -755.5 4225.9 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-D7" x="1723" y="0"></use><g transform="translate(2724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>300</mn><mo>√ó</mo><mn>300</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">300 \times 300</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher muss das Bild zuerst komprimiert werden. Dazu verwende ich den leichtesten Skalierungsalgorithmus - die Methode des n√§chsten Nachbarn (INTER_NEAREST in der OpenCV-Bibliothek). Es funktioniert etwas schneller als Interpolationsmethoden und hat fast keinen Einfluss auf das Ergebnis. Beachten Sie auch die Reihenfolge der Bildkan√§le: Der Detektor erwartet die BGR-Reihenfolge, daher m√ºssen Sie diese f√ºr die Kamera einstellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe auch versucht, die Videoverarbeitung in zwei Streams zu unterteilen, von denen einer das n√§chste Bild von der Kamera empfangen und verarbeitet hat, und der andere hat zu diesem Zeitpunkt das vorherige Bild in NCS hochgeladen und auf die Detektorergebnisse gewartet. Mit diesem Schema erh√∂ht sich technisch die Verarbeitungsgeschwindigkeit, aber auch die Verz√∂gerung zwischen dem Empfangen des Rahmens und dem Empfangen von Erkennungen f√ºr ihn nimmt zu. Aufgrund dieser Verz√∂gerung hinter der Realit√§t wird die √úberwachung des Gesichts nur noch schwieriger, so dass ich dieses Schema am Ende abgelehnt habe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie m√ºssen nicht nur Gesichter erkennen, sondern auch verfolgt werden, um Detektorfehler zu vermeiden. Dazu verwende ich den Lightweight Tracker </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Online Realtime Tracker (SORT)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieser einfache Tracker besteht aus zwei Teilen: Der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ungarische Algorithmus</font></a><font style="vertical-align: inherit;"> wird verwendet, um Objekte auf benachbarten Frames abzugleichen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und um die Flugbahn des Objekts vorherzusagen, wenn es pl√∂tzlich verschwindet - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kalman-Filter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">W√§hrend ich mit Face Tracking spielte, stellte ich fest, dass die vom Kalman-Filter vorhergesagten Trajektorien bei pl√∂tzlichen Bewegungen sehr unplausibel sein k√∂nnen, was wiederum den Prozess nur erschwert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund habe ich den Kalman-Filter ausgeschaltet und nur den Gesichtsanpassungsalgorithmus und den Z√§hler der fortlaufenden Anzahl von Frames belassen, auf denen das Gesicht erkannt wurde. Auf diese Weise werden die falsch positiven Ergebnisse des Detektors entfernt. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obere Plattform von links nach rechts: Kamera, Servos zur Steuerung von Kopf und Augenbrauen, Schalter, Stromanschl√ºsse, Big Red Button.</font></font></i><br>
<img src="https://habrastorage.org/webt/hb/ky/kk/hbkykkpwtkhtfl39aonaop5indg.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Verkehr</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die Bewegung verf√ºgt der Roboter √ºber f√ºnf Servos: Zwei Servos mit kontinuierlicher Rotation FS5103R drehen die R√§der; Es gibt zwei weitere gew√∂hnliche FS5109M, von denen einer den Kopf dreht und der andere die Dose sch√ºttelt. Schlie√ülich zieht der kleine SG90 die Augenbrauen hoch.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um ehrlich zu sein, schienen mir die SG90-Miniservos wie M√ºll zu sein - eines meiner Servos hatte die falsche Steuerimpulsbreite, und nur eines √ºberlebte unter den anderen vier. Fairerweise habe ich versehentlich einen der Diener mit meinem Ellbogen genommen, aber die anderen beiden konnten die Last einfach nicht tragen (ich habe sie fr√ºher f√ºr den Kopf und die Dose verwendet). Sogar das letzte Servo, das die einfachste Aufgabe hatte - das Bewegen der Augenbrauen - muss von Zeit zu Zeit einen Stock stechen, damit es nicht verkeilt. Bei anderen Servos habe ich keine Probleme bemerkt. Zwar m√ºssen Servos mit kontinuierlicher Rotation manchmal so kalibriert werden, dass sie sich im inaktiven Zustand nicht drehen. Dazu befindet sich ein kleiner Regler, der mit einem Schlitzschraubendreher gedreht werden kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass das Verwalten von Servos mit Raspberry nicht so einfach ist. Erstens werden sie von gesteuert</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulsweitenmodulation (PWM / PWM)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , und bei Raspberry gibt es nur zwei Pins, an denen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM von Hardware unterst√ºtzt wird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Zweitens wird Raspberry nat√ºrlich nicht in der Lage sein, die Servos anzutreiben, es wird dies nicht ertragen. Gl√ºcklicherweise werden diese Probleme mit einem externen PWM-Controller gel√∂st. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adafruit PCA9685</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein 16-Kanal-PWM-Controller, der √ºber die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I2C-Schnittstelle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gesteuert werden </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">kann</font></a><font style="vertical-align: inherit;"> . Es ist auch sehr praktisch, dass es Anschl√ºsse f√ºr die Stromversorgung von Servos hat. Dar√ºber hinaus ist es [theoretisch] m√∂glich, bis zu 62 Controller zu verketten und dabei bis zu 992 Steuerpins zu empfangen. Dazu m√ºssen Sie jedem Controller mit speziellen Jumpern eine eindeutige Adresse zuweisen. Wenn Sie also pl√∂tzlich eine Armee von Servos brauchen, wissen Sie, was zu tun ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Steuerung des PCA9685 gibt es eine √ºbergeordnete </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliothek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die als </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">WiringPi-</font></a><font style="vertical-align: inherit;"> Erweiterung fungiert</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Arbeit mit diesem Ding ist sehr praktisch - w√§hrend der Initialisierung werden 16 virtuelle Pins erstellt, in die Sie ein PWM-Signal schreiben k√∂nnen, aber zuerst m√ºssen Sie die Anzahl der Ticks berechnen. </font><font style="vertical-align: inherit;">Um den Servohebel auf einen bestimmten Winkel im Bereich [0, 180] zu drehen, m√ºssen Sie diesen Winkel zun√§chst in den Bereich der Steuerimpulsl√§ngen in Millisekunden [SERVO_MS_MIN, SERVO_MS_MAX] √ºbersetzen. </font><font style="vertical-align: inherit;">F√ºr alle meine Servos betragen diese Werte ungef√§hr 0,6 ms bzw. 2,4 ms. </font><font style="vertical-align: inherit;">Im Allgemeinen finden Sie diese Werte im Servodatenblatt. Die Praxis hat jedoch gezeigt, dass sie sich unterscheiden k√∂nnen, sodass sie m√∂glicherweise ausgew√§hlt werden m√ºssen. </font><font style="vertical-align: inherit;">Teilen Sie dann den resultierenden Wert durch 20 ms (den Standardwert der L√§nge des Regelzyklus) und multiplizieren Sie ihn mit der maximalen Anzahl von Ticks PCA9685 (4096):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">driveDegs</span><span class="hljs-params">(<span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">int</span> pin)</span> </span>{
    <span class="hljs-keyword">int</span> ticks = (<span class="hljs-keyword">int</span>) (PCA_MAX_PWM * (angle/<span class="hljs-number">180.0f</span>*(SERVO_MS_MAX-SERVO_MS_MIN) + SERVO_MS_MIN) / <span class="hljs-number">20.0f</span>); <font></font>
    pwmWrite(pin, ticks);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In √§hnlicher Weise geschieht dies mit Servos mit kontinuierlicher Rotation - anstelle eines Winkels stellen wir die Geschwindigkeit im Bereich [-1,1] ein.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das Roboterchassis sowie die Karosserie aus improvisierten Mitteln zusammengebaut: Ich habe M√∂belr√§der auf die Servoantriebe mit kontinuierlicher Rotation gesetzt, und eine M√∂belkugelst√ºtze fungiert als drittes Rad. Fr√ºher stand stattdessen ein Rad auf einer rotierenden St√ºtze, aber mit einem solchen Chassis war es schwierig, pr√§zise Kurven zu fahren, deshalb musste ich es ersetzen. Unter der Dose befindet sich auch ein kleines Rad, mit dem ein Teil des Gewichts vom Servo auf das Geh√§use √ºbertragen werden kann. Eine einfache Sache, die mir anfangs nicht klar war, war, dass Servohebel mit einer Schraube befestigt werden m√ºssen, insbesondere f√ºr R√§der, damit sie auf dem Weg nicht herunterfallen. Wegen dieser Dummheit musste ich das Chassis einmal wiederholen. Ich habe den Roboter auch zu einem breiten Sto√üf√§nger aus PVC-Ecken gemacht, damit er nicht so oft h√§ngen bleibt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun dar√ºber, was Sie dagegen tun k√∂nnen. Zun√§chst k√∂nnen Sie das Glas sch√ºtteln und die Augenbrauen bewegen - dazu m√ºssen Sie nur den Servohebel in einen vorgew√§hlten Winkel drehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweitens k√∂nnen Sie Ihren Kopf drehen. Ich wollte nicht, dass sich der Kopf mit der maximalen Geschwindigkeit des Servos dreht, da eine Kamera darauf ist. Deshalb habe ich mich entschlossen, die Geschwindigkeit programmgesteuert zu reduzieren: Ich muss den Hebel um einen kleinen Winkel drehen und dann einige Millisekunden warten - und so weiter, bis der gew√ºnschte Winkel erreicht ist. In diesem Fall muss die aktuelle absolute Position des Kopfes gespeichert und jedes Mal √ºberpr√ºft werden, ob er die zul√§ssigen Grenzwerte √ºberschritten hat (bei meinem Roboter liegt er im Bereich von [10, 90] Grad).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drittens k√∂nnen Sie die Bewegungsrichtung √§ndern, indem Sie die Drehzahl der R√§der √§ndern. </font><font style="vertical-align: inherit;">Auf die gleiche Weise k√∂nnen Sie beispielsweise die Plattform drehen, um dem Gesicht zu folgen. </font><font style="vertical-align: inherit;">Die Winkeldrehzahl h√§ngt sowohl von den Servos selbst als auch von ihrer Position auf dem Chassis ab. Daher ist es einfacher, sie einmal zu messen und sie dann bei Kurvenfahrten zu ber√ºcksichtigen. </font><font style="vertical-align: inherit;">Um die erforderliche Verz√∂gerung zwischen dem Einschalten der Motoren zum Drehen und dem Ausschalten zu ermitteln, m√ºssen Sie das Winkelmodul durch die Winkelgeschwindigkeit dividieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlie√ülich k√∂nnen Sie den Kopf und das Chassis gleichzeitig und asynchron drehen, um keine Zeit zu verschwenden. </font><font style="vertical-align: inherit;">So mach ich es:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">auto</span> waitRotation = <span class="hljs-built_in">std</span>::async(<span class="hljs-built_in">std</span>::launch::async, rotatePlatform, platformAngle);<font></font>
success = driveHead(headAngle);<font></font>
waitRotation.wait();<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zentrale Plattform von links nach rechts: PCA9685, Power Bus, Raspberry Pi, MCP3008 ADC</font></font></i><br>
<img src="https://habrastorage.org/webt/bq/q1/8_/bqq18_ilwmgadlcsz0ydepdk44u.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann habe ich nichts kompliziert, so dass der Roboter nur zwei Sharp GP2Y0A02YK Infrarot-Entfernungsmesser f√ºr die Navigation verwendet. Dies ist auch nicht so einfach, da die Sensoren analog sind, aber Raspberry hat im Gegensatz zu Arduino </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keine analogen Eing√§nge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dieses Problem wird durch den Analog-Digital-Wandler (ADC / ADC) gel√∂st. Ich verwende den 10-Bit-8-Kanal-MCP3008. Es wird als separate Mikroschaltung verkauft, daher musste es auf eine Leiterplatte gel√∂tet werden, und dort wurden auch Stifte verl√∂tet, um das Anschlie√üen zu vereinfachen. Auf Anraten meines Bati, der mehr an Schaltkreisen herumfummelt, habe ich zwei Kondensatoren (Keramik und Elektrolyt) zwischen die Schenkel des Netzteils und den Boden gel√∂tet, um das Rauschen des digitalen Teils des gesamten Schaltkreises zu absorbieren. Die Sensoren geben am Ausgang nicht mehr als drei Volt aus, sodass 3,3 V mit Raspberry als Referenz-ADC-Spannung (VREF) angeschlossen werden k√∂nnen - genau wie beim Netzteil MCP3008 (VDD). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der MCP3008 kann √ºber die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schnittstelle gesteuert werden </font><font style="vertical-align: inherit;">, und daf√ºr ist es sogar einfach, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorgefertigten Code auf GitHub zu finden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trotzdem ben√∂tigen Sie f√ºr eine bequeme Arbeit mit dem ADC einige T√§nze mit einem Tamburin.</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">analogRead</span><span class="hljs-params">(mcp3008Spi &amp;adc, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> channel)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> spi_data[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>;<font></font>
<font></font>
    spi_data[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;  <span class="hljs-comment">// start bit</span>
    spi_data[<span class="hljs-number">1</span>] = <span class="hljs-number">0b10000000</span> | ( channel &lt;&lt; <span class="hljs-number">4</span>); <span class="hljs-comment">// mode and channel</span>
    spi_data[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// anything</span>
    adc.spiWriteRead(spi_data, <span class="hljs-keyword">sizeof</span>(spi_data));<font></font>
  <font></font>
    <span class="hljs-comment">// read value, combine last two bits of second byte with whole third byte</span>
    val = (spi_data[<span class="hljs-number">1</span>]&lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0b1100000000</span>; <font></font>
    val |= (spi_data[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>);
    <span class="hljs-keyword">return</span> val;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es m√ºssen drei Bytes an den MCP3008 gesendet werden, wo das Startbit im ersten Byte und der Modus und die Kanalnummer (0-7) im zweiten Byte geschrieben werden. </font><font style="vertical-align: inherit;">Wir erhalten auch drei Bytes zur√ºck, wonach wir die zwei niedrigstwertigen Bits des zweiten Bytes mit allen Bits des dritten verbinden m√ºssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die Werte von den Sensoren erhalten k√∂nnen, m√ºssen wir sie kalibrieren, da sich die beiden Sensoren geringf√ºgig voneinander unterscheiden k√∂nnen. </font><font style="vertical-align: inherit;">Im Allgemeinen ist die Anzeige aus der Ferne aufgrund der Signalst√§rke dieser Sensoren nicht linear und nicht sehr einfach ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weitere Einzelheiten siehe Datenblatt, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Daher reicht es aus, zwei Koeffizienten zu erfassen, wenn sie multipliziert werden, wodurch die Sensoren in einem sinnvollen, gleichen Abstand einen Wert von 1,0 ergeben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Sensorwerte k√∂nnen sehr verrauscht sein, insbesondere bei schwierigen Hindernissen. Daher verwende ich einen exponentiell gewichteten gleitenden Durchschnitt (EWMA), um das Signal von jedem Sensor zu gl√§tten. </font><font style="vertical-align: inherit;">Ich habe die Gl√§ttungsparameter mit dem Auge ausgew√§hlt, damit das Signal kein Rauschen verursacht und nicht weit hinter der Realit√§t zur√ºckbleibt. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorderansicht: Bank, Entfernungsmesser und Sto√üstange.</font></font></i><br>
<img src="https://habrastorage.org/webt/kb/vw/l-/kbvwl-usmln86iqj8aq236ifhpo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ern√§hrung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns zun√§chst bewerten, welchen Strom der Roboter verbraucht ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºber den aktuellen Stromverbrauch von Himbeeren und Peripherieger√§ten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B: nicht weniger als 350 mA, aber mehr unter Last (bis zu 750-820 mA (?));</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kamera: ca. 250 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neural Compute Stick: angegebener Stromverbrauch von 1 Watt, bei einer Spannung von 5 Volt an USB sind es 200 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IR-Sensoren: jeweils 33 mA ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenblatt, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li>MCP3008:  ,  0.5  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>PCA9685:  , 6  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>:  ~150-200   1500-2000     (stall current),          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> FS5109M, pdf</a>)</li>
<li>HDMI (   ): 50 ;</li>
<li> +  ( ): ~200 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt kann gesch√§tzt werden, dass 1,5 bis 2,5 Ampere ausreichen sollten, sofern sich nicht alle Servos unter starker Last gleichzeitig bewegen. Gleichzeitig ben√∂tigt Raspberry eine bedingte Spannung von 5 Volt und f√ºr Servos 4,8-6 Volt. Es bleibt eine Stromquelle zu finden, die diese Anforderungen erf√ºllt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund habe ich beschlossen, den Roboter mit 18650 Batterien zu betreiben. Wenn Sie zwei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROBITON 3.4 / Li18650-Batterien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (3,6 Volt, 3400 mAh, maximaler Entladestrom 4875 mA) in Reihe </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">schalten</font></a><font style="vertical-align: inherit;"> , k√∂nnen sie bei einer Spannung von 7,2 Volt bis zu 4,8 Ampere erzeugen. Bei einem Verbrauchsstrom von 1,5 bis 2,5 Ampere sollten sie f√ºr ein oder zwei Stunden ausreichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Batterien haben √ºbrigens einen Haken: Trotz des angegebenen Formfaktors 18650 sind ihre Gr√∂√üen weit davon entfernt</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>18</mn><mo>&amp;#x00D7;</mo><mn>650</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.653ex" height="2.009ex" viewBox="0 -755.5 3725.4 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-D7" x="1223" y="0"></use><g transform="translate(2223,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-36"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>18</mn><mo>√ó</mo><mn>650</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">18 \times 650</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mm - sie sind aufgrund des eingebauten Ladesteuerkreises einige Millimeter l√§nger. Aus diesem Grund musste ich das Batteriefach mit einem Messer erstechen, damit sie dort passen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur die Spannung auf 5 Volt zu senken. Daf√ºr verwende ich zwei separate Abw√§rts-DC-DC-Wandler </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DFRobot Power Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mit diesem St√ºck Eisen k√∂nnen Sie die Spannung bei einer Eingangsspannung von 3,6 bis 25 Volt und einer Spannungsdifferenz von mindestens 0,6 Volt senken. Der Einfachheit halber verf√ºgt es √ºber einen Schalter, mit dem Sie genau 5 Volt am Ausgang ausw√§hlen oder eine beliebige Ausgangsspannung mit einem speziellen Regler einstellen k√∂nnen. Ich habe beide Wandler auf 5 Volt eingestellt; Einer von ihnen speist Himbeere √ºber einen Micro-USB-Anschluss und der zweite Servos √ºber PCA9685-Terminals. Dies ist erforderlich, um die Stromversorgung der logischen und der Leistungsteile des Roboters zu maximieren, damit sie sich nicht gegenseitig st√∂ren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Debuggen habe ich anstelle der Batterien ein chinesisches 9-Volt-2-Ampere-Netzteil verwendet, und es hat gereicht, damit der Roboter funktioniert. Ich habe es wie die Batterien an zwei DC-DC-Wandler angeschlossen. Aus praktischen Gr√ºnden habe ich am Roboter Terminals hergestellt, an die Sie ein Netzteil oder ein Batteriefach anschlie√üen k√∂nnen, aus denen Sie ausw√§hlen k√∂nnen. Dies hat mir sehr geholfen, als ich den gesamten Code auf ROS komplett neu geschrieben habe und den Roboter, einschlie√ülich Servos, lange Zeit debuggen musste. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Einfachheit halber musste ich auch einen "Leistungsbus" bauen - tats√§chlich nur ein St√ºck der Platine mit drei Reihen verbundener Stifte f√ºr Masse, 3,3 V bzw. 5 V. Der Bus wird mit den entsprechenden Himbeerstiften verbunden. Nur IR-Entfernungsmesser werden vom 5-V-Bus und MCP3008 und PCA9685 vom 3,3-V-Bus mit Strom versorgt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nat√ºrlich habe ich nach der guten alten Tradition den Big Red Button auf den Roboter gelegt - wenn er gedr√ºckt wird, unterbricht er einfach den gesamten Stromkreis. </font><font style="vertical-align: inherit;">Es war nicht notwendig, es f√ºr einen Notstopp zu verwenden, aber das Einschalten des Roboters mit Hilfe eines Knopfes ist wirklich bequemer. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untere Plattform von links nach rechts: Batteriefach, NCS, DC-DC-Wandler, Servoantriebe mit R√§dern, Entfernungsmesser.</font></font></i><br>
<img src="https://habrastorage.org/webt/od/tf/6b/odtf6b5gksijt0nhbflim7wrh1m.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robotersteuerung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Raspberry Pi 2B gibt es kein WLAN, daher muss ich eine Verbindung √ºber ssh √ºber ein Ethernet-Kabel herstellen (dies kann √ºbrigens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direkt vom Laptop aus erfolgen, ohne einen Router zu verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Es stellt sich dieses Schema heraus: Wir verbinden uns √ºber ssh √ºber das Kabel, starten den Roboter und ziehen das Kabel ab. Dann kann es an seinen Platz zur√ºckgebracht werden, um wieder auf die Himbeere zuzugreifen. Es gibt elegantere L√∂sungen, aber ich habe beschlossen, nicht zu komplizieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit der Roboter leicht gestoppt werden kann, ohne ihn auszuschalten, habe ich einen massiven sowjetischen Schalter (von einem U-Boot?) Hinzugef√ºgt. Wenn Sie ihn ausschalten, endet das Programm und der Roboter stoppt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Switch ist mit Masse und einem der Raspberry GPIO-Pins verbunden, und Sie k√∂nnen mithilfe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der WiringPi-Bibliothek daraus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">wiringPiSetup();<font></font>
pinMode(PIN_SWITCH, INPUT);<font></font>
pullUpDnControl(PIN_SWITCH, PUD_UP);<font></font>
<span class="hljs-keyword">bool</span> value = digitalRead(BB_PIN_SWITCH);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist anzumerken, dass bei dieser Verbindung die Spannung am Pin auf 3,3 V erh√∂ht werden muss und gleichzeitig ein hohes Signal im offenen Zustand und ein niedriges Signal im geschlossenen Zustand erzeugt wird.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles zusammenf√ºgen</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Jetzt m√ºssen alle oben genannten Punkte in einem Programm kombiniert werden, das den Roboter steuert. </font><font style="vertical-align: inherit;">In der ersten Version des Roboters habe ich dies mit Threads ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) gemacht. </font><font style="vertical-align: inherit;">Diese Version ist in dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Master</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Zweig </font><font style="vertical-align: inherit;">, aber der Code ist ziemlich be√§ngstigend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Programm arbeitet in vier Threads: Ein Thread nimmt Bilder von der Kamera und startet den Detektor am NCS; </font><font style="vertical-align: inherit;">der zweite Strom liest Daten von Entfernungsmessern; </font><font style="vertical-align: inherit;">Der dritte Thread √ºberwacht den Switch und setzt die globale Variable </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn es aus ist; Der Hauptfaden ist f√ºr das Roboterverhalten und die Servosteuerung verantwortlich. Threads haben Zeiger gemeinsam mit dem Haupt-Thread, mit dem sie die Ergebnisse ihrer Arbeit schreiben. Ich habe die Vektoren, die Informationen √ºber die vom Detektor gefundenen Gesichter speichern, auf den Mutex beschr√§nkt und die anderen, einfacheren allgemeinen Variablen als atomar deklariert. Um den Fluss des Gesichtsdetektors mit dem Hauptfaden zu koordinieren, gibt es ein Flag </font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, das zur√ºckgesetzt wird, wenn ein neues Ergebnis vom Detektor kommt, und ausgel√∂st wird, wenn der Hauptfaden dieses Ergebnis zur Auswahl eines Verhaltens verwendet. Dies ist erforderlich, um alte Daten, die m√∂glicherweise nicht relevant sind, nicht zu verarbeiten nach dem Umzug. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ROS-</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Version mit Streams hat gut funktioniert, aber ich habe das alles gestartet, um etwas zu lernen. Warum also nicht gleichzeitig Master?</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">Ich habe dieses Framework schon lange geh√∂rt und musste sogar ein bisschen damit an einem Hackathon arbeiten, also habe ich mich am Ende entschlossen, den gesamten Code auf ROS neu zu schreiben. </font><font style="vertical-align: inherit;">Diese Version des Codes befindet sich im Standardzweig von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und sieht viel anst√§ndiger aus. </font><font style="vertical-align: inherit;">Es ist klar, dass die Implementierung in ROS aufgrund des Overheads beim Senden von Nachrichten und allem anderen mit ziemlicher Sicherheit langsamer sein wird als die Implementierung in den Flows - die einzige Frage ist, wie viel?</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROS-Konzept</font></font></b>
                        <div class="spoiler_text">ROS (Robot Operating System) ‚Äî     ,             ,   ,        .<br>
<br>
    ,  ,  ,     (node), ,    ,       .<br>
<br>
      (topic)      (message)  ,         -    . <br>
<br>
    ‚Äî   (service).         ,       ,     .      ¬´ ¬ª,    .<br>
<br>
         <code>.msg</code>  <code>.srv</code> .          .<br>
<br>
 ROS    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr meinen Roboter habe ich keine vorgefertigten Pakete mit ROS-Algorithmen verwendet. Ich habe den Robotercode nur in einem separaten Paket entworfen, das aus f√ºnf Knoten besteht, die √ºber Nachrichten und ROS-Dienste miteinander kommunizieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einfachste Knoten </font></font><code>switch_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºberwacht den Status des Switches. Sobald sich der Schalter ausschaltet, beginnt der Knoten, nicht informative Nachrichten des Typs </font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Thema zu spammen </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies ist ein Signal an den Hauptknoten, dass es Zeit ist, die Arbeit abzuschlie√üen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Knoten </font></font><code>sensor_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liest regelm√§√üig die Messwerte beider IR-Entfernungsmesser und sendet sie in </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer Nachricht </font><font style="vertical-align: inherit;">an das Thema </font><font style="vertical-align: inherit;">. Dieser Knoten ist auch f√ºr die Signalverarbeitung verantwortlich: Skalierung durch Kalibrierungsfaktoren und gleitenden Durchschnitt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dritter Knoten</font></font><code>camera_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Er ist f√ºr alles verantwortlich, was mit Gesichtern zu tun hat: Er nimmt Bilder von der Kamera auf, verarbeitet sie, empf√§ngt die Ergebnisse des Detektors, leitet sie durch den Tracker und findet dann das Gesicht, das der Bildmitte am n√§chsten liegt - der Roboter verwendet den Rest sowieso nicht, aber Sie m√∂chten kleinere Nachrichten erstellen. Die Nachrichten, die der Knoten an das Thema sendet, </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enthalten die Rahmennummer, die Tatsache, dass ein Gesicht vorhanden ist (da Sie auch √ºber das Fehlen eines Gesichts Bescheid wissen m√ºssen), die relativen Koordinaten der oberen linken Ecke, die Breite und H√∂he des Gesichts. So sieht die Beschreibung des Nachrichtentyps in der Datei aus </font></font><code>DetectionBox.msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">int64 count<font></font>
bool present<font></font>
float32 x<font></font>
float32 y<font></font>
float32 width<font></font>
float32 height<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der vierte Knoten </font></font><code>servo_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist f√ºr die Servos verantwortlich. Erstens unterst√ºtzt es einen Dienst </font></font><code>servo_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der es erm√∂glicht, eine der Aktionen von Servos anhand ihrer Nummer auszuf√ºhren: den gesamten Knoten in seinen Ausgangszustand zu versetzen (Augenbrauen, Bank, Kopf, Chassis stoppen); den Kopf in seinen Ausgangszustand versetzen; sch√ºttle das Glas; Stellen Sie mit einer Augenbraue einen von drei Ausdr√ºcken dar (gut, neutral, b√∂se). Zweitens k√∂nnen Sie mithilfe des Dienstes </font></font><code>servo_speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neue Geschwindigkeiten f√ºr beide R√§der festlegen, indem Sie sie in der Anforderung senden. Beide Dienste geben nichts zur√ºck. Schlie√ülich gibt es einen Service </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mit dem Sie den Kopf und / oder das Chassis um einen bestimmten Winkel relativ zur aktuellen Position drehen k√∂nnen. Dieser Service kehrt zur√ºck, </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wenn es m√∂glich war, den Kopf zumindest teilweise zu drehen, und</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andernfalls, wenn sich der Kopf bereits am Rand des zul√§ssigen Winkels befindet und wir versuchen, ihn noch weiter zu drehen. </font><font style="vertical-align: inherit;">Wenn beide Winkel in der Anforderung ungleich Null sind, dreht sich der Dienst wie oben angegeben asynchron. </font><font style="vertical-align: inherit;">In der Hauptschleife tut der Servoknoten nichts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist zum Beispiel eine Beschreibung des Dienstes </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">float32 head_delta<font></font>
float32 platform_delta<font></font>
---<font></font>
bool head_success<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jeder der aufgelisteten Knoten unterst√ºtzt einen Dienst </font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einer leeren Antwortanforderung, wodurch der Betrieb des Knotens gestoppt wird. </font><font style="vertical-align: inherit;">Es wird folgenderma√üen implementiert:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etwas Code</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">...
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">atomic_bool</span> is_running; <span class="hljs-comment">// global</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">terminate_node</span><span class="hljs-params">(std_srvs::Empty::Request &amp;req, std_srvs::Empty::Response &amp;ignored)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">true</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">while</span> (is_running &amp;&amp; ros::ok()) {
        <span class="hljs-comment">// do stuff</span><font></font>
    }<font></font>
    ...<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Knoten hat eine globale Variable </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, deren Wert den Hauptzyklus des Knotens bestimmt. Der Dienst setzt diese Variable einfach zur√ºck und die Hauptschleife wird unterbrochen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch einen Hauptknoten, </font></font><code>beggar_bot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in dem die Grundlogik des Roboters implementiert ist. Vor dem Start der Hauptschleife werden Themen abonniert </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Inhalt von Nachrichten in globalen Variablen in R√ºckruffunktionen gespeichert. Er hat auch das Thema abonniert </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dessen R√ºckruf das Flag zur√ºcksetzt </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und die Hauptschleife unterbricht. Bevor der Zyklus beginnt, k√ºndigt der Knoten die Schnittstellen f√ºr die Dienste des Servoknotens an und wartet einige Sekunden, bis die anderen Knoten gestartet sind. Nach dem Ende der Hauptschleife ruft dieser Knoten die Dienste auf</font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dadurch werden alle anderen Knoten ausgeschaltet und dann selbst ausgeschaltet. Das hei√üt, wenn der Schalter ausgeschaltet ist, schlie√üen alle f√ºnf Knoten den Vorgang ab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Wechsel zu ROS hat mich gezwungen, die Struktur des Programms ziemlich zu √§ndern. Fr√ºher war es beispielsweise m√∂glich, die Radgeschwindigkeit mit einer hohen Frequenz zu √§ndern, und dies funktionierte einwandfrei, aber der ROS-Dienst arbeitet um eine Gr√∂√üenordnung langsamer, sodass ich den Code neu schreiben musste, damit der Dienst nur aufgerufen wurde, wenn sich die Geschwindigkeit wirklich √§ndert (im "Lazy-Modus"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit ROS k√∂nnen Sie auch ganz bequem alle Knoten des Roboters ausf√ºhren. Dazu m√ºssen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine .launch-Startdatei</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schreiben, </font><font style="vertical-align: inherit;">in der alle Knoten und andere Attribute des Roboters im XML-Format </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">aufgelistet sind</font></a><font style="vertical-align: inherit;"> , und dann den folgenden Befehl ausf√ºhren:</font></font><br>
<br>
<pre><code class="plaintext hljs">roslaunch beggar_bot robot.launch</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROS vs. pthread</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nun k√∂nnen Sie endlich die Geschwindigkeit der ROS-Version und der pthread-Version vergleichen. </font><font style="vertical-align: inherit;">Ich mache es so: Der Thread / Knoten, der f√ºr die Arbeit mit der Kamera verantwortlich ist, betrachtet seine FPS (als das langsamste Element), vorausgesetzt, alles andere funktioniert auch. </font><font style="vertical-align: inherit;">F√ºr die Pthread-Version habe ich durchweg FPS 9.99 oder so bekommen, f√ºr die ROS-Version stellte sich heraus, dass es ungef√§hr 8.3 war. </font><font style="vertical-align: inherit;">In der Tat ist dies f√ºr ein solches Spielzeug v√∂llig ausreichend, aber der Overhead ist durchaus sp√ºrbar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roboterverhalten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Idee ist ganz einfach: Wenn der Roboter eine Person sieht, muss er zu ihr fahren und die Dose sch√ºtteln. Das Glas zu sch√ºtteln ist ganz einfach und macht Spa√ü, aber zuerst m√ºssen Sie zu der Person gelangen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt eine Funktion </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die bei einer Fl√§che im Rahmen das Chassis und den Kopf des Roboters in seine Richtung dreht (nur die Fl√§che, die der Mitte am n√§chsten liegt, wird ber√ºcksichtigt). Dies ist notwendig, damit der Roboter immer seinen Kurs auf einer Person beh√§lt, wenn er sich im Rahmen befindet, und auch direkt in das Gesicht schaut, wenn er ein Glas sch√ºttelt. </font><font style="vertical-align: inherit;">Dieselbe Variable wird verwendet </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, um diese Funktion mit dem Thema zu synchronisieren </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wie in der Version mit Streams. Die Idee ist dieselbe - wir wollen Daten nur einmal verarbeiten, weil sich der Roboter st√§ndig bewegt. Die Funktion wartet zun√§chst, bis der R√ºckruf des Themas mit den Erkennungen das Flag senkt, dass der letzte Frame verarbeitet wurde. W√§hrend sie wartet, ruft sie st√§ndig </font></font><code>ros::spinOnce()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an, um neue Nachrichten zu erhalten (im Allgemeinen sollte dies √ºberall dort erfolgen, wo das Programm neue Daten erwartet). Befindet sich ein Gesicht im Rahmen, werden die Winkel berechnet, die die Plattform und den Kopf drehen m√ºssen. Dies kann erreicht werden, indem die relativen Koordinaten der Gesichtsmitte und des Sichtfelds der Kamera horizontal und vertikal bekannt sind. Danach k√∂nnen Sie den Service anrufen </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und den Roboter bewegen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt einen subtilen Punkt: Informationen √ºber die Position des Gesichts bleiben hinter der tats√§chlichen Bewegung des Gesichts zur√ºck und k√∂nnen hinter den Bewegungen des Roboters selbst zur√ºckbleiben. Daher kann der Roboter den Drehwinkel √ºbersch√§tzen, wodurch sich der Kopf mit zunehmender Amplitude hin und her zu bewegen beginnt. Um dies zu verhindern, mache ich Verz√∂gerungen nach dem Umzug (300 ms) und √ºberspringe auch einen Frame nach dem Umzug. Aus dem gleichen Grund werden die Drehwinkel von Chassis und Kopf mit dem Faktor 0,8 multipliziert (die P-Komponenten des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID-Reglers sind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sinnvoll </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktion</font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gibt den Status einer Person zur√ºck. </font><font style="vertical-align: inherit;">Eine Person kann: abwesend sein, nah genug am Zentrum sein, zu weit vom Roboter entfernt sein; </font><font style="vertical-align: inherit;">eine andere Option - als wir den Roboter drehten und nicht wussten, was mit dem Gesicht passiert ist (im Suchprozess); </font><font style="vertical-align: inherit;">Es gibt immer noch einen seltenen Fall, in dem sich der Kopf an der Grenze befindet, weshalb es unm√∂glich ist, sich dem Gesicht zuzuwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Hauptschleife passiert etwas ziemlich Einfaches:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rufen Sie an, </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bis die Person einen bestimmten Status hat (beliebig, au√üer "im Suchvorgang"). </font><font style="vertical-align: inherit;">Am Ende dieses Schritts schaut der Roboter direkt ins Gesicht.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Gesicht gefunden wird und es nahe ist: </font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√ºtteln Sie die Dose;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finde das Gesicht wieder;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Gesicht vorhanden ist, machen Sie einen guten Ausdruck mit den Augenbrauen und sch√ºtteln Sie das Glas erneut.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Gesicht verschwunden ist, machen Sie einen w√ºtenden Ausdruck mit Augenbrauen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drehen Sie sich um und gehen Sie zum Anfang des Zyklus.</font></font></li>
</ol><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es keine Person gibt (oder es weit weg ist) - Navigation durch den Raum:</font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn auf beiden Seiten keine Hindernisse vorhanden sind, fahren Sie vorw√§rts (wenn das Gesicht gefunden wurde, sich aber als zu weit herausgestellt hat, geht der Roboter zu der Person).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich auf beiden Seiten Hindernisse befinden, drehen Sie den Bereich nach dem Zufallsprinzip </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich das Hindernis nur auf einer Seite befindet, drehen Sie es in einem zuf√§lligen Winkel in die entgegengesetzte Richtung </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.815ex" height="2.634ex" viewBox="0 -809.3 2503.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5D" x="2225" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">[0, 90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Vorw√§rtsbewegung zu lange andauert (m√∂glicherweise stecken bleibt), ziehen Sie sich ein wenig zur√ºck und drehen Sie den Bereich nach dem Zufallsprinzip </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiBqTSRLOriAsk2JYsNP-tgd5Nynw#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;; </font></font></li>
</ol><br>
 </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Algorithmus behauptet nicht, eine starke k√ºnstliche Intelligenz zu sein. Zuf√§lliges Verhalten und ein breiter Sto√üf√§nger erm√∂glichen es dem Roboter jedoch, fr√ºher oder sp√§ter aus fast jeder Position herauszukommen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotz seiner offensichtlichen Einfachheit deckt dieses Projekt viele nicht triviale Themen ab: Arbeiten mit analogen Sensoren, Arbeiten mit PWM, Computer Vision, Koordination asynchroner Aufgaben. </font><font style="vertical-align: inherit;">Au√üerdem macht es einfach wahnsinnig Spa√ü. </font><font style="vertical-align: inherit;">Wahrscheinlich werde ich weiter etwas Bedeutenderes tun, aber mehr mit einer Tendenz zum tiefen Lernen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Bonus - die Galerie:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/el/cw/jd/elcwjdoa21liogjvhakstzg-yru.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/il/12/fp/il12fpucbbreblnwyb2ojwsfmwu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/3w/kr/7m/3wkr7mfjqjo2b_f9kvekia82ztq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z4/3q/wr/z43qwrmlfgwndbi3dw-jnvxzqew.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500140/index.html">"Bis zu 10 Tausend": mehr als 25 Bewertungen von Kopfh√∂rern</a></li>
<li><a href="../de500142/index.html">Rechte auf Einrichtungsebene verwalten</a></li>
<li><a href="../de500144/index.html">David O'Brien (Xirus): Metriken! Metriken! Metriken! Teil 1</a></li>
<li><a href="../de500146/index.html">Jobsuche in Deutschland als Produktmanager und mehr. Teil 3/5. Was Sie tun m√ºssen, bevor Sie Lebensl√§ufe versenden</a></li>
<li><a href="../de500148/index.html">Mikrotik-Firewall-Filter: Skript, das die Grundlage f√ºr eine Filterrichtlinie generiert</a></li>
<li><a href="../de500152/index.html">Wie ich POS-Terminal und FR IKKM-Touch in 1C: Enterprise integriert habe</a></li>
<li><a href="../de500154/index.html">Vertrauliches maschinelles Lernen. PySyft-Bibliothek</a></li>
<li><a href="../de500158/index.html">SwiftUI-Interaktion mit Redux</a></li>
<li><a href="../de500160/index.html">Visuelle Elemente</a></li>
<li><a href="../de500162/index.html">Tolles Tutorial zur Verarbeitung von Python-Sportdaten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>