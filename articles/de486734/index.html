<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍾 🏓 🍋 Reine Architektur mit Typescript: DDD und Layered Architecture 🕳️ 👃🏿 🤦🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Vor kurzem habe ich der Architektur viel Aufmerksamkeit geschenkt und beschlossen, eine Übersetzung des Artikels Saubere Architektur mit T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Reine Architektur mit Typescript: DDD und Layered Architecture</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486734/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font><font style="vertical-align: inherit;">Vor kurzem habe ich der Architektur viel Aufmerksamkeit geschenkt und beschlossen, eine Übersetzung des Artikels </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saubere Architektur mit Typoskript: DDD, Zwiebel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">André Bazaglia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der Community zu teilen </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seit über 6 Jahren meiner Berufserfahrung hatte ich die Möglichkeit, in coolen Technologieunternehmen zu arbeiten, die viel Wert auf hohe Verfügbarkeit und Codequalität legen. </font><font style="vertical-align: inherit;">Ich musste mich mit kritischen Situationen auseinandersetzen, in denen Fehler oder sogar eine zweite Ausfallzeit des Systems nicht akzeptabel waren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Zweck dieses Artikels ist nicht eine detaillierte Beschreibung komplexer Themen zu DDD und Layered Architecture, sondern ein Beispiel für die Implementierung dieser beiden Ansätze in Typescript. </font><font style="vertical-align: inherit;">Das verwendete Projekt ist grundlegend und kann beispielsweise mithilfe des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CQRS-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ansatzes verfeinert und erweitert werden </font><font style="vertical-align: inherit;">.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum DDD?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellte Softwareprodukte müssen die festgelegten Geschäftsanforderungen implementieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz vereinfacht das Testen der Domänenschicht, wodurch sichergestellt werden kann, dass alle Geschäftsanforderungen berücksichtigt werden, und langlebiger, fehlersicherer Code geschrieben wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DDD in Kombination mit einer mehrschichtigen Architektur vermeidet den Dominoeffekt, wenn das Ändern des Codes an einer Stelle zu unzähligen Fehlern an verschiedenen Stellen führt.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum geschichtete Architektur?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz passt gut zu DDD, da das gesamte System um ein Domänenmodell herum aufgebaut ist, das der mittlere Kreis im Bild unten ist. Die inneren Schichten sind nicht direkt von den äußeren abhängig und werden durch Injektion verwendet. Darüber hinaus erhalten wir eine hervorragende Flexibilität, sodass jede Schicht ihren eigenen Verantwortungsbereich hat und die eingehenden Daten von jeder Schicht entsprechend ihren Anforderungen validiert werden. Daher erhalten innere Schichten immer gültige Daten von äußeren Schichten. Ganz zu schweigen vom Testen: Das Testen von Einheiten wird mithilfe von Abhängigkeitsmobs, die auf Schnittstellen basieren, einfacher, sodass Sie von externen Teilen des Systems, wie z. B. Datenbanken, abstrahieren können. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/at/ex/qsatexfqebsdg9n1gwlnga_vuuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Fall von Typescript und Javascript </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inversion der Kontrolle (über Dependency Inversion)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bedeutet das Einbetten (Übergeben) von Abhängigkeiten durch Parameter anstelle des expliziten Imports. </font><font style="vertical-align: inherit;">Im folgenden Codebeispiel verwenden wir die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inversify-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek </font><font style="vertical-align: inherit;">, mit der wir Abhängigkeiten mithilfe von Dekoratoren beschreiben können, sodass später erstellte Klassen dynamisch Container zum Auflösen von Abhängigkeiten </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">erstellen</font></a><font style="vertical-align: inherit;"> können.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Architektur</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für diese einfache Anwendung ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen eine einfache Warenkorbanwendung, mit der Produkte zum Warenkorb hinzugefügt werden können. </font><font style="vertical-align: inherit;">Ein Warenkorb kann mehrere Geschäftsregeln haben, z. B. eine minimale oder maximale Menge für jeden Artikel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns in die Tiefen der Anwendungsebenen eintauchen, mit der innersten Ebene beginnen und nacheinander nach außen gehen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Domänenschicht ist per Definition der Lebensraum für Geschäftsregeln. Es weiß nichts über externe Schichten, hat keine Abhängigkeiten und kann leicht getestet werden. Selbst wenn Sie die gesamte Anwendung ändern, bleibt die Domain unberührt, da sie nur Geschäftsregeln enthält, die verfügbar sind, um ihren Zweck für alle zu verstehen, die diesen Code lesen. Diese Schicht sollte so weit wie möglich mit Tests bedeckt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben also eine Entity-Basisklasse, die bestimmte Logik enthalten kann, die allen Domänenklassen gemeinsam ist. In diesem Beispiel besteht die allgemeine Logik darin, eine kollisionssichere Kennung zu generieren, die für die horizontale Skalierung geeignet ist, und alle Objekte verwenden diesen Ansatz.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> abstract <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entity</span>&lt;<span class="hljs-title">T</span>&gt; </span>{<font></font>
  protected readonly _id: string<font></font>
  protected props: T<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(props: T, id?: string) {
    <span class="hljs-keyword">this</span>._id = id ? id : UniqueEntityID()
    <span class="hljs-keyword">this</span>.props = props<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// other common methods here...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Schreiben der Entity-Klasse können Sie mit der Erstellung unserer zentralen Domänenklasse beginnen, die die abstrakte Entity-Klasse erweitert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dieser Klasse gibt es nichts sehr Kompliziertes, aber es gibt einige interessante Punkte, auf die Sie achten sollten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens ist der Konstruktor privat, was bedeutet, dass das Ausführen von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new Cart ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einen Fehler verursacht, den wir benötigen. In DDD wird empfohlen, ein Domänenobjekt immer in einem gültigen Zustand zu halten. Anstatt direkt ein leeres Cart-Objekt zu erstellen, verwenden wir das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Factory-Muster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies gibt die fertige Instanz der Cart-Klasse zurück. Um sicherzustellen, dass der Erstellungsvorgang alle erforderlichen Attribute erhalten hat, können sie validiert werden. In ähnlicher Weise werden Getter und Setter verwendet, um mit der Domäne zu interagieren. Aus diesem Grund wird der interne Status der Klasse in einem privaten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitenobjekt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gespeichert </font><font style="vertical-align: inherit;">. Getter bieten Lesezugriff auf Attribute, die öffentlich sein sollten. In ähnlicher Weise können Sie mit öffentlichen Setzern und anderen Methoden die Domäne mit einer konstanten Garantie für die Gültigkeit des Status des Objekts ändern. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassend können wir einen wichtigen Punkt hervorheben: Die Domänenlogik sollte sich auf das Verhalten und nicht auf Eigenschaften konzentrieren.</font></font></b><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Entity</span>&lt;<span class="hljs-title">ICartProps</span>&gt; </span>{<font></font>
  private <span class="hljs-keyword">constructor</span>({ id, ...data }: ICartProps) {
    <span class="hljs-keyword">super</span>(data, id)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">static</span> create(props: ICartProps): Cart {
    <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> Cart(props)
    <span class="hljs-keyword">return</span> instance<font></font>
  }<font></font>
<font></font>
  public unmarshal(): UnmarshalledCart {<font></font>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: <span class="hljs-keyword">this</span>.id,
      <span class="hljs-attr">products</span>: <span class="hljs-keyword">this</span>.products.map(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> ({
        <span class="hljs-attr">item</span>: product.item.unmarshal(),
        <span class="hljs-attr">quantity</span>: product.quantity<font></font>
      })),<font></font>
      <span class="hljs-attr">totalPrice</span>: <span class="hljs-keyword">this</span>.totalPrice<font></font>
    }<font></font>
  }<font></font>
<font></font>
  private <span class="hljs-keyword">static</span> validQuantity(quantity: number) {
    <span class="hljs-keyword">return</span> quantity &gt;= <span class="hljs-number">1</span> &amp;&amp; quantity &lt;= <span class="hljs-number">1000</span><font></font>
  }<font></font>
<font></font>
  private setProducts(products: CartItem[]) {<font></font>
    <span class="hljs-keyword">this</span>.props.products = products<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">id</span>(): <span class="hljs-title">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._id<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">products</span>(): <span class="hljs-title">CartItem</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.props.products<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">get</span> <span class="hljs-title">totalPrice</span>(): <span class="hljs-title">number</span> {
    <span class="hljs-keyword">const</span> cartSum = <span class="hljs-function">(<span class="hljs-params">acc: number, product: CartItem</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> acc + product.item.price * product.quantity<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.products.reduce(cartSum, <span class="hljs-number">0</span>)<font></font>
  }<font></font>
<font></font>
  public add(item: Item, <span class="hljs-attr">quantity</span>: number) {
    <span class="hljs-keyword">if</span> (!Cart.validQuantity(quantity)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(
        <span class="hljs-string">'SKU needs to have a quantity between 1 and 1000'</span><font></font>
      )<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> index = <span class="hljs-keyword">this</span>.products.findIndex(
      <span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.item.sku === item.sku<font></font>
    )<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">-1</span>) {
      <span class="hljs-keyword">const</span> product = {<font></font>
        ...this.products[index],<font></font>
        <span class="hljs-attr">quantity</span>: <span class="hljs-keyword">this</span>.products[index].quantity + quantity<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (!Cart.validQuantity(product.quantity)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(<span class="hljs-string">'SKU exceeded allowed quantity'</span>)<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">const</span> products = [<font></font>
        ...this.products.slice(<span class="hljs-number">0</span>, index),<font></font>
        product,<font></font>
        ...this.products.slice(index + <span class="hljs-number">1</span>)<font></font>
      ]<font></font>
<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setProducts(products)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">const</span> products = [...this.products, { item, quantity }]
    <span class="hljs-keyword">this</span>.setProducts(products)<font></font>
  }<font></font>
<font></font>
  public remove(itemId: string) {<font></font>
    <span class="hljs-keyword">const</span> products = <span class="hljs-keyword">this</span>.products.filter(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.item.id !== itemId)
    <span class="hljs-keyword">this</span>.setProducts(products)
    <span class="hljs-keyword">this</span>.emitCartMutation()<font></font>
  }<font></font>
<font></font>
  public empty() {<font></font>
    <span class="hljs-keyword">this</span>.setProducts([])<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während unser Cart-Objekt von der Anwendung mithilfe von Domänenmethoden verwendet werden kann, müssen wir es in einigen Fällen möglicherweise in einem sauberen Objekt "bereitstellen". </font><font style="vertical-align: inherit;">Zum Beispiel, um in der Datenbank zu speichern oder als JSON-Objekt an den Client zu senden. </font><font style="vertical-align: inherit;">Dies kann mit der Methode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unmarshal ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementiert werden </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Flexibilität der Architektur zu erhöhen, kann die Domänenschicht auch eine Quelle für Domänenereignisse werden. </font><font style="vertical-align: inherit;">Hier kann der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Event-Sourcing-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ansatz angewendet werden </font><font style="vertical-align: inherit;">, bei dem Ereignisse erstellt werden, wenn sich Domänenentitäten ändern.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzerskripte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier werden Domänenmethoden und Objekte verwendet, die auf Infrastrukturebene implementiert wurden, um Daten zu speichern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inversify-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek </font><font style="vertical-align: inherit;">, um den Inversion of Management-Ansatz zu implementieren, der das Repository von der Infrastrukturschicht in dieses Szenario </font><b><font style="vertical-align: inherit;">einfügt</font></b><font style="vertical-align: inherit;"> und uns die Möglichkeit bietet, den Warenkorb mithilfe von Domänenmethoden zu bearbeiten und anschließend Änderungen an der Datenbank zu speichern.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { inject, injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'inversify'</span><font></font>
<font></font>
@injectable()<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartService</span> </span>{<font></font>
  @inject(TYPES.CartRepository) private repository: CartRepository<font></font>
<font></font>
  private <span class="hljs-keyword">async</span> _getCart(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.repository.getById(id)
      <span class="hljs-keyword">return</span> cart<font></font>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">const</span> emptyCart = Cart.create({ id, <span class="hljs-attr">products</span>: [] })
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.create(emptyCart)<font></font>
    }<font></font>
  }<font></font>
<font></font>
  public getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.getById(id)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">async</span> add(cartId: string, <span class="hljs-attr">item</span>: Item, <span class="hljs-attr">sku</span>: number): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._getCart(cartId)<font></font>
    cart.add(item, sku)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.update(cart)<font></font>
  }<font></font>
<font></font>
  public <span class="hljs-keyword">async</span> remove(cartId: string, <span class="hljs-attr">itemId</span>: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._getCart(cartId)<font></font>
    cart.remove(itemId)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repository.update(cart)<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Schicht ist für den Betrieb der Anwendung verantwortlich. </font><font style="vertical-align: inherit;">Codeänderungen an dieser Ebene wirken sich nicht auf Domänenentitäten oder externe Abhängigkeiten wie eine Datenbank aus.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastruktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotz aller Offensichtlichkeit interagiert die Infrastrukturschicht mit externen Systemen wie einer Datenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Daten in der Datenbank zu speichern, verwende ich die Ansätze Data Mapper und Repository. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mapper kann die Quelldaten aus der Datenbank abrufen und in das entsprechende Domänenobjekt konvertieren:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Cart, CartItem } <span class="hljs-keyword">from</span> <span class="hljs-string">'src/domain/cart'</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> getProducts = <span class="hljs-function">(<span class="hljs-params">products: CartItem[]</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> products.map(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> ({
    <span class="hljs-attr">item</span>: product.item,
    <span class="hljs-attr">quantity</span>: product.quantity<font></font>
  }))<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartMapper</span> </span>{<font></font>
  public <span class="hljs-keyword">static</span> toDomain(raw: any): Cart {
    <span class="hljs-keyword">return</span> Cart.create({
      <span class="hljs-attr">id</span>: raw.id,
      <span class="hljs-attr">couponCode</span>: raw.couponCode,
      <span class="hljs-attr">products</span>: getProducts(raw.products || [])<font></font>
    })<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Repository selbst kann von der Clientbibliothek einer bestimmten Datenbank abhängen. </font><font style="vertical-align: inherit;">Zum Beispiel aus dem Speicher im RAM, und verwenden Sie diese Methoden, um Daten zu verwalten:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">'inversify'</span>
<span class="hljs-keyword">import</span> { Cart } <span class="hljs-keyword">from</span> <span class="hljs-string">'src/domain/cart'</span>
<span class="hljs-keyword">import</span> { CartMapper } <span class="hljs-keyword">from</span> <span class="hljs-string">'../mappers/cart'</span><font></font>
<font></font>
interface ICartRepository {<font></font>
  getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
  create(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
  update(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt;<font></font>
}<font></font>
<font></font>
@injectable()<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartRepository</span> <span class="hljs-title">implements</span> <span class="hljs-title">ICartRepository</span> </span>{<font></font>
  @inject(TYPES.Database) private _database: MemoryData<font></font>
<font></font>
  <span class="hljs-keyword">async</span> getById(id: string): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> cart = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.getById(id)
    <span class="hljs-keyword">if</span> (!cart) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ResourceNotFound(<span class="hljs-string">'Cart'</span>, { id })<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> CartMapper.toDomain(cart)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> create(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> dtoCart = cart.unmarshal()
    <span class="hljs-keyword">const</span> inserted = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.insert(dtoCart)
    <span class="hljs-keyword">return</span> CartMapper.toDomain(inserted)<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">async</span> update(cart: Cart): <span class="hljs-built_in">Promise</span>&lt;Cart&gt; {
    <span class="hljs-keyword">const</span> dtoCart = cart.unmarshal()
    <span class="hljs-keyword">const</span> updated = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>._database.cart.update(cart.id, dtoCart)
    <span class="hljs-keyword">return</span> CartMapper.toDomain(updated)<font></font>
  }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viel Raum für Verbesserungen und Verbesserungen. </font><font style="vertical-align: inherit;">Der Code wurde für diese visuelle Demonstration erstellt. Die erste Verbesserung der Schichtarchitektur könnte die Ankündigung der Deklaration der Repository-Schnittstelle in der Domänenschicht und deren Implementierung in der Infrastrukturschicht sein, die wir beim nächsten Mal diskutieren können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Quellcode ist auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfügbar </font><font style="vertical-align: inherit;">.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486714/index.html">Instagram API mindestens</a></li>
<li><a href="../de486716/index.html">Was macht die Moscow Exchange Free API auf Google Sheets?</a></li>
<li><a href="../de486722/index.html">Statische Sicherheitsprüfung mit Open Source Tools</a></li>
<li><a href="../de486726/index.html">Diagnose von Netzwerkverbindungen auf einem virtuellen EDGE-Router</a></li>
<li><a href="../de486728/index.html">Deutsche Datenschutzbehörde: Telemetrie in Windows 10 1909 Enterprise kann vollständig deaktiviert werden</a></li>
<li><a href="../de486736/index.html">So erhöhen Sie die Decodierungsgeschwindigkeit eines Videostreams in FFmpeg</a></li>
<li><a href="../de486738/index.html">PHP-Code-Stil-Konventionen</a></li>
<li><a href="../de486740/index.html">Schreiben einer API in Rust mithilfe von prozeduralen Makros</a></li>
<li><a href="../de486742/index.html">Interview mit Anatoly Wasserman über die Zukunft</a></li>
<li><a href="../de486744/index.html">Ein intelligenter, inländischer Haltungskorrektor wurde zum Verkauf angeboten. Wir haben uns das neue Produkt - IBACK - angesehen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>