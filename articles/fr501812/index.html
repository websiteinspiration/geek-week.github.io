<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏿 ✍🏽 👧🏽 Bot de pagination de télégramme Python 🤔 🏑 🚵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Récemment, j'ai eu la tâche de paginer une liste d'éléments dans un bot de télégramme. Et elle a été surprise de constater que pour une tâche aussi ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bot de pagination de télégramme Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501812/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récemment, j'ai eu la tâche de paginer une liste d'éléments dans un bot de télégramme. </font><font style="vertical-align: inherit;">Et elle a été surprise de constater que pour une tâche aussi apparemment typique, PyPi n'a pas une seule bibliothèque. </font><font style="vertical-align: inherit;">Par conséquent, il a été décidé de corriger cette omission ennuyeuse et de publier sa mise en œuvre.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez installer le package depuis PyPi en exécutant dans la console:</font></font></p><br>
<pre><code class="bash hljs">pip install python-telegram-bot-pagination</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe InlineKeyboardPaginator du package telegram_bot_pagination facilite l'obtention d'un ensemble de boutons en ligne pour naviguer dans les pages de liste. </font><font style="vertical-align: inherit;">Il est nécessaire de transférer au constructeur le nombre de pages dans lesquelles la liste des éléments est divisée, ainsi que la page actuelle et le modèle pour générer les données retournées en appuyant sur le bouton bot. </font><font style="vertical-align: inherit;">Après cela, le paginateur lui-même formera le clavier nécessaire, qui sera disponible via la propriété de balisage.</font></font></p><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> telegram_bot_pagination <span class="hljs-keyword">import</span> InlineKeyboardPaginator<font></font>
<font></font>
paginator = InlineKeyboardPaginator(<font></font>
        <span class="hljs-number">10</span>,<font></font>
        current_page=<span class="hljs-number">1</span>,<font></font>
        data_pattern=<span class="hljs-string">'elements#{page}'</span>
    )</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, paginator.markup renverra un objet json pour le champ reply_markup de la méthode API sendMessage Telegram Bot. </font><font style="vertical-align: inherit;">Dans ce cas, cinq boutons seront formés. </font><font style="vertical-align: inherit;">Si le nombre de pages est de cinq ou moins, alors les boutons seront en conséquence. </font><font style="vertical-align: inherit;">S'il n'y a qu'une seule page, le balisage sera vide. </font><font style="vertical-align: inherit;">S'il y a plus de cinq pages, le clavier contiendra 5 boutons pour:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">première page;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page précédente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page actuelle;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page suivante;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dernière page.</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, s'il existe un tableau de pages de caractères contenant des descriptions de personnages de Harry Potter pour créer un bot qui affiche une liste de caractères, nous avons besoin d'une fonction qui envoie la page de liste actuelle:</font></font></p><br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_character_page</span>(<span class="hljs-params">message, page=<span class="hljs-number">1</span></span>):</span><font></font>
    paginator = InlineKeyboardPaginator(<font></font>
        len(character_pages),<font></font>
        current_page=page,<font></font>
        data_pattern=<span class="hljs-string">'character#{page}'</span><font></font>
    )<font></font>
<font></font>
    bot.send_message(<font></font>
        message.chat.id,<font></font>
        character_pages[page<span class="hljs-number">-1</span>],<font></font>
        reply_markup=paginator.markup,<font></font>
        parse_mode=<span class="hljs-string">'Markdown'</span>
    )</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et le gestionnaire de boutons dans le bot:</font></font></p><br>
<pre><code class="python hljs">
<span class="hljs-meta">@bot.callback_query_handler(func=lambda call: call.data.split('#')[0]=='character')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">characters_page_callback</span>(<span class="hljs-params">call</span>):</span>
    page = int(call.data.split(<span class="hljs-string">'#'</span>)[<span class="hljs-number">1</span>])<font></font>
    bot.delete_message(<font></font>
        call.message.chat.id,<font></font>
        call.message.message_id<font></font>
    )<font></font>
    send_character_page(call.message, page)<font></font>
</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'exemple utilise pyTelegramBotAPI pour travailler avec le bot.</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'exemple de code complet se trouve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le résultat, selon le nombre d'entrées dans la liste, ressemblera à ceci:</font></font></p><br>
<p><img src="https://habrastorage.org/webt/ql/c9/_t/qlc9_t6jziecxi7nnhgasn_rmlo.png"></p><br>
<p><img src="https://habrastorage.org/webt/na/us/ut/nausutgts_d96lpmy_9oqhual4y.png"></p><br>
<p><img src="https://habrastorage.org/webt/7k/o7/xw/7ko7xw3169bgtdh4evx4gu7jsas.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci pour l'attention. </font><font style="vertical-align: inherit;">Je serai heureux de toute critique constructive.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr501800/index.html">Une petite session osinta sur la modernisation et la production de systèmes de radiocommunication pour les forces armées</a></li>
<li><a href="../fr501804/index.html">Dard. Tout ce que vous devez savoir sur les constantes</a></li>
<li><a href="../fr501806/index.html">ACS: problèmes, solutions et gestion des risques de sécurité</a></li>
<li><a href="../fr501808/index.html">La liste des changements dans D 2.092. Emprunter Emprunter</a></li>
<li><a href="../fr501810/index.html">Tireurs 3D sympas sur un ancien ordinateur portable: un test de la plate-forme de jeux en nuage GFN.RU</a></li>
<li><a href="../fr501814/index.html">Changements COVID: histoires des membres de StartupDrive qui ont changé et sont devenues plus fortes pendant une pandémie</a></li>
<li><a href="../fr501820/index.html">Intégration des solutions de surveillance Netflow et SIEM</a></li>
<li><a href="../fr501822/index.html">Ingénieur de troisième génération</a></li>
<li><a href="../fr501824/index.html">Se préparer pour un hackathon à la maison</a></li>
<li><a href="../fr501826/index.html">À propos des fondateurs ambitieux ou comment j'ai essayé de collecter des investissements pour une startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>