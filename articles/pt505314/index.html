<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèº üñ≤Ô∏è ‚èπÔ∏è Sincroniza√ß√£o de hora do Linux: NTP, Chrony e systemd-timesyncd ‚ú°Ô∏è üßöüèΩ üì§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A maioria das pessoas mant√©m a no√ß√£o do tempo. N√≥s acordamos a tempo de realizar nossos rituais matinais e vamos trabalhar, fazemos uma pausa para o a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sincroniza√ß√£o de hora do Linux: NTP, Chrony e systemd-timesyncd</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/505314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/ts/k3/m-tsk33gxcmkrlh4yuqdaxl4ytk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria das pessoas mant√©m a no√ß√£o do tempo. </font><font style="vertical-align: inherit;">N√≥s acordamos a tempo de realizar nossos rituais matinais e vamos trabalhar, fazemos uma pausa para o almo√ßo, cumprimos os prazos do projeto, comemoramos anivers√°rios e feriados, entramos em um avi√£o e assim por diante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso: alguns de n√≥s s√£o obcecados com o tempo. </font><font style="vertical-align: inherit;">Meu rel√≥gio √© alimentado por energia solar e recebe um hor√°rio preciso do Instituto Nacional de Padr√µes e Tecnologia ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) em Fort Collins, Colorado, via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√°dio de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> longo comprimento de onda </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">da WWVB</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Os sinais de tempo s√£o sincronizados com o rel√≥gio at√¥mico, tamb√©m localizado em Fort Collins. </font><font style="vertical-align: inherit;">Meu Fitbit sincroniza com meu telefone, que sincroniza com o servidor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que finalmente sincroniza com o rel√≥gio at√¥mico.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os dispositivos tamb√©m acompanham o tempo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° muitas raz√µes pelas quais nossos dispositivos e computadores precisam de tempo preciso. Por exemplo, em bancos, bolsas de valores e outras empresas financeiras, as transa√ß√µes devem ser executadas na ordem correta, e seq√º√™ncias de tempo precisas s√£o cr√≠ticas para isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossos telefones, tablets, carros, sistemas de GPS e computadores exigem configura√ß√µes precisas de data e hora. Quero que o rel√≥gio na √°rea de trabalho do meu computador mostre a hora correta. Quero que meu calend√°rio local tenha lembretes no momento certo. O hor√°rio correto tamb√©m garante que os trabalhos cron e systemd sejam iniciados no momento certo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A data e a hora tamb√©m s√£o importantes para o registro, por isso √© um pouco mais f√°cil encontrar determinados registros com base na data e hora. </font><font style="vertical-align: inherit;">Por exemplo, eu trabalhei no DevOps (eles n√£o o chamavam naquela √©poca) e configurei um sistema de e-mail na Carolina do Norte. </font><font style="vertical-align: inherit;">Costum√°vamos processar mais de 20 milh√µes de e-mails por dia. </font><font style="vertical-align: inherit;">O rastreamento de emails por meio de uma s√©rie de servidores ou a determina√ß√£o da seq√º√™ncia exata de eventos usando arquivos de log em hosts geograficamente dispersos pode ser muito mais f√°cil se os computadores forem sincronizados a tempo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma vez - muitas horas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os hosts Linux devem estar cientes de que h√° uma hora do sistema e uma hora RTC. RTC (Real Time Clock) √© um nome um pouco estranho e pouco preciso para um rel√≥gio de hardware. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rel√≥gio do hardware funciona continuamente, mesmo quando o computador √© desligado usando a bateria na placa-m√£e do sistema. A principal fun√ß√£o do RTC √© armazenar o hor√°rio em que a conex√£o com o servidor de hor√°rio n√£o est√° dispon√≠vel. Naqueles dias em que era imposs√≠vel conectar-se ao servidor de hor√°rio via Internet, cada computador tinha que ter um rel√≥gio interno preciso. Os sistemas operacionais precisavam acessar o RTC no momento da inicializa√ß√£o e o usu√°rio precisava definir manualmente a hora do sistema usando a interface de configura√ß√£o do BIOS do hardware para garantir que estava correta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os rel√≥gios de hardware n√£o entendem o conceito de fuso hor√°rio; </font><font style="vertical-align: inherit;">O RTC armazena apenas a hora, n√£o o fuso hor√°rio ou o deslocamento do UTC (Hor√°rio Universal Coordenado, tamb√©m conhecido como GMT ou Hor√°rio de Greenwich). </font><font style="vertical-align: inherit;">Voc√™ pode instalar o RTC usando a ferramenta, que discutirei mais adiante neste artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hora do sistema √© a hora que o sistema operacional exibe no rel√≥gio da GUI na √°rea de trabalho, na sa√≠da do comando date, nos registros de data e hora dos logs. </font><font style="vertical-align: inherit;">Isso tamb√©m se aplica ao hor√°rio em que os arquivos foram criados, modificados e abertos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A p√°gina do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manual rtc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tem uma descri√ß√£o completa do RTC e do rel√≥gio do sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que o NTP tem?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Computadores em todo o mundo usam o NTP (Network Time Protocol) para sincronizar seu tempo com rel√≥gios de refer√™ncia padr√£o pela Internet usando uma hierarquia de servidores NTP. Os principais servidores de hor√°rio est√£o localizados no n√≠vel 1 e est√£o diretamente conectados a v√°rios servi√ßos de hor√°rio nacional no n√≠vel 0 via sat√©lite, r√°dio ou mesmo modems atrav√©s de linhas telef√¥nicas. Os servi√ßos de tempo no n√≠vel 0 podem ser um rel√≥gio at√¥mico, um receptor de r√°dio sintonizado com os sinais transmitidos pelo rel√≥gio at√¥mico ou um receptor GPS usando sinais de rel√≥gio de alta precis√£o transmitidos por sat√©lites GPS.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na grande maioria dos servidores de refer√™ncia, v√°rios milhares de servidores p√∫blicos NTP stratum 2 est√£o abertos, dispon√≠veis para todos. </font><font style="vertical-align: inherit;">Muitas organiza√ß√µes e usu√°rios (incluindo eu) com um grande n√∫mero de hosts que exigem um servidor NTP preferem instalar seus pr√≥prios servidores de hor√°rio, portanto, apenas um host local chama o estrato 2 ou 3. Em seguida, eles configuram os n√≥s restantes na rede para usar o servidor de hor√°rio local . </font><font style="vertical-align: inherit;">No caso da minha rede dom√©stica, este √© um servidor de n√≠vel 3.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°rias implementa√ß√µes de NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A implementa√ß√£o inicial do NTP √© ntpd. Ent√£o dois novos se juntaram a ela, chronyd e systemd-timesyncd. Todos os tr√™s sincronizam o hor√°rio do host local com o servidor de hor√°rio NTP. O servi√ßo systemd-timesyncd n√£o √© t√£o confi√°vel quanto o chronyd, mas √© suficiente para a maioria dos prop√≥sitos. Se o RTC n√£o estiver sincronizado, ele poder√° ajustar gradualmente a hora do sistema para sincronizar com o servidor NTP quando a hora local do sistema for ligeiramente alterada. O servi√ßo systemd-timesync n√£o pode ser usado como um servidor de hor√°rio. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Chrony</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma implementa√ß√£o do NTP que cont√©m dois programas: o daemon chronyd e uma interface de linha de comando chamada chronyc. O Chrony possui alguns recursos que, em muitos casos, s√£o simplesmente insubstitu√≠veis:</font></font><br>
<br>
<ul>
<li>Chrony       ,    ntpd.       ,    .</li>
<li>     , ,           ,      -   ,       .</li>
<li>    ,        .</li>
<li>    .</li>
<li>    Chrony    .             .</li>
<li>Chrony       .          .</li>
<li>Chrony     NTP-.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais uma vez: NTP √© um protocolo que pode ser implementado em um host Linux usando Chrony ou systemd-timesyncd. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os pacotes RPM NTP, Chrony e systemd-timesyncd est√£o dispon√≠veis nos reposit√≥rios padr√£o do Fedora. </font><font style="vertical-align: inherit;">O RPM systemd-udev √© um gerenciador de eventos do kernel instalado por padr√£o no Fedora, mas n√£o √© necess√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode instalar os tr√™s e alternar entre eles, mas isso criar√° uma dor de cabe√ßa extra. </font><font style="vertical-align: inherit;">Ent√£o √© melhor n√£o. </font><font style="vertical-align: inherit;">As vers√µes atuais do Fedora, CentOS e RHEL migraram para o Chrony como uma implementa√ß√£o padr√£o e tamb√©m possuem systemd-timesyncd. </font><font style="vertical-align: inherit;">Acredito que o Chrony funcione bem, forne√ßa uma interface melhor que o servi√ßo NTP, forne√ßa muito mais informa√ß√µes e aumente o controle, do qual os administradores de sistema certamente apreciar√£o.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desativando servi√ßos NTP </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seu host j√° pode ter o servi√ßo NTP em execu√ß√£o. </font><font style="vertical-align: inherit;">Nesse caso, voc√™ precisa desativ√°-lo antes de mudar para outra coisa. </font><font style="vertical-align: inherit;">Eu tinha o chronyd em execu√ß√£o, ent√£o usei os seguintes comandos para par√°-lo e desativ√°-lo. </font><font style="vertical-align: inherit;">Execute os comandos apropriados para qualquer daemon NTP usado em seu host:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl disable chronyd ; systemctl stop chronyd</span><font></font>
Removed /etc/systemd/system/multi-user.target.wants/chronyd.service.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique se o servi√ßo est√° parado e desabilitado:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status chronyd</span><font></font>
‚óè chronyd.service - NTP client/server<font></font>
     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; disabled; vendor preset: enabled)<font></font>
     Active: inactive (dead)<font></font>
       Docs: man:chronyd(8)<font></font>
             man:chrony.conf(5)<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique o status antes do lan√ßamento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O status da sincroniza√ß√£o do rel√≥gio do sistema permite determinar se o servi√ßo NTP est√° em execu√ß√£o. </font><font style="vertical-align: inherit;">Como voc√™ ainda n√£o iniciou o NTP, o comando timesync-status indicar√° isso:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl timesync-status</span>
Failed to query server: Could not activate remote peer.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solicita√ß√£o de status direta fornece informa√ß√µes importantes. </font><font style="vertical-align: inherit;">Por exemplo, o comando timedatectl sem argumento ou par√¢metro executa o subcomando de status padr√£o:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># timedatectl status</span><font></font>
           Local time: Fri 2020-05-15 08:43:10 EDT  <font></font>
           Universal time: Fri 2020-05-15 12:43:10 UTC  <font></font>
                 RTC time: Fri 2020-05-15 08:43:08      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: no                          <font></font>
              NTP service: inactive                    <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes                    <font></font>
<font></font>
Warning: The system is configured to <span class="hljs-built_in">read</span> the RTC time <span class="hljs-keyword">in</span> the <span class="hljs-built_in">local</span> time zone.<font></font>
         This mode cannot be fully supported. It will create various problems<font></font>
         with time zone changes and daylight saving time adjustments. The RTC<font></font>
         time is never updated, it relies on external facilities to maintain it.<font></font>
         If at all possible, use RTC <span class="hljs-keyword">in</span> UTC by calling
         <span class="hljs-string">'timedatectl set-local-rtc 0'</span>.<font></font>
[root@testvm1 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, voc√™ obt√©m a hora local do seu host, a hora UTC e a hora RTC. Nesse caso, a hora do sistema √© definida para o fuso hor√°rio America / New_York (TZ), o RTC √© definido para a hora no fuso hor√°rio local e o servi√ßo NTP n√£o est√° ativo. O tempo do RTC come√ßou a se desviar um pouco do tempo do sistema. Isso √© normal para sistemas cujos rel√≥gios n√£o foram sincronizados. A quantidade de deslocamento no host depende do tempo decorrido desde a √∫ltima sincroniza√ß√£o do sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m recebemos um aviso sobre o uso da hora local para o RTC - isso se aplica a altera√ß√µes nas configura√ß√µes de fuso hor√°rio e hor√°rio de ver√£o. </font><font style="vertical-align: inherit;">Se o computador estiver desligado no momento em que for necess√°rio fazer altera√ß√µes, o tempo do RTC n√£o ser√° alterado. </font><font style="vertical-align: inherit;">Mas, para servidores ou outros hosts que funcionam o tempo todo, isso n√£o √© um problema. </font><font style="vertical-align: inherit;">Al√©m disso, qualquer servi√ßo que forne√ßa sincroniza√ß√£o de hor√°rio NTP ajustar√° o hor√°rio do host no est√°gio inicial da inicializa√ß√£o, portanto, assim que a inicializa√ß√£o for conclu√≠da, o hor√°rio ficar√° correto novamente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configura√ß√£o de fuso hor√°rio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, voc√™ especifica o fuso hor√°rio durante o procedimento de instala√ß√£o e n√£o tem tarefa de alter√°-lo no futuro. No entanto, h√° momentos em que voc√™ precisa alterar o fuso hor√°rio. Existem v√°rias ferramentas que podem ajudar. O Linux usa arquivos de fuso hor√°rio para determinar o fuso hor√°rio local do host. Esses arquivos est√£o localizados no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diret√≥rio / usr / share / zoneinfo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por padr√£o, para o meu fuso hor√°rio, o sistema grava isso: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / localtime -&gt; ../usr/share/zoneinfo/America/New_York</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mas voc√™ n√£o precisa conhecer essas sutilezas para alterar o fuso hor√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O principal √© saber o nome oficial do fuso hor√°rio da sua localiza√ß√£o e da equipe correspondente. Digamos que voc√™ queira alterar o fuso hor√°rio para Los Angeles:</font></font><br>
<br>
<pre><code class="bash hljs">
[root@testvm2 ~]<span class="hljs-comment"># timedatectl list-timezones | column</span><font></font>
&lt;SNIP&gt;<font></font>
America/La_Paz                  Europe/Budapest<font></font>
America/Lima                    Europe/Chisinau<font></font>
America/Los_Angeles             Europe/Copenhagen<font></font>
America/Maceio                  Europe/Dublin<font></font>
America/Managua                 Europe/Gibraltar<font></font>
America/Manaus                  Europe/Helsinki<font></font>
&lt;SNIP&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode definir o fuso hor√°rio. </font><font style="vertical-align: inherit;">Usei o comando date para verificar as altera√ß√µes, mas voc√™ tamb√©m pode usar timedatectl:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 04:47:49 PM EDT<font></font>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl set-timezone America/Los_Angeles</span>
[root@testvm2 ~]<span class="hljs-comment"># date</span><font></font>
Tue 19 May 2020 01:48:23 PM PDT<font></font>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode alterar novamente o fuso hor√°rio do seu host para a hora local.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O daemon systemd timesync fornece uma implementa√ß√£o NTP que √© f√°cil de gerenciar no contexto do systemd. </font><font style="vertical-align: inherit;">Ele √© instalado por padr√£o no Fedora e Ubuntu. </font><font style="vertical-align: inherit;">No entanto, ele inicia por padr√£o apenas no Ubuntu. </font><font style="vertical-align: inherit;">N√£o tenho certeza sobre as outras distribui√ß√µes. </font><font style="vertical-align: inherit;">Voc√™ pode verificar por si mesmo:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm1 ~]<span class="hljs-comment"># systemctl status systemd-timesyncd</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando systemd-timesyncd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O arquivo de configura√ß√£o para systemd-timesyncd √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/timesyncd.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este √© um arquivo simples com menos op√ß√µes inclu√≠das do que nos antigos servi√ßos NTP e chronyd. </font><font style="vertical-align: inherit;">Aqui est√° o conte√∫do deste arquivo (sem mais altera√ß√µes) na minha m√°quina virtual Fedora:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#  This file is part of systemd.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment">#  systemd is free software; you can redistribute it and/or modify it</span>
<span class="hljs-comment">#  under the terms of the GNU Lesser General Public License as published by</span>
<span class="hljs-comment">#  the Free Software Foundation; either version 2.1 of the License, or</span>
<span class="hljs-comment">#  (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Entries in this file show the compile time defaults.</span>
<span class="hljs-comment"># You can change settings by editing this file.</span>
<span class="hljs-comment"># Defaults can be restored by simply deleting this file.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># See timesyncd.conf(5) for details.</span><font></font>
<font></font>
[Time]<font></font>
<span class="hljs-comment">#NTP=</span>
<span class="hljs-comment">#FallbackNTP=0.fedora.pool.ntp.org 1.fedora.pool.ntp.org 2.fedora.pool.ntp.org 3.fedora.pool.ntp.org</span>
<span class="hljs-comment">#RootDistanceMaxSec=5</span>
<span class="hljs-comment">#PollIntervalMinSec=32</span>
<span class="hljs-comment">#PollIntervalMaxSec=2048</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √∫nica se√ß√£o que ele cont√©m, al√©m dos coment√°rios, √© [Hora]. </font><font style="vertical-align: inherit;">Todas as outras linhas s√£o comentadas. </font><font style="vertical-align: inherit;">Esses s√£o os valores padr√£o, eles n√£o precisam ser alterados (a menos que voc√™ tenha uma raz√£o para isso). </font><font style="vertical-align: inherit;">Se voc√™ n√£o possui o servidor de hor√°rio NTP definido na linha NTP =, o Fedora usa o servidor de hor√°rio de backup do Fedora por padr√£o. </font><font style="vertical-align: inherit;">Eu costumo adicionar meu servidor de hor√°rio:</font></font><br>
<br>
<pre><code class="bash hljs">NTP=myntpserver</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempos de sincroniza√ß√£o do lan√ßamento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode iniciar e tornar systemd-timesyncd ativo assim:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># systemctl enable systemd-timesyncd.service</span><font></font>
Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
Created symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service ‚Üí /usr/lib/systemd/system/systemd-timesyncd.service.<font></font>
[root@testvm2 ~]<span class="hljs-comment"># systemctl start systemd-timesyncd.service</span>
[root@testvm2 ~]<span class="hljs-comment">#</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instala√ß√£o do rel√≥gio de hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como √© a situa√ß√£o ap√≥s o tempo de execu√ß√£oyncd:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Sat 2020-05-16 14:34:54 EDT  <font></font>
           Universal time: Sat 2020-05-16 18:34:54 UTC  <font></font>
                 RTC time: Sat 2020-05-16 14:34:53      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: no    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, a diferen√ßa entre o RTC e a hora local (EDT) n√£o excede um segundo e a discrep√¢ncia aumenta em alguns segundos nos pr√≥ximos dias. Como n√£o h√° conceito de fuso hor√°rio no RTC, o comando timedatectl deve executar uma compara√ß√£o para determinar o fuso hor√°rio desejado. Se o RTC n√£o corresponder exatamente ao hor√°rio local, ele n√£o corresponder√° ao fuso hor√°rio local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Procurando mais informa√ß√µes, verifiquei o status do systemd-timesync e encontrei o seguinte:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 systemd]<span class="hljs-comment"># systemctl status systemd-timesyncd.service</span><font></font>
‚óè systemd-timesyncd.service - Network Time Synchronization<font></font>
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service; enabled; vendor preset: disabled)<font></font>
     Active: active (running) since Sat 2020-05-16 13:56:53 EDT; 18h ago<font></font>
       Docs: man:systemd-timesyncd.service(8)<font></font>
   Main PID: 822 (systemd-timesyn)<font></font>
     Status: <span class="hljs-string">"Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org)."</span>
      Tasks: 2 (<span class="hljs-built_in">limit</span>: 10365)<font></font>
     Memory: 2.8M<font></font>
        CPU: 476ms<font></font>
     CGroup: /system.slice/systemd-timesyncd.service<font></font>
             ‚îî‚îÄ822 /usr/lib/systemd/systemd-timesyncd<font></font>
<font></font>
May 16 09:57:24 testvm2.both.org systemd[1]: Starting Network Time Synchronization...<font></font>
May 16 09:57:24 testvm2.both.org systemd-timesyncd[822]: System clock time <span class="hljs-built_in">unset</span> or jumped backwards, restoring from recorded timestamp: Sat 2020-05-16 13:56:53 EDT<font></font>
May 16 13:56:53 testvm2.both.org systemd[1]: Started Network Time Synchronization.<font></font>
May 16 13:57:56 testvm2.both.org systemd-timesyncd[822]: Initial synchronization to time server 163.237.218.19:123 (2.fedora.pool.ntp.org).<font></font>
[root@testvm2 systemd]<span class="hljs-comment">#</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preste aten√ß√£o √† mensagem de log, que indica que a hora do sistema n√£o est√° definida ou redefinida. </font><font style="vertical-align: inherit;">O servi√ßo Timesync define a hora do sistema com base em um carimbo de data / hora. </font><font style="vertical-align: inherit;">Os registros de data e hora s√£o mantidos pelo daemon timesync e s√£o criados a cada sincroniza√ß√£o bem-sucedida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O comando timedatectl n√£o pode tirar o valor do rel√≥gio do hardware do rel√≥gio do sistema. </font><font style="vertical-align: inherit;">Ela pode definir a hora e a data apenas a partir do valor digitado na linha de comando. </font><font style="vertical-align: inherit;">Voc√™ pode configurar o RTC para o mesmo valor que a hora do sistema usando o comando hwclock:</font></font><br>
<br>
<pre><code class="bash hljs">[root@testvm2 ~]<span class="hljs-comment"># /sbin/hwclock --systohc --localtime</span>
[root@testvm2 ~]<span class="hljs-comment"># timedatectl</span><font></font>
               Local time: Mon 2020-05-18 13:56:46 EDT  <font></font>
           Universal time: Mon 2020-05-18 17:56:46 UTC  <font></font>
                 RTC time: Mon 2020-05-18 13:56:46      <font></font>
                Time zone: America/New_York (EDT, -0400)<font></font>
System clock synchronized: yes                          <font></font>
              NTP service: active                      <font></font>
          RTC <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> TZ: yes</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A op√ß√£o --localtime indica que o rel√≥gio do hardware mostra a hora local, n√£o o UTC.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que voc√™ precisa do RTC?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qualquer implementa√ß√£o NTP definir√° o rel√≥gio do sistema na inicializa√ß√£o. </font><font style="vertical-align: inherit;">E ent√£o por que RTC? </font><font style="vertical-align: inherit;">Isso n√£o √© inteiramente verdade: isso s√≥ acontecer√° se voc√™ tiver uma conex√£o de rede com um servidor de hor√°rio. </font><font style="vertical-align: inherit;">No entanto, muitos sistemas n√£o t√™m acesso constante √† conex√£o de rede; portanto, o rel√≥gio do hardware √© √∫til para o Linux definir a hora do sistema com base neles. </font><font style="vertical-align: inherit;">√â melhor do que definir a hora manualmente, mesmo que ela possa se desviar do tempo real.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo discute algumas ferramentas para gerenciar data, hora e fusos hor√°rios. A ferramenta systemd-timesyncd fornece um cliente NTP que pode sincronizar a hora em um host local com um servidor NTP. No entanto, systemd-timesyncd n√£o fornece um servi√ßo de servidor, portanto, se voc√™ precisar de um servidor NTP na sua rede, dever√° usar outra coisa - por exemplo, Chrony, para trabalhar como servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu prefiro ter uma √∫nica implementa√ß√£o para qualquer servi√ßo na minha rede, ent√£o eu uso o Chrony. Se voc√™ n√£o precisa de um servidor NTP local ou se n√£o se importa em usar o Chrony como servidor e systemd-timesyncd como um cliente SNTP. Afinal, n√£o h√° necessidade de usar os recursos adicionais do Chrony como cliente se voc√™ estiver satisfeito com a funcionalidade do systemd-timesyncd.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais uma observa√ß√£o: voc√™ n√£o precisa usar as ferramentas systemd para implementar o NTP. </font><font style="vertical-align: inherit;">Voc√™ pode usar a vers√£o antiga do ntpd, Chrony ou outra implementa√ß√£o NTP. </font><font style="vertical-align: inherit;">Afinal, o systemd consiste em um grande n√∫mero de servi√ßos; </font><font style="vertical-align: inherit;">muitos deles s√£o opcionais, ent√£o voc√™ pode desativ√°-los e usar outra coisa. </font><font style="vertical-align: inherit;">Este n√£o √© um enorme monstro monol√≠tico. </font><font style="vertical-align: inherit;">Voc√™ pode n√£o gostar do systemd ou partes dele, mas deve tomar uma decis√£o informada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gosto da implementa√ß√£o do NTP no systemd, mas prefiro o Chrony porque ele atende melhor √†s minhas necessidades. </font><font style="vertical-align: inherit;">Este √© Linux, baby -)</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como an√∫ncio</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A VDSina oferece </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidores para qualquer tarefa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , uma grande variedade de sistemas operacionais para instala√ß√£o autom√°tica, √© poss√≠vel instalar qualquer sistema operacional a partir de sua pr√≥pria </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">painel de controle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conveniente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">de</font></a><font style="vertical-align: inherit;"> seu pr√≥prio design e pagamento di√°rio. </font><font style="vertical-align: inherit;">Lembre-se de que temos servidores eternos que s√£o definitivamente atemporais;)</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt505298/index.html">V√¥o do Drag√£o da Tripula√ß√£o em fotos e v√≠deo</a></li>
<li><a href="../pt505300/index.html">Ind√∫stria de petr√≥leo para engenheiros, programadores, matem√°ticos e as massas de trabalhadores, parte 1</a></li>
<li><a href="../pt505302/index.html">10 dicas de design de circuitos</a></li>
<li><a href="../pt505306/index.html">De jogos a projetos de com√©rcio eletr√¥nico. Alterando o programa de dois anos do Technopark</a></li>
<li><a href="../pt505310/index.html">O que distingue empresas tecnologicamente avan√ßadas e como a techlide pode ajudar sua equipe a crescer</a></li>
<li><a href="../pt505322/index.html">Despachante do futuro: como mudar√° seu papel na empresa de servi√ßos?</a></li>
<li><a href="../pt505330/index.html">Como n√£o criar uma criptomoeda do zero em 3 anos</a></li>
<li><a href="../pt505336/index.html">Como: Manet ou Monet? A rede neural responde</a></li>
<li><a href="../pt505340/index.html">Funcion√°rios do Walmart tentam provar que a IA anti-roubo n√£o funciona</a></li>
<li><a href="../pt505342/index.html">A inje√ß√£o de depend√™ncia e o princ√≠pio de invers√£o de depend√™ncia N√ÉO S√ÉO UM E MESMO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>