<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêê üìö ü§∏üèø Reducci√≥n del 60% en el tama√±o de la aplicaci√≥n React Native en unos pocos pasos simples üéà üñåÔ∏è üêö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yo trabajo en Mutual . Ella trabaja en Brasil, en el campo de la igualdad de cr√©dito. Ayudamos a prestatarios y prestamistas a conectarse entre s√≠. Lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Reducci√≥n del 60% en el tama√±o de la aplicaci√≥n React Native en unos pocos pasos simples</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yo trabajo en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ella trabaja en Brasil, en el campo de la igualdad de cr√©dito. </font><font style="vertical-align: inherit;">Ayudamos a prestatarios y prestamistas a conectarse entre s√≠. </font><font style="vertical-align: inherit;">Los primeros buscan buenas apuestas, mientras que los segundos buscan ingresos que excedan lo que el mercado puede ofrecerles. </font><font style="vertical-align: inherit;">Nuestro producto es utilizado por una amplia gama de usuarios, trabajamos en un pa√≠s grande. </font><font style="vertical-align: inherit;">Como resultado, nuestras aplicaciones React Native basadas en iOS y Android se descargan a dispositivos muy diferentes.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe se√±alar que la mayor√≠a de nuestros usuarios instalan aplicaciones en dispositivos econ√≥micos. </font><font style="vertical-align: inherit;">Podemos sacar tales conclusiones utilizando los datos de la biblioteca de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">clase de a√±o de dispositivo de</font></a><font style="vertical-align: inherit;"> Facebook.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esta biblioteca, despu√©s de haber recibido informaci√≥n sobre el modelo del dispositivo, informa en qu√© a√±o este dispositivo se considerar√≠a un tel√©fono insignia exclusivo. </font><font style="vertical-align: inherit;">Por ejemplo, el tel√©fono m√°s popular entre nuestros usuarios es el Samsung Galaxy A10. </font><font style="vertical-align: inherit;">Este tel√©fono, aunque fue lanzado en 2019, podr√≠a considerarse el buque insignia solo en 2013. Analizando los datos en los dispositivos de los usuarios, podemos decir que el 85% de estos dispositivos podr√≠an reconocerse como dispositivos de gama alta solo en 2015 o antes. </font><font style="vertical-align: inherit;">Debido a esto, tenemos requisitos especiales para optimizar nuestra aplicaci√≥n m√≥vil. </font><font style="vertical-align: inherit;">El objetivo de la optimizaci√≥n es que incluso los usuarios con dispositivos d√©biles puedan usar c√≥modamente nuestra aplicaci√≥n.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porcentaje de dispositivos que podr√≠an ser reconocidos como emblem√°ticos en un a√±o en particular</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este sentido, prestamos mucha atenci√≥n al tama√±o de la aplicaci√≥n. En el caso de su versi√≥n de Android, ten√≠a 26.8 MB. Aunque este no es un tama√±o tan grande, definitivamente es m√°s que el tama√±o medio de las aplicaciones de nuestros usuarios. Esta cifra, seg√∫n la consola Google Play, es de 16.3 MB. El tama√±o de la aplicaci√≥n puede ser un factor decisivo para los usuarios con planes tarifarios limitados, o para aquellos con dispositivos con poca memoria, lo que obliga a los usuarios a elegir cuidadosamente las aplicaciones que habr√°n instalado. Como resultado, algunas aplicaciones tienen que ser desinstaladas. Esto es especialmente importante en el caso de la aplicaci√≥n Mutua, ya que los prestatarios pagan cuotas mensuales a trav√©s de esta aplicaci√≥n. Cuando el prestatario desinstala nuestra aplicaci√≥n, las posibilidades de que realice el pago a tiempo se reducen considerablemente.Y esto afecta directamente las ganancias de los inversores que usan nuestra plataforma.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tama√±o de la aplicaci√≥n Mutual es mucho mayor que el tama√±o medio de las</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
aplicaciones</font><i><font color="#999999"><font style="vertical-align: inherit;"> de nuestros usuarios</font></font></i><font style="vertical-align: inherit;"> . El tama√±o de la aplicaci√≥n no solo afecta el nivel de desinstalaciones. El tama√±o tambi√©n afecta la tasa de conversi√≥n de la configuraci√≥n de la aplicaci√≥n.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠ hay un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buen art√≠culo sobre esto escrito por el equipo de Google Play. Este art√≠culo analiza la importancia del tama√±o de la aplicaci√≥n. En particular, dice que cada 6 MB adicionales del tama√±o del archivo APK reduce la tasa de conversi√≥n de las instalaciones en un 1%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hablan sobre el hecho de que en los pa√≠ses en desarrollo donde los dispositivos de presupuesto son la norma, este efecto es a√∫n m√°s fuerte. Es decir, reducir el tama√±o del archivo APK en 10 MB en los mercados emergentes corresponde a un aumento en la tasa de conversi√≥n de las instalaciones en aproximadamente un 2,5%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aumentar la tasa de conversi√≥n de las instalaciones por cada 10 Mb de reducci√≥n del tama√±o del archivo APK en diferentes pa√≠ses (seg√∫n los datos internos de Google)</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nos motiv√≥ mucho c√≥mo la reducci√≥n del tama√±o de la aplicaci√≥n puede afectar el nivel de desinstalaciones y la tasa de conversi√≥n de la configuraci√≥n de la aplicaci√≥n. </font><font style="vertical-align: inherit;">Como resultado, nos pusimos a trabajar para reducir al m√°ximo el tama√±o de la aplicaci√≥n, teniendo en cuenta su conveniencia para los usuarios. </font><font style="vertical-align: inherit;">El primer paso en este proyecto fue analizar las</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recomendaciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficiales de</font><font style="vertical-align: inherit;">Google para los desarrolladores de Android.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paquete de aplicaciones de Android</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al leer las recomendaciones, aprendimos que la forma m√°s f√°cil de reducir el tama√±o de una aplicaci√≥n es utilizar un nuevo m√©todo de distribuci√≥n de aplicaciones llamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paquete de aplicaciones de Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (AAB). Hasta ese momento, distribuimos la aplicaci√≥n, recolectamos el viejo archivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APK), que se puede ejecutar en la mayor√≠a de los dispositivos Android, y lo cargamos en la Consola de Google Play. Pero el paquete AAB contiene solo c√≥digo compilado y recursos. Como resultado, cuando se descarga, Google es responsable de generar archivos APK optimizados para varios tipos de dispositivos, teniendo en cuenta sus especificaciones y arquitectura de CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que al hacer un simple cambio en el proceso de construcci√≥n del proyecto, ¬øpodemos obtener una reducci√≥n seria en el tama√±o de la aplicaci√≥n sin hacer m√°s esfuerzo? ¬°Esto es demasiado bueno para la verdad! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de leer la documentaci√≥n, simplemente cambiamos el script de compilaci√≥n React Native Gradle para que se </font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejecute en </font><font style="vertical-align: inherit;">lugar del actual </font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Eso es todo lo que necesit√°bamos para crear el archivo AAB. Despu√©s de hacer algunas modificaciones m√°s a la </font></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">configuraci√≥n de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastlane con</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respecto a la carga autom√°tica de materiales directamente a Play Store, cambiamos a AAB y apareci√≥ una nueva versi√≥n de nuestra aplicaci√≥n en Google Play Console.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este cambio solo ha llevado a una reducci√≥n en el tama√±o de los archivos APK transferidos a los dispositivos de los usuarios. La disminuci√≥n vari√≥ de 9.1 a 12.4 Mb. Al final result√≥ que, el uso de Android App Bundle es una t√©cnica efectiva que, de hecho, le permite reducir el tama√±o de la aplicaci√≥n.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El antiguo archivo APK y el nuevo paquete AAB, cuyo uso lleva al hecho de que el tama√±o de la aplicaci√≥n en diferentes dispositivos puede ser de 14.4 a 17.7 MB.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Verdadero, debe tener cuidado aqu√≠. </font><font style="vertical-align: inherit;">Si usa React Native con</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es posible que deba actualizar su dependencia</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(consulte los detalles</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">De lo contrario, existe el riesgo de darle al usuario una aplicaci√≥n que contendr√° un error cr√≠tico. </font><font style="vertical-align: inherit;">Tuvimos suerte, pudimos identificar este problema durante las pruebas de la versi√≥n alfa del proyecto. </font><font style="vertical-align: inherit;">Pero el error podr√≠a pasar f√°cilmente a producci√≥n, ya que no aparece durante las pruebas locales o al compilar el archivo APK.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizaci√≥n de recursos de aplicaciones con Android Size Analyzer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente sugerencia para optimizar las aplicaciones que encontramos en la documentaci√≥n fue el uso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Size Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta es una herramienta de l√≠nea de comandos que analiza las aplicaciones de Android y busca formas de reducir su tama√±o. </font><font style="vertical-align: inherit;">Lanzamos esta herramienta usando un comando de la siguiente forma:</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtuvimos una lista de excelentes recursos de aplicaciones e im√°genes que podemos optimizar. </font><font style="vertical-align: inherit;">Tambi√©n nos recomendaron configurar ProGuard.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informe del analizador de tama√±o</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProGuard es una herramienta para comprimir, ofuscar y optimizar el c√≥digo de bytes de Java. </font><font style="vertical-align: inherit;">Todav√≠a no hemos explorado la posibilidad de usar esta herramienta, ya que aprendimos que puede no ser compatible con algunas bibliotecas de Android. </font><font style="vertical-align: inherit;">Como nos esforzamos por reducir el tama√±o de nuestra aplicaci√≥n lo m√°s r√°pido posible, y para que esto sea lo m√°s simple posible, decidimos dejar este m√©todo de optimizaci√≥n en el futuro.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Grandes recursos de la aplicaci√≥n</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecut√°ndolo </font></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuevamente, con la clave </font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, obtuvimos una lista de recursos de la aplicaci√≥n, ordenados por su tama√±o. </font><font style="vertical-align: inherit;">Dado que esta herramienta no sabe nada acerca de c√≥mo trabajan los usuarios con la aplicaci√≥n, nos dio la oportunidad de decidir independientemente qu√© recursos deber√≠an eliminarse y cu√°les deber√≠an cargarse din√°micamente en la aplicaci√≥n.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de recursos de aplicaciones grandes ordenados por tama√±o</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El primer y m√°s grande recurso en esta lista fue el paquete React Native JavaScript. </font><font style="vertical-align: inherit;">Ahora no podemos dividir este paquete y cargarlo din√°micamente. </font><font style="vertical-align: inherit;">Pero luego lo pensaremos. </font><font style="vertical-align: inherit;">M√°s abajo en la lista hay archivos de fuentes grandes (TTF) y archivos de im√°genes (JPG y PNG).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Im√°genes innecesarias</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos llamaron la atenci√≥n de inmediato las enormes im√°genes JPG utilizadas en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storybook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Utilizamos este sistema para desarrollar y probar componentes. </font><font style="vertical-align: inherit;">Esto es 2 MB de basura que cayeron en la versi√≥n de producci√≥n del proyecto. </font><font style="vertical-align: inherit;">¬°Vergonzoso error! </font><font style="vertical-align: inherit;">Cuando sucede algo como esto, sentimos que hemos hecho una estupidez grave. </font><font style="vertical-align: inherit;">Pero en el complejo mundo del desarrollo de software, todos cometen errores. </font><font style="vertical-align: inherit;">Creo que si habla de sus errores p√∫blicamente, ayudar√° a otros desarrolladores a aprender de estos errores. </font><font style="vertical-align: inherit;">Existe la posibilidad de que cometa los mismos errores si no analiza la estructura de recursos de la aplicaci√≥n, cuyo tama√±o aumenta gradualmente.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Fuentes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eliminar r√°pidamente las im√°genes innecesarias, procedimos a analizar otros elementos de la lista de recursos. Estaba claro que hab√≠a muchas fuentes incorporadas. Despu√©s de hablar de esto con nuestros dise√±adores, nos dijeron que muchos componentes antiguos no difieren en el estricto cumplimiento de los manuales tipogr√°ficos. Por lo tanto, descubrimos qu√© componentes se pueden eliminar y en qu√© puede usar las fuentes actualizadas adecuadas. Gracias a esto, pudimos reducir la cantidad de fuentes utilizadas de seis a cuatro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra cosa que notamos fue el gran tama√±o de los propios archivos de fuentes. El tama√±o de cada uno de ellos era de aproximadamente 670 Kb. Esto signific√≥ que cuatro fuentes en el paquete sin comprimir ocupan unos impresionantes 2.7 Mb. Pero, afortunadamente, hay una herramienta llamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le permite analizar y modificar profundamente los archivos de fuentes. Con esta herramienta, pudimos descubrir que la raz√≥n principal del gran tama√±o de los archivos de fuente son los caracteres cir√≠licos extendidos y los glifos innecesarios. Podr√≠amos eliminar todo esto de manera segura, ya que la parte de texto de nuestra aplicaci√≥n est√° completamente escrita en portugu√©s. Gracias a este cambio, pudimos reducir el tama√±o de los archivos de fuentes de 670 Kb a 70 Kb, en un 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplos de algunos glifos incluidos en nuestras fuentes:</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
debido a que eliminamos las fuentes innecesarias y optimizamos las restantes, pudimos reducir el tama√±o de la aplicaci√≥n en 3.8 Mb. </font><font style="vertical-align: inherit;">Esto condujo a una reducci√≥n agradable en el tama√±o total del archivo APK en 2 MB.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fuentes y sus tama√±os antes de la optimizaci√≥n.</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de fuentes y sus tama√±os despu√©s de la optimizaci√≥n.</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçOptimizaci√≥n de im√°genes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de analizar las im√°genes que a√∫n permanec√≠an en la aplicaci√≥n, notamos que algunas de ellas son bastante grandes. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procesamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> varias de estas im√°genes con la </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">herramienta de</font></a><font style="vertical-align: inherit;"> optimizaci√≥n de gr√°ficos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">TinyPNG</font></a><font style="vertical-align: inherit;"> y vimos una reducci√≥n significativa en el tama√±o de estas im√°genes. </font><font style="vertical-align: inherit;">Despu√©s de eso, decidimos optimizar todas las im√°genes JPG y PNG utilizadas en la aplicaci√≥n. </font><font style="vertical-align: inherit;">Eran 41 de ellos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagen antes y despu√©s de la optimizaci√≥n</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esto nos dio la oportunidad de reducir el tama√±o de las im√°genes de 2.5 MB a 756 KB, es decir, en un 70%. </font><font style="vertical-align: inherit;">Sin embargo, debido al hecho de que las im√°genes no estaban optimizadas previamente, se comprimieron durante la creaci√≥n del archivo APK final. </font><font style="vertical-align: inherit;">Result√≥ que nuestra optimizaci√≥n condujo a una disminuci√≥n en el tama√±o de la aplicaci√≥n descargada por el usuario en solo 500 Kb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, nos dimos cuenta de que ya hab√≠amos agotado todas las posibilidades de optimizaci√≥n r√°pida. </font><font style="vertical-align: inherit;">Continuar con la optimizaci√≥n de los recursos requerir√≠a grandes esfuerzos o solo mejoras menores.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reaccionar optimizaci√≥n de paquete de JavaScript nativo</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de descubrir los recursos de la aplicaci√≥n espec√≠ficos para la plataforma Android, es hora de analizar el paquete de JavaScript. </font><font style="vertical-align: inherit;">La optimizaci√≥n de paquetes puede considerarse una buena idea por tres razones. </font><font style="vertical-align: inherit;">En primer lugar, reduce el tama√±o del archivo APK terminado. </font><font style="vertical-align: inherit;">En segundo lugar, esto lleva a un lanzamiento m√°s r√°pido de la aplicaci√≥n, ya que la m√°quina virtual JS tiene que procesar menos c√≥digo. </font><font style="vertical-align: inherit;">Finalmente, y lo m√°s importante, acelera las actualizaciones de OTA que hacemos varias veces a la semana usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Analizador de paquetes y optimizaci√≥n de c√≥digo</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para tomar una decisi√≥n sobre c√≥mo reducir el tama√±o del paquete, primero, ten√≠a que averiguar qu√© ocupaba m√°s lugar en el paquete. Para hacer esto, utilizamos la excelente herramienta de c√≥digo abierto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Despu√©s de analizar el proyecto con su ayuda, obtuvimos una visualizaci√≥n en la que cada carpeta y cada dependencia de la aplicaci√≥n estaba presente, indicando los tama√±os de las entidades correspondientes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instant√°nea de las bibliotecas y carpetas de la base de c√≥digo de la interfaz de la aplicaci√≥n Mutual con la indicaci√≥n de los tama√±os</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Descubrimos que el tama√±o total del paquete es de 5.49 Mb. El 57.8% de este volumen est√° representado por dependencias de la carpeta</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, el 27.5% - c√≥digo de aplicaci√≥n. Lo que queda, la herramienta utilizada por nosotros no pudo ser identificada. Durante el proceso de ensamblaje del paquete, el c√≥digo no utilizado ya se elimin√≥, por lo que lo que vimos fue el c√≥digo que realmente utiliza la aplicaci√≥n. Pero, incluso considerando esto, en el paquete siempre puedes encontrar algo que se puede mejorar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor dependencia del proyecto es</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta biblioteca, como su nombre lo indica, implementa muchas operaciones matem√°ticas. No tenemos una necesidad especial de esta biblioteca debido al hecho de que realizamos todos los c√°lculos importantes en el servidor, despu√©s de lo cual simplemente enviamos los resultados a la aplicaci√≥n. Cuando miramos el c√≥digo de la aplicaci√≥n, result√≥ que la biblioteca se usa solo para realizar algunas operaciones simples. Probablemente fue utilizado por un desarrollador que trabaj√≥ en el c√≥digo del servidor solo en virtud del h√°bito. R√°pidamente extrajimos los m√©todos apropiados de la biblioteca y los incorporamos a nuestra base de c√≥digo, eliminando por completo esta dependencia. Esto permiti√≥ reducir el tama√±o del paquete a 4.64 Mb. ¬°El rechazo de una sola biblioteca permiti√≥ reducir el tama√±o del paquete en un 15,5%!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya se mencion√≥, usamos Storybook para desarrollar y probar componentes. Es cierto que las capacidades correspondientes deber√≠an estar disponibles solo en entornos locales e intermedios. Los usuarios finales no necesitan esto. Gracias a esto, utilizamos la variable </font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para controlar la inclusi√≥n de la parte correspondiente de la aplicaci√≥n. Aunque esto es adecuado para restringir el acceso, el agrupador no puede saber qu√© valor se escribe en esta variable. Debido a esta limitaci√≥n, todo el c√≥digo de Storybook cay√≥ en el paquete de producci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para solucionar el problema, aislamos la importaci√≥n de esta secci√≥n dentro de un solo archivo. Luego creamos dos versiones de este archivo: una que incluye Storybook y otra que es para producci√≥n, que contiene solo el dise√±o del componente. Para cambiar entre estos archivos al preparar la versi√≥n de producci√≥n del paquete, escribimos un script que se ejecuta antes de que se construya el proyecto y cambia un archivo a otro. Gracias a este m√©todo, pudimos eliminar completamente el c√≥digo de Storybook de la versi√≥n de producci√≥n de la aplicaci√≥n, eliminando tanto la dependencia </font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como el c√≥digo habitual con respecto a la configuraci√≥n de las "historias" de Storybook.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se actualiz√≥ la carpeta Storybook con dos versiones del archivo de √≠ndice.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Estos dos cambios redujeron el tama√±o del paquete de 5,49 MB a 4,2 MB. </font><font style="vertical-align: inherit;">Esto significa que, entre otras cosas, la aplicaci√≥n se cargar√° m√°s r√°pido y se actualizar√° m√°s r√°pido.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tama√±o del paquete final fue de 4.2 MB.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s de todas estas mejoras, volvimos a descargar la aplicaci√≥n en Play Store. </font><font style="vertical-align: inherit;">Ahora nos informaron que el tama√±o del archivo APK terminado estar√° en el rango de 10.5 a 13.7 Mb. </font><font style="vertical-align: inherit;">Esto, dado que la aplicaci√≥n originalmente ten√≠a un tama√±o de 26.8 MB, ¬°simplemente significa una reducci√≥n incre√≠ble en el tama√±o del proyecto en aproximadamente un 60%! </font><font style="vertical-align: inherit;">Entonces, como dijimos en un art√≠culo del equipo de Google Play, podemos esperar que la tasa de conversi√≥n de las instalaciones aumente en un 3.75%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaci√≥n de la versi√≥n APK original de la aplicaci√≥n con la versi√≥n final de AAB, en la que se realizan todas las mejoras descritas anteriormente</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosotros, como programadores orientados a los negocios, sabemos que a veces las empresas, en aras de un desarrollo m√°s r√°pido de un proyecto, pueden aumentar su deuda t√©cnica. </font><font style="vertical-align: inherit;">Esto es especialmente cierto para las nuevas empresas j√≥venes como Mutual, que est√°n tratando de encontrar su lugar en el mercado. </font><font style="vertical-align: inherit;">Pero si no observa esta deuda, puede cometer errores molestos, como enviar 2 MB de im√°genes de prueba a producci√≥n y el uso injustificado de una gran biblioteca. </font><font style="vertical-align: inherit;">No se debe permitir que la deuda t√©cnica se salga de control y cause problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, a menudo sucede que los desarrolladores simplemente pierden las oportunidades disponibles para optimizar proyectos. </font><font style="vertical-align: inherit;">Por lo tanto, a veces se recomienda analizar cr√≠ticamente sus proyectos. </font><font style="vertical-align: inherit;">Solo para verificar si perdi√≥ alguna oportunidad de optimizar r√°pidamente el tama√±o, la velocidad o alg√∫n otro aspecto de la aplicaci√≥n. </font><font style="vertical-align: inherit;">Nos llev√≥ solo dos d√≠as analizar la aplicaci√≥n, planificar el trabajo y realizar mejoras en el proyecto, lo que nos permiti√≥ reducir el tama√±o de la aplicaci√≥n en un 60%. </font><font style="vertical-align: inherit;">Es dif√≠cil encontrar algo m√°s que pueda producir los mismos resultados en tan poco tiempo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo optimizas tus proyectos React Native?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502412/index.html">Guilloche de otra manera</a></li>
<li><a href="../es502414/index.html">FOSS News No. 16: una revisi√≥n del software gratuito y de c√≥digo abierto del 11 al 17 de mayo de 2020</a></li>
<li><a href="../es502416/index.html">Complementando SQL. Parte 1. La complejidad del an√°lisis. Historias sobre la finalizaci√≥n del archivo ANTLR</a></li>
<li><a href="../es502418/index.html">Monitor de imagen 3D</a></li>
<li><a href="../es502420/index.html">Hallazgos interesantes de CSS en el dise√±o de Twitter</a></li>
<li><a href="../es502432/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 415 (11-17 de mayo de 2020)</a></li>
<li><a href="../es502436/index.html">CI TeamCity - Automatizaci√≥n de procesos de compilaci√≥n de pruebas de Android y UI</a></li>
<li><a href="../es502438/index.html">Material Python. Tarjetas personalizadas con efectos OpenGL</a></li>
<li><a href="../es502440/index.html">Creaci√≥n de aplicaciones con Mediapipe</a></li>
<li><a href="../es502442/index.html">PHP Digest No. 180 (4 al 18 de mayo de 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>