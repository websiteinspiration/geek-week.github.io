<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎽 👉🏿 👸🏽 テスト駆動開発を使用して心理療法士にお金を節約する方法 👨🏼‍🎓 🈴 🙍🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="これまでにこのような症状がありましたか？
 
 
 特定の例を使用して、TDDがコードの品質を向上させる方法を紹介します。
 私が問題を研究している間に会ったすべてがかなり理論的だったので。
 たまたま、ほぼ同じ2つのアプリケーションを作成することがありました。1つはクラシックスタイルで記述されてい...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>テスト駆動開発を使用して心理療法士にお金を節約する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/leroy_merlin/blog/456662/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これまでにこのような症状がありましたか？</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/td/so/bltdsone5ewlnnqa_aamnii9rl8.jpeg" alt="画像"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の例を使用して、TDDがコードの品質を向上させる方法を紹介します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が問題を研究している間に会ったすべてがかなり理論的だったので。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たまたま、ほぼ同じ2つのアプリケーションを作成することがありました。1つはクラシックスタイルで記述されていたため、当時はTDDを知りませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に、最も大きな違いがあった場所を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個人的には、これは私にとって重要でした。誰かが私のコードのバグを見つけるたびに、私は自尊心のために重いマイナスを捉えました。はい、バグは正常であると私は理解しました、誰もがそれらを書きますが、劣等感は消えませんでした。また、サービスの進化の過程で、自分がかゆみですべてを捨てて書き直すような書き方をしていたことが時々わかりました。そしてそれがどのように起こったかは理解できません。初めは何とかすべてが順調でしたが、いくつかの機能の後、しばらくすると、涙がなければ建築を見ることはできません。変更のすべてのステップは論理的だったようですが。自分の作品の製品が気に入らなかったという気持ちは、プログラマーが私から来たという気持ちにスムーズに流れ込みました。ごめんなさい、たわごとの弾丸のように。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私だけではなく、同僚の多くも同じような感覚を持っていることがわかりました。</font><font style="vertical-align: inherit;">そして、私は普通に書くことを学ぶか、それとも自分の職業を変える時だと決心しました。</font><font style="vertical-align: inherit;">私のプログラミングアプローチで何かを変更しようとして、テスト駆動開発を試みました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後、いくつかのプロジェクトの結果に基づくと、TDDはよりクリーンなアーキテクチャーを提供しますが、開発が遅くなります。</font><font style="vertical-align: inherit;">そして、それは常に適切であるとは限らず、すべての人に適しているわけではありません。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDDとは</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f39/01c/4ed/f3901c4ed2fee96d90b1a40fc30e9270.jpg" alt="画像"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDD-テストによる開発。</font><font style="vertical-align: inherit;">Wikiの記事は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちら</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古典的なアプローチは、最初にアプリケーションを作成し、次にそれをテストでカバーすることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDDアプローチ-最初にクラスのテストを記述し、次に実装します。</font><font style="vertical-align: inherit;">私たちは、抽象化のレベルを介して移動する-最高の私たちは、そこからレイヤー・クラスにアプリケーションを壊すと同時に、適用に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注文し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、特定の実装から自由であること、私たちに必要な行動を。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これを初めて読んだとしても、何もわかりません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
抽象単語が多すぎる：例を見てみましょう。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaで実際のスプリングアプリケーションを作成し、TDDで作成します。開発プロセス中に私の思考プロセスを示し、最終的にTDDに時間を費やすことが理にかなっているかどうかについて結論を導きます。 </font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実用的なタスク</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちがとても幸運で、開発する必要があるもののToRがあると仮定します。</font><font style="vertical-align: inherit;">通常、アナリストはそれを気にせず、次のよう</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">になります。商品を販売してから自宅のクライアントに配送する可能性を計算するマイクロサービスを開発する必要があります。</font><font style="vertical-align: inherit;">この機能に関する情報はサードパーティのDATAシステムに送信する必要があります。</font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ビジネスロジックは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">商品は在庫があります</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">請負業者（会社DostavchenKOなど）は、それをクライアントに持ち込む機会があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品の色-青ではない（青が好きではない）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロサービスは、http-requestを介して、店の棚の商品の数量の変更について通知されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この通知は、可用性を計算するためのトリガーです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、人生が蜂蜜ではないように：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーは特定の製品を手動で無効にできる必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DATAをスパムしないようにするには、変更された製品の在庫データのみを送信する必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはTKを数回読み、そして行きます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/10/xa/vc/10xavc46--r-thnqp--lbfzw4co.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統合テスト</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDDで、あなたが書くすべてのことについて尋ねなければならない最も重要な質問の1つは、「何が欲しいのか...」です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私たちが最初に尋ねる質問は、アプリケーション全体についてです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから問題は：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私のマイクロサービスに何が欲しいですか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回答：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際にはたくさんのこと。</font><font style="vertical-align: inherit;">そのような単純なロジックでさえ、多くのオプションがあり、それらを書き留める試み、さらにはそれらすべてのテストを作成する試みは、不可能な作業になる場合があります。</font><font style="vertical-align: inherit;">したがって、アプリケーションレベルでの質問に答えるために、主なテストケースのみを選択します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、すべての入力データは有効な形式であり、サードパーティのシステムは正常に応答し、以前は製品に関する情報がなかったと想定しています。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だから、私はしたい：</font></font></i><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">棚に商品がないというイベントが到着しました。</font><font style="vertical-align: inherit;">配信できないことを通知します。</font></font></li>
<li> ,    —  , DostavchenKO   .    .</li>
<li>    —       .    .</li>
<li>  :      ,   —  .   :  — ,  — .</li>
<li>    ,       .</li>
<li>…</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでの主なことは、時間内に停止することです。すでに書いたように、オプションが多すぎます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここですべてを説明しても意味がありません</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的な</font><font style="vertical-align: inherit;">オプションのみ</font><font style="vertical-align: inherit;">です。将来的には、ビジネスロジックのテストを作成するときに、それらの組み合わせで、ここで思いつくすべてのものがカバーされる可能性があります。ここでの主な動機は、これらのテストに合格した場合、アプリケーションが必要に応じて機能することを確認することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてのウィッシュリストを蒸留してテストします。さらに、これはアプリケーションレベルのウィッシュリストであるため、春のコンテキストを上げる、つまり非常に重いテストを行います。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、残念なことに、多くのTDDの目的のために、そのような統合テストを書くためには、人々が常に費やすことをいとわないとは限らない、かなりの努力が必要です。</font><font style="vertical-align: inherit;">そして、はい、これは最も難しいステップですが、私が信じてください、あなたがそれを実行した後、コードはほとんどそれ自体を書き、あなたのアプリケーションがあなたが望むように正しく動作することを確信するでしょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/r2/hg/db/r2hgdbqezd8esoynflanwv-so8e.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問に答えるプロセスでは、生成されたSpring Initializrクラスでコードの記述を開始できます。</font><font style="vertical-align: inherit;">テストの名前はウィッシュリストにすぎません。</font><font style="vertical-align: inherit;">ここでは、空のメソッドを作成します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductQuantityIsZero</span><span class="hljs-params">()</span> </span>{}
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyAvailableYellowProductIfPositiveQuantityAndDostavchenkoApproved</span><span class="hljs-params">()</span> </span>{}
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyOnceOnSeveralEqualProductMessages</span><span class="hljs-params">()</span> </span>{}
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyFirstAvailableThenNotIfProductQuantityMovedFromPositiveToZero</span><span class="hljs-params">()</span> </span>{}
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">noNotificationOnDisabledProduct</span><span class="hljs-params">()</span> </span>{}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドの命名について：test1（）、test2（）ではなく、情報を提供することを強くお勧めします。後で、どのクラスを記述したか、およびそれが担当することを忘れると、代わりに機会があるからです。コードを直接解析して、テストを開き、クラスが満たすコントラクトメソッドを読み取ります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストの記入を開始します</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主なアイデアは、内部で何が起こっているかを確認するために、外部のすべてをエミュレートすることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのサービスに関する「外部」は、マイクロサービス自体ではなく、直接それと通信するすべてのものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、外部は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">商品の数量変化を弊社サービスがお知らせするシステム</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手動で商品を切断するお客様</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サードパーティのDostavchenKOシステム</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の2つの要求をエミュレートするために、Springing MockMvcを使用します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DostavchenKOをエミュレートするには、wiremockまたはMockRestServiceServerを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、統合テストは次のようになります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">統合テスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@AutoConfigureMockMvc</span>
<span class="hljs-meta">@AutoConfigureWireMock(port = 8090)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TddExampleApplicationTests</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MockMvc mockMvc;<font></font>
<font></font>
    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{<font></font>
        WireMock.reset();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductQuantityIsZero</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 111,\n"</span> +
                        <span class="hljs-string">"  \"available\": false\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        performQuantityUpdateRequest(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 111,\n"</span> +
                        <span class="hljs-string">"  \"color\" : \"red\",  \n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 0\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        verify(<span class="hljs-number">1</span>, postRequestedFor(urlEqualTo(<span class="hljs-string">"/notify"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyAvailableYellowProductIfPositiveQuantityAndDostavchenkoApproved</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        stubDostavchenko(<span class="hljs-string">"112"</span>);<font></font>
<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 112,\n"</span> +
                        <span class="hljs-string">"  \"available\": true\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        performQuantityUpdateRequest(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 112,\n"</span> +
                        <span class="hljs-string">"  \"color\" : \"Yellow\",  \n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        verify(<span class="hljs-number">1</span>, postRequestedFor(urlEqualTo(<span class="hljs-string">"/notify"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyOnceOnSeveralEqualProductMessages</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        stubDostavchenko(<span class="hljs-string">"113"</span>);<font></font>
<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 113,\n"</span> +
                        <span class="hljs-string">"  \"available\": true\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {<font></font>
            performQuantityUpdateRequest(<font></font>
                    <span class="hljs-comment">// language=JSON</span>
                    <span class="hljs-string">"{\n"</span> +
                            <span class="hljs-string">"  \"productId\": 113,\n"</span> +
                            <span class="hljs-string">"  \"color\" : \"Yellow\",  \n"</span> +
                            <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                            <span class="hljs-string">"}"</span>);<font></font>
        }<font></font>
<font></font>
        verify(<span class="hljs-number">1</span>, postRequestedFor(urlEqualTo(<span class="hljs-string">"/notify"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyFirstAvailableThenNotIfProductQuantityMovedFromPositiveToZero</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        stubDostavchenko(<span class="hljs-string">"114"</span>);<font></font>
<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 114,\n"</span> +
                        <span class="hljs-string">"  \"available\": true\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        performQuantityUpdateRequest(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 114,\n"</span> +
                        <span class="hljs-string">"  \"color\" : \"Yellow\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 114,\n"</span> +
                        <span class="hljs-string">"  \"available\": false\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        performQuantityUpdateRequest(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 114,\n"</span> +
                        <span class="hljs-string">"  \"color\" : \"Yellow\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 0\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        verify(<span class="hljs-number">2</span>, postRequestedFor(urlEqualTo(<span class="hljs-string">"/notify"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">noNotificationOnDisabledProduct</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        stubNotification(<font></font>
                <span class="hljs-comment">// language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 115,\n"</span> +
                        <span class="hljs-string">"  \"available\": false\n"</span> +
                        <span class="hljs-string">"}"</span>);<font></font>
<font></font>
        disableProduct(<span class="hljs-number">115</span>);<font></font>
<font></font>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {<font></font>
            performQuantityUpdateRequest(<font></font>
                    <span class="hljs-comment">// language=JSON</span>
                    <span class="hljs-string">"{\n"</span> +
                            <span class="hljs-string">"  \"productId\": 115,\n"</span> +
                            <span class="hljs-string">"  \"color\" : \"Yellow\",\n"</span> +
                            <span class="hljs-string">"  \"productQuantity\": "</span> + i + <span class="hljs-string">"\n"</span> +
                            <span class="hljs-string">"}"</span>);<font></font>
        }<font></font>
<font></font>
        verify(<span class="hljs-number">1</span>, postRequestedFor(urlEqualTo(<span class="hljs-string">"/notify"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableProduct</span><span class="hljs-params">(<span class="hljs-keyword">int</span> productId)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        mockMvc.perform(<font></font>
                post(<span class="hljs-string">"/disableProduct?productId="</span> + productId)<font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isOk()<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">performQuantityUpdateRequest</span><span class="hljs-params">(String content)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        mockMvc.perform(<font></font>
                post(<span class="hljs-string">"/product-quantity-update"</span>)<font></font>
                        .contentType(MediaType.APPLICATION_JSON)<font></font>
                        .content(content)<font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isOk()<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stubNotification</span><span class="hljs-params">(String content)</span> </span>{<font></font>
        stubFor(WireMock.post(urlEqualTo(<span class="hljs-string">"/notify"</span>))<font></font>
                .withHeader(<span class="hljs-string">"Content-Type"</span>, equalTo(MediaType.APPLICATION_JSON_UTF8_VALUE))<font></font>
                .withRequestBody(equalToJson(content))<font></font>
                .willReturn(aResponse().withStatus(HttpStatus.OK_200)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stubDostavchenko</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String productId)</span> </span>{<font></font>
        stubFor(get(urlEqualTo(<span class="hljs-string">"/isDeliveryAvailable?productId="</span> + productId))<font></font>
                .willReturn(aResponse().withStatus(HttpStatus.OK_200).withBody(<span class="hljs-string">"true"</span>)));<font></font>
    }<font></font>
}</code></pre></div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今何があったの？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
統合テストを作成しました。そのテストは、主要なユーザーストーリーに従ってシステムの操作性を保証します。そして、サービスの実装を開始する前にそれを行いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチの利点の1つは、書き込みプロセス中に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DostavchenKO </font><font style="vertical-align: inherit;">に行って、スタブに対して行っ</font><font style="vertical-align: inherit;">た</font><b><font style="vertical-align: inherit;">実際の</font></b><font style="vertical-align: inherit;">リクエストに対して</font><b><font style="vertical-align: inherit;">実際の</font></b><font style="vertical-align: inherit;"> DostavchenKOから</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">答え</font><font style="vertical-align: inherit;">を得</font><font style="vertical-align: inherit;">なければならないこと</font><font style="vertical-align: inherit;">です。すべてのコードが記述された後ではなく、開発の最初の段階でこれを処理したことは非常に良いことです。そして、形式がTORで指定されたものではないか、サービスが一般に利用できないか、または他の何かであることがわかります。</font><font style="vertical-align: inherit;">
また、まだ書かれていませんが、まだ書かれていませ</font><b><font style="vertical-align: inherit;">ん。</font></b></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">後で製品化されるコード行がありますが</font><font style="vertical-align: inherit;">、マイクロサービスが内部にどのように配置されるかについて</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単一の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮定</font><font style="vertical-align: inherit;">さえしていません</font><font style="vertical-align: inherit;">：どのレイヤーが存在するか、ベースを使用するかどうか、そうである場合など。テストを書いている時点では、実装から抽象化されており、後で説明するように、これは多くのアーキテクチャ上の利点をもたらします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストの直後に実装が記述される標準的なTDDとは対照的に、統合テストにはそれほど長い時間がかかりません。</font><font style="vertical-align: inherit;">実際、ファイルが含まれるすべてのものが完全に書き込まれるまで、開発の最後まで緑色に変わりません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに進んでいます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
統合テストを作成した後は、タスクを完了した後、夜間に安らかに眠ることができるようになったので、レイヤーのプログラミングを開始します。そして、実装する最初のレイヤーはコントローラーです。なぜ彼は正確に？これはプログラムへのエントリポイントだからです。ユーザーが操作する最初のレイヤーから最後のレイヤーまで、上から下に移動する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大事です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして再び、それはすべて同じ質問から始まります：</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラーに何が欲しいですか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
回答：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、コントローラーがユーザーとの通信、入力データの検証と変換に従事しており、ビジネスロジックを含まないことを知っています。したがって、この質問に対する答えは次のようなものになる可能性があります</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効なIDを持つ製品を切断しようとしたときにBAD_REQUESTがユーザーに返されました</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効なIDの商品の変更について通知しようとする場合のBAD_REQUEST</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負の数量を通知しようとする場合のBAD_REQUEST</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DostavchenKOが利用できない場合のINTERNAL_SERVER_ERROR</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNAL_SERVER_ERROR、DATAに送信できない場合</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはユーザーフレンドになりたいので、上記のすべての項目について、httpコードに加えて、ユーザーが問題を理解できるように問題を説明するカスタムメッセージを表示する必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理が成功した場合は200</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のすべてのケースではINTERNAL_SERVER_ERRORとデフォルトのメッセージを使用して、スタックレースを回避します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDDについて書き始めるまで、私が考えていた最後の事柄は、私のシステムがユーザーに何をもたらすかであり、一見したところではありそうもありませんでした。</font><font style="vertical-align: inherit;">単純な理由で考えませんでした。すべてのエッジケースを完全に考慮するために実装を作成するのは非常に難しいため、脳に十分なRAMがない場合があります。</font><font style="vertical-align: inherit;">そして、書かれた実装後、事前に考慮しなかったかもしれない何かについてコードを分析することは依然として喜びです：私たちは皆、完璧なコードをすぐに書いていると思います）。</font><font style="vertical-align: inherit;">実装はありませんが、それについて考える必要はありません。それを変更したとしても、痛みはありません。</font><font style="vertical-align: inherit;">最初にテストを作成したので、星が収束するまで待つ必要はありません。製品への撤退後、特定の数のシステムが失敗し、顧客は何かを修正するように要求してあなたのところに行きます。</font><font style="vertical-align: inherit;">そして、これはコントローラだけに当てはまるわけではありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストを書き始める</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の3つはすべて明らかです。Spring検証を使用します。無効なリクエストが到着すると、アプリケーションが実行をスローし、例外ハンドラでキャッチします。ここで、彼らが言うように、すべてがそれ自体で機能しますが、コントローラーは、サードパーティのシステムが利用できないことをどのようにして知るのでしょうか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラー自体がサードパーティのシステムについて何も知らないはずであることは明らかです。どのシステムに質問し、ビジネスロジックとは何か、つまり、何らかの仲介者が必要です。この仲介はサービスです。そして、このサービスのモックを使用してコントローラーのテストを記述し、特定の場合の動作をエミュレートします。したがって、サービスはシステムが利用できないことを何らかの形でコントローラーに通知する必要があります。これはさまざまな方法で実行できますが、カスタム実行をスローする最も簡単な方法です。このコントローラーの動作のテストを作成します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サードパーティのDATAシステムとの通信エラーをテストする</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@WebMvcTest</span>
<span class="hljs-meta">@AutoConfigureMockMvc</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ControllerTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@MockBean</span>
    <span class="hljs-keyword">private</span> UpdateProcessorService updateProcessorService;<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnServerErrorOnDataCommunicationError</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> DataCommunicationException()).when(updateProcessorService).processUpdate(any(Update.class));<font></font>
<font></font>
        performUpdate(<font></font>
                //language=JSON<font></font>
                "{\n" +<font></font>
                        "  \"productId\": <span class="hljs-number">1</span>,\n<span class="hljs-string">" +
                        "</span>  \<span class="hljs-string">"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isInternalServerError()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"Can't communicate with Data system\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階で、いくつかのものが自分で現れました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラーに注入され、新しい数量の商品の着信メッセージの処理を委任されるサービス。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このサービスのメソッド、およびそれに応じてその署名。この処理を実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムが使用できないときにメソッドがカスタム実行を排出する必要があるという認識。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このカスタム実行自体。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜ一人で？</font><font style="vertical-align: inherit;">あなたが覚えているように、私たちはまだ実装を書いていません。</font><font style="vertical-align: inherit;">そして、これらすべてのエンティティは、テストをプログラムする方法のプロセスに現れました。</font><font style="vertical-align: inherit;">コンパイラが誓わないように、実際のコードでは、上記のすべてを作成する必要があります。</font><font style="vertical-align: inherit;">幸い、ほとんどすべてのIDEが必要なエンティティの生成に役立ちます。</font><font style="vertical-align: inherit;">したがって、私たちは一種のテストを作成します-そしてアプリケーションはクラスとメソッドで満たされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体として、コントローラーのテストは次のとおりです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@WebMvcTest</span>
<span class="hljs-meta">@AutoConfigureMockMvc</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ControllerTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@InjectMocks</span>
    <span class="hljs-keyword">private</span> Controller controller;
    <span class="hljs-meta">@MockBean</span>
    <span class="hljs-keyword">private</span> UpdateProcessorService updateProcessorService;<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MockMvc mvc;<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnBadRequestOnDisableWithInvalidProductId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        mvc.perform(<font></font>
                post(<span class="hljs-string">"/disableProduct?productId=-443"</span>)<font></font>
        ).andDo(<font></font>
            print()<font></font>
        ).andExpect(<font></font>
                status().isBadRequest()<font></font>
        ).andExpect(<font></font>
                content().json(getInvalidProductIdJsonContent())<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnBadRequestOnNotifyWithInvalidProductId</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        performUpdate(<font></font>
                <span class="hljs-comment">//language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": -1,\n"</span> +
                        <span class="hljs-string">"  \"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 0\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isBadRequest()<font></font>
        ).andExpect(<font></font>
                content().json(getInvalidProductIdJsonContent())<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnBadRequestOnNotifyWithNegativeProductQuantity</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        performUpdate(<font></font>
                <span class="hljs-comment">//language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 1,\n"</span> +
                        <span class="hljs-string">"  \"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": -10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isBadRequest()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"productQuantity is invalid\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnServerErrorOnDostavchenkoCommunicationError</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> DostavchenkoException()).when(updateProcessorService).processUpdate(any(Update.class));<font></font>
<font></font>
        performUpdate(<font></font>
                //language=JSON<font></font>
                "{\n" +<font></font>
                        "  \"productId\": <span class="hljs-number">1</span>,\n<span class="hljs-string">" +
                        "</span>  \<span class="hljs-string">"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isInternalServerError()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"DostavchenKO communication exception\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnServerErrorOnDataCommunicationError</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> DataCommunicationException()).when(updateProcessorService).processUpdate(any(Update.class));<font></font>
<font></font>
        performUpdate(<font></font>
                //language=JSON<font></font>
                "{\n" +<font></font>
                        "  \"productId\": <span class="hljs-number">1</span>,\n<span class="hljs-string">" +
                        "</span>  \<span class="hljs-string">"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isInternalServerError()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"Can't communicate with Data system\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">return200OnSuccess</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        performUpdate(<font></font>
                <span class="hljs-comment">//language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": 1,\n"</span> +
                        <span class="hljs-string">"  \"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isOk()<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnServerErrorOnUnexpectedException</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> RuntimeException()).when(updateProcessorService).processUpdate(any(Update.class));<font></font>
<font></font>
        performUpdate(<font></font>
                //language=JSON<font></font>
                "{\n" +<font></font>
                        "  \"productId\": <span class="hljs-number">1</span>,\n<span class="hljs-string">" +
                        "</span>  \<span class="hljs-string">"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": 10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isInternalServerError()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"Internal Server Error\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnTwoErrorMessagesOnInvalidProductIdAndNegativeQuantity</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        performUpdate(<font></font>
                <span class="hljs-comment">//language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"productId\": -1,\n"</span> +
                        <span class="hljs-string">"  \"color\": \"red\",\n"</span> +
                        <span class="hljs-string">"  \"productQuantity\": -10\n"</span> +
                        <span class="hljs-string">"}"</span><font></font>
        ).andDo(<font></font>
                print()<font></font>
        ).andExpect(<font></font>
                status().isBadRequest()<font></font>
        ).andExpect(<font></font>
                content().json(<span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    { \"message\": \"productQuantity is invalid\" },\n"</span> +
                        <span class="hljs-string">"    { \"message\": \"productId is invalid\" }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>)<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> ResultActions <span class="hljs-title">performUpdate</span><span class="hljs-params">(String jsonContent)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">return</span> mvc.perform(<font></font>
                post(<span class="hljs-string">"/product-quantity-update"</span>)<font></font>
                        .contentType(MediaType.APPLICATION_JSON_UTF8_VALUE)<font></font>
                        .content(jsonContent)<font></font>
        );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getInvalidProductIdJsonContent</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span>
                <span class="hljs-comment">//language=JSON</span>
                <span class="hljs-string">"{\n"</span> +
                        <span class="hljs-string">"  \"errors\": [\n"</span> +
                        <span class="hljs-string">"    {\n"</span> +
                        <span class="hljs-string">"      \"message\": \"productId is invalid\"\n"</span> +
                        <span class="hljs-string">"    }\n"</span> +
                        <span class="hljs-string">"  ]\n"</span> +
                        <span class="hljs-string">"}"</span>;<font></font>
    }<font></font>
}</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 これで実装を記述して、すべてのテストが正常にパスすることを確認できます。</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Validated</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Controller</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UpdateProcessorService updateProcessorService;<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping("/product-quantity-update")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateQuantity</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> Update update)</span> </span>{<font></font>
        updateProcessorService.processUpdate(update);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@PostMapping("/disableProduct")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("productId")</span> <span class="hljs-meta">@Min(0)</span> Long productId)</span> </span>{<font></font>
        updateProcessorService.disableProduct(Long.valueOf(productId));<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外ハンドラー</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationExceptionHandler</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@ExceptionHandler(ConstraintViolationException.class)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title">onConstraintViolationException</span><span class="hljs-params">(ConstraintViolationException exception)</span> </span>{<font></font>
        log.info(<span class="hljs-string">"Constraint Violation"</span>, exception);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorResponse(exception.getConstraintViolations().stream()<font></font>
                .map(constraintViolation -&gt; <span class="hljs-keyword">new</span> ErrorResponse.Message(<font></font>
                        ((PathImpl) constraintViolation.getPropertyPath()).getLeafNode().toString() +<font></font>
                                <span class="hljs-string">" is invalid"</span>))<font></font>
                .collect(Collectors.toList()));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-meta">@ResponseStatus(value = HttpStatus.BAD_REQUEST)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title">onMethodArgumentNotValidException</span><span class="hljs-params">(MethodArgumentNotValidException exception)</span> </span>{<font></font>
        log.info(exception.getMessage());<font></font>
        List&lt;ErrorResponse.Message&gt; fieldErrors = exception.getBindingResult().getFieldErrors().stream()<font></font>
                .map(fieldError -&gt; <span class="hljs-keyword">new</span> ErrorResponse.Message(fieldError.getField() + <span class="hljs-string">" is invalid"</span>))<font></font>
                .collect(Collectors.toList());<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorResponse(fieldErrors);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@ExceptionHandler(DostavchenkoException.class)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title">onDostavchenkoCommunicationException</span><span class="hljs-params">(DostavchenkoException exception)</span> </span>{<font></font>
        log.error(<span class="hljs-string">"DostavchenKO communication exception"</span>, exception);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorResponse(Collections.singletonList(
                <span class="hljs-keyword">new</span> ErrorResponse.Message(<span class="hljs-string">"DostavchenKO communication exception"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@ExceptionHandler(DataCommunicationException.class)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title">onDataCommunicationException</span><span class="hljs-params">(DataCommunicationException exception)</span> </span>{<font></font>
        log.error(<span class="hljs-string">"DostavchenKO communication exception"</span>, exception);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorResponse(Collections.singletonList(
                <span class="hljs-keyword">new</span> ErrorResponse.Message(<span class="hljs-string">"Can't communicate with Data system"</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ErrorResponse <span class="hljs-title">onException</span><span class="hljs-params">(Exception exception)</span> </span>{<font></font>
        log.error(<span class="hljs-string">"Error while processing"</span>, exception);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ErrorResponse(Collections.singletonList(
                <span class="hljs-keyword">new</span> ErrorResponse.Message(HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase())));<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今何があったの？</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDDでは、すべてのコードを頭に置いておく必要はありません。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
繰り返しますが、アーキテクチャ全体をRAMに保持しないでください。 1つのレイヤーを見てください。彼は単純です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常のプロセスでは、多くの実装があるため、脳は十分ではありません。あなたが頭の中の大きなプロジェクトのすべてのニュアンスを考慮に入れることができるスーパーヒーローであるなら、TDDは必要ありません。私はそんなことはできません。プロジェクトが大きくなるほど、私はもっと誤解されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の層に必要なものだけを理解する必要があることに気づいた後、人生の悟りが訪れます。</font><font style="vertical-align: inherit;">実際には、このアプローチでは不要なことを行うことができません。</font><font style="vertical-align: inherit;">ここであなたは女の子と話しています。</font><font style="vertical-align: inherit;">彼女は職場での問題について何か言います。</font><font style="vertical-align: inherit;">そして、あなたはそれを解決する方法を考え、あなたの頭を悩ませます。</font><font style="vertical-align: inherit;">そして、彼女はそれを解決する必要はありません、彼女は伝える必要があります。</font><font style="vertical-align: inherit;">以上です。</font><font style="vertical-align: inherit;">彼女は何かを共有したかっただけです。</font><font style="vertical-align: inherit;">listen（）の最初の段階でこれについて学ぶことは貴重です。</font><font style="vertical-align: inherit;">他のすべてについて...まあ、あなたは知っています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/bk/fb/qxbkfb93hkn7folrvbn1pjd8hxm.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、サービスを実装します。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスから何が欲しいですか？</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは彼にビジネスロジックを処理してもらいたい、すなわち：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼は商品を切断する方法を知っていて、次のことについて</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も通知しました</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品が切断されていない場合、在庫があり、在庫があり、製品の色が黄色であり、DostavchenKOが配送可能です。</font></font></li>
<li>,         .</li>
<li>,   —  .</li>
<li>,  DostavchenKO   .</li>
<li>,    .</li>
<li> ,    ,  -   .</li>
<li> ,    DATA,     ,  :</li>
<li>         ,  ,    .</li>
<li>   ,    — .</li>
<li>    - … </li>
</ol><br>
<b>!</b><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/if/ek/y1/ifeky128w2kgpc2gw2jcxwvzkia.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのサービスがやりすぎだと思いませんか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィッシュリストから判断すると、彼は商品をオフにする方法を知っており、アクセシビリティを考慮し、以前に送信されたメッセージを送信しないようにします。これは高い結束度ではありません。異機種混在機能を異なるクラスに移動する必要があるため、すでに3つのサービスがあるはずです。1つは商品の切断を処理し、もう1つは配送の可能性を計算してそれをサービスに渡し、サービスが送信するかどうかを決定します。ちなみに、このようにして、ビジネスロジックサービスはDATAシステムについて何も認識しません。これも間違いなくプラスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の経験では、かなり頻繁に、実装に真っ向から行ったので、建築の瞬間を見失うことがよくあります。</font><font style="vertical-align: inherit;">何をすべきかを考えずにサービスをすぐに作成した場合、そして重要なことに、そうでない場合よりも、責任の領域が重複する可能性が高くなります。</font><font style="vertical-align: inherit;">実際に実際に起こったこの特定の例と、TDDの結果とシーケンシャルプログラミングアプローチの質的な違いがこの投稿を書くきっかけになったことを、私自身のために付け加えたいと思います。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビジネスの論理</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
凝集度が高いのと同じ理由でビジネスロジックサービスについて考えると、サービスと実際のDostavchenKOの間に別のレベルの抽象化が必要であることがわかります。</font><font style="vertical-align: inherit;">また、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">サービスを設計するので</font><font style="vertical-align: inherit;">、DostavchenKOクライアントから必要な内部契約を要求できます。</font><font style="vertical-align: inherit;">ビジネスロジックのテストを記述するプロセスでは、次のシグネチャを使用して、クライアントに何を求めているかを理解します。</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isAvailableForTransportation</span><span class="hljs-params">(Long productId)</span> </span>{...}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスレベルでは、実際のDostavchenKOがどのように応答するかは重要ではありません。将来的には、クライアントのタスクが何らかの形でこの情報を彼から取得することになります。</font><font style="vertical-align: inherit;">単純なこともあるかもしれませんが、いくつかの要求を行う必要がある場合もあります。現時点では、これから抽象化されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
切断された商品を処理するサービスから同様の署名が必要です。</font></font><br>
<br>
<pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isProductEnabled</span><span class="hljs-params">(Long productId)</span> </span>{...}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、「ビジネスロジックサービスに何が必要ですか？」という質問は、テストに記録され、次のようになります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービステスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RunWith(MockitoJUnitRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateProcessorServiceTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@InjectMocks</span>
    <span class="hljs-keyword">private</span> UpdateProcessorService updateProcessorService;<font></font>
<font></font>
    <span class="hljs-meta">@Mock</span>
    <span class="hljs-keyword">private</span> ManualExclusionService manualExclusionService;
    <span class="hljs-meta">@Mock</span>
    <span class="hljs-keyword">private</span> DostavchenkoClient dostavchenkoClient;
    <span class="hljs-meta">@Mock</span>
    <span class="hljs-keyword">private</span> AvailabilityNotifier availabilityNotifier;<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyAvailableIfYellowProductIsEnabledAndReadyForTransportation</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">10L</span>, <span class="hljs-string">"Yellow"</span>);<font></font>
<font></font>
        when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">true</span>);<font></font>
        when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword">new</span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword">true</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductIsAbsent</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">0L</span>, <span class="hljs-string">"Yellow"</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword">new</span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword">false</span>)));<font></font>
        verifyNoMoreInteractions(manualExclusionService);<font></font>
        verifyNoMoreInteractions(dostavchenkoClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductIsBlue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">10L</span>, <span class="hljs-string">"Blue"</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword">new</span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword">false</span>)));<font></font>
        verifyNoMoreInteractions(manualExclusionService);<font></font>
        verifyNoMoreInteractions(dostavchenkoClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductIsDisabled</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">10L</span>, <span class="hljs-string">"Yellow"</span>);<font></font>
<font></font>
        when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">false</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword">new</span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword">false</span>)));<font></font>
        verifyNoMoreInteractions(dostavchenkoClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyNotAvailableIfProductIsNotReadyForTransportation</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">10L</span>, <span class="hljs-string">"Yellow"</span>);<font></font>
<font></font>
        when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">false</span>);<font></font>
        when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword">new</span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword">false</span>)));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test(expected = DostavchenkoException.class)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">throwCustomExceptionIfDostavchenkoCommunicationFailed</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> Update testProduct = <span class="hljs-keyword">new</span> Update(<span class="hljs-number">1L</span>, <span class="hljs-number">10L</span>, <span class="hljs-string">"Yellow"</span>);<font></font>
<font></font>
        when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId()))<font></font>
                .thenThrow(<span class="hljs-keyword">new</span> RestClientException(<span class="hljs-string">"Something's wrong"</span>));<font></font>
        when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
        updateProcessorService.processUpdate(testProduct);<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階で、彼らは自分で生まれました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスに適したシンガチュラを備えたDostavchenKOクライアント</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遅延送信のロジックを実装する必要があるサービスで、設計されたサービスがその作業の結果を送信するサービス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切断された商品のサービスとその署名</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装：</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateProcessorService</span> </span>{<font></font>
    <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AvailabilityNotifier availabilityNotifier;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DostavchenkoClient dostavchenkoClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ManualExclusionService manualExclusionService;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processUpdate</span><span class="hljs-params">(Update update)</span> </span>{
        <span class="hljs-keyword">if</span> (update.getProductQuantity() &lt;= <span class="hljs-number">0</span>) {<font></font>
            availabilityNotifier.notify(getNotAvailableProduct(update.getProductId()));<font></font>
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"Blue"</span>.equals(update.getColor())) {<font></font>
            availabilityNotifier.notify(getNotAvailableProduct(update.getProductId()));<font></font>
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">if</span> (!manualExclusionService.isProductEnabled(update.getProductId())) {<font></font>
            availabilityNotifier.notify(getNotAvailableProduct(update.getProductId()));<font></font>
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> availableForTransportation = dostavchenkoClient.isAvailableForTransportation(update.getProductId());<font></font>
            availabilityNotifier.notify(<span class="hljs-keyword">new</span> ProductAvailability(update.getProductId(), availableForTransportation));<font></font>
        } <span class="hljs-keyword">catch</span> (Exception exception) {<font></font>
            log.warn(<span class="hljs-string">"Problems communicating with DostavchenKO"</span>, exception);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DostavchenkoException();<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> ProductAvailability <span class="hljs-title">getNotAvailableProduct</span><span class="hljs-params">(Long productId)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ProductAvailability(productId, <span class="hljs-keyword">false</span>);<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品を無効にする</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
避けられないTDDフェーズの1つであるリファクタリングの時が来ました。</font><font style="vertical-align: inherit;">覚えていると思いますが、コントローラーの実装後のサービスコントラクトは次のようになります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableProduct</span><span class="hljs-params">(<span class="hljs-keyword">long</span> productId)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、切断ロジックを別のサービスに移動することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階のこのサービスから、次のものが必要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">商品をオフにする機能。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼が以前に切断されていた場合、商品が切断されていることを彼に返してほしい。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前に接続が切断されていなかった場合は、製品が利用可能であることを彼に返してほしい。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスロジックサービスと計画されたサービスとの間の契約の直接的な結果であるウィッシュリストを見て、次のことに注意したいと思います。</font></font><br>
<br>
<ol>
<li>-,  ,      ,  -     , . .          .   , , ,      ,     .  ,              ,      ,           .      ,     ,      : ,         .</li>
<li>-,       .           —   ,         .  ,  , ,       ,      ,      , . . ProductAvailability.    ,      . . .,  ,   god object,    ,        ,      ,     TDD,          ,     .   ,  , «» —     : «    ...»     , ,  TDD,     .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストと実装は非常に簡単です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManualExclusionServiceTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ManualExclusionService service;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ManualExclusionRepository manualExclusionRepository;<font></font>
<font></font>
    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearDb</span><span class="hljs-params">()</span> </span>{<font></font>
        manualExclusionRepository.deleteAll();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableItem</span><span class="hljs-params">()</span> </span>{<font></font>
        Long productId = <span class="hljs-number">100L</span>;<font></font>
        service.disableProduct(productId);<font></font>
<font></font>
        assertThat(service.isProductEnabled(productId), is(<span class="hljs-keyword">false</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">returnEnabledIfProductWasNotDisabled</span><span class="hljs-params">()</span> </span>{<font></font>
        assertThat(service.isProductEnabled(<span class="hljs-number">100L</span>), is(<span class="hljs-keyword">true</span>));<font></font>
        assertThat(service.isProductEnabled(<span class="hljs-number">200L</span>), is(<span class="hljs-keyword">true</span>));<font></font>
    }<font></font>
<font></font>
}</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></b><div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManualExclusionService</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ManualExclusionRepository manualExclusionRepository;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isProductEnabled</span><span class="hljs-params">(Long productId)</span> </span>{
        <span class="hljs-keyword">return</span> !manualExclusionRepository.exists(productId);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disableProduct</span><span class="hljs-params">(<span class="hljs-keyword">long</span> productId)</span> </span>{<font></font>
        manualExclusionRepository.save(<span class="hljs-keyword">new</span> ManualExclusion(productId));<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイジー提出サービス</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最後のサービスに到達しました。これにより、DATAシステムが同じメッセージでスパムされないことが保証されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスロジックサービスの結果は既に転送されていること、つまりProductAvailabilityオブジェクトに転送されていることを思い出してください。このフィールドには、productIdとisAvailableの2つのフィールドしかありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古き良き伝統に従って、私たちはこのサービスから何が欲しいかについて考え始めます：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれにしても、初めて通知を送信する。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品の在庫状況が変更された場合に通知を送信します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そうでない場合は、何も送信しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サードパーティシステムへの送信が例外で終了した場合、例外の原因となった通知は送信済み通知のデータベースに含めないでください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、DATA側から実行する場合、サービスはDataCommunicationExceptionをスローする必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではすべてが単純ですが、1つ指摘しておきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前に送信したものに関する情報が必要です。つまり、商品の在庫状況に関する過去の計算を保存するリポジトリーがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProductAvailabilityオブジェクトは、少なくとも識別子がないため、保存に適していません。つまり、別の識別子を作成することが論理的です。</font><font style="vertical-align: inherit;">ここでの主なことは、この識別子を@Document（MongoDbをベースとして使用します）およびProductAvailability自体のインデックスと共に追加しないことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのフィールドすべてを持つProductAvailabilityオブジェクトが、現在設計しているものよりも呼び出し階層で上位のクラスを設計する段階で作成されたことを理解する必要があります。これらのクラスは、設計時にこの情報が必要なかったため、データベース固有のフィールドについて何も知る必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これはすべて話です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、ProductAvailabilityを使用して一連のテストを既に作成しているため、このサービスに転送するため、新しいフィールドを追加すると、これらのテストもリファクタリングする必要があり、多少の労力が必要になる場合があります。</font><font style="vertical-align: inherit;">つまり、すぐに実装を作成した場合よりも、ProductAvailabilityからgodオブジェクトを作成したい人がはるかに少なくなります。逆に、既存のオブジェクトにフィールドを追加する方が、別のクラスを作成するよりも簡単です。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta">@RunWith(SpringRunner.class)</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyAvailabilityNotifierTest</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LazyAvailabilityNotifier lazyAvailabilityNotifier;<font></font>
<font></font>
    <span class="hljs-meta">@MockBean</span>
    <span class="hljs-meta">@Qualifier("dataClient")</span>
    <span class="hljs-keyword">private</span> AvailabilityNotifier availabilityNotifier;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AvailabilityRepository availabilityRepository;<font></font>
<font></font>
    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearDb</span><span class="hljs-params">()</span> </span>{<font></font>
        availabilityRepository.deleteAll();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyIfFirstTime</span><span class="hljs-params">()</span> </span>{<font></font>
        sendNotificationAndVerifyDataBase(<span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">false</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyIfAvailabilityChanged</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> ProductAvailability oldProductAvailability = <span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">false</span>);<font></font>
        sendNotificationAndVerifyDataBase(oldProductAvailability);<font></font>
<font></font>
        <span class="hljs-keyword">final</span> ProductAvailability newProductAvailability = <span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">true</span>);<font></font>
        sendNotificationAndVerifyDataBase(newProductAvailability);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doNotNotifyIfAvailabilityDoesNotChanged</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">final</span> ProductAvailability productAvailability = <span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">false</span>);<font></font>
        sendNotificationAndVerifyDataBase(productAvailability);<font></font>
        sendNotificationAndVerifyDataBase(productAvailability);<font></font>
        sendNotificationAndVerifyDataBase(productAvailability);<font></font>
        sendNotificationAndVerifyDataBase(productAvailability);<font></font>
<font></font>
        verify(availabilityNotifier, only()).notify(eq(productAvailability));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doNotSaveIfSentWithException</span><span class="hljs-params">()</span> </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> RuntimeException()).when(availabilityNotifier).notify(anyObject());<font></font>
<font></font>
        <span class="hljs-keyword">boolean</span> exceptionThrown = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">try</span> {<font></font>
            availabilityNotifier.notify(<span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">false</span>));<font></font>
        } <span class="hljs-keyword">catch</span> (RuntimeException exception) {<font></font>
            exceptionThrown = <span class="hljs-keyword">true</span>;<font></font>
        }<font></font>
<font></font>
        assertTrue(<span class="hljs-string">"Exception was not thrown"</span>, exceptionThrown);<font></font>
        assertThat(availabilityRepository.findAll(), hasSize(<span class="hljs-number">0</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Test(expected = DataCommunicationException.class)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wrapDataException</span><span class="hljs-params">()</span> </span>{<font></font>
        doThrow(<span class="hljs-keyword">new</span> RestClientException(<span class="hljs-string">"Something wrong"</span>)).when(availabilityNotifier).notify(anyObject());<font></font>
<font></font>
        lazyAvailabilityNotifier.notify(<span class="hljs-keyword">new</span> ProductAvailability(<span class="hljs-number">1L</span>, <span class="hljs-keyword">false</span>));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendNotificationAndVerifyDataBase</span><span class="hljs-params">(ProductAvailability productAvailability)</span> </span>{<font></font>
<font></font>
        lazyAvailabilityNotifier.notify(productAvailability);<font></font>
<font></font>
        verify(availabilityNotifier).notify(eq(productAvailability));<font></font>
        assertThat(availabilityRepository.findAll(), hasSize(<span class="hljs-number">1</span>));<font></font>
        assertThat(availabilityRepository.findAll().get(<span class="hljs-number">0</span>),<font></font>
                hasProperty(<span class="hljs-string">"productId"</span>, is(productAvailability.getProductId())));<font></font>
        assertThat(availabilityRepository.findAll().get(<span class="hljs-number">0</span>),<font></font>
                hasProperty(<span class="hljs-string">"availability"</span>, is(productAvailability.isAvailable())));<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyAvailabilityNotifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AvailabilityNotifier</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AvailabilityRepository availabilityRepository;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AvailabilityNotifier availabilityNotifier;<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notify</span><span class="hljs-params">(ProductAvailability productAvailability)</span> </span>{
        <span class="hljs-keyword">final</span> AvailabilityPersistenceObject persistedProductAvailability = availabilityRepository<font></font>
                .findByProductId(productAvailability.getProductId());<font></font>
        <span class="hljs-keyword">if</span> (persistedProductAvailability == <span class="hljs-keyword">null</span>) {<font></font>
            notifyWith(productAvailability);<font></font>
            availabilityRepository.save(createObjectFromProductAvailability(productAvailability));<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (persistedProductAvailability.isAvailability() != productAvailability.isAvailable()) {<font></font>
            notifyWith(productAvailability);<font></font>
            persistedProductAvailability.setAvailability(productAvailability.isAvailable());<font></font>
            availabilityRepository.save(persistedProductAvailability);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyWith</span><span class="hljs-params">(ProductAvailability productAvailability)</span> </span>{
        <span class="hljs-keyword">try</span> {<font></font>
            availabilityNotifier.notify(productAvailability);<font></font>
        } <span class="hljs-keyword">catch</span> (RestClientException exception) {<font></font>
            log.error(<span class="hljs-string">"Couldn't notify"</span>, exception);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DataCommunicationException();<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> AvailabilityPersistenceObject <span class="hljs-title">createObjectFromProductAvailability</span><span class="hljs-params">(ProductAvailability productAvailability)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AvailabilityPersistenceObject(productAvailability.getProductId(), productAvailability.isAvailable());<font></font>
    }<font></font>
<font></font>
}</code></pre><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/cq/u-/eqcqu-xh6fu5mybs440rhhfob-g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様のアプリケーションを実際に作成する必要がありました。そして、最初はTDDなしで記述されていたことが判明し、その後、ビジネスはそれが不要であると述べ、6か月後に要件が変更され、もう一度ゼロから書き直すことが決定されました（メリットはマイクロサービスアーキテクチャであり、何かを捨てることはそれほど怖くはありませんでした）。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じアプリケーションを異なる手法で作成することで、それらの違いを理解できます。私の実務では、TDDがアーキテクチャの構築にどのように役立つかを見ました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その理由は、実装前のテストの作成ではなかったと考えられますが、最初にテストを作成したので、作成したクラスが何を行うかをまず考えます。また、実装はありませんが、呼び出されたオブジェクトで必要な正確なコントラクトを実際に「順序付け」できます。どこかにすばやく何かを追加して、同時に多くのタスクを処理するエンティティを取得するという誘惑はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、私にとってのTDDの主な利点の1つは、自分が生産する製品に本当に自信を持つことができたことを強調することができます。これは、TDDで記述された平均コードの方がテストでカバーされている可能性が高いという事実が原因である可能性がありますが、TDDで記述を開始した後、コードの編集回数が減少したのは、テストはほぼゼロです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、全体として、開発者としては上手くなった気がしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。それがどのように作成されたかを段階的に理解したい場合は、コミットの履歴に注意を払うことをお勧めします。その後、分析して、典型的なTDDアプリケーションの作成プロセスがより理解しやすくなることを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここはとても便利です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。TDDの世界に飛び込みたいと思うすべての人に視聴することを強くお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションコードは、jsonのようなフォーマットされた文字列を再利用します。</font><font style="vertical-align: inherit;">これは、アプリケーションがPOJOオブジェクトのjsonを解析する方法をチェックするために必要です。</font><font style="vertical-align: inherit;">IDEAを使用する場合、JSON言語のインジェクションを使用して、必要なフォーマットをすばやく簡単に行うことができます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このアプローチの欠点は何ですか？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発には長い時間がかかります。標準的なパラダイムでプログラミングすることで、私の同僚は、テストなしでテストするためにテスターに​​サービスを提供し、途中でそれらを追加する余裕ができました。とても速かった。 TDDではこれは機能しません。期限が厳しい場合、マネージャーは不幸になります。ここでは、すぐにうまくいくが、長い間、あまり良くないが速いというトレードオフがあります。結果として2番目の方が長いので、私は最初の方を自分で選択します。そして、大きな神経を使います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の考えでは、TDDは、多くのリファクタリングを行う必要がある場合には適していません。最初から作成したアプリケーションとは異なり、どの方法を最初に実行するかが明確でないためです。クラステストに取り組んでいることが判明する可能性があり、その結果、そのテストは削除されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TDDは特効薬ではありません。</font><font style="vertical-align: inherit;">これは、パフォーマンスの問題を引き起こす可能性のある、明確で読みやすいコードに関するストーリーです。</font><font style="vertical-align: inherit;">たとえば、Fowlerの場合と同様に、それぞれが独自のことを行うN個のクラスを作成しました。</font><font style="vertical-align: inherit;">そして、彼らの仕事をするために、彼らは全員が基地に行く必要があることがわかりました。</font><font style="vertical-align: inherit;">そして、データベースにN個のクエリがあります。</font><font style="vertical-align: inherit;">たとえば、1つの神のオブジェクトを作成して1回行く代わりに。</font><font style="vertical-align: inherit;">ミリ秒を争う場合、TDDを使用する場合はこれを考慮する必要があります。読み取り可能なコードが常に最速であるとは限りません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、この方法論に切り替えるのは非常に困難です。異なる考え方を身に付ける必要があります。</font><font style="vertical-align: inherit;">痛みのほとんどは最初の段階です。</font><font style="vertical-align: inherit;">1.5日間書いた最初の統合テスト。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、最後。</font><font style="vertical-align: inherit;">TDDを使用していて、コード</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がまだそれほどではない場合</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それから問題は方法論にないかもしれません。</font><font style="vertical-align: inherit;">しかし、それは私を助けました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/je/ix/2n/jeix2nwpo0ui_ehjeisprshkrvk.jpeg"></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja456650/index.html">バジェットポケットオシロスコープの選択</a></li>
<li><a href="../ja456652/index.html">時間は待たない：Windows 10タイムラインよりも犯罪者に役立ちます</a></li>
<li><a href="../ja456654/index.html">ERPプロジェクトは塗装されているのでそれほどひどくない</a></li>
<li><a href="../ja456656/index.html">SDL 2のレッスン：レッスン4-PNGのストレッチ</a></li>
<li><a href="../ja456658/index.html">成長：チームでのスキルの評価方法</a></li>
<li><a href="../ja456664/index.html">ロボットがあなたのお金を失ったときに誰を訴えるか</a></li>
<li><a href="../ja456666/index.html">WebTotemまたはインターネットをより安全にしたい方法</a></li>
<li><a href="../ja456668/index.html">Microsoft ML Spark：SparkMLをより人道的にするSpark拡張機能とボーナスとしてLightGBM</a></li>
<li><a href="../ja456670/index.html">超スパイ認証方式について</a></li>
<li><a href="../ja456672/index.html">Nginxレシピ：PostgreSQLからWebSocketへの非同期通知</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>