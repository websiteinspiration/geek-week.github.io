<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÑ ‚ùé ‚û°Ô∏è Laravel + Docker + Gitlab. D√≥nde empezar ü•ù ü§òüèø üï∞Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por lo general, siempre prescind√≠ de una ventana acoplable y pens√© que solo se necesita para proyectos grandes en grandes empresas. Pero un d√≠a vi c√≥m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Laravel + Docker + Gitlab. D√≥nde empezar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491532/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo general, siempre prescind√≠ de una ventana acoplable y pens√© que solo se necesita para proyectos grandes en grandes empresas. </font><font style="vertical-align: inherit;">Pero un d√≠a vi c√≥mo funciona un acoplador junto con el gitlab de un amigo y me di cuenta de que a√∫n deb√≠a estudiarlo. </font><font style="vertical-align: inherit;">Sin embargo, como suele suceder, no encontr√© un art√≠culo adecuado: eran demasiado complejos o incompletos, o implicaban que todos lo sab√≠an por s√≠ mismos. </font><font style="vertical-align: inherit;">Tuve que buscar varias fuentes durante mucho tiempo, ponerlo todo junto y al final logr√© hacer un proyecto simple y CI / CD para ello. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el trabajo se puede dividir en tres partes: en la m√°quina local, en el hitlab y en el servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, para la implementaci√≥n del proyecto, necesitamos una cuenta gitlab y un servidor remoto con virtualizaci√≥n KVM o XEN.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 1. M√°quina local</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la m√°quina local, debe instalar la ventana acoplable. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comentario</font></font></b><div class="spoiler_text">  . Docker     Linux  ( Ubuntu, ),    Windows  MacOS.   macos     ,     Windows      .   - ,        linux .   - ,           .       VirtualBox.          Ubuntu     <br>
</div></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalar en un entorno Linux, debe ejecutar los siguientes comandos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eliminar contenedores viejos:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualizar apto:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale los siguientes paquetes para poder descargar Docker desde el repositorio a trav√©s de https:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install \<font></font>
    apt-transport-https \<font></font>
    ca-certificates \<font></font>
    curl \<font></font>
    gnupg-agent \<font></font>
    software-properties-common</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue la clave de acoplamiento GPG oficial:</font></font><br>
<br>
<pre><code class="bash hljs">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aseg√∫rese de que la impresi√≥n sea correcta:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-key fingerprint 0EBFCD88</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Responder:</font></font><br>
<br>
<pre><code class="bash hljs">pub   rsa4096 2017-02-22 [SCEA]<font></font>
      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88<font></font>
uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;<font></font>
sub   rsa4096 2017-02-22 [S]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargar versi√≥n estable:</font></font><br>
<br>
<pre><code class="bash hljs">sudo add-apt-repository \
   <span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   <span class="hljs-subst">$(lsb_release -cs)</span> \
   stable"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualice apt nuevamente:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale el √∫ltimo motor acoplable:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install docker-ce docker-ce-cli containerd.io</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique la operaci√≥n del acoplador:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker run hello-world</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si todo es correcto, comenzar√° la descarga de la imagen Hello World. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrucciones completas en la documentaci√≥n oficial de la ventana acoplable</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n necesitamos instalar docker-compose. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La instrucci√≥n oficial est√° aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalarlo, ejecute los comandos en la terminal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargar desde el repositorio:</font></font><br>
<br>
<pre><code class="bash hljs">sudo curl -L <span class="hljs-string">"https://github.com/docker/compose/releases/download/1.25.4/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>"</span> -o /usr/<span class="hljs-built_in">local</span>/bin/docker-compose</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregar un ejercicio correcto:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chmod +x /usr/<span class="hljs-built_in">local</span>/bin/docker-compose</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificaci√≥n de versi√≥n:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker-compose --version</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalamos la ventana acoplable, ahora es necesario recopilar la imagen. </font><font style="vertical-align: inherit;">Para hacer esto, utilic√© el art√≠culo del sitio web digitalocean: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.digitalocean.com/community/tutorials/how-to-set-up-laravel-nginx-and-mysql-with-docker-compose-ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Habr√° una reimpresi√≥n de este art√≠culo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descarga de Laravel e instalaci√≥n de dependencias</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En el primer paso, descargamos la √∫ltima versi√≥n de Laravel e instalamos las dependencias del proyecto, incluido Composer, el administrador de paquetes PHP a nivel de aplicaci√≥n. </font><font style="vertical-align: inherit;">Instalaremos estas dependencias usando Docker para no realizar una instalaci√≥n global de Composer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vaya a su directorio de inicio y clone la √∫ltima versi√≥n de Laravel en un directorio llamado laravel-app:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> ~<font></font>
git <span class="hljs-built_in">clone</span> https://github.com/laravel/laravel.git laravel-app</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vaya al directorio laravel-app:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> ~/laravel-app</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego monte la imagen del compositor de Docker en los directorios que necesita para su proyecto Laravel para evitar la sobrecarga de instalar Composer globalmente:</font></font><br>
<br>
<pre><code class="bash hljs">docker run --rm -v $(<span class="hljs-built_in">pwd</span>):/app composer install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los indicadores -v y --rm del comando docker run crean un contenedor virtual que se une al directorio actual hasta que se elimina. </font><font style="vertical-align: inherit;">El contenido de su directorio ~ / laravel-app se copiar√° en el contenedor, y el contenido del Composer creado dentro del contenedor de la carpeta del proveedor se copiar√° en el directorio actual. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusi√≥n, establezca el nivel de permisos en el directorio del proyecto para que sea propiedad de un usuario sin privilegios de root:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chown -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> ~/laravel-app</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto ser√° importante cuando escriba el Dockerfile para la imagen de su aplicaci√≥n, ya que le permitir√° trabajar con el c√≥digo de la aplicaci√≥n e iniciar procesos en el contenedor sin privilegios de root. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora ha colocado el c√≥digo de la aplicaci√≥n y puede proceder a la definici√≥n de servicios utilizando Docker Compose. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear un archivo Docker Compose</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Crear aplicaciones con Docker Compose simplifica el proceso de configuraci√≥n y control de versiones en su infraestructura. Para personalizar nuestra aplicaci√≥n Laravel, crearemos un archivo docker-compose con la definici√≥n de servicios de servidor web, base de datos y aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abre el archivo:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/laravel-app/docker-compose.yml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se definen tres servicios en el archivo docker-compose: aplicaci√≥n, servidor web y db. </font><font style="vertical-align: inherit;">Agregue el siguiente c√≥digo al archivo, mientras reemplaza la contrase√±a de root para MYSQL_ROOT_PASSWORD, definida como la variable de entorno del servicio db, con una contrase√±a de su elecci√≥n:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">version: '3'<font></font>
services:<font></font>
<font></font>
  #PHP Service<font></font>
  app:<font></font>
    build:<font></font>
      context: .<font></font>
      dockerfile: Dockerfile<font></font>
    image: digitalocean.com/php<font></font>
    container_name: app<font></font>
    restart: unless-stopped<font></font>
    tty: true<font></font>
    environment:<font></font>
      SERVICE_NAME: app<font></font>
      SERVICE_TAGS: dev<font></font>
    working_dir: /var/www<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
  #Nginx Service<font></font>
  webserver:<font></font>
    image: nginx:alpine<font></font>
    container_name: webserver<font></font>
    restart: unless-stopped<font></font>
    tty: true<font></font>
    ports:<font></font>
      - "80:80"<font></font>
      - "443:443"<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
  #MySQL Service<font></font>
  db:<font></font>
    image: mysql:5.7.22<font></font>
    container_name: db<font></font>
    restart: unless-stopped<font></font>
    tty: true<font></font>
    ports:<font></font>
      - "3306:3306"<font></font>
    environment:<font></font>
      MYSQL_DATABASE: laravel<font></font>
      MYSQL_ROOT_PASSWORD: your_mysql_root_password<font></font>
      SERVICE_TAGS: dev<font></font>
      SERVICE_NAME: mysql<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
#Docker Networks<font></font>
networks:<font></font>
  app-network:<font></font>
    driver: bridge</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ se incluyen los siguientes servicios:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n: Esta definici√≥n de servicio contiene la aplicaci√≥n Laravel y lanza la imagen Docker personalizada, digitalocean.com/php. </font><font style="vertical-align: inherit;">Tambi√©n establece el par√°metro working_dir en el contenedor en / var / www.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor web: esta definici√≥n de servicio toma la imagen nginx: alpine de Docker y abre los puertos 80 y 443.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db: esta definici√≥n de servicio recupera la imagen mysql: 5.7.22 de Docker y define nuevas variables de entorno, incluida la base de datos laravel para su aplicaci√≥n y la contrase√±a ra√≠z para la base de datos. </font><font style="vertical-align: inherit;">Puede usar cualquier nombre de base de datos que desee, tambi√©n debe reemplazar your_mysql_root_password con su propia contrase√±a segura. </font><font style="vertical-align: inherit;">Esta definici√≥n de servicio tambi√©n asigna el puerto de host 3306 al puerto de contenedor 3306.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada propiedad container_name define un nombre de contenedor correspondiente al nombre del servicio. </font><font style="vertical-align: inherit;">Si no define esta propiedad, Docker le dar√° a cada contenedor nombres que consisten en el nombre de una persona hist√≥rica y una palabra aleatoria, separados por un gui√≥n bajo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para simplificar la interacci√≥n entre contenedores, los servicios se conectan a la red de conexi√≥n llamada app-network. La red de conexi√≥n utiliza un puente de software que permite que los contenedores conectados a esta red se comuniquen entre s√≠. El controlador de puente establece autom√°ticamente las reglas de host para que los contenedores en diferentes redes de conexi√≥n no puedan comunicarse directamente entre s√≠. Esto mejora la seguridad de la aplicaci√≥n porque solo los servicios relacionados pueden comunicarse entre s√≠. Tambi√©n significa que puede especificar diferentes redes y servicios que se conectan a funciones relacionadas: por ejemplo, los servicios de aplicaciones del cliente pueden usar la red frontend y los servicios del servidor pueden usar la red back-end.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, veamos c√≥mo agregar vol√∫menes y vincular im√°genes montadas a definiciones de servicio para guardar permanentemente los datos de la aplicaci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenamiento persistente de datos</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Docker tiene medios potentes y convenientes para el almacenamiento persistente de datos. </font><font style="vertical-align: inherit;">En nuestra aplicaci√≥n, utilizaremos vol√∫menes e im√°genes montadas para guardar permanentemente archivos de bases de datos, aplicaciones y configuraciones. </font><font style="vertical-align: inherit;">Los vol√∫menes proporcionan flexibilidad de copia de seguridad y preservaci√≥n al finalizar el ciclo de vida del contenedor, y las im√°genes montables montables simplifican los cambios de c√≥digo durante el desarrollo al reflejar de inmediato los cambios en los archivos o directorios host en los contenedores. </font><font style="vertical-align: inherit;">Usamos ambas opciones.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Advertencia!</font></font></b><div class="spoiler_text">             ,   ,        .      ,       Docker   .       .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defina el volumen denominado dbdata en el archivo docker-compose en la definici√≥n del servicio db para conservar la base de datos MySQL:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">...<font></font>
#MySQL Service<font></font>
db:<font></font>
  ...<font></font>
    volumes:<font></font>
      - dbdata:/var/lib/mysql<font></font>
    networks:<font></font>
      - app-network<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un volumen llamado dbdata se usa para guardar permanentemente el contenido de la carpeta / var / lib / mysql dentro del contenedor. </font><font style="vertical-align: inherit;">Esto le permite detener y reiniciar el servicio db sin perder datos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue una definici√≥n de volumen dbdata al final del archivo:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">...<font></font>
#Volumes<font></font>
volumes:<font></font>
  dbdata:<font></font>
    driver: local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esta definici√≥n, puede usar este volumen para diferentes servicios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego agregue el enlace de imagen de montaje al servicio db para los archivos de configuraci√≥n de MySQL:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">...<font></font>
#MySQL Service<font></font>
db:<font></font>
  ...<font></font>
    volumes:<font></font>
      - dbdata:/var/lib/mysql<font></font>
      - ./mysql/my.cnf:/etc/mysql/my.cnf<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta imagen montada vincula el archivo ~ / laravel-app / mysql / my.cnf al directorio /etc/mysql/my.cnf en el contenedor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego agregue las im√°genes montadas al servicio del servidor web. </font><font style="vertical-align: inherit;">Habr√° dos: uno para el c√≥digo de la aplicaci√≥n y otro para determinar la configuraci√≥n de Nginx</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">#Nginx Service<font></font>
webserver:<font></font>
  ...<font></font>
  volumes:<font></font>
      - ./:/var/www<font></font>
      - ./nginx/conf.d/:/etc/nginx/conf.d/<font></font>
  networks:<font></font>
      - app-network</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera imagen montada vincula el c√≥digo de la aplicaci√≥n en el directorio ~ / laravel-app al directorio / var / www dentro del contenedor. El archivo de configuraci√≥n, agregado a ~ / laravel-app / nginx / conf.d /, tambi√©n est√° montado en /etc/nginx/conf.d/ en el contenedor, lo que le permite agregar y cambiar el contenido del directorio de configuraci√≥n seg√∫n sea necesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusi√≥n, agregue los siguientes montajes de im√°genes montadas al servicio de la aplicaci√≥n para el c√≥digo de la aplicaci√≥n y los archivos de configuraci√≥n:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="xml hljs">#PHP Service<font></font>
app:<font></font>
  ...<font></font>
  volumes:<font></font>
       - ./:/var/www<font></font>
       - ./php/local.ini:/usr/local/etc/php/conf.d/local.ini<font></font>
  networks:<font></font>
      - app-network<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servicio de aplicaciones vincula la imagen montada de la carpeta ~ / laravel-app, que contiene el c√≥digo de la aplicaci√≥n, a la carpeta / var / www. Esto acelerar√° el proceso de desarrollo, ya que cualquier cambio en el directorio de la aplicaci√≥n local se reflejar√° inmediatamente en el contenedor. Tambi√©n vincula el archivo de configuraci√≥n PHP ~ / laravel-app / php / local.ini al archivo /usr/local/etc/php/conf.d/local.ini en el contenedor. M√°s tarde crear√° un archivo de configuraci√≥n PHP local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Su archivo docker-compose ahora se ver√° as√≠:</font></font><br>
<br>
<code>~/laravel-app/docker-compose.yml</code><br>
<br>
<pre><code class="bash hljs">version: <span class="hljs-string">'3'</span><font></font>
services:<font></font>
<font></font>
  <span class="hljs-comment">#PHP Service</span><font></font>
  app:<font></font>
    build:<font></font>
      context: .<font></font>
      dockerfile: Dockerfile<font></font>
    image: digitalocean.com/php<font></font>
    container_name: app<font></font>
    restart: unless-stopped<font></font>
    tty: <span class="hljs-literal">true</span><font></font>
    environment:<font></font>
      SERVICE_NAME: app<font></font>
      SERVICE_TAGS: dev<font></font>
    working_dir: /var/www<font></font>
    volumes:<font></font>
      - ./:/var/www<font></font>
      - ./php/local.ini:/usr/<span class="hljs-built_in">local</span>/etc/php/conf.d/local.ini<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
  <span class="hljs-comment">#Nginx Service</span><font></font>
  webserver:<font></font>
    image: nginx:alpine<font></font>
    container_name: webserver<font></font>
    restart: unless-stopped<font></font>
    tty: <span class="hljs-literal">true</span><font></font>
    ports:<font></font>
      - <span class="hljs-string">"80:80"</span>
      - <span class="hljs-string">"443:443"</span><font></font>
    volumes:<font></font>
      - ./:/var/www<font></font>
      - ./nginx/conf.d/:/etc/nginx/conf.d/<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
  <span class="hljs-comment">#MySQL Service</span><font></font>
  db:<font></font>
    image: mysql:5.7.22<font></font>
    container_name: db<font></font>
    restart: unless-stopped<font></font>
    tty: <span class="hljs-literal">true</span><font></font>
    ports:<font></font>
      - <span class="hljs-string">"3306:3306"</span><font></font>
    environment:<font></font>
      MYSQL_DATABASE: laravel<font></font>
      MYSQL_ROOT_PASSWORD: your_mysql_root_password<font></font>
      SERVICE_TAGS: dev<font></font>
      SERVICE_NAME: mysql<font></font>
    volumes:<font></font>
      - dbdata:/var/lib/mysql/<font></font>
      - ./mysql/my.cnf:/etc/mysql/my.cnf<font></font>
    networks:<font></font>
      - app-network<font></font>
<font></font>
<span class="hljs-comment">#Docker Networks</span><font></font>
networks:<font></font>
  app-network:<font></font>
    driver: bridge<font></font>
<span class="hljs-comment">#Volumes</span><font></font>
volumes:<font></font>
  dbdata:<font></font>
    driver: <span class="hljs-built_in">local</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear un Dockerfile</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Docker le permite definir el entorno dentro de contenedores individuales utilizando un Dockerfile. </font><font style="vertical-align: inherit;">Dockerfile le permite crear im√°genes personalizadas. </font><font style="vertical-align: inherit;">que puede usarse para instalar el software de aplicaci√≥n requerido y cambiar la configuraci√≥n seg√∫n sea necesario. </font><font style="vertical-align: inherit;">Puede transferir im√°genes creadas al Docker Hub o cualquier registro privado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El Dockerfile se ubicar√° en el directorio ~ / laravel-app. </font><font style="vertical-align: inherit;">Crea un archivo:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/laravel-app/Dockerfile</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este Dockerfile especificar√° la imagen base y los comandos e instrucciones necesarios para construir la imagen de la aplicaci√≥n Laravel. </font><font style="vertical-align: inherit;">Agregue el siguiente c√≥digo al archivo:</font></font><br>
<br>
<code>~/laravel-app/php/Dockerfile</code><br>
<br>
<pre><code class="xml hljs">FROM php:7.2-fpm<font></font>
<font></font>
# Copy composer.lock and composer.json<font></font>
COPY composer.lock composer.json /var/www/<font></font>
<font></font>
# Set working directory<font></font>
WORKDIR /var/www<font></font>
<font></font>
# Install dependencies<font></font>
RUN apt-get update &amp;&amp; apt-get install -y \<font></font>
    build-essential \<font></font>
    mysql-client \<font></font>
    libpng-dev \<font></font>
    libjpeg62-turbo-dev \<font></font>
    libfreetype6-dev \<font></font>
    locales \<font></font>
    zip \<font></font>
    jpegoptim optipng pngquant gifsicle \<font></font>
    vim \<font></font>
    unzip \<font></font>
    git \<font></font>
    curl<font></font>
<font></font>
# Clear cache<font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*<font></font>
<font></font>
# Install extensions<font></font>
RUN docker-php-ext-install pdo_mysql mbstring zip exif pcntl<font></font>
RUN docker-php-ext-configure gd --with-gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/<font></font>
RUN docker-php-ext-install gd<font></font>
<font></font>
# Install composer<font></font>
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer<font></font>
<font></font>
# Add user for laravel application<font></font>
RUN groupadd -g 1000 www<font></font>
RUN useradd -u 1000 -ms /bin/bash -g www www<font></font>
<font></font>
# Copy existing application directory contents<font></font>
COPY . /var/www<font></font>
<font></font>
# Copy existing application directory permissions<font></font>
COPY --chown=www:www . /var/www<font></font>
<font></font>
# Change current user to www<font></font>
USER www<font></font>
<font></font>
# Expose port 9000 and start php-fpm server<font></font>
EXPOSE 9000<font></font>
CMD ["php-fpm"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, el Dockerfile crea la imagen encima de la imagen de Docker php: 7.2-fpm. Esta es una imagen basada en una instancia instalada de PHP FastCGI PHP-FPM. Este archivo tambi√©n instala los paquetes necesarios para Laravel: mcrypt, pdo_mysql, mbstring e imagick with composer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La directiva RUN especifica comandos para actualizar, instalar y configurar par√°metros dentro de un contenedor, incluido un usuario dedicado y un grupo llamado www. La instrucci√≥n WORKDIR establece el directorio / var / www como el directorio de trabajo de la aplicaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crear un usuario y un grupo separados con derechos de acceso limitados reduce la vulnerabilidad al iniciar contenedores Docker, que de forma predeterminada se ejecutan con privilegios de root. En lugar de ejecutar este contenedor con privilegios de root, creamos un usuario www con permisos de lectura y escritura para la carpeta / var / www usando el comando COPY con el indicador --chown para copiar los permisos de la carpeta de la aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El comando EXPOSE abre el puerto 9000 en el contenedor para el servidor php-fpm. CMD indica el comando que debe ejecutarse despu√©s de crear el contenedor. Aqu√≠, CMD indica el comando php-fpm que inicia el servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando termine de hacer cambios, guarde el archivo y cierre el editor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede pasar a definir su configuraci√≥n de PHP. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de PHP</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ha definido la infraestructura en el archivo docker-compose, y ahora puede configurar el servicio PHP para que act√∫e como un procesador PHP para las solicitudes entrantes de Nginx. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar PHP, crear√° un archivo local.ini en la carpeta php. </font><font style="vertical-align: inherit;">Este es el archivo que ha vinculado al archivo /usr/local/etc/php/conf.d/local.ini en el contenedor de arriba. </font><font style="vertical-align: inherit;">La creaci√≥n de este archivo le permitir√° ignorar el archivo php.ini predeterminado que PHP lee en el inicio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crea un directorio php:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir ~/laravel-app/php</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego abra el archivo local.ini:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/laravel-app/php/local.ini</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demostrar la configuraci√≥n de PHP, agregaremos el siguiente c√≥digo para establecer los l√≠mites de tama√±o de carga de archivos:</font></font><br>
<br>
<code>~/laravel-app/php/local.ini</code><br>
<br>
<pre><code class="xml hljs">upload_max_filesize=40M<font></font>
post_max_size=40M</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las directivas upload_max_filesize y post_max_size establecen el tama√±o m√°ximo permitido de los archivos cargados y muestran c√≥mo configurar las configuraciones de php.ini desde el archivo local.ini. Puede insertar cualquier par√°metro de configuraci√≥n de PHP que desee ignorar en el archivo local.ini. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de Nginx</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Cuando configura el servicio PHP, puede modificar el servicio Nginx para usar PHP-FPM como un servidor FastCGI para servir contenido din√°mico. El servidor FastCGI se basa en un protocolo binario para la interacci√≥n de programas interactivos con un servidor web. Se puede encontrar informaci√≥n adicional en el art√≠culo "Comprensi√≥n e implementaci√≥n de proxies FastCGI en Nginx". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar Nginx, crear√° un archivo app.conf con la configuraci√≥n de servicios en la carpeta ~ / laravel-app / nginx / conf.d /. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero cree el directorio nginx / conf.d /:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p ~/laravel-app/nginx/conf.d</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego cree el archivo de configuraci√≥n app.conf:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/laravel-app/nginx/conf.d/app.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue el siguiente c√≥digo al archivo para configurar Nginx:</font></font><br>
<br>
<code>~/laravel-app/nginx/conf.d/app.conf</code><br>
<br>
<pre><code class="xml hljs">server {<font></font>
    listen 80;<font></font>
    index index.php index.html;<font></font>
    error_log  /var/log/nginx/error.log;<font></font>
    access_log /var/log/nginx/access.log;<font></font>
    root /var/www/public;<font></font>
    location ~ \.php$ {<font></font>
        try_files $uri =404;<font></font>
        fastcgi_split_path_info ^(.+\.php)(/.+)$;<font></font>
        fastcgi_pass app:9000;<font></font>
        fastcgi_index index.php;<font></font>
        include fastcgi_params;<font></font>
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<font></font>
        fastcgi_param PATH_INFO $fastcgi_path_info;<font></font>
    }<font></font>
    location / {<font></font>
        try_files $uri $uri/ /index.php?$query_string;<font></font>
        gzip_static on;<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El bloque de servidor configura el servidor web Nginx usando las siguientes directivas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listen: esta directiva define el puerto que el servidor escucha para las solicitudes entrantes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error_log y access_log: estas directivas definen archivos para el registro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root: esta directiva establece la ruta a la carpeta ra√≠z, formando la ruta completa para cualquier archivo solicitado en el sistema de archivos local.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el bloque de ubicaci√≥n php, la directiva fastcgi_pass indica que el servicio de la aplicaci√≥n est√° escuchando en un socket TCP en el puerto 9000. Con √©l, el servidor PHP-FPM escucha en la red, no en el socket Unix. Aunque el socket Unix proporciona una ligera ventaja de velocidad sobre el socket TCP, no tiene un protocolo de red y omite la pila de red. En los casos en que los hosts se encuentran en el mismo sistema, puede tener sentido usar un socket Unix, pero si los servicios se ejecutan en diferentes hosts, el socket TCP proporciona una ventaja al permitirle conectarse a servicios distribuidos. Dado que nuestros contenedores de aplicaciones y servidores web se ejecutan en diferentes hosts, es m√°s eficiente usar un socket TCP en nuestra configuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando termine de hacer cambios, guarde el archivo y cierre el editor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias al enlace creado anteriormente, cualquier cambio en la carpeta nginx / conf.d / se refleja directamente en el contenedor del servidor web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos los par√°metros de MySQL. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n de MySQL</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s de configurar PHP y Nginx, puede activar MySQL como una base de datos para su aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar MySQL, debe crear el archivo my.cnf en la carpeta mysql. </font><font style="vertical-align: inherit;">Este es el archivo que adjunt√≥ al archivo /etc/mysql/my.cnf dentro del contenedor durante el paso de configuraci√≥n de la base de datos. </font><font style="vertical-align: inherit;">Montar la imagen montada le permite ignorar cualquier opci√≥n my.cnf, si es necesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para demostrar c√≥mo funciona esto, agregaremos configuraciones a my.cnf que incluyen el registro de solicitud general y configuraremos el archivo de registro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crea un directorio mysql:</font></font><br>
<br>
<pre><code class="bash hljs">mkdir ~/laravel-app/mysql</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree el archivo my.cnf:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/laravel-app/mysql/my.cnf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue el siguiente c√≥digo al archivo para activar el registro de consultas y establezca la ubicaci√≥n del archivo de registro:</font></font><br>
<br>
<code>~/laravel-app/mysql/my.cnf</code><br>
<br>
<pre><code class="xml hljs">[mysqld]<font></font>
general_log = 1<font></font>
general_log_file = /var/lib/mysql/general.log</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo my.cnf admite registros al establecer el par√°metro general_log en 1, que habilita los registros generales. </font><font style="vertical-align: inherit;">El par√°metro general_log_file especifica d√≥nde se almacenar√°n los registros. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio de contenedores y cambio de la configuraci√≥n del entorno</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Defini√≥ todos los servicios en el archivo docker-compose y cre√≥ archivos de configuraci√≥n para estos servicios. </font><font style="vertical-align: inherit;">Ahora puedes ejecutar contenedores. </font><font style="vertical-align: inherit;">En conclusi√≥n, crearemos una copia del archivo .env.example que Laravel incluye por defecto y lo llamaremos .env, ya que Laravel usa dicho archivo para determinar el entorno:</font></font><br>
<br>
<pre><code class="bash hljs">cp .env.example .env</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de iniciar los contenedores, configuraremos par√°metros de instalaci√≥n espec√≠ficos en este archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora todos sus servicios est√°n definidos en el archivo docker-compose, y solo necesita ejecutar un comando para iniciar todos los contenedores, crear vol√∫menes y configurar y conectar redes:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose up -d</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera vez que inicie Docker-compose, se descargar√°n todas las im√°genes Docker necesarias, lo que puede llevar alg√∫n tiempo. </font><font style="vertical-align: inherit;">Despu√©s de descargar las im√°genes y guardarlas en la computadora local, Compose crear√° sus contenedores. </font><font style="vertical-align: inherit;">El indicador -d convierte el proceso en un demonio con el que los contenedores permanecen ejecut√°ndose en segundo plano. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez que se complete el proceso, use el siguiente comando para enumerar todos los contenedores en ejecuci√≥n:</font></font><br>
<pre><code class="bash hljs">docker ps</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ver√° los siguientes resultados con datos sobre la aplicaci√≥n, el servidor web y los contenedores db:</font></font><br>
<br>
<pre><code class="bash hljs">Output<font></font>
CONTAINER ID        NAMES               IMAGE                             STATUS              PORTS<font></font>
c31b7b3251e0        db                  mysql:5.7.22                      Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp<font></font>
ed5a69704580        app                 digitalocean.com/php              Up 2 seconds        9000/tcp<font></font>
5ce4ee31d7c0        webserver           nginx:alpine                      Up 2 seconds        0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En estos resultados, la ID DE CONTENEDOR es un identificador √∫nico para cada contenedor, y NAMES enumera los nombres de servicio para cada contenedor. </font><font style="vertical-align: inherit;">Puede usar ambos identificadores para acceder a los contenedores. </font><font style="vertical-align: inherit;">IMAGE define el nombre de la imagen de cada contenedor, y STATUS proporciona informaci√≥n sobre el estado del contenedor: iniciado, reiniciado o detenido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede modificar el archivo .env en el contenedor de la aplicaci√≥n para agregar par√°metros espec√≠ficos a su sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra el archivo con docker-compose exec, que le permite ejecutar comandos espec√≠ficos en contenedores. </font><font style="vertical-align: inherit;">En este caso, abre el archivo para editarlo:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose <span class="hljs-built_in">exec</span> app nano .env</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Localice el bloque que especifica DB_CONNECTION y actual√≠celo para reflejar la configuraci√≥n de su sistema. </font><font style="vertical-align: inherit;">Cambiar√°s los siguientes campos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_HOST ser√° su contenedor de base de datos db.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_DATABASE ser√° la base de datos laravel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_USERNAME ser√° el nombre de usuario para su base de datos. </font><font style="vertical-align: inherit;">En este caso, usaremos laraveluser.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_PASSWORD ser√° una contrase√±a protegida para esta cuenta de usuario.</font></font></li>
</ol><br>
<code>/var/www/.env</code><br>
<br>
<pre><code class="xml hljs">DB_CONNECTION=mysql<font></font>
DB_HOST=db<font></font>
DB_PORT=3306<font></font>
DB_DATABASE=laravel<font></font>
DB_USERNAME=laraveluser<font></font>
DB_PASSWORD=your_laravel_db_password</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n es necesario corregir las mismas variables en el archivo .env.example, ya que se utilizar√° m√°s adelante cuando se implemente en el servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego configure la clave de aplicaci√≥n para Laravel con la clave php artisan: generate command. </font><font style="vertical-align: inherit;">Este comando generar√° una clave y la copiar√° al archivo .env, que proteger√° las sesiones de usuario y los datos cifrados:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose <span class="hljs-built_in">exec</span> app php artisan key:generate</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tiene todas las configuraciones de entorno necesarias para ejecutar la aplicaci√≥n. </font><font style="vertical-align: inherit;">Para almacenar en cach√© estas configuraciones en un archivo que acelere la carga de la aplicaci√≥n, ejecute el comando:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose <span class="hljs-built_in">exec</span> app php artisan config:cache</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci√≥n se cargar√° en el archivo /var/www/bootstrap/cache/config.php en el contenedor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, abra el sitio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en su navegador </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se abre la p√°gina principal de la aplicaci√≥n Laravel. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creaci√≥n de un usuario MySQL</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al instalar MySQL, de manera predeterminada solo se crea una cuenta ra√≠z administrativa con privilegios ilimitados para acceder al servidor de la base de datos. </font><font style="vertical-align: inherit;">Cuando se trabaja con una base de datos, generalmente es mejor evitar el uso de una cuenta ra√≠z administrativa. </font><font style="vertical-align: inherit;">En su lugar, crearemos un usuario de base de datos especial para la base de datos Laravel de nuestra aplicaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para crear un nuevo usuario, inicie el shell interactivo bash en el contenedor db usando el comando docker-compose exec:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose <span class="hljs-built_in">exec</span> db bash</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro del contenedor, inicie sesi√≥n en la cuenta administrativa ra√≠z de MySQL:</font></font><br>
<br>
<pre><code class="sql hljs">mysql -u root -p</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se le pedir√° que ingrese la contrase√±a especificada para la cuenta ra√≠z de MySQL cuando est√© instalada en el archivo docker-compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, verifique la base de datos laravel definida en el archivo docker-compose. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute el comando show bases de datos para verificar las bases de datos existentes:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">show</span> <span class="hljs-keyword">databases</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los resultados, deber√≠a ver la base de datos laravel:</font></font><br>
<br>
<pre><code class="bash hljs">Output<font></font>
+--------------------+<font></font>
| Database           |<font></font>
+--------------------+<font></font>
| information_schema |<font></font>
| laravel            |<font></font>
| mysql              |<font></font>
| performance_schema |<font></font>
| sys                |<font></font>
+--------------------+<font></font>
5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego cree una cuenta de usuario que tendr√° acceso a esta base de datos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos el nombre de usuario laraveluser, pero puede reemplazarlo con cualquier nombre preferido. </font><font style="vertical-align: inherit;">Solo aseg√∫rese de que el nombre de usuario y la contrase√±a coincidan con los del archivo .env en el paso anterior:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">ON</span> laravel.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'laraveluser'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">IDENTIFIED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">'your_laravel_db_password'</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Privilegios de actualizaci√≥n para notificar cambios al servidor MySQL:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">FLUSH</span> <span class="hljs-keyword">PRIVILEGES</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cerrar MySQL:</font></font><br>
<br>
<pre><code class="sql hljs">EXIT;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salir del contenedor:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">exit</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede hacer la migraci√≥n para probar la base de datos:</font></font><br>
<br>
<pre><code class="bash hljs">docker-compose <span class="hljs-built_in">exec</span> app php artisan migrate</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados de la confirmaci√≥n de la migraci√≥n son los siguientes:</font></font><br>
<br>
<pre><code class="bash hljs">Output<font></font>
<font></font>
Migration table created successfully.<font></font>
Migrating: 2014_10_12_000000_create_users_table<font></font>
Migrated:  2014_10_12_000000_create_users_table<font></font>
Migrating: 2014_10_12_100000_create_password_resets_table<font></font>
Migrated:  2014_10_12_100000_create_password_resets_table</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 2. Gitlab</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Hitlab, debe crear un nuevo proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesitamos guardar el proyecto en el repositorio de hitlab. </font><font style="vertical-align: inherit;">Para hacer esto, llame a los siguientes comandos desde la carpeta del proyecto en la m√°quina local:</font></font><br>
<br>
<pre><code class="bash hljs">git init<font></font>
git remote add origin git@gitlab.com:&lt;&gt;/&lt;&gt;  <font></font>
git remote add origin https://gitlab.com/&lt;&gt;/&lt;&gt;      SSH<font></font>
git add .<font></font>
git commit -m <span class="hljs-string">"Initial commit"</span>
git push -u origin master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El proyecto debe aparecer en Descripci√≥n general del proyecto -&gt; Detalles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que sea conveniente obtener de inmediato el entorno terminado, guardamos la imagen acoplable del entorno en el registro de la lista de resultados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, debes hacer:</font></font><br>
<br>
<pre><code class="bash hljs">docker login registry.gitlab.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y arroja la imagen en gitlab:</font></font><br>
<br>
<pre><code class="bash hljs">docker build -t registry.gitlab.com/&lt;&gt;/&lt;&gt; .<font></font>
docker push registry.gitlab.com/&lt;&gt;/&lt;&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La imagen se ubicar√° en Paquetes-&gt; Registro de contenedores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para finalizar con gitlab, obtenemos inmediatamente la clave para gitlab-runner. </font><font style="vertical-align: inherit;">Para hacer esto, vaya a Configuraci√≥n-&gt; CI / CD-&gt; Runner. </font><font style="vertical-align: inherit;">La clave se encuentra en el paso 3 en la secci√≥n Configuraci√≥n manual (Configurar un Runner espec√≠fico manualmente).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte 3. Configuraci√≥n del servidor</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servidor VPS debe tomarse con el tipo de virtualizaci√≥n KVM o XEN. </font><font style="vertical-align: inherit;">La virtualizaci√≥n como OpenVZ comparte el n√∫cleo del sistema entre todos los usuarios, por lo que no tiene la capacidad de cambiar los par√°metros del kernel. </font><font style="vertical-align: inherit;">Para la prueba, tom√© el servidor KVM con Docker preinstalado. </font><font style="vertical-align: inherit;">Sin embargo, puede que no haya una ventana acoplable en el servidor. </font><font style="vertical-align: inherit;">En este caso, debe instalarlo manualmente. </font><font style="vertical-align: inherit;">El algoritmo es el mismo que cuando se instala en la m√°quina local. </font><font style="vertical-align: inherit;">Tambi√©n es necesario verificar la versi√≥n de php. </font><font style="vertical-align: inherit;">Para Laravel necesitas al menos 7.2. </font><font style="vertical-align: inherit;">Tambi√©n tuve que instalar por separado la extensi√≥n para php ext-mbstring (en mi caso para php 7.3):</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update<font></font>
sudo apt-get install php7.3-mbstring<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, necesitamos instalar gitlab-runner. </font><font style="vertical-align: inherit;">Runner es un servicio que aceptar√° un webhook de un hitlab al recibir una nueva versi√≥n y desplegar√° todo en nuestro servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalar gitlab-runner debes hacer:</font></font><br>
<br>
<pre><code class="bash hljs">curl -L --output /usr/<span class="hljs-built_in">local</span>/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la descarga, configure el permiso para ejecutar:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chmod +x /usr/<span class="hljs-built_in">local</span>/bin/gitlab-runner
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, cree el usuario gitlab-runner y ejecute el servicio gitlab runner:</font></font><br>
<br>
<pre><code class="bash hljs">sudo useradd --comment <span class="hljs-string">'GitLab Runner'</span> --create-home gitlab-runner --shell /bin/bash<font></font>
sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner<font></font>
sudo gitlab-runner start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Registrarse corredor. </font><font style="vertical-align: inherit;">Para hacer esto, necesitamos el token de la parte 2 de este art√≠culo:</font></font><br>
<br>
<pre><code class="bash hljs">sudo gitlab-runner register</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En respuesta, le pedir√°n la direcci√≥n de su hitlab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especifique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gitlab.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )<font></font>
https://gitlab.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debe ingresar el token. </font><font style="vertical-align: inherit;">Ingrese el token de la parte 2.</font></font><br>
<br>
<pre><code class="bash hljs">Please enter the gitlab-ci token <span class="hljs-keyword">for</span> this runner<font></font>
xxx<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, especifique una descripci√≥n y etiquetas separadas por comas. </font><font style="vertical-align: inherit;">Entonces se nos ofrece elegir un albacea. </font><font style="vertical-align: inherit;">Aqu√≠ debe seleccionar un shell:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
Please enter the executor:<font></font>
shell</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n tengo entendido, el ejecutor es un entorno en el que se ejecuta el c√≥digo del archivo .gitlab-ci.yml. </font><font style="vertical-align: inherit;">Hay bash, ssh, docker, paralelos, virtualbox y kubernets para elegir. </font><font style="vertical-align: inherit;">La documentaci√≥n recomienda que si no sabe qu√© usar, use bash. </font><font style="vertical-align: inherit;">Esta es una opci√≥n universal que se ejecuta en la l√≠nea de comandos de su servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego necesitamos agregar el usuario gitlab-runner al grupo de usuarios de docker.</font></font><br>
<br>
<pre><code class="bash hljs">sudo usermod -aG docker gitlab-runner</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar errores de acceso, agregue a sudoers</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /etc/sudoers</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
l√≠nea </font></font><br>
<br>
<pre><code class="bash hljs">gitlab-runner ALL=(ALL) NOPASSWD: ALL</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora podemos crear el archivo .gitlab-ci.yml. </font><font style="vertical-align: inherit;">Es necesario para la ejecuci√≥n del llamado Pipeline: una secuencia de comandos para implementar un proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, vaya al repositorio del proyecto en la lista de resultados y haga clic en Crear un nuevo archivo. </font><font style="vertical-align: inherit;">El propio Gitlab ofrecer√° plantillas de archivos, entre ellas debe seleccionar .gitlab-ci.yml. </font><font style="vertical-align: inherit;">Despu√©s de crear un archivo en el gitlab, es posible seleccionar una plantilla para el contenido del archivo. </font><font style="vertical-align: inherit;">Eleg√≠ laravel y lo rehice un poco para m√≠:</font></font><br>
<br>
<pre><code class="xml hljs"><font></font>
# This file is a template, and might need editing before it works on your project.<font></font>
# Official framework image. Look for the different tagged releases at:<font></font>
# https://hub.docker.com/r/library/php<font></font>
# .    ,        <font></font>
image: registry.gitlab.com/<span class="hljs-tag">&lt;<span class="hljs-name"></span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name"></span>&gt;</span>:latest<font></font>
<font></font>
# Pick zero or more services to be used on all builds.<font></font>
# Only needed when using a docker container to run your tests in.<font></font>
# Check out: http://docs.gitlab.com/ce/ci/docker/using_docker_images.html#what-is-a-service<font></font>
services:<font></font>
  - mysql:latest<font></font>
#    <font></font>
variables:<font></font>
  MYSQL_DATABASE: laravel<font></font>
  MYSQL_ROOT_PASSWORD: ***********<font></font>
<font></font>
# This folder is cached between builds<font></font>
# ,      <font></font>
# http://docs.gitlab.com/ce/ci/yaml/README.html#cache<font></font>
cache:<font></font>
  paths:<font></font>
    - vendor/<font></font>
    - node_modules/<font></font>
<font></font>
# This is a basic example for a gem or script which doesn't use<font></font>
# services such as redis or postgres<font></font>
#     <font></font>
before_script:<font></font>
  #   <font></font>
  - sudo apt-get update -yqq<font></font>
  #    nodejs<font></font>
  - sudo apt-get install gnupg -yqq<font></font>
  #  Node   12<font></font>
  - curl -sL https://deb.nodesource.com/setup_12.x | sudo bash -<font></font>
  #  <font></font>
  - sudo apt-get install git nodejs libcurl4-gnutls-dev libicu-dev libmcrypt-dev libvpx-dev libjpeg-dev libpng-dev libxpm-dev zlib1g-dev libfreetype6-dev libxml2-dev libexpat1-dev libbz2-dev libgmp3-dev libldap2-dev unixodbc-dev libpq-dev libsqlite3-dev libaspell-dev libsnmp-dev libpcre3-dev libtidy-dev -yqq<font></font>
  #  composer<font></font>
  - curl -sS https://getcomposer.org/installer | php<font></font>
  - php composer.phar install<font></font>
  - composer install<font></font>
  #   Node<font></font>
  - npm install<font></font>
  # Copy over testing configuration.<font></font>
  # Don't forget to set the database config in .env.testing correctly<font></font>
  - DB_HOST=mysql<font></font>
  - DB_DATABASE=laravel<font></font>
  - DB_USERNAME=root<font></font>
  - DB_PASSWORD=*********<font></font>
  #  .env.example    .env<font></font>
  - cp .env.example .env<font></font>
  #  npm build<font></font>
  - npm run dev<font></font>
  #       laravel<font></font>
  - php artisan key:generate<font></font>
  - php artisan config:cache<font></font>
  - php artisan route:clear<font></font>
  - php artisan config:clear<font></font>
  - php artisan cache:clear<font></font>
  #  .<font></font>
  - docker-compose exec app php artisan migrate<font></font>
  #   <font></font>
  #- docker-compose exec app php artisan db:seed<font></font>
<font></font>
#<font></font>
test:<font></font>
  script:<font></font>
    #  <font></font>
    - php vendor/bin/phpunit --coverage-text --colors=never<font></font>
    #  npm<font></font>
    - npm test<font></font>
<font></font>
#       <font></font>
deploying:<font></font>
  stage: deploy<font></font>
  script:<font></font>
    - echo "Deployed"<font></font>
    - docker-compose stop<font></font>
    - docker-compose up -d<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de ejecutar con √©xito la canalizaci√≥n (CI / CD-&gt; Canalizaciones) en la direcci√≥n IP de su servidor, deber√≠a ver su p√°gina laravel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para configurar CI / CD, utilic√© las instrucciones de Sean Bradley:</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/RV0845KmsNI</font></font></a></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">medium.com/@sean_bradley/auto-devops-with-gitlab-ci-and-docker-compose-f931233f080f</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es491520/index.html">Convierta xls a xlsx y xml en C #</a></li>
<li><a href="../es491522/index.html">¬øPor qu√© las mujeres viven m√°s?</a></li>
<li><a href="../es491524/index.html">Stas Afanasyev. Juno Tuber√≠as basadas en io.Reader / io.Writer. Parte 2</a></li>
<li><a href="../es491528/index.html">Mi experiencia es realizar 1000 entrevistas. Sinopsis del informe de Yegor Bugaenko</a></li>
<li><a href="../es491530/index.html">Una vez m√°s, unos 433 MHz transmisores y receptores</a></li>
<li><a href="../es491534/index.html">Una breve gu√≠a para usar GDB</a></li>
<li><a href="../es491536/index.html">YouTube: error. Por favor, int√©ntelo de nuevo m√°s tarde. ID de reproducci√≥n: <...></a></li>
<li><a href="../es491540/index.html">Redes para un especialista en TI novato. Base obligatoria</a></li>
<li><a href="../es491542/index.html">Transformaci√≥n de color: b√∫squedas de tabla de adelgazamiento</a></li>
<li><a href="../es491544/index.html">Qu√© leer en el fin de semana restante: libros sobre virus, piratas inform√°ticos y la historia del cartel "digital"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>