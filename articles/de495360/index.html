<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü©Ô∏è ü§õüèª üö§ Wie wir die Portierung von Produkten von C # nach C ++ automatisiert haben üç§ üèÅ ‚ò¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr. In diesem Beitrag werde ich dar√ºber sprechen, wie wir es geschafft haben, eine monatliche Ver√∂ffentlichung von Bibliotheken f√ºr die C ++ -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie wir die Portierung von Produkten von C # nach C ++ automatisiert haben</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr. </font><font style="vertical-align: inherit;">In diesem Beitrag werde ich dar√ºber sprechen, wie wir es geschafft haben, eine monatliche Ver√∂ffentlichung von Bibliotheken f√ºr die C ++ - Sprache zu organisieren, deren Quellcode in C # entwickelt wurde. </font><font style="vertical-align: inherit;">Hier geht es nicht um verwaltetes C ++ oder gar um das Erstellen einer Br√ºcke zwischen nicht verwaltetem C ++ und der CLR-Umgebung. Es geht um die Automatisierung der C ++ - Codegenerierung, bei der die API und die Funktionalit√§t des urspr√ºnglichen C # -Codes wiederholt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die notwendige Infrastruktur f√ºr die √úbersetzung von Code zwischen Sprachen und die Emulation der Funktionen der .Net-Bibliothek selbst geschrieben und damit ein Problem gel√∂st, das normalerweise als akademisch angesehen wird. Auf diese Weise konnten wir auch monatliche Versionen von Pre-Donets-Produkten f√ºr die C ++ - Sprache ver√∂ffentlichen und den Code f√ºr jede Version aus der entsprechenden Version des C # -Codes abrufen. Gleichzeitig werden die Tests, die den urspr√ºnglichen Code abdeckten, mit portiert, sodass Sie die Leistung der resultierenden L√∂sung zusammen mit speziell geschriebenen Tests in C ++ steuern k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werde ich kurz die Geschichte unseres Projekts und die darin verwendeten Technologien beschreiben. </font><font style="vertical-align: inherit;">Ich werde die Fragen der wirtschaftlichen Rechtfertigung nur am Rande ansprechen, da die technische Seite f√ºr mich viel interessanter ist. </font><font style="vertical-align: inherit;">In den folgenden Artikeln der Reihe m√∂chte ich mich mit Themen wie Codegenerierung und Speicherverwaltung sowie einigen anderen befassen, wenn die Community relevante Fragen hat.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrund</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zun√§chst befasste sich unser Unternehmen mit der Freigabe von Bibliotheken f√ºr die .Net-Plattform. </font><font style="vertical-align: inherit;">Diese Bibliotheken bieten haupts√§chlich APIs f√ºr die Arbeit mit einigen Dateiformaten (Dokumente, Tabellen, Folien, Grafiken) und Protokollen (E-Mail), die eine bestimmte Marktl√ºcke f√ºr solche L√∂sungen einnehmen. </font><font style="vertical-align: inherit;">Die gesamte Entwicklung wurde in C # durchgef√ºhrt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ende der 2000er Jahre beschloss das Unternehmen, in einen neuen Markt einzutreten und √§hnliche Produkte f√ºr Java herauszubringen. Die Entwicklung von Grund auf w√ºrde offensichtlich eine Investition von Ressourcen erfordern, die mit der anf√§nglichen Entwicklung aller betroffenen Produkte vergleichbar ist. Die Option, den Donnet-Code in eine Ebene zu packen, die Aufrufe und Daten von Java nach .Net und umgekehrt √ºbersetzt, wurde aus bestimmten Gr√ºnden ebenfalls abgelehnt. Stattdessen wurde die Frage gestellt, ob es in irgendeiner Weise m√∂glich ist, vorhandenen Code vollst√§ndig auf die neue Plattform zu migrieren. Dies war umso relevanter, als es sich nicht um eine einmalige Aktion handelte, sondern um eine monatliche Ver√∂ffentlichung neuer Versionen jedes Produkts, die zwischen zwei Sprachen synchronisiert waren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde beschlossen, die Entscheidung in zwei Teile zu teilen. </font><font style="vertical-align: inherit;">Der erste - der sogenannte Porter - w√ºrde die C # -Quellcodesyntax in Java konvertieren und gleichzeitig .NET-Typen und -Methoden durch ihre Gegenst√ºcke aus Java-Bibliotheken ersetzen. </font><font style="vertical-align: inherit;">Die zweite - die Bibliothek - w√ºrde die Arbeit jener Teile der .Net-Bibliothek emulieren, f√ºr die es schwierig oder unm√∂glich ist, eine direkte Korrespondenz mit Java herzustellen, und daf√ºr verf√ºgbare Komponenten von Drittanbietern anziehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die grunds√§tzliche Durchf√ºhrbarkeit eines solchen Plans sprach Folgendes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ideologisch sind die Sprachen C # und Java ziemlich √§hnlich - zumindest hinsichtlich der Typstruktur und Organisation der Arbeit mit dem Speicher;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ging darum, Bibliotheken zu portieren, die GUI musste nicht portiert werden.</font></font></li>
<li>  ,  , -    ,        System.Net  System.Drawing;</li>
<li>   ,        .Net ( Framework,   Standard   Xamarin),          .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde nicht auf Details eingehen, da sie einen separaten Artikel verdienen (und keinen). </font><font style="vertical-align: inherit;">Ich kann nur sagen, dass es vom Beginn der Entwicklung bis zur Ver√∂ffentlichung des ersten Java-Produkts ungef√§hr zwei Jahre gedauert hat, und seitdem ist die Ver√∂ffentlichung von Java-Produkten eine regelm√§√üige Praxis des Unternehmens geworden. </font><font style="vertical-align: inherit;">W√§hrend der Entwicklung des Projekts hat sich der Portier von einem einfachen Dienstprogramm, das Text nach festgelegten Regeln konvertiert, zu einem komplexen Codegenerator entwickelt, der mit der AST-Darstellung des Quellcodes arbeitet. </font><font style="vertical-align: inherit;">Die Bibliothek ist auch mit Code √ºberwachsen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Erfolg der Java-Richtung bestimmte den Wunsch des Unternehmens, f√ºr sich selbst weiter in neue M√§rkte zu expandieren, und 2013 wurde die Frage nach der Ver√∂ffentlichung von Produkten f√ºr die C ++ - Sprache in einem √§hnlichen Szenario aufgeworfen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulierung des Problems</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Ver√∂ffentlichung positiver Produktversionen sicherzustellen, musste ein Framework erstellt werden, mit dem Sie C ++ - Code aus beliebigem C # -Code abrufen, kompilieren, √ºberpr√ºfen und dem Client √ºbergeben k√∂nnen. Es ging um Bibliotheken mit Volumina von mehreren hunderttausend bis zu mehreren Millionen Zeilen (ohne Abh√§ngigkeiten).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig wurden die Erfahrungen mit dem Java-Porter ber√ºcksichtigt: Als es sich zun√§chst nur um ein einfaches Tool zum Konvertieren von Syntax handelte, entstand nat√ºrlich die Praxis, den portierten Code manuell zu finalisieren. Kurzfristig, konzentriert auf die schnelle Ver√∂ffentlichung von Produkten, war dies relevant, da dies den Entwicklungsprozess beschleunigen konnte. Langfristig erh√∂hte dies jedoch die Kosten f√ºr die Vorbereitung jeder Version f√ºr die Ver√∂ffentlichung erheblich, da jeder √úbersetzungsfehler jedes Mal korrigiert werden musste.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Komplexit√§t war nat√ºrlich beherrschbar - zumindest indem nur Patches in den resultierenden Java-Code √ºbertragen wurden, die als Differenz zwischen der Ausgabe des Portiers f√ºr die n√§chsten beiden Revisionen des C # -Codes berechnet werden. Dieser Ansatz erm√∂glichte es, jede portierte Leitung nur einmal zu korrigieren und in Zukunft den bereits entwickelten Code zu verwenden, bei dem keine √Ñnderungen vorgenommen wurden. Bei der Entwicklung eines positiven Portiers bestand das Ziel jedoch darin, die Phase der Korrektur des portierten Codes zu beseitigen und stattdessen das Framework selbst zu reparieren. Somit w√ºrde jeder willk√ºrlich seltene √úbersetzungsfehler einmal korrigiert - im Porter-Code, und dieser Fix w√ºrde f√ºr alle zuk√ºnftigen Versionen aller portierten Produkte gelten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zus√§tzlich zum Porter selbst musste eine Bibliothek in C ++ entwickelt werden, mit der die folgenden Probleme gel√∂st werden konnten:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulation der .Net-Umgebung in dem Ma√üe, in dem der portierte Code funktionieren muss;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anpassung des portierten C # -Codes an die Realit√§ten von C ++ (Typstruktur, Speicherverwaltung, anderer Servicecode);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gl√§tten der Unterschiede zwischen "neu geschriebenem C #" und C ++ selbst, um Programmierern, die nicht mit .NET-Paradigmen vertraut sind, die Verwendung von portiertem Code zu erleichtern.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus offensichtlichen Gr√ºnden wurde kein Versuch unternommen, .Net-Typen direkt Typen aus der Standardbibliothek zuzuordnen. </font><font style="vertical-align: inherit;">Stattdessen wurde beschlossen, immer Typen aus seiner Bibliothek als Ersatz f√ºr die Donnet-Typen zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele Leser werden sofort fragen, warum sie keine vorhandenen Implementierungen wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono verwendet haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Daf√ºr gab es Gr√ºnde.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durch das Anziehen einer solchen fertigen Bibliothek w√§re es m√∂glich, nur die erste Anforderung zu erf√ºllen, nicht jedoch die zweite und nicht die dritte.</font></font></li>
<li> Mono   C# ,  ,   ,       .</li>
<li>      (API,  ,   ,   C++,   )   ,     .</li>
<li>    ,    .Net,                  .  ,           ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Theoretisch k√∂nnte eine solche Bibliothek vollst√§ndig √ºber einen Port in C ++ √ºbersetzt werden. Dies w√ºrde jedoch zu Beginn der Entwicklung einen voll funktionsf√§higen Porter erfordern, da ohne eine Systembibliothek das Debuggen von portiertem Code grunds√§tzlich nicht m√∂glich ist. Dar√ºber hinaus w√§re die Frage der Optimierung des √ºbersetzten Codes der Systembibliothek noch akuter als beim Code portierter Produkte, da Aufrufe der Systembibliothek tendenziell zu einem Engpass werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund wurde beschlossen, die Bibliothek als eine Reihe von Adaptern zu entwickeln, die den Zugriff auf Funktionen erm√∂glichen, die bereits in Bibliotheken von Drittanbietern implementiert sind, jedoch √ºber eine .NET-√§hnliche API (√§hnlich wie Java). Dies w√ºrde die Arbeit reduzieren und fertige, bereits optimierte C ++ - Komponenten verwenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine wichtige Voraussetzung f√ºr das Framework war, dass der portierte Code als Teil von Benutzeranwendungen funktionieren muss (soweit es Bibliotheken betrifft). Dies bedeutete, dass das Speicherverwaltungsmodell C ++ - Programmierern klar gemacht werden sollte, da wir nicht erzwingen k√∂nnen, dass beliebiger Clientcode in einer Garbage Collection-Umgebung ausgef√ºhrt wird. Die Verwendung von intelligenten Zeigern wurde als Kompromissmodell gew√§hlt. Wie wir es geschafft haben, einen solchen √úbergang sicherzustellen (insbesondere um das Problem der Zirkelverweise zu l√∂sen), werde ich in einem separaten Artikel er√∂rtern.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere Anforderung war die F√§higkeit, Bibliotheken nicht nur zu portieren, sondern auch zu testen. </font><font style="vertical-align: inherit;">Das Unternehmen verf√ºgt √ºber eine hohe Kultur der Testabdeckung seiner Produkte, und die M√∂glichkeit, in C ++ dieselben Tests auszuf√ºhren, die f√ºr den urspr√ºnglichen Code geschrieben wurden, w√ºrde die Suche nach Problemen nach der √úbersetzung erheblich vereinfachen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die verbleibenden Anforderungen (Startformat, Testabdeckung, Technologie usw.) betrafen haupts√§chlich die Arbeitsmethoden f√ºr das Projekt und das Projekt. </font><font style="vertical-align: inherit;">Ich werde nicht auf sie eingehen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geschichte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich fortfahre, muss ich noch ein paar Worte zur Struktur des Unternehmens sagen. Das Unternehmen arbeitet remote, alle Teams sind verteilt. Die Entwicklung eines bestimmten Produkts liegt normalerweise in der Verantwortung eines Teams, das (fast immer) und (haupts√§chlich) geografisch geordnet ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die aktive Arbeit an dem Projekt begann im Herbst 2013. Aufgrund der verteilten Struktur des Unternehmens und auch aufgrund einiger Zweifel am Erfolg der Entwicklung wurden sofort drei Versionen des Frameworks eingef√ºhrt: Zwei davon dienten jeweils einem Produkt, das dritte drei auf einmal. Es wurde angenommen, dass dies dann die Entwicklung weniger effektiver L√∂sungen stoppen und gegebenenfalls Ressourcen neu zuweisen w√ºrde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Zukunft nahmen vier weitere Teams an der Arbeit am ‚Äûgemeinsamen‚Äú Framework teil, von denen zwei sp√§ter ihre Entscheidung √ºberdachten und sich weigerten, Produkte f√ºr C ++ zu ver√∂ffentlichen. Anfang 2017 wurde beschlossen, die Entwicklung einer der ‚Äûindividuellen‚Äú L√∂sungen einzustellen und das entsprechende Team auf die Arbeit mit einem ‚Äûgemeinsamen‚Äú Rahmen zu √ºbertragen. Die gestoppte Entwicklung setzte die Verwendung des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boehm GC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Mittel zur Speicherverwaltung </font><font style="vertical-align: inherit;">voraus </font><font style="vertical-align: inherit;">und enthielt eine viel umfangreichere Implementierung einiger Teile der Systembibliothek, die dann auf die ‚Äûallgemeine‚Äú L√∂sung √ºbertragen wurde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So kamen zwei Entwicklungen ins Ziel - n√§mlich die Ver√∂ffentlichung portierter Produkte - eine ‚ÄûEinzelperson‚Äú und eine ‚ÄûKollektiv‚Äú. Die ersten Releases basierend auf unserem (‚Äûgemeinsamen‚Äú) Framework fanden im Februar 2018 statt. Anschlie√üend wurden die Releases aller sechs Teams, die diese L√∂sung verwenden, monatlich ver√∂ffentlicht, und das Framework selbst wurde als separates Produkt des Unternehmens ver√∂ffentlicht. Es wurde sogar die Frage aufgeworfen, es Open Source zu machen, aber diese Diskussion hat sich noch nicht entwickelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Team, das weiterhin unabh√§ngig an einem √§hnlichen Framework arbeitete, ver√∂ffentlichte 2018 auch seine erste C ++ - Version.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ersten Ver√∂ffentlichungen enthielten verk√ºrzte Versionen der Originalprodukte, wodurch die Ausstrahlung unwichtiger Teile so weit wie m√∂glich verz√∂gert werden konnte. </font><font style="vertical-align: inherit;">In nachfolgenden Versionen wurde eine teilweise Erweiterung der Funktionalit√§t vorgenommen (und erfolgt).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation der Arbeit am Projekt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Organisation der gemeinsamen Arbeit an dem Projekt durch mehrere Teams konnte erhebliche √Ñnderungen erfahren. Zun√§chst wurde beschlossen, dass ein gro√ües ‚Äûzentrales‚Äú Team f√ºr die Entwicklung, Unterst√ºtzung und Korrektur des Frameworks verantwortlich ist, w√§hrend kleine ‚ÄûProdukt‚Äú -Teams, die an der Ver√∂ffentlichung der Endprodukte in C ++ beteiligt sind, haupts√§chlich f√ºr den Versuch verantwortlich sind, ihre zu portieren Code und Feedback (Informationen zu Portierungs-, Kompilierungs- und Ausf√ºhrungsfehlern). Ein solches Schema erwies sich jedoch als unproduktiv, da das zentrale Team mit Anfragen aller ‚ÄûProdukt‚Äú -Teams √ºberlastet war und sie erst fortfahren konnten, wenn die aufgetretenen Probleme behoben waren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus Gr√ºnden, die weitgehend unabh√§ngig vom Stand dieser Entwicklung sind, wurde beschlossen, das ‚Äûzentrale‚Äú Team aufzul√∂sen und Mitarbeiter in ‚ÄûProduktteams‚Äú zu √ºberf√ºhren, die nun daf√ºr verantwortlich sind, den Rahmen an ihre Bed√ºrfnisse anzupassen. In diesem Fall w√ºrde jedes Team selbst entscheiden, ob es seine gemeinsamen Grundlagen nutzt oder einen eigenen Projektgabel generiert. Eine solche Erkl√§rung der Frage war f√ºr das Java-Framework relevant, dessen Code zu diesem Zeitpunkt stabil war. Es war jedoch eine Konsolidierung der Bem√ºhungen erforderlich, um die C ++ - Bibliothek so schnell wie m√∂glich zu f√ºllen, damit die Teams weiterhin zusammenarbeiten konnten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Form der Arbeit hatte auch ihre Nachteile, so dass in Zukunft eine weitere Reform durchgef√ºhrt wurde. Das ‚Äûzentrale‚Äú Team wurde zwar in kleinerer Zusammensetzung, aber mit unterschiedlichen Funktionen wiederhergestellt: Jetzt war es nicht mehr f√ºr die eigentliche Entwicklung des Projekts verantwortlich, sondern f√ºr die Organisation der gemeinsamen Arbeit daran. Dies beinhaltete Unterst√ºtzung f√ºr die CI-Umgebung, Organisation von Merge Request-Praktiken, regelm√§√üige Besprechungen mit Entwicklungsteilnehmern, Unterst√ºtzung der Dokumentation, Abdeckung von Tests, Unterst√ºtzung bei Architekturl√∂sungen und Fehlerbehebung usw. Dar√ºber hinaus √ºbernahm das Team die Arbeit zur Beseitigung technischer Schulden und anderer ressourcenintensiver Bereiche. In diesem Modus wird die Entwicklung bis heute fortgesetzt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So wurde das Projekt von mehreren (ungef√§hr f√ºnf) Entwicklern initiiert und umfasste in den besten Zeiten ungef√§hr zwanzig Personen. Etwa zehn bis f√ºnfzehn Personen, die f√ºr die Entwicklung und Unterst√ºtzung des Frameworks und die Ver√∂ffentlichung von sechs portierten Produkten verantwortlich sind, k√∂nnen in den letzten Jahren als stabiler Wert angesehen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Autor dieser Zeilen trat Mitte 2016 in das Unternehmen ein und begann in einem der Teams zu arbeiten, die ihren Code mit einer ‚Äûgemeinsamen‚Äú L√∂sung sendeten. Im Winter desselben Jahres, als beschlossen wurde, das ‚Äûzentrale‚Äú Team neu zu bilden, wechselte ich in die Position ihrer Teamleiterin. Daher habe ich heute mehr als dreieinhalb Jahre Erfahrung im Projekt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Autonomie der Teams, die f√ºr die Ver√∂ffentlichung portierter Produkte verantwortlich sind, hat dazu gef√ºhrt, dass es sich in einigen F√§llen f√ºr Entwickler als einfacher herausstellte, den Portier durch Betriebsmodi zu erg√§nzen, als Kompromisse bei seinem standardm√§√üigen Verhalten einzugehen. </font><font style="vertical-align: inherit;">Dies erkl√§rt mehr als erwartet die Anzahl der verf√ºgbaren Optionen bei der Konfiguration des Porters.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technologien</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist Zeit, √ºber die im Projekt verwendeten Technologien zu sprechen. Porter ist eine in C # geschriebene Konsolenanwendung, da es in dieser Form einfacher ist, Skripte einzubetten, die Aufgaben wie "Port-Compile-Run-Tests" ausf√ºhren. Dar√ºber hinaus gibt es eine GUI-Komponente, mit der Sie dieselben Ziele erreichen k√∂nnen, indem Sie auf die Schaltfl√§chen klicken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die alte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRefactory-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek ist f√ºr das Parsen von Code und das Aufl√∂sen der Semantik verantwortlich </font><font style="vertical-align: inherit;">. Leider war </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roslyn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Zeitpunkt des Projektbeginns </font><font style="vertical-align: inherit;">noch nicht verf√ºgbar, obwohl eine Migration darauf nat√ºrlich geplant ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porter verwendet </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">AST-</font></a><font style="vertical-align: inherit;"> Holzstege</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um Informationen zu sammeln und C ++ - Ausgabecode zu generieren. Wenn C ++ - Code generiert wird, wird die AST-Darstellung nicht erstellt und der gesamte Code wird als einfacher Text gespeichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In vielen F√§llen ben√∂tigt der Portier zus√§tzliche Informationen zur Feinabstimmung. Diese Informationen werden ihm in Form von Optionen und Attributen √ºbermittelt. Die Optionen gelten sofort f√ºr das gesamte Projekt und erm√∂glichen es Ihnen, beispielsweise die Namen von Exportmakroelementen von Klassen oder C # -Vorprozessordefinitionen festzulegen, die bei der Codeanalyse verwendet werden. Attribute werden an Typen und Entit√§ten angeh√§ngt und bestimmen die f√ºr sie spezifische Verarbeitung (z. B. die Notwendigkeit, Schl√ºsselw√∂rter "const" oder "ver√§nderlich" f√ºr Klassenmitglieder zu generieren oder sie von der Portierung auszuschlie√üen).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C # -Klassen und -Strukturen werden in C ++ - Klassen √ºbersetzt, ihre Mitglieder und ausf√ºhrbarer Code werden in die n√§chsten Entsprechungen √ºbersetzt. Generische Typen und Methoden werden C ++ - Vorlagen zugeordnet. C # -Links werden in intelligente Zeiger (stark oder schwach) √ºbersetzt, die in der Bibliothek definiert sind. Weitere Einzelheiten zu den Grunds√§tzen des Portiers werden in einem separaten Artikel er√∂rtert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher wird die urspr√ºngliche C # -Baugruppe in ein C ++ - Projekt konvertiert, das anstelle von .NET-Bibliotheken von unserer gemeinsam genutzten Bibliothek abh√§ngt. Dies ist in der folgenden Abbildung dargestellt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/d1/s-/ofd1s-pimst_5rrcxzz8t-fh0nq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake wird zum Erstellen der Bibliothek und der portierten Projekte verwendet. Derzeit werden die Compiler VS 2017 und 2019 (Windows), GCC und Clang (Linux) unterst√ºtzt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erw√§hnt, sind die meisten unserer .Net-Implementierungen d√ºnne Schichten von Bibliotheken von Drittanbietern, die den Gro√üteil der Arbeit erledigen. </font><font style="vertical-align: inherit;">Es enth√§lt:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr die Arbeit mit Grafiken;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zur Unterst√ºtzung von Verschl√ºsselungsfunktionen;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intensivstation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr die Arbeit mit Strings, Codierungen und Kulturen;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libxml2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr die Arbeit mit XML;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCRE2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zum Arbeiten mit regul√§ren Ausdr√ºcken;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - um Komprimierungsfunktionen zu implementieren;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - f√ºr verschiedene Zwecke;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mehrere andere Bibliotheken.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sowohl der Portier als auch die Bibliothek werden in zahlreichen Tests behandelt. </font><font style="vertical-align: inherit;">Bibliothekstests verwenden das gtest-Framework. </font><font style="vertical-align: inherit;">Porter-Tests sind haupts√§chlich in NUnit / xUnit geschrieben und in mehrere Kategorien unterteilt, die Folgendes best√§tigen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Porter-Ausgabe dieser Eingabedateien entspricht dem Ziel.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ausgabe der portierten Programme nach dem Kompilieren und Starten stimmt mit dem Ziel √ºberein.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUnit-Tests aus Eingabeprojekten werden erfolgreich in gtest-Tests in portierten Projekten konvertiert und bestanden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die API f√ºr portierte Projekte funktioniert erfolgreich in C ++.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Auswirkungen einzelner Optionen und Attribute auf den √úbersetzungsprozess sind wie erwartet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um den Quellcode zu speichern </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jenkins wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als CI-Umgebung ausgew√§hlt </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Portierte Produkte sind als Nuget-Pakete und als Download-Archive erh√§ltlich.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probleme</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
W√§hrend der Arbeit an dem Projekt hatten wir viele Probleme. </font><font style="vertical-align: inherit;">Einige von ihnen wurden erwartet, w√§hrend andere bereits im Prozess erschienen. </font><font style="vertical-align: inherit;">Wir listen kurz die wichtigsten auf.</font></font><br>
<br>
<ol>
<li><b>     .Net  C++.</b><br>
  ,   C++    Object,       RTTI.           .Net   STL.</li>
<li><b>   .</b><br>
       ,          ,    . ,  C#     ,   C++ ‚Äî .</li>
<li><b>  .</b><br>
   ‚Äî   .          ,   .   ,            .</li>
<li><b>    .</b><br>
 C++   ,        ,        .</li>
<li><b>    C#.</b><br>
 C#    ,      C++.    ,     :<br>
<br>
<ul>
<li>   ,    ;</li>
<li>   ,       (,       yeild);</li>
<li>,      (,            ,       ,        C#);</li>
<li>,   C++ (,  C#        foreground-).</li>
</ul></li>
<li><b>  .</b><br>
,        .Net  ,          .</li>
<li><b>   .</b><br>
- ,     ,        ¬´¬ª ,     .  ,  ,  ,     ,     using,             -.                 .   ,             .</li>
<li><b> .</b><br>
         ,    ,   ,  ,   ,    /     -          .</li>
<li><b>    .</b><br>
     .       ,           .    ,       ,      ,     .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schwierigkeiten beim Schutz des geistigen Eigentums. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn C # -Code durch Boxed-L√∂sungen ziemlich leicht verschleiert werden kann, m√ºssen Sie in C ++ zus√§tzliche Anstrengungen unternehmen, da viele Klassenmitglieder nicht ohne Konsequenzen aus Header-Dateien gel√∂scht werden k√∂nnen. </font><font style="vertical-align: inherit;">Das √úbersetzen generischer Klassen und Methoden in Vorlagen f√ºhrt auch zu Schwachstellen, indem Algorithmen verf√ºgbar gemacht werden.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotzdem ist das Projekt aus technischer Sicht sehr interessant. </font><font style="vertical-align: inherit;">Wenn Sie daran arbeiten, k√∂nnen Sie viel lernen und viel lernen. </font><font style="vertical-align: inherit;">Dazu tr√§gt auch der akademische Charakter der Aufgabe bei.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Rahmen des Projekts konnten wir ein System implementieren, das ein interessantes akademisches Problem aufgrund seiner direkten praktischen Anwendung l√∂st. Wir haben eine monatliche Ausgabe der Firmenbibliotheken in einer Sprache organisiert, f√ºr die sie urspr√ºnglich nicht vorgesehen waren. Es stellte sich heraus, dass die meisten Probleme vollst√§ndig l√∂sbar sind und die daraus resultierende L√∂sung zuverl√§ssig und praktisch ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In K√ºrze sollen zwei weitere Artikel ver√∂ffentlicht werden. Einer von ihnen beschreibt anhand von Beispielen ausf√ºhrlich, wie ein Portier funktioniert und wie C # -Konstrukte in C ++ angezeigt werden. In einer anderen Rede werden wir dar√ºber sprechen, wie wir es geschafft haben, die Kompatibilit√§t von Speichermodellen in zwei Sprachen sicherzustellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde versuchen, die Fragen in den Kommentaren zu beantworten. </font><font style="vertical-align: inherit;">Wenn die Leser Interesse an anderen Aspekten unserer Entwicklung zeigen und die Antworten √ºber die Korrespondenz in den Kommentaren hinausgehen, werden wir die M√∂glichkeit in Betracht ziehen, neue Artikel zu ver√∂ffentlichen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495344/index.html">Vereinheitlichen Sie es: Wie Lamoda seine Go-Services konsistent macht</a></li>
<li><a href="../de495346/index.html">Vom Fehler zum Alarm mit Aktionen</a></li>
<li><a href="../de495350/index.html">Home-Webserver oder Ihr eigener Hosting-Anbieter</a></li>
<li><a href="../de495354/index.html">Wie kann man Produkte kontinuierlich in 20 Sprachen ver√∂ffentlichen und nicht sterben?</a></li>
<li><a href="../de495356/index.html">Implementierung des RAFT-Konsensalgorithmus f√ºr verteilten KV-Speicher in Java</a></li>
<li><a href="../de495362/index.html">Selbstisolieren und programmieren: Wie man zu Hause nicht verr√ºckt wird und Zeit sinnvoll verbringt</a></li>
<li><a href="../de495364/index.html">API Style Guide, oder lassen Sie Benutzer nicht nachdenken</a></li>
<li><a href="../de495366/index.html">16 Arten von Programmierern oder Entwicklern sind nicht dieselben Roboter</a></li>
<li><a href="../de495368/index.html">Wir registrieren uns selbst f√ºr selbstlaufende Selbsthunde unter Bedingungen der Selbstisolation</a></li>
<li><a href="../de495370/index.html">√ñffentlichkeit ist b√∂se</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>