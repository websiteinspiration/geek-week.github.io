<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍⚖️ 🏺 👩🏾‍🤝‍👨🏽 Construire un routeur dans SOCKS sur un ordinateur portable avec Debian 10 🧝 ◻️ 🏂🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendant un an (ou deux), j'ai reporté la publication de cet article pour la raison principale - j'ai déjà publié deux articles dans lesquels j'ai décr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Construire un routeur dans SOCKS sur un ordinateur portable avec Debian 10</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendant un an (ou deux), j'ai reporté la publication de cet article pour la raison principale - j'ai déjà publié deux articles dans lesquels j'ai décrit le processus de création d'un routeur dans SOCKS à partir d'un ordinateur portable ordinaire avec Debian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, depuis lors, la version stable de Debian a été mise à jour vers Buster, un nombre suffisant de personnes m'ont envoyé une demande personnelle pour aider à la configuration, ce qui signifie que mes articles précédents ne sont pas exhaustifs. Eh bien, j'ai moi-même deviné que les méthodes qui y étaient décrites ne révélaient pas complètement toutes les subtilités de la configuration de Linux pour le routage dans SOSKS. De plus, ils ont été écrits pour Debian Stretch, et après la mise à niveau vers Buster, dans le système d'initialisation systemd, j'ai remarqué de petits changements dans l'interaction des services. Oui, et dans les articles eux-mêmes, je n'ai pas utilisé systemd-networkd, bien qu'il soit mieux adapté aux configurations réseau complexes.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus des changements ci-dessus, des services comme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont été ajoutés à ma configuration </font><font style="vertical-align: inherit;">- un service pour la virtualisation des points d'accès, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour synchroniser l'heure des clients du réseau local, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour crypter les connexions DNS et désactiver la publicité sur les clients du réseau local, ainsi que, comme je l'ai mentionné auparavant, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour configurer les interfaces réseau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici le schéma de principe le plus simple de la structure interne d'un tel routeur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/eq/_f/gyeq_fcjwxnobupmbqn9b-hwqqk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vous rappelle donc quels sont les objectifs du cycle de ces articles:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acheminez toutes les connexions du système d'exploitation vers SOCKS, ainsi que les connexions de tous les appareils qui se trouvent sur le même réseau que l'ordinateur portable. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ordinateur portable dans mon cas doit rester entièrement mobile. </font><font style="vertical-align: inherit;">Autrement dit, pour donner la possibilité d'utiliser l'environnement de bureau et de ne pas être lié à un emplacement physique.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le dernier point implique la connexion et le routage uniquement via l'interface sans fil intégrée.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, bien sûr, la création d'un guide exhaustif, ainsi que l'analyse des technologies appropriées au mieux de mes modestes connaissances.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui sera considéré dans cet article:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - télécharger les tun2socks projettent des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiels</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nécessaires pour acheminer le </font><font style="vertical-align: inherit;">trafic TCP SOCKS et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - un script pour automatiser la configuration d'un point d'accès virtuel à l' </font><font style="vertical-align: inherit;">aide </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">compile</font></b><font style="vertical-align: inherit;"> et installe le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le système </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - configurez les interfaces sans fil et virtuelles, les tables de routage statiques et le transfert de paquets.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - installe le service systemd sur le système, configure et lance le point d'accès virtuel.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étapes facultatives:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - installe et configure le serveur pour synchroniser l'heure sur les clients du point d'accès virtuel.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - crypter les requêtes DNS, les acheminer vers SOCKS et désactiver les domaines publicitaires pour le réseau local.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi tout ça?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est une façon de sécuriser les connexions TCP sur un réseau local. Le principal avantage est que toutes les connexions vont à SOCKS si une route statique via la passerelle d'origine n'est pas créée pour eux. Cela signifie qu'il n'est pas nécessaire de prescrire les paramètres du serveur SOCKS à des programmes individuels ou à des clients sur le réseau local - ils vont tous à SOCKS par défaut, car c'est la passerelle par défaut jusqu'à ce que nous spécifions le contraire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, nous ajoutons le deuxième routeur de chiffrement en tant qu'ordinateur portable devant le routeur d'origine et utilisons la connexion Internet du routeur d'origine pour les demandes SOCKS déjà chiffrées de l'ordinateur portable, qui, à leur tour, achemine et chiffre les demandes des clients du réseau local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Du point de vue du fournisseur, nous sommes constamment connectés au même serveur avec un trafic crypté.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, tous les appareils se connectent au point d'accès virtuel d'un ordinateur portable.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant de commencer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque toutes les configurations sont disponibles dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">référentiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez tun2socks dans le système</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tant que vous avez Internet sur votre machine, téléchargez tous les outils nécessaires.</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br>
<pre><code class="bash hljs">apt install git make cmake</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Téléchargez le package badvpn</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/ambrop72/badvpn
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dossier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apparaîtra sur votre système </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Créer un dossier de build séparé</font></font><br>
<br>
<pre><code class="bash hljs">mkdir badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aller vers elle</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Construire des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><br>
<br>
<pre><code class="bash hljs">cmake ../badvpn -DBUILD_NOTHING_BY_DEFAULT=1 -DBUILD_TUN2SOCKS=1
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installer sur le système</font></font><br>
<br>
<pre><code class="bash hljs">make install
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le paramètre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-DBUILD_NOTHING_BY_DEFAULT =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 désactive l'assemblage de tous les composants du référentiel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBUILD_TUN2SOCKS = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inclut les composants </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'assemblage </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make install</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - installe le binaire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur votre système à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / local / bin / badvpn-tun2socks.</font></font></i></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer le service tun2socks dans systemd</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/tun2socks.service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant:</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=SOCKS TCP Relay<font></font>
<font></font>
[Service]<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/badvpn-tun2socks --tundev tun2socks --netif-ipaddr 172.16.1.1 --netif-netmask 255.255.255.0 --socks-server-addr 127.0.0.1:9050<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--tundev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - accepte le nom de l'interface virtuelle que nous initialisons avec </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--netif-ipaddr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - adresse réseau du </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tuner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «routeur» </font><font style="vertical-align: inherit;">auquel l'interface virtuelle est connectée. </font><font style="vertical-align: inherit;">Il est préférable de créer un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous-réseau réservé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> distinct </font><font style="vertical-align: inherit;">.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--socks-server-addr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - accepte un socket ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adresse: port du</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serveur SOCKS).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si votre serveur SOCKS nécessite une authentification, vous pouvez spécifier les </font><b><font style="vertical-align: inherit;">paramètres </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--password</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, enregistrez le service</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et allume</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> tun2socks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de démarrer le service, nous lui fournirons une interface réseau virtuelle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accédez à systemd-networkd</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Activez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Désactivez les services réseau actuels.</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">disable</span> networking NetworkManager NetworkManager-wait-online</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkManager-wait-online</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un service qui attend une connexion réseau fonctionnelle avant que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd ne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> continue à démarrer d'autres services qui dépendent du réseau. </font><font style="vertical-align: inherit;">Nous le désactivons lorsque nous passons à l'analogue </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allumons-le tout de suite:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd-wait-online</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer une interface réseau sans fil</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez un fichier de configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'interface réseau sans fil </font></font><code>/etc/systemd/network/25-wlp6s0.network</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=wlp6s0<font></font>
<font></font>
[Network]<font></font>
Address=192.168.1.2/24<font></font>
IPMasquerade=yes<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nom de votre interface sans fil. </font><font style="vertical-align: inherit;">Identifiez-le avec la commande </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPMasquerade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est une directive qui inclut le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masquage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le transfert de paquets sur une interface réseau.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'adresse</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est responsable de l'attribution d'une adresse IP à l'interface sans fil. </font><font style="vertical-align: inherit;">Nous le spécifions statiquement car avec la directive équivalente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crée une passerelle par défaut dans le système. </font><font style="vertical-align: inherit;">Ensuite, tout le trafic passera par la passerelle d'origine, et non par la future interface virtuelle dans un excellent sous-réseau. </font><font style="vertical-align: inherit;">Vous pouvez vérifier la passerelle par défaut actuelle avec la commande</font></font><pre><code class="bash hljs">ip r</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Créer une route statique pour le serveur SOCKS distant</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si votre serveur SOCKS n'est pas local, mais distant, vous devez lui créer un itinéraire statique. </font><font style="vertical-align: inherit;">Pour ce faire, ajoutez la section </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la fin du fichier de configuration sans fil que vous avez créé avec le contenu suivant:</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=0.0.0.0<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La passerelle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la passerelle ou l'adresse par défaut de votre point d'accès d'origine.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destination</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Adresse du serveur SOCKS.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer wpa_supplicant pour systemd-networkd</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilise </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour se connecter à un point d'accès sécurisé. </font><font style="vertical-align: inherit;">Lorsque vous essayez de "relancer" l'interface sans fil, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> démarre le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nom</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nom de l'interface sans fil. </font><font style="vertical-align: inherit;">Si vous n'avez pas utilisé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avant ce point, ce service n'est certainement pas disponible sur votre système. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, créez-le avec la commande:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> wpa_supplicant@wlp6s0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai utilisé </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme nom de mon interface sans fil. </font><font style="vertical-align: inherit;">Votre nom peut être différent. </font><font style="vertical-align: inherit;">Vous pouvez le découvrir par son équipe</font></font><pre><code class="bash hljs">ip l</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le service créé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> démarrera lorsque l'interface sans fil sera «levée», cependant, à son tour, il recherchera les paramètres SSID et mot de passe du point d'accès dans le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / wpa_supplicant / wpa_supplicant-wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Par conséquent, vous devez le créer à l'aide de l'utilitaire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_passphrase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, exécutez la commande:</font></font><br>
<br>
<pre><code class="bash hljs">wpa_passphrase SSID password&gt;/etc/wpa_supplicant/wpa_supplicant-wlp6s0.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
où </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nom de votre point d'accès, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mot de passe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le mot de passe et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nom de votre interface sans fil.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initialiser l'interface virtuelle pour tun2socks</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez un fichier pour initialiser une nouvelle interface virtuelle dans le système </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.netdev</font></font></i><br>
<br>
<pre><code class="bash hljs">[NetDev]<font></font>
Name=tun2socks<font></font>
Kind=tun<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nom que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribuera à la future interface virtuelle lors de son initialisation.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kind</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un type d'interface virtuelle. </font><font style="vertical-align: inherit;">Sur la base du nom du service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez deviner qu'il utilise une interface comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est l'extension de fichier que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilise pour initialiser les interfaces réseau virtuelles. </font><font style="vertical-align: inherit;">L'adresse et les autres paramètres réseau de ces interfaces sont spécifiés dans les </font><font style="vertical-align: inherit;">fichiers </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez un fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant:</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=tun2socks<font></font>
<font></font>
[Network]<font></font>
Address=172.16.1.2/24<font></font>
Gateway=172.16.1.1<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - le nom de l'interface virtuelle que vous avez spécifiée dans le </font><font style="vertical-align: inherit;">fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adresse</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">Adresse</font></b><font style="vertical-align: inherit;"> IP à attribuer à l'interface virtuelle. </font><font style="vertical-align: inherit;">Doit être sur le même réseau que l'adresse que vous avez spécifiée dans </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passerelle</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'adresse IP du «routeur» </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que vous avez spécifié lors de la création du service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'interface </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a l'adresse </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire qu'il est la passerelle pour toutes les connexions à partir de l'interface virtuelle.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer un point d'accès virtuel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez les dépendances:</font></font><br>
<br>
<pre><code class="bash hljs">apt install util-linux procps hostapd iw haveged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Téléchargez le référentiel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur votre machine:</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/oblique/create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accédez au dossier du référentiel sur votre ordinateur:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez dans le système:</font></font><br>
<br>
<pre><code class="bash hljs">make install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/create_ap.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apparaîtra sur votre système </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Voici les principales options d'édition:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GATEWAY = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - il est préférable de créer un sous-réseau réservé distinct.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNS = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - désactiver, car ce paramètre sera contrôlé par l'interface virtual systemd-networkd.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNSMASQ = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - désactivez-le pour la même raison.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIFI_IFACE = wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - interface sans fil de l'ordinateur portable.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNET_IFACE = tun2socks&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - interface virtuelle créée pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID = hostapd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nom du point d'accès virtuel.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PASSPHRASE = 12345678</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mot de passe.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas d'activer le service:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> create_ap</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activer le serveur DHCP dans systemd-networkd</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initialise l'interface virtuelle </font><i><font style="vertical-align: inherit;">ap0</font></i><font style="vertical-align: inherit;"> sur le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Théoriquement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><i><font style="vertical-align: inherit;">dnsmasq se</font></i><font style="vertical-align: inherit;"> bloque sur cette interface </font><font style="vertical-align: inherit;">, mais pourquoi installer des services supplémentaires si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient un serveur DHCP intégré? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour l'activer, définissez les paramètres réseau du point virtuel. Pour ce faire, créez le fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-ap0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec le contenu suivant:</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=ap0<font></font>
<font></font>
[Network]<font></font>
Address=10.0.0.1/24<font></font>
DHCPServer=yes<font></font>
<font></font>
[DHCPServer]<font></font>
EmitDNS=yes<font></font>
DNS=10.0.0.1<font></font>
EmitNTP=yes<font></font>
NTP=10.0.0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois que le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sreate_ap a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> initialisé l'interface virtuelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-NetworkD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribue automatiquement une adresse IP et active le serveur DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les lignes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitDNS = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmettent les paramètres du serveur DNS aux appareils connectés au point d'accès. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ne prévoyez pas d'utiliser un serveur DNS local - dans mon cas, il s'agit de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - vous pouvez définir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est l'adresse de votre passerelle d'origine. Ensuite, les requêtes DNS de votre hôte et de votre réseau local ne seront pas cryptées via les serveurs du fournisseur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitNTP = oui</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmettent les paramètres NTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il en va de même pour la ligne </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer et configurer le serveur NTP</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installez dans le système:</font></font><br>
<br>
<pre><code class="bash hljs">apt install ntp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifiez la configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ntp.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Commentez les adresses des pools standard:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#pool 0.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 1.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 2.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 3.debian.pool.ntp.org iburst</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez les adresses des serveurs publics, par exemple, Google Public NTP:</font></font><br>
<br>
<pre><code class="bash hljs">server time1.google.com ibrust<font></font>
server time2.google.com ibrust<font></font>
server time3.google.com ibrust<font></font>
server time4.google.com ibrust<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordez l'accès au serveur aux clients de votre réseau:</font></font><br>
<br>
<pre><code class="bash hljs">restrict 10.0.0.0 mask 255.255.255.0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transformez la diffusion en réseau:</font></font><br>
<br>
<pre><code class="bash hljs">broadcast 10.0.0.255
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, ajoutez les adresses de ces serveurs à la table de routage statique. </font><font style="vertical-align: inherit;">Pour ce faire, ouvrez le fichier de configuration sans fil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-wlp6s0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ajoutez la section </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à la fin </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.0<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.4<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.8<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez trouver les adresses de vos serveurs NTP en utilisant l'utilitaire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hôte</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme suit:</font></font><br>
<br>
<pre><code class="bash hljs">host time1.google.com</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , supprimez les publicités et masquez le trafic DNS du fournisseur</font></font></h2><br>
<pre><code class="bash hljs">apt install dnscrypt-proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour servir les requêtes DNS de l'hôte et du réseau local, modifiez le socket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/lib/systemd/system/dnscrypt-proxy.socket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Modifiez les lignes suivantes:</font></font><br>
<br>
<pre><code class="bash hljs">ListenStream=0.0.0.0:53<font></font>
ListenDatagram=0.0.0.0:53</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redémarrer </font></font><code>systemd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifiez la configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/dnscrypt-proxy/dnscrypt-proxy.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">server_names = [<span class="hljs-string">'adguard-dns'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour acheminer les connexions proxy </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> via </font><i><font style="vertical-align: inherit;">tun2socks</font></i><font style="vertical-align: inherit;"> , ajoutez ci-dessous:</font></font><br>
<br>
<pre><code class="bash hljs">force_tcp = <span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifiez la configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui indique le serveur DNS à l'hôte.</font></font><br>
<br>
<pre><code class="bash hljs">nameserver 127.0.0.1<font></font>
nameserver 192.168.1.1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première ligne inclut l'utilisation de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la seconde - utilise la passerelle d'origine, au cas où le serveur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy ne</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serait </font><font style="vertical-align: inherit;">pas disponible.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminé!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redémarrez ou arrêtez les services réseau existants:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl stop networking NetworkManager NetworkManager-wait-online</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et redémarrez tous ceux nécessaires:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart systemd-networkd tun2socks create_ap dnscrypt-proxy ntp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après le redémarrage ou le redémarrage, vous disposerez d'un deuxième point d'accès qui achemine l'hôte et les périphériques LAN vers SOCKS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici à quoi ressemble la sortie.</font></font><pre><code class="bash hljs">ip a</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ordinateur portable ordinaire:</font></font><br>
<br>
<pre><code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<font></font>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<font></font>
    inet 127.0.0.1/8 scope host lo<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 ::1/128 scope host <font></font>
       valid_lft forever preferred_lft forever<font></font>
2: tun2socks: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 500<font></font>
    link/none <font></font>
    inet 172.16.1.2/24 brd 172.16.1.255 scope global tun2socks<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::122b:260:6590:1b0e/64 scope link stable-privacy <font></font>
       valid_lft forever preferred_lft forever<font></font>
3: enp4s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000<font></font>
    link/ether e8:11:32:0e:01:50 brd ff:ff:ff:ff:ff:ff<font></font>
4: wlp6s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:85 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 192.168.1.2/24 brd 192.168.1.255 scope global wlp6s0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf85/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
5: ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:86 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 10.0.0.1/24 brd 10.0.0.255 scope global ap0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf86/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalement</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fournisseur ne voit que la connexion cryptée à votre serveur SOCKS, ce qui signifie qu'il ne voit rien.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et pourtant, il voit vos requêtes NTP, pour éviter cela, supprimez les routes statiques pour les serveurs NTP. </font><font style="vertical-align: inherit;">Cependant, ce n'est pas un fait que votre serveur SOCKS autorise NTP.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crutch vu sur Debain 10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous essayez de redémarrer le service réseau à partir de la console, il échouera avec une erreur. </font><font style="vertical-align: inherit;">Cela est dû au fait qu'une partie de celui-ci sous la forme d'une interface virtuelle est liée au service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifie qu'il est utilisé. </font><font style="vertical-align: inherit;">Pour redémarrer le service réseau, vous devez d'abord arrêter le service </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mais je pense que si vous lisez jusqu'au bout, pour vous ce n'est certainement pas un problème!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Références</font></font></h4><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Routage statique sous Linux - IBM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd.service - Freedesktop.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks ambrop72 / badvpn wiki github</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oblique / create_ap: ce script crée un point d'accès WiFi NATed ou Bridged.</font></font></a><br>
 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy 2 - Un proxy DNS flexible, avec prise en charge des protocoles DNS chiffrés.</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491558/index.html">Trouvez plus d'oeufs de Pâques rock: des messages mystérieux aux appels pour vous laver les mains et faire vos devoirs</a></li>
<li><a href="../fr491560/index.html">Comment faire du terminal votre assistant, pas un ennemi?</a></li>
<li><a href="../fr491562/index.html">FOSS News n ° 6 - examen des nouvelles gratuites et open source du 2 au 8 mars 2020</a></li>
<li><a href="../fr491564/index.html">Java 14: Record, une instance plus concise, wrapper jpackage, switch lambdas et blocs de texte</a></li>
<li><a href="../fr491566/index.html">Apprentissage automatique en langage R à l'aide du package mlr3</a></li>
<li><a href="../fr491570/index.html">Pourquoi ICQ a perdu un ancien utilisateur après avoir acheté Mail.Ru</a></li>
<li><a href="../fr491572/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 405 (2 - 8 mars 2020)</a></li>
<li><a href="../fr491574/index.html">Une astuce simple pour gérer la procrastination</a></li>
<li><a href="../fr491576/index.html">Les transformateurs comme réseaux de neurones graphiques</a></li>
<li><a href="../fr491584/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 336 (2 - 9 mars)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>