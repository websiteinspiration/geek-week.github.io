<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¥ ğŸ‘¦ğŸ» ğŸ¦‚ é€šè¿‡ç±»ä¼¼äºæ¢¯åº¦çš„ä¸‹é™æ¥é€‰æ‹©kè¿‘é‚»ï¼ˆäº•æˆ–å…¶ä»–è¶…å‚æ•°ï¼‰çš„ç‰¹å¾é‡è¦æ€§ ğŸ‘©ğŸ¿â€ğŸš€ â—ï¸ ğŸ˜š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é€šè¿‡å¯¹æœ€ç®€å•çš„æœºå™¨å­¦ä¹ ä»»åŠ¡è¿›è¡Œå®éªŒï¼Œæˆ‘å‘ç°åœ¨ç›¸å½“å®½çš„èŒƒå›´å†…åŒæ—¶é€‰æ‹©18ä¸ªè¶…å‚æ•°ä¼šå¾ˆæœ‰è¶£ã€‚å°±æˆ‘è€Œè¨€ï¼Œä¸€åˆ‡æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºå¯ä»¥ç”¨è›®æ¨ªçš„è®¡ç®—æœºåŠŸèƒ½æ¥å®Œæˆä»»åŠ¡ã€‚
 
 å­¦ä¹ ä¸€äº›ä¸œè¥¿æ—¶ï¼Œå‘æ˜æŸç§è‡ªè¡Œè½¦ä¼šéå¸¸æœ‰è¶£ã€‚æœ‰æ—¶äº‹å®è¯æ˜ç¡®å®æå‡ºäº†ä¸€äº›æ–°å»ºè®®ã€‚æœ‰æ—¶å€™ï¼Œäº‹å®è¯æ˜ä¸€åˆ‡éƒ½æ˜¯åœ¨æˆ‘ä¹‹å‰å‘æ˜çš„ã€‚ä½†æ˜¯ï¼Œå³ä½¿æˆ‘åªæ˜¯é‡å¤èµ°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>é€šè¿‡ç±»ä¼¼äºæ¢¯åº¦çš„ä¸‹é™æ¥é€‰æ‹©kè¿‘é‚»ï¼ˆäº•æˆ–å…¶ä»–è¶…å‚æ•°ï¼‰çš„ç‰¹å¾é‡è¦æ€§</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496484/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/eg/qm/x6/egqmx63h8mgrbxfytg9nmuaby-g.gif" alt="çœŸæ­£çš„åºŸè¯ä¸ä»…å¯ä»¥è§£å†³ä¸å¯èƒ½çš„äº‹æƒ…ï¼Œè€Œä¸”å¯ä»¥ä½œä¸ºè­¦å‘Šçš„ä¾‹å­"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡å¯¹æœ€ç®€å•çš„æœºå™¨å­¦ä¹ ä»»åŠ¡è¿›è¡Œå®éªŒï¼Œæˆ‘å‘ç°åœ¨ç›¸å½“å®½çš„èŒƒå›´å†…åŒæ—¶é€‰æ‹©18ä¸ªè¶…å‚æ•°ä¼šå¾ˆæœ‰è¶£ã€‚å°±æˆ‘è€Œè¨€ï¼Œä¸€åˆ‡æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºå¯ä»¥ç”¨è›®æ¨ªçš„è®¡ç®—æœºåŠŸèƒ½æ¥å®Œæˆä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å­¦ä¹ ä¸€äº›ä¸œè¥¿æ—¶ï¼Œå‘æ˜æŸç§è‡ªè¡Œè½¦ä¼šéå¸¸æœ‰è¶£ã€‚æœ‰æ—¶äº‹å®è¯æ˜ç¡®å®æå‡ºäº†ä¸€äº›æ–°å»ºè®®ã€‚æœ‰æ—¶å€™ï¼Œäº‹å®è¯æ˜ä¸€åˆ‡éƒ½æ˜¯åœ¨æˆ‘ä¹‹å‰å‘æ˜çš„ã€‚ä½†æ˜¯ï¼Œå³ä½¿æˆ‘åªæ˜¯é‡å¤èµ°åœ¨æˆ‘ä¹‹å‰çš„é‚£æ¡è·¯ï¼Œä½œä¸ºå¥–åŠ±ï¼Œæˆ‘ä¹Ÿå¸¸å¸¸äº†è§£å®ƒä»¬çš„åŠŸèƒ½å’Œå†…éƒ¨å±€é™æ€§çš„ç®—æ³•çš„åŸºæœ¬æœºåˆ¶ã€‚æˆ‘é‚€è¯·ä½ åˆ°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦ç‡åœ°è¯´ï¼Œåœ¨Pythonå’ŒDSä¸­ï¼Œæˆ‘æ˜¯ä¸€ä¸ªåˆå­¦è€…ï¼Œæˆ‘æ ¹æ®æˆ‘çš„æ—§ç¼–ç¨‹ä¹ æƒ¯åšäº†å¾ˆå¤šå¯ä»¥åœ¨ä¸€ä¸ªå›¢é˜Ÿä¸­å®ç°çš„äº‹æƒ…ï¼Œè€ŒPythonåˆ™é€šè¿‡é™ä½é€Ÿåº¦ï¼ˆä¸æ˜¯æœ‰æ—¶è€Œæ˜¯æŒ‰æ•°é‡çº§ï¼‰æ¥æƒ©ç½šã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘å°†æ‰€æœ‰ä»£ç ä¸Šä¼ åˆ°å­˜å‚¨åº“ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨çŸ¥é“å¦‚ä½•æ›´æœ‰æ•ˆåœ°å®æ–½å®ƒ-è¯·å‹¿å®³ç¾ï¼Œåœ¨æ­¤å¤„è¿›è¡Œç¼–è¾‘æˆ–åœ¨è¯„è®ºä¸­å†™ä¸‹ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/kraidiky/GDforHyperparameters</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æˆ‘ç›¸ä¿¡ï¼Œé‚£äº›å·²ç»å¾ˆé…·çš„æ•°æ®å­¦å®¶å¹¶ä¸”å·²ç»å°è¯•äº†è¿™ä¸€è¾ˆå­çš„ä¸€åˆ‡ï¼Œå¯¹äºå­¦ä¹ è¿‡ç¨‹çš„å¯è§†åŒ–å¾ˆæœ‰è¶£ï¼Œè¿™ä¸ä»…é€‚ç”¨äºæ­¤ä»»åŠ¡ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜çš„ææ³•</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ODS.aiæä¾›äº†å¦‚æ­¤å‡ºè‰²çš„DSè¯¾ç¨‹ï¼Œè¿˜æœ‰ç¬¬ä¸‰å ‚è¯¾ã€Š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†ç±»ï¼Œå†³ç­–æ ‘å’Œæœ€è¿‘é‚»å±…çš„æ–¹æ³•ã€‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨é‚£é‡Œï¼Œå®ƒåœ¨æå…¶ç®€å•ä¸”å¯èƒ½æ˜¯åˆæˆæ•°æ®ä¸Šæ˜¾ç¤ºå‡ºï¼Œæœ€ç®€å•çš„å†³ç­–æ ‘å¦‚ä½•å®ç°94.5ï¼…çš„å‡†ç¡®åº¦ï¼Œè€Œkä¸ªæœ€è¿‘é‚»å±…çš„ç›¸åŒæå…¶ç®€å•çš„æ–¹æ³•æ— éœ€ä»»ä½•é¢„å¤„ç†å³å¯æä¾›89ï¼…çš„å‡†ç¡®æ€§ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¼å…¥å’ŒåŠ è½½æ•°æ®</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<font></font>
%matplotlib inline<font></font>
<span class="hljs-keyword">import</span> warnings<font></font>
warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)<font></font>
<font></font>
df = pd.read_csv(<span class="hljs-string">'data/telecom_churn.csv'</span>)<font></font>
df[<span class="hljs-string">'Voice mail plan'</span>] = pd.factorize(df[<span class="hljs-string">'Voice mail plan'</span>])[<span class="hljs-number">0</span>]<font></font>
df[<span class="hljs-string">'International plan'</span>] = pd.factorize(df[<span class="hljs-string">'International plan'</span>])[<span class="hljs-number">0</span>]<font></font>
df[<span class="hljs-string">'Churn'</span>] = df[<span class="hljs-string">'Churn'</span>].astype(<span class="hljs-string">'int32'</span>)<font></font>
states = df[<span class="hljs-string">'State'</span>]<font></font>
y = df[<span class="hljs-string">'Churn'</span>]<font></font>
df.drop([<span class="hljs-string">'State'</span>,<span class="hljs-string">'Churn'</span>], axis = <span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)<font></font>
df.head()<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯”è¾ƒæœ¨æä¸knn</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split, StratifiedKFold
<span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeClassifier
<span class="hljs-keyword">from</span> sklearn.neighbors <span class="hljs-keyword">import</span> KNeighborsClassifier
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV, cross_val_score
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<font></font>
<font></font>
X_train, X_holdout, y_train, y_holdout = train_test_split(df.values, y, test_size=<span class="hljs-number">0.3</span>,<font></font>
random_state=<span class="hljs-number">17</span>)<font></font>
<font></font>
tree = DecisionTreeClassifier(random_state=<span class="hljs-number">17</span>, max_depth=<span class="hljs-number">5</span>)<font></font>
knn = KNeighborsClassifier(n_neighbors=<span class="hljs-number">10</span>)<font></font>
<font></font>
tree_params = {<span class="hljs-string">'max_depth'</span>: range(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>), <span class="hljs-string">'max_features'</span>: range(<span class="hljs-number">4</span>,<span class="hljs-number">19</span>)}<font></font>
tree_grid = GridSearchCV(tree, tree_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
tree_grid.fit(X_train, y_train)<font></font>
tree_grid.best_params_, tree_grid.best_score_, accuracy_score(y_holdout, tree_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'max_depth'ï¼š6ï¼Œ6ï¼Œ'max_features'ï¼š16}ï¼Œ0.944706386626661ï¼Œ0.945ï¼‰</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºknnä¸€æ ·</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.pipeline <span class="hljs-keyword">import</span> Pipeline
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<font></font>
<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>))])<font></font>
knn_params = {<span class="hljs-string">'knn__n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)}<font></font>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'knn__n_neighbors'ï¼š9}ï¼Œ0.8868409772824689ï¼Œ0.891ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä¸ºæ˜¾ç„¶ä¸è¯šå®çš„knnæ„Ÿåˆ°é—æ†¾ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨è¯¥æŒ‡æ ‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘æ²¡æœ‰æƒ³åˆ°ï¼Œæˆ‘ä»æ ‘ä¸­å–å‡ºäº†feature_importances_å¹¶å°†å…¶è¾“å…¥æ ‡å‡†åŒ–ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç‰¹å¾è¶Šé‡è¦ï¼Œç‚¹ä¹‹é—´çš„è·ç¦»å°±è¶Šå¤§ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ•°æ®å½’ä¸€åŒ–ä¸ºåŠŸèƒ½çš„é‡è¦æ€§</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
feature_importances = pd.DataFrame({<span class="hljs-string">'features'</span>: df.columns, <span class="hljs-string">'importance'</span>:tree_grid.best_estimator_.feature_importances_})<font></font>
print(feature_importances.sort_values(by=[<span class="hljs-string">'importance'</span>], inplace=<span class="hljs-literal">False</span>, ascending=<span class="hljs-literal">False</span>))<font></font>
<font></font>
scaler = StandardScaler().fit(X_train)<font></font>
X_train_transformed = scaler.transform(X_train)<font></font>
X_train_transformed = X_train_transformed * np.array(feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
<font></font>
X_holdout_transformed = scaler.transform(X_holdout)<font></font>
X_holdout_transformed = X_holdout_transformed * np.array(feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
<font></font>
knn_grid = GridSearchCV(KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>), {<span class="hljs-string">'n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>)}, cv=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
knn_grid.fit(X_train_transformed, y_train)<font></font>
<span class="hljs-keyword">print</span> (knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout_transformed)))
</code></pre></div></div><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»åˆ†é’Ÿ</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.270386</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®¢æˆ·æœåŠ¡ç”µè¯</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.147185</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰å¤œæ€»åˆ†é’Ÿ</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.135475</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›½é™…è®¡åˆ’</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.097249</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åå…­</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»å›½é™…è´¹ç”¨</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.091671</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åäº”</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›½é™…é€šè¯æ€»æ•°</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09.090008</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vmailæ¶ˆæ¯æ•°é‡</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.050646</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹³å®‰å¤œæ€»è´¹ç”¨</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.038593</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¨å¤©æ”¶è´¹</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.026422</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯­éŸ³é‚®ä»¶è®¡åˆ’</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.017068</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åä¸€</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ™šä¸Šæ€»æ—¶é—´</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.014185</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åä¸‰</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯æ™šæ€»è´¹ç”¨</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.005742</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤œé—´é€šè¯æ€»æ•°</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.005502</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰å¤œæ€»é€šè¯æ¬¡æ•°</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.003614</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¥é—´é€šè¯æ€»æ•°</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.002246</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ€»å›½é™…åˆ†é’Ÿ</font></font></td>
<td>0.002009</td>
</tr>
<tr>
<td>0</td>
<td>Account length</td>
<td>0.001998</td>
</tr>
<tr>
<td>1</td>
<td>Area code</td>
<td>0.000000</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{'n_neighbors'ï¼š5} 0.909129875696528 0.913 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ£µæ ‘ä¸knnå…±äº«äº†ä¸€ç‚¹çŸ¥è¯†ï¼Œç°åœ¨æˆ‘ä»¬çœ‹åˆ°äº†91ï¼…ï¼Œä¸é¦™è‰æ ‘çš„94.5ï¼…ç›¸å·®ä¸è¿œã€‚ç„¶åæˆ‘æƒ³åˆ°ä¸€ä¸ªä¸»æ„ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¦‚ä½•éœ€è¦å¯¹è¾“å…¥è¿›è¡Œæ ‡å‡†åŒ–ä»¥ä½¿knnæ˜¾ç¤ºæœ€ä½³ç»“æœï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨è„‘æµ·ä¸­ä¼°è®¡ç°åœ¨å¤šå°‘å°†è¢«è§†ä¸ºâ€œå‰é¢â€ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªå‚æ•°è®¾å®š18ä¸ªå‚æ•°ï¼Œä¾‹å¦‚ï¼Œå¯¹æ•°åˆ»åº¦ä¸­çš„å› å­å¯èƒ½è¦è¿›è¡Œ10ä¸ªæ­¥éª¤ã€‚æˆ‘ä»¬å¾—åˆ°10e18é€‰é¡¹ã€‚ä¸€ä¸ªå…·æœ‰æ‰€æœ‰å¯èƒ½çš„å¥‡æ•°ä¸ªé‚»å±…çš„é€‰é¡¹å°äº10ï¼Œè€Œäº¤å‰éªŒè¯ä¹Ÿä¸º10ï¼Œæˆ‘è®¤ä¸ºçº¦ä¸º1.5ç§’ã€‚äº‹å®è¯æ˜ï¼Œè¿™æ˜¯420äº¿å¹´ã€‚ä¹Ÿè®¸ä¸å¾—ä¸æ”¾å¼ƒæ™šä¸Šè®¡ç®—çš„æƒ³æ³•ã€‚ :)åœ¨è¿™é‡Œé™„è¿‘çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘æƒ³ï¼šâ€œå˜¿ï¼æ‰€ä»¥æˆ‘ä¼šåšä¸€è¾†ä¼šé£çš„è‡ªè¡Œè½¦ï¼â€</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¢¯åº¦æœç´¢</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œæ­¤ä»»åŠ¡å¾ˆå¯èƒ½åªæœ‰ä¸€ä¸ªå¯ç”¨çš„æœ€å¤§å€¼ã€‚</font><font style="vertical-align: inherit;">å¥½å§ï¼Œè¿™å½“ç„¶ä¸æ˜¯ä¸€ä¸ªå–å¾—å¥½æˆç»©çš„æ•´ä¸ªé¢†åŸŸï¼Œä½†æ˜¯å®ƒä»¬å‡ ä¹æ˜¯ç›¸ä¼¼çš„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ²¿ç€æ¢¯åº¦èµ°ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„ç‚¹ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆæƒ³åˆ°çš„æ˜¯æ¨å¹¿é—ä¼ ç®—æ³•ï¼Œä½†æ˜¯åœ¨è¿™é‡Œè‡ªé€‚åº”åœ°å½¢ä¼¼ä¹å¹¶ä¸å¤ªç´§å¯†ï¼Œè¿™ä¼šæœ‰ç‚¹è¿‡å¤§ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å°†å°è¯•æ‰‹åŠ¨å¼€å§‹ã€‚</font><font style="vertical-align: inherit;">è¦å°†å› ç´ æ¨ä¸ºè¶…å‚æ•°ï¼Œæˆ‘éœ€è¦å¤„ç†å®šæ ‡å™¨ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœ¬è¯¾ç¨‹ä¸­ä¸€æ ·ï¼Œæˆ‘ä½¿ç”¨äº†StandartScalerï¼Œå®ƒä½¿è®­ç»ƒæ ·æœ¬å¹³å‡å±…ä¸­ï¼Œå¹¶ä½¿sigma =1ã€‚ä¸ºäº†åœ¨ç®¡é“ä¸­å¾ˆå¥½åœ°ç¼©æ”¾å®ƒï¼Œå¿…é¡»ä½¿è¶…å‚æ•°æ›´åŠ å¤æ‚ã€‚</font><font style="vertical-align: inherit;">æˆ‘å¼€å§‹åœ¨sklearn.preprocessingä¸­çš„è½¬æ¢å™¨ä¸­æœç´¢é€‚åˆæˆ‘çš„æƒ…å†µçš„ä¸œè¥¿ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¸œè¥¿ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘è¯•å›¾é€šè¿‡åœ¨å…¶ä¸Šæ‚¬æŒ‚å…¶ä»–æ†ç»‘å› ç´ æ¥ç»§æ‰¿StandartScalerã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºæ ‡ç§°åŒ–çš„ç±»ï¼Œç„¶åæŒ‰æ¯”ä¾‹ä¹˜ä»¥ä¸sklearnæµæ°´çº¿ç¨å¾®å…¼å®¹</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> sklearn.base <span class="hljs-keyword">import</span> TransformerMixin
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StandardAndPoorScaler</span>(<span class="hljs-params">StandardScaler, TransformerMixin</span>):</span>
    <span class="hljs-comment">#normalization = None</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, copy=True, with_mean=True, with_std=True, normalization = None</span>):</span>
        <span class="hljs-comment">#print("new StandardAndPoorScaler(normalization=", normalization.shape if normalization is not None else normalization, ") // ", type(self))</span><font></font>
        self.normalization = normalization<font></font>
        super().__init__(copy, with_mean, with_std)<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span>(<span class="hljs-params">self, X, y=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".fit(",X.shape, ",", y.shape if y is not None else "&lt;null&gt;",")")</span><font></font>
        super().fit(X, y)<font></font>
        <span class="hljs-keyword">return</span> self
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partial_fit</span>(<span class="hljs-params">self, X, y=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".partial_fit(",X.shape, ",", y.shape if y is not None else "&lt;null&gt;)")</span><font></font>
        super().partial_fit(X, y)<font></font>
        <span class="hljs-keyword">if</span> self.normalization <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            self.normalization = np.ones((X.shape[<span class="hljs-number">1</span>]))
        <span class="hljs-keyword">elif</span> type(self.normalization) != np.ndarray:<font></font>
            self.normalization = np.array(self.normalization)<font></font>
        <span class="hljs-keyword">if</span> X.shape[<span class="hljs-number">1</span>] != self.normalization.shape[<span class="hljs-number">0</span>]:
            <span class="hljs-keyword">raise</span> <span class="hljs-string">"X.shape[1]="</span>+X.shape[<span class="hljs-number">1</span>]+<span class="hljs-string">" in equal self.scale.shape[0]="</span>+self.normalization.shape[<span class="hljs-number">0</span>]
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span class="hljs-params">self, X, copy=None</span>):</span>
        <span class="hljs-comment">#print(type(self),".transform(",X.shape,",",copy,").self.normalization", self.normalization)</span><font></font>
        Xresult = super().transform(X, copy)<font></font>
        Xresult *= self.normalization<font></font>
        <span class="hljs-keyword">return</span> Xresult
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_reset</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment">#print(type(self),"._reset()")</span><font></font>
        super()._reset()<font></font>
    <font></font>
scaler = StandardAndPoorScaler(normalization = feature_importances[<span class="hljs-string">'importance'</span>])<font></font>
scaler.fit(X = X_train, y = <span class="hljs-literal">None</span>)<font></font>
print(scaler.normalization)<font></font>
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°è¯•ç”³è¯·è¯¥è¯¾ç¨‹</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'knn__n_neighbors'</span>: range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">4</span>), <span class="hljs-string">'scaler__normalization'</span>: [feature_importances[<span class="hljs-string">'importance'</span>]]}<font></font>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">5</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'knn__n_neighbors'ï¼š5ï¼Œ'scaler__normalization'ï¼šåç§°ï¼šé‡è¦æ€§ï¼Œdtypeï¼šfloat64}ï¼Œ0.909558508358337ï¼Œ0.913ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœä¸æˆ‘çš„é¢„æœŸç•¥æœ‰ä¸åŒã€‚å¥½å§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸåˆ™ä¸Šä¸€åˆ‡æ­£å¸¸ã€‚ä¸ºäº†äº†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä¸å¾—ä¸åœ¨ä¸‰ä¸ªå°æ—¶å†…ä»å¤´å¼€å§‹é‡åˆ¶æ‰€æœ‰æ­¤ç±»å†…å®¹ï¼Œç„¶åæ‰æ„è¯†åˆ°æ‰“å°ä¸æ‰“å°å¹¶ä¸æ˜¯å› ä¸ºsklearnåˆ¶ä½œé”™è¯¯ï¼Œè€Œæ˜¯å› ä¸ºGridSearchCVåœ¨ä¸»æµä¸­åˆ›å»ºäº†å…‹éš†ï¼Œä½†åœ¨å…¶ä»–çº¿ç¨‹ä¸­è¿›è¡Œé…ç½®å’Œè®­ç»ƒã€‚æ‚¨åœ¨å…¶ä»–æµä¸­æ‰“å°çš„æ‰€æœ‰å†…å®¹éƒ½å°†æ¶ˆå¤±ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†n_jobs = 1ï¼Œåˆ™æ‰€æœ‰å¯¹è¦†ç›–å‡½æ•°çš„è°ƒç”¨éƒ½æ˜¾ç¤ºä¸ºå¯çˆ±ã€‚çŸ¥è¯†çš„äº§ç”Ÿéå¸¸æ˜‚è´µï¼Œç°åœ¨æ‚¨ä¹Ÿæ‹¥æœ‰äº†ï¼Œå¹¶ä¸”æ‚¨é€šè¿‡é˜…è¯»ä¹å‘³çš„æ–‡ç« æ¥ä¸ºä¹‹ä»˜å‡ºäº†ä»£ä»·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œç»§ç»­å‰è¿›ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘æƒ³ä¸ºå®ƒä»¬çš„æ¯ä¸ªå‚æ•°æä¾›ä¸€äº›æ–¹å·®ï¼Œç„¶ååœ¨æœ€ä½³å€¼é™„è¿‘ç»™å®ƒå°‘ä¸€äº›ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°å¾—åˆ°ä¸å®é™…ç›¸ä¼¼çš„ç»“æœã€‚</font><font style="vertical-align: inherit;">è¿™å°†æ˜¯æœ€ç»ˆå®ç°æˆ‘çš„æ¢¦æƒ³ç®—æ³•çš„ç¬¬ä¸€ä¸ªç²—é²çš„åŸºå‡†ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†å½¢æˆå‡ ä¸ªç”¨äºåŠ æƒçš„é€‰é¡¹ï¼Œä¸åŒçš„æ˜¯å‡ ä¸ªå‚æ•°</font></font></b><div class="spoiler_text"><pre><code class="python hljs">feature_base = feature_importances[<span class="hljs-string">'importance'</span>]<font></font>
searchArea = np.array([feature_base - <span class="hljs-number">.05</span>, feature_base, feature_base + <span class="hljs-number">.05</span>])<font></font>
searchArea[searchArea &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span>
searchArea[searchArea &gt; <span class="hljs-number">1</span>] = <span class="hljs-number">1</span>
print(searchArea[<span class="hljs-number">2</span>,:] - searchArea[<span class="hljs-number">0</span>,:])<font></font>
<font></font>
<span class="hljs-keyword">import</span> itertools<font></font>
<font></font>
affected_props = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<font></font>
parametrs_ranges = np.concatenate([<font></font>
    np.linspace(searchArea[<span class="hljs-number">0</span>,affected_props], searchArea[<span class="hljs-number">1</span>,affected_props], <span class="hljs-number">2</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
    np.linspace(searchArea[<span class="hljs-number">1</span>,affected_props], searchArea[<span class="hljs-number">2</span>,affected_props], <span class="hljs-number">3</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
<font></font>
print(parametrs_ranges) <span class="hljs-comment">#      .  125 </span>
recombinations = itertools.product(parametrs_ranges[<span class="hljs-number">0</span>],parametrs_ranges[<span class="hljs-number">1</span>],parametrs_ranges[<span class="hljs-number">1</span>])<font></font>
<font></font>
variances = []<font></font>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> recombinations: <span class="hljs-comment">#          ,       Python .</span><font></font>
    varince = feature_base.copy()<font></font>
    varince[affected_props] = item<font></font>
    variances.append(varince)<font></font>
print(variances[<span class="hljs-number">0</span>])<font></font>
print(len(variances))<font></font>
<span class="hljs-comment">#  knn   ,               .</span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½äº†ï¼Œç¬¬ä¸€ä¸ªå®éªŒçš„æ•°æ®é›†å·²ç»å‡†å¤‡å¥½äº†ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘å°†å°è¯•å¯¹æ•°æ®è¿›è¡Œå®éªŒï¼Œé¦–å…ˆå¯¹ç»“æœ15ä¸ªé€‰é¡¹è¿›è¡Œè¯¦å°½æœç´¢ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åƒæœ¬æ–‡ä¸­é‚£æ ·å°è¯•é€‰æ‹©å‚æ•°</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-comment">#scale = np.ones([18])</span>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œä¸€åˆ‡éƒ½ä¸å¥½ï¼Œæ—¶é—´èŠ±åœ¨äº†çªç ´ä¸Šï¼Œç»“æœéå¸¸ä¸ç¨³å®šã€‚</font><font style="vertical-align: inherit;">ä»X_holdoutæ£€æŸ¥ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œç»“æœåƒåœ¨ä¸‡èŠ±ç­’ä¸­é‚£æ ·è·³èˆï¼Œå¯¹è¾“å…¥æ•°æ®çš„æ›´æ”¹å¾ˆå°ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å°è¯•å¦ä¸€ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä¸€æ¬¡åªæ›´æ”¹ä¸€ä¸ªå‚æ•°ï¼Œä½†ç¦»æ•£åŒ–è¦å¤§å¾—å¤šã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘æ”¹å˜ä¸€ä¸ªç¬¬å››å±æ€§</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
affected_property = <span class="hljs-number">4</span><font></font>
parametrs_range = np.concatenate([<font></font>
    np.linspace(searchArea[<span class="hljs-number">0</span>,affected_property], searchArea[<span class="hljs-number">1</span>,affected_property], <span class="hljs-number">29</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
    np.linspace(searchArea[<span class="hljs-number">1</span>,affected_property], searchArea[<span class="hljs-number">2</span>,affected_property], <span class="hljs-number">30</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
<font></font>
print(searchArea[<span class="hljs-number">1</span>,affected_property])<font></font>
print(parametrs_range) <span class="hljs-comment"># C   ,  .</span><font></font>
<font></font>
<font></font>
variances = []<font></font>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> parametrs_range: <span class="hljs-comment">#          ,       Python .</span><font></font>
    varince = feature_base.copy()<font></font>
    varince[affected_property] = item<font></font>
    variances.append(varince)<font></font>
print(variances[<span class="hljs-number">0</span>])<font></font>
print(len(variances))<font></font>
<span class="hljs-comment">#  knn   ,               .</span><font></font>
<font></font>
knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
<font></font>
knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
knn_grid.fit(X_train, y_train)<font></font>
knn_grid.best_params_, knn_grid.best_score_, accuracy_score(y_holdout, knn_grid.predict(X_holdout))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ{'scaler__normalization'ï¼š4 0.079957åç§°ï¼šé‡è¦æ€§ï¼Œdtypeï¼šfloat64}ï¼Œ0.9099871410201458ï¼Œ0.913ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£ä¹ˆï¼Œé¹…æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">äº¤å‰éªŒè¯æ—¶ï¼Œç™¾åˆ†ä¹‹ä¸€åˆ°ååˆ†ä¹‹äºŒçš„åç§»é‡ï¼Œå¦‚æœæ‚¨æŸ¥çœ‹ä¸åŒçš„å—å½±å“çš„å±æ€§ï¼Œåˆ™X_holdoutçš„åç§»é‡ä¸ºåŠä¸ªç™¾åˆ†ç‚¹ã€‚</font><font style="vertical-align: inherit;">æ˜¾ç„¶ï¼Œå¦‚æœæ‚¨ä»æ ‘ä¸ºæˆ‘ä»¬æä¾›è¿™æ ·çš„æ•°æ®è¿™ä¸€äº‹å®å¼€å§‹ï¼Œæ”¹å–„è¿™ç§æƒ…å†µæ˜¯å¿…ä¸å¯å°‘ä¸”å»‰ä»·çš„ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªåˆå§‹çš„ï¼Œå·²çŸ¥çš„æƒé‡åˆ†å¸ƒï¼Œå¹¶å°è¯•ä»¥å¾®å°çš„æ­¥é•¿åœ¨å¾ªç¯ä¸­çš„ä»»æ„ç‚¹è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¼šå¾ˆæœ‰è¶£ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆå§‹å¡«å……</font></font></b><div class="spoiler_text"><pre><code class="python hljs">searchArea = np.array([np.zeros((<span class="hljs-number">18</span>,)), np.ones((<span class="hljs-number">18</span>,)) /<span class="hljs-number">18</span>, np.ones((<span class="hljs-number">18</span>,))])<font></font>
print(searchArea[:,<span class="hljs-number">0</span>])<font></font>
<font></font>
history_parametrs = [searchArea[<span class="hljs-number">1</span>,:].copy()]<font></font>
scaler = StandardAndPoorScaler(normalization=searchArea[<span class="hljs-number">1</span>,:])<font></font>
scaler.fit(X_train)<font></font>
knn = KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>)<font></font>
knn.fit(scaler.transform(X_train), y_train)<font></font>
history_holdout_score = [accuracy_score(y_holdout, knn.predict(scaler.transform(X_holdout)))]</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç•¥å¾®æ›´æ”¹ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼ˆå¸¦æœ‰è°ƒè¯•æ—¥å¿—ï¼‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">changePropertyNormalization</span>(<span class="hljs-params">affected_property, points_count = <span class="hljs-number">15</span></span>):</span><font></font>
    test_range = np.concatenate([<font></font>
        np.linspace(searchArea[<span class="hljs-number">0</span>,affected_property], searchArea[<span class="hljs-number">1</span>,affected_property], points_count//<span class="hljs-number">2</span>, endpoint=<span class="hljs-literal">False</span>),<font></font>
        np.linspace(searchArea[<span class="hljs-number">1</span>,affected_property], searchArea[<span class="hljs-number">2</span>,affected_property], points_count//<span class="hljs-number">2</span> + <span class="hljs-number">1</span>, endpoint=<span class="hljs-literal">True</span>)]).transpose()<font></font>
    variances = [searchArea[<span class="hljs-number">1</span>,:].copy() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(test_range.shape[<span class="hljs-number">0</span>])]
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> range(len(variances)):<font></font>
        variances[row][affected_property] = test_range[row]<font></font>
    <font></font>
    knn_pipe = Pipeline([(<span class="hljs-string">'scaler'</span>, StandardAndPoorScaler()), (<span class="hljs-string">'knn'</span>, KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>))])<font></font>
    knn_params = {<span class="hljs-string">'scaler__normalization'</span>: variances} <span class="hljs-comment"># 'knn__n_neighbors': range(3, 9, 2), </span>
    knn_grid = GridSearchCV(knn_pipe, knn_params, cv=<span class="hljs-number">10</span>, n_jobs=<span class="hljs-number">-1</span>, verbose=<span class="hljs-literal">False</span>)<font></font>
<font></font>
    knn_grid.fit(X_train, y_train)<font></font>
    holdout_score = accuracy_score(y_holdout, knn_grid.predict(X_holdout))<font></font>
    best_param = knn_grid.best_params_[<span class="hljs-string">'scaler__normalization'</span>][affected_property]<font></font>
    print(affected_property,<font></font>
          <span class="hljs-string">'property:'</span>, searchArea[<span class="hljs-number">1</span>, affected_property], <span class="hljs-string">"=&gt;"</span>, best_param,
          <span class="hljs-string">'holdout:'</span>, history_holdout_score[<span class="hljs-number">-1</span>], <span class="hljs-string">"=&gt;"</span>, holdout_score, <span class="hljs-string">'('</span>, knn_grid.best_score_, <span class="hljs-string">')'</span>)
    <span class="hljs-comment">#             .</span><font></font>
    before = searchArea[:, affected_property]<font></font>
    propertySearchArea = searchArea[:, affected_property].copy()<font></font>
    <span class="hljs-keyword">if</span> best_param == propertySearchArea[<span class="hljs-number">0</span>]:<font></font>
        print(<span class="hljs-string">'|&lt;&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = best_param/<span class="hljs-number">2</span> <span class="hljs-keyword">if</span> best_param &gt; <span class="hljs-number">0.01</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + searchArea[<span class="hljs-number">2</span>, affected_property])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param == propertySearchArea[<span class="hljs-number">2</span>]:<font></font>
        print(<span class="hljs-string">'&gt;&gt;|'</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + <span class="hljs-number">1</span>)/<span class="hljs-number">2</span> <span class="hljs-keyword">if</span> best_param &lt; <span class="hljs-number">0.99</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>
        searchArea[<span class="hljs-number">0</span>, affected_property] = (best_param + searchArea[<span class="hljs-number">0</span>, affected_property])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &lt; (propertySearchArea[<span class="hljs-number">0</span>] + propertySearchArea[<span class="hljs-number">1</span>])/<span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">'&lt;&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = max(propertySearchArea[<span class="hljs-number">0</span>]*<span class="hljs-number">1.1</span> - <span class="hljs-number">.1</span>*propertySearchArea[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = (best_param + propertySearchArea[<span class="hljs-number">2</span>])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &gt; (propertySearchArea[<span class="hljs-number">1</span>] + propertySearchArea[<span class="hljs-number">2</span>])/<span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">'&gt;&gt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = (best_param + propertySearchArea[<span class="hljs-number">0</span>])/<span class="hljs-number">2</span>
        searchArea[<span class="hljs-number">2</span>, affected_property] = min(propertySearchArea[<span class="hljs-number">2</span>]*<span class="hljs-number">1.1</span> - <span class="hljs-number">.1</span>*propertySearchArea[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>)<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &lt; propertySearchArea[<span class="hljs-number">1</span>]:<font></font>
        print(<span class="hljs-string">'&lt;'</span>)<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">2</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">elif</span> best_param &gt; propertySearchArea[<span class="hljs-number">1</span>]:<font></font>
        print(<span class="hljs-string">'&gt;'</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">0</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">1</span>, affected_property] = best_param
    <span class="hljs-keyword">else</span>:<font></font>
        print(<span class="hljs-string">'='</span>)<font></font>
        searchArea[<span class="hljs-number">0</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">0</span>, affected_property]<font></font>
        searchArea[<span class="hljs-number">2</span>, affected_property] = searchArea[<span class="hljs-number">1</span>, affected_property]*<span class="hljs-number">.25</span> + <span class="hljs-number">.75</span>*searchArea[<span class="hljs-number">2</span>, affected_property]<font></font>
    normalization = searchArea[<span class="hljs-number">1</span>,:].sum() <span class="hljs-comment">#,      .</span><font></font>
    searchArea[:,:] /= normalization<font></font>
    print(before, <span class="hljs-string">"=&gt;"</span>,searchArea[:, affected_property])<font></font>
    history_parametrs.append(searchArea[<span class="hljs-number">1</span>,:].copy())<font></font>
    history_holdout_score.append(holdout_score)<font></font>
    <font></font>
changePropertyNormalization(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)<font></font>
changePropertyNormalization(<span class="hljs-number">1</span>, <span class="hljs-number">9</span>)
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¿›è¡Œä»»ä½•ä¼˜åŒ–ï¼Œç»“æœï¼Œæˆ‘è¿›è¡Œäº†å°†è¿‘åŠå°æ—¶çš„å†³å®šæ€§æ­¥éª¤ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšè—æ–‡å­—</font></font></b><div class="spoiler_text">       40 .<pre><code class="python hljs">%%time
<span class="hljs-comment">#   </span>
searchArea = np.array([np.zeros((<span class="hljs-number">18</span>,)), np.ones((<span class="hljs-number">18</span>,)) /<span class="hljs-number">18</span>, np.ones((<span class="hljs-number">18</span>,))])<font></font>
print(searchArea[:,<span class="hljs-number">0</span>])<font></font>
<font></font>
history_parametrs = [searchArea[<span class="hljs-number">1</span>,:].copy()]<font></font>
scaler = StandardAndPoorScaler(normalization=searchArea[<span class="hljs-number">1</span>,:])<font></font>
scaler.fit(X_train)<font></font>
knn = KNeighborsClassifier(n_neighbors = <span class="hljs-number">7</span> , n_jobs=<span class="hljs-number">-1</span>)<font></font>
knn.fit(scaler.transform(X_train), y_train)<font></font>
history_holdout_score = [accuracy_score(y_holdout, knn.predict(scaler.transform(X_holdout)))]<font></font>
<font></font>
<span class="hljs-keyword">for</span> tick <span class="hljs-keyword">in</span> range(<span class="hljs-number">40</span>):
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> range(searchArea.shape[<span class="hljs-number">1</span>]):<font></font>
        changePropertyNormalization(p, <span class="hljs-number">7</span>)<font></font>
    <font></font>
print(searchArea[<span class="hljs-number">1</span>,:])<font></font>
print(history_holdout_score)</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
knnçš„æœ€ç»ˆç²¾åº¦ä¸ºï¼š91.9ï¼…ï¼Œæ¯”æˆ‘ä»¬ä»æ ‘ä¸­åˆ é™¤æ•°æ®æ—¶è¦å¥½ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”æ¯”åŸå§‹ç‰ˆæœ¬è¦å¥½å¾—å¤šã€‚</font><font style="vertical-align: inherit;">æ ¹æ®å†³ç­–æ ‘æ¯”è¾ƒæˆ‘ä»¬å¯¹åŠŸèƒ½çš„é‡è¦æ€§ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹æ®knnå¯è§†åŒ–åŠŸèƒ½çš„é‡è¦æ€§</font></font></b><div class="spoiler_text"><pre><code class="python hljs">feature_importances[<span class="hljs-string">'knn_importance'</span>] = history_parametrs[<span class="hljs-number">-1</span>]<font></font>
diagramma = feature_importances.copy()<font></font>
indexes = diagramma.index<font></font>
diagramma.index = diagramma[<span class="hljs-string">'features'</span>]<font></font>
diagramma.drop(<span class="hljs-string">'features'</span>, <span class="hljs-number">1</span>, inplace = <span class="hljs-literal">True</span>)<font></font>
diagramma.plot(kind=<span class="hljs-string">'bar'</span>);<font></font>
plt.savefig(<span class="hljs-string">"images/pic1.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()<font></font>
feature_importances</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/kk/pe/nf/kkpenftrnyfl6dpu4p1qh2dnwqq.gif"><br>
<br>
<img src="https://habrastorage.org/webt/ui/o2/rp/uio2rplq9j2p5cxppq7jb7h_mpk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¼¼ä¹æ˜¯ï¼Ÿ</font><font style="vertical-align: inherit;">æ˜¯çš„ï¼Œçœ‹æ¥ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯è¿œéç›¸åŒã€‚</font><font style="vertical-align: inherit;">æœ‰è¶£çš„è§‚å¯Ÿã€‚</font><font style="vertical-align: inherit;">æ•°æ®é›†ä¸­æœ‰å‡ ä¸ªåŠŸèƒ½å¯ä»¥å®Œå…¨é‡å¤ï¼Œä¾‹å¦‚â€œæ€»å¤œé—´æ—¶é—´â€å’Œâ€œæ€»å¤œé—´è´¹ç”¨â€ã€‚</font><font style="vertical-align: inherit;">å› æ­¤è¯·æ³¨æ„ï¼Œknnæœ¬èº«å‘ç°äº†æ­¤ç±»é‡å¤åŠŸèƒ½çš„é‡è¦éƒ¨åˆ†ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¼šå°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œå¦åˆ™æ¢å¤å·¥ä½œæœ‰ç‚¹ä¸ä¾¿...ã€‚</font></font></b><div class="spoiler_text"><pre><code class="python hljs">parametrs_df = pd.DataFrame(history_parametrs)<font></font>
parametrs_df[<span class="hljs-string">'scores'</span>] = history_holdout_score<font></font>
parametrs_df.index.name = <span class="hljs-string">'index'</span>
parametrs_df.to_csv(<span class="hljs-string">'parametrs_and_scores.csv'</span>)
</code></pre></div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œç»“æœ.919æœ¬èº«å¯¹knnæ¥è¯´è¿˜ä¸é”™ï¼Œé”™è¯¯ç‡æ¯”æ™®é€šç‰ˆæœ¬å°‘äº†ä¸€åŠåŠï¼Œæ¯”ä½¿ç”¨feature_importanceæ ‘é©±åŠ¨æ—¶å°‘äº†7ï¼…ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æœ€æœ‰è¶£çš„æ˜¯ï¼Œæ ¹æ®knnæœ¬èº«ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†feature_importanceã€‚</font><font style="vertical-align: inherit;">å®ƒå’Œæ ‘å‘Šè¯‰æˆ‘ä»¬çš„æœ‰äº›ä¸åŒã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œtreeå’Œknnå¯¹äºå“ªä¸ªç¬¦å·å¯¹æˆ‘ä»¬æ ¹æœ¬ä¸é‡è¦æœ‰ä¸åŒçš„çœ‹æ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œæœ€åã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æœ‰äº†ä¸€äº›ç›¸å¯¹è¾ƒæ–°çš„å’Œä¸å¯»å¸¸çš„ä¸œè¥¿ï¼Œå¯¹ä¸‰é—¨è®²åº§mlcourse.ai </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
odså’ŒGoogle </font><font style="vertical-align: inherit;">éƒ½æœ‰ä¸€å®šçš„äº†è§£ï¼Œ</font><font style="vertical-align: inherit;">å¯ä»¥å›ç­”æœ‰å…³pythonçš„ç®€å•é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºè¿˜ä¸é”™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨å¹»ç¯ç‰‡</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç®—æ³•å·¥ä½œçš„å‰¯äº§å“æ˜¯å®ƒæ‰€ç»è¿‡çš„è·¯å¾„ã€‚ä½†æ˜¯ï¼Œè¯¥è·¯å¾„æ˜¯18ç»´çš„ï¼Œè¿™æœ‰ç‚¹å¦¨ç¢äº†ä»–çš„æ„è¯†ï¼Œæ— æ³•å®æ—¶è·Ÿè¸ªç®—æ³•åœ¨æ­¤å¤„æ‰§è¡Œçš„æ“ä½œï¼Œå­¦ä¹ æˆ–ä½¿ç”¨åƒåœ¾å¹¶ä¸é‚£ä¹ˆæ–¹ä¾¿ã€‚æ ¹æ®é”™è¯¯æ—¶é—´è¡¨ï¼Œè¿™å®é™…ä¸Šå¹¶ä¸æ€»æ˜¯å¯è§çš„ã€‚è¯¥é”™è¯¯å¯èƒ½ä¸ä¼šåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿæ˜æ˜¾å˜åŒ–ï¼Œä½†æ˜¯è¯¥ç®—æ³•éå¸¸ç¹å¿™ï¼Œä¼šæ²¿ç€è‡ªé€‚åº”ç©ºé—´ä¸­çš„ç‹­é•¿å±±è°·çˆ¬è¡Œã€‚å› æ­¤ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæˆ‘å°†ä½¿ç”¨ç¬¬ä¸€ç§æœ€ç®€å•ä½†éå¸¸æœ‰ç”¨çš„æ–¹æ³•-æˆ‘å°†18ç»´ç©ºé—´éšæœºæŠ•å½±åˆ°äºŒç»´ç©ºé—´ä¸Šï¼Œä»¥ä¾¿æ‰€æœ‰å‚æ•°çš„è´¡çŒ®ï¼ˆæ— è®ºå…¶é‡è¦æ€§å¦‚ä½•ï¼‰éƒ½æ˜¯å•ä¸€çš„ã€‚å®é™…ä¸Šï¼Œåœ¨æˆ‘ä»¬çš„æ–‡ç« ã€Š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">çª¥è§†ç¥ç»ç½‘ç»œã€‹ä¸­</font></a><font style="vertical-align: inherit;">ï¼Œ18ç»´è·¯å¾„å¾ˆå°ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘åŒæ ·é’¦ä½©ç¥ç»ç½‘ç»œå…·æœ‰çš„æ‰€æœ‰çªè§¦çš„éŸ³é˜¶ç©ºé—´ï¼Œå®ƒå¾ˆå¥½å¹¶ä¸”æä¾›äº†å¾ˆå¤šä¿¡æ¯ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å·²é€šè¿‡åŸ¹è®­é˜¶æ®µï¼Œå¦‚æœæˆ‘æ¢å¤å·¥ä½œï¼Œåˆ™ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</font></font></b><div class="spoiler_text"><pre><code class="python hljs">parametrs_df = pd.read_csv(<span class="hljs-string">'parametrs_and_scores.csv'</span>, index_col = <span class="hljs-string">'index'</span>)<font></font>
history_holdout_score = np.array(parametrs_df[<span class="hljs-string">'scores'</span>])<font></font>
parametrs_df.drop(<span class="hljs-string">'scores'</span>,axis=<span class="hljs-number">1</span>)<font></font>
history_parametrs = np.array(parametrs_df.drop(<span class="hljs-string">'scores'</span>,axis=<span class="hljs-number">1</span>))</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éªŒè¯é”™è¯¯ä»æŸç‚¹å¼€å§‹ä¸å†æ”¹å˜ã€‚</font><font style="vertical-align: inherit;">åœ¨è¿™é‡Œï¼Œæœ‰å¯èƒ½åœ¨æˆ‘çš„ä½™ç”Ÿä¸­è‡ªåŠ¨åœæ­¢å­¦ä¹ å¹¶ä½¿ç”¨æ¥æ”¶åˆ°çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘å·²ç»æœ‰ä¸€ç‚¹æ—¶é—´äº†ã€‚</font><font style="vertical-align: inherit;">:(</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å†³å®šå­¦ä¹ å¤šå°‘ã€‚</font></font></b><div class="spoiler_text"><pre><code class="python hljs">last = history_holdout_score[<span class="hljs-number">-1</span>]<font></font>
steps = np.arange(<span class="hljs-number">0</span>, history_holdout_score.shape[<span class="hljs-number">0</span>])[history_holdout_score != last].max()<font></font>
print(steps/<span class="hljs-number">18</span>)</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
35.5555555555555556 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¸€æ¬¡æ›´æ”¹äº†ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤ä¸€ä¸ªä¼˜åŒ–å‘¨æœŸ</font><font style="vertical-align: inherit;">åŒ…æ‹¬</font><font style="vertical-align: inherit;">18ä¸ªæ­¥éª¤ã€‚</font><font style="vertical-align: inherit;">äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬æœ‰36ä¸ªæœ‰æ„ä¹‰çš„æ­¥éª¤æˆ–ç±»ä¼¼çš„æ­¥éª¤ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•å¯è§†åŒ–è®­ç»ƒè¯¥æ–¹æ³•çš„è½¨è¿¹ã€‚</font></font><br>
<br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éšè—æ–‡å­—</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-comment">#    :</span>
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<font></font>
%matplotlib inline<font></font>
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> math<font></font>
random.seed(<span class="hljs-number">17</span>)<font></font>
property_projection = np.array([[math.sin(a), math.cos(a)] <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> [random.uniform(-math.pi, math.pi) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(history_parametrs[<span class="hljs-number">0</span>].shape[<span class="hljs-number">0</span>])]]).transpose()<font></font>
history = np.array(history_parametrs[::<span class="hljs-number">18</span>]) <span class="hljs-comment">#   - 18 .</span>
<span class="hljs-comment">#           . :(</span>
points = np.array([(history[i] * property_projection).sum(axis=<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(history.shape[<span class="hljs-number">0</span>])])<font></font>
plt.plot(points[:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">0</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic2.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/jt/zs/rc/jtzsrcgk60i_aeqhcvxjq9atvee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯ä»¥çœ‹å‡ºï¼Œæ—…ç¨‹çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯åœ¨å‰å››ä¸ªæ­¥éª¤ä¸­å®Œæˆçš„ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä»–çš„å¢åŠ æ–¹å¼</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰å‰4åˆ†</font></font></b><div class="spoiler_text"><pre><code class="python hljs">plt.plot(points[<span class="hljs-number">4</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">4</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic3.png"</span>, format = <span class="hljs-string">'png'</span>)</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/gq/xh/wa/gqxhwawt9nnsmypgk3tkry9vbpw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹è·¯å¾„çš„æœ€åéƒ¨åˆ†ï¼Œçœ‹çœ‹è€å¸ˆåˆ°è¾¾ç›®çš„åœ°ååšäº†ä»€ä¹ˆã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¶Šæ¥è¶Šè¿‘</font></font></b><div class="spoiler_text"><pre><code class="python hljs">plt.plot(points[<span class="hljs-number">14</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">14</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.savefig(<span class="hljs-string">"images/pic4.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()<font></font>
plt.plot(points[<span class="hljs-number">24</span>:<span class="hljs-number">36</span>,<span class="hljs-number">0</span>],points[<span class="hljs-number">24</span>:<span class="hljs-number">36</span>,<span class="hljs-number">1</span>]);<font></font>
plt.plot(points[<span class="hljs-number">35</span>:,<span class="hljs-number">0</span>],points[<span class="hljs-number">35</span>:,<span class="hljs-number">1</span>], color = <span class="hljs-string">'red'</span>);<font></font>
plt.savefig(<span class="hljs-string">"images/pic5.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show()</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/a5/kq/6m/a5kq6mq5yxl3roojyjfzdw8wq8a.png"><br>
<br>
<img src="https://habrastorage.org/webt/g5/lo/gs/g5logsa_jmna5lveoc-w0679koy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç®—æ³•æ­£åœ¨ä¸“å¿ƒè®­ç»ƒã€‚ç›´åˆ°ä»–æ‰¾åˆ°ç›®çš„åœ°ã€‚å½“ç„¶ï¼Œå…·ä½“ç‚¹å–å†³äºäº¤å‰éªŒè¯ä¸­çš„éšæœºæ€§ã€‚ä½†æ˜¯ï¼Œæ— è®ºå…·ä½“ç‚¹å¦‚ä½•ï¼Œéƒ½å¯ä»¥ç†è§£æ‰€å‘ç”Ÿäº‹æƒ…çš„æ€»ä½“æƒ…å†µã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘æ›¾ç»ä½¿ç”¨è¿™æ ·çš„æ—¶é—´è¡¨æ¥æ¼”ç¤ºå­¦ä¹ è¿‡ç¨‹ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶æœªæ˜¾ç¤ºæ•´ä¸ªè½¨è¿¹ï¼Œè€Œæ˜¯æ˜¾ç¤ºäº†æ¯”ä¾‹å°ºæ»‘åŠ¨å¹³æ»‘çš„æœ€åå‡ æ­¥ã€‚åœ¨æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« â€œæˆ‘ä»¬çª¥æ¢ç¥ç»ç½‘ç»œâ€ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¾‹å­ã€‚æ˜¯çš„ï¼Œå½“ç„¶ï¼Œé‡åˆ°è¿™ç§å¯è§†åŒ–çš„æ¯ä¸ªäººéƒ½ä¼šç«‹å³é—®ä¸ºä»€ä¹ˆæ‰€æœ‰å› ç´ éƒ½å…·æœ‰ç›¸åŒçš„æƒé‡ï¼Œé‡è¦æ€§ï¼Œè€Œååˆæœ‰æ‰€ä¸åŒã€‚ä¸Šä¸€æ¬¡ï¼Œæˆ‘è¯•å›¾é‡æ–°è¡¡é‡çªè§¦çš„é‡è¦æ€§ï¼Œç»“æœå´æ²¡æœ‰é‚£ä¹ˆå¤šä¿¡æ¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ¬¡ï¼Œå€ŸåŠ©æ–°çŸ¥è¯†ï¼Œæˆ‘å°†å°è¯•ä½¿ç”¨t-SNEå°†å¤šç»´ç©ºé—´éƒ¨ç½²åˆ°æŠ•å½±ä¸­ï¼Œä½¿ä¸€åˆ‡éƒ½å¯ä»¥å˜å¾—æ›´å¥½ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¨ä½</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">import</span> sklearn.manifold <span class="hljs-keyword">as</span> manifold<font></font>
tsne = manifold.TSNE(random_state=<span class="hljs-number">19</span>)<font></font>
tsne_representation = tsne.fit_transform(history)<font></font>
plt.plot(tsne_representation[:, <span class="hljs-number">0</span>], tsne_representation[:, <span class="hljs-number">1</span>])<font></font>
plt.savefig(<span class="hljs-string">"images/pic6.png"</span>, format = <span class="hljs-string">'png'</span>)<font></font>
plt.show();</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/qe/bp/nn/qebpnnz71ywbxgqvhzj3fpv8vzc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t-Sneä¼¼ä¹å·²ç»æ‰©å±•äº†ç©ºé—´ï¼Œå› æ­¤å¯¹äºé‚£äº›è¿…é€Ÿåœæ­¢å˜åŒ–çš„åŠŸèƒ½ï¼Œå®ƒå®Œå…¨å¯ä»¥æ§åˆ¶å˜åŒ–çš„èŒƒå›´ï¼Œä»è€Œä½¿å›¾åƒå®Œå…¨æ— ç”¨ã€‚</font><font style="vertical-align: inherit;">ç»“è®º-ä¸è¦è¯•å›¾å°†ç®—æ³•æ”¾åˆ°ä¸é€‚åˆä»–ä»¬ä½¿ç”¨çš„åœ°æ–¹ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨æ— æ³•è¿›ä¸€æ­¥é˜…è¯»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è¿˜å°è¯•å°†tsneæ³¨å…¥å†…éƒ¨ä»¥å¯è§†åŒ–ä¸­é—´ä¼˜åŒ–çŠ¶æ€ï¼Œä»¥æœŸèƒ½äº§ç”Ÿç¾æ„Ÿã€‚ä½†æ˜¯äº‹å®è¯æ˜ï¼Œè¿™ä¸æ˜¯ç¾ä¸½ï¼Œæ˜¯ä¸€äº›åƒåœ¾ã€‚å¦‚æœæœ‰å…´è¶£ï¼Œè¯·å‚é˜…æ“ä½œæ–¹æ³•ã€‚äº’è”ç½‘ä¸Šå……æ–¥ç€æ­¤ç±»æ³¨å…¥ä»£ç çš„ç¤ºä¾‹ï¼Œä½†ä»…å¤åˆ¶å®ƒä»¬å°±ä¸ä¼š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€ æˆ</font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éº»çƒ¦</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">å› ä¸º</font><b><font style="vertical-align: inherit;">sklearn.manifold.t_sne</font></b><font style="vertical-align: inherit;">å†…éƒ¨å‡½æ•°</font><b><font style="vertical-align: inherit;">_gradient_descentä¸­</font></b><font style="vertical-align: inherit;">åŒ…å«æ›¿ä»£</font><b><font style="vertical-align: inherit;">é¡¹</font></b><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”å–å†³äºç‰ˆæœ¬ï¼Œå…¶ç­¾åå’Œå†…éƒ¨å˜é‡çš„å¤„ç†å¯èƒ½ä¼šéå¸¸ä¸åŒã€‚å› æ­¤ï¼Œåªéœ€æ‰¾åˆ°è‡ªå·±çš„æºä»£ç ï¼Œç„¶åä»é‚£é‡Œé€‰æ‹©å‡½æ•°çš„ç‰ˆæœ¬ï¼Œç„¶ååœ¨å…¶ä¸­æ’å…¥ä¸€è¡Œï¼Œå³å¯åœ¨æ‚¨</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è‡ªå·±</font><font style="vertical-align: inherit;">çš„å˜é‡ä¸­æ·»åŠ ä¸­é—´è½¬å‚¨ï¼š</font><font style="vertical-align: inherit;">position.appendï¼ˆp.copyï¼ˆï¼‰ï¼‰ï¼ƒæˆ‘ä»¬ä¿å­˜å½“å‰ä½ç½®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¾åœ°å¯è§†åŒ–æ‰€å¾—åˆ°çš„ç»“æœï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨å°„ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> linalg
<span class="hljs-comment"># This list will contain the positions of the map points at every iteration.</span><font></font>
positions = []<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_gradient_descent</span>(<span class="hljs-params">objective, p0, it, n_iter,
                      n_iter_check=<span class="hljs-number">1</span>, n_iter_without_progress=<span class="hljs-number">300</span>,
                      momentum=<span class="hljs-number">0.8</span>, learning_rate=<span class="hljs-number">200.0</span>, min_gain=<span class="hljs-number">0.01</span>,
                      min_grad_norm=<span class="hljs-number">1e-7</span>, verbose=<span class="hljs-number">0</span>, args=None, kwargs=None</span>):</span>
    <span class="hljs-comment"># The documentation of this function can be found in scikit-learn's code.</span>
    <span class="hljs-keyword">if</span> args <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
        args = []<font></font>
    <span class="hljs-keyword">if</span> kwargs <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
        kwargs = {}<font></font>
<font></font>
    p = p0.copy().ravel()<font></font>
    update = np.zeros_like(p)<font></font>
    gains = np.ones_like(p)<font></font>
    error = np.finfo(np.float).max<font></font>
    best_error = np.finfo(np.float).max<font></font>
    best_iter = i = it<font></font>
<font></font>
    tic = time()<font></font>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(it, n_iter):<font></font>
        positions.append(p.copy()) <span class="hljs-comment"># We save the current position.</span><font></font>
        <font></font>
        check_convergence = (i + <span class="hljs-number">1</span>) % n_iter_check == <span class="hljs-number">0</span>
        <span class="hljs-comment"># only compute the error when needed</span>
        kwargs[<span class="hljs-string">'compute_error'</span>] = check_convergence <span class="hljs-keyword">or</span> i == n_iter - <span class="hljs-number">1</span><font></font>
<font></font>
        error, grad = objective(p, *args, **kwargs)<font></font>
        grad_norm = linalg.norm(grad)<font></font>
<font></font>
        inc = update * grad &lt; <span class="hljs-number">0.0</span><font></font>
        dec = np.invert(inc)<font></font>
        gains[inc] += <span class="hljs-number">0.2</span>
        gains[dec] *= <span class="hljs-number">0.8</span><font></font>
        np.clip(gains, min_gain, np.inf, out=gains)<font></font>
        grad *= gains<font></font>
        update = momentum * update - learning_rate * grad<font></font>
        p += update<font></font>
<font></font>
        <span class="hljs-keyword">if</span> check_convergence:<font></font>
            toc = time()<font></font>
            duration = toc - tic<font></font>
            tic = toc<font></font>
<font></font>
            <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                print(<span class="hljs-string">"[t-SNE] Iteration %d: error = %.7f,"</span>
                      <span class="hljs-string">" gradient norm = %.7f"</span>
                      <span class="hljs-string">" (%s iterations in %0.3fs)"</span>
                      % (i + <span class="hljs-number">1</span>, error, grad_norm, n_iter_check, duration))<font></font>
<font></font>
            <span class="hljs-keyword">if</span> error &lt; best_error:<font></font>
                best_error = error<font></font>
                best_iter = i<font></font>
            <span class="hljs-keyword">elif</span> i - best_iter &gt; n_iter_without_progress:
                <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                    print(<span class="hljs-string">"[t-SNE] Iteration %d: did not make any progress "</span>
                          <span class="hljs-string">"during the last %d episodes. Finished."</span>
                          % (i + <span class="hljs-number">1</span>, n_iter_without_progress))
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">if</span> grad_norm &lt;= min_grad_norm:
                <span class="hljs-keyword">if</span> verbose &gt;= <span class="hljs-number">2</span>:<font></font>
                    print(<span class="hljs-string">"[t-SNE] Iteration %d: gradient norm %f. Finished."</span>
                          % (i + <span class="hljs-number">1</span>, grad_norm))
                <span class="hljs-keyword">break</span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> p, error, i<font></font>
<font></font>
manifold.t_sne._gradient_descent = _gradient_descent</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”ç”¨``å›ºå®š''t-SNE</font></font></b><div class="spoiler_text"><pre><code class="python hljs">tsne_representation = manifold.TSNE(random_state=<span class="hljs-number">17</span>).fit_transform(history)<font></font>
X_iter = np.dstack(position.reshape(<span class="hljs-number">-1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> position <span class="hljs-keyword">in</span> positions)<font></font>
position_reshape = [position.reshape(<span class="hljs-number">-1</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> position <span class="hljs-keyword">in</span> positions]<font></font>
print(position_reshape[<span class="hljs-number">0</span>].shape)<font></font>
print(<span class="hljs-string">'[0] min'</span>, position_reshape[<span class="hljs-number">0</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">0</span>][:,<span class="hljs-number">0</span>].max())<font></font>
print(<span class="hljs-string">'[1] min'</span>, position_reshape[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">1</span>][:,<span class="hljs-number">0</span>].max())<font></font>
print(<span class="hljs-string">'[2] min'</span>, position_reshape[<span class="hljs-number">2</span>][:,<span class="hljs-number">0</span>].min(),<span class="hljs-string">'max'</span>, position_reshape[<span class="hljs-number">2</span>][:,<span class="hljs-number">0</span>].max())
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
41ï¼Œ2 </font><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">[0]æœ€å°å€¼-0.00018188123æœ€å¤§å€¼0.00027207955 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[1]æœ€å°å€¼-0.05136269æœ€å¤§å€¼0.032607622 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[2]æœ€å°å€¼-4.392309æœ€å¤§å€¼7.9074526 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥å€¼åœ¨éå¸¸å®½çš„èŒƒå›´å†…å˜åŒ–ï¼Œå› æ­¤åœ¨ç»˜åˆ¶å®ƒä»¬ä¹‹å‰å°†å¯¹å…¶è¿›è¡Œç¼©æ”¾ã€‚</font><font style="vertical-align: inherit;">åœ¨å¾ªç¯ä¸­ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯ç¼“æ…¢å®Œæˆçš„ã€‚</font><font style="vertical-align: inherit;">:(</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ç¼©æ”¾</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> MinMaxScaler<font></font>
minMaxScaler = MinMaxScaler()<font></font>
minMaxScaler.fit_transform(position_reshape[<span class="hljs-number">0</span>])<font></font>
position_reshape = [minMaxScaler.fit_transform(frame) <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> position_reshape]<font></font>
position_reshape[<span class="hljs-number">0</span>].min(), position_reshape[<span class="hljs-number">0</span>].max()</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ¨ç”»åŒ–</font></font></b><div class="spoiler_text"><pre><code class="python hljs">%%time<font></font>
<font></font>
<span class="hljs-keyword">from</span> matplotlib.animation <span class="hljs-keyword">import</span> FuncAnimation, PillowWriter
<span class="hljs-comment">#plt.style.use('seaborn-pastel')</span><font></font>
<font></font>
fig = plt.figure()<font></font>
<font></font>
ax = plt.axes(xlim=(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), ylim=(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))<font></font>
line, = ax.plot([], [], lw=<span class="hljs-number">3</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init</span>():</span><font></font>
    line.set_data([], [])<font></font>
    <span class="hljs-keyword">return</span> line,
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">animate</span>(<span class="hljs-params">i</span>):</span>
    x = position_reshape[i][:,<span class="hljs-number">0</span>]<font></font>
    y = position_reshape[i][:,<span class="hljs-number">1</span>]<font></font>
    line.set_data(x, y)<font></font>
    <span class="hljs-keyword">return</span> line,<font></font>
<font></font>
anim = FuncAnimation(fig, animate, init_func=init, frames=<span class="hljs-number">36</span>, interval=<span class="hljs-number">20</span>, blit=<span class="hljs-literal">True</span>, repeat_delay = <span class="hljs-number">1000</span>)<font></font>
anim.save(<span class="hljs-string">'images/animate_tsne_learning.gif'</span>, writer=PillowWriter(fps=<span class="hljs-number">5</span>))
</code></pre></div></div><br>
<img src="https://habrastorage.org/webt/lh/dq/g6/lhdqg6khzhplw6jtkei6y0s3pdu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒåœ¨æŠ€å·§ä¸Šå¾ˆæœ‰å¯å‘æ€§ï¼Œä½†åœ¨è¿™é¡¹ä»»åŠ¡å’Œä¸‘é™‹ä¸­ç»å¯¹æ²¡æœ‰ç”¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºæ­¤ï¼Œæˆ‘å‘ä½ å‘Šåˆ«ã€‚</font><font style="vertical-align: inherit;">æˆ‘å¸Œæœ›å³ä½¿åœ¨knnçš„å¸®åŠ©ä¸‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¾—åˆ°ä¸€äº›æ–°é¢–æœ‰è¶£çš„ä¸œè¥¿ä»¥åŠä¸€äº›ä»£ç ï¼Œè¿™ä¸€æƒ³æ³•ä¹Ÿå°†å¸®åŠ©æ‚¨å¦‚ä½•åœ¨è¿™åœºç˜Ÿç–«ä¸­çš„æ™ºåŠ›å¤§é¤ä¸­ç©è½¬æ•°æ®ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN496466/index.html">ä»»ä½•è¶³å¤Ÿå¿«çš„å…‰æºéƒ½å…·æœ‰çº¢è‰²å¤šæ™®å‹’é¢‘ç§»</a></li>
<li><a href="../zh-CN496472/index.html">GitHubä¸Šçš„10ä¸ªæœ‰è¶£çš„å­˜å‚¨åº“ï¼Œå¯¹ä»»ä½•å¼€å‘äººå‘˜éƒ½æœ‰ç”¨</a></li>
<li><a href="../zh-CN496476/index.html">ä½¿ç”¨Windows Server Coreå°†Windows Serveræ¨å…¥ä½åŠŸè€—VPS</a></li>
<li><a href="../zh-CN496480/index.html">æœªæ¥çš„å¯‚é™ä¹‹å£°</a></li>
<li><a href="../zh-CN496482/index.html">å›¢é˜Ÿç®¡ç†ä¸­çŸ¥æƒ…é¢†å¯¼çš„å‘å±•</a></li>
<li><a href="../zh-CN496486/index.html">æ„è§ï¼šSpamhaus-åœ¨çº¿å®¡æŸ¥è¿˜æ˜¯æ¸…æ´ç½‘ç»œæˆ˜æ–—äººå‘˜ï¼Ÿ</a></li>
<li><a href="../zh-CN496488/index.html">IaaSæä¾›å•†æŠ—å‡»BGPåè®®çš„æ”»å‡»</a></li>
<li><a href="../zh-CN496490/index.html">æˆ‘ä»¬ç ”ç©¶äº†Mediastreamer2 VoIPå¼•æ“ã€‚ç¬¬7éƒ¨åˆ†</a></li>
<li><a href="../zh-CN496492/index.html">LXDåŸºæœ¬åŠŸèƒ½-Linuxå®¹å™¨ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN496494/index.html">æˆ‘ä»¬åœ¨ç³»ç»Ÿæ‰¬å£°å™¨ä¸Šæ’­æ”¾Marioçš„éŸ³ä¹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>