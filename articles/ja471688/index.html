<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍚 ✨ 🤨 AWSが回復力のあるサービスを醸造する方法。ネットワークスケーリング 🧗🏽 🧒🏿 👨🏼‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="アマゾンウェブサービスネットワークは、米国、ヨーロッパ、アジア、アフリカ、オーストラリアの22地域に69の場所にあります。各ゾーンには、最大8つのデータセンター（データ処理センター）があります。各データセンターには数千または数十万のサーバーがあります。ネットワークは、起こりそうもないすべての停止シナ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWSが回復力のあるサービスを醸造する方法。ネットワークスケーリング</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/471688/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アマゾンウェブサービスネットワークは、米国、ヨーロッパ、アジア、アフリカ、オーストラリアの22地域に69の場所にあります。各ゾーンには、最大8つのデータセンター（データ処理センター）があります。各データセンターには数千または数十万のサーバーがあります。ネットワークは、起こりそうもないすべての停止シナリオが考慮されるような方法で構築されています。たとえば、すべてのリージョンは互いに分離されており、アクセスゾーンは数キロメートル離れています。ケーブルを切断しても、システムはバックアップチャネルに切り替わり、情報の損失はデータパケットの単位になります。ネットワークが構築される他の原則とその構築方法については、Vasily Pantyukhinに伝えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5p/_u/v_/5p_uv_g6etdeiay-nwb0r6v8ns0.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヴァシリー・パンチュキン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼は.ru企業のUnix管理者として始まり、6年間鉄の大規模なSun Microsystemで働き、11年間、EMCで世界のデータ中心性を説きました。自然にプライベートクラウドに進化し、その後公開されました。現在、Amazon Web Servicesのアーキテクトとして、テクニカルアドバイスはAWSクラウドでの生活と成長を支援します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSデバイスの三部作の前の部分では、Vasilyが物理サーバーのデバイスとデータベースのスケーリングについて詳しく調べました。ニトロカード、KVMベースのカスタムハイパーバイザー、Amazon Auroraデータベース-「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWSがどのように調理するか</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」という記事のすべては、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">その弾性サービスを提供します。サーバーとデータベースのスケーリング</font></a><font style="vertical-align: inherit;">」読んでコンテキストに飛び込むか</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレゼンテーションの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ビデオを</font></a><font style="vertical-align: inherit;">ご覧ください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この部分では、AWSで最も複雑なシステムの1つであるネットワークスケーリングに焦点を当てます。</font><font style="vertical-align: inherit;">フラットネットワークからVirtual Private Cloudとそのデバイス、内部BlackfootおよびHyperPlaneサービスへの進化、騒々しい隣人の問題、そして最終的には、ネットワーク、バックボーン、および物理ケーブルの規模。</font><font style="vertical-align: inherit;">カットの下のこのすべてについて。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項：以下はすべてVasilyの個人的な見解であり、Amazon Web Servicesの立場と一致しない場合があります。</font></font></i><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークスケーリング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSクラウドは2006年に開始されました。</font><font style="vertical-align: inherit;">彼のネットワークは非常に原始的で、フラットな構造でした。</font><font style="vertical-align: inherit;">プライベートアドレスの範囲は、クラウドのすべてのテナントに共通でした。</font><font style="vertical-align: inherit;">新しい仮想マシンを起動すると、この範囲から使用可能なIPアドレスを誤って受け取りました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/u9/jw/kju9jwz69aeoldlbn6yn_vmtzom.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチは実装が簡単でしたが、クラウドの使用は根本的に制限されていました。</font><font style="vertical-align: inherit;">特に、地上とAWSでプライベートネットワークを組み合わせたハイブリッドソリューションを開発することは非常に困難でした。</font><font style="vertical-align: inherit;">最も一般的な問題は、IPアドレスの範囲の交差です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/fu/tg/lwfutg75jtwalgbliyv-rmdhfbc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想プライベートクラウド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラウドは需要がありました。数千万のテナントによる拡張性とその使用の可能性について考える時が来ました。フラットなネットワークは大きな障害となっています。したがって、ネットワークレベルでユーザーを互いに分離して、IP範囲を個別に選択できるようにする方法を考えました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fl/tw/co/fltwcomu7sr802932c3wyyaucve.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークの分離について考えるとき、最初に何が思い浮かびますか？もちろん、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VLAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VRFは仮想ルーティングと転送</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、これは機能しませんでした。</font><font style="vertical-align: inherit;">VLAN IDはわずか12ビットであり、4096の分離されたセグメントのみを提供します。</font><font style="vertical-align: inherit;">最大のスイッチでも、最大1〜1000のVRFを使用できます。</font><font style="vertical-align: inherit;">VRFとVLANを組み合わせて使用​​すると、数百万のサブネットしか得られません。</font><font style="vertical-align: inherit;">これは数千万のテナントには十分ではなく、それぞれが複数のサブネットを使用できるはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、必要な数の大きなボックスを、たとえばCiscoやJuniperから購入するだけの余裕もありません。</font><font style="vertical-align: inherit;">理由は2つあります。非常に高額であり、開発とパッチポリシーに依存したくないからです。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論は1つだけです-あなた自身の決定を調理することです。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2009年に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Virtual Private Cloud</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を発表しました</font><font style="vertical-align: inherit;">。この名前は根付き、現在では多くのクラウドプロバイダーでも使用されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VPCは、</font><font style="vertical-align: inherit;">ソフトウェア定義ネットワーク（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">仮想ネットワーク</font><font style="vertical-align: inherit;">です。 L2およびL3レベルで特別なプロトコルを発明しないことを決定しました。ネットワークは標準のイーサネットとIPで実行されます。ネットワークを介した送信では、仮想マシンのトラフィックは独自のプロトコルのラッパーにカプセル化されます。テナントVPCに属するIDを示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x7/yh/nc/x7yhncwzn9xfi677tpy65s3td18.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは簡単に聞こえます。ただし、いくつかの深刻な技術的問題を解決する必要があります。たとえば、仮想MAC / IPアドレス、VPC ID、および対応する物理MAC / IPのマッピングデータを保存する場所と方法。 AWSスケールでは、これは最小限のレイテンシで機能する巨大なテーブルです。</font><font style="vertical-align: inherit;">これは、ネットワーク全体に薄層が塗りつぶされた</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マッピングサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が担当します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新世代の機械では、カプセル化はNitroカードによって鉄レベルで実行されます。古いインスタンスでは、カプセル化とカプセル化解除はソフトウェアです。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6q/pt/zr/6qptzrmyqowtaimwlbu6mqobr44.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが一般的にどのように機能するか見てみましょう。レベルL2から始めましょう。物理サーバー192.168.0.3にIP 10.0.0.2の仮想マシンがあるとします。 192.168.1.4上にある10.0.0.3仮想マシンにデータを送信します。 Nitroネットワークカードに該当するARP要求が生成されます。簡単にするために、両方の仮想マシンが同じ「青」のVPCに存在すると考えています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/u5/hv/vlu5hvvmaufe2e2jirp0mz14ugg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カードは送信元アドレスを自身のアドレスに置き換え、ARPフレームをマッピングサービスに送信します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0j/d9/lx/0jd9lx41a5744ptq64tdrmgzxya.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マッピングサービスは、L2物理ネットワークでの送信に必要な情報を返します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3e/ir/nt/3eirntgsopwiccgdaaneovvgqxe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ARP応答のニトロカードは、物理ネットワークのMACをVPCのアドレスに置き換えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fv/uo/kh/fvuokhk6mswvl5i8ifguxgxrhee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを転送するときは、論理MACとIPをVPCラッパーでラップします。これはすべて、適切なIP Nitroの送信元カードと宛先カードを使用して、物理ネットワークを介して送信されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/4i/u-/4k4iu-ei5cp9cdk-vfqmmf8vtig.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージがチェックを実行することを目的とした物理マシン。これは、なりすましの可能性を防ぐためです。マシンは特別なリクエストをマッピングサービスに送信し、次のように質問します。「物理マシン192.168.0.3から、青いVPCで10.0.0.3用に設計されたパケットを受信しました。彼は合法ですか？」&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/qn/0e/vvqn0ecobvoxvxw8-1u3hgc8k48.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マッピングサービスは、そのリソース割り当てテーブルをチェックして、パケットの通過を許可または拒否します。すべての新しいインスタンスでは、追加の検証がNitroカードに組み込まれています。理論的にも回避することは不可能です。したがって、別のVPCのリソースへのなりすましは機能しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/tr/wa/xxtrwaqlrsbhdledrligrt0mfjc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、データは対象となる仮想マシンに送信されます。&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1i/hb/py/1ihbpywnhbngzsuzs8376qf0i8g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マッピングサービスは、異なるサブネット上の仮想マシン間でデータを転送するための論理ルーターとしても機能します。ここではすべてが概念的に単純なので、詳細には分析しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rr/rj/9n/rrrj9nvl-jwgk54pzowtmqm6ynm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各パケットの送信中に、サーバーがマッピングサービスにアクセスすることがわかります。避けられない遅延にどう対処するか？</font><font style="vertical-align: inherit;">もちろん</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャッシング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての魅力は、巨大なテーブル全体をキャッシュする必要がないことです。</font><font style="vertical-align: inherit;">比較的少数のVPCの仮想マシンが物理サーバー上に存在します。</font><font style="vertical-align: inherit;">これらのVPCについてのみ情報をキャッシュする必要があります。</font><font style="vertical-align: inherit;">「デフォルト」構成で他のVPCにデータを転送することは、まだ正当ではありません。</font><font style="vertical-align: inherit;">VPCピアリングなどの機能が使用されている場合、対応するVPCに関する情報が追加でキャッシュにロードされます。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cj/vu/uh/cjvuuhb_xbbsrhjdzxpf0x7lnck.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VPCへのデータの転送が判明しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブラックフット</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トラフィックを外部に送信する必要がある場合、たとえばインターネットやVPNを介して地上に送信する必要がある場合はどうしますか？</font><font style="vertical-align: inherit;">これは</font><font style="vertical-align: inherit;">、AWS内部サービス</font><font style="vertical-align: inherit;">である</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blackfoot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が私たちを支援する場所</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">南アフリカのチームが設計しました。</font><font style="vertical-align: inherit;">したがって、このサービスは南アフリカに住むペンギンにちなんで名付けられました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/af/7s/gf/af7sgf9jhvniudixr94rqhwgdy0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blackfootはトラフィックのカプセル化を解除し、必要な処理を行います。</font><font style="vertical-align: inherit;">インターネットデータはそのまま送信されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fi/93/02/fi9302-pumvdpx70gqpo7ufaaqw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VPNを使用する場合、データはカプセル化が解除され、IPsecラッパーで再度ラップされます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jk/ag/iu/jkagiufrbqprn50vjuxqy_hwbe8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
直接接続を使用する場合、トラフィックはタグ付けされ、対応するVLANに送信されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/xj/i0/yjxji0wexg4cugs-cztvnv_wvxs.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハイパープレーン</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは内部フロー制御サービスです。多くのネットワークサービスでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフローステータスの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">監視が必要です</font><font style="vertical-align: inherit;">。たとえば、NATを使用する場合、フロー制御は、「IP：宛先ポート」の各ペアに一意の送信ポートがあることを確認する必要があります。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バランサー</font><font style="vertical-align: inherit;">- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロードバランサーの場合</font><font style="vertical-align: inherit;">、データストリームは常に同じターゲット仮想マシンに送られる必要があります。セキュリティグループはステートフルなファイアウォールです。着信トラフィックを監視し、発信パケットストリームのポートを暗黙的に開きます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/pa/kk/wqpakkyp8v_rdhyuclzte2e2y6w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSクラウドでは、伝送レイテンシの要件が非常に高くなっています。したがって、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperPlaneは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク全体の正常性にとって非常に重要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ov/cr/wm/ovcrwmosat9fxborz1tmkxkjt_4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパープレーンはEC2仮想マシン上に構築されています。</font><font style="vertical-align: inherit;">ここには魔法はなく、ずるいだけです。</font><font style="vertical-align: inherit;">トリックは、大容量のRAMを備えた仮想マシンであることです。</font><font style="vertical-align: inherit;">トランザクションはトランザクションであり、メモリ内でのみ実行されます。</font><font style="vertical-align: inherit;">これにより、わずか数十マイクロ秒の遅延が可能になります。</font><font style="vertical-align: inherit;">ディスクを操作すると、すべてのパフォーマンスが失われます。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハイパープレーンは、このようなEC2マシンの膨大な数の分散システムです。</font><font style="vertical-align: inherit;">各仮想マシンの帯域幅は5 GB /秒です。</font><font style="vertical-align: inherit;">これにより、地域ネットワーク全体で、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テラバイトの帯域幅が得られ、</font><b><font style="vertical-align: inherit;">毎秒数百万の接続</font></b><font style="vertical-align: inherit;">を処理できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HyperPlaneはスレッドでのみ機能します。</font><font style="vertical-align: inherit;">VPCパケットのカプセル化は彼には完全に透過的です。</font><font style="vertical-align: inherit;">この内部サービスに潜在的な脆弱性があるため、VPC分離を突破することはできません。</font><font style="vertical-align: inherit;">安全のために、以下のレベルが責任を負います。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">騒々しい隣人</font></font></h3><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">騒々しい隣人</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の問題もあり</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">隣人に</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">うるさい</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">8つのノードがあるとします。</font><font style="vertical-align: inherit;">これらのノードは、すべてのクラウドユーザーのスレッドを処理します。</font><font style="vertical-align: inherit;">すべて問題ないようで、負荷はすべてのノードに均等に分散する必要があります。</font><font style="vertical-align: inherit;">ノードは非常に強力で、オーバーロードが困難です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私たちは、ありそうもないシナリオに基づいてアーキテクチャを構築しています。&nbsp;</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低い確率は不可能を意味しません。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1人または複数のユーザーが過大な負荷を生成する状況を想像できます。すべてのHyperPlaneノードがこの負荷の処理に関与しており、他のユーザーは何らかのパフォーマンスの低下を感じる可能性があります。これは、テナントが相互に影響を与える方法がないクラウドの概念を破壊します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/ni/_l/gcni_lqe59zlatesmuodjxmcxcm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
騒々しい隣人の問題を解決するには？最初に頭に浮かぶのは、シャーディングです。 8つのノードは、それぞれ2つのノードを持つ4つのシャードに論理的に分割されています。これで、騒々しい隣人はすべてのユーザーの4分の1だけによって妨げられますが、それよりはるかに多くのユーザーが妨げられます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e7/vz/-v/e7vz-vablrrhawvz2xbvb1psfxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の方法でやりましょう。各ユーザーには3つのノードのみが割り当てられます。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/md/su/px/mdsupxahouehxh6y-jffnyhjpyy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
秘訣は、ノードを異なるユーザーにランダムに割り当てることです。</font><font style="vertical-align: inherit;">下の図では、青のユーザーが他の2人のユーザー（緑とオレンジ）の1つとノードを交差させています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xw/ee/yz/xweeyztmogrwbeomfqi_sbec0u0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8ノードと3ユーザーの場合、ノイズの多いネイバーがユーザーの1人と交差する確率は54％です。</font><font style="vertical-align: inherit;">この確率で、青のユーザーは他のテナントに影響を与えます。</font><font style="vertical-align: inherit;">さらに、その負荷の一部のみ。</font><font style="vertical-align: inherit;">私たちの例では、この影響は少なくとも何らかの形ですべてのユーザーに気づくわけではなく、全ユーザーの3分の1にしか気づきません。</font><font style="vertical-align: inherit;">これはすでに良い結果です。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交差するユーザーの数</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーセントでの確率</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">54％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">３</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2％</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状況を実際の状況に近づけましょう-5つのノードで100ノードと5人のユーザーを取ります。</font><font style="vertical-align: inherit;">この場合、どのノードも77％の確率で交差しません。&nbsp;</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交差するユーザーの数</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーセントでの確率</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.8％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">３</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.06％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0006％</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.00000013％</font></font><br>
</td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
膨大な数のHyperPlaneノードとユーザーがいる実際の状況では、他のユーザーに対するノイズの多いネイバーの潜在的な影響は最小限です。</font><font style="vertical-align: inherit;">このメソッドが呼び出され</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、混合shardirovaniem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャッフルはシャーディングされます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ノード障害の悪影響を最小限に抑えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのサービスはHyperPlaneに基づいて構築されています：ネットワークロードバランサー、NATゲートウェイ、Amazon EFS、AWS PrivateLink、AWS Transit Gateway。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワーク規模</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ネットワーク自体の規模について説明します。</font><font style="vertical-align: inherit;">2019年10月のAWSのサービスは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22リージョン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">提供されており</font><font style="vertical-align: inherit;">、さらに9 </font><b><font style="vertical-align: inherit;">リージョン</font></b><font style="vertical-align: inherit;">が計画されています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各リージョンには、いくつかのアベイラビリティーゾーンが含まれています。</font><font style="vertical-align: inherit;">世界にはそれらの69があります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各AZはデータ処理センターで構成されています。</font><font style="vertical-align: inherit;">それらは8つ以下です。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データセンターには膨大な数のサーバーがあり、そのうちのいくつかは最大30万台に達します。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、これらすべてが平均化され、乗算され</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Amazonクラウドのスケール</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を示す印象的な数値が得られます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクセスゾーンとデータセンターの間には、多くの光チャネルが敷設されています。</font><font style="vertical-align: inherit;">私たちの最大の地域の1つでは、AZと他の地域との通信センター（トランジットセンター）間のAZの通信用に388チャネルのみが敷設されています。</font><font style="vertical-align: inherit;">合計すると、これは狂った</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5000 Tbitになり</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zi/nj/bj/zinjbjkov6298ccr_kuiux7z89k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックボーンAWSはクラウド専用に構築されており、クラウドと連携するように最適化されています。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 GB /秒の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャネルで構築しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">中国の地域を除き、これらを完全に管理しています。</font><font style="vertical-align: inherit;">トラフィックは他の会社の負荷と共有されません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e-/ko/hs/e-kohsjs0wax_tmb0zd3l5xh5ys.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、私たちだけがプライベートバックボーンネットワークを備えたクラウドプロバイダーではありません。より多くの大企業がこの道を進んでいます。これは、たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegeography</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの独立した研究者によって確認されてい</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/en/ad/myenadxrsqlm4a58uyc6a_us7kq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このグラフは、コンテンツプロバイダーとクラウドプロバイダーのシェアが拡大していることを示しています。このため、バックボーンプロバイダーからのインターネットトラフィックの割合は常に減少しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが起こる理由を説明します。以前は、ほとんどのWebサービスが利用可能であり、インターネットから直接利用されていました。現在、ますます多くのサーバーがクラウドに配置され、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content Distribution Network</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を通じて利用できます</font><font style="vertical-align: inherit;">。リソースにアクセスするために、ユーザーは最も近いCDN PoP- </font><b><font style="vertical-align: inherit;">Point of Presenceに</font></b><font style="vertical-align: inherit;">のみインターネットを経由します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ほとんどの場合、それは近くのどこかにあります。</font><font style="vertical-align: inherit;">次に、公共のインターネットを離れ、プライベートバックボーンなどを介して大西洋を飛行し、リソースに直接アクセスします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この傾向が続くと、インターネットは10年後にどう変わるのだろうか。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物理チャネル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
科学者たちはまだ宇宙で光の速度を上げる方法を理解していませんが、光ファイバーを介してそれを伝送する方法に大きな進歩を遂げました。現在6912ファイバーケーブルを使用しています。これは、インストールのコストを大幅に最適化するのに役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の地域では、特別なケーブルを使用する必要があります。たとえば、シドニー地域では、シロアリに対して特別なコーティングを施したケーブルを使用しています。&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qc/vn/wh/qcvnwhnrrbnil48u0qqgblljgna.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
誰もトラブルから安全ではなく、時には私たちのチャンネルが破損しています。右の写真は、ビルダーが引き裂いたアメリカの地域の光ケーブルです。事故の結果、失われたデータパケットは13のみであり、これは驚くべきことです。もう一度-たった13システムは文字通り瞬時にバックアップチャネルに切り替わりました-スケールは機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはいくつかのアマゾンクラウドサービスとテクノロジーを駆け回りました。</font><font style="vertical-align: inherit;">私たちのエンジニアが解決しなければならないタスクの規模について、少なくともある程度の知識があることを願っています。</font><font style="vertical-align: inherit;">個人的にはとても興味があります。&nbsp;</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、AWSデバイスに関するVasily Pantyukhinの三部作の最後の部分です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分は、サーバの最適化とデータベースのスケーリングを説明し、そして</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二には、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーレス機能と爆竹を記述する。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11月に、ワシーリーPantyukhinは新しいアマゾンのデバイスの詳細情報を共有することになります。</font><font style="vertical-align: inherit;">彼は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">話をする</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">障害の原因とAmazonでの分散システムの設計について。</font><font style="vertical-align: inherit;">10月24日でも</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チケットをお得な料金で予約して、後で支払う</font><font style="vertical-align: inherit;">ことができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちはHighLoad ++であなたを待っています、来て、話してください！</font></font></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471670/index.html">Jetpack Composeを戦闘で試してみませんか？</a></li>
<li><a href="../ja471676/index.html">Телефонные мошенники. Действие второе, в котором я срываюсь и бегу до ближайшего банкомата</a></li>
<li><a href="../ja471678/index.html">オンデマンドでサービスを提供</a></li>
<li><a href="../ja471684/index.html">nginxのモジュールを作成する必要がある理由</a></li>
<li><a href="../ja471686/index.html">AWSが回復力のあるサービスを醸造する方法。サーバーとデータベースのスケーリング</a></li>
<li><a href="../ja471700/index.html">将来の基盤を備えた技術スタックをどのように選択したか</a></li>
<li><a href="../ja471702/index.html">サイバー拡張Webアプリケーション</a></li>
<li><a href="../ja471704/index.html">本「セルフィ​​ッシュミトコンドリア。健康を維持して老後を動かす方法」</a></li>
<li><a href="../ja471706/index.html">NetFlow分析を使用して検出できる9つの典型的なネットワーク問題（例としてFlowmonを使用）</a></li>
<li><a href="../ja471708/index.html">ストーリーポイントはクライアント/サーバーアプリケーションの開発にとって危険です</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>