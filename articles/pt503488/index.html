<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ß üëàüèø üó°Ô∏è Melhores pr√°ticas do Kubernetes. Desativar finaliza√ß√£o correta üóÇÔ∏è üè≥Ô∏è üë©üèæ‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Melhores pr√°ticas do Kubernetes. Criando 
 pr√°ticas recomendadas para Kubernetes de cont√™ineres pequenos. Organiza√ß√£o Kubernetes com o namespace Kuber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Melhores pr√°ticas do Kubernetes. Desativar finaliza√ß√£o correta</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503488/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores pr√°ticas do Kubernetes. Criando </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√°ticas recomendadas para Kubernetes de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">cont√™ineres </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">pequenos. Organiza√ß√£o Kubernetes com o namespace Kubernetes </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best Practices. Teste de viabilidade Kubernetes com testes de prontid√£o e vida </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√°ticas recomendadas de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">. Configurando Solicita√ß√µes e Limites de Recursos</font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/pw/un/tmpwunqsjdjy_abzbl8c0t-exzo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um ponto importante na opera√ß√£o de sistemas distribu√≠dos √© o tratamento de falhas. O Kubernetes ajuda nisso, usando controladores que monitoram o estado do seu sistema e reiniciam os servi√ßos que pararam de funcionar. No entanto, o Kubernetes pode desligar √† for√ßa seus aplicativos para garantir a viabilidade geral do sistema. Nesta s√©rie, veremos como voc√™ pode ajudar o Kubernetes a realizar seu trabalho com mais efici√™ncia e reduzir o tempo de inatividade do aplicativo.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de usar cont√™ineres, a maioria dos aplicativos era executada em m√°quinas virtuais ou f√≠sicas. Se o aplicativo travou ou travou, demorou muito tempo para remover a tarefa em andamento e baixar novamente o programa. Na pior das hip√≥teses, algu√©m tinha que resolver esse problema manualmente √† noite, no hor√°rio mais inoportuno. Se apenas 1-2 m√°quinas de trabalho executassem uma tarefa importante, esse mau funcionamento seria completamente inaceit√°vel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, em vez de reiniciar manualmente, eles come√ßaram a usar o monitoramento no n√≠vel do processo para reiniciar automaticamente o aplicativo no caso de sua finaliza√ß√£o anormal. Se o programa travar, o processo de monitoramento captura o c√≥digo de sa√≠da e reinicia o servidor. Com o advento de sistemas como o Kubernetes, esse tipo de resposta a falhas do sistema foi simplesmente integrado √† infraestrutura.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes usa o loop de eventos "observar - confirmar diferen√ßas - confirmar" para garantir que os recursos estejam operacionais ao longo do caminho, desde os cont√™ineres at√© os pr√≥prios n√≥s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/rw/f9/6nrwf9r4k54zb99ghrykicqtc78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso significa que voc√™ n√£o precisa mais iniciar manualmente os processos de monitoramento. Se um recurso falhar no Health Check, o Kubernetes simplesmente fornecer√° uma substitui√ß√£o automaticamente. O Kubernetes faz muito mais do que apenas monitorar as falhas de seu aplicativo. Ele pode criar mais c√≥pias do aplicativo para trabalhar em v√°rias m√°quinas, atualizar o aplicativo ou executar simultaneamente v√°rias vers√µes do aplicativo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, existem muitas raz√µes pelas quais o Kubernetes pode interromper um recipiente perfeitamente saud√°vel. Por exemplo, se voc√™ atualizar sua implanta√ß√£o, o Kubernetes interromper√° lentamente os pods antigos ao lan√ßar novos. Se voc√™ desconectar um n√≥, o Kubernetes encerrar√° todos os lares nesse n√≥. Por fim, se o n√≥ ficar sem recursos, o Kubernetes desativar√° todos os pods para liberar esses recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, √© muito importante que seu aplicativo pare de funcionar com impacto m√≠nimo no usu√°rio final e tempo m√≠nimo de recupera√ß√£o. Isso significa que, antes de desconectar, ele deve salvar todos os dados que precisam ser salvos, fechar todas as conex√µes de rede, concluir o trabalho restante e ter tempo para concluir outras tarefas urgentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pr√°tica, isso significa que seu aplicativo deve poder processar a mensagem SIGTERM - o sinal de encerramento do processo, que √© o sinal padr√£o para o utilit√°rio kill no sistema operacional da fam√≠lia Unix. Depois de receber esta mensagem, o aplicativo deve se desconectar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que Kubernetes decidiu concluir o pod, toda uma s√©rie de eventos ocorreu. Vamos dar uma olhada em todas as etapas que o Kubernetes executa quando um cont√™iner ou lareira √© conclu√≠do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que desejemos completar uma das lareiras. Nesse momento, ele deixar√° de receber novo tr√°fego - os cont√™ineres trabalhando na lareira n√£o ser√£o afetados, mas todo o novo tr√°fego ser√° bloqueado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/go/iq/swgoiqnkzgrbf1g9ikbyc7kq6ym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos o gancho preStop - este √© um comando especial ou solicita√ß√£o HTTP enviada aos cont√™ineres na lareira. Se o seu aplicativo n√£o desligar corretamente quando o SIGTERM for recebido, voc√™ poder√° usar o preStop para sair corretamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/rk/a-/rcrka-cajxoq76gtcdaopdabeak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos programas quando recebe um sinal SIGTERM termina corretamente, mas se voc√™ usar c√≥digo de terceiros ou algum sistema que n√£o possa controlar completamente, o gancho preStop √© uma √≥tima maneira de causar um desligamento normal sem alterar o aplicativo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s executar este gancho, o Kubernetes enviar√° um sinal SIGTERM para os cont√™ineres na lareira, o que permitir√° que eles saibam que ser√£o desconectados em breve. Ap√≥s receber esse sinal, seu c√≥digo continuar√° com o processo de desligamento. Esse processo pode incluir a interrup√ß√£o de qualquer conex√£o de longa dura√ß√£o, como a conex√£o com um banco de dados ou um fluxo WebSocket, salvando o estado atual e similares. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo se voc√™ usar o gancho preStop, √© muito importante verificar o que exatamente acontece com seu aplicativo quando voc√™ envia um sinal SIGTERM, como ele se comporta de tal maneira que eventos ou mudan√ßas na opera√ß√£o do sistema causadas pelo desligamento da lareira n√£o sejam uma surpresa para voc√™.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse momento, antes de tomar outras medidas, o Kubernetes aguardar√° um tempo especificado, chamado terminationGracePeriodSecond, ou o per√≠odo para desligar corretamente ao receber um sinal SIGTERM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_9/uq/gj/_9uqgjt61tblfxn6kgbrjnh3zs8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padr√£o, esse per√≠odo √© de 30 segundos. √â importante notar que dura em paralelo com o gancho preStop e o sinal SIGTERM. O Kubernetes n√£o esperar√° o encerramento do preStop e o SIGTERM - se o seu aplicativo sair antes do t√©rmino do per√≠odo TerminationGracePeriod, o Kubernetes continuar√° imediatamente para a pr√≥xima etapa. Portanto, verifique se o valor desse per√≠odo em segundos n√£o √© menor que o tempo necess√°rio para que a lareira desligue corretamente e, se exceder 30 s, aumente o per√≠odo para o valor desejado em YAML. No exemplo acima, s√£o 60 anos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, a √∫ltima etapa - se os cont√™ineres continuarem a funcionar ap√≥s o t√©rmino do terminationGracePeriod, eles enviar√£o um sinal SIGKILL e ser√£o exclu√≠dos √† for√ßa. </font><font style="vertical-align: inherit;">Nesse ponto, o Kubernetes tamb√©m limpar√° todos os outros objetos do pod. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/zp/t9/ptzpt92xzjuszc3tw0mwhgbp80m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes desliga as lareiras por v√°rios motivos; portanto, verifique se seu aplicativo ser√° conclu√≠do corretamente para garantir a opera√ß√£o est√°vel do servi√ßo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores pr√°ticas do Kubernetes. </font><font style="vertical-align: inherit;">Mapeando Servi√ßos Externos</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z_l_kE1MDTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores de n√≠vel b√°sico que foi inventado por n√≥s para voc√™: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um pr√©dio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503472/index.html">Pagamentos sem dinheiro, podcasts e carne artificial: o que outras empresas est√£o lidando bem com a crise do coronav√≠rus</a></li>
<li><a href="../pt503474/index.html">Minha experi√™ncia em desenvolvimento de aplicativos como PM</a></li>
<li><a href="../pt503476/index.html">Gravar autotestes de interface do usu√°rio de v√≠deo trabalhando no Chrome sem cabe√ßa</a></li>
<li><a href="../pt503480/index.html">At√© 40 Milhares: Mais de 10 Resenhas de Jogadores de Vinil</a></li>
<li><a href="../pt503486/index.html">Quantas instru√ß√µes em x86?</a></li>
<li><a href="../pt503490/index.html">Compara√ß√£o de cenas de rap russas usando t√©cnicas de minera√ß√£o de texto e texto. Noize Mc, Oxxxymiron, tio Zhenya. Epis√≥dio 2</a></li>
<li><a href="../pt503494/index.html">Montando um gateway DIY para dispositivos Zigbee</a></li>
<li><a href="../pt503504/index.html">O projeto de ci√™ncia de dados mais bem-sucedido e mais escandaloso: Cambridge Analytica</a></li>
<li><a href="../pt503508/index.html">Escolas, professores, alunos, suas notas e classifica√ß√µes</a></li>
<li><a href="../pt503518/index.html">Neomorfismo usando SwiftUI. Parte 2: O que pode ser feito com acessibilidade?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>