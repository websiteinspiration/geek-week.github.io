<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤧 👈🏿 🗡️ Melhores práticas do Kubernetes. Desativar finalização correta 🗂️ 🏳️ 👩🏾‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Melhores práticas do Kubernetes. Criando 
 práticas recomendadas para Kubernetes de contêineres pequenos. Organização Kubernetes com o namespace Kuber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Melhores práticas do Kubernetes. Desativar finalização correta</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503488/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores práticas do Kubernetes. Criando </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">práticas recomendadas para Kubernetes de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">contêineres </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">pequenos. Organização Kubernetes com o namespace Kubernetes </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Best Practices. Teste de viabilidade Kubernetes com testes de prontidão e vida </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Práticas recomendadas de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Kubernetes </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">. Configurando Solicitações e Limites de Recursos</font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/pw/un/tmpwunqsjdjy_abzbl8c0t-exzo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um ponto importante na operação de sistemas distribuídos é o tratamento de falhas. O Kubernetes ajuda nisso, usando controladores que monitoram o estado do seu sistema e reiniciam os serviços que pararam de funcionar. No entanto, o Kubernetes pode desligar à força seus aplicativos para garantir a viabilidade geral do sistema. Nesta série, veremos como você pode ajudar o Kubernetes a realizar seu trabalho com mais eficiência e reduzir o tempo de inatividade do aplicativo.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de usar contêineres, a maioria dos aplicativos era executada em máquinas virtuais ou físicas. Se o aplicativo travou ou travou, demorou muito tempo para remover a tarefa em andamento e baixar novamente o programa. Na pior das hipóteses, alguém tinha que resolver esse problema manualmente à noite, no horário mais inoportuno. Se apenas 1-2 máquinas de trabalho executassem uma tarefa importante, esse mau funcionamento seria completamente inaceitável. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, em vez de reiniciar manualmente, eles começaram a usar o monitoramento no nível do processo para reiniciar automaticamente o aplicativo no caso de sua finalização anormal. Se o programa travar, o processo de monitoramento captura o código de saída e reinicia o servidor. Com o advento de sistemas como o Kubernetes, esse tipo de resposta a falhas do sistema foi simplesmente integrado à infraestrutura.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes usa o loop de eventos "observar - confirmar diferenças - confirmar" para garantir que os recursos estejam operacionais ao longo do caminho, desde os contêineres até os próprios nós. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/rw/f9/6nrwf9r4k54zb99ghrykicqtc78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso significa que você não precisa mais iniciar manualmente os processos de monitoramento. Se um recurso falhar no Health Check, o Kubernetes simplesmente fornecerá uma substituição automaticamente. O Kubernetes faz muito mais do que apenas monitorar as falhas de seu aplicativo. Ele pode criar mais cópias do aplicativo para trabalhar em várias máquinas, atualizar o aplicativo ou executar simultaneamente várias versões do aplicativo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, existem muitas razões pelas quais o Kubernetes pode interromper um recipiente perfeitamente saudável. Por exemplo, se você atualizar sua implantação, o Kubernetes interromperá lentamente os pods antigos ao lançar novos. Se você desconectar um nó, o Kubernetes encerrará todos os lares nesse nó. Por fim, se o nó ficar sem recursos, o Kubernetes desativará todos os pods para liberar esses recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, é muito importante que seu aplicativo pare de funcionar com impacto mínimo no usuário final e tempo mínimo de recuperação. Isso significa que, antes de desconectar, ele deve salvar todos os dados que precisam ser salvos, fechar todas as conexões de rede, concluir o trabalho restante e ter tempo para concluir outras tarefas urgentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na prática, isso significa que seu aplicativo deve poder processar a mensagem SIGTERM - o sinal de encerramento do processo, que é o sinal padrão para o utilitário kill no sistema operacional da família Unix. Depois de receber esta mensagem, o aplicativo deve se desconectar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois que Kubernetes decidiu concluir o pod, toda uma série de eventos ocorreu. Vamos dar uma olhada em todas as etapas que o Kubernetes executa quando um contêiner ou lareira é concluído. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponha que desejemos completar uma das lareiras. Nesse momento, ele deixará de receber novo tráfego - os contêineres trabalhando na lareira não serão afetados, mas todo o novo tráfego será bloqueado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/go/iq/swgoiqnkzgrbf1g9ikbyc7kq6ym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos o gancho preStop - este é um comando especial ou solicitação HTTP enviada aos contêineres na lareira. Se o seu aplicativo não desligar corretamente quando o SIGTERM for recebido, você poderá usar o preStop para sair corretamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/rk/a-/rcrka-cajxoq76gtcdaopdabeak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos programas quando recebe um sinal SIGTERM termina corretamente, mas se você usar código de terceiros ou algum sistema que não possa controlar completamente, o gancho preStop é uma ótima maneira de causar um desligamento normal sem alterar o aplicativo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após executar este gancho, o Kubernetes enviará um sinal SIGTERM para os contêineres na lareira, o que permitirá que eles saibam que serão desconectados em breve. Após receber esse sinal, seu código continuará com o processo de desligamento. Esse processo pode incluir a interrupção de qualquer conexão de longa duração, como a conexão com um banco de dados ou um fluxo WebSocket, salvando o estado atual e similares. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo se você usar o gancho preStop, é muito importante verificar o que exatamente acontece com seu aplicativo quando você envia um sinal SIGTERM, como ele se comporta de tal maneira que eventos ou mudanças na operação do sistema causadas pelo desligamento da lareira não sejam uma surpresa para você.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse momento, antes de tomar outras medidas, o Kubernetes aguardará um tempo especificado, chamado terminationGracePeriodSecond, ou o período para desligar corretamente ao receber um sinal SIGTERM. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_9/uq/gj/_9uqgjt61tblfxn6kgbrjnh3zs8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padrão, esse período é de 30 segundos. É importante notar que dura em paralelo com o gancho preStop e o sinal SIGTERM. O Kubernetes não esperará o encerramento do preStop e o SIGTERM - se o seu aplicativo sair antes do término do período TerminationGracePeriod, o Kubernetes continuará imediatamente para a próxima etapa. Portanto, verifique se o valor desse período em segundos não é menor que o tempo necessário para que a lareira desligue corretamente e, se exceder 30 s, aumente o período para o valor desejado em YAML. No exemplo acima, são 60 anos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, finalmente, a última etapa - se os contêineres continuarem a funcionar após o término do terminationGracePeriod, eles enviarão um sinal SIGKILL e serão excluídos à força. </font><font style="vertical-align: inherit;">Nesse ponto, o Kubernetes também limpará todos os outros objetos do pod. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/zp/t9/ptzpt92xzjuszc3tw0mwhgbp80m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes desliga as lareiras por vários motivos; portanto, verifique se seu aplicativo será concluído corretamente para garantir a operação estável do serviço. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores práticas do Kubernetes. </font><font style="vertical-align: inherit;">Mapeando Serviços Externos</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z_l_kE1MDTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Você gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analógico exclusivo de servidores de nível básico que foi inventado por nós para você: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 núcleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as opções estão disponíveis com RAID1 e RAID10, até 24 núcleos e até 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterdã?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente nós temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um prédio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503472/index.html">Pagamentos sem dinheiro, podcasts e carne artificial: o que outras empresas estão lidando bem com a crise do coronavírus</a></li>
<li><a href="../pt503474/index.html">Minha experiência em desenvolvimento de aplicativos como PM</a></li>
<li><a href="../pt503476/index.html">Gravar autotestes de interface do usuário de vídeo trabalhando no Chrome sem cabeça</a></li>
<li><a href="../pt503480/index.html">Até 40 Milhares: Mais de 10 Resenhas de Jogadores de Vinil</a></li>
<li><a href="../pt503486/index.html">Quantas instruções em x86?</a></li>
<li><a href="../pt503490/index.html">Comparação de cenas de rap russas usando técnicas de mineração de texto e texto. Noize Mc, Oxxxymiron, tio Zhenya. Episódio 2</a></li>
<li><a href="../pt503494/index.html">Montando um gateway DIY para dispositivos Zigbee</a></li>
<li><a href="../pt503504/index.html">O projeto de ciência de dados mais bem-sucedido e mais escandaloso: Cambridge Analytica</a></li>
<li><a href="../pt503508/index.html">Escolas, professores, alunos, suas notas e classificações</a></li>
<li><a href="../pt503518/index.html">Neomorfismo usando SwiftUI. Parte 2: O que pode ser feito com acessibilidade?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>