<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😺 🤷🏼 🧑🏽‍🤝‍🧑🏻 Et encore une fois Qbot - une nouvelle souche de cheval de Troie bancaire 🔊 🍣 🤯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous avons découvert et inversé l'ingénierie d'une autre nouvelle souche de Qbot, un logiciel malveillant complexe et largement connu qui collecte des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Et encore une fois Qbot - une nouvelle souche de cheval de Troie bancaire</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/486790/"><img src="https://habrastorage.org/webt/cj/7x/id/cj7xidsu1_9bkjmliahsaf1axbs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons découvert et inversé l'ingénierie d'une autre nouvelle souche de Qbot, un logiciel malveillant complexe et largement connu qui collecte des données qui vous permet de commettre une fraude financière. Voici des exemples de données collectées par Qbot: cookies de navigateur, informations de certificat, frappes, paires login-mot de passe et autres informations d'identification, ainsi que des données de sessions ouvertes dans des applications Web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'équipe de recherche en sécurité de Varonis a répondu à plusieurs cas d'infection par Qbot en 2019, principalement aux États-Unis. Il semble que les développeurs de Qbot n'étaient pas inactifs: ils ont créé de nouvelles souches avec de nouvelles fonctionnalités, améliorant simultanément la capacité d'empêcher la détection par les équipes responsables de la sécurité des informations.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons décrit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une souche antérieure de Qbot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et discuté de son TTP (tactiques, techniques et procédures). </font><font style="vertical-align: inherit;">La nouvelle souche diffère de la précédente sur deux points principaux:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au lieu d'essayer de deviner les mots de passe d'un utilisateur de domaine, cette souche utilise un utilisateur déjà compromis pour créer une carte des dossiers réseau disponibles; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il envoie les données de la victime au serveur FTP, au lieu d'utiliser des requêtes HTTP POST.</font></font></li>
</ul><br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détection</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un de nos clients a demandé de l'aide après une notification de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la plateforme de cybersécurité Varonis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le compte utilisateur se comporte de manière atypique et donne accès à un nombre inhabituel de nœuds de réseau. </font><font style="vertical-align: inherit;">Ensuite, le client a attiré l'attention sur les journaux de la solution antivirus sur l'appareil à partir duquel cet accès a été effectué et a remarqué des alertes non traitées sur le fichier infecté qui sont apparues à peu près au même moment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fichiers bruts se trouvaient dans le dossier temporaire du profil utilisateur et avaient les extensions </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.vbs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.zip</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'équipe de criminalistique de Varonis a aidé l'utilisateur à récupérer des échantillons des fichiers infectés, et l'équipe de recherche en sécurité a analysé et constaté qu'il s'agissait d'une </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouvelle variante de Qbot</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment fonctionne-t-il</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons lancé le fichier infecté dans notre laboratoire et trouvé des indicateurs similaires qu'il était malveillant avec ceux qui étaient dans notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">étude précédente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mise en œuvre du processus "explorer.exe", connexion à la même URL, les mêmes mécanismes pour assurer une présence constante dans le registre et sur le disque et la même copie de remplacement du fichier avec "calc.exe". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette souche contenait un fichier de configuration crypté, avec l'extension incorrecte ".dll". En utilisant une analyse dynamique du processus explorer.exe, nous avons constaté que la clé pour déchiffrer le fichier de configuration RC4 chiffré est le hachage SHA1 de la chaîne unique que le malware crée pour chaque appareil (nous savons que ce n'est pas un jeu de caractères aléatoire, comme la précédente variation Qbot créée même ligne pour le même appareil).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici les données de configuration que nous avons décodées pour notre appareil: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/eu/_z/it/eu_zitvq4rphqklbvmserhft8d8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette configuration contient les données suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temps d'installation;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">heure du dernier appel de C2; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP externe de la victime; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> liste des dossiers réseau entourés par la victime. </font></font></li>
</ul><br>
<h3><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase I: Bootloader </font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noms de fichiers: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVC_82633.vbs</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
SHA1: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f38ed9fec9fe4e6451645724852aa2da9fce1be9</font></font></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Comme la version précédente, cette variante de Qbot utilisait le fichier VBS pour télécharger les principaux modules malveillants.</font></font><br>
<br>
<h3><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase II: assurer une présence constante dans le système et une implémentation dans les processus</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout comme l'exemple précédent, le chargeur de démarrage lance les modules du noyau du malware et garantit la constance de leur présence dans le système d'exploitation. </font><font style="vertical-align: inherit;">Cette version se copie dans </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
% Appdata% \ Roaming \ Microsoft \ {Ligne arbitraire} au lieu de% Appdata% \ Roaming \ {Ligne arbitraire}, mais les valeurs des clés de registre et des tâches planifiées sont restées identiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La charge utile principale est intégrée dans tous les processus actifs exécutés au nom de l'utilisateur.</font></font><br>
<br>
<h3><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phase III: vol de données - chemin vers le serveur pirate</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir assuré la présence dans le système, le malware essaie de se connecter à son serveur C2 en utilisant l'URI content.bigflimz.com. </font><font style="vertical-align: inherit;">Cette version collecte des données importantes à ses fins sur l'ordinateur de la victime et les envoie via FTP en utilisant des paramètres de connexion et de mot de passe codés en dur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce serveur contenait des données chiffrées collectées auprès des victimes, avec le principe de dénomination suivant: «artic1e- * 6 caractères et après eux 6 autres chiffres * - * POSIX-time * .zip». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons ouvert le serveur FTP spécifié et trouvé ce dossier avec le contenu suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/vf/zc/kpvfzcujonqtqvzb2lc9antejxe.png"><br>
<br>
<img src="https://habrastorage.org/webt/sk/cn/a4/skcna4gadyaviscreyowp7c-2e8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas encore pu décrypter les fichiers zip pour déterminer quelles données ont été volées.</font></font><br>
<br>
<h2><font color="#D21927"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récupération et récupération</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme nous n'avons trouvé qu'un seul appareil infecté, nos recommandations étaient les suivantes:</font></font><br>
<br>
<ol>
<li>         ,        ,    ; </li>
<li>         ,   ,        IP-,    ;</li>
<li>      Varonis,     .</li>
</ol></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486790/">https://habr.com/ru/post/fr486790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr486778/index.html">SSO sur l'architecture de microservice. Nous utilisons Keycloak. Numéro de pièce 1</a></li>
<li><a href="../fr486780/index.html">Développement frontend dans l'entreprise: qu'est-ce que c'est et comment le rendre efficace</a></li>
<li><a href="../fr486782/index.html">UI / UX - conception. Tendances et prévisions pour 2020</a></li>
<li><a href="../fr486784/index.html">Les frères Lumiere n'ont jamais rêvé</a></li>
<li><a href="../fr486788/index.html">Webinaire «Surveillance à distance et diagnostic des équipements. Études de cas sur la solution CNC de Winnum »</a></li>
<li><a href="../fr486792/index.html">Le chemin du robot vers le satellite glacé d'une autre planète commence dans les profondeurs de l'Antarctique</a></li>
<li><a href="../fr486794/index.html">Les processus des neurones humains ont montré une capacité inattendue à calculer</a></li>
<li><a href="../fr486798/index.html">Y a-t-il un GameDev à Sakhaline? Fin</a></li>
<li><a href="../fr486800/index.html">Cassandra. Comment ne pas mourir si vous ne connaissez qu'Oracle</a></li>
<li><a href="../fr486802/index.html">Les gens rencontrent des systèmes de recommandation. Factorisation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>