<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ†˜ â™ï¸ ğŸ° æª»ã®ä¸­ã®ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ï¼Ÿ ğŸŒ¤ï¸ ğŸ§Ÿ ğŸ‘¨â€ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ãŸã¾ãŸã¾ç§ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆç•¥ã—ã¦sysadminï¼‰ã®ãƒ—ãƒ­ã®ç®¡ç†è€…ã§ã‚ã‚Šã€ãŸã¾ãŸã¾profã«æ•™ãˆã¾ã—ãŸã€‚ä¸Šè¨˜ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å¿…è¦ã¨ã™ã‚‹ã‚‚ã®ã‚’å«ã‚€ã€ã•ã¾ã–ã¾ãªã‚·ã‚¹ãƒ†ãƒ ã®æ´»å‹•ã€‚å°‘ã—å‰ã«ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã‚’è‡ªåˆ†ã«ã¨ã£ã¦èˆˆå‘³æ·±ã„ã‚‚ã®ã§ã‚ã‚‹ã¨æ„Ÿã˜ã€ãã‚Œã‚’ä½¿ç”¨ã—ãŸã ã‘ã§ãªãã€é–‹ç™ºã®è¦³ç‚¹ã‹ã‚‰ãƒ“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æª»ã®ä¸­ã®ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ï¼Ÿ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477124/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã¾ãŸã¾ç§ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆç•¥ã—ã¦sysadminï¼‰ã®ãƒ—ãƒ­ã®ç®¡ç†è€…ã§ã‚ã‚Šã€ãŸã¾ãŸã¾profã«æ•™ãˆã¾ã—ãŸã€‚ä¸Šè¨˜ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å¿…è¦ã¨ã™ã‚‹ã‚‚ã®ã‚’å«ã‚€ã€ã•ã¾ã–ã¾ãªã‚·ã‚¹ãƒ†ãƒ ã®æ´»å‹•ã€‚å°‘ã—å‰ã«ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’è‡ªåˆ†ã«ã¨ã£ã¦èˆˆå‘³æ·±ã„ã‚‚ã®ã§ã‚ã‚‹ã¨æ„Ÿã˜</font><font style="vertical-align: inherit;">ã€ãã‚Œã‚’ä½¿ç”¨ã—ãŸã ã‘ã§ãªãã€é–‹ç™ºã®è¦³ç‚¹ã‹ã‚‰ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆçµå±€ã®ã¨ã“ã‚p2pï¼‰ã¨ç‹¬ç«‹ã—ã¦å‹•ä½œã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ãŸã‚ã«ã„ãã¤ã‹ã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹</font><font style="vertical-align: inherit;">ã—ãŸã“ã¨ã‚‚åˆ¤æ˜ã—ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ï¼ˆç§ã¯ç¢ºã‹ã«è‡ªåˆ†è‡ªèº«ãª</font></font><code>dev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®ã§ã€é€šã‚Šéãã¾ã™ï¼‰ã€‚ã—ã‹ã—ã€ç§ã¯é–‹ç™ºã«ã¤ã„ã¦è©±ã—ã¦ã„ã‚‹ã®ã§ã¯ãªãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®å®‰å…¨ã§åŠ¹æœçš„ãªç’°å¢ƒã«ã¤ã„ã¦è©±ã—ã¦ã„ã‚‹ã®ã§ã™ã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡‘èæŠ€è¡“ï¼ˆ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fintech</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã¯æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infosec</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã¨</font><em><font style="vertical-align: inherit;">ä½µç”¨</font></em><font style="vertical-align: inherit;">ã§ãã€æœ€åˆã®</font><font style="vertical-align: inherit;">æŠ€è¡“</font><font style="vertical-align: inherit;">ã¯2ç•ªç›®ã®æŠ€è¡“ãªã—ã§ã‚‚æ©Ÿèƒ½ã—ã¾ã™ãŒã€é•·ãã¯ç¶šãã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€ç§ã¯è‡ªåˆ†ã®çµŒé¨“ã¨ã€</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fintech</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infosecã®</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¡æ–¹ã‚’å«ã‚€ç§ãŒä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã®ã‚»ãƒƒãƒˆã‚’å…±æœ‰ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">åŒæ™‚ã«ã€ãã‚Œã¯ã‚ˆã‚Šåºƒã„ç›®çš„ã‚„å®Œå…¨ã«ç•°ãªã‚‹ç›®çš„ã«ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã«ã¤ã„ã¦ã§ã¯ãªãã€é‡‘èã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã ã‘ã§ãªãï¼‰ã®é–‹ç™ºã¨é‹ç”¨ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã€ŒBã€ãŒé‡è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³å–å¼•æ‰€ã¨ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã‚’ã¾ã£ãŸãæŒãŸãªã„å°ä¼æ¥­ã®ã‚µãƒ¼ãƒ“ã‚¹ã®æœ€ã‚‚å…¸å‹çš„ãªä¼æ¥­å‹•ç‰©åœ’ã®ä¸¡æ–¹ã«å½“ã¦ã¯ã¾ã‚Šã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œæ„šã‹ãªã‚·ãƒ³ãƒ—ãƒ«ã•ã€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œå°‘ãªã„ã»ã†ãŒå¤šã„ã€</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã„ã†åŸå‰‡ã®æ”¯æŒè€…ã§ã‚ã‚‹ã“ã¨ã‚’æŒ‡æ‘˜ã—ãŸã„</font><font style="vertical-align: inherit;">ã®ã§ã€è¨˜äº‹ã¨ãã“ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã®ä¸¡æ–¹ã«ã€ã“ã‚Œã‚‰ã®åŸå‰‡ã«é–¢ã™ã‚‹ç‰¹æ€§ãŒã‚ã‚Šã¾ã™ã€‚</font></font></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¶ç©ºã®ã‚·ãƒŠãƒªã‚ªï¼š</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³äº¤æ›å™¨ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ç§ãŸã¡ã¯ãƒ«ãƒ¼ãƒ–ãƒ«ã€ãƒ‰ãƒ«ã€ãƒ¦ãƒ¼ãƒ­ã‚’ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã«ã€ã¾ãŸã¯ãã®é€†ã«äº¤æ›ã™ã‚‹ã“ã¨ã‚’é–‹å§‹ã™ã‚‹ã“ã¨ã‚’æ±ºã‚ã¾ã—ãŸã€ãã—ã¦ç§ãŸã¡ã¯ã™ã§ã«å®Ÿç”¨çš„ãªè§£æ±ºç­–ã‚’æŒã£ã¦ã„ã¾ã™ãŒã€ã‚­ã‚¦ã‚¤ã‚„ã‚¦ã‚§ãƒ–ãƒãƒãƒ¼ã®ã‚ˆã†ãªä»–ã®ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒãƒ¼ã€ã™ãªã‚ã¡ç§ãŸã¡ã¯ã™ã¹ã¦ã®æ³•çš„å•é¡Œã‚’è§£æ±ºã—ã¾ã—ãŸã€‚ãƒ«ãƒ¼ãƒ–ãƒ«ã€ãƒ‰ãƒ«ã€ãƒ¦ãƒ¼ãƒ­ã€ãã®ä»–ã®æ”¯æ‰•ã„ã‚·ã‚¹ãƒ†ãƒ ã®æ”¯æ‰•ã„ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹æ—¢è£½ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚éŠ€è¡Œå£åº§ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ãŠã‚Šã€æœ€çµ‚çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ç‰¹å®šã®APIã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚ã¾ãŸã€ä¸€èˆ¬çš„ãªã‚­ã‚¦ã‚¤ã‚„ã‚¦ã‚§ãƒ–ãƒãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã©ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äº¤æ›è€…ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã¾ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é–‹ã„ãŸã‚Šã€ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚Šã—ã¾ã™ã€‚ LANã§REST APIã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨é€šä¿¡ã—ã¾ã™ã€‚ãã—ã¦ã€ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã‚’æ¥ç¶šã—ã€åŒæ™‚ã«ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚æœ€åˆã¯ã™ã¹ã¦ãŒãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸‹ã®ã‚ªãƒ•ã‚£ã‚¹ã®ä»®æƒ³ãƒœãƒƒã‚¯ã‚¹ã«æ®ºåˆ°ã—ã¦ã„ã¾ã—ãŸ...å½¼ã‚‰ã¯ã‚µã‚¤ãƒˆã‚’ä½¿ã„å§‹ã‚ã¾ã—ãŸã€ãã—ã¦ç§ãŸã¡ã¯ç¨¼åƒæ™‚é–“ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¤ã„ã¦å¿ƒé…ã—å§‹ã‚ã¾ã—ãŸã€‚</font></font></p><br>
<p>,    â€”  . ..          (OVH)   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>         .iso,   ,  -     .   ,           ,      .   ,  ,                  "  ",                     .</p><br>
<p><strong> </strong></p><br>
<p>  .      .    FreeBSD.    (      )  IPMI        .iso FreeBSD .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Ansible</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">mfsbsd</a>. ,     kimsufi,   <em>custom installation</em>  ,        ""    /home ,     ,    .</p><br>
<p><img src="https://habrastorage.org/webt/-m/ve/av/-mveavdklaybhokh5sznmisf7be.png"></p><br>
<p>    ,      ,  ,         <em>hardening</em> ,   <code>bsdinstaller</code>    (    ):</p><br>
<p><img src="https://habrastorage.org/webt/pj/6w/no/pj6wnohhskxkw6vqigcucollot0.png"></p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   ,     . </p><br>
<p>          .          . *<em>ee â€”     BSD</em></p><br>
<p><code># ee /etc/rc.conf</code></p><br>
<pre><code class="plaintext hljs">...<font></font>
#sec hard<font></font>
clear_tmp_enable="YES"<font></font>
syslogd_flags="-ss"    <font></font>
sendmail_enable="NONE"<font></font>
</code></pre><br>
<p><code># ee /etc/sysctl.conf</code></p><br>
<pre><code class="plaintext hljs">...<font></font>
#sec hard<font></font>
security.bsd.see_other_uids=0<font></font>
security.bsd.see_other_gids=0<font></font>
security.bsd.unprivileged_read_msgbuf=0<font></font>
security.bsd.unprivileged_proc_debug=0<font></font>
kern.randompid=$(jot -r 1 9999)<font></font>
security.bsd.stack_guard_page=1</code></pre><br>
<p>   ,       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a>.   , ,     , ..     -.     SSH     -,        .</p><br>
<p>  <code>aide</code>,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p><code>pkg install aide</code></p><br>
<p>   </p><br>
<p><code>crontab -e</code></p><br>
<p><code>06 01 * * 0-6 /root/chkaide.sh</code></p><br>
<pre><code class="plaintext hljs">#! /bin/sh<font></font>
#chkaide.sh<font></font>
MYDATE=`date +%Y-%m-%d`<font></font>
MYFILENAME="Aide-"$MYDATE.txt<font></font>
/bin/echo "Aide check !! `date`" &gt; /tmp/$MYFILENAME<font></font>
/usr/local/bin/aide --check &gt; /tmp/myAide.txt<font></font>
/bin/cat /tmp/myAide.txt|/usr/bin/grep -v failed &gt;&gt; /tmp/$MYFILENAME<font></font>
/bin/echo "**************************************" &gt;&gt; /tmp/$MYFILENAME<font></font>
/usr/bin/tail -20 /tmp/myAide.txt &gt;&gt; /tmp/$MYFILENAME<font></font>
/bin/echo "****************DONE******************" &gt;&gt; /tmp/$MYFILENAME</code></pre><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a></p><br>
<p><code>sysrc auditd_enable=YES</code></p><br>
<p><code># service auditd start</code></p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>       .            .  ,     VT-x  EPT      .</p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cbsd</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">olevole</a>,          !</p><br>
<p><strong>?  docker  ?</strong></p><br>
<p>   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">FreeBSD Jails</a> â€”     ,    <code>cbsd</code>    ,   â€” .</p><br>
<p>           ,          .     -,       "".        " ",     .      ,         â€”                .       .    ,       ,        .             .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="ç”»åƒ"></p><br>
<p><strong>     ?</strong></p><br>
<p>  , <code>cbsd</code>   <code>bhyve</code>  XEN .     ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  FreeBSD</a>.     <code>bhyve</code>   .</p><br>
<p><strong>    </strong></p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ZFS</a>.         .  ZFS         ,  " "  ,   ,    ,         .       .            .  ?   ,         SSH.</p><br>
<p><code>gpart add -t freebsd-zfs /dev/ada0</code></p><br>
<p><code>/dev/ada0p4 added!</code></p><br>
<p>     </p><br>
<p><code>geli init /dev/ada0p4</code></p><br>
<p>   </p><br>
<p><code>geli attach /dev/ada0p4</code></p><br>
<p>        /dev/ada0p4.eli â€”      .      /dev/ada1     .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ZFS pool</a>.</p><br>
<p><code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code> â€”  ,      .           . </p><br>
<p>    ""</p><br>
<p><code>zfs create vms/jails</code></p><br>
<p><code>pkg install cbsd</code> â€”  ,      .</p><br>
<p>   <code>cbsd</code> ,   :</p><br>
<p><code># env workdir="/vms/jails" /usr/local/cbsd/sudoexec/initenv</code></p><br>
<p>     ,    -.</p><br>
<p>*   ,     <code>cbsdd</code>   ,         (     zabbix)</p><br>
<p>**     NAT  <code>cbsd</code>,      <code>pf</code>.</p><br>
<p><code># sysrc pf_enable=YES</code></p><br>
<p><code># ee /etc/pf.conf</code></p><br>
<pre><code class="plaintext hljs">IF_PUBLIC="em0"<font></font>
IP_PUBLIC="1.23.34.56"<font></font>
JAIL_IP_POOL="192.168.0.0/24"<font></font>
<font></font>
#WHITE_CL="{ 127.0.0.1 }"<font></font>
<font></font>
icmp_types="echoreq"<font></font>
<font></font>
set limit { states 20000, frags 20000, src-nodes 20000 }<font></font>
set skip on lo0<font></font>
scrub in all<font></font>
<font></font>
#NAT for jails<font></font>
nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC<font></font>
<font></font>
## Bitcoin network port forward<font></font>
IP_JAIL="192.168.0.1"<font></font>
PORT_JAIL="{8333}"<font></font>
rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL<font></font>
</code></pre><br>
<p><code># service pf start</code></p><br>
<p><code># pfctl -f /etc/pf.conf</code></p><br>
<p>      ,         BLOCK ALL    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>     -    .</p><br>
<p>  â€¦    cbsd,       â€”    !</p><br>
<p><code>cbsd jconstruct-tui</code></p><br>
<p><img src="https://habrastorage.org/webt/jf/yn/l5/jfynl5o0yozaua314r4e65yxy0y.png"></p><br>
<p>     .      , !</p><br>
<p>   ,         .      FreeBSD  <code>repo</code>.           (    ,    ).</p><br>
<p>     â€”  !</p><br>
<p><code># cbsd jstart bitcoind</code></p><br>
<p>      .</p><br>
<p><code># jls</code></p><br>
<pre><code class="plaintext hljs">   JID  IP Address      Hostname                      Path<font></font>
     1  192.168.0.1     bitcoind.space.com            /zroot/jails/jails/bitcoind</code></pre><br>
<p><code>jexec bitcoind</code>      </p><br>
<p>         ( -  )</p><br>
<p><code>bitcoind:/@[15:25] # pkg install bitcoin-daemon bitcoin-utils</code></p><br>
<p><code>bitcoind:/@[15:30] # sysrc bitcoind_enable=YES</code></p><br>
<p><code>bitcoind:/@[15:30] # service bitcoind start</code></p><br>
<p>   ,    ,          .               .  <code>pf</code>   NAT   IP    ,   NAT    TOR-.        ,          ,    ,    IP  .      ,  ""   ".onion"-         .</p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart tor</code></p><br>
<p><code># jexec tor</code></p><br>
<p><code>tor:/@[15:38] # pkg install tor</code></p><br>
<p><code>tor:/@[15:38] # sysrc tor_enable=YES</code></p><br>
<p><code>tor:/@[15:38] # ee /usr/local/etc/tor/torrc</code></p><br>
<p>     (   )</p><br>
<p><code>SOCKSPort 192.168.0.2:9050</code></p><br>
<p>        . ,      ,    .  nginx,     reverse-proxy     Let's Encrypt </p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart nginx-rev</code></p><br>
<p><code># jexec nginx-rev</code></p><br>
<p><code>nginx-rev:/@[15:47] # pkg install nginx py36-certbot</code></p><br>
<p><em>  150      .   - .</em></p><br>
<p>   nginx ,            nodejs  rust  -,   -     ,       MySQL.</p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart paygw</code></p><br>
<p><code># jexec paygw</code></p><br>
<p><code>paygw:/@[15:55] # pkg install git node npm</code></p><br>
<p><code>paygw:/@[15:55] # curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code></p><br>
<p><em>â€¦   380   </em></p><br>
<p>       .</p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart webapp</code></p><br>
<p><code># jexec webapp</code></p><br>
<p><code>webapp:/@[16:02] # pkg install mariadb104-server apache24 php74 mod_php74 php74-pdo_mysql</code></p><br>
<p><em>450  .  .</em></p><br>
<p>     SSH   ,     :</p><br>
<p><code>webapp:/@[16:02] # ee /etc/ssh/sshd_config</code></p><br>
<p><code>Port 2267</code> â€”   SSH    </p><br>
<p><code>webapp:/@[16:02] # sysrc sshd_enable=YES</code></p><br>
<p><code>webapp:/@[16:02] # service sshd start</code></p><br>
<p> ,  ,     <code>pf</code> firewall</p><br>
<p>            ""</p><br>
<p><code># jls</code></p><br>
<pre><code class="plaintext hljs">   JID  IP Address      Hostname                      Path<font></font>
     1  192.168.0.1     bitcoind.space.com            /zroot/jails/jails/bitcoind<font></font>
     2  192.168.0.2     tor.space.com                 /zroot/jails/jails/tor<font></font>
     3  192.168.0.3     nginx-rev.space.com           /zroot/jails/jails/nginx-rev<font></font>
     4  192.168.0.4     paygw.space.com               /zroot/jails/jails/paygw<font></font>
     5  192.168.0.5     webapp.my.domain              /zroot/jails/jails/webapp</code></pre><br>
<p>  </p><br>
<p><code># ee /etc/pf.conf</code></p><br>
<pre><code class="plaintext hljs">## SSH for web-Devs<font></font>
IP_JAIL="192.168.0.5"<font></font>
PORT_JAIL="{ 2267 }"<font></font>
rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL<font></font>
</code></pre><br>
<p>     ,       reverse-proxy:</p><br>
<pre><code class="plaintext hljs">## web-ports for nginx-rev<font></font>
IP_JAIL="192.168.0.3"<font></font>
PORT_JAIL="{ 80, 443 }"<font></font>
rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code></pre><br>
<p><code># pfctl -f /etc/pf.conf</code></p><br>
<p><strong>     </strong></p><br>
<p>   â€”    -,   ,        .             â€”  <code>bitcoind</code>    ,      .     RPC   ,        "".      <code>electrum</code> â€”  CLI . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>       " "    â€”    ,     ""        .      GUI,          <br>
.       ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ElectrumX</a>,        .</p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart electrum</code></p><br>
<p><code># jexec electrum</code></p><br>
<p><code>electrum:/@[8:45] # pkg install py36-electrum</code></p><br>
<p><em> 700      </em></p><br>
<p><code>electrum:/@[8:53] # adduser</code></p><br>
<pre><code class="plaintext hljs">Username: wallet<font></font>
Full name: <font></font>
Uid (Leave empty for default): <font></font>
Login group [wallet]: <font></font>
Login group is wallet. Invite wallet into other groups? []: <font></font>
Login class [default]: <font></font>
Shell (sh csh tcsh nologin) [sh]: tcsh<font></font>
Home directory [/home/wallet]: <font></font>
Home directory permissions (Leave empty for default): <font></font>
Use password-based authentication? [yes]: no<font></font>
Lock out the account after creation? [no]: <font></font>
Username   : wallet<font></font>
Password   : &lt;disabled&gt;<font></font>
Full Name  : <font></font>
Uid        : 1001<font></font>
Class      : <font></font>
Groups     : wallet <font></font>
Home       : /home/wallet<font></font>
Home Mode  : <font></font>
Shell      : /bin/tcsh<font></font>
Locked     : no<font></font>
OK? (yes/no): yes<font></font>
adduser: INFO: Successfully added (wallet) to the user database.<font></font>
Add another user? (yes/no): no<font></font>
Goodbye!<font></font>
electrum:/@[8:53] # su wallet</code></pre><br>
<p><code>electrum:/@[8:53] # su wallet</code></p><br>
<p><code>wallet@electrum:/ % electrum-3.6 create</code></p><br>
<pre><code class="plaintext hljs">{<font></font>
    "msg": "Please keep your seed in a safe place; if you lose it, you will not be able to restore your wallet.",<font></font>
    "path": "/usr/home/wallet/.electrum/wallets/default_wallet",<font></font>
    "seed": "jealous win pig material ribbon young punch visual okay cactus random bird"<font></font>
}</code></pre><br>
<p>     . </p><br>
<p><code>wallet@electrum:/ % electrum-3.6 listaddresses</code></p><br>
<pre><code class="plaintext hljs">[<font></font>
    "18WEhbjvMLGRMfwudzUrUd25U5C7uZYkzE",<font></font>
    "14XHSejhxsZNDRtk4eFbqAX3L8rftzwQQU",<font></font>
    "1KQXaN8RXiCN1ne9iYngUWAr6KJ6d4pPas",<font></font>
    ...<font></font>
    "1KeVcAwEYhk29qEyAfPwcBgF5mMMoy4qjw",<font></font>
    "18VaUuSeBr6T2GwpSHYF3XyNgLyLCt1SWk"<font></font>
]</code></pre><br>
<p><code>wallet@electrum:/ % electrum-3.6 help</code></p><br>
<p>  <em>on-chain</em>        .           ,   SSH     (   VPN).    SSH,     pf.conf  .</p><br>
<p><code>electrum:/@[9:00] # sysrc sshd_enable=YES</code></p><br>
<p><code>electrum:/@[9:00] # service sshd start</code></p><br>
<p>       .   IP-    ,   NAT-.   <code>/etc/pf.conf</code>  </p><br>
<p><code># ee /etc/pf.conf</code></p><br>
<p><code>JAIL_IP_POOL="192.168.0.0/24"</code>   <code>JAIL_IP_POOL="192.168.0.0/25"</code>,     192.168.0.126-255       .   "air-gap" network.  NAT    </p><br>
<p><code>nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC</code></p><br>
<p> </p><br>
<p><code># pfctl -f /etc/pf.conf</code></p><br>
<p>    </p><br>
<p><code># cbsd jconfig jname=electrum</code></p><br>
<p><img src="https://habrastorage.org/webt/mj/zo/ui/mjzouia2v_lhuzln_o9inimlwca.png"></p><br>
<p><img src="https://habrastorage.org/webt/_x/7-/c9/_x7-c9zdmlojjeqrpzfmv2j5fpc.png"></p><br>
<pre><code class="plaintext hljs">jset mode=quiet jname=electrum ip4_addr="192.168.0.200"<font></font>
Remove old IP: /sbin/ifconfig em0 inet 192.168.0.6 -alias<font></font>
Setup new IP: /sbin/ifconfig em0 inet 192.168.0.200 alias<font></font>
ip4_addr: 192.168.0.200</code></pre><br>
<p>,         .      proxy.    ,  TOR  SOCKS5 ,       HTTP .</p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart polipo</code></p><br>
<p><code># jexec polipo</code></p><br>
<p><code>polipo:/@[9:28] # pkg install polipo</code></p><br>
<p><code>polipo:/@[9:28] # ee /usr/local/etc/polipo/config</code></p><br>
<pre><code class="plaintext hljs">socksParentProxy = "192.168.0.2:9050"<font></font>
socksProxyType = socks5</code></pre><br>
<p><code>polipo:/@[9:42] # sysrc polipo_enable=YES</code></p><br>
<p><code>polipo:/@[9:43] # service polipo start</code></p><br>
<p> ,       -,     TOR: socks5://192.168.0.2:9050  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">http://192.168.0.6:8123</a></p><br>
<p>     </p><br>
<p><code># jexec electrum</code></p><br>
<p><code>electrum:/@[9:45] # su wallet</code></p><br>
<p><code>wallet@electrum:/ % ee ~/.cshrc</code></p><br>
<pre><code class="plaintext hljs">#in the end of file proxy config<font></font>
setenv http_proxy http://192.168.0.6:8123<font></font>
setenv https_proxy http://192.168.0.6:8123</code></pre><br>
<p> ,     - .    ,     <code>/usr/local/etc/pkg.conf</code>    </p><br>
<pre><code class="plaintext hljs">pkg_env: {<font></font>
               http_proxy: "http://my_proxy_ip:8123",<font></font>
           }</code></pre><br>
<p>      TOR hidden service     SSH    .</p><br>
<p><code># jexec tor</code></p><br>
<p><code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code></p><br>
<pre><code class="plaintext hljs">HiddenServiceDir /var/db/tor/electrum/<font></font>
HiddenServicePort 22 192.168.0.200:22</code></pre><br>
<p><code>tor:/@[10:01] # mkdir /var/db/tor/electrum</code></p><br>
<p><code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/electrum</code></p><br>
<p><code>tor:/@[10:01] # chmod 700 /var/db/tor/electrum</code></p><br>
<p><code>tor:/@[10:03] # service tor restart</code></p><br>
<p><code>tor:/@[10:04] # cat /var/db/tor/electrum/hostname</code></p><br>
<pre><code class="plaintext hljs">mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion</code></pre><br>
<p>     .   c  .      SSH-:</p><br>
<p><code>wallet@electrum:/ % mkdir ~/.ssh</code></p><br>
<p><code>wallet@electrum:/ % ee ~/.ssh/authorized_keys</code></p><br>
<pre><code class="plaintext hljs">ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAG9Fk2Lqi4GQ8EXZrsH3EgSrVIQPQaAlS38MmJLBabihv9KHIDGXH7r018hxqLNNGbaJWO/wrWk7sG4T0yLHAbdQAFsMYof9kjoyuG56z0XZ8qaD/X/AjrhLMsIoBbUNj0AzxjKNlPJL4NbHsFwbmxGulKS0PdAD5oLcTQi/VnNdU7iFw== user@local</code></pre><br>
<p>    - </p><br>
<p><code>user@local ~$ nano ~/.ssh/config</code></p><br>
<pre><code class="plaintext hljs">#remote electrum wallet<font></font>
Host remotebtc<font></font>
        User wallet<font></font>
        Port 22<font></font>
        Hostname mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion<font></font>
        ProxyCommand /bin/ncat --proxy localhost:9050 --proxy-type socks5 %h %p<font></font>
</code></pre><br>
<p> <em>(         TOR,    9050)</em></p><br>
<p><code>user@local ~$ ssh remotebtc</code></p><br>
<pre><code class="plaintext hljs">The authenticity of host 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion (&lt;no hostip for proxy command&gt;)' can't be established.<font></font>
ECDSA key fingerprint is SHA256:iW8FKjhVF4yyOZB1z4sBkzyvCM+evQ9cCL/EuWm0Du4.<font></font>
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<font></font>
Warning: Permanently added 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion' (ECDSA) to the list of known hosts.<font></font>
FreeBSD 12.1-RELEASE-p1 GENERIC <font></font>
To save disk space in your home directory, compress files you rarely<font></font>
use with "gzip filename".<font></font>
        -- Dru &lt;genesis@istar.ca&gt;<font></font>
wallet@electrum:~ % logout<font></font>
</code></pre><br>
<p>!</p><br>
<p>     -      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Lightning Network</a>,         .  *<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">c-lightning</a>,       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Sparko</a>,    HTTP (REST)       off-chain ,    on-chain . <code>c-lightning</code>    <code>bitcoind</code> .</p><br>
<p>*<em>       Lightning Network.      c-lightning (  )     -</em></p><br>
<p><code># cbsd jsconstruct-tui</code></p><br>
<p><code># cbsd jstart cln</code></p><br>
<p><code># jexec cln</code></p><br>
<p><code>lightning:/@[10:23] # adduser</code></p><br>
<pre><code class="plaintext hljs">Username: lightning<font></font>
...</code></pre><br>
<p><code>lightning:/@[10:24] # pkg install git</code></p><br>
<p><code>lightning:/@[10:23] # su lightning</code></p><br>
<p><code>cd ~ &amp;&amp; git clone https://github.com/ElementsProject/lightning</code></p><br>
<p><code>lightning@lightning:~ % exit</code></p><br>
<p><code>lightning:/@[10:30] # cd /home/lightning/lightning/</code></p><br>
<p><code>lightning:/home/lightning/lightning@[10:31] # pkg install autoconf automake gettext git gmp gmake libtool python python3 sqlite3 libsodium py36-mako bash bitcoin-utils</code></p><br>
<p><code>lightning:/home/lightning/lightning@[10:34] # ./configure &amp;&amp; gmake &amp;&amp; gmake install</code></p><br>
<p>     ,   RPC  <code>lightningd</code>  <code>bitcoind</code></p><br>
<p><code># jexec bitcoind</code></p><br>
<p><code>bitcoind:/@[10:36] # ee /usr/local/etc/bitcoin.conf</code></p><br>
<pre><code class="plaintext hljs">rpcbind=192.168.0.1<font></font>
rpcuser=test<font></font>
rpcpassword=test<font></font>
#allow only c-lightning<font></font>
rpcallowip=192.168.0.7/32</code></pre><br>
<p><code>bitcoind:/@[10:39] # service bitcoind restart</code></p><br>
<p><em>              <code>tmux</code>,        - . : <code>screen</code></em></p><br>
<p><img src="https://habrastorage.org/webt/xu/cz/14/xucz14wosjbbeme4iis8ws4nxq8.png"></p><br>
<p>,      IP  ,        .      .onion.</p><br>
<p><code># jexec tor</code></p><br>
<p><code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code></p><br>
<pre><code class="plaintext hljs">HiddenServiceDir /var/db/tor/cln/<font></font>
HiddenServicePort 9735 192.168.0.7:9735</code></pre><br>
<p><code>tor:/@[10:01] # mkdir /var/db/tor/cln</code></p><br>
<p><code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/cln</code></p><br>
<p><code>tor:/@[10:01] # chmod 700 /var/db/tor/cln</code></p><br>
<p><code>tor:/@[10:03] # service tor restart</code></p><br>
<p><code>tor:/@[10:04] # cat /var/db/tor/cln/hostname</code></p><br>
<pre><code class="plaintext hljs">en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion</code></pre><br>
<p>    c-lightning</p><br>
<p><code>lightning:/home/lightning/lightning@[10:31] # su lightning</code></p><br>
<p><code>lightning@lightning:~ % mkdir .lightning</code></p><br>
<p><code>lightning@lightning:~ % ee .lightning/config</code></p><br>
<pre><code class="plaintext hljs">alias=My-LN-Node<font></font>
bind-addr=192.168.0.7:9735<font></font>
rgb=ff0000<font></font>
announce-addr=en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion:9735<font></font>
network=bitcoin<font></font>
log-level=info<font></font>
fee-base=0<font></font>
fee-per-satoshi=1<font></font>
proxy=192.168.0.2:9050<font></font>
log-file=/home/lightning/.lightning/c-lightning.log<font></font>
min-capacity-sat=200000<font></font>
<font></font>
# sparko plugin<font></font>
# https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/sparko<font></font>
<font></font>
sparko-host=192.168.0.7<font></font>
sparko-port=9737<font></font>
<font></font>
sparko-tls-path=sparko-tls<font></font>
<font></font>
#sparko-login=mywalletusername:mywalletpassword<font></font>
<font></font>
#sparko-keys=masterkey;secretread:+listchannels,+listnodes;secretwrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice<font></font>
sparko-keys=masterkey;secretread:+listchannels,+listnodes;ultrawrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice<font></font>
# for the example above the initialization logs (mixed with lightningd logs) should print something like</code></pre><br>
<p><code>lightning@lightning:~ % mkdir .lightning/plugins</code></p><br>
<p><code>lightning@lightning:~ % cd .lightning/plugins/</code></p><br>
<p><code>lightning@lightning:~/.lightning/plugins:% fetch https://github.com/fiatjaf/sparko/releases/download/v0.2.1/sparko_full_freebsd_amd64</code></p><br>
<p><code>lightning@lightning:~/.lightning/plugins % mkdir ~/.lightning/sparko-tls</code></p><br>
<p><code>lightning@lightning:~/.lightning/sparko-tls % cd ~/.lightning/sparko-tls</code></p><br>
<p><code>lightning@lightning:~/.lightning/sparko-tls % openssl genrsa -out key.pem 2048</code></p><br>
<p><code>lightning@lightning:~/.lightning/sparko-tls % openssl req -new -x509 -sha256 -key key.pem -out cert.pem -days 3650</code></p><br>
<p><code>lightning@lightning:~/.lightning/plugins % chmod +x sparko_full_freebsd_amd64</code></p><br>
<p><code>lightning@lightning:~/.lightning/plugins % mv sparko_full_freebsd_amd64 sparko</code></p><br>
<p><code>lightning@lightning:~/.lightning/plugins % cd ~</code></p><br>
<p>       bitcoin-cli, ,    <code>bitcoind</code></p><br>
<p><code>lightning@lightning:~ % mkdir .bitcoin</code></p><br>
<p><code>lightning@lightning:~ % ee .bitcoin/bitcoin.conf</code></p><br>
<pre><code class="plaintext hljs">rpcconnect=192.168.0.1<font></font>
rpcuser=test<font></font>
rpcpassword=test</code></pre><br>
<p></p><br>
<p><code>lightning@lightning:~ % bitcoin-cli echo "test"</code></p><br>
<pre><code class="plaintext hljs">[<font></font>
  "test"<font></font>
]</code></pre><br>
<p> <code>lightningd</code></p><br>
<p><code>lightning@lightning:~ % lightningd --daemon</code></p><br>
<p> <code>lightningd</code>    <code>lightning-cli</code>, :</p><br>
<p><code>lightning-cli newaddr</code> <em>     </em></p><br>
<pre><code class="plaintext hljs">{<font></font>
   "address": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv",<font></font>
   "bech32": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv"<font></font>
}</code></pre><br>
<p><code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>      ( - )</em></p><br>
<p>    off-chain  <code>lightning-cli invoice</code>, <code>lightning-cli listinvoices</code>, <code>lightning-cli pay</code> .</p><br>
<p>         REST Api</p><br>
<p><code>curl -k https://192.168.0.7:9737/rpc -d '{"method": "pay", "params": ["lnbc..."]}' -H 'X-Access masterkey'</code></p><br>
<p><strong>   </strong></p><br>
<p><code># jls</code></p><br>
<pre><code class="plaintext hljs">   JID  IP Address      Hostname                      Path<font></font>
     1  192.168.0.1     bitcoind.space.com            /zroot/jails/jails/bitcoind<font></font>
     2  192.168.0.2     tor.space.com                 /zroot/jails/jails/tor<font></font>
     3  192.168.0.3     nginx-rev.space.com           /zroot/jails/jails/nginx-rev<font></font>
     4  192.168.0.4     paygw.space.com               /zroot/jails/jails/paygw<font></font>
     5  192.168.0.5     webapp.my.domain              /zroot/jails/jails/webapp<font></font>
     7  192.168.0.200   electrum.space.com            /zroot/jails/jails/electrum<font></font>
     8  192.168.0.6     polipo.space.com              /zroot/jails/jails/polipo<font></font>
     9  192.168.0.7     lightning.space.com           /zroot/jails/jails/cln</code></pre><br>
<p><img src="https://habrastorage.org/webt/nt/0k/ew/nt0kewrhuin48nj-lbfk1jpa4rc.png"></p><br>
<p>    ,            . </p><br>
<p><code># zfs list</code></p><br>
<pre><code class="plaintext hljs">NAME                    USED  AVAIL  REFER  MOUNTPOINT<font></font>
zroot                   279G  1.48T    88K  /zroot<font></font>
zroot/ROOT             1.89G  1.48T    88K  none<font></font>
zroot/ROOT/default     1.89G  17.6G  1.89G  /<font></font>
zroot/home               88K  1.48T    88K  /home<font></font>
zroot/jails             277G  1.48T   404M  /zroot/jails<font></font>
zroot/jails/bitcoind    190G  1.48T   190G  /zroot/jails/jails-data/bitcoind-data<font></font>
zroot/jails/cln         653M  1.48T   653M  /zroot/jails/jails-data/cln-data<font></font>
zroot/jails/electrum    703M  1.48T   703M  /zroot/jails/jails-data/electrum-data<font></font>
zroot/jails/nginx-rev   190M  1.48T   190M  /zroot/jails/jails-data/nginx-rev-data<font></font>
zroot/jails/paygw      82.4G  1.48T  82.4G  /zroot/jails/jails-data/paygw-data<font></font>
zroot/jails/polipo     57.6M  1.48T  57.6M  /zroot/jails/jails-data/polipo-data<font></font>
zroot/jails/tor        81.5M  1.48T  81.5M  /zroot/jails/jails-data/tor-data<font></font>
zroot/jails/webapp      360M  1.48T   360M  /zroot/jails/jails-data/webapp-data</code></pre><br>
<p> , bitcoind   190  .          ?  ZFS   .   <code>cbsd jclone old=bitcoind new=bitcoind-clone host_hostname=clonedbtc.space.com</code>          .        ,               (   190 )</p><br>
<p>      ZFS,    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ZFS   </a>     ,     SSH.    ,   . </p><br>
<p>       ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Zabbix</a>.</p><br>
<p><strong> â€” </strong></p><br>
<p>  ,        :</p><br>
<p><em></em> â€”   UNIX-     .           â€” .          .           .                   .       -,             . </p><br>
<p><em></em> â€”        . -       , ECC , ZFS  " "        .            .   -     .</p><br>
<p><em></em> â€”   .           .           .                (     ).           ,         . </p><br>
<p><em> </em> â€”            ,  .          ,               .</p><br>
<p>           ,     ,    ,         .</p><br>
<p><strong>    ?</strong></p><br>
<p>    cbsd  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.   ,    <code>bhyve</code>     . </p><br>
<p><code># cat /etc/rc.conf</code></p><br>
<pre><code class="plaintext hljs">...<font></font>
kld_list="vmm if_tap if_bridge nmdm"<font></font>
...</code></pre><br>
<p><code># cat /boot/loader.conf</code></p><br>
<pre><code class="plaintext hljs">...<font></font>
vmm_load="YES"<font></font>
...</code></pre><br>
<p>       ,   - debian  !</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif"></p><br>
<p><strong>  </strong></p><br>
<p>      .          â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc</a>.          ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">pet-project</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja477110/index.html">é¢ç™½ã„è¨ˆç”»</a></li>
<li><a href="../ja477114/index.html">MSHã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®å®Ÿè£…</a></li>
<li><a href="../ja477118/index.html">MIROã¯ã‚ªãƒ¼ãƒ—ãƒ³ãªå±‹å†…ãƒ­ãƒœãƒƒãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ãƒ‘ãƒ¼ãƒˆ5-ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼šARDUINOï¼ˆAVRï¼‰ã€ã€Œå†…éƒ¨ã€ã«ç™»ã‚‹</a></li>
<li><a href="../ja477120/index.html">Windowsç”¨ã®é€£ç¶šè¡€ç³–ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</a></li>
<li><a href="../ja477122/index.html">ä¼šç¤¾ã®é ­è„³ã€‚ãƒ‘ãƒ¼ãƒˆ3</a></li>
<li><a href="../ja477126/index.html">5åˆ†ã§ç®¡ç†ã§ãã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰-react-adminã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰-Flask-RESTful</a></li>
<li><a href="../ja477128/index.html">é€±æœ«ã®ãƒãƒ–ãƒ©åˆ‘äº‹</a></li>
<li><a href="../ja477130/index.html">ã€Œãƒ¦ãƒ¼ã‚¸ãƒ¼ãƒ³ãƒ»ã‚ªãƒãƒ¼ã‚®ãƒ³ã€ï¼šåè»¢ï¼ˆN.-F.ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼‰</a></li>
<li><a href="../ja477132/index.html">ãƒ­ã‚·ã‚¢é€£é‚¦ã®å€‹äººãƒ‡ãƒ¼ã‚¿ï¼šç§ãŸã¡ã¯èª°ã§ã™ã‹ï¼Ÿç§é”ã¯ã©ã“ã«è¡Œãã®ï¼Ÿ</a></li>
<li><a href="../ja477136/index.html">FL.ruãŒ1ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’2å›è²©å£²ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã ã¾ã—ã€ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ã‚’ç ´ã‚‹æ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>