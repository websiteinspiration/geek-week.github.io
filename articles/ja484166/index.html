<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏾 🏚️ 📟 VVVVVV ??? VVVVVV !!! :) 👎🏼 🏔️ 🔟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="このテキストを読んだ場合、それはあなたが記事のタイトルに問題があると思ったか、またはそれに馴染みのあるコンピュータゲームの名前を見たことを意味します。VVVVVVは、快適な外部のシンプルさと同様に快適な内部の複雑さで多くのプレイヤーの心をつかんだインディープラットフォーマーゲームです。数日前、VVV...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>VVVVVV ??? VVVVVV !!! :)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484166/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このテキストを読んだ場合、それはあなたが記事のタイトルに問題があると思ったか、またはそれに馴染みのあるコンピュータゲームの名前を見たことを意味します。</font><font style="vertical-align: inherit;">VVVVVVは、快適な外部のシンプルさと同様に快適な内部の複雑さで多くのプレイヤーの心をつかんだインディープラットフォーマーゲームです。</font><font style="vertical-align: inherit;">数日前、VVVVVVは10歳になり、ゲームの作者であるTerry Cavanaghがこの休暇を祝って、ソースコードを公開しました。</font><font style="vertical-align: inherit;">「おいしい」とは何ですか？</font><font style="vertical-align: inherit;">この記事の答えを読んでください。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/i1/ij/g8/i1ijg8lekultgdxwi426mbnaers.png" alt="写真1"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ああ、VVVVVV ...私はリリース直後にそれを見つけた方法を覚えています。そして、ピクセルレトロゲームの大ファンだったので、私は喜んでそれを自分のコンピューターにインストールしました。第一印象を覚えています。「それで、それだけですか？正方形の部屋を走り回っているだけですか？」 -ゲームの数分後に思った。何が待ち受けているのかまだ分かりませんでした。出発地を離れるとすぐに、私には、小さいけれども混乱していて華やかな2次元の世界に、私には知られていない珍しい風景やピクセルアーティファクトでいっぱいになりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このゲームは私を引きずり込みました。当時の珍しいコントロールに巧みに打ち負かされた高度な複雑さにもかかわらず（メインキャラクターはジャンプする方法を知りませんが、重力ベクトルの方向を自分で反転させることができます）、完全に合格しました。そのときキャラクターが何回死んだかはわかりませんが、死者の数は数千単位で測定されると確信しています。それでも、このゲームにはいくつかのユニークな魅力があります:)ゲーム</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">の記念日を記念してレイアウトされ</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たソースコードに戻りましょう</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、私はC ++-PVS-Studioチームの開発者-C、C ++、C＃、およびJavaの静的コードアナライザーです。開発そのものに加え、製品のプロモーションにも取り組んでいます。私たちにとって、これを行う最良の方法の1つは、オープンソースプロジェクトのチェックに関する記事を書くことです。読者はプログラミングトピックに関する興味深い記事を受け取り、PVS-Studioの機能を明確に示す機会を得ます。したがって、ソースコードVVVVVVのオープニングについて知ったので、私は通りがかっただけでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、PVS-StudioアナライザーによってVVVVVVコードで検出されたいくつかの興味深いエラーを確認し、これらのエラーの詳細な分析を行います。重力ベクトルを「下」の位置に戻し、腰を下ろしてください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アナライザーによって発行されたアラートの概要</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告1</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V512</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「sprintf」関数を呼び出すと、バッファ「fileSearch」がオーバーフローします。</font><font style="vertical-align: inherit;">FileSystemUtils.cpp 307</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_PATH          260</span><font></font>
<font></font>
....<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PLATFORM_migrateSaveData</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *output)</span>
</span>{
  <span class="hljs-keyword">char</span> oldLocation[MAX_PATH];
  <span class="hljs-keyword">char</span> newLocation[MAX_PATH];
  <span class="hljs-keyword">char</span> oldDirectory[MAX_PATH]; 
  <span class="hljs-keyword">char</span> fileSearch[MAX_PATH];<font></font>
<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-comment">/* Same place, different layout. */</span>
  <span class="hljs-built_in">strcpy</span>(oldDirectory, output);<font></font>
<font></font>
  <span class="hljs-built_in">sprintf</span>(fileSearch, <span class="hljs-string">"%s\\*.vvvvvv"</span>, oldDirectory);<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とおり</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fileSearch行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">oldDirectory行</font></i><font style="vertical-align: inherit;">は同じサイズで、260文字です。</font><font style="vertical-align: inherit;">文字列</font><i><font style="vertical-align: inherit;">oldDirectoryの</font></i><font style="vertical-align: inherit;">内容をそれに置き換えた後</font><font style="vertical-align: inherit;">のフォーマット文字列（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprintf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の3番目の引数</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">は、次の</font><font style="vertical-align: inherit;">よう</font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">なります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">&lt;i&gt;_oldDirectory\*.vvvvvv&lt;/i&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この文字列は、元の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oldDirectory</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より9文字長くなり</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fileSearchに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに書き込まれるのは、この一連の文字です</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oldDirectory</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列の長さが</font><font style="vertical-align: inherit;">251を超えるとどうなりますか？</font><font style="vertical-align: inherit;">結果の文字列は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fileSearch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が対応できる長さよりも長くなり</font><font style="vertical-align: inherit;">、配列の外側に書き込まれます。</font><font style="vertical-align: inherit;">RAM内のどのデータが破損している可能性があり、どのような結果になるかは修辞的な質問です:)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告2</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「バックグラウンド」変数には、2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">おそらくこれは間違いです。</font><font style="vertical-align: inherit;">チェック行：1367、1373。Map.cpp 1373</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mapclass::loadlevel</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-comment">//The Warpzone</span><font></font>
    tmap = warplevel.loadlevel(rx, ry, game, obj);<font></font>
    fillcontent(tmap);<font></font>
    roomname = warplevel.roomname;<font></font>
    tileset = <span class="hljs-number">1</span>;<font></font>
    background = <span class="hljs-number">3</span>;                    <span class="hljs-comment">// &lt;=</span><font></font>
    dwgfx.rcol = warplevel.rcol;<font></font>
    dwgfx.backgrounddrawn = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    warpx = warplevel.warpx;<font></font>
    warpy = warplevel.warpy;<font></font>
    background = <span class="hljs-number">5</span>;                    <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (warpy) background = <span class="hljs-number">4</span>;
    <span class="hljs-keyword">if</span> (warpx) background = <span class="hljs-number">3</span>;
    <span class="hljs-keyword">if</span> (warpx &amp;&amp; warpy) background = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">break</span>;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つの同じ変数に2回続けて値が割り当てられます。</font><font style="vertical-align: inherit;">さらに、割り当ての間、この変数はどこにも使用されません。</font><font style="vertical-align: inherit;">奇妙なことに、おそらくこのシーケンスはプログラムのロジックに違反していませんが、そのような割り当て自体は、コードを書くときに混乱を招きます。</font><font style="vertical-align: inherit;">これが実際に間違いであるかどうかは、作者だけが言うことができます。</font><font style="vertical-align: inherit;">コードにこのエラーの明るい例がありますが：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Game::loadquick</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pKey == <span class="hljs-string">"frames"</span>)<font></font>
  {<font></font>
    frames = atoi(pText);<font></font>
    frames = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、ロジックのエラー、または少なくとも不要な割り当てがどこかにあることはすでに明らかです。</font><font style="vertical-align: inherit;">おそらく、2行目はデバッグのために一時的に記述された後、削除するのを忘れていました。</font><font style="vertical-align: inherit;">合計すると、PVS-Studioはそのような状況について8つの警告を発行しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告3</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'basic_string'タイプの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V808</font></a><font style="vertical-align: inherit;"> 'pKey'オブジェクトが作成されましたが、使用されませんでした。</font><font style="vertical-align: inherit;">editor.cpp 1866</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">editorclass::load</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;_path)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">pKey</span><span class="hljs-params">(pElem-&gt;Value())</span></span>;<font></font>
<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (pKey == <span class="hljs-string">"edEntities"</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (TiXmlElement *edEntityEl = pElem-&gt;FirstChildElement();<font></font>
         edEntityEl;<font></font>
         edEntityEl = edEntityEl-&gt;NextSiblingElement())<font></font>
    {<font></font>
      <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> <span class="hljs-title">pKey</span><span class="hljs-params">(edEntityEl-&gt;Value())</span></span>;                         <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-comment">//const char* pText = edEntityEl-&gt;GetText() ;</span>
      <span class="hljs-keyword">if</span> (edEntityEl-&gt;GetText() != <span class="hljs-literal">NULL</span>)<font></font>
      {<font></font>
        edentity[i].scriptname = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(edEntityEl-&gt;GetText());<font></font>
      }<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"x"</span>, &amp;edentity[i].x);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"y"</span>, &amp;edentity[i].y);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"t"</span>, &amp;edentity[i].t);<font></font>
<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p1"</span>, &amp;edentity[i].p1);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p2"</span>, &amp;edentity[i].p2);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p3"</span>, &amp;edentity[i].p3);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p4"</span>, &amp;edentity[i].p4);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p5"</span>, &amp;edentity[i].p5);<font></font>
      edEntityEl-&gt;QueryIntAttribute(<span class="hljs-string">"p6"</span>, &amp;edentity[i].p6);<font></font>
<font></font>
      i++;<font></font>
<font></font>
    }<font></font>
<font></font>
    EditorData::GetInstance().numedentities = i;<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
非常に奇妙なコード。アナライザーは、作成されたが使用されていない変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について警告します</font><font style="vertical-align: inherit;">が、実際には問題はより興味深いものであることが判明しました。この関数には</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という名前の行の複数の定義が含まれているため、警告が発行された行を矢印で明確にマークしました</font><font style="vertical-align: inherit;">。はい、</font><font style="vertical-align: inherit;">別のそのような変数は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループ内</font><font style="vertical-align: inherit;">で宣言さ</font><font style="vertical-align: inherit;">れて</font><font style="vertical-align: inherit;">おり、その名前によって、ループ外で宣言さ</font><font style="vertical-align: inherit;">れた</font><font style="vertical-align: inherit;">変数をオーバーライドします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font><i><font style="vertical-align: inherit;">for</font></i><font style="vertical-align: inherit;">ループの外側で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字列の値にアクセスする</font><font style="vertical-align: inherit;">と、</font><i><font style="vertical-align: inherit;">pElem-&gt; Value（）</font></i><font style="vertical-align: inherit;">に等しい値が取得されますが、ループ内で同じことを行うと、</font><i><font style="vertical-align: inherit;">edEntityEl-&gt; Value（）に</font></i><font style="vertical-align: inherit;">等しい値が取得されます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">名前の重複はかなり大きな間違いであり、コードのレビュー時に自分で見つけるのは非常に困難です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告4</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V805</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスの低下。</font><font style="vertical-align: inherit;">'strlen（str）&gt; 0'構文を使用して空の文字列を識別することは非効率的です。</font><font style="vertical-align: inherit;">より効率的な方法は、チェックすることです：str [0]！= '\ 0'。</font><font style="vertical-align: inherit;">physfs.c 1604</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *prefDir = <span class="hljs-literal">NULL</span>;<font></font>
<font></font>
....<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *<span class="hljs-title">PHYSFS_getPrefDir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *org, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *app)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  assert(<span class="hljs-built_in">strlen</span>(prefDir) &gt; <span class="hljs-number">0</span>);<font></font>
<font></font>
  ...<font></font>
<font></font>
  <span class="hljs-keyword">return</span> prefDir;<font></font>
} <span class="hljs-comment">/* PHYSFS_getPrefDir */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーは潜在的なマイクロ最適化の場所を見つけました。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を使用して、Cスタイルの文字列のvoidをチェックします</font><font style="vertical-align: inherit;">。この関数は、文字列のすべての要素を「実行」し、各要素を終端ゼロ（ '\ 0'）と等しいかどうかをチェックします。大きな文字列が入力された場合でも、その各文字は文字列ゼロと比較されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、文字列が空でないことを確認するだけです！これを行うには、文字列の最初の文字が終端ゼロかどうかを調べます。したがって、assert内でこのチェックを最適化するには、次のように記述する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">str[<span class="hljs-number">0</span>] != <span class="hljs-string">'\0'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、アナライザーからの推奨事項です。</font><font style="vertical-align: inherit;">もちろん、strlen関数呼び出しは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロ条件内</font><font style="vertical-align: inherit;">にあるため、速度はそれほど重要ではないデバッグバージョンでのみ実行されます。</font><font style="vertical-align: inherit;">リリースバージョンでは、関数呼び出しが消え、コードがすばやく動作します。</font><font style="vertical-align: inherit;">それでも、マイクロ最適化を提案するアナライザーの機能を実証したかったのです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告5</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のエラーを表示するには、ここにコードの2つのセクション（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entclass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの宣言</font><font style="vertical-align: inherit;">とそのコンストラクター）</font><font style="vertical-align: inherit;">をアタッチする必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">発表から始めましょう：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">entclass</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  entclass();<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">outside</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
  <span class="hljs-comment">//Fundamentals</span>
  <span class="hljs-keyword">bool</span> active, invis;
  <span class="hljs-keyword">int</span> type, size, tile, rule;
  <span class="hljs-keyword">int</span> state, statedelay;
  <span class="hljs-keyword">int</span> behave, animate;
  <span class="hljs-keyword">float</span> para;
  <span class="hljs-keyword">int</span> life, colour;<font></font>
<font></font>
  <span class="hljs-comment">//Position and velocity</span>
  <span class="hljs-keyword">int</span> oldxp, oldyp;
  <span class="hljs-keyword">float</span> ax, ay, vx, vy;
  <span class="hljs-keyword">int</span> cx, cy, w, h;
  <span class="hljs-keyword">float</span> newxp, newyp;
  <span class="hljs-keyword">bool</span> isplatform;
  <span class="hljs-keyword">int</span> x1, y1, x2, y2;
  <span class="hljs-comment">//Collision Rules</span>
  <span class="hljs-keyword">int</span> onentity;
  <span class="hljs-keyword">bool</span> harmful;
  <span class="hljs-keyword">int</span> onwall, onxwall, onywall;<font></font>
<font></font>
  <span class="hljs-comment">//Platforming specific</span>
  <span class="hljs-keyword">bool</span> jumping;
  <span class="hljs-keyword">bool</span> gravity;
  <span class="hljs-keyword">int</span> onground, onroof;
  <span class="hljs-keyword">int</span> jumpframe;
  <span class="hljs-comment">//Animation</span>
  <span class="hljs-keyword">int</span> framedelay, drawframe, walkingframe, dir, actionframe;
  <span class="hljs-keyword">int</span> yp; <span class="hljs-keyword">int</span> xp;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスのコンストラクターは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">entclass::entclass()<font></font>
{<font></font>
  clear();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">entclass::clear</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// Set all values to a default,</span>
  <span class="hljs-comment">// required for creating a new entity</span>
  active = <span class="hljs-literal">false</span>;<font></font>
  invis = <span class="hljs-literal">false</span>;<font></font>
  type = <span class="hljs-number">0</span>;<font></font>
  size = <span class="hljs-number">0</span>;<font></font>
  tile = <span class="hljs-number">0</span>;<font></font>
  rule = <span class="hljs-number">0</span>;<font></font>
  state = <span class="hljs-number">0</span>;<font></font>
  statedelay = <span class="hljs-number">0</span>;<font></font>
  life = <span class="hljs-number">0</span>;<font></font>
  colour = <span class="hljs-number">0</span>;<font></font>
  para = <span class="hljs-number">0</span>;<font></font>
  behave = <span class="hljs-number">0</span>;<font></font>
  animate = <span class="hljs-number">0</span>;<font></font>
<font></font>
  xp = <span class="hljs-number">0</span>;<font></font>
  yp = <span class="hljs-number">0</span>;<font></font>
  ax = <span class="hljs-number">0</span>;<font></font>
  ay = <span class="hljs-number">0</span>;<font></font>
  vx = <span class="hljs-number">0</span>;<font></font>
  vy = <span class="hljs-number">0</span>;<font></font>
  w = <span class="hljs-number">16</span>;<font></font>
  h = <span class="hljs-number">16</span>;<font></font>
  cx = <span class="hljs-number">0</span>;<font></font>
  cy = <span class="hljs-number">0</span>;<font></font>
  newxp = <span class="hljs-number">0</span>;<font></font>
  newyp = <span class="hljs-number">0</span>;<font></font>
<font></font>
  x1 = <span class="hljs-number">0</span>;<font></font>
  y1 = <span class="hljs-number">0</span>;<font></font>
  x2 = <span class="hljs-number">320</span>;<font></font>
  y2 = <span class="hljs-number">240</span>;<font></font>
<font></font>
  jumping = <span class="hljs-literal">false</span>;<font></font>
  gravity = <span class="hljs-literal">false</span>;<font></font>
  onground = <span class="hljs-number">0</span>;<font></font>
  onroof = <span class="hljs-number">0</span>;<font></font>
  jumpframe = <span class="hljs-number">0</span>;<font></font>
<font></font>
  onentity = <span class="hljs-number">0</span>;<font></font>
  harmful = <span class="hljs-literal">false</span>;<font></font>
  onwall = <span class="hljs-number">0</span>;<font></font>
  onxwall = <span class="hljs-number">0</span>;<font></font>
  onywall = <span class="hljs-number">0</span>;<font></font>
  isplatform = <span class="hljs-literal">false</span>;<font></font>
<font></font>
  framedelay = <span class="hljs-number">0</span>;<font></font>
  drawframe = <span class="hljs-number">0</span>;<font></font>
  walkingframe = <span class="hljs-number">0</span>;<font></font>
  dir = <span class="hljs-number">0</span>;<font></font>
  actionframe = <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
十分なフィールドですね。</font><font style="vertical-align: inherit;">PVS-Studioが警告を発行したというエラーがここに潜んでいる</font><font style="vertical-align: inherit;">ことは</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことです</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。V730</font></a><font style="vertical-align: inherit;">クラスのすべてのメンバーがコンストラクター内で初期化されていない可能性があります。</font><font style="vertical-align: inherit;">検査を検討してください：oldxp、oldyp。</font><font style="vertical-align: inherit;">Ent.cpp 3 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、このような大きなリストでは、クラスの2つのフィールドの初期化が失われています。</font><font style="vertical-align: inherit;">したがって、それらの値は不確かなままでした。そのため、プログラムの他の場所で、未知の値をそれらから読み取って使用することができます。</font><font style="vertical-align: inherit;">このようなエラーを目で確認することは非常に困難です。</font></font><br>
<br>
<p><img src="https://habrastorage.org/webt/mi/8n/du/mi8nduqzzi75r1jhntbsqwarlns.png" alt="図2"></p><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードを考えてみましょう：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mapclass::loadlevel</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; tmap;<font></font>
<font></font>
  ....<font></font>
<font></font>
  tmap = otherlevel.loadlevel(rx, ry, game, obj);<font></font>
  fillcontent(tmap);<font></font>
<font></font>
  .... <span class="hljs-comment">//  tmap    .</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告PVS-studio：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V688</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'tmap'ローカル変数は、クラスメンバーの1つと同じ名前を持っているため、混乱を招く可能性があります。 Map.cpp 1192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確かに、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapclass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスの内部を見る</font><font style="vertical-align: inherit;">と、同じ名前の同じベクトルがそこにあります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mapclass</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  ....<font></font>
<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; roomdeaths;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; roomdeathsfinal;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; areamap;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; contents;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; explored;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-keyword">int</span>&gt; vmult;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span> &lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; tmap;       <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  ....<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、関数内で同じ名前のベクトルを宣言すると、クラスで宣言されたベクトルが非表示になります。すべての関数について、関数</font><font style="vertical-align: inherit;">内でのみ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loadlevel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベクトル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が変更されることが</font><i><font style="vertical-align: inherit;">わかり</font></i><font style="vertical-align: inherit;">ます。クラスで宣言されたベクターは変更されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioがそのようなコードのフラグメントを20個も発見したのは興味深いことです。ほとんどの場合、これらは一時変数に関連付けられています。一時変数は、便宜上、クラスのメンバーとして宣言されています。ゲームの作者（およびその唯一の開発者）自身は、以前はこの悪い癖があったと書いています。これについては、この記事の冒頭にリンクした投稿で読むことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼はまた、そのような命名が有害でバグを捕らえるのを難しくしたことにも言及しています。</font><font style="vertical-align: inherit;">まあ、そのようなバグは本当に有害な場合がありますが、静的分析を使用してそれらを検出することは難しくありません:)</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告7</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V601</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整数型は暗黙的にchar型にキャストされます。</font><font style="vertical-align: inherit;">Game.cpp 4997</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Game::loadquick</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pKey == <span class="hljs-string">"totalflips"</span>)<font></font>
  {<font></font>
      totalflips = atoi(pText);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pKey == <span class="hljs-string">"hardestroom"</span>)<font></font>
  {<font></font>
      hardestroom = atoi(pText);        <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pKey == <span class="hljs-string">"hardestroomdeaths"</span>)<font></font>
  {<font></font>
      hardestroomdeaths = atoi(pText);<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を理解するために、コードの特定のセクションから変数の定義を見てみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//Some stats:</span>
<span class="hljs-keyword">int</span> totalflips;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> hardestroom;
<span class="hljs-keyword">int</span> hardestroomdeaths;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">totalflips</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hardestroomdeaths</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は整数型であるため、結果をそれらの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atoi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数に割り当てること</font><font style="vertical-align: inherit;">は完全に正常です。</font><font style="vertical-align: inherit;">しかし、整数値を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std ::文字列に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">割り当てるとどうなります</font><font style="vertical-align: inherit;">か？</font><font style="vertical-align: inherit;">言語の観点から、そのような割り当ては完全に有効であることがわかります。</font><font style="vertical-align: inherit;">その結果</font><font style="vertical-align: inherit;">、理解できない値が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hardestroom</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数に</font><font style="vertical-align: inherit;">書き込ま</font><font style="vertical-align: inherit;">れます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告8</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullptrに対して検証された後、「pElem」ポインタが安全に使用されませんでした。</font><font style="vertical-align: inherit;">チェック行：1739、1744。editor.cpp 1744</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">editorclass::load</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;_path)</span>
</span>{<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-function">TiXmlHandle <span class="hljs-title">hDoc</span><span class="hljs-params">(&amp;doc)</span></span>;<font></font>
  TiXmlElement *pElem;<font></font>
  <span class="hljs-function">TiXmlHandle <span class="hljs-title">hRoot</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;<font></font>
  version = <span class="hljs-number">0</span>;<font></font>
<font></font>
  {<font></font>
    pElem = hDoc.FirstChildElement().Element();<font></font>
    <span class="hljs-comment">// should always have a valid root</span>
    <span class="hljs-comment">// but handle gracefully if it does</span>
    <span class="hljs-keyword">if</span> (!pElem)<font></font>
    {<font></font>
      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"No valid root! Corrupt level file?\n"</span>);<font></font>
    }<font></font>
<font></font>
    pElem-&gt;QueryIntAttribute(<span class="hljs-string">"version"</span>, &amp;version);    <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-comment">// save this for later</span><font></font>
    hRoot = TiXmlHandle(pElem);<font></font>
  }<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザー</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nullptr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がチェックされた直後に</font><i><font style="vertical-align: inherit;">pElem</font></i><font style="vertical-align: inherit;">ポインター</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">安全に使用されていない</font><font style="vertical-align: inherit;">ことを警告し</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。アナライザーが正しいことを確認するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Element（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数の定義を見てください</font><font style="vertical-align: inherit;">。その戻り値は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pElem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインターを初期化します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/** @deprecated use ToElement.
  Return the handle as a TiXmlElement. This may return null.
*/</span>
<span class="hljs-function">TiXmlElement *<span class="hljs-title">Element</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>
</span>{
  <span class="hljs-keyword">return</span> ToElement();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コメントからわかるように、この関数は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返すことがあり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが本当に起こったと想像してください。</font><font style="vertical-align: inherit;">この場合はどうなりますか？</font><font style="vertical-align: inherit;">実際には、そのような状況は決して処理されません。</font><font style="vertical-align: inherit;">はい、何か問題があったことを示すメッセージが表示されますが、文字通り、誤ったポインタの下の行は逆参照されます。</font><font style="vertical-align: inherit;">そのような逆参照は、プログラムのクラッシュまたは未定義の動作につながります。</font><font style="vertical-align: inherit;">これはかなり深刻な間違いです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告9</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの次のセクションで、PVS-Studioは4つの警告を発行しました。</font></font><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件式の一部は常にtrueです：x&gt; =0。editor.cpp1137</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件式の一部は常にtrueです：y&gt; =0。editor.cpp1137</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件式の一部は常にtrueです：x &lt;40。editor.cpp 1137</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V560</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件式の一部は常にtrueです：y &lt;30。editor.cpp 1137</font></font></li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">editorclass::at</span><span class="hljs-params">( <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y )</span>
</span>{
  <span class="hljs-keyword">if</span>(x&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> at(<span class="hljs-number">0</span>,y);
  <span class="hljs-keyword">if</span>(y&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> at(x,<span class="hljs-number">0</span>);
  <span class="hljs-keyword">if</span>(x&gt;=<span class="hljs-number">40</span>) <span class="hljs-keyword">return</span> at(<span class="hljs-number">39</span>,y);
  <span class="hljs-keyword">if</span>(y&gt;=<span class="hljs-number">30</span>) <span class="hljs-keyword">return</span> at(x,<span class="hljs-number">29</span>);<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(x&gt;=<span class="hljs-number">0</span> &amp;&amp; y&gt;=<span class="hljs-number">0</span> &amp;&amp; x&lt;<span class="hljs-number">40</span> &amp;&amp; y&lt;<span class="hljs-number">30</span>)<font></font>
  {<font></font>
      <span class="hljs-keyword">return</span> contents[x+(levx*<span class="hljs-number">40</span>)+vmult[y+(levy*<span class="hljs-number">30</span>)]];<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての警告は、最後の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステートメントに</font><font style="vertical-align: inherit;">適用されます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">問題は、その中で実行される4つのチェックすべてが常に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trueを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返すこと</font><i><font style="vertical-align: inherit;">です</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは重大な間違いだとは言いませんが、かなりおかしいことがわかりました。</font><font style="vertical-align: inherit;">著者はこの関数を真剣に受け止め、念のため各変数を再度</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェック</font><font style="vertical-align: inherit;">しました:) </font><font style="vertical-align: inherit;">このチェックは削除できます。</font><font style="vertical-align: inherit;">いずれにしても、実行スレッドが式「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return 0;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」に</font><font style="vertical-align: inherit;">到達することはありません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これによりプログラムのロジックは変更されませんが、不要なチェックやデッドコードから解放されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームの記念日に関する彼の記事で、テリーは皮肉なことに、ゲームのロジックを制御する要素の1つが、</font><font style="vertical-align: inherit;">多数の異なるゲームの状態に即座に関与</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game :: updatestate（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数からの大きなスイッチ</font><font style="vertical-align: inherit;">であったと述べています。そして、私は次の警告を見つけることがかなり期待されていました：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2008</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cyclomatic Complexity：548。 'Game :: updatestate'関数をリファクタリングすることを検討してください。 Game.cpp 612 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、あなたは正しく理解しました：PVS-Studioは関数の循環的複雑度を548単位と推定しました。五百四十八！これは私が理解していることです-「きちんとしたコード」。そして、これは、実際には、スイッチ式以外に関数には他に何もないという事実にもかかわらずです。スイッチ自体では、300以上のケース式を数えました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのオフィスでは、最長の記事をめぐって著者間で小さな競争があります。</font><font style="vertical-align: inherit;">ここではすべての関数コード（3450行）を喜んで持ってきますが、そのような勝利は不正直なので</font><font style="vertical-align: inherit;">、巨大なスイッチ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">言及</font></a><font style="vertical-align: inherit;">することにします。</font><font style="vertical-align: inherit;">私はそれに従って自分でスケール全体を評価することをお勧めします！</font><font style="vertical-align: inherit;">ちなみに</font><font style="vertical-align: inherit;">、PVS-Studioは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game :: updatestate（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に加えて</font><font style="vertical-align: inherit;">、循環的複雑度が非常に高い44個の関数を検出しました。そのうち10個は200以上の複雑度を持っています。</font></font><br>
<br>
<p><img src="https://habrastorage.org/webt/pu/s9/a2/pus9a2tqqeyzmdkg90auf5r2d0q.png" alt="図3"></p><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事には書かれたエラーで十分だと思います。はい、プロジェクトには多くのミスがありましたが、これはまさにトリックです。彼のコードをレイアウトした後、Terry Cavanaghは優れたゲームを作るために優れたプログラマーである必要はないことを示しました。今、10年後、テリーはそれらの時代を皮肉で思い出します。あなたの過ちから学ぶことは重要であり、練習はこれを行うための最良の方法です。そして、あなたの練習がまだVVVVVVのようなゲームを生み出すことができるなら、これは一般的に豪華です！えーと…行って、またプレイします:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、ゲームコードで見つかったすべてのエラーではありませんでした。他に何が見つかるか自分で確認したい場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studioをダウンロードして試してみる</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ことをお勧めし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。また、オープンソースプロジェクトの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のライセンス</font><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">提供する</font></a><font style="vertical-align: inherit;">ことも忘れないでください</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す聴衆と共有したい場合は、翻訳へのリンクを使用してください：George Gribkov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VVVVVV ??? </font><font style="vertical-align: inherit;">VVVVVV !!! </font><font style="vertical-align: inherit;">:)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484150/index.html">楽しいコンテンツを作成するための5つの新しいツール</a></li>
<li><a href="../ja484152/index.html">高速PACコントローラーWISE-5580</a></li>
<li><a href="../ja484154/index.html">ディオファントス方程式のシステムを解く方法</a></li>
<li><a href="../ja484160/index.html">とらえどころのない才能：ロシアは最高のIT専門家を失う</a></li>
<li><a href="../ja484164/index.html">本の歴史と図書館の未来</a></li>
<li><a href="../ja484168/index.html">Angular CDKから仮想スクロールの戦略を書きます</a></li>
<li><a href="../ja484170/index.html">チェックポイントをR77.30から80.20に更新</a></li>
<li><a href="../ja484172/index.html">Unityでの継続的インテグレーション：組み立て時間を短縮し、リソースを節約する方法+ギフトとしてのペイライン</a></li>
<li><a href="../ja484174/index.html">「極端な」条件での城の飲酒、または「DOZOR」ショーへの参加方法</a></li>
<li><a href="../ja484176/index.html">Unityでのステータステンプレートの実装</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>