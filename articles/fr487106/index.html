<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤪 🐧 🛫 Contrôle RunUO de l'analyseur PVS-Studio 💃 🚧 🦃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est consacré à la vérification du projet RunUO à l'aide de l'analyseur statique PVS-Studio. RunUO est un émulateur de logiciel serveur pou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Contrôle RunUO de l'analyseur PVS-Studio</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/487106/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/vz/nb/pkvznbl6d22oijuluuu2xfoztcs.png" alt="Image 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article est consacré à la vérification du projet RunUO à l'aide de l'analyseur statique PVS-Studio. </font><font style="vertical-align: inherit;">RunUO est un émulateur de logiciel serveur pour Ultima Online, un jeu qui a une fois conquis le cœur de nombreux fans de MMORPG.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un émulateur de logiciel serveur pour MMORPG Ultima Online. Le but de ce projet est de créer un logiciel stable qui pourra rivaliser avec les serveurs officiels d'EA Games. RunUO a été créé en 2002, mais il ne perd pas de sa pertinence et est activement utilisé à ce jour. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le but de la vérification du projet est de vulgariser le sujet de l'analyse statique. Nous vérifions divers projets - jeux ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), bibliothèques ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), messagers ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), navigateurs ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) et bien plus encore ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) pour attirer l'attention d'un public diversifié. Avec ces articles, nous essayons d'attirer l'attention sur l'importance d'utiliser l'analyse statique dans le développement. L'analyse statique rend le code plus fiable et plus sûr. De plus, grâce à son utilisation régulière, vous pouvez rechercher et éliminer les erreurs dès les premiers stades. Cela fait gagner du temps et des efforts aux développeurs, car personne ne veut passer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 heures à</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rechercher l'erreur que l'analyseur peut trouver.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous aidons également la communauté open source. </font><font style="vertical-align: inherit;">À travers des articles avec des erreurs trouvées, nous contribuons au développement de l'open source. </font><font style="vertical-align: inherit;">Cependant, dans les articles, nous n'analysons pas tous les avertissements. </font><font style="vertical-align: inherit;">Certains avertissements semblaient trop ennuyeux pour nous d'entrer dans l'article, certains se sont révélés être de faux positifs, etc. </font><font style="vertical-align: inherit;">Par conséquent, nous sommes prêts à fournir une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licence gratuite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour les projets open source. </font><font style="vertical-align: inherit;">De plus, ce qui nous a semblé ennuyeux pour l'article peut sembler assez intéressant pour les développeurs du projet en cours de test, car les développeurs du projet sont encore plus conscients des problèmes les plus critiques.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morceaux de code qui ont retenu l'attention lors de l'examen du rapport de l'analyseur</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3010 La valeur de retour de la fonction 'Intern' doit être utilisée. </font><font style="vertical-align: inherit;">BasePaintedMask.cs 49</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">Intern</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> str </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( str == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( str.Length == <span class="hljs-number">0</span> )
    <span class="hljs-keyword">return</span> String.Empty;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> String.Intern( str );<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BasePaintedMask</span>(<span class="hljs-params"> <span class="hljs-keyword">string</span> staffer, <span class="hljs-keyword">int</span> itemid </span>)
                            : <span class="hljs-title">base</span>(<span class="hljs-params"> itemid + Utility.Random( <span class="hljs-number">2</span> </span>) )</span><font></font>
{<font></font>
  m_Staffer = staffer;<font></font>
<font></font>
  Utility.Intern( m_Staffer );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La valeur de retour de la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intern ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'est </font><font style="vertical-align: inherit;">prise en compte nulle part, comme indiqué par l'analyseur. </font><font style="vertical-align: inherit;">Il s'agit peut-être d'un bogue ou d'un code redondant. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3017 Un modèle a été détecté: (l'élément est BasePotion) || </font><font style="vertical-align: inherit;">((l'élément est BasePotion) &amp;&amp; ...). </font><font style="vertical-align: inherit;">L'expression est excessive ou contient une erreur logique. </font><font style="vertical-align: inherit;">Cleanup.cs 137</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBuggable</span>(<span class="hljs-params"> Item item </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> Fists )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( item <span class="hljs-keyword">is</span> ICommodity || item <span class="hljs-keyword">is</span> Multis.BaseBoat<font></font>
    || item <span class="hljs-keyword">is</span> Fish || item <span class="hljs-keyword">is</span> BigFish<font></font>
    || item <span class="hljs-keyword">is</span> BasePotion || item <span class="hljs-keyword">is</span> Food || item <span class="hljs-keyword">is</span> CookableFood<font></font>
    || item <span class="hljs-keyword">is</span> SpecialFishingNet || item <span class="hljs-keyword">is</span> BaseMagicFish<font></font>
    || item <span class="hljs-keyword">is</span> Shoes || item <span class="hljs-keyword">is</span> Sandals<font></font>
    || item <span class="hljs-keyword">is</span> Boots || item <span class="hljs-keyword">is</span> ThighBoots<font></font>
    || item <span class="hljs-keyword">is</span> TreasureMap || item <span class="hljs-keyword">is</span> MessageInABottle<font></font>
    || item <span class="hljs-keyword">is</span> BaseArmor || item <span class="hljs-keyword">is</span> BaseWeapon<font></font>
    || item <span class="hljs-keyword">is</span> BaseClothing<font></font>
    || ( item <span class="hljs-keyword">is</span> BaseJewel &amp;&amp; Core.AOS )<font></font>
    || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe des sous-expressions qui peuvent être simplifiées. </font><font style="vertical-align: inherit;">Je vais les écrire pour que ce soit plus clair:</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> BasePotion || ( item <span class="hljs-keyword">is</span> BasePotion &amp;&amp; Core.ML ))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article est BasePotion = true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition est vrai, en </font><font style="vertical-align: inherit;">dépit de </font><font style="vertical-align: inherit;">la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article est BasePotion = false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la condition est fausse, encore une </font><font style="vertical-align: inherit;">fois quelle que </font><font style="vertical-align: inherit;">soit la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.ML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Un tel code est le plus souvent simplement redondant, cependant, il y a des situations pires lorsque le programmeur a fait une erreur et a écrit la mauvaise variable dans la deuxième sous-expression. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Un contrôle excessif peut être simplifié. </font><font style="vertical-align: inherit;">Le '||' </font><font style="vertical-align: inherit;">L'opérateur est entouré d'expressions opposées «bPlayerOnly» et «! bPlayerOnly». </font><font style="vertical-align: inherit;">BaseCreature.cs 3005</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">double</span> <span class="hljs-title">GetFightModeRanking</span>(<span class="hljs-params"> Mobile m,
                                           FightMode acqType,
                                           <span class="hljs-keyword">bool</span> bPlayerOnly </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ( bPlayerOnly &amp;&amp; m.Player ) ||  !bPlayerOnly )<font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code est soit redondant soit erroné. </font><font style="vertical-align: inherit;">Son problème est que des deux côtés de «||» </font><font style="vertical-align: inherit;">sont différents dans le sens de la sous-expression. </font><font style="vertical-align: inherit;">Si nous le coupons comme ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ( m.Player || !bPlayerOnly )</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
alors rien ne changera. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3001 Il existe des sous-expressions identiques «acte est SmallBrickHouseDeed» à gauche et à droite de «||» </font><font style="vertical-align: inherit;">opérateur. </font><font style="vertical-align: inherit;">RealEstateBroker.cs 132</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ComputePriceFor</span>(<span class="hljs-params"> HouseDeed deed </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">int</span> price = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> StonePlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> FieldStoneHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> SmallBrickHouseDeed ||    <span class="hljs-comment">// &lt;=</span>
       deed <span class="hljs-keyword">is</span> WoodHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> WoodPlasterHouseDeed ||<font></font>
       deed <span class="hljs-keyword">is</span> ThatchedRoofCottageDeed )<font></font>
      ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que cela ne vaut pas la peine d'expliquer quoi que ce soit ici, le code suivant ou erroné ou redondant. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3067 Il est possible que le bloc "else" ait été oublié ou commenté, altérant ainsi les logiques de fonctionnement du programme. </font><font style="vertical-align: inherit;">BaseHouse.cs 1558</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetLockdown</span>(<span class="hljs-params"> Item i, <span class="hljs-keyword">bool</span> locked, <span class="hljs-keyword">bool</span> checkContains </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( m_LockDowns == <span class="hljs-literal">null</span> )
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> Mondain's Legacy</span>
  <span class="hljs-keyword">if</span> ( i <span class="hljs-keyword">is</span> BaseAddonContainer )<font></font>
    i.Movable = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">else</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span><font></font>
<font></font>
  i.Movable = !locked;<font></font>
  i.IsLockedDown = locked;<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un avertissement assez rare. </font><font style="vertical-align: inherit;">L'analyseur a trouvé suspect le formatage du code après la directive </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#endregion. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous ne lisez pas le code, il ressemble à une ligne</font></font><br>
<br>
<pre><code class="cs hljs">i.Movable = !locked;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sera exécuté dans tous les cas, quelle que soit la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Peut-être que les accolades ont été oubliées ici ... En général, les développeurs devraient vérifier ce code. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3043 La logique de fonctionnement du code ne correspond pas à sa mise en forme. </font><font style="vertical-align: inherit;">L'instruction est en retrait vers la droite, mais elle est toujours exécutée. </font><font style="vertical-align: inherit;">Il est possible que des accolades soient manquantes. </font><font style="vertical-align: inherit;">Earthquake.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCast</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( Core.AOS )<font></font>
  {<font></font>
    damage = m.Hits / <span class="hljs-number">2</span>;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> ( !m.Player )<font></font>
      damage = Math.Max( Math.Min( damage, <span class="hljs-number">100</span> ), <span class="hljs-number">15</span> );<font></font>
      damage += Utility.RandomMinMax( <span class="hljs-number">0</span>, <span class="hljs-number">15</span> );            <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les accolades peuvent être manquantes dans ce code. </font><font style="vertical-align: inherit;">Cette conclusion peut être faite en raison de la mise en forme étrange du code dans le corps de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (! M.Player)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3083 Appel non sécurisé de l'événement 'ServerStarted', NullReferenceException est possible. </font><font style="vertical-align: inherit;">Pensez à affecter un événement à une variable locale avant de l'invoquer. </font><font style="vertical-align: inherit;">EventSink.cs 921</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> ( ServerStarted != <span class="hljs-literal">null</span> )<font></font>
    ServerStarted();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette méthode utilise un appel potentiellement dangereux au </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> événements </font><i><font style="vertical-align: inherit;">RefreshStarted</font></i><font style="vertical-align: inherit;"> , comme l'indique l'analyseur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-ce dangereux? Imaginez cette situation. L'événement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'a qu'un seul abonné. Et au moment entre la vérification de null et l'appel direct du gestionnaire d'événements </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerStarted ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans un autre thread, une désinscription a été effectuée à partir de cet événement. Cela </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lèvera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> une </font><i><font style="vertical-align: inherit;">NullReferenceException</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple de prévenir cette situation consiste à fournir un appel d'événement sécurisé à l'aide de l'opérateur «?».</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InvokeServerStarted</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ServerStarted?.Invoke();<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3054 Verrouillage à double vérification potentiellement dangereux. Utilisez des variables volatiles ou des primitives de synchronisation pour éviter cela. Item.cs 1624</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          m_RemovePacket = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          m_RemovePacket.SetStatic();<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'avertissement de l'analyseur est associé à une utilisation non sûre du schéma de verrouillage à double vérification. Comme vous pouvez le voir dans le code ci-dessus, un verrou à double vérification a été appliqué pour implémenter le modèle génératif - Loners. Lorsque nous essayons d'obtenir une instance de la classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><font style="vertical-align: inherit;">accédant à la propriété </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le getter vérifie que le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket est égal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à zéro. Si la vérification réussit, nous entrons dans le corps de l'instruction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">initialisé</font></i><font style="vertical-align: inherit;"> . Une situation intéressante se présente au moment où le thread principal a déjà initialisé la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> via le constructeur, mais n'a pas encore appelé la méthode</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetStatic ().</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Théoriquement, un autre thread peut accéder à la propriété </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au moment très gênant. La </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vérification</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'égalité à zéro de </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> n'échouera plus et le thread appelant recevra un lien vers un objet incomplètement prêt à l'emploi. Pour résoudre ce problème, </font><font style="vertical-align: inherit;">vous pouvez créer une variable intermédiaire de la classe </font><i><font style="vertical-align: inherit;">Packet</font></i><font style="vertical-align: inherit;"> dans le corps de l'instruction </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , l'initialiser via un appel de constructeur et la méthode </font><i><font style="vertical-align: inherit;">SetStatic (),</font></i><font style="vertical-align: inherit;"> puis l'affecter à la variable </font><i><font style="vertical-align: inherit;">m_RemovePacket</font></i><font style="vertical-align: inherit;"> . Dans ce cas, le corps de l'instruction </font><i><font style="vertical-align: inherit;">lock</font></i><font style="vertical-align: inherit;"> pourrait ressembler à ceci:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">lock</span> (_rpl)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    m_RemovePacket = instance;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problème semble être résolu et le code fonctionnera comme prévu. Mais ce n'est pas le cas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un autre point: l'analyseur ne suggère pas seulement d'utiliser le mot-clé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans la version </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">finale</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du programme, le compilateur peut effectuer une optimisation et réorganiser les lignes de l'appel à la méthode </font><i><font style="vertical-align: inherit;">SetStatic ()</font></i><font style="vertical-align: inherit;"> et affecter la variable d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (du point de vue du compilateur, la sémantique du programme ne sera pas violée). Et nous revenons encore au même point où nous avons commencé - la possibilité d'obtenir la variable non initialisée </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Il est impossible de dire exactement quand cette réorganisation peut se produire et si elle se produira: elle peut être affectée par la version CLR, l'architecture du processeur utilisé, etc. Il vaut toujours la peine d'être protégé contre un tel scénario, et l'une des solutions (cependant, pas la plus productive) sera d'utiliser le mot clé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Une variable qui sera déclarée avec le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modificateur volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne sera pas soumise à des permutations lors de l'optimisation par le compilateur. Un code finalement fixe peut ressembler à ceci:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Packet m_RemovePacket;<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">object</span> _rpl = <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>();
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">lock</span> (_rpl)<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (m_RemovePacket == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
          Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
          instance.SetStatic();<font></font>
          m_RemovePacket = instance;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, l'utilisation d'un </font><font style="vertical-align: inherit;">champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut être indésirable en raison de la surcharge d'accès à un tel champ. Nous ne nous attarderons pas sur ce sujet en détail, notant simplement que dans l'exemple considéré, un enregistrement de champ atomique n'est nécessaire qu'une seule fois (lorsque la propriété est accédée pour la première fois), cependant, déclarer le champ comme </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obligera le compilateur à effectuer sa lecture et son écriture atomiques qui peut ne pas être optimal en termes de performances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, une autre approche pour corriger cet avertissement de l'analyseur pour éviter une surcharge supplémentaire de déclaration d'un </font><font style="vertical-align: inherit;">champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">volatile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consiste à utiliser le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour sauvegarder le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_RemovePacket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au lieu d'un double contrôle de verrouillage. </font><font style="vertical-align: inherit;">Dans ce cas, le corps getter peut être remplacé par la méthode initializer, qui sera transmise au constructeur de l'instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> Lazy&lt;Packet&gt; m_RemovePacket = <span class="hljs-keyword">new</span> Lazy&lt;Packet&gt;(() =&gt;<font></font>
  {<font></font>
    Packet instance = <span class="hljs-keyword">new</span> RemoveItem(<span class="hljs-keyword">this</span>);<font></font>
    instance.SetStatic();<font></font>
    <span class="hljs-keyword">return</span> instance;<font></font>
  }, LazyThreadSafetyMode.ExecutionAndPublication);<font></font>
<font></font>
....<font></font>
<span class="hljs-keyword">public</span> Packet RemovePacket<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> m_RemovePacket.Value;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La méthode d'initialisation sera appelée une fois, lorsque le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est accédé pour la première fois, </font><font style="vertical-align: inherit;">et la sécurité du streaming en cas d'accès à la propriété à partir de plusieurs threads en même temps sera garantie par le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (le mode de sécurité des threads est contrôlé par le deuxième paramètre du constructeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lazy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3131 La compatibilité de l'expression «ciblé» avec le type «IAxe» est vérifiée, mais elle est convertie en type «Article». </font><font style="vertical-align: inherit;">HarvestTarget.cs 61</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnTarget</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, <span class="hljs-keyword">object</span> targeted </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( m_System <span class="hljs-keyword">is</span> Lumberjacking &amp;&amp;<font></font>
            targeted <span class="hljs-keyword">is</span> IAxe &amp;&amp; m_Tool <span class="hljs-keyword">is</span> BaseAxe )<font></font>
  {<font></font>
    IAxe obj = (IAxe)targeted;<font></font>
    Item item = (Item)targeted;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ciblée a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> été vérifiée pour l'appartenance au type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IAxe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais </font><font style="vertical-align: inherit;">personne n'a vérifié l' </font><font style="vertical-align: inherit;">appartenance à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Item</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme le rapporte l'analyseur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3070 La variable non initialisée 'Zero' est utilisée lors de l'initialisation de la variable 'm_LastMobile'. Serial.cs 29</font></font><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Serial : IComparable, IComparable&lt;Serial&gt;<font></font>
{<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> m_Serial;<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastMobile = Zero;                <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Serial m_LastItem = <span class="hljs-number">0x40000000</span>;<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastMobile { .... }
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serial LastItem { .... }<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial MinusOne = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">-1</span> );
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Serial Zero = <span class="hljs-keyword">new</span> Serial( <span class="hljs-number">0</span> );     <span class="hljs-comment">// &lt;=</span><font></font>
  ....<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Serial</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> serial </span>)</span><font></font>
  {<font></font>
    m_Serial = serial;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que tel, il n'y a pas d'erreur, cependant, écrire ce n'est pas très bon. En raison de l'affectation de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_LastMobile à la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valeur d'un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zéro</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> non initialisé </font><font style="vertical-align: inherit;">, une structure avec le constructeur par défaut </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera créée </font><font style="vertical-align: inherit;">, ce qui conduira à l'initialisation de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et cela, à son tour, équivaut à appeler un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveau Serial (0)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En fait, les développeurs ont de la chance que le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numéro de série</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soit égal à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , s'il devait y avoir une autre valeur, cela entraînerait une erreur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3063 Une partie de l'expression conditionnelle est toujours vraie si elle est évaluée: m_Serial &lt;= 0x7FFFFFFF. Serial.cs 83</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> ( m_Serial &gt;= <span class="hljs-number">0x40000000</span> &amp;&amp; m_Serial &lt;= <span class="hljs-number">0x7FFFFFFF</span> );<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est la valeur maximale possible que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut contenir </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Par conséquent, quelle que soit la valeur de la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_Serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , elle sera en tout cas inférieure ou égale à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x7FFFFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3004 L'instruction 'then' est équivalente à l'instruction 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 1571</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">try</span> <font></font>
  { <font></font>
    d = <span class="hljs-keyword">new</span> TimeSpan( ticks-now ); <font></font>
  }<font></font>
  <span class="hljs-keyword">catch</span> <font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
      d = TimeSpan.MaxValue; <font></font>
    <span class="hljs-keyword">else</span> <font></font>
      d = TimeSpan.MaxValue;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'analyseur met en garde contre un morceau de code suspect dans lequel les vraies et les fausses branches de l' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coïncident complètement. </font><font style="vertical-align: inherit;">Peut-être qu'une des branches devrait avoir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TimeSpan.MinValue. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le même code a été trouvé à plusieurs endroits: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 L'instruction 'then' est équivalente à l'instruction 'else'. </font><font style="vertical-align: inherit;">Item.cs 2103</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Serialize</span>(<span class="hljs-params"> GenericWriter writer </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3004 L'instruction 'then' est équivalente à l'instruction 'else'. </font><font style="vertical-align: inherit;">Serialization.cs 383</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteDeltaTime</span>(<span class="hljs-params"> DateTime <span class="hljs-keyword">value</span> </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <font></font>
  <span class="hljs-keyword">if</span>( ticks &lt; now ) <font></font>
    d = TimeSpan.MaxValue; <font></font>
  <span class="hljs-keyword">else</span> <font></font>
    d = TimeSpan.MaxValue;<font></font>
  <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai utilisé "This" pour une raison, il est très probable que, entre autres choses, il ne puisse pas se passer de copier-coller, ces fragments de code semblent très douloureux. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3051 Une fonte de type excessive. </font><font style="vertical-align: inherit;">L'objet est déjà du type 'Item'. </font><font style="vertical-align: inherit;">Mobile.cs 11237</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> Item Talisman<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">return</span> FindItemOnLayer( Layer.Talisman ) <span class="hljs-keyword">as</span> Item;<font></font>
  }<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> Item <span class="hljs-title">FindItemOnLayer</span>(<span class="hljs-params"> Layer layer </span>)</span><font></font>
{<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet avertissement de l'analyseur peut être obtenu en cas d'utilisation excessive de l'opérateur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il n'y a aucune erreur dans cette section du code, mais cela n'a également aucun sens de convertir l'objet en son propre type. </font><font style="vertical-align: inherit;">Avertissement </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3148 La conversion de la valeur 'null' potentielle de 'toSet' en un type de valeur peut conduire à NullReferenceException. </font><font style="vertical-align: inherit;">Properties.cs 502</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ConstructFromString</span>(<span class="hljs-params"> .... </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">object</span> toSet;
  <span class="hljs-keyword">bool</span> isSerial = IsSerial( type );<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate into int32</span>
    type = m_NumericTypes[<span class="hljs-number">4</span>];<font></font>
<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    toSet = <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
  ....<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( isSerial ) <span class="hljs-comment">// mutate back</span><font></font>
    toSet = (Serial)((Int32)toSet);<font></font>
<font></font>
  constructed = toSet;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette section de code, nous nous intéressons au cas où la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la variable </font><font style="vertical-align: inherit;">est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ensuite, la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> également </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De plus, si la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSerial == true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">converti</font></i><font style="vertical-align: inherit;"> en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui conduira à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez corriger ce code en ajoutant, par exemple, 0 par défaut:</font></font><br>
<br>
<pre><code class="cs hljs">toSet = (Serial)((Int32)(toSet ?? <span class="hljs-number">0</span>));</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3031 Un contrôle excessif peut être simplifié. </font><font style="vertical-align: inherit;">Le '||' </font><font style="vertical-align: inherit;">L'opérateur est entouré des expressions opposées 'pack == null' et 'pack! = null'. </font><font style="vertical-align: inherit;">BODBuyGump.cs 64</font></font><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnResponse</span>(<span class="hljs-params">Server.Network.NetState sender, RelayInfo info</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( (pack == <span class="hljs-literal">null</span>) ||<font></font>
       ((pack != <span class="hljs-literal">null</span>) &amp;&amp;<font></font>
        (!pack.CheckHold(<font></font>
                m_From,<font></font>
                item,<font></font>
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>,
                <span class="hljs-number">0</span>,<font></font>
                item.PileWeight + item.TotalWeight)) ) )<font></font>
  {<font></font>
    pv.SayTo(m_From, <span class="hljs-number">503204</span>);<font></font>
    m_From.SendGump(<span class="hljs-keyword">new</span> BOBGump(m_From, m_Book, m_Page, <span class="hljs-literal">null</span>));<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code peut être simplifié, comme le rapporte l'analyseur: </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> ((pack == <span class="hljs-literal">null</span>) || ((pack != <span class="hljs-literal">null</span>) &amp;&amp; (!pack.CheckHold(....))))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À gauche et à droite de l'opérateur '||' </font><font style="vertical-align: inherit;">il y a des expressions opposées dans le sens. </font><font style="vertical-align: inherit;">Ici, le check </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est redondant, car avant cela, le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pack de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conditions opposées </font><i><font style="vertical-align: inherit;">== null est</font></i><font style="vertical-align: inherit;"> vérifié </font><font style="vertical-align: inherit;">, et ces expressions sont séparées par l'opérateur '||'. </font><font style="vertical-align: inherit;">Cette ligne peut être raccourcie comme suit:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (pack == <span class="hljs-literal">null</span> || !pack.CheckHold(....))</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3080 Déréférence nulle possible. </font><font style="vertical-align: inherit;">Pensez à inspecter le «gagnant». </font><font style="vertical-align: inherit;">CTF.cs 1302</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Finish_Callback</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  CTFTeamInfo winner = ( teams.Count &gt; <span class="hljs-number">0</span> ? teams[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span> );<font></font>
<font></font>
  .... <font></font>
<font></font>
  m_Context.Finish( m_Context.Participants[winner.TeamID] <span class="hljs-keyword">as</span> Participant );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lets</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dire </font><i><font style="vertical-align: inherit;">teams.Count</font></i><font style="vertical-align: inherit;"> est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Alors </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gagnant = null.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et plus loin dans le code, la propriété </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winner.TeamID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><i><font style="vertical-align: inherit;">accessible</font></i><font style="vertical-align: inherit;"> sans vérifier la valeur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui entraînera l'accès par une référence null. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3041 L'expression a été implicitement convertie du type 'int' en type 'double'. Pensez à utiliser un transtypage de type explicite pour éviter la perte d'une partie fractionnaire. Un exemple: double A = (double) (X) / Y;. StormsEye.cs 87</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Gain</span>(<span class="hljs-params"> Mobile <span class="hljs-keyword">from</span>, Skill skill </span>)</span> <font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">from</span>.Player &amp;&amp; <font></font>
     ( skills.Total / skills.Cap ) &gt;= Utility.RandomDouble())<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce fragment de code contient l'opération de division des variables </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Total</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skills.Cap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui sont de type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et le résultat est ensuite implicitement converti en type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme le rapporte l'analyseur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3085 Le nom du champ 'typeofObject' dans un type imbriqué est ambigu. Le type externe contient un champ statique avec un nom identique. PropsGump.cs 744</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">object</span> );<font></font>
....<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GroupComparer</span> : <span class="hljs-title">IComparer</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type typeofObject = <span class="hljs-keyword">typeof</span>( Object );<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeofObject a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> été créée dans cette section de code dans une classe imbriquée </font><font style="vertical-align: inherit;">. Son problème est que dans la classe externe, il existe une variable du même nom et des erreurs peuvent survenir à cause de cela. Il vaut mieux ne pas le permettre afin de réduire la probabilité de telles erreurs dues à l'inattention. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio: les</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accesseurs de propriété V3140 utilisent différents champs de support. WallBanner.cs 77</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_IsRewardItem;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> IsRewardItem<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_IsRewardItem; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> m_East;<font></font>
<font></font>
[<span class="hljs-meta">CommandProperty( AccessLevel.GameMaster )</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> East<font></font>
{<font></font>
  <span class="hljs-keyword">get</span>{ <span class="hljs-keyword">return</span> m_East; }
  <span class="hljs-keyword">set</span>{ m_IsRewardItem = <span class="hljs-keyword">value</span>; InvalidateProperties(); }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, il y a une erreur qui est apparue en raison du copier-coller. La méthode d'accès </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">définie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la </font><font style="vertical-align: inherit;">propriété </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consistait à attribuer une valeur à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_East</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et non à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_IsRewardItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Avertissements </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio:</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3012 L'opérateur '?:', Quelle que soit son expression conditionnelle, renvoie toujours une seule et même valeur: 0xe7f. TreasureChestLevel2.cs 52 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V3012 L'opérateur '?:', Quelle que soit son expression conditionnelle, renvoie toujours une seule et même valeur: 0xe77. TreasureChestLevel2.cs 57</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetChestAppearance</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">bool</span> UseFirstItemId = Utility.RandomBool();<font></font>
<font></font>
  <span class="hljs-keyword">switch</span>( Utility.RandomList( <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span> ) )<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<span class="hljs-comment">// Keg</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe7f</span> : <span class="hljs-number">0xe7f</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<span class="hljs-comment">// Barrel</span>
      <span class="hljs-keyword">this</span>.ItemID = ( UseFirstItemId ? <span class="hljs-number">0xe77</span> : <span class="hljs-number">0xe77</span> );
      <span class="hljs-keyword">this</span>.GumpID = <span class="hljs-number">0x3e</span>;
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une sorte d'illusion de choix :) Quelle que soit la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UseFirstItemId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.ItemID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe7f</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le premier cas, soit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xe77</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le second. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avertissement PVS-Studio:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3066 Ordre incorrect possible des arguments passés à la méthode 'OnSwing': 'défenseur' et 'attaquant'. </font><font style="vertical-align: inherit;">BaseWeapon.cs 1188</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">int</span> <span class="hljs-title">AbsorbDamageAOS</span>(<span class="hljs-params"> Mobile attacker,
                                    Mobile defender,
                                    <span class="hljs-keyword">int</span> damage </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> ( weapon != <span class="hljs-literal">null</span> )<font></font>
  {<font></font>
    defender.FixedParticles(<span class="hljs-number">0x3779</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">15</span>,
                            <span class="hljs-number">0x158B</span>,
                            <span class="hljs-number">0x0</span>,
                            <span class="hljs-number">0x3</span>,<font></font>
                            EffectLayer.Waist);<font></font>
    weapon.OnSwing( defender, attacker );<font></font>
  }<font></font>
  ....<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> TimeSpan <span class="hljs-title">OnSwing</span>(<span class="hljs-params"> Mobile attacker, Mobile defender </span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> OnSwing( attacker, defender, <span class="hljs-number">1.0</span> );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a semblé suspect à l'analyseur que la méthode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnSwing () ait</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reçu des </font><font style="vertical-align: inherit;">arguments dans l'ordre inverse. </font><font style="vertical-align: inherit;">Cela est peut-être dû à une erreur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V3092 Les intersections de plage sont possibles dans les expressions conditionnelles. </font><font style="vertical-align: inherit;">Exemple: if (A&gt; 0 &amp;&amp; A &lt;5) {...} else if (A&gt; 3 &amp;&amp; A &lt;9) {...}. </font><font style="vertical-align: inherit;">HouseFoundation.cs 1883</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsFixture</span>(<span class="hljs-params"> <span class="hljs-keyword">int</span> itemID </span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31B0</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// ML doors</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID == <span class="hljs-number">0x2D46</span> ||<font></font>
           itemID == <span class="hljs-number">0x2D48</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE2</span> ||<font></font>
           itemID == <span class="hljs-number">0x2FE4</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x2D63</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x2D70</span> )
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( itemID &gt;= <span class="hljs-number">0x319C</span> &amp;&amp; itemID &lt; <span class="hljs-number">0x31AF</span> ) 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les plages testées dans des conditions se croisent. </font><font style="vertical-align: inherit;">Cela semblait suspect à l'analyseur. </font><font style="vertical-align: inherit;">Même si ce morceau de code fonctionne correctement, il vaut toujours la peine de le réparer. </font><font style="vertical-align: inherit;">Imaginez une situation où nous devions réécrire le corps du dernier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tel est le cas, si la condition est vraie, la méthode retourne </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemID est</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> égal à, disons, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x319C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la méthode retournera toujours </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela entraînera à son tour une perte de temps pour rechercher les erreurs.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RunUO a été créé il y a longtemps, beaucoup de travail a été fait, cependant, en utilisant l'exemple de ce projet, vous pouvez voir les avantages d'utiliser l'analyse statique sur des projets avec un historique. </font><font style="vertical-align: inherit;">L'analyseur de 543 000 lignes de code de projet a émis environ 500 avertissements (sans compter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le niveau</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bas), dont la plupart n'apparaissaient pas dans l'article en raison de leur uniformité. </font><font style="vertical-align: inherit;">Pour vous familiariser avec le résultat de l'analyse plus en détail, je vous suggère d'utiliser une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">licence gratuite pour les projets open source</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Ekaterina Nikiforova. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RunUO Check par l'analyseur PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr487106/">https://habr.com/ru/post/fr487106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487092/index.html">Modélisation des processus métiers dans le cadre d'un projet d'implémentation d'un système ERP</a></li>
<li><a href="../fr487094/index.html">Événements de retraitement reçus de Kafka</a></li>
<li><a href="../fr487096/index.html">Extraits. Comment faciliter le processus de travail avec la documentation</a></li>
<li><a href="../fr487098/index.html">Dessiner avec des fourmis: images procédurales utilisant des algorithmes d'optimisation des colonies de fourmis</a></li>
<li><a href="../fr487100/index.html">Structures de données immuables à la pointe de la technologie</a></li>
<li><a href="../fr487108/index.html">Profil de joueur mobile: recherche MyTracker</a></li>
<li><a href="../fr487110/index.html">Slurm SRE. Une expérience complète avec des experts de Booking.com et de Google.com</a></li>
<li><a href="../fr487112/index.html">Edge of Madness: The Basic Circle</a></li>
<li><a href="../fr487116/index.html">Pourquoi Discord passe de Go à Rust</a></li>
<li><a href="../fr487118/index.html">Loki - collecte de journaux à l'aide de l'approche Prometheus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>