<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’  â˜ºï¸ ğŸƒ La journalisation et le suivi des requÃªtes sont les meilleures pratiques. Rapport Yandex ğŸ£ ğŸ“® ğŸ¤´ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yandex.Market a une grande architecture de microservices. La demande de navigateur de la page principale du marchÃ© donne lieu Ã  des dizaines de demand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>La journalisation et le suivi des requÃªtes sont les meilleures pratiques. Rapport Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/489048/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Market a une grande architecture de microservices. </font><font style="vertical-align: inherit;">La demande de navigateur de la page principale du marchÃ© donne lieu Ã  des dizaines de demandes intÃ©grÃ©es dans diffÃ©rents services (backends) qui sont dÃ©veloppÃ©es par diffÃ©rentes personnes. </font><font style="vertical-align: inherit;">Dans un tel systÃ¨me, il peut Ãªtre difficile de comprendre pour quelle raison la demande est tombÃ©e ou a pris beaucoup de temps Ã  traiter.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/_l1qP0DyBcA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anatoly Ostrovsky </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">megatolya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explique comment son Ã©quipe a rÃ©solu ce problÃ¨me et partage des pratiques spÃ©cifiques au marchÃ©, mais gÃ©nÃ©ralement pertinentes pour tout excellent service. Son rapport est basÃ© sur sa propre expÃ©rience de dÃ©ploiement d'un nouveau marchÃ© dans un temps assez court. Pendant plusieurs annÃ©es, Tolya a dirigÃ© l'Ã©quipe de dÃ©veloppement d'interfaces sur le marchÃ©, et maintenant il s'est orientÃ© vers les vÃ©hicules sans pilote.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Tous nos marchÃ©s sont construits selon des principes gÃ©nÃ©raux. Il s'agit d'un grand systÃ¨me unique. Mais si nous parlons de l'interface, du point de vue de l'utilisateur, les applications sont complÃ¨tement diffÃ©rentes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xf/cx/bk/xfcxbk6d4xsoxdb3l7clfzw5yza.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le mÃªme temps, nos frontends vont Ã  de nombreux backends. Parfois, ces backends sont similaires les uns aux autres (diffÃ©rentes instances de la mÃªme application). Et parfois, ils sont uniques au service (facturation spÃ©ciale). La structure d'un tel systÃ¨me peut Ãªtre considÃ©rÃ©e comme une architecture de microservice classique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a toujours un problÃ¨me dans un grand service - il est difficile de comprendre ce qui s'y passe exactement. Ou, par exemple, ce qui se passe au moment oÃ¹ une erreur de paiement se produit avec l'utilisateur. Supposons que cela se soit passÃ© chez lui hier, et aujourd'hui, nous devons comprendre ce qui s'est passÃ©.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b3/nz/p2/b3nzp2buowpixe2wnv1-r-ymj7m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le backend 2 peut Â«graverÂ» soit pour un produit spÃ©cifique, soit Ã  un moment prÃ©cis, soit pour des utilisateurs spÃ©cifiques. Nous devons Ãªtre en mesure de rÃ©pondre Ã  toutes les situations. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/wu/-w/pvwu-wguspmalhce4hxtbvhqznu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons de nombreux backends et, comme je l'ai dit, ils peuvent marcher seuls. Si cela est prÃ©sentÃ© sous la forme d'un graphique, cela se rÃ©vÃ©lera plutÃ´t dÃ©routant. Dans la vraie vie, il peut y avoir des centaines de microservices. Imaginez combien de connexions il y aura entre eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a plusieurs Ã©tapes pour plonger dans ce sujet. Je vais parler briÃ¨vement de chacun d'eux.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/nf/hq/qunfhq8cdqgbtqtmikv0maf1tpc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, convenez avec vos collÃ¨gues du backend d'un systÃ¨me de marquage de demande commun - il est plus facile de les trouver plus tard. </font><font style="vertical-align: inherit;">Ensuite, vous devez pouvoir reproduire rapidement le problÃ¨me. </font><font style="vertical-align: inherit;">Supposons qu'une erreur de paiement se soit produite - essayez de comprendre rapidement comment elle s'est produite et dans quel backend. </font><font style="vertical-align: inherit;">Stockez les journaux non seulement dans des fichiers, mais Ã©galement dans la base de donnÃ©es afin de pouvoir effectuer des agrÃ©gations. </font><font style="vertical-align: inherit;">Et, bien sÃ»r, une partie importante du processus concerne les graphiques et la surveillance. </font><font style="vertical-align: inherit;">Ensuite, dans l'ordre.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystÃ¨me d'identification des demandes unifiÃ©</font></font></h2><br>
<img src="https://habrastorage.org/webt/1z/lc/cl/1zlccllwyct_nesu28sa4kh0za0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est l'un des outils les plus simples pour comprendre ce qui se passe avec le service. Convenez avec vos collÃ¨gues que, par exemple, votre frontend gÃ©nÃ¨re une sorte de demande d'identification (la variable requestId dans l'image), puis la jette dans tous les endopoints des backends. Et le backend lui-mÃªme ne rÃ©invente rien. Il prend le requestId qui est arrivÃ© et le transmet plus loin dans les requÃªtes Ã  ses backends. En mÃªme temps, il peut spÃ©cifier son prÃ©fixe, de sorte que parmi le requestId identique, il serait possible de trouver ce backend particulier. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/qo/sk/ohqoskth2c-8o9h2btju58-tg04.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lorsque vous avalez vos journaux, puis, en vous assurant que vos journaux indiquent, par exemple, que le backend est de cinq cents, il peut y avoir deux options. Vous allez soit donner cet identifiant de demande Ã  vos collÃ¨gues et ils le regarderont dans leurs journaux, ou vous verrez par vous-mÃªme.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pq/cf/1m/pqcf1m-t3srhcoorgfwnnpohbqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous nos journaux sont marquÃ©s avec un tel identifiant afin non seulement de comprendre ce qui s'est passÃ© et Ã  quel moment, mais aussi de garder le contexte de cette demande. </font><font style="vertical-align: inherit;">Il est asynchrone, il peut par la suite ajouter quelque chose au journal. </font><font style="vertical-align: inherit;">Et si vous mordez Ã  la demande, rien de bon n'en sortira.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boucle</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour reproduire le problÃ¨me, nous utilisons l'utilitaire cURL. Il s'agit d'un utilitaire de console qui effectue des requÃªtes rÃ©seau - http et https. cURL prend en charge de nombreux autres protocoles, mais lors du dÃ©veloppement Web, il est plus facile de supposer qu'il s'agit d'un outil pour travailler avec les requÃªtes http. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/75/mr/uh/75mruhc0hnm0q7qtllafjtnz8ak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vous familiariser avec l'Ã©quipe cURL, vous pouvez vous rendre sur n'importe quel site, puis aller sur RÃ©seau et copier toute demande sous forme de cURL. Le rÃ©sultat est une si grande ligne: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jl/mn/fx/jlmnfxdobmhcqctl-uviygpzij8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
si vous essayez de le comprendre, alors il n'y a rien Ã  craindre. Essayons de le dÃ©monter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j5/88/xz/j588xz0r-jh48xp1rphfqoljlvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici une demande Ã  market.yandex.ru. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gv/6v/_d/gv6v_dz188tviqfjs5siyf9lt8e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un User-Agent a Ã©tÃ© ajoutÃ© ici, ce qui prend dÃ©jÃ  beaucoup de place.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1j/a_/sd/1ja_sdx_in4dcwudr64xjdezf98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, le reste est constituÃ© de cookies. Il y en a beaucoup dans le code Yandex. Sous forme sÃ©rialisÃ©e, ils ont un look trÃ¨s redoutable. En fait, il n'y a rien d'autre Ã  part eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ quoi sert cURL? Si vous l'avez copiÃ© sur vous-mÃªme et l'avez exÃ©cutÃ©, vous avez vu la mÃªme page market.yandex.ru que moi - seul l'ordinateur sur lequel il s'exÃ©cutait serait diffÃ©rent. Bien sÃ»r, certains effets secondaires pourraient donner des diffÃ©rences dans les adresses IP, mais en gÃ©nÃ©ral, ce seraient les mÃªmes demandes. Nous reproduirions le mÃªme scÃ©nario. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lh/gd/sg/lhgdsguqkolxs1vrjusxnshjnmg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas inventer de telles requÃªtes cURL Ã  chaque fois, vous pouvez utiliser le format-curl npm-package.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/in/fk/yjinfkjpv0bgzbhfmi8shr7qyno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il prend tous les paramÃ¨tres de requÃªte que la fonction prend habituellement - c'est-Ã -dire, dans ce cas, uniquement les en-tÃªtes et l'URL. </font><font style="vertical-align: inherit;">Mais il sait aussi interroger, corps, etc. Et la sortie est juste une chaÃ®ne avec une requÃªte cURL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/4l/h8/xx4lh8tvvwmvzw1-aflbg7ophvq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, tous nos journaux dans l'environnement de dÃ©veloppement contiennent Ã©galement des demandes cURL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/iq/f6/wuiqf6p5bzxdgiom430q364yuw4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons mÃªme enregistrÃ© les demandes cURL de backend directement dans le navigateur pour voir immÃ©diatement comment nous allons Ã  nos backends sans regarder la console du navigateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0o/l3/ay/0ol3ay03w7toau9tyabduyiu1-m.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veuillez noter que les demandes cURL impliquent le transfert de cookies de session - c'est mauvais. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous m'avez rejetÃ© votre demande cURL sur market.yandex.ru, je pourrais entrer dans votre marchÃ© et tout autre service Yandex sous votre identifiant. </font><font style="vertical-align: inherit;">Par consÃ©quent, nous ne stockons ces demandes nulle part et nous les enregistrons uniquement dans des bancs de test pour nous-mÃªmes - ces donnÃ©es ne peuvent pas Ãªtre divulguÃ©es.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clickhouse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, je vais parler des journaux structurÃ©s. Ici, je garderai Ã  l'esprit la base de donnÃ©es ClickHouse spÃ©cifique, mais vous pouvez en choisir une. ClickHouse est un SGBD en colonnes, il est plus pratique de sÃ©lectionner parmi une Ã©norme quantitÃ© de donnÃ©es et de prendre de gros morceaux de donnÃ©es. C'est bien parce que vous pouvez y sauvegarder une grande partie du journal et ensuite, par exemple, faire une sorte d'agrÃ©gation d'un milliard d'enregistrements. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rx/yq/hx/rxyqhxvdpvjetfh9jmkw4hfkwvu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, l'exemple de sÃ©lection ClickHouse est du SQL brut. Ici, nous montrons le nombre de demandes de codes d'Ã©tat pour aujourd'hui. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oi/5v/je/oi5vje-sgh204x5-w1fjywdjyk8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consÃ©quence, nous aurons 180 mille deux cent sept cinq cents, et les codes de statut restants, par exemple, ne nous intÃ©ressent pas. Mais comment pouvons-nous utiliser cela de faÃ§on intÃ©ressante?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/r6/gp/edr6gpqetfffuhjo6uc2hwznb4s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons dire que le rapport de deux cents au rapport du nombre total de rÃ©ponses est l'indicateur de niveau de service, qui rÃ©pond Ã  la question de savoir comment notre application fonctionne en termes de codes de statut. Bien que simple, il parle dÃ©jÃ  de quelque chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y3/vr/vq/y3vrvqez5ghx9umed2htpzgeurm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base de notre indicateur, nous pouvons proposer le premier SLI, c'est-Ã -dire, par exemple, que 99% de nos demandes devraient Ãªtre OK. Et ici, nous pouvons comparer que nous avons effectuÃ© notre SLI. S'ils ne l'avaient pas terminÃ©, nous aurions pu essayer de distinguer soit certaines derniÃ¨res demandes qui auraient Ã©tÃ© cinq cents, soit tout simplement des Ã©lÃ©ments critiques. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hf/0i/vf/hf0ivf6posnoebmrwayqz4wni5c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, les erreurs de paiement sont critiques pour nous, mais dans ce cas, elles retourneront zÃ©ro - c'est une chance :) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/0i/yh/5c0iyhrkfdxbgd0psywb7jvv8si.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment vous assurer que vos journaux sont sous cette forme pratique et peuvent Ãªtre pris via SQL?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7b/7m/hx/7b7mhxhtlyos6qbomnnm2p6xcko.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est un sujet pour un gros rapport sÃ©parÃ©, et tout dÃ©pend de votre infrastructure. </font><font style="vertical-align: inherit;">Mais il semble qu'il y ait deux faÃ§ons. </font><font style="vertical-align: inherit;">PremiÃ¨rement: soumettez les mÃ©tadonnÃ©es directement Ã  l'exÃ©cution, directement Ã  la base de donnÃ©es. </font><font style="vertical-align: inherit;">Nous le faisons diffÃ©remment, dans la deuxiÃ¨me maniÃ¨re: nous suivons le fichier journal et soumettons des morceaux soit dans la base de donnÃ©es ou dans un endroit intermÃ©diaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela fonctionne pour nous plutÃ´t en plusieurs couches - nous envoyons des journaux d'une instance spÃ©cifique Ã  un serveur de stockage distant de ces journaux.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande de trace</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas de concept de Â«traÃ§age des requÃªtesÂ». Ce terme a Ã©tÃ© inventÃ© par Google. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/au/mc/cf/aumccfspkkp7eieqgesgk8awnn4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous recherchez sur Internet le Â«traÃ§age des requÃªtesÂ», vous verrez la commande traceroute. C'est peut-Ãªtre similaire au suivi des requÃªtes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w0/no/pv/w0nopvgiuihtlc2x8b7fdist7lm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a mÃªme un programme console, et ici je l'ai exÃ©cutÃ© pour le site bringly.ru (un service que nous avons dÃ©veloppÃ© au printemps dernier). Cela aide Ã  comprendre quel type de machines et de serveurs la requÃªte traverse avant d'arriver Ã  l'Ã©quilibreur, qui rÃ©pondra soit par la mise en page, soit par autre chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9g/n9/ax/9gn9axljm2rabdxvowa3p8gsjec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici notre Ã©quilibreur. Par traÃ§age de requÃªtes, nous ne voulons pas dire cela, mais tout ce qui se passe Ã  l'intÃ©rieur de notre Ã©quilibreur - comment la demande se dÃ©roule plus loin dans notre application node.js.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/rh/rr/fhrhrr6j0ujdnvdivmn0dwobnlc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons cela sous la forme d'une chronologie, oÃ¹ l'heure horizontale est affichÃ©e, et la sÃ©quence verticale des demandes. Dans ce cas, nous avons une demande Ã  la fiche produit, oÃ¹ l'on peut voir qu'il s'agit d'une demande au backend de notre autorisation. AprÃ¨s sa dÃ©cision, trois longues files d'attente sont allÃ©es - il s'agit d'une demande Ã  notre backend principal pour un panier, une carte de produit et des produits similaires. Nous avons donc une trace. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m8/sl/4a/m8sl4atplnknyq_5wefl8b2wgw0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous voyez la mÃªme demande d'autorisation, puis le backend est parti. Dans ce cas, le backend ne se comporte pas de maniÃ¨re trÃ¨s optimale, car il a de nombreuses requÃªtes consÃ©cutives sur sa base de donnÃ©es. Probablement, une telle requÃªte pourrait Ãªtre optimisÃ©e.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/ah/bz/ruahbzfg8qzvgzi1s2gbexvm0og.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici un exemple de trace, lorsque nous ne sommes allÃ©s dans aucun backend, mais avons immÃ©diatement donnÃ© le statut 500. Comment une telle trace nous est-elle utile? </font><font style="vertical-align: inherit;">Nous n'avons pas Ã  dÃ©ranger nos collÃ¨gues. </font><font style="vertical-align: inherit;">Nous avons l'identifiant de cette demande, nous pouvons donc regarder nous-mÃªmes dans les journaux et comprendre ce qui se passe. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/nm/0g/wqnm0gw9rgznoe7rswqshty_u1a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici la situation inverse. </font><font style="vertical-align: inherit;">Backend a dit que quelque chose n'allait pas et a en mÃªme temps Ã©crit dans les mÃ©ta-informations ce qui s'est exactement passÃ© - une sorte de trace de pile est apparue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uc/lb/ck/uclbck5ju2ri2l2qyhjxkwnvxpk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment se faire le mÃªme outil? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La chose la plus importante ici est la base de donnÃ©es. </font><font style="vertical-align: inherit;">Si vous avez le plus simple Â«INSERT INTOÂ» dans la base de donnÃ©es de certaines actions avec le service, plus tard, vous pouvez au moins utiliser SQL pour trouver les Ã©vÃ©nements nÃ©cessaires. </font><font style="vertical-align: inherit;">Et si nÃ©cessaire, vous pouvez crÃ©er une interface pour cela.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphiques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est un sujet trÃ¨s intÃ©ressant, je ne m'y attarderai pas en dÃ©tail aujourd'hui, bien sÃ»r, :) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mo/tc/5p/motc5p8irltrzn7aqlsffemkdza.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons de la journalisation. </font><font style="vertical-align: inherit;">Nous avons beaucoup de graphiques, nous les regardons lorsque nous dÃ©ployons quelque chose - et dans les temps, il y a un tel bruit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lo/vn/ku/lovnkuij1s2d39nszmdwvwsde78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les graphiques aident Ã  voir visuellement que quelque chose ne va pas. </font><font style="vertical-align: inherit;">Et puis vous devez toujours regarder les journaux et comprendre ce qui ne va pas avec eux. </font><font style="vertical-align: inherit;">Dans ce cas, la montÃ©e subite immÃ©diatement aprÃ¨s la libÃ©ration signifie au moins qu'une telle libÃ©ration doit Ãªtre annulÃ©e immÃ©diatement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surveillance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une partie encore plus importante et un degrÃ© plus Ã©levÃ© d'immersion dans ce sujet est la surveillance. Par surveillance, je comprends, d'une part, la surveillance automatique des graphiques et, d'autre part, les rÃ¨gles automatisÃ©es de surveillance de quelque chose. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wn/1f/r9/wn1fr9r0fnzl-r4kbkgbj3pwz6w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous surveillons le rapport de cinq cents au nombre total de rÃ©ponses par minute. Nous surveillons Ã©galement quatre cents, la prÃ©sence d'une charge sur le service, en vÃ©rifiant le bouton de contrÃ´le de santÃ©, qui tire le bouton ping de chacun des backends, etc.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/be/ts/j0betsujurv192dkwhrvk_cvegk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, nous avons des tableaux de bord de surveillance que nous incluons sur les Ã©crans Ã  proximitÃ© des postes de travail. </font><font style="vertical-align: inherit;">On voit donc immÃ©diatement lequel de la surveillance "rougir". </font><font style="vertical-align: inherit;">Par exemple, ici c'est l'un des principaux, oÃ¹ le frontend et notre backend principal sont visibles. </font><font style="vertical-align: inherit;">Ici, vous pouvez voir que certains contrÃ´les s'allument sur le backend. </font><font style="vertical-align: inherit;">Cela signifie qu'Ã  ce moment, la personne responsable de ce service recevra un message sur Telegram, ou peut-Ãªtre mÃªme l'appellera - cela dÃ©pend des paramÃ¨tres de surveillance.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un seul requestId vous aidera Ã  trouver plus facilement les problÃ¨mes dans un service composÃ© de plusieurs applications. </font><font style="vertical-align: inherit;">La cURL correcte vous permettra de reproduire plus prÃ©cisÃ©ment les problÃ¨mes et de voir comment vous-mÃªme, par exemple, envoyer des donnÃ©es au backend. </font><font style="vertical-align: inherit;">Les journaux structurÃ©s vous permettront de crÃ©er SLI, et ils sont plus pratiques Ã  utiliser que les journaux de texte standard. </font><font style="vertical-align: inherit;">Et n'oubliez pas de suivre les graphiques et d'effectuer un suivi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je recommande de lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le livre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Site Reliability Engineering de Google si vous Ãªtes intÃ©ressÃ© par les infrastructures.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489038/index.html">Le livre "Java Concurrency in Practice"</a></li>
<li><a href="../fr489040/index.html">Contact Center AI: un tiers dans une conversation est trÃ¨s bien</a></li>
<li><a href="../fr489042/index.html">Grande rÃ©ouverture de la boutique: chargement de donnÃ©es dans Android Ã  l'aide de coroutine</a></li>
<li><a href="../fr489044/index.html">Physique du texte. Partie 1. Symboles</a></li>
<li><a href="../fr489046/index.html">GAZ66 Monster Truck sans conducteur 1/16</a></li>
<li><a href="../fr489050/index.html">Windows vs Sysmon</a></li>
<li><a href="../fr489058/index.html">Ensembles de rÃ©seaux de neurones avec PyTorch et Sklearn</a></li>
<li><a href="../fr489060/index.html">Analyse: quelle est la diffÃ©rence entre les investissements Ã  haut risque et les investissements Ã  faible risque</a></li>
<li><a href="../fr489062/index.html">Incroyable performances parallÃ¨les d'E / S Apache Parquet en Python</a></li>
<li><a href="../fr489068/index.html">ImmortalitÃ© numÃ©rique - une approche d'ingÃ©nierie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>