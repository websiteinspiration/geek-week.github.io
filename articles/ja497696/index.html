<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏻 🚢 🤭 企業を攻撃するRyukランサムウェアはどのように 🥓 🚵🏻 👨‍👩‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ryukは、ここ数年で最もよく知られているランサムウェアオプションの1つです。彼は2018年の夏に最初に登場して以来、特にビジネス環境において、彼の攻撃の主なターゲットである犠牲者の印象的なリストをまとめました。
 
 1.一般的な情報
 このドキュメントには、Ryukランサムウェアオプションの分析...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>企業を攻撃するRyukランサムウェアはどのように</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryukは、ここ数年で最もよく知られているランサムウェアオプションの1つです。</font><font style="vertical-align: inherit;">彼は2018年の夏に最初に登場して以来</font><font style="vertical-align: inherit;">、特にビジネス環境において、彼の攻撃の主なターゲットで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある犠牲者の印象的なリストを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まとめまし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.一般的な情報</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このドキュメントには、Ryukランサムウェアオプションの分析と、マルウェアをシステムにダウンロードするためのブートローダーが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryukランサムウェアは、2018年の夏に初めて登場しました。 Ryukと他のランサムウェアの違いの1つは、企業環境を攻撃することを目的としていることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2019年半ばに、この犯罪者の助けを借りて、サイバー犯罪グループが多数のスペイン企業を攻撃しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図</font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1：Ryukランサムウェア攻撃に関するEl Confidencialからの抜粋[1] </font></i><i><font style="vertical-align: inherit;">2：Ryukランサムウェアによる攻撃に関するElPaísからの抜粋[2]</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
今年、Ryukはさまざまな国の多数の企業を攻撃しました。下の図からわかるように、ドイツ、中国、アルジェリア、インドが最も被害を受けました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サイバー攻撃の数を比較すると、数百万人のユーザーがリュークの影響を受け、膨大な量のデータが侵害され、深刻な経済的被害をもたらしていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 3：Ryukのグローバルな活動の図。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 4：リューク</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イチジクの</font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">影響を最も強く受けている16か国</font></i><i><font style="vertical-align: inherit;">5：Ryukランサムウェアによって攻撃されたユーザーの数（百万単位）</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このような脅威の操作の通常の原則によると、暗号化後のこのランサムウェアは、暗号化されたファイルへのアクセスを復元するために、指定されたアドレスにビットコインで支払う必要がある身代金通知を被害者に示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマルウェアは、最初に出現してから変更されています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このドキュメントで分析されたこの脅威の変種は、2020年1月に攻撃を仕掛けようとしたときに発見されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマルウェアは複雑であるため、多くの場合、APTグループとも呼ばれる組織化されたサイバー犯罪者に起因します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リュークのコードの一部は、よく知られている別のHermes暗号技術者のコードと構造に非常によく似ており、それらには多数の同一の機能があります。そのため、リュークは当初、北朝鮮のグループであるラザロと関係があり、当時はエルメスランサムウェアの背後にあると疑われていました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、CrowdStrikeのFalcon Xは、リュークが実際にはWIZARD SPIDERによって作成されたと述べました[4]。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この仮定を裏付ける証拠がいくつかあります。最初に、このランサムウェアは、有名なロシアのマルウェア市場であり、以前はいくつかのロシアのAPTグループに関連付けられていた、exploit.in Webサイトで宣伝されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この事実は、リュックがラザロのAPTグループによって開発され得るという理論を排除している。これは、グループの行動方法と一致しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、リュークは、ロシア語、ウクライナ語、ベラルーシ語のシステムでは機能しない暗号化装置としてもてはやされました。この動作は、Ryukの一部のバージョンにある機能によって決定されます。この機能では、この暗号化機能が実行されているシステムの言語をチェックし、システムにロシア語、ウクライナ語、またはベラルーシ語が含まれている場合はその動作を停止します。最後に、WIZARD SPIDERグループによってハッキングされたマシンのエキスパート分析を行ったところ、ヘルメス暗号の変種としてリュークの開発に使用されたと思われるいくつかの「アーティファクト」が発見されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一方、専門家のガブリエラニコラオとルチアーノマーティンスは、暗号技術者はCryptoTech APTグループによって開発された可能性があると示唆しました[5]。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、リュークの登場の数か月前に、このグループがHermesランサムウェアの新バージョンを開発したのと同じサイトのフォーラムに情報を投稿したという事実に基づいています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのフォーラムユーザーは、CryptoTechが本当にRyukを作成したのか疑問に思っています。</font><font style="vertical-align: inherit;">その後、このグループは自らを擁護し、この暗号化機能を100％開発したという証拠があると述べました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.特徴</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブートローダーから始めます。そのタスクは、それが配置されているシステムを特定することです。これにより、Ryuk暗号化プログラムの「正しい」バージョンを実行できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようにブートローダのハッシュは次のとおりです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このブートローダの特徴の一つは、それがどのようなデータが含まれていないということです-このマルウェアの作成者は、その中に情報を含めていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正当なアプリケーションを起動しているとユーザーに思わせるために、誤ったデータが含まれている場合があります。</font><font style="vertical-align: inherit;">ただし、後で説明するように、感染がユーザーとの対話を伴わない場合（この暗号化装置の場合のように）、攻撃者はメタデータを使用する必要があるとは見なしません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">6：</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
サンプル</font><i><font style="vertical-align: inherit;">メタデータサンプル</font></i><font style="vertical-align: inherit;">は32ビット形式でコンパイルされているため、32ビットシステムと64ビットシステムの両方で実行できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.浸透ベクトル</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryukをダウンロードして起動するサンプルは、リモート接続を介してシステムに入り、事前のRDP攻撃のおかげでアクセスパラメータが取得されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 7：レジストリへの</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
攻撃攻撃者がシステムにリモートでログインすることに成功しました。その後、サンプルを使用して実行可能ファイルを作成しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この実行可能ファイルは、起動前にウイルス対策ソリューションによってブロックされました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 8：サンプルのブロック</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図9：サンプルロック</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
悪意のあるファイルがブロックされると、攻撃者は暗号化されたバージョンの実行可能ファイルをダウンロードしようとしましたが、これもブロックされました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 10：攻撃者が実行しようとしたサンプルのセット</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
最後に、暗号化されたコンソールを介して別の悪意のあるファイルをダウンロードしようとしました</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウイルス対策保護をバイパスするためのPowerShell。</font><font style="vertical-align: inherit;">しかし、彼もブロックされました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">11：悪意のあるコンテンツがブロックされたPowerShell </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図 </font><font style="vertical-align: inherit;">12：悪意のあるコンテンツがブロックされたPowerShell</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ブートローダー</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行されると、ReadMeファイルを</font><font style="vertical-align: inherit;">Ryukで一般的な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％temp％</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダーに書き込みます</font><font style="vertical-align: inherit;">。このファイル-身代金要求、マルウェアのこの家族の中ではかなり一般的である電子メールアドレスprotonmailドメイン、含む：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 13：償還要件</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ブートローダーの実行中に、ランダムな名前でいくつかの実行可能ファイルを起動することがわかります。それらは非表示の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダーに保存されますが</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「非表示のファイルとフォルダーを表示</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font><b><font style="vertical-align: inherit;">」</font></b><font style="vertical-align: inherit;">オプションがオペレーティングシステム</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">アクティブでない場合</font><font style="vertical-align: inherit;">、それらは非表示のままになります。さらに、これらのファイルは、32ビットの親ファイルとは異なり、64ビットです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 14：サンプルによって起動された実行可能ファイル</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
上の図に示されているように、Ryukはicacls.exeを起動します。これは、すべてのACL（アクセス制御リスト）の変更に使用され、アクセスを保証し、フラグを変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エラー（/ C）に関係なく、メッセージ（/ Q）を表示せずに、すべてのユーザーの下でデバイス（/ T）上のすべてのファイルにフルアクセスできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。図15：サンプルによって起動されたicacls.exeの実行オプションRyuk</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
が実行中のWindowsのバージョンを確認することに注意することが重要です。これを行うには、</font><b><font style="vertical-align: inherit;">GetVersionExW</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用してバージョンを確認し</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このバージョン</font><font style="vertical-align: inherit;">では、</font><b><font style="vertical-align: inherit;">lpVersionInformation</font></b><font style="vertical-align: inherit;">フラグの値を確認します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windowsの現在のバージョンが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以降かどうかを示し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows XP以降のバージョンを実行しているかどうかに応じて、ブートローダーはローカルユーザーフォルダー（この場合は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Public％</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダー）に書き込みます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 17：オペレーティングシステムのバージョンの確認</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
記録されたファイルはRyukです。次にそれを起動し、自身のアドレスをパラメーターとして渡します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 18：ShellExecuteによるRyuk</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font><i><font style="vertical-align: inherit;">実行Ryukが</font></i><font style="vertical-align: inherit;">最初に行うことは、入力パラメーターを取得することです。今回は、2つの入力パラメーター（実行可能ファイル自体とドロッパーアドレス）があり、これらは独自のトレースを削除するために使用されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 19：プロセスの作成</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、彼が実行可能ファイルを起動するとすぐに彼は自分自身を削除するため、実行されたフォルダーに自分の存在の痕跡が残らないことがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">20：ファイルの削除</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1プレゼンス</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryukは、他のマルウェアと同様に、システムにできるだけ長く留まることを試みます。上記のように、この目標を達成する1つの方法は、実行可能ファイルを密かに作成して実行することです。このため、最も一般的な方法は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentVersion \ Run</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レジストリキーを変更すること</font><font style="vertical-align: inherit;">です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、この目的のために、最初の実行可能ファイル</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
（ファイル名はランダムに生成されます）が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exeを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起動することが</font><b><font style="vertical-align: inherit;">わかり</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 21：VWjRF.exeファイルの実行</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、</font><font style="vertical-align: inherit;">" </font><b><font style="vertical-align: inherit;">svchos</font></b><font style="vertical-align: inherit;"> "という名前の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドが入力さ</font><font style="vertical-align: inherit;">れ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「したがって、いつでもレジストリキーを確認したい場合、この名前とsvchostの類似性を考えると、この変更に気付くことは簡単ではありません。このキーのおかげで、リュークはシステム内での存在を確認します。システムがまだ感染していない場合その後、システムを再起動すると、実行可能ファイルが再試行し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。図22：サンプルはレジストリキーの存在を</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
確認しますこの実行可能ファイルが2つのサービスを停止していることも確認できます：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "。オーディオ、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図23：サンプルはシステムオーディオ</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
と</font><b><font style="vertical-align: inherit;">samssサービス</font></b><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止します</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これはアカウント管理サービスです。これら2つのサービスの停止は、リュークの特徴です。システムはSIEMシステムに接続されている場合この場合、暗号化は、送信を停止しようとする</font><font style="vertical-align: inherit;">任意の警告を</font><font style="vertical-align: inherit;">する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。したがって、リュークが実行された後、一部のSAMサービスが作業を正しく開始できなくなるため、彼は次のステップを守ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 24：サンプルはSamssサービスを停止します</font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2特権</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一般的に、リュークはネットワーク内の水平移動で開始するか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの別の悪意のあるプログラムによって起動され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事前に、実装プロセスの前置きとして、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセスを実行することがわかります。つまり</font><font style="vertical-align: inherit;">、アクセストークンのセキュリティコンテンツがストリームに転送され、そこで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してすぐに受信されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 25：ImpersonateSelfの呼び出し</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、アクセストークンをストリームに関連付けます。また、フラグの1つが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であることも</font><b><font style="vertical-align: inherit;">わかります</font></b><font style="vertical-align: inherit;">。これは、ストリームが持つアクセスを制御するために使用できます。この場合、edxが受け取る値は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font><b><font style="vertical-align: inherit;">TOKEN_WRITEで</font></b><font style="vertical-align: inherit;">なければなり</font><font style="vertical-align: inherit;">ませ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ん</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 26：ストリームトークンの作成次</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に使用します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ストリームに関するデバッグデバッグ権限を取得するための呼び出しを行います。その結果、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を指定することにより</font><font style="vertical-align: inherit;">、必要なプロセスにアクセスできます。さて、暗号化器はすでに準備されたストリームを持っているので、最終段階に進むだけです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 27：SeDebugPrivilegeの呼び出しと権限の昇格機能</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一方には、LookupPrivilegeValueWがあります。これは、発生させたい特権に関する必要な情報を提供します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 28：エスカレーションの特権に関する情報の要求</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一方、</font><font style="vertical-align: inherit;">ストリームに必要な権限を取得できる</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります。この場合、最も重要なのは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewStateです。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのフラグは特権を付与します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。図29：トークンの権限の設定</font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3配置</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このセクションでは、このレポートで前述した配置プロセスをサンプルが実行する方法を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装プロセスとエスカレーションの主な目的は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シャドウコピーに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセスすることです</font><font style="vertical-align: inherit;">。これを行うには、ローカルユーザーよりも高い権限でストリームを操作する必要があります。そのようなより高い権限を取得するとすぐに、オペレーティングシステムの以前の復元ポイントに戻れないようにするために、コピーを削除し、他のプロセスに変更を加えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このタイプのマルウェアの場合は通常そうであるように、</font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot</font></b><font style="vertical-align: inherit;">を使用して実装を完了します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なので、現在実行中のプロセスのスナップショットを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、</font><b><font style="vertical-align: inherit;">OpenProcess</font></b><font style="vertical-align: inherit;">を使用してこれらのプロセスへのアクセスを</font><b><font style="vertical-align: inherit;">試み</font></b><font style="vertical-align: inherit;">ます。彼はプロセスへのアクセスを取得するとすぐに、プロセスパラメータを取得するための情報を含むトークンも開きます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
図</font><i><font style="vertical-align: inherit;">30：コンピューターからのプロセスの受信</font></i><font style="vertical-align: inherit;"> CreateToolhelp32Snapshotを使用して、ルーチン140002D9Cで実行中のプロセスのリストを受信する方法を動的に確認できます。それらを受け取った後、彼はリストを確認し、OpenProcessを使用して、プロセスが実行可能になるまで1つずつプロセスを開こうとします。この場合、彼が最初に開けたプロセスは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「taskhost.exe」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 31：プロセスを取得するためのプロシージャの動的実行</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、彼がプロセスのトークンを読み取ることが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">わかり</font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">ます。</font></i><font style="vertical-align: inherit;">これは</font><font style="vertical-align: inherit;">、「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図の</font></font></i><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">OpenProcessToken </font></b><i><font style="vertical-align: inherit;">です。 32：プロセストークン情報の読み取り</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
また、埋め込まれるプロセスが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe、lsaas.exeで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ないこと</font><b><font style="vertical-align: inherit;">、</font></b><font style="vertical-align: inherit;">または</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT権限の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セットがある</font><font style="vertical-align: inherit;">ことも確認し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。図33：除外され</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たプロセス</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。140002D9Cの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセストークン情報を使用して最初にチェックする方法を動的に確認して、プロセスの</font><font style="vertical-align: inherit;">実行に使用される権限を持つアカウントが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アカウントであるかどうかを確認できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 34：NT AUTHORITYの確認</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
そしてその後、プロシージャの外で、それが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe、explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ではないことを確認し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 35：NT AUTHORITYの確認</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プロセスのスナップショットを取り、プロセスを開いて、それらのいずれもが除外されていないことを確認した後、メモリに実装されるプロセスを書き留める準備が整いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、まずメモリ内の領域を予約し（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、</font><font style="vertical-align: inherit;">その領域に</font><font style="vertical-align: inherit;">書き込み（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、ストリームを作成します（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。これらの関数を操作するために、彼は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して以前に取得した、選択されたプロセスのPIDを使用し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 36：埋め込みコード</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ここでは、プロセスPIDを使用して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を呼び出す方法を動的に観察できます</font><b><font style="vertical-align: inherit;">。</font></b></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。図37：VirtualAllocEx </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4暗号化の</font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">呼び出し</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このセクションでは、このサンプルの暗号化に関連する部分を見ていきます。次の図</font><font style="vertical-align: inherit;">では、暗号化手順を実行する</font><font style="vertical-align: inherit;">「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」と「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">という2つのルーチンを確認でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 38：暗号化手順</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
最初に、インポート、DLL、コマンド、ファイル、CSPなど、必要なものすべてを難読化解除するために後で使用される文字列をロードする方法を確認できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 39：解読チェーン</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の図は、R4レジスタ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で解読される最初のインポートを示してい</font><font style="vertical-align: inherit;">ます。これは後で必要なDLLをロードするために使用されます。また、レジスタR12に別の行が表示されています。これは、解読を実行するために前の行と一緒に使用されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 40：動的解読：</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
バックアップ、復元ポイント、およびセーフブートモードを無効にするために後で実行するコマンドを引き続きロードします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 41：コマンドのダウンロード</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows.bat、run.sct</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.batの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3つのファイルをドロップする場所をロードします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 42：ファイルの場所</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの3つのファイルは、各場所の特権を確認するために使用されます。必要な権限が利用できない場合、Ryukは実行を停止します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのファイルに対応する行をロードし続けます。最初の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、ファイルの復元に必要な情報が含まれています。 2番目の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、RSA公開鍵が含まれています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 43：文字列DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
3番目に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、暗号化を実行する次のルーチンで使用される暗号化されたキーが含まれます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 44：一意のIDは文字列を削除しない</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
最後に、必要なライブラリと、必要なインポートおよびCSP（</font><b><font style="vertical-align: inherit;">Microsoft Enhanced RSA）を</font></b><font style="vertical-align: inherit;">ロードします</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AES暗号プロバイダー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 45：ライブラリのダウンロード</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべての解読が完了した後、彼は暗号化に必要なアクションの実行に進みます。すべての論理ドライブを反復処理し、前のサブルーチンでロードされたものを実行し、システム内の存在を増やし、RyukReadMe.htmlファイルをドロップし、暗号化し、反復します。すべてのネットワークドライブ、検出されたデバイスとその暗号化に切り替えます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」</font><font style="vertical-align: inherit;">をダウンロードし</font><font style="vertical-align: inherit;">、RSA公開鍵を書き込む</font><font style="vertical-align: inherit;">ことから始まり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 46：暗号化の準備</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してすべての論理ドライブを取得し</font><font style="vertical-align: inherit;">、すべてのバックアップ、リカバリポイント、およびセーフブートモードを無効にします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 47：回復ツールの非アクティブ化</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
その後、上記で見たように、彼はシステムでの存在を強化し、最初の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMPに</font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">書き込み</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
図</font><i><font style="vertical-align: inherit;">48：買い戻し通知の発行。</font></i><font style="vertical-align: inherit;">次の図では、ファイルの作成、コンテンツのダウンロード、書き込みの方法を示してい</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。 49：ファイルのコンテンツのダウンロードと記録</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべてのデバイスで同じアクションを実行できるようにするために、</font><font style="vertical-align: inherit;">上記で示したように、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」を</font><font style="vertical-align: inherit;">使用し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。 50：icalcls.exeの使用</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後に、「* .exe」、「* .dll」ファイル、システムファイル、および暗号化されたホワイトリストとして指定されたその他の場所を除いて、ファイルの暗号化を開始します。</font><font style="vertical-align: inherit;">このために、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（AESおよびRSAの使用が示されている場合）、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey、CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの</font><b><font style="vertical-align: inherit;">インポート</font></b><font style="vertical-align: inherit;">を使用します。</font><font style="vertical-align: inherit;">WNetEnumResourceWを使用して検出されたネットワークデバイスへの影響を拡大し、暗号化する試みも行われています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図。</font><font style="vertical-align: inherit;">51：システムファイルの暗号化</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.インポートと関連フラグ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、サンプルで使用される最も関連性の高いインポートとフラグをリストした表です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. IOC</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタートメニュー\プログラム\スタートアップ\ start.bat AppData \ローミング\ Microsoft \ Windows \スタート</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メニュー\ ProgramsStartup \ start.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PandaLabsアンチウイルスラボのエキスパートがまとめたRyukランサムウェアのテクニカルレポート。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.リファレンス</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.「Everis y Prisa Radio sufren un grave ciberataque que secuestra sus sistemas。」Https：// www。 elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /、Publicada el 04/11/2019。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.「Un virus de origen ruso ataca a Importantes empresasespañolas」。Https：//elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html、Publicada el 04/11/2019。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.「VB2019論文：死神の復讐：Ryukマルウェアの長い尾」Https://securelist.com/ story-of-the-year-2019-cities-under-ransomware-siege / 95456 /、Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4.「Ryukによるビッグゲームハンティング：もう1つのLucrativebasedランサムウェア。」Https：// www。 cloudstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/、Publicada el 01/10/2019。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.「VB2019論文：死神の復讐：Ryukマルウェアの長い尾」Https：// www。</font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-revenge-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497680/index.html">電報が流れているようです</a></li>
<li><a href="../ja497682/index.html">Pavel Klemenkov、NVIDIA：データサイエンティストが実行できることと、彼が実行できるようにする必要があることの間のギャップを狭めようとしています。</a></li>
<li><a href="../ja497684/index.html">誇大広告曲線：どのITテクノロジーがピークに達していて、何が安定した需要を維持するか</a></li>
<li><a href="../ja497686/index.html">細菌を殺すインプラント材料</a></li>
<li><a href="../ja497688/index.html">Kubernetesイブニングスクールの仕組み</a></li>
<li><a href="../ja497700/index.html">4月17日からのバッキングとDevOps、セキュリティ、ロボットに関する毎週のオンラインmitap</a></li>
<li><a href="../ja497702/index.html">2020年に注目すべきデータストレージの5つのトレンド</a></li>
<li><a href="../ja497708/index.html">4月と5月に開催される一連の富士通ウェビナーにご参加ください</a></li>
<li><a href="../ja497714/index.html">macOSのプロセスとカーネル拡張を保護する方法</a></li>
<li><a href="../ja497724/index.html">PythonでWebアプリを公開するためのサーバーの準備</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>