<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå† üôåüèæ üë¥üèæ Automatic garden watering system for Home Assistant, ESP8266 and MiFlora ü§ü üâê ü•ì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago my family had a house with a small garden in a very warm and arid place, and we faced the problem of regular watering. 
 
 I wanted the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Automatic garden watering system for Home Assistant, ESP8266 and MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some time ago my family had a house with a small garden in a very warm and arid place, and we faced the problem of regular watering. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I wanted the irrigation system to be automatic, while choosing it I had to take into account the following conditions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> very expensive water that must be saved in all available ways </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> different plants in the garden for moisture requirements, from succulents to moisture-loving</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the need for fully autonomous watering during the absence of people in the house, preferably with the possibility of remote control </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arid climate that does not forgive irrigation errors</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After evaluating the ready-made solutions that were found on local DIY networks and on Amazon and reading reviews about their reliability (usually not the highest), we decided to try to do something on our own. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disclaimer: The author is not an IT specialist, and does not claim to be a professional knowledge of the topic. </font><font style="vertical-align: inherit;">The level of project execution is a hobby. </font><font style="vertical-align: inherit;">The author is well aware of the level of his knowledge in programming and electronics and will greatly appreciate suggestions for improving and optimizing the solutions used.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Circuit diagram</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The garden was divided into 4 irrigation zones, each of them is equipped with an individual soil moisture sensor and can be watered according to an individual schedule and a different amount of water. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the ground, PND-pipes of drip irrigation with perforation are laid, which are connected to pipes converging in the water-collecting unit and connected through the electromagnetic valves to the water supply. </font><font style="vertical-align: inherit;">The valves are controlled by relays connected to the ESP8266 (Sonoff 4Ch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Watering is carried out by timers, at night, to increase the amount of water that is absorbed into the ground and will not be evaporated by the sun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the scheduled watering time, compliance with several conditions is checked:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soil moisture below a predetermined value </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> there are no predicted precipitation in a large enough amount for the next 2 days </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">water limit for irrigation set for this line is not exceeded</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Used equipment</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with HassIO installed (already had) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an ESPHome firmware, acting as a bluetooth gateway for MiFlora and receiving data from wired humidity sensors. </font><font style="vertical-align: inherit;">Located in the garden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wired moisture sensors </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capacitive Soil Moisture Sensor v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which measure humidity in the watering zones closest to the ESP32 installation site. MiFlora </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sensors are</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> connected to the ESP32 via BLE, which measure moisture in remote watering zones. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , stitched with ESPHome, is located in the water intake unit, where pipes from all watering zones come </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 Normally-closed solenoid valves for 220V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">located in the water stand and connected to the Sonoff 4Ch. Open the water supply for irrigation. A normally-closed model was chosen so that the probability of ‚Äúflooding‚Äù in the event of any failure of the electrics and electronics was minimized, and in order to minimize the number of required relay outputs. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pulsed water</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> meter at the entrance to the irrigation system in the water intake unit and connected to the Sonoff 4ch. Allowed to fully transfer water flow data to Home Asssistant and implement the irrigation functionality with a given amount. It turned out to be very successful that on this version of sonoff the contacts for firmware were already soldered and even there was one free GPIO02 - a pulse counter was hung on it.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It looks like a collector with installed valves and a water meter. </font><font style="vertical-align: inherit;">The controller (sonoff 4Ch) did not get into the frame, it is installed at a distance of half a meter in the IP65 shield</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESPHome and Home Assistant Settings</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capacitive Soil Moisture Sensor v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pulse Water Meter</font></font></b><div class="spoiler_text">   ¬´¬ª,          (   ).       ‚Äî      ,   ,        (  ‚Äî  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   ¬´¬ª  ).      ‚Äî  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      ‚Äî    ,    ¬´¬ª.       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MiFlora Sensor</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          ‚Äî , ,   ¬´¬ª .   ‚Äî     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Virtual rainfall sensor</font></font></b><div class="spoiler_text">   ‚Äî          .            ,   . <br>
<br>
       darksky.  ,          Apple        ¬´ ¬ª. API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After all the data is collected, you can proceed directly to watering. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how I look at a piece of the interface from one of the zones in the Home Assistant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can set the amount of water for irrigation (with a slider) and see the values ‚Äã‚Äãof the main sensors and counters. </font><font style="vertical-align: inherit;">I gave the interface for one of the lines, for the rest everything is the same, only on lines with wired data sensors it is slightly less.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the interface, you can notice one ‚Äúsuperfluous‚Äù detail - the auxiliary sensor ‚ÄúThe norm has been reached‚Äù. </font><font style="vertical-align: inherit;">It had to be introduced, because </font><font style="vertical-align: inherit;">I was not able to get condition: template to work to stop the automation when the norm for the amount of water was reached, and as a result, the automation just checks the value of this sensor. </font><font style="vertical-align: inherit;">I am sure that this part of automation can be made simpler and more elegant, but my level was not enough for this. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Below is the code for the resulting ‚Äúcrutch‚Äù template sensor:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watering sufficiency sensor (inside configuration.yaml or a separate file)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Automation to start watering ultimately looks like this:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start watering (inside automations.yaml or a separate file)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Watering starts late in the evening, with each line starting at its own time interval. </font><font style="vertical-align: inherit;">Separation by start time allows you to use one inlet water meter to obtain data on 4 lines. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At startup, three conditions are checked:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is the limit on the amount of water for today not exceeded (if, for example, manual watering was turned on)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does the humidity exceed 50% (according to observations in our conditions, freshly spilled soil has a moisture content of not more than 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precipitation greater than 5 mm is not expected in the next two days.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next automation is disabling watering:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disabling watering (inside automations.yaml or a separate file)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In automation, as many as 4 variants of triggers were used, but in most cases it works according to the first - a ‚Äúcrutch‚Äù sensor, which monitors the excess of the limit by the amount of water. </font><font style="vertical-align: inherit;">The rest of the triggers are made to a large extent for safety reasons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, the last automation related to the problem is resetting the daily counter</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeroing the daily counter (inside automations.yaml or a separate file)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project economics</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The costs for the control part of the irrigation system were as follows: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Raspberry PIE with HassIO on board and a WiFi router with a coating in the garden were already before the start of the project, I don‚Äôt take them into account) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNIPUMP BCX-15 1/2 "solenoid valve (normally closed) 4 * 20 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pulse meter Pulsar 8 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 DevKitC 3.5 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capacitive Soil Moisture Sensor v1.2 2 * 0.67 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MiFlora sensors 2 * 16 euros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guards, collector, wires, fittings all together about 50 euros </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOTAL: about 190 euros</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The time spent on setting up the sensors and MK is approximately 3-4 pm for several hours, but most of the time was spent on ‚Äúinventing bicycles‚Äù and inventing ‚Äúcrutches‚Äù, in general, there is not much work. </font><font style="vertical-align: inherit;">The physical assembly of the system took about 2 evenings. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, water savings of about 20-50% are expected compared to the ‚Äúsilly" timer system and at local water prices, the system should pay off in one or two seasons.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shortcomings and plans for revision</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of the project, some nuances and opportunities for further improvement were revealed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In particular, I would replace 220V solenoid valves with a 24V model - this voltage is standard for irrigation systems. In this case, you would have to add a 24V transformer to the system and change the Sonoff 4Ch to something with a dry contact (for example, Sonoff 4CH Pro or something self-assembled). Valves themselves are cheaper (from 8 euros) and reduce the likelihood of electric shock. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It also turned out that for working with plastic pipelines, the pressure from the water supply is too high, and the fittings can leak during the irrigation cycle. In my case, this is not critical, all fittings are located above the watering ground, but in a good way you need to add a reducer at the inlet to lower the pressure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I was even more upset by the impossibility of accounting for the amount of water for irrigation in volumes less than 10 liters - this volume is the minimum measurable quantity for such a meter. </font><font style="vertical-align: inherit;">This problem can be solved by disassembling the counter and swapping the wheels, but until then hands have not reached it.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497588/index.html">Spring Security - An OAuth2 Authorization Web Application Example Through BitBucket</a></li>
<li><a href="../en497590/index.html">We deal with the wave function collapse algorithm</a></li>
<li><a href="../en497594/index.html">External data storage: from the time of IBM 1311 to the present day. Part 1</a></li>
<li><a href="../en497596/index.html">Long live PHP</a></li>
<li><a href="../en497602/index.html">Do you consider yourself a signor? Who are you kidding</a></li>
<li><a href="../en497608/index.html">How Traffic Analysis Systems Detect Hacker Tactics by MITER ATT & CK, Part 5</a></li>
<li><a href="../en497612/index.html">The story of how the invisible hand of the market transferred me to a remote place</a></li>
<li><a href="../en497614/index.html">Thought experiments, paradoxes and boundaries of logic // We are doomed # 2</a></li>
<li><a href="../en497616/index.html">Interview with Alexander Makarov (Yii) about Opensource, conferences and Yii</a></li>
<li><a href="../en497618/index.html">Implementation of the concept of highly secure remote access</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>