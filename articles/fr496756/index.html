<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üë∞üèæ üë©üèæ‚Äçüéì AWS Lambda en action. Partie 2: se familiariser avec les outils de d√©veloppement et de test ‚öæÔ∏è üè¶ üôÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ce guide est le r√©sultat d'une exp√©rience personnelle dans le d√©veloppement et le test d'applications sans serveur, ainsi que dans les man≈ìuvres entre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda en action. Partie 2: se familiariser avec les outils de d√©veloppement et de test</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/496756/"><img src="https://habrastorage.org/webt/7w/hp/bb/7whpbbwttpekzxdq4-7sgs28rio.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce guide est le r√©sultat d'une exp√©rience personnelle dans le d√©veloppement et le test d'applications sans serveur, ainsi que dans les man≈ìuvres entre b√©quilles et v√©los lorsque vous essayez de les tester. Lorsque j'ai commenc√© √† d√©velopper des applications sans serveur, j'ai d√ª tout comprendre avec mes mains, il n'y avait pas de guides clairs ou d'outils pratiques pour le d√©veloppement local et les tests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, la situation est en train de changer: des outils ont commenc√© √† appara√Ætre, mais trouver des manuels sur leur utilisation n'est pas facile. Dans cet article, je vais montrer avec un exemple simple comment travailler avec la nouvelle fonctionnalit√©. Vous pouvez facilement le ma√Ætriser et contourner les probl√®mes et les bugs que j'ai eu la ¬´chance¬ª de rencontrer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous apprendrez √† d√©velopper √† l'aide de la console de navigation AWS, SAM-CLI et IntelljIDEA. </font><font style="vertical-align: inherit;">Je parlerai √©galement des tests: int√©gration, E2E et tests unitaires. </font><font style="vertical-align: inherit;">Et enfin, nous discuterons du co√ªt d'une telle solution (spoiler: vous pouvez √©conomiser beaucoup). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet article sera utile √† ceux qui commencent √† d√©velopper des applications sans serveur et ne connaissent pas encore ses outils et ses approches.</font></font><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui sera discut√©</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour √† tous! </font><font style="vertical-align: inherit;">Je m'appelle Alexander Gruzdev et je suis heureux de vous pr√©senter la deuxi√®me partie de l'article sur l'utilisation et le d√©veloppement de solutions sans serveur bas√©es sur AWS Lambda. </font><font style="vertical-align: inherit;">Dans la suite, nous parlerons des fa√ßons de d√©velopper et de tester la solution √† partir de la premi√®re partie ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda en action dans Java 11. Nous visitons Serverless dans ¬´Production¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depuis la publication du dernier article, l'application de test a √©t√© l√©g√®rement repens√©e, mais la signification principale reste la m√™me. </font><font style="vertical-align: inherit;">Il s'agit d'un formulaire HTML Contactez-nous trivial qui envoie des donn√©es du formulaire √† l'API de passerelle via des requ√™tes HTTP, et qui, √† son tour, proc√®de √† la proxy de la demande de traitement √† AWS Lambda. </font><font style="vertical-align: inherit;">Pendant le traitement, le lambda √©crit des donn√©es dans la table DynamoDB et envoie une lettre via AWS SES. </font><font style="vertical-align: inherit;">Le diagramme des composants est pr√©sent√© ci-dessous.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/zp/wd/aczpwdfofm_vp7xqrjdis2gsblu.png" alt="Diagramme des composants"><br>
<br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenu</font></font></h1><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©veloppement √† l'aide de la console du navigateur AWS</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©veloppement √† l'aide de SAM-CLI</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©veloppement avec IntelljIDEA</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Types de tests</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Co√ªts sans serveur</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles</font></font></a></li>
</ol><br>
<br>
<a name="Part1"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. D√©veloppement √† l'aide de la console du navigateur AWS</font></font></h1><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console AWS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La console AWS permet d'acc√©der √† n'importe quel service AWS, qu'il s'agisse de votre serveur EC2 virtuel, des param√®tres de strat√©gie d'acc√®s / r√¥le IAM ou AWS Lambda avec tous les param√®tres qui peuvent √™tre modifi√©s en temps r√©el sans red√©ploiement via les syst√®mes de livraison continue / d√©ploiement continu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela acc√©l√®re consid√©rablement le processus de d√©veloppement et certains types de tests. </font><font style="vertical-align: inherit;">Il permet √©galement de contr√¥ler visuellement les param√®tres de lancement et de fonctionnement de vos applications.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console API Gateway</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La console vous permet de surveiller l'√©tat actuel de l'application, de g√©rer vos environnements et de proposer de nouvelles versions. </font><font style="vertical-align: inherit;">Je vais montrer comment cela peut √™tre utilis√© pour v√©rifier la sant√© de l'environnement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons √† quoi ressemble cette console ¬´magique¬ª dans la capture d'√©cran de l'onglet Ressources de l'application Contactez-nous: </font><font style="vertical-align: inherit;">
La capture d'√©cran montre comment la demande du client via l'API de passerelle entre dans le lambda et comment la r√©ponse retourne au client lorsque la ressource POST est appel√©e / contact.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/f7/fe/s2/f7fes2uz9qxcpj9dqmko6zuxalc.png" alt="Ressources de passerelle"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande de m√©thode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - premi√®re √©tape du traitement de la demande. </font><font style="vertical-align: inherit;">Dans notre cas, il ne contient aucun param√®tre, mais peut contenir, par exemple, des param√®tres d'autorisation.</font></font><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La demande d'int√©gration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie que la demande HTTP sera transmise au lambda dans un format sp√©cial: elle contient toutes les informations envoy√©es par le client et des d√©tails sur le contexte appel√©.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La r√©ponse d'int√©gration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique que le client HTTP recevra la r√©ponse directement du lambda. </font><font style="vertical-align: inherit;">Par cons√©quent, vous √™tes vous-m√™me responsable de la formation du corps de r√©ponse dans lambda.</font></font></li>
</ul><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©sactiver l'int√©gration du proxy</font></font></b>
                        <div class="spoiler_text">     API Gateway  ,    <i>Use Lambda Proxy integration</i>   <i>Integration Request</i>.          . ,          ,     .<br>
<br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple de demande d'int√©gration</font></font></b>
                        <div class="spoiler_text">    SAM init      <i>events</i>,     ,      <i>Integration request</i>.    ,   AWS    ,     .         AWS Lambda.<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appuyez sur le bouton TEST pour v√©rifier que l'application fonctionne. </font><font style="vertical-align: inherit;">Cela vous donnera acc√®s aux appels de l'API HTTP Gateway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la capture d'√©cran suivante, j'ai envoy√© une demande pour r√©chauffer le lambda: </font><font style="vertical-align: inherit;">
en plus de r√©pondre √† la demande, l'API Gateway affiche des journaux d√©taill√©s. </font><font style="vertical-align: inherit;">De la m√™me mani√®re, vous pouvez faire une vraie demande en rempla√ßant le corps de la demande JSON sous la forme:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ia/kf/ga/iakfgafb8t4-9aocr5o-e5dspy0.png" alt="Demande de test de passerelle"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<pre><code class="javascript hljs">{
    <span class="hljs-string">"subject"</span>: <span class="hljs-string">"Email subject"</span>,
    <span class="hljs-string">"question"</span>: <span class="hljs-string">"Your question‚Ä¶"</span>,
    <span class="hljs-string">"username"</span>: <span class="hljs-string">"Your name‚Ä¶"</span>,
    <span class="hljs-string">"phone"</span>: <span class="hljs-string">"Your phone‚Ä¶"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"Your email‚Ä¶"</span><font></font>
} <font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez donc tester manuellement votre API sans formulaires d'interface utilisateur ni applications frontales, s√©parant ainsi le d√©veloppement frontal et le d√©veloppement principal. </font><font style="vertical-align: inherit;">Comme alternative √† la console int√©gr√©e, vous pouvez utiliser Postman ou tout autre client HTTP.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facteur comme alternative</font></font></b>
                        <div class="spoiler_text">   HTTP-     Postman.         .   ,   API Gateway       AWS ,              API. ,  ,       AWS .<br>
</div>
                    </div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Console Lambda</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les tests et le d√©veloppement, en plus des demandes via l'API Gateway, vous pouvez utiliser la console du navigateur AWS Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Son √©cran est divis√© en plusieurs blocs:</font></font><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Designer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> affiche les d√©clencheurs et les calques existants. </font><font style="vertical-align: inherit;">Dans notre cas, le d√©clencheur est API Gateway. </font><font style="vertical-align: inherit;">Si nous cliquons dessus, toutes les informations n√©cessaires s'ouvriront: URL, √©tape, chemin d'acc√®s aux ressources.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les alias</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (disponibles lors de la s√©lection d'un alias lambda sp√©cifique) vous permettent de configurer la r√©partition du trafic par version de lambda. </font><font style="vertical-align: inherit;">Plus d'informations √† ce sujet dans le paragraphe suivant.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/hs/3s/b8/hs3sb8_jvymnm4bnmtn1yvgcamg.png"></a></li>
<li><i>Function code</i> ‚Äî        .      zip-  ,    .       ,   Function code      .         Python/NodeJs. <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/1l/p1/0y/1lp10yo_zd7tcbcr7cyu-dyxtlw.png"></a></li>
<li><i>Environment variables.</i> ,      .  ,        ,     .    ,         . ,    ,        .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/hx/sg/z_/hxsgz_-adludvt4phrfgebnjqa4.png"></a></li>
<li><i>Tags</i> ‚Äî  ,       , ,    ,    .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/qm/za/bt/qmzabtb2nt-yo9tedqlxluhop8e.png"></a></li>
<li><i>Execution role</i> ‚Äî      (   ) ,      .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/bf/rk/3s/bfrk3sw8ig7rseuhnwr4mr8o8-c.png"></a></li>
<li><i>Basic settings</i> ‚Äî         .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ds/lr/cj/dslrcjorhygk_bmfzlxp5ddxqz0.png"></a></li>
<li><i>Network</i>:      -  ,          VPC.    ‚Äî   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  .</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-i/lz/hm/-ilzhms_ty6b7i7pex7pc1dbcbw.png"></a></li>
<li><i>AWS X-Ray</i>   .           AWS-. <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/pj/l6/qz/pjl6qzbt3133iqwonql03wd96qs.png"></a></li>
<li><i> Reserve concurrency</i>     ,                  .          .<br>
   Provisioned concurrency</li>
<li><i>Provisioned concurrency</i> ‚Äî    .       ,          .     ,     ‚Äî    .          Free Tier .<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/mb/gt/sq/mbgtsqv1iueoy6js88rv4rusi7s.png"></a></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'appel asynchrone</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permet de configurer un traitement sp√©cial des demandes asynchrones. </font><font style="vertical-align: inherit;">Nous indiquons le nombre d'appels r√©p√©t√©s √† effectuer en cas d'erreur et pendant combien de temps la demande peut se bloquer dans la file d'attente. </font><font style="vertical-align: inherit;">Facultativement, vous pouvez sp√©cifier une file d'attente pour le traitement des demandes qui √©chouent.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/fp/g_/zi/fpg_ziuv-ouv4yeeejmxqlko-za.png"></a><br>
</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les proxys de base de donn√©es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont une autre nouvelle fonctionnalit√© qui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous permet de configurer l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acc√®s √† la base de donn√©es via des proxys sous la forme d'API Gateway + Lambda.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/bp/f4/fw/bpf4fw1yjd0ayzsolj0vbhnjrfs.png"></a></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ensuite comment d√©velopper √† partir de cette console. </font><font style="vertical-align: inherit;">Outre la modification des param√®tres, la fonctionnalit√© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurer les √©v√©nements de test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut √™tre utilis√©e pour cr√©er une demande de test. </font><font style="vertical-align: inherit;">Une liste assez compl√®te est disponible, mais nous profiterons de ce que j'ai d√©j√† joint dans le projet:</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demande de contact</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">{
  <span class="hljs-string">"body"</span>: <span class="hljs-string">"{\"subject\": \"Question\",\"question\": \"How much does it cost\",\"username\": \"Alex\",\"phone\": \"+79999999999\",\"email\": \"alex@gmail.com\"}"</span>,
  <span class="hljs-string">"resource"</span>: <span class="hljs-string">"/{proxy+}"</span>,
  <span class="hljs-string">"path"</span>: <span class="hljs-string">"/path/to/resource"</span>,
  <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"isBase64Encoded"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"queryStringParameters"</span>: {
    <span class="hljs-string">"foo"</span>: <span class="hljs-string">"bar"</span><font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span>: {
    <span class="hljs-string">"proxy"</span>: <span class="hljs-string">"/path/to/resource"</span><font></font>
  },<font></font>
  <span class="hljs-string">"stageVariables"</span>: {
    <span class="hljs-string">"baz"</span>: <span class="hljs-string">"qux"</span><font></font>
  },<font></font>
  <span class="hljs-string">"headers"</span>: {
    <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,
    <span class="hljs-string">"Accept-Encoding"</span>: <span class="hljs-string">"gzip, deflate, sdch"</span>,
    <span class="hljs-string">"Accept-Language"</span>: <span class="hljs-string">"en-US,en;q=0.8"</span>,
    <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"max-age=0"</span>,
    <span class="hljs-string">"CloudFront-Forwarded-Proto"</span>: <span class="hljs-string">"https"</span>,
    <span class="hljs-string">"CloudFront-Is-Desktop-Viewer"</span>: <span class="hljs-string">"true"</span>,
    <span class="hljs-string">"CloudFront-Is-Mobile-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Is-SmartTV-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Is-Tablet-Viewer"</span>: <span class="hljs-string">"false"</span>,
    <span class="hljs-string">"CloudFront-Viewer-Country"</span>: <span class="hljs-string">"US"</span>,
    <span class="hljs-string">"Host"</span>: <span class="hljs-string">"1234567890.execute-api.us-east-1.amazonaws.com"</span>,
    <span class="hljs-string">"Upgrade-Insecure-Requests"</span>: <span class="hljs-string">"1"</span>,
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Custom User Agent String"</span>,
    <span class="hljs-string">"Via"</span>: <span class="hljs-string">"1.1 08f323deadbeefa7af34d5feb414ce27.cloudfront.net (CloudFront)"</span>,
    <span class="hljs-string">"X-Amz-Cf-Id"</span>: <span class="hljs-string">"cDehVQoZnx43VYQb9j2-nvCh-9z396Uhbp027Y2JvkCPNLmGJHqlaA=="</span>,
    <span class="hljs-string">"X-Forwarded-For"</span>: <span class="hljs-string">"127.0.0.1, 127.0.0.2"</span>,
    <span class="hljs-string">"X-Forwarded-Port"</span>: <span class="hljs-string">"443"</span>,
    <span class="hljs-string">"X-Forwarded-Proto"</span>: <span class="hljs-string">"https"</span><font></font>
  },<font></font>
  <span class="hljs-string">"requestContext"</span>: {
    <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"resourceId"</span>: <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"stage"</span>: <span class="hljs-string">"prod"</span>,
    <span class="hljs-string">"requestId"</span>: <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"requestTime"</span>: <span class="hljs-string">"09/Apr/2015:12:34:56 +0000"</span>,
    <span class="hljs-string">"requestTimeEpoch"</span>: <span class="hljs-number">1428582896000</span>,
    <span class="hljs-string">"identity"</span>: {
      <span class="hljs-string">"cognitoIdentityPoolId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"accountId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"cognitoIdentityId"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"caller"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"accessKey"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"sourceIp"</span>: <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"cognitoAuthenticationType"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"userArn"</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-string">"userAgent"</span>: <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span>: <span class="hljs-literal">null</span><font></font>
    },<font></font>
    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/prod/path/to/resource"</span>,
    <span class="hljs-string">"resourcePath"</span>: <span class="hljs-string">"/{proxy+}"</span>,
    <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"apiId"</span>: <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"protocol"</span>: <span class="hljs-string">"HTTP/1.1"</span><font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir ajout√© la demande, cliquez sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et voyez le r√©sultat de lambda: </font><font style="vertical-align: inherit;">
Lambda renvoie JSON, qui contient le code d'√©tat et le corps de la r√©ponse. </font><font style="vertical-align: inherit;">La valeur du corps ira directement au client qui a appel√© l'API de passerelle. </font><font style="vertical-align: inherit;">De plus, la capture d'√©cran pr√©sente les caract√©ristiques de l'appel: le temps d'ex√©cution, le temps d'ex√©cution pour lequel nous allons payer, la quantit√© maximale de m√©moire qui a √©t√© consomm√©e par le lambda. </font><font style="vertical-align: inherit;">En nous appuyant sur ces mesures, nous pouvons configurer la quantit√© optimale de m√©moire afin que le lambda corresponde √† vos exigences de prix / taux de r√©ponse.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/oc/vw/w1/ocvww1tut1fhx0czz5ijzjnpvhg.png" alt="Ressources de passerelle"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de la console AWS pour tester le d√©ploiement Canary</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abordons maintenant un point important li√© au d√©ploiement d'une nouvelle version de lambda. </font><font style="vertical-align: inherit;">J'ai sp√©cifi√© de tels param√®tres lorsque j'ai √©crit le mod√®le SAM:</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier param√®tre ajoute automatiquement un alias en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">direct</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† chaque nouvelle version du lambda </font><font style="vertical-align: inherit;">.</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu sur les alias</font></font></b>
                        <div class="spoiler_text">     ,   .    ,         ,       API Gateway.      1, 2, 3   .    <i>LATEST</i>,     .     2  3   API Gateway (Stage   AWS),          Gateway-Lambda.  API Gateway      (ARN ),      <i>LATEST</i>. <br>
 <br>
 ‚Äî    (  ), ,      ,    ARN .      ,         Stage  API Gateway      .  ,    API Gateway: dev, qa  prod       .<br>
<br>
         ,    ,      .       ,        .  , live,    .    live-    , , ,    ,       CloudWatch.<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour tester le d√©ploiement de Canary, vous pouvez utiliser √† la fois la console Gateway API et la console Lambda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez d'abord modifier le code lambda afin qu'il renvoie une r√©ponse diff√©rente. </font><font style="vertical-align: inherit;">Par exemple, dans le traitement de pr√©chauffage, sp√©cifiez la version 2 au lieu de la version 1 dans la r√©ponse. Ce sera notre marqueur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, en utilisant la fonctionnalit√© API du test de passerelle, nous pouvons nous assurer que dans les dix minutes lors de l'envoi des demandes WARM-UP, seulement 10% des r√©ponses auront la version 2 dans le corps de la r√©ponse. </font><font style="vertical-align: inherit;">Pass√© ce d√©lai, la version 2 renverra 100% des demandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus de la console Gateway API, nous pouvons utiliser la console Lambda, o√π, apr√®s avoir s√©lectionn√© l'alias n√©cessaire, nous voyons une politique de distribution du trafic qui peut √™tre contr√¥l√©e.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/hs/3s/b8/hs3sb8_jvymnm4bnmtn1yvgcamg.png" alt="Alias ‚Äã‚ÄãLambda"></a><br>
<br>
<br>
<a name="Part2"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. D√©veloppement local avec SAM-CLI</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque temps, l'un des principaux inconv√©nients de l'utilisation de lambda √©tait consid√©r√© comme un inconv√©nient lors du d√©veloppement et des tests sur la machine locale. Maintenant, la situation a beaucoup chang√©: le framework SAM est apparu, ce qui permet non seulement de collecter et de d√©ployer des solutions, mais simplifie √©galement le d√©veloppement local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, vous pouvez appeler votre lambda directement depuis la console:</font></font><br>
<pre><code class="bash hljs">sam <span class="hljs-built_in">local</span> invoke -e ./events/warm_up_request.json ContactUsFunction
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette commande est lanc√©e √† partir du r√©pertoire avec le mod√®le SAM et transf√®re le contenu du fichier JSON vers l'entr√©e lambda ContactUsFunction (il s'agit du nom logique dans le mod√®le). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est-√†-dire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'en</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant cette commande, SAM l√®ve l'image </font><i><font style="vertical-align: inherit;">lambci / lambda: java11</font></i><font style="vertical-align: inherit;"> dans docker </font><font style="vertical-align: inherit;">et y ex√©cute votre code. </font><font style="vertical-align: inherit;">Pour acc√©der √† des services distants, tels que SES, votre configuration AWS avec une cl√© secr√®te / d'acc√®s est utilis√©e, elle doit donc √™tre √† jour. </font><font style="vertical-align: inherit;">Autre point important: si vous n'ajoutez pas d'en-t√™te pour le mode de pr√©chauffage, les vrais services AWS SES et DynamoDB seront appel√©s.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journal d'appels ici</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam <span class="hljs-built_in">local</span> invoke -e ./events/warm_up_request.json ContactUsFunction<font></font>
Invoking com.gralll.sam.App::handleRequest (java11)<font></font>
Fetching lambci/lambda:java11 Docker container image......<font></font>
Mounting F:\aws\projects\contact-us-sam-app\.aws-sam\build\ContactUsFunction as /var/task:ro,delegated inside runtime container<font></font>
?[32mSTART RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2 Version: <span class="hljs-variable">$LATEST</span>?[0m<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 INFO  App - Request was received<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 DEBUG App - {<font></font>
  <span class="hljs-string">"body"</span> : <span class="hljs-string">"{\"subject\": \"Question\",\"question\": \"How much does it cost\",\"username\": \"Alex\",\"phone\": \"+79999999999\",\"email\": \"alex@gmail.com\"}"</span>,
  <span class="hljs-string">"resource"</span> : <span class="hljs-string">"/{proxy+}"</span>,
  <span class="hljs-string">"requestContext"</span> : {
    <span class="hljs-string">"resourceId"</span> : <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"apiId"</span> : <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"resourcePath"</span> : <span class="hljs-string">"/{proxy+}"</span>,
    <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"requestId"</span> : <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"extendedRequestId"</span> : null,
    <span class="hljs-string">"accountId"</span> : <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"identity"</span> : {
      <span class="hljs-string">"apiKey"</span> : null,
      <span class="hljs-string">"apiKeyId"</span> : null,
      <span class="hljs-string">"userArn"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationType"</span> : null,
      <span class="hljs-string">"caller"</span> : null,
      <span class="hljs-string">"userAgent"</span> : <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span> : null,
      <span class="hljs-string">"cognitoIdentityPoolId"</span> : null,
      <span class="hljs-string">"cognitoIdentityId"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span> : null,
      <span class="hljs-string">"sourceIp"</span> : <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"accountId"</span> : null,
      <span class="hljs-string">"accessKey"</span> : null<font></font>
    },<font></font>
    <span class="hljs-string">"authorizer"</span> : null,
    <span class="hljs-string">"stage"</span> : <span class="hljs-string">"prod"</span>,
    <span class="hljs-string">"path"</span> : <span class="hljs-string">"/prod/path/to/resource"</span>,
    <span class="hljs-string">"protocol"</span> : <span class="hljs-string">"HTTP/1.1"</span>,
    <span class="hljs-string">"requestTime"</span> : <span class="hljs-string">"09/Apr/2015:12:34:56 +0000"</span>,
    <span class="hljs-string">"requestTimeEpoch"</span> : 1428582896000,
    <span class="hljs-string">"elb"</span> : null<font></font>
  },<font></font>
  <span class="hljs-string">"multiValueQueryStringParameters"</span> : { },
  <span class="hljs-string">"multiValueHeaders"</span> : {
    <span class="hljs-string">"X-WARM-UP"</span> : [ <span class="hljs-string">"13"</span> ]<font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span> : {
    <span class="hljs-string">"proxy"</span> : <span class="hljs-string">"/path/to/resource"</span><font></font>
  },<font></font>
  <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"stageVariables"</span> : {
    <span class="hljs-string">"baz"</span> : <span class="hljs-string">"qux"</span><font></font>
  },<font></font>
  <span class="hljs-string">"path"</span> : <span class="hljs-string">"/path/to/resource"</span>,
  <span class="hljs-string">"isBase64Encoded"</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">"requestSource"</span> : <span class="hljs-string">"API_GATEWAY"</span><font></font>
}<font></font>
2020-01-06 19:09:17 a86d65fa-1f19-15c5-93b8-d87631c80ee2 INFO  App - Lambda was warmed up<font></font>
?[32mEND RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2?[0m<font></font>
?[32mREPORT RequestId: a86d65fa-1f19-15c5-93b8-d87631c80ee2     Init Duration: 1984.55 ms       Duration: 42.22 ms      Billed Duration: 100 ms Memory Size: 256 MB     Max Memory Used: 102 MB ?[0m<font></font>
{<span class="hljs-string">"statusCode"</span>:201,<span class="hljs-string">"multiValueHeaders"</span>:{<span class="hljs-string">"Access-Control-Allow-Origin"</span>:[<span class="hljs-string">"*"</span>]},<span class="hljs-string">"body"</span>:{<span class="hljs-string">"response"</span>:<span class="hljs-string">"Lambda was warmed up. V1"</span>},<span class="hljs-string">"isBase64Encoded"</span>:<span class="hljs-literal">false</span>}
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du journal lambda, des informations de service sur l'√©tat de l'appel et une r√©ponse au format JSON sont √©crites sur la console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'API de passerelle, comme lambda, peut √™tre ex√©cut√©e localement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ex√©cutons la commande:</font></font><br>
<pre><code class="bash hljs">sam <span class="hljs-built_in">local</span> start-api
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journal de la console au d√©marrage</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam <span class="hljs-built_in">local</span> start-api<font></font>
Mounting ContactUsFunction at http://127.0.0.1:3000/contact [POST, OPTIONS]<font></font>
You can now browse to the above endpoints to invoke your <span class="hljs-built_in">functions</span>. You <span class="hljs-keyword">do</span> not need to restart/reload SAM CLI <span class="hljs-keyword">while</span> working on your <span class="hljs-built_in">functions</span>, changes will be reflected instantly/automatically. You only need to restart SAM CLI <span class="hljs-keyword">if</span> you update your AWS SAM template<font></font>
2020-01-06 22:20:30  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir d√©marr√© le serveur, nous pouvons ex√©cuter des requ√™tes. </font><font style="vertical-align: inherit;">J'utiliserai Postman et enverrai une demande pour r√©chauffer le lambda.</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/_e/hg/vs/_ehgvsftbjygwjcu3iiol-vky68.png"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la console, nous voyons</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">Invoking com.gralll.sam.App::handleRequest (java11)<font></font>
Fetching lambci/lambda:java11 Docker container image......<font></font>
Mounting F:\aws\projects\contact-us-sam-app\.aws-sam\build\ContactUsFunction as /var/task:ro,delegated inside runtime container<font></font>
?[32mSTART RequestId: 27868750-3637-1f80-3d80-53a724da16ef Version: <span class="hljs-variable">$LATEST</span>?[0m<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef INFO  App - Request was received<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef DEBUG App - {<font></font>
  <span class="hljs-string">"body"</span> : <span class="hljs-string">"{\r\n  \"subject\": \"Question\",\r\n  \"question\": \"How much does it cost\",\r\n  \"username\": \"Alex\",\r\n  \"phone\": \"+79999999999\",\r\n  \"email\": \"alex@gmail.com\"\r\n}"</span>,
  <span class="hljs-string">"resource"</span> : <span class="hljs-string">"/contact"</span>,
  <span class="hljs-string">"requestContext"</span> : {
    <span class="hljs-string">"resourceId"</span> : <span class="hljs-string">"123456"</span>,
    <span class="hljs-string">"apiId"</span> : <span class="hljs-string">"1234567890"</span>,
    <span class="hljs-string">"resourcePath"</span> : <span class="hljs-string">"/contact"</span>,
    <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"requestId"</span> : <span class="hljs-string">"c6af9ac6-7b61-11e6-9a41-93e8deadbeef"</span>,
    <span class="hljs-string">"extendedRequestId"</span> : null,
    <span class="hljs-string">"accountId"</span> : <span class="hljs-string">"123456789012"</span>,
    <span class="hljs-string">"identity"</span> : {
      <span class="hljs-string">"apiKey"</span> : null,
      <span class="hljs-string">"apiKeyId"</span> : null,
      <span class="hljs-string">"userArn"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationType"</span> : null,
      <span class="hljs-string">"caller"</span> : null,
      <span class="hljs-string">"userAgent"</span> : <span class="hljs-string">"Custom User Agent String"</span>,
      <span class="hljs-string">"user"</span> : null,
      <span class="hljs-string">"cognitoIdentityPoolId"</span> : null,
      <span class="hljs-string">"cognitoIdentityId"</span> : null,
      <span class="hljs-string">"cognitoAuthenticationProvider"</span> : null,
      <span class="hljs-string">"sourceIp"</span> : <span class="hljs-string">"127.0.0.1"</span>,
      <span class="hljs-string">"accountId"</span> : null,
      <span class="hljs-string">"accessKey"</span> : null<font></font>
    },<font></font>
    <span class="hljs-string">"authorizer"</span> : null,
    <span class="hljs-string">"stage"</span> : <span class="hljs-string">"Prod"</span>,
    <span class="hljs-string">"path"</span> : <span class="hljs-string">"/contact"</span>,
    <span class="hljs-string">"protocol"</span> : null,
    <span class="hljs-string">"requestTime"</span> : null,
    <span class="hljs-string">"requestTimeEpoch"</span> : 0,
    <span class="hljs-string">"elb"</span> : null<font></font>
  },<font></font>
  <span class="hljs-string">"multiValueQueryStringParameters"</span> : null,
  <span class="hljs-string">"multiValueHeaders"</span> : {
    <span class="hljs-string">"Accept"</span> : [ <span class="hljs-string">"application/json"</span> ],
    <span class="hljs-string">"Accept-Encoding"</span> : [ <span class="hljs-string">"gzip, deflate, br"</span> ],
    <span class="hljs-string">"Accept-Language"</span> : [ <span class="hljs-string">"ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7"</span> ],
    <span class="hljs-string">"Cache-Control"</span> : [ <span class="hljs-string">"no-cache"</span> ],
    <span class="hljs-string">"Connection"</span> : [ <span class="hljs-string">"keep-alive"</span> ],
    <span class="hljs-string">"Content-Length"</span> : [ <span class="hljs-string">"150"</span> ],
    <span class="hljs-string">"Content-Type"</span> : [ <span class="hljs-string">"text/plain;charset=UTF-8"</span> ],
    <span class="hljs-string">"Host"</span> : [ <span class="hljs-string">"127.0.0.1:3000"</span> ],
    <span class="hljs-string">"Origin"</span> : [ <span class="hljs-string">"chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop"</span> ],
    <span class="hljs-string">"Postman-Token"</span> : [ <span class="hljs-string">"5cadaccd-6fae-5bc2-b4ef-63900a1725ff"</span> ],
    <span class="hljs-string">"Sec-Fetch-Mode"</span> : [ <span class="hljs-string">"cors"</span> ],
    <span class="hljs-string">"Sec-Fetch-Site"</span> : [ <span class="hljs-string">"cross-site"</span> ],
    <span class="hljs-string">"User-Agent"</span> : [ <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span> ],
    <span class="hljs-string">"X-Forwarded-Port"</span> : [ <span class="hljs-string">"3000"</span> ],
    <span class="hljs-string">"X-Forwarded-Proto"</span> : [ <span class="hljs-string">"http"</span> ],
    <span class="hljs-string">"X-Warm-Up"</span> : [ <span class="hljs-string">"123"</span> ]<font></font>
  },<font></font>
  <span class="hljs-string">"pathParameters"</span> : null,
  <span class="hljs-string">"httpMethod"</span> : <span class="hljs-string">"POST"</span>,
  <span class="hljs-string">"stageVariables"</span> : null,
  <span class="hljs-string">"path"</span> : <span class="hljs-string">"/contact"</span>,
  <span class="hljs-string">"isBase64Encoded"</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">"requestSource"</span> : <span class="hljs-string">"API_GATEWAY"</span><font></font>
}<font></font>
2020-01-06 19:28:09 27868750-3637-1f80-3d80-53a724da16ef INFO  App - Lambda was warmed up<font></font>
?[32mEND RequestId: 27868750-3637-1f80-3d80-53a724da16ef?[0m<font></font>
?[32mREPORT RequestId: 27868750-3637-1f80-3d80-53a724da16ef     Init Duration: 1951.87 ms       Duration: 42.91 ms      Billed Duration: 100 ms Memory Size: 256 MB     Max Memory Used: 102 MB ?[0m<font></font>
2020-01-06 22:28:11 127.0.0.1 - - [06/Jan/2020 22:28:11] <span class="hljs-string">"POST /contact HTTP/1.1"</span> 201 -
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les journaux, bien s√ªr, ne sont pas format√©s de la meilleure fa√ßon. </font><font style="vertical-align: inherit;">J'esp√®re que cela sera corrig√© √† l'avenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Important: lors du changement du code lambda, le red√©marrage de l'API n'est pas n√©cessaire. </font><font style="vertical-align: inherit;">Il suffit de reconstruire le lambda avec la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commande sam build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de bugs</font></font></b>
                        <div class="spoiler_text">        Java-  <i>aws-serverless-java-container-core</i>,    :       502 .    :<br>
<pre><code class="bash hljs">Invalid API Gateway Response Keys: {<span class="hljs-string">'base64Encoded'</span>} <span class="hljs-keyword">in</span> {<span class="hljs-string">'statusCode'</span>: 200, <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span>}, <span class="hljs-string">'body'</span>: <span class="hljs-string">'Hello World'</span>, <span class="hljs-string">'base64Encoded'</span>: False} 
</code></pre><br>
  - ,   API Gateway    AWS       JsonProperty.     <i>'isBase64Encoded'</i>   <i>'base64Encoded'</i>, , ,    .   ,       Java- ContactUsProxyResponse  AwsProxyRequest.<br>
</div>
                    </div><br>
<br>
<a name="Part3"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Appels locaux d'IDEA</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout ce qui est d√©crit dans le paragraphe ci-dessus est la fonctionnalit√© de l'outil SAM. Il est contr√¥l√© depuis la ligne de commande et peut √™tre int√©gr√© dans n'importe quelle interface. C'est exactement ce qui a √©t√© fait dans le plugin pour IntelljIDEA AWS Toolkit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce plugin ajoute des configurations suppl√©mentaires pour lancer un lambda directement depuis l'IDE. Voici √† quoi ressemble la fen√™tre de configuration. </font><font style="vertical-align: inherit;">
Vous devez soit s√©lectionner un mod√®le avec une description du lambda, soit configurer les param√®tres manuellement. </font><font style="vertical-align: inherit;">
Dans le premier cas, la quantit√© de m√©moire et de langue pour la compilation sera automatiquement prise √† partir du mod√®le. Dans le second cas, vous pouvez configurer vous-m√™me la quantit√© de RAM et effectuer un calcul approximatif de la limite. </font><font style="vertical-align: inherit;">
Un autre plugin vous permet d'ex√©cuter la configuration directement √† partir de la fen√™tre de l'√©diteur de code Java ou du mod√®le yaml. Captures d'√©cran ci-dessous:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/2s/8u/xk/2s8uxk8n8gfza3p9z9ewugw-xge.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/8o/um/83/8oum83fe_tkz8suqmxzg-evjpaa.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/iw/ma/is/iwmais_steqx3sfhwstdxk7ncwa.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est tout. </font><font style="vertical-align: inherit;">En ex√©cutant la configuration personnalis√©e, vous automatisez simplement les appels lambda fr√©quents √† partir de la console. </font><font style="vertical-align: inherit;">D'accord, assez confortable?</font></font><br>
<br>
<a name="Part4"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Test</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous parlons des types de tests pour les lambdas. </font><font style="vertical-align: inherit;">Puisque j'ai utilis√© Java dans l'exemple, les tests incluront √©galement des outils assez standard pour les tests unitaires et d'int√©gration: Junit 4, Mockito et PowerMockito.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests unitaires</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour couvrir le code lambda avec des tests unitaires, vous n'avez pas besoin d'avoir des connaissances sp√©cifiques. </font><font style="vertical-align: inherit;">Il suffit d'appliquer des pratiques Java standard: verrouillez toutes les d√©pendances de la classe et essayez de tester tous les cas possibles de traitement des requ√™tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas ajout√© tous les sc√©narios de test et je me suis limit√© √† deux sc√©narios positifs et deux n√©gatifs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier test positif v√©rifie que s'il existe un en-t√™te X-WARM-UP, il n'y a aucune demande dans DbService et EmailService. </font><font style="vertical-align: inherit;">Le second cas v√©rifie que ces services seront appel√©s si la demande est r√©elle. </font><font style="vertical-align: inherit;">Ce sont les tests les plus simples et j'ai omis une partie des v√©rifications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sc√©narios n√©gatifs sont une v√©rification des r√©ponses en cas d'erreur de traitement client ou serveur.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests d'int√©gration</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce qui concerne les tests d'int√©gration, j'ai d√©cid√© de v√©rifier DbService et son travail avec la table DynamoDB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, j'ai utilis√© l'outil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Localstack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette solution fournit des mokas gratuits pour les services AWS qui s'ex√©cutent en tant que conteneurs Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour installer cette solution, ex√©cutez simplement les commandes:</font></font><br>
<pre><code class="bash hljs">pip install localstack<font></font>
localstack start<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou vous pouvez utiliser le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier docker-compose</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-compose pour lever uniquement DynamoDB</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">version: <span class="hljs-string">'2.1'</span><font></font>
services:<font></font>
  localstack:<font></font>
    container_name: <span class="hljs-string">"<span class="hljs-variable">${LOCALSTACK_DOCKER_NAME-localstack_main}</span>"</span><font></font>
    image: localstack/localstack<font></font>
    ports:<font></font>
      - <span class="hljs-string">"4567-4599:4567-4599"</span>
      - <span class="hljs-string">"<span class="hljs-variable">${PORT_WEB_UI-8080}</span>:<span class="hljs-variable">${PORT_WEB_UI-8080}</span>"</span><font></font>
    environment:<font></font>
      - SERVICES=dynamodb<font></font>
      - DEBUG=<span class="hljs-variable">${DEBUG- }</span>
      - DATA_DIR=<span class="hljs-variable">${DATA_DIR- }</span>
      - PORT_WEB_UI=<span class="hljs-variable">${PORT_WEB_UI- }</span>
      - LAMBDA_EXECUTOR=<span class="hljs-variable">${LAMBDA_EXECUTOR- }</span>
      - KINESIS_ERROR_PROBABILITY=<span class="hljs-variable">${KINESIS_ERROR_PROBABILITY- }</span><font></font>
      - DOCKER_HOST=unix:///var/run/docker.sock<font></font>
    volumes:<font></font>
      - <span class="hljs-string">"<span class="hljs-variable">${TMPDIR:-/tmp/localstack}</span>:/tmp/localstack"</span>
      - <span class="hljs-string">"/var/run/docker.sock:/var/run/docker.sock"</span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La commande start d√©clenche tous les services AWS disponibles par d√©faut. </font><font style="vertical-align: inherit;">Pour augmenter DynamoDB sp√©cifiquement, il suffit de d√©finir la variable d'environnement:</font></font><br>
<pre><code class="bash hljs"><span class="hljs-built_in">set</span> SERVICES=dynamodb
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LocalstackTestRunner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sp√©cial </font><i><font style="vertical-align: inherit;">pour Junit</font></i><font style="vertical-align: inherit;"> qui vous permet de d√©marrer les services n√©cessaires √† l'aide de la configuration </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@LocalstackDockerProperties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, l'√©criture d'un test pour DbService ressemble √† ceci:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez la classe de test. </font></font><br>
<pre><code class="java hljs"><span class="hljs-meta">@RunWith(LocalstackTestRunner.class)</span>
<span class="hljs-meta">@LocalstackDockerProperties(services = { "dynamodb" })</span>
</code></pre> <br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er une table </font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-meta">@Before</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{<font></font>
    AmazonDynamoDB clientDynamoDB = TestUtils.getClientDynamoDB();<font></font>
    dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(clientDynamoDB);<font></font>
    dbService = <span class="hljs-keyword">new</span> DbService(dynamoDB);<font></font>
<font></font>
    dynamoDB.createTable(<font></font>
            <span class="hljs-keyword">new</span> CreateTableRequest()<font></font>
                    .withTableName(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                    .withKeySchema(<span class="hljs-keyword">new</span> KeySchemaElement(<span class="hljs-string">"Id"</span>, KeyType.HASH))<font></font>
                    .withAttributeDefinitions(<span class="hljs-keyword">new</span> AttributeDefinition(<span class="hljs-string">"Id"</span>, ScalarAttributeType.S))<font></font>
                    .withProvisionedThroughput(<span class="hljs-keyword">new</span> ProvisionedThroughput(<span class="hljs-number">10L</span>, <span class="hljs-number">10L</span>)));<font></font>
}<font></font>
                </code></pre><br>
 </div>
                    </div><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous d√©crivons le sc√©nario de test</font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-comment">// given</span>
ContactUsRequest contactUsRequest = <span class="hljs-keyword">new</span> ContactUsRequest(<span class="hljs-string">"subject"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"+79991234545"</span>, <span class="hljs-string">"123@mail.ru"</span>, <span class="hljs-string">"Qeustion"</span>);<font></font>
<font></font>
<span class="hljs-comment">// when</span>
dbService.putContactUsRequest(<span class="hljs-string">"123"</span>, contactUsRequest);<font></font>
<font></font>
<span class="hljs-comment">// then</span>
Item item = dynamoDB.getTable(<span class="hljs-string">"ContactUsTable"</span>).getItem(<span class="hljs-keyword">new</span> PrimaryKey(<span class="hljs-string">"Id"</span>, <span class="hljs-string">"123"</span>));<font></font>
assertEquals(contactUsRequest.getSubject(), item.get(<span class="hljs-string">"Subject"</span>));<font></font>
assertEquals(contactUsRequest.getUsername(), item.get(<span class="hljs-string">"Username"</span>));<font></font>
assertEquals(contactUsRequest.getPhone(), item.get(<span class="hljs-string">"Phone"</span>));<font></font>
assertEquals(contactUsRequest.getEmail(), item.get(<span class="hljs-string">"Email"</span>));<font></font>
assertEquals(contactUsRequest.getQuestion(), item.get(<span class="hljs-string">"Question"</span>));
              </code></pre><br>
 </div>
                    </div><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'oubliez pas de supprimer le tableau apr√®s le test.</font></font><br>
 <div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b>
                        <div class="spoiler_text"> <pre><code class="java hljs"><span class="hljs-meta">@After</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tearDown</span><span class="hljs-params">()</span> </span>{<font></font>
    dynamoDB.getTable(<span class="hljs-string">"ContactUsTable"</span>).delete();<font></font>
}<font></font>
               </code></pre><br>
 </div>
                    </div><br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, en utilisant Localstack, nous obtenons une gamme assez √©tendue de simulations AWS qui vous permettent d'√©muler le travail de ces services.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests E2E</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour jouer aux sc√©narios E2E, il est pr√©f√©rable d'augmenter les services de test AWS sp√©cifiquement pour l'ex√©cution de tests, si, bien s√ªr, il existe une telle opportunit√©. </font><font style="vertical-align: inherit;">Cela peut √™tre fait en utilisant le mod√®le CloudFormation facultatif, dans lequel les ressources seront des copies du mod√®le principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le test peut √™tre effectu√© en appelant le lambda via AWS-CLI et en traitant le r√©sultat avec n'importe quel outil disponible. </font><font style="vertical-align: inherit;">Vous pouvez toujours faire un appel dans les tests unitaires, mais sans cr√©er de mobs.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des tests de performance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que les tests de performances m√©ritent un article s√©par√© ou m√™me un livre, je n'essaierai pas de mettre toutes les informations ici. </font><font style="vertical-align: inherit;">En bref, lorsque vous parlez de tests de r√©sistance, vous devez vous rappeler que l'utilisation de presque tous les services AWS n'est pas gratuite et vous devez √™tre pr√™t √† estimer les co√ªts possibles √† l'avance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez √©valuer les ressources n√©cessaires pour un lambda, utilisez la console d'interface utilisateur et effectuez des appels de test. </font><font style="vertical-align: inherit;">Ensuite, √† l'aide d'une logique et de math√©matiques courantes, √©valuez l'augmentation des performances de votre lambda en fonction de la quantit√© de ressources disponibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N'oubliez pas CloudWatch. </font><font style="vertical-align: inherit;">Avec son aide, vous pouvez cr√©er des tableaux de bord assez indicatifs et en fonction de ceux-ci d√©terminer les param√®tres de lambda et les d√©penses que vous pouvez vous permettre.</font></font><br>
<br>
<a name="Part5"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Le co√ªt des solutions sans serveur</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©valuation d'une solution est toujours sp√©cifique, car vous devez prendre en compte non seulement le co√ªt d'un appel, mais √©galement le trafic entrant / sortant, le co√ªt de la mise en cache, de la journalisation et de la surveillance. </font><font style="vertical-align: inherit;">Si vous envisagez d'utiliser lambda, essayez de pr√©dire la charge que votre service va g√©rer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il s'agit d'appels uniques ou d'un processus ETL qui s'ex√©cute toutes les quelques heures / jours, le lambda est plus susceptible de porter ses fruits. </font><font style="vertical-align: inherit;">Si vous pr√©voyez une charge de plusieurs requ√™tes par seconde, assurez-vous de faire une estimation pr√©cise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessous, je donne des estimations approximatives du co√ªt du lambda et du serveur EC2 le moins cher, afin que vous compreniez quelles valeurs sont en question: </font><font style="vertical-align: inherit;">
Les param√®tres suivants pour le lambda ont √©t√© pris pour calculer:</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/p_/0w/ij/p_0wij6j_z2xop6dbt185485llc.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©lai:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 150 millisecondes</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prix:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,00001616 $ pour 1 Go-s</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©moire:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 256 Mo</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour EC2 t2.nano:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prix:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4,75 $ par mois</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©moire:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 512 Mo</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vCPU:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charge maximale:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5% CPU par mois</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai pris les donn√©es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> charge EC2 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">d'ici</font></a><font style="vertical-align: inherit;"> . D'apr√®s ces calculs, le serveur sp√©cifi√© peut supporter une charge constante de 0,3 requ√™tes par seconde. √Ä mesure que la charge augmente, le temps de r√©ponse augmentera, ce qui r√©duira l'efficacit√© de ce serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous ces calculs sont assez abstraits et ne prennent pas en compte de nombreux facteurs: remises sur un acompte ou un grand nombre de demandes, d√©lai d'ex√©cution lambda, etc. Mais ils montrent qu'avec une charge inf√©rieure √† 1 demande par seconde, lambda co√ªte moins cher que le serveur EC2 le moins cher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, n'oubliez pas d'ajouter le prix de l'ALB au prix de l'EC2 si vous devez conserver plusieurs r√©pliques d'applications ou IP √©lastiques.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/wc/md/grwcmd0t5swk3uwf-shmglewttu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les tests et le d√©veloppement local de solutions sans serveur sont moins populaires que les m√™mes microservices. </font><font style="vertical-align: inherit;">N√©anmoins, de plus en plus de personnes √©tudient et appliquent ces technologies et donnent la chance √† divers produits open source de devenir meilleurs et plus efficaces. </font><font style="vertical-align: inherit;">De telles solutions simplifient consid√©rablement la vie des entreprises qui doivent publier un produit d√®s que possible et ne pas avoir √† configurer l'ensemble de l'infrastructure. </font><font style="vertical-align: inherit;">Mais m√™me dans les produits d√©j√† d√©velopp√©s, je pense qu'il y a une place pour les bases de donn√©es sans serveur ou les lambdas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne pr√©tends pas √™tre un expert dans le domaine des tests de solutions sans serveur, mais, sur la base de mon exp√©rience personnelle positive, j'ai d√©cid√© de souligner les principaux points de cet article. </font><font style="vertical-align: inherit;">J'esp√®re qu'elles seront utiles √† quelqu'un, et peut-√™tre que certains d'entre vous pourront me compl√©ter ou m√™me me corriger, ce dont je serai tr√®s heureux.</font></font><br>
<br>
<a name="Part6"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles</font></font></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda en action. </font><font style="vertical-align: inherit;">Partie 1</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  GitHub</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Localstack Git </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> docker-compose   Localstack</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   EC2  AWS Lambda</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> AWS-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> SAM-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> AWS-CLI</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> SAM-</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   AWS Lambda</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr496742/index.html">√Ä propos d'une solution au probl√®me des voleurs et des prostitu√©es dans les syst√®mes de services √©ducatifs en ligne</a></li>
<li><a href="../fr496744/index.html">Comment √©conomiser des finances et m√™me gagner de l'argent face √† la chute des march√©s: les produits structurels</a></li>
<li><a href="../fr496750/index.html">Stratification, ou comment apprendre √† faire confiance aux donn√©es</a></li>
<li><a href="../fr496752/index.html">Comment le virus Ebola nous a appris √† g√©rer les donn√©es d'infection, et nous avons oubli√© toutes ses le√ßons</a></li>
<li><a href="../fr496754/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 506 (03.24.2020-30.03.2020)</a></li>
<li><a href="../fr496758/index.html">Soins de sant√© m√©di√©vaux num√©riques. Transformation technologique mondiale apr√®s COVID-19</a></li>
<li><a href="../fr496760/index.html">Flux d'utilisateurs: comment cr√©er des applications et des sites populaires</a></li>
<li><a href="../fr496762/index.html">Simulation d'√©rosion de surface bas√©e sur les particules</a></li>
<li><a href="../fr496764/index.html">Petit mais fier: DuckDuckGo vs Ad Monsters</a></li>
<li><a href="../fr496766/index.html">Qu'est-ce qu'Azure Stack HCI et comment √ßa marche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>