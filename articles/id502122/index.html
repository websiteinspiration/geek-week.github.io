<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏫 👩🏽‍🤝‍👨🏻 🏸 Thanos - Prometheus Terukur 🧐 🍃 👩🏿‍🤝‍👩🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Terjemahan artikel ini disiapkan khusus untuk siswa dari kursus "DevOps Practices and Tools" .
 
 
 
  (Fabian Reinartz) — , Go . Prometheus Kubernete...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos - Prometheus Terukur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terjemahan artikel ini disiapkan khusus untuk siswa dari kursus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"DevOps Practices and Tools"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  (Fabian Reinartz)</a> —   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  (Bartek Plotka)</a> —    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melihat produk SpatialOS andalan kami, Anda dapat menebak bahwa Improbable membutuhkan infrastruktur cloud global yang sangat dinamis dengan puluhan cluster Kubernetes. Kami adalah salah satu yang pertama menggunakan sistem pemantauan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Prometheus mampu melacak jutaan metrik secara waktu nyata dan dilengkapi dengan bahasa permintaan yang kuat untuk mengambil informasi yang diperlukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesederhanaan dan keandalan Prometheus adalah salah satu keunggulan utamanya. Namun, setelah melewati skala tertentu, kami mengalami beberapa kekurangan. Untuk mengatasi masalah ini, kami mengembangkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sebuah proyek open source yang dibuat oleh Improbable untuk mentransformasi cluster Prometheus yang ada menjadi sistem pemantauan tunggal dengan repositori data historis yang tidak terbatas. </font><font style="vertical-align: inherit;">Thanos tersedia di github di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ikuti terus berita terbaru dari Improbable.</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tujuan kami dengan Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada skala tertentu, masalah muncul yang melampaui kemampuan Prometheus vanila. </font><font style="vertical-align: inherit;">Bagaimana cara menyimpan petabytes data historis secara andal dan ekonomis? </font><font style="vertical-align: inherit;">Bisakah ini dilakukan tanpa mengurangi waktu respons terhadap permintaan? </font><font style="vertical-align: inherit;">Apakah mungkin untuk mengakses semua metrik yang terletak di server Prometheus yang berbeda dengan satu permintaan API? </font><font style="vertical-align: inherit;">Apakah mungkin untuk menggabungkan data replikasi yang dikumpulkan menggunakan Prometheus HA? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatasi masalah ini, kami menciptakan Thanos. </font><font style="vertical-align: inherit;">Bagian berikut menjelaskan bagaimana kami mendekati masalah ini dan menjelaskan tujuan yang kami kejar.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meminta data dari beberapa instance Prometheus (permintaan global)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus menawarkan pendekatan fungsional untuk sharding. Bahkan satu server Prometheus menyediakan skalabilitas yang cukup untuk membebaskan pengguna dari kesulitan sharding horizontal di hampir semua kasus penggunaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meskipun ini adalah model penyebaran yang sangat baik, seringkali diperlukan untuk mengakses data pada server Prometheus yang berbeda melalui satu API atau UI - tampilan global. Tentu saja, dimungkinkan untuk menampilkan beberapa permintaan dalam satu panel Grafana, tetapi setiap permintaan hanya dapat dijalankan pada satu server Prometheus. Di sisi lain, dengan Thanos, Anda dapat meminta dan mengumpulkan data dari beberapa server Prometheus, karena semuanya dapat diakses dari satu titik akhir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelumnya, untuk mendapatkan pandangan global tentang Improbable, kami mengatur instance Prometheus kami menjadi multi-level</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Federasi Hirarkis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ini berarti membuat satu server meta Prometheus yang mengumpulkan sebagian dari metrik dari setiap server daun, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yang terbukti bermasalah, menyulitkan konfigurasi, menambahkan titik potensi kegagalan tambahan dan menerapkan aturan kompleks untuk memberikan titik akhir federasi dengan data yang tepat. Selain itu, federasi semacam ini tidak memungkinkan Anda untuk mendapatkan tampilan global yang nyata, karena tidak semua data dapat diakses dari satu permintaan API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terkait erat dengan ini adalah presentasi tunggal data yang dikumpulkan pada server ketersediaan tinggi (HA) Prometheus. Model Prometheus HA secara independen mengumpulkan data dua kali, yang sangat sederhana sehingga tidak bisa lebih sederhana. Namun, menggunakan representasi gabungan dan deduplikasi dari kedua utas akan jauh lebih nyaman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, ada kebutuhan untuk server Prometheus yang sangat tersedia. Di Improbable, kami benar-benar serius memantau data setiap menit, tetapi memiliki satu instance Prometheus per cluster adalah satu titik kegagalan. Kesalahan konfigurasi atau kegagalan perangkat keras berpotensi menyebabkan hilangnya data penting. Bahkan penerapan sederhana dapat menyebabkan gangguan kecil dalam pengumpulan metrik, karena memulai ulang bisa secara signifikan lebih lama dari interval goresan.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyimpanan data historis yang andal</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyimpanan metrik murah, cepat, dan jangka panjang adalah impian kami (dibagikan oleh sebagian besar pengguna Prometheus). </font><font style="vertical-align: inherit;">Dalam Improbable, kami dipaksa untuk mengatur periode penyimpanan untuk metrik menjadi sembilan hari (untuk Prometheus 1.8). </font><font style="vertical-align: inherit;">Ini menambah batasan yang jelas untuk seberapa jauh kita bisa melihat ke belakang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus 2.0 lebih baik dalam hal ini, karena jumlah deret waktu tidak lagi memengaruhi kinerja server secara keseluruhan (lihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubeCon keynote tentang Prometheus 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Namun, Prometheus menyimpan data pada drive lokal. </font><font style="vertical-align: inherit;">Meskipun kompresi data yang sangat efisien dapat secara signifikan mengurangi penggunaan SSD lokal, masih ada batasan pada jumlah data historis yang disimpan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Improbable, kami juga memperhatikan keandalan, kesederhanaan, dan biaya. </font><font style="vertical-align: inherit;">Drive lokal yang besar lebih sulit dioperasikan dan dicadangkan. </font><font style="vertical-align: inherit;">Mereka lebih mahal dan membutuhkan lebih banyak alat cadangan, yang mengarah pada kompleksitas yang tidak perlu.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segera setelah kami mulai bekerja dengan data historis, kami menyadari bahwa ada kesulitan mendasar dengan O-big yang membuat permintaan menjadi lebih lambat dan lebih lambat jika kami bekerja dengan data selama berminggu-minggu, berbulan-bulan dan bertahun-tahun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi standar untuk masalah ini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downsampling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - downsampling sinyal. </font><font style="vertical-align: inherit;">Dengan downsampling, kami dapat "menurunkan" rentang waktu yang lebih besar dan mempertahankan jumlah sampel yang sama, yang memungkinkan kami mempertahankan responsif terhadap permintaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Downsampling data lama merupakan persyaratan yang tak terhindarkan dari solusi penyimpanan jangka panjang dan melampaui vanilla Prometheus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tujuan tambahan</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu tujuan awal proyek Thanos adalah untuk berintegrasi mulus dengan instalasi Prometheus yang ada. </font><font style="vertical-align: inherit;">Tujuan kedua adalah operasi sederhana dengan penghalang masuk minimum. </font><font style="vertical-align: inherit;">Setiap dependensi harus mudah dipenuhi untuk pengguna kecil dan besar, yang juga menyiratkan biaya dasar yang rendah.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsitektur Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah sasaran kami didaftar di bagian sebelumnya, mari kita kerjakan dan lihat bagaimana Thanos memecahkan masalah ini.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pandangan global</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mendapatkan tampilan global di atas instance Prometheus yang ada, kita perlu mengaitkan satu titik masuk permintaan dengan semua server. Inilah yang dilakukan komponen Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Itu ditempatkan di sebelah setiap server Prometheus dan bertindak sebagai proxy, melayani data Prometheus lokal melalui antarmuka gRPC Store, memungkinkan Anda untuk memilih data seri waktu berdasarkan label dan rentang waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sisi lain, ada komponen Querier scalable yang dapat dinegaskan secara horizontal yang sedikit lebih dari sekadar menanggapi permintaan PromQL melalui API HTTP Prometheus standar. Komponen Querier, Sidecar, dan Thanos lainnya berkomunikasi melalui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protokol gosip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat menerima permintaan, Querier terhubung ke server API Store yang sesuai, yaitu, untuk Sidecar kami, dan menerima data deret waktu dari server Prometheus yang sesuai.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah itu, menggabungkan jawaban dan melakukan permintaan PromQL pada mereka. </font><font style="vertical-align: inherit;">Querier dapat menggabungkan data terpisah dan duplikat data dari server Prometheus HA.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini memecahkan sebagian besar teka-teki kami - menggabungkan data dari server Prometheus yang terisolasi menjadi satu tampilan. </font><font style="vertical-align: inherit;">Bahkan, Thanos hanya bisa digunakan untuk kesempatan ini. </font><font style="vertical-align: inherit;">Server Prometheus yang ada tidak perlu melakukan perubahan apa pun!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umur simpan tidak terbatas!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, cepat atau lambat kami ingin menyimpan data yang melampaui waktu penyimpanan normal Prometheus. Untuk menyimpan data historis, kami telah memilih penyimpanan objek. Ini tersedia secara luas di cloud apa pun, serta di pusat data lokal dan sangat ekonomis. Selain itu, hampir semua penyimpanan objek dapat diakses melalui S3 API yang terkenal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus menulis data dari RAM ke disk kira-kira setiap dua jam. Blok data yang disimpan berisi semua data untuk periode waktu yang tetap dan tidak dapat diubah. Ini sangat nyaman, karena Thanos Sidecar dapat dengan mudah melihat katalog data Prometheus dan, ketika blok baru muncul, masukkan mereka ke dalam ember penyimpanan objek.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengunduh ke penyimpanan objek segera setelah menulis ke disk juga memungkinkan Anda menjaga kesederhanaan "pengikis" (Prometheus dan Thanos Sidecar). Yang menyederhanakan dukungan, biaya, dan desain sistem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, mencadangkan data sangat sederhana. Tapi bagaimana dengan menanyakan data dalam penyimpanan objek? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komponen Thanos Store bertindak sebagai proksi untuk mengambil data dari penyimpanan objek. Seperti Thanos Sidecar, ia berpartisipasi dalam cluster gosip dan mengimplementasikan API Store. Dengan demikian, Querier yang ada dapat menganggapnya sebagai Sidecar, sebagai sumber data deret waktu lain - tidak diperlukan konfigurasi khusus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blok data deret waktu terdiri dari beberapa file besar. Mengunduhnya sesuai permintaan akan sangat tidak efisien, dan caching lokal membutuhkan memori dan ruang disk yang besar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai gantinya, Store Gateway tahu bagaimana menangani format penyimpanan Prometheus. Berkat perencana kueri yang pintar dan caching hanya bagian indeks yang diperlukan dari blok, menjadi mungkin untuk mengurangi kueri kompleks ke jumlah minimum permintaan HTTP ke file penyimpanan objek. Dengan demikian, adalah mungkin untuk mengurangi jumlah permintaan sebanyak empat hingga enam urutan besarnya dan mencapai waktu tanggapan yang umumnya sulit dibedakan dari permintaan data pada SSD lokal.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti ditunjukkan pada diagram di atas, Thanos Querier secara signifikan mengurangi biaya permintaan data tunggal dalam penyimpanan objek dengan menggunakan format penyimpanan Prometheus dan menempatkan data terkait secara berdampingan. </font><font style="vertical-align: inherit;">Dengan menggunakan pendekatan ini, kami dapat menggabungkan banyak permintaan tunggal ke dalam jumlah minimum operasi massal.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemadatan dan downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah blok data deret waktu baru berhasil dimuat ke penyimpanan objek, kami menganggapnya sebagai data "historis" yang segera tersedia melalui Store Gateway. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, setelah beberapa saat, blok dari satu sumber (Prometheus dengan Sidecar) menumpuk dan tidak lagi menggunakan potensi pengindeksan penuh. Untuk mengatasi masalah ini, kami memperkenalkan komponen lain yang disebut Compactor. Ini hanya berlaku mekanisme pemadatan Prometheus lokal untuk data historis di toko objek dan dapat dijalankan sebagai pekerjaan batch periodik sederhana.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat kompresi yang efisien, meminta repositori dalam periode waktu yang lama tidak menimbulkan masalah dalam hal ukuran data. Namun, potensi biaya membongkar satu miliar nilai dan menjalankannya melalui pemroses kueri pasti akan mengarah pada peningkatan tajam dalam waktu eksekusi kueri. Di sisi lain, karena ada ratusan titik data per piksel layar, menjadi tidak mungkin untuk bahkan memvisualisasikan data dalam resolusi penuh. Dengan demikian, downsampling tidak hanya mungkin, tetapi tidak akan menyebabkan hilangnya akurasi yang nyata.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk downsampling data, Compactor terus mengumpulkan data dengan resolusi lima menit dan satu jam. Untuk setiap fragmen mentah yang dikodekan menggunakan kompresi TSDB XOR, berbagai jenis data agregat disimpan, seperti min, maks, atau jumlah untuk satu blok. Ini memungkinkan Querier untuk secara otomatis memilih agregat yang sesuai untuk kueri PromQL yang diberikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menggunakan data dengan akurasi yang lebih rendah, pengguna tidak memerlukan konfigurasi khusus. Querier secara otomatis beralih antara resolusi dan data mentah yang berbeda saat pengguna memperbesar dan memperkecil. Jika diinginkan, pengguna dapat mengontrol ini secara langsung melalui parameter "langkah" dalam permintaan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena biaya penyimpanan satu GB kecil, secara default Thanos menyimpan data asli, data dengan resolusi lima menit dan satu jam. </font><font style="vertical-align: inherit;">Tidak perlu menghapus data asli.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aturan perekaman</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan dengan aturan perekaman Thanos adalah bagian penting dari tumpukan pemantauan. </font><font style="vertical-align: inherit;">Mereka mengurangi kompleksitas, latensi dan biaya permintaan. </font><font style="vertical-align: inherit;">Mereka juga nyaman bagi pengguna untuk mendapatkan data metrik gabungan. </font><font style="vertical-align: inherit;">Thanos didasarkan pada instance vanilla dari Prometheus, sehingga sangat dapat diterima untuk menyimpan aturan rekaman dan mengingatkan aturan pada server Prometheus yang ada. </font><font style="vertical-align: inherit;">Namun, dalam beberapa kasus ini mungkin tidak cukup:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lansiran dan aturan global (misalnya, lansiran ketika layanan tidak dapat digunakan di lebih dari dua dari tiga kluster).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aturan untuk data di luar penyimpanan lokal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keinginan untuk menjaga semua aturan dan waspada di satu tempat.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk semua kasus ini, Thanos menyertakan komponen terpisah yang disebut Ruler, yang menghitung aturan dan peringatan melalui Kueri Thanos. </font><font style="vertical-align: inherit;">Dengan menyediakan StoreAPI yang terkenal, node Kueri dapat mengakses metrik yang baru dihitung. </font><font style="vertical-align: inherit;">Kemudian, mereka juga disimpan dalam penyimpanan objek dan tersedia melalui Store Gateway.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kekuatan Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos cukup fleksibel untuk disesuaikan dengan kebutuhan Anda. </font><font style="vertical-align: inherit;">Ini sangat berguna saat bermigrasi dari Prometheus sederhana. </font><font style="vertical-align: inherit;">Mari kita lihat apa yang kita pelajari tentang komponen-komponen Thanos. </font><font style="vertical-align: inherit;">Inilah cara mentransfer vanilla Prometheus Anda ke dunia "penyimpanan metrik tanpa batas":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan Thanos Sidecar ke server Prometheus Anda - misalnya, wadah yang berdekatan di pod Kubernetes.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perluas beberapa replika Thanos Querier untuk melihat data. </font><font style="vertical-align: inherit;">Pada titik ini, mudah untuk membuat gosip antara Scraper dan Querier. </font><font style="vertical-align: inherit;">Gunakan metrik 'thanos_cluster_members' untuk menguji interaksi komponen.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya dua langkah ini yang cukup untuk memberikan pandangan global dan deduplikasi data yang sempurna dari replika Prometheus HA yang potensial! </font><font style="vertical-align: inherit;">Cukup sambungkan dasbor Anda ke titik akhir HTTP Querier atau gunakan antarmuka UI Thanos secara langsung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, jika Anda harus mencadangkan metrik dan penyimpanan jangka panjang, Anda harus melakukan tiga langkah lagi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat Bucket AWS S3 atau GCS. </font><font style="vertical-align: inherit;">Konfigurasikan Sidecar untuk menyalin data ke bucket ini. </font><font style="vertical-align: inherit;">Sekarang Anda dapat meminimalkan penyimpanan data lokal.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perluas Store Gateway dan sambungkan ke kluster gosip yang ada. </font><font style="vertical-align: inherit;">Sekarang Anda dapat mengirim permintaan data dalam cadangan!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menyebarkan Compactor untuk meningkatkan kinerja kueri dalam jangka waktu lama menggunakan kompaksi dan downsampling.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin tahu lebih banyak, jangan ragu untuk melihat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contoh kubernet manifes kami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memulai</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hanya dalam lima langkah, kami telah mengubah Prometheus menjadi sistem pemantauan yang andal dengan tampilan global, waktu penyimpanan tanpa batas, dan potensi ketersediaan metrik yang tinggi.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan tarik: kami membutuhkan Anda!</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah proyek open source sejak awal. </font><font style="vertical-align: inherit;">Integrasi yang sempurna dengan Prometheus dan kemampuan untuk menggunakan hanya sebagian dari Thanos menjadikannya pilihan yang sangat baik untuk meningkatkan skala sistem pemantauan tanpa upaya ekstra. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami selalu menyambut Permintaan dan Masalah Tarik GitHub. </font><font style="vertical-align: inherit;">Pada saat yang sama, jangan ragu untuk menghubungi kami melalui Masalah Github atau mengendur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Improbable-eng #thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika Anda memiliki pertanyaan atau umpan balik, atau ingin berbagi pengalaman Anda! </font><font style="vertical-align: inherit;">Jika Anda menyukai apa yang kami lakukan di Improbable, jangan ragu untuk menghubungi kami - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kami selalu memiliki lowongan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelajari lebih lanjut tentang kursus.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id502104/index.html">Robot sekretaris, informan bot, ahli terapi bot dan proyek-proyek lain dari VirusHack hackathon online</a></li>
<li><a href="../id502114/index.html">Game Motivasi. Bagian 1</a></li>
<li><a href="../id502116/index.html">Tinjauan umum fitur PVS-Studio versi 7.07</a></li>
<li><a href="../id502118/index.html">Desain di tingkat sistem. Bagian 3: Menghubungkan Sistem Komposer dan MathWorks Toolchain</a></li>
<li><a href="../id502120/index.html">Pemantauan jarak jauh dan diagnostik peralatan produksi</a></li>
<li><a href="../id502124/index.html">Hasil usaha 2019 untuk Ukraina</a></li>
<li><a href="../id502126/index.html">Cara Meningkatkan Resume Programmer Bahasa Inggris Anda</a></li>
<li><a href="../id502132/index.html">Cara mentransfer wadah OpenVZ 6 ke server KVM tanpa sakit kepala</a></li>
<li><a href="../id502134/index.html">Cukup takut pada keputusan indah yang subyektif dalam kode - Anda bukan robot</a></li>
<li><a href="../id502136/index.html">Kompresi data di Apache Ignite. Pengalaman Sberbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>