<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèéÔ∏è üï¢ ‚ôüÔ∏è El libro "Bash y ciberseguridad: ataque, defensa y an√°lisis desde la l√≠nea de comando de Linux" üïì ‚§¥Ô∏è üîè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habrozhiteli! La l√≠nea de comando puede ser una herramienta ideal para la ciberseguridad. La incre√≠ble flexibilidad y la disponibilidad absoluta ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>El libro "Bash y ciberseguridad: ataque, defensa y an√°lisis desde la l√≠nea de comando de Linux"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/501528/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/xx/ml/ir/xxmlirxciwbxahmteiy-9cslfxg.jpeg" align="left" alt="imagen"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola habrozhiteli! </font><font style="vertical-align: inherit;">La l√≠nea de comando puede ser una herramienta ideal para la ciberseguridad. </font><font style="vertical-align: inherit;">La incre√≠ble flexibilidad y la disponibilidad absoluta convierten la interfaz de l√≠nea de comando est√°ndar (CLI) en una soluci√≥n fundamental si tiene la experiencia adecuada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los autores Paul Tronkon y Karl Albing hablan sobre herramientas y trucos de la l√≠nea de comando que ayudan a recopilar datos con protecci√≥n proactiva, analizar registros y monitorear el estado de la red. </font><font style="vertical-align: inherit;">Los Pentesters aprender√°n c√≥mo realizar ataques utilizando una funcionalidad colosal integrada en casi cualquier versi√≥n de Linux.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPara qui√©n es este libro?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El libro "Bash y ciberseguridad" est√° destinado a aquellos que desean aprender a trabajar con la l√≠nea de comandos en el contexto de la seguridad inform√°tica. </font><font style="vertical-align: inherit;">Nuestro objetivo no es reemplazar las herramientas existentes con scripts de l√≠nea de comandos, sino m√°s bien ense√±arle c√≥mo usar efectivamente la l√≠nea de comandos para mejorar la funcionalidad existente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A lo largo del libro, proporcionamos ejemplos de m√©todos de seguridad como la recopilaci√≥n de datos, an√°lisis y pruebas de penetraci√≥n. </font><font style="vertical-align: inherit;">El prop√≥sito de estos ejemplos es demostrar las capacidades de la l√≠nea de comandos y presentarle algunos de los m√©todos fundamentales utilizados en las herramientas de nivel superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este libro no es una introducci√≥n a la programaci√≥n, aunque algunos conceptos generales est√°n cubiertos en la Parte I.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoreo de registros en tiempo real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La capacidad de analizar una revista despu√©s de un evento es una habilidad importante. </font><font style="vertical-align: inherit;">Pero es igualmente importante poder extraer informaci√≥n del archivo de registro en tiempo real para detectar acciones maliciosas o sospechosas en el momento en que ocurren. </font><font style="vertical-align: inherit;">En este cap√≠tulo, consideraremos m√©todos para leer entradas de diario a medida que se crean y formatean para mostrar an√°lisis y generar alertas basadas en indicadores de amenazas conocidos para la operaci√≥n de un sistema o red (indicadores de compromiso).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoreo de registro de texto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma m√°s f√°cil de monitorear el registro en tiempo real es usar el comando tail con el par√°metro ‚Äìf: lee continuamente el archivo y lo muestra en stdout a medida que se agregan nuevas l√≠neas. Como en los cap√≠tulos anteriores, para ejemplos usaremos el registro de acceso al servidor web Apache, pero los m√©todos descritos son relevantes para cualquier registro de texto. Para rastrear el registro de acceso de Apache usando el comando tail, ingrese lo siguiente: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La salida del comando tail se puede pasar al comando grep, por lo que solo se mostrar√°n los registros que coincidan con ciertos criterios. El siguiente ejemplo rastrea el registro de acceso de Apache y muestra las entradas correspondientes a una direcci√≥n IP espec√≠fica:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | grep '10.0.0.152'<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n puedes usar expresiones regulares. En este ejemplo, solo se mostrar√°n los registros que devuelvan el c√≥digo de estado HTTP 404 "P√°gina no encontrada"; La opci√≥n -i se agrega para ignorar el caso de los caracteres: </font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i 'HTTP/.*" 404'</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
para borrar la informaci√≥n extra√±a, la salida se debe pasar al comando de corte. Este ejemplo monitorea el registro de acceso para consultas que conducen al c√≥digo de estado 404, y luego usa el m√©todo de corte para mostrar solo la fecha / hora y la p√°gina solicitada: </font><font style="vertical-align: inherit;">
Luego, para eliminar los corchetes y las comillas dobles, puede dirigir la salida a tr -d ' [] "'.</font></font><br>
<br>
<code>$ tail -f access.log | egrep --line-buffered 'HTTP/.*" 404' | cut -d' ' -f4-7<br>
[29/Jul/2018:13:10:05 -0400] "GET /test<br>
[29/Jul/2018:13:16:17 -0400] "GET /test.txt<br>
[29/Jul/2018:13:17:37 -0400] "GET /favicon.ico</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: aqu√≠ se usa la opci√≥n --line-buffering del comando egrep. </font><font style="vertical-align: inherit;">Esto obliga a egrep a imprimir en stdout cada vez que se produce un salto de l√≠nea. </font><font style="vertical-align: inherit;">Sin este par√°metro, se producir√° el almacenamiento en b√∫fer y la salida no se enviar√° al comando de corte hasta que el b√∫fer est√© lleno. </font><font style="vertical-align: inherit;">No queremos esperar tanto. </font><font style="vertical-align: inherit;">Esta opci√≥n permite que el comando egrep escriba cada l√≠nea a medida que se encuentra.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUFFERS DE LINEA DE MANDO </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© sucede durante el buffering? </font><font style="vertical-align: inherit;">Imagine egrep encuentra muchas cadenas que coinciden con el patr√≥n especificado. </font><font style="vertical-align: inherit;">En este caso, egrep tendr√° mucha salida. </font><font style="vertical-align: inherit;">Pero la salida (de hecho, cualquier entrada o salida) es mucho m√°s costosa (lleva m√°s tiempo) que el procesamiento de datos (b√∫squeda de texto). </font><font style="vertical-align: inherit;">Por lo tanto, cuantas menos llamadas de E / S, m√°s eficiente ser√° el programa.</font></font><br>
<br>
     grep       ,  ,          .         .  grep       .   ,  grep   50    .   ,     50  ,     ,     .   50  !<br>
<br>
       egrep, ,             .  egrep       ,     ,     .    ,    ,   ,      ,      .      ,     .<br>
<br>
    ,    ,  tail -f        (    ),       . ,       ¬´ ¬ª,      .     .          .<br>
<br>
   ,        egrep     ,     .        ,   .</blockquote><br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede usar los comandos tail y egrep para monitorear el registro y mostrar cualquier entrada que corresponda a patrones conocidos de actividad sospechosa o maliciosa, a menudo denominada IOC. Puede crear un sistema simple de detecci√≥n de intrusos (IDS). Primero, cree un archivo que contenga los patrones de expresi√≥n regular para el COI, como se muestra en el Ejemplo 8.1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo 8.1 ioc.txt </font><b><font style="vertical-align: inherit;">(1)</font></b><font style="vertical-align: inherit;"> Esta plantilla (../) es un indicador de un ataque de directorio indirecto: un atacante intenta salir del directorio de trabajo actual y acceder a archivos que no son accesibles para √©l. </font><b><font style="vertical-align: inherit;">(2) Los</font></b><font style="vertical-align: inherit;"> archivos Linux etc / passwd y etc / shadow se utilizan para la autenticaci√≥n del sistema y nunca se debe acceder a ellos a trav√©s de un servidor web. </font><b><font style="vertical-align: inherit;">(3)</font></b></font><br>
<br>
<code>\.\./ <b>(1)</b><br>
etc/passwd <b>(2)</b><br>
etc/shadow<br>
cmd\.exe <b>(3)</b><br>
/bin/sh<br>
/bin/bash<br>
</code><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servir los archivos cmd.exe, / bin / sh o / bin / bash es una indicaci√≥n de la conexi√≥n inversa devuelta por el servidor web. Una conexi√≥n inversa a menudo indica un intento de operaci√≥n exitoso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que los IOC deben estar en formato regex, ya que ser√°n utilizados m√°s adelante por el comando egrep. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El archivo ioc.txt se puede usar con la opci√≥n egrep -f. Este par√°metro le dice a egrep que busque los patrones de expresi√≥n regular del archivo especificado. Esto le permite usar el comando tail para monitorear el archivo de registro, y a medida que se agrega cada registro, la l√≠nea de lectura se comparar√° con todas las plantillas en el archivo IOC, mostrando cualquier registro correspondiente. Aqu√≠ hay un ejemplo:</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep -i -f ioc.txt</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, el comando tee se puede usar para mostrar simult√°neamente advertencias en la pantalla y guardarlas para su posterior procesamiento en su propio archivo: </font><font style="vertical-align: inherit;">
Una vez m√°s, la opci√≥n --line-buffer es necesaria para garantizar que no haya problemas causados ‚Äã‚Äãal almacenar el resultado del comando.</font></font><br>
<br>
<code>tail -f /var/logs/apache2/access.log | egrep --line-buffered -i -f ioc.txt |<br>
tee -a interesting.txt</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoreo de registro de Windows</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya se mencion√≥, debe usar el comando wevtutil para acceder a los eventos de Windows. </font><font style="vertical-align: inherit;">Aunque este comando es universal, no tiene una funcionalidad como tail, que puede usarse para recuperar nuevos registros entrantes. </font><font style="vertical-align: inherit;">Pero hay una salida: use un script bash simple que pueda proporcionar la misma funcionalidad (Ejemplo 8.2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo 8.2. </font><font style="vertical-align: inherit;">wintail.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# wintail.sh<font></font>
#<font></font>
# :<font></font>
#    tail   Windows<font></font>
#<font></font>
# : ./wintail.sh<font></font>
#<font></font>
<font></font>
WINLOG=<span class="hljs-string">"Application"</span> (<span class="hljs-number">1</span>)<font></font>
<font></font>
LASTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (2)</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span>
      CURRENTLOG=$(wevtutil qe <span class="hljs-string">"$WINLOG"</span> <span class="hljs-comment">//c:1 //rd:true //f:text) (3)</span>
      <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"$CURRENTLOG"</span> != <span class="hljs-string">"$LASTLOG"</span> ]]<font></font>
      then<font></font>
            echo <span class="hljs-string">"$CURRENTLOG"</span>
            echo <span class="hljs-string">"----------------------------------"</span>
            LASTLOG=<span class="hljs-string">"$CURRENTLOG"</span><font></font>
      fi<font></font>
done</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta variable define el registro de Windows que desea rastrear. Para obtener una lista de los registros actualmente disponibles en el sistema, puede usar el comando wevtutil el. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠, wevtutil se ejecuta para solicitar el archivo de registro especificado. El par√°metro c: 1 devuelve solo una entrada de registro. El par√°metro rd: true permite que el comando lea la entrada de registro m√°s reciente. Finalmente, f: text devuelve el resultado en texto plano, no en formato XML, lo que facilita la lectura del resultado desde la pantalla. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las siguientes l√≠neas ejecutan nuevamente el comando wevtutil y la entrada de registro reci√©n recibida se compara con la √∫ltima impresa en la pantalla. </font><font style="vertical-align: inherit;">Si difieren entre s√≠, esto significa que ha habido cambios en el registro. </font><font style="vertical-align: inherit;">En este caso, se muestra una nueva entrada. </font><font style="vertical-align: inherit;">Si los registros que se comparan son los mismos, no sucede nada y el comando wevtutil retrocede y comienza a buscar y comparar nuevamente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creaci√≥n de histogramas en tiempo real.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El comando tail -f proporciona el flujo de datos actual. </font><font style="vertical-align: inherit;">Pero, ¬øqu√© sucede si desea contar la cantidad de l√≠neas que se agregaron al archivo durante un cierto per√≠odo de tiempo? </font><font style="vertical-align: inherit;">Puede observar este flujo de datos, iniciar un temporizador y realizar el conteo durante un per√≠odo de tiempo espec√≠fico; </font><font style="vertical-align: inherit;">entonces se debe detener el conteo y reportar los resultados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este trabajo se puede dividir en dos procesos de script: un script leer√° las l√≠neas y el otro mirar√° la hora. El temporizador notifica al contador de l√≠nea utilizando un mecanismo de comunicaci√≥n entre procesos POSIX est√°ndar llamado se√±al. Una se√±al es una interrupci√≥n de software, y hay varios tipos de se√±ales. Algunos de ellos son fatales: conducen al final del proceso (por ejemplo, una excepci√≥n en una operaci√≥n de coma flotante). La mayor√≠a de estas se√±ales pueden ignorarse o capturarse. Se toman medidas cuando se detecta una se√±al. Muchas de estas se√±ales tienen un prop√≥sito predefinido en el sistema operativo. Utilizaremos una de las dos se√±ales disponibles para los usuarios. Esta es la se√±al SIGUSR1 (la otra es SIGUSR2).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los scripts de shell pueden detectar interrupciones utilizando el comando trap incorporado. Con su ayuda, puede seleccionar un comando que determina qu√© acci√≥n desea realizar cuando se recibe una se√±al, y una lista de se√±ales que activan una llamada a este comando. Por ejemplo: </font></font><br>
<br>
<code>trap warnmsg SIGINT</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto hace que se llame al comando warnmsg (nuestro propio script o funci√≥n) cada vez que el script de shell recibe una se√±al SIGINT, por ejemplo, cuando presiona Ctrl + C para interrumpir un proceso en ejecuci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo 8.3 muestra un script que realiza un recuento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo 8.3 looper.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# looper.sh<font></font>
#<font></font>
# :<font></font>
#    <font></font>
#<font></font>
# : ./looper.sh [filename]<font></font>
# filename ‚Äî  ,   ,<font></font>
#  : log.file<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">interval</span> <span class="hljs-params">()</span>                                           <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      echo $(date <span class="hljs-string">'+%y%m%d %H%M%S'</span>) $cnt                       (<span class="hljs-number">2</span>)<font></font>
      cnt=<span class="hljs-number">0</span><font></font>
}<font></font>
<font></font>
declare -i cnt=<span class="hljs-number">0</span>
<span class="hljs-function">trap interval <span class="hljs-title">SIGUSR1</span>                                          <span class="hljs-params">(<span class="hljs-number">3</span>)</span>

shopt -s <span class="hljs-title">lastpipe</span>                                              <span class="hljs-params">(<span class="hljs-number">4</span>)</span>

tail -f --pid</span>=$$ ${<span class="hljs-number">1</span>:-log.file} | <span class="hljs-function"><span class="hljs-keyword">while</span> read <span class="hljs-title">aline</span>             <span class="hljs-params">(<span class="hljs-number">5</span>)</span>
<span class="hljs-keyword">do</span>
     let cnt++
done</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se llamar√° a la funci√≥n de intervalo al recibir cada se√±al. Por supuesto, el intervalo debe definirse antes de que podamos nombrarlo y usar trap en nuestra expresi√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se invoca el comando de fecha para proporcionar una marca de tiempo para el valor de la variable cnt que estamos imprimiendo. Una vez que se muestra el contador, restablecemos este valor a 0 para comenzar la cuenta regresiva del siguiente intervalo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ahora que el intervalo est√° definido, podemos indicar que se llama a la funci√≥n cada vez que nuestro proceso recibe la se√±al SIGUSR1. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es un paso muy importante. Por lo general, cuando hay una tuber√≠a de comandos (por ejemplo, ls-l | grep rwx | wc), partes de la tuber√≠a (cada comando) se ejecutan en subredes y cada proceso finaliza con su propio identificador de proceso. Esto podr√≠a ser un problema para este escenario, porque el bucle while estar√° en una subshell con un identificador de proceso diferente. Independientemente del proceso que se inicie, el script looper.sh no conocer√° el identificador del proceso del bucle while para enviarle una se√±al. Adem√°s, cambiar el valor de la variable cnt en el subshell no cambia el valor cnt en el proceso principal, por lo que la se√±al para el proceso principal establecer√° cada vez el valor en 0. Puede resolver este problema con el comando shopt, que establece el par√°metro (-s) en lastpipe. Le dice al shell que no cree un subshell para el √∫ltimo comando en la tuber√≠a,y ejecuta este comando en el mismo proceso que el script mismo. En nuestro caso, esto significa que el comando tail se ejecutar√° en una subshell (es decir, en otro proceso), y el ciclo while pasar√° a formar parte del proceso del script principal. Nota: esta opci√≥n de shell solo est√° disponible en la versi√≥n bash 4.xy superior y solo para shells no interactivos (es decir, scripts).</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este es el comando tail -f con otro par√°metro --pid. Indicamos el identificador del proceso, que, al finalizar este proceso, terminar√° el comando de cola. Especificamos el ID de proceso del script de shell actual $$ para ser visto. Esta acci√≥n le permite limpiar procesos y no dejar el comando de cola ejecutado en segundo plano (si, por ejemplo, este script se ejecuta en segundo plano; Ejemplo 8.4). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script tailcount.sh comienza y detiene el script con un cron√≥metro (temporizador) y cuenta los intervalos de tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo 8.4. tailcount.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# tailcount.sh<font></font>
#<font></font>
# :<font></font>
#    n <font></font>
#<font></font>
# : ./tailcount.sh [filename]<font></font>
#     filename:  looper.sh<font></font>
#<font></font>
<font></font>
#  ‚Äî    <font></font>
<span class="hljs-function">function <span class="hljs-title">cleanup</span> <span class="hljs-params">()</span>
</span>{<font></font>
      [[ -n $LOPID ]] &amp;&amp; kill $LOPID          (<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-function">trap cleanup <span class="hljs-title">EXIT</span>                             <span class="hljs-params">(<span class="hljs-number">2</span>)</span>
bash looper.sh $1 &amp;                           <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
LOPID</span>=$!                                      (<span class="hljs-number">4</span>)<font></font>
#   <font></font>
sleep <span class="hljs-number">3</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span>
<span class="hljs-keyword">do</span><font></font>
      kill -SIGUSR1 $LOPID<font></font>
      sleep <span class="hljs-number">5</span>
done &gt;&amp;<span class="hljs-number">2</span>                                      (<span class="hljs-number">5</span>)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dado que este script ejecutar√° otros scripts, deber√≠a limpiarse despu√©s del trabajo. Si el identificador de proceso se almacen√≥ en LOPID, la variable almacenar√° el valor, por lo tanto, la funci√≥n enviar√° una se√±al a este proceso utilizando el comando kill. Si no especifica una se√±al espec√≠fica en el comando kill, la se√±al SIGTERM se enviar√° por defecto. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El comando EXIT no es una se√±al. Este es un caso especial cuando la instrucci√≥n trap le dice al shell que llame a esta funci√≥n (en este caso, limpieza) si el shell que ejecuta este script est√° a punto de cerrarse. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora comienza el verdadero trabajo. Se inicia el script looper.sh, que se ejecutar√° en segundo plano: para que este script funcione durante todo el ciclo (sin esperar a que el comando complete el trabajo), se desconecta del teclado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠, se almacena el identificador del proceso de script que acabamos de comenzar en segundo plano. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(5)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta redirecci√≥n es simplemente una precauci√≥n. Todos los resultados que provienen de un ciclo while o de las instrucciones kill / sleep (aunque no los esperamos) no deben mezclarse con ning√∫n resultado de la funci√≥n looper.sh, que, aunque se ejecuta en segundo plano, todav√≠a los env√≠a a stdout. Por lo tanto, redirigimos los datos de stdout a stderr.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resumir, vemos que aunque la funci√≥n looper.sh se coloc√≥ en segundo plano, su identificador de proceso se almacena en una variable de shell. Cada cinco segundos, el script tailcount.sh env√≠a una se√±al SIGUSR1 a este proceso (que se ejecuta en la funci√≥n looper.sh), que, a su vez, llama al script looper.sh para imprimir el n√∫mero actual de l√≠neas fijadas en √©l y reiniciar el conteo. Despu√©s de salir, el script tailcount.sh se borrar√° enviando una se√±al SIGTERM a la funci√≥n looper.sh para interrumpirlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la ayuda de dos guiones, un gui√≥n que realiza el recuento de l√≠neas y un gui√≥n con un cron√≥metro (temporizador) que controla el primer gui√≥n, puede obtener la salida (el n√∫mero de l√≠neas para un per√≠odo determinado), en funci√≥n del cual el pr√≥ximo gui√≥n crear√° un histograma. Se llama as√≠:</font></font><br>
<br>
<code>bash tailcount.sh | bash livebar.sh</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script livebar.sh lee datos de stdin e imprime el resultado en stdout, una l√≠nea para cada l√≠nea de entrada (Ejemplo 8.5). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo 8.5 </font><font style="vertical-align: inherit;">livebar.sh</font></font><br>
<br>
<pre><code class="java hljs">#!/bin/bash -<font></font>
#<font></font>
# Bash  <font></font>
# livebar.sh<font></font>
#<font></font>
# :<font></font>
#    ¬´¬ª <font></font>
#<font></font>
# :<font></font>
# &lt;output from other script or program&gt; | bash livebar.sh<font></font>
#<font></font>
<font></font>
<span class="hljs-function">function <span class="hljs-title">pr_bar</span> <span class="hljs-params">()</span>                                         <span class="hljs-params">(<span class="hljs-number">1</span>)</span>
</span>{<font></font>
      local raw maxraw scaled<font></font>
      raw=$<span class="hljs-number">1</span>
      maxraw=$<span class="hljs-number">2</span><font></font>
      ((scaled=(maxbar*raw)/maxraw))<font></font>
      ((scaled == <span class="hljs-number">0</span>)) &amp;&amp; scaled=<span class="hljs-number">1</span> #   
      <span class="hljs-keyword">for</span>((i=<span class="hljs-number">0</span>; i&lt;scaled; i++)) ; <span class="hljs-keyword">do</span> printf <span class="hljs-string">'#'</span> ; done<font></font>
      printf <span class="hljs-string">'\n'</span><font></font>
<font></font>
} # pr_bar<font></font>
<font></font>
maxbar=<span class="hljs-number">60</span>     #         (<span class="hljs-number">2</span>)<font></font>
MAX=<span class="hljs-number">60</span>
<span class="hljs-function"><span class="hljs-keyword">while</span> read dayst timst qty
<span class="hljs-keyword">do</span>
      <span class="hljs-title">if</span> <span class="hljs-params">(( qty &gt; MAX )</span>)                                   <span class="hljs-params">(<span class="hljs-number">3</span>)</span>
      then
           let MAX</span>=$qty+$qty/<span class="hljs-number">4</span>    #   <font></font>
           echo <span class="hljs-string">"                      **** rescaling: MAX=$MAX"</span><font></font>
      fi<font></font>
      printf <span class="hljs-string">'%6.6s %6.6s %4d:'</span> $dayst $timst $qty         (<span class="hljs-number">4</span>)<font></font>
      pr_bar $qty $MAX<font></font>
done<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La funci√≥n pr_bar muestra una cadena de hashtags que se escalan seg√∫n los par√°metros proporcionados al tama√±o m√°ximo. </font><font style="vertical-align: inherit;">Esta caracter√≠stica puede parecer familiar, ya que la usamos anteriormente en el script histogram.sh. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este es el tama√±o de l√≠nea de hashtag m√°s largo que podemos permitir (sin envolver la l√≠nea). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© tan grandes ser√°n los valores que se mostrar√°n? Sin saber esto de antemano (aunque estos datos se pueden proporcionar al script como argumento), el script realizar√° el seguimiento del m√°ximo. Si se excede este m√°ximo, el valor comenzar√° a "escalar" y las l√≠neas que ahora se muestran, y las l√≠neas futuras tambi√©n se escalar√°n a un nuevo m√°ximo. El script agrega un 25% al ‚Äã‚Äãvalor m√°ximo, por lo que no tiene que escalar el valor si el siguiente valor nuevo cada vez aumenta solo un 1-2%. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf define el ancho m√≠nimo y m√°ximo de los dos primeros campos que se imprimir√°n. </font><font style="vertical-align: inherit;">Estas son marcas de fecha y hora que se truncar√°n si se exceden los valores de ancho. </font><font style="vertical-align: inherit;">Para mostrar el valor completo, especifique su ancho de cuatro caracteres. </font><font style="vertical-align: inherit;">En este caso, a pesar de las restricciones, se imprimir√°n todos los valores. </font><font style="vertical-align: inherit;">Si el n√∫mero de caracteres en los valores es inferior a cuatro, los que faltan se completar√°n con espacios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que este script se lee desde stdin, puede ejecutarlo usted mismo para ver c√≥mo se comporta. </font><font style="vertical-align: inherit;">Aqu√≠ hay un ejemplo:</font></font><br>
<br>
<pre><code class="java hljs">$ bash  livebar.sh
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>
                       **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span>     <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
^C</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, la entrada se mezcla con la salida. </font><font style="vertical-align: inherit;">Tambi√©n puede poner la entrada en un archivo y redirigirlo a un script para ver solo la salida:</font></font><br>
<br>
<pre><code class="java hljs">$ bash livebar.sh &lt; testdata.txt<font></font>
bash livebar.sh &lt; x.data<font></font>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">20</span>:####################<font></font>
                 **** rescaling: MAX=<span class="hljs-number">87</span>
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">70</span>:################################################
<span class="hljs-number">201010</span> <span class="hljs-number">1020</span> <span class="hljs-number">75</span>:###################################################<font></font>
$</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬ªSe puede encontrar m√°s informaci√≥n sobre el libro en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el sitio web del editor</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extracto de</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Khabrozhiteley 25% de descuento en el cup√≥n - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bash</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tras el pago de la versi√≥n en papel del libro, se env√≠a un libro electr√≥nico por correo electr√≥nico.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es501516/index.html">¬øVamos a apagar el vac√≠o? Alexey Lesovsky</a></li>
<li><a href="../es501520/index.html">C # 8 y validez nula. ¬øC√≥mo vivimos con esto?</a></li>
<li><a href="../es501522/index.html">Seminarios web gratuitos de Skillbox: juegos de escritura en PHP, Unity y Unreal Engine</a></li>
<li><a href="../es501524/index.html">Secretos de sincronizaci√≥n de los campos electromagn√©ticos de la Tierra y un organismo vivo.</a></li>
<li><a href="../es501526/index.html">¬øPor qu√© el ingl√©s canadiense se considera "sucio" y qu√© tiene que ver Keanu Reeves con √©l?</a></li>
<li><a href="../es501534/index.html">Ahora con COVID-19 tambi√©n hay una erupci√≥n</a></li>
<li><a href="../es501536/index.html">Hecho a medida: una historia sobre c√≥mo una l√≠nea de c√≥digo se convirti√≥ en kilotones de carb√≥n</a></li>
<li><a href="../es501538/index.html">Sangr√≠a en Python - Opci√≥n de soluci√≥n</a></li>
<li><a href="../es501544/index.html">Tel√©fono inteligente perfecto</a></li>
<li><a href="../es501546/index.html">"¬øPor qu√© estoy pasando por esto?" - los psic√≥logos explican c√≥mo encontrar el significado de forma aislada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>