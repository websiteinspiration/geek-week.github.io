<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📪 👩🏼‍🏫 🙋🏽 Gestion des glissements dans un projet de jeu sur Godot Engine 🕞 👨🏽‍🏭 👩🏿‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations à tous! Aujourd'hui, je voudrais parler de la façon d'implémenter la gestion des glissements dans un projet de jeu pour Android sur le mot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Gestion des glissements dans un projet de jeu sur Godot Engine</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492144/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salutations à tous! </font><font style="vertical-align: inherit;">Aujourd'hui, je voudrais parler de la façon d'implémenter la gestion des glissements dans un projet de jeu pour Android sur le moteur Godot.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/773/b8a/443/773b8a4432cd4faa601f0b96aa425352.gif" alt="image"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'appelle Peter et je suis l'un des utilisateurs actifs du moteur de jeu Godot Engine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le segment de langue russe, il y a une énorme pénurie de matériel sur cet outil, ce qui me surprend beaucoup, car il est l'un des moteurs de jeu à la croissance la plus rapide. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il est à bien des égards inférieur à des moteurs tels que Unity, UE, etc., et vous ne ferez pas de jeu de classe AAA dessus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutefois! Il est gratuit (complet), multiplateforme (complet), et son poids est d'environ 60 mégaoctets, par opposition à la même unité.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur fonctionne sur la plupart des appareils, même si ces derniers proviennent d'une ligne très économique. Également «prêt à l'emploi», il est déjà russifié, dispose de tous les outils nécessaires à bord, ne nécessite pas de logiciel supplémentaire et ne consomme pas toute la RAM en cours d'exécution. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai déjà vu quelques articles sur Habré à ce sujet, et c'est très petit, car il est si sympathique pour le développeur que c'est une grosse omission de le dépasser et de ne pas l'essayer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sujet de cet article est l'implémentation de la gestion des swipes (gestes) dans un projet Android. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, l'expérience de mon utilisation du moteur est assez étendue et si le sujet obtient une réponse, je peux organiser un cours de formation complet. Par ce post, je veux au moins attirer votre attention sur le moteur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que langage de programmation, vous pouvez à nouveau utiliser deux options: GDScript et C #. J'utiliserai le premier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interface de l'éditeur principal ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/08c/413/508/08c41350881b6a2f1b89c16be70cfa7a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vous pouvez y travailler simultanément avec 3D, 2D, des scripts et en général tout ce dont un développeur peut avoir besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moteur utilise une approche dans laquelle votre jeu est un ensemble de scènes imbriquées les unes dans les autres. Et il peut y avoir une certaine confusion, car j'utilise le terme «scène» pour les nœuds qui ne sont que des scènes de jeu (situations, fenêtres, états de jeu (menus, jeux, etc.)), et pour d'autres cas j'utilise le terme "Prefab" emprunté à Unity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que dans cet article, je considérerai un cas particulier, je ne développerai pas certains sujets. Si quelque chose n'est pas clair, il y a des commentaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, la scène principale de la démonstration, nous aurons un jeu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sa structure ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b02/e02/749/b02e027490b4d5b53a0988584ce5819a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nœud racine du jeu stocke imbriqué en lui-même: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - monde, - stocke des données de niveau en lui </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - niveau, - un ensemble d'objets d'environnement (blocs, anneaux, obstacles) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - joueur, - objet joueur </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - - InterpolatedCamera, - lisse la caméra qui surveille l' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 interface - gui, - </font><font style="vertical-align: inherit;">du joueur </font><font style="vertical-align: inherit;">ne sera pas impliquée. Les </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
noms des objets et de la structure sont arbitraires et ce n'est qu'un cas particulier.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Près de certains objets, vous pouvez voir des icônes indiquant que cet objet est un préfabriqué (scène imbriquée) et qu'un script peut également y être ajouté. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, en cliquant sur l'icône «script», nous entrons dans l'éditeur de script, en fait, le mode de fonctionnement du moteur change simplement. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f10/ba8/178/f10ba8178d6fcdd585a2e31fe1d63088.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce mode de fonctionnement, vous pouvez modifier le comportement des objets. En fait, dans ce cas, c'est un script de l'objet monde qui, lors du chargement d'un objet dans le jeu, définit l'objet caméra (InterpolatedCamera) définit la cible du suivi.</font></font><br>
<br>
<pre><code class="python hljs">extends Spatial<font></font>
<font></font>
func _ready():<font></font>
	$InterpolatedCamera.target = <span class="hljs-string">'../player/camera'</span> <span class="hljs-comment">#  , ,         (  ).   player  "camera"   pivot.   .         .</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Syntaxiquement, GDScript est similaire à Python. Vous pouvez suivre une brève formation sur GDScript en russe ici: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre GDScript</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Avec l'objet monde, c'est clair, il définit simplement la cible de la caméra pour le suivi. L'objet suivant (déjà un enfant du monde) est le niveau. Sa structure ressemble à ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6c9/66c/d57/6c966cd5730b9f968c40ea4731c9b910.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, ce sont simplement des objets arrangés avec des propriétés physiques qui n'ont pas de scripts ou de comportement. En plus des objets "cellule". Ce sont des anneaux qui tournent et disparaissent au contact de l’objet du joueur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'objet joueur est le plus intéressant en ce moment, qui contient la logique de contrôle de balayage pour les écrans tactiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce préfabriqué ressemble à ceci: l' </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7b0/463/3ef/7b04633ef9eea50d04dafe2718a8c017.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
objet racine a un script, que nous verrons un peu plus tard. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérons d'abord les objets imbriqués.</font></font><br>
<br>
<ul>
<li>camera, —     ,      ,   .           player.</li>
<li>CollisionShape, —    .        «» .        ,     ,   .         .</li>
<li>MeshInstance, —    .     ,  .   Blender 3D ,   .</li>
<li>Tween,        .          .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, considérons maintenant le script lui-même dans l'objet racine. Il s'avère être le plus volumineux de tout le "jeu". </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2e8/e97/33d/2e8e9733deb908e37715c9ce68a90187.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, sa description et son décodage.</font></font><br>
<br>
<pre><code class="python hljs">
extends KinematicBody <span class="hljs-comment">#       </span><font></font>
<font></font>
<span class="hljs-comment">#  </span>
const GRAV = <span class="hljs-number">0.5</span> <span class="hljs-comment">#   (      Y, ..       ,     )</span>
const SPEED = <span class="hljs-number">2</span> <span class="hljs-comment">#  </span>
const SWIPE_SPEED = <span class="hljs-number">30</span> <span class="hljs-comment">#       </span>
const JUMP_SPEED = <span class="hljs-number">10</span> <span class="hljs-comment">#     </span><font></font>
<font></font>
onready var ball = $MeshInstance <span class="hljs-comment">#        </span>
onready var tween = $Tween <span class="hljs-comment">#      </span>
var vel = Vector3() <span class="hljs-comment">#     </span>
var swipe = <span class="hljs-string">''</span> <span class="hljs-comment">#       </span><font></font>
<font></font>
<font></font>
func _ready():<font></font>
	<span class="hljs-keyword">pass</span> <span class="hljs-comment">#        ;    </span><font></font>
<font></font>
<font></font>
<span class="hljs-comment">#       (60FPS)  </span>
func _physics_process(delta): <span class="hljs-comment"># delta -  Delta Time ,  ,    </span>
	vel.y -= GRAV <span class="hljs-comment">#      (  )</span>
	vel.z = -SPEED <span class="hljs-comment">#     .   </span>
	ball.rotate_x(-delta * SPEED * <span class="hljs-number">2</span>) <span class="hljs-comment">#     ,   ""</span><font></font>
<font></font>
	<span class="hljs-keyword">if</span> swipe &amp;&amp; swipe != <span class="hljs-string">'swiped'</span>: <span class="hljs-comment">#         </span>
		<span class="hljs-keyword">if</span> swipe == <span class="hljs-string">'up'</span> &amp;&amp; is_on_floor(): <span class="hljs-comment">#        ()</span>
			vel.y = JUMP_SPEED <span class="hljs-comment">#     ,   -  </span>
		<span class="hljs-keyword">elif</span> swipe == <span class="hljs-string">'left'</span> || swipe == <span class="hljs-string">'right'</span>: <span class="hljs-comment">#     </span>
			tween.interpolate_property(self, <span class="hljs-string">"translation"</span>, <span class="hljs-comment">#      </span>
				translation, translation+Vector3(<span class="hljs-number">-2</span> <span class="hljs-keyword">if</span> swipe == <span class="hljs-string">'left'</span> <span class="hljs-keyword">else</span> <span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">0.2</span>, <span class="hljs-comment">#    ,         X.      . -2  ,  2</span>
				Tween.TRANS_CUBIC, Tween.EASE_IN_OUT) <span class="hljs-comment">#     "" </span>
			tween.start() <span class="hljs-comment">#   </span>
		swipe = <span class="hljs-string">'swiped'</span> <span class="hljs-comment">#   ,   </span><font></font>
<font></font>
	vel = move_and_slide(vel, Vector3.UP) <span class="hljs-comment">#       ,                  </span><font></font>
<font></font>
<span class="hljs-comment">#       </span><font></font>
func _input(e):<font></font>
	<span class="hljs-keyword">if</span> e <span class="hljs-keyword">is</span> InputEventScreenDrag: <span class="hljs-comment"># ,       </span>
		<span class="hljs-keyword">if</span> !swipe: <span class="hljs-comment">#       </span>
			<span class="hljs-keyword">if</span> e.relative.y &lt; -SWIPE_SPEED: <span class="hljs-comment">#       Y</span>
				swipe = <span class="hljs-string">'up'</span> <span class="hljs-comment">#     (     )    ( ,          ),     " (UP)"</span>
			<span class="hljs-keyword">elif</span> e.relative.x &lt; -SWIPE_SPEED: <span class="hljs-comment">#      ,     X.     -  </span>
				swipe = <span class="hljs-string">'left'</span>
			<span class="hljs-keyword">elif</span> e.relative.x &gt; SWIPE_SPEED: <span class="hljs-comment">#  ,</span>
				swipe = <span class="hljs-string">'right'</span> <span class="hljs-comment">#  </span><font></font>
<font></font>
	<span class="hljs-keyword">elif</span> e <span class="hljs-keyword">is</span> InputEventScreenTouch: <span class="hljs-comment">#     </span>
		<span class="hljs-keyword">if</span> !e.pressed: <span class="hljs-comment">#      </span>
			swipe = <span class="hljs-string">''</span> <span class="hljs-comment">#   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai décrit chaque ligne, j'espère, avec des scripts tout est plus ou moins clair. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si en russe, alors lorsque nous déplaçons notre doigt sur l'écran, nous enregistrons le sens du mouvement et la vitesse. Si le doigt bouge à la vitesse désirée, on compte le glissement. En fonction de l'axe et de la direction du mouvement, nous avons trois options: HAUT, GAUCHE, DROITE. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous écrivons la valeur reçue dans une variable, qui est immédiatement captée par l'événement de mise à jour de l'état de l'objet, et effectue les actions nécessaires avec lui, après quoi il marque l'événement comme rempli et attend le suivant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas pris le moyen le plus simple pour implémenter un balayage, mais il est assez fiable et fonctionne dans la plupart des situations. Bien sûr, cela dépend du genre et du type de jeu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la suite du travail effectué, nous obtenons un exemple de la facilité avec laquelle il est possible de mettre en œuvre la gestion de balayage en dix minutes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au total, cela m'a pris environ 30 minutes, cela tient compte de la création de modèles dans Blender. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, selon la tradition ...</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vidéo de développement</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/b8NPIt0TqXU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  ,  </a><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492128/index.html">Interface Tales of Toxic Grandfather "Obtenez un chiffon!" (s1 e4)</a></li>
<li><a href="../fr492130/index.html">Mathématiques floues. Relations et queues de loup</a></li>
<li><a href="../fr492134/index.html">Avantages et inconvénients de faire des affaires aux États-Unis: impressions après trois ans de développement de deux sociétés</a></li>
<li><a href="../fr492138/index.html">Pourquoi surestimons-nous (éventuellement) la létalité de COVID-19</a></li>
<li><a href="../fr492140/index.html">Gueule de bois le 8 mars: un autre article sur Habré sur les femmes en informatique</a></li>
<li><a href="../fr492146/index.html">Alexander Pavlyuk: «Je veux vraiment que les plans de construction apparaissent progressivement dans OSM»</a></li>
<li><a href="../fr492148/index.html">Comment changer d'hébergement</a></li>
<li><a href="../fr492150/index.html">Implémentez-le complètement. Di-in-js</a></li>
<li><a href="../fr492154/index.html">Le lancement d'ExoMars reporté à la prochaine fenêtre de lancement en 2022</a></li>
<li><a href="../fr492156/index.html">Soustrait. Vouloir. Faire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>