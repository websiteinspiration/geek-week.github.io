<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏾 🎆 🍿 IIoTプラットフォームのデータベース：Mail.ru Cloud Solutionsが複数のデバイスからのペタバイトのデータを処理する方法 👨‍🏭 ⌚️ ☯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは。Mail.ruCloud Solutionsの IoTソリューション開発グループの責任者であるAndrey Sergeevです。ユニバーサルデータベースが存在しないことがわかっています。特に、センサーから毎秒数百万のイベントをほぼリアルタイムモードで処理できるモノのインターネットプラット...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IIoTプラットフォームのデータベース：Mail.ru Cloud Solutionsが複数のデバイスからのペタバイトのデータを処理する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/497570/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cq/9y/ln/cq9yln3qusppabwqddmvvyftzdk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんにちは。Mail.ruCloud </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solutionsの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IoTソリューション開発グループの責任者であるAndrey Sergeevです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ユニバーサルデータベースが存在しないことがわかっています。</font><font style="vertical-align: inherit;">特に、センサーから毎秒数百万のイベントをほぼリアルタイムモードで処理できるモノのインターネットプラットフォームを構築する必要がある場合。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当社の製品</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mail.ru IoT Platform</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Tarantoolに基づくプロトタイプから始まりました。</font><font style="vertical-align: inherit;">私たちが行った方法、発生した問題、およびそれらをどのように解決したかを説明します。</font><font style="vertical-align: inherit;">また、産業用モノのインターネットの最新プラットフォームの現在のアーキテクチャも示しています。</font><font style="vertical-align: inherit;">記事では、次のことを話します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース要件、ユニバーサルソリューション、CAPの定理について</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのアプローチでのデータベース+アプリケーションサーバーが特効薬かどうか。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォームとその中で使用されているデータベースの進化について</font></font></li>
<li> ,     Tarantool’       .</li>
</ul><a name="habracut"></a><br>
<i>  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">@Databases Meetup</a> by Mail.ru Cloud Solutions.    ,  :</i><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wigSv2_zWBU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2>Mail.ru IoT Platform   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当社の製品であるMail.ru IoTプラットフォームは、産業用モノのインターネットのためのソリューションを構築するための、ハードウェアに依存しないスケーラブルなプラットフォームです。</font><font style="vertical-align: inherit;">これにより、数十万のデバイスから同時にデータを収集し、カスタムルール（PythonまたはLuaのスクリプト）の使用を含め、このストリームをほぼリアルタイムモード（つまり、準リアルタイム）で処理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームはソースからの無制限の量の生データを保存でき、データを視覚化および分析するための既製のコンポーネントのセット、予測分析のための組み込みツール、およびプラットフォームに基づいたアプリケーションの作成があります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kz/eq/lx/kzeqlxssqhyx4fop4gl2ifrnxwe.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これがMail.ru IoTプラットフォームデバイスの外観です。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
現時点では、プラットフォームはお客様の施設のオンプレミスモデルに従ってインストールでき、今年はパブリッククラウドのサービスとしてプラットフォームをリリースする予定です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolプロトタイプ：すべての始まり</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのプラットフォームはパイロットプロジェクトとして始まりました-主要な機能は、OPAサーバーからデータフローを受信し、Luaスクリプトを使用してリアルタイムで受信したイベントを処理し、それらに基づいて主要なインジケーターを監視し、イベントとアラートを生成することでした。優れたシステム。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/2a5/f8c/2582a5f8c1d12d5717365bb82081efa4.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolプロトタイプスキーム</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このプロトタイプは、クラスターサイトで数か月間戦闘条件下で機能し、ペルシャ湾のイラクの公海での石油生産のためのプラットフォームです。</font><font style="vertical-align: inherit;">彼は主要な指標を監視し、視覚化システムとイベントログのデータを提供しました。</font><font style="vertical-align: inherit;">パイロットは成功したと認識されましたが、プロトタイプの場合と同様に、パイロットを超えず、プロトタイプが手に入るまで長い箱に入れられました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoTプラットフォームの開発における私たちの目標</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトタイプと一緒に、私たちは仕事をしました-本格的なスケーラブルでフォールトトレラントなIoTプラットフォームを作成することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の導入部を備えたプラットフォームを構築する必要がありました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数十万のデバイスを同時に接続します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1秒あたり数百万のイベントを受信します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ほぼリアルタイムモードでのストリーム処理。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数年間の生データの保存。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリーミング分析と履歴分析の両方のツール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大の災害復旧のための複数のデータセンターでの導入サポート。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォームプロトタイプの長所と短所</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
活発な開発が始まった時点では、プロトタイプは次のようになっています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース+アプリケーションサーバー（アプリケーションサーバー）として使用されるTarantool</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのデータはTarantoolのメモリに保存されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じTarantool内のLua上のアプリケーション。データを受信し、それを処理し、着信データでユーザースクリプトを呼び出す機能を実行します。</font></font></li>
</ul><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションを構築するこのアプローチには、次のような利点があり</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードとデータが1か所にあるため、アプリケーションのメモリ内のデータを直接操作でき、従来のアプリケーションに典型的なネットワーク訪問のオーバーヘッドコストを削減できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TarantoolはLuaにJIT（Just in Time Compiler）を使用します。これにより、コンパイル時にLuaコードがマシンコードにコンパイルされます。これにより、シンプルなLuaスクリプトをCコードに匹敵する速度で実行できます（1つのコアから40,000 RPS-これは制限ではありません） ！）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolは、協調マルチタスクに基づいています。つまり、ストアドプロシージャへの各呼び出しは、コルーチンのアナログである独自のファイバーで起動されます。これにより、ネットワークへのアクセスなど、I / O操作を伴うタスクのパフォーマンスがさらに向上します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースの効率的な使用-1つのCPUコアから毎秒40,000リクエストを処理できるツールはほとんどありません。</font></font></li>
</ol><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、重大な欠点があります</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスからの生データを数年間保存する必要がありますが、Tarantoolには数百ペタバイトのメモリがありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のプラスの直接的な結果：プラットフォームのコード全体がデータベース内のストアドプロシージャであるため、プラットフォームのコードベースの更新はデータベースの更新であり、これは非常に骨の折れる作業です。</font></font></li>
<li>  ,           .  ,        Tarantool       24-32   (Tarantool       )    .          —        Tarantool,    .</li>
<li>        .    - ,  Tarantool   Lua    ,   - ,  LuaJIT           .</li>
</ol><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MVPの作成にはTarantoolが適していますが、数十万のデバイスからデータを受信、処理、保存できる、本格的でスケーラブルで、簡単にサポートされ、フォールトトレラントなIoTプラットフォームには適合しません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちが取り除きたかったプロトタイプの主な問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、プロトタイプの2つの問題を解決したいと考えました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベース+アプリケーションサービスの概念から離れてください。</font><font style="vertical-align: inherit;">データストアに関係なく、アプリケーションコードを更新する必要がありました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">負荷がかかった状態で動的スケーリングを簡素化します。</font><font style="vertical-align: inherit;">できるだけ多くの関数を簡単に独立して水平方向にスケーリングしたかったのです。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題を解決するために、私たちは革新的でまだテストされていないアプローチを選択しました：マイクロサービスアーキテクチャとサービスのステートレス-アプリケーションとステートフル-データベースへの分離。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステートレスサービスの運用と水平スケーリングをさらに促進するために、それらをコンテナ化し、Kubernetesを採用しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/687/017/0db687017d254d99d9502d5b4362a4f2.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ステートレスサービスを見つけましたが、それはデータの処理方法を決定するために残っています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoTプラットフォームの基本的なデータベース要件</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、庭をフェンスで囲うのではなく、すべてのプラットフォームデータを1つのユニバーサルデータベースに格納する必要がありました。</font><font style="vertical-align: inherit;">目標を分析した後、ユニバーサルデータベースの要件の次のリストに到達しました。</font></font><br>
<br>
<ol>
<li><strong>ACID-</strong> —        ,          .</li>
<li><strong> </strong> —         .</li>
<li><strong>     </strong> —      ,         near real-time.</li>
<li><strong></strong> —        -    .</li>
<li><strong></strong> —      ,          .</li>
<li><strong> </strong> <strong>  </strong> —          (  !),     .</li>
<li><strong> </strong>—           ,       (      !).</li>
<li><strong>SQL</strong> —         .</li>
</ol><br>
<h2>      CAP-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要件に準拠するために市場に出回っているすべてのデータベースを整理する前に、かなりよく知られたツールであるCAP定理を使用して、健全性に関する要件を検証することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CAPの定理では、分散システムは次の3つのプロパティのうち最大2つを持つことができるとしています。</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一貫性（データの一貫性）</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ある時点のすべてのコンピューティングノードで、データが互いに矛盾しない。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用性</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -分散システムへの要求はすべて正しい応答で終了しますが、システム内のすべてのノードの回答が一致する保証はありません。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーティションの許容度</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ノード間に接続がない場合でも、ノードは互いに独立して機能し続けます。</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_p/8i/0o/_p8i0olwyxcps5ymii2x6j1diow.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、クラシックCAシステムは同期レプリケーションを備えたPostgreSQLマスター/スレーブクラスターであり、クラシックAPシステムはCassandraです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要件に戻り、CAP定理を使用してそれらを分類します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACIDトランザクションと厳密な整合性（または少なくとも結果整合性ではない）はCです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き込みと読み取り、および高可用性のための水平スケーリングはA（マルチマスター）です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォールトトレランスはPです。1つのデータセンターが故障しても、プラットフォームが停止することはありません。</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xv/fr/ju/xvfrjubabyxcsbepcrhpr_fuht0.jpeg"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：必要なユニバーサルデータベースには、CAP定理の3つのプロパティがすべて必要です。つまり、すべての要件に対応できるユニバーサルデータベースはありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoTプラットフォームが機能するデータ用のデータベースの選択</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニバーサルデータベースを選択できない場合は、プラットフォームで使用できるデータのタイプを選択し、タイプごとにデータベースを選択することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の近似では、データを2つのタイプに分けました。</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メタ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">情報</font></strong><font style="vertical-align: inherit;">は、世界、デバイス、設定、ルール、エンドデバイスを送信するものを除くほとんどすべてのデータのモデルです。</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスからの生データ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">デバイスからの</font></strong><font style="vertical-align: inherit;">センサー測定値、テレメトリ、サービス情報。</font><font style="vertical-align: inherit;">実際、これらは時系列であり、個々のメッセージには値とタイムスタンプが含まれています。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メタデータ用のデータベースの選択</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メタデータのデータベース要件</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。メタデータは本質的にリレーショナルです。それらは少量で特徴付けられ、ほとんど変更されませんが、重要なデータであり、失われることはありません。したがって、非同期レプリケーションのフレームワーク、およびACIDトランザクションと水平方向の読み取りスケーリング内でも一貫性が重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなデータは比較的少なく、比較的頻繁に変更されることもないため、事故が発生した場合に、記録への水平方向のスケーリングと、記録データベースにアクセスできない可能性を犠牲にすることができます。つまり、CAPの定理に関しては、CAシステムが必要です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは通常の場合に適してい</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。このような問題の説明があれば、PostgreSQLやMySQLのような非同期レプリケーションを備えたクラスターをサポートする従来のリレーショナルデータベースは、私たちに非常に適しています。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのプラットフォームの特徴</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。特定の要件を持つツリーのサポートも必要でした。プロトタイプの一部として、BDVVクラス（リアルタイムデータベース）のシステムの機能があり、タグツリーを使用して世界をモデリングしました。これらを使用すると、すべてのクライアントデバイスを1つのツリー構造に結合できるため、多数のデバイスとそのディスプレイの管理が容易になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/58e/f7e/b7c58ef7ef64fc742bcbd0f3190d5510.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、ツリー構造の形式でデバイスを表示する方法です。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このようなツリーを使用すると、エンドデバイスを環境にリンクできます</font><i><font style="vertical-align: inherit;">。</font></i><font style="vertical-align: inherit;">たとえば、物理的に1つの部屋にあるデバイスを1つのサブツリーに配置できるため、将来のデバイスでの作業が大幅に容易になります。</font><font style="vertical-align: inherit;">これは便利な機能であり、さらに、空中起爆装置システムのニッチで作業したかったので、そのような機能の存在は実際には業界標準です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タグツリーを完全に実装するには、潜在的なデータベースが次の要件を満たす必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意の幅と深さを持つツリーのサポート。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACIDトランザクションのツリー要素の変更。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツリーをトラバースするときの高いパフォーマンス。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラシックリレーショナルデータベースは小さなツリーをかなりうまく処理できますが、任意のツリーではうまく機能しません。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能な解決策。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのデータベースを使用します。ツリーを格納するグラフデータベースと、残りのメタ情報を格納するリレーショナルデータベースです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチには、いくつかの大きな欠点があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのデータベース間の整合性を確保するには、外部トランザクションコーディネーターを追加する必要があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この設計は維持するのが難しく、信頼性が高くありません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力では、1つではなく2つのデータベースが表示されますが、グラフデータベースは限られた機能をサポートするためにのみ必要です。</font></font></li>
</ol><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5db/00d/e2d/5db00de2daec50d59dded73a98bc932c.jpg"></div><br>
<h4><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つのデータベースを使用した、可能ではあるがあまりよくないソリューション</font></font></i></h4><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メタデータを保存するためのソリューション</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、当初、この機能はTarantoolに基づくプロトタイプに実装され、非常にうまく機能したことを思い出しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に進む前に、Tarantoolの非標準的な定義を示します</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Tarantoolはデータベースではなく、特定のケース用のデータベースを構築するための一連のプリミティブです。</font></font></strong><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに使えるプリミティブ：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スペース-データを格納するためのデータベース内のテーブルの類似物。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本格的なACIDトランザクション。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WALログを使用したレプリケーションは非同期です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動リシャーディングをサポートするシャーディングツール。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストアドプロシージャ用の超高速LuaJIT。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大規模な標準ライブラリ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに多くのパッケージを備えたLuaRocksパッケージマネージャー。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのCAソリューションは、Tarantoolに基づくリレーショナル+グラフデータベースでした。</font><font style="vertical-align: inherit;">Tarantoolプリミティブに基づいて、夢のメタ情報リポジトリを収集しました：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データストレージ用のスペース。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACIDトランザクション-利用可能でした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非同期複製-使用できました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関係-ストアドプロシージャに対して行われます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツリー-ストアドプロシージャでも作成されます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが持っているクラスターのインストールは、そのようなシステムにとって古典的です-書き込み用の1つのマスターと、読み取り用のスケーリングのための非同期レプリケーションを備えた複数のSlive。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果：リレーショナルデータベースとグラフデータベースの高速でスケーラブルなハイブリッド。</font><font style="vertical-align: inherit;">単一のTarantoolインスタンスは、アクティブなツリートラバーサルを含む、何千もの読み取りリクエストを処理できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスからのデータ用のデータベースの選択</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスからのデータのデータベース要件</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これらのデータは、頻繁な記録と大量のデータによって特徴付けられます：数百万のデバイス、数年のストレージ、受信メッセージと保存されたデータの両方のペタバイト単位の情報。主にユーザールールと当社の内部サービスの両方で動作するのはセンサーの読み取り値であるため、それらの高可用性は重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースの場合、読み取りと書き込みの水平方向のスケーリング、可用性とフォールトトレランス、およびこのデータ配列を操作するための既製の分析ツール（できればSQLに基づく）の可用性が重要です。同時に、一貫性とACIDトランザクションを犠牲にすることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、CAPの定理の枠組みでは、APシステムが必要です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加要件</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">膨大な量のデータを保存する場所を決定するために、いくつかの追加要件がありました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時系列-センサーからのデータは時系列であり、専門的なベースを取得したいと考えていました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンソース-オープンソースコードの利点はコメントを必要としません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のクラスターは、新しいデータベースに共通する問題です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優れた圧縮-データの量と一般的にそれらの均一性を考慮して、格納されたデータを効率的に圧縮したかった。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">運用の成功-リスクを最小限に抑えるために、誰かが負荷の近くですでにアクティブに活用しているデータベースから始めたかったのです。</font></font></li>
</ol><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの決定</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ClickHouseは、レプリケーション、マルチマスター、シャーディング、SQLサポート、無料のクラスターを備えた時系列の列ベースのデータベースである当社の要件にのみ適しています。</font><font style="vertical-align: inherit;">さらに、Mail.ruは、ストレージボリュームで最大のClickHouseクラスタの1つを操作する際に長年の成功を収めてきました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ClickHouseがどんなに優れていても、それには問題があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらのデバイスとそのソリューションのデータベースの問題</font></font></h3><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き込みパフォーマンスの問題。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐに、大きなデータストリームの書き込みパフォーマンスに問題が発生しました。イベントのフローをリアルタイムで分析するルールが特定のデバイスの履歴を確認し、アラートを生成するかどうかを決定できるように、これらはできるだけ迅速に分析データベースに取り込む必要があります。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題の解決策</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 ClickHouseは複数の単一の挿入（挿入）を許容しませんが、データの大きなバッチ（バッチ）でうまく機能します-何百万行もの記録バッチに簡単に対処します。着信データストリームをバッファし、このデータをバッチで貼り付けることにしました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66f/85b/77d/66f85b77dfb1fe8788658f7455bbb56b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">録画の</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
問題は解決されましたが、システムにデータが入力されてからデータベースに表示されるまでに数秒の大幅な遅延が発生しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、センサーからのデータにリアルタイムで応答するさまざまなアルゴリズムにとって重要です。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスの問題を確認。</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リアルタイムデータ処理のストリーム分析には、データベースからの情報が常に必要です。これらは数万の小さなクエリです。平均して、1つのClickHouseノードは同時に約100の分析クエリを保持します;これは、大量のデータを処理するための頻繁ではない重い分析クエリのために作成されました。もちろん、これは数十万のセンサーからのデータの流れの傾向を計算するのには適していません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20a/34a/2a9/20a34a2a9469b6a0276c8437a7dd6ec8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClickHouseは、リクエストの数が多いとうまく動作しません</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューション</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 ClickHouseの前にキャッシュを置くことにしました。これには、過去24時間に最もリクエストされたホットデータが含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過去24時間のデータは1年のデータではなく、かなりの量のデータでもあるため、ここでは、読み取りと書き込みの水平スケーリングを備えたAPシステムも必要ですが、単一のイベントの記録と複数のイベントの両方のパフォーマンスに重点を置いています読書。また、高可用性、時系列分析、持続性、および組み込みTTLも必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結局、速度を上げるためにすべてをメモリに格納できるクイックClickHouseが必要でした。</font><font style="vertical-align: inherit;">市場には適切なソリューションが見つからなかったため、Tarantoolプリミティブに基づいて構築することにしました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永続性-は（WALログ+スナップショット）です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンス-すべてのデータがメモリにあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケーリング-レプリケーション+シャーディングがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高可用性-あります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時系列分析ツール（グループ化、集計など）-ストアドプロシージャで作成。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TTL-1つのバックグラウンドファイバー（コルーチン）を使用したスト​​アドプロシージャで作成。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは便利で生産的なソリューションであることがわかりました-1つのインスタンスは、最大数万のクエリの分析クエリを含む、読み取り用に10,000 RPCを保持しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果のアーキテクチャは次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb3/ef4/260/fb3ef426007f70be5c2a737b75cea80b.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終的なアーキテクチャ：分析データベースとしてのClickHouseおよび24時間でデータを保存するTarantoolキャッシュ</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいデータ型-状態とそのストレージ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのデータに特化したデータベースを選択しましたが、プラットフォームが開発され、新しいデータタイプが表示されました-状態。</font><font style="vertical-align: inherit;">状態には、デバイスとセンサーの現在の状態、およびストリーム分析ルールのさまざまなグローバル変数が含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、部屋には電球があります。</font><font style="vertical-align: inherit;">オンとオフの両方を切り替えることができ、ルールを含め、常に現在の状態にアクセスできる必要があります。</font><font style="vertical-align: inherit;">別の例は、ストリームルールの変数です。たとえば、ある種のカウンターです。</font><font style="vertical-align: inherit;">このタイプのデータは、頻繁な記録と迅速なアクセスの必要性を特徴としていますが、同時に、データ自体は比較的少量です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メタ情報リポジトリは、状態が頻繁に変化する可能性があるため、これらのタイプのデータにはあまり適していません。この場合、記録の上限は1つのマスターに制限されます。</font><font style="vertical-align: inherit;">私たちの状態は3年前に最後に変更されたため、長期的な運用ストレージもあまり適していません。迅速な読み取りアクセス権を持つことが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、状態が保存されているデータベースの場合、読み取りと書き込みの水平スケーリング、高可用性、フォールトトレランスが重要ですが、値/ドキュメントのレベルで一貫性が必要です。</font><font style="vertical-align: inherit;">全体的な一貫性とACIDトランザクションを利用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
適切なソリューションは、任意のキー値またはドキュメントデータベース（陰影付きのRedisクラスター、MongoDB、またはTarantool）です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolの長所：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、Tarantoolを使用する最も一般的な方法です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水平スケーリング-非同期レプリケーション+シャーディングがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントレベルでの整合性-です。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、完全に異なるケースで使用する3つのTarantoolsができました。メタ情報の保存、デバイスからのデータの迅速な読み取りとステータスデータの保存です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoTプラットフォームのデータベースを選択する方法</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユニバーサルデータベースは存在しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各タイプのデータには、それに最適な独自のデータベースがあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なデータベースが市場で入手できない場合があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantoolは、特殊なデータベースの基礎として適しています。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この講演は</font><font style="vertical-align: inherit;">、Mail.ru Cloud Solutionsによって</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Databases Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で最初に行われ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他のパフォーマンスの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見て</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Mail.ru Groupの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Telegram </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Around Kubernetesの</font></a><font style="vertical-align: inherit;">イベントのお知らせを購読して</font><font style="vertical-align: inherit;">ください。</font></font><br>
<br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他に読むもの</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再度選択しないように、プロジェクトで選択するデータベース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceph以外：MCSクラウド内のブロックストレージ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ol><br>
</div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja497560/index.html">検疫がITの労働市場に与える影響</a></li>
<li><a href="../ja497562/index.html">Mitap：家にいてGOnline</a></li>
<li><a href="../ja497564/index.html">ローカルハックデー-オンラインハッカソン</a></li>
<li><a href="../ja497566/index.html">ハフマン圧縮アルゴリズム</a></li>
<li><a href="../ja497568/index.html">LANITの従業員がイタリアとベラルーシの遠隔地で働く方法</a></li>
<li><a href="../ja497572/index.html">lamp-luwakによるサービス指向の状態管理</a></li>
<li><a href="../ja497574/index.html">COVID-19パンデミックに関連した腫瘍学：最大の命を救う方法</a></li>
<li><a href="../ja497578/index.html">AMDは、データセンターの市場で大きなシェアを獲得することを約束します</a></li>
<li><a href="../ja497580/index.html">ハード検疫は非常に悪い</a></li>
<li><a href="../ja497582/index.html">Habrがユーザーのデジタル権利のランキングで1位に</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>