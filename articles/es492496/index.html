<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Ejemplo de Simple Notes SPA en Mithril.js  叼 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mithril.js es una herramienta impopular para construir aplicaciones web de clientes. Pr谩cticamente no hay publicaciones sobre Habr茅 sobre este tema. E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ejemplo de Simple Notes SPA en Mithril.js</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492496/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una herramienta impopular para construir aplicaciones web de clientes. </font><font style="vertical-align: inherit;">Pr谩cticamente no hay publicaciones sobre Habr茅 sobre este tema. </font><font style="vertical-align: inherit;">En esta publicaci贸n, quiero mostrar c贸mo puedes hacer una peque帽a aplicaci贸n en Mithril. </font><font style="vertical-align: inherit;">La aplicaci贸n se basar谩 en esta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publicaci贸n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">traducci贸n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驴Qu茅 es mihtril?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mithril es un marco reactivo dise帽ado para crear SPA (aplicaciones web de una sola p谩gina). En general, es solo javascript y 13 firmas de funciones API. Adem谩s, hay una biblioteca de flujo de mithril que no est谩 incluida en mithril y se usa por separado. El n煤cleo de mithril incluye el enrutamiento de la aplicaci贸n y el trabajo con solicitudes XHR. El concepto central es la abstracci贸n: un nodo virtual (vnode). Un nodo virtual es solo un objeto js con alg煤n conjunto de atributos. Los nodos virtuales son creados por la funci贸n especial m (). El estado actual de la interfaz se almacena en una lista de nodos virtuales (DOM virtual). En la representaci贸n inicial de la p谩gina de la aplicaci贸n, el DOM virtual se traduce al DOM. Cuando se inicia el controlador de eventos de la API DOM, cuando se completa la promesa m.request () y cuando cambia la URL (navegaci贸n a lo largo de las rutas de la aplicaci贸n), se genera una nueva matriz DOM virtual,se compara con el antiguo, y los nodos modificados cambian el DOM del navegador. Adem谩s de los eventos DOM y la finalizaci贸n de la solicitud m.request (), se puede llamar a redibujar manualmente con la funci贸n m.redraw ().</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay plantillas similares a HTML en mithril listas para usar, no hay soporte para JSX, aunque puede usar todo esto con varios complementos para construir si lo desea. No usar茅 estas oportunidades aqu铆. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el primer argumento para m () es una cadena (por ejemplo, 'div'), la funci贸n devuelve un nodo virtual simple y, como resultado, se mostrar谩 una etiqueta HTML en el DOM</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el primer argumento para m () es el objeto o la funci贸n que devuelve el objeto, entonces dicho objeto debe tener un m茅todo view (), y dicho objeto se llama componente. El m茅todo view () del componente, a su vez, siempre debe devolver la funci贸n m () (o una matriz del tipo: [m (),]). Por lo tanto, podemos construir una jerarqu铆a de objetos componentes. Y est谩 claro que, en 煤ltima instancia, todos los componentes devuelven nodos vnode simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanto los nodos virtuales como los componentes tienen m茅todos de ciclo de vida, y se denominan oninit (), oncreate (), onbeforeupdate (), etc. Cada uno de estos m茅todos se llama en un momento muy espec铆fico en la representaci贸n de la p谩gina.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede pasar par谩metros al nodo virtual o componente como un objeto, que deber铆a ser el segundo argumento para la funci贸n m (). Puede obtener un enlace a este objeto dentro del nodo utilizando la notaci贸n vnode.attrs. El tercer argumento para la funci贸n m () son los descendientes de este nodo y se puede acceder a trav茅s del enlace vnode.children. Adem谩s de la funci贸n m (), la funci贸n m.trust () devuelve nodos simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El autor de mithril no ofrece ning煤n patr贸n especial de dise帽o de aplicaciones, aunque aconseja evitar algunas soluciones fallidas, por ejemplo, componentes "demasiado gruesos" o manipular a los descendientes del 谩rbol de componentes. El autor tampoco ofrece formas o m茅todos especiales para controlar el estado de la aplicaci贸n como un todo o componentes. Aunque la documentaci贸n establece que no debe usar el estado del nodo en s铆, manip煤lelo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todas estas caracter铆sticas del mithril parecen muy inconvenientes, y el marco parece estar inacabado, no hay recomendaciones especiales, no hay estado / almacenamiento, no hay reductor / despachador de eventos, ni plantillas. </font><font style="vertical-align: inherit;">En general, haz lo que puedas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que necesitas para un ejemplo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usaremos:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js versi贸n 2.0.4</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">css library </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure.css</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versi贸n 1.0.1</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontawesome v5.12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para iconos</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rollup.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versi贸n 1.32 para </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">compilar</font></a><font style="vertical-align: inherit;"> la aplicaci贸n</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgREST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> versi贸n 5.2.0, como servidor REST de fondo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgresql versi贸n 9.6 o superior como una base de datos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El servidor frontend no es importante aqu铆, solo tiene que proporcionar al cliente index.html y archivos de script y de estilo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No instalaremos mithril en node_modules, y enlazaremos el c贸digo de la aplicaci贸n y el marco en un solo archivo. </font><font style="vertical-align: inherit;">El c贸digo de la aplicaci贸n y el mithril se cargar谩n en la p谩gina por separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No describir茅 el procedimiento de instalaci贸n de las herramientas, aunque puedo decir sobre postgREST, solo descargue el archivo binario, col贸quelo en una carpeta separada, cree un archivo de configuraci贸n test.conf como este:</font></font><br>
<br>
<pre><code class="plaintext hljs">db-uri = "postgres://postgres:user1@localhost:5432/testbase"<font></font>
server-port= 5000<font></font>
# The name of which database schema to expose to REST clients<font></font>
db-schema= "public"<font></font>
# The database role to use when no client authentication is provided.<font></font>
# Can (and probably should) differ from user in db-uri<font></font>
db-anon-role = "postgres" </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, su cl煤ster postgesql debe tener una base de base de prueba y usuario1. </font><font style="vertical-align: inherit;">En esta base de prueba, cree una tabla:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-comment">-- Postgrest sql notes table </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> notes (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">serial</span> primary <span class="hljs-keyword">key</span>,<font></font>
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">127</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">content</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
created <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,<font></font>
completed <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-built_in">time</span> zone,<font></font>
ddel <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El inicio del servidor postgREST se realiza con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">postgrest test.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu茅s de iniciar el servidor, muestra mensajes informativos sobre la conexi贸n a la base de datos y en qu茅 puerto escuchar谩 a los clientes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planificando un proyecto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, si se entiende m谩s o menos c贸mo funciona Mitril, debe descubrir c贸mo hacer la aplicaci贸n. </font><font style="vertical-align: inherit;">Aqu铆 est谩 el plan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenaremos los datos de la aplicaci贸n en un objeto local, llamemos a su modelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las aplicaciones API se almacenar谩n en un archivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almacenaremos rutas de aplicaciones en un archivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El archivo de ruta ser谩 el punto de entrada para crear la aplicaci贸n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada componente separado (y usar茅 el esquema de representaci贸n de componentes) y las funciones asociadas con 茅l se almacenar谩n en un archivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada componente que representa los datos del modelo tendr谩 acceso al modelo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los controladores de eventos DOM de componentes se localizan en el componente</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, no necesitamos eventos personalizados, m谩s bien eventos DOM nativos, las devoluciones de llamada para estos eventos se localizan en los componentes. </font><font style="vertical-align: inherit;">Usar茅 el enlace bidireccional. </font><font style="vertical-align: inherit;">Quiz谩s no a todos les gusta este enfoque, pero no a todos les gusta redux o vuex. </font><font style="vertical-align: inherit;">Adem谩s, la t茅cnica de enlace unidireccional tambi茅n se puede implementar de manera elegante en mitril usando mithril-sream. </font><font style="vertical-align: inherit;">Pero en este caso, esta es una soluci贸n redundante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estructura de carpetas de aplicaciones</font></font></h3><br>
<img src="https://habrastorage.org/webt/yp/uy/fa/ypuyfap4tlxl_ccqo86wbtb9h98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carpeta p煤blica ser谩 servida por el servidor frontal, hay un archivo index.html y directorios con estilos y scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carpeta src contiene la ra铆z del enrutador y la definici贸n de API, y dos directorios, para el modelo y las vistas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la ra铆z del proyecto hay un archivo de configuraci贸n rollup.config, y el proyecto se construye usando el comando:</font></font><br>
<br>
<pre><code class="bash hljs">rollup c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para no aburrir al lector con los largos trozos de c贸digo que est谩n disponibles en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo comentar茅 los principales elementos de implementaci贸n para demostrar un enfoque idiom谩tico para mitral.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API y enrutador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C贸digo API:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// used by backend server</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> restApi= {
  <span class="hljs-attr">notes</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">'notes'</span>, <span class="hljs-attr">editable</span>: [<span class="hljs-string">'add'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'del'</span>] }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// used by routers</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appApi = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">"/"</span>,<font></font>
}<font></font>
<span class="hljs-comment">// used by navBar</span>
<span class="hljs-comment">// here array of arrays though it may be hash eg</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appMenu = [<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Home'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'About'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Contacts'</span>],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defin铆 una API para el servidor REST y para el enrutador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enrutador:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { restApi, appApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'./appApi'</span>;
<span class="hljs-keyword">import</span> { moModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/moModel'</span>;
<span class="hljs-keyword">import</span> { vuView, vuApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuApp'</span>;
<span class="hljs-keyword">import</span> { vuNavBar } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuNavBar'</span>;<font></font>
<font></font>
<span class="hljs-comment">// application router</span>
<span class="hljs-keyword">const</span> appRouter = { [appApi.root]: {<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> view = m(vuApp, {
      <span class="hljs-attr">model</span>: moModel.getModel( restApi.notes ),<font></font>
    });<font></font>
    <span class="hljs-keyword">return</span> vuView( {<span class="hljs-attr">menu</span>: vuNavBar}, view);<font></font>
  }<font></font>
}};<font></font>
<font></font>
<span class="hljs-comment">// once per app</span>
m.route(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">"/"</span>, appRouter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 el enrutador est谩 montado en el cuerpo del documento. </font><font style="vertical-align: inherit;">El enrutador en s铆 es un objeto que describe las rutas y los componentes que se utilizar谩n en esta ruta, la funci贸n render () deber铆a devolver vnode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El objeto appApi define todas las rutas de aplicaci贸n v谩lidas y el objeto appMenu define todos los elementos de navegaci贸n posibles para la aplicaci贸n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci贸n de representaci贸n, cuando se llama, genera un modelo de aplicaci贸n y lo pasa al nodo ra铆z.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo de aplicaci贸n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La estructura que almacena datos relevantes, la llam茅 modelo. </font><font style="vertical-align: inherit;">El c贸digo fuente de la funci贸n que devuelve el modelo:</font></font><br>
<br>
<pre><code class="javascript hljs">getModel(<font></font>
    {url=<span class="hljs-literal">null</span>, method=<span class="hljs-string">"GET"</span>, order_by=<span class="hljs-string">'id'</span>, editable=<span class="hljs-literal">null</span>} = {}<font></font>
  ) {<font></font>
<span class="hljs-comment">/**
  * url - string of model's REST API url
  * method - string of model's REST method
  * order_by - string "order by" with initially SELECT 
  * editable - array defines is model could changed
*/</span>
    <span class="hljs-keyword">const</span> model = {
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">method</span>: method,
      <span class="hljs-attr">order_by</span>: order_by,
      <span class="hljs-attr">editable</span>: editable,
      <span class="hljs-attr">key</span>: order_by, <span class="hljs-comment">// here single primary key only</span>
      <span class="hljs-attr">list</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// main data list </span>
      <span class="hljs-attr">item</span>: {}, <span class="hljs-comment">// note item</span>
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Promise error</span>
      <span class="hljs-attr">save</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// save status</span>
      <span class="hljs-attr">editMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// view switch flag</span>
      <span class="hljs-attr">word</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// dialog header word</span><font></font>
    };  <font></font>
    model.getItem= <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {<font></font>
      model.item= {};<font></font>
      <span class="hljs-keyword">if</span> ( !id ) {<font></font>
        model.editMode= <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">const</span> key= model.key;
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> it <span class="hljs-keyword">of</span> model.list ) {
        <span class="hljs-keyword">if</span> (it[key] == id) {<font></font>
          model.item= <span class="hljs-built_in">Object</span>.assign({}, it);
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> model;<font></font>
  },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Aqu铆 se inicializa y devuelve el objeto modelo. </font><font style="vertical-align: inherit;">Los enlaces dentro del objeto pueden cambiar, pero el enlace al objeto en s铆 permanece constante. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem谩s de la funci贸n getModel, el objeto global moModel tiene funciones envolventes para la funci贸n m.request () mitry, estas son getList (modelo) y formSubmit (evento, modelo, m茅todo). </font><font style="vertical-align: inherit;">El par谩metro modelo es en realidad una referencia al objeto modelo, el evento es el objeto de evento que se genera cuando se env铆a el formulario, el m茅todo es el m茅todo HTTP con el que queremos guardar la nota (POST es una nota nueva, PATCH, DELETE es antigua).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Representaci贸n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La carpeta de vista contiene funciones que son responsables de representar elementos de p谩gina individuales. </font><font style="vertical-align: inherit;">Los divid铆 en 4 partes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuApp: el componente ra铆z de la aplicaci贸n, </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNavBar - barra de navegaci贸n,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes: una lista de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formulario de edici贸n de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuDialog: elemento de di谩logo HTML </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El enrutador determina que vuView (men煤, vista) se devuelve en una sola ruta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Definici贸n de esta funci贸n:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuView= <span class="hljs-function">(<span class="hljs-params">appMenu, view</span>)=&gt;</span> m(vuMain, appMenu, view);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es solo un contenedor que devuelve el componente vuMain, si el objeto appMenu es lo suficientemente complejo como para tener objetos anidados en una estructura similar a un objeto externo, entonces dicho contenedor es una forma adecuada de devolver un componente con diferentes elementos de navegaci贸n y componentes secundarios (solo necesita escribir menos c贸digo) . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Componente VuMain:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> vuMain= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-comment">// We use ivnode as argument as it is initial vnode</span>
  <span class="hljs-keyword">const</span> { menu }= ivnode.attrs;
  <span class="hljs-keyword">return</span> { view(vnode) {
    <span class="hljs-comment">// IMPORTANT !</span>
    <span class="hljs-comment">// If we use vnode inside the view function we MUST provide it for view</span>
    <span class="hljs-keyword">return</span> [<font></font>
      m(menu),<font></font>
      m(<span class="hljs-string">'#layout'</span>, vnode.children)<font></font>
    ];<font></font>
  }};<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto simplemente devuelve los vnodos de la navegaci贸n y el contenido real de la p谩gina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De aqu铆 en adelante, donde sea posible definir un componente, usar茅 cierres. </font><font style="vertical-align: inherit;">Los cierres se llaman una vez durante la representaci贸n inicial de la p谩gina y almacenan localmente todos los enlaces pasados a objetos y definiciones de sus propias funciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cierre como definici贸n siempre debe devolver un componente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en realidad el componente de contenido de la aplicaci贸n:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuApp= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-comment">//initially get notes</span><font></font>
  moModel.getList( model );<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() { 
    <span class="hljs-keyword">return</span> [<font></font>
      m(vuNotes, { model }),<font></font>
      m(vuNoteForm, { model }),<font></font>
      vuModalDialog(model)<font></font>
    ];<font></font>
  }};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya tenemos un modelo, cuando llamo a un cierre, quiero obtener la lista completa de notas de la base de datos. </font><font style="vertical-align: inherit;">Habr谩 tres componentes en la p谩gina:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes: una lista de notas con el bot贸n Agregar,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formulario de edici贸n de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuModalDialog: un elemento de di谩logo que mostraremos modalmente y se cerrar谩 cuando sea necesario. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como cada uno de estos componentes necesita saber c贸mo dibujarse, pasamos un enlace al objeto modelo en cada uno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lista de notas de componentes:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//Notes List</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuNotes= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-keyword">const</span> _display= <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> model.editMode ? <span class="hljs-string">'display:none'</span>: <span class="hljs-string">'display:block'</span>;
  <span class="hljs-keyword">const</span> vuNote= noteItem(model); <span class="hljs-comment">// returns note function</span><font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() {
    <span class="hljs-keyword">return</span> model.error ? m(<span class="hljs-string">'h2'</span>, {<span class="hljs-attr">style</span>: <span class="hljs-string">'color:red'</span>}, model.error) :<font></font>
    !model.list ? m(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'...LOADING'</span> ) :<font></font>
    m(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">style</span>: _display() }, [<font></font>
      m(addButton , { model } ),<font></font>
      m(<span class="hljs-string">'.pure-g'</span>, m(<span class="hljs-string">'.pure-u-1-2.pure-u-md-1-1'</span>,<font></font>
        m(<span class="hljs-string">'.notes'</span>, model.list.map( vuNote ) )<font></font>
      ))<font></font>
    ]);<font></font>
  }};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El indicador bool editMode se almacena en el objeto modelo; si el valor del indicador es verdadero, entonces mostramos el formulario de edici贸n; de lo contrario, una lista de notas. </font><font style="vertical-align: inherit;">Puede elevar la prueba un nivel m谩s alto, pero luego el n煤mero de nodos virtuales y los nodos DOM reales cambiar铆an cada vez que se cambie el indicador, y esto es un trabajo innecesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 somos idiom谩ticos para mitril, generamos una p谩gina, verificando la presencia o ausencia de atributos en el modelo utilizando operadores ternarios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 est谩 el cierre que devuelve la funci贸n de visualizaci贸n de notas:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noteItem= <span class="hljs-function"><span class="hljs-params">model</span>=&gt;</span> {
  <span class="hljs-comment">// click event handler</span>
  <span class="hljs-keyword">const</span> event= <span class="hljs-function">(<span class="hljs-params"> msg, word=<span class="hljs-string">''</span>, time=<span class="hljs-literal">null</span></span>)=&gt;</span> <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    model.getItem(e.target.getAttribute(<span class="hljs-string">'data'</span>));
    <span class="hljs-keyword">if</span> ( !!msg ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">msg</span>: msg };<font></font>
      model.word= word;<font></font>
      <span class="hljs-keyword">if</span> ( !!time )<font></font>
        model.item.completed= time;<font></font>
      vuDialog.open();<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      model.editMode= <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  };<font></font>
  <span class="hljs-comment">// trash icon's click handler</span>
  <span class="hljs-keyword">const</span> _trash= event(<span class="hljs-string">'trash'</span>, <span class="hljs-string">'Dlelete'</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// check icon's click handler</span>
  <span class="hljs-keyword">const</span> _check= event(<span class="hljs-string">'check'</span>, <span class="hljs-string">'Complete'</span>,
    <span class="hljs-comment">// postgre timestamp string</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString().split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">' '</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// edit this note</span>
  <span class="hljs-keyword">const</span> _edit= event(<span class="hljs-string">''</span>);<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> _time= <span class="hljs-function"><span class="hljs-params">ts</span>=&gt;</span> ts.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>];<font></font>
  <font></font>
  <span class="hljs-comment">// Single Note </span>
  <span class="hljs-keyword">const</span> _note= <span class="hljs-function"><span class="hljs-params">note</span>=&gt;</span> m(<span class="hljs-string">'section.note'</span>, {<span class="hljs-attr">key</span>: note.id}, [<font></font>
    m(<span class="hljs-string">'header.note-header'</span>, [ m(<span class="hljs-string">'p.note-meta'</span>, [
      <span class="hljs-comment">// note metadata</span>
      m(<span class="hljs-string">'span'</span>, { <span class="hljs-attr">style</span>: <span class="hljs-string">'padding: right: 3em'</span> }, <span class="hljs-string">`Created: <span class="hljs-subst">${_time( note.created )}</span>`</span>),<font></font>
      note.completed ? m(<span class="hljs-string">'span'</span>, <span class="hljs-string">`  Completed: <span class="hljs-subst">${_time( note.completed )}</span>`</span>) : <span class="hljs-string">''</span>, 
      <span class="hljs-comment">// note right panel </span>
      m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-trash'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _trash } )),<font></font>
      note.completed ? <span class="hljs-string">''</span> : [<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-pen'</span>, {<span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _edit } )),<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-check'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _check} ))<font></font>
      ]<font></font>
    ]),<font></font>
      m(<span class="hljs-string">'h2.note-title'</span>, { <span class="hljs-attr">style</span>: note.completed ? <span class="hljs-string">'text-decoration: line-through'</span>: <span class="hljs-string">''</span>}, note.title)<font></font>
    ]),<font></font>
    m(<span class="hljs-string">'.note-content'</span>, m(<span class="hljs-string">'p'</span>, note.content))<font></font>
  ]);<font></font>
  <span class="hljs-keyword">return</span> _note;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los manejadores de clics se definen localmente. El modelo no sabe c贸mo est谩 estructurado el objeto de nota, solo defin铆 la propiedad clave, con la que podemos seleccionar el elemento deseado de la matriz model.list. Sin embargo, el componente debe saber exactamente c贸mo est谩 estructurado el objeto que dibuja. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dar茅 el texto completo del c贸digo del formulario para editar la nota; solo miraremos el controlador de env铆o de formularios por separado:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// form submit handler</span>
  <span class="hljs-keyword">const</span> _submit= <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    e.preventDefault();<font></font>
    model.item.title= clean(model.item.title);<font></font>
    model.item.content= clean(model.item.content);<font></font>
    <span class="hljs-keyword">const</span> check= check_note(model.item);
    <span class="hljs-keyword">if</span> ( !!check ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">msg</span>: check }; <font></font>
      model.word= <span class="hljs-string">'Edit'</span>;<font></font>
      vuDialog.open();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> moModel.formSubmit(e, model, _method() ).then(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { model.editMode=<span class="hljs-literal">false</span>; <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}).catch(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { vuDialog.open(); <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } );<font></font>
  };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dado que la definici贸n se produce en el cierre, tenemos un enlace al modelo, y devolvemos una promesa con el procesamiento posterior del resultado: la prohibici贸n de mostrar el formulario cuando la solicitud se completa normalmente, o en caso de error: abrir un di谩logo con el texto de error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que accede al servidor de fondo, se vuelve a leer la lista de notas. </font><font style="vertical-align: inherit;">En este ejemplo, no es necesario ajustar la lista en la memoria, aunque esto se puede hacer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El componente de di谩logo se puede ver en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo 煤nico que debe enfatizarse es que en este caso us茅 un objeto literal para definir el componente, porque quiero que las funciones de apertura y cierre de la ventana est茅n disponibles para otros componentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi贸n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribimos una peque帽a aplicaci贸n de SPA en javascript y mithril.js, tratando de mantener los modismos de este marco. </font><font style="vertical-align: inherit;">Quiero prestar atenci贸n una vez m谩s que esto es solo c贸digo javascript. </font><font style="vertical-align: inherit;">Quiz谩s no del todo limpio. </font><font style="vertical-align: inherit;">El enfoque le permite encapsular peque帽os fragmentos de c贸digo, aislar la mec谩nica de un componente y utilizar un estado com煤n para todos los componentes.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es492482/index.html">Eventos digitales en Mosc煤 del 16 al 22 de marzo.</a></li>
<li><a href="../es492484/index.html">Eventos digitales en San Petersburgo del 16 al 22 de marzo.</a></li>
<li><a href="../es492486/index.html">Nuxt + Django + GraphQL por ejemplo</a></li>
<li><a href="../es492488/index.html">OpenID Connect: autorizaci贸n de aplicaciones internas de gen茅rico a est谩ndar</a></li>
<li><a href="../es492492/index.html">NikiRobot - una evoluci贸n en rob贸tica educativa</a></li>
<li><a href="../es492500/index.html">Science Garage en ruso. Experiencia traduciendo un show americano</a></li>
<li><a href="../es492502/index.html">MIP * = RE: evidencia de la 茅poca del campo de la inform谩tica que caus贸 el efecto domin贸 en f铆sica y matem谩ticas</a></li>
<li><a href="../es492504/index.html">驴Qu茅 sucede cuando un m贸dulo JS se importa dos veces?</a></li>
<li><a href="../es492506/index.html">3 formas de renderizar listas grandes en Angular</a></li>
<li><a href="../es492508/index.html">Libro Kubernetes para DevOps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>