<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙🏼 👂🏻 👢 ZigbeeリレーSonoff BASICZBR3（ds18b20センサー付き）のZ-Stack 3.0上のTI cc2530のファームウェアを作成しています 👆🏽 🕋 👩🏾‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="読者はすでにC言語の初期知識があり、Zigbee、cc2530チップ、フラッシュおよび使用方法に関する知識があり、zigbee2mqttなどのプロジェクトにも精通していることが前提です。そうでない場合は、準備するか、https：//myzigbee.ruおよびhttps://www.zigbee2m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ZigbeeリレーSonoff BASICZBR3（ds18b20センサー付き）のZ-Stack 3.0上のTI cc2530のファームウェアを作成しています</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/495926/"><img src="https://habrastorage.org/webt/pk/k8/1r/pkk81rmgifam0ccamhmapnesahq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読者はすでにC言語の初期知識があり、Zigbee、cc2530チップ、フラッシュおよび使用方法に関する知識があり、zigbee2mqttなどのプロジェクトにも精通していることが前提です。</font><font style="vertical-align: inherit;">そうでない場合は、準備するか、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https：//myzigbee.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.zigbee2mqtt.io/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で読んで</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください。</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
記事は最初に詳細に書かれていますが、徐々に加速し、詳細に止まることはありませんが、完成したファームウェアコードについて説明しています。</font><font style="vertical-align: inherit;">誰かが推論に興味がない場合は、ファームウェアのソースを開いてそれらを読んでください。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成したファームウェアのソースコード</font></font></a><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
コードと開発アプローチは理想的であると主張していません。</font><font style="vertical-align: inherit;">「私は魔術師ではありません、ただ学んでいます。」</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な目標は、Z-Stackのファームウェアを長い間記述する方法を理解することです。</font><font style="vertical-align: inherit;">そのため、完成した機器に代替ファームウェアを実装し（例として</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff BASICZBR3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リレーを選択</font><font style="vertical-align: inherit;">）、人気のあるds18b20温度センサーを接続する機能を追加することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、Z-StackでTI cc2530チップ用のファームウェアを開発する例を初心者Zigbee開発者に見せたかったのです。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.準備</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発を開始するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z-Stack 3.0.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をダウンロードしてインストールする必要</font><font style="vertical-align: inherit;">があります。これは、サンプルとドキュメントを含むファームウェアを開発するためのSDKです。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">8051用のIAR Embeded Workbench</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
をダウンロードしてインストールする必要もあります。</font><font style="vertical-align: inherit;">これは、TI cc2530チップ用にコンパイルできる開発環境です。</font><font style="vertical-align: inherit;">使用の無料期間は1か月です（ただし、シーカーは解決策を見つけます）。</font><font style="vertical-align: inherit;">
開発とデバッグには、CCDebuggerを使用します。これにより、cc2531 / cc2530チップのフラッシュだけでなく、IAR環境でのアプリケーションのデバッグも可能になります。</font><font style="vertical-align: inherit;">
実験、プロトタイピング、デバッグを単純化するために、開発ボードと対応するcc2530モジュールで実行します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/aj/pr/_jajpr3cvn5q93lo6_igpenpdly.jpeg"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/xc/cq/qlxccqkdbxnqt3pcuo8049lj0ci.jpeg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.新しいアプリケーションを作成する</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GenericAppに基づいて新しいプロジェクトを作成します。</font><font style="vertical-align: inherit;">これは、基本的なZ-Stackアプリケーションの例です。</font><font style="vertical-align: inherit;">Z-Stack 3.0.2 \ Projects \ zstack \ HomeAutomation \ GenericAppフォルダーにあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
近くにコピーして、たとえばDIYRuZRTに名前を変更します（デバイスのアプリケーションを呼び出しましょう）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CC2530DBフォルダー内にはファイルがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.ewd-C-SPYのプロジェクト設定</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.ewp-プロジェクトファイル</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenericApp.eww-ワークスペース</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの名前をDIYRuZRT.ewwおよびDIYRuZRT.ewpに変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのファイル（Sourceフォルダーを含む）内で、GenericAppへのすべての参照をDIYRuZRTに変更します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、IARでDIYRuZRT.ewpプロジェクトを開きます。 RouterEBの構成を選択し、Rebuild Allを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fb/re/mb/fbremb-ma8rcyafhwdcj6klys9k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RouterEBフォルダーがCC2530DBフォルダーに作成され、DIYRuZRT.d51ファイルがEXEフォルダー内に表示されます。このファイルは、IARからのフラッシュおよびデバッグに便利です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、SmartRF Flash Programmerを介してファームウェアをフラッシュする必要がある場合は、小さな変更を加えます。これを行うには、[出力]タブの[リンク]セクションのプロジェクト設定で、出力ファイルと形式の設定を変更します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r5/cb/xl/r5cbxlrunrutiwxxgt-gytlwjz4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、DIYRuZRT.hexファームウェアファイルがEXEフォルダーに作成され、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他のツールからのフラッシュや他の方法でのフラッシュ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に便利</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">です</font></a><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、このファームウェアをアップロードした後、デバイスはネットワークに接続しません。</font><font style="vertical-align: inherit;">さて、わかります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ちょっとした用語</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zigbeeの用語には、次の概念があります。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンドポイント</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -エンドデバイスの説明ポイント。</font><font style="vertical-align: inherit;">通常、単純なデバイスでは1つのエンドポイント。</font><font style="vertical-align: inherit;">それらのいくつかは、多機能デバイスだけでなく、異なる対話プロファイル（1つのプロファイル-1つのエンドポイント）を持つデバイスにも存在する可能性があります。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスター（クラスター）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -単一の機能に関連する属性とコマンドのセット（オン/オフ、調光、温度測定など）。</font><font style="vertical-align: inherit;">クラスターは、エンドポイントによって実現される機会を示します。</font><font style="vertical-align: inherit;">1つのエンドポイントで、複数の異なるクラスターを実装できますが、同じクラスターを実装することはできません。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性（属性）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -値の読み取りまたは書き込みが可能なクラスターの特性。</font><font style="vertical-align: inherit;">クラスターは多くの属性を持つことができます。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンド</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -クラスターが処理できる制御メッセージ。</font><font style="vertical-align: inherit;">チームにはパラメータがある場合があります。</font><font style="vertical-align: inherit;">これは、コマンドとパラメーターを受け取ったときに実行される関数によって実装されます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターのタイプ、属性、コマンドはZigbee Cluster Libraryで標準化されています。</font><font style="vertical-align: inherit;">ただし、メーカーは独自の属性とチームを持つ独自のクラスターを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かわいそうなプロデューサーの中には、標準を気にせず、標準について何かをする人もいます。</font><font style="vertical-align: inherit;">次に、それらに適応する必要があります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Z-Stackの</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
用語</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、次のような独自の概念もあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL（オペレーティングシステムアブストラクションレイヤー）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">オペレーティングシステム</font></b><font style="vertical-align: inherit;">のアブストラクションレベル。</font><font style="vertical-align: inherit;">ここでは、タスク（タスク）、メッセージ（メッセージ）、イベント（イベント）、タイマー（タイマー）、およびその他のオブジェクトを操作します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL（ハードウェアアブストラクションレイヤー）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -機器のアブストラクションのレベル。</font><font style="vertical-align: inherit;">ここでは、ボタン（キー）、LED（LED）、割り込み（割り込み）などで動作します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハードウェア層は、プログラムコードとそれが制御する機器を分離します。</font><font style="vertical-align: inherit;">運用レベルは、アプリケーション要素間の構築および相互作用のためのメカニズムを提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをすべて使用すると、以下、そして原則として、ファームウェアを開発するときにあなたを待つことができます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.基本アプリケーション内には何がありますか？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションコードはSourceフォルダにあります。</font></font><br>
<br>
<ul>
<li><i>OSAL_DIYRuZRT.c</i> —    <br>
</li>
<li><i>zcl_DIYRuZRT.h</i> —  <br>
</li>
<li><i>zcl_DIYRuZRT.c</i> —   <br>
</li>
<li><i>zcl_DIYRuZRT_data.c</i> —  ,   <br>
</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL_DIYRuZRT.c-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハンドラータスク（タスク）</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pTaskEventHandlerFn tasksArrの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列で埋められ、</font><font style="vertical-align: inherit;">初期化関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osalInitTasks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を販売する</font><font style="vertical-align: inherit;">マスターファイル&nbsp; </font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの初期化子とハンドラーを実装するには、他のすべてのファイルが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクハンドラーのリスト</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pTaskEventHandlerFn tasksAr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rには、関数参照が入力されます。一部のタスクは、対応するコンパイルディレクティブによって接続/切断されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定義済みシンボルコンパイラオプションでコンパイルディレクティブを表示および構成できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/tl/u6/pntlu6bioazjsoaywmdfofeloas.png"><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> pTaskEventHandlerFn tasksArr[] = {<font></font>
  macEventLoop,<font></font>
  nwk_event_loop,<font></font>
#<span class="hljs-keyword">if</span> !defined (DISABLE_GREENPOWER_BASIC_PROXY) &amp;&amp; (ZG_BUILD_RTR_TYPE)<font></font>
  gp_event_loop,<font></font>
#endif  <font></font>
  Hal_ProcessEvent,<font></font>
#<span class="hljs-keyword">if</span> defined( MT_TASK )<font></font>
  MT_ProcessEvent,<font></font>
#endif<font></font>
  APS_event_loop,<font></font>
#<span class="hljs-keyword">if</span> defined ( ZIGBEE_FRAGMENTATION )<font></font>
  APSF_ProcessEvent,<font></font>
#endif<font></font>
  ZDApp_event_loop,<font></font>
#<span class="hljs-keyword">if</span> defined ( ZIGBEE_FREQ_AGILITY ) || defined ( ZIGBEE_PANID_CONFLICT )<font></font>
  ZDNwkMgr_event_loop,<font></font>
#endif<font></font>
  <span class="hljs-comment">//Added to include TouchLink functionality</span>
  #<span class="hljs-keyword">if</span> defined ( INTER_PAN )<font></font>
    StubAPS_ProcessEvent,<font></font>
  #endif<font></font>
  <span class="hljs-comment">// Added to include TouchLink initiator functionality</span>
  #<span class="hljs-keyword">if</span> defined ( BDB_TL_INITIATOR )<font></font>
    touchLinkInitiator_event_loop,<font></font>
  #endif<font></font>
  <span class="hljs-comment">// Added to include TouchLink target functionality</span>
  #<span class="hljs-keyword">if</span> defined ( BDB_TL_TARGET )<font></font>
    touchLinkTarget_event_loop,<font></font>
  #endif<font></font>
  zcl_event_loop,<font></font>
  bdb_event_loop,<font></font>
  zclDIYRuZRT_event_loop<font></font>
};<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osalInitTasks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、アプリケーション</font><b><font style="vertical-align: inherit;">によって</font></b><font style="vertical-align: inherit;">実行</font><b><font style="vertical-align: inherit;">される</font></b><font style="vertical-align: inherit;">タスクを登録するアプリケーション起動関数です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクの登録は順番に行われ、各タスクには独自の番号が割り当てられます。と同じ順序に従うことが重要である</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasksArrの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">として、ハンドラーはタスク番号に従って呼び出されます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">osalInitTasks</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{<font></font>
  uint8 taskID = <span class="hljs-number">0</span>;<font></font>
<font></font>
  tasksEvents = (uint16 *)osal_mem_alloc( <span class="hljs-keyword">sizeof</span>( uint16 ) * tasksCnt);<font></font>
  osal_memset( tasksEvents, <span class="hljs-number">0</span>, (<span class="hljs-keyword">sizeof</span>( uint16 ) * tasksCnt));<font></font>
<font></font>
  macTaskInit( taskID++ );<font></font>
  nwk_init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> !defined (DISABLE_GREENPOWER_BASIC_PROXY) &amp;&amp; (ZG_BUILD_RTR_TYPE)</span><font></font>
  gp_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  Hal_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined( MT_TASK )</span><font></font>
  MT_TaskInit( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  APS_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( ZIGBEE_FRAGMENTATION )</span><font></font>
  APSF_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  ZDApp_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( ZIGBEE_FREQ_AGILITY ) || defined ( ZIGBEE_PANID_CONFLICT )</span><font></font>
  ZDNwkMgr_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
  <span class="hljs-comment">// Added to include TouchLink functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( INTER_PAN )</span><font></font>
  StubAPS_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-comment">// Added to include TouchLink initiator functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined( BDB_TL_INITIATOR )</span><font></font>
  touchLinkInitiator_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
<span class="hljs-comment">// Added to include TouchLink target functionality</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined ( BDB_TL_TARGET )</span><font></font>
  touchLinkTarget_Init( taskID++ );<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><font></font>
  zcl_Init( taskID++ );<font></font>
  bdb_Init( taskID++ );<font></font>
  zclDIYRuZRT_Init( taskID );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプリケーションは、関数ハンドラー</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_event_loop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および初期化関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Initを登録しました</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。リストの最後に追加されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらは、アプリケーションの2つの主要な機能です。これらの関数の実装は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_DIYRuZRT.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルにあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク登録関数。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_ENDPOINT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションによって実装されたエンドポイント番号。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションを説明する登録手順が順番に実行されます。</font></font><br>
<br>
<ul>
<li><b>bdb_RegisterSimpleDescriptor </b> —    .    <b>SimpleDescriptionFormat_t zclDIYRuZRT_SimpleDesc</b> —    ,  , ,    .       <i>OSAL_DIYRuZRT_data.c</i><br>
</li>
<li><b>zclGeneral_RegisterCmdCallbacks </b> —      <b>zclGeneral_AppCallbacks_t zclDIYRuZRT_CmdCallbacks</b> —  ,       .<br>
</li>
<li><b>zcl_registerAttrList </b> —    <b>zclAttrRec_t zclDIYRuZRT_Attrs</b> —  ,     .<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_registerForMsg-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制御メッセージの受信を登録します。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RegisterForKeys-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンクリックイベントを受け取るためのタスクに署名します。</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*********************************************************************
 * SIMPLE DESCRIPTOR
 */</span>
<span class="hljs-comment">// This is the Cluster ID List and should be filled with Application</span>
<span class="hljs-comment">// specific cluster IDs.</span>
<span class="hljs-keyword">const</span> cId_t zclDIYRuZRT_InClusterList[] =<font></font>
{<font></font>
  ZCL_CLUSTER_ID_GEN_BASIC,<font></font>
  ZCL_CLUSTER_ID_GEN_IDENTIFY,<font></font>
  <font></font>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Add application specific Input Clusters Here. </span>
  <span class="hljs-comment">//       See zcl.h for Cluster ID definitions</span><font></font>
  <font></font>
};<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCLDIYRuZRT_MAX_INCLUSTERS   (sizeof(zclDIYRuZRT_InClusterList) / sizeof(zclDIYRuZRT_InClusterList[0]))</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">const</span> cId_t zclDIYRuZRT_OutClusterList[] =<font></font>
{<font></font>
  ZCL_CLUSTER_ID_GEN_BASIC,<font></font>
  <font></font>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Add application specific Output Clusters Here. </span>
  <span class="hljs-comment">//       See zcl.h for Cluster ID definitions</span><font></font>
};<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCLDIYRuZRT_MAX_OUTCLUSTERS  (sizeof(zclDIYRuZRT_OutClusterList) / sizeof(zclDIYRuZRT_OutClusterList[0]))</span><font></font>
<font></font>
<font></font>
SimpleDescriptionFormat_t zclDIYRuZRT_SimpleDesc =<font></font>
{<font></font>
  DIYRuZRT_ENDPOINT,                  <span class="hljs-comment">//  int Endpoint;</span>
  ZCL_HA_PROFILE_ID,                     <span class="hljs-comment">//  uint16 AppProfId;</span>
  <span class="hljs-comment">// DIYRuZRT_<span class="hljs-doctag">TODO:</span> Replace ZCL_HA_DEVICEID_ON_OFF_LIGHT with application specific device ID</span>
  ZCL_HA_DEVICEID_ON_OFF_LIGHT,          <span class="hljs-comment">//  uint16 AppDeviceId; </span>
  DIYRuZRT_DEVICE_VERSION,            <span class="hljs-comment">//  int   AppDevVer:4;</span>
  DIYRuZRT_FLAGS,                     <span class="hljs-comment">//  int   AppFlags:4;</span>
  ZCLDIYRuZRT_MAX_INCLUSTERS,         <span class="hljs-comment">//  byte  AppNumInClusters;</span>
  (cId_t *)zclDIYRuZRT_InClusterList, <span class="hljs-comment">//  byte *pAppInClusterList;</span>
  ZCLDIYRuZRT_MAX_OUTCLUSTERS,        <span class="hljs-comment">//  byte  AppNumInClusters;</span>
  (cId_t *)zclDIYRuZRT_OutClusterList <span class="hljs-comment">//  byte *pAppInClusterList;</span><font></font>
};<font></font>
</code></pre><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_event_loop-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションのイベントハンドラーの関数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、システムイベントはループで処理されます。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZCL_INCOMING_MSG-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイス制御コマンドはzclDIYRuZRT_ProcessIncomingMsgで処理されます。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KEY_CHANGE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンクリックイベントは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_HandleKeysで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理され</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZDO_STATE_CHANGE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークステータス変更イベント。</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">if</span> ( events &amp; SYS_EVENT_MSG )<font></font>
  {<font></font>
    <span class="hljs-keyword">while</span> ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( zclDIYRuZRT_TaskID )) )<font></font>
    {<font></font>
      <span class="hljs-keyword">switch</span> ( MSGpkt-&gt;hdr.event )<font></font>
      {<font></font>
        <span class="hljs-keyword">case</span> ZCL_INCOMING_MSG:
          <span class="hljs-comment">// Incoming ZCL Foundation command/response messages</span><font></font>
          zclDIYRuZRT_ProcessIncomingMsg( (zclIncomingMsg_t *)MSGpkt );<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> KEY_CHANGE:<font></font>
          zclDIYRuZRT_HandleKeys( ((keyChange_t *)MSGpkt)-&gt;state, ((keyChange_t *)MSGpkt)-&gt;keys );<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">case</span> ZDO_STATE_CHANGE:<font></font>
          zclDIYRuZRT_NwkState = (devStates_t)(MSGpkt-&gt;hdr.status);<font></font>
<font></font>
          <span class="hljs-comment">// now on the network</span>
          <span class="hljs-keyword">if</span> ( (zclDIYRuZRT_NwkState == DEV_ZB_COORD) ||<font></font>
               (zclDIYRuZRT_NwkState == DEV_ROUTER)   ||<font></font>
               (zclDIYRuZRT_NwkState == DEV_END_DEVICE) )<font></font>
          {<font></font>
            giGenAppScreenMode = GENERIC_MAINMODE;<font></font>
            zclDIYRuZRT_LcdDisplayUpdate();<font></font>
          }<font></font>
          <span class="hljs-keyword">break</span>;<font></font>
<font></font>
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">break</span>;<font></font>
      }<font></font>
<font></font>
      <span class="hljs-comment">// Release the memory</span><font></font>
      osal_msg_deallocate( (uint8 *)MSGpkt );<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、特別なイベント</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_EVT_1の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理が</font><font style="vertical-align: inherit;">あります。これは、LED </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_LED_2の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態を切り替え</font><font style="vertical-align: inherit;">、同じイベントで500mのタイマーを開始します。</font><font style="vertical-align: inherit;">これにより、LED </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_LED_2の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点滅が始まり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-keyword">if</span> ( events &amp; DIYRuZRT_EVT_1 )<font></font>
  {<font></font>
    <span class="hljs-comment">// toggle LED 2 state, start another timer for 500ms</span><font></font>
    HalLedSet ( HAL_LED_2, HAL_LED_MODE_TOGGLE );<font></font>
    osal_start_timerEx( zclDIYRuZRT_TaskID, DIYRuZRT_EVT_1, <span class="hljs-number">500</span> );<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> ( events ^ DIYRuZRT_EVT_1 );<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事実は、ファームウェアの起動時に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_KEY_SW_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font><b><font style="vertical-align: inherit;">が発生</font></b><font style="vertical-align: inherit;">し、タイマーと</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_EVT_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントが</font><b><font style="vertical-align: inherit;">初期化されること</font></b><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">S2ボタンを押すと、点滅が止まります（LEDが点灯したままになります）。</font><font style="vertical-align: inherit;">もう一度押すと点滅します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. HAL：LEDとボタン</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「ちょっと待って、どのLEDとボタン？」と尋ねます。</font><font style="vertical-align: inherit;">最初に、Zスタックのすべての例は、SmartRF05 EBシリーズのさまざまな種類のデバッグボードに焦点を当てて</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tz/bl/ru/tzblrurrrpoze3kghx_dd1zrume.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
います。少し異なるデバッグボードとチップ付きのモジュールがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードには2つのボタン（+リセット）と3つのLED（+電源インジケーター）があります。</font><font style="vertical-align: inherit;">ファームウェアが正常に動作している場合、そのうちの1つ（D2）が点滅します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンタクトを呼び出して、ピン、ダイオード、ボタンの対応を決定します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D1-P10</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D2-P11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3-P14</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2-P20</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S1-P01</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、HALは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハードウェアアブストラクションレイヤー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">であり、機器の実装から抽象化する方法です。アプリケーションコードは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタン1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの抽象化で機能するマクロと関数を使用し</font><font style="vertical-align: inherit;">、抽象化と機器の特定の対応は個別に設定されます。</font><b><font style="vertical-align: inherit;">HAL_LED_2の種類</font></b><font style="vertical-align: inherit;">と、どのピンが中断されているかを理解する方法を</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見てみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
検索すると、</font><i><font style="vertical-align: inherit;">hal_led.h</font></i><font style="vertical-align: inherit;">ファイルが</font><i><font style="vertical-align: inherit;">見つかり</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。ここには、これらの定数と</font><b><font style="vertical-align: inherit;">HalLedSet</font></b><font style="vertical-align: inherit;">関数が</font><b><font style="vertical-align: inherit;">記述されて</font></b><font style="vertical-align: inherit;">おり、LED番号とモードが送信されます。内部では、</font><b><font style="vertical-align: inherit;">HalLedOnOff</font></b><font style="vertical-align: inherit;">関数が</font><b><font style="vertical-align: inherit;">呼び出さ</font></b><font style="vertical-align: inherit;">れてLEDをオン/オフし、</font><b><font style="vertical-align: inherit;">HAL_TURN_ON_LED2</font></b><font style="vertical-align: inherit;">または</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_OFF_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_ON_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TURN_OFF_LED2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><b><font style="vertical-align: inherit;">hal_board_cfg.hで</font></b><font style="vertical-align: inherit;">説明されているマクロ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">マクロはハードウェア構成によって異なります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_TURN_OFF_LED2() &nbsp; &nbsp; &nbsp; st( LED2_SBIT = LED2_POLARITY (0); )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_TURN_ON_LED2()&nbsp; &nbsp; &nbsp; &nbsp; st( LED2_SBIT = LED2_POLARITY (1); )</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルの少し上にあるのは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_SBIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_POLARITYの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">対応です</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">&nbsp;&nbsp;<span class="hljs-comment">/* 2 - Red */</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(1)</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT &nbsp; &nbsp; &nbsp; &nbsp; P1_1</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P1DIR</span>
&nbsp;&nbsp;<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_HIGH</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、LED 2がピン</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1_1に</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、そのスイッチングレベルが高い</font><font style="vertical-align: inherit;">ことを意味します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、コードから判断すると、ボタンを押すとLEDは消えるはずですが、私たちの場合はオンのままです。</font><font style="vertical-align: inherit;">このファイルで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg.hを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更した場合：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_HIGH</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
に</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY &nbsp; &nbsp; ACTIVE_LOW</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、S2ボタンを押すと、LEDが消灯するはずです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションに関連しない一般的なファイルを変更しないようにするには、それ以外の場合は次のようにすることをお勧めします。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースフォルダーに（Z-Stack 3.0.2 \ Components \ hal \ target \ CC2530EB \フォルダーから）</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルのコピーを作成し、</font><i><font style="vertical-align: inherit;">それに名前を付け</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">（例：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h）</font></font></i><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルのコピーを最初のコピーにします（これにより、共有ファイルの接続が除外されます）。</font><font style="vertical-align: inherit;">Sourceフォルダーに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを作成し、</font><font style="vertical-align: inherit;">そこに次の行を書き込み</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"hal_board_cfg_DIYRuZRT.h"</span></span></code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このファイルの接続が最初であることを示します-プロジェクト設定で：</font></font><br>
</li>
</ul><br>
<pre><code class="cpp hljs">$PROJ_DIR$\..\Source\preinclude.h</code></pre><br>
<img src="https://habrastorage.org/webt/jl/_f/j_/jl_fj_oy71xhwehgszprw9jhdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これ</font><font style="vertical-align: inherit;">で、</font><font style="vertical-align: inherit;">共有ファイルを編集せず</font><font style="vertical-align: inherit;">に、</font><i><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></i><font style="vertical-align: inherit;">ファイルと</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの機器パラメーターを変更</font><font style="vertical-align: inherit;">できます。</font><font style="vertical-align: inherit;">
コンパイラディレクティブを同じpreinclude.hファイルに転送し、コンパイラオプションで削除しました。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SECURE 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TC_LINKKEY_JOIN</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NV_INIT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> NV_RESTORE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xZTOOL_P1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_TASK</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_APP_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_SYS_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_ZDO_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_ZDO_MGMT</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> xMT_APP_CNF_FUNC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LEGACY_LCD_DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LCD_SUPPORTED DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MULTICAST_ENABLED FALSE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_READ</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_WRITE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_BASIC</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_IDENTIFY</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_SCENES</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_GROUPS</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、S1ボタンとジョイスティックセンタープレスの説明があります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* S1 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH1_BV&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(1)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH1_SBIT&nbsp; &nbsp; &nbsp; &nbsp; P0_1</span><font></font>
<font></font>
<span class="hljs-comment">/* Joystick Center Press */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_BV&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BV(0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_SBIT&nbsp; &nbsp; &nbsp; &nbsp; P2_0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PUSH2_POLARITY&nbsp; &nbsp; ACTIVE_HIGH</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ボード上のボタンのピンに対応しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハードウェアの初期化- </font><font style="vertical-align: inherit;">同じファイル内の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_INIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マクロ</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">見てみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デフォルトでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_CC2530EB_REV17</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブが</font><b><font style="vertical-align: inherit;">オンに</font></b><font style="vertical-align: inherit;">なっているため、対応するマクロバリアントを調べます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* ----------- Board Initialization ---------- */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined (HAL_BOARD_CC2530EB_REV17) &amp;&amp; !defined (HAL_PA_LNA) &amp;&amp; \
    !defined (HAL_PA_LNA_CC2590) &amp;&amp; !defined (HAL_PA_LNA_SE2431L) &amp;&amp; \
    !defined (HAL_PA_LNA_CC2592)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_BOARD_INIT()                                         \
{                                                                \
  uint16 i;                                                      \
                                                                 \
  SLEEPCMD &amp;= ~OSC_PD;                       <span class="hljs-comment">/* turn on 16MHz RC and 32MHz XOSC */</span>                \
  while (!(SLEEPSTA &amp; XOSC_STB));            <span class="hljs-comment">/* wait for 32MHz XOSC stable */</span>                     \
  asm(<span class="hljs-meta-string">"NOP"</span>);                                <span class="hljs-comment">/* chip bug workaround */</span>                            \
  for (i=0; i&lt;504; i++) asm(<span class="hljs-meta-string">"NOP"</span>);          <span class="hljs-comment">/* Require 63us delay for all revs */</span>                \
  CLKCONCMD = (CLKCONCMD_32MHZ | OSC_32KHZ); <span class="hljs-comment">/* Select 32MHz XOSC and the source for 32K clock */</span> \
  while (CLKCONSTA != (CLKCONCMD_32MHZ | OSC_32KHZ)); <span class="hljs-comment">/* Wait for the change to be effective */</span>   \
  SLEEPCMD |= OSC_PD;                        <span class="hljs-comment">/* turn off 16MHz RC */</span>                              \
                                                                 \
  <span class="hljs-comment">/* Turn on cache prefetch mode */</span>                              \
  PREFETCH_ENABLE();                                             \
                                                                 \
  HAL_TURN_OFF_LED1();                                           \
  LED1_DDR |= LED1_BV;                                           \
  HAL_TURN_OFF_LED2();                                           \
  LED2_DDR |= LED2_BV;                                           \
  HAL_TURN_OFF_LED3();                                           \
  LED3_DDR |= LED3_BV;                                           \
  HAL_TURN_OFF_LED4();                                           \
  LED4_SET_DIR();                                                \
                                                                 \
  <span class="hljs-comment">/* configure tristates */</span>                                      \
  P0INP |= PUSH2_BV;                                             \
}</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマクロでは、プロセッサのモードとレジスタが初期化されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代わりに、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_DDR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1DIR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に置き換えられ</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;"> -このポート</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登録し</font><font style="vertical-align: inherit;">、動作モードピン（入力または出力）を充電します。したがって、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED2_BV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は対応するピンのビットごとに1に設定されます（この場合、1ビット。これは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1_1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピンに対応します</font><font style="vertical-align: inherit;">）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/ed/0y/qred0ypxdrfxxkaleymbpqmjgto.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レジスターとプロセッサーモードは</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「cc253xユーザーガイド」の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントに記載されて</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いますが、ボタンの設定方法はどこにも表示されていません。ボタンは同様に処理されますが、別のファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-hal_key.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で処理されます</font><font style="vertical-align: inherit;">。ボタンと関数のパラメーターを定義します</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyInit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyConfig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyRead</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HalKeyPoll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらの関数は、ボタンの操作と値の読み取りのサブシステムを初期化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、ボタンの処理は100msごとにタイマーで実行されます。</font><font style="vertical-align: inherit;">現在の構成のピンP2_0がジョイスティックに割り当てられ、その現在の状態がクリックとして読み取られます。したがって、LED点滅タイマーが開始します。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.デバイスを自分で設定します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zcl_DIYRuZRT.hを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1のDIYRuZRT_ENDPOINT</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSAL_DIYRuZRT_data.c内</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1のDIYRuZRT_DEVICE_VERSION</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ManufacturerName on {6、 'D'、 'I'、 'Y'、 'R'、 'u'、 'Z'}</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ModelId on {9、 'D'、 'I'、 'Y'、 'R'、 'u'、 'Z'、 '_'、 'R'、 'T'}</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_DateCode on {8、 '2'、 '0'、 '2'、 '0'、 '0'、 '4'、 '0'、 '5'}</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスが任意のチャネルのネットワークに接続できるようにするには（</font><i><font style="vertical-align: inherit;">Tools \ f8wConfig.cfgファイル</font></i><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFAULT_CHANLIST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブ</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">指定されているデフォルトでは11のみ</font><font style="vertical-align: inherit;">）、</font><font style="vertical-align: inherit;">ディレクティブの値を変更</font><font style="vertical-align: inherit;">して</font><i><font style="vertical-align: inherit;">preinclude.h</font></i><font style="vertical-align: inherit;">ファイルでこの機能を指定する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
また、コンパイルディレクティブ</font><b><font style="vertical-align: inherit;">DISABLE_GREENPOWER_BASIC_PROXYを</font></b><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">て、デバイスにGREENPOWERエンドポイントが作成されないようにします。</font><font style="vertical-align: inherit;">
また、LCD画面の不要なサポートをオフにします。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define LCD_SUPPORTED DEBUG</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DISABLE_GREENPOWER_BASIC_PROXY</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFAULT_CHANLIST 0x07FFF800&nbsp; <span class="hljs-comment">// ALL Channels</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスが自動的にネットワークに接続しようとするために、ネットワークへの接続を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数コードに追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">bdb_StartCommissioning(BDB_COMMISSIONING_MODE_NWK_STEERING |<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BDB_COMMISSIONING_MODE_FINDING_BINDING);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ビルドを実行し、ファームウェアをチップに入力して、コーディネーターでペアリングを開始します。</font><font style="vertical-align: inherit;">私はioBroker.zigbeeでZigbeeネットワークの動作を確認します。これは、新しく接続されたデバイスがどのように見えるかです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/ik/ss/umikss4n4f19icobraxj-rb_tj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしい、デバイスを接続することが判明しました！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.デバイスの操作を複雑にする</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、機能を少し変更してみましょう。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスをネットワークに接続するプロセスは、ボタンを長押しすることで実行されます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスがすでにネットワーク上にある場合は、長押しするとネットワークからデバイスが表示されます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">短押し-LEDのステータスを切り替えます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停電後のデバイスの起動時に、LEDのステータスを維持する必要があります。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自のボタン処理をセットアップするため</font><font style="vertical-align: inherit;">に、</font><i><font style="vertical-align: inherit;">hal_key.c</font></i><font style="vertical-align: inherit;">モジュールの</font><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">と同様</font><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_HalKeyInit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を作成しました</font><font style="vertical-align: inherit;">が、ボタンのセット専用です。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    ()</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DIYRuZRT_HalKeyInit</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">/*      0 */</span>
  halKeySavedKeys = <span class="hljs-number">0</span>;<font></font>
<font></font>
  PUSH1_SEL &amp;= ~(PUSH1_BV); <span class="hljs-comment">/*    - GPIO */</span>
  PUSH1_DIR &amp;= ~(PUSH1_BV); <span class="hljs-comment">/*    -  */</span><font></font>
  <font></font>
  PUSH1_ICTL &amp;= ~(PUSH1_ICTLBIT); <span class="hljs-comment">/*      */</span>
  PUSH1_IEN &amp;= ~(PUSH1_IENBIT);   <span class="hljs-comment">/*     */</span><font></font>
  <font></font>
  PUSH2_SEL &amp;= ~(PUSH2_BV); <span class="hljs-comment">/* Set pin function to GPIO */</span>
  PUSH2_DIR &amp;= ~(PUSH2_BV); <span class="hljs-comment">/* Set pin direction to Input */</span><font></font>
  <font></font>
  PUSH2_ICTL &amp;= ~(PUSH2_ICTLBIT); <span class="hljs-comment">/* don't generate interrupt */</span>
  PUSH2_IEN &amp;= ~(PUSH2_IENBIT);   <span class="hljs-comment">/* Clear interrupt enable bit */</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マクロ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_BOARD_INIT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.hに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加されたこの関数を呼び出す</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">競合を回避するには、同じファイル</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.hの組み込みhal_keyを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効にします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_KEY FALSE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜなら </font><font style="vertical-align: inherit;">標準のボタンリーダーが無効になっている場合は、自分で行います。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_Init</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、ボタンの状態を読み取るためのタイマー</font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">開始します。</font><font style="vertical-align: inherit;">タイマーは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_KEY_EVENT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントを生成します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">osal_start_reload_timer( zclDIYRuZRT_TaskID, HAL_KEY_EVENT, <span class="hljs-number">100</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、イベントループでは、我々は処理する</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_KEY_EVENTの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントを</font><b><font style="vertical-align: inherit;">することによって</font></b><font style="vertical-align: inherit;">呼び出す</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_HalKeyPollの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能を</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DIYRuZRT_HalKeyPoll</span> <span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  uint8 keys = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-comment">//   1 ?</span>
  <span class="hljs-keyword">if</span> (HAL_PUSH_BUTTON1())<font></font>
  {<font></font>
    keys |= HAL_KEY_SW_1;<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-comment">//   2 ?</span>
  <span class="hljs-keyword">if</span> (HAL_PUSH_BUTTON2())<font></font>
  {<font></font>
    keys |= HAL_KEY_SW_2;<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (keys == halKeySavedKeys)<font></font>
  {<font></font>
    <span class="hljs-comment">//  -  </span>
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">//        . </span><font></font>
  halKeySavedKeys = keys;<font></font>
<font></font>
  <span class="hljs-comment">//     </span><font></font>
  OnBoard_SendKeys(keys, HAL_KEY_STATE_NORMAL);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンの状態を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">halKeySavedKeys</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数に保存すると、</font><font style="vertical-align: inherit;">変更の瞬間、つまりボタンを押して離す瞬間を特定できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボタンをクリックすると、タイマーが5秒間開始します。</font><font style="vertical-align: inherit;">このタイマーが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作動</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すると、</font><b><font style="vertical-align: inherit;">DIYRuZRT_EVT_LONG</font></b><font style="vertical-align: inherit;">イベントが生成され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ボタンを離すとタイマーがリセットされます。</font><font style="vertical-align: inherit;">いずれにしてもボタンを押すとLEDの状態が切り替わります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_HandleKeys</span><span class="hljs-params">( byte shift, byte keys )</span>
</span>{
  <span class="hljs-keyword">if</span> ( keys &amp; HAL_KEY_SW_1 )<font></font>
  {<font></font>
    <span class="hljs-comment">//       - 5 </span>
    osal_start_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_LONG, <span class="hljs-number">5000</span>);
    <span class="hljs-comment">//  </span>
    updateRelay(RELAY_STATE == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    <span class="hljs-comment">//     </span><font></font>
    osal_stop_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_LONG);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、長押しイベントを処理するとき、構造属性</font><b><font style="vertical-align: inherit;">bdbAttributes.bdbNodeIsOnANetwork</font></b><font style="vertical-align: inherit;">を通じてネットワークの現在の状態に注意を払います</font></font><b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">//  DIYRuZRT_EVT_LONG</span>
  <span class="hljs-keyword">if</span> ( events &amp; DIYRuZRT_EVT_LONG )<font></font>
  {<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-comment">//      ?</span>
    <span class="hljs-keyword">if</span> ( bdbAttributes.bdbNodeIsOnANetwork )<font></font>
    {<font></font>
      <span class="hljs-comment">//  </span><font></font>
      zclDIYRuZRT_LeaveNetwork();<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <font></font>
    {<font></font>
      <span class="hljs-comment">//    </span><font></font>
      bdb_StartCommissioning(<font></font>
        BDB_COMMISSIONING_MODE_NWK_FORMATION | <font></font>
        BDB_COMMISSIONING_MODE_NWK_STEERING | <font></font>
        BDB_COMMISSIONING_MODE_FINDING_BINDING | <font></font>
        BDB_COMMISSIONING_MODE_INITIATOR_TL<font></font>
      );<font></font>
      <span class="hljs-comment">//  ,   </span>
      osal_start_timerEx(zclDIYRuZRT_TaskID, DIYRuZRT_EVT_BLINK, <span class="hljs-number">500</span>);<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> ( events ^ DIYRuZRT_EVT_LONG );<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに進みます。</font><font style="vertical-align: inherit;">LEDの状態は変数に保存され、その値はNVメモリに保存されます。</font><font style="vertical-align: inherit;">デバイスが起動すると、メモリから変数に値が読み込まれます。</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">//  NVM   RELAY STATE</span>
  <span class="hljs-keyword">if</span> ( SUCCESS == osal_nv_item_init( NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">1</span>, &amp;RELAY_STATE ) ) {
    <span class="hljs-comment">//   RELAY STATE  </span>
    osal_nv_read( NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, &amp;RELAY_STATE );<font></font>
  }<font></font>
  <span class="hljs-comment">//   </span><font></font>
  applyRelay();<font></font>
</code></pre><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateRelay</span> <span class="hljs-params">( <span class="hljs-keyword">bool</span> value )</span>
</span>{
  <span class="hljs-keyword">if</span> (value) {<font></font>
    RELAY_STATE = <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    RELAY_STATE = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">//   </span>
  osal_nv_write(NV_DIYRuZRT_RELAY_STATE_ID, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, &amp;RELAY_STATE);
  <span class="hljs-comment">//   </span><font></font>
  applyRelay();<font></font>
}<font></font>
  <font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">applyRelay</span> <span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">if</span> (RELAY_STATE == <span class="hljs-number">0</span>) {
    <span class="hljs-comment">//    1</span><font></font>
    HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//    1</span><font></font>
    HalLedSet ( HAL_LED_1, HAL_LED_MODE_ON );<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.次に、ジグビーを扱います</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、ハードウェアを整理しました-ボタンでLEDを制御します。</font><font style="vertical-align: inherit;">今、私たちは同じことをZigbeeを介して実装します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リレーを制御するには、唯一のエンドポイントを使用して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスターを実装するだけで十分です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは、のためにジグビークラスタライブラリの仕様読ん</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOffの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスタを</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zo/9z/z7/zo9zz7ccj2oyfyrxrk3mithxh0i.png"><br>
<br>
<img src="https://habrastorage.org/webt/7b/na/ek/7bnaekoi4gmleiisjwvbfw75hao.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
のOnOff属性とオン、オフ、トグルコマンドを実装するのに十分です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、ディレクティブを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preinclude.hに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_ON_OFF</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
属性zclDIYRuZRT_Attrsの説明に、新しいクラスター属性を追加します。</font></font><br>
<br>
<pre><code class="cpp hljs">  <span class="hljs-comment">// ***  On/Off  ***</span><font></font>
  {<font></font>
    ZCL_CLUSTER_ID_GEN_ON_OFF,<font></font>
    { <span class="hljs-comment">// </span><font></font>
      ATTRID_ON_OFF,<font></font>
      ZCL_DATATYPE_BOOLEAN,<font></font>
      ACCESS_CONTROL_READ,<font></font>
      (<span class="hljs-keyword">void</span> *)&amp;RELAY_STATE<font></font>
    }<font></font>
  },<font></font>
  {<font></font>
    ZCL_CLUSTER_ID_GEN_ON_OFF,<font></font>
    {  <span class="hljs-comment">//  On/Off </span><font></font>
      ATTRID_CLUSTER_REVISION,<font></font>
      ZCL_DATATYPE_UINT16,<font></font>
      ACCESS_CONTROL_READ | ACCESS_CLIENT,<font></font>
      (<span class="hljs-keyword">void</span> *)&amp;zclDIYRuZRT_clusterRevision_all<font></font>
    }<font></font>
  },<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、サポートされる着信エンドポイントクラスター</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_InClusterListの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リストにクラスターを追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
制御コマンドを実装するには、ハンドラーを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_CmdCallbacks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テーブルに追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*********************************************************************
 *    ZCL 
 */</span>
<span class="hljs-keyword">static</span> zclGeneral_AppCallbacks_t zclDIYRuZRT_CmdCallbacks =<font></font>
{<font></font>
  zclDIYRuZRT_BasicResetCB,               <span class="hljs-comment">// Basic Cluster Reset command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Identify Trigger Effect command</span>
  zclDIYRuZRT_OnOffCB,                    <span class="hljs-comment">// On/Off cluster commands</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command Off with Effect</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command On with Recall Global Scene</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// On/Off cluster enhanced command On with Timed Off</span><font></font>
#ifdef ZCL_LEVEL_CTRL<font></font>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Move to Level command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Move command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Step command</span>
  <span class="hljs-literal">NULL</span>,                                   <span class="hljs-comment">// Level Control Stop command</span><font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそれを実装します：</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    OnOff</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_OnOffCB</span><span class="hljs-params">(uint8 cmd)</span>
</span>{
  <span class="hljs-comment">//  ,   </span>
  <span class="hljs-comment">//    </span><font></font>
  afIncomingMSGPacket_t *pPtr = zcl_getRawAFMsg();<font></font>
  zclDIYRuZRT_DstAddr.addr.shortAddr = pPtr-&gt;srcAddr.addr.shortAddr;<font></font>
  <font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">if</span> (cmd == COMMAND_ON) {<font></font>
    updateRelay(TRUE);<font></font>
  }<font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmd == COMMAND_OFF) {<font></font>
    updateRelay(FALSE);<font></font>
  }<font></font>
  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmd == COMMAND_TOGGLE) {<font></font>
    updateRelay(RELAY_STATE == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしい、今リレーはコマンドで切り替えることができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/_b/r5/rg_br5mwpw1z8g63trgcdts2o84.png"><br>
<br>
<img src="https://habrastorage.org/webt/sc/s8/-h/scs8-heldl3hz6l7h4ia3jllscw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これでは十分ではありません。</font><font style="vertical-align: inherit;">ボタンでスイッチを切り替える場合、LEDの現在の状態をコーディネーターに通知する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度、ディレクティブを追加します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ZCL_REPORTING_DEVICE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に</font><font style="vertical-align: inherit;">、ステータスメッセージを送信</font><font style="vertical-align: inherit;">する関数</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ReportOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">LEDが切り替わったとき、デバイスが起動したときに呼び出します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_ReportOnOff</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">const</span> uint8 NUM_ATTRIBUTES = <span class="hljs-number">1</span>;<font></font>
<font></font>
  zclReportCmd_t *pReportCmd;<font></font>
<font></font>
  pReportCmd = osal_mem_alloc(<span class="hljs-keyword">sizeof</span>(zclReportCmd_t) +<font></font>
                              (NUM_ATTRIBUTES * <span class="hljs-keyword">sizeof</span>(zclReport_t)));
  <span class="hljs-keyword">if</span> (pReportCmd != <span class="hljs-literal">NULL</span>) {<font></font>
    pReportCmd-&gt;numAttr = NUM_ATTRIBUTES;<font></font>
<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrID = ATTRID_ON_OFF;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].dataType = ZCL_DATATYPE_BOOLEAN;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrData = (<span class="hljs-keyword">void</span> *)(&amp;RELAY_STATE);<font></font>
<font></font>
    zclDIYRuZRT_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;<font></font>
    zclDIYRuZRT_DstAddr.addr.shortAddr = <span class="hljs-number">0</span>;<font></font>
    zclDIYRuZRT_DstAddr.endPoint = <span class="hljs-number">1</span>;<font></font>
<font></font>
    zcl_SendReportCmd(DIYRuZRT_ENDPOINT, &amp;zclDIYRuZRT_DstAddr,<font></font>
                      ZCL_CLUSTER_ID_GEN_ON_OFF, pReportCmd,<font></font>
                      ZCL_FRAME_CLIENT_SERVER_DIR, <span class="hljs-literal">false</span>, SeqNum++);<font></font>
  }<font></font>
<font></font>
  osal_mem_free(pReportCmd);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ログにLEDのステータスの変化に関するメッセージが表示されます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. ds18b20温度センサーを接続します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
センサーは任意の空きピンに接続されています（私の場合、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2_1を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定し</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
センサーポーリングコードをアプリケーションに追加します。定期的に面接します-1分に1回。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポーリング直後に、ネットワークコーディネーターが現在の値を通知します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
温度センサーからデータを送信するためのZCL仕様をお読みください。クラスター</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度測定</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/o2/_q/8h/o2_q8h7gtgxs7cjvvz8dumonsgq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
が必要です。3つの属性を実装する必要があることがわかり</font><b><font style="vertical-align: inherit;">ます。</font></b><font style="vertical-align: inherit;">そのうちの1つは、温度値に100を掛けたものを表します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GenOnOff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスターと同様に属性を追加します</font><font style="vertical-align: inherit;">。コーディネーターは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIYRuZRT_REPORTING_EVT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントについて通知されます</font><font style="vertical-align: inherit;">。これは、開始時に1分に1回計画しています。イベントハンドラーで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zclDIYRuZRT_ReportTemp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、センサーの温度を読み取り、メッセージを送信します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">zclDIYRuZRT_ReportTemp</span><span class="hljs-params">( <span class="hljs-keyword">void</span> )</span>
</span>{
  <span class="hljs-comment">//  </span><font></font>
  zclDIYRuZRT_MeasuredValue = readTemperature();<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> uint8 NUM_ATTRIBUTES = <span class="hljs-number">1</span>;<font></font>
<font></font>
  zclReportCmd_t *pReportCmd;<font></font>
<font></font>
  pReportCmd = osal_mem_alloc(<span class="hljs-keyword">sizeof</span>(zclReportCmd_t) +<font></font>
                              (NUM_ATTRIBUTES * <span class="hljs-keyword">sizeof</span>(zclReport_t)));
  <span class="hljs-keyword">if</span> (pReportCmd != <span class="hljs-literal">NULL</span>) {<font></font>
    pReportCmd-&gt;numAttr = NUM_ATTRIBUTES;<font></font>
<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrID = ATTRID_MS_TEMPERATURE_MEASURED_VALUE;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].dataType = ZCL_DATATYPE_INT16;<font></font>
    pReportCmd-&gt;attrList[<span class="hljs-number">0</span>].attrData = (<span class="hljs-keyword">void</span> *)(&amp;zclDIYRuZRT_MeasuredValue);<font></font>
<font></font>
    zclDIYRuZRT_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;<font></font>
    zclDIYRuZRT_DstAddr.addr.shortAddr = <span class="hljs-number">0</span>;<font></font>
    zclDIYRuZRT_DstAddr.endPoint = <span class="hljs-number">1</span>;<font></font>
<font></font>
    zcl_SendReportCmd(DIYRuZRT_ENDPOINT, &amp;zclDIYRuZRT_DstAddr,<font></font>
                      ZCL_CLUSTER_ID_MS_TEMPERATURE_MEASUREMENT, pReportCmd,<font></font>
                      ZCL_FRAME_CLIENT_SERVER_DIR, <span class="hljs-literal">false</span>, SeqNum++);<font></font>
  }<font></font>
<font></font>
  osal_mem_free(pReportCmd);<font></font>
}<font></font>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.ファームウェアをデバイスに注ぎます</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
devboardをSonoff BASICZBR3に変更するには、LEDピンとボタンのマッチングを調整する必要があります。</font><font style="vertical-align: inherit;">リレーを制御するため</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eg/fu/we/egfuweya8lj53yh-5rarbvslzvk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
にピン</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P0_7の</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LED 1をやり直します</font><font style="vertical-align: inherit;">。包含は、高レベルの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTIVE_HIGH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって実行され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ピン</font><b><font style="vertical-align: inherit;">P1_3の</font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタン</font><font style="vertical-align: inherit;">と、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1_0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の情報LED 2を</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再取り付けし</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。温度センサーはピン</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2_1のままにしておき</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。これらの変更はすべて</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hal_board_cfg_DIYRuZRT.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルで</font><i><font style="vertical-align: inherit;">行い</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。構成を選択するには、別のディレクティブ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_SONOFFを作成し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。設定されている場合、Sonoff BASICZBR3の設定が使用され、それ以外の場合はdevboardの設定が使用されます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> HAL_SONOFF</span>
  <span class="hljs-comment">/* 1 - P0_7  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_BV           BV(7)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_SBIT         P0_7</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_DDR          P0DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_POLARITY     ACTIVE_HIGH</span><font></font>
<font></font>
  <span class="hljs-comment">/* 2 - P1_0  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV           BV(0)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT         P1_0</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY     ACTIVE_LOW</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
  <span class="hljs-comment">/* 1 - P1_0  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_BV           BV(0)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_SBIT         P1_0</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED1_POLARITY     ACTIVE_LOW</span><font></font>
<font></font>
  <span class="hljs-comment">/* 2 - P1_1  */</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_BV           BV(1)</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_SBIT         P1_1</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_DDR          P1DIR</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED2_POLARITY     ACTIVE_LOW</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの重要なパラメーターは修正する必要がありました。「ウォッチ」クオーツの存在です。</font><font style="vertical-align: inherit;">Sonoff BASICZBR3ボードでは、はんだ付けされていません。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">//#define HAL_CLOCK_CRYSTAL</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OSC32K_CRYSTAL_INSTALLED FALSE</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのオプションがないと、ファームウェアは起動しません（または、常にそうとは限りません）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ファームウェアを収集し、ファームウェアに接続します。</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意！！！</font><font style="vertical-align: inherit;">接続とファームウェアの前に、Sonoff BASICZBR3リレーをAC電源から切断してください！</font></font></b></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff BASICZBR3配線をCCDebuggerに接続し、チップを消去してファームウェアをフラッシュします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/w-/3b/bzw-3bib84ucfczt0kg_mmbajtw.jpeg"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. zigbee2mqttとioBroker.Zigbeeでデバイスを起動します</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続されているデバイスのリストに表示されているデバイスとコマンドを送信してデバイスを管理することはできますが、画像と状態を使用して、より正確に行う必要があります。</font><b><font style="vertical-align: inherit;">ioBroker.Zigbee</font></b><font style="vertical-align: inherit;">で</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいデバイスを取得</font><font style="vertical-align: inherit;">するには、2つの手順を実行する必要があります。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li>     <b>zigbee-herdsman-converters</b>.       ,       <b>zigbee2mqtt</b>.<br>
</li>
<li>    <b>ioBroker.Zigbee</b><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にローカルファイルですべての変更を行い、次に対応するリポジトリでPRを行うことができます。</font><font style="vertical-align: inherit;">インストールされているioBroker（またはzigbee2mqtt）でzigbee </font><b><font style="vertical-align: inherit;">-</font></b><font style="vertical-align: inherit;"> herdsman </font><b><font style="vertical-align: inherit;">-converters</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パッケージの場所を見つけます</font><font style="vertical-align: inherit;">。パッケージの中に私たちが見つけ</font><i><font style="vertical-align: inherit;">devices.js</font></i><font style="vertical-align: inherit;">ファイル</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">https://github.com/Koenkk/zigbee-herdsman-converters/blob/master/devices.jsを</font></a><font style="vertical-align: inherit;"> 
このファイルには、すべてのデバイスの説明が含まれ</font><b><font style="vertical-align: inherit;">ioBroker.zigbee</font></b><font style="vertical-align: inherit;">と</font><b><font style="vertical-align: inherit;">zigbee2mqttが</font></b><font style="vertical-align: inherit;">働くことができる</font><b><font style="vertical-align: inherit;">と</font></b><font style="vertical-align: inherit;">。その中に、DIYRuZデバイスの説明のブロックがあります（2300行以降）。このブロックに新しいデバイスの説明を追加します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs">&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">zigbeeModel</span>: [<span class="hljs-string">'DIYRuZ_RT'</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">model</span>: <span class="hljs-string">'DIYRuZ_RT'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">vendor</span>: <span class="hljs-string">'DIYRuZ'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">description</span>: <span class="hljs-string">''</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">supports</span>: <span class="hljs-string">'on/off, temperature'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">fromZigbee</span>: [fz.on_off, fz.temperature],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">toZigbee</span>: [tz.on_off],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fromZigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
属性</font><b><font style="vertical-align: inherit;">で</font></b><font style="vertical-align: inherit;">は、デバイスからのメッセージを処理するコンバーターを指定します。 2つの投稿は標準化されています。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fz.on_off</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンバータ</font><font style="vertical-align: inherit;">はon / offメッセージを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">処理し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">fz.temperature</font></b><font style="vertical-align: inherit;">は温度データを</font><b><font style="vertical-align: inherit;">処理</font></b><font style="vertical-align: inherit;">します。これらのコンバーターのコード（ファイルconverters / fromZigbee.jsにあります）は、着信メッセージがどのように処理されるか、および温度が100で除算されることを示しています。</font></font><br>
<br>
<pre><code class="javascript hljs">   on_off: {
        <span class="hljs-attr">cluster</span>: <span class="hljs-string">'genOnOff'</span>,
        <span class="hljs-attr">type</span>: [<span class="hljs-string">'attributeReport'</span>, <span class="hljs-string">'readResponse'</span>],
        <span class="hljs-attr">convert</span>: <span class="hljs-function">(<span class="hljs-params">model, msg, publish, options, meta</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (msg.data.hasOwnProperty(<span class="hljs-string">'onOff'</span>)) {
                <span class="hljs-keyword">const</span> property = getProperty(<span class="hljs-string">'state'</span>, msg, model);
                <span class="hljs-keyword">return</span> {[property]: msg.data[<span class="hljs-string">'onOff'</span>] === <span class="hljs-number">1</span> ? <span class="hljs-string">'ON'</span> : <span class="hljs-string">'OFF'</span>};<font></font>
            }<font></font>
        },<font></font>
    },<font></font>
</code></pre><br>
<pre><code class="javascript hljs"> temperature: {
        <span class="hljs-attr">cluster</span>: <span class="hljs-string">'msTemperatureMeasurement'</span>,
        <span class="hljs-attr">type</span>: [<span class="hljs-string">'attributeReport'</span>, <span class="hljs-string">'readResponse'</span>],
        <span class="hljs-attr">convert</span>: <span class="hljs-function">(<span class="hljs-params">model, msg, publish, options, meta</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> temperature = <span class="hljs-built_in">parseFloat</span>(msg.data[<span class="hljs-string">'measuredValue'</span>]) / <span class="hljs-number">100.0</span>;
            <span class="hljs-keyword">return</span> {<span class="hljs-attr">temperature</span>: calibrateAndPrecisionRoundOptions(temperature, options, <span class="hljs-string">'temperature'</span>)};<font></font>
        },<font></font>
    },<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toZigbee</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
属性で</font><b><font style="vertical-align: inherit;">は</font></b><font style="vertical-align: inherit;">、デバイスへのコマンドを処理するコンバーター</font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">指定します。</font><font style="vertical-align: inherit;">私たちのケースでは、</font><font style="vertical-align: inherit;">リレーを切り替えるため</font><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tz.on_off</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンバーター</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが「コンバーター」に追加されました。</font><font style="vertical-align: inherit;">誰が</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zigbee2mqtt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しています</font><b><font style="vertical-align: inherit;">か</font></b><font style="vertical-align: inherit;"> -すでに使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ioBrokerユーザーは、デバイスの説明を</font><i><font style="vertical-align: inherit;">ioBroker.zigbee \ lib \ devices.js</font></i><font style="vertical-align: inherit;">ファイルに追加します</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="javascript hljs">&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">vendor</span>: <span class="hljs-string">'DIYRuZ'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">models</span>: [<span class="hljs-string">'DIYRuZ_RT'</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">icon</span>: <span class="hljs-string">'img/DIYRuZ.png'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">states</span>: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;states.state,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;states.temperature,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まったく同じモデル、画像と状態のリストを含むファイルを示すのに十分です。</font><font style="vertical-align: inherit;">我々の場合には、状態も標準装備されています：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステート</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リレーの状態のため、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">温度値を表示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oz/fu/zm/ozfuzmz72p-e1lwweegnd4fv74q.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.次は？</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、Z-Stack 3.0が提供するすべての側面と機能を理解することはできませんでした。</font><font style="vertical-align: inherit;">ほとんどの場合、私はある種の機能を正しく実装していなかったか、組み込みのメカニズムを使用してそれを実装できた可能性があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、上記のソリューションを改善および開発できます。</font><font style="vertical-align: inherit;">ここにいくつかの方向があります：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リレーを介して子デバイスを接続する可能性の解決策をすぐに見つけることができませんでした。</font><font style="vertical-align: inherit;">他のルータデバイスは、permit_joinコマンドを実行して、新しいデバイスをコーディネータに持っていかなくても、自分自身を介して新しいデバイスを接続できます。</font><font style="vertical-align: inherit;">デバイスはルーターで表され、ネットワークマップに正しく表示されますが、「permit_join」コマンドの実行を拒否します。</font><font style="vertical-align: inherit;">より正確には、コマンドは実行されますが、デバイスはそれを介して接続しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、正しいレポートを実装していませんでした。</font><font style="vertical-align: inherit;">これは、configReportコマンドを使用して送信する属性のリストと通知の頻度を指定できる場合に、ステータス通知を構成する方法です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グループで作業します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">割り込みを処理し、割り込みを介してポーリングボタンを実装します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、次のデバイスでは、電源モードと、バッテリーでの「スリープ」デバイスの作成に対処する必要があります。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いつものように、コメントに加えて、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZigbeeのTelegramチャットで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これと他のデバイスについて議論することを勧めます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テレグラムチャットとZigbeeコミュニティでの同僚の育成に対するサポートと支援に感謝の意を表します。</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/DJONvl</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/antstar</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/Jager_f</font></font></a></li>
</ul><br>
</blockquote><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインのドキュメントはZ-Stack 3.0.2 SDKに含まれており、一緒にインストールされます。</font><font style="vertical-align: inherit;">しかし、私はここにリンクの一部を与えます：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSALおよびHAL </font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI ZIgbee Wiki</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Create New Application For SmartRF05 + CC2530 SWRA231 Version 1.1</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Z-Stack Home Sample Application User's Guide SWRU354 Version 1.3</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Z-Stack Sample Applications SWRA201 Version 1.6</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Z-Stack Developer's Guide SWRA176 Version 1.12</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Z-Stack 3.0 Developer's Guide Version 1.14</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Z-Stack API SWRA195 Version 1.10</a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">TI CC253x User's Guide</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://github.com/formtapez/ZigUP</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Zigbee Cluster Library rev 6</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   DIYRuZ_RT</a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja495910/index.html">UbuntuシングルボードIMGイメージへのROSのインストール</a></li>
<li><a href="../ja495912/index.html">スマートリプレイステッカー</a></li>
<li><a href="../ja495918/index.html">コンピュータゲームやVRでリアルなサウンドを再現する方法と、それが難しい理由</a></li>
<li><a href="../ja495920/index.html">PTPv2時間同期プロトコルの実装の詳細</a></li>
<li><a href="../ja495924/index.html">優れたCOVID-19配布モデルを構築することがそれほど難しいのはなぜですか？</a></li>
<li><a href="../ja495932/index.html">SCRUMガイドで著者の隠された意味は何ですか？パート1.プロセスについて</a></li>
<li><a href="../ja495934/index.html">家庭でのDataGovernance</a></li>
<li><a href="../ja495938/index.html">機械学習に関する一連の記事：2020年3月の事例、ガイド、および研究</a></li>
<li><a href="../ja495942/index.html">時間、神経、工数を節約</a></li>
<li><a href="../ja495944/index.html">更新されたTOP50（CISスーパーコンピューターの評価）：ダイナミクスとトレンド</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>