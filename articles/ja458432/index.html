<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍💼 👆🏿 ✍🏽 複数のパッケージを単一のPython名前空間に組み合わせる 👩‍❤️‍💋‍👩 🧑🏽‍🤝‍🧑🏽 🥨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="同じ名前空間にある複数のパッケージを、異なる物理パスに沿って分離することが必要になる場合があります。たとえば、プラグインのさまざまなレイアウトを転送し、場所を制御せずにプラグインを後で追加し、同時に同じ名前空間を介してそれらにアクセスできるようにしたい場合。
 
 初心者により適したこのチートシート...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>複数のパッケージを単一のPython名前空間に組み合わせる</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458432/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ名前空間にある複数のパッケージを、異なる物理パスに沿って分離することが必要になる場合があります。</font><font style="vertical-align: inherit;">たとえば、プラグインのさまざまなレイアウトを転送し、場所を制御せずにプラグインを後で追加し、同時に同じ名前空間を介してそれらにアクセスできるようにしたい場合。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初心者により適したこのチートシートは、Python名前空間専用です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがPythonの異なるバージョンでどのように実行できるかを見てみましょう。Python2は間もなくサポートされなくなりますが、今の私たちの多くは2つの火災の中間にあり、これは移行における重要なニュアンスの1つにすぎません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/q4/bw/uz/q4bwuz7njfxhpsdaaignisff3ew.png" alt="画像"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の例</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
を考えてみます。パッケージ構造を取得したいとします。</font></font><br>
<br>
<pre><code class="markdown hljs">namespace1
<span class="hljs-code">      package1
           module1
      package2
           module2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Module1ファイルの内容</font></font><br>
<br>
<pre><code class="python hljs">print(<span class="hljs-string">'package 1'</span>)<font></font>
var1 = <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Module2ファイルの内容</font></font><br>
<br>
<pre><code class="python hljs">print(<span class="hljs-string">'package 2'</span>)<font></font>
var2 = <span class="hljs-number">2</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、パッケージは次のフォルダー構造で配布されます。</font></font><br>
<br>
<pre><code class="markdown hljs"><span class="hljs-code">    path1
        namespace1
            package1
                module1
    path2
        namespace1
            package2
                module2 
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何らかの方法で、path1とpath2がすでにsys.pathに追加されているとします。</font><font style="vertical-align: inherit;">module1とmodule2にアクセスする必要があります。</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-keyword">from</span> namespace1.package1 <span class="hljs-keyword">import</span> module1
    <span class="hljs-keyword">from</span> namespace1.package2 <span class="hljs-keyword">import</span> module2
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコードを実行すると</font><font style="vertical-align: inherit;">
、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python 3.7では</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が起こり</font><font style="vertical-align: inherit;">ますか？</font><font style="vertical-align: inherit;">すべてが素晴らしく機能します：</font></font><br>
<br>
<pre><code class="markdown hljs">package 1<font></font>
package 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python 3.3のPEP-420では、暗黙的な名前空間のサポートが登場しました。</font><font style="vertical-align: inherit;">また、py33からパッケージをインポートする場合、__ init__.pyファイルを作成する必要はありません。</font><font style="vertical-align: inherit;">そして名前空間をインポートするとき、それは単に_禁止されています_。</font><font style="vertical-align: inherit;">__init__.pyファイルがnamespace1という名前の1つまたは両方のディレクトリに存在する場合、2番目のパッケージのインポートでエラーが発生します。</font></font><br>
<br>
<pre><code class="python hljs">ModuleNotFoundError: No module named <span class="hljs-string">'namespace1.package2'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、内部関係者の存在がパッケージを明示的に決定し、パッケージを組み合わせることはできません。これは単一のエンティティです。古いデザインに関係なく新しいプロジェクトを開始し、パッケージがpipを使用してインストールされる場合は、この方法を使用する必要があります。ただし、古いコードを継承することもあります。これは、少なくともしばらくの間維持するか、新しいバージョンに移植する必要もあります。</font><b><font style="vertical-align: inherit;">Python 2.7に</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
移りましょう</font><font style="vertical-align: inherit;">。このバージョンでは、それはすでにより興味深いものです。まず、各ディレクトリに__init__.pyを追加してパッケージを作成する必要があります。そうしないと、インタープリターはこのファイルセット内のパッケージを単に認識しません。そして、namespace1に関連する__init__ファイルに明示的な名前空間宣言を登録します。そうしないと、最初のパッケージのみがインポートされます。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> pkgutil <span class="hljs-keyword">import</span> extend_path<font></font>
__path__ = extend_path(__path__, __name__)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起こるのですか？インタープリターが最初のインポートに到達すると、その名前のパッケージがsys.pathで検索され、path1 / namespace1にあり、インタープリターはpath1 / namespace1 / __ init__.pyを実行します。それ以上の検索は行われません。ただし、extend_path関数自体はすでにsys.path全体を検索し、namespace1という名前と内部名を持つすべてのパッケージを見つけて、この名前空間で子パッケージを検索するために使用されるパッケージnamespace1の__path__変数に追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
公式ガイドでは、namespace1を配置するたびにイニシャルを同じにすることをお勧めします。実際、sys.pathでの検索中に見つかった最初の1つを除いてすべて空にすることができます。残りは実行されないため、pkgutil.extend_pathを呼び出す必要があります。ただし、もちろん、コールがすべてのチームで行われるようにしてください。「万が一の場合」ロジックを結び付けず、最初に実行したチームを推測しないようにします。これは、検索順序が変わる可能性があるためです。同じ理由で、変数領域に他のロジック__init__ファイルを配置しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは将来のバージョンで機能し、このコードを使用して</font><b><font style="vertical-align: inherit;">互換性のあるコード</font></b><font style="vertical-align: inherit;">を作成でき</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ただし、各配布パッケージで選択した方法を順守する必要があることを考慮する必要があります。バージョン3で、pkgutil.extend_pathの呼び出しで一部のパッケージにインボックスを配置し、一部をインボックスなしのままにした場合、これは機能しません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、このオプションは、python setup.py installを使用してインストールする場合にも適しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう少し古くなったと考えられている別の方法ですが、それでも多くの場所で見つけることができます：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#namespace1/__init__.py</span>
__import__(<span class="hljs-string">'pkg_resources'</span>).declare_namespace(__name__)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pkg_resourcesモジュールは、setuptoolsパッケージに付属しています。</font><font style="vertical-align: inherit;">ここでの意味はpkgutilの場合と同じです。namespace1の各場所にある各__init__ファイルに同じ名前空間宣言が含まれ、他のコードがないことが必要です。</font><font style="vertical-align: inherit;">同時に、setup.pyに名前空間namespace_packages = ['namespace1']を登録する必要があります。</font><font style="vertical-align: inherit;">パッケージ作成の詳細については、この記事の範囲を超えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、そのようなコードを見つけることがよくあります</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">try</span>:<font></font>
	__import__(<span class="hljs-string">'pkg_resources'</span>).declare_namespace(__name__)
<span class="hljs-keyword">except</span>:
	<span class="hljs-keyword">from</span> pkgutil <span class="hljs-keyword">import</span> extend_path<font></font>
	__path__ = extend_path(__path__, __name__)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでのロジックは単純です。setuptoolsがインストールされていない場合は、標準ライブラリに含まれているpkgutilを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの方法のいずれかで名前空間を構成すると、1つのモジュールから別の名前空間を呼び出すことができます。</font><font style="vertical-align: inherit;">たとえば、namespace1 / package2 / module2を変更します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> namespace1.package1.module1<font></font>
print(var1)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、誤って新しいパッケージと既存のパッケージに名前を付け、同じ名前空間でラップした場合にどうなるかを確認します。</font><font style="vertical-align: inherit;">たとえば、package1という名前の異なる場所に2つのパッケージがあります。</font></font><br>
<br>
<pre><code class="markdown hljs"><span class="hljs-code">     
     namespace1
            package1
                module1
            package1
                module2
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、最初の1つだけがインポートされ、module2へのアクセスはありません。</font><font style="vertical-align: inherit;">パッケージを組み合わせることはできません。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> namespace1.package1 <span class="hljs-keyword">import</span> module1
<span class="hljs-keyword">from</span> namespace1.package1 <span class="hljs-keyword">import</span> module2<font></font>
<font></font>
<span class="hljs-comment">#&gt;&gt;ImportError: cannot import name module2</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要：</font></font></b><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3より古いPythonでpipを使用してインストールする場合は、暗黙的な名前空間宣言を使用することをお勧めします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン2と3のサポート、およびpipとpython setup.pyの両方を使用したインストールの場合は、pkgutilを使用したオプションをお勧めします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この方法を使用して古いパッケージをサポートする必要がある場合、またはパッケージをzipセーフにする必要がある場合は、pkg_resourcesオプションをお勧めします。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出典：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packaging.python.org/guides/packaging-namespace-packages</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.python.org/dev/peps/pep-0420</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mark LutzによるPythonの学習、第5版</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458420/index.html">ライファイゼンバンクでのAWS_Ruミートアップ</a></li>
<li><a href="../ja458422/index.html">ブロックチェーン開発者向けの助成プログラムの概要</a></li>
<li><a href="../ja458424/index.html">ドローンショー：インサイドルック</a></li>
<li><a href="../ja458426/index.html">地図投影：xkcdが実際に冗談を言うもの</a></li>
<li><a href="../ja458428/index.html">Googleがrobots.txtパーサーのソースコードを開く</a></li>
<li><a href="../ja458434/index.html">Cisco 200-125 CCNA v3.0のトレーニング。11日目VLANの基本</a></li>
<li><a href="../ja458436/index.html">一般的なロギングエラー</a></li>
<li><a href="../ja458440/index.html">平日のテクニカルサポート：ユーザーに連絡できない場合に何が起こるかについての話</a></li>
<li><a href="../ja458444/index.html">夏の居住者のためのインターネット。パート4. 1つのSIMカードで十分</a></li>
<li><a href="../ja458446/index.html">ハイパースケールデータセンター：誰が構築し、どのくらいのコストがかかるか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>