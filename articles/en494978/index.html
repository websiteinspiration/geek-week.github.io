<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌁 🚎 👩‍🚀 What is Windows PowerShell and what does it eat? Part 4: Working with objects, custom classes 🚈 🙇🏽 🧕🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The text output of commands in the PowerShell interpreter window is just a way to display information in a human-readable form. In fact, the environme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What is Windows PowerShell and what does it eat? Part 4: Working with objects, custom classes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/494978/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/-b/i_/73/-bi_73lwdxmnzvtveeghrwvtqay.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The text output of commands in the PowerShell interpreter window is just a way to display information in a human-readable form. </font><font style="vertical-align: inherit;">In fact, the environment is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">focused</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on working with objects: cmdlets and functions receive them at the input and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return at the output</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the types of variables available in interactive mode and in scripts are based on .NET classes. </font><font style="vertical-align: inherit;">In the fourth article of the cycle, we will study working with objects in more detail.</font></font><a name="habracut"></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Table of contents:</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">ForEach-Object, Group-Object  Measure-Object</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  .NET  COM (New-Object)</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> PSCustomObject</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a><br>
<br>
<a name="section1"></a><h3><font color="#3AC1EF">  PowerShell</font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recall that an object is a collection of data fields (properties, events, etc.) and their processing methods (methods). Its structure is determined by the type, which is usually based on the classes used in the unified .NET Core platform. It is also possible to work with COM, CIM (WMI) and ADSI objects. Properties and methods are needed to perform various actions on the data, in addition to PowerShell, objects can be passed as arguments to functions and cmdlets, assigned their values ​​to variables, and there is also a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mechanism for composing commands</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pipeline or pipeline). Each command in the pipeline passes its output to the next one in turn - object by object. For processing, you can use compiled cmdlets or create your own </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">advanced functions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to perform various manipulations with objects in the pipeline: filtering, sorting, grouping and even changing their structure. </font><font style="vertical-align: inherit;">Data transfer in this form has a serious advantage: the receiving team does not need to parse the stream of bytes (text), all the necessary information is easily extracted by referring to the corresponding properties and methods.</font></font><br>
<br>
<a name="section2"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">View object structure</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, run the Get-Process cmdlet, which allows you to get information about the processes running in the system: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4k/fo/qs/4kfoqsdoj0-r5h7lz6y5ecwjskc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It displays some formatted text data that does not give an idea of ​​the properties of the returned objects and their methods. </font><font style="vertical-align: inherit;">To fine-tune the output, you need to learn how to examine the structure of objects, and the Get-Member cmdlet will help us with this:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/86/fq/tt/86fqttuizhkkraqk9eoh9lnrfc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we already see the type and structure, and with the help of additional parameters we can, for example, display only the properties of the object that entered the input:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-MemberType</span> Property</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This knowledge will be needed to solve administrative tasks interactively or to write your own scripts: say, to get information about hung processes by the Responding property.</font></font><br>
<br>
<a name="section3"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object Filtering</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell allows you to pipe objects that satisfy a specific condition:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Where-Object</span> {   }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The result of the execution of the script block in operator brackets should be a logical value. </font><font style="vertical-align: inherit;">If it is true ($ true), the object that entered the Where-Object cmdlet will be passed down the pipeline, otherwise (the value $ false) it will be deleted. </font><font style="vertical-align: inherit;">For example, we list the stopped Windows Server services, i.e. </font><font style="vertical-align: inherit;">those with the Status property set to Stopped:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Service</span> | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">"Stopped"</span>}</code></pre><br>
<img src="https://habrastorage.org/webt/eq/w6/gy/eqw6gyo6ww_hha2hw_cnbse9_ki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we again see the textual representation, but if you want to understand the type and internal structure of the objects passing through the pipeline, it is easy:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Service</span> | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">"Stopped"</span>} | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/qu/uk/uy/quukuy29t6wndu8hhktdyei1rsi.png"><br>
<br>
<a name="section4"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sort Objects</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When pipelining objects, it is often necessary to sort them. </font><font style="vertical-align: inherit;">Property names (sort keys) are passed to the Sort-Object cmdlet, and it returns objects ordered by their values. </font><font style="vertical-align: inherit;">The output of running processes can be easily sorted by the processor time spent (cpu property):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Sort-Object</span> –Property cpu</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The -Property parameter can be omitted when calling the Sort-Object cmdlet - it is used by default. </font><font style="vertical-align: inherit;">For reverse sorting, use the -Descending parameter:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Sort-Object</span> cpu <span class="hljs-literal">-Descending</span></code></pre><br>
<img src="https://habrastorage.org/webt/i5/-l/og/i5-logdefolkpn4oiqab5549qac.png"><br>
<br>
<a name="section5"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selection of objects and their parts</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Select-Object cmdlet allows you to select a specific number of objects at the beginning or at the end of a pipeline using the -First or -Last parameters. </font><font style="vertical-align: inherit;">With it, you can select single objects or certain properties, as well as create new objects on their basis. </font><font style="vertical-align: inherit;">Let’s look at the cmdlet’s work using simple examples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following command displays information about 10 processes consuming the maximum amount of RAM (WS property):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Sort-Object</span> WS <span class="hljs-literal">-Descending</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-First</span> <span class="hljs-number">10</span></code></pre><br>
<img src="https://habrastorage.org/webt/uz/tk/4g/uztk4gok8nqkynaqcaupcito0ri.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can select only certain properties of objects passing through the pipeline and create new ones on their basis:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> ProcessName, Id <span class="hljs-literal">-First</span> <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result of the pipeline, we will get a new object, the structure of which will be different from the structure returned by the Get-Process cmdlet. </font><font style="vertical-align: inherit;">We will verify this using Get-Member:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> ProcessName, Id <span class="hljs-literal">-First</span> <span class="hljs-number">1</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/fw/2y/0c/fw2y0cn_xin2jr571bsy1crcite.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that Select-Object returns a single object (-First 1), which has only two fields specified by us: their values ​​were copied from the first object passed to the pipeline with the Get-Process cmdlet. </font><font style="vertical-align: inherit;">Using Select-Object, one of the ways to create objects in PowerShell scripts is based:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$obj</span> = <span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> ProcessName, Id <span class="hljs-literal">-First</span> <span class="hljs-number">1</span>
<span class="hljs-variable">$obj</span>.GetType()</code></pre><br>
<img src="https://habrastorage.org/webt/lf/rp/fo/lfrpfonoe8e6xidulqfn8s6xfh8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using Select-Object, you can add computed properties to objects that must be represented as a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash table</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In this case, the value of its first key corresponds to the name of the property, and the value of the second corresponds to the value of the property for the current element of the pipeline:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> ProcessName, <span class="hljs-selector-tag">@</span>{Name=<span class="hljs-string">"StartTime"</span>; Expression = {<span class="hljs-variable">$_</span>.StartTime.Minute}}</code></pre><br>
<img src="https://habrastorage.org/webt/vm/oq/6l/vmoq6l8umcadkrnqomarqazayms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the structure of objects passing through the pipeline:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> ProcessName, <span class="hljs-selector-tag">@</span>{Name=<span class="hljs-string">"StartTime"</span>; Expression = {<span class="hljs-variable">$_</span>.StartTime.Minute}} | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/zt/_a/df/zt_adfbgvhdylarb7lxrrj1gpp4.png"><br>
<br>
<a name="section6"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ForEach-Object, Group-Object and Measure-Object</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are other cmdlets for working with objects. </font><font style="vertical-align: inherit;">For example, we’ll talk about the three most useful: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ForEach-Object</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> allows you to execute PowerShell code for each object in the pipeline:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">ForEach-Object</span> {   }</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Group-Object</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> groups objects by property value:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Group-Object</span> PropertyName</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you run it with the -NoElement parameter, you can find out the number of elements in groups. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Measure-Object</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aggregates various summary parameters by the values ​​of the fields of objects in the pipeline (calculates the sum, and also finds the minimum, maximum or average value):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Measure-Object</span> <span class="hljs-literal">-Property</span> PropertyName <span class="hljs-literal">-Minimum</span> <span class="hljs-literal">-Maximum</span> <span class="hljs-literal">-Average</span> <span class="hljs-literal">-Sum</span></code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, the considered cmdlets are used interactively, and scripts often create </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">functions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with Begin, Process, and End blocks.</font></font><br>
<br>
<a name="section7"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating .NET and COM Objects (New-Object)</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are many software components with .NET Core and COM interfaces that are useful to system administrators. </font><font style="vertical-align: inherit;">Using the System.Diagnostics.EventLog class, you can manage system logs directly from Windows PowerShell. </font><font style="vertical-align: inherit;">Let's look at an example of creating an instance of this class using the New-Object cmdlet with the -TypeName parameter:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Diagnostics.EventLog</code></pre><br>
<img src="https://habrastorage.org/webt/xu/qr/dg/xuqrdgtwodglftnhuszvu4uxaws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we did not specify a specific event log, the resulting instance of the class contains no data. </font><font style="vertical-align: inherit;">To change this, during its creation, you must call the special constructor method using the -ArgumentList parameter. </font><font style="vertical-align: inherit;">If we want to access the application log, pass the string “Application” as an argument to the constructor:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$AppLog</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Diagnostics.EventLog <span class="hljs-literal">-ArgumentList</span> Application
<span class="hljs-variable">$AppLog</span></code></pre><br>
<img src="https://habrastorage.org/webt/gj/dl/vv/gjdlvvpxyezep9mwm180v702fb0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note: we saved the output of the command in the $ AppLog variable. </font><font style="vertical-align: inherit;">Although pipelines are commonly used in interactive mode, scripting often requires maintaining an object reference. </font><font style="vertical-align: inherit;">In addition, the main .NET Core classes are contained in the System namespace: PowerShell searches by default for the specified types in it, so writing Diagnostics.EventLog instead of System.Diagnostics.EventLog is quite correct. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To work with the journal, you can refer to the appropriate methods:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$AppLog</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-MemberType</span> Method</code></pre><br>
<img src="https://habrastorage.org/webt/t7/90/c5/t790c5xr4ripd1fr9la0euc5yym.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's say it is cleared using the Clear () method with access rights:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$AppLog</span>.Clear()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The New-Object cmdlet is also used to work with COM components. </font><font style="vertical-align: inherit;">There are quite a lot of them - from the libraries supplied with the Windows scripting server to ActiveX applications, such as, for example, Internet Explorer. </font><font style="vertical-align: inherit;">To create a COM object, you need to specify the -ComObject parameter with the program identifier ProgId of the desired class:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Shell
<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Network
<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Scripting.Dictionary
<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Scripting.FileSystemObject</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create your own objects with an arbitrary structure, using New-Object looks too archaic and cumbersome; this cmdlet is used to work with software components external to PowerShell. </font><font style="vertical-align: inherit;">In subsequent articles, this issue will be discussed in more detail. </font><font style="vertical-align: inherit;">In addition to .NET and COM objects, we will also learn about CIM (WMI) and ADSI objects.</font></font><br>
<br>
<a name="section8"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calling Static Methods</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is not possible to create instances of some .NET Core classes: these include System.Environment and System.Math. </font><font style="vertical-align: inherit;">They are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and contain only static properties and methods. </font><font style="vertical-align: inherit;">In essence, these are reference libraries that are used without creating objects. </font><font style="vertical-align: inherit;">You can refer to a static class through a literal, enclosing the type name in square brackets. </font><font style="vertical-align: inherit;">Moreover, if you look at the structure of the object using Get-Member, we will see the type System.RuntimeType instead of System.Environment:</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">System.Environment</span>] | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/ik/he/k0/ikhek0k2z6vca22zc3eycacvo5i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To view only static elements, you need to call Get-Member with the -Static parameter (pay attention to the type of object):</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">System.Environment</span>] | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-Static</span></code></pre><br>
<img src="https://habrastorage.org/webt/o0/g7/pb/o0g7pb_kewdzes-asln_mcgslz4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To access static properties and methods, two consecutive colons are used instead of a period after a literal:</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">System.Environment</span>]::OSVersion</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$test</span>=[<span class="hljs-type">System.Math</span>]::Sqrt(<span class="hljs-number">25</span>) 
<span class="hljs-variable">$test</span>
<span class="hljs-variable">$test</span>.GetType()</code></pre><br>
<img src="https://habrastorage.org/webt/yi/da/cs/yidacsgbamkq7sxl32r51ifmie0.png"><br>
<br>
<a name="section9"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type PSCustomObject</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Among the many data types available in PowerShell, it is worth mentioning PSCustomObject, designed to store objects with an arbitrary structure. </font><font style="vertical-align: inherit;">Creating such an object using the New-Object cmdlet is considered a classic, but cumbersome and obsolete way:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = <span class="hljs-built_in">New-Object</span>  –TypeName PSCustomObject <span class="hljs-literal">-Property</span> <span class="hljs-selector-tag">@</span>{Name = <span class="hljs-string">'Ivan Danko'</span>; <font></font>
                                          City = <span class="hljs-string">'Moscow'</span>;<font></font>
                                          Country = <span class="hljs-string">'Russia'</span>}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's look at the structure of the object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/m8/jr/vx/m8jrvxzu6wvnk4x2oi3bt-6w6zg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starting with PowerShell 3.0, another syntax is available:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = [<span class="hljs-type">PSCustomObject</span>]<span class="hljs-selector-tag">@</span>{Name = <span class="hljs-string">'Ivan Danko'</span>; <font></font>
                                          City = <span class="hljs-string">'Moscow'</span>;<font></font>
                                          Country = <span class="hljs-string">'Russia'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can access the data in one of the equivalent ways:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span>.Name<font></font>
<font></font>
<span class="hljs-variable">$object</span>.<span class="hljs-string">'Name'</span><font></font>
<font></font>
<span class="hljs-variable">$value</span> = <span class="hljs-string">'Name'</span>
<span class="hljs-variable">$object</span>.<span class="hljs-variable">$value</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is an example of converting an existing hash table into an object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$hash</span> = <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Name'</span>=<span class="hljs-string">'Ivan Danko'</span>; <span class="hljs-string">'City'</span>=<span class="hljs-string">'Moscow'</span>; <span class="hljs-string">'Country'</span>=<span class="hljs-string">'Russia'</span>}
<span class="hljs-variable">$hash</span>.GetType()
<span class="hljs-variable">$object</span> = [<span class="hljs-type">pscustomobject</span>]<span class="hljs-variable">$hash</span>
<span class="hljs-variable">$object</span>.GetType()
</code></pre><br>
<img src="https://habrastorage.org/webt/m1/uu/ga/m1uugarnq3obtfdapd18xzqecva.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the drawbacks of objects of this type is that the order of their properties can change. </font><font style="vertical-align: inherit;">To avoid this, you must use the [ordered] attribute:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = [<span class="hljs-type">PSCustomObject</span>][<span class="hljs-type">ordered</span>]<span class="hljs-selector-tag">@</span>{Name = <span class="hljs-string">'Ivan Danko'</span>; <font></font>
                                          City = <span class="hljs-string">'Moscow'</span>;<font></font>
                                          Country = <span class="hljs-string">'Russia'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are other options for creating an object: above we examined the use of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select-Object cmdlet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It remains to deal with the addition and removal of elements. </font><font style="vertical-align: inherit;">To do this for the object from the previous example is quite simple:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> | <span class="hljs-built_in">Add-Member</span> –MemberType NoteProperty –Name Age  –Value <span class="hljs-number">33</span>
<span class="hljs-variable">$object</span> | <span class="hljs-built_in">Get-Member</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/au/3v/fg/au3vfg5kkxvcg9hhotimmx_viog.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Add-Member cmdlet allows you to add not only properties, but also methods to the previously created $ object object using the "-MemberType ScriptMethod" construct:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$ScriptBlock</span> = {
    <span class="hljs-comment">#  </span><font></font>
}<font></font>
<span class="hljs-variable">$object</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">"MyMethod"</span> <span class="hljs-literal">-MemberType</span> ScriptMethod <span class="hljs-literal">-Value</span> <span class="hljs-variable">$ScriptBlock</span>
<span class="hljs-variable">$object</span> | <span class="hljs-built_in">Get-Member</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: to store the code for the new method, we used the $ ScriptBlock variable of type ScriptBlock. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1k/h7/um/1kh7umvv2w2ralp_6xwyxvhq2za.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To remove properties, use the appropriate method:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span>.psobject.properties.remove(<span class="hljs-string">'Name'</span>)</code></pre><br>
<a name="section10"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating Your Own Classes</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell 5.0 introduces the ability to define </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the characteristic syntax for object-oriented programming languages. </font><font style="vertical-align: inherit;">The service word Class is intended for this, after which you should specify the class name and describe its body in operator brackets:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span></span><font></font>
{<font></font>
    <span class="hljs-comment">#  </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a true type of .NET Core, the body of which describes its properties, methods, and other elements. </font><font style="vertical-align: inherit;">Consider an example of a simple class definition:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span></span> <font></font>
{<font></font>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Name</span>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$City</span>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Country</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To create an object (an instance of a class), use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New-Object</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmdlet </font><font style="vertical-align: inherit;">or a literal of the [MyClass] type and the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pseudostatic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> new </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">method</font></a><font style="vertical-align: inherit;"> (default constructor):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> MyClass</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
or</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = [<span class="hljs-type">MyClass</span>]::new()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let us analyze the structure of the object:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/gk/pt/pr/gkptprl6q2cwswt7lsdb2-0e_w8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not forget about scope: you cannot refer to the type name as a string or use a type literal outside the script or module in which the class is defined. </font><font style="vertical-align: inherit;">At the same time, functions can return instances of the class (objects) that will be available outside the module or script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After creating the object, fill in its properties:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span>.Name = <span class="hljs-string">'Ivan Danko'</span>
<span class="hljs-variable">$object</span>.City = <span class="hljs-string">'Moscow'</span>
<span class="hljs-variable">$object</span>.Country = <span class="hljs-string">'Russia'</span>
<span class="hljs-variable">$object</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/tj/x4/sq/tjx4sqnhix6a4d7wmd_kqahdnj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that in the class description not only property types are set, but also their default values:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span></span><font></font>
{<font></font>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Name</span> = <span class="hljs-string">'John Doe'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The description of the class method resembles the description of a function, but without using the function word function. </font><font style="vertical-align: inherit;">As in the function, the parameters are passed to the methods, if necessary:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span></span> <font></font>
{<font></font>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Name</span>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$City</span>
     [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Country</span><font></font>
     <font></font>
     <span class="hljs-comment"># </span>
     Smile([<span class="hljs-built_in">bool</span>]<span class="hljs-variable">$param1</span>)<font></font>
     {<font></font>
         <span class="hljs-keyword">If</span>(<span class="hljs-variable">$param1</span>) {
            <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">':)'</span><font></font>
         }<font></font>
     }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the representative of our class knows how to smile:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$object</span> = [<span class="hljs-type">MyClass</span>]::new()
<span class="hljs-variable">$object</span>.Smile(<span class="hljs-variable">$true</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methods can be overloaded, in addition, the class has </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static properties and methods</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as well as constructors whose names coincide with the name of the class itself. </font><font style="vertical-align: inherit;">A class defined in a script or PowerShell module can serve as a base for another - this is how inheritance is implemented. </font><font style="vertical-align: inherit;">At the same time, the use of existing .NET classes is allowed as the base ones:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass2</span> : <span class="hljs-title">MyClass</span></span><font></font>
{<font></font>
      <span class="hljs-comment">#  ,     MyClass</span><font></font>
}<font></font>
[<span class="hljs-type">MyClass2</span>]::new().Smile(<span class="hljs-variable">$true</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our description of working with objects in PowerShell is hardly exhaustive. </font><font style="vertical-align: inherit;">In the following publications, we will try to deepen it with practical examples: the fifth article in the series will be devoted to the issues of integrating PowerShell with third-party software components. </font><font style="vertical-align: inherit;">Past parts can be found at the links below.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 1:   Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 2:     Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> 3:      ,  </a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494964/index.html">Neural networks and trading. Practical implementation</a></li>
<li><a href="../en494966/index.html">SCRUM: a poem about love and pain</a></li>
<li><a href="../en494968/index.html">Underwater Internet Cables: Who Routes Them</a></li>
<li><a href="../en494970/index.html">Introversion: randomness within the margin of error, or evolutionary mechanism of species conservation?</a></li>
<li><a href="../en494972/index.html">SEMrush vs SimilarWeb - who is more accurate?</a></li>
<li><a href="../en494990/index.html">Use time correctly: process automation in Tinder</a></li>
<li><a href="../en494992/index.html">About Mathematics, Pandemics, and Quarantines, continued</a></li>
<li><a href="../en494994/index.html">Significant proof of the theorem on computer science captures physics with mathematics</a></li>
<li><a href="../en494998/index.html">Algorithms for the exam in the SHAD</a></li>
<li><a href="../en495000/index.html">Data home: what kind of data is generated by the ecosystem of smart things</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>