<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¹ğŸ» ğŸ¬ ğŸ––ğŸ» Istioã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™ ğŸ˜¨ ğŸ‚ ğŸ¤’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Istio â€” , . Istio , Kubernetes â€” . Istio ,  Istio. ,  Istio Google Kubernetes Engine (GKE) Istio on GKE.
 

 , GKE, . , Istio . , , Kubernetes, servic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Istioã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/469515/"><p><img src="https://habrastorage.org/webt/qy/yw/v1/qyywv1qmzphh1svbblasrxjc6ym.jpeg"></p><br>
<p>Istio â€”     ,     .  Istio          ,            Kubernetes â€”    .     Istio   ,           <em></em> Istio.        ,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Istio  Google Kubernetes Engine (GKE)</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Istio on GKE</a>.</p><br>
<p>  ,            GKE,          .   ,  Istio    . ,       , Kubernetes, service mesh  Istio.</p><a name="habracut"></a><br>
<h3 id="zadachi"></h3><br>
<p>      :</p><br>
<ol>
<li>   hello world   .</li>
<li>    .</li>
<li>   .</li>
<li>  Kubernetes.</li>
<li>   .</li>
</ol><br>
<h3 id="prezhde-chem-nachat">  </h3><br>
<p> ,   Kubernetes Engine API:</p><br>
<ol>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Kubernetes Engine</a>   Google Cloud Platform.</li>
<li>   .</li>
<li>,   API   .     .</li>
<li>,    Google Cloud Platform   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">,    </a>.</li>
</ol><br>
<p>     Cloud Shell,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">g1-small  Google Compute Engine</a>  Linux   Debian,    Linux  macOS.</p><br>
<h3 id="variant-a-ispolzovanie-cloud-shell"> :  Cloud Shell</h3><br>
<p>  Cloud Shell:</p><br>
<ul>
<li>  Python 2  Python 3 ( <strong>virtualenv</strong>)  .</li>
<li>   <strong>gcloud</strong>, <strong>docker</strong>, <strong>git</strong>  <strong>kubectl</strong>,    ,  .</li>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>:<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,         Cloud Shell.</li>
<li>Emacs, Vim  Nano,       Cloud Shell.</li>
</ol></li>
</ul><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cloud Shell</a>:</p><br>
<ol>
<li>   GCP.</li>
<li>  <strong>Activate Cloud Shell</strong> ( Cloud Shell)      GCP.</li>
</ol><br>
<p><img src="https://habrastorage.org/webt/yu/sh/9x/yush9xie9_peummad02lgu2n5x8.png"></p><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> GCP</a>      Cloud Shell   .</p><br>
<p><img src="https://habrastorage.org/webt/yi/no/-q/yino-qj5bwaluwxlo3xtf0yr7ty.png"></p><br>
<h3 id="variant-b-ispolzovanie-instrumentov-komandnoy-stroki-lokalno"> :     </h3><br>
<p>       Linux  macOS,      :</p><br>
<ol>
<li><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Python 3  Python 2</a>.</p><br>
</li>
<li><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Cloud SDK</a>     <strong>gcloud</strong>.</p><br>
</li>
<li><p> <strong>kubectl</strong> â€”       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Kubernetes</a>.</p><br>
<pre><code class="plaintext hljs">gcloud components install kubectl</code></pre><br>
</li>
<li><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Docker Community Edition (CE)</a>.       <strong>docker</strong>,       .</p><br>
</li>
<li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Git</a>,      GitHub.</p><br>
</li>
</ol><br>
<h3 id="zagruzka-primera-koda">  </h3><br>
<ol>
<li><p>   <strong>helloserver</strong>:</p><br>
<pre><code class="plaintext hljs">git clone https://github.com/GoogleCloudPlatform/istio-samples</code></pre><br>
</li>
<li><p>    :</p><br>
<pre><code class="plaintext hljs">cd istio-samples/sample-apps/helloserver</code></pre><br>
</li>
</ol><br>
<h3 id="izuchenie-prilozheniya-s-neskolkimi-servisami">    </h3><br>
<p>    Python     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">REST</a>:</p><br>
<ul>
<li><strong>server</strong>:       <strong>GET, /</strong>,   Â«hello worldÂ»  .</li>
<li><strong>loadgen</strong>: ,     <strong>server</strong>,      .</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/b1/ky/lj/b1kyljxdkjdci12qtle2w3dmtjw.png"></p><br>
<h3 id="zapusk-prilozheniya-iz-ishodnogo-koda">    </h3><br>
<p>   ,    Cloud Shell   .<br>
1)   <strong>istio-samples/sample-apps/helloserver</strong>  <strong>server</strong>:</p><br>
<pre><code class="plaintext hljs">python3 server/server.py</code></pre><br>
<p>  <strong>server</strong>  :</p><br>
<pre><code class="plaintext hljs">INFO:root:Starting server...</code></pre><br>
<p>2)    ,     <strong>server</strong>.    Cloud Shell,   ,    .<br>
3)    <strong>server</strong>:</p><br>
<pre><code class="plaintext hljs">curl http://localhost:8080</code></pre><br>
<p>server :</p><br>
<pre><code class="plaintext hljs">Hello World!</code></pre><br>
<p>4)  ,     ,   ,   <strong>loadgen</strong>:</p><br>
<pre><code class="plaintext hljs">cd YOUR_WORKING_DIRECTORY/istio-samples/sample-apps/helloserver/loadgen</code></pre><br>
<p>5)    :</p><br>
<pre><code class="plaintext hljs">export SERVER_ADDR=http://localhost:8080<font></font>
export REQUESTS_PER_SECOND=5</code></pre><br>
<p>6)  <strong>virtualenv</strong>:</p><br>
<pre><code class="plaintext hljs">virtualenv --python python3 env</code></pre><br>
<p>7)   :</p><br>
<pre><code class="plaintext hljs">source env/bin/activate</code></pre><br>
<p>8)    <strong>loadgen</strong>:</p><br>
<pre><code class="plaintext hljs">pip3 install -r requirements.txt</code></pre><br>
<p>9)  <strong>loadgen</strong>:</p><br>
<pre><code class="plaintext hljs">python3 loadgen.py</code></pre><br>
<p>  <strong>loadgen</strong>    :</p><br>
<pre><code class="plaintext hljs">Starting loadgen: 2019-05-20 10:44:12.448415<font></font>
5 request(s) complete to http://localhost:8080</code></pre><br>
<p>    <strong>server</strong>      :</p><br>
<pre><code class="plaintext hljs">127.0.0.1 - - [21/Jun/2019 14:22:01] "GET / HTTP/1.1" 200 -<font></font>
INFO:root:GET request,<font></font>
Path: /<font></font>
Headers:<font></font>
Host: localhost:8080<font></font>
User-Agent: python-requests/2.22.0<font></font>
Accept-Encoding: gzip, deflate<font></font>
Accept: */*</code></pre><br>
<p>   ,       (     Cloud Shell).    <strong>localhost</strong>,     <strong>server</strong>.<br>
10)   <strong>loadgen</strong>  <strong>server</strong>,  <strong>Ctrl-c</strong>    .<br>
11)    <strong>loadgen</strong>   :</p><br>
<pre><code class="plaintext hljs">deactivate</code></pre><br>
<h3 id="upakovka-prilozheniya-v-konteynery">   </h3><br>
<p>    GKE,     â€” <strong>server</strong>  <strong>loadgen</strong> â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.  â€”    ,     .</p><br>
<p>    ,  <strong>Dockerfile</strong>. <strong>Dockerfile</strong> â€”   ,             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Docker.</a>        ,  Docker Hub  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Container Registry</a>.</p><br>
<p>    <strong>Dockerfile</strong>  <strong>server</strong>  <strong>loadgen</strong>    ,   .  â€” <strong>Dockerfile</strong>  <strong>server</strong>:</p><br>
<pre><code class="plaintext hljs">FROM python:3-slim as base<font></font>
FROM base as builder<font></font>
RUN apt-get -qq update \<font></font>
    &amp;&amp; apt-get install -y --no-install-recommends \<font></font>
        g++ \<font></font>
    &amp;&amp; rm -rf /var/lib/apt/lists/*<font></font>
<font></font>
# Enable unbuffered logging<font></font>
FROM base as final<font></font>
ENV PYTHONUNBUFFERED=1<font></font>
<font></font>
RUN apt-get -qq update \<font></font>
    &amp;&amp; apt-get install -y --no-install-recommends \<font></font>
        wget<font></font>
<font></font>
WORKDIR /helloserver<font></font>
<font></font>
# Grab packages from builder<font></font>
COPY --from=builder /usr/local/lib/python3.7/ /usr/local/lib/python3.7/<font></font>
<font></font>
# Add the application<font></font>
COPY . .<font></font>
<font></font>
EXPOSE 8080<font></font>
ENTRYPOINT [ "python", "server.py" ]</code></pre><br>
<ul>
<li> <strong>FROM python:3-slim as base</strong>  Docker   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Python 3</a>   .</li>
<li> <strong>COPY. .</strong>        (    <strong>server.py</strong>)    .</li>
<li><strong>ENTRYPOINT</strong>  ,     .         ,      <strong>server.py</strong>   .</li>
<li> <strong>EXPOSE</strong> ,  <strong>server</strong>     <strong>8080</strong>.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.  -  ,  ,    <strong>8080</strong>   .</li>
</ul><br>
<h3 id="podgotovka-k-konteynerizacii-prilozheniya">   </h3><br>
<p>1)    .  <strong>PROJECT_ID</strong>     GCP.</p><br>
<pre><code class="plaintext hljs">export PROJECT_ID="PROJECT_ID"</code></pre><br>
<pre><code class="plaintext hljs">export GCR_REPO="preparing-istio"</code></pre><br>
<p>   <strong>PROJECT_ID</strong>  <strong>GCR_REPO</strong>    Docker,        Container Registry.</p><br>
<p>2)   GCP       <strong>gcloud</strong>.</p><br>
<pre><code class="plaintext hljs">gcloud config set project $PROJECT_ID</code></pre><br>
<p>3)         <strong>gcloud</strong>.</p><br>
<pre><code class="plaintext hljs">gcloud config set compute/zone us-central1-b</code></pre><br>
<p>4) ,   Container Registry    GCP.</p><br>
<pre><code class="plaintext hljs">gcloud services enable containerregistry.googleapis.com</code></pre><br>
<h3 id="konteynerizaciya-server"> server</h3><br>
<ol>
<li><p>  ,    <strong>server</strong>:</p><br>
<pre><code class="plaintext hljs">cd YOUR_WORKING_DIRECTORY/istio-samples/sample-apps/helloserver/server/</code></pre><br>
</li>
<li><p>    <strong>Dockerfile</strong>   ,    :</p><br>
<pre><code class="plaintext hljs">docker build -t gcr.io/$PROJECT_ID/$GCR_REPO/helloserver:v0.0.1 .</code></pre><br>
</li>
</ol><br>
<p> <strong>-t</strong>   Docker.   ,      .</p><br>
<ol>
<li>   Container Registry:<br>
<pre><code class="plaintext hljs">docker push gcr.io/$PROJECT_ID/$GCR_REPO/helloserver:v0.0.1</code></pre></li>
</ol><br>
<h3 id="konteynerizaciya-loadgen"> loadgen</h3><br>
<p>1)   ,    <strong>loadgen</strong>:</p><br>
<pre><code class="plaintext hljs">cd ../loadgen</code></pre><br>
<p>2)  :</p><br>
<pre><code class="plaintext hljs">docker build -t gcr.io/$PROJECT_ID/$GCR_REPO/loadgen:v0.0.1 .</code></pre><br>
<p>3)    Container Registry:</p><br>
<pre><code class="plaintext hljs">docker push gcr.io/$PROJECT_ID/$GCR_REPO/loadgen:v0.0.1</code></pre><br>
<h3 id="prosmotr-spiska-obrazov">  </h3><br>
<p>      ,   :</p><br>
<pre><code class="plaintext hljs">gcloud container images list --repository gcr.io/$PROJECT_ID/preparing-istio</code></pre><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">NAME<font></font>
gcr.io/PROJECT_ID/preparing-istio/helloserver<font></font>
gcr.io/PROJECT_ID/preparing-istio/loadgen</code></pre><br>
<h3 id="sozdanie-klastera-gke">  GKE.</h3><br>
<p>         Cloud Shell     <strong>docker run</strong>.         . ,  ,  ,    ,          ,   .</p><br>
<p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GKE</a>. GKE â€”    ,      .     .  GKE   -   Kubernetes. Kubernetes     .</p><br>
<p>  GKE:</p><br>
<p>1)  :</p><br>
<pre><code class="plaintext hljs">gcloud container clusters create istioready \<font></font>
  --cluster-version latest \<font></font>
  --machine-type=n1-standard-2 \<font></font>
  --num-nodes 4</code></pre><br>
<p> <strong>gcloud</strong>   istioready   GCP    ,   .   Istio,     4     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">n1-standard-2</a>.</p><br>
<p>    .    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>2)        <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">kubectl</a></strong>,      :</p><br>
<pre><code class="plaintext hljs">gcloud container clusters get-credentials istioready</code></pre><br>
<p>3)     Kubernetes  <strong>kubectl</strong>. ,      :</p><br>
<pre><code class="plaintext hljs">kubectl get nodes</code></pre><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">NAME                                       STATUS   ROLES    AGE    VERSION<font></font>
gke-istoready-default-pool-dbeb23dc-1vg0   Ready    &lt;none&gt;   99s    v1.13.6-gke.13<font></font>
gke-istoready-default-pool-dbeb23dc-36z5   Ready    &lt;none&gt;   100s   v1.13.6-gke.13<font></font>
gke-istoready-default-pool-dbeb23dc-fj7s   Ready    &lt;none&gt;   99s    v1.13.6-gke.13<font></font>
gke-istoready-default-pool-dbeb23dc-wbjw   Ready    &lt;none&gt;   99s    v1.13.6-gke.13</code></pre><br>
<h3 id="klyuchevye-ponyatiya-kubernetes">  Kubernetes</h3><br>
<p>     GKE:</p><br>
<p><img src="https://habrastorage.org/webt/-s/x2/uj/-sx2ujtlifvzdtixzdqpnr9jzva.png"></p><br>
<p>     GKE,    Kubernetes.     ,     .</p><br>
<ul>
<li><strong>  </strong>.  GKE  â€”   .    Kubernetes       .  â€”   ,           .</li>
<li><strong>Podâ€™</strong>.  Kubernetes    podâ€™. Pod  Kubernetes â€”   . Pod     .    server  <strong>loadgen</strong>   podâ€™.   podâ€™   (,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">-</a>),          podâ€™.</li>
<li><strong></strong>.  Kubernetes  â€”  ,     podâ€™.     podâ€™,    .    podâ€™,     .</li>
<li><strong> Kubernetes</strong>.      GKE    <strong>loadgen</strong>  <strong>server</strong>.        Cloud Shell   ,     <strong>server</strong>   <strong>localhost:8080</strong>.    GKE podâ€™    .        ,     pod,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">podâ€™</a>   IP-.<br>
  IP-  <strong>server</strong>,      podâ€™.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Kubernetes</a>.  Kubernetes       podâ€™.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>. <strong>server</strong>  <strong>LoadBalancer</strong>,    IP-,    <strong>server</strong> -  .<br>
  Kubernetes    DNS,    DNS (, <strong>helloserver.default.cluster.local</strong>) .   podâ€™      podâ€™     .  DNS     ,   Cloud Shell   .</li>
</ul><br>
<h3 id="manifesty-kubernetes"> Kubernetes</h3><br>
<p>      ,     <strong>python3</strong> </p><br>
<p><strong>server.py</strong></p><br>
<p>  : Â« Â».</p><br>
<p>Kubernetes  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.  ,     Kubernetes,    ,    . , Kubernetes    podâ€™   ,      .</p><br>
<p>     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">YAML</a>.  YAML        Kubernetes.</p><br>
<p>    YAML  <strong>server</strong>  <strong>loadgen</strong>.   YAML        Kubernetes.</p><br>
<p><strong>server.yaml</strong></p><br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: helloserver<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: helloserver<font></font>
  replicas: 1<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        app: helloserver<font></font>
    spec:<font></font>
      terminationGracePeriodSeconds: 5<font></font>
      restartPolicy: Always<font></font>
      containers:<font></font>
      - name: main<font></font>
        image: gcr.io/google-samples/istio/helloserver:v0.0.1<font></font>
        imagePullPolicy: Always</code></pre><br>
<ul>
<li><strong>kind</strong>   .</li>
<li><strong>metadata.name</strong>   .</li>
<li>  <strong>spec</strong>    .</li>
<li><strong>spec.replicas</strong>    podâ€™.</li>
<li> <strong>spec.template</strong>   podâ€™.   podâ€™   <strong>image</strong>,    ,     Container Registry.</li>
</ul><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: hellosvc<font></font>
spec:<font></font>
  type: LoadBalancer<font></font>
  selector:<font></font>
    app: helloserver<font></font>
  ports:<font></font>
  - name: http<font></font>
    port: 80<font></font>
    targetPort: 8080</code></pre><br>
<ul>
<li><strong>LoadBalancer</strong>:     IP-  ,     IP-    -  .</li>
<li><strong>targetPort</strong>:   ,  <strong>EXPOSE 8080</strong>  <strong>Dockerfile</strong>   .    <strong>8080</strong>,       <strong>server</strong>  .    <strong>hellosvc.default.cluster.local:80</strong> ( : <strong>hellosvc</strong>)   <strong>8080</strong> IP-  <strong>helloserver</strong>.</li>
<li><strong>port</strong>:   ,        .</li>
</ul><br>
<p><strong>loadgen.yaml</strong></p><br>
<p>   <strong>loadgen.yaml</strong>   <strong>server.yaml</strong>.   ,      <strong>env</strong>.    ,   <strong>loadgen</strong>          .</p><br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: loadgenerator<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      app: loadgenerator<font></font>
  replicas: 1<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        app: loadgenerator<font></font>
    spec:<font></font>
      terminationGracePeriodSeconds: 5<font></font>
      restartPolicy: Always<font></font>
      containers:<font></font>
      - name: main<font></font>
        image: gcr.io/google-samples/istio/loadgen:v0.0.1<font></font>
        imagePullPolicy: Always<font></font>
        env:<font></font>
        - name: SERVER_ADDR<font></font>
          value: "http://hellosvc:80/"<font></font>
        - name: REQUESTS_PER_SECOND<font></font>
          value: "10"<font></font>
        resources:<font></font>
          requests:<font></font>
            cpu: 300m<font></font>
            memory: 256Mi<font></font>
          limits:<font></font>
            cpu: 500m<font></font>
            memory: 512Mi</code></pre><br>
<p> <strong>loadgen</strong>    ,   <strong>type</strong>  <strong>ClusterIP</strong>.     IP-,      ,   IP-    .</p><br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: Service<font></font>
metadata:<font></font>
  name: loadgensvc<font></font>
spec:<font></font>
  type: ClusterIP<font></font>
  selector:<font></font>
    app: loadgenerator<font></font>
  ports:<font></font>
  - name: http<font></font>
    port: 80<font></font>
    targetPort: 8080</code></pre><br>
<h3 id="razvertyvanie-konteynerov-v-gke">   GKE</h3><br>
<p>1)   ,    <strong>server</strong>:</p><br>
<pre><code class="plaintext hljs">cd YOUR_WORKING_DIRECTORY/istio-samples/sample-apps/helloserver/server/</code></pre><br>
<p>2)  <strong>server.yaml</strong>   .<br>
3)     <strong>image</strong>     Docker.</p><br>
<pre><code class="plaintext hljs">image: gcr.io/PROJECT_ID/preparing-istio/helloserver:v0.0.1</code></pre><br>
<p> <strong>PROJECT_ID</strong>     GCP.<br>
4)    <strong>server.yaml</strong>.<br>
5)   YAML  Kubernetes:</p><br>
<pre><code class="plaintext hljs">kubectl apply -f server.yaml</code></pre><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">deployment.apps/helloserver created<font></font>
service/hellosvc created</code></pre><br>
<p>6)   ,   <strong>loadgen</strong>:</p><br>
<pre><code class="plaintext hljs">cd ../loadgen</code></pre><br>
<p>7)  <strong>loadgen.yaml</strong>   .<br>
8)     <strong>image</strong>     Docker.</p><br>
<pre><code class="plaintext hljs">image: gcr.io/PROJECT_ID/preparing-istio/loadgenv0.0.1</code></pre><br>
<p> <strong>PROJECT_ID</strong>     GCP.<br>
9)    <strong>loadgen.yaml</strong>,   .<br>
10)   YAML  Kubernetes:</p><br>
<pre><code class="plaintext hljs">kubectl apply -f loadgen.yaml</code></pre><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">deployment.apps/loadgenerator created<font></font>
service/loadgensvc created</code></pre><br>
<p>11)   :</p><br>
<pre><code class="plaintext hljs">kubectl get pods</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs">NAME                             READY   STATUS    RESTARTS   AGE<font></font>
helloserver-69b9576d96-mwtcj     1/1     Running   0          58s<font></font>
loadgenerator-774dbc46fb-gpbrz   1/1     Running   0          57s</code></pre><br>
<p>12)      <strong>loadgen</strong>.  <strong>POD_ID</strong>     .</p><br>
<pre><code class="plaintext hljs">kubectl logs loadgenerator-POD_ID</code></pre><br>
<p>13)   IP- <strong>hellosvc</strong>:</p><br>
<pre><code class="plaintext hljs">kubectl get service</code></pre><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">NAME         TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)        AGE<font></font>
hellosvc     LoadBalancer   10.81.15.158   192.0.2.1       80:31127/TCP   33m<font></font>
kubernetes   ClusterIP      10.81.0.1      &lt;none&gt;          443/TCP        93m<font></font>
loadgensvc   ClusterIP      10.81.15.155   &lt;none&gt;          80/TCP         4m52s</code></pre><br>
<p>14)    <strong>hellosvc</strong>:  <strong>EXTERNAL_IP</strong>   IP- <strong>hellosvc</strong>.</p><br>
<pre><code class="plaintext hljs">curl http://EXTERNAL_IP</code></pre><br>
<h3 id="beremsya-za-istio">  Istio</h3><br>
<p>    ,   GKE. <strong>loadgen</strong>   Kubernetes DNS (<strong>hellosvc:80</strong>),     <strong>server</strong>,       <strong>server</strong>   IP-.   Kubernetes  , -     :</p><br>
<ul>
<li><strong>  ?</strong>    ?     ?   ,  <strong>loadgen</strong>    <strong>server</strong>,  ,       .     ,       GKE.</li>
<li><strong></strong>.   <strong>server</strong>    ?       server?     ?</li>
<li><strong>  </strong>.   <strong>loadgen</strong>  <strong>server</strong>    <strong>HTTP</strong>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">mTLS</a>?</li>
</ul><br>
<p>     Istio.   Istio  sidecar- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Envoy</a>   pod.  Envoy         .  ,  <strong>server</strong>  <strong>loadgen</strong>   sidecar- Envoy,     <strong>loadgen</strong>  <strong>server</strong>    Envoy.</p><br>
<p>   Envoy  service mesh.  service mesh     Kubernetes.</p><br>
<p><img src="https://habrastorage.org/webt/7n/sk/z-/7nskz-5os2onyoaaf5kz5x38ve4.png"></p><br>
<p>  Envoy    , Istio     GKE,     .    - ,        Istio:</p><br>
<ul>
<li>   .   <strong>server</strong>  <strong>loadgen</strong>    Kubernetes.   <strong>loadgen</strong>,      ,  .</li>
<li>      .   GKE      , Istio   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>     .   YAML   <strong>server</strong>  <strong>http</strong>,   server   <strong>HTTP</strong>.   <strong>service</strong>  <strong>gRPC</strong>,     <strong>grpc</strong>.</li>
<li> .        Istio,       .</li>
</ul><br>
<h3 id="ustanovka-istio"> Istio</h3><br>
<p> Istio   .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Istio on GKE</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> - Istio</a>  .  Istio on GKE       Istio      GKE.       Istio        Istio,  -   Istio on GKE.    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Istio on GKE?</a>.</p><br>
<p> ,      ,   Istio  .     Istio     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  sidecarâ€™</a>    <strong>default</strong>.</p><br>
<h3 id="ochistka"></h3><br>
<p>   Google Cloud Platform     ,      ,   ,   Istio     .       ,   ,    .</p><br>
<h3 id="chto-dalshe"> ?</h3><br>
<ul>
<li><p>  :</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Docker</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Container Registry</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Kubernetes</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GKE</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Service mesh</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Istio</a></li>
</ol><br>
</li>
<li><p>  :</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Cloud SDK</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  <strong>gcloud</strong></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>kubectl</strong></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong>docker</strong></a></li>
</ol><br>
</li>
<li><p>  Kubernetes:</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Podâ€™</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
</ol><br>
</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja469499/index.html">ParallelsãŒAppleã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’å¾æœã—ãŸæ–¹æ³•</a></li>
<li><a href="../ja469503/index.html">ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼šç§ãŸã¡ã¯2019å¹´ã«ãƒªãƒ¼ã‚¯ã‹ã‚‰åŠ å…¥è€…ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã—ã¾ã™</a></li>
<li><a href="../ja469505/index.html">ãƒ“ã‚¸ãƒã‚¹ã‚’æµ·å¤–å¸‚å ´ã«ã‚‚ãŸã‚‰ã™3ã¤ã®å®Ÿè·µçš„ãªæ–¹æ³•ï¼šå®Ÿéš›ã®ä¼æ¥­ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨æ‰‹æ³•</a></li>
<li><a href="../ja469507/index.html">3ç•ªç›®ã®Steam Windowsã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è„†å¼±æ€§ï¼ˆ0dayã§ã¯ãªã„ï¼‰</a></li>
<li><a href="../ja469509/index.html">è§’åº¦å›è·¯å›³ã€ã¾ãŸã¯ç§ãŒè§’åº¦ã‚¯ãƒªã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›¸ã„ãŸã¨ã</a></li>
<li><a href="../ja469521/index.html">è»¢å€’ã§ã¯ãªãä¹—ã‚‹ãŸã‚ã«ãƒã‚¤ã‚¯ã‚’è³¼å…¥ã—ã¾ã—ãŸ</a></li>
<li><a href="../ja469523/index.html">JavaScriptã§ã®å¤‰æ•°å®£è¨€ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¯¾ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ä¾å­˜æ€§</a></li>
<li><a href="../ja469525/index.html">é‰±å±±æ˜å‰Šæ©Ÿã®è‡ªå‹•åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ </a></li>
<li><a href="../ja469527/index.html">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ›ãƒ³ã¯ã‚¹ãƒ‘ã‚¤ã®è€³ã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja469529/index.html">ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ã‚ãªãŸã‚’å«Œã„ã¾ã™</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>