<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍💼 🏇🏾 🚕 层次深度缓冲区 💙 🏝️ 👨🏽‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="简短评论
 分层深度缓冲区是用作深度查询的加速结构的多级深度缓冲区（Z缓冲区）。与纹理Mip链一样，每个级别的大小通常是将全分辨率缓冲区的大小除以2的结果。在本文中，我将讨论从全分辨率缓冲区生成分层深度缓冲区的两种方法。
 
 首先，我将向您展示如何为深度缓冲区生成完整的Mip链，即使深度缓冲区的大...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>层次深度缓冲区</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494376/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fr/kx/e8/frkxe8hnnru9xzoo2g9k8qec2sq.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简短评论</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分层深度缓冲区是用作深度查询的加速结构的多级深度缓冲区（Z缓冲区）。与纹理Mip链一样，每个级别的大小通常是将全分辨率缓冲区的大小除以2的结果。在本文中，我将讨论从全分辨率缓冲区生成分层深度缓冲区的两种方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我将向您展示如何为深度缓冲区生成完整的Mip链，即使深度缓冲区的大小不等于2的幂，该深度链也可以在纹理坐标空间（或NDC）中保持深度查询的准确性。 （在Internet上，我遇到了不能保证这种准确性的代码示例，这会使在高Mip级别执行精确查询变得复杂。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，对于仅需要一个级别的下采样的情况，我将演示如何通过一次调用计算着色器来生成此级别，该计算着色器使用工作组共享内存中的原子操作。</font><font style="vertical-align: inherit;">在我的应用程序中，仅需要1/16 x 1/16的分辨率（mip级别4），使用计算着色器的方法</font><font style="vertical-align: inherit;">比对mip链进行几遍下采样的常规方法</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快2-3倍</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
层次深度（也称为Hi-Z）是3D图形中经常使用的一种技术。它是用来加速隐形几何形状（遮挡剔除）（中的微调</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），计算</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在屏幕空间反射</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">体积雾</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi-Z</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPU </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">通常被实现</font></a><font style="vertical-align: inherit;">为栅格化管线的一部分。如果碎片图块被先前渲染的基元完全覆盖，则可以通过芯片上缓存中的快速Hi-Z搜索操作完全跳过碎片图块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hi-Z的基本思想是通过读取较低分辨率的缓冲区来加速深度查询操作。</font><font style="vertical-align: inherit;">这比从缓冲区读取完整分辨率深度要快，原因有两个：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较低分辨率缓冲器的一个像素（或仅几个像素）可以用作高分辨率缓冲器的多个像素的近似值。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较低分辨率的缓冲区可能足够小并被缓存，从而极大地加快了搜索操作的执行速度（尤其是使用随机访问时）。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下采样的Hi-Z缓冲区级别的内容取决于如何使用它们（深度缓冲区是否将被</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“反转”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，应使用哪种类型的请求）。通常，Hi-Z缓冲区级别的</font><font style="vertical-align: inherit;">纹理像素会</font><font style="vertical-align: inherit;">存储</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在先前级别对应于它的所有纹理像素。有时和的值会</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同时</font><font style="vertical-align: inherit;">存储</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。简单平均值（通常在常规纹理的Mip级别中使用）很少使用，因为它们对于此类查询很少有用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hi-Z缓冲区通常几乎在出口处立即被请求，以避免在全分辨率缓冲区中进行进一步的处理和更精确的搜索操作。例如，如果我们存储值</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于同相的深度缓冲区（深度值越大，对象越远），我们可以快速准确地确定屏幕空间中的特定位置是否被深度缓冲区覆盖（如果其坐标Z&gt;是存储在某些位置的值（最大值） Hi-Z缓冲区的较高级别（即较低的分辨率））。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，我使用了“完全”一词：如果坐标Z &lt;=接收值（最大值），则不知道其缓冲区是否重叠。</font><font style="vertical-align: inherit;">在某些应用中，在不确定的情况下，可能有必要在缓冲区中搜索完整的分辨率深度。</font><font style="vertical-align: inherit;">在其他情况下，则不需要这样做（例如，如果只考虑了不必要的计算，而没有正确的渲染）。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的应用程序：在计算着色器中渲染粒子</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">PARTICULATE</font></a><font style="vertical-align: inherit;"> VR应用程序的引擎</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的计算着色器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">
实现</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">粒子渲染</font></a><font style="vertical-align: inherit;">时，我面临使用Hi-Z的</font><font style="vertical-align: inherit;">需求</font><font style="vertical-align: inherit;">。由于此渲染技术不使用具有固定功能的栅格化，因此需要对每个具有一个像素大小的粒子使用自己的深度检查。而且由于粒子没有以任何方式分类，因此深度缓冲区的访问（在最坏的情况下）几乎是随机的。</font><font style="vertical-align: inherit;">
全屏随机访问纹理上的搜索操作是降低性能的方法。为了减少负载，我首先在分辨率降低后的深度缓冲区中搜索深度，分辨率为原始分辨率的1/16 x 1/16。该缓冲区包含深度值。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它允许绝大多数可见粒子的计算渲染着色器跳过完整分辨率的深度测试。 （如果粒子深度是&lt;较低分辨率缓冲区中存储的最小深度，则我们知道它是绝对可见的。如果它是&gt; = min，则需要检查完整分辨率的深度缓冲区。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，在一般情况下，对可见粒子进行了深度测试成为低成本经营。 （对于与几何图形重叠的粒子，它更昂贵，但是它适合我们，因为它不会导致渲染成本，因此粒子仍然需要很少的计算。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于首先在较低分辨率深度的缓冲区中执行搜索（如上所述），这一事实，</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">粒子渲染时间最多减少35％</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与仅在全分辨率缓冲区中执行搜索的情况相比。</font><font style="vertical-align: inherit;">因此，对于我的应用，Hi-Z非常有益。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将介绍两种用于生成分层深度缓冲区的技术。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术1：生成完整的Mip链</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在许多Hi-Z应用中，需要创建完整的深度缓冲区Mip链。例如，当使用Hi-Z执行遮挡剔除时，将边界体积投影到屏幕空间中，并且使用投影的大小来选择适当的Mip级别（以便在每个重叠测试中包含固定数量的纹理像素）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从全分辨率深度缓冲区生成Mip链通常是一项简单的任务-对于级别N的每个纹理像素，我们获取</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或同时获取）先前生成的级别N-1中的相应4个纹理像素。我们执行顺序遍历（每次将大小减小一半），直到获得最后一个1x1的mip级别。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，在深度缓冲区的大小不等于2的幂的情况下，一切都变得更加复杂。由于用于深度缓冲区的Hi-Z通常是根据标准屏幕分辨率（很少是2的幂）构建的，因此我们需要找到解决此问题的可靠解决方案。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，让我们决定什么将意味着每个纹理像素Mip级别深度缓冲区的值。在本文中，我们将假定Mip链存储value </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。深度搜索操作应使用最近邻居的过滤，因为值的插值</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们来说</font><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">无用的，并且会损害所创建深度的Mip链的层次性质。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那么，我们获得的mip级别N的单个纹理像素的值到底意味着什么？这应该是最小值（</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全屏深度缓冲区的所有纹理像素的）在（规范化）纹理坐标空间中占据相同的空间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
换句话说，如果纹理的单独坐标（在区间</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="2.884ex" viewBox="0 -916.9 2457.1 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1224" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">[0, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）（通过过滤最接近的邻居）映射到全分辨率缓冲区的单个纹理像素，然后应将此全分辨率的纹理像素视为</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个后续更高的Mip级别上为纹理像素计算</font><font style="vertical-align: inherit;">的值的候选对象，</font><font style="vertical-align: inherit;">并映射相同的纹理坐标。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果保证了这种对应关系，那么我们将确保在高mip级别的搜索操作将永远不会在与全分辨率缓冲区（级别0）相对应的相同纹理坐标中返回depth值&gt; texel值。在单独的N的情况下，此保证会在其以下的所有级别（&lt;N）保持不变。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于偶数维（在全分辨率缓冲区为2的幂的情况下），每个级别的偶数维直到最末尾（维数等于1）都将很容易实现。</font><font style="vertical-align: inherit;">在一维情况下，对于具有索引的纹理元素</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.009ex" viewBox="0 -755.5 345.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">i</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在N级时，我们需要在N-1级时使用带有索引的纹理像素 </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.009ex" viewBox="0 -755.5 500.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 和 </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.968ex" height="2.134ex" viewBox="0 -755.5 2569.4 918.9" role="img" focusable="false" style="vertical-align: -0.38ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2B" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="2068" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">2i + 1</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并找到他们的意思</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.481ex" height="2.634ex" viewBox="0 -809.3 16137.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-29" x="15748" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以直接以“ 2比1”的比率比较纹理像素（因此也可以比较纹理坐标的大小），因为每个级别的大小恰好是前一个的两倍。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/ca7/b43/11fca7b43dd706d72f35590f69422e2c.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">均匀级别大小的示例：此级别上的6个纹理像素在更高级别上减少到3个。</font><font style="vertical-align: inherit;">三个高级别像素的每一个的纹理坐标大小都精确地叠加在每两个低级别像素上。</font><font style="vertical-align: inherit;">（点是纹理像素的中心，正方形是在过滤最近的邻居时纹理坐标的尺寸。）</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在奇数级大小的情况下（并且非分辨率为2的幂的全分辨率缓冲区将至少具有一个奇数大小的级）。越来越难。</font><font style="vertical-align: inherit;">对于奇数大小的N-1级</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.595ex" height="2.384ex" viewBox="0 -755.5 3270.2 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1637,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">\mathit{dim}_{N-1}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 下一级（N）的大小将相等 </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo>=</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230A;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230B;</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.865ex" height="3.759ex" viewBox="0 -1132.2 7261.2 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-6D" x="819" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="2315" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-3D" x="2643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-230A" x="3699" y="0"></use><g transform="translate(4144,0)"><g transform="translate(120,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="1469" y="-542"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-230B" x="6816" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo>=</mo><mo fence="false" stretchy="false">⌊</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence="false" stretchy="false">⌋</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">\mathit{dim}_{N} = \lfloor \frac{\mathit{dim}_{N-1}}{2} \rfloor</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即 </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2260;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.66ex" height="3.759ex" viewBox="0 -1132.2 3728.6 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2260" x="0" y="0"></use><g transform="translate(778,0)"><g transform="translate(397,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="1469" y="-542"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>≠</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-8">\neq \frac{\mathit{dim}_{N-1}}{2}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这意味着现在我们没有清晰的N-1级纹理像素到N级纹理像素的2对1映射。现在，N级每个纹理像素的纹理坐标大小叠加在</font><font style="vertical-align: inherit;">N-1级</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个纹理像素</font><font style="vertical-align: inherit;">的大小上</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48d/9d6/6e1/48d9d66e16424a3781e695a3340d2cb4.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奇数级别大小的示例：该级别的7个纹理像素在下一级别减少为3个纹理像素。</font><font style="vertical-align: inherit;">三个高级纹理像素的纹理坐标的尺寸从较低的水平叠加在三个纹理像素的尺寸上。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="51.493ex" height="2.634ex" viewBox="0 -809.3 22170.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2C" x="15748" y="0"></use><g transform="translate(16193,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="18654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="18933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-69" x="19433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2B" x="20001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="21002" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="21502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-29" x="21781" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1], D_{N-1}[2i + 2])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着N-1级别的一个纹理元素有时会影响N级别的</font><em><font style="vertical-align: inherit;">2</font></em><font style="vertical-align: inherit;">个纹理元素的</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。这对于维持上述比较是必要的。</font><font style="vertical-align: inherit;">
为了简单起见，以上描述仅在一个维度上给出。</font><font style="vertical-align: inherit;">在二维中，如果N-1级的两个维度都相等，则N-1级的2x2像素区域映射到N级的一个像素；如果其中一个维是奇数，则N-1级的2x3或3x2区域映射到一个。如果</font><em><font style="vertical-align: inherit;">两个</font></em><font style="vertical-align: inherit;">维度均为</font><font style="vertical-align: inherit;">奇数</font><font style="vertical-align: inherit;">，则还应考虑“角度”纹理像素，即，将N-1级别的3x3区域与N级别的一个像素进行比较。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码示例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面显示的G​​LSL着色器代码实现了我们描述的算法。</font><font style="vertical-align: inherit;">必须从级别1（级别0是完整分辨率级别）开始，为随后的每个mip执行该操作。</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_depthBuffer;<font></font>
uniform <span class="hljs-keyword">int</span> u_previousLevel;<font></font>
uniform ivec2 u_previousLevelDimensions;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
	ivec2 thisLevelTexelCoord = ivec2(gl_FragCoord);<font></font>
	ivec2 previousLevelBaseTexelCoord = <span class="hljs-number">2</span> * thisLevelTexelCoord;<font></font>
<font></font>
	vec4 depthTexelValues;<font></font>
	depthTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord,<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.z = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.w = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
<font></font>
	<span class="hljs-keyword">float</span> minDepth = min(min(depthTexelValues.x, depthTexelValues.y),<font></font>
                         min(depthTexelValues.z, depthTexelValues.w));<font></font>
<font></font>
    <span class="hljs-comment">// Incorporate additional texels if the previous level's width or height (or both) </span>
    <span class="hljs-comment">// are odd. </span>
	<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel = ((u_previousLevelDimensions.x &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel = ((u_previousLevelDimensions.y &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span> (shouldIncludeExtraColumnFromPreviousLevel) {<font></font>
		vec2 extraColumnTexelValues;<font></font>
		extraColumnTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>),<font></font>
                                              u_previousLevel).r;<font></font>
		extraColumnTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>),<font></font>
                                              u_previousLevel).r;<font></font>
<font></font>
		<span class="hljs-comment">// In the case where the width and height are both odd, need to include the </span>
        <span class="hljs-comment">// 'corner' value as well. </span>
		<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {
			<span class="hljs-keyword">float</span> cornerTexelValue = texelFetch(u_depthBuffer,<font></font>
                                                previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                                                u_previousLevel).r;<font></font>
			minDepth = min(minDepth, cornerTexelValue);<font></font>
		}<font></font>
		minDepth = min(minDepth, min(extraColumnTexelValues.x, extraColumnTexelValues.y));<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {<font></font>
		vec2 extraRowTexelValues;<font></font>
		extraRowTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		extraRowTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		minDepth = min(minDepth, min(extraRowTexelValues.x, extraRowTexelValues.y));<font></font>
	}<font></font>
<font></font>
	gl_FragDepth = minDepth;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这段代码有缺陷</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，如果全分辨率深度缓冲区的一个维度大于另一维度的两倍，则调用索引</font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会超出</font></font><code>u_depthBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 （在这种情况下，较小的尺寸先于1变为1。）我想使用此示例</font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用整数坐标），以便使所发生的事情尽可能清晰，并且不会亲自遇到如此特别的宽/高深度缓冲区。如果遇到此类问题，可以限制（</font></font><code>clamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）传输的</font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标</font><font style="vertical-align: inherit;">，也可以</font><font style="vertical-align: inherit;">使用</font></font><code>texture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纹理</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">规范化坐标（在采样器中，在边缘上设置一个限制）。在计算时，</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该始终多次考虑一个纹理像素是否存在边界情况。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其次，尽管</font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用一个替换</font><font style="vertical-align: inherit;">前四个调用</font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但这使事情变得复杂（因为</font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法显示mip级别）。</font><font style="vertical-align: inherit;">另外，使用时我没有注意到速度增加</font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我使用上面的片段着色器为VR引擎中的两个深度缓冲区（每只眼睛一个）生成了两个完整的Mip链。</font><font style="vertical-align: inherit;">在测试中，每只眼睛的分辨率为1648x1776，这导致创建了10个额外的降低的mip级别（这意味着10次通过）。</font><font style="vertical-align: inherit;">在NVIDIA GTX 980上花费了0.25毫秒，在AMD R9 290上花费了0.30毫秒，从而为双眼生成了一条完整的链。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/805/461/815/8054618153533c29d1de1000fcee2878.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/2b6/950/a8f2b6950b278655f3deff3ca456874c.png"></div><br>
<i>Mip- 4, 5  6,    ,     . ( ,     ,  ,     .) Mip- 4 — ,    (103x111)     2.</i><br>
<br>
<h2>   mip-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上述算法的任务是维持纹理坐标空间（或NDC）中深度查询的准确性。为了完整性（并且因为我在下面的2中的技术中拒绝了此保证），我想演示一下我遇到的另一种方法（例如，在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，与前一个方法一样，此替代方法也设计用于大小不为2的幂的全分辨率缓冲区（但是，当然，它们的大小等于2的幂）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种替代方法中，当对具有奇数宽度（或高度）的级别进行下采样而不是为每个输出纹理像素添加上一（较低）级别的附加列（或行）纹理像素时，我们仅对具有最大索引（“极端”纹理像素”的输出纹理像素执行此操作） ）上面显示的片段着色器中唯一发生变化的是设置值</font></font><code>shouldIncludeExtraColumnFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>shouldIncludeExtraRowFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// If the previous level's width is odd and this is the highest-indexed "edge" texel for </span>
<span class="hljs-comment">// this level, incorporate the rightmost edge texels from the previous level. The same goes </span>
<span class="hljs-comment">// for the height. </span>
<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.x == u_previousLevelDimensions.x - <span class="hljs-number">3</span>);
<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.y == u_previousLevelDimensions.y - <span class="hljs-number">3</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，具有最高索引的极端纹素变得非常“厚”，因为每个除以2个奇数维会导致这样一个事实，即它们占据了归一化纹理坐标空间的较大比例的间隔。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这种方法的缺点是执行高Mip级别的深度查询变得更加困难。</font><font style="vertical-align: inherit;">我们不仅需要使用归一化的纹理坐标，还需要确定与这些坐标相对应的全分辨率纹理像素，然后将该纹理像素的坐标转换为相应的Mip级别的坐标，并执行其请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面的代码段是从NDC空间迁移的</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.884ex" viewBox="0 -916.9 3235.6 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-10">[-1, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到mip级别的texel坐标</font></font><code>higherMipLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs">vec2 windowCoords = (<span class="hljs-number">0.5</span> * ndc.xy + vec2(<span class="hljs-number">0.5</span>)) * textureSize(u_depthBuffer, <span class="hljs-number">0</span>);
<span class="hljs-comment">// Account for texel centers being halfway between integers. </span>
ivec2 texelCoords = ivec2(round(windowCoords.xy - vec2(<span class="hljs-number">0.5</span>)));<font></font>
ivec2 higherMipLevelTexelCoords =<font></font>
    min(texelCoords / (<span class="hljs-number">1</span> &lt;&lt; higherMipLevel),<font></font>
        textureSize(u_depthBuffer, higherMipLevel).xy - ivec2(<span class="hljs-number">1</span>));</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术2：使用计算着色器生成单个Hi-Z水平</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成完整的Mip链非常快，但是让我有些烦恼的是，我的应用程序会生成所有这些级别，并且仅使用其中一个级别（级别4）。</font><font style="vertical-align: inherit;">除了消除这种效率低下的问题，我还想看看如果仅使用一个计算着色器调用来生成所需的级别，那么可以加速多少工作。</font><font style="vertical-align: inherit;">（值得注意的是，当使用带有多遍片段着色器的解决方案时，我的应用程序可以在第4级停止，因此在本节的最后，我将其用作比较运行时的基础。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在大多数Hi-Z应用中，仅需要一个深度级别，因此我发现这种情况很常见。我为自己的特定要求编写了计算着色器（生成级别4，其分辨率为原始级别的1/16 x 1/16）。类似的代码可用于生成不同的级别。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
计算着色器非常适合此任务，因为它可以使用共享的工作组内存在线程之间交换数据。每个工作组负责一个输出纹理像素（通过对缓冲区的下采样减少），并且工作组的线程共享计算</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全分辨率相应纹理像素</font><font style="vertical-align: inherit;">的工作</font><font style="vertical-align: inherit;">，并通过共享内存共享结果。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我尝试了基于计算着色器的两个主要解决方案。首先，每个线程都</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要一个共享内存变量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，由于程序员无法（没有特定制造商的硬件扩展）对非整数值执行原子操作（并且我的深度存储为</font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），因此这里需要一些技巧。因为当它们的位作为无符号整数值进行处理非负浮动的IEEE 754标准保留它们的顺序点值，我们可以使用</font></font><code>floatBitsToUint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使（使用重新解释铸造）的深度值</font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后调用</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（以然后执行</font></font><code>uintBitsToFloat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对成品最小值</font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">） 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最明显的解决方案</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是创建16x16线程组，其中每个线程接收一个texel，然后</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用共享内存中的值</font><font style="vertical-align: inherit;">执行它</font><font style="vertical-align: inherit;">。我比较了使用较小流块（8x8、4x8、4x4、2x4、2x2）的这种方法，其中每个流接收一个texel区域并计算其自身的局部最小值，然后调用</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有这些经过测试的解决方案中最快的</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA和AMD都提出了具有4x4流模块的解决方案（其中每个流本身都接收4x4 texel区域）。</font><font style="vertical-align: inherit;">我不太明白为什么这个选择最快，但是也许反映了原子操作竞争和独立流计算之间的折衷。</font><font style="vertical-align: inherit;">还值得注意的是，4x4工作组的大小每个扭曲/波动仅使用16个线程（并且也可以使用32或64个线程），这很有趣。</font><font style="vertical-align: inherit;">下面的示例实现了这种方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为使用的替代方法，</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我尝试使用在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">此NVIDIA演示文稿中引用</font></a><font style="vertical-align: inherit;">的技术执行并行还原</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">（基本思想是使用与工作组中的线程数相同大小的共享内存阵列，以及</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于依次联合计算</font><font style="vertical-align: inherit;">每个线程</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">低点，直到获得整个工作组的最终最小值。）</font><font style="vertical-align: inherit;">
我使用与解决方案c相同的所有工作组大小尝试了此解决方案</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">即使采用了NVIDIA演示文稿中描述的所有优化措施，并行还原解决方案（</font><font style="vertical-align: inherit;">我</font><font style="vertical-align: inherit;">在两个GPU上都具有10个GPU的情况下）仍比</font><font style="vertical-align: inherit;">我提出</font><font style="vertical-align: inherit;">的解决方案稍慢</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另外，带有</font><font style="vertical-align: inherit;">代码</font><font style="vertical-align: inherit;">的解决方案</font><font style="vertical-align: inherit;">要简单得多。</font></font><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>log</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.23ex" height="2.634ex" viewBox="0 -809.3 3112.9 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-6F" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-67" x="779" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-32" x="1809" y="-343"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-28" x="1733" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMATHI-6E" x="2122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhGjLUbrnpJAfRYwPlGVdA5ve1iaA#MJMAIN-29" x="2723" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>log</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">\log_{2} (n)</script><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码示例</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用此方法，最简单的方法是不尝试在减少缓冲区和全分辨率纹理像素之间的纹理坐标的标准化空间中保持对应关系。</font><font style="vertical-align: inherit;">您可以简单地执行从全分辨率的texel坐标到降低分辨率的texel坐标的转换：</font></font><br>
<br>
<pre><code class="cpp hljs">ivec2 reducedResTexelCoords = texelCoords / ivec2(downscalingFactor);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我的情况下（生成等价于4级的等价点）</font></font><code>downscalingFactor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是16。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如上所述，此GLSL计算着色器实现了具有</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4x4工作组大小</font><font style="vertical-align: inherit;">的解决方案</font><font style="vertical-align: inherit;">，其中每个线程从全分辨率缓冲区接收4x4 texel区域。</font><font style="vertical-align: inherit;">所得到的减小的深度深度缓冲区</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为全分辨率缓冲区大小的1/16 x 1/16（如果全分辨率大小不能被16整除，则四舍五入）。</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_inputDepthBuffer;<font></font>
uniform <span class="hljs-keyword">restrict</span> writeonly image2DArray u_outputDownsampledMinDepthBufferImage;
<span class="hljs-comment">// The dimension in normalized texture coordinate space of a single texel in </span>
<span class="hljs-comment">// u_inputDepthBuffer. </span><font></font>
uniform vec2 u_texelDimensions;<font></font>
<font></font>
<span class="hljs-comment">// Resulting image is 1/16th x 1/16th resolution, but we fetch 4x4 texels per thread, hence </span>
<span class="hljs-comment">// the divisions by 4 here. </span>
layout(local_size_x = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_y = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_z = <span class="hljs-number">1</span>) in;<font></font>
<font></font>
<span class="hljs-comment">// This is stored as uint because atomicMin only works on integer types. Luckily </span>
<span class="hljs-comment">// (non-negative) floats maintain their order when their bits are interpreted as uint (using </span>
<span class="hljs-comment">// floatBitsToUint). </span><font></font>
shared uint s_workgroupMinDepthEncodedAsUint;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// Initialize to 1.0 (max depth) before performing atomicMin's. </span>
		s_workgroupMinDepthEncodedAsUint = floatBitsToUint(<span class="hljs-number">1.0</span>);<font></font>
	}<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
	<span class="hljs-comment">// Fetch a 4x4 texel region per thread with 4 calls to textureGather. 'gatherCoords' </span>
    <span class="hljs-comment">// are set up to be equidistant from the centers of the 4 texels being gathered (which </span>
    <span class="hljs-comment">// puts them on integer values). In my tests textureGather was not faster than </span>
    <span class="hljs-comment">// individually fetching each texel - I use it here only for conciseness. </span>
    <span class="hljs-comment">// </span>
    <span class="hljs-comment">// Note that in the case of the full-res depth buffer's dimensions not being evenly </span>
    <span class="hljs-comment">// divisible by the downscaling factor (16), these textureGather's may try to fetch </span>
    <span class="hljs-comment">// out-of-bounds coordinates - that's fine as long as the texture sampler is set to </span>
    <span class="hljs-comment">// clamp-to-edge, as redundant values don't affect the resulting min. </span><font></font>
<font></font>
	uvec2 baseTexelCoords = <span class="hljs-number">4</span> * gl_GlobalInvocationID.xy;<font></font>
	vec2 gatherCoords1 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords2 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords3 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords4 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
<font></font>
	vec4 gatheredTexelValues1 = textureGather(u_inputDepthBuffer, gatherCoords1);<font></font>
	vec4 gatheredTexelValues2 = textureGather(u_inputDepthBuffer, gatherCoords2);<font></font>
	vec4 gatheredTexelValues3 = textureGather(u_inputDepthBuffer, gatherCoords3);<font></font>
	vec4 gatheredTexelValues4 = textureGather(u_inputDepthBuffer, gatherCoords4);<font></font>
<font></font>
	<span class="hljs-comment">// Now find the min across the 4x4 region fetched, and apply that to the workgroup min </span>
    <span class="hljs-comment">// using atomicMin. </span><font></font>
	vec4 gatheredTexelMins = min(min(gatheredTexelValues1, gatheredTexelValues2),<font></font>
                                 min(gatheredTexelValues3, gatheredTexelValues4));<font></font>
	<span class="hljs-keyword">float</span> finalMin = min(min(gatheredTexelMins.x, gatheredTexelMins.y),<font></font>
                         min(gatheredTexelMins.z, gatheredTexelMins.w));<font></font>
	atomicMin(s_workgroupMinDepthEncodedAsUint, floatBitsToUint(finalMin));<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
    <span class="hljs-comment">// Thread 0 writes workgroup-wide min to image. </span>
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">float</span> workgroupMinDepth = uintBitsToFloat(s_workgroupMinDepthEncodedAsUint);<font></font>
<font></font>
		imageStore(u_outputDownsampledMinDepthBufferImage,<font></font>
		           ivec2(gl_WorkGroupID.xy),<font></font>
                   <span class="hljs-comment">// imageStore can only be passed vec4, but only a float is stored. </span><font></font>
				   vec4(workgroupMinDepth));<font></font>
	}<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我使用了上面的计算着色器来处理具有与生成完整mip链相同的尺寸的全分辨率深度缓冲区（每只眼睛1648x1776缓冲区）。</font><font style="vertical-align: inherit;">它在NVIDIA GTX 980上的运行时间为0.12毫秒，在AMD R9 290上的运行时间为0.08毫秒。如果我们将生成时间仅为1-4 mip（在NVIDIA上为0.22 ms，在AMD上为0.25 ms），那么用计算着色器中的溶液被证明</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是与NVIDIA GPU的快87％</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">197％，比AMD的GPU更快</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
绝对而言，加速度不是很大，但是每0.1 ms很重要，尤其是在VR中：)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN494364/index.html">GDPR：同意处理个人数据</a></li>
<li><a href="../zh-CN494366/index.html">从3月27日开始，为期一周的在线mitaps（背面，移动，QA，PM等）</a></li>
<li><a href="../zh-CN494370/index.html">通过Python开发人员的眼光看清架构</a></li>
<li><a href="../zh-CN494372/index.html">全俄验证软件-内部视图</a></li>
<li><a href="../zh-CN494374/index.html">电动巴士及其电池：什么是钛酸锂？（第1部分）</a></li>
<li><a href="../zh-CN494380/index.html">战略产品管理导论</a></li>
<li><a href="../zh-CN494384/index.html">功能调查</a></li>
<li><a href="../zh-CN494390/index.html">3D打印将自动调整成本降低了一半</a></li>
<li><a href="../zh-CN494394/index.html">夏佩苏：中国计算机科学之母</a></li>
<li><a href="../zh-CN494396/index.html">欢迎垫-现在也有俄语</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>