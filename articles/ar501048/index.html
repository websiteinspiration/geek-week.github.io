<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ฝ ๐๐ฝ ๐ ุชูุธูู ุงูุนูู ุนู ุจุนุฏ SMB ุนูู OpenVPN ๐ง๐ป ๐ง ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุตูุงุบุฉ ุงููุดููุฉ
 ุชุตู ุงูููุงูุฉ ุชูุธูู ุงููุตูู ุนู ุจุนุฏ ููููุธููู ุนูู ููุชุฌุงุช ููุชูุญุฉ ุงููุตุฏุฑ ููููู ุงุณุชุฎุฏุงููุง ูุจูุงุก ูุธุงู ูุณุชูู ุชูุงููุง ูุณุชููู ูููุฏุฉ ููุชูุณุน ุนูุฏูุง ููู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ุชูุธูู ุงูุนูู ุนู ุจุนุฏ SMB ุนูู OpenVPN</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501048/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุงุบุฉ ุงููุดููุฉ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุตู ุงูููุงูุฉ ุชูุธูู ุงููุตูู ุนู ุจุนุฏ ููููุธููู ุนูู ููุชุฌุงุช ููุชูุญุฉ ุงููุตุฏุฑ ููููู ุงุณุชุฎุฏุงููุง ูุจูุงุก ูุธุงู ูุณุชูู ุชูุงููุง ูุณุชููู ูููุฏุฉ ููุชูุณุน ุนูุฏูุง ูููู ููุงู ููุต ูู ุงูุชุฑุงุฎูุต ูู ูุธุงู ุชุฌุงุฑู ูุงุฆู ุฃู ุนูุฏูุง ูููู ุฃุฏุงุฆู ุบูุฑ ูุงูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุบุฑุถ ูู ูุฐู ุงูููุงูุฉ ูู ุชูุฏูู ูุธุงู ูุงูู ูุชูููุฑ ุงููุตูู ุนู ุจุนุฏ ุฅูู ููุธูุฉ ุ ููู ูุง ูุฒูุฏ ููููุงู ุนู "ุชุซุจูุช OpenVPN ูู 10 ุฏูุงุฆู". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุชูุฌุฉ ูุฐูู ุ ูุญุตู ุนูู ูุธุงู ูุชู ููู ุงุณุชุฎุฏุงู ุงูุดูุงุฏุงุช ูุฏููู ุดุฑูุฉ Active Directory (ุงุฎุชูุงุฑููุง) ููุตุงุฏูุฉ ุงููุณุชุฎุฏู. ุฅูู. ูุญุตู ุนูู ูุธุงู ูุน ุนุงูููู ููุชุญูู - ูุง ูุฏู (ุงูุดูุงุฏุฉ) ููุง ุฃุนุฑูู (ูููุฉ ุงููุฑูุฑ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุงูุฉ ุนูู ุงูุณูุงุญ ูููุณุชุฎุฏู ุจุงูุงุชุตุงู ูู ุนุถููุชู ูู ูุฌููุนุฉ myVPNUsr. ุณูุชู ุงุณุชุฎุฏุงู ุงููุฑุฌุน ุงููุตุฏู ุจุดูู ูุณุชูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชูููุฉ ุชูููุฐ ุงูุญู ููุณุช ุณูู ููุงุฑุฏ ุฃุฌูุฒุฉ ุตุบูุฑุฉ ูุณุงุนุฉ ูุงุญุฏุฉ ูู ุนูู ูุณุคูู ุงููุธุงู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุณุชุฎุฏู ุฌูุงุฒูุง ุงูุชุฑุงุถููุง ูุน OpenVPN ู Easy-RSA ุงูุฅุตุฏุงุฑ ุงูุซุงูุซ ุนูู CetntOS 7 ุ ูุงูุฐู ูุนุชูุฏ ุนูู 100 ุงุชุตุงู ุฃุตุฏุฑ 4 vCPU ู 4 GiB RAM.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงููุซุงู ุ ุดุจูุฉ ูุคุณุณุชูุง ูู 172.16.0.0/16 ุ ุญูุซ ููุฌุฏ ุฎุงุฏู VPN ุจุงูุนููุงู 172.16.19.123 ูู ุงูุฌุฒุก 172.16.19.0/24 ุ ูุฎูุงุฏู DNS ูู 172.16.16.16 ู 172.16.17.17 ุ ูุงูุดุจูุฉ ุงููุฑุนูุฉ 172.16.20.0/23 ูุฎุตุตุฉ ูุนููุงุก VPN . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงุชุตุงู ูู ุงูุฎุงุฑุฌ ุ ูุชู ุงุณุชุฎุฏุงู ุงูุงุชุตุงู ุนูู ุงููููุฐ 1194 / UDP ุ ููุชู ุฅูุดุงุก ุณุฌู A gw.abc.ru ูู DNS ุงูุฎุงุต ุจุฎุงุฏููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ููุตุญ ุจุดุฏุฉ ุจุชุนุทูู SELinux! </font><font style="vertical-align: inherit;">ูุนูู OpenVPN ุจุฏูู ุชุนุทูู ุณูุงุณุงุช ุงูุฃูุงู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุญุชูู</font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุงู ุงูุชุดุบูู ูุชุซุจูุช ุจุฑูุงูุฌ ุงูุชุทุจูู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏ ุงูุชุดููุฑ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู OpenVPN</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุตุงุฏูุฉ ูู ู</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุดุบูู ูุงูุชุดุฎูุต</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุตุฏุงุฑ ูุฅูุบุงุก ุงูุดูุงุฏุฉ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู ุดุจูุฉ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ุจุนุฏ</font></font></a></li>
</ol><br>
<a name="setup"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุงู ุงูุชุดุบูู ูุชุซุจูุช ุจุฑูุงูุฌ ุงูุชุทุจูู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณุชุฎุฏู ุฃุฏูุงุช ุงูุชูุฒูุน CentOS 7.8.2003. </font><font style="vertical-align: inherit;">ูุญู ุจุญุงุฌุฉ ุฅูู ุชุซุจูุช ูุธุงู ุงูุชุดุบูู ูู ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชูููู. </font><font style="vertical-align: inherit;">ูู ุงูุณูู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kickstart</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุงุณุชูุณุงุฎ ุตูุฑุฉ ูุธุงู ุงูุชุดุบูู ุงููุซุจุชุฉ ูุณุจููุง ุ ููุณุงุฆู ุฃุฎุฑู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุงูุชุซุจูุช ุ ูุชุนููู ุนููุงู ููุงุฌูุฉ ุงูุดุจูุฉ (ููููุง ูุดุฑูุท ุงููููุฉ 172.16.19.123) ุ ูููู ุจุชุญุฏูุซ ูุธุงู ุงูุชุดุบูู:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum update -y &amp;&amp; reboot
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุถุฑูุฑู ุฃูุถูุง ุงูุชุฃูุฏ ูู ุฅุฌุฑุงุก ูุฒุงููุฉ ุงูููุช ุนูู ุฃุฌูุฒุชูุง. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุซุจูุช ุจุฑูุงูุฌ ุงูุชุทุจูู ุ ุชุญุชุงุฌ ุฅูู ุญุฒู openvpn ู openvpn-auth-ldap ู easy-rsa ู vim ููุญุฑุฑ ุฑุฆูุณู (ุณุชุญุชุงุฌ ุฅูู ูุณุชูุฏุน EPEL).</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install epel-release<font></font>
$ sudo yum install openvpn openvpn-auth-ldap easy-rsa vim<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงููุณุจุฉ ููุฌูุงุฒ ุงูุธุงูุฑู ุ ูู ุงููููุฏ ุชุซุจูุช ูููู ุถูู:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install open-vm-tools</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุถููู VMware ESXi ุฃู oVirt</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install ovirt-guest-agent</code></pre><br>
<a name="crypto"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุนุฏุงุฏ ุงูุชุดููุฑ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชูู ุฅูู ุฏููู easy-rsa:</font></font><br>
<br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุฅูุดุงุก ููู ูุชุบูุฑ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim vars</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุญุชูู ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="plaintext hljs">export KEY_COUNTRY="RU"<font></font>
export KEY_PROVINCE="MyRegion"<font></font>
export KEY_CITY="MyCity"<font></font>
export KEY_ORG="ABC LLC"<font></font>
export KEY_EMAIL="admin@abc.ru"<font></font>
export KEY_CN="allUsers"<font></font>
export KEY_OU="allUsers"<font></font>
export KEY_NAME="gw.abc.ru"<font></font>
export KEY_ALTNAMES="abc-openvpn-server"<font></font>
export EASYRSA_CERT_EXPIRE=3652<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนููุงุช ุงูุชูุธูู ุงูุดุฑุทู ูุดุฑูุฉ ABC LLC ููุตููุฉ ููุง. ููููู ุชุตุญูุญูุง ุจุดูู ุญูููู ุฃู ุชุฑููุง ููุซุงู. </font><font style="vertical-align: inherit;">ุฃูู ุดูุก ูู ุงููุนููุงุช ูู ุงูุณุทุฑ ุงูุฃุฎูุฑ ุ ุงูุฐู ูุญุฏุฏ ูุชุฑุฉ ุตูุงุญูุฉ ุงูุดูุงุฏุฉ ุจุงูุฃูุงู. </font><font style="vertical-align: inherit;">ูู ุงููุซุงู ุ ูุชู ุงุณุชุฎุฏุงู ูููุฉ 10 ุณููุงุช (365 * 10 + 2 ุณููุงุช ูุจูุณุฉ). </font><font style="vertical-align: inherit;">ูุฌุจ ุชุนุฏูู ูุฐู ุงููููุฉ ูุจู ุฅุตุฏุงุฑ ุดูุงุฏุงุช ุงููุณุชุฎุฏู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฐูู ุ ูู ุจุฅุนุฏุงุฏ ูุฑุฌุน ูุตุฏู ูุณุชูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุถูู ุงูุชูููู ุชุตุฏูุฑ ุงููุชุบูุฑุงุช ุ ูุชููุฆุฉ ุงููุฑุฌุน ุงููุตุฏู ุ ูุฅุตุฏุงุฑ ุงูููุชุงุญ ุงูุฌุฐุฑ ูุดูุงุฏุฉ ุงููุฑุฌุน ุงููุตุฏู ุ ูููุชุงุญ Diffie-Hellman ุ ูููุชุงุญ TLS ุ ุจุงูุฅุถุงูุฉ ุฅูู ููุชุงุญ ุงูุฎุงุฏู ูุงูุดูุงุฏุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุญูุงูุฉ ููุชุงุญ ุงููุฑุฌุน ุงููุตุฏู ุจุนูุงูุฉ ูุงูุญูุงุธ ุนูู ุณุฑูุชู! </font><font style="vertical-align: inherit;">ูููู ุชุฑู ุฌููุน ุงููุนููุงุช ุนูุฏ ุงูุทูุจุงุช ุจุดูู ุงูุชุฑุงุถู.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
. ./vars<font></font>
./easyrsa init-pki<font></font>
./easyrsa build-ca nopass<font></font>
./easyrsa gen-dh<font></font>
./easyrsa gen-req myvpngw nopass<font></font>
./easyrsa sign-req server myvpngw<font></font>
./easyrsa gen-crl<font></font>
openvpn --genkey --secret pki/ta.key<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ูุฐุง ุ ุชู ุงูุงูุชูุงุก ูู ุงูุฌุฒุก ุงูุฑุฆูุณู ูู ุฅุนุฏุงุฏ ุขููุฉ ุงูุชุดููุฑ.</font></font><br>
<a name="ovpn"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู OpenVPN</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชูู ุฅูู ุฏููู OpenVPN ุ ูุฃูุดุฆ ุฃุฏูุฉ ุงูุฎุฏูุฉ ูุฃุถู ุฑุงุจุทูุง ุฅูู easy-rsa:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /etc/openvpn/<font></font>
mkdir /var/<span class="hljs-built_in">log</span>/openvpn/ /etc/openvpn/ccd /usr/share/easy-rsa/3/client<font></font>
ln -s /usr/share/easy-rsa/3/pki/ /etc/openvpn/<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุฅูุดุงุก ููู ุชูููู OpenVPN ุงูุฑุฆูุณู:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim server.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุญุชูู ุงูุชุงูู</font></font><br>
<br>
<pre><code class="plaintext hljs">port 1194<font></font>
proto udp<font></font>
dev tun<font></font>
ca /etc/openvpn/pki/ca.crt<font></font>
cert /etc/openvpn/pki/issued/myvpngw.crt<font></font>
key /etc/openvpn/pki/private/myvpngw.key<font></font>
crl-verify /etc/openvpn/pki/crl.pem<font></font>
dh /etc/openvpn/pki/dh.pem<font></font>
server 172.16.20.0 255.255.254.0<font></font>
ifconfig-pool-persist ipp.txt<font></font>
push "route 172.16.0.0 255.255.255.0"<font></font>
push "route 172.17.0.0 255.255.255.0"<font></font>
client-config-dir ccd<font></font>
push "dhcp-option DNS 172.16.16.16"<font></font>
push "dhcp-option DNS 172.16.17.17"<font></font>
keepalive 10 120<font></font>
cipher AES-256-CBC<font></font>
user nobody<font></font>
group nobody<font></font>
persist-key<font></font>
persist-tun<font></font>
status /var/log/openvpn/openvpn-status.log<font></font>
log-append  /var/log/openvpn/openvpn.log<font></font>
verb 3<font></font>
explicit-exit-notify 1<font></font>
username-as-common-name<font></font>
plugin /usr/lib64/openvpn/plugin/lib/openvpn-auth-ldap.so /etc/openvpn/ldap.conf<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุถ ุงูููุงุญุธุงุช ุญูู ุงููุนููุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ุชูุช ุงูุฅุดุงุฑุฉ ุฅูู ุงุณู ูุฎุชูู ุนูุฏ ุฅุตุฏุงุฑ ุงูุดูุงุฏุฉ ุ ููู ุจุชุญุฏูุฏูุง ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุฏูุฏ ุชุฌูุน ุงูุนูุงููู ูููุงูู * ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุฃู ุชููู ุงููุณุงุฑุงุช ูุฎูุงุฏู DNS ูุงุญุฏุฉ ุฃู ุฃูุซุฑ ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุขุฎุฑ ุณุทุฑูู ูุทููุจุงู ูุชูููุฐ ุงููุตุงุฏูุฉ ูู AD **.</font></font></li>
</ul><br>
<i>*         127 , ..   /23,  OpenVPN        /30.<br>
        ,    ,        SELinux,    tcp   , ..   tcp-        .<br>
<br>
**   AD  ,  ,   โ ,    <b>  auth-user-pass</b>.</i><br>
<a name="auth"></a><br>
<h4>  AD</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฏุนู ุงูุนุงูู ุงูุซุงูู ุ ุณูุณุชุฎุฏู ุงูุชุญูู ูู ุงูุญุณุงุจ ูู ู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญู ุจุญุงุฌุฉ ุฅูู ุญุณุงุจ ูู ุงููุฌุงู ูุน ุญููู ูุณุชุฎุฏู ุนุงุฏู ููุฌููุนุฉ ุ ุณุชุญุฏุฏ ุนุถููุชูุง ุงููุฏุฑุฉ ุนูู ุงูุงุชุตุงู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅูุดุงุก ููู ุชูููู:</font></font><br>
<br>
<pre><code class="bash hljs">/etc/openvpn/ldap.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุญุชูู ุงูุชุงูู</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;LDAP&gt;<font></font>
        URL             "ldap://ldap.abc.ru"<font></font>
        BindDN          "CN=bindUsr,CN=Users,DC=abc,DC=ru"<font></font>
        Password        b1ndP@SS<font></font>
        Timeout         15<font></font>
        TLSEnable       no<font></font>
        FollowReferrals yes<font></font>
&lt;/LDAP&gt;<font></font>
&lt;Authorization&gt;<font></font>
        BaseDN          "OU=allUsr,DC=abc,DC=ru"<font></font>
        SearchFilter    "(sAMAccountName=%u)"<font></font>
        RequireGroup    true<font></font>
        &lt;Group&gt;<font></font>
                BaseDN          "OU=myGrp,DC=abc,DC=ru"<font></font>
                SearchFilter    "(cn=myVPNUsr)"<font></font>
                MemberAttribute "member"<font></font>
        &lt;/Group&gt;<font></font>
&lt;/Authorization&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุคุดุฑุงุช ุงูุฑุฆูุณูุฉ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL "ldap: //ldap.abc.ru" - ุนููุงู ูุญุฏุฉ ุชุญูู ุงููุฌุงู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BindDN โCN = bindUsrุ CN = Usersุ DC = abcุ DC = ruโ - ุงูุงุณู ุงูุฃุณุงุณู ููุฑุจุท ุจู LDAP (UZ - bindUsr ูู ุงูุญุงููุฉ abc.ru/Users) ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฉ ุงููุฑูุฑ b1ndP @ SS - ูููุฉ ูุฑูุฑ ุงููุณุชุฎุฏู ููุฑุจุท ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseDN "OU = allUsrุ DC = abcุ DC = ru" - ุงููุณุงุฑ ุงูุฐู ูุจุฏุฃ ููู ุจุญุซ ุงููุณุชุฎุฏู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseDN โOU = myGrpุ DC = abcุ DC = ruโ - ุญุงููุฉ ุงููุฌููุนุฉ ุงููุณููุญ ุจูุง (ุงููุฌููุนุฉ myVPNUsr ูู ุงูุญุงููุฉ abc.ru \ myGrp) ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchFilter "(cn = myVPNUsr)" ูู ุงุณู ุงููุฌููุนุฉ ุงูุชู ุชู ุญููุง.</font></font></li>
</ul><br>
<a name="run"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุดุบูู ูุงูุชุดุฎูุต</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูููููุง ูุญุงููุฉ ุชุดุบูู ูุจุฏุก ุงูุฎุงุฏู ุงูุฎุงุต ุจูุง:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl <span class="hljs-built_in">enable</span> openvpn@server.service<font></font>
$ sudo systemctl start openvpn@server.service<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฏููู ุงูุฅุทูุงู:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl status openvpn@server.service<font></font>
journalctl -xe<font></font>
cat /var/<span class="hljs-built_in">log</span>/messages<font></font>
cat /var/<span class="hljs-built_in">log</span>/openvpn/*<span class="hljs-built_in">log</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุตุฏุงุฑ ูุฅูุบุงุก ุงูุดูุงุฏุฉ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงู </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุงูุดูุงุฏุงุช ููุณูุง ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ููุงุชูุญ ูุฅุนุฏุงุฏุงุช ุฃุฎุฑู ุ ููู ุงูููุงุฆู ุฌุฏูุง ุฃู ุชููู ุจูู ูู ูุฐุง ูู ููู ุชุนุฑูู ูุงุญุฏ. </font><font style="vertical-align: inherit;">ุซู ูุชู ููู ูุฐุง ุงูููู ุฅูู ุงููุณุชุฎุฏู ููุชู ุงุณุชูุฑุงุฏ ููู ุงูุชุนุฑูู ุจุงููุนู ุนูู ุนููู OpenVPN. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูู ุจุฅูุดุงุก ูุงูุจ ุชูููู ูุจุฑูุงูุฌ ูุตู ูุดูู ููู ุงูุชุนุฑูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ููู ุงูุชุนุฑูู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ูุญุชููุงุช ูููุงุช ุงูุดูุงุฏุงุช ุงูุฌุฐุฑ (ca.crt) ูููุชุงุญ TLS (ta.key). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ุฅุตุฏุงุฑ ุดูุงุฏุงุช ุงููุณุชุฎุฏู ุ </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฃูุฏ ูู ุชุนููู ูุชุฑุฉ ุตูุงุญูุฉ ุงูุดูุงุฏุฉ ุงููุทููุจุฉ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ููู ุงููุนููุฉ. </font><font style="vertical-align: inherit;">ูุง ูุฌุจ ุฃู ุชุฌุนูู ูุจูุฑูุง ุฌุฏูุง ุ ุฃูุตู ุจุชุญุฏูุฏู ุจุญุฏ ุฃูุตู 180 ููููุง.</font></font><br>
<br>
<pre><code class="bash hljs">vim /usr/share/easy-rsa/3/vars</code></pre><br>
<pre><code class="plaintext hljs">...<font></font>
export EASYRSA_CERT_EXPIRE=180<font></font>
</code></pre><br>
<pre><code class="bash hljs">vim /usr/share/easy-rsa/3/client/template.ovpn</code></pre><br>
<pre><code class="plaintext hljs">client<font></font>
dev tun<font></font>
proto udp<font></font>
remote gw.abc.ru 1194<font></font>
resolv-retry infinite<font></font>
nobind<font></font>
persist-key<font></font>
persist-tun<font></font>
remote-cert-tls server<font></font>
cipher AES-256-CBC<font></font>
verb 3<font></font>
auth-user-pass<font></font>
<font></font>
&lt;ca&gt;<font></font>
-----BEGIN CERTIFICATE-----<font></font>
PUT YOUR CA CERT (ca.crt) HERE<font></font>
-----END CERTIFICATE-----<font></font>
&lt;/ca&gt;<font></font>
<font></font>
key-direction 1<font></font>
&lt;tls-auth&gt;<font></font>
-----BEGIN OpenVPN Static key V1-----<font></font>
PUT YOUR TA KEY (ta.key) HERE<font></font>
-----END OpenVPN Static key V1-----<font></font>
&lt;/tls-auth&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงุญุธุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุถุน ...</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุณูุงุณู </font><font style="vertical-align: inherit;">ุชุบูุฑุช ุฅูู ูุญุชููุงุช </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุดูุงุฏุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฌูุงุฒ ุงูุชุญูู ุนู ุจุนุฏ ุงูุชูุฌูู ุญุฏุฏ ุงุณู / ุนููุงู ุงูุจูุงุจุฉ ุงูุฎุงุตุฉ ุจู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุงุณุชุฎุฏุงู ุงูุชูุฌูู auth-user-pass ูููุตุงุฏูุฉ ุงูุฎุงุฑุฌูุฉ ุงูุฅุถุงููุฉ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุฏููู ุงูุฑุฆูุณู (ุฃู ุฃู ููุงู ููุงุณุจ ุขุฎุฑ) ูููู ุจุฅูุดุงุก ุจุฑูุงูุฌ ูุตู ูุทูุจ ุดูุงุฏุฉ ูุฅูุดุงุก ููู ุชุนุฑูู:</font></font><br>
<br>
<pre><code class="bash hljs">vim ~/make.profile.sh</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ] ; <span class="hljs-keyword">then</span>
 <span class="hljs-built_in">echo</span> Missing mandatory client name. Usage: <span class="hljs-variable">$0</span> vpn-username
 <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">#Set variables</span><font></font>
basepath=/usr/share/easy-rsa/3<font></font>
clntpath=<span class="hljs-variable">$basepath</span>/client<font></font>
privpath=<span class="hljs-variable">$basepath</span>/pki/private<font></font>
certpath=<span class="hljs-variable">$basepath</span>/pki/issued<font></font>
profile=<span class="hljs-variable">$clntpath</span>/<span class="hljs-variable">$1</span>.ovpn<font></font>
<font></font>
<span class="hljs-comment">#Get current year and lowercase client name</span><font></font>
year=`date +%F`<font></font>
client=<span class="hljs-variable">${1,,}</span>
<span class="hljs-built_in">echo</span> Processing <span class="hljs-variable">$year</span> year cert <span class="hljs-keyword">for</span> user/device <span class="hljs-variable">$client</span><font></font>
<font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$basepath</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [  -f client/<span class="hljs-variable">$client</span>* ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"*** ERROR! ***"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Certificate <span class="hljs-variable">$client</span> already issued!"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"*** ERROR! ***"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span><font></font>
<font></font>
. ./vars<font></font>
./easyrsa --batch --req-cn=<span class="hljs-variable">$client</span> gen-req <span class="hljs-variable">$client</span> nopass<font></font>
./easyrsa --batch sign-req client <span class="hljs-variable">$client</span><font></font>
<font></font>
<span class="hljs-comment">#Make profile</span>
cp <span class="hljs-variable">$clntpath</span>/template.ovpn <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;key&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
cat <span class="hljs-variable">$privpath</span>/<span class="hljs-variable">$1</span>.key &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/key&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$certpath</span>/<span class="hljs-variable">$1</span>.crt -out <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt<font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;cert&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
cat <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/cert&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n"</span> &gt;&gt; <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-comment">#remove tmp file</span>
rm -f <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt<font></font>
<font></font>
<span class="hljs-built_in">echo</span> Complete. See <span class="hljs-variable">$profile</span> file.<font></font>
<font></font>
<span class="hljs-built_in">cd</span> ~
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุนู ุงูููู ูุงุจูุงู ููุชูููุฐ:</font></font><br>
<br>
<pre><code class="bash hljs">chmod a+x ~/make.profile.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููููู ุฅุตุฏุงุฑ ุดูุงุฏุชูุง ุงูุฃููู.</font></font><br>
<br>
<pre><code class="bash hljs">~/make.profile.sh my-first-user</code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุฏูุฏ ุงููุนู</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ุชู ุงุฎุชุฑุงู ุงูุดูุงุฏุฉ (ุงูุฎุณุงุฑุฉ ุ ุงูุณุฑูุฉ) ุ ูุฌุจ ุฅุจุทุงู ูุฐู ุงูุดูุงุฏุฉ:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
./easyrsa revoke my-first-user<font></font>
./easyrsa gen-crl<font></font>
</code></pre><br>
<a name="cert"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฑุถ ุงูุดูุงุฏุงุช ุงูุตุงุฏุฑุฉ ูุงููุจุทูุฉ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุนุฑุถ ุงูุดูุงุฏุงุช ุงูุตุงุฏุฑุฉ ูุงููุจุทูุฉ ุ ูุง ุนููู ุณูู ุนุฑุถ ููู ุงูููุฑุณ:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
cat pki/index.txt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชูุณูุฑุงุช:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณุทุฑ ุงูุฃูู ูู ุดูุงุฏุฉ ุงูุฎุงุฏู ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุฑู ุงูุฃูู</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V (ุตุงูุญ) - ุตุงูุญ ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R (ูุจุทูุฉ) - ูุณุชุฏุนู.</font></font></li>
</ul></li>
</ul><br>
<a name="net"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููู ุดุจูุฉ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฎุทูุงุช ุงูุฃุฎูุฑุฉ ูู ุฅูุดุงุก ุดุจูุฉ ููู - ุงูุชูุฌูู ูุงูุฌุฏุฑุงู ุงููุงุฑูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐู ููุงุชุตุงูุงุช ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงููุญูู:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --add-service=openvpn<font></font>
$ sudo firewall-cmd --add-service=openvpn --permanent<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฐูู ุ ูู ุจุชูููู ุชูุฌูู ุญุฑูุฉ ูุฑูุฑ IP:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo sysctl net.ipv4.ip_forward=1<font></font>
$ sudo <span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.ip_forward=1"</span> &gt; /etc/sysctl.d/50-sysctl.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจูุฆุฉ ุงูุดุฑูุงุช ุ ุฑุจูุง ูููู ููุงู ุชูุณูู ุฅูู ุงูุดุจูุงุช ุงููุฑุนูุฉ ููุญุชุงุฌ ุฅูู ุฅุฎุจุงุฑ ุฌูุงุฒ ุงูุชูุฌูู (ุงูููุฌูุงุช) ุจููููุฉ ุฅุฑุณุงู ุงูุญุฒู ุงูููุฌูุฉ ุฅูู ุนููุงุก VPN ูุฏููุง. ูู ุณุทุฑ ุงูุฃูุงูุฑ ุ ูู ุจุชูููุฐ ุงูุฃูุฑ ุจุงูุทุฑููุฉ (ูุนุชูุฏ ุนูู ุงููุนุฏุงุช ุงููุณุชุฎุฏูุฉ):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># ip route 172.16.20.0 255.255.254.0 172.16.19.123</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุญูุธ ุงูุชูููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุนูู ูุงุฌูุฉ ุฌูุงุฒ ุงูุชูุฌูู ุงูุญุฏูุฏู ุ ุญูุซ ูุชู ุชูุฏูู ุงูุนููุงู ุงูุฎุงุฑุฌู gw.abc.ru ุ ูู ุงูุถุฑูุฑู ุงูุณูุงุญ ุจูุฑูุฑ ุญุฒู udp / 1194. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงูุช ูุคุณุณุชู ูุฏููุง ููุงุนุฏ ุฃูุงู ุตุงุฑูุฉ ุ ูุฌุจ ุนููู ุฃูุถูุง ุชูููู ุฌุฏุงุฑ ุญูุงูุฉ ุนูู ุฎุงุฏู VPN ุงูุฎุงุต ุจูุง. </font><font style="vertical-align: inherit;">ูู ุฑุฃูู ุ ูุฅู ุฅุนุฏุงุฏ ุณูุงุณู iptables FORWARD ูููุญ ุฃูุจุฑ ูุฏุฑ ูู ุงููุฑููุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ุฅุนุฏุงุฏูุง ุฃูู ููุงุกูุฉ. </font><font style="vertical-align: inherit;">ุฃูุซุฑ ููููุงู ุญูู ุฅุนุฏุงุฏูุง. </font><font style="vertical-align: inherit;">ููุฐุง ุ ูู ุงูุฃูุณุจ ุงุณุชุฎุฏุงู "ุงูููุงุนุฏ ุงููุจุงุดุฑุฉ" - ุงูููุงุนุฏ ุงููุจุงุดุฑุฉ ุงููุฎุฒูุฉ ูู ููู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/firewalld/direct.xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูููู ุงูุนุซูุฑ ุนูู ุชูููู ุงููุงุนุฏุฉ ุงูุญุงููุฉ ุนูู ุงููุญู ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --direct --get-all-rule</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจู ุชุบููุฑ ุงูููู ุ ูู ุจุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ููู:</font></font><br>
<br>
<pre><code class="bash hljs">cp /etc/firewalld/direct.xml /etc/firewalld/direct.xml.`date +%F.%T`.bak</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุญุชููุงุช ุงูุชูุฑูุจูุฉ ููููู ูู ููุง ููู:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">direct</span>&gt;</span>
 <span class="hljs-comment">&lt;!--Common Remote Services--&gt;</span>
  <span class="hljs-comment">&lt;!--DNS--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o ens192 -p udp --dport 53 -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--web--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p tcp -d 172.16.19.200 --dport 80 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p tcp -d 172.16.19.201 --dport 443 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--Some Other Systems--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p udp -d 172.16.19.100 --dport 7000 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--just logging--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -j LOG --log-prefix 'forward_fw '<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">direct</span>&gt;</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุณูุฑุงุช</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุฃุณุงุณู ุ ูุฐู ูู ููุงุนุฏ iptables ุงููุนุชุงุฏุฉ ุ ูุฅูุง ูุชู ุชุนุจุฆุชูุง ุจุนุฏ ุธููุฑ ุฌุฏุงุฑ ุงูุญูุงูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฌูุฉ ุงููุฌูุฉ ูู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ูู tun0 ุ ููุฏ ุชุฎุชูู ุงููุงุฌูุฉ ุงูุฎุงุฑุฌูุฉ ููููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ens192 ุ ุงุนุชูุงุฏูุง ุนูู ุงููุธุงู ุงูุฃุณุงุณู ุงููุณุชุฎุฏู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุณุทุฑ ุงูุฃุฎูุฑ ูู ูุชุณุฌูู ุงูุญุฒู ุงููุณูุทุฉ. </font><font style="vertical-align: inherit;">ููุชุณุฌูู ููุนูู ุ ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ูุณุชูู ุงูุชุตุญูุญ ูู ุชูููู ุฌุฏุงุฑ ุงูุญูุงูุฉ:</font></font><br>
<br>
<pre><code class="bash hljs">vim /etc/sysconfig/firewalld<font></font>
FIREWALLD_ARGS=--debug=2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุทุจูู ุงูุฅุนุฏุงุฏุงุช - ุงูุฃูุฑ ุงููุนุชุงุฏ ูุฌุฏุงุฑ ุงูุญูุงูุฉ ูุฅุนุงุฏุฉ ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุนุฑุถ ุงูุญุฒู ุงูููููุฉ ููุง ููู:</font></font><br>
<br>
<pre><code class="bash hljs">grep forward_fw /var/<span class="hljs-built_in">log</span>/messages</code></pre><br>
<a name="next"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ุจุนุฏ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชู ุงูุฅุนุฏุงุฏ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจูู ุนูู ุฌุงูุจ ุงูุนููู ูุชุซุจูุช ุจุฑูุงูุฌ ุงูุนููู ูุงุณุชูุฑุงุฏ ููู ุงูุชุนุฑูู ูุงูุงุชุตุงู. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุธุงู ุงูุชุดุบูู ูุซู Windows ุ ูุชููุฑ ุงูุชูุฒูุน ุนูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุน ุงููุทูุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุงูุฎุชุงู ุ ูุฑุจุท ุฎุงุฏููุง ุงูุฌุฏูุฏ ุจุฃูุธูุฉ ุงููุฑุงูุจุฉ ูุงูุฃุฑุดูุฉ ุ ููุง ููุณู ุชุซุจูุช ุงูุชุญุฏูุซุงุช ุจุงูุชุธุงู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุชุตุงู ูุณุชูุฑ!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar501034/index.html">ูุฏูุงุช IBM ุงูุฃุณุจูุนูุฉ - ูุงูู 2020</a></li>
<li><a href="../ar501040/index.html">ุงูุฃุฎุทุงุก ุงููููุฐุฌูุฉ ูู ุงูุชุทุจููุงุช ุงูุชู ุชุคุฏู ุฅูู ุงูุงูุชูุงุฎ ูู postgresql. ุฃูุฏุฑู ุณุงูููููู</a></li>
<li><a href="../ar501042/index.html">Likbez ุนูู ุงูุงูุชุซุงู: ูุญู ูููู ูุชุทูุจุงุช ุงูููุธููู ูู ูุฌุงู ุฃูู ุงููุนูููุงุช</a></li>
<li><a href="../ar501044/index.html">ะะต ะดะตัะถะธัะต ะปัะดะตะน ะทะฐ ะธะดะธะพัะพะฒ ะธะปะธ ะฟะพัะตะผั ัะตะปะพะฒะตะบ ั ะธะฝะถะตะฝะตัะฝัะผ ะพะฑัะฐะทะพะฒะฐะฝะธะตะผ ะผะพะถะตั ัะถะตัั ะฒััะบั ัะพัะพะฒะพะน ัะฒัะทะธ (ะฒะธะดะตะพ)</a></li>
<li><a href="../ar501046/index.html">ุญูู ุงููุฒุงูุง ุงูุตูุจุฉ: ุฃูุถู 10 ุชูุงุฑูุฑ ูููุคุชูุฑ C ++ Russia 2019 Piter</a></li>
<li><a href="../ar501050/index.html">ูู ุจุชุซุจูุช ูุชูุนูู LabVIEW Community Edition</a></li>
<li><a href="../ar501052/index.html">ุนูุฏุฉ ุณูููุฉ ุงููุถุงุก ุงูุตูููุฉ</a></li>
<li><a href="../ar501056/index.html">ููุงุฐุง ููุชู ูููููุฉ ุงุณุชุฎุฏุงู ุฎุงุตูุฉ ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ ูุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ ูู ุจุงูุซูู</a></li>
<li><a href="../ar501058/index.html">ูุณุงุนุฏ ุญู Teamcenter Rapid Start ุนูู ุงูุดุฑูุงุช ุงููุตูุนุฉ ูููุนุฏุงุช ุงูุตูุงุนูุฉ ูู ุชูููู ููุช ุงูุชุตููู ุจูุณุจุฉ 25ูช</a></li>
<li><a href="../ar501060/index.html">JetBrains .NET ุฃูุงู ุนูู ุงูุฅูุชุฑูุช ุ 13-14 ูุงูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>