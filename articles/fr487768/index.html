<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸🏼 👶🏼 👩🏿‍💻 Ouverture des ports 4321 et 9898 sur Xiaomi Gateway 2 🧑🏼‍🤝‍🧑🏼 😆 🛍️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 En me reposant pour les vacances du Nouvel An, je me suis enthousiasmé à l'idée de créer une «maison intelligente». Parmi les écosystème...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Ouverture des ports 4321 et 9898 sur Xiaomi Gateway 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487768/"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En me reposant pour les vacances du Nouvel An, je me suis enthousiasmé à l'idée de créer une «maison intelligente». Parmi les écosystèmes "populaires", le plus populaire en raison du bon marché et de l'abondance de toutes sortes d'appareils connectés m'a semblé une solution de Xiaomi. Abandonnant immédiatement la gestion de ma maison via des serveurs chinois (retards possibles, sécurité et liaison aux appareils du même fabricant), j'ai commencé à étudier toutes sortes de systèmes de contrôle domotique et à sélectionner des équipements compatibles pour eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après des heures de recherche, j'ai décidé que l'assistant à domicile me convenait. J'ai décidé de tout construire au stade initial en utilisant le Raspberry Pi 4 Model B (2 Go) et les capteurs de Xiaomi. Après avoir acheté une passerelle (vous avez besoin d'une version avec le </font><b><font style="vertical-align: inherit;">numéro d'</font></b><font style="vertical-align: inherit;"> article </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DGNWG02LM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) et en activant le protocole de communication LAN, j'étais confronté au fait que les ports 4321 et 9898, nécessaires à l'intégration dans le Home Assistant, restaient toujours fermés.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez le </font><b><font style="vertical-align: inherit;">vérifier</font></b><font style="vertical-align: inherit;"> via </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à l'aide de la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap -sU -Pn &lt;Gateway IP&gt; -p 9898,4321,54321</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/rh/hl/tarhhleh9pcv7fmpaebftwvciuq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dans cet article, je décrirai comment ouvrir ces ports et ce qu'il faudra.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entraînement</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne suis pas sûr que vous puissiez publier des liens vers des magasins spécifiques, donc je vais seulement indiquer les prix auxquels j'ai acheté tout ce dont j'avais besoin à Moscou. </font><font style="vertical-align: inherit;">Nous aurons besoin:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tête de tournevis U6 (alias SP6) - 36 roubles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convertisseur USB-TTL basé sur CH340 - 84 roubles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Câble de connexion maman-papa - vous avez besoin d'au moins 3 pièces, mais j'ai pris un ensemble de 40 pièces pour 110 roubles</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fer à souder - j'avais :)</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se rendre à la partie amusante</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous effectuez toutes les autres actions à vos propres risques. L'ouverture de la passerelle annulera votre garantie.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La première étape consiste à retirer les trois patins en caoutchouc qui recouvrent les vis. Les coussinets ne sont pas collés, il suffit de les soulever avec quelque chose de fin: j'ai utilisé un couteau. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/bi/qs/zfbiqsiq4yzt6xqk4rjwgerodcm.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sous l'un des coussinets, il y aura un sceau de garantie. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est le point de non-retour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En dévissant les vis, </font><font style="vertical-align: inherit;">ouvrez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doucement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la passerelle. Dans sa partie supérieure, il y a un haut-parleur connecté par des fils à la carte sur la partie inférieure. Nous déconnectons les fils pour que rien n'interfère. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/zu/6d/odzu6db1a8_ky6wic1lrtnfxunw.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez souder trois câbles à la carte passerelle. Avec deux points, tout est clair, le troisième est sur le côté du bouton. Les endroits sont indiqués sur l'image: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h5/-x/1v/h5-x1vvavmnokro2iojyysyn76q.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous obtenons quelque chose comme ceci:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_a/g0/he/_ag0hesnmhhb2e7zk9hs1g4d-tg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'étape suivante consiste à configurer la connexion pour le convertisseur. </font><font style="vertical-align: inherit;">Nous retirons les cavaliers du convertisseur (quand je l'ai acheté, il se tenait sur VCC et 3V3), nous le connectons au port </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB 2.0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur Windows 10, les pilotes se sont chargés, une connexion sur le port </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COM3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est apparue dans le gestionnaire de périphériques </font><font style="vertical-align: inherit;">(rappelez-vous, cela vous sera utile plus tard). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ar/iw/ew/ariwewaznpdg4oothlkls-mogl8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les propriétés de notre appareil, allez dans l'onglet "Paramètres du port" et modifiez les valeurs:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bit par seconde" à </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">115200</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Contrôle de flux" à </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juste au cas où, vous pouvez vérifier la capture d'écran: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/df/g0/dr/dfg0drfos-u5pbh2t2nj_rpihx4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec la configuration du convertisseur, nous avons terminé, nous le retirons du port USB. Nous procédons à la connexion de la passerelle: nous connectons son </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au </font><font style="vertical-align: inherit;">convertisseur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne connectons pas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encore la passerelle </font><b><font style="vertical-align: inherit;">RX</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Branchez la passerelle sur une prise de courant. Si tout est fait correctement, il commencera à clignoter en bleu. Nous attendons le téléchargement complet (le clignotement s'arrêtera) et connectons le convertisseur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au même port USB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qu'à l'étape de configuration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exécutez PuTTY en tant qu'administrateur. Dans la section "Session", changez le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Type de connexion"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Série</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans les champs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ligne série"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Speed"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">port</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dont nous nous sommes souvenus plus tôt (dans mon cas - COM3), et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">115200</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/sc/lb/d_sclb65priuudogh09janyh8dg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la section "Serial", vérifiez que notre port COM est spécifié, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Speed ​​(baud)"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">115200</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Flow control"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aucun</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/c3/hh/vhc3hh2c3gdi4lzmmereg-hdtqo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous revenons à la section "Session" et nous nous connectons à la passerelle. Si tout a été fait correctement, un texte lisible apparaîtra dans la console. Cela ressemblait à ceci pour moi: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tw/aa/nj/twaanjonw54dshlwypcamd71lro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez connecter la </font><font style="vertical-align: inherit;">passerelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au </font><font style="vertical-align: inherit;">convertisseur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il ne devrait y avoir aucune erreur dans la console. Le texte lisible a continué à apparaître, cette fois au format JSON. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entrez la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psm-set network.open_pf 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et appuyez sur Entrée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans certaines vidéos et articles que j'ai suivis, il est écrit qu'une réponse devrait apparaître dans la console. </font><font style="vertical-align: inherit;">Après avoir entré la commande, j'ai attendu environ une minute, mais il n'y a pas eu de réponse. </font><font style="vertical-align: inherit;">Dans la console, seulement de nouvelles entrées flashées occasionnellement. </font><font style="vertical-align: inherit;">Par conséquent, juste au cas où, j'ai essayé trois autres options pour la commande:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psm-get network open_pf 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (espace au lieu de </font><b><font style="vertical-align: inherit;">point</font></b><font style="vertical-align: inherit;"> )</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># psm-get network.open_pf 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (après toute entrée dans la console, appuyez sur Entrée pour que # apparaisse et écrivez la commande)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># psm-get network open_pf 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (analogue au précédent, mais avec un espace)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après quatre tentatives de réponse, je n'ai pas attendu et j'ai décidé de vérifier si les ports étaient ouverts. </font><font style="vertical-align: inherit;">Pour ce faire, éteignez le convertisseur et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redémarrez la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passerelle en la retirant de la prise. </font><font style="vertical-align: inherit;">Sans connecter le convertisseur à l'ordinateur, allumez la passerelle et attendez le téléchargement. </font><font style="vertical-align: inherit;">Après cela, utilisez la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap -sU -Pn &lt;Gateway IP&gt; -p 9898,4321,54321 pour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vérifier les ports. </font><font style="vertical-align: inherit;">Dans mon cas, ils étaient ouverts!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/lx/pf/9ylxpfv2a9zr_pbupu5s-hodjvs.png" alt="image"></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487750/index.html">Quelques subtilités des collections d'injection au printemps</a></li>
<li><a href="../fr487752/index.html">Optimiser le stockage: un cas d'unification et de moindre coût de possession</a></li>
<li><a href="../fr487754/index.html">Organisation de l'intranet (automatisation de la production informatique). Partie 1 - Utilisateurs et courrier</a></li>
<li><a href="../fr487756/index.html">RIT, Maxim Lapshin (Erlyvideo): comment un programmeur pour faire croître une entreprise</a></li>
<li><a href="../fr487764/index.html">J'ai 14 ans et je combine l'école avec le travail en informatique</a></li>
<li><a href="../fr487772/index.html">Rencontrez la langue tchouvache dans Yandex.Translate: comment nous résolvons le principal problème de la traduction automatique</a></li>
<li><a href="../fr487774/index.html">Erreurs de date et d'heure SQL Server</a></li>
<li><a href="../fr487776/index.html">Journée de formation Microsoft Azure: migration de l'infrastructure du serveur (inscription terminée)</a></li>
<li><a href="../fr487780/index.html">Vulnerability Management - plus: gestion ou vulnérabilités?</a></li>
<li><a href="../fr487782/index.html">Comment je me suis débarrassé de mille onglets ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>