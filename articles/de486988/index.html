<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕧 👨‍💻 👨‍❤️‍💋‍👨 Taschenwetterstation 👨🏿‍🤝‍👨🏻 🌞 🤶🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ja, bei der Wetterstation geht es um etwas, das eine Vielzahl von Parametern von der Richtung und Stärke des Windes bis zur Sonneneinstrahlung misst, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Taschenwetterstation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486988/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ja, bei der Wetterstation geht es um etwas, das eine Vielzahl von Parametern von der Richtung und Stärke des Windes bis zur Sonneneinstrahlung misst, aber es gab keinen passenderen Begriff, sodass Sie irreführen müssen. </font><font style="vertical-align: inherit;">Aber über die Größe ist alles fair.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/vf/yl/sbvfylae2jg5ca22n6incvh0_le.jpeg"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät hat vielleicht nicht viel kommerziellen Wert, weil </font><font style="vertical-align: inherit;">Selbst in Bezug auf die Anzahl der Komponenten ist es vielen Chinesen unterlegen und nicht nur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Waren</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit ähnlicher Funktionalität. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DIY ist auch schwer zu benennen, da beispielsweise Leiterplatten mit anschließendem Löten kleiner / bleifreier Komponenten bestellt werden müssen, wodurch sich die Anzahl der Personen, die das Gerät wiederholen möchten, erheblich verringert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Wetterstation selbst wurde als etwas geschaffen, ich möchte denken, ästhetisch, kompakt und in der Lage, die Temperatur + Luftfeuchtigkeit schnell zu beurteilen, und sobald der ausgewählte Sensor auch über den Druck berichten kann, dann auch dies. </font><font style="vertical-align: inherit;">Alles sieht ungefähr so ​​aus (anklickbar):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/6q/1n/xy6q1n0mungrju5uff3k_qznrhw.jpeg"></div></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/pa/ur/8t/paur8tgioddbzxqzwbkywgcr9pg.jpeg"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vergleich:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/on/6z/bi/on6zbi8c1riuymare1htfaoy3gy.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Über Eisen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Sensor wurde der BOSCH-BME280 gewählt, der die gewünschten Umgebungsparameter, zumindest nach I2C, mindestens nach SPI, acht Beine in einem bleifreien LGA-Gehäuse von 2,5 x 2,5 mm liefert - relativ preiswert, winzig. Zunächst wurde ein ausgefeilterer Sensor aus derselben BME680-Serie geplant, der neben Daten, Luftfeuchtigkeit und Luftdruck laut Datenblatt auch die Luftqualität anhand des sogenannten Index for Air Quality (IAQ) bewerten kann. Es scheint nicht schlecht zu sein, aber tatsächlich stellte sich heraus, dass IAQ nur mit BSEC: Bosch Software Environmental Cluster erhalten werden kann, das basierend auf den Sensorwerten und dem Ändern dieser Werte den IAQ berechnet. Es scheint, dass Sie das Zeugnis selbst nehmen und alles berechnen können; Nicht sicher so. Auf Anfrage zur Messung der Luftqualität gibt der Sensor einen Widerstand in Ohm an.Es erwärmt das Innere eines kleinen empfindlichen Bereichs, der mit Leitfähigkeit auf das Vorhandensein flüchtiger organischer Substanzen - flüchtiger organischer Verbindungen (VOC) - reagiert und das Ergebnis liefert, d.h. Widerstand gegen diesen Bereich. Im Prinzip,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige Handwerker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bieten ihre eigenen Algorithmen zur Interpretation dieser Messwerte ohne BSEC an, aber unter anderem ließen die Mehrfachkosten im Vergleich zum BME280 keine Wahl.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/6f/ua/xm6fuaet6jexqzojp2ijibwk8yg.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Display besteht aus zwei TOS-F2101, dies sind gewöhnliche Sieben-Segment-Indikatoren von grüner Farbe mit einer gemeinsamen Kathode. </font><font style="vertical-align: inherit;">Bemerkenswert ist, dass dies die Größe und das Gehäuse für die Oberflächenmontage sind, sodass Sie sie auf unkonventionelle Weise platzieren können. </font><font style="vertical-align: inherit;">Dies sind übrigens die kleinsten planaren Indikatoren, die zum Verkauf angeboten wurden, und sie bestimmen größtenteils die Größe des gesamten Geräts.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/s2/ur/mvs2urkyspmxu99dx60ynxqs0ju.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwaltet alle STM32F072 in einem 48-poligen QFPN-Gehäuse. </font><font style="vertical-align: inherit;">Ausgewählt wiederum basierend auf der Größe, Verfügbarkeit von Peripheriegeräten und der erforderlichen Anzahl von Schlussfolgerungen für die Steuerung von Indikatoren, die in der dualen Version aus irgendeinem Grund nicht auftreten und die Schlussfolgerungen anständig sein müssen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/1q/ph/dd1qph6m-u11ozvyb8nudzl1mf0.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Rest sind Widerstände, Kondensatoren, ein 3,3-V-Spannungswandler, je weniger - desto besser, natürlich innerhalb angemessener Grenzen und TTX-Komponenten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der USB-Anschluss befindet sich auf der Platine. Für einen zuverlässigen Kontakt sollte die Dicke der Leiterplatte ungefähr 2 mm betragen. Wenn Sie sich von der Zeichnung auf USB Typ A leiten lassen, gibt es etwas mehr, aber wenn Sie die Maske auf beiden Seiten berücksichtigen, stellt sich heraus, dass dies ziemlich erträglich ist. Natürlich bietet dieses Anschlussformat mehr Chancen für mechanische Schäden an der USB-Steckdose, aber im Großen und Ganzen kann dies mit einem normalen Flash-Laufwerk behoben werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Touch-Taste ist ein rundes Polygon unter dem Bild auf der Tafel. Die Taste reagiert auf eine kurze und lange Berührung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich zur Anzeige verfügt die Karte über drei LEDs, die anzeigen, welche der Messwerte derzeit auf der Anzeige angezeigt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie für die Software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Programm wird mit CMSIS geschrieben, die Betriebsfrequenz beträgt 48 MHz und stammt von einer internen Quelle. Hier gibt es eine, Sie können sogar USB damit verwenden, ohne externen Quarz zu verwenden. Für Flexibilität und möglicherweise Erweiterung der Funktionalität wird FreeRTOS hinzugefügt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Touch-Taste wird vom Touch Sensing Controller (TSC) bedient. Da es weder eine Tastatur über die Touch-Tasten auf der Platine noch Schieberegler gibt, wenn die Touchpads in einer Linie kombiniert sind, und es einen Sensor gibt, der kurze und lange Berührungen erfasst, macht es keinen Sinn, die umfassende Bibliothek von ST zu verwenden. Das Prinzip der Sensorbedienung ist einfach: Es sind mehrere Stifte zu Gruppen zusammengefasst. Ein Kondensator (Abtastkondensator) Cs ist mit einem von ihnen verbunden. Dieser Stift wird beispielhaft. Die verbleibenden Stifte der Gruppe können mit den Sensorpolygonen verbunden werden, die tatsächlich auch Cx-Kondensatoren sind . Die Steuerung lädt die Kapazität des Deponiekondensators Cx auf und diese Ladung destilliert dann in das Modell Cs. Der Vorgang wird bis zu einer bestimmten Spannungsgrenze an Cs wiederholt. Die Sensorkapazität ist normalerweise gering.Daher sind viele solcher Operationen erforderlich, und es gibt ein separates Register (TSC_IOGxCR) zum Zählen. Wenn Sie den Sensor berühren, wird die Kapazität Cx ​​größer und die Zyklen zum Laden von Cs werden weniger benötigt. Dies wird sofort behoben und eine Berührung wird nach oben gemeldet. Übrigens steigt die Sensorkapazität an, wenn keine direkte Berührung erfolgt, sodass der Sensor vor physischem Kontakt geschützt werden kann, z. B. mit einer Maske, oder Sie können verschiedene Annäherungsgrade aufzeichnen.oder verschiedene Annäherungsgrade festlegen.oder verschiedene Annäherungsgrade festlegen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Kommunikation mit dem BME280 wird die I2C-Schnittstelle verwendet. </font><font style="vertical-align: inherit;">Die Implementierung von I2C in STM32F072 ist einfacher als im beliebten STM32F103. Unter anderem müssen Sie 1/2 / viele empfangene Bytes nicht separat verfolgen. Es reicht aus, deren Anzahl im Voraus anzugeben (I2C_CR2.NBYTES [7: 0]). </font><font style="vertical-align: inherit;">Dieselbe Bibliothek für die Arbeit mit dem Sensor wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereitgestellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und vom Hersteller des Sensors empfohlen. </font><font style="vertical-align: inherit;">Um die Messwerte mithilfe der Bibliothek lesen zu können, müssen Sie zwei Strukturen erstellen - für Einstellungen und Daten. </font><font style="vertical-align: inherit;">In den Einstellungen, die Sie vornehmen müssen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensoradresse am I2C-Bus</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I2C Lese- / Schreibfunktionen sowie Verzögerungsfunktion</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Anzahl der Ablesungen von Anzeigen zur Mittelung (Überabtastung) x1, x2 usw. für jeden der Parameter Temperatur / Feuchtigkeit / Druck</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Filterkoeffizient für ADC</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeitraum der Entfernung von Parameterwerten</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen können Sie für einen der Parameter, die gelesen werden können, eine Temperatur belassen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betriebsart "normal" - mit regelmäßigen Ablesungen, "erzwungen" - Ablesungen auf Anfrage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der „normale“ Modus ausgewählt ist, können die tatsächlichen Werte der Messwerte im Prinzip durch Ausführen der Funktion „bme280_get_sensor_data“ ermittelt werden. Dabei werden die entsprechenden Sensorregister überprüft, die direkten Messwerte gelesen und anschließend gemäß den im Mikrokreis im Werk aufgezeichneten Korrekturfaktoren verarbeitet. </font><font style="vertical-align: inherit;">Infolgedessen enthält die Ausgangsdatenstruktur die Temperatur in Grad Celsius, die relative Luftfeuchtigkeit in Prozent und den atmosphärischen Druck in Pascal. </font><font style="vertical-align: inherit;">Im "erzwungenen" Modus müssen Sie nur jedes Mal vor dem Lesen der Messwerte die Konvertierung "bme280_set_sensor_mode" ausführen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das allgemeine Prinzip des Geräts lautet wie folgt: Schließen Sie es in einer mobilen Version an USB oder an Power Bank an. Für die anfängliche Anzeige und Umschaltung von Messwerten - eine kurze Berührung des Sensors, um sie zu deaktivieren - eine lange Berührung. Zuerst wird die Temperatur in Grad Celsius angezeigt, dann die relative Luftfeuchtigkeit in Prozent und der Luftdruck in Millimetern Quecksilber, weil Es gibt nur zwei Indikatoren, und der Druckindikator geht selten über siebenhundert hinaus, dann ist die Nummer sieben hier virtuell. Wenn Sie den Sensor längere Zeit nicht berühren, werden die Anzeigen ausgeschaltet, sodass Sie beispielsweise die Power Bank nicht entladen. Der durchschnittliche Verbrauch des Geräts beträgt ~ 50 mA, und die Hauptverbraucher sind nur Indikatoren. Wenn Sie sie ausschalten, wird die Zählung an Mikroampere gesendet.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/os/yc/m4/osycm4d_nxftmdscyosimsmxyqu.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9g/of/6q/9gof6qylzgjq2zeba4rkgumqvze.jpeg"></div><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/n91MdTEM7X4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen beliefen sich die Gesamtkosten der Komponenten im Januar 2020 auf etwa 850 Rubel. Dies ist ohne Berücksichtigung der Platine einfach, weil </font><font style="vertical-align: inherit;">Der Hersteller hatte Neujahrsrabatte, und ich habe Gutscheine, aber es ist unwahrscheinlich, dass dies in naher Zukunft erneut geschieht, zumindest bis zum nächsten Dezember. </font><font style="vertical-align: inherit;">Nun, wer sich mit der Quelle vertraut machen will, kann es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tun </font><font style="vertical-align: inherit;">.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486988/">https://habr.com/ru/post/de486988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486976/index.html">Probleme der russischen Informationserziehung und ihre möglichen Lösungen</a></li>
<li><a href="../de486978/index.html">Feldnotizen: Eine der größten OpenSource-Konferenzen FOSDEM 2020</a></li>
<li><a href="../de486980/index.html">Kim Dotcom: Gefangen, die meistgesuchte Person online. Teil 1</a></li>
<li><a href="../de486982/index.html">So lernen Sie die Front-End-Entwicklung, finden Ihren ersten Job und bekommen keine Unebenheiten</a></li>
<li><a href="../de486984/index.html">Python Gateway bei InterSystems IRIS</a></li>
<li><a href="../de486994/index.html">Winkel: Integrationstests (flache Tests)</a></li>
<li><a href="../de486998/index.html">Günstiger und schneller Druck des Thermodruckers</a></li>
<li><a href="../de487000/index.html">Citrus: Style Set für AvaloniaUI</a></li>
<li><a href="../de487002/index.html">Augmented Reality Marketing: Was es ist und wie es funktioniert</a></li>
<li><a href="../de487004/index.html">Warum immer mehr US-Bundesstaaten die Netzneutralität zurückgeben - diskutieren Sie den Verlauf der Ereignisse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>