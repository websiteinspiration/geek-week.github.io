<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìá üåØ üë®‚Äçüëß‚Äçüëß The truth first of all, or why the system needs to be designed based on the database device üë®üèΩ‚Äçüé§ ü§öüèº ‚ô£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 
 
 We continue to explore the topic of Java and Spring , including at the database level. Today we suggest reading about why, when desig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>The truth first of all, or why the system needs to be designed based on the database device</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/498816/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We continue to explore the topic of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , including at the database level. Today we suggest reading about why, when designing large applications, it is the database structure, and not the Java code, that should have a decisive importance on how this is done, and what exceptions to this rule are.</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this rather belated article, I will explain why I believe that in almost all cases the data model in the application should be designed ‚Äúbased on the database‚Äù, and not ‚Äúbased on the capabilities of Java‚Äù (or another client language you work with). </font><font style="vertical-align: inherit;">Choosing the second approach, you embark on a long journey of pain and suffering as soon as your project begins to grow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article is based on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one question</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asked on Stack Overflow. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interesting discussions on reddit in the sections </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / programming</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code generation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How surprised I am that there is such a small layer of users who, having got acquainted with jOOQ, are outraged by the fact that when working jOOQ seriously relies on source code generation. Nobody bothers you to use jOOQ as you see fit, and does not force you to use code generation. But by default (as described in the manual), working with jOOQ happens like this: you start with the (inherited) database schema, reverse engineer it with the jOOQ code generator, so that you get a set of classes representing your tables, and then write type-safe queries to these tables:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-keyword">for</span> (Record2&lt;String, String&gt; record : DSL.using(configuration)
<span class="hljs-comment">//   ^^^^^^^^^^^^^^^^^^^^^^^      </span>
<span class="hljs-comment">//     ,    </span>
<span class="hljs-comment">//   SELECT </span><font></font>
 <font></font>
       .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME)<font></font>
<span class="hljs-comment">//           vvvvv ^^^^^^^^^^^^  ^^^^^^^^^^^^^^^  </span><font></font>
       .from(ACTOR)<font></font>
       .orderBy(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) {
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code is generated either manually outside the assembly, or manually with each assembly. </font><font style="vertical-align: inherit;">For example, such regeneration may follow immediately after the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migration of the Flyway database, which can also be done manually or automatically</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source code generation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Various philosophies, advantages and disadvantages are associated with such approaches to code generation - manual and automatic - which I am not going to discuss in detail in this article. But, in general, the whole point of the generated code is that it allows us to reproduce in Java that ‚Äútruth‚Äù that we take for granted, either within our system or outside it. In a sense, compilers that generate bytecode, machine code, or some other kind of source-based code do the same thing ‚Äî we get a representation of our ‚Äútruth‚Äù in another language, regardless of specific reasons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are many such code generators. For example, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XJC can generate Java code based on XSD or WSDL files</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The principle is always the same:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is some truth (internal or external) - for example, specification, data model, etc.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We need a local representation of this truth in our programming language.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, generating such a representation is almost always advisable - to avoid redundancy.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type Providers and Annotation Processing</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: another, more modern and specific approach to code generation for jOOQ is associated with the use of type providers, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the form in which they are implemented in F #</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In this case, the code is generated by the compiler, actually at the compilation stage. </font><font style="vertical-align: inherit;">In the form of source code, such a code basically does not exist. </font><font style="vertical-align: inherit;">There are similar, albeit less elegant tools in Java - these are annotation processors such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In a certain sense, the same things happen here as in the first case, with the exception of:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You do not see the generated code (perhaps this situation seems to someone not so repulsive?)</font></font></li>
<li>  ,    ,  , ¬´¬ª    .     Lombok,   ‚Äú‚Äù.      ,        .</li>
</ul><br>
<h4>     ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the tricky question of how it is better to start code generation - manually or automatically, I have to mention that there are people who think that code generation is not needed at all. The rationale for this point of view, which I came across most often, is that it is then difficult to configure the assembly pipeline. Yes, really hard. There are additional infrastructure costs. If you are just starting to work with a certain product (be it jOOQ, or JAXB, or Hibernate, etc.), it takes time to set up the working environment that you would like to spend on learning the API itself, and then extract value from it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the costs associated with understanding the generator‚Äôs device are too great, then, in fact, the API did a little work on the usability of the code generator (and in the future it turns out that the user configuration in it is complicated). Ease of use should be the highest priority for any such API. But this is just one argument against code generation. For the rest, it‚Äôs completely completely manual to write a local representation of internal or external truth. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many will say that they don‚Äôt have time to do all this. They have deadlines for their Super Product. Sometime later we comb the assembly conveyors, it will be in time. I will answer them: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/ah/5v/sdah5v4nuslp0dylmjlrvcu0qfu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alan O'Rourke, Audience Stack </font></font></a> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But in Hibernate / JPA it is so simple to write code ‚Äúfor Java‚Äù.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Really. </font><font style="vertical-align: inherit;">For Hibernate and its users, this is both a blessing and a curse. </font><font style="vertical-align: inherit;">In Hibernate, you can simply write a couple of entities, like this:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And almost everything is ready. </font><font style="vertical-align: inherit;">Now Hibernate‚Äôs destiny is to generate complex ‚Äúdetails‚Äù of exactly how this entity will be defined on the DDL of your SQL ‚Äúdialect‚Äù:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> book (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">IDENTITY</span>,<font></font>
  title <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),<font></font>
 <font></font>
  <span class="hljs-keyword">CONSTRAINT</span> pk_book PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
 <font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> i_book_title <span class="hljs-keyword">ON</span> book (title);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... and we start to drive the application. </font><font style="vertical-align: inherit;">A really cool opportunity to get started quickly and try different things. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, allow. </font><font style="vertical-align: inherit;">I was deceiving.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does Hibernate really apply the definition of this named primary key?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will Hibernate create an index in TITLE? </font><font style="vertical-align: inherit;">‚ÄúI know for sure that we will need him.‚Äù</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does Hibernate exactly make this key identifiable in the Identity Specification?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probably not. </font><font style="vertical-align: inherit;">If you are developing your project from scratch, it is always convenient to simply drop the old database and generate a new one as soon as you add the necessary annotations. </font><font style="vertical-align: inherit;">So, the Book entity will eventually take the form:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
  @Index(name = "i_book_title", columnList = "title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool. </font><font style="vertical-align: inherit;">Re-generate. </font><font style="vertical-align: inherit;">Again, in this case, at the start it will be very easy.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But then you have to pay for it</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sooner or later you have to go into production. Just then, such a model will stop working. Because: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In production it will no longer be possible, if necessary, to discard the old database and start all over from scratch. Your database will turn into a legacy one. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From now on, you will have to write </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDL migration scripts, for example, using Flyway</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . And what then happens to your entities? You can either adapt them manually (and thus double your workload), or you can order Hibernate to regenerate them for you (how great are the chances that the one generated in this way will meet your expectations?) You lose anyway.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, as soon as you go into production, you will need hot patches. </font><font style="vertical-align: inherit;">And they need to be put into production very quickly. </font><font style="vertical-align: inherit;">Since you have not prepared and organized a smooth conveyorization of your migrations for production, you are patching everything wildly. </font><font style="vertical-align: inherit;">And then you don‚Äôt have time to do everything right. </font><font style="vertical-align: inherit;">And scold Hibernate, because anyone is always to blame, but not you ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead, from the very beginning everything could be done in a completely different way. </font><font style="vertical-align: inherit;">For example, put round wheels on a bicycle.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Database first</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The real "truth" in the schema of your database and the "sovereignty" over it lies inside the database. </font><font style="vertical-align: inherit;">The scheme is defined only in the database itself and nowhere else, and each of the clients has a copy of this scheme, so it is completely advisable to impose compliance with the scheme and its integrity, do it directly in the database - where the information is stored. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is old worn wisdom even. </font><font style="vertical-align: inherit;">Primary and unique keys are good. </font><font style="vertical-align: inherit;">Foreign keys are good. </font><font style="vertical-align: inherit;">Checking for restrictions is good. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Statements</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are good. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moreover, this is not all. </font><font style="vertical-align: inherit;">For example, using Oracle, you probably want to specify:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What tablespace is your table in? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is its PCTFREE value? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the size of the cache in your sequence (behind the identifier)</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps all this is not important in small systems, but it is not necessary to wait for the transition to the area of ‚Äã‚Äã"big data" - it is possible and much earlier to begin to benefit from the storage optimizations provided by the supplier, such as those mentioned above. </font><font style="vertical-align: inherit;">None of the ORMs I've seen (including jOOQ) provide access to the full set of DDL options that you might want to use in your database. </font><font style="vertical-align: inherit;">ORMs offer some tools that help write DDL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in the end, a well-designed circuit is manually written in DDL. </font><font style="vertical-align: inherit;">Any generated DDL is only an approximation of it.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What about the client model?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned above, on the client you will need a copy of your database schema, the client view. Needless to say, this client view must be synchronized with the real model. What is the best way to achieve this? Using a code generator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All databases provide their meta information through SQL. Here's how to get all tables in different dialects of SQL from your database:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server</span>
<span class="hljs-keyword">SELECT</span> table_schema, table_name
<span class="hljs-keyword">FROM</span> information_schema.tables<font></font>
 <font></font>
<span class="hljs-comment">-- DB2</span>
<span class="hljs-keyword">SELECT</span> tabschema, tabname
<span class="hljs-keyword">FROM</span> syscat.tables<font></font>
 <font></font>
<span class="hljs-comment">-- Oracle</span>
<span class="hljs-keyword">SELECT</span> owner, table_name
<span class="hljs-keyword">FROM</span> all_tables<font></font>
 <font></font>
<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>
<span class="hljs-keyword">FROM</span> sqlite_master<font></font>
 <font></font>
<span class="hljs-comment">-- Teradata</span>
<span class="hljs-keyword">SELECT</span> databasename, tablename
<span class="hljs-keyword">FROM</span> dbc.tables
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These queries (or similar ones, depending on whether you also have to consider representations, materialized representations, functions with a table value) are also performed using a call </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><code>DatabaseMetaData.getTables()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from JDBC, or using the jOOQ meta-module. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the results of such queries, it is relatively easy to generate any client view of your database model, regardless of what technology is used on your client.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you use JDBC or Spring, you can create a set of string constants </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If using JPA, you can generate entities themselves </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If using jOOQ, you can generate the jOOQ meta-model</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depending on how many features are offered by your client API (e.g. jOOQ or JPA), the generated meta-model can be truly rich and complete. </font><font style="vertical-align: inherit;">Take, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the possibility of implicit joins that </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">appeared in jOOQ 3.11</font></a><font style="vertical-align: inherit;"> , which relies on the generated meta-information about the relationships of foreign keys between your tables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now any increment of the database will automatically lead to updating client code. </font><font style="vertical-align: inherit;">Imagine for example:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> title <span class="hljs-keyword">TO</span> book_title;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Would you really like to do this job twice? </font><font style="vertical-align: inherit;">In no case. </font><font style="vertical-align: inherit;">Just fix the DDL, run it through your assembly pipeline and get the updated entity:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
 
  //    ?
  @Index(name = "i_book_title", columnList = "book_title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
 <font></font>
  <span class="hljs-meta">@Column("book_title")</span><font></font>
  String bookTitle;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or an updated jOOQ class. </font><font style="vertical-align: inherit;">Most DDL changes also affect semantics, not just syntax. </font><font style="vertical-align: inherit;">Therefore, it can be convenient to see in compiled code which code will (or may be) be affected by the increment of your database.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only truth</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No matter what technology you use, there is always one model that is the only source of truth for some subsystem - or, at least, we should strive for this and avoid such enterprise confusion, where the ‚Äútruth‚Äù is everywhere and nowhere. </font><font style="vertical-align: inherit;">Everything can be much simpler. </font><font style="vertical-align: inherit;">If you are just exchanging XML files with some other system, just use XSD. </font><font style="vertical-align: inherit;">Take a look at the INFORMATION_SCHEMA meta-model from jOOQ in an XML form: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD is well understood</font></font></li>
<li>XSD     XML         </li>
<li>XSD        </li>
<li>XSD     Java   XJC</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last point is important. </font><font style="vertical-align: inherit;">When communicating with an external system using XML messages, we want to be sure of the validity of our messages. </font><font style="vertical-align: inherit;">This is very easy to achieve with JAXB, XJC and XSD. </font><font style="vertical-align: inherit;">It would be completely insane to expect that, when approaching the design of ‚ÄúJava first‚Äù, where we make our messages in the form of Java objects, they could somehow be clearly displayed in XML and sent for consumption to another system. </font><font style="vertical-align: inherit;">The XML generated in this way would be of very poor quality, not documented, and would be difficult to develop. </font><font style="vertical-align: inherit;">If there was an agreement on the level of quality of service (SLA) on such an interface, we would immediately ruin it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Honestly, that‚Äôs exactly what happens all the time from the API to JSON, but that's another story, I‚Äôll swear next time ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Databases: it's the same thing</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When working with databases, you understand that they are, in principle, similar. The base owns its data and must manage the scheme. Any modifications made to the circuit must be implemented directly on DDL in order to update a single source of truth. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When a source update has occurred, all clients must also update their copies of the model. Some clients can be written in Java using jOOQ and Hibernate or JDBC (or all at once). Other clients can be written in Perl (it remains to wish them good luck), and others in C #. It does not matter. The main model is in the database. Models generated using ORMs, usually of poor quality, are poorly documented and difficult to develop.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, do not make mistakes. </font><font style="vertical-align: inherit;">Make no mistakes right from the start. </font><font style="vertical-align: inherit;">Work from a database. </font><font style="vertical-align: inherit;">Build a deployment pipeline that can be automated. </font><font style="vertical-align: inherit;">Turn on code generators to make it convenient to copy your database model and dump it onto clients. </font><font style="vertical-align: inherit;">And stop worrying about code generators. </font><font style="vertical-align: inherit;">They are good. </font><font style="vertical-align: inherit;">With them you will become more productive. </font><font style="vertical-align: inherit;">You only need to spend a little time from the very beginning to configure them - and then you will have years of increased productivity that will form the history of your project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Until then, thank you.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Explanation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For clarity: This article in no way advocates that under the model of your database you need to bend the entire system (i.e., subject area, business logic, etc., etc.). </font><font style="vertical-align: inherit;">In this article, I say that client code that interacts with the database must act on the basis of the database model so that it does not reproduce the database model in the "first class" status. </font><font style="vertical-align: inherit;">This logic is usually located at the data access level on your client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In two-tier architectures, which are still preserved in some places, such a system model may be the only possible one. </font><font style="vertical-align: inherit;">However, in most systems, the level of data access seems to me to be a "subsystem" encapsulating a database model.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exceptions</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are exceptions to any rule, and I have already said that an approach with database primacy and source code generation can sometimes be inappropriate. </font><font style="vertical-align: inherit;">Here are a couple of exceptions (there are probably others):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the circuit is unknown, and it must be opened. </font><font style="vertical-align: inherit;">For example, you are a provider of a tool to help users navigate any scheme. </font><font style="vertical-align: inherit;">Phew </font><font style="vertical-align: inherit;">There is no code generation. </font><font style="vertical-align: inherit;">But still - the database is above all.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a circuit should be generated on the fly to solve a certain problem. </font><font style="vertical-align: inherit;">This example seems like a slightly fanciful version of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entity attribute value</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pattern </font><font style="vertical-align: inherit;">, i.e., you really don't have a well-defined schema. </font><font style="vertical-align: inherit;">In this case, it‚Äôs often impossible to be sure at all that an RDBMS is right for you.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exceptions are inherently exceptional. </font><font style="vertical-align: inherit;">In most cases involving the use of an RDBMS, the scheme is known in advance, it is located inside the RDBMS and is the only source of ‚Äútruth‚Äù, and all customers have to acquire copies that are derived from it. </font><font style="vertical-align: inherit;">Ideally, you need to use a code generator.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498796/index.html">Content Security Policy in Magento 2</a></li>
<li><a href="../en498798/index.html">Keep learning and learning with JetBrains</a></li>
<li><a href="../en498800/index.html">How I taught my computer to play Dobble with OpenCV and Deep Learning</a></li>
<li><a href="../en498808/index.html">Vim with YAML Support for Kubernetes</a></li>
<li><a href="../en498814/index.html">You failed one theoretical question on the Social Security, and they put an end to you. This is normal? // We Are Doomed # 3</a></li>
<li><a href="../en498820/index.html">Some more tricky questions on .NET and C #</a></li>
<li><a href="../en498822/index.html">Development and creation from scratch of an arcade machine for four players</a></li>
<li><a href="../en498826/index.html">SIL and Salesforce</a></li>
<li><a href="../en498828/index.html">How table salt and proteins will increase implant survival</a></li>
<li><a href="../en498830/index.html">Hash + cache: stream processing optimization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>