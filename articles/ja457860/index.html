<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”° ğŸ‘¸ğŸ» âœŒğŸ¿ Node.jsã¨Reactã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹ ğŸ‘©â€â¤ï¸â€ğŸ‘© ğŸ•º ğŸ¤´ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ—¥ã®ç¿»è¨³ã‚’å…¬é–‹ã—ã¦ã„ã‚‹è³‡æ–™ã®è‘—è€…ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§èµ·ã“ã£ã¦ã„ã‚‹ã“ã¨ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ”¾é€ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ã‚’æ•´ç†ã§ãã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å–ã‚Šçµ„ã‚“ã§ã„ã‚‹ã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ã‹ã‚‰RTMPå½¢å¼ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’HLSã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€è¦–è´è€…ã®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Node.jsã¨Reactã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/457860/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ—¥ã®ç¿»è¨³ã‚’å…¬é–‹ã—ã¦ã„ã‚‹è³‡æ–™ã®è‘—è€…ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§èµ·ã“ã£ã¦ã„ã‚‹ã“ã¨ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ”¾é€ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ã‚’æ•´ç†ã§ãã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å–ã‚Šçµ„ã‚“ã§ã„ã‚‹ã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ã‹ã‚‰RTMPå½¢å¼ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å—ã‘å–ã‚Šã€ãã‚Œã‚’HLSã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€è¦–è´è€…ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§å†ç”Ÿã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€Node.jsã¨Reactã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èˆˆå‘³ã®ã‚ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è¦‹æ…£ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã™ãã«ã‚³ãƒ¼ãƒ‰ã«æ²¡é ­ã—ã¦ã€</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã“ã®</font></a><font style="vertical-align: inherit;">ãƒªãƒã‚¸ãƒˆãƒªã‚’</font><font style="vertical-align: inherit;">èª¿ã¹ã‚‹ã“ã¨ãŒã§ã</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/6d3/aa0/af1/6d3aa0af110dff937f5e88ba5ae02921.png" alt="ç”»åƒ"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºæœ¬èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹Webã‚µãƒ¼ãƒãƒ¼é–‹ç™º</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Node.jsã«åŸºã¥ãå˜ç´”ãªWebã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã“ã§ã¯ã€passport.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆ¦ç•¥ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æƒ…å ±ã®æ°¸ç¶šçš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦ã€MongoDBã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Mongoose ODMãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ npm init</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ npm install axios bcrypt-nodejs body-parser bootstrap config connect-ensure-login connect-flash cookie-parser ejs express express-session mongoose passport passport-local request session-file-store --save-dev</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€2ã¤ã®ãƒ•ã‚©ãƒ«ãƒ€- </font></font><code>client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã¾ã™</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ Reactã«åŸºã¥ããƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã¯æœ€çµ‚çš„ã«ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼</font></font><code>client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«æ ¼ç´ã•ã‚Œã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«æ ¼ç´ã•ã‚Œã¾ã™</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ç¾åœ¨ã€ãƒ•ã‚©ãƒ«ãƒ€ã§ä½œæ¥­ã—ã¦ã„ã¾ã™</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ã¤ã¾ã‚Šã€passport.jsã‚’ä½¿ç”¨ã—ã¦èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚ passportãŠã‚ˆã³passport-localãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æˆ¦ç•¥ã‚’èª¬æ˜ã™ã‚‹å‰ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—</font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€å˜ç´”ãªã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ã«å¿…è¦ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªåˆ†ã§å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€MongoDB DBMSãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¬¡ã®å ´æ‰€ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Session = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;bodyParse = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;middleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;FileStore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'session-file-store'</span>)(Session),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config/default'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;flash = <span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-flash'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;port = <span class="hljs-number">3333</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;app = express();<font></font>
<font></font>
mongoose.connect(<span class="hljs-string">'mongodb://127.0.0.1/nodeStream'</span> , { <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span> });<font></font>
<font></font>
app.set(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>);<font></font>
app.set(<span class="hljs-string">'views'</span>, path.join(__dirname, <span class="hljs-string">'./views'</span>));<font></font>
app.use(express.static(<span class="hljs-string">'public'</span>));<font></font>
app.use(flash());<font></font>
app.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>)());<font></font>
app.use(bodyParse.urlencoded({<span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>}));<font></font>
app.use(bodyParse.json({<span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>}));<font></font>
<font></font>
app.use(Session({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">store</span>: <span class="hljs-keyword">new</span> FileStore({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">path</span> : <span class="hljs-string">'./server/sessions'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">secret</span>: config.server.secret,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">maxAge</span> : <span class="hljs-built_in">Date</span>().now + (<span class="hljs-number">60</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">30</span>)<font></font>
}));<font></font>
<font></font>
app.get(<span class="hljs-string">'*'</span>, middleware.ensureLoggedIn(), (req, res) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;res.render(<span class="hljs-string">'index'</span>);<font></font>
});<font></font>
<font></font>
app.listen(port, () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`App listening on <span class="hljs-subst">${port}</span>!`</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MongoDBã«æ¥ç¶šã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ãªã™ã¹ã¦ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«Expressã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜ã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•å¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¾©å…ƒã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²ã¨èªè¨¼ã‚’æ•´ç†ã™ã‚‹ãŸã‚ã®passport.jsæˆ¦ç•¥ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€å†…ã«</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€</font></font><code>auth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã€</font><font style="vertical-align: inherit;">ãã®ä¸­ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã™</font></font><code>passport.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ã¹ãã‚‚ã®ã§ã™</font></font><code>server/auth/passport.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../database/Schema'</span>).User,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;shortid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'shortid'</span>);<font></font>
<font></font>
passport.serializeUser( <span class="hljs-function">(<span class="hljs-params">user, cb</span>) =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;cb(<span class="hljs-literal">null</span>, user);<font></font>
});<font></font>
<font></font>
passport.deserializeUser( <span class="hljs-function">(<span class="hljs-params">obj, cb</span>) =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;cb(<span class="hljs-literal">null</span>, obj);<font></font>
});<font></font>
<font></font>
<span class="hljs-comment">//  passport,   </span>
passport.use(<span class="hljs-string">'localRegister'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">usernameField</span>: <span class="hljs-string">'email'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passwordField</span>: <span class="hljs-string">'password'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passReqToCallback</span>: <span class="hljs-literal">true</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, email, password, done) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.findOne({<span class="hljs-attr">$or</span>: [{<span class="hljs-attr">email</span>: email}, {<span class="hljs-attr">username</span>: req.body.username}]},&nbsp; (err, user) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (err)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(err);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (user) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (user.email === email) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.flash(<span class="hljs-string">'email'</span>, <span class="hljs-string">'Email is already taken'</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (user.username === req.body.username) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.flash(<span class="hljs-string">'username'</span>, <span class="hljs-string">'Username is already taken'</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> user = <span class="hljs-keyword">new</span> User();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.email = email;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.password = user.generateHash(password);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.username = req.body.username;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.stream_key = shortid.generate();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.save( <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (err)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> err;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}));<font></font>
<font></font>
<span class="hljs-comment">//  passport,   </span>
passport.use(<span class="hljs-string">'localLogin'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">usernameField</span>: <span class="hljs-string">'email'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passwordField</span>: <span class="hljs-string">'password'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">passReqToCallback</span>: <span class="hljs-literal">true</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, email, password, done) =&gt; {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.findOne({<span class="hljs-string">'email'</span>: email}, (err, user) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (err)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(err);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!user)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, req.flash(<span class="hljs-string">'email'</span>, <span class="hljs-string">'Email doesn\'t exist.'</span>));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!user.validPassword(password))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, req.flash(<span class="hljs-string">'password'</span>, <span class="hljs-string">'Oops! Wrong password.'</span>));<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}));<font></font>
<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = passport;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã‚‰ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒ ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã“ã‚Œã‚’ã¨å‘¼ã³ã¾ã™</font></font><code>UserSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€å†…ã«</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€</font></font><code>database</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã€</font><font style="vertical-align: inherit;">ãã®ä¸­ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã¾ã™</font></font><code>UserSchema.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><code>server/database.UserSchema.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;bcrypt &nbsp; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bcrypt-nodejs'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;shortid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'shortid'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Schema = mongoose.Schema;<font></font>
<font></font>
<span class="hljs-keyword">let</span> UserSchema = <span class="hljs-keyword">new</span> Schema({
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">username</span>: <span class="hljs-built_in">String</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">email</span> : <span class="hljs-built_in">String</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">password</span>: <span class="hljs-built_in">String</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span> : <span class="hljs-built_in">String</span>,<font></font>
});<font></font>
<font></font>
UserSchema.methods.generateHash = <span class="hljs-function">(<span class="hljs-params">password</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> bcrypt.hashSync(password, bcrypt.genSaltSync(<span class="hljs-number">8</span>), <span class="hljs-literal">null</span>);<font></font>
};<font></font>
<font></font>
UserSchema.methods.validPassword = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">password</span>)</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> bcrypt.compareSync(password, <span class="hljs-keyword">this</span>.password);<font></font>
};<font></font>
<font></font>
UserSchema.methods.generateStreamKey = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> shortid.generate();<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = UserSchema;</code></pre><br><font style="vertical-align: inherit;"></font><code>UserSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ã¤ã®æ–¹æ³•</font><font style="vertical-align: inherit;">
ãŒã‚ã‚Š</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯</font></font><code>generateHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§æç¤ºã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’bcryptãƒãƒƒã‚·ãƒ¥ã«å¤‰æ›ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®æ–¹æ³•ã‚’ãƒ‘ã‚¹ãƒãƒ¼ãƒˆæˆ¦ç•¥ã§ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’bcryptãƒãƒƒã‚·ãƒ¥ã«å¤‰æ›ã—ã¾ã™ã€‚å—ä¿¡ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰</font></font><code>validPassword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å—ã‘å…¥ã‚Œã€ãã®ãƒãƒƒã‚·ãƒ¥ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒãƒƒã‚·ãƒ¥ã¨æ¯”è¼ƒã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ç¢ºèªã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰</font></font><code>generateStreamKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€RTMPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚­ãƒ¼ï¼‰ã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è»¢é€ã™ã‚‹ä¸€æ„ã®æ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><code>server/database/Schema.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);<font></font>
<font></font>
exports.User = mongoose.model(<span class="hljs-string">'User'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./UserSchema'</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‘ã‚¹ãƒãƒ¼ãƒˆæˆ¦ç•¥ã‚’å®šç¾©ã—ã€ã‚¹ã‚­ãƒ¼ãƒ ã‚’èª¬æ˜ã—ã€</font></font><code>UserSchema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã«åŸºã¥ã„ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ãŸã®ã§ã€ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ã«åˆæœŸåŒ–ã—ã¾ã—ã‚‡ã†</font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãŠã‚Š</font><font style="vertical-align: inherit;">ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//       ,    </span>
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/passport'</span>);<font></font>
<font></font>
app.use(passport.initialize());<font></font>
app.use(passport.session());</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã‚‰ã«ã€</font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’</font><font style="vertical-align: inherit;">è¿½åŠ ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   </span><font></font>
<font></font>
app.use(<span class="hljs-string">'/login'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/login'</span>));<font></font>
app.use(<span class="hljs-string">'/register'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/register'</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€</font><font style="vertical-align: inherit;">ã«ã‚ã‚‹</font><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«</font></font><code>login.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><code>register.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚©ãƒ«ãƒ€ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—</font></font><code>routes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ä¸Šè¨˜ã®ãƒ«ãƒ¼ãƒˆã‚’ã„ãã¤ã‹å®šç¾©ã—ã€ãƒ‘ã‚¹ãƒãƒ¼ãƒˆãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½¿ç”¨ã—ã¦ã€ç™»éŒ²ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’æ•´ç†ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><code>server/routes/login.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;router = express.Router(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);<font></font>
<font></font>
router.get(<span class="hljs-string">'/'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedOut(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, res) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.render(<span class="hljs-string">'login'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">user</span> : <span class="hljs-literal">null</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errors</span> : {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">email</span> : req.flash(<span class="hljs-string">'email'</span>),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">password</span> : req.flash(<span class="hljs-string">'password'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
<font></font>
router.post(<span class="hljs-string">'/'</span>, passport.authenticate(<span class="hljs-string">'localLogin'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">successRedirect</span> : <span class="hljs-string">'/'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">failureRedirect</span> : <span class="hljs-string">'/login'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">failureFlash</span> : <span class="hljs-literal">true</span><font></font>
}));<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = router;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™</font></font><code>server/routes/register.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;router = express.Router(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);<font></font>
<font></font>
router.get(<span class="hljs-string">'/'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedOut(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, res) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.render(<span class="hljs-string">'register'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">user</span> : <span class="hljs-literal">null</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">errors</span> : {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">username</span> : req.flash(<span class="hljs-string">'username'</span>),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">email</span> : req.flash(<span class="hljs-string">'email'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
<font></font>
router.post(<span class="hljs-string">'/'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedOut(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passport.authenticate(<span class="hljs-string">'localRegister'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">successRedirect</span> : <span class="hljs-string">'/'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">failureRedirect</span> : <span class="hljs-string">'/register'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">failureFlash</span> : <span class="hljs-literal">true</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
);<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = router;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ejsãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</font></font><code>login.ejs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><code>register.ejs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã«ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼</font></font><code>views</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">è¿½åŠ </font><font style="vertical-align: inherit;">ã—ã¾ã™</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯æ¬¡ã®</font></font><code>server/views/login.ejs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãŠã‚Š</font><font style="vertical-align: inherit;">ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">header.ejs</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">navbar.ejs</span> %&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container app mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-4"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-xs-12 col-sm-12 col-md-8 col-lg-6"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter email"</span> <span class="hljs-attr">required</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">errors.email.length</span>) { %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-danger"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">errors.email</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> } %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span> <span class="hljs-attr">required</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">errors.password.length</span>) { %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-danger"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">errors.password</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> } %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"leader"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Don't have an account? Register <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/register"</span>&gt;</span>here<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-dark btn-block"</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">footer.ejs</span> %&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ã¹ãã‚‚ã®ã§ã™</font></font><code>server/views/register.ejs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">header.ejs</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">navbar.ejs</span> %&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container app mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-4"</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/register"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">class</span>=<span class="hljs-string">"col-xs-12 col-sm-12 col-md-8 col-lg-6"</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter username"</span> <span class="hljs-attr">required</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">errors.username.length</span>) { %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-danger"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">errors.username</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> } %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email address<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter email"</span> <span class="hljs-attr">required</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">errors.email.length</span>) { %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-danger"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">errors.email</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">%</span> } %&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Password"</span> <span class="hljs-attr">required</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"leader"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Have an account? Login <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/login"</span>&gt;</span>here<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-dark btn-block"</span>&gt;</span>Register<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">include</span> <span class="hljs-attr">footer.ejs</span> %&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä½œæ¥­ãŒçµ‚äº†ã—ãŸã¨è¨€ãˆã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¬¡ã®éƒ¨åˆ†ã®ä½œæˆã‚’é–‹å§‹ã—ã¦ã€RTMPã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹æˆã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTMPã‚µãƒ¼ãƒãƒ¼ã®æ§‹æˆ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTMPï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ã¯ã€ãƒ†ãƒ¼ãƒ—ãƒ‰ãƒ©ã‚¤ãƒ–ã¨ã‚µãƒ¼ãƒãƒ¼é–“ã§ã®ãƒ“ãƒ‡ã‚ªã€ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã€ãŠã‚ˆã³ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿ã®é«˜æ€§èƒ½ä¼é€ç”¨ã«é–‹ç™ºã•ã‚ŒãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚ Twitchã€Facebookã€YouTubeã€ãŠã‚ˆã³ä»–ã®å¤šãã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µã‚¤ãƒˆã¯ã€RTMPã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å—ã‘å…¥ã‚Œã€ãã‚Œã‚‰ã‚’HTTPã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆHLSå½¢å¼ï¼‰ã«ãƒˆãƒ©ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰ã€ã“ã‚Œã‚‰ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’CDNã«è»¢é€ã—ã¦é«˜å¯ç”¨æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
node-media-serverãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«-RTMPãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ã®Node.js-implementationã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ã¯ã€RTMPã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å—ã‘å…¥ã‚Œã€ffmpegãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦HLS / DASHã«å¤‰æ›ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã«ã¯ã€ffmpegãŒã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ Linuxã§ä½œæ¥­ã—ã¦ã„ã¦ã€ffmpegãŒã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãã®ãƒ‘ã‚¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ which ffmpeg<font></font>
# /usr/bin/ffmpeg</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
node-media-serverãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ffmpegãƒãƒ¼ã‚¸ãƒ§ãƒ³4.xã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ffmpegã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¦ç¢ºèªã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ ffmpeg --version<font></font>
# ffmpeg version 4.1.3-0york1~18.04 Copyright (c) 2000-2019 the&nbsp;<font></font>
# FFmpeg developers built with gcc 7 (Ubuntu 7.3.0-27ubuntu1~18.04)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ffmpegãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚‰ãšã€Ubuntuã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">#    PPA-.     PPA,   <font></font>
# ffmpeg  3.x.&nbsp;<font></font>
&nbsp;<font></font>
$ sudo add-apt-repository ppa:jonathonf/ffmpeg-4<font></font>
$ sudo apt install ffmpeg</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsã§ä½œæ¥­ã—ã¦ã„ã‚‹å ´åˆã¯ã€Windowsç”¨ã®</font><font style="vertical-align: inherit;">ffmpeg </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ“ãƒ«ãƒ‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™</font></font><code>server/config/default.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> config = {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">server</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">secret</span>: <span class="hljs-string">'kjVkuti2xAyF3JGCzSZTk0YWM5JhI9mgQW4rytXc'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">rtmp_server</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">rtmp</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">port</span>: <span class="hljs-number">1935</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">chunk_size</span>: <span class="hljs-number">60000</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">gop_cache</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">ping</span>: <span class="hljs-number">60</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">ping_timeout</span>: <span class="hljs-number">30</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">http</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">port</span>: <span class="hljs-number">8888</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">mediaroot</span>: <span class="hljs-string">'./server/media'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">allow_origin</span>: <span class="hljs-string">'*'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">trans</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">ffmpeg</span>: <span class="hljs-string">'/usr/bin/ffmpeg'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">tasks</span>: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app: <span class="hljs-string">'live'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">hls</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">hlsFlags</span>: <span class="hljs-string">'[hls_time=2:hls_list_size=3:hls_flags=delete_segments]'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">dash</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">dashFlags</span>: <span class="hljs-string">'[f=dash:window_size=3:extra_window_size=5]'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
};<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = config;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤</font></font><code>ffmpeg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ã€ffmpegãŒã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¹ã«</font><font style="vertical-align: inherit;">ç½®ãæ›ãˆ</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Windowsã§ä½œæ¥­ã—ã¦ã„ã¦ã€ä¸Šè¨˜ã®ãƒªãƒ³ã‚¯ã‹ã‚‰Windowsã‚¢ã‚»ãƒ³ãƒ–ãƒªffmpegã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸå ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã«æ‹¡å¼µå­ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„</font></font><code>.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å¯¾å¿œã™ã‚‹ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">const config = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trans: {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffmpeg: 'D:/ffmpeg/bin/ffmpeg.exe',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€node-media-serverã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ npm install node-media-server --save</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚©ãƒ«ãƒ€ã«</font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«</font><font style="vertical-align: inherit;">ã‚’ä½œæˆã—ã¾ã™</font></font><code>media_server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æŒ¿å…¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯</font></font><code>server/media_server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> NodeMediaServer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-media-server'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config/default'</span>).rtmp_server;<font></font>
&nbsp;<font></font>
nms = <span class="hljs-keyword">new</span> NodeMediaServer(config);<font></font>
&nbsp;<font></font>
nms.on(<span class="hljs-string">'prePublish'</span>, <span class="hljs-keyword">async</span> (id, StreamPath, args) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> stream_key = getStreamKeyFromStreamPath(StreamPath);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[NodeEvent on prePublish]'</span>, <span class="hljs-string">`id=<span class="hljs-subst">${id}</span> StreamPath=<span class="hljs-subst">${StreamPath}</span> args=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(args)}</span>`</span>);<font></font>
});<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">const</span> getStreamKeyFromStreamPath = <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> parts = path.split(<span class="hljs-string">'/'</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> parts[parts.length - <span class="hljs-number">1</span>];<font></font>
};<font></font>
&nbsp;<font></font>
<span class="hljs-built_in">module</span>.exports = nms;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½¿ç”¨ã¯</font></font><code>NodeMediaService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éå¸¸ã«ç°¡å˜ã§ã™ã€‚</font><font style="vertical-align: inherit;">RTMPã‚µãƒ¼ãƒãƒ¼ã‚’æä¾›ã—ã€æ¥ç¶šã‚’å¾…ã¤ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ãŒç„¡åŠ¹ãªå ´åˆã€ç€ä¿¡æ¥ç¶šã‚’æ‹’å¦ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã—ã¾ã™</font></font><code>prePublish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã«</font></font><code>prePublish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">è¿½åŠ ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç„¡åŠ¹ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã§ç€ä¿¡æ¥ç¶šã‚’æ‹’å¦ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã¾ã§ã®é–“ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®RTMPãƒãƒ¼ãƒˆï¼ˆ1935ï¼‰ã«ç€ä¿¡ã™ã‚‹ã™ã¹ã¦ã®ç€ä¿¡æ¥ç¶šã‚’å—ã‘å…¥ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«ã«</font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</font><font style="vertical-align: inherit;">ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€</font></font><code>node_media_server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™</font><font style="vertical-align: inherit;">ã ã‘ã§ã™</font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’ã«è¿½åŠ ã—ã¾ã™</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//      app.js,</span>
<span class="hljs-comment">//  ,     </span>
<span class="hljs-keyword">const</span> node_media_server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./media_server'</span>);<font></font>
&nbsp;<font></font>
<span class="hljs-comment">//   run()   ,</span>
<span class="hljs-comment">// ,    -</span><font></font>
&nbsp;<font></font>
node_media_server.run();</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆOpen Broadcaster Softwareï¼‰ã‚’</font><font style="vertical-align: inherit;">
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨­å®šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¾ã™</font></font><code>Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><code>Custom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§</font><font style="vertical-align: inherit;">é¸æŠ</font><font style="vertical-align: inherit;">ã—ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</font></font><code>Service</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«å…¥åŠ›</font></font><code>rtmp://127.0.0.1:1935/live</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã¾ã™</font></font><code>Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</font></font><code>Stream Key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ç©ºç™½ã®ã¾ã¾ã«ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å…¥åŠ›ã›ãšã«è¨­å®šã‚’ä¿å­˜ã§ããªã„å ´åˆã¯ã€ä»»æ„ã®æ–‡å­—ã‚»ãƒƒãƒˆã‚’å…¥åŠ›ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒœã‚¿ãƒ³</font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™</font></font><code>OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒœã‚¿ãƒ³</font></font><code>Start Streaming</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦</font><font style="vertical-align: inherit;">ã€RTMPã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è‡ªåˆ†ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã«è»¢é€ã—å§‹ã‚ã¾ã™ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/323/b3f/d84/323b3fd845651845971b2b0d7a1e57fe.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OBSã®æ§‹æˆ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ç§»å‹•ã—ã€ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ãŒä½•ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã„ãã¤ã‹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç€ä¿¡ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ãƒ­ã‚°ã«é–¢ã™ã‚‹æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddf/c30/bed/ddfc30bed1ce406a72cecafe2af3a8b2.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.jsã«åŸºã¥ããƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã‚‹ç«¯æœ«ã¸ã®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒãƒ¼ã¯ã€æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã§ãã‚‹APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</font></font><code>http://127.0.0.1:8888/api/streams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¾Œã§ã€Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã“ã®APIã‚’ä½¿ç”¨ã—ã¦ã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
&nbsp;&nbsp;"live": {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;"0wBic-qV4": {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"publisher": {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"app": "live",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"stream": "0wBic-qV4",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"clientId": "WMZTQAEY",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"connectCreated": "2019-05-12T16:13:05.759Z",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"bytes": 33941836,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ip": "::ffff:127.0.0.1",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"audio": {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"codec": "AAC",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"profile": "LC",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"samplerate": 44100,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"channels": 2<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"video": {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"codec": "H264",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"width": 1920,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"height": 1080,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"profile": "High",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"level": 4.2,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"fps": 60<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"subscribers": [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"app": "live",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"stream": "0wBic-qV4",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"clientId": "GNJ9JYJC",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"connectCreated": "2019-05-12T16:13:05.985Z",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"bytes": 33979083,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ip": "::ffff:127.0.0.1",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"protocol": "rtmp"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æº–å‚™ãŒã»ã¼æ•´ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€HTTPã€RTMPã€ãŠã‚ˆã³HLSãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ç¨¼åƒä¸­ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€ç€ä¿¡RTMPæ¥ç¶šã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã¯ã¾ã ä½œæˆã—ã¦ã„ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼ãŒèªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã¿ã‚’å—ã‘å…¥ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’</font></font><code>prePublish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«ã®</font><font style="vertical-align: inherit;">ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼</font><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">è¿½åŠ ã—</font><font style="vertical-align: inherit;">ã¾ã™</font></font><code>server/media_server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//      </span>
<span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./database/Schema'</span>).User;<font></font>
<font></font>
nms.on(<span class="hljs-string">'prePublish'</span>, <span class="hljs-keyword">async</span> (id, StreamPath, args) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> stream_key = getStreamKeyFromStreamPath(StreamPath);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[NodeEvent on prePublish]'</span>, <span class="hljs-string">`id=<span class="hljs-subst">${id}</span> StreamPath=<span class="hljs-subst">${StreamPath}</span> args=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(args)}</span>`</span>);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;User.findOne({<span class="hljs-attr">stream_key</span>: stream_key}, (err, user) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!user) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> session = nms.getSession(id);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.reject();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// - </span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">const</span> getStreamKeyFromStreamPath = <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> parts = path.split(<span class="hljs-string">'/'</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> parts[parts.length - <span class="hljs-number">1</span>];<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚­ãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å±ã—ã¦ã„ã‚‹å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã¨ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å…¬é–‹ã‚’è¨±å¯ã™ã‚‹ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ç€ä¿¡RTMPæ¥ç¶šã‚’æ‹’å¦ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Reactã«åŸºã¥ãç°¡å˜ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯ã€è¦–è´è€…ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’è¦–è´ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ãŠã‚ˆã³ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”Ÿæ”¾é€</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™</font></font><code>clients</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã®ã§ã€webpackãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€JSXã‚³ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ãŒç†è§£ã§ãã‚‹JavaScriptã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚‚å¿…è¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">$ npm install @babel/core @babel/preset-env @babel/preset-react babel-loader css-loader file-loader mini-css-extract-plugin node-sass sass-loader style-loader url-loader webpack webpack-cli react react-dom react-router-dom video.js jquery bootstrap history popper.js</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€webpackï¼ˆ</font></font><code>webpack.config.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã®</font><font style="vertical-align: inherit;">æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> MiniCssExtractPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mini-css-extract-plugin"</span>);
<span class="hljs-keyword">const</span> devMode = process.env.NODE_ENV !== <span class="hljs-string">'production'</span>;
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);<font></font>
&nbsp;<font></font>
<span class="hljs-built_in">module</span>.exports = {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">entry</span> : <span class="hljs-string">'./client/index.js'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">output</span> : {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">filename</span> : <span class="hljs-string">'bundle.js'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">path</span> : path.resolve(__dirname, <span class="hljs-string">'public'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">module</span> : {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">rules</span> : [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test: <span class="hljs-regexp">/\.s?[ac]ss$/</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MiniCssExtractPlugin.loader,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="hljs-attr">loader</span>: <span class="hljs-string">'css-loader'</span>, <span class="hljs-attr">options</span>: { <span class="hljs-attr">url</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span> } },<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="hljs-attr">loader</span>: <span class="hljs-string">'sass-loader'</span>, <span class="hljs-attr">options</span>: { <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span> } }<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exclude: <span class="hljs-regexp">/node_modules/</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use: <span class="hljs-string">"babel-loader"</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.woff($|\?)|\.woff2($|\?)|\.ttf($|\?)|\.eot($|\?)|\.svg($|\?)/</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loader: <span class="hljs-string">'url-loader'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|jpg|gif)$/</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use: [{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">loader</span>: <span class="hljs-string">'file-loader'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">options</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">outputPath</span>: <span class="hljs-string">'/'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">devtool</span>: <span class="hljs-string">'source-map'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">plugins</span>: [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span> MiniCssExtractPlugin({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">filename</span>: <span class="hljs-string">"style.css"</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span> webpack.ProvidePlugin({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">$</span>: <span class="hljs-string">'jquery'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">jQuery</span>: <span class="hljs-string">'jquery'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">mode</span> : devMode ? <span class="hljs-string">'development'</span> : <span class="hljs-string">'production'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">watch</span> : devMode,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">performance</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">hints</span>: process.env.NODE_ENV === <span class="hljs-string">'production'</span> ? <span class="hljs-string">"warning"</span> : <span class="hljs-literal">false</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è¿½åŠ ã—ã¾ã™</font></font><code>client/index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> {BrowserRouter} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'bootstrap'</span>;
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./index.scss'</span>);
<span class="hljs-keyword">import</span> Root <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Root.js'</span>;<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">if</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)){<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ReactDOM.render(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Root</span>/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯æ¬¡ã®</font></font><code>client/index.scss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãŠã‚Š</font><font style="vertical-align: inherit;">ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">@import '~bootstrap/dist/css/bootstrap.css';<font></font>
@import '~video.js/dist/video-js.css';<font></font>
&nbsp;<font></font>
@import url('https://fonts.googleapis.com/css?family=Dosis');<font></font>
&nbsp;<font></font>
html,body{<font></font>
&nbsp;&nbsp;font-family: 'Dosis', sans-serif;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¯Reactãƒ«ãƒ¼ã‚¿ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯ã€ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã€ãŠã‚ˆã³ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å ´åˆã¯video.jsã‚‚ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä»Šã¾ã§ã®ãƒ•ã‚©ãƒ«ãƒ€ã®è¿½åŠ </font></font><code>client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ•ã‚©ãƒ«ãƒ€</font></font><code>components</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãŠã‚ˆã³ãã‚Œã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’</font></font><code>Root.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯æ¬¡ã®</font></font><code>client/components/Root.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ãŠã‚Š</font><font style="vertical-align: inherit;">ã§ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> {Router, Route} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> Navbar <span class="hljs-keyword">from</span> <span class="hljs-string">'./Navbar'</span>;
<span class="hljs-keyword">import</span> LiveStreams <span class="hljs-keyword">from</span> <span class="hljs-string">'./LiveStreams'</span>;
<span class="hljs-keyword">import</span> Settings <span class="hljs-keyword">from</span> <span class="hljs-string">'./Settings'</span>;<font></font>
<font></font>
<span class="hljs-keyword">import</span> VideoPlayer <span class="hljs-keyword">from</span> <span class="hljs-string">'./VideoPlayer'</span>;
<span class="hljs-keyword">const</span> customHistory = <span class="hljs-built_in">require</span>(<span class="hljs-string">"history"</span>).createBrowserHistory();<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Root</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(props){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">super</span>(props);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;render(){<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{customHistory}</span> &gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Navbar</span>/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{props</span> =&gt;</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">LiveStreams</span>&nbsp; {<span class="hljs-attr">...props</span>} /&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}/&gt;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/stream/:username"</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{(props)</span> =&gt;</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">VideoPlayer</span> {<span class="hljs-attr">...props</span>}/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}/&gt;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">exact</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/settings"</span> <span class="hljs-attr">render</span>=<span class="hljs-string">{props</span> =&gt;</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Settings</span> {<span class="hljs-attr">...props</span>} /&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)}/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ã¤ã®ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å«ã‚€</font><font style="vertical-align: inherit;">
Component </font><font style="vertical-align: inherit;">React </font></font><code>&lt;Root/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ãƒ³ãƒ€ãƒ¼</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</font><font style="vertical-align: inherit;">ã¯ã€ç¿»è¨³ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</font><font style="vertical-align: inherit;">ã¯ã€video.jsãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã®è¡¨ç¤ºã‚’æ‹…å½“ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</font><font style="vertical-align: inherit;">ã¯ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ä½œæˆã‚’æ‹…å½“ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><code>&lt;Router/&gt;</code><font style="vertical-align: inherit;"></font><code>&lt;Route/&gt;</code><font style="vertical-align: inherit;"></font><code>&lt;LiveStreams/&gt;</code><font style="vertical-align: inherit;"></font><code>&lt;VideoPlayer/&gt;</code><font style="vertical-align: inherit;"></font><code>&lt;Settings/&gt;</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>client/components/LiveStreams.js</code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> {Link} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./LiveStreams.scss'</span>;
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'../../server/config/default'</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Navbar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(props) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">super</span>(props);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.state = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">live_streams</span>: []<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;componentDidMount() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.getLiveStreams();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;getLiveStreams() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axios.get(<span class="hljs-string">'http://127.0.0.1:'</span> + config.rtmp_server.http.port + <span class="hljs-string">'/api/streams'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> streams = res.data;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> (streams[<span class="hljs-string">'live'</span>] !== <span class="hljs-string">'undefined'</span>)) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.getStreamsInfo(streams[<span class="hljs-string">'live'</span>]);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;getStreamsInfo(live_streams) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axios.get(<span class="hljs-string">'/streams/info'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">params</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">streams</span>: live_streams<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">live_streams</span>: res.data<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, () =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.state);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;render() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> streams = <span class="hljs-keyword">this</span>.state.live_streams.map(<span class="hljs-function">(<span class="hljs-params">stream, index</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"stream col-xs-12 col-sm-12 col-md-3 col-lg-4"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"live-label"</span>&gt;</span>LIVE<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">stream</span>/' + <span class="hljs-attr">stream.username</span>}&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"stream-thumbnail"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">thumbnails</span>/' + <span class="hljs-attr">stream.stream_key</span> + '<span class="hljs-attr">.png</span>'}/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"username"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">stream</span>/' + <span class="hljs-attr">stream.username</span>}&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{stream.username}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Live Streams<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-4"</span>/&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"streams row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{streams}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚ŒãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒšãƒ¼ã‚¸ã®å¤–è¦³ã§ã™ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/333/69a/7c9/33369a7c9ecfa8e08ed4c9dee6419356.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</font></font><code>&lt;LiveStreams/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒ</font><font style="vertical-align: inherit;">ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸå¾Œã€</font><font style="vertical-align: inherit;">NMS APIãŒå‘¼ã³å‡ºã•ã‚Œã€ã‚·ã‚¹ãƒ†ãƒ ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆãŒå–å¾—ã•ã‚Œã¾ã™ã€‚ NMS APIã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹å¤šãã®æƒ…å ±ã‚’æä¾›ã—ã¾ã›ã‚“ã€‚ç‰¹ã«ã€ãã“ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒRTMPã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã™ã‚‹ã¨ãã«ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¡ã‚½ãƒƒãƒ‰ã§</font></font><code>getStreamsInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€XHRãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã«å®Ÿè¡Œã—ã¾ã™ãŒã€</font></font><code>/streams/info</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œç­”ã§ãã‚‹ã‚‚ã®ã¯ã¾ã ä½œæˆã—ã¦ã„ã¾ã›ã‚“ã€‚</font></font><code>server/routes/streams.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¬¡ã®å†…å®¹ã®</font><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«</font><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ä½œæˆã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;router = express.Router(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../database/Schema'</span>).User;<font></font>
&nbsp;<font></font>
router.get(<span class="hljs-string">'/info'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedIn(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, res) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(req.query.streams){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> streams = <span class="hljs-built_in">JSON</span>.parse(req.query.streams);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> query = {<span class="hljs-attr">$or</span>: []};
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> stream <span class="hljs-keyword">in</span> streams) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!streams.hasOwnProperty(stream)) <span class="hljs-keyword">continue</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.$or.push({<span class="hljs-attr">stream_key</span> : stream});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.find(query,(err, users) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (err)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (users) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.json(users);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;<font></font>
<span class="hljs-built_in">module</span>.exports = router;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ç¶šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€NMS APIã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ•ãƒ­ãƒ¼æƒ…å ±ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ¸¡ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ãŒNMS APIã‹ã‚‰å—ã‘å–ã£ãŸã‚‚ã®ã¨ä¸€è‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆã‚’JSONå½¢å¼ã§è¿”ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ«ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã—ã¾ã™</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="plaintext hljs">app.use('/streams', require('./routes/streams'));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®çµæœã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®ãƒªã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒªã‚¹ãƒˆã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚µãƒ ãƒã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">è¨˜äº‹ã®æœ€å¾Œã§ã€æ”¾é€ç”¨ã®ã‚µãƒ ãƒã‚¤ãƒ«ã®ä½œæˆæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚µãƒ ãƒã‚¤ãƒ«ã¯ã€video.jsã‚’ä½¿ç”¨ã—ã¦HLSã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒå†ç”Ÿã•ã‚Œã‚‹ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™</font></font><code>client/components/VideoPlayer.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> videojs <span class="hljs-keyword">from</span> <span class="hljs-string">'video.js'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'../../server/config/default'</span>;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VideoPlayer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(props) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">super</span>(props);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.state = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">videoJsOptions</span>: <span class="hljs-literal">null</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;componentDidMount() {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axios.get(<span class="hljs-string">'/user'</span>, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">params</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">username</span>: <span class="hljs-keyword">this</span>.props.match.params.username<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">videoJsOptions</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">autoplay</span>: <span class="hljs-literal">false</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">controls</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">sources</span>: [{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">src</span>: <span class="hljs-string">'http://127.0.0.1:'</span> + config.rtmp_server.http.port + <span class="hljs-string">'/live/'</span> + res.data.stream_key + <span class="hljs-string">'/index.m3u8'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">type</span>: <span class="hljs-string">'application/x-mpegURL'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">fluid</span>: <span class="hljs-literal">true</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, () =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.player = videojs(<span class="hljs-keyword">this</span>.videoNode, <span class="hljs-keyword">this</span>.state.videoJsOptions, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPlayerReady</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'onPlayerReady'</span>, <span class="hljs-keyword">this</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;componentWillUnmount() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.player) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.player.dispose()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;render() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-xs-12 col-sm-12 col-md-10 col-lg-8 mx-auto mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{this.state.stream ? (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">data-vjs-player</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{node</span> =&gt;</span> this.videoNode = node} className="video-js vjs-big-play-centered"/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) : ' Loading ... '}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã¨ã€video.jsãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã§HLSã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/684/b9e/7dc/684b9e7dcb9735092e54ccfc80e01be1.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ãƒ¼ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’è¡Œã†äºˆå®šã®äººã¸ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã®å•é¡Œ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™</font></font><code>client/components/Settings.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Navbar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">constructor</span>(props){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">super</span>(props);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.state = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span> : <span class="hljs-string">''</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.generateStreamKey = <span class="hljs-keyword">this</span>.generateStreamKey.bind(<span class="hljs-keyword">this</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;componentDidMount() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.getStreamKey();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;generateStreamKey(e){<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axios.post(<span class="hljs-string">'/settings/stream_key'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span> : res.data.stream_key<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;getStreamKey(){<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axios.get(<span class="hljs-string">'/settings/stream_key'</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.setState({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span> : res.data.stream_key<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;render() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.Fragment</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Streaming Key<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-4"</span>/&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-xs-12 col-sm-12 col-md-8 col-lg-6"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>{this.state.stream_key}<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">button</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">className</span>=<span class="hljs-string">"btn btn-dark mt-2"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.generateStreamKey}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generate a new key
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>How to Stream<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-4"</span>/&gt;</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-12"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You can use <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://obsproject.com/"</span>&gt;</span>OBS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> or
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.xsplit.com/"</span>&gt;</span>XSplit<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> to Live stream. If you're
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using OBS, go to Settings &gt; Stream and select Custom from service dropdown. Enter
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>rtmp://127.0.0.1:1935/live<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> in server input field. Also, add your stream key.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Click apply to save.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">React.Fragment</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
passport.jsã®ãƒ­ãƒ¼ã‚«ãƒ«æˆ¦ç•¥ã«å¾“ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚ŒãŸå ´åˆã¯ã€ä¸€æ„ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ«ãƒ¼ãƒˆ</font></font><code>/settings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã‚­ãƒ¼ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã¨ãã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®XHRãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’è¦‹ã¤ã‘ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«è¡¨ç¤ºã—ã¾ã™</font></font><code>&lt;Settings/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°ã—ã„ã‚­ãƒ¼ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™</font></font><code>Generate a new key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦XHRè¦æ±‚ãŒè¡Œã‚ã‚Œã€æ–°ã—ã„ã‚­ãƒ¼ãŒä½œæˆã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚­ãƒ¼ãŒä½œæˆã€ä¿å­˜ã€è¿”ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ–°ã—ã„ã‚­ãƒ¼ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä»•äº‹ã¸ã®ã“ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®ãŸã‚ã«-ç§ãŸã¡ã¯ã€ãƒ«ãƒ¼ãƒˆå®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font></font><code>GET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã€</font></font><code>POST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã‚ã«</font></font><code>/settings/stream_key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹</font></font><code>server/routes/settings.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã§ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;router = express.Router(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../database/Schema'</span>).User,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;shortid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'shortid'</span>);<font></font>
<font></font>
router.get(<span class="hljs-string">'/stream_key'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedIn(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, res) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.findOne({<span class="hljs-attr">email</span>: req.user.email}, (err, user) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!err) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.json({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span>: user.stream_key<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
<font></font>
router.post(<span class="hljs-string">'/stream_key'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-ensure-login'</span>).ensureLoggedIn(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;(req, res) =&gt; {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User.findOneAndUpdate({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">email</span>: req.user.email<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span>: shortid.generate()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">upsert</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, (err, user) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!err) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.json({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stream_key</span>: user.stream_key<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = router;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€æ„ã®æ–‡å­—åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€shortidãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã«æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’ç™»éŒ²</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">app.use(<span class="hljs-string">'/settings'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/settings'</span>));</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/192/f46/66b/192f4666b55c01b6540b8a9169849b77.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ãŒã‚­ãƒ¼ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒšãƒ¼ã‚¸</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</font></font><code>&lt;LiveStreams/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font><code>client/components/LiveStreams.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã§ã¯ã€ã‚¹ãƒˆãƒªãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã•ã‚Œã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã‚µãƒ ãƒã‚¤ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">render() {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> streams = <span class="hljs-keyword">this</span>.state.live_streams.map(<span class="hljs-function">(<span class="hljs-params">stream, index</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"stream col-xs-12 col-sm-12 col-md-3 col-lg-4"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"live-label"</span>&gt;</span>LIVE<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">stream</span>/' + <span class="hljs-attr">stream.username</span>}&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"stream-thumbnail"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">thumbnails</span>/' + <span class="hljs-attr">stream.stream_key</span> + '<span class="hljs-attr">.png</span>'}/&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"username"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>'/<span class="hljs-attr">stream</span>/' + <span class="hljs-attr">stream.username</span>}&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{stream.username}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mt-5"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Live Streams<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-4"</span>/&gt;</span>
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"streams row"</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{streams}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ã¨ãã«ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">5ç§’ã”ã¨ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã®æ–°ã—ã„ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹cronã‚¿ã‚¹ã‚¯ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã«è¿½åŠ ã—ã¾ã™</font></font><code>server/helpers/helpers.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> spawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).spawn,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/default'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;cmd = config.rtmp_server.trans.ffmpeg;<font></font>
<font></font>
<span class="hljs-keyword">const</span> generateStreamThumbnail = <span class="hljs-function">(<span class="hljs-params">stream_key</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> args = [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'-y'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'-i'</span>, <span class="hljs-string">'http://127.0.0.1:8888/live/'</span>+stream_key+<span class="hljs-string">'/index.m3u8'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'-ss'</span>, <span class="hljs-string">'00:00:01'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'-vframes'</span>, <span class="hljs-string">'1'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'-vf'</span>, <span class="hljs-string">'scale=-2:300'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">'server/thumbnails/'</span>+stream_key+<span class="hljs-string">'.png'</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;];<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;spawn(cmd, args, {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">stdio</span>: <span class="hljs-string">'ignore'</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}).unref();<font></font>
};<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">generateStreamThumbnail</span> : generateStreamThumbnail<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã—</font></font><code>generateStreamThumbnail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HLSã‚¹ãƒˆãƒªãƒ¼ãƒ ã«åŸºã¥ã„ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹åˆ¥ã®ffmpegãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™ã€‚</font></font><code>prePublish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ï¼ˆ</font></font><code>server/media_server.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã‚’</font><font style="vertical-align: inherit;">ç¢ºèªã—ãŸå¾Œ</font><font style="vertical-align: inherit;">ã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã“ã®è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">nms.on(<span class="hljs-string">'prePublish'</span>, <span class="hljs-keyword">async</span> (id, StreamPath, args) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> stream_key = getStreamKeyFromStreamPath(StreamPath);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[NodeEvent on prePublish]'</span>, <span class="hljs-string">`id=<span class="hljs-subst">${id}</span> StreamPath=<span class="hljs-subst">${StreamPath}</span> args=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(args)}</span>`</span>);<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;User.findOne({<span class="hljs-attr">stream_key</span>: stream_key}, (err, user) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!err) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!user) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> session = nms.getSession(id);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session.reject();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;helpers.generateStreamThumbnail(stream_key);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ–°ã—ã„ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€cronã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€ä¸Šè¨˜ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ</font></font><code>server/cron/thumbnails.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ã‚’å‘¼ã³å‡ºã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> CronJob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cron'</span>).CronJob,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../helpers/helpers'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/default'</span>),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;port = config.rtmp_server.http.port;<font></font>
<font></font>
<span class="hljs-keyword">const</span> job = <span class="hljs-keyword">new</span> CronJob(<span class="hljs-string">'*/5 * * * * *'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;request<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get(<span class="hljs-string">'http://127.0.0.1:'</span> + port + <span class="hljs-string">'/api/streams'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, response, body</span>) </span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> streams = <span class="hljs-built_in">JSON</span>.parse(body);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> (streams[<span class="hljs-string">'live'</span>] !== <span class="hljs-literal">undefined</span>)) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">let</span> live_streams = streams[<span class="hljs-string">'live'</span>];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> stream <span class="hljs-keyword">in</span> live_streams) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!live_streams.hasOwnProperty(stream)) <span class="hljs-keyword">continue</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;helpers.generateStreamThumbnail(stream);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
}, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<font></font>
<font></font>
<span class="hljs-built_in">module</span>.exports = job;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚¿ã‚¹ã‚¯ã¯5ç§’ã”ã¨ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">NMS APIã‹ã‚‰ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦å„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¿ã‚¹ã‚¯ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—</font></font><code>server/app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¦å‘¼ã³å‡ºã™</font><font style="vertical-align: inherit;">å¿…è¦ãŒã‚ã‚Šã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
 <br>
<pre><code class="javascript hljs"><span class="hljs-comment">//      app.js,</span>
<span class="hljs-keyword">const</span> thumbnail_generator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./cron/thumbnails'</span>);<font></font>
&nbsp;<font></font>
<span class="hljs-comment">//   start()   </span>
thumbnail_generator.start();</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¦‚è¦</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’æ•´ç†ã§ãã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹è©±ãŒçµ‚ã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãŠãã‚‰ãã€ã‚³ãƒ¼ãƒ‰ã®åˆ†æä¸­ã«ã€ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã®æ–­ç‰‡ãŒä¸å½“ã«å¿˜ã‚Œã‚‰ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç†è§£ã§ããªã„å•é¡Œã«ç›´é¢ã—ãŸå ´åˆã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªãƒã‚¸ãƒˆãƒªã‚’ã”è¦§ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã«ã‚¨ãƒ©ãƒ¼ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€è³‡æ–™ã®ä½œæˆè€…ã¯ãã®ã“ã¨ã‚’é€šçŸ¥ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã¾ã™ã€‚</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¢ã§ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª­è€…ã®çš†æ§˜ï¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è³‡æ–™ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒæ§˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºã«ã©ã®ã‚ˆã†ã«å–ã‚Šçµ„ã¿ã¾ã™ã‹ï¼Ÿ</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a09/9e4/5a8/a099e45a81c9dafd3a3673edd5ea415b.jpg"></div></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457846/index.html">å¥åº·è£½å“ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</a></li>
<li><a href="../ja457848/index.html">2019å¹´7æœˆã®ITåˆ†é‡ã®äººäº‹æ‹…å½“è€…å‘ã‘ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ</a></li>
<li><a href="../ja457850/index.html">ABBYY Roadã¯ã©ã“ã‚’ãƒªãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã‹</a></li>
<li><a href="../ja457852/index.html">åˆ†æï¼šç±³å›½å½“å±€ã¨ã®å•é¡ŒãŒãƒ•ã‚¡ãƒ¼ã‚¦ã‚§ã‚¤ã¨ITãƒ“ã‚¸ãƒã‚¹ã«ã©ã®ã‚ˆã†ã«å½±éŸ¿ã™ã‚‹ã‹</a></li>
<li><a href="../ja457854/index.html">80å¹´ä»£ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã‹ã‚‰ã“ã‚“ã«ã¡ã¯</a></li>
<li><a href="../ja457862/index.html">iOSãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆ8ï¼ˆ6æœˆ14æ—¥-6æœˆ27æ—¥ï¼‰</a></li>
<li><a href="../ja457864/index.html">ã‚·ã‚¹ãƒ†ãƒ åˆ†æã®ç¥è©±ã¨ä¼èª¬ã€ã¾ãŸã¯éŠ€è¡Œã®ã‚¢ãƒŠãƒªã‚¹ãƒˆãŒè¡Œã†ã“ã¨</a></li>
<li><a href="../ja457866/index.html">Laravelã§ã®å˜ä½“ãƒ†ã‚¹ãƒˆ</a></li>
<li><a href="../ja457870/index.html">Dockerã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£</a></li>
<li><a href="../ja457872/index.html">æ™‚é–“ã‚’ç®¡ç†ã—ã€å…ˆå»¶ã°ã—ã‚’ã‚„ã‚ã‚‹ã«ã¯ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>