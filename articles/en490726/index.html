<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😈 🕘 👉🏽 Authentication on network equipment through SSH using public keys 🚶🏽 🤙🏻 👩‍❤️‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By default, engineers connect to network equipment using a username and password. Using Telnet, user credentials are transmitted in clear text, and ov...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Authentication on network equipment through SSH using public keys</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/490726/"><img src="https://habrastorage.org/webt/ss/yc/-o/ssyc-oz7kbnxgw-o4rmrcit6gsg.jpeg" alt="Bunch of keys"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, engineers connect to network equipment using a username and password. </font><font style="vertical-align: inherit;">Using Telnet, user credentials are transmitted in clear text, and over SSH, in encrypted. </font><font style="vertical-align: inherit;">In order not to transmit the secret part over the network, public key authentication is used. </font><font style="vertical-align: inherit;">With this authentication, the user's public key is pre-assigned to the user on the equipment. </font><font style="vertical-align: inherit;">The private key is not transmitted over the network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This guide will help you quickly start using public keys for authentication when connecting to network equipment using the SSH protocol. </font><font style="vertical-align: inherit;">The guide is applicable for both Windows and Mac OS X. I tried to make it as simple and informative as possible. </font><font style="vertical-align: inherit;">It is not overloaded, but answers the basic questions:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to get the public key and how to use it?</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">         ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">           ?</a></li>
</ul><br>
<a name="habracut"></a><br>
<h2></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  RSA-</a><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> RSA-  SecureCRT</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> RSA-  PuTTYgen</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> RSA-   Putty Private Key (PuTTY)   OpenSSH (SecureCRT)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> RSA-   VanDyke Private Key (SecureCRT)   Putty Private Key (PuTTY)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    MAC OS X   </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Cisco IOS XE, Catalyst (  15.1  ), IOS</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Cisco ASA</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">   Huawei</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Huawei USG (6000)</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Cisco Nexus 9.3</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">      SSH</a><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">SecureCRT</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">PuTTY</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">MAC OS X</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">    SSH  MAC OS X:</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I also examined the "sore" topics:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Key conversion between OpenSSH &lt;==&gt; SecureCRT &lt;==&gt; PuTTY.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using different pairs of public keys for different equipment. </font><font style="vertical-align: inherit;">One key is good, but not applicable in reality. </font><font style="vertical-align: inherit;">Different customers or equipment require different pairs of public keys (some with a password, others without).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using the native (native) MAC OS X to work with public keys.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The guide should also help use Ansible with network equipment, since Ansible uses OpenSSH with public key authentication by default.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
90% of the material presented is tested on real equipment.</font></font><br>
<br>
<a name="Introduction"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to standard password authentication (password / keyboard) in the SSH protocol, there is also public key authentication (RSA).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For reference</font></font></b><div class="spoiler_text">RSA (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">https://ru.wikipedia.org/wiki/RSA</a>) —     .     (public key)     (private key).        :            .         .         ,       ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Authentication using RSA keys consists of several steps: </font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a pair of RSA keys.</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installing a public key on equipment.</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting to equipment and authentication using an RSA key.</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why only RSA? </font><font style="vertical-align: inherit;">Why not a DSA? </font><font style="vertical-align: inherit;">Unfortunately, I did not find the answer to this question (and did not really look for it). </font><font style="vertical-align: inherit;">But officially, only RSA is supported on Cisco equipment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secure Shell Configuration Guide, Cisco IOS Release 15E:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure Shell Configuration Guide, Cisco IOS Release 15E </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Restrictions for Secure Shell Version 2 Support </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rivest, Shamir, and Adleman (RSA) key generation is an SSH server-side requirement. </font><font style="vertical-align: inherit;">Devices that act as SSH clients need not generate RSA keys.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Attempting to enter DSA key data:</font></font><br>
<br>
<pre><code class="plaintext hljs">CSR-1(conf-ssh-pubkey-data)#exit<font></font>
%SSH: Only ssh-rsa type is supported<font></font>
CSR-1(conf-ssh-pubkey-user)#<font></font>
</code></pre><br>
<a name="CreatePublicKey"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a public RSA key</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pair of RSA keys can be created using various utilities: SecureCRT, PuTTYgen or any other software. </font><font style="vertical-align: inherit;">When creating a key, you can set Passphrase (password protection with a key).</font></font><br>
<br>
<a name="CreatePublicKeySecureCRT"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA pair generation in SecureCRT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SecureCRT -&gt; Tools -&gt; Create Public Key ...:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2m/xb/eb/2mxbeb3d8sc8thocdojacrzizn4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bit of theory → the “Next&gt;” button:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/ii/ze/wviize2n_5dkko4v4kpyxkkwzty.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Type of RSA / DSA certificate → Select RSA → “Next&gt;” button:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rs/le/ni/rslenitclgxtobzvsz_ulj39q_c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encryption password for the secret key (optional, you can leave it blank and not encrypt) + Comment → “Next&gt;” button:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/q7/_q/5v/q7_q5vwtmmpbeszmxkizeuznul4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choose the key length (in SecureCRT version 6.1.0 the maximum key length is 2048 bits, in version 8.5.4 - 16 384 bits):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/q5/qm/zg/q5qmzgg_hzzlyg_q0qvobcddkd4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Key </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
generation </font><font style="vertical-align: inherit;">→ “Next&gt;” button: </font><font style="vertical-align: inherit;">To generate random numbers, you need to move the mouse within the window.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wf/w8/dh/wfw8dhn0tsfuj8nkdfprxdsjpxk.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aw/yj/cs/awyjcsqvlbd_6tapahm4twq8kj4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saving a key pair → Selecting a storage location → Selecting a format for a saved key (VanDuke Private format, OpenSSH legacy, OpenSSH new) → “Finish” button: </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9n/ts/3s/9nts3s5p5bnfiz14nwmlo59eva4.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/pw/dv/kqpwdvana4ytrh1wjrzbdtjegzu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SecureCRT asks whether to make this key the default key for SecureCRT:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zl/pa/iv/zlpaiv_a3gr6noc5hppfx-1vpoq.png"></div><br>
<a name="CreatePublicKeyPuttygen"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSA pair generation in PuTTYgen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can download PuTTYgen here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Launch PuTTYgen:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_l/wi/fo/_lwifoh8tblsbyjqqft_7ooyofu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Select the parameters (pair type: RSA; key bit dimension: 2048; optionally set Passphrase (password protection with a password)) → Generate:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/dw/d0/b3dwd0xoppidkvcjqwzont-kxj0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To guarantee random numbers, he asks to move the mouse within the window. </font><font style="vertical-align: inherit;">This is a protection against pseudo random numbers.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/0a/vq/ee0avqbadgo1s4r8ir21kchtuoa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Save RSA keys → “Save private key” button:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fp/l-/qa/fpl-qavfk_rncnkpey7leotfaqe.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note: RSA keys stored in a private format in one software cannot be used in software of another manufacturer. </font><font style="vertical-align: inherit;">That is, a pair of RSA keys created in PuTTYgen and saved in Putty Private Key format is not suitable for use in SecureCRT, and vice versa. </font><font style="vertical-align: inherit;">PuTTY only supports the Putty Private Key format. </font><font style="vertical-align: inherit;">A universal solution for distributing keys is to convert keys to OpenSSH format (See link 2: “Conversion from Putty to SecureCRT with auth. Keys”). </font><font style="vertical-align: inherit;">Since SecureCRT works freely with the OpenSSH format. </font><font style="vertical-align: inherit;">And PuTTYgen software converts the OpenSSH format into the Putty Private Key format.</font></font><br>
<br>
<a name="ConvertPPKtoOpenSSH"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Converting an RSA key from Putty Private Key (PuTTY) format to OpenSSH (SecureCRT) format</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to use RSA keys in SecureCRT that are generated in PuTTYgen and saved in Putty Private Key format (* .ppk), we export them using PuTTYgen in OpenSSH format:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch PuTTYgen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We load the existing RSA key in the Putty Private Key format (* .ppk) → The “Load” button.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save the public key file → “Save public key”.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We export the secret key to the OpenSSH format: menu PuTTYgen → “Conversions” → “Export OpenSSH key”.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We use OpenSSH files in SecureCRT. </font><font style="vertical-align: inherit;">The file with the public key has the extension .pub, the file with the private key has no extension.</font></font></li>
</ol><br>
<a name="ConvertVanDykePrivateKeyToPPK"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Converting an RSA key from VanDyke Private Key (SecureCRT) format to Putty Private Key (PuTTY) format</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To use RSA keys in PuTTY that are generated in SecureCRT and saved in the VanDyke Private Key format (public key file * .pub, secret key file *. (Without extension)), export them using SecureCRT to OpenSSH format, and then using PuTTYgen we export to Putty Private Key (* .ppk) format:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch SecureCRT.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu “Tools” → “Convert Private Key to OpenSSH format ...”</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select the source file with the VanDyke Private Key keys.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We save OpenSSH keys with a new name.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch PuTTYgen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We load the existing RSA-key in the OpenSSH format (*.): PuTTYgen Menu → “Conversions” → “Import key”.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save the file in Putty format: “Save private key”.</font></font></li>
</ol><br>
<a name="CreatePublicKeyMacOSX"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generating public keys on MAC OS X using the operating system</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will use the built-in ssh-keygen utility (man ssh-keygen). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We generate an RSA key with a length of 2048 bits with the key name, the path to the folder with the key storage location:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh-keygen -b 2048 -t rsa -c "Lab router R4" -f /Users/ArtemiySP/Documents/python/r4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At run time, the program will ask for a password to protect the RSA key:</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 2048 -t rsa -C "Lab router R4" -f /Users/ArtemiySP/Documents/python/r4<font></font>
Generating public/private rsa key pair.<font></font>
Enter passphrase (empty for no passphrase): <font></font>
Enter same passphrase again: <font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r4.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r4.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:WdT47SFvgGI7danxX94p8/cO3uyU12SB3ipkc7nHxzA Lab router R4<font></font>
The key's randomart image is:<font></font>
+---[RSA 2048]----+<font></font>
|          .o     |<font></font>
|         .. . .  |<font></font>
|          .o + . |<font></font>
|        oo+ B = .|<font></font>
|       .S+ O OEoo|<font></font>
|        o + + B*+|<font></font>
|         . . =.*O|<font></font>
|            .+o**|<font></font>
|              =+O|<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We generate an RSA key with a length of 4096 bits in indicating the name of the key, path to the folder with the key storage location, set the password explicitly in the key generation parameters (-N "cisco"):</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 4096 -t rsa -C "Lab router R5" -N "cisco" -f /Users/ArtemiySP/Documents/python/r5<font></font>
Generating public/private rsa key pair.<font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r5.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r5.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:NraLRMqB4qmA8qNjKdpBBt1JBw8Osf/3GfuB2k1R+zY Lab router R5<font></font>
The key's randomart image is:<font></font>
+---[RSA 4096]----+<font></font>
|  o.+..          |<font></font>
| . * =           |<font></font>
|. o + .       .  |<font></font>
| . o         . . |<font></font>
|. + o . S   . .  |<font></font>
|o+.. = o o . . . |<font></font>
|+oo o o o o o  Eo|<font></font>
|*=.. . o = * . ..|<font></font>
|Boo.  . o =.o    |<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Key generation parameters that are not recommended: an unreliable key with a length of 1024 bits, specifying the key name, the path to the folder with the key storage location, we set the password explicitly in the key generation parameters (-N "" - without password):</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Downloads ArtemiySP$ ssh-keygen -b 1024 -t rsa -C "Lab router R6" -N "" -f /Users/ArtemiySP/Documents/python/r6<font></font>
Generating public/private rsa key pair.<font></font>
Your identification has been saved in /Users/ArtemiySP/Documents/python/r6.<font></font>
Your public key has been saved in /Users/ArtemiySP/Documents/python/r6.pub.<font></font>
The key fingerprint is:<font></font>
SHA256:LEcfgN+58TYMDv4MpBA2FGCWc2aFiY+SxWBf7pRViWs Lab router R6<font></font>
The key's randomart image is:<font></font>
+---[RSA 1024]----+<font></font>
|.++=o*.o+..      |<font></font>
|.oB % +. o       |<font></font>
| o X * .o...     |<font></font>
|o . =  E+.=.     |<font></font>
| .   oo+So.*     |<font></font>
|      .oo o =    |<font></font>
|         + . .   |<font></font>
|          o      |<font></font>
|                 |<font></font>
+----[SHA256]-----+<font></font>
artemiy-2:Downloads ArtemiySP$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, we created three keys in with the names of the keys and the location of the keys (by default, all keys are stored in /Users/[Username 022/.ssh). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, when connecting via SSH with authentication by public key, all public keys are stored in sequence, which are stored in the /Users/[Username†/.ssh folder. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R6 key: rename the key to “id_rsa” (by default the name of the generated key file is “id_rsa”) and transfer it to the folder with SSH keys (~ / .ssh /) (i.e., we will perform all the steps so that the R6 key is used as the main default SSH connection key): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Convert the public OpenSSH key to RFC4716 format (export to Cisco IOS):</font></font><br>
<br>
<pre><code class="plaintext hljs">https://serverfault.com/questions/706336/how-to-get-a-pem-file-from-ssh-key-pair<font></font>
ssh-keygen -f ~/Documents/python/r4.pub -e -m RFC4716<font></font>
ssh-keygen -f ~/Documents/python/r5.pub -e -m RFC4716<font></font>
ssh-keygen -f ~/.ssh/id_rsa.pub -e -m RFC4716<font></font>
</code></pre><br>
<a name="ConfigureKeyAtHardware"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using a public key on equipment</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How on various equipment to bind a public key to a user? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The process of binding a public key to a user is not standard and varies from equipment to equipment, therefore, examples are given for each type of equipment that is most often used on the network.</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareCiscoIOS"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco IOS XE, Catalyst (from version 15.1 and higher), IOS </font></font></h3><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is already a user on the device.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the SSH settings (ip ssh pubkey-chain) for the user (username cisco), specify the public key (key-string):</font></font><br>
<pre><code class="plaintext hljs">CSR-1#conf t<font></font>
Enter configuration commands, one per line.  End with CNTL/Z.<font></font>
CSR-1(config)#ip ssh pubkey-chain <font></font>
CSR-1(conf-ssh-pubkey)#username ssh-putty<font></font>
CSR-1(conf-ssh-pubkey-user)#key-string <font></font>
CSR-1(conf-ssh-pubkey-data)#$QAAAQEAnPbynT1+2rjlyqP4viSPdTVDFLSHzWjJnAwy     <font></font>
CSR-1(conf-ssh-pubkey-data)#$NCfaqvMTPruCgG5096q8lO0ntURmNgmfMEQPOgb8weF     <font></font>
CSR-1(conf-ssh-pubkey-data)#$AtMQYk7WFM+5iBnOQ32UAHNavCUA7YFEpAdOQO4W/qB     <font></font>
CSR-1(conf-ssh-pubkey-data)#$SlOLy+PQ47jDUINBnuUeHd8ZXyzXxWglzSvqtwMEXBW     <font></font>
CSR-1(conf-ssh-pubkey-data)#$VoUTBYbJ45DmFa93P50qf494ujaAsTbYyJ/GBzJUTK/     <font></font>
CSR-1(conf-ssh-pubkey-data)#$UADAkNGxQARfOfHZWiIYb3rif6h6hfwwVUZS/Tw==       <font></font>
CSR-1(conf-ssh-pubkey-data)#exit<font></font>
CSR-1(conf-ssh-pubkey-user)#exit<font></font>
CSR-1(conf-ssh-pubkey)#exit<font></font>
CSR-1(config)#exit<font></font>
CSR-1#exit<font></font>
<font></font>
CSR-1#show running-config | inc ssh<font></font>
username ssh-public-key secret 5 $1$ebjc$EYgwMFQXPPiywFVn6rl7t.<font></font>
username ssh-putty privilege 15 secret 5 $1$vIhh$nM8iCeBKmLyVK4hA6./h4.<font></font>
ip ssh pubkey-chain<font></font>
   key-hash ssh-rsa D4E9AD62F7F6265EAAB3FB8778477612<font></font>
  username ssh-public-key<font></font>
   key-hash ssh-rsa C331DEE821A84681A4A7B1862C100D16<font></font>
  username ssh-putty<font></font>
   key-hash ssh-rsa F32BEB60290EA75D151447C0D42D2A99<font></font>
   key-hash ssh-rsa 5432C275B363B646E02D3BA7E8D865B7<font></font>
CSR-1#<font></font>
</code></pre></li>
</ol><br>
<a name="ConfigureKeyAtHardwareCiscoASA"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco ASA</font></font></h3><br>
<pre><code class="plaintext hljs">LAB-ASA5516-X-01/pri/act# conf t<font></font>
LAB-ASA5516-X-01/pri/act(config)# username artemiy password artemiy privilege $<font></font>
LAB-ASA5516-X-01/pri/act(config)# username artemiy attributes <font></font>
LAB-ASA5516-X-01/pri/act(config-username)# ssh authentication publickey ?<font></font>
<font></font>
username mode commands/options:<font></font>
  WORD  Raw SSH-RSA public key<font></font>
LAB-ASA5516-X-01/pri/act(config-username)# ssh authentication publickey AAAAB3$<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We insert the whole key in one line (OpenSSH format).</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareHuaweiRouter"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei routers and switches</font></font></h3><br>
<pre><code class="plaintext hljs">[R1]rsa peer-public-key test-key1 encoding-type pem <font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
NOTE: The number of the bits of public key must be between 769 and 2048.<font></font>
[R1-rsa-public-key]public-key-code begin <font></font>
Enter "RSA key code" view, return last view with "public-key-code end".<font></font>
[R1-rsa-key-code]---- BEGIN SSH2 PUBLIC KEY ----<font></font>
[R1-rsa-key-code]Subject: Subject<font></font>
[R1-rsa-key-code]Comment: " Subject@Subject.local"<font></font>
[R1-rsa-key-code]ModBitSize: 2048<font></font>
[R1-rsa-key-code]AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
[R1-rsa-key-code]lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
[R1-rsa-key-code]63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
[R1-rsa-key-code]2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
[R1-rsa-key-code]yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
[R1-rsa-key-code]VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
[R1-rsa-key-code]---- END SSH2 PUBLIC KEY ----<font></font>
[R1-rsa-key-code]public-key-code end<font></font>
[R1-rsa-public-key]peer-public-key end <font></font>
[R1]display rsa peer-public-key <font></font>
<font></font>
=====================================<font></font>
    Key name: test-key1<font></font>
=====================================<font></font>
Key Code:<font></font>
---- BEGIN SSH2 PUBLIC KEY ----<font></font>
AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
---- END SSH2 PUBLIC KEY ----<font></font>
aaa<font></font>
local-user jet privilege level 15<font></font>
 local-user jet service-type telnet terminal ssh http<font></font>
ssh user jet assign rsa-key test-key1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Types of key formats imported to Huawei: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“The SecureCRT and PuTTY generate RSA keys in PEM format.”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“The OpenSSH generates RSA keys in OpenSSH format.”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type openssh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“The OpenSSL generates RSA keys in DER format.”</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1 encoding-type der</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The default is in hexadecimal:</font></font><br>
<br>
<pre><code class="plaintext hljs">rsa peer-public-key test-key1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: Huawei equipment not only supports keys in RSA format, but also other formats:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh user user-name assign { rsa-key | dsa-key | ecc-key } key-name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can rigidly set the authentication type for the user over SSH:</font></font><br>
<br>
<pre><code class="plaintext hljs">[R1]ssh user jet authentication-type ?<font></font>
  all           All authentication, password,RSA or ECC<font></font>
  ecc           ECC authentication<font></font>
  password      Password authentication<font></font>
  password-ecc  Both password and ECC<font></font>
  password-rsa  Both password and RSA<font></font>
  rsa           RSA authentication<font></font>
[R1]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That is, we allow access using either a password, or public and private keys, or both.</font></font><br>
<br>
<a name="ConfigureKeyAtHardwareHuaweiUSG"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei USG (6000)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The configuration is completely similar to the settings on the router, but has some features. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By default, the privilege level after logging using certificates is 0 and cannot be elevated. </font><font style="vertical-align: inherit;">Therefore, the priority level is set using</font></font><br>
<br>
<pre><code class="plaintext hljs">user-interface vty 0 4 <font></font>
user privilege level 15<font></font>
user-interface vty 16 20:<font></font>
user privilege level 15<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example:</font></font><br>
<br>
<pre><code class="plaintext hljs">[USG-a]rsa peer-public-key test-key1 encoding-type pem <font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
[USG-a-rsa-public-key]public-key-code begin<font></font>
Enter "RSA key code" view, return last view with "public-key-code end".<font></font>
[USG-a-rsa-key-code]---- BEGIN SSH2 PUBLIC KEY ----<font></font>
[USG-a-rsa-key-code]Subject: subject<font></font>
[USG-a-rsa-key-code]Comment: " subject@subject.local"<font></font>
[USG-a-rsa-key-code]ModBitSize: 2048<font></font>
[USG-a-rsa-key-code]AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnx<font></font>
[USG-a-rsa-key-code]lTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof<font></font>
[USG-a-rsa-key-code]63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK<font></font>
[USG-a-rsa-key-code]2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZa<font></font>
[USG-a-rsa-key-code]yI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTP<font></font>
[USG-a-rsa-key-code]VdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
[USG-a-rsa-key-code]---- END SSH2 PUBLIC KEY ----<font></font>
[USG-a-rsa-key-code]public-key-code end<font></font>
[USG-a-rsa-public-key]peer-public-key end<font></font>
[USG-a]<font></font>
[USG-a]ssh user admin assign rsa-key test-key1<font></font>
! Out-of-band management interface:<font></font>
[USG-a-GigabitEthernet0/0/0]service-manage ssh permit<font></font>
! Grant user level 15 privillege:<font></font>
[USG-a]user-interface vty 0 4<font></font>
[USG-a-ui-vty0-4]user privilege level 15<font></font>
</code></pre><br>
<a name="ConfigureKeyAtHardwareCiscoNexus"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco Nexus 9.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Option 1: pre-install the public key file on the device and attach the public key file to the user.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copy the public key file to the device.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We instruct the user to use the public key file.</font></font></li>
</ul><br>
<pre><code class="plaintext hljs">switch# copy tftp://10.10.1.1/secsh_file.pub bootflash:secsh_file.pub<font></font>
username User1 sshkey file bootflash:secsh_file.pub<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Option 2: copy the public key to the user:</font></font><br>
<br>
<pre><code class="plaintext hljs">username User1 sshkey<font></font>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4YLFhPqfsz4a6PUpZOtvm6zGn5TWOVMnxlTH5hr/u+aYnoM2XnDTu4Ul1iB8MMPLVKXzV4LgYhaFcU1rz2/yYhTKIwbiQTHof63fJjyWwkvyBuVZTSKh4b2pfoF2mXgdJzzRmUaiRrZZUVJWsX+CbgtKQuktG7sTK2eguHwdfhilbOAsUaL0/q39Y0aTAMnLMtn0m5r6MD/UopQPI3Fxm1L9azJ7zYIZayI43Solg0AOupPl8FHFI9Cxq81/uZRACx5lAyuObaQ4/t1Rdh3CAJj1qwfZjZFTPVdJxwTDxwfkpOzMD193M0ThOSrgfWe336Q9F3jbSWrEYUQDX8ew7<font></font>
</code></pre><br>
<a name="ConfigureSoftwareToUsePublicKey"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using a secret key for SSH connection</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This section is devoted to configuring SSH clients for authentication using RSA keys on network equipment (or other equipment, provided that the hardware and software supports public key authentication). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will consider setting up the use of the public key in the most popular programs: SecureCRT and PuTTY.</font></font><br>
<br>
<a name="ConfigureSoftwareToUsePublicKeySecureCRT"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecureCRT</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is an Authentication list in the SSH settings window. </font><font style="vertical-align: inherit;">In it, you need to increase the priority of PublicKey to the highest - make it top in the list.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/l-/ke/z4/l-kez4rg6qpuyslsuv3nmt_dti4.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xi/jh/ah/xijhahjlx-hq9m52ugqyih0qrwi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then go to the PublicKey options and select the private key file. </font><font style="vertical-align: inherit;">The topmost switch allows you to use the global settings of the secret key or session settings - another secret key (non-default key) - only for this connection.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ub/js/xd/ubjsxdlmflzod5cfguosfwuqiqi.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/og/pv/ys/ogpvysr3cvrk7aliad5qxeg3jp0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configure the global public key: in the menu Options → Global options → Category SSH2.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0m/yd/dg/0myddgh9flvk10qrh8pixuphke8.png"></div><br>
<a name="ConfigureSoftwareToUsePublicKeyPutty"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PuTTY</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the SSH settings (Connection → SSH → Auth) in the field “Private key file for authentication” specify the file Putty Private Key (* .ppk):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/wu/tp/xmwutpoyrfibggfiqssajegtyq0.png"></div><br>
<a name="ConfigureSoftwareToUsePublicKeyMacOSX"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC OS X</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setting up a standard client for using public keys:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connection with a non-default key specified manually:</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r4@10.31.73.29 -i ~/Documents/python/r4<font></font>
The authenticity of host '10.31.73.29 (10.31.73.29)' can't be established.<font></font>
RSA key fingerprint is SHA256:fxOLFKU6YGyIqisrIh2P0O52Rr6Wx/wsSAcHsTz8fo0.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.29' (RSA) to the list of known hosts.<font></font>
CSR-4#<font></font>
</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connection with a non-default key specified manually:</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r5@10.31.73.30 -i ~/Documents/python/r5<font></font>
The authenticity of host '10.31.73.30 (10.31.73.30)' can't be established.<font></font>
RSA key fingerprint is SHA256:4l67C4Il4pTaqYT4vrtWr0aY7rPmNWKsjRv2zlYtQIU.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.30' (RSA) to the list of known hosts.<font></font>
MGTU#exit<font></font>
Connection to 10.31.73.30 closed.<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example Error</font></font></b><div class="spoiler_text">        —      .     MAC OS X —     .<br>
</div></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connection with the default key (default key - the system itself will find and use the Default public key):</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:~ ArtemiySP$ ssh r6@10.31.73.31<font></font>
The authenticity of host '10.31.73.31 (10.31.73.31)' can't be established.<font></font>
RSA key fingerprint is SHA256:2/ysACJQw48Q8S45ody4wna+6nJspcsEU558HiUN43Q.<font></font>
Are you sure you want to continue connecting (yes/no)? yes<font></font>
Warning: Permanently added '10.31.73.31' (RSA) to the list of known hosts.<font></font>
PR#exit<font></font>
Connection to 10.31.73.31 closed.<font></font>
artemiy-2:~ ArtemiySP$ <font></font>
</code></pre></li>
</ul><br>
<a name="MacOSXUseSSH"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to simplify working with SSH on MAC OS X:</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create SSH Aliases.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In SSH Aliases, we immediately set the users.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediately register the location of the keys.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The location of Aliases and the pre-configured SSH configuration are specified in the ~ / .ssh / config file (/Users/[Username†/.ssh/config). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Filled in this way:</font></font><br>
<br>
<pre><code class="plaintext hljs">host r4<font></font>
   Hostname 10.31.73.29<font></font>
   Port 22<font></font>
   User r4<font></font>
   IdentityFile ~/Documents/python/r4<font></font>
<font></font>
host r5<font></font>
   Hostname 10.31.73.30<font></font>
   Port 22<font></font>
   User r5<font></font>
   IdentityFile ~/Documents/python/r5<font></font>
<font></font>
host r6<font></font>
   Hostname 10.31.73.31<font></font>
   Port 22<font></font>
   User r6<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note: my default connection is incorrectly configured (I don’t know how correctly), because the connection to the R6 host (10.31.73.31) takes a very long time. </font><font style="vertical-align: inherit;">It is recommended that you specify immediately specify the path to the default key. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example of an ssh connection using public keys and a config file:</font></font><br>
<br>
<pre><code class="plaintext hljs">artemiy-2:Documents ArtemiySP$ ssh r5<font></font>
MGTU#exit<font></font>
Connection to 10.31.73.30 closed by remote host.<font></font>
Connection to 10.31.73.30 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r4<font></font>
CSR-4#exit<font></font>
Connection to 10.31.73.29 closed by remote host.<font></font>
Connection to 10.31.73.29 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r6<font></font>
PR#exit<font></font>
Connection to 10.31.73.31 closed.<font></font>
artemiy-2:Documents ArtemiySP$ ssh r6<font></font>
PR#<font></font>
</code></pre><br>
<a name="finale"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RSA keys can be used to replace password authentication, but not in all cases:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public key authentication is not possible if domain authentication is configured (because LDAP requests (kerberos) to the server are proxied for authentication).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public key authentication on old network equipment is not possible (example: failed to configure on Cisco Catalyst 2960 with firmware 12.2).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Password-protected public keys are conveniently used in bench equipment. Disadvantage: it is necessary to send a bunch of private and public keys to colleagues and partners. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On some equipment, several pairs of public keys can correspond to one user, on other equipment only one public key corresponds to one user. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are also different formats in which a pair of public and private keys is stored. But this guide will help you export keys in different formats. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, it is optimal to use keys with a length of 2048 bits, but for some equipment this is the maximum possible key length (maybe this will be fixed in new firmware). For instance:</font></font><br>
<br>
<pre><code class="plaintext hljs">[R1]rsa peer-public-key test-key2 encoding-type pem<font></font>
Enter "RSA public key" view, return system view with "peer-public-key end".<font></font>
NOTE: The number of the bits of public key must be between 769 and 2048.<font></font>
[R1-rsa-public-key]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is recommended to use public keys to replace passwords if passwords are entered using scripts (example: autologon in SecureCRT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is recommended that you use public keys to protect against password transmission over the network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Some software uses public keys by default for SSH authentication instead of a password (example: Ansible).</font></font><br>
<br>
<a name="ListOfSources"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of sources:</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wikipedia RSA</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conversion from Putty to SecureCRT with auth. </font><font style="vertical-align: inherit;">keys, SecureCRT Forum</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure Shell Configuration Guide, Cisco IOS Release 15E</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download PuTTYgen</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a description of the various key formats for importing to a Huawei router</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huawei USG 6000, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring Public Key Authentication</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (CLI: Example for Logging In to the CLI Using STelnet (RSA Authentication))</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Nexus 9000 Configuration guide SSH public key</a></li>
<li>man ssh-keygen —      mac os x.</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">SSH config file  MAC OS X</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">       SSH</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">       SSH config</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  openssh public key   RFC4716</a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490714/index.html">How to get 100 thousand per code. Complete Beginner's Guide</a></li>
<li><a href="../en490716/index.html">How to ensure high-quality operation of the local network of a small enterprise?</a></li>
<li><a href="../en490718/index.html">What is the "clean code" in 2020?</a></li>
<li><a href="../en490720/index.html">Motor! or What is game physics</a></li>
<li><a href="../en490722/index.html">Gender holidays in IT. How to note</a></li>
<li><a href="../en490728/index.html">Security Week 10: RSA Conference and Cybersecurity Awareness</a></li>
<li><a href="../en490730/index.html">Intel x86 Root of Trust: loss of trust</a></li>
<li><a href="../en490732/index.html">Speech Recognition: A Very Short Introductory Course</a></li>
<li><a href="../en490734/index.html">Easter eggs on topographic maps of Switzerland</a></li>
<li><a href="../en490736/index.html">9 clear tools for learning and pumping English vocabulary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>