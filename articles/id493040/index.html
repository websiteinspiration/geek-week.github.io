<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•´ğŸ¿ ğŸ¤¸ğŸ½ ğŸ¦” Bilah gulir yang gagal ğŸŒ¾ ğŸ¤šğŸ¿ ğŸ¤ŸğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini merilis versi baru Terminal Windows. Semuanya akan baik-baik saja, tetapi kinerja bilah gulirnya meninggalkan banyak yang harus diingink...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bilah gulir yang gagal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/493040/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b6/xe/uj/b6xeuj-pps_cnuo5ky22sr0yl5o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini merilis versi baru Terminal Windows. </font><font style="vertical-align: inherit;">Semuanya akan baik-baik saja, tetapi kinerja bilah gulirnya meninggalkan banyak yang harus diinginkan. </font><font style="vertical-align: inherit;">Karena itu, sekarang saatnya untuk menempelkan sedikit tongkat padanya dan memainkan rebana.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang biasanya dilakukan pengguna dengan versi baru aplikasi apa pun? </font><font style="vertical-align: inherit;">Itu benar, apa yang tidak dilakukan oleh penguji. </font><font style="vertical-align: inherit;">Karena itu, setelah menggunakan terminal secara singkat untuk tujuan yang dimaksudkan, saya mulai melakukan hal-hal buruk dengannya. </font><font style="vertical-align: inherit;">Baiklah, baiklah, saya baru saja menumpahkan kopi di keyboard dan tanpa sengaja menjepit &lt;Enter&gt; ketika saya menyeka. </font><font style="vertical-align: inherit;">Apa yang terjadi pada akhirnya?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/tq/ev/at/tqevatebkqh9qhtc7meqb8gd9y8.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, sepertinya tidak terlalu mengesankan, tapi jangan buru-buru melempari saya dengan batu. </font><font style="vertical-align: inherit;">Perhatikan sisi kanan. </font><font style="vertical-align: inherit;">Pertama-tama cobalah mencari tahu apa yang salah dengannya. </font><font style="vertical-align: inherit;">Berikut screenshot untuk sebuah petunjuk:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/33/g5/nz/33g5nz7ix7fpgot21hpt-flsw0m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, judul artikel itu adalah spoiler yang serius. :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, ada masalah dengan scrollbar. Pindah ke baris baru berkali-kali, setelah melewati batas bawah, Anda biasanya mengharapkan bilah gulir muncul, dan Anda dapat menggulir ke atas. Namun, ini tidak terjadi sampai kita menulis perintah dengan output dari sesuatu. Anggap saja tingkah lakunya aneh. Namun, ini mungkin tidak terlalu kritis jika scrollbar berfungsi ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah diuji sedikit, saya menemukan bahwa beralih ke baris baru tidak meningkatkan buffer. Ini hanya membuat output dari perintah. Jadi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami di</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atas </font><font style="vertical-align: inherit;">akan meningkatkan buffer hanya dengan satu baris. Karena itu, lama kelamaan kita akan kehilangan banyak sejarah, terutama setelah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jelas.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal pertama yang muncul di benak saya adalah menggunakan penganalisa kami dan melihat apa yang dikatakannya:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/hf/dt/op/hfdtop2yyl-2hnm0fdzu2bg6jmo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesimpulannya, tentu saja, dari ukuran yang mengesankan, jadi saya akan mengambil keuntungan dari kekuatan pemfilteran dan memotong segala sesuatu kecuali yang mengandung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ScrollBar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/kb/k9/nh/kbk9nhstx9w90yxa5q8sm542fvk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak bisa mengatakan bahwa ada banyak pesan ... Ya, mungkin kemudian ada sesuatu yang terkait dengan buffer?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/js/ym/u0/jsymu0ehvgbwmldkhi30tkr8duw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penganalisa tidak gagal dan menemukan sesuatu yang menarik. </font><font style="vertical-align: inherit;">Saya menyoroti peringatan ini di atas. </font><font style="vertical-align: inherit;">Mari kita lihat apa yang salah di sana: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ada sub-ekspresi identik ke kiri dan ke kanan operator '-': bufferHeight - bufferHeight TermControl.cpp 592</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> TermControl::_InitializeTerminal()<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">auto</span> bottom = _terminal-&gt;GetViewport().BottomExclusive();
  <span class="hljs-keyword">auto</span> bufferHeight = bottom;<font></font>
<font></font>
  ScrollBar().Maximum(bufferHeight - bufferHeight); <span class="hljs-comment">// &lt;=  </span>
  ScrollBar().Minimum(<span class="hljs-number">0</span>);<font></font>
  ScrollBar().Value(<span class="hljs-number">0</span>);<font></font>
  ScrollBar().ViewportSize(bufferHeight);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini disertai dengan komentar: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Siapkan ketinggian ScrollViewer dan kisi yang kami gunakan untuk memalsukan ketinggian gulir kami." </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mensimulasikan ketinggian gulir tentu saja bagus, tetapi mengapa kita menempatkan maksimum 0? </font><font style="vertical-align: inherit;">Beralih ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dokumentasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , menjadi jelas bahwa kode tersebut tidak terlalu mencurigakan. </font><font style="vertical-align: inherit;">Jangan salah paham: mengurangkan variabel dari dirinya sendiri, tentu saja, mencurigakan, tetapi kita mendapatkan nol pada output, yang tidak membahayakan kita. </font><font style="vertical-align: inherit;">Bagaimanapun, saya mencoba menentukan nilai </font><font style="vertical-align: inherit;">default (1) </font><font style="vertical-align: inherit;">di bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maksimum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/my/pz/-r/mypz-rza0bhmadv3_q32c5oklkc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bilah gulir muncul, tetapi juga tidak berfungsi:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/ii/xg/_niixgvkmgqfoy_fmiyaouu6rog.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ada, maka saya menjepit &lt;Enter&gt; selama 30 detik. Rupanya ini bukan masalah, jadi mari kita biarkan apa adanya, kecuali dengan mengganti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bufferHeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bufferHeight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan 0:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">bool</span> TermControl::_InitializeTerminal()<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">auto</span> bottom = _terminal-&gt;GetViewport().BottomExclusive();
  <span class="hljs-keyword">auto</span> bufferHeight = bottom;<font></font>
<font></font>
  ScrollBar().Maximum(<span class="hljs-number">0</span>); <span class="hljs-comment">// &lt;=   </span>
  ScrollBar().Minimum(<span class="hljs-number">0</span>);<font></font>
  ScrollBar().Value(<span class="hljs-number">0</span>);<font></font>
  ScrollBar().ViewportSize(bufferHeight);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kita tidak terlalu dekat dengan penyelesaian masalah. Dengan tidak adanya tawaran yang lebih baik untuk masuk ke debag. Pada awalnya kami bisa meletakkan breakpoint pada baris yang diubah, tetapi saya ragu itu akan membantu kami. Oleh karena itu, pertama-tama kita perlu menemukan fragmen yang bertanggung jawab atas offset Viewport relatif terhadap buffer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sedikit tentang cara kerja scrollbar lokal (dan kemungkinan besar lainnya). Kami memiliki satu buffer besar yang menyimpan semua output. Untuk berinteraksi dengannya, beberapa jenis abstraksi digunakan untuk menggambar di layar, dalam hal ini, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan menggunakan dua primitif ini, kita dapat memahami apa masalah kita. Pergi ke baris baru tidak meningkatkan buffer, dan karena ini, kita tidak punya tempat untuk pergi. Karena itu, masalahnya ada di dalamnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berbekal pengetahuan umum ini, kami melanjutkan debat heroik kami. </font><font style="vertical-align: inherit;">Setelah sedikit berjalan di sekitar fungsi, saya menarik perhatian pada fragmen ini:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// This event is explicitly revoked in the destructor: does not need weak_ref</span>
<span class="hljs-keyword">auto</span> onReceiveOutputFn = [<span class="hljs-keyword">this</span>](<span class="hljs-keyword">const</span> hstring str) {<font></font>
  _terminal-&gt;Write(str);<font></font>
};<font></font>
_connectionOutputEventToken = _connection.TerminalOutput(onReceiveOutputFn);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kami mengkonfigurasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ScrollBar di</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atas </font><font style="vertical-align: inherit;">, kami mengkonfigurasi berbagai fungsi panggilan balik dan menjalankan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__connection.Start ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk jendela baru kami yang dicetak. </font><font style="vertical-align: inherit;">Setelah itu lambda di atas disebut. </font><font style="vertical-align: inherit;">Karena ini adalah pertama kalinya kami menulis sesuatu ke buffer, saya sarankan memulai debug kami dari sana. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menetapkan breakpoint di dalam lambda dan mencari di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_terminal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0z/lz/rb/0zlzrbnxlr94nbnb2jkgnmmf1sq.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita memiliki dua variabel yang sangat penting bagi kita - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_mutableViewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Letakkan breakpoint pada mereka dan temukan di mana mereka berubah. Benar, dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_viewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya akan sedikit </font><i><font style="vertical-align: inherit;">curang</font></i><font style="vertical-align: inherit;"> dan meletakkan breakpoint bukan pada variabel itu sendiri, tetapi pada bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atasnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (kita hanya membutuhkannya). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang klik pada &lt;F5&gt;, dan tidak ada yang terjadi ... Baiklah, maka mari kita tekan beberapa lusin kali &lt;Enter&gt;. Tidak ada yang terjadi. Rupanya, pada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami menetapkan breakpoint terlalu ceroboh, dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_viewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , seperti yang diharapkan, tetap di bagian atas buffer, yang tidak bertambah besar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, masuk akal untuk memasukkan perintah yang menyebabkan titik diperbarui.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_viewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Setelah itu, kami bangun dengan sepotong kode yang sangat menarik:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span> Terminal::_AdjustCursorPosition(<span class="hljs-keyword">const</span> COORD proposedPosition)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-comment">// Move the viewport down if the cursor moved below the viewport.</span>
  <span class="hljs-keyword">if</span> (cursorPosAfter.Y &gt; _mutableViewport.BottomInclusive())<font></font>
  {<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> newViewTop =
      <span class="hljs-built_in">std</span>::max(<span class="hljs-number">0</span>, cursorPosAfter.Y - (_mutableViewport.Height() - <span class="hljs-number">1</span>));
    <span class="hljs-keyword">if</span> (newViewTop != _mutableViewport.Top())<font></font>
    {<font></font>
      _mutableViewport = Viewport::FromDimensions(....); <span class="hljs-comment">// &lt;=</span>
      notifyScroll = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menunjukkan komentar di mana kami tinggalkan. </font><font style="vertical-align: inherit;">Jika Anda melihat komentar pada fragmen itu, menjadi jelas bahwa kami lebih dekat dengan solusi daripada sebelumnya. </font><font style="vertical-align: inherit;">Di tempat inilah bagian yang terlihat bergeser relatif ke buffer, dan kami mendapat kesempatan untuk menggulir. </font><font style="vertical-align: inherit;">Setelah mengamati perilaku sedikit, saya perhatikan satu hal menarik: ketika pindah ke baris baru, nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kursorPosAfter.Y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variabel </font><font style="vertical-align: inherit;">sama dengan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jadi kami tidak menghilangkannya dan tidak ada yang berhasil. </font><font style="vertical-align: inherit;">Selain itu, ada masalah serupa dengan variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newViewTop</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Oleh karena itu, mari kita </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tambahkan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nilai </font><i><font style="vertical-align: inherit;">cursorPosAfter.Y</font></i><font style="vertical-align: inherit;"> per satu dan lihat apa yang terjadi:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span> Terminal::_AdjustCursorPosition(<span class="hljs-keyword">const</span> COORD proposedPosition)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-comment">// Move the viewport down if the cursor moved below the viewport.</span>
  <span class="hljs-keyword">if</span> (cursorPosAfter.Y + <span class="hljs-number">1</span> &gt; _mutableViewport.BottomInclusive())<font></font>
  {<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> newViewTop =
      <span class="hljs-built_in">std</span>::max(<span class="hljs-number">0</span>, cursorPosAfter.Y + <span class="hljs-number">1</span> - (_mutableViewport.Height() - <span class="hljs-number">1</span>));
    <span class="hljs-keyword">if</span> (newViewTop != _mutableViewport.Top())<font></font>
    {<font></font>
      _mutableViewport = Viewport::FromDimensions(....); <span class="hljs-comment">// &lt;=</span>
      notifyScroll = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan hasil peluncurannya:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/6g/7d/xc/6g7dxcp_8o_uw-jzmlx6qxy6xjy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keajaiban! </font><font style="vertical-align: inherit;">Saya memasukkan jumlah dan bilah gulir berfungsi. </font><font style="vertical-align: inherit;">Benar, sampai saat kami memperkenalkan sesuatu ... Untuk mendemonstrasikan file, saya akan melampirkan gif:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/ed/8y/cled8yrho-rrvtihhjf7uoo7ybq.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya, kami melakukan beberapa lompatan ekstra ke baris baru. </font><font style="vertical-align: inherit;">Mari kita coba membatasi transisi kita menggunakan koordinat X. Kita hanya akan menggeser garis ketika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah 0:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">void</span> Terminal::_AdjustCursorPosition(<span class="hljs-keyword">const</span> COORD proposedPosition)<font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (   proposedCursorPosition.X == <span class="hljs-number">0</span><font></font>
      &amp;&amp; proposedCursorPosition.Y == _mutableViewport.BottomInclusive())<font></font>
  {<font></font>
    proposedCursorPosition.Y++;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Update Cursor Position</span><font></font>
  ursor.SetPosition(proposedCursorPosition);<font></font>
<font></font>
  <span class="hljs-keyword">const</span> COORD cursorPosAfter = cursor.GetPosition();<font></font>
<font></font>
  <span class="hljs-comment">// Move the viewport down if the cursor moved below the viewport.</span>
  <span class="hljs-keyword">if</span> (cursorPosAfter.Y &gt; _mutableViewport.BottomInclusive())<font></font>
  {<font></font>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> newViewTop =
      <span class="hljs-built_in">std</span>::max(<span class="hljs-number">0</span>, cursorPosAfter.Y - (_mutableViewport.Height() - <span class="hljs-number">1</span>));
    <span class="hljs-keyword">if</span> (newViewTop != _mutableViewport.Top())<font></font>
    {<font></font>
      _mutableViewport = Viewport::FromDimensions(....);<font></font>
      notifyScroll = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fragmen yang dituliskan di atas akan menggeser koordinat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk kursor. </font><font style="vertical-align: inherit;">Kemudian kami memperbarui posisi kursor. </font><font style="vertical-align: inherit;">Secara teori, ini harus berhasil ... Apa yang terjadi?</font></font><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/7i/kc/xs/7ikcxsonvzc4h99f-6obibt1o8u.gif"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah, tentu saja, lebih baik. </font><font style="vertical-align: inherit;">Namun, ada masalah saat kami menggeser titik output, tetapi jangan menggeser buffer. </font><font style="vertical-align: inherit;">Karena itu, kita melihat dua panggilan dari perintah yang sama. </font><font style="vertical-align: inherit;">Tentu saja, sepertinya saya tahu apa yang saya lakukan, tetapi tidak demikian. </font><font style="vertical-align: inherit;">:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada titik ini, saya memutuskan untuk memeriksa isi buffer, jadi saya kembali ke titik di mana saya memulai debug:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// This event is explicitly revoked in the destructor: does not need weak_ref</span>
<span class="hljs-keyword">auto</span> onReceiveOutputFn = [<span class="hljs-keyword">this</span>](<span class="hljs-keyword">const</span> hstring str) {<font></font>
  _terminal-&gt;Write(str);<font></font>
};<font></font>
_connectionOutputEventToken = _connection.TerminalOutput(onReceiveOutputFn);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menetapkan breakpoint di tempat yang sama seperti terakhir kali, dan mulai melihat isi dari variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mari kita mulai dengan apa yang saya lihat di layar saya:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ha/ll/4c/hall4czp0c9scl5ybzmduvpa2iy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut Anda apa yang akan ada di string </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ketika saya menekan &lt;Enter&gt;?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"DESKRIPSI PANJANG"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seluruh buffer yang sekarang kita lihat.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seluruh buffer, tetapi tanpa baris pertama.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan merana - seluruh buffer, tetapi tanpa baris pertama. </font><font style="vertical-align: inherit;">Dan ini adalah masalah yang cukup besar, karena justru karena inilah kita kehilangan sejarah, terlebih lagi, secara langsung. </font><font style="vertical-align: inherit;">Beginilah tampilan fragmen hasil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bantuan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">setelah menuju ke baris baru:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/n8/d9/rcn8d94h6tyf1qtscqyqvfvtn24.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan panah aku menandai tempat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"LONG DESCRIPTOIN" berada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mungkin kemudian menimpa buffer dengan offset satu baris? </font><font style="vertical-align: inherit;">Ini akan berhasil jika panggilan balik ini tidak dipanggil untuk setiap bersin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya telah menemukan setidaknya tiga situasi ketika dipanggil,</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika kita memasukkan karakter apa pun;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat kita menelusuri sejarah;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika kita menjalankan perintah.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalahnya adalah Anda hanya perlu memindahkan buffer saat kami menjalankan perintah, atau masukkan &lt;Enter&gt;. </font><font style="vertical-align: inherit;">Dalam kasus lain, melakukan ini adalah ide yang buruk. </font><font style="vertical-align: inherit;">Jadi kita perlu entah bagaimana menentukan di dalam apa yang perlu digeser.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/pb/yo/ij/pbyoijjc9y4dezbt9wizjxrwnb0.png" alt="Gambar 18"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini adalah upaya untuk menunjukkan betapa terampilnya PVS-Studio dapat menemukan kode yang rusak yang mengarah ke kesalahan yang saya perhatikan. </font><font style="vertical-align: inherit;">Pesan tentang topik mengurangkan variabel dari dirinya sendiri sangat memotivasi saya, dan saya mulai menulis teks. </font><font style="vertical-align: inherit;">Tetapi seperti yang Anda lihat, kegembiraan saya terlalu dini dan semuanya ternyata jauh lebih rumit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi saya memutuskan untuk berhenti. </font><font style="vertical-align: inherit;">Seseorang masih bisa menghabiskan beberapa malam, tetapi semakin lama saya melakukan ini, semakin banyak masalah muncul. </font><font style="vertical-align: inherit;">Yang bisa saya lakukan adalah berharap para pengembang Terminal Windows semoga berhasil dalam memperbaiki bug ini. </font><font style="vertical-align: inherit;">:)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya harap saya tidak mengecewakan pembaca bahwa saya tidak menyelesaikan penelitian dan menarik bagi saya untuk berjalan-jalan di sepanjang bagian dalam proyek. Sebagai kompensasi, saya sarankan menggunakan kode promo #WindowsTerminal, terima kasih Anda akan menerima versi demo PVS-Studio tidak selama seminggu, tetapi langsung selama sebulan. Jika Anda belum mencoba penganalisis statis PVS-Studio dalam praktiknya, ini adalah alasan yang tepat untuk melakukan hal itu. Cukup masukkan "#WindowsTerminal" di bidang "Pesan" di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">halaman unduhan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan juga, mengambil kesempatan ini, saya ingin mengingatkan Anda bahwa segera akan ada versi penganalisa C # yang bekerja di Linux dan macOS. Dan sekarang Anda dapat mendaftar untuk pengujian pendahuluan.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Maxim Zvyagintsev. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scrollbar Kecil Yang Tidak Bisa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493026/index.html">Pengujian pada prod: Penempatan Canary</a></li>
<li><a href="../id493032/index.html">5. Periksa Point Maestro Pertanyaan yang Sering Diajukan (FAQ)</a></li>
<li><a href="../id493034/index.html">COVID-19: memprediksi jumlah pasien dengan coronavirus</a></li>
<li><a href="../id493036/index.html">Saya memutar dan memutar, saya ingin membingungkan: manipulasi dengan graphene dua lapisan</a></li>
<li><a href="../id493038/index.html">Tentang budaya perusahaan untuk tim yang didistribusikan dan tidak hanya</a></li>
<li><a href="../id493042/index.html">Segmen data audiens pasar periklanan dan pemasaran online. Bagian. 1. Perubahan undang-undang</a></li>
<li><a href="../id493046/index.html">Bagaimana merencanakan pembukaan kafe, atau menulis perencana Anda sendiri untuk membuka usaha</a></li>
<li><a href="../id493050/index.html">Pencarian bukan apa yang ditemukan</a></li>
<li><a href="../id493052/index.html">Masalah</a></li>
<li><a href="../id493060/index.html">Pekerjaan jarak jauh sebagai kesempatan untuk mengungkapkan manajer proyek</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>