<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â‡ï¸ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ‰ Analyse einer Kinoseite auf Golang ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ¼ ğŸ“ ğŸ‘¦ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits, in diesem Artikel sehen wir uns einen kleinen Beispielcode an, der geschrieben wurde, um Daten von einer Site in der beliebten Progr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Analyse einer Kinoseite auf Golang</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493088/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo allerseits, in diesem Artikel sehen wir uns einen kleinen Beispielcode an, der geschrieben wurde, um Daten von einer Site in der beliebten Programmiersprache Go today zu sammeln. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel ist besonders interessant fÃ¼r diejenigen, die viel Ã¼ber Go gehÃ¶rt haben, es aber noch nicht selbst ausprobiert haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ¼r eines der internen Projekte mussten wir Daten Ã¼ber die ausgeliehenen Filme und den Zeitplan der Shows sammeln. Jetzt werden wir die erste (einfachste) Version des Parsers betrachten, mit der alles begann.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ¼r diejenigen, die zu faul sind, um den Artikelcode zu lesen, stelle ich sofort einen Link zum </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bereit </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In seiner ersten Version konnte der Parser nur die folgenden Informationen sammeln:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ãœber Sessions in einem Kino,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detaillierte Beschreibung,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titel,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studio,</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und speichern Sie es in JSON. ZunÃ¤chst mÃ¼ssen Sie die entsprechende Bibliothek zum Parsen auswÃ¤hlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google bietet eine groÃŸe Anzahl von Optionen fÃ¼r die Abfrage "Golang Web Scraping", viele davon sind in dieser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste enthalten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ihnen, sie zu lesen. Ich habe </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">geziyor gewÃ¤hlt</font></a><font style="vertical-align: inherit;"> , da es JS-Rendering unterstÃ¼tzt (das wir Ã¼brigens hier nicht verwenden werden Diese Funktion ist jedoch beispielsweise beim Parsen von Websites sehr nÃ¼tzlich und recht einfach zu verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die Bibliothek ausgewÃ¤hlt ist, besteht der nÃ¤chste Schritt darin, sie zu installieren und im Code zu verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Installation der Bibliothek ist Ã¤uÃŸerst einfach:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get -u github.com/geziyor/geziyor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fahren wir nun mit dem Schreiben von Code fort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Hauptteil der Hauptfunktion rufen wir den Parser auf, geben ihm die URL der Seite, von der aus wir mit der Datenerfassung beginnen, und geben an, dass das Ergebnis in eine JSON-Datei exportiert werden soll:</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> { <font></font>
    geziyor.NewGeziyor(&amp;geziyor.Options{ <font></font>
        StartURLs: []<span class="hljs-keyword">string</span>{<span class="hljs-string">"https://kinoteatr.ru/raspisanie-kinoteatrov/city/#"</span>}, <font></font>
        ParseFunc: parseMovies, <font></font>
        Exporters: []export.Exporter{&amp;export.JSON{}}, <font></font>
    }).Start() <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde begonnen, aber es gibt nicht genÃ¼gend Logik zum Sammeln von Daten. Dazu mÃ¼ssen wir die Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parseMovies</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementieren </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Erfassungslogik lautet wie folgt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suchen Sie nach einem Block mit Filminformationen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammlung von Informationen zu allen Sitzungen in diesem Block,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammlung des Namens des Films und des Filmstudios,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammeln eines Links zu einer Seite mit detaillierten Informationen zum Film,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sammlung von Beschreibungen von dieser Seite</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fahren wir mit der Implementierung dieser Funktion fort.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier werden alle BlÃ¶cke, die Informationen Ã¼ber den Film enthalten, zur weiteren Verarbeitung ausgewÃ¤hlt.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parseMovies</span><span class="hljs-params">(g *geziyor.Geziyor, r *client.Response)</span></span> {<font></font>
    r.HTMLDoc.Find(<span class="hljs-string">"div.shedule_movie"</span>).Each(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>, s *goquery.Selection)</span></span> { </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diese Weise werden Informationen zu den Sitzungen gesammelt und dann in eine fÃ¼r eine Person geeignete Form gebracht (wir entfernen zusÃ¤tzliche Leerzeichen und EinrÃ¼ckungen in einer neuen Zeile).</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-keyword">var</span> sessions = strings.Split(s.Find(<span class="hljs-string">".shedule_session_time"</span>).Text(), <span class="hljs-string">" \n "</span>) <font></font>
sessions = sessions[:<span class="hljs-built_in">len</span>(sessions)<span class="hljs-number">-1</span>] <font></font>
<font></font>
<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(sessions); i++ { <font></font>
    sessions[i] = strings.Trim(sessions[i], <span class="hljs-string">"\n "</span>) <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Codeblock ist dafÃ¼r verantwortlich, eine Seite mit detaillierten Informationen zum Film und dessen Beschreibung zu erhalten.</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-keyword">if</span> href, ok := s.Find(<span class="hljs-string">"a.gtm-ec-list-item-movie"</span>).Attr(<span class="hljs-string">"href"</span>); ok {<font></font>
    g.Get(r.JoinURL(href), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_g *geziyor.Geziyor, _r *client.Response)</span></span> {<font></font>
        description = _r.HTMLDoc.Find(<span class="hljs-string">"span.announce p.movie_card_description_inform"</span>).Text() <font></font>
        description = strings.ReplaceAll(description, <span class="hljs-string">"\t"</span>, <span class="hljs-string">""</span>) <font></font>
        description = strings.ReplaceAll(description, <span class="hljs-string">"\n"</span>, <span class="hljs-string">""</span>) <font></font>
        description = strings.TrimSpace(description) <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch wird die API aufgerufen, um die Ergebnisse in eine JSON-Datei zu exportieren.</font></font><br>
<br>
<pre><code class="go hljs">
g.Exports &lt;- <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}{ 
    <span class="hljs-string">"title"</span>:        strings.TrimSpace(s.Find(<span class="hljs-string">"span.movie_card_header.title"</span>).Text()), 
    <span class="hljs-string">"subtitle"</span>:    strings.TrimSpace(s.Find(<span class="hljs-string">"span.sub_title.shedule_movie_text"</span>).Text()), 
    <span class="hljs-string">"sessions"</span>:    sessions, 
    <span class="hljs-string">"description"</span>: description, <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurra, du bist fertig! </font><font style="vertical-align: inherit;">Es bleibt nur, die geschriebenen CodeblÃ¶cke miteinander zu kombinieren und mit dem Parsen zu beginnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So funktioniert der Parser, wir sehen Meldungen Ã¼ber den erfolgreichen Empfang von Seiten im Terminal, das ist praktisch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/ee/zo/abeezot2smu6-n26c31884sg5tg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so sieht das Ergebnis des Parsens aus. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/qy/3v/0fqy3vtnnv727n5xbjy-jju9zh4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank fÃ¼r das Lesen des Artikels, liebe das Programmieren auf Go.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de493076/index.html">So Ã¼bertragen Sie ein Unternehmen schnell auf Remote-Arbeit: eine kostenlose Online-Konferenz von Netology und TalentTech</a></li>
<li><a href="../de493078/index.html">Top 5 BÃ¼cher, die ein Manager lesen sollte</a></li>
<li><a href="../de493082/index.html">Wie Verkehrsanalysesysteme MITRE ATT & CK-Hacker-Taktiken mithilfe der PT Network Attack Discovery erkennen</a></li>
<li><a href="../de493084/index.html">Schreiben eines GeschÃ¤ftsprozesses in Bitrix24 mit einer Einzahlung fÃ¼r die Zukunft</a></li>
<li><a href="../de493086/index.html">Kulhacker. Start</a></li>
<li><a href="../de493090/index.html">Treffen Sie NestJS</a></li>
<li><a href="../de493094/index.html">Amazon-Lagerarbeiter alarmieren Ã¼ber die Verbreitung von Coronaviren</a></li>
<li><a href="../de493096/index.html">FÃ¼gen Sie ein dunkles Thema in iOS hinzu</a></li>
<li><a href="../de493098/index.html">Stellen Sie den ASA VPN-Lastausgleichscluster bereit</a></li>
<li><a href="../de493100/index.html">Wie das Finden einfacher Wege Startups hilft, aggressives Wachstum zu erzielen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>