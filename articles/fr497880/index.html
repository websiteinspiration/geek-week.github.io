<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏿 ✊🏽 🙏🏼 Production d'icônes de matériaux pour MacOSX Home Assistant sur Electron 👨🏽‍🎤 🚨 👌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la première série, j'ai brassé une maison intelligente sur le Home Assistant. Dans le processus, je suis tombée amoureuse de l'Assistant Maison e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Production d'icônes de matériaux pour MacOSX Home Assistant sur Electron</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497880/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">première série,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> j'ai brassé une maison intelligente sur le Home Assistant. Dans le processus, je suis tombée amoureuse de l'Assistant Maison et j'ai pensé à écrire une application de bureau pour ce système. Home Assitant a une merveilleuse interface Web et il semblait raisonnable de l'envelopper dans Electron pour obtenir une belle icône de dock, des notifications natives, une barre de menus pour un accès rapide et d'autres zeroconf. Home Assistant pour tout ce qui peut être utilisé Material Icons: pour les tableaux de bord, pour les états, pour les boutons, pour tout. Cela signifie que vous devez extraire l'ensemble des icônes de matériaux dans l'application Electron.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Electron utilise l'API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nativeImage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour travailler avec des images </font><font style="vertical-align: inherit;">qui, en 2020, n'acceptent pas les formats vectoriels et daigne ne consommer que du PNG et du JPG. JPG ne nous convient pas car les artefacts de compression des icônes sont mortels. Vous avez donc besoin d'un endroit pour transférer le format en PNG. En montant sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site principal des icônes de matériaux pendant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> environ 15 minutes, je cherchais un ensemble prêt à l'emploi d'icônes de matériaux pour MacOSX découpé en png de différentes tailles et sous différents dpi ... Il est difficile de dire pourquoi, mais ils ne publient rien de tel là-bas. Devra produire indépendamment. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Home Assistant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propose de déclarer dans les configs des icônes au format "mdi: home-cirlce" - le nom de l'icône ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) avec le remplacement du premier caractère «-» par «:». </font><font style="vertical-align: inherit;">Remplacez "-" =&gt; ":" nous convertissons par programmation pour être plus proche de l'original et n'avons pas utilisé les caractères ":" dans les noms de fichiers. </font><font style="vertical-align: inherit;">Le premier endroit où je voulais visser les icônes était le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menu du tableau de bord Home Assistant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour la barre de menu, macosx utilise des images 16x16 pixels et @ 2 pour la rétine (peut-être un peu plus, @ 2 était suffisant sur mon coquelicot). </font><font style="vertical-align: inherit;">J'ai donc besoin d'obtenir deux fichiers pour chaque icône de l'ensemble de matériaux:</font></font><br>
<br>
<pre><code class="bash hljs">mdi-icon-name16.png<font></font>
mdi-icon-name16@2.png<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajout d'une taille au nom pour que l'ajout de nouvelles tailles d'images n'interfère pas avec la marche à l'avenir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les polices finales sont généralement collectées à partir d'images SVG, ce qui a donné lieu à deux tâches: 1 - trouver des icônes de matériau svg, 2 - automatiser leur découpage pour&gt; 5000 fichiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le site natif était toujours utile, là j'ai trouvé la commande «npm install</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Police de caractère. " </font><font style="vertical-align: inherit;">Au hasard en remplaçant svg au lieu de font avec la commande «npm install</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mdi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ svg ”, nous avons obtenu l'ensemble complet des icônes matérielles se trouvant soigneusement dans le même répertoire node_modules / @ mdi / svg / svg / avec des noms comme mdi-icon-name.svg. </font><font style="vertical-align: inherit;">Le familier ImageMagick montrait une qualité extrêmement faible des images résultantes, l'utilitaire svg2png fonctionnait encore pire. </font><font style="vertical-align: inherit;">Mais le bon stackoverflow a suggéré que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inkscape ferait</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> face à cette tâche </font><font style="vertical-align: inherit;">avec une telle commande</font></font><br>
<br>
<pre><code class="bash hljs">inkscape -w 16 -h 16 node_modules/@mdi/svg/svg/ab-testing.svg \<font></font>
    -o images/mdi-ab-testing16.png</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat s'est avéré satisfaisant. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/u5/3w/h7u53wlvlxmjfgh5gf8hdkcrajm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais un examen plus approfondi a montré qu'en mode sombre, ces icônes semblaient ternes: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/k_/tj/agk_tjmhekpylck8-0y9nv2w6fc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
le site Web d'Apple a déclaré avoir inventé un format de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spécial </font><font style="vertical-align: inherit;">afin que les images puissent être inversées sans trop de difficulté, si le destin les amène en mode sombre. </font><font style="vertical-align: inherit;">Le rôle de ces fichiers est une image PNG dans laquelle tous les pixels sont noirs et l'icône elle-même est dessinée en transparence (sur le canal alpha). </font><font style="vertical-align: inherit;">Dans le même temps, Electron peut prendre de telles photos s'il y a un «modèle» dans leur nom. </font><font style="vertical-align: inherit;">Donc, deux fichiers supplémentaires avec des icônes doivent être ajoutés deux autres avec des icônes de modèle, nous obtenons cet ensemble pour chaque icône:</font></font><br>
<br>
<pre><code class="bash hljs">mdi-icon-name16.png<font></font>
mdi-icon-name16@2.png<font></font>
mdi-icon-name16Template.png<font></font>
mdi-icon-name16Template@2.png<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inkscape ne pourra pas effectuer de miracles avec le canal alpha à partir de la console, mais il est facile de convertir à partir d'ImageMagick. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous procédons en trois étapes:</font></font><br>
<br>
<pre><code class="bash hljs">inkscape -w 16 -h 16 \<font></font>
    node_modules/@mdi/svg/svg/ab-testing.svg \<font></font>
    -o images/mdi-ab-testing16.png<font></font>
convert -size 16x16 xc:none images/background16.png<font></font>
convert -verbose -composite images/background16.png \<font></font>
    images/mdi-ab-testing16.png -compose CopyAlpha \<font></font>
    menuicons/ab-testingTemplate16.png</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 - Création d'une image bitmap à partir d'un vecteur </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - Création d'une image transparente pour l'étape trois </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - Création d'un fichier avec le transfert des dégradés de gris vers le canal alpha </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Déjà avec les icônes du menu Modèle en mode sombre, cela commençait à ressembler à </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/g4/w7/mjg4w7raoh9flq3szdvkgllte9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, l'objectif est atteint. </font><font style="vertical-align: inherit;">Le script distille toutes les images dans les formats souhaités</font></font><br>
<br>
<pre><code class="bash hljs">
<span class="hljs-comment">#!/bin/sh -x</span><font></font>
<font></font>
<span class="hljs-built_in">set</span> -e<font></font>
<font></font>
<span class="hljs-comment"># Run 'npm install @mdi/svg' beforehead</span>
MDISVG_PATH=<span class="hljs-string">'node_modules/@mdi/svg/svg/'</span><font></font>
<font></font>
<span class="hljs-comment">#Put inkscape and convert into PATH</span>
PATH=<span class="hljs-variable">$PATH</span>:/Applications/Inkscape.app/Contents/MacOS/<font></font>
<font></font>
mkdir -p images<font></font>
convert -size 32x32 xc:none images/background16@2x.png<font></font>
convert -size 16x16 xc:none images/background16.png<font></font>
<font></font>
SIZES=<span class="hljs-string">"
16,16
32,16@2x
"</span>
FILES=`ls <span class="hljs-variable">${MDISVG_PATH}</span> |grep svg`
<span class="hljs-keyword">for</span> SVG <span class="hljs-keyword">in</span> <span class="hljs-variable">$FILES</span>; <span class="hljs-keyword">do</span>
    BASE=$(basename <span class="hljs-string">"<span class="hljs-variable">$SVG</span>"</span> | sed <span class="hljs-string">'s/\.[^\.]*$//'</span>)
    <span class="hljs-keyword">for</span> PARAMS <span class="hljs-keyword">in</span> <span class="hljs-variable">$SIZES</span>; <span class="hljs-keyword">do</span>
        SIZE=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PARAMS</span> | cut -d, -f1)<font></font>
        LABEL=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PARAMS</span> | cut -d, -f2)<font></font>
        inkscape -w <span class="hljs-variable">$SIZE</span> -h <span class="hljs-variable">$SIZE</span> <span class="hljs-string">"<span class="hljs-variable">$MDISVG_PATH</span>/<span class="hljs-variable">$SVG</span>"</span> \<font></font>
            -o <span class="hljs-string">"images/mdi-<span class="hljs-variable">${BASE}</span><span class="hljs-variable">${LABEL}</span>"</span>.png<font></font>
        convert -verbose \<font></font>
            -composite images/background<span class="hljs-variable">${LABEL}</span>.png <span class="hljs-string">"images/mdi-<span class="hljs-variable">${BASE}</span><span class="hljs-variable">${LABEL}</span>"</span>.png \<font></font>
            -compose CopyAlpha \<font></font>
            <span class="hljs-string">"images/<span class="hljs-variable">${BASE}</span>Template<span class="hljs-variable">${LABEL}</span>"</span>.png
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">done</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous attendons quelques heures jusqu'à ce que&gt; 20 000 photos sortent de la chaîne de montage ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Ce ne sont pas les seules aventures en travaillant avec Electron, j'écrirai sur d'autres aventures au fur et à mesure qu'elles seront terminées ...</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497870/index.html">Virus informatiques: une histoire d'espions domestiques inoffensifs aux voleurs de cartes bancaires</a></li>
<li><a href="../fr497872/index.html">Facteurs inhabituels et assez évidents affectant le trafic des réseaux d'entreprise et le travail des prestataires</a></li>
<li><a href="../fr497874/index.html">David Heinemeyer Hansson (Basecamp, ReWork, Ruby on Rails) sur son fonctionnement</a></li>
<li><a href="../fr497876/index.html">[signet] Travailler avec des images sur le Web</a></li>
<li><a href="../fr497878/index.html">Installer la version GPL de HPL avec OpenBLAS</a></li>
<li><a href="../fr497882/index.html">Comment obtenir une entrevue ou pourquoi n’êtes-vous pas embauché?</a></li>
<li><a href="../fr497886/index.html">Validation de champ IOS - rapide et facile</a></li>
<li><a href="../fr497890/index.html">Journée de formation virtuelle Microsoft 365: plongez dans les équipes Microsoft</a></li>
<li><a href="../fr497894/index.html">Journée de formation virtuelle Microsoft Azure: entrepôt de données moderne</a></li>
<li><a href="../fr497896/index.html">Nous préservons la vision sur un site distant en utilisant un projecteur au lieu d'un moniteur - plusieurs nuances non évidentes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>