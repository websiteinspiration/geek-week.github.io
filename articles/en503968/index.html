<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíí ü•î ü§≤üèª How to make the robot move accurately? Studuino Platform Robotics Overview and Features üîØ üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© üôÖüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The organization in which I work was asked to hold a small robotics webinar for the Moscow International Education Salon 2020, which was held in an on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to make the robot move accurately? Studuino Platform Robotics Overview and Features</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503968/"><img src="https://habrastorage.org/webt/tv/1x/rr/tv1xrr8dyui1j9kgp12ampq04z4.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The organization in which I work was asked to hold a small robotics webinar for the Moscow International Education Salon 2020, which was held in an online format. The topic of the presentation was left to me open and given an educational set on robotics. So I got acquainted with products from the Japanese corporation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArTeC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (this is not advertising and I am not an employee of ArTeC - it's just my personal experience from communicating with their products). After the webinar, I decided to write this article, since in Russia kits from Lego Education were quite popular, and this was the first time I came across this Japanese designer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The article is divided into two parts. </font><font style="vertical-align: inherit;">The first part will be useful to those who choose a kit for educational robotics. </font><font style="vertical-align: inherit;">In the second part, I examined the use of a kit to solve an applied problem that may occur in life. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, if anyone is interested in what kind of robotic kit it is and what can be done with it, I ask for a cat. </font><font style="vertical-align: inherit;">So let's go!</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a building basis, the designer uses only a few basic parts from which you can assemble quite complex structures. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-f/wo/fc/-fwofcl47qvnsp3yktrthob23fk.jpeg" alt="ArTeC Designer Base Blocks"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArTeC Designer Base Blocks </font></font></b></i><br>
<br>
<img src="https://habrastorage.org/webt/88/y5/x_/88y5x_wap5y9pfk89w0s2d_kclm.jpeg" alt="image"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example Models from Designer Parts</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the specifics of the parts - the staggered order of the holes and spikes for the connection, it is not always quick to find the right combination of parts to achieve the result. Of the advantages, unlike Lego: all parts are large enough, losing such a lot more difficult. The second plus is that you don‚Äôt have to rummage around in search of the necessary part for a long time, because there are only 5-6 pieces of basic parts (the difference in the color of the parts does not count). There is a minus - as long as the parts are completely new, their separation sometimes turns into torment - so they cling tightly to each other. To help disengage them comes a special tool that is in the kit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to the basic blocks in the set there are a couple of varieties of wheels and gears, as well as a gear rack.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now about what is included in the electronic part of this robotic kit. The Japanese website has a fairly large number of different sensors and modules. Of course, I had a lot less of them, but those that were already gave a certain scope for creativity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the filling of the main control unit, the Japanese made their version of the Arduino board, finalizing it, and called it Studuino. They added a DC motor control driver to it and brought a line for 3-pin connectors (standard BLS-3, these are placed on servos). On each such connector there is power: plus and minus, as well as one of the pins of the Arduino board. All connectors are signed, so it‚Äôs hard to make a mistake when connecting to them. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ti/ls/g5/tilsg5zc0fbgyoeusvabr0xeti0.png" alt="Studuino Platform"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studuino Platform</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For compatibility with standard Arduino shields on standard places, there are connectors similar to Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main difference from the Arduino board is that the voltage of the controller is 3.3V. This is explained by the fact that the central control module is supplied with power through the supplied battery compartment for 3 AA batteries (4.5 V in total). The battery, unfortunately, is not provided, it can not even be bought on the manufacturer‚Äôs website as an additional option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The board is located in a plastic case, to which you can attach the base parts of the designer and other elements. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4s/db/tv/4sdbtvlbdgyvbyrtjohswx8w4zq.jpeg" alt="ArTeC Central Unit"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArTeC Central Unit</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As actuators, the manufacturer offers two DC motors with gearboxes and up to 8 servo-drives of their own design (their number can vary depending on the kit configuration). Motors are connected through special connectors that are on the board. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xr/ig/ti/xrigtithv8bt_ypcxqceow8mze0.jpeg" alt="DC motors with gears and their connection"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC motors with gearboxes and their connection</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It </font><i><b><font style="vertical-align: inherit;">is</font></b></i><font style="vertical-align: inherit;"> possible to assemble quite easily and quickly the simplest construction that comes to mind: a robot machine with two motors, controlling which you can make it move in the right direction. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cw/k8/pb/cwk8pb5whc2yhdqudkn_igjmw04.jpeg" alt="Simple robot machine with two DC motors"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple robot machine with two DC motors</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The engines are controlled by setting the logical states of the terminals D2, D4, D3 for the engine, which is connected to the M1 and D7, D8, D5 connectors for the motor connected to the M2 connector on the Studuino board. It is to these conclusions that the developers of the Studuino board connected in parallel a motor driver driver chip. Using these conclusions by connecting your circuit there, and at the same time using the engines at the same time, will fail.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider how to control an engine that is connected to the M1 connector. By setting a different logical state of the terminals D2 and D4, it is possible to achieve rotation of the engine in the desired direction. For example: with D2 - 1 and D4 - 0, the engine rotates clockwise, and if D2 - 0 and D4 - 1, then the engine rotates counterclockwise. It is also necessary to set the motor rotation speed by setting the PWM value at pin D3 - it can be in the range from 0 to 255. If the value is 0, the motor will not rotate, and if the value is 255, we will get the maximum rotation speed. The engine driver also allows an instant change in the direction of rotation of the engine and supports the engine braking mode. To decelerate the engine, the same logical state equal to 1 must be set at terminals D2 and D4.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, there are no D3 and D5 pins in the connectors that have 3 pins (GND, VCC, SIG) on the Studuino board, but they are on the standard Arduino connector, which the developers left to maintain platform compatibility. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Similarly, the motor is controlled, which is connected to the M2 connector. For him, the direction of rotation is specified through the state of the terminals D7 and D8, and the rotation speed by terminal D5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simplest program I wrote made the robot machine move like this:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vQ3rZuYrAfM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Servos can be connected to the connectors that are highlighted in red on the board: D2, D4, D7, D8, D9, D10, D11, D12. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0w/dj/ai/0wdjaiemegvopfxyopehiaw3kk4.jpeg" alt="Servo connection"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecting Servo Drives</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
It is on these pins that the AtMega168 microcontroller has a PWM, which is needed to control the servo drives. If you connect the maximum number of servos, you can get some interesting design. For the sake of demonstration, I put together a simple analogue of a walking robot and tried to program it a little bit. The result can be seen in the video:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7wUzKdMxz2o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only thing to remember is that if you plan to use both DC motors and servos at the same time, then you cannot use 2 DC motors and 8 servos at the same time, since they have common outputs controlled by the microcontroller. You can make the following configurations: 2 DC motors + 4 servos, 1 DC motor + 6 servos or use only 8 servos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In any robotic kit, in addition to actuators, there must be sensors that are the "eyes" and "ears" of any robot. They are also here. In my set there were the following sensors: a light sensor, a sound sensor, an acceleration sensor, two IR sensors, a touch sensor, as well as LEDs (green, red, blue, white) and a piezodynamic. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/37/od/_9/37od_926t58t-bpda408gn8t3r0.jpeg" alt="Sensors in a set"><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensors in a set</font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensors are connected to the central unit using the cables that come with the kit. </font><font style="vertical-align: inherit;">To fix the sensors in the robot model on the housings, they have spikes with which they can be attached to the structure. </font><font style="vertical-align: inherit;">I assembled and programmed a couple of simple designs to look at the operation of the sensors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how the touch sensor works:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/1xNKl1vxEEM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And so the light sensor works:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/IporhRPSjf4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If there are not enough standard sensors in the set and you want to expand its functionality, then you can easily use the solderless breadboard and connect circuits there, just like on a standard Arduino board. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_b/c6/vg/_bc6vgpysz7ujiuqezh3v69hgfy.jpeg" alt="Enhanced Recruitment Features"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enhanced dialing</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The next important point for any robotic kit is the availability of a convenient programming environment. Here, the manufacturer offers three different programming options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entry level - designed for the smallest users, those who still do not really know how to read, but who are already taking their first steps into the adult world of robotics. For them, the simplest programming environment is offered - the pictogram one. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/pe/o-/mypeo-odgpb_o6ewezjvyd2haxy.jpeg" alt="Icon programming"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Icon programming</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here you can pull out pictograms with basic actions into the program (go forward, turn, turn on the LED, etc.) and configure their basic parameters. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When this level is mastered or its capabilities become insufficient to solve the tasks, you can go to the next step and start using the Scratch programming environment for the Studuino platform. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/cx/ze/mscxzeyahq9fake71sur4f9ncuq.jpeg" alt="Scratch programming for Studuino"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scratch programming for Studuino</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
There are already more programming options: you can use variables and arrays, logical and arithmetic expressions, subroutines, as well as more flexibly configure various blocks for execution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When these capabilities are not enough, you can go on to programming in the Arduino IDE and get full control over all the hardware capabilities of the Studuino platform. To use the Studuino board in the Arduino IDE, you must configure the environment according to the instructions from the manufacturer‚Äôs website (so that the environment sees the Studuino platform in the list of supported boards). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Complete with programming software, the manufacturer gives a set of instructions for assembling different models and programming them. The software itself is available for free on the manufacturer's website. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's try to solve a small practical problem using this set.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine that we have a robot that must move forward and backward in the warehouse and we need to make it stop at the given places. </font><font style="vertical-align: inherit;">If the robot is not controlled, an accident will occur. </font><font style="vertical-align: inherit;">An example of such an accident is shown here:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/a-q58XA4iKs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moving the robot forward and backward can be done using DC motors or using servos. </font><font style="vertical-align: inherit;">Servo drives solve the problem of how to stop the robot in the right place (you can accurately set the angle of rotation of the servo). </font><font style="vertical-align: inherit;">This solution has a limitation (we will use a servo from a set with a wheel fixed on it) - servos cannot rotate by an angle of more than 180 degrees and thus the movement of our robot will be limited to half the length of the wheel revolution on the servo, but usually you want more.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will use a DC motor with a reducer from the set to move forward and backward. These motors have no feedback. After starting the engine, we cannot say how far the robot traveled. You can detect the time during which the robot travels the required distance during engine operation and use these delays in the program to stop the robot in the right place. This method has one significant drawback - the engine speed depends on the voltage that is supplied to it and on the required effort. Since batteries are used in the robot, which after a while will be slightly discharged and their voltage will become less, in the same time the robot will begin to travel a shorter distance, and it will be necessary to select the time again.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The simplest option that you can use is a robot, passing the desired point, touches the touch sensor, which will be a stop signal in the right place. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I made changes to my design by adding touch sensors on the robot, and placed elements along the robot path so that the robot touched them with touch sensors when moving.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HA3jLus8px8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The video shows that the robot reaches the end of the ‚Äúwarehouse‚Äù and touches the ‚Äúwall‚Äù with the sensor, then it goes back to the opposite ‚Äúwall‚Äù of the warehouse and there it also touches. After that, the process is repeated. Thus, there are two points that the robot ‚Äúknows‚Äù for sure - these are the points when the touch sensor is triggered. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/b1/t9/dab1t9huyd38v6ayifpulmebjnq.jpeg" alt="Scratch touch program for Studuino"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A program with touch sensors in the Scratch language for Studuino</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sometimes this is enough to solve the task. But we want more! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I made changes to the design and program of the robot and this is what I got:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/VFrxd_LQzo0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's consider in more detail what so much more I decided to demand from the robot. I decided that two breakpoints are not enough for me and I want more. For this, I used an IR sensor, which is included in the kit. I fixed it on a moving platform, and below I arranged a strip of paper with black lines pre-drawn by the marker, on which the robot would have to stop. I also removed one of the touch sensors from the robot (on the right side). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/al/kn/1x/alkn1xf57oqajjs1jfb_k7n3e3q.jpeg" alt="IR Robot"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robot with an IR sensor</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As a result, I got a classic diagram of the device of one of the axes of a 3D printer or a CNC machine. When turned on, the printer does not know where it is and goes all the way to one side (until it is touched by the limit switch), and after that it considers this point to zero and starts to count its position on this axis from it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this design, the countdown occurs on black stripes on paper. The number of these bands is known in advance, so when you reach the last band, you can return to the zero reference point. The Scratch program for Studuino is presented below. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b9/tv/so/b9tvsopxgjuhgvbiga4dj22_kck.jpeg" alt="Scratch IR Robot Program for Studuino"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scratch IR Robot Program for Studuino</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you carefully look at the program, you can see incomprehensible values ‚Äã‚Äãof 40 and 50, with which the value of the IR sensor is compared. To understand these numbers, you need to remember a little about what signals can be read from different sensors. There are digital and analog sensors. Digital sensors have a fixed number of positions and move from one position to another sharply and without intermediate values. Mostly used sensors with two positions. Touch sensors is the most striking example of a digital sensor: until the sensor is pressed, it gives a logical value of 1, and when pressed - a logical value of 0 (in this constructor and with these sensors this is the scheme, but there are schemes where it is done the other way around: pressed - 1, not pressed - 0).Analog sensors describe some inextricable relationship between the signal and the voltage or current at the output and do not have fixed values. The IR sensor emits an analog light signal, which may depend on various factors, such as ambient light, battery voltage, and even ambient temperature.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The analog signal is linearly converted to a number, for Scratch for Studuino - in the range from 0 to 100. This is done to simplify the work with them to end users (this programming environment was first developed for teaching children). In the Arduino IDE, an ‚Äúhonest‚Äù range of values ‚Äã‚Äãfrom 0 to 1023 is issued, which corresponds to the 10-bit ADC converter that is present in the Atmega168 controller. If you look at the differences in the graphs between the digital and analog signal, it becomes clear why the analog signal is a range of values. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ur/3x/et/ur3xety3bijaa_dks5k0_evptss.jpeg" alt="Analog (left) and digital (right) signal"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analog (left) and digital (right) signal The</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
infrared sensor, which is used to determine the black tag line, works by the principle of capturing the reflected signal. Two elements can be clearly seen in the figure: IR LED and IR photodetector.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/3c/6x/on3c6xotvu7c0kki7or2ldclw9k.png" alt="IR sensor"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IR sensor</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If you put an obstacle in front of the sensor from which IR rays will be reflected, the better they will be reflected from the obstacle (depending on the distance to the obstacle or the type of obstacle), the more they will be picked up by the IR photodetector and the sensor will return more value to the user during his survey.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The numbers 40 and 50 are selected empirically. In my case, the sensor showed, being above a white surface, values ‚Äã‚Äãof about 65-75. Above the black surface, the sensor returned values ‚Äã‚Äãin the range of 18-25. The number 40 is the moment when the sensor begins to switch from a white surface to black, and the number 50 is the moment of transition from a black surface to white. These figures are taken with a small margin in order to block the error in the measurement of the sensor. When developing a real design, it is necessary to take into account the conditions under which the sensor will take readings (external lighting, the location of the sensor, etc.), because all these factors will affect the sensor readings. You may have to develop an algorithm for constantly adjusting these values ‚Äã‚Äãdepending on external conditions.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will summarize a small result. Two possible solutions to the problem of moving the robot around the warehouse were considered. Both of these options required additional external "tags", which guided the robot. Is there any way to do without them? In order for the robot, for example, to know at what angle the motor shaft has turned and, depending on the angle value, has decided to stop or move on. There is a simple solution to this problem - the use of a motor with an encoder (angle sensor). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The set has DC motors with gear, but they do not have an encoder. The idea came to my mind: maybe I could try to make a simple encoder from the parts of the designer, especially since the gears from the set have a fairly large module (tooth size)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/pw/m7/3fpwm7n1mk6bd9rcxqx4lbu3vly.jpeg" alt="The main elements of the encoder"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main elements of the encoder</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main problem was to choose the location and fix the IR sensor so that it intersects the gear tooth when it rotates. As a result, I got a test design, which is shown in the figure below. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tq/xl/e-/tqxle-maffh26bftiaj1knmhuvc.jpeg" alt="Encoder Test Model"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoder Test Model</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As you can see in the image above, the IR sensor is fixed so that the gear crosses its working measurement area with its teeth during rotation. Opposite (on the other side of the gear) of the IR sensor, I additionally put an obstacle working on the reflection of infrared rays to get more correct data from the sensor. When the gear rotates and the IR sensor measures the signal reflection, there will be large values ‚Äã‚Äãwhen there is a tooth in front of the sensor and smaller ones when there is a ‚Äúhole‚Äù between the gear teeth.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program for working with the encoder is developed in the Arduino IDE. </font><font style="vertical-align: inherit;">To test the efficiency of my idea, I wrote a simple program that started the engine to rotate at a constant speed and continuously output values ‚Äã‚Äãfrom the IR sensor to the debug console.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program text</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_A        2       <span class="hljs-comment">//   1   1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_B        4       <span class="hljs-comment">//   2   1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_PWM      3       <span class="hljs-comment">//       1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SENSOR_PIN  A4      <span class="hljs-comment">//     IR-sensor</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  Serial.begin(<span class="hljs-number">9600</span>);       <span class="hljs-comment">//      </span>
  pinMode(M1_A, OUTPUT);    <span class="hljs-comment">//       " "</span><font></font>
  pinMode(M1_B, OUTPUT);    <font></font>
  analogWrite(M1_PWM, <span class="hljs-number">100</span>); <span class="hljs-comment">//    </span>
  digitalWrite(M1_A, HIGH); <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2000</span>; i++) {    <span class="hljs-comment">//   2000    -</span>
    Serial.println(analogRead(SENSOR_PIN));   <span class="hljs-comment">//      </span><font></font>
  }<font></font>
  digitalWrite(M1_A, LOW);  <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to the data that the program displayed on the console, I got the following graph: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/kf/tc/atkftc0d8gxexmeimdiirwuyfbw.png" alt="Graph of IR sensor values ‚Äã‚Äãduring gear rotation"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graph of changes in the values ‚Äã‚Äãof the IR sensor during rotation of the gear</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The nature of the graph resembles the shape of the teeth of a gear, which suggests that indeed such data can be used to control the rotation of the engine using the gear from the designer set as an encoder disk. To eliminate ‚Äúbounce‚Äù hysteresis is used, which is implemented as follows (symbols on the graph): MIDDLE is the average value between the maximum and minimum values ‚Äã‚Äãof the IR sensor readings, WIDTH is the deviation from MIDDLE to a greater or lesser value to create a certain ‚Äúerror band‚Äù ¬ªSignal measurements (the total width of this band is 2 * WIDTH). MIDDLE and WIDTH will be used in the engine rotation control algorithm. The algorithm for counting the teeth in the gear during engine rotation can be represented as follows:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/cp/2a/rscp2atjd50elx___64gsjrvpra.png" alt="Algorithm for counting teeth in the gear during engine rotation"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithm for counting teeth in the gear during engine rotation.</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The algorithm uses the following notation:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prev_state</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - previous gear state;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cur_state</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - current state of the gear;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the number of gear teeth counted;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - IR sensor readings.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The principle of counting gear teeth in this algorithm is based on a constant reading of the readings from the IR sensor and a change in the value of the cur_state variable when the signal level goes over the upper or lower line of the ‚Äúerror band‚Äù. </font><font style="vertical-align: inherit;">If the value goes over the upper limit, then the variable cur_state becomes equal to 1, which means a gear tooth, and when going beyond the lower boundary, the variable cur_state becomes equal to 0, which means a gap between the gear teeth. </font><font style="vertical-align: inherit;">The addition of the count variable occurs only when the state of the cur_state variable changes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A program that uses this algorithm is presented below. </font><font style="vertical-align: inherit;">In it, I described a subroutine that waits until the engine rotates the gear by a predetermined number of teeth and after that transfers control to the main program.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program text</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_A        2       <span class="hljs-comment">//   1   1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_B        4       <span class="hljs-comment">//   2   1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M1_PWM      3       <span class="hljs-comment">//       1</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SENSOR_PIN  A4      <span class="hljs-comment">//     IR-sensor</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MIDDLE      550     <span class="hljs-comment">//         </span></span>
                            <span class="hljs-comment">// ""</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WIDTH       50      <span class="hljs-comment">//      ,   </span></span>
      <span class="hljs-comment">//    -     </span>
      <span class="hljs-comment">// </span><font></font>
<font></font>
<span class="hljs-keyword">int</span> enc_tooth = <span class="hljs-number">0</span>;          <span class="hljs-comment">// ,    </span>
<span class="hljs-keyword">int</span> cur_state = <span class="hljs-number">0</span>;          <span class="hljs-comment">//   :  (1)  "" (0)</span>
<span class="hljs-keyword">int</span> prev_state = <span class="hljs-number">0</span>;         <span class="hljs-comment">//   </span>
<span class="hljs-keyword">int</span> tmp;                    <span class="hljs-comment">//      </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_enc</span><span class="hljs-params">()</span> </span>{<font></font>
  enc_tooth = <span class="hljs-number">0</span>;<font></font>
  cur_state = <span class="hljs-number">0</span>;<font></font>
  prev_state = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-comment">//         cur_state</span>
  <span class="hljs-comment">//    ,   = 1,    ""      </span>
  <span class="hljs-comment">//   0      </span>
  <span class="hljs-keyword">if</span> (analogRead(SENSOR_PIN)&gt;MIDDLE) {<font></font>
    prev_state = <span class="hljs-number">1</span>;<font></font>
    cur_state = <span class="hljs-number">1</span>;<font></font>
    enc_tooth++;<font></font>
  }  <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">wait_by_count</span><span class="hljs-params">(<span class="hljs-keyword">int</span> count)</span> </span>{
  <span class="hljs-comment">//       count,       IR </span>
  <span class="hljs-comment">//           ""</span>
  <span class="hljs-keyword">while</span> (enc_tooth &lt;= count) {
    <span class="hljs-comment">//    IR-    </span><font></font>
    tmp = analogRead(SENSOR_PIN);<font></font>
<font></font>
    <span class="hljs-comment">//       +  ,    </span>
    <span class="hljs-keyword">if</span> ((tmp + WIDTH) &gt; MIDDLE) {<font></font>
      cur_state = <span class="hljs-number">1</span>;<font></font>
    } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">//       -  ,    ""</span>
      <span class="hljs-keyword">if</span> ((tmp - WIDTH) &lt; MIDDLE) {<font></font>
        cur_state = <span class="hljs-number">0</span>;<font></font>
      }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//       ,      </span>
    <span class="hljs-comment">// ,     ""   -  ""  </span>
    <span class="hljs-keyword">if</span> (cur_state != prev_state) {
    <span class="hljs-comment">//   ,   0  - ,     </span>
    <span class="hljs-comment">// </span><font></font>
      enc_tooth += cur_state;<font></font>
    <font></font>
    <span class="hljs-comment">//        </span><font></font>
      prev_state = cur_state;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">//        </span>
  Serial.begin(<span class="hljs-number">115200</span>);<font></font>
<font></font>
  <span class="hljs-comment">//        ""</span><font></font>
  pinMode(M1_A, OUTPUT);<font></font>
  pinMode(M1_B, OUTPUT);<font></font>
<font></font>
  <span class="hljs-comment">//   </span><font></font>
  init_enc();<font></font>
<font></font>
  <span class="hljs-comment">//    </span>
  analogWrite(M1_PWM, <span class="hljs-number">100</span>);<font></font>
 <font></font>
  <span class="hljs-comment">//    ,      1 (    </span>
  <span class="hljs-comment">//  0)</span>
  digitalWrite(M1_A, <span class="hljs-number">1</span>);<font></font>
<font></font>
  <span class="hljs-comment">// ,    30  </span>
  wait_by_count(<span class="hljs-number">30</span>);<font></font>
  <font></font>
  <span class="hljs-comment">//   </span>
  digitalWrite(M1_B, <span class="hljs-number">1</span>);<font></font>
<font></font>
  Serial.print(<span class="hljs-string">"  = "</span>);<font></font>
  Serial.println(enc_tooth);<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program starts the engine and waits until the gear rotates by 30 teeth - just such a number of teeth in the gear, and after that it stops the motor. </font><font style="vertical-align: inherit;">Below is a video that demonstrates the operation of the program:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wS0eODG7zzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On a white piece of paper, which is glued to the gear, you can track its rotation by 360 degrees. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On this I want to end this article. </font><font style="vertical-align: inherit;">In conclusion, I can say that I did not just stop at the encoder model. </font><font style="vertical-align: inherit;">A full-fledged robot platform was assembled with two motors and two encoders (one for each wheel) and a program was made to synchronize wheel rotation according to encoders, but this is a topic for another article ... A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/st/zy/b3/stzyb3ery-ssclsmbwlzghisq24.jpeg" alt="Robot platform with encoders based on IR sensors"><br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">robot platform with encoders based on IR sensors</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As an educational designer in robotics, this is a good option for those children (well, adults) who want to join in such classes, especially since the manufacturer did everything to maximize the age range of those who can use this product (the presence of different programming environments ) </font><font style="vertical-align: inherit;">You can start with the simplest and most elementary elements, and after obtaining basic knowledge, go to another level of development of robotics and electronics.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en503958/index.html">Open API Game: Swagger Play</a></li>
<li><a href="../en503960/index.html">How Linux sort sorts strings</a></li>
<li><a href="../en503962/index.html">Autonomous Driving - hype in cars, but the need for data center network services</a></li>
<li><a href="../en503964/index.html">DataStore - CRUD (Create Read Update Delete)</a></li>
<li><a href="../en503966/index.html">The Social Monitoring app was made from a garbage truck tracker</a></li>
<li><a href="../en503970/index.html">PuppetConf 2016. Kubernetes for system administrators. Part 1</a></li>
<li><a href="../en503972/index.html">Streaming test in 4 social networks and choosing the best option</a></li>
<li><a href="../en503980/index.html">Monitoring temperature at a remote site by ‚Äúimprovised‚Äù means</a></li>
<li><a href="../en503982/index.html">About orcs and frameworks</a></li>
<li><a href="../en503988/index.html">How "swirling light" got into optical networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>