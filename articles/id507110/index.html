<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽🏼 🎅🏿 💃 Cara menemukan kesalahan dalam proyek C #, bekerja di Linux dan macOS 🎅🏻 🧝🏾 🙍🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio adalah penganalisis kode statis terkenal yang memungkinkan Anda menemukan banyak kesalahan rumit yang tersembunyi di sumbernya. Uji beta ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cara menemukan kesalahan dalam proyek C #, bekerja di Linux dan macOS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/507110/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a2/607/d60/6a2607d60720993d5834a2c2e83a6bb1.png" alt="Gambar 8"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio adalah penganalisis kode statis terkenal yang memungkinkan Anda menemukan banyak kesalahan rumit yang tersembunyi di sumbernya. </font><font style="vertical-align: inherit;">Uji beta versi baru baru-baru ini selesai, di mana dimungkinkan untuk menganalisis proyek C # untuk Linux dan macOS. </font><font style="vertical-align: inherit;">Selain itu, alat analisa sekarang dapat diintegrasikan dengan JetBrains Cross-Platform IDE - Rider. </font><font style="vertical-align: inherit;">Artikel ini akan memungkinkan Anda untuk berkenalan dengan fitur-fitur ini pada contoh memeriksa proyek open source RavenDB.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa waktu yang lalu, kolega saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Vasiliev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menulis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">catatan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang pembukaan uji beta versi baru alat analisa statis PVS-Studio yang sedang kami kembangkan. </font><font style="vertical-align: inherit;">Sekarang tes beta selesai dan versi baru dapat diunduh dengan mengklik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pada artikel yang sama, kami akan memeriksa cara menganalisis proyek C # di Linux / macOS menggunakan antarmuka konsol dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rider</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Setelah itu, kami akan melakukan analisis tradisional terhadap beberapa operasi analisa yang menarik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ravendb</font></font></h2><br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/dca/148/5ecdca148f1673576dcd824058b19e63.png" alt="Gambar 5"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk verifikasi, proyek RavenDB terbuka dipilih, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang totalnya hampir 5 ribu file kode sumber. </font><font style="vertical-align: inherit;">Ini adalah basis data NoSQL yang cukup populer. </font><font style="vertical-align: inherit;">Detail dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situs web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mudah ditebak bahwa saya tertarik dengan ukurannya, karena dalam proyek yang sedemikian besar dan, tanpa keraguan, yang serius, mungkin akan ada sesuatu yang menarik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antarmuka Baris Perintah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulai, pertimbangkan cara menganalisis melalui konsol. </font><font style="vertical-align: inherit;">Bagian ini, menurut pendapat saya, akan sangat menarik bagi mereka yang ingin mengintegrasikan alat analisa ke dalam sistem CI. </font><font style="vertical-align: inherit;">Tim yang memulai analisis memiliki sejumlah opsi menarik, tetapi dalam kasus umum, semuanya cukup sepele. </font><font style="vertical-align: inherit;">Untuk menganalisis RavenDB, saya pergi ke folder proyek dan masukkan yang berikut di konsol:</font></font><br>
<br>
<pre><code class="cs hljs">pvs-studio-dotnet -t ./RavenDB.sln </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bendera -t (kependekan dari target) digunakan untuk menentukan solusi atau file proyek untuk verifikasi. </font><font style="vertical-align: inherit;">Baris yang disajikan di atas memulai analisis dan, sebagai hasil dari pekerjaan, membentuk file yang mengandung kesalahan yang ditemukan. </font><font style="vertical-align: inherit;">Sederhana, bukan?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengendara</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bekerja dengan penganalisa di Rider hampir sama dengan di Visual Studio. </font><font style="vertical-align: inherit;">Antarmuka plugin yang sederhana dan intuitif memungkinkan Anda memeriksa proyek hanya dengan beberapa klik. </font><font style="vertical-align: inherit;">Ini bukan berlebihan - untuk melakukan analisis RavenDB, saya hanya perlu mengklik pada menu Tools, arahkan ke "PVS-Studio" dan klik "Periksa Solusi Saat Ini / Proyek".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/105/bd4/a2c105bd4e20693c064b6c1a4f0dc9f5.png" alt="Gambar 2"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasil analisis akan ditampilkan di bagian bawah jendela pada tab PVS-Studio (baik, yang lain? :))</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a4/8d2/477/7a48d2477e60a0038e89c97dbd991406.png" alt="Gambar 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti halnya plug-in untuk Visual Studio, mengklik dua kali pada peringatan akan menampilkan lokasi yang terkait dengannya. Semuanya nyaman dan mudah dimengerti. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih penting lagi, alat PVS-Studio tidak hanya menunjukkan kesalahan, tetapi juga memiliki infrastruktur yang membuatnya mudah untuk menerapkan metodologi analisis statis bahkan dalam proyek lama yang besar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ide umumnya adalah sebagai berikut. Pengguna memulai penganalisa dan menerima banyak peringatan. Karena sebuah proyek yang telah dikembangkan selama bertahun-tahun, masih hidup, berkembang dan menghasilkan uang, maka kemungkinan besar tidak akan ada banyak peringatan dalam laporan yang mengindikasikan cacat kritis. Dengan kata lain, bug kritis telah diperbaiki dengan satu atau lain cara dengan cara yang lebih mahal atau berkat umpan balik dari pelanggan. Karenanya, segala sesuatu yang ditemukan oleh penganalisa sekarang dapat dianggap sebagai hutang teknis, yang tidak praktis untuk segera dihilangkan. Rasional untuk mengabaikan peringatan ini untuk saat ini, tetapi untuk menulis kode baru sudah melakukan analisis rutin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memberi tahu PVS-Studio untuk mempertimbangkan peringatan ini sebagai tidak relevan (menunda utang teknis untuk nanti), dan tidak menunjukkannya lagi. Penganalisis membuat file khusus di mana ia menyimpan informasi tentang kesalahan yang tidak menarik sejauh ini. Dan sekarang PVS-Studio akan mengeluarkan peringatan hanya pada kode baru atau yang diubah. Apalagi semua ini diimplementasikan dengan cerdik. Jika, misalnya, baris kosong ditambahkan ke awal file, maka penganalisa memahami bahwa, pada kenyataannya, tidak ada yang berubah, dan akan tetap diam. File markup ini dapat disematkan dalam sistem kontrol versi. File ini besar, tetapi tidak menakutkan, karena sering kali tidak masuk akal untuk meletakkannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang semua programmer akan melihat peringatan yang terkait dengan kode baru atau yang diubah. Dengan demikian, penganalisa dapat mulai menggunakan apa yang disebut hari berikutnya. Dan akan mungkin untuk kembali ke hutang teknis nanti, dan secara bertahap memperbaiki kesalahan dan mengkonfigurasi analisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menekan peringatan pada kode yang ada di Rider, cukup buka menu atas di Tools-&gt; PVS-Studio dan klik "Suppress All Messages".</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/860/1eb/1d38601ebc120fa0c03d91df2237a8df.png" alt="Gambar 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di jendela yang muncul, memperingatkan bahwa semua operasi saat ini akan jatuh ke dalam daftar penekan, klik "Oke". </font><font style="vertical-align: inherit;">Akibatnya, file penekan akan dibuat di folder proyek, yang akan diperhitungkan oleh penganalisa selama pekerjaan lebih lanjut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa Rider sudah memiliki analisa yang berhasil menyoroti beberapa kesalahan. </font><font style="vertical-align: inherit;">Dengan demikian, serangkaian peringatan dari PVS-Studio menunjukkan kode yang terlihat mencurigakan dari sudut pandang editor. </font><font style="vertical-align: inherit;">Namun demikian, PVS-Studio cukup sering menemukan kesalahan yang bisa lolos dari mata sensitif penganalisa dari JetBrains. </font><font style="vertical-align: inherit;">Itulah sebabnya solusi paling efektif adalah membiarkan mereka bekerja dalam tim.</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/401/c23/d47/401c23d47c7f813c25acd347e7517482.png" alt="Gambar 10"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan untuk pencuci mulut</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, seperti yang dijanjikan, kami akan mempertimbangkan peringatan menarik apa yang ditampilkan oleh analis sesuai dengan hasil verifikasi. Proyek ini berisi sejumlah besar file kode sumber, sehingga tidak mengherankan untuk menemukan banyak momen mencurigakan di dalamnya. Tidak ada yang harus dilakukan - semua orang membuat kesalahan, tetapi penting untuk melakukan segala upaya untuk mendeteksi dan memperbaikinya tepat waktu. Analisis statis dapat sangat menyederhanakan tugas ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari cek, sekitar seribu peringatan ditampilkan:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a6/3d4/124/2a63d41242fd337aaff1753454f8a79c.png" alt="Gambar 11"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat membaca lebih lanjut tentang tingkat peringatan dengan mengklik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, tidak semua pemicu mengindikasikan kesalahan super-menakutkan. </font><font style="vertical-align: inherit;">Jika demikian, tidak mungkin setidaknya ada sesuatu yang berhasil dalam proyek :). </font><font style="vertical-align: inherit;">Tetapi penting untuk dipahami bahwa jika penganalisa "bersumpah", maka kodenya terlihat aneh dan harus dipelajari dengan cermat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, proyek ini menemukan banyak hal positif yang menarik. </font><font style="vertical-align: inherit;">Namun demikian, saya tidak ingin artikelnya menjadi sangat besar, jadi kami hanya akan mempertimbangkan beberapa di antaranya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hanya cek ekstra?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsurePathExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> dirpath = Path.GetDirectoryName(file);<font></font>
  List&lt;<span class="hljs-keyword">string</span>&gt; dirsToCreate = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();
  <span class="hljs-keyword">while</span> (Directory.Exists(dirpath) == <span class="hljs-literal">false</span>)<font></font>
  {<font></font>
    dirsToCreate.Add(dirpath);<font></font>
    dirpath = Directory.GetParent(dirpath).ToString();<font></font>
    <span class="hljs-keyword">if</span> (dirpath == <span class="hljs-literal">null</span>)                                  <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
  dirsToCreate.ForEach(x =&gt; Directory.CreateDirectory(x));<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'dirpath == null' selalu salah. PosixHelper.cs (124) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Operasi ini dapat dianggap dengan cara yang berbeda. Di satu sisi, pemeriksaan tambahan tentu saja tidak terlalu baik, tetapi dengan sendirinya itu bukan kesalahan. Di sisi lain, ada baiknya mempertimbangkan: apakah kode ini benar-benar berfungsi seperti yang dimaksudkan oleh programmer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin pengembang benar-benar tidak tahu bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak akan pernah mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika tidak demikian, maka kita dapat membuat asumsi tentang apa yang ingin dia raih. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus dipanggil ketika tidak mungkin untuk mendapatkan orang tua untuk direktori yang dimaksud. Jika demikian, maka periksa untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masuk akal. </font><font style="vertical-align: inherit;">Namun, kita perlu mempertimbangkan bukan hasil dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi nilai yang dikembalikan oleh metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">dirsToCreate.Add(dirpath);
<span class="hljs-keyword">var</span> dir = Directory.GetParent(dirpath);    
<span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>)
  <span class="hljs-keyword">break</span>;<font></font>
<font></font>
dirpath = dir.ToString();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika tidak, mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetParent melempar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pengecualian saat memanggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null khas</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">ScanOldest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; copy.Length; i++)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> item = copy[i].Value;
    <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span> || item == InvalidLowLevelTransaction) <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      <span class="hljs-keyword">if</span> (val &gt; item.Id)                                    <span class="hljs-comment">// &lt;=</span><font></font>
        val = item.Id;<font></font>
    }<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'item' digunakan setelah diverifikasi terhadap nol. Periksa baris: 249, 247. ActiveTransactions.cs (249), ActiveTransactions.cs (247) Voron </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini terlihat aneh karena apa yang terjadi ketika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item tersebut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> benar </font><i><font style="vertical-align: inherit;">-</font></i><font style="vertical-align: inherit;"> benar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Memang, jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juga </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kondisinya benar dan upaya untuk mendapatkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item. Saya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan melempar pengecualian. Dan jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak boleh </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka syarat " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == InvalidLowLevelTransaction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"itu hanya berlebihan. Ini karena ia diperiksa hanya ketika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nah, jika tiba-tiba </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak dapat </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka seluruh kondisi kehilangan artinya dan hanya menambah sarang yang tidak perlu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya pikir, mungkin, operator logika yang salah dipilih. Jika Anda mengganti "||" dengan "&amp;&amp;" dalam kondisi tersebut, kode segera mulai terlihat logis. Nah, tidak ada masalah yang muncul dalam kasus ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rencana semacam itu merupakan tipikal dari kesalahan yang sangat berbahaya dalam teori yang terdeteksi oleh penganalisa. Dalam keadilan, perlu dicatat bahwa alat analisa yang dibangun pada Rider juga menandai fragmen ini sebagai berpotensi berbahaya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cek lagi?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteObjectEnd</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (_continuationState.Count &gt; <span class="hljs-number">1</span>)<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> outerState = <font></font>
      _continuationState.Count &gt; <span class="hljs-number">0</span> ? _continuationState.Pop() : currentState<font></font>
    ;<font></font>
    <span class="hljs-keyword">if</span> (outerState.FirstWrite == <span class="hljs-number">-1</span>)<font></font>
      outerState.FirstWrite = start;<font></font>
    _continuationState.Push(outerState);<font></font>
  }  <font></font>
   ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '_continuationState.Count&gt; 0' selalu benar. </font><font style="vertical-align: inherit;">ManualBlittableJsonDocumentBuilder.cs (152) Sparrow </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, dalam kondisi eksternal, diperiksa bahwa jumlah elemen dalam koleksi lebih besar dari 1, dan kemudian pada baris berikutnya operator ternary memeriksa bahwa jumlahnya lebih besar dari 0. Tampaknya salah satu cek akan terlihat berbeda. </font><font style="vertical-align: inherit;">Dengan satu atau lain cara, kode ini terlihat sangat mencurigakan dan harus dipelajari dan diproses dengan hati-hati jika perlu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemungkinan NRE</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Expression <span class="hljs-title">VisitIndex</span>(<span class="hljs-params">IndexExpression node</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (node.Object != <span class="hljs-literal">null</span>)<font></font>
  {<font></font>
    Visit(node.Object);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    Out(node.Indexer.DeclaringType.Name); <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (node.Indexer != <span class="hljs-literal">null</span>)               <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    Out(<span class="hljs-string">"."</span>);<font></font>
    Out(node.Indexer.Name);<font></font>
  }<font></font>
  VisitExpressions(<span class="hljs-string">'['</span>, node.Arguments, <span class="hljs-string">']'</span>);
  <span class="hljs-keyword">return</span> node;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'node.Indexer' digunakan sebelum diverifikasi terhadap nol. Periksa baris: 1180, 1182. ExpressionStringBuilder.cs (1180), ExpressionStringBuilder.cs (1182) Raven. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, ini adalah tempat lain yang PVS-Studio dan Rider anggap mencurigakan. Benar, kata-katanya agak berbeda: penganalisa dari JetBrains hanya menyoroti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer. Mengumumkan Jenis</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan komentar "Kemungkinan NullReferenceException". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua pengulas mengklaim bahwa pengecualian memang dapat dilemparkan ke dalam fragmen ini. Saya harus mengatakan bahwa peringatan dari PVS-Studio tidak hanya mengatakan bahwa kesalahan mungkin terjadi di sini, tetapi juga menjelaskan mengapa ia memiliki pendapat seperti itu. Tampaknya sepele, tapi bagus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, itu bukan fakta bahwa memang ada kesalahan. </font><font style="vertical-align: inherit;">Ada kemungkinan bahwa jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tepat ditentukan. </font><font style="vertical-align: inherit;">Dalam kasus ini, situasi diperbolehkan ketika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node.Indexer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keduanya tidak </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hanya dalam kasus ini operasi yang diberikan dari kedua analis dianggap salah. </font><font style="vertical-align: inherit;">Oleh karena itu, ada baiknya untuk hati-hati menganalisis semua opsi yang mungkin.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan jika Anda menggali lebih dalam?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LoadStartingWithInternal</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">var</span> command = operation.CreateRequest();
  <span class="hljs-keyword">if</span> (command != <span class="hljs-literal">null</span>)                       <span class="hljs-comment">// &lt;=</span><font></font>
  {<font></font>
    <span class="hljs-keyword">await</span> RequestExecutor<font></font>
      .ExecuteAsync(command, Context, SessionInfo, token)<font></font>
      .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
    ;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (stream != <span class="hljs-literal">null</span>)<font></font>
      Context.Write(stream, command.Result.Results.Parent);<font></font>
    <span class="hljs-keyword">else</span><font></font>
      operation.SetResult(command.Result);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Pernyataan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'perintah! = Null' selalu benar. AsyncDocumentSession.Load.cs (175) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan dikeluarkan karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metode CreateRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak pernah mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Faktanya, lihat saja kodenya untuk melihat ini:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> GetDocumentsCommand <span class="hljs-title">CreateRequest</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  _session.IncrementRequestCount();<font></font>
  <span class="hljs-keyword">if</span> (Logger.IsInfoEnabled)<font></font>
    Logger.Info(....);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetDocumentsCommand(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, pemeriksaan ini bukan masalah seperti itu, meskipun mungkin metode yang digunakan untuk mengembalikan nol dalam keadaan tertentu, tetapi sekarang melempar pengecualian. </font><font style="vertical-align: inherit;">Siapa tahu, ada kemungkinan bahwa alih-alih memeriksa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sekarang harus ada try-catch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin memiliki pertanyaan yang sangat masuk akal: di mana pengecualian dilemparkan di sini? </font><font style="vertical-align: inherit;">Jika tidak, maka kami masih memiliki pemeriksaan tambahan, dan tidak ada kesalahan di sini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun sayang, ketika metode ini dijalankan, pengecualian memang bisa dilemparkan, apalagi, dua kali. </font><font style="vertical-align: inherit;">Pertama dalam metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IncrementRequestCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementRequestCount</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (++NumberOfRequests &gt; MaxNumberOfRequestsPerSession)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(....);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian, dalam konstruktor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetDocumentsCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetDocumentsCommand</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> startWith, ....</span>)</span><font></font>
{<font></font>
  _startWith = startWith ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(startWith));<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salin-tempel tradisional</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteTo</span>(<span class="hljs-params">StringBuilder writer</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (SqlConnectionStringsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(SqlConnectionStringsUpdated)] = SqlConnectionStringsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (PeriodicBackupsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(PeriodicBackupsUpdated)] = PeriodicBackupsUpdated;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (ExternalReplicationsUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ExternalReplicationsUpdated)] = ExternalReplicationsUpdated;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3127</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dua fragmen kode serupa ditemukan. Mungkin ini salah ketik. SmugglerResult.cs (256), SmugglerResult.cs (253) Raven.Client Saya </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sangat ragu bahwa setidaknya seseorang akan melihat keanehan di sini dengan melihat kode. Fungsi ini terdiri dari 14 kondisi yang sama dan semua variabel berakhir dengan Diperbarui. Bahkan ketika sebagian kecil diberikan di sini, kesalahannya tidak segera terlihat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otak manusia secara harfiah menolak untuk mencari apa pun dalam kode semacam itu. Pada saat yang sama, PVS-Studio dengan mudah menemukan bahwa itu ditugaskan, kemungkinan besar, itu sepenuhnya salah, seharusnya:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (ClientConfigurationUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ClientConfigurationUpdated)] = ClientConfigurationUpdated;<font></font>
<font></font>
<span class="hljs-keyword">if</span> (ConflictSolverConfigUpdated)<font></font>
    json[<span class="hljs-keyword">nameof</span>(ConflictSolverConfigUpdated)] = ClientConfigurationUpdated;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adalah logis bahwa garis bawah di sebelah kanan operator penugasan harus </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConflictSolverConfigUpdated</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya yakin bahwa tanpa analisis statis, keanehan ini akan ditemukan hanya jika sesuatu yang cukup serius telah rusak karenanya. </font><font style="vertical-align: inherit;">Programmer akan dapat memperhatikan bahwa suatu masalah tersembunyi dalam fungsi ini, kecuali hanya jika ia mengetahuinya terlebih dahulu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh itu "??"</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Count =&gt; <font></font>
  _documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mungkin '??' Operator bekerja dengan cara yang berbeda dari yang diharapkan. Prioritasnya lebih rendah daripada prioritas operator lain di bagian kirinya. InMemoryDocumentSessionOperations.cs (1952) Raven.Client </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, masih ada kemungkinan bahwa ini bukan kesalahan sama sekali, itulah yang dimaksudkan. Namun tempat ini terlihat sangat mencurigakan. Lagi pula, logis untuk mengasumsikan bahwa gagasan fungsi ini bukan untuk mengembalikan 0 dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_onBeforeStoreDocumentsByEntity == null.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Saya pikir benar-benar ada kesalahan terkait dengan prioritas operator. Dalam hal ini, Anda harus meletakkan tanda kurung:</font></font><br>
<br>
<pre><code class="cs hljs">_documentsByEntity.Count + (_onBeforeStoreDocumentsByEntity?.Count ?? <span class="hljs-number">0</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, jika tiba-tiba semuanya benar-benar direncanakan, maka mungkin Anda harus menunjukkannya secara eksplisit - maka penganalisa dan pemrogram yang membaca kode tidak akan memiliki pertanyaan:</font></font><br>
<br>
<pre><code class="cs hljs">(_documentsByEntity.Count + _onBeforeStoreDocumentsByEntity?.Count) ?? <span class="hljs-number">0</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi ini masalah selera, tentu saja.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melewati parameter</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateEnvironmentVariableLicenseString</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ValidateLicense(newLicense, rsaParameters, oldLicense) == <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan urutan argumen yang salah diteruskan ke metode 'ValidateLicense': 'newLicense' dan 'oldLicense'. </font><font style="vertical-align: inherit;">LicenseHelper.cs (177) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Argumen diteruskan ke metode dalam urutan yang mencurigakan. </font><font style="vertical-align: inherit;">Faktanya, lihat iklannya:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">ValidateLicense</span>(<span class="hljs-params">
  License oldLicense, 
  RSAParameters rsaParameters, 
  License newLicense
</span>)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat menyenangkan bahwa PVS-Studio dapat menemukan kesalahan seperti itu. </font><font style="vertical-align: inherit;">Ini adalah contoh yang bagus dari pertanyaan tentang manfaat analisis statis daripada analisis dinamis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terlepas dari hal tersebut di atas, saya awalnya menyarankan bahwa mungkin tidak masalah urutan argumen ini. </font><font style="vertical-align: inherit;">Tentu saja, dalam hal ini nama tidak akan dipilih dengan benar, tetapi apa yang dapat Anda lakukan. </font><font style="vertical-align: inherit;">Namun, struktur internal </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidateLicense</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menunjukkan bahwa parameter ini masih memiliki arti yang berbeda. </font><font style="vertical-align: inherit;">Kode fungsi ini dapat dilihat dengan mengklik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan pernah melanjutkan</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;CounterOperation&gt; <span class="hljs-title">GetCounterOperationsFor</span>(<span class="hljs-params">RavenEtlItem item</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; counters.Count; i++)<font></font>
  {<font></font>
    counters.GetPropertyByIndex(i, <span class="hljs-keyword">ref</span> prop);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (<font></font>
      GetCounterValueAndCheckIfShouldSkip(<font></font>
        item.DocumentId, <font></font>
        <span class="hljs-literal">null</span>, <font></font>
        prop, <font></font>
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
        <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete<font></font>
      )<font></font>
    ) <span class="hljs-keyword">continue</span>;<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'GetCounterValueAndCheckIfShouldSkip (item.DocumentId, null, prop, nilai long, bool out delete)' selalu salah. RavenEtlDocumentTransformer.cs (362) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode ini dapat sepenuhnya dipertimbangkan dengan mengklik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peringatan menunjukkan bahwa panggilan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lanjutan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam loop ini tidak dapat dijangkau. Dan jika demikian, maka fragmennya benar-benar aneh. Tapi mungkin itu hanya positif palsu? Namun Rider tidak bersumpah tentang ini. </font><i><font style="vertical-align: inherit;">Lihatlah</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCounterValueAndCheckIfShouldSkip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCounterValueAndCheckIfShouldSkip</span>(<span class="hljs-params">
  LazyStringValue docId, 
  <span class="hljs-keyword">string</span> function, 
  BlittableJsonReaderObject.PropertyDetails prop, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">value</span>, 
  <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> delete
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (prop.Value <span class="hljs-keyword">is</span> LazyStringValue)<font></font>
  {<font></font>
    delete = <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">else</span><font></font>
  {<font></font>
    delete = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">value</span> = CountersStorage.InternalGetCounterValue(<font></font>
      prop.Value <span class="hljs-keyword">as</span> BlittableJsonReaderObject.RawBlob, <font></font>
      docId, <font></font>
      prop.Name<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (function != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> result = BehaviorsScript.Run(<font></font>
        Context, <font></font>
        Context, <font></font>
        function, <font></font>
        <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { docId, prop.Name }<font></font>
      ))<font></font>
      {<font></font>
        <span class="hljs-keyword">if</span> (result.BooleanValue != <span class="hljs-literal">true</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jelas, metode ini hanya dapat mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berfungsi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dalam kode yang dipertimbangkan sebelumnya, tepatnya penunjuk nol dilewatkan ke tempat parameter ini. </font><font style="vertical-align: inherit;">Jadi panggilan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lanjutan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> benar </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">benar tidak dapat dijangkau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Momen ini dapat berupa penghilangan yang tidak berbahaya dan masalah yang terkait dengan beberapa kesalahan dalam kondisi tersebut. </font><font style="vertical-align: inherit;">Dengan satu atau lain cara, Anda harus memperhatikannya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percaya tapi verifikasi</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> LicenseType Type<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (ErrorMessage != <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.Invalid;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> LicenseType.None;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (Attributes != <span class="hljs-literal">null</span> &amp;&amp;                             <span class="hljs-comment">// &lt;=</span>
        Attributes.TryGetValue(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">object</span> type) &amp;&amp;<font></font>
        type <span class="hljs-keyword">is</span> <span class="hljs-keyword">int</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">var</span> typeAsInt = (<span class="hljs-keyword">int</span>)type;
      <span class="hljs-keyword">if</span> (Enum.IsDefined(<span class="hljs-keyword">typeof</span>(LicenseType), typeAsInt))
        <span class="hljs-keyword">return</span> (LicenseType)typeAsInt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> LicenseType.Community;<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu benar jika dievaluasi: Atribut! = Null. </font><font style="vertical-align: inherit;">LicenseStatus.cs (28) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebuah fragmen yang sangat aneh. </font><font style="vertical-align: inherit;">Biasanya, pemeriksaan berlebihan setidaknya entah bagaimana dipisahkan - di sini korespondensi dari variabel ke pointer nol diperiksa langsung di baris berikutnya. </font><font style="vertical-align: inherit;">Tampaknya kode itu, agaknya, sama sekali tidak seperti yang diinginkan oleh programmer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak dapat dibatalkan yang tidak pernah dibatalkan</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)                                  <span class="hljs-comment">// &lt;=</span><font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer Peringatan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expression 'suspend.HasValue' selalu benar. </font><font style="vertical-align: inherit;">RachisAdminHandler.cs (116) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lain cek "ekstra" yang tampaknya tidak berbahaya. </font><font style="vertical-align: inherit;">Meskipun belum jelas mengapa penganalisa menganggapnya demikian. </font><i><font style="vertical-align: inherit;">Beralih</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span>? GetBoolValueQueryString(<span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> boolAsString = GetStringQueryString(name, required);
  <span class="hljs-keyword">if</span> (boolAsString == <span class="hljs-literal">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">bool</span>.TryParse(boolAsString, <span class="hljs-keyword">out</span> <span class="hljs-keyword">bool</span> result) == <span class="hljs-literal">false</span>)<font></font>
    ThrowInvalidBoolean(name, boolAsString);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memang, terkadang fungsi ini mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ya, dan Rider tidak menganggap pemeriksaan itu tidak perlu. </font><font style="vertical-align: inherit;">Apakah Unicorn gagal?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/99d/ab6/34999dab64459aebc38561a25b2bad72.png" alt="Gambar 15"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi bagaimana jika Anda melihat metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetStringQueryString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name, <span class="hljs-keyword">bool</span> required = <span class="hljs-literal">true</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> val = HttpContext.Request.Query[name];
  <span class="hljs-keyword">if</span> (val.Count == <span class="hljs-number">0</span> || <span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(val[<span class="hljs-number">0</span>]))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (required)<font></font>
      ThrowRequiredMember(name);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> val[<span class="hljs-number">0</span>];<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, jika parameter yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diperlukan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , maka metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ThrowRequiredMember</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dipanggil </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Aku ingin tahu apa yang dia lakukan? </font><font style="vertical-align: inherit;">:) Nah, jadi yang pasti tidak ada keraguan lagi:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ThrowRequiredMember</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(
    <span class="hljs-string">$"Query string <span class="hljs-subst">{name}</span> is mandatory, but wasn't specified."</span><font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami meringkas. Pengembang memanggil metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dia mungkin percaya bahwa berpotensi metodenya tidak akan mendapatkan nilai yang diperlukan. Yah, sebagai hasilnya, ia mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Di dalam, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetStringQueryString disebut</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika ada masalah, itu akan mengembalikan nol atau melempar pengecualian. Yang kedua terjadi jika parameter yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diperlukan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diatur ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Selain itu, ini adalah nilai standarnya. Pada saat yang sama, ketika memanggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jika Anda melihat kode di atas, tidak dikirimkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lihat sekali lagi pada kode metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SuspendObserver</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , fragmen yang </font><i><font style="vertical-align: inherit;">dianalisa</font></i><font style="vertical-align: inherit;"> oleh penganalisa:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">SuspendObserver</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (ServerStore.IsLeader())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> suspend = GetBoolValueQueryString(<span class="hljs-string">"value"</span>);
    <span class="hljs-keyword">if</span> (suspend.HasValue)<font></font>
    {<font></font>
      Server.ServerStore.Observer.Suspended = suspend.Value;<font></font>
    }<font></font>
<font></font>
    NoContentStatus();<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
  }<font></font>
<font></font>
  RedirectToLeader();<font></font>
<font></font>
  <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya, secara desain, utas tidak boleh terputus di sini jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak bisa mendapatkan nilai. Bahkan, setelah blok dengan cek untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , berbagai tindakan dilakukan dan nilai dikembalikan. Saya percaya bahwa, secara desain, tindakan ini dilakukan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terlepas dari</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> keberhasilan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apa yang sebenarnya akan terjadi? Utas eksekusi akan terganggu oleh pengecualian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk titik ini benar, Anda memerlukan panggilan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetBoolValueQueryString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lulus sebagai parameter kedua </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diperlukan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menjadi false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Maka semuanya akan benar-benar berfungsi seperti yang diharapkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang saya katakan sebelumnya, kadang-kadang tampaknya penganalisa keliru (apa yang harus disembunyikan, terkadang itu terjadi). </font><font style="vertical-align: inherit;">Juga cukup sering, peringatan itu terlihat tidak signifikan. </font><font style="vertical-align: inherit;">Tampaknya ada pemeriksaan tambahan di sini, dan oke. </font><font style="vertical-align: inherit;">Baik, atau bahkan lebih baik - kami menghapusnya dan tidak ada masalah - peringatan akan hilang! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan dalam kasus di mana operasi tampak aneh dan tidak dapat dipahami, jangan buru-buru menandainya sebagai salah. </font><font style="vertical-align: inherit;">Anda perlu mencoba memahami mengapa penganalisa menganggap tempat itu bermasalah dan membuat keputusan setelah itu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keanehan</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">WriteDocumentsJsonAsync</span>(<span class="hljs-params">...., <span class="hljs-keyword">int</span> numberOfResults</span>) <span class="hljs-comment">// &lt;=</span></span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (
    <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> AsyncBlittableJsonTextWriter(<font></font>
      context, <font></font>
      ResponseBodyStream(), <font></font>
      Database.DatabaseShutdown<font></font>
    )<font></font>
  )<font></font>
  {<font></font>
    writer.WriteStartObject();<font></font>
    writer.WritePropertyName(<span class="hljs-keyword">nameof</span>(GetDocumentsResult.Results));<font></font>
    numberOfResults = <span class="hljs-keyword">await</span> writer.WriteDocumentsAsync(                    <span class="hljs-comment">// &lt;=</span><font></font>
      context, <font></font>
      documentsToWrite, <font></font>
      metadataOnly<font></font>
    );<font></font>
<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> numberOfResults;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter 'numberOfResults' selalu ditulis ulang dalam tubuh metode sebelum digunakan. </font><font style="vertical-align: inherit;">DocumentHandler.cs (273), DocumentHandler.cs (267) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parameter yang diteruskan ke fungsi tidak digunakan, tetapi segera ditimpa. </font><font style="vertical-align: inherit;">Mengapa ini dibutuhkan di sini? </font><font style="vertical-align: inherit;">Mereka ingin meneruskannya melalui referensi? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin tahu bagaimana metode ini digunakan dalam kode yang ada. </font><font style="vertical-align: inherit;">Saya berharap karena ini bersifat pribadi, seharusnya tidak ada terlalu banyak. </font><font style="vertical-align: inherit;">Berkat Rider, saya dengan mudah menemukan di mana panggilan itu dibuat. </font><font style="vertical-align: inherit;">Ini satu-satunya tempat:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetDocumentsByIdAsync</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....            <font></font>
  <span class="hljs-keyword">int</span> numberOfResults = <span class="hljs-number">0</span>;<font></font>
<font></font>
  numberOfResults = <span class="hljs-keyword">await</span> WriteDocumentsJsonAsync(<font></font>
    context, <font></font>
    metadataOnly, <font></font>
    documents, <font></font>
    includes, <font></font>
    includeCounters?.Results, <font></font>
    numberOfResults<font></font>
  );<font></font>
<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel diberikan 0, lalu diteruskan ke metode, yang hasilnya ditugaskan untuk itu. </font><font style="vertical-align: inherit;">Dan di dalam metode ini, parameter ini tidak digunakan dengan cara apa pun. </font><font style="vertical-align: inherit;">Em. </font><font style="vertical-align: inherit;">Mengapa semua ini?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/e29/1cf/74ae291cf3c642aafc84c5bfce7ed18e.png" alt="Gambar 6"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator logis salah</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> OrderByField <span class="hljs-title">ExtractOrderByFromMethod</span>(<span class="hljs-params">....</span>)</span><font></font>
{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (me.Arguments.Count &lt; <span class="hljs-number">2</span> &amp;&amp; me.Arguments.Count &gt; <span class="hljs-number">3</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryException(....);<font></font>
  ....<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'me.Arguments.Count &lt;2 &amp;&amp; me.Arguments.Count&gt; 3' selalu salah. </font><font style="vertical-align: inherit;">Mungkin '||' </font><font style="vertical-align: inherit;">Operator harus digunakan di sini. </font><font style="vertical-align: inherit;">QueryMetadata.cs (861) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode lengkap dapat dilihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kali ini kami memiliki kesalahan yang jelas, yang terdiri dari penggunaan operator logika yang salah. </font><font style="vertical-align: inherit;">Dalam bentuknya saat ini, memeriksa jumlah argumen sama sekali tidak berfungsi, karena tidak ada nilai yang keduanya kurang dari 2 dan lebih dari 3. Maksud sebenarnya pengembang mudah diungkapkan oleh argumen pertama yang diteruskan ke konstruktor pengecualian:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-string">"Invalid ORDER BY 'spatial.distance(from, to, roundFactor)' call, 
expected 2-3 arguments, got "</span> + me.Arguments.Count<font></font>
   ,    <span class="hljs-string">"&amp;&amp;"</span>  <span class="hljs-string">"||"</span>.</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode coba aneh</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Operator</span>(<span class="hljs-params">OperatorField fieldOption, <span class="hljs-keyword">out</span> QueryExpression op</span>)</span><font></font>
{ <font></font>
  ....<font></font>
  <span class="hljs-keyword">switch</span> (match)<font></font>
  {<font></font>
    ....<font></font>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"("</span>:
      <span class="hljs-keyword">var</span> isMethod = Method(field, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> method); <span class="hljs-comment">// &lt;=</span><font></font>
      op = method;<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (isMethod &amp;&amp; Operator(OperatorField.Optional, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodOperator))<font></font>
      {<font></font>
        ....<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> isMethod;<font></font>
    ....<font></font>
  }<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu benar jika dievaluasi: isMethod. QueryParser.cs (1797) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode lengkap dapat dilihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konstruk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var isMethod = Metode (bidang, metode keluar var)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengingatkan saya pada metode standar seperti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.TryParse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Metode seperti itu berusaha mendapatkan hasilnya dan menuliskannya ke variabel keluar, dan bendera keberhasilan operasi adalah nilai balik. Kode yang menggunakan fungsi tersebut biasanya memeriksa nilai balik, dan kemudian melakukan operasi tertentu berdasarkan nilai itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menurut pendapat saya, </font><i><font style="vertical-align: inherit;">Metode</font></i><font style="vertical-align: inherit;"> berfungsi</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">digunakan di sini dengan cara ini. Hasil dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di samping itu, adalah nilai balik dari metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Operator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memanggilnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alat analisis menunjukkan bahwa variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isMethod akan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan verifikasi dalam kondisi tidak berarti. Ini berarti bahwa fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak pernah mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lalu apa gunanya konstruksi seperti itu? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memulainya, pastikan bahwa analisa itu tidak salah:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Method</span>(<span class="hljs-params">FieldExpression field, <span class="hljs-keyword">out</span> MethodExpression op</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> args = ReadMethodArguments();<font></font>
<font></font>
  op = <span class="hljs-keyword">new</span> MethodExpression(field.FieldValue, args);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memang, nilai balik dari metode ini selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dan jika semuanya direncanakan seperti semula, maka ini ... aneh, tetapi pada dasarnya tidak masalah. Tetapi bagaimana jika tidak? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadMethodArguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang kodenya dapat dilihat di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , melempar pengecualian dalam beberapa kasus. Ini terjadi ketika suatu metode tidak dapat melakukan tugasnya dengan benar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya kode yang memanggil fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak dirancang untuk melempar pengecualian. Kemungkinan besar, diasumsikan bahwa ketika tidak mungkin untuk mendapatkan nilai variabel keluar dengan benar, fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan kembali </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Namun, dengan implementasi saat ini, pengecualian akan dilemparkan sebagai gantinya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimanapun, perlu memperhatikan fragmen ini.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null! = null?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Address <span class="hljs-title">GetNextEdge</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (m_curEdgeBlock == <span class="hljs-literal">null</span> || m_curEdgeBlock.Count &lt;= m_curEdgeIdx)<font></font>
  {<font></font>
    m_curEdgeBlock = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (m_edgeBlocks.Count == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error not enough edge data.  Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> nextEdgeBlock = m_edgeBlocks.Dequeue();
    <span class="hljs-keyword">if</span> (<font></font>
      m_curEdgeBlock != <span class="hljs-literal">null</span> &amp;&amp;                       <span class="hljs-comment">// &lt;=</span>
      nextEdgeBlock.Index != m_curEdgeBlock.Index + <span class="hljs-number">1</span><font></font>
    )<font></font>
    {<font></font>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationException(
        <span class="hljs-string">"Error expected Node Index "</span> + (m_curEdgeBlock.Index + <span class="hljs-number">1</span>) + 
        <span class="hljs-string">" Got "</span> + nextEdgeBlock.Index + <span class="hljs-string">" Giving up on heap dump."</span><font></font>
      );<font></font>
    }<font></font>
<font></font>
    m_curEdgeBlock = nextEdgeBlock;<font></font>
    m_curEdgeIdx = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> m_curEdgeBlock.Values(m_curEdgeIdx++).Target;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu salah jika dievaluasi: m_curEdgeBlock! = Null. </font><font style="vertical-align: inherit;">DotNetHeapDumpGraphReader.cs (803) Raven.Debug </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel diberikan pointer nol, dan kemudian setelah beberapa baris diperiksa untuk ketimpangan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nolnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dalam hal ini, kode yang memeriksa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nextEdgeBlock.Index! = M_curEdgeBlock.Index + 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menjadi tidak berarti </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Selain itu, pengecualian tidak akan pernah dilempar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adalah logis untuk berasumsi bahwa sesuatu tidak berfungsi sebagaimana mestinya, karena fragmennya terlihat sangat aneh. </font><font style="vertical-align: inherit;">Entah cek tidak diperlukan di sini sama sekali, atau entah bagaimana diterapkan dengan tidak benar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat mempertimbangkan untuk memicu dan, sebaliknya, beralih dari yang sebaliknya. </font><font style="vertical-align: inherit;">Mari kita coba bayangkan situasi di mana respons ini salah. </font><font style="vertical-align: inherit;">Saya pikir ini hanya mungkin jika nilai variabel dapat diubah dengan memanggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deque</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Namun, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah bidang pribadi, dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_edgeBlocks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah antrian standar yang diinisialisasi di kelas yang sama. </font><font style="vertical-align: inherit;">Dengan demikian, sangat diragukan bahwa panggilan ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat mempengaruhi nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_curEdgeBlock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Karena itu, pemicunya kemungkinan besar tidak salah.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama atau nol</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt; <span class="hljs-title">FindSpecialColumns</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> tableSchema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> mainSchema = GetTable(tableSchema, tableName);<font></font>
<font></font>
  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">string</span>&gt;();<font></font>
  mainSchema.PrimaryKeyColumns.ForEach(x =&gt; result.Add(x)); <span class="hljs-comment">// &lt;=</span><font></font>
<font></font>
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> fkCandidate <span class="hljs-keyword">in</span> Tables)
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tableReference <span class="hljs-keyword">in</span> fkCandidate.References.Where(<font></font>
        x =&gt; x.Table == tableName &amp;&amp; x.Schema == tableSchema<font></font>
      )<font></font>
    )<font></font>
    {<font></font>
      tableReference.Columns.ForEach(x =&gt; result.Add(x));<font></font>
    }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3146</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan null dereference dari 'mainSchema'. 'Tables.FirstOrDefault' dapat mengembalikan nilai nol default. DatabaseSchema.cs (31) Raven.Server Operasi </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, pada pandangan pertama, mungkin tampak tidak bisa dipahami. Memang, apa hubungannya </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan </font><i><font style="vertical-align: inherit;">itu</font></i><font style="vertical-align: inherit;"> ? Untuk memperjelas mengapa penganalisis bersumpah, Anda perlu melihat fungsi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> TableSchema <span class="hljs-title">GetTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> schema, <span class="hljs-keyword">string</span> tableName</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">return</span> Tables.FirstOrDefault(<font></font>
    x =&gt; x.Schema == schema &amp;&amp; x.TableName == tableName<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Panggilan ke metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bukan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mungkin disebabkan oleh fakta bahwa koleksi mungkin tidak mengandung elemen yang cocok dengan kondisi yang ditentukan. Dalam hal ini, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan, karenanya, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TableSchema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah tipe referensi. Itulah sebabnya PVS-Studio mengatakan bahwa dalam kode ini upaya untuk melakukan dereferensi pointer nol dapat terjadi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mungkin masih layak untuk memeriksa kasus seperti itu sehingga eksekusi tidak mengganggu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika opsi di mana </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tables.FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol tidak</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mungkin, maka tidak ada gunanya menggunakan</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FirstOrDefault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alih-alih </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selalu benar</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">VerifyCanExecuteCommand</span>(<span class="hljs-params">
  ServerStore store, TransactionOperationContext context, <span class="hljs-keyword">bool</span> isClusterAdmin
</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">using</span> (context.OpenReadTransaction())<font></font>
  {<font></font>
    <span class="hljs-keyword">var</span> read = store.Cluster.GetCertificateByThumbprint(context, Name);
    <span class="hljs-keyword">if</span> (read == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> definition = JsonDeserializationServer.CertificateDefinition(read);
    <span class="hljs-keyword">if</span> (<font></font>
      definition.SecurityClearance != SecurityClearance.ClusterAdmin || <span class="hljs-comment">// &lt;=</span>
      definition.SecurityClearance != SecurityClearance.ClusterNode     <span class="hljs-comment">// &lt;=</span><font></font>
    )<font></font>
      <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  AssertClusterAdmin(isClusterAdmin);<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan Analyzer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selalu benar. </font><font style="vertical-align: inherit;">Mungkin operator '&amp;&amp;' harus digunakan di sini. </font><font style="vertical-align: inherit;">DeleteCertificateFromClusterCommand.cs (21) Raven.Server </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh lain dari situasi di mana operator logika yang salah kemungkinan besar dipilih. </font><font style="vertical-align: inherit;">Dalam hal ini, kondisi selalu benar, karena variabel pasti tidak sama dengan setidaknya satu dari nilai yang dibandingkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya percaya bahwa "||" </font><font style="vertical-align: inherit;">harus diganti dengan "&amp;&amp;". </font><font style="vertical-align: inherit;">Maka yang tertulis akan masuk akal. </font><font style="vertical-align: inherit;">Namun jika operator logis dipilih dengan benar, maka kemungkinan besar salah satu syaratnya adalah perbandingan variabel lain. </font><font style="vertical-align: inherit;">Dengan satu atau lain cara, fragmen ini terlihat sangat mencurigakan dan harus dianalisis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, saya ingin mengucapkan terima kasih kepada semua orang yang sampai di tempat ini. Artikel ini cukup panjang, tapi saya harap Anda tertarik untuk bekerja dengan saya pada versi baru alat analisa PVS-Studio dan mempelajari kesalahan yang ditemukan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penting untuk diingat bahwa pengembang harus menetapkan sebagai tujuan utamanya untuk tidak mengurangi jumlah operasi. Bukan untuk mencapai log kesalahan kosong, Anda harus menggunakan PVS-Studio. Melawan hal positif sama halnya dengan memerangi gejala penyakit yang menjadi sumber kode sumber.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat melihat pesan penganalisa, Anda harus selalu mencoba memahami mengapa peringatan ini atau itu dikeluarkan. </font><font style="vertical-align: inherit;">Hanya dengan menyadari logika yang digunakan oleh penganalisa untuk mengeluarkan peringatan, kita dapat menyimpulkan apakah itu mengindikasikan kesalahan atau tidak. </font><font style="vertical-align: inherit;">Dalam hal ini Anda tidak akan bertarung dengan gejalanya, tetapi dengan penyakitnya. </font><font style="vertical-align: inherit;">Dan begitulah kode Anda akan menjadi lebih bersih dan lebih sehat. </font><font style="vertical-align: inherit;">Dan tentu saja, akan ada jauh lebih sedikit masalah dengan sumber yang hebat. </font><font style="vertical-align: inherit;">Meskipun lebih baik saya berharap Anda tidak memilikinya sama sekali :)</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ca9/91e/843ca991e0e2688c6dc6a299fe3af231.png" alt="Gambar 16"></div><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Nikita Lipilin. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cara menemukan kesalahan dalam proyek C # yang bekerja di Linux dan macOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id507086/index.html">Ubah skrip Bash ke kode C # untuk mengirim SMS melalui modem usb HUAWEI E3372</a></li>
<li><a href="../id507090/index.html">Bagaimana tim teknologi dapat membangun startup mereka, atau jalur dari pemantauan fungsional ke platform AIOps</a></li>
<li><a href="../id507092/index.html">Kami mengundang Anda ke mitap online kedua Zabbix</a></li>
<li><a href="../id507104/index.html">Perpecahan besar dalam impor: mengklarifikasi ketidakpastian dengan impor dalam naskah</a></li>
<li><a href="../id507106/index.html">Bagaimana implementasi DNS-over-HTTPS</a></li>
<li><a href="../id507112/index.html">PayOnline | Memperoleh Internet untuk Bisnis</a></li>
<li><a href="../id507114/index.html">Ode Excel: 34 Tahun Sihir</a></li>
<li><a href="../id507116/index.html">"Udalenka". Catatan dari pengembang kantor kemarin. Bagian 2</a></li>
<li><a href="../id507124/index.html">PDB bukan hanya bulu yang berharga</a></li>
<li><a href="../id507132/index.html">Vladimir Kitov: "Tidak mungkin untuk memahami bagaimana para ilmuwan perintis meramalkan komputerisasi universal pada 1950-an!"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>