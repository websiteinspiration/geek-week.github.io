<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ï üòú üè¢ In den meisten F√§llen ist eine Serialisierung in Android nicht erforderlich üôÄ üÜñ üê©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR: In den meisten Anwendungen ist es sinnvoll, eine explizite bewusste Architekturentscheidung zu treffen, bei der die Anwendung im Falle eines P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>In den meisten F√§llen ist eine Serialisierung in Android nicht erforderlich</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489746/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR: In den meisten Anwendungen ist es sinnvoll, eine explizite bewusste Architekturentscheidung zu treffen, bei der die Anwendung im Falle eines Prozesstodes einfach von Grund auf neu gestartet wird, ohne zu versuchen, den Status wiederherzustellen. </font><font style="vertical-align: inherit;">Und in diesem Fall </font></font><code>Serializable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden </font></font><code>Parcelable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">andere </font></font><code>Bundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht ben√∂tigt.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befindet sich mindestens eine Anwendungsaktivit√§t zwischen </font></font><code>onStart()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>onStop()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ist garantiert, dass die Aktivit√§t und damit der Prozess, in dem die Aktivit√§t ausgef√ºhrt wird, sicher sind. </font><font style="vertical-align: inherit;">In anderen F√§llen kann das Betriebssystem den Anwendungsprozess jederzeit beenden.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich musste keine transparente (dh f√ºr den Benutzer unsichtbare) Verarbeitung des Todes eines Prozesses in einer realen Anwendung implementieren. </font><font style="vertical-align: inherit;">Aber es scheint durchaus machbar zu sein, skizzierte ein funktionierendes Beispiel: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/mychka/resurrection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Idee ist, </font></font><code>onSaveInstanceState()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den gesamten Status der Anwendung </font><font style="vertical-align: inherit;">in jeder Aktivit√§t zu </font><font style="vertical-align: inherit;">speichern und </font></font><code>onCreate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, falls der Prozess abgebrochen wurde, wiederherzustellen:</font></font></p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<font></font>
<font></font>
        ResurrectionApp.ensureState(savedInstanceState)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSaveInstanceState</span><span class="hljs-params">(outState: <span class="hljs-type">Bundle</span>)</span></span> {
        <span class="hljs-keyword">super</span>.onSaveInstanceState(outState)<font></font>
<font></font>
        ResurrectionApp.STATE.save(outState)<font></font>
    }<font></font>
}</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um das Beenden eines Prozesses zu simulieren, k√∂nnen Sie die Anwendung minimieren und den Befehl verwenden</font></font></p><br>
<pre><code class="plaintext hljs">adb shell am kill org.resurrection</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn wir uns entscheiden, den Tod des Prozesses zu behandeln, kann der folgende Aufwand festgestellt werden.</font></font></p><br>
<ol>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code-Komplikation.</font></font></p><br>
<ul>
<li>    ,        ,     ,     .  ,      ,    - .   -   : ,     ,    .</li>
<li>     <code>Serializable</code>/<code>Parcelable</code>.</li>
<li>  ‚Äî    ,      . ,      <code>loading == true</code>   .       ,     ,   <code>loading</code>  <code>false</code>.      TCP-,     .</li>
<li>   ,    <code>Activity#onCreate()</code> ‚Äî ,      ‚Äî            .</li>
</ul><br>
<p> ,  ,      ,     .   ,           ,     ,  -  .</p><br>
</li>
<li><p>   <code>Activity#onSaveInstanceState()</code>     . (,  <code>Activity#isChangingConfigurations == true</code>,   ,  .)   ,      ,   -    .</p><br>
</li>
<li><p>    .       1,        .       /     .</p><br>
</li>
<li><p>.      , , ,        ,    ,         -   .<br>
 , ,   :      ,     .         ,   , ,   .</p><br>
</li>
</ol><br>
<p>     ,         .  ,   ,   foreground .   ,   .</p><br>
<p>   (      )      ,      ,              .<br>
    .   (02.03.2020)    : Facebook, Twitter, WhatsApp, Chrome, Gmail, Yandex.Maps.  : Yandex.Navigator, YouTube,       -, Skype.</p><br>
<p>, ,        .   ,     ,      .     :     ,      .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://github.com/mychka/life-from-scratch</a><br>
  <code>BaseActivity</code>   .  <code>LoginActivity</code>.   "NEXT".   <code>DashboardActivity</code>.  .     </p><br>
<pre><code class="plaintext hljs">adb shell am kill org.lifefromscratch</code></pre><br>
<p>  .  ,   <code>DashboardActivity</code>    <code>LoginActivity#loginShownAt</code>,       .</p><br>
<p>       .         ,     .    ,          :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {<font></font>
<font></font>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">init</span> {
            <span class="hljs-keyword">if</span> (!appStartedNormally) {<font></font>
                APP.startActivity(<font></font>
                    APP.getPackageManager().getLaunchIntentForPackage(<font></font>
                        APP.getPackageName()<font></font>
                    )<font></font>
                );<font></font>
                System.exit(<span class="hljs-number">0</span>)<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p> .      ,     -.</p><br>
<p>    .         ,       .  </p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BinderReference</span>&lt;<span class="hljs-type">T</span>&gt;</span>(<span class="hljs-keyword">val</span> value: T?) : Binder()</code></pre><br>
<p>   <code>Parcel</code>    . ,</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyNonSerializableData</span></span>(<span class="hljs-keyword">val</span> os: OutputStream)<font></font>
<font></font>
<span class="hljs-keyword">val</span> parcel: Parcel = Parcel.obtain()
<span class="hljs-keyword">val</span> obj = MyNonSerializableData(ByteArrayOutputStream())<font></font>
parcel.writeStrongBinder(BinderReference(obj))<font></font>
parcel.setDataPosition(<span class="hljs-number">0</span>)
<span class="hljs-keyword">val</span> obj2 = (parcel.readStrongBinder() <span class="hljs-keyword">as</span> BinderReference&lt;*&gt;).value<font></font>
assert(obj === obj2)</code></pre><br>
<p>  <code>android.os.Binder</code>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://habr.com/ru/post/274635/</a></p><br>
<p>    .        . ,      .   :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> DEFAULT_BUNDLE_KEY = <span class="hljs-string">"com.example.DEFAULT_BUNDLE_KEY.cr5?Yq+&amp;Jr@rnH5j"</span><font></font>
<font></font>
<span class="hljs-keyword">val</span> Any?.bundle: Bundle?
    <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == <span class="hljs-literal">null</span>) <span class="hljs-literal">null</span> <span class="hljs-keyword">else</span> Bundle().also { it.putBinder(DEFAULT_BUNDLE_KEY, BinderReference(<span class="hljs-keyword">this</span>)) }<font></font>
<font></font>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> Bundle?.<span class="hljs-title">value</span><span class="hljs-params">()</span></span>: T =
    <span class="hljs-keyword">this</span>?.getBinder(DEFAULT_BUNDLE_KEY)?.let {
        <span class="hljs-keyword">if</span> (it <span class="hljs-keyword">is</span> BinderReference&lt;*&gt;) it.value <span class="hljs-keyword">as</span> T <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
    } <span class="hljs-keyword">as</span> T<font></font>
<font></font>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> Arg&gt;</span> Fragment.<span class="hljs-title">defaultArg</span><span class="hljs-params">()</span></span> = lazy&lt;Arg&gt;(LazyThreadSafetyMode.NONE) {<font></font>
    arguments.value()<font></font>
}</code></pre><br>
<p>  .  :</p><br>
<pre><code class="kotlin hljs">findNavController(R.id.nav_host_fragment).navigate(<font></font>
    R.id.bbbFragment,<font></font>
    MyNonSerializableData(ByteArrayOutputStream()).bundle<font></font>
)</code></pre><br>
<p>   </p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: MyNonSerializableData <span class="hljs-keyword">by</span> defaultArg()</code></pre><br>
<p>  ‚Äî <code>androidx.lifecycle.ViewModel</code>.     ,  ,     destroy ,    configuration change,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://developer.android.com/reference/androidx/activity/ComponentActivity.html#onRetainCustomNonConfigurationInstance()</a></p><br>
<p>,       ,       ,      .    <code>ViewModel</code> .</p><br>
<p> <code>BinderReference</code>,    <code>androidx.lifecycle.ViewModel</code>,       <code>onSaveInstanceState(outState)</code>/<code>onCreate(savedInstanceState)</code>.  view model    .</p><br>
<p>UPD:   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">kamer</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Dimezis</a>  ,             ,    2.3 (API 9).   .        (,    <code>finish()</code>),    configuration change.      :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://stackoverflow.com/questions/7536988/android-app-out-of-memory-issues-tried-everything-and-still-at-a-loss/7576275#7576275</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://stackoverflow.com/questions/11616575/android-not-killing-activities-from-stack-when-memory-is-low/11616829#11616829</a><br>
   :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">https://issuetracker.google.com/issues/36934944</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sicher zu sein, m√ºssen Sie in den Quellcode von Android eintauchen. </font><font style="vertical-align: inherit;">Wenn es eine Option "Aktivit√§ten nicht behalten" gibt, gibt es im Android-Kernel einen Code, der Aktivit√§ten "sanft" zerst√∂ren kann. </font><font style="vertical-align: inherit;">Mit hoher Wahrscheinlichkeit k√∂nnen Sie sich ein schwieriges Szenario einfallen lassen, wenn dieser Code aufgerufen wird, und dementsprechend </font></font><code>androidx.lifecycle.ViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Gegensatz zu einem Absturz f√ºhren </font></font><code>onSaveInstanceState()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Aber im wirklichen Leben k√∂nnen Sie es anscheinend </font></font><code>androidx.lifecycle.ViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">immer </font><font style="vertical-align: inherit;">noch </font><font style="vertical-align: inherit;">sicher verwenden.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489734/index.html">Scanfenster f√ºr NumPy-Arrays</a></li>
<li><a href="../de489736/index.html">[√úbersetzung] IOC e-Sports Kommuniqu√© und Erkl√§rung</a></li>
<li><a href="../de489740/index.html">Vereinfachen Sie das Schreiben von HTTP-Handlern in Golang</a></li>
<li><a href="../de489742/index.html">Hackathon f√ºr 200 Personen - was Sie organisieren m√ºssen</a></li>
<li><a href="../de489744/index.html">Konvertieren Sie die Infix-Notation in Postfix</a></li>
<li><a href="../de489750/index.html">Verwalten eines Docker-Schwarmclusters mit Swarmpit</a></li>
<li><a href="../de489754/index.html">20 Projektmanagementsysteme, √úbersicht √ºber 100 Chips</a></li>
<li><a href="../de489756/index.html">Erstellen Sie einen Stifteffekt in SVG</a></li>
<li><a href="../de489758/index.html">Winkel: Ein Beispiel f√ºr die Verwendung von NGRX</a></li>
<li><a href="../de489760/index.html">Bewusstsein und Existenz. Quantenmechanik ohne Paradoxien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>