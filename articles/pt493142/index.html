<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏣 🙅🏿 🤱🏻 "Vamos usar o Kubernetes!" Agora você tem 8 problemas 👨🏽‍🎨 👚 😂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se você usa o Docker, o próximo passo lógico parece estar mudando para o Kubernetes, são os K8s, certo? Bem, suponha. No entanto, as soluções projetad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>"Vamos usar o Kubernetes!" Agora você tem 8 problemas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/it-grad/blog/493142/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se você usa o Docker, o próximo passo lógico parece estar mudando para o Kubernetes, são os K8s, certo? </font><font style="vertical-align: inherit;">Bem, suponha. </font><font style="vertical-align: inherit;">No entanto, as soluções projetadas para 500 engenheiros de software que desenvolvem simultaneamente um único aplicativo são bem diferentes das soluções para 50 pessoas. </font><font style="vertical-align: inherit;">E a solução para uma equipe de 5 programadores é outra história. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você trabalha em uma equipe pequena, o Kubernetes provavelmente não é para você. </font><font style="vertical-align: inherit;">Trará muita dor em troca de benefícios extremamente modestos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver por que isso pode acontecer.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo mundo gosta das "partes móveis"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes está se movendo e mudando bastante: conceitos, subsistemas, processos, máquinas, código ... E tudo isso significa muitas dificuldades.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vários carros</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes é um sistema distribuído: possui uma máquina host que controla o resto, trabalhadores. </font><font style="vertical-align: inherit;">Cada máquina realiza trabalhos em contêineres. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, já estamos falando de pelo menos duas máquinas físicas ou virtuais, necessárias apenas para fazê-lo funcionar. </font><font style="vertical-align: inherit;">Mas na verdade você recebe ... apenas um carro. </font><font style="vertical-align: inherit;">Se você estiver escalando (é onde o cão está enterrado!), Você precisará de três, quatro ou talvez até dezessete máquinas virtuais.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muito, muito código</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A base de código Kubernetes no início de março de 2020 inclui mais de 580.000 linhas de código no Go. E este é apenas um código limpo, excluindo comentários, linhas em branco e pacotes de fornecedores. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A revisão de segurança de 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descreve a base de código da seguinte maneira: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“A base de código do Kubernetes tem espaço significativo para melhorias. É grande e complexo, contém grandes seções de código com documentação mínima e um grande número de dependências, incluindo sistemas que não fazem parte do Kubernetes. Também na base de código há muitos casos de reimplementação da lógica, que poderiam ser centralizados no suporte a bibliotecas, o que reduziria a complexidade, simplificaria as correções e reduziria a carga de documentos em várias áreas da base de código. ”</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser honesto, o mesmo pode ser dito sobre muitos outros projetos grandes, mas todo esse código deve funcionar corretamente se você não quiser que seu aplicativo falhe.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complexidade arquitetônica, operacional, configuração e conceitual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes é um sistema abrangente com muitos serviços, sistemas e muito mais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de iniciar seu único aplicativo, você precisará fornecer a seguinte arquitetura bastante simplificada (a imagem original é obtida na documentação do Kubernetes): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w2/rx/h8/w2rxh88tfa7n3dmfhvyrahxjd0k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A documentação conceitual do K8s inclui muitas coisas puramente "educacionais", como o seguinte trecho:</font></font><br>
<blockquote>In Kubernetes, an EndpointSlice contains references to a set of network endpoints. The EndpointSlice controller automatically creates EndpointSlices for a Kubernetes Service when a selector is specified. These EndpointSlices will include references to any Pods that match the Service selector. EndpointSlices group network endpoints together by unique Service and Port combinations.<br>
By default, EndpointSlices managed by the EndpointSlice controller will have no more than 100 endpoints each. Below this scale, EndpointSlices should map 1:1 with Endpoints and Services and have similar performance.</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, entendo do que se trata, mas preste atenção em quantos conceitos você precisa aprender: EndpointSlice, Service, seletor, Pod, Endpoint. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E - sim, na maioria das vezes você não usará todos esses recursos. Portanto, na maioria das vezes você não precisará do Kubernetes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está outro trecho aleatório:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por padrão, o tráfego enviado para um Serviço ClusterIP ou NodePort pode ser roteado para qualquer endereço de back-end do Serviço. </font><font style="vertical-align: inherit;">Desde o Kubernetes 1.7, é possível rotear tráfego "externo" para os Pods em execução no Nó que recebeu o tráfego, mas isso não é suportado pelos Serviços de ClusterIP, e topologias mais complexas - como o roteamento zonalmente - não são possíveis. </font><font style="vertical-align: inherit;">O recurso de topologia de serviço resolve isso, permitindo que o criador do serviço defina uma política para rotear o tráfego com base nos rótulos dos nós dos nós de origem e de destino.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está o que a análise de segurança diz sobre isso:</font></font><br>
<blockquote>Kubernetes —   ,    .   ,     Kubernetes —  ,       ,    ,     .</blockquote><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais você adquire o Kubernetes, mais difícil o processo normal de desenvolvimento se torna: você precisa de todos esses conceitos (Pod, Implantação, Serviço etc.) apenas para fazer seu código funcionar. Portanto, você precisa promover um sistema K8s completo, mesmo apenas para testes através de uma máquina virtual ou contêineres Docker aninhados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, desde que a sua aplicação torna-se mais difícil de ser executado localmente, o desenvolvimento é complicado por muitas opções para resolver este problema, a partir de um ambiente de banco para proxy um processo local de um cluster (eu escrevi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta ferramenta um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par de anos atrás </font><font style="vertical-align: inherit;">) e proxy um processo remoto a uma máquina local ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode escolha qualquer opção, mas nenhuma delas será perfeita. A maneira mais fácil de não usar o Kubernetes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsserviços (essa é uma má ideia)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um problema secundário é que, como o seu sistema permite executar muitos serviços, você deve escrever esses muitos serviços. </font><font style="vertical-align: inherit;">Péssima ideia. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplicação distribuída é difícil de escrever qualidade. </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , quanto mais partes móveis, mais esses problemas interferem no trabalho. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplicativos distribuídos são difíceis de depurar. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você precisará de um tipo completamente novo de ferramentas de depuração e registro, que ainda fornecerão menos do que os logs de um aplicativo monolítico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os microsserviços são uma das técnicas de dimensionamento nas organizações: quando você tem 500 desenvolvedores que atendem a um site produtivo, faz sentido aceitar o custo de um sistema distribuído em larga escala se permitir que as equipes de desenvolvimento trabalhem independentemente. </font><font style="vertical-align: inherit;">Assim, cada equipe de 5 pessoas recebe um único microsserviço e finge que todos os outros microsserviços são serviços externos nos quais você não deve confiar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se toda a sua equipe é composta por 5 pessoas, você tem 20 microsserviços e as circunstâncias de força maior não o obrigam a criar um sistema distribuído; então, em algum lugar que você calculou mal. </font><font style="vertical-align: inherit;">Em vez de 5 pessoas por 1 microsserviço, como nas grandes empresas, você recebe 0,25 pessoas. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes não é útil?</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensionamento</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes pode ser útil se você precisar de uma escalabilidade séria. </font><font style="vertical-align: inherit;">No entanto, vamos ver quais alternativas você tem:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode comprar VMs na nuvem, e elas terão até 416 CPUs virtuais e 8 TB de RAM, ou seja, uma potência completamente desagradável. </font><font style="vertical-align: inherit;">Vai custar um centavo bonito, mas será extremamente simples de fazer.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muitos aplicativos web simples podem ser dimensionados de maneira bastante fácil com serviços como o Heroku.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supõe-se, é claro, que um aumento no número de VMs em funcionamento também funcionará em suas mãos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria dos aplicativos não requer dimensionamento significativo; eles terão otimização de alta qualidade suficiente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O gargalo para dimensionar a maioria dos aplicativos da Web são bancos de dados, não trabalhadores da Web</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Confiabilidade</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais partes móveis, maior o potencial de ocorrência de um erro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os recursos do Kubernetes, aprimorados pelo aumento da confiabilidade (verificações de integridade, implantações contínuas), em muitos casos já podem ser integrados ou implementados com muito mais facilidade. Por exemplo, o nginx pode fazer verificações de saúde nos processos de trabalho e você também pode usar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-autoheal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou algo semelhante para reiniciar automaticamente esses processos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você estiver particularmente preocupado com o tempo de inatividade, o primeiro pensamento que o visitará não deve ser "como reduzo o tempo de inatividade ao implantar de 1 segundo a 1 milissegundo), mas deve ser" como garantir que as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alterações no esquema do banco de dados permitam a reversão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se eu em algum lugar em algum lugar?</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se você precisar de trabalhadores da Web confiáveis ​​sem uma única máquina como ponto de falha, há muitas maneiras de implementar isso sem o Kubernetes. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Melhores práticas?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, não existem boas práticas na natureza. </font><font style="vertical-align: inherit;">Existem apenas práticas recomendadas para cada situação específica. </font><font style="vertical-align: inherit;">Portanto, se algo está em tendência e é popular, isso não significa que seja a escolha certa especificamente para você. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em alguns casos, o Kubernetes é a melhor opção. </font><font style="vertical-align: inherit;">O resto é uma perda de tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A menos que você sinta a necessidade urgente de todas essas complexidades, você tem uma ampla seleção de ferramentas que resolverão seus problemas: Docker Compose para uma máquina, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da Hashicorp </font><font style="vertical-align: inherit;">para orquestração, Heroku e sistemas similares para dimensionamento e algo como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shakemake</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para pipelines de computação.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posfácio do Editor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como um provedor de nuvem, encontramos regularmente uma grande variedade de clientes, desde pequenas startups a grandes organizações com processos de negócios complexos e solicitações de infraestrutura relacionadas. </font><font style="vertical-align: inherit;">Independentemente da qualidade da tecnologia, sempre haverá precedentes nos quais sua aplicação resultará em dificuldades desnecessárias. </font><font style="vertical-align: inherit;">Você deve sempre sair da situação e pesar cuidadosamente os prós e contras das opções disponíveis. </font><font style="vertical-align: inherit;">O autor do artigo engrossou um pouco suas cores, mas sua mensagem é bastante clara: às vezes, para tomar a decisão certa, vale a pena se afastar das tendências e avaliar seu projeto de forma imparcial. </font><font style="vertical-align: inherit;">Isso economizará a força dos desenvolvedores e o uso dos recursos da empresa o tornará mais apropriado.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt493130/index.html">Почему не стоит бояться коронавируса: мифы и почти правда о COVID-2019</a></li>
<li><a href="../pt493132/index.html">Em torno de data.table</a></li>
<li><a href="../pt493136/index.html">FAST VP em Unity Storage: como funciona</a></li>
<li><a href="../pt493138/index.html">Fale comigo: o que os robôs de voz podem fazer hoje</a></li>
<li><a href="../pt493140/index.html">As aventuras de Cipollino: Quarantine IT Quest from Flant</a></li>
<li><a href="../pt493146/index.html">Projetos paralelos emocionantes que você pode fazer hoje</a></li>
<li><a href="../pt493150/index.html">"Remoto" com um roteador Cisco</a></li>
<li><a href="../pt493152/index.html">Redes neurais e mineração de processos: tentando fazer amigos</a></li>
<li><a href="../pt493158/index.html">Loghouse 0.3 - a tão esperada atualização do nosso sistema de registro em Kubernetes</a></li>
<li><a href="../pt493160/index.html">Como aprimoramos a Pesquisa inteligente no hh.ru em 2019: infográficos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>