<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¶ğŸ½ ğŸ˜€ ğŸ§›ğŸ¾ data.tableã®å‘¨ã‚Š ğŸ˜ ğŸ‘©â€ğŸ‘¦ ğŸ¥¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®ãƒãƒ¼ãƒˆã¯ã€Rã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª-data.tableã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦èˆˆå‘³æ·±ã„ã‚‚ã®ã§ã‚ã‚Šã€ã•ã¾ã–ã¾ãªä¾‹ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æŸ”è»Ÿæ€§ã‚’ç¢ºèªã§ãã‚‹ã“ã¨ã‚’å¬‰ã—ãæ€ã„ã¾ã™ã€‚åŒåƒšã®
 
 è‰¯ã„ä¾‹ã«è§¦ç™ºã•ã‚Œã€ã™ã§ã«å½¼ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã€data.tableã«åŸºã¥ã„ã¦ã‚³...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>data.tableã®å‘¨ã‚Š</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493132/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ãƒãƒ¼ãƒˆã¯ã€Rã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª-data.tableã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦èˆˆå‘³æ·±ã„ã‚‚ã®ã§ã‚ã‚Šã€ã•ã¾ã–ã¾ãªä¾‹ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æŸ”è»Ÿæ€§ã‚’ç¢ºèªã§ãã‚‹ã“ã¨ã‚’å¬‰ã—ãæ€ã„ã¾ã™ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">åŒåƒšã®</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è‰¯ã„ä¾‹ã«è§¦ç™ºã•ã‚Œã€</font><font style="vertical-align: inherit;">ã™ã§ã«å½¼ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã€</font><b><font style="vertical-align: inherit;">data.tableã«</font></b><font style="vertical-align: inherit;">åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«ã•ã‚‰ã«æ˜ã‚Šä¸‹ã’ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—</font><b><font style="vertical-align: inherit;">ã¾ã™</font></b><font style="vertical-align: inherit;">ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã˜ã‚ã«ï¼šdata.tableã¯ã©ã“ã‹ã‚‰æ¥ãŸã®ã§ã™ã‹ï¼Ÿ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°‘ã—é ãã‹ã‚‰ã€ã¤ã¾ã‚Šdata.tableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆä»¥ä¸‹ã€DTï¼‰ã‚’å–å¾—ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‹ã‚‰ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’çŸ¥ã£ã¦ãŠãã®ãŒæœ€å–„ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ãƒ¬ã‚¤</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## arrays ---------</span><font></font>
<font></font>
arrmatr &lt;- array(<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, c(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">typeof</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">array</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">matrix</span>(<span class="hljs-params">arrmatr</span>)

</span></code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚‰ã®æ§‹é€ ã®1ã¤ã¯é…åˆ—ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ŸBase :: array</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã§ã™ã€‚ä»–ã®è¨€èªã¨åŒæ§˜ã«ã€ã“ã“ã§ã¯é…åˆ—ã¯å¤šæ¬¡å…ƒã§ã™ã€‚ãŸã ã—ã€ãŸã¨ãˆã°ã€2æ¬¡å…ƒé…åˆ—ãŒãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¯ãƒ©ã‚¹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆï¼ŸBase ::ãƒãƒˆãƒªãƒƒã‚¯ã‚¹</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ã‹ã‚‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¶™æ‰¿ã—å§‹ã‚</font><font style="vertical-align: inherit;">ã€é‡è¦ãª1æ¬¡å…ƒé…åˆ—ãŒãƒ™ã‚¯ãƒˆãƒ«ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Ÿãƒ™ãƒ¼ã‚¹::ãƒ™ã‚¯ãƒˆãƒ«</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã‚’</font><font style="vertical-align: inherit;">ç¶™æ‰¿ã—ãªã„</font><font style="vertical-align: inherit;">ã“ã¨ãŒèˆˆå‘³æ·±ã„</font><b><font style="vertical-align: inherit;">ã§ã™</font></b><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚·ãƒªãƒ†ã‚£ã«å«ã¾ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ—ã¯ã€é–¢æ•°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ™ãƒ¼ã‚¹:: typeof</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§</font><font style="vertical-align: inherit;">ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</font><b><font style="vertical-align: inherit;">ã€‚typeof</font></b><font style="vertical-align: inherit;">ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®å†…éƒ¨è¨˜è¿°</font><font style="vertical-align: inherit;">-æœ€åˆã«ç”Ÿã¾ã‚Œ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸCã«</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸå…±é€šè¨€èªãƒ—ãƒ­ãƒˆã‚³ãƒ«</font><font style="vertical-align: inherit;">ã«å¾“ã£ã¦ã€ã‚¿ã‚¤ãƒ—ã®å†…éƒ¨è¨˜è¿°ã‚’è¿”ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ©ã‚¹ã‚’åˆ¤åˆ¥ã™ã‚‹åˆ¥ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base :: classã§ã™ã€‚</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ãƒ™ã‚¯ãƒˆãƒ«ã®å ´åˆã¯ãƒ™ã‚¯ãƒˆãƒ«ã‚¿ã‚¤ãƒ—ã‚’è¿”ã—ã¾ã™ï¼ˆå†…éƒ¨åã¨ã¯ç•°ãªã‚Šã¾ã™ãŒã€ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã‚’ç†è§£ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼‰ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2æ¬¡å…ƒé…åˆ—ã‹ã‚‰ã€ãã‚Œã¯è¡Œåˆ—</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆï¼ˆ</font><b><font style="vertical-align: inherit;">ï¼ŸBase :: list</font></b><font style="vertical-align: inherit;">ï¼‰ã«ç§»å‹•ã§ãã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## lists ------------------</span><font></font>
<font></font>
mylist &lt;- <span class="hljs-keyword">as</span>.list(arrmatr)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.vector(mylist)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(mylist)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®å ´åˆã€ã„ãã¤ã‹ã®ã“ã¨ãŒåŒæ™‚ã«èµ·ã“ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡Œåˆ—ã®2ç•ªç›®ã®æ¬¡å…ƒãŒç¸®å°ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ãƒªã‚¹ãƒˆã¨ãƒ™ã‚¯ãƒˆãƒ«ã®ä¸¡æ–¹ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚ </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ãƒªã‚¹ãƒˆã¯ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒãƒˆãƒªãƒƒã‚¯ã‚¹é…åˆ—ã®ã‚»ãƒ«ã‹ã‚‰ã®å˜ä¸€ã®ï¼ˆã‚¹ã‚«ãƒ©ãƒ¼ï¼‰å€¤ãŒãƒªã‚¹ãƒˆé …ç›®ã«å¯¾å¿œã™ã‚‹ã“ã¨ã‚’è¦šãˆã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒªã‚¹ãƒˆã¯ãƒ™ã‚¯ãƒˆãƒ«ã§ã‚‚ã‚ã‚‹ãŸã‚ã€ãƒ™ã‚¯ãƒˆãƒ«ã®ä¸€éƒ¨ã®é–¢æ•°ã‚’ãƒªã‚¹ãƒˆã«é©ç”¨ã§ãã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒªã‚¹ãƒˆã€è¡Œåˆ—ã€ã¾ãŸã¯ãƒ™ã‚¯ãƒˆãƒ«ã‹ã‚‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã«ç§»å‹•ã§ãã¾ã™ï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ŸBase :: data.frame</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## data.frames ------------</span><font></font>
<font></font>
df &lt;- <span class="hljs-keyword">as</span>.data.frame(arrmatr)<font></font>
df2 &lt;- <span class="hljs-keyword">as</span>.data.frame(mylist)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
df$V6 &lt;- df$V1 + df$V2<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
èˆˆå‘³æ·±ã„ã®ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ãŒãƒªã‚¹ãƒˆã‹ã‚‰ç¶™æ‰¿ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®åˆ—ã¯ãƒªã‚¹ãƒˆã‚»ãƒ«ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆã«é©ç”¨ã•ã‚Œã‚‹é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã“ã‚Œã¯å°†æ¥çš„ã«é‡è¦ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿è¡¨</font></font></h3><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ </font></i><font style="vertical-align: inherit;">ã€ãƒªã‚¹ãƒˆã€ãƒ™ã‚¯ãƒˆãƒ«ã€è¡Œåˆ—</font><font style="vertical-align: inherit;">ã‹ã‚‰</font><font style="vertical-align: inherit;">
DTï¼ˆ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ŸData.table :: data.table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">ã‚’å–å¾—ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ã“ã®ã‚ˆã†ã«ï¼ˆãã®å ´ã§ï¼‰ã€‚</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## data.tables -----------------------</span><font></font>
library(data.table)<font></font>
<font></font>
data.table::setDT(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.frame(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.table(df)
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¨åŒæ§˜ã«ã€DTãŒãƒªã‚¹ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¶™æ‰¿ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTã¨ãƒ¡ãƒ¢ãƒª</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rãƒ™ãƒ¼ã‚¹ã®ä»–ã®ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ç•°ãªã‚Šã€DTã¯å‚ç…§æ¸¡ã—ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ–°ã—ã„ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.table :: copy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é–¢æ•°</font><font style="vertical-align: inherit;">ãŒå¿…è¦ã‹ã€å¤ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰é¸æŠã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs">df2 &lt;- df<font></font>
<font></font>
df[V1 == <span class="hljs-number">1</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
df2 &lt;- data.table::copy(df)<font></font>
<font></font>
df[V1 == <span class="hljs-number">2</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ç´¹ä»‹ã§çµ‚ã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">DTã¯ã€Rã§ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®é–‹ç™ºã®ç¶šãã§ã™ã€‚ã“ã‚Œã¯ã€ä¸»ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹æ“ä½œã®æ‹¡å¼µã¨åŠ é€ŸãŒåŸå› ã§ç™ºç”Ÿã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®å ´åˆã€ä»–ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‹ã‚‰ã®ç¶™æ‰¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.tableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä½¿ç”¨ä¾‹</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆã®ã‚ˆã†ã«...</font></font></h3><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è¨€èªã®ãƒ«ãƒ¼ãƒ—ã‚³ãƒ¼ãƒ‰ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«é…ã„ãŸã‚</font><font style="vertical-align: inherit;">ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã¾ãŸã¯DTã®è¡Œã‚’åå¾©å‡¦ç†ã™ã‚‹ã“ã¨ã¯ãŠå‹§ã‚ã§ãã¾ã›ã‚“</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åˆ—ã‚’æ­©ãã¨ãã€å„åˆ—ã¯ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã§ã‚ã‚Šã€é€šå¸¸ã¯ãƒ™ã‚¯ãƒˆãƒ«ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ãƒ™ã‚¯ãƒˆãƒ«ã®æ“ä½œã¯ã€è¨€èªã®åŸºæœ¬çš„ãªé–¢æ•°ã§ã†ã¾ããƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆã¨ãƒ™ã‚¯ã‚¿ãƒ¼ã«å›ºæœ‰ã®é¸æŠæ¼”ç®—å­ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">`[[`ã€ `$`</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## operations on data.tables ------------</span><font></font>
<font></font>
<span class="hljs-comment">#using list properties</span><font></font>
<font></font>
df$<span class="hljs-string">'V1'</span>[<span class="hljs-number">1</span>]<font></font>
<font></font>
df[[<span class="hljs-string">'V1'</span>]]<font></font>
<font></font>
df[[<span class="hljs-number">1</span>]][<span class="hljs-number">1</span>]<font></font>
<font></font>
sapply(df, <span class="hljs-class"><span class="hljs-keyword">class</span>)

<span class="hljs-title">sapply</span>(<span class="hljs-params">df, function(<span class="hljs-params">x</span>) sum(<span class="hljs-params">is.na(<span class="hljs-params">x</span>)</span>)</span>)
</span></code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ™ã‚¯ãƒˆãƒ«åŒ–</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤§ããªDTã®è¡Œã‚’é€šéã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚’ä½¿ç”¨ã—ã¦é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã®ãŒæœ€å–„ã®è§£æ±ºç­–ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã ã—ã€æ©Ÿèƒ½ã—ãªã„å ´åˆã¯</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DT </font><i><font style="vertical-align: inherit;">å†…ã®</font></i><font style="vertical-align: inherit;">ã‚µã‚¤ã‚¯ãƒ«</font><b><font style="vertical-align: inherit;">ãŒC</font></b><font style="vertical-align: inherit;">ã§å®Ÿè¡Œã•</font><b><font style="vertical-align: inherit;">ã‚Œã‚‹</font></b><font style="vertical-align: inherit;">ãŸã‚</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã®</font><font style="vertical-align: inherit;">æ–¹ãŒã‚µã‚¤ã‚¯ãƒ«ãŒé€Ÿã„</font><font style="vertical-align: inherit;">ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
100Kè¡Œã®ã‚ˆã‚Šå¤§ããªä¾‹ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font><font style="vertical-align: inherit;">åˆ—ãƒ™ã‚¯ãƒˆãƒ«</font><b><font style="vertical-align: inherit;">wã«</font></b><font style="vertical-align: inherit;">å«ã¾ã‚Œã‚‹å˜èªã‹ã‚‰æœ€åˆã®æ–‡å­—ã‚’å¼•ãå‡ºã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font><i><font style="vertical-align: inherit;">æ›´æ–°ã—ã¾ã—ãŸ</font></i></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs">library(magrittr)<font></font>
library(microbenchmark)<font></font>
<font></font>
<span class="hljs-comment">## Bigger example ----</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = sapply(seq_len(rown), function(x) paste(sample(letters, <span class="hljs-number">3</span>, replace = T), collapse = <span class="hljs-string">' '</span>))<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
<span class="hljs-comment"># vectorization</span><font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		, by = <span class="hljs-number">1</span>:nrow(dt)<font></font>
	   ]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># second</span><font></font>
<font></font>
first_l_f &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		do.call(rbind, .) %&gt;%<font></font>
		`[`(,<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># third</span><font></font>
<font></font>
first_l_f2 &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		unlist %&gt;%<font></font>
		matrix(nrow = <span class="hljs-number">3</span>) %&gt;%<font></font>
		`[`(<span class="hljs-number">1</span>,)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f2(w))<font></font>
		]<font></font>
})<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åˆã®å®Ÿè¡Œã¯ã€æ¬¡ã®è¡Œã‚’åå¾©ã—ã¾ã™ã€‚</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ä½ï¼šãƒŸãƒªç§’</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr min </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [ã€ `ï¼š=`ï¼ˆfirst_lã€unlistï¼ˆstrsplitï¼ˆwã€split = ""ã€fixed = Tï¼‰ï¼‰[1]ï¼‰ã€by = 1ï¼šnrowï¼ˆdtï¼‰]} 439.6217 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 lqå¹³å‡ä¸­å¤®å€¤uq max neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 451.9998 460.1593 456.2505 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">460.9147</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 621.4042 100</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2å›ç›®ã®å®Ÿè¡Œã§ã¯ã€ãƒªã‚¹ãƒˆã‚’è¡Œåˆ—ã«å¤‰æ›ã—ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1ã‚’æŒã¤ã‚¹ãƒ©ã‚¤ã‚¹ã®è¦ç´ ã‚’å–å¾—ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãŒè¡Œã‚ã‚Œã¾ã™</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆå¾Œè€…ã¯å®Ÿéš›ã«ã¯ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã§ã™ï¼‰</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç§ã¯å›å¾©ã—ã¾ã™ï¼š</font><font style="vertical-align: inherit;">å…¥åŠ›ã¨ã—ã¦ãƒ™ã‚¯ãƒˆãƒ«ã‚’å–ã‚‹ã“ã¨ãŒã§ãã‚‹</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strsplit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é–¢æ•°ã®ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãƒªã‚¹ãƒˆã‚’è¡Œåˆ—ã«å¤‰æ›ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–è‡ªä½“ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«é›£ã—ã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ãŒã€ã“ã®å ´åˆã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œã¦ã„ãªã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«é«˜é€Ÿã§ã™ã€‚</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ä½ï¼šãƒŸãƒªç§’</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr min lqå¹³å‡ä¸­å¤®å€¤uqæœ€å¤§ãƒãƒ´ã‚¡ãƒ«</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [ã€ `ï¼š=`ï¼ˆfirst_l ,.ï¼ˆFirst_l_fï¼ˆwï¼‰ï¼‰ï¼‰]} 93.07916 112.1381 161.9267 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">149.6863</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 185.9893 442.5199 100</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠ é€Ÿã®ä¸­å¤®å€¤ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3å€</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3å›ç›®ã®å®Ÿè¡Œã§ã¯ã€ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã¸ã®å¤‰æ›ã®ã‚¹ã‚­ãƒ¼ãƒ ãŒå¤‰æ›´ã•ã‚Œã¾ã™ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ä½ï¼šãƒŸãƒªç§’</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr min lqå¹³å‡ä¸­å¤®å€¤uqæœ€å¤§ãƒãƒ´ã‚¡ãƒ«</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 {dt [ã€ `ï¼š=`ï¼ˆfirst_l ,.ï¼ˆFirst_l_f2ï¼ˆwï¼‰ï¼‰ï¼‰]} 32.60481 34.13679 40.4544 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">35.57115</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 42.11975 222.972 100</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠ é€Ÿã®ä¸­å¤®å€¤ã¯</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13å€</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ãªãŸã¯ã“ã®å•é¡Œã‚’å®Ÿé¨“ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€ã‚ˆã‚Šå¤šã-ã‚ˆã‚Šè‰¯ã„ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ†ã‚­ã‚¹ãƒˆã‚‚ã‚ã‚‹ãŒã€å®Ÿéš›ã®æ¡ä»¶ã«è¿‘ã„ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã®ã‚‚ã†1ã¤ã®ä¾‹ï¼šå˜èªã®é•·ã•ã€å˜èªæ•°ãŒç•°ãªã‚‹ã€‚</font><font style="vertical-align: inherit;">æœ€åˆã®3ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚ˆã†ã«ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i_/sp/y_/i_spy_ok37lu1k5f6syb7db8kw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã¯ã€ãƒ™ã‚¯ãƒˆãƒ«ã®é•·ã•ãŒç•°ãªã‚‹ãŸã‚ã€å‰ã®é–¢æ•°ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚è¡Œåˆ—ã®ã‚µã‚¤ã‚ºã‚’è¨­å®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’æ˜ã‚Šä¸‹ã’ã¦ã“ã‚Œã‚’ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># fourth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
first_l_f3 &lt;- function(sd, n)<font></font>
{<font></font>
	l &lt;- strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T)<font></font>
	<font></font>
	maxl &lt;- max(lengths(l))<font></font>
	<font></font>
	sapply(l, <span class="hljs-string">"length&lt;-"</span>, maxl) %&gt;%<font></font>
		`[`(n,) %&gt;%<font></font>
		<span class="hljs-keyword">as</span>.character<font></font>
}<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
		]<font></font>
})<font></font>
<font></font>
dt[<font></font>
	, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
	]<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å˜ä½ï¼šãƒŸãƒªç§’</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 expr min lqå¹³å‡ä¸­å¤®å€¤</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{dt [ã€ `ï¼š=`ï¼ˆï¼ˆpaste0ï¼ˆ "w_"ã€1ï¼š3ï¼‰ï¼‰ã€strsplitï¼ˆwã€split = ""ã€fixed = Tï¼‰ï¼‰]} 851.7623 916.071 1054.5 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1035.199</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 uq max neval </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 1178.738 1356.816 100</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¹³å‡1ç§’ã®é€Ÿåº¦ã§å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ‚ªããªã„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ¥ã®ã‚ˆã‚ŠçµŒæ¸ˆçš„ãªæ–¹æ³•ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚«ãƒ–ãƒ©ã‚°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># fifth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
microbenchmark({<font></font>
	<font></font>
	w_split &lt;- dt[<font></font>
		, data.table::tstrsplit(w, split = <span class="hljs-string">' '</span>, fixed = T, keep = <span class="hljs-number">1L</span>:<span class="hljs-number">3L</span>)<font></font>
		]<font></font>
	<font></font>
	dt[<font></font>
		, `:=` (<font></font>
			w_1 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">1</span>]])<font></font>
			, w_2 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">2</span>]])<font></font>
			, w_3 = <span class="hljs-keyword">as</span>.character(w_split[[<span class="hljs-number">3</span>]])<font></font>
		)<font></font>
		]<font></font>
<font></font>
})<font></font>
</code></pre><br>
</div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­å¤®å€¤186ã€5å€å®‰ã„...</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1æœ¬ã®ãƒã‚§ãƒ¼ãƒ³ã§ã¤ãªãŒã£ã¦......</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦DTã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ“ä½œã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ‹¬å¼§ã®æ§‹æ–‡ã‚’å³å´ã«ãƒ•ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€ç ‚ç³–ã§ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># chaining</span><font></font>
<font></font>
res1 &lt;- dt[a == <span class="hljs-string">'a'</span>][sample(.N, <span class="hljs-number">100</span>)]<font></font>
<font></font>
res2 &lt;- dt[, .N, a][, N]<font></font>
<font></font>
res3 &lt;- dt[, coefficients(lm(e ~ d))[<span class="hljs-number">1</span>], a][, .(letter = a, coef = V1)]<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ã‚¤ãƒ—ã‚’æµã‚Œã‚‹...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DTã ã‘ã§ãªãä»»æ„ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã§ãã‚‹ãŸã‚ã€åŒã˜æ“ä½œã‚’ãƒ‘ã‚¤ãƒ”ãƒ³ã‚°ã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ã€‚è¦‹ãŸç›®ã¯ä¼¼ã¦ã„ã¾ã™ãŒã€æ©Ÿèƒ½ã¯è±Šå¯Œã§ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‡ã‚£ãƒ¼ã‚¼ãƒ«ç‡ƒæ–™ã«ã„ãã¤ã‹ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€åˆæˆãƒ‡ãƒ¼ã‚¿ã®ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ä¿‚æ•°ã‚’å°å‡ºã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># piping</span><font></font>
<font></font>
samplpe_b &lt;- dt[a %<span class="hljs-keyword">in</span>% head(letters), sample(b, <span class="hljs-number">1</span>)]<font></font>
<font></font>
res4 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[a %<span class="hljs-keyword">in</span>% head(letters)] %&gt;%<font></font>
	.[, <font></font>
	  {<font></font>
	  	dt0 &lt;- .SD[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>]<font></font>
	  	<font></font>
	  	quants &lt;- <font></font>
	  		dt0[, c] %&gt;%<font></font>
	  		quantile(seq(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.1</span>), na.rm = T)<font></font>
	  	<font></font>
	  	.(q = quants)<font></font>
	  }<font></font>
	  , .(cond = b &gt; samplpe_b)<font></font>
	  ] %&gt;%<font></font>
	glm(<font></font>
		cond ~ q <span class="hljs-number">-1</span>
		, family = binomial(link = <span class="hljs-string">"logit"</span>)<font></font>
		, data = .<font></font>
	) %&gt;%<font></font>
	summary %&gt;%<font></font>
	.[[<span class="hljs-number">12</span>]]
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTå†…ã®çµ±è¨ˆã€æ©Ÿæ¢°å­¦ç¿’ãªã©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ©ãƒ ãƒ€é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ãŒã€ãã‚Œã‚‰ã‚’å€‹åˆ¥ã«ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã‚’ç™»éŒ²ã—ã¦ã‹ã‚‰ã€DTå†…ã§æ©Ÿèƒ½ã™ã‚‹æ–¹ãŒè‰¯ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ä¾‹ã¯ã€ä¸Šè¨˜ã®ã™ã¹ã¦ã®æ©Ÿèƒ½ã«åŠ ãˆã¦ã€DTã‚¢ãƒ¼ã‚»ãƒŠãƒ«ã‹ã‚‰ã®ã„ãã¤ã‹ã®ä¾¿åˆ©ãªã‚‚ã®ï¼ˆå‚ç…§ã«ã‚ˆã£ã¦DTå†…ã®DTè‡ªä½“ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãªã©ã€é †ç•ªã«æŒ¿å…¥ã•ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ï¼‰ã§å¼·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># function</span><font></font>
<font></font>
rm(lm_preds)<font></font>
<font></font>
lm_preds &lt;- function(<font></font>
	sd, by, n<font></font>
)<font></font>
{<font></font>
	<font></font>
	<span class="hljs-keyword">if</span>(<font></font>
		n &lt; <span class="hljs-number">100</span> | <font></font>
		!by[[<span class="hljs-string">'a'</span>]] %<span class="hljs-keyword">in</span>% head(letters, <span class="hljs-number">4</span>)<font></font>
	   )<font></font>
	{<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = NA<font></font>
				, mean = NA<font></font>
				, high = NA<font></font>
				, coefs = NA<font></font>
			)<font></font>
		<font></font>
	} <span class="hljs-keyword">else</span> {<font></font>
<font></font>
		lmm &lt;- <font></font>
			lm(<font></font>
				d ~ c + b<font></font>
				, data = sd<font></font>
			)<font></font>
		<font></font>
		preds &lt;- <font></font>
			stats::predict.lm(<font></font>
				lmm<font></font>
				, sd<font></font>
				, interval = <span class="hljs-string">"prediction"</span><font></font>
				)<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = preds[, <span class="hljs-number">2</span>]<font></font>
				, mean = preds[, <span class="hljs-number">1</span>]<font></font>
				, high = preds[, <span class="hljs-number">3</span>]<font></font>
				, coefs = coefficients(lmm)<font></font>
			)<font></font>
	}<font></font>
<font></font>
	res<font></font>
	<font></font>
}<font></font>
<font></font>
res5 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[e &lt; <span class="hljs-number">0</span>] %&gt;%<font></font>
	.[.[, .I[b &gt; <span class="hljs-number">0</span>]]] %&gt;%<font></font>
	.[, `:=` (<font></font>
		low = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">1</span>]])<font></font>
		, mean = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">2</span>]])<font></font>
		, high = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">3</span>]])<font></font>
		, coef_c = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">1</span>])<font></font>
		, coef_b = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">2</span>])<font></font>
		, coef_int = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">3</span>])<font></font>
	)<font></font>
	, a<font></font>
	] %&gt;%<font></font>
	.[!<span class="hljs-keyword">is</span>.na(mean), -<span class="hljs-string">'e'</span>, <span class="hljs-keyword">with</span> = F]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># plot</span><font></font>
<font></font>
plo &lt;- <font></font>
	res5 %&gt;%<font></font>
	ggplot +<font></font>
	facet_wrap(~ a) +<font></font>
	geom_ribbon(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, ymin = low<font></font>
			, ymax = high<font></font>
			, fill = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">0.1</span>
		, alpha = <span class="hljs-number">0.1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = mean<font></font>
			, color = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = d<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span>
		, color = <span class="hljs-string">'black'</span><font></font>
	) +<font></font>
	theme_minimal()<font></font>
<font></font>
print(plo)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµè«–</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rã‚¯ãƒ©ã‚¹ã‹ã‚‰ã®ç¶™æ‰¿ã«é–¢é€£ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å§‹ã¾ã‚Šã€ç‹¬è‡ªã®ãƒãƒƒãƒ—ã¨æ•´é “ã•ã‚ŒãŸè¦ç´ ã‹ã‚‰ã®ç’°å¢ƒã§çµ‚ã‚ã‚‹data.tableã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Œå…¨ãªã€ã—ã‹ã—ã‚‚ã¡ã‚ã‚“ã€å®Œå…¨ã§ã¯ãªã„ç”»åƒã‚’ä½œæˆã§ããŸã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚ŒãŒã‚ãªãŸãŒã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚ˆã‚Šã‚ˆãå­¦ã³ã€ä»•äº‹ã¨</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥½ã—ã¿ã®</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/xl/km/fhxlkmndxsdm4gcfyiymozut1vg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ„Ÿè¬ï¼</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">## load libs ----------------</span><font></font>
<font></font>
library(data.table)<font></font>
library(ggplot2)<font></font>
library(magrittr)<font></font>
library(microbenchmark)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">## arrays ---------</span><font></font>
<font></font>
arrmatr &lt;- array(<span class="hljs-number">1</span>:<span class="hljs-number">20</span>, c(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>))<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">typeof</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">array</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">matrix</span>(<span class="hljs-params">arrmatr</span>)


## <span class="hljs-title">lists</span> ------------------

<span class="hljs-title">mylist</span> &lt;- <span class="hljs-title">as</span>.<span class="hljs-title">list</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">vector</span>(<span class="hljs-params">mylist</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">list</span>(<span class="hljs-params">mylist</span>)


## <span class="hljs-title">data</span>.<span class="hljs-title">frames</span> ------------

<span class="hljs-title">df</span> &lt;- <span class="hljs-title">as</span>.<span class="hljs-title">data</span>.<span class="hljs-title">frame</span>(<span class="hljs-params">arrmatr</span>)

<span class="hljs-title">is</span>.<span class="hljs-title">list</span>(<span class="hljs-params">df</span>)

<span class="hljs-title">df</span>$<span class="hljs-title">V6</span> &lt;- <span class="hljs-title">df</span>$<span class="hljs-title">V1</span> + <span class="hljs-title">df</span>$<span class="hljs-title">V2</span>


## <span class="hljs-title">data</span>.<span class="hljs-title">tables</span> -----------------------

<span class="hljs-title">data</span>.<span class="hljs-title">table</span>:</span>:setDT(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.list(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.frame(df)<font></font>
<font></font>
<span class="hljs-keyword">is</span>.data.table(df)<font></font>
<font></font>
df2 &lt;- df<font></font>
<font></font>
df[V1 == <span class="hljs-number">1</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
df2 &lt;- data.table::copy(df)<font></font>
<font></font>
df[V1 == <span class="hljs-number">2</span>, V2 := <span class="hljs-number">999</span>]<font></font>
<font></font>
data.table::fsetdiff(df, df2)<font></font>
<font></font>
<font></font>
<span class="hljs-comment">## operations on data.tables ------------</span><font></font>
<font></font>
<span class="hljs-comment">#using list properties</span><font></font>
<font></font>
df$<span class="hljs-string">'V1'</span>[<span class="hljs-number">1</span>]<font></font>
<font></font>
df[[<span class="hljs-string">'V1'</span>]]<font></font>
<font></font>
df[[<span class="hljs-number">1</span>]][<span class="hljs-number">1</span>]<font></font>
<font></font>
sapply(df, <span class="hljs-class"><span class="hljs-keyword">class</span>)

<span class="hljs-title">sapply</span>(<span class="hljs-params">df, function(<span class="hljs-params">x</span>) sum(<span class="hljs-params">is.na(<span class="hljs-params">x</span>)</span>)</span>)


## <span class="hljs-title">Bigger</span> <span class="hljs-title">example</span> ----

<span class="hljs-title">rown</span> &lt;- 100000

<span class="hljs-title">dt</span> &lt;- 
	<span class="hljs-title">data</span>.<span class="hljs-title">table</span>(<span class="hljs-params">
		w = sapply(<span class="hljs-params">seq_len(<span class="hljs-params">rown</span>), function(<span class="hljs-params">x</span>) paste(<span class="hljs-params">sample(<span class="hljs-params">letters, <span class="hljs-number">3</span>, replace = T</span>), collapse = <span class="hljs-string">' '</span></span>)</span>)
		, a = sample(<span class="hljs-params">letters, rown, replace = T</span>)
		, b = runif(<span class="hljs-params">rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span></span>)
		, c = runif(<span class="hljs-params">rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span></span>)
		, e = rnorm(<span class="hljs-params">rown</span>)
	</span>) %&gt;%
	.[, <span class="hljs-title">d</span> :</span>= <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
<span class="hljs-comment"># vectorization</span><font></font>
<font></font>
<span class="hljs-comment"># zero - for loop</span><font></font>
<font></font>
microbenchmark({<font></font>
	<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:nrow(dt))<font></font>
		{<font></font>
		dt[<font></font>
			i<font></font>
			, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		]<font></font>
	}<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># first</span><font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := unlist(strsplit(w, split = <span class="hljs-string">' '</span>, fixed = T))[<span class="hljs-number">1</span>]<font></font>
		, by = <span class="hljs-number">1</span>:nrow(dt)<font></font>
	   ]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># second</span><font></font>
<font></font>
first_l_f &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		do.call(rbind, .) %&gt;%<font></font>
		`[`(,<span class="hljs-number">1</span>)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># third</span><font></font>
<font></font>
first_l_f2 &lt;- function(sd)<font></font>
{<font></font>
	strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T) %&gt;%<font></font>
		unlist %&gt;%<font></font>
		matrix(nrow = <span class="hljs-number">3</span>) %&gt;%<font></font>
		`[`(<span class="hljs-number">1</span>,)<font></font>
}<font></font>
<font></font>
dt[, first_l := NULL]<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, first_l := .(first_l_f2(w))<font></font>
		]<font></font>
})<font></font>
<font></font>
<span class="hljs-comment"># fourth</span><font></font>
<font></font>
rown &lt;- <span class="hljs-number">100000</span><font></font>
<font></font>
words &lt;-<font></font>
	sapply(<font></font>
		seq_len(rown)<font></font>
		, function(x){<font></font>
			nwords &lt;- rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>)<font></font>
			paste(<font></font>
				sapply(<font></font>
					seq_len(nwords)<font></font>
					, function(x){<font></font>
						paste(sample(letters, rbinom(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>), replace = T), collapse = <span class="hljs-string">''</span>)<font></font>
					}<font></font>
				)<font></font>
				, collapse = <span class="hljs-string">' '</span><font></font>
			)<font></font>
		}<font></font>
	)<font></font>
<font></font>
dt &lt;- <font></font>
	data.table(<font></font>
		w = words<font></font>
		, a = sample(letters, rown, replace = T)<font></font>
		, b = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, c = runif(rown, <span class="hljs-number">-3</span>, <span class="hljs-number">3</span>)<font></font>
		, e = rnorm(rown)<font></font>
	) %&gt;%<font></font>
	.[, d := <span class="hljs-number">1</span> + b + c + rnorm(nrow(.))]<font></font>
<font></font>
first_l_f3 &lt;- function(sd, n)<font></font>
{<font></font>
	l &lt;- strsplit(sd, split = <span class="hljs-string">' '</span>, fixed = T)<font></font>
	<font></font>
	maxl &lt;- max(lengths(l))<font></font>
	<font></font>
	sapply(l, <span class="hljs-string">"length&lt;-"</span>, maxl) %&gt;%<font></font>
		`[`(n,) %&gt;%<font></font>
		<span class="hljs-keyword">as</span>.character<font></font>
}<font></font>
<font></font>
microbenchmark({<font></font>
	dt[<font></font>
		, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
		]<font></font>
})<font></font>
<font></font>
dt[<font></font>
	, (paste0(<span class="hljs-string">'w_'</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>)) := lapply(<span class="hljs-number">1</span>:<span class="hljs-number">3</span>, function(x) first_l_f3(w, x))<font></font>
	]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># chaining</span><font></font>
<font></font>
res1 &lt;- dt[a == <span class="hljs-string">'a'</span>][sample(.N, <span class="hljs-number">100</span>)]<font></font>
<font></font>
res2 &lt;- dt[, .N, a][, N]<font></font>
<font></font>
res3 &lt;- dt[, coefficients(lm(e ~ d))[<span class="hljs-number">1</span>], a][, .(letter = a, coef = V1)]<font></font>
<font></font>
<span class="hljs-comment"># piping</span><font></font>
<font></font>
samplpe_b &lt;- dt[a %<span class="hljs-keyword">in</span>% head(letters), sample(b, <span class="hljs-number">1</span>)]<font></font>
<font></font>
res4 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[a %<span class="hljs-keyword">in</span>% head(letters)] %&gt;%<font></font>
	.[, <font></font>
	  {<font></font>
	  	dt0 &lt;- .SD[<span class="hljs-number">1</span>:<span class="hljs-number">100</span>]<font></font>
	  	<font></font>
	  	quants &lt;- <font></font>
	  		dt0[, c] %&gt;%<font></font>
	  		quantile(seq(<span class="hljs-number">0.1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.1</span>), na.rm = T)<font></font>
	  	<font></font>
	  	.(q = quants)<font></font>
	  }<font></font>
	  , .(cond = b &gt; samplpe_b)<font></font>
	  ] %&gt;%<font></font>
	glm(<font></font>
		cond ~ q <span class="hljs-number">-1</span>
		, family = binomial(link = <span class="hljs-string">"logit"</span>)<font></font>
		, data = .<font></font>
	) %&gt;%<font></font>
	summary %&gt;%<font></font>
	.[[<span class="hljs-number">12</span>]]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># function</span><font></font>
<font></font>
rm(lm_preds)<font></font>
<font></font>
lm_preds &lt;- function(<font></font>
	sd, by, n<font></font>
)<font></font>
{<font></font>
	<font></font>
	<span class="hljs-keyword">if</span>(<font></font>
		n &lt; <span class="hljs-number">100</span> | <font></font>
		!by[[<span class="hljs-string">'a'</span>]] %<span class="hljs-keyword">in</span>% head(letters, <span class="hljs-number">4</span>)<font></font>
	   )<font></font>
	{<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = NA<font></font>
				, mean = NA<font></font>
				, high = NA<font></font>
				, coefs = NA<font></font>
			)<font></font>
		<font></font>
	} <span class="hljs-keyword">else</span> {<font></font>
<font></font>
		lmm &lt;- <font></font>
			lm(<font></font>
				d ~ c + b<font></font>
				, data = sd<font></font>
			)<font></font>
		<font></font>
		preds &lt;- <font></font>
			stats::predict.lm(<font></font>
				lmm<font></font>
				, sd<font></font>
				, interval = <span class="hljs-string">"prediction"</span><font></font>
				)<font></font>
		<font></font>
		res &lt;-<font></font>
			list(<font></font>
				low = preds[, <span class="hljs-number">2</span>]<font></font>
				, mean = preds[, <span class="hljs-number">1</span>]<font></font>
				, high = preds[, <span class="hljs-number">3</span>]<font></font>
				, coefs = coefficients(lmm)<font></font>
			)<font></font>
	}<font></font>
<font></font>
	res<font></font>
	<font></font>
}<font></font>
<font></font>
res5 &lt;- <font></font>
	dt %&gt;%<font></font>
	.[e &lt; <span class="hljs-number">0</span>] %&gt;%<font></font>
	.[.[, .I[b &gt; <span class="hljs-number">0</span>]]] %&gt;%<font></font>
	.[, `:=` (<font></font>
		low = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">1</span>]])<font></font>
		, mean = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">2</span>]])<font></font>
		, high = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">3</span>]])<font></font>
		, coef_c = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">1</span>])<font></font>
		, coef_b = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">2</span>])<font></font>
		, coef_int = <span class="hljs-keyword">as</span>.numeric(lm_preds(.SD, .BY, .N)[[<span class="hljs-number">4</span>]][<span class="hljs-number">3</span>])<font></font>
	)<font></font>
	, a<font></font>
	] %&gt;%<font></font>
	.[!<span class="hljs-keyword">is</span>.na(mean), -<span class="hljs-string">'e'</span>, <span class="hljs-keyword">with</span> = F]<font></font>
<font></font>
<font></font>
<span class="hljs-comment"># plot</span><font></font>
<font></font>
plo &lt;- <font></font>
	res5 %&gt;%<font></font>
	ggplot +<font></font>
	facet_wrap(~ a) +<font></font>
	geom_ribbon(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, ymin = low<font></font>
			, ymax = high<font></font>
			, fill = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">0.1</span>
		, alpha = <span class="hljs-number">0.1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = mean<font></font>
			, color = a<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span><font></font>
	) +<font></font>
	geom_point(<font></font>
		aes(<font></font>
			x = c * coef_c + b * coef_b + coef_int<font></font>
			, y = d<font></font>
		)<font></font>
		, size = <span class="hljs-number">1</span>
		, color = <span class="hljs-string">'black'</span><font></font>
	) +<font></font>
	theme_minimal()<font></font>
<font></font>
print(plo)<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja493118/index.html">ãƒ¡ãƒ¢ãƒªã‚¿ã‚°æ‹¡å¼µæ©Ÿèƒ½ã®æ¦‚è¦ï¼ˆArmv8.5-Aï¼‰</a></li>
<li><a href="../ja493122/index.html">ãƒãƒ³ã‚¶ã‚¤ã‚²ãƒ¼ãƒ ã‚ªãƒ•ã‚£ã‚¹ï¼šãƒ¢ã‚¹ã‚¯ãƒ¯ã®ä¸­å¿ƒã«ã‚ã‚‹æ—¥æœ¬</a></li>
<li><a href="../ja493124/index.html">æ—¥æ›œå¤§å·¥ã®ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã€ã¾ãŸã¯ã‚¼ãƒ­ã‹ã‚‰ã®è‡ªå‹•ã‚µãƒ¼ãƒãƒ¼æº–å‚™</a></li>
<li><a href="../ja493126/index.html">ã‚¤ãƒ™ãƒ³ãƒˆæŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³</a></li>
<li><a href="../ja493130/index.html">ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹ã‚’æã‚Œã‚‹ã¹ãã§ã¯ãªã„ç†ç”±ï¼šç¥è©±ã¨COVID-2019ã«é–¢ã™ã‚‹ã»ã¨ã‚“ã©ã®çœŸå®Ÿ</a></li>
<li><a href="../ja493136/index.html">Unity Storageã®FAST VPï¼šä»•çµ„ã¿</a></li>
<li><a href="../ja493138/index.html">ç§ã«è©±ã—ã‹ã‘ã¦ãã ã•ã„ï¼šä»Šæ—¥ã€éŸ³å£°ãƒœãƒƒãƒˆãŒã§ãã‚‹ã“ã¨</a></li>
<li><a href="../ja493140/index.html">ã‚·ãƒãƒƒãƒªãƒ¼ãƒã®å†’é™ºï¼šFlantã«ã‚ˆã‚‹ITã‚¯ã‚¨ã‚¹ãƒˆã®éš”é›¢</a></li>
<li><a href="../ja493142/index.html">ã€ŒKubernetesã‚’ä½¿ã„ã¾ã—ã‚‡ã†ï¼ã€8ã¤ã®å•é¡ŒãŒã‚ã‚Šã¾ã™</a></li>
<li><a href="../ja493146/index.html">ä»Šæ—¥ã§ãã‚‹ã‚¨ã‚­ã‚µã‚¤ãƒ†ã‚£ãƒ³ã‚°ãªã‚µã‚¤ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>