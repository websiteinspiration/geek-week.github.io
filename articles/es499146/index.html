<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏻 👸🏿 💆🏽 Una manera fácil de proteger tu Mikrotik de los ataques 🌇 ♍️ 🤭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir con la comunidad una manera simple y funcional de cómo usar Mikrotik para proteger mi red y los servicios que "vigilan" debido a ataq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Una manera fácil de proteger tu Mikrotik de los ataques</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499146/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiero compartir con la comunidad una manera simple y funcional de cómo usar Mikrotik para proteger mi red y los servicios que "vigilan" debido a ataques externos. Es decir, con solo tres reglas, organice un honeypot en Mikrotik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, imaginemos que tenemos una pequeña oficina, una IP externa detrás de la cual hay un servidor RDP, para que los empleados trabajen de forma remota. La primera regla es, por supuesto, cambiar el puerto 3389 en la interfaz externa a otro. Pero esto no es por mucho tiempo, después de un par de días, el registro de auditoría del servidor terminal comenzará a mostrar varias autorizaciones fallidas por segundo de clientes desconocidos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra situación, tienes un asterisco oculto detrás de Mikrotik, por supuesto, no en el puerto udp 5060, y después de un par de días también comienza a adivinar la contraseña ... sí, lo sé, fail2ban es todo, pero todavía tengo que resoplarlo ... por ejemplo, recientemente lo levanté a ubuntu El 18 de abril, me sorprendió descubrir que fail2ban no contiene la configuración real para el asterisco del mismo cuadro de la misma distribución de ubuntu ... pero Google no puede buscar en Google configuraciones rápidas de "recetas" preparadas, el número de lanzamientos crece con los años y los artículos con " recetas "para las versiones antiguas ya no funcionan, pero casi no hay nuevas ... Pero algo me estoy desviando ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, lo que es honeypot en pocas palabras: es un señuelo, en nuestro caso, un puerto popular en una IP externa, cualquier solicitud a este puerto desde un cliente externo envía la dirección src a la lista negra. </font><font style="vertical-align: inherit;">Todas.</font></font><br>
 <br>
<pre><code class="plaintext hljs">/ip firewall filter<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment="block honeypot ssh rdp winbox" \<font></font>
    connection-state=new dst-port=22,3389,8291 in-interface=\<font></font>
    ether4-wan protocol=tcp<font></font>
add action=add-src-to-address-list address-list="Honeypot Hacker" \<font></font>
    address-list-timeout=30d0h0m chain=input comment=\<font></font>
    "block honeypot asterisk" connection-state=new dst-port=5060 \<font></font>
    in-interface=ether4-wan protocol=udp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
    "Honeypot Hacker"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera regla en los populares puertos TCP 22, 3389, 8291 de la interfaz externa ether4-wan envía la IP del invitado a la lista Honeypot Hacker (los puertos para ssh, rdp y winbox se deshabilitan por adelantado o se cambian a otros). El segundo hace lo mismo en el popular UDP 5060. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tercera regla en la etapa previa al enrutamiento deja caer paquetes de "invitados" cuya dirección srs entró en el "Honeypot Hacker". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de dos semanas de trabajo en mi hogar Mikrotik, la lista de Honeypot Hacker incluía alrededor de mil quinientas direcciones IP de admiradores amigables con las ubres de los recursos de mi red (telefonía doméstica, correo, nextcloud, rdp). Los ataques de fuerza bruta se detuvieron, la felicidad se produjo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el trabajo, no todo resultó ser tan simple, continúan rompiendo el servidor rdp con contraseñas de fuerza bruta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aparentemente, el escáner determinó el número de puerto mucho antes de que se encendiera el honeypot, y durante la cuarentena no es tan fácil reconfigurar a más de 100 usuarios, de los cuales el 20% tiene más de 65 años. </font><font style="vertical-align: inherit;">En el caso de que el puerto no se pueda cambiar, hay una pequeña receta de trabajo. </font><font style="vertical-align: inherit;">Conocí algo similar en Internet, pero hay un ajuste final y preciso:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reglas para configurar la anulación de puertos</font></font></b>
                        <div class="spoiler_text"> <pre><code class="plaintext hljs"> /ip firewall filter<font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=15m chain=forward comment=rdp_to_blacklist \<font></font>
    connection-state=new dst-port=3389 protocol=tcp src-address-list=\<font></font>
    rdp_stage12<font></font>
add action=add-src-to-address-list address-list=rdp_stage12 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage11<font></font>
add action=add-src-to-address-list address-list=rdp_stage11 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage10<font></font>
add action=add-src-to-address-list address-list=rdp_stage10 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage9<font></font>
add action=add-src-to-address-list address-list=rdp_stage9 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage8<font></font>
add action=add-src-to-address-list address-list=rdp_stage8 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage7 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage6<font></font>
add action=add-src-to-address-list address-list=rdp_stage6 \<font></font>
    address-list-timeout=4m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage5<font></font>
add action=add-src-to-address-list address-list=rdp_stage5 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage4<font></font>
add action=add-src-to-address-list address-list=rdp_stage4 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=\<font></font>
    3389 protocol=tcp src-address-list=rdp_stage3<font></font>
add action=add-src-to-address-list address-list=rdp_stage3 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage2<font></font>
add action=add-src-to-address-list address-list=rdp_stage2 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp src-address-list=rdp_stage1<font></font>
add action=add-src-to-address-list address-list=rdp_stage1 \<font></font>
    address-list-timeout=2m chain=forward connection-state=new dst-port=3389 \<font></font>
    protocol=tcp <font></font>
/ip firewall raw<font></font>
add action=drop chain=prerouting in-interface=ether4-wan src-address-list=\<font></font>
rdp_blacklist<font></font>
</code></pre> </div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 4 minutos, el cliente remoto puede realizar solo 12 nuevas "solicitudes" al servidor RDP. </font><font style="vertical-align: inherit;">Un intento de inicio de sesión es de 1 a 4 "solicitudes". </font><font style="vertical-align: inherit;">En el 12º "pedido" - un candado por 15 minutos. </font><font style="vertical-align: inherit;">En mi caso, los atacantes no dejaron de piratear el servidor, se adaptaron a los temporizadores y ahora lo hacen muy lentamente, esta velocidad de selección reduce la eficiencia del ataque a cero. </font><font style="vertical-align: inherit;">Los empleados de la empresa prácticamente no experimentan ningún inconveniente en el trabajo realizado.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otro pequeño truco</font></font></b>
                        <div class="spoiler_text">            5,     ,     .<br>
<br>
<pre><code class="plaintext hljs">/ip firewall filter <font></font>
add action=add-src-to-address-list address-list=rdp_blacklist \<font></font>
    address-list-timeout=1w0d0h0m chain=forward comment=\<font></font>
    "night_rdp_blacklist" connection-state=new disabled=\<font></font>
    yes dst-port=3389 protocol=tcp src-address-list=rdp_stage8</code></pre><br>
  8    IP       . !<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, además de lo anterior, agregaré un enlace al artículo de Wiki, con la configuración de trabajo para proteger a Mikrotik de los escáneres de red. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki.mikrotik.com/wiki/Drop_port_scanners</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En mis dispositivos, esta configuración funciona junto con las reglas de honeypot descritas anteriormente, y las complementa bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: Como se sugiere en los comentarios, la regla de caída de paquetes se ha movido a RAW para reducir la carga en el enrutador.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es499130/index.html">BlockAdBlock Publicidad Ingeniería inversa antibloqueo</a></li>
<li><a href="../es499134/index.html">4 pasos para aumentar el producto LTV a través de la comunicación del usuario</a></li>
<li><a href="../es499136/index.html">#BeeFree, o ... Beeline - ¿no pudiste resistirte?</a></li>
<li><a href="../es499138/index.html">Clasificación topológica</a></li>
<li><a href="../es499140/index.html">Generación bajo control: cómo frenar modelos de lenguaje potentes</a></li>
<li><a href="../es499148/index.html">Aerosol y dióxido de cloro (ClO2): ¿cómo se relaciona esto?</a></li>
<li><a href="../es499150/index.html">Y un guerrero en el campo: ¿es posible proporcionar servicios de alojamiento de calidad sin un equipo?</a></li>
<li><a href="../es499152/index.html">DLL y Python</a></li>
<li><a href="../es499154/index.html">El resumen de materiales interesantes para el desarrollador móvil # 342 (del 20 al 26 de abril)</a></li>
<li><a href="../es499160/index.html">Российский SCRUM. Бессмысленный и беспощадный</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>