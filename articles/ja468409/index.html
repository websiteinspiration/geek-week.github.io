<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎵 🐳 🤦🏿 Slackクライアントのサービスワーカー：ダウンロードの高速化とオフラインモード 🌑 👡 👩🏼‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本日翻訳する資料は、Slackデスクトップクライアントの新バージョンの最適化に関する記事に特化しており、その中心的な機能の1つは読み込みの高速化でした。
 
 
 
 バックグラウンド
 Slackデスクトップクライアントの新しいバージョンでの作業の最初に、「スピーディブーツ」と呼ばれるプロトタイプ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Slackクライアントのサービスワーカー：ダウンロードの高速化とオフラインモード</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468409/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本日翻訳する資料は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デスクトップクライアントの新バージョンの最適化に関する記事に特化しており</font><font style="vertical-align: inherit;">、その中心的な機能の1つは読み込みの高速化でした。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/yq/fs/2h/yqfs2hg85qatg9osvxq8onvkhue.jpeg"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slackデスクトップクライアントの新しいバージョンでの作業の最初に、「スピーディブーツ」と呼ばれるプロトタイプが作成されました。このプロトタイプの目的は、ご想像のとおり、ダウンロードを可能な限り高速化することでした。 CDNキャッシュのHTMLファイル、事前に保存されたReduxストレージデータ、およびService Workerを使用して、クライアントのライトバージョンを1秒未満でダウンロードできました（そのとき、1〜2個のワークスペースを持つユーザーの通常のダウンロード時間は約5秒でした） ）サービスワーカーがこの加速の中心でした。さらに、Slackユーザーに頻繁に実装を依頼した機会への道を開きました。ここでは、クライアントのオフラインモードについて説明します。プロトタイプにより、変換後のクライアントが何ができるかを文字どおり一目で見ることができました。上記の技術に基づいて、Slackクライアントの処理を開始しました。結果を大まかに想像し、ダウンロードの高速化とオフラインプログラム操作モードの実装に焦点を当てました。更新されたクライアントのコアがどのように機能するかについて話しましょう。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスワーカーとは何ですか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスワーカー（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスワーカー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-実際には、ネットワークリクエスト用の強力なプロキシオブジェクトです。これにより、開発者は少量のJavaScriptコードを使用して、ブラウザがHTTP固有のリクエストを処理する方法を制御できます。</font><font style="vertical-align: inherit;">Service Workerは、Requestオブジェクトがキーとして使用され、Responseオブジェクトが値として使用されるように設計された、高度で柔軟なキャッシングAPIをサポートしています。</font><font style="vertical-align: inherit;">ワーカーをワーカーおよびWeb（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webワーカー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">としてサービスを提供し</font><font style="vertical-align: inherit;">ます。実行のメインスレッド、ブラウザウィンドウのJavaScriptコードの外で、独自のプロセスで実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workerテクノロジーが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アプリケーションキャッシュ</font></a><font style="vertical-align: inherit;">テクノロジーに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">続く</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、廃止されたと見なされます。これは、</font></font><code>AppCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オフライン機能を実装するサイトを作成するために使用される</font><font style="vertical-align: inherit;">インターフェースによって表されるAPIのセットでした</font><font style="vertical-align: inherit;">。を使用する場合</font></font><code>AppCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、開発者がオフラインで使用するためにキャッシュするファイルを記述する静的マニフェストファイルが使用されました。概して、これは機会に</font></font><code>AppCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限定されていました。このメカニズムは単純ですが、柔軟性がなく、開発者がキャッシュを特別に制御することはできませんでした。 W3C </font><font style="vertical-align: inherit;">では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Service Worker仕様の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発時</font><font style="vertical-align: inherit;">にこれが考慮されました。その結果、Service Workerにより、開発者はWebアプリケーションまたはWebサイトによって実行される各ネットワーク対話セッションに関する多くの詳細を管理できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテクノロジーの使用を始めたとき、Chromeがそれをサポートする唯一のブラウザーでしたが、サービスワーカーに対する幅広いサポートを待つ時間があまりないことがわかっていました。</font><font style="vertical-align: inherit;">現在、このテクノロジーは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至る所</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあり、すべての主要なブラウザーをサポートしています。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Service Workerの使用方法</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーが初めて新しいSlackクライアントを起動すると、リソース（HTML、JavaScript、CSS、フォント、サウンド）の完全なセットがダウンロードされ、Service Workerのキャッシュに配置されます。さらに、メモリにあるReduxリポジトリのコピーを作成し、このコピーをIndexedDBデータベースに書き込みます。プログラムが次回起動されるときに、対応するキャッシュの存在を確認します。ある場合は、アプリケーションをダウンロードするときに使用します。ユーザーがインターネットに接続している場合は、アプリケーションを起動した後に最新のデータをダウンロードします。そうでない場合、クライアントは操作可能なままです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントをロードするための上記の2つのオプションを区別するために、ホット（ウォーム）およびコールド（コールド）ダウンロードという名前を付けました。</font><font style="vertical-align: inherit;">ほとんどの場合、クライアントのコールドブートは、ユーザーが初めてプログラムを起動したときに発生します。</font><font style="vertical-align: inherit;">この状況では、キャッシュされたリソースやReduxデータは保存されません。</font><font style="vertical-align: inherit;">ホットブートでは、ユーザーのコンピューターでSlackクライアントを実行するために必要なものがすべて揃っています。</font><font style="vertical-align: inherit;">ほとんどのバイナリリソース（画像、PDF、ビデオなど）はブラウザキャッシュによって処理されることに注意してください（これらのリソースは通常のキャッシュヘッダーによって制御されます）。</font><font style="vertical-align: inherit;">サービスワーカーは、オフラインで作業できるように、特別な方法で処理しないでください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e2/86c/d90/3e286cd909ec21f50aec8152ac59baf1.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホットローディングとコールドローディングの選択</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスワーカーのライフサイクル</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workerは3つのライフサイクルイベントを処理できます。これらは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フェッチ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブ化</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。以下では、これらの各イベントへの応答方法について説明しますが、最初にService Worker自体のダウンロードと登録について説明する必要があります。そのライフサイクルは、ブラウザーがService Workerファイルの更新を処理する方法によって異なります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MDNで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認できる内容は次の</font><font style="vertical-align: inherit;">とおりです。「ダウンロードしたファイルが新しいものとして認識されると、インストールが完了します。これは、既存のファイルとは異なるファイル（ファイル間の違いはバイトで比較することによって決定されます）、または処理されているページでブラウザーが最初に検出したService Workerファイルのいずれかです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが対応するJavaScript、CSSやHTMLファイルを更新するたびに、それが独特のハッシュと、対応するファイルの記述でマニフェストを作成するカスタムWebPACKのプラグイン、（経由する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにある</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェストファイルの省略の例）。</font><font style="vertical-align: inherit;">このマニフェストはService Workerコードに埋め込まれているため、次回の起動時にService Workerが更新されます。</font><font style="vertical-align: inherit;">さらに、これは、サービスワーカーの実装が変更されない場合でも行われます。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍イベントのインストール</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスワーカーが更新されるたびに、イベントが発生し</font></font><code>install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。これに応じて、Service Workerに組み込まれたマニフェストに説明が含まれているファイルを調べ、各ファイルをロードして、対応するキャッシュブロックに配置します。ファイルストレージは</font><font style="vertical-align: inherit;">、Service Worker仕様の一部である</font><font style="vertical-align: inherit;">新しい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> APIを使用して編成されます</font><font style="vertical-align: inherit;">。このAPIは、オブジェクト</font></font><code>Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をキーとして使用してオブジェクトを</font><font style="vertical-align: inherit;">格納</font><font style="vertical-align: inherit;">します</font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。その結果、ストレージは驚くほどシンプルであることがわかりました。これは、Service Workerイベントが要求を受け取り、応答を返す方法とうまく調和しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブロックをキャッシュするキーは、ソリューションの展開時間に基づいて割り当てられます。</font><font style="vertical-align: inherit;">タイムスタンプはHTMLコードに埋め込まれているため、ファイル名の一部として、各リソースのダウンロードリクエストで送信できます。</font><font style="vertical-align: inherit;">互換性のないリソースの共有を回避するために、各デプロイメントからリソースを個別にキャッシュすることが重要です。</font><font style="vertical-align: inherit;">これにより、最初にダウンロードされたHTMLファイルが互換性のあるリソースのみをダウンロードすることを確認できます。これは、ネットワーク経由でダウンロードされたときも、キャッシュからダウンロードされたときも同じです。</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍イベントフェッチ</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workerが登録されると、同じソースに属するすべてのネットワーク要求の処理が開始されます。開発者はそれを行うことができないため、一部のリクエストはService Workerによって処理され、その他のリクエストは処理されません。ただし、開発者は、Service Workerが受け取ったリクエストを正確に実行するために必要なことを完全に制御できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リクエストを処理するとき、最初にそれを調べます。要求されたものがマニフェストに存在し、キャッシュに存在する場合、キャッシュからデータを取得することにより、要求に対する応答を返します。キャッシュに必要なものがなければ、サービスワーカーがこのプロセスにまったく関与していないかのように、実際のネットワークリソースにアクセスする実際のネットワークリクエストを返します。以下は、イベントハンドラの簡易バージョンです</font></font><code>fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">'fetch'</span>, (e) =&gt; {
&nbsp;&nbsp;<span class="hljs-keyword">if</span> (assetManifest.includes(e.request.url) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;e.respondWith(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caches<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.open(cacheKey)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> cache.match(e.request))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (response) <span class="hljs-keyword">return</span> response;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> fetch(e.request);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;e.respondWith(fetch(e.request));<font></font>
&nbsp;&nbsp;}<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、そのようなコードにはSlack固有のロジックがはるかに多く含まれていますが、ハンドラーのコアはこの例のように単純です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cf/86d/f94/1cf86df942a3064ac14c75cc47220fc1.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークインタラクションを分析するとき、Service Workerから返された回答は、データ量を示す列のServiceWorkerマークによって認識できます。</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍イベントアクティベート</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このイベント</font></font><code>activate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、新規または更新されたService Workerが正常にインストールされた後に発生します。</font><font style="vertical-align: inherit;">これを使用して、キャッシュされたリソースを分析し、7日より古いキャッシュブロックを無効にします。</font><font style="vertical-align: inherit;">これは、システムを適切に維持するための優れた方法であり、さらに、クライアントのロード時に古すぎるリソースが使用されないようにすることができます。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最新のリリースに遅れているクライアントコード</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントの最初の起動後にSlackクライアントを起動すると、最新のリソースではなく、以前のService Workerの登録時に読み込まれたキャッシュされたリソースが受信されることを、実装が意味していることに気づいたかもしれません。元のクライアント実装では、ダウンロードのたびにService Workerを更新しようとしました。ただし、典型的なSlackユーザーは、たとえば、朝1日に1回だけプログラムをダウンロードする場合があります。これにより、終日のコードが最新のリリースよりも遅れているクライアントと常に連携している可能性があります（1日に数回新しいリリースをリリースしています）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
訪問するとすぐに放棄される一般的なWebサイトとは異なり、ユーザーのコンピューター上のSlackクライアントは何時間も開いており、開いた状態です。その結果、コードの寿命はかなり長くなり、その関連性を維持するために特別なアプローチを使用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、ユーザーが最新バージョンのコードで作業できるように努めており、ユーザーは最新の機能、バグ修正、パフォーマンスの改善を受けることができます。</font><font style="vertical-align: inherit;">新しいクライアントをリリースした直後に、ユーザーが使用しているものとリリースしたものの間のギャップを狭めることができるメカニズムをクライアントに実装しました。</font><font style="vertical-align: inherit;">最後の更新後にシステムの新しいバージョンが展開された場合、クライアントが次回起動するときに使用される新しいリソースをロードします。</font><font style="vertical-align: inherit;">新しいものが見つからない場合、何もロードされません。</font><font style="vertical-align: inherit;">この変更がクライアントに加えられた後、クライアントにロードされたリソースの平均「ライフ」時間は半分になりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc5/6bd/544/bc56bd544f49378516f608c8e4e321f9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードの新しいバージョンが定期的にダウンロードされますが、プログラムのダウンロード時には最新バージョンのみが使用されます</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新機能フラグ同期</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新機能のフラグ（Feature Flags）を利用して、未完成のコードベースにマークを付けます。</font><font style="vertical-align: inherit;">これにより、公開前にコードに新機能を含めることができます。</font><font style="vertical-align: inherit;">このアプローチは、新しい機能をアプリケーションの残りの部分と一緒に自由にテストできるため、本番でのエラーのリスクを軽減し、作業が完了する前にこれを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slackの新機能は通常、対応するAPIに変更を加えるとリリースされます。 Service Workerの使用を開始する前は、APIの新機能と変更が常に同期されることが保証されていました。しかし、最新バージョンのコードが含まれていない可能性があるキャッシュを使用し始めた後、クライアントがコードがバックエンド機能と同期していない状況にある可能性があることがわかりました。この問題に対処するために、リソースだけでなく一部のAPI応答もキャッシュします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workerが絶対にすべてのネットワーク要求を処理するという事実により、ソリューションが簡素化されました。</font><font style="vertical-align: inherit;">Service Workerを更新するたびに、API要求を実行し、対応するリソースと同じキャッシュブロックに応答をキャッシュします。</font><font style="vertical-align: inherit;">これにより、機能と実験的機能が適切なリソースに関連付けられます-廃止される可能性がありますが、相互に一貫していることが保証されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これは、サービスワーカーのおかげで、開発者が利用できる機会の氷山の一角にすぎません。</font><font style="vertical-align: inherit;">メカニズムを使用しても解決できない問題</font></font><code>AppCache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、またはクライアントとサーバーの両方のメカニズムを解決する必要がある問題は、Service WorkerとキャッシュAPIを使用して簡単かつ自然に解決されます。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Service Workerは、次回クライアントが起動したときに使用できるリソースのローカルストレージを編成することにより、Slackクライアントのロードを加速しました。ネットワーク-ユーザーが遭遇する可能性のある遅延とあいまいさの主な原因は、現在、状況にほとんど影響を与えていません。私たちは、いわば、方程式からそれを削除しました。そして、方程式からネットワークを削除できれば、プロジェクトにオフライン機能を実装できることがわかります。現在、オフラインモードのサポートは非​​常に簡単です。ユーザーはクライアントをダウンロードし、ダウンロードした会話からメッセージを読むことができます。同時に、システムは読み取りメッセージの同期マークを準備します。しかし、現在は、より高度なメカニズムを将来実装するための基盤があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何ヶ月もの開発、実験、最適化の後、サービスワーカーが実際にどのように機能するかについて多くを学びました。</font><font style="vertical-align: inherit;">さらに、このテクノロジーは大規模プロジェクトに適していることがわかりました。</font><font style="vertical-align: inherit;">クライアントがService Workerを公開してから1か月も経たないうちに、インストールされた数百万人のService Workerから毎日数千万のリクエストを正常に処理しています。</font><font style="vertical-align: inherit;">これにより、新しい顧客のロード時間は古い顧客と比較して約50％短縮され、ホットロードはコールドよりも約25％高速であるという事実につながりました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/d46/330/9e8d463303d4002954ada304466550fd.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左から右へ：古いクライアントのロード、新しいクライアントのコールドロード、新しいクライアントのホットロード（インジケーターが低いほど良い）</font></font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者各位 </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトでService Workerを使用していますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></div></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468399/index.html">C / C ++。LinuxのGCCで作業するときに組み込みアプリケーションリソースを使用する方法</a></li>
<li><a href="../ja468401/index.html">ASP.NET Core + SPAでJWTを交換する安全な方法</a></li>
<li><a href="../ja468403/index.html">組み込みのソフトウェアアプリケーションランタイムコントロール</a></li>
<li><a href="../ja468405/index.html">なんとなく2つのブラウザがスクロールバーに入り......</a></li>
<li><a href="../ja468407/index.html">5G-ウェブを遅くする可能性が高い技術</a></li>
<li><a href="../ja468411/index.html">パフォーマンスの問題Moment.jsの解決に関するストーリー</a></li>
<li><a href="../ja468413/index.html">アクセラレーションinstagram.com。パート2</a></li>
<li><a href="../ja468415/index.html">なぜ1Cではないのですか？</a></li>
<li><a href="../ja468417/index.html">3CX v16 Update 3 Betaがリリースされました-AndroidおよびiOSでのビデオ通話、SIPトランクのTLS接続</a></li>
<li><a href="../ja468419/index.html">GoogleアナリティクスとGDPR：ユーザーの同意が必要ですか？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>