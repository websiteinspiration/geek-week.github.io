<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎅🏾 🕵🏻 🚶🏿 Dark Corners iOS自动可再生订阅 🌛 👩‍👩‍👦‍👦 👨🏾‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="越来越多的应用程序正在切换到订阅货币化系统。计划在您的应用程序中使用订阅系统？那给你
 

 Mobius 2019 Moscow Auto-renewable Subscriptions iOS , .
 

 — Mobius 2019 Moscow.
 
 

 iOS- Mamba. 15 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Dark Corners iOS自动可再生订阅</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/498686/"><p><img src="https://habrastorage.org/webt/bq/q6/zg/bqq6zgoalxrv0zfuzu3cwnomty4.png"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">越来越多的应用程序正在切换到订阅货币化系统。</font><font style="vertical-align: inherit;">计划在您的应用程序中使用订阅系统？</font><font style="vertical-align: inherit;">那给你</font></font></p><br>
<p>   Mobius 2019 Moscow       Auto-renewable Subscriptions  iOS       ,         .</p><br>
<p>  —        Mobius 2019 Moscow.</p><a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NbygMTsP1Ow" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>   iOS-   Mamba.  15           : macOS, Windows, Android, Bada, Tizen  Smart TV.</p><br>
<h2 id="dalee--povestvovanie-ot-lica-spikera"> —    .</h2><br>
<p>     ,       iOS-     ,     .</p><br>
<h2 id="plan-doklada"> </h2><br>
<ul>
<li>   ,       . </li>
<li>           . </li>
<li>    , —           . </li>
<li> « »   ,    ,          ,       AppStore.</li>
<li> « Boost»  « »     ,       ,      . </li>
</ul><br>
<h2 id="podpiski-rulyat"> </h2><br>
<p>      .    .<br>
<strong> </strong> —   ,              .<br>
<strong> </strong> —    15%   ,      ,      12      ,   60 .<br>
<strong> </strong> —    ,              .</p><br>
<p>     —    .     -   ,  - ,      . ,      ,      .</p><br>
<p>       :        .      iOS,    Android      .   ,    ,     Android-  .           ,       .   ,                 .            .     ,          .     .      .     ,       ,   ,    ,        ,  ,    .          ,        .</p><br>
<h2 id="realizaciya"></h2><br>
<p> 4       ,   ,     «».           ,     .</p><br>
<p><img src="https://habrastorage.org/webt/un/qu/6y/unqu6y0jqw_-go6d6urkw7gqiyc.png"></p><br>
<p>   ,  .  ,      ,   Apple,     , StoreKit,      Apple   .     ,    .      ,      ,   ,   .  Apple  ,      Receipt (). Receipt —   ,     -      .</p><br>
<p> ,   . </p><br>
<p><img src="https://habrastorage.org/webt/ng/n7/ig/ngn7igdxluxblso9kiaadpbfr4o.png"></p><br>
<p>-,   iOS 7,  ,    Bundle  ,     iOS,     . ,         . -,    ,  ,     -    PKCS#7.  payload,   ,   ,    JSON  XML,    ANS.1. Receipt     , —   .      .  Receipt    ,   ,     . Receipt    AppleId  .     StoreKit,     Receipt   .</p><br>
<p><img src="https://habrastorage.org/webt/-b/b4/ec/-bb4ecis1fnz9c09zqj1v1ybjhk.png"></p><br>
<p>    Apple  Receipt,          Receipt.     . </p><br>
<p><img src="https://habrastorage.org/webt/jd/9d/hs/jd9dhsvqfr4dfvv5aul7mvh6nss.png"></p><br>
<p>      ,  ,   Receipt ,     ,      ().      — .</p><br>
<p>    . </p><br>
<p><img src="https://habrastorage.org/webt/w2/in/cl/w2inclr_fpyzv-b0zed49ktiye4.png"></p><br>
<p>  Receipt ,   OpenSSL            GUID_hash  Receipt_hash.    GUID_hash  Receipt_hash    Apple.       Receipt    ANS.1       .     ANS.1    (ans1).  ,     ,  Objective-C     .   ,  GUIDE_hash  Receipt_hash,    .   ,     Receipt  .           latest_receipt_info   ,       expires_date.   ,      .</p><br>
<p>   ,         ,       .    ,       ,       .     ,    ,   . </p><br>
<p><img src="https://habrastorage.org/webt/fy/fo/h2/fyfoh2_x2lcahnzlnahl3cdzkbw.png"></p><br>
<p>,      ,    Receipt  .     ,        Receipt-,    .</p><br>
<p>            Receipt.        ,     .       if  else   ,    return       .          .<br>
         (exp.date),    ,    ,        .</p><br>
<p>         .</p><br>
<p>   </p><br>
<p> . </p><br>
<p><img src="https://habrastorage.org/webt/xd/ad/pe/xdadpe3wlzb8n3evkhlrcql6ocs.png"></p><br>
<p>    ,      ,    ,            .      .  —            - .    —       -,    .</p><br>
<h2 id="zaschita-pri-podhode-all-in-app">   All in App</h2><br>
<p>    ,    . -,       ,   ,     NSDefaults. -,       ,    verify,     ,       . -,       Jailbreak.  ,      ,    .    Jailbreak,       .   ,    ,   ,     ,  ,           .        ,   ,      Jailbreak-,   ,     . -       ,  - , ,   time server’.</p><br>
<p>           ,   C,  Objective-C, ,   ,     OpenSSL,     .           ,     ,      ,       .</p><br>
<h2 id="podhod---app-unlock-api-verify"> — App unlock, API verify</h2><br>
<p><img src="https://habrastorage.org/webt/8e/ch/0a/8ech0a2zi3njenoo7gkjmax8bic.png"></p><br>
<p>  “App unlock, API verify”  ,         ,      Apple.        —   API.    ,      ,   Receipt     Apple,                JSON. ,          ,     .</p><br>
<p><img src="https://habrastorage.org/webt/fv/ko/0v/fvko0vwqgj8bz35t-f6n9sw5u8a.png"></p><br>
<p>     ,          ,  verify    .   -  ,     Receipt. </p><br>
<p>  -   «Man in the middle».            «SSL Pinning».                    SSL .         Receipt   Apple,      .</p><br>
<p>             -,       .</p><br>
<h2 id="plyusy-i-minusy-podhoda">   </h2><br>
<p><img src="https://habrastorage.org/webt/ml/z-/oo/mlz-oo9w_h_qn7dmw3mcjlqiof0.png"></p><br>
<p>          ,    .      API,        Node.js.         Receipt.          ,          .  —     ,       , , -,     -,    .</p><br>
<h2 id="podhod---all-in-api"> — All in API</h2><br>
<p><img src="https://habrastorage.org/webt/_y/x4/ec/_yx4ecjhkm_vhm4wjfcj-g7_tjy.png"></p><br>
<p>      “All in API”,  ,   -,     expiration date     API.</p><br>
<p>       API, ,    Receipt,     ,  Receipt, Expiration date    ,     polling’.</p><br>
<p><img src="https://habrastorage.org/webt/6o/mz/pd/6omzpdwixxf2z11ptzztvwfamcs.png"></p><br>
<p>            .    ,       ,  .  Receipt,   Receipt    API,     .    Receipt ,           .        API  , ,        .       polling’.  polling ,   API   ,  -      Receipt,     ,     Apple.       Apple   Receipt  .       Receipt ,      ,       .</p><br>
<h2 id="plyusy-i-minusy-podhoda-1">   </h2><br>
<p><img src="https://habrastorage.org/webt/s_/q2/_d/s_q2_dhctwxdwuupxm3fgzyiffs.png"></p><br>
<p>           iOS-     .    -  ,    .  —      polling  ,       Receipt-   .     ,     . :  ,     ,        .          ,  ,     ,  -   ,  - ,           , , ,    ,   - . </p><br>
<p>,      polling        server-to-server notifications.     ,   Apple       .       ,      .</p><br>
<h2 id="notifications">Notifications</h2><br>
<p><img src="https://habrastorage.org/webt/uw/rl/ih/uwrlihyl6dddtkkyofa1tkcwxv8.png"></p><br>
<p>Notifications    callback-   URL,     iTunes.  ,       ,    App Transport Security.     ,      SSL-,      ,   Apple.        .      ,    SSL     .      . Notifications      Shared Secret,      iTunes      «password».  ,   ,     Notification.  2019   Notification   «unified_receipt»,          Receipt.     Notification   .  2019           unified_receipt. Notifications      original_transaction_id,        .</p><br>
<p><img src="https://habrastorage.org/webt/j-/zb/47/j-zb478skn94fe8ocvdaudyg_la.png"></p><br>
<p> Notifications        ,    .   9 , 9  .       ,         ,    GitHub    .  —  INITIAL_BUY,     ,     .   DID_FAIL_TO_RENEW —    ,       ,   .  ,   ,   DID_RECOVER,    ,          .    RENEWAL,     ,    DID_RECOVER,      ,   ,  RENEWAL —    DID_RECOVER.  ,   WWDC 19,      2020 ,  RENEWAL   .   CANCEL    :       ,       ,   Apple Care.</p><br>
<p><img src="https://habrastorage.org/webt/md/fk/t2/mdfkt2fdecskvi1hkcpp38jumq0.png"></p><br>
<p>    ,    .   DID_CHANGE_RENEWAL_STATUS.      ,        .  ,      ,       Notification,      .      Notification — DID_CHANGE_RENEWAL_PREF,  ,      ,       . INTERACTIVE_RENEWAL       ,   ,       ,      ,      iTunes    .     Notification,        ,      ,      . ,   2019 , PRICE_INCREASE_CONSENT,    ,        . </p><br>
<p><img src="https://habrastorage.org/webt/5r/v5/uh/5rv5uhhg-t8j6kacfkankhpjq0a.png"></p><br>
<p>     — Notification  ,          .     polling.   WWDC  Apple  ,    ,     .      —        .    Notification   100%    .   4        ,          .         polling.        polling      ,         ,       .        ,            .</p><br>
<p><img src="https://habrastorage.org/webt/yy/bw/jz/yybwjz0p5-zgjzasq6o85nuyi4w.png"></p><br>
<p> .       ,     ,    ,        .</p><br>
<h2 id="sravnim">?</h2><br>
<p>,      ,     .</p><br>
<p><img src="https://habrastorage.org/webt/n0/yl/89/n0yl89kxvmlautcwrbo19dk6dw0.png"></p><br>
<p>     : c ,  ,     .<br>
        ,  , -,     , -,     .       ,     ,      ,  - .      ,      API OpenSSL,      ,      .   ,   ,   ,  ,        .</p><br>
<p> ,      Apple,    ,       .       ,   .     ,     Receipt    Apple.  - ,        ,   .</p><br>
<p>      ,      API    .              - ,  ,  ,     .         ,      .</p><br>
<p>   , ..    ,        .  ,   ,          Notification,     -   ,    .</p><br>
<h2 id="rabota-nad-oshibkami">  </h2><br>
<p>     ,     ,     .</p><br>
<p>     ,    ,     . ,     , ,    ,        .         ,    ,    ,  -   ,   .</p><br>
<p> .   ,    ,      6  A4,          .    .</p><br>
<p><img src="https://habrastorage.org/webt/3s/tb/1h/3stb1hc1t9j1r530q8qbfkxtchg.png"></p><br>
<p>    ,      ,       ,      ,  ,             .      . -,  ,               , ..   .    —         ,                 .   —  ,     .    ,        ,         .          ,         ,           .</p><br>
<h3 id="kriterii-gruppirovki-oshibok">  </h3><br>
<p>  .  —   ,     .      ,  ,      purchase, ,  ,     .  —    ,          . , ,             finished.</p><br>
<h3 id="gruppy-oshibok"> </h3><br>
<p>        .      —  ,    .   — ,    ,  -          .    ,       ,     .    ,     ,      ,   ,       ,       .</p><br>
<h3 id="strategiya-obrabotki"> </h3><br>
<p>       .     ,   .          expiration date —    ,      .       ,      - ,   ,      .           , -   ,   ,      ,     ,   StoreKit.              ,   .      ,     .         .         ,   -   ,     ,      .   ,             6 ,      .   ,   ,    ,   , ,     ,   ,      ,      .         ,     -    .     ,  .           ,     ,     - .</p><br>
<h2 id="gryaznye-haki"> </h2><br>
<p>   ,           .   ,        . -,    « »,   ,    dark pattern ,     .    ,        ,     ,             «».  —       .      ,       ,     . ,  - ,         «».   —       .    ,        ,      ,   ,    ,     ,     .</p><br>
<h3 id="primery"></h3><br>
<p>   . ,   ,   «Weather Alarms»,      WWDC.</p><br>
<p><img src="https://habrastorage.org/webt/cj/yo/fl/cjyofld5uqzfm_f4tbyaqn689ek.png"></p><br>
<p>   3 .  —    «»,      ,     . -,   ,   UIScrollView ,           .   —    ,    80$    ,         .       «»   ,    - ,        .</p><br>
<p>  —  «Translate Assistant»,    «Google Translate». </p><br>
<p><img src="https://habrastorage.org/webt/_0/px/gp/_0pxgpd1xx9ffitvbkq2eiguie4.png"></p><br>
<p>       «»,      ,    .           .       ,      ,    .</p><br>
<p> — . «QR Code Reader» — ,     ,     «»       , ,  .</p><br>
<p>     37:36:</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NbygMTsP1Ow" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>    .  «Fitness balance», ,   ,      .          .</p><br>
<p>  37:58: </p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NbygMTsP1Ow" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>     ,    ,    ,        99$   “”.      ,   consumable In-App,     100    .</p><br>
<p>      ,    2018   TechCrunch.   ,  ,     ,           .  ,     ,  ,  Apple     ,      .      - ,  , -,  ,      review,       ,    AppStore.      , -       , ..    . -       Apple    developer    ,       ,         .     ,    - ,  Apple       .<br>
 Boost</p><br>
<p>  ,     ,      .</p><br>
<p>   —     Grace period.</p><br>
<p><img src="https://habrastorage.org/webt/wu/xq/8v/wuxq8vcw4nffmiptfgtfu0lu7je.png"></p><br>
<p>Grace period —  ,         ,             .      WWDC   ,   7   Grace period  16%          .    Grace period  iOS     ,      ,          .    ,      iTunes     ,         ,    . </p><br>
<p>      —   promotion     AppStore.    AppStore           ,     ,     .</p><br>
<p> —   , Introductory Offers,     2018 ,          .         ,     iTunes       .       .</p><br>
<p>        ,     ,        ,      Subscription Offers.        10  ,      ,     .    — ,           .     -,      .</p><br>
<p>      A/B   ,  ,               .</p><br>
<p> iOS 13       StoreKit   ,        AppleId  —       -  .<br>
  —  Subscription Multiple Apps,  ,         ,     . </p><br>
<h2 id="vopros-iz-zala-kak-testirovat">  :  ?</h2><br>
<p>   .      ,   ,    ,   ,   ,     notification.       —   notification-.    -  ,    ,   ,   ,     ,    notification-,      .      , ,    .</p><br>
<p>  StoreKit,  ,      Receipt   URL  Apple,      ,    .       ,       URL.      .         - ,        :      - ,           ,      Apple  Sandbox   ,            ,</p><br>
<h2 id="itogi"></h2><br>
<p>  ,      «App unlock, API verify»,      Apple,          .    ,       ,    ,      . </p><br>
<p>  —    .      , ,    ,  ,      ,     ,               .<br>
    .    notification-,      ,         ,     .      ,    ,   ,              . Notifications       -  ,       ,    .  :    ,        ,  .</p><br>
<hr><br>
<p>         WWDC,   :</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Auto-renewable Subscriptions</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Engineering Subscriptions</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Advanced StoreKit</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">In-App Purchases and Using Server-to-Server Notifications</a></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Best Practices and What’s New with In-App Purchases</a></p><br>
<p>   server-to-server notification.      notification,  , ,      notification, ,     .    Notification,    .</p><br>
<hr><br>
<blockquote>    -.  Mobius   22  25     -!   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN498662/index.html">COVID-19如何永久改变Google的搜索结果？</a></li>
<li><a href="../zh-CN498664/index.html">带有小部件的后端驱动的UI</a></li>
<li><a href="../zh-CN498672/index.html">按钮及其种类</a></li>
<li><a href="../zh-CN498674/index.html">2020年产品安全趋势在线会议视频录像</a></li>
<li><a href="../zh-CN498678/index.html">映射到山顶和靠近基督雕像的电话镜-投影仪如何使您在困难时期表达支持之词</a></li>
<li><a href="../zh-CN498688/index.html">很棒的A / B测试指南</a></li>
<li><a href="../zh-CN498692/index.html">SIP连接器电报+ Voximplant =呼叫蜂窝电话和软电话</a></li>
<li><a href="../zh-CN498694/index.html">混合印刷中心：我们每天如何实现数百万封信件</a></li>
<li><a href="../zh-CN498696/index.html">IT人员被迫切换到远程工作时会遇到什么问题？</a></li>
<li><a href="../zh-CN498700/index.html">IT是中产阶级。以及如何不去采访程序员</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>