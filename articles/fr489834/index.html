<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📍 👨🏿‍💼 ♐️ Intégrez votre appareil Smart Home dans l'écosystème SmartThings 👩‍❤️‍💋‍👨 🙏🏾 🦈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les plateformes Smart Home vous permettent d'intégrer des appareils et de créer de nouveaux scénarios pour leur interaction. L'effet de plate-forme es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Intégrez votre appareil Smart Home dans l'écosystème SmartThings</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/samsung/blog/489834/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les plateformes Smart Home vous permettent d'intégrer des appareils et de créer de nouveaux scénarios pour leur interaction. </font><font style="vertical-align: inherit;">L'effet de plate-forme est connu: les utilisateurs sont plus susceptibles de choisir celui avec lequel leurs appareils existants sont compatibles, plutôt que de passer à un nouveau. </font><font style="vertical-align: inherit;">Par conséquent, pour les développeurs de nouveaux appareils ingénieux, il peut s'avérer plus rentable de s'intégrer dans une plate-forme déjà terminée, en se concentrant sur le produit «fer», plutôt que de développer vos propres «vélos» sous la forme d'écosystèmes cloud et de comptes personnels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment intégrer votre propre appareil à la plateforme Samsung SmartThings Smart Home. </font><font style="vertical-align: inherit;">Nous mettons en œuvre une option de connexion directe pour contrôler l'appareil Smart Home en utilisant l'exemple d'un interrupteur à bouton et d'une ampoule tricolore.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cx/se/xy/cxsexydnzipoeqmkj3n7jq9x4iu.gif"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi avons-nous besoin de plateformes Smart Home?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, des gadgets et des appareils intelligents sont en vente - autant que vous le souhaitez. Pas de problème pour acheter une bouilloire avec contrôle Bluetooth ou une ampoule avec WiFi. Mais cela rend-il votre maison «intelligente»? Une situation n'est pas rare: une ampoule n'est contrôlée que via une application mobile du constructeur. Cela crée des inconvénients si vous essayez de combiner au moins plusieurs marques différentes. Par conséquent, la plate-forme idéale est celle qui vous permet de gérer les appareils de différents fabricants de la même manière.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, j'aimerais voir un «ordinateur se dissoudre dans la vie de tous les jours», comme le rêvait Mark Weiser de Xerox PARC: ne contrôlez pas via une application spéciale, ne vaporisez pas votre attention. Je voudrais une interaction naturelle avec un environnement intelligent qui ne change pas nos habitudes. Comment l'implémenter techniquement? Par exemple, il peut s'agir de scénarios impliquant des appareils hétérogènes dans la maison: vous vous êtes réveillé - l'appareil portable l'a détecté et la bouilloire s'est allumée; vous êtes rentré à la maison - le capteur sur la porte l'a enregistré, en tenant compte de l'heure, des rideaux fermés, de la lampe allumée et de la climatisation allumée en tenant compte de la température.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les scénarios deviennent encore plus utiles si nous utilisons Internet: par exemple, pour vérifier à distance si la prise avec le fer à repasser est fermée. </font><font style="vertical-align: inherit;">Ou un exemple banal: votre maison intelligente a regardé les prévisions météorologiques et vous a donné des conseils sur la meilleure façon de s'habiller. </font><font style="vertical-align: inherit;">Ou vous pouvez ajouter une commande vocale via un haut-parleur intelligent. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plateforme Smart Home est conçue pour tout cela. </font><font style="vertical-align: inherit;">Considérez ce que la plateforme Samsung SmartThings peut faire.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte - Que sont les SmartThings?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SmartThings a commencé en tant que startup. Au moment où il est apparu, en 2012 aux États-Unis, le thème de la «Smart Home» n'était pas encore au sommet du battage médiatique, il n'y avait toujours pas d'enceintes intelligentes et une variété de gadgets en magasin. L'idée est venue au fondateur de la startup, Alex Hawkinson, après un incident: sa maison familiale au Colorado a souffert du fait qu'après une panne de courant temporaire, les conduites d'eau étaient très froides, elles ont éclaté et tout le sol a été inondé. Puis il a pensé qu'il aurait pu prévenir le problème s'il avait su ce qui se passait dans la maison.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir vainement cherché une solution clé en main, Hawkinson et ses collègues ont réalisé un prototype de l'appareil et lancé une campagne sur Kickstarter. La campagne a connu un succès excessif, recueillant 1 200 000 $ au lieu des 250 000 $ prévus dans 30 jours. La vente d'un hub hub avec un petit ensemble d'appareils dans le kit a commencé: prise intelligente, capteur d'ouverture de porte, capteur de mouvement, capteur de présence. Et en 2019, déjà sous la marque Samsung SmartThings, la troisième version du hub a été lancée. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/xk/vi/hexkviuwr8rq2bf7z84ft-akdnm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La clé du succès sur Kickstarter était la disponibilité de prototypes fonctionnels de fer et de logiciels, et la convivialité pour la communauté des fabricants</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les créateurs de la startup ont quitté l'environnement de bricolage, ils développent donc constamment le concept d'une API ouverte pour les fabricants de geek qui peuvent agir en tant qu'adopteurs précoces à un stade précoce. Dans la campagne Kickstarter, il y avait un bouclier pour Arduino et divers modules cloud pour connecter en toute transparence votre appareil tiers. Sur Internet, vous pouvez trouver de nombreux exemples d'appareils faits maison compatibles avec SmartThings, qu'il s'agisse d'une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porte de poulailler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contrôlée </font><font style="vertical-align: inherit;">(avec la solution d'une tâche de la vie sérieuse - pour sauver les poulets d'un vison prédateur), ou de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">installation à</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> distance </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">d'</font></a><font style="vertical-align: inherit;"> un code de verrouillage électronique pour les clients avec Airbnb. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/fd/tl/ctfdtl25yhvhmrnz2yufm_qwhfw.jpeg" width="500"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source de la photo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.hackster.io/aaronpk/auto-airbnb-entry-745799</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2012-2013, SmartThings a effectué plusieurs cycles d'investissement et a reçu 12,5 millions de dollars. </font><font style="vertical-align: inherit;">Enfin, en 2014, elle s'est intéressée à Samsung et a été acquise pour 200 millions de dollars dans le cadre d'une stratégie visant à pénétrer le marché de l'Internet des objets. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les capacités du cloud de la plate-forme sont restées gratuites: les auteurs, désormais employés de Samsung, n'excluant pas la possibilité théorique de facturer de gros volumes de trafic, soulignent: il y aura toujours une option gratuite pour les développeurs d'appareils. </font><font style="vertical-align: inherit;">C'est bien, car maintenant presque tous les services cloud prévoient la monétisation, et souvent même pour une période d'essai, vous devez joindre une carte bancaire. </font><font style="vertical-align: inherit;">SmartThings est une plateforme entièrement gratuite.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture de SmartThings</font></font></h1><br>
<img src="https://habrastorage.org/webt/dm/gw/ir/dmgwirddjoqbh-1caazcx5kg-sc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Déplaçons le motif de gauche à droite.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dispositifs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Périphériques SmartThings - il peut s'agir non seulement de périphériques de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la suite SmartThings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais également de nombreux partenaires tiers de la liste des partenaires. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ut/j6/oq/utj6oqymmwwnqazkm_jekxgymwq.jpeg" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'appareil ne figure pas dans la liste des appareils officiellement pris en charge, vous pouvez y rechercher le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaire d'appareil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - il peut être fourni par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la communauté des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> développeurs - ou écrire le vôtre.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Méthodes de connexion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez connecter des appareils à la plate-forme des manières suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecté au concentrateur - via un concentrateur concentrateur, pertinent pour les appareils qui n'ont pas leur connexion Internet, mais qui sont connectés via des réseaux sans fil traditionnels comme ZigBee pour de tels systèmes.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Directement connecté - via Internet directement au cloud. </font><font style="vertical-align: inherit;">SmartThings a récemment </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publié un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caméscope, une ampoule et une prise intelligente, et ils fonctionnent sans concentrateur - via le WiFi. </font><font style="vertical-align: inherit;">C'est l'option que nous allons implémenter dans ce guide.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecté au cloud - via un cloud tiers pour les appareils qui ont déjà leur propre écosystème cloud. </font><font style="vertical-align: inherit;">C'est plus compliqué, donc nous n'envisagerons pas une telle option.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Centre</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En règle générale, pour connecter une variété d'équipements dans votre maison devrait être un petit serveur spécial "Smart Home" qui prend en charge divers protocoles. </font><font style="vertical-align: inherit;">Lui - un hub, un hub, une passerelle - les noms sont différents. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/yy/_b/gxyy_bk9o6kvzdfzldagqw4lbb0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hub et un ensemble d'appareils à elle. </font><font style="vertical-align: inherit;">Source de la photo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IXBT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application SmartThings est une application qui peut être installée sur le système d'exploitation mobile principal et avec son aide: ajouter de nouveaux appareils au système, contrôler ceux déjà ajoutés, définir des règles d'automatisation, recevoir des notifications par push et SMS, et bien plus encore.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/tu/-q/uatu-qhi_oijgiuumtopuqsjedk.png" width="400"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abstraction</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans SmartThings, comme dans de nombreuses autres plates-formes de maison intelligente, il existe les abstractions suivantes: pièces, scènes, scénarios.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appareils sont regroupés en pièces. </font><font style="vertical-align: inherit;">Vous attachez simplement tel ou tel gadget à une pièce de l'application et vous l'appelez «Cuisine», «Salle de bain», «Couloir». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe encore des scènes (scènes) - ce sont des situations: «sommeil», «repos», «travail», «regarder un film» - chacune des situations est caractérisée par son propre ensemble d'états de périphérique. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/vo/5o/qtvo5o8yo8thwuwhptupdthayjc.png" width="300"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scènes et pièces sur l'écran d'application</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et enfin, les scripts (Routines): règles d'automatisation if-then. Par défaut, le programme comporte quatre scénarios: «Je suis de retour», «Bonne nuit», «Au revoir», «Bonjour». Vous pouvez configurer l'activation du script en fonction de la condition du matin, ou en cas de mouvement, ou en cas d'ouverture de la porte, etc. Un exemple non trivial: lorsque j'entre du trafic réseau à domicile sur ma caméra de surveillance à domicile pour éviter la fuite de mes vidéos personnelles. Ou un exemple éducatif cruel: déconnectez de force la tablette du réseau quand il est 11 heures du soir pour vous empêcher de rester sur Internet au lieu d'un sommeil sain.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7j/gp/qg/7jgpqgdehbjdzjtpmfnf7a2supc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, dans le programme SmartThings au téléphone, il existe une opportunité intéressante - mémoriser des actions typiques. Lorsque vous utilisez souvent le téléphone, au fil du temps, il commence à vous indiquer la meilleure façon de configurer les scènes en fonction des applications les plus fréquemment lancées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ajouter de nouveaux périphériques au système, un système de plug-in est fourni. Le développeur peut programmer le plug-in pour son propre appareil - l'interface utilisateur à l'intérieur de l'application SmartThings et la logique de l'appareil. Il s'agit essentiellement d'une application Web. Du point de vue du développeur, le plugin peut s'abonner aux événements ou notifications de l'appareil, lui envoyer un message, surveiller l'état de la connexion avec l'appareil. Il existe une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> claire </font><font style="vertical-align: inherit;">sur le cycle de vie du plugin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils sont téléchargés par l'utilisateur depuis le "plug-in store" selon les besoins, afin de ne pas gonfler l'application sur le téléphone. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2t/i7/6p/2ti76pkvardmqwv2efyxjh5nec4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais maintenant, nous ne ferons plus de plug-ins, mais nous allons simplifier: nous allons ajouter un appareil fait maison en utilisant uniquement des outils de plate-forme standard.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre votre appareil compatible avec SmartThings</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez peut-être une question: pourquoi? </font><font style="vertical-align: inherit;">Quel est l'intérêt de le rendre compatible si vous êtes développeur d'appareils?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le principal avantage est l'augmentation de la valeur du produit grâce à l'intégration automatique avec l'ensemble de l'écosystème.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous réserve du succès des tests fonctionnels, vous pouvez coller le logo: «Compatible avec SmartThings» sur la boîte du produit, garantissant ainsi une installation et une configuration sans problème de l'appareil dans l'écosystème SmartThings.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme avec n'importe quelle plate-forme, votre tâche est facilitée: vous n'avez plus besoin d'essayer de développer, par exemple, une interface utilisateur - vous pouvez utiliser les boutons standard et d'autres éléments de l'interface SmartThings.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous obtenez des relations publiques et un public d'utilisateurs grâce à la communauté SmartThings (elle est vivante et active).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le manuel ci-dessous, nous connecterons notre propre appareil entièrement personnalisé.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que propose-t-on de faire</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le SDK SmartThings Device (STDK) a récemment été présenté à la Samsung Developer Conference en octobre 2019. Ci-dessous, nous proposons une traduction du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manuel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de ce SDK. Et pas seulement une traduction: nous avons fait la même chose et l'avons répétée de nos propres mains, il y aura donc des commentaires pratiques qui vont au-delà du manuel d'origine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À quoi ressemblera le résultat final dans la vidéo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Rvo6pbI2-0U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La lampe RVB est connectée à la plate-forme SmartThings via WiFi, et vous la contrôlez via le téléphone. La lampe elle-même est mise en œuvre de la manière la moins chère et la plus simple - sur la puce ESP8266 super populaire. Le fer n'est pas important: il peut être fait sur n'importe quel microcontrôleur, car le SDK est écrit en C, disposé dans le domaine public et il peut être porté si vous le souhaitez. Il est peu probable que l'ESP entre en production (pour commencer, il est plus pratique d'utiliser d'autres interfaces dans la maison intelligente que le WiFi), mais il convient tout à fait au modèle et à l'illustration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonctionnalité de l'ampoule intelligente qui en résulte sera la suivante: Contrôle LED RVB à l'aide de la roue chromatique du téléphone. En plus de l'éteindre et de l'activer à l'aide du bouton. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le processus de développement est illustré dans le diagramme:</font></font><br>
<img src="https://habrastorage.org/webt/ba/kb/_h/bakb_hunqhwmmaovm0jk2xrbqgk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le processus indiqué n'est pas difficile, certaines étapes peuvent être inversées, ce que nous montrerons dans le manuel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le manuel d'origine montre tout sur l'exemple de la carte WeMos D1 Mini, il s'agit d'une carte de débogage basée sur ESP8266 qui peut être insérée dans la planche à pain. </font><font style="vertical-align: inherit;">En général, il n'y a rien de délicat, c'est juste un module de la puce ESP chinoise qui est super populaire parmi les fans, soudé pour plus de commodité à une carte plus large de la taille de la planche à pain. </font><font style="vertical-align: inherit;">Par conséquent, vous pouvez tout faire sur n'importe quel autre tableau. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/lo/8t/rslo8ts8_gfmrhvrrnh-jb87yry.jpeg" width="200"> <img src="https://habrastorage.org/webt/bl/sg/mw/blsgmwf3onhbr9x9y4s9dxialiw.jpeg" width="200"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gauche: WeMos D1, droite - Troyka WiFi Shield</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Doux</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce dont vous avez besoin pour construire l'exemple:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version Ubuntu Linux pas inférieure à 18.04 (vous pouvez construire un exemple pour Windows et MacOS, mais pour être précis, nous avons choisi Linux)</font></font><br>
</li>
<li>  Android    1.7.39,  iOS    1.6.41-343.   Play Market  SmartThings,     Samsung Account.       Samsung,    .<br>
</li>
<li>ESP8266 SDK.  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  ,   ,   :<br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/espressif/ESP8266_RTOS_SDK.git</code></pre><br>
     SDK   IDF_PATH:<br>
<br>
<pre><code class="bash hljs">nano ~/.bashrc
<span class="hljs-built_in">export</span> IDF_PATH=<span class="hljs-string">"~/git/ESP8266_RTOS_SDK:<span class="hljs-variable">$IDF_PATH</span>"</span></code></pre></li>
<li>   :<br>
<br>
<pre><code class="bash hljs">sudo apt-get install gcc git wget make libncurses-dev flex bison gperf python python-pip python-setuptools python-serial python-cryptography python-future python-pyparsing python-pyelftools</code></pre><br>
   ():<br>
<br>
<pre><code class="bash hljs">sudo mkdir /opt/Espressif<font></font>
sudo chown username /opt/Espressif/<font></font>
<span class="hljs-built_in">cd</span> /opt/Espressif<font></font>
wget https://dl.espressif.com/dl/xtensa-lx106-elf-linux64-1.22.0-100-ge567ec7-5.2.0.tar.gz<font></font>
tar -xzf ./xtensa-lx106-elf-linux64-1.22.0-100-ge567ec7-5.2.0.tar.gz<font></font>
<span class="hljs-built_in">cd</span> xtensa-lx106-elf
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/opt/Espressif/xtensa-lx106-elf/bin:<span class="hljs-variable">$PATH</span>"</span></code></pre><br>
</li>
<li>Smart Things Device SDK C –   .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  github,         ,     ,       .<br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/SmartThingsCommunity/st-device-sdk-c-ref.git
<span class="hljs-built_in">cd</span> st-device-sdk-c-ref<font></font>
./setup.sh esp8266</code></pre><br>
</li>
</ul><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appareils suivants seront considérés comme des exemples: interrupteur intelligent et ampoule intelligente. </font><font style="vertical-align: inherit;">Nous allons commencer par un interrupteur intelligent, plus simple et ne nécessitant aucun périphérique externe.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 1. Enregistrez votre appareil.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le travail commence dans l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace de travail du développeur SmartThings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , où vous devez vous connecter à l'aide de votre compte Samsung. </font><font style="vertical-align: inherit;">Ce compte est créé gratuitement, et pour le créer il n'est pas nécessaire d'avoir un téléphone Samsung.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rz/vc/tb/rzvctbgclnb7ug6rcxccoqsfe88.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans Developer Workspace, il vous est immédiatement proposé de créer le premier projet. </font><font style="vertical-align: inherit;">Nous sommes d'accord, après quoi, parmi les deux options de projet, vous devez sélectionner l'intégration des périphériques. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/7z/0f/mh7z0fghp37p2_kfmlj4p3bjkvg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le choix sera donné trois options pour intégrer l'appareil:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SmartThings Cloud Connector - pour connecter des appareils qui ont leur propre cloud qui seront connectés au cloud SmartThings</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SmartThings Hub n'est pas disponible pour les appareils ZigBee, Z-Wave, Bluetooth et au moment de la rédaction, car le hub n'est pas encore officiellement vendu en Russie</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Directly Connected est l'option la plus simple pour se connecter directement, sans intermédiaire.&nbsp;</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choisissez la troisième option. </font><font style="vertical-align: inherit;">Pensez à un nom de projet, par exemple, pour plus de simplicité - SmartSwitch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/dg/5w/ordg5wpiqskc-9kyau_hjlquhaq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez un profil d'appareil. </font><font style="vertical-align: inherit;">En termes de POO, un profil de périphérique est une telle «classe», et un périphérique spécifique est une «instance de classe». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons déterminer les caractéristiques fonctionnelles de l'appareil en termes de capacité SmartThings. </font><font style="vertical-align: inherit;">Vous pouvez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur les «capacités» générales de l'appareil </font><font style="vertical-align: inherit;">dans le manuel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gk/sx/wl/gksxwlnkswip3cxd21fngup5jc0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous remplissons les champs avec nos valeurs. </font><font style="vertical-align: inherit;">Par exemple, le nom du profil peut être saisi Test Switch Profile, description - n'importe quel texte, type d'appareil - Switch, Vendor ID - n'importe quel texte. </font><font style="vertical-align: inherit;">"Type d'appareil" affecte l'icône de votre appareil et l'interface utilisateur. </font><font style="vertical-align: inherit;">Il n'y a pas beaucoup de types d'appareils possibles sur la liste (bien qu'il y en ait des exotiques, par exemple WineCellar - une cave à vin), donc si vous ne trouvez pas le vôtre, ne vous découragez pas et choisissez simplement le plus proche et le plus proche. </font><font style="vertical-align: inherit;">Sur le dernier écran (Dashboard Control), vous ne pouvez rien changer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir créé le profil, n'oubliez pas de cliquer sur le bouton «Ajouter un profil d'appareil au projet» en haut à droite.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/py/_m/ou/py_mouuxfu6aqpzsuhypzlwxhau.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important: Health Check est requis pour tous les appareils directement connectés. </font><font style="vertical-align: inherit;">Ajoutez-le au profil de l'appareil.&nbsp;</font></font><br>
</li>
<li>  « »   : Switch, Health Check.<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez maintenant le profil d'authentification (profil d'intégration). En bref, dans ce profil, vous pouvez personnaliser les écrans qui apparaissent lorsque vous vous connectez et vous connectez pour la première fois. Saisissez un nom et un numéro à trois chiffres. Vous pouvez ignorer les deux autres écrans pour l'instant. Sur le dernier écran, sélectionnez l'option de confirmation - Bouton Confirmer - en appuyant sur le bouton de l'appareil. Dans ce manuel, nous supposons que vous avez une carte avec un bouton intégré. Si tout à coup il n'y a pas de bouton (par exemple, vous utilisez un autre module ESP), alors vous pouvez choisir l'option sans authentification du tout - elle s'appelle Just Works, c'est-à-dire qu'elle «fonctionne juste» sans aucune question. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, par analogie avec l'exemple précédent, n'oubliez pas de cliquer sur le bouton "Ajouter l'intégration de l'appareil au projet".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_4/8w/k1/_48wk1mewseukstfc4rbvdjx8qw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'à cliquer sur le bouton Déployer. </font><font style="vertical-align: inherit;">Après cela, vous pouvez voir votre appareil dans l'application SmartThings - mais uniquement en mode développeur. </font><font style="vertical-align: inherit;">Si Deploy n'est pas poussé et qu'ils écrivent «Veuillez ajouter un nom de modèle» - cela signifie que vous n'avez pas spécifié d'ID d'intégration de périphérique, faites défiler la page ci-dessous et faites-le - entrez le nom de votre choix. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/l1/cc/pr/l1ccprru9d4xx-2onzisikmuhlk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant commencer à tester votre appareil virtuel sur votre téléphone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première étape entière est présentée en détail dans la vidéo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/0KLJNC2nj5M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrer un appareil dans le cloud</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de commencer à travailler avec le matériel réel, vous devez faire autre chose. Après avoir appuyé sur le bouton Déployer, l'écran sera différent: un nouveau champ Identité du périphérique y apparaîtra.&nbsp; </font></font><br>
<img src="https://habrastorage.org/webt/ow/hj/tk/owhjtkpdu8stli8nbv5hykchulo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour authentifier votre appareil dans le cloud SmartThings, vous devez entrer son numéro de série et sa clé publique (avec le schéma de signature ED25519). C'est assez simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet exemple montre comment créer une paire de clés ED25519 à l'aide d'un outil du SDK. Vous obtiendrez le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">device_info.json</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme résultat du programme dans le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dossier tools / keygen / linux / output_ {serialNumber}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La version Linux de keygen se trouve dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st-iot-device-sdk-c-reference / iot-core / tools / keygen / linux</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st-device-sdk-c / tools / keygen / linux</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le numéro de série de l'appareil de test sera généré de manière aléatoire au format STDK + [MNID] + format alphanumérique (8 caractères). </font><font style="vertical-align: inherit;">Vous pouvez trouver votre MNID dans le profil de développeur dans la section Gérer le compte.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f6/6b/tq/f66btqfqggupzu83olz6lbaru6c.png" width="300"><br>
<br>
<img src="https://habrastorage.org/webt/qv/1k/p0/qv1kp0xha-it8b8xnyaa4hj2fe8.png" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, pour générer la partie alphanumérique, vous devez entrer votre MNID (4 caractères) comme paramètre keygen. </font><font style="vertical-align: inherit;">Dans l'exemple ci-dessous, le MNID est fJ * c.</font></font><br>
<br>
<pre><code class="bash hljs">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">cd</span> ~/Workspace/st-iot-device-sdk-c-ref/iot-core/tools/keygen<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;./stdk-keygen -m fJ*c<font></font>
&nbsp;&nbsp;&nbsp; Go Device Identity of Developer Workspace.<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Serial Number:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;┌──────────┬──────────┐<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;│ STDKfJ*c&nbsp; &nbsp; │ abed**5c   │<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;└──────────┴──────────┘<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;Public Key:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;waGgyjWIvHhF1LU***FG2hx/4u***ADFHr/ry0j5jbk=<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copiez «abed ** 5c» de l'émission keygen et collez-le dans les champs XXXXXXXX de la section Enregistrement de l'identité du périphérique. </font><font style="vertical-align: inherit;">Une fenêtre apparaîtra vous demandant d'entrer la clé publique. </font></font><br>
<img src="https://habrastorage.org/webt/wv/bd/ft/wvbdftti3tqz7qug9us-jphddq8.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copiez la clé publique de l'émission keygen («waGgyjWIvHhF1LU *** FG2hx / 4u *** ADFHr / ry0j5jbk =» dans cet exemple) et collez-la dans le champ «Device Public Key».</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/wn/60/gxwn602ru15zwlvouhg68zo8918.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 2. Micrologiciel de l'appareil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlez du code que vous téléchargerez sur l'appareil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des exemples de firmware se trouvent dans le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dossier st-device-sdk-c-ref / apps / esp8266 /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous serons intéressés par l'exemple </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st_switch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Téléchargez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboarding_profile.json</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la fenêtre de </font><b><font style="vertical-align: inherit;">présentation</font></b><font style="vertical-align: inherit;"> de votre appareil dans le bureau du développeur.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/he/mn/o5hemnlglw1ak1cu134aqeka4sm.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiez le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onboarding_profile.json</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> téléchargé </font><font style="vertical-align: inherit;">dans le répertoire de votre application - dans notre cas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apps / esp8266 / st_switch / main</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="plaintext hljs">cd ~/Workspace/st-device-sdk-c-ref/apps/esp8266/st_switch/main/<font></font>
cp ~/Downloads/onboarding_profile.json .<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe déjà un exemple d'un tel fichier - remplacez-le simplement par le vôtre.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De même, copiez le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">device_info.json</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fichier </font><font style="vertical-align: inherit;">de l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outil / keygen / linux / output_ {} serialNumber dossier</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans lequel les informations spécifiques à l' </font><font style="vertical-align: inherit;">appareil se trouve, dans le même dossier, en </font><font style="vertical-align: inherit;">remplaçant le fichier existant.</font></font><br>
<br>
<pre><code class="plaintext hljs">cd ~/Workspace/st-device-sdk-c-ref/iot-core/tools/keygen/linux/<font></font>
cp output_{serialNumber}/device_info.json ~/Workspace/st-device-sdk-c-ref/apps/esp8266/st_switch/main/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce fichier, en plus des clés et du numéro de série, il y a la ligne «firmwareVersion» - elle peut être remplacée par la version de votre programme.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, assemblez et flashez le programme.</font></font><br>
<br>
<pre><code class="plaintext hljs">cd ~/Workspace/st-device-sdk-c-ref<font></font>
./build.sh esp8266 st_switch<font></font>
./build.sh esp8266 st_switch flash<font></font>
./build.sh esp8266 st_switch monitor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou le même, mais plus court:</font></font><br>
<br>
<pre><code class="plaintext hljs">cd ~/Workspace/st-device-sdk-c-ref<font></font>
./build.sh esp8266 st_switch flash monitor</code></pre><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
! </font><font style="vertical-align: inherit;">Si vous ne pouvez pas flasher le programme de quelque manière que ce soit, vous avez probablement oublié de mettre la carte ESP8266 en mode de programmation. </font><font style="vertical-align: inherit;">Cela se fait généralement en appuyant sur un bouton de la carte elle-même. </font><font style="vertical-align: inherit;">Par exemple, le module Wi-Fi Troyka peut être traduit en maintenant enfoncé le bouton PROG, puis en appuyant et en relâchant le bouton RESET. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le firmware téléchargé, n'oubliez pas de redémarrer la carte.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape 3. Connexion et contrôle depuis le téléphone</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Activez le mode développeur dans l'application SmartThings sur votre téléphone. Comment faire est </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">écrit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur le site officiel, mais il est plus facile de l'expliquer avec des mots: entrez les paramètres via le "gear" et appuyez sur le bouton "SmartThings Details" pendant 20 secondes. Le menu «Developer Mode» apparaît ci-dessous. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/di/vs/hs/divshsyn6jnwbmaox3t_mkpaebe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre appareil doit être visible dans la liste de l'application SmartThings: lancez l'application, cliquez sur le bouton plus et Ajouter un appareil. Faites défiler jusqu'à la fin de la liste des fournisseurs et voyez l'icône «Mes appareils de test». Cliquez dessus et sélectionnez votre appareil. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_o/ks/pa/_okspakmd1pndm_lh-xpbeehyw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus: si vous avez déjà activé le mode développeur et allumé l'appareil, vous aurez alors un menu contextuel proposant d'ajouter cet appareil particulier! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion </font><i><font style="vertical-align: inherit;">démarre</font></i><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8n/by/pd/8nbypdf-00xmksrlukpvetjlv2m.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gérez l'appareil à partir de l'application SmartThings.&nbsp;</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un premier temps, l'appareil apparaît comme un point d'accès, car il ne connaît pas encore le mot de passe de votre WiFi. </font><font style="vertical-align: inherit;">Au cours du processus de connexion, vous spécifiez le réseau avec lequel l'appareil doit se connecter. </font><font style="vertical-align: inherit;">Si vous avez un point d'accès caché, ESP ne pourra pas s'y connecter, alors choisissez un point ouvert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat sera le suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/--/pw/ne/--pwnex-v3o9iewlsmw7xk-lps8.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st-switch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), vous contrôlez la LED intégrée sur la carte en appuyant sur le bouton de la carte elle-même. </font><font style="vertical-align: inherit;">Comme vous pouvez le voir, pour cet exemple, vous n'avez même pas besoin de périphériques supplémentaires, uniquement la carte ESP8266 elle-même. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez également allumer / éteindre l'appareil avec le bouton du panneau de commande dans l'application mobile: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/ze/-7/nzze-7ywppruvlqiafqpz4-xgew.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien sûr, si vous appuyez sur le bouton physique, le statut de l'ampoule dans l'application est également mis à jour.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple d'éclairage intelligent</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir fait l'exemple Smart Switch, essayons de compliquer un peu les choses. </font><font style="vertical-align: inherit;">Il y aura une LED RVB, et nous activerons / désactiverons un bouton externe, et sélectionnerons également une couleur via l'application.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le fer</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma de connexion sera simple: </font></font><br>
<img src="https://habrastorage.org/webt/sv/xh/cf/svxhcfrv9zn7brswyuebeh_jd9o.png" width="500"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le schéma de circuit ne fait pas de mal non plus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1z/gu/8v/1zgu8vamare3efr_qqtqt_s6bqa.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
si vous regardez la source (située à: st-device-sdk-c-ref / apps / esp8266 / st_lamp), alors la connexion est la suivante: </font><font style="vertical-align: inherit;">
vous pouvez réaffecter les conclusions selon lesquelles c'est le modèle de la planche que vous avez. </font><font style="vertical-align: inherit;">Veuillez noter qu'il existe un système de notation (D1, D2 ...) sur la carte, et un autre dans le code, mais cela est facile à comprendre simplement en consultant la documentation de votre carte.</font></font><br>
<br>
<code>#define GPIO_OUTPUT_NOTIFICATION_LED 2<br>
#define GPIO_INPUT_BUTTON 5<br>
#define GPIO_OUTPUT_COLORLED_R 16<br>
#define GPIO_OUTPUT_COLORLED_G 14<br>
#define GPIO_OUTPUT_COLORLED_B 12<br>
#define GPIO_OUTPUT_COLORLED_0 13&nbsp;</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie logiciel</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon la partie logicielle, nous allons changer plusieurs étapes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de l'ajout de capacités, vous devez spécifier les éléments suivants: Switch, Switch Level, Color Control, Health Check. </font><font style="vertical-align: inherit;">Le type d'appareil sera - Light.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous prenons un exemple de firmware du même dossier avec des exemples, il s'appelle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">st_lamp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interface de l'application </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r9/qh/d_/r9qhd_lnaxlrnd5qcxonqzu2k70.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ressemblera à </font><font style="vertical-align: inherit;">ceci: à </font><font style="vertical-align: inherit;">quoi cela ressemble en action - encore une fois GIF:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cx/se/xy/cxsexydnzipoeqmkj3n7jq9x4iu.gif"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, vous avez un exemple de travail prêt. </font><font style="vertical-align: inherit;">Vous voyez que la plupart du code a déjà été fait pour vous - tout ce qui concerne la connexion, l'authentification, l'interface de l'appareil. </font><font style="vertical-align: inherit;">L'exemple SmartThings est précieux en ce qu'il n'est lié à aucun périphérique matériel, et vous pouvez regarder et évaluer les fonctionnalités de la plate-forme nécessaires dans 2k20 si vous développez une maison intelligente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/kt/h0/g8kth04siprq-9s2uwlli2fp6ae.jpeg" align="left"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatyana Volkova - Auteur du programme de suivi de l'Internet des objets de la Samsung IT Academy, spécialiste des programmes de responsabilité sociale des entreprises au Samsung Research Center</font></font><br>
</i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489822/index.html">Génération de nombres pseudo-aléatoires à l'aide d'un automate cellulaire: règle 30</a></li>
<li><a href="../fr489824/index.html">7 outils de surveillance de la sécurité du cloud open source à connaître</a></li>
<li><a href="../fr489826/index.html">À propos des méthodes mutables d'un objet Math en JavaScript</a></li>
<li><a href="../fr489828/index.html">Travailler avec GeoJSON dans Node.js: une introduction pratique</a></li>
<li><a href="../fr489832/index.html">Perles atomiques artificielles: manipulations avec des macrocycles</a></li>
<li><a href="../fr489836/index.html">Lidars du futur: 11 000 lasers au lieu de 128</a></li>
<li><a href="../fr489838/index.html">Fuite de mémoire côté serveur Nuxt à l'aide de SSR (rendu côté serveur)</a></li>
<li><a href="../fr489840/index.html">Drive Anatomy: Disques durs</a></li>
<li><a href="../fr489844/index.html">Analyse comparative de certains décompilateurs Java</a></li>
<li><a href="../fr489848/index.html">Pourquoi mes collègues / employés se comportent-ils comme @% §?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>