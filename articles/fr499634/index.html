<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè© üî≠ üë©üèª‚Äçüöí TypeScript avanc√© üîé üßù üë©üèª‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apn√©e - plong√©e sous-marine sans plong√©e sous-marine. Le plongeur ressent la loi d'Archim√®de: il d√©place une certaine quantit√© d'eau, ce qui le repous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TypeScript avanc√©</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/499634/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apn√©e - plong√©e sous-marine sans plong√©e sous-marine. </font><font style="vertical-align: inherit;">Le plongeur ressent la loi d'Archim√®de: il d√©place une certaine quantit√© d'eau, ce qui le repousse. </font><font style="vertical-align: inherit;">Par cons√©quent, les premiers m√®tres sont les plus durs, mais la force de pression de la colonne d'eau au-dessus de vous commence √† se d√©placer plus profond√©ment. </font><font style="vertical-align: inherit;">Ce processus rappelle l'apprentissage et la plong√©e dans les syst√®mes de type TypeScript - il devient un peu plus facile lorsque vous plongez. </font><font style="vertical-align: inherit;">Mais nous ne devons pas oublier d'√©merger dans le temps. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/eb/y9/sheby96u0qt6o3usirdpsc78hpg.jpeg"><br>
<font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One Ocean One Breath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Bashurov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saitonakamura</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - Senior Frontend Engineer chez WiseBits, fan de TypeScript et apn√©iste amateur. </font><font style="vertical-align: inherit;">Les analogies de l'apprentissage de TypeScript et de la plong√©e en profondeur ne sont pas accidentelles. </font><font style="vertical-align: inherit;">Michael vous dira ce que sont les unions discrimin√©es, comment utiliser l'inf√©rence de type, pourquoi vous avez besoin d'une compatibilit√© nominale et d'une image de marque. </font><font style="vertical-align: inherit;">Retenez votre souffle et plongez.</font></font><a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/m0uRxCCno00" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©sentation et liens vers GitHub avec un exemple de code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type de travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les types de sommes semblent alg√©briques - essayons de comprendre de quoi il s'agit. </font><font style="vertical-align: inherit;">Ils sont appel√©s variante dans ReasonML, union √©tiquet√©e dans Haskell et union discrimin√©e dans F # et TypeScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wikipedia donne la d√©finition suivante: "Le type de montant est la somme des types d'≈ìuvres". </font></font><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Merci capitaine! </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La d√©finition est tout √† fait correcte, mais inutile, alors comprenons. </font><font style="vertical-align: inherit;">Allons du priv√© et commen√ßons par le type de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que nous ayons un type </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a deux champs: </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et qui l'a cr√©√©.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce type de travail est intersection ou </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intersection</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela signifie que nous pouvons √©crire le m√™me code que chaque champ individuellement.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number } &amp; { <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'alg√®bre des propositions, cela s'appelle la multiplication logique: c'est l'op√©ration ¬´ET¬ª ou ¬´ET¬ª. </font><font style="vertical-align: inherit;">Le type de produit est le produit logique de ces deux √©l√©ments.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un objet avec un ensemble de champs peut √™tre exprim√© via un produit logique.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le type de travail n'est pas limit√© aux champs. </font><font style="vertical-align: inherit;">Imaginez que nous aimons Prototype et avons d√©cid√© que nous manquions </font></font><code>leftPad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type RichString = string &amp; { <span class="hljs-attr">leftPad</span>: <span class="hljs-function">(<span class="hljs-params">toLength: number</span>) =&gt;</span> string }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez-le √† </font></font><code>String.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour exprimer en types, nous prenons une cha√Æne et une fonction qui prend les valeurs n√©cessaires. </font><font style="vertical-align: inherit;">La m√©thode et la cha√Æne sont l'intersection.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une association</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'union - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - est utile, par exemple, pour repr√©senter le type d'une variable qui d√©finit la largeur d'un √©l√©ment en CSS: une cha√Æne de 10 pixels ou une valeur absolue. </font><font style="vertical-align: inherit;">La sp√©cification CSS est en fait beaucoup plus compliqu√©e, mais pour simplifier, laissons cela de cette fa√ßon.</font></font><br>
<br>
<pre><code class="javascript hljs">type Width = string | number</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple est plus compliqu√©. </font><font style="vertical-align: inherit;">Supposons que nous ayons une t√¢che. </font><font style="vertical-align: inherit;">Il peut √™tre dans trois √©tats: juste cr√©√©, accept√© dans le travail et termin√©.</font></font><br>
<br>
<pre><code class="javascript hljs">type InitialTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type InWorkTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type FinishTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number, <span class="hljs-attr">finishDate</span>: <span class="hljs-built_in">Date</span> }<font></font>
<font></font>
type Task = InitialTask | InWorkTask | FinishedTask</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les premier et deuxi√®me √©tats, la t√¢che l'a </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et qui l'a cr√©√©e, et dans le troisi√®me, la date d'ach√®vement appara√Æt. </font><font style="vertical-align: inherit;">Ici, l'union appara√Æt - ceci ou cela. </font></font><br>
<br>
<strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></em></strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Au lieu de cela, </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez utiliser </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais il y a des nuances. </font><font style="vertical-align: inherit;">Le r√©sultat de l'union et de l'intersection est toujours un type. </font><font style="vertical-align: inherit;">Vous pouvez exprimer l'intersection √† travers </font></font></em><code>extends</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais l'union √† travers </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne le peut pas. </font><font style="vertical-align: inherit;">C'est </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste plus court. </font></font><br>
<br>
</em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aide uniquement √† fusionner les d√©clarations. </font><font style="vertical-align: inherit;">Les types de biblioth√®ques doivent toujours √™tre exprim√©s √† travers </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car cela permettra √† d'autres d√©veloppeurs de l'√©tendre avec leurs champs. </font><font style="vertical-align: inherit;">Donc, typiquement, par exemple, jQuery-plugins.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compatibilit√© des types</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a un probl√®me - dans TypeScript, la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilit√© des types structurels</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela signifie que si les premier et deuxi√®me types ont le m√™me ensemble de champs, ce sont deux du m√™me type. Par exemple, nous avons 10 types avec des noms diff√©rents, mais avec une structure identique (avec les m√™mes champs). Si nous fournissons l'un des 10 types √† une fonction qui accepte l'un d'entre eux, TypeScript ne s'en souciera pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Java ou C #, au contraire, un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®me de compatibilit√© nominale</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous allons √©crire les 10 m√™mes classes avec des champs identiques et une fonction qui en prend une. Une fonction n'acceptera pas d'autres classes si elles ne sont pas des descendants directs du type auquel la fonction est destin√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me de compatibilit√© structurelle est r√©solu en ajoutant un statut au champ: </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou</font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais les types de somme sont un moyen d'exprimer du code plus s√©mantiquement que la fa√ßon dont il est stock√© dans la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un exemple, nous nous adresserons √† ReasonML. Voici √† quoi ressemble ce type.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task =<font></font>
| Initial({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| InWork({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| Finished({<font></font>
        <span class="hljs-attr">id</span>: int,
        <span class="hljs-attr">whoCreated</span>: int,
        <span class="hljs-attr">finshDate</span>: <span class="hljs-built_in">Date</span>
    })</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les m√™mes champs, sauf qu'√† la </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si vous regardez attentivement, nous notons </font></font><code>Initial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>InWork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Finished</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ils ne sont pas situ√©s √† gauche, dans le nom du type, mais √† droite dans la d√©finition. Ce n'est pas seulement une ligne dans le titre, mais une partie d'un type distinct, nous pouvons donc distinguer le premier du second. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piratage de la vie</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour les types g√©n√©riques (comme vos entit√©s de domaine), cr√©ez un fichier </font></font><code>global.d.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ajoutez-y tous les types. Ils seront automatiquement visibles dans toute la base de code TypeScript sans avoir besoin d'une importation explicite. Cela est pratique pour la migration, car vous n'avez pas √† vous soucier de l'emplacement des types. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment proc√©der en utilisant l'exemple du code Redux primitif.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state, action) = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">erro</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R√©√©crivez le code en TypeScript. Commen√ßons par renommer le fichier - de </font></font><code>.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Activez toutes les options d'√©tat et l'option noImplicitAny. Cette option recherche les fonctions dans lesquelles le type de param√®tre n'est pas sp√©cifi√© et est utile au stade de la migration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typable </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ajouter un champ </font></font><code>isFetching</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(qui ne peut pas l'√™tre) et </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">title</span>: string }<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.jpg"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.png"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}</code></pre><br>
<em><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lifehack a jet√© un coup d'≈ìil √† la </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plong√©e profonde TypeScript</font></font></em></a><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;"> de Basarat Ali Syed </font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est un peu dat√©, mais toujours utile pour ceux qui veulent plonger dans TypeScript. D√©couvrez l'√©tat actuel de TypeScript sur le </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog de</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marius Schulz. Il √©crit sur de nouvelles fonctionnalit√©s et astuces. √âtudiez √©galement les </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journaux des modifications</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il n'y a pas seulement des informations sur les mises √† jour, mais aussi comment les utiliser.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Actions restantes. Nous taperons et d√©clarerons chacun d'eux.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
}<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span><font></font>
}<font></font>
<font></font>
type Actions = FetchAction | SuccessAction | FailAction</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le champ </font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour tous les types est diff√©rent, ce n'est pas seulement une cha√Æne, mais une cha√Æne sp√©cifique - un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">litt√©ral de cha√Æne</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discriminateur m√™me</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'√©tiquette par laquelle nous distinguons tous les cas. </font><font style="vertical-align: inherit;">Nous avons obtenu un syndicat discrimin√© et, par exemple, nous pouvons comprendre ce qui est dans la charge utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mettez √† jour le code Redux d'origine:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un danger ici si nous √©crivons </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... alors tout va se casser, car ce n'est plus un discriminateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette action, le type peut √™tre n'importe quelle cha√Æne et non un discriminateur sp√©cifique. </font><font style="vertical-align: inherit;">Apr√®s cela, TypeScript ne pourra pas distinguer une action d'une autre et trouver des erreurs. </font><font style="vertical-align: inherit;">Par cons√©quent, il doit y avoir exactement un litt√©ral de cha√Æne. </font><font style="vertical-align: inherit;">De plus, nous pouvons ajouter cette conception: </font></font><code>type ActionType = Actions["type"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois de nos options appara√Ætront dans les invites. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/gm/si/ufgmsit8lx5zzmmd9tvot5ibg5u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous √©crivez ...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... alors les invites seront simples </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car toutes les autres lignes ne sont plus importantes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z1/g1/qe/z1g1qecermtbhjq62vju5ujmwv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons tous tap√© et obtenu le type de montant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rification exhaustive</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez une situation hypoth√©tique o√π la gestion des erreurs n'est pas ajout√©e au code.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-comment">//case "TASK_FAIL":</span>
            <span class="hljs-comment">//return { isFetching: false, error: action.payload }</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une v√©rification exhaustive</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous aidera </font><font style="vertical-align: inherit;">- une autre propri√©t√© utile comme la somme </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l'occasion de v√©rifier que nous avons trait√© tous les cas possibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter une variable apr√®s l'instruction switch: </font></font><code>const exhaustiveCheck: never = action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
n'est jamais un type int√©ressant:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si elle est le r√©sultat d'un retour de fonction, alors la fonction ne se termine jamais correctement (par exemple, elle renvoie toujours une erreur ou est ex√©cut√©e sans fin);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'il s'agit d'un type, ce type ne peut pas √™tre cr√©√© sans effort suppl√©mentaire.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le compilateur indiquera l'erreur ¬´Le type¬´ FailAction ¬ªn'est pas attribuable au type¬´ jamais ¬ª¬ª. </font><font style="vertical-align: inherit;">Nous avons trois types d'actions possibles, dont nous n'avons pas trait√© </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est le cas </font></font><code>FailAction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais √† jamais, ce n'est pas ¬´assignable¬ª. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons le traitement </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et il n'y aura plus d'erreurs. </font><font style="vertical-align: inherit;">Trait√© </font></font><code>"TASK_FETCH"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- renvoy√©, trait√© </font></font><code>"TASK_SUCCESS"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- retourn√©, trait√© </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lorsque nous avons trait√© les trois fonctions, quelle pourrait √™tre l'action? </font><font style="vertical-align: inherit;">Rien - </font></font><code>never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ajoutez une autre action, le compilateur vous indiquera celles qui ne sont pas trait√©es. </font><font style="vertical-align: inherit;">Cela vous aidera si vous souhaitez r√©pondre √† toutes les actions, et si ce n'est qu'√† une s√©lection, alors non.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premier conseil</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire un effort.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au d√©but, il sera difficile de plonger: lisez le type de somme, puis les produits, les types de donn√©es alg√©briques, etc. dans la cha√Æne. </font><font style="vertical-align: inherit;">Faudra faire un effort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous plongeons plus profond√©ment, la pression de la colonne d'eau au-dessus de nous augmente. </font><font style="vertical-align: inherit;">√Ä une certaine profondeur, la force de flottabilit√© et la pression d'eau au-dessus de nous sont √©quilibr√©es. </font><font style="vertical-align: inherit;">Il s'agit d'une zone de "flottabilit√© neutre", dans laquelle nous sommes en apesanteur. </font><font style="vertical-align: inherit;">Dans cet √©tat, nous pouvons nous tourner vers d'autres types de syst√®mes ou langages.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syst√®me de type nominal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la Rome antique, les habitants avaient trois composantes du nom: nom, pr√©nom et "surnom". </font><font style="vertical-align: inherit;">Le nom lui-m√™me est ¬´nomen¬ª. </font><font style="vertical-align: inherit;">De l√† vient le syst√®me de type nominal - "nominal". </font><font style="vertical-align: inherit;">C'est parfois utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous avons un tel code de fonction.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> string
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> string<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchStarredRepos = (<font></font>
    nodeEnv: string,<font></font>
    <span class="hljs-attr">githubUrl</span>: string<font></font>
): <span class="hljs-built_in">Promise</span>&lt;GithubRepo[ ]&gt; =&gt; {
    <span class="hljs-keyword">if</span> (nodeEnv = <span class="hljs-string">"production"</span>) {
        <span class="hljs-comment">// log call</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'$githubUrl}/users/saitonakamura/starred'</span>)<font></font>
        .then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration est sur l'API: </font></font><code>GITHUB_URL=https://api.github.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La m√©thode </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API extrait les r√©f√©rentiels sur lesquels nous mettons un ast√©risque. </font><font style="vertical-align: inherit;">Et si </font></font><code>nodeEnv = "production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il enregistre cet appel, par exemple, pour les mesures. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la fonction que nous voulons d√©velopper (UI).</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> StarredRepos = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> [starredRepos, setStarredRepos] = useState&lt;GithubRepo[ ] | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (!starredRepos) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {starredRepos.map(repo =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.name}</span>&gt;</span>repo.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><font></font>
    )<font></font>
}<font></font>
<font></font>
type GithubRepo = {<font></font>
    <span class="hljs-attr">name</span>: string<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction sait d√©j√† comment afficher les donn√©es, et s'il n'y en a pas, alors un chargeur. </font><font style="vertical-align: inherit;">Il reste √† ajouter un appel API et √† remplir les donn√©es.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarredRepos(githubUrl, nodeEnv).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais si nous ex√©cutons ce code, tout tombera. </font><font style="vertical-align: inherit;">Dans le panneau du d√©veloppeur, nous constatons qu'il </font></font><code>fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acc√®de √† l'adresse </font></font><code>'/users/saitonakamura/starred'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- githubUrl a disparu quelque part. </font><font style="vertical-align: inherit;">Il s'av√®re que tout cela en raison de la conception √©trange - </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vient en premier. </font><font style="vertical-align: inherit;">Bien s√ªr, il peut √™tre tentant de tout changer, mais la fonction peut √™tre utilis√©e √† d'autres endroits de la base de code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si le compilateur le demande √† l'avance? </font><font style="vertical-align: inherit;">Ensuite, vous n'avez pas √† passer par tout le cycle de lancement, √† d√©tecter une erreur ou √† rechercher les raisons.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'image de marque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript a un hack pour cela - les types de marque. </font><font style="vertical-align: inherit;">Cr√©ez </font></font><code>Brand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(cha√Æne) </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et deux types. </font><font style="vertical-align: inherit;">Nous allons cr√©er le m√™me type pour </font></font><code>NodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Brand&lt;T, B extends string&gt; = T &amp; { readonly _brand: B }<font></font>
<font></font>
type GithubUrl = Brand&lt;string, <span class="hljs-string">"githubUrl"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> GithubUrl<font></font>
<font></font>
type NodeEnv = Brand&lt;string, <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous obtenons une erreur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/_e/j-/qi_ej-yne7xhcj4qmozvbw6r7qc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font><font style="vertical-align: inherit;">maintenant </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impossible de s‚Äôattribuer mutuellement, car ce sont des types nominaux. </font><font style="vertical-align: inherit;">Discret, mais nominal. </font><font style="vertical-align: inherit;">Maintenant, nous ne pouvons pas les √©changer ici - nous les changeons dans une autre partie du code.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarresRepos(nodeEnv, githubUrl).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, tout va bien - ils ont </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des primitives de marque</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le branding est utile lorsque plusieurs arguments (cha√Ænes, nombres) sont rencontr√©s. Ils ont une certaine s√©mantique (coordonn√©es x, y), et ils ne doivent pas √™tre confondus. C'est pratique lorsque le compilateur vous dit qu'ils sont confus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a deux probl√®mes. Tout d'abord, TypeScript n'a pas de types nominaux natifs. Mais il y a de l'espoir qu'il sera r√©solu, une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion de ce probl√®me est en</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cours dans le r√©f√©rentiel de langue </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me probl√®me est ¬´comme¬ª, il n'y a aucune garantie que le </font></font><code>GITHUB_URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien n'est pas rompu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi qu'avec </font></font><code>NODE_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Tr√®s probablement, nous voulons non seulement une cha√Æne, mais </font></font><code>"production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>"development"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type NodeEnv = Brand&lt;<span class="hljs-string">"production"</span> | <span class="hljs-string">"development"</span> | <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela doit √™tre v√©rifi√©. </font><font style="vertical-align: inherit;">Je vous r√©f√®re aux concepteurs intelligents et au rapport de Sergey Cherepanov, " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conception d'un domaine avec TypeScript dans un style fonctionnel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®me et troisi√®me conseils</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fais attention.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, arr√™tez-vous et regardez autour de vous: √† d'autres langages, frameworks, syst√®mes de types. </font><font style="vertical-align: inherit;">Apprenez de nouveaux principes et apprenez des le√ßons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous passons le point de "flottabilit√© neutre", l'eau presse plus fort et nous tire vers le bas.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se d√©tendre.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plongez plus profond√©ment et laissez TypeScript faire son travail.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce que TypeScript peut faire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript peut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imprimer des types</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
})<font></font>
<font></font>
type FetchAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>,<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a TypeScript pour cela </font></font><code>ReturnType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il obtient la valeur de retour de la fonction:</font></font><pre><code class="javascript hljs">type FetchAction = ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On y passe le type de fonction. </font><font style="vertical-align: inherit;">Nous ne pouvons tout simplement pas √©crire une fonction: pour prendre un type dans une fonction ou une variable, nous devons √©crire </font></font><code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On voit dans les astuces </font></font><code>type: string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6w/n0/tq/6wn0tq3zjhnnoqvjrk0saubafak.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est mauvais - le discriminateur se cassera parce qu'il y a un objet litt√©ral.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous cr√©ons un objet en JavaScript, il est modifiable par d√©faut. </font><font style="vertical-align: inherit;">Cela signifie que dans un objet avec un champ et une cha√Æne, nous pouvons plus tard changer la cha√Æne en une autre. </font><font style="vertical-align: inherit;">Par cons√©quent, TypeScript √©tend une cha√Æne sp√©cifique √† n'importe quelle cha√Æne pour les objets mutables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons en quelque sorte aider TypeScript. </font><font style="vertical-align: inherit;">Il y a autant de const pour cela.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter - la cha√Æne dispara√Ætra imm√©diatement dans les invites. </font><font style="vertical-align: inherit;">Nous pouvons √©crire ceci non seulement √† travers la ligne, mais en g√©n√©ral tout le litt√©ral.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le type (et tous les champs) deviendra alors en lecture seule.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {<font></font>
    readonly type: <span class="hljs-string">"TASK_FETCH"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci est utile car il est peu probable que vous changiez la mutabilit√© de votre action. </font><font style="vertical-align: inherit;">Par cons√©quent, nous ajoutons comme const partout.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
type Actions =<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createSuccess&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFail&gt;<font></font>
<font></font>
type State =<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; task: Task }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; error: <span class="hljs-built_in">Error</span> }<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
  <span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
  <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les actions de saisie de code ont √©t√© r√©duites et ajout√©es en tant que const. </font><font style="vertical-align: inherit;">TypeScript a tout compris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript peut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afficher l'√©tat</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est repr√©sent√© par l'union dans le code ci-dessus avec trois √©tats possibles de isFetching: true, false ou Task. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez type State = ReturnType. </font><font style="vertical-align: inherit;">Les invites TypeScript indiquent qu'il existe une d√©pendance circulaire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/jk/vu/vejkvuzbnzraxku1y7yfm5qefhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raccourcir.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br>
<code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cess√© de maudire, mais maintenant il l'est </font></font><code>any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car nous avons une d√©pendance cyclique. </font><font style="vertical-align: inherit;">Nous tapons l'argument.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state: { isFetching: <span class="hljs-literal">true</span> }, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conclusion est pr√™te. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i-/7f/mt/i-7fmtcvakp9l6ldfo98cqxfbwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conclusion est similaire √† ce que nous avions √† l' </font><font style="vertical-align: inherit;">origine: </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il y a des champs poubelles ici </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais avec le type </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le champ semble √™tre l√†, mais il ne semble pas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quatri√®me astuce</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne surchargez pas.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous vous d√©tendez et plongez trop profond√©ment, il se peut qu'il n'y ait pas assez d'oxyg√®ne pour revenir en arri√®re. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La formation aussi: si vous √™tes trop immerg√© dans la technologie et d√©cidez de l'appliquer partout, vous rencontrerez tr√®s probablement des erreurs dont vous ne connaissez pas les raisons. </font><font style="vertical-align: inherit;">Cela entra√Ænera un rejet et ne voudra plus utiliser de types statiques. </font><font style="vertical-align: inherit;">Essayez d'√©valuer votre force.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment TypeScript ralentit le d√©veloppement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge de la saisie prendra un certain temps. </font><font style="vertical-align: inherit;">Il n'a pas le meilleur UX - il donne parfois des erreurs compl√®tement incompr√©hensibles, comme tout autre type de syst√®me, comme dans Flow ou Haskell.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus le syst√®me est expressif, plus l'erreur est difficile.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La valeur du syst√®me de type est qu'il fournit une r√©troaction rapide lorsque des erreurs se produisent. Le syst√®me affichera les erreurs et prendra moins de temps pour les trouver et les corriger. Si vous passez moins de temps √† corriger les erreurs, plus de solutions architecturales recevront plus d'attention. Les types ne ralentissent pas le d√©veloppement si vous apprenez √† travailler avec eux.</font></font><br>
<br>
<blockquote>              <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">++</a>.  -  ,   ,        (25  26 )  -      (27  ‚Äî 10 ). <br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>   (5900  ),  ++            IT-,    . <br>
<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AvitoTech</a>  FrontendConf 2019    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">youtube-</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@FrontendConfChannel</a>,       . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499624/index.html">Pr√©sentation des outils Ansible</a></li>
<li><a href="../fr499626/index.html">SOA sur Laravel et JSON-RPC 2.0</a></li>
<li><a href="../fr499628/index.html">Entretiens de d√©veloppement: choisir des amis</a></li>
<li><a href="../fr499630/index.html">Battement. Spring Update 2020</a></li>
<li><a href="../fr499632/index.html">Am√©lioration de la qualit√© audio de Google Duo avec WaveNetEQ</a></li>
<li><a href="../fr499636/index.html">React Native pour les plus petits. Exp√©rience de d√©veloppement mobile</a></li>
<li><a href="../fr499642/index.html">Pixockets: comment nous avons √©crit notre propre biblioth√®que r√©seau pour le serveur de jeux</a></li>
<li><a href="../fr499644/index.html">Cr√©ation de robots (RPA) avec les outils AutoTest</a></li>
<li><a href="../fr499646/index.html">5 r√®gles pour int√©grer UX dans Agile et Scrum</a></li>
<li><a href="../fr499648/index.html">¬´Un game designer est toujours un joueur¬ª: que fait un sp√©cialiste, quelles comp√©tences sont importantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>