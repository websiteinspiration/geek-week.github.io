<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏩 🔭 👩🏻‍🚒 TypeScript avancé 🔎 🧝 👩🏻‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apnée - plongée sous-marine sans plongée sous-marine. Le plongeur ressent la loi d'Archimède: il déplace une certaine quantité d'eau, ce qui le repous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>TypeScript avancé</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/499634/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apnée - plongée sous-marine sans plongée sous-marine. </font><font style="vertical-align: inherit;">Le plongeur ressent la loi d'Archimède: il déplace une certaine quantité d'eau, ce qui le repousse. </font><font style="vertical-align: inherit;">Par conséquent, les premiers mètres sont les plus durs, mais la force de pression de la colonne d'eau au-dessus de vous commence à se déplacer plus profondément. </font><font style="vertical-align: inherit;">Ce processus rappelle l'apprentissage et la plongée dans les systèmes de type TypeScript - il devient un peu plus facile lorsque vous plongez. </font><font style="vertical-align: inherit;">Mais nous ne devons pas oublier d'émerger dans le temps. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/eb/y9/sheby96u0qt6o3usirdpsc78hpg.jpeg"><br>
<font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One Ocean One Breath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Bashurov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saitonakamura</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - Senior Frontend Engineer chez WiseBits, fan de TypeScript et apnéiste amateur. </font><font style="vertical-align: inherit;">Les analogies de l'apprentissage de TypeScript et de la plongée en profondeur ne sont pas accidentelles. </font><font style="vertical-align: inherit;">Michael vous dira ce que sont les unions discriminées, comment utiliser l'inférence de type, pourquoi vous avez besoin d'une compatibilité nominale et d'une image de marque. </font><font style="vertical-align: inherit;">Retenez votre souffle et plongez.</font></font><a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/m0uRxCCno00" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Présentation et liens vers GitHub avec un exemple de code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type de travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les types de sommes semblent algébriques - essayons de comprendre de quoi il s'agit. </font><font style="vertical-align: inherit;">Ils sont appelés variante dans ReasonML, union étiquetée dans Haskell et union discriminée dans F # et TypeScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wikipedia donne la définition suivante: "Le type de montant est la somme des types d'œuvres". </font></font><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Merci capitaine! </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La définition est tout à fait correcte, mais inutile, alors comprenons. </font><font style="vertical-align: inherit;">Allons du privé et commençons par le type de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que nous ayons un type </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a deux champs: </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et qui l'a créé.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce type de travail est intersection ou </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intersection</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela signifie que nous pouvons écrire le même code que chaque champ individuellement.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number } &amp; { <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'algèbre des propositions, cela s'appelle la multiplication logique: c'est l'opération «ET» ou «ET». </font><font style="vertical-align: inherit;">Le type de produit est le produit logique de ces deux éléments.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un objet avec un ensemble de champs peut être exprimé via un produit logique.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le type de travail n'est pas limité aux champs. </font><font style="vertical-align: inherit;">Imaginez que nous aimons Prototype et avons décidé que nous manquions </font></font><code>leftPad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type RichString = string &amp; { <span class="hljs-attr">leftPad</span>: <span class="hljs-function">(<span class="hljs-params">toLength: number</span>) =&gt;</span> string }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez-le à </font></font><code>String.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pour exprimer en types, nous prenons une chaîne et une fonction qui prend les valeurs nécessaires. </font><font style="vertical-align: inherit;">La méthode et la chaîne sont l'intersection.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une association</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'union - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - est utile, par exemple, pour représenter le type d'une variable qui définit la largeur d'un élément en CSS: une chaîne de 10 pixels ou une valeur absolue. </font><font style="vertical-align: inherit;">La spécification CSS est en fait beaucoup plus compliquée, mais pour simplifier, laissons cela de cette façon.</font></font><br>
<br>
<pre><code class="javascript hljs">type Width = string | number</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un exemple est plus compliqué. </font><font style="vertical-align: inherit;">Supposons que nous ayons une tâche. </font><font style="vertical-align: inherit;">Il peut être dans trois états: juste créé, accepté dans le travail et terminé.</font></font><br>
<br>
<pre><code class="javascript hljs">type InitialTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type InWorkTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type FinishTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number, <span class="hljs-attr">finishDate</span>: <span class="hljs-built_in">Date</span> }<font></font>
<font></font>
type Task = InitialTask | InWorkTask | FinishedTask</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les premier et deuxième états, la tâche l'a </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et qui l'a créée, et dans le troisième, la date d'achèvement apparaît. </font><font style="vertical-align: inherit;">Ici, l'union apparaît - ceci ou cela. </font></font><br>
<br>
<strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></em></strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Au lieu de cela, </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous pouvez utiliser </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais il y a des nuances. </font><font style="vertical-align: inherit;">Le résultat de l'union et de l'intersection est toujours un type. </font><font style="vertical-align: inherit;">Vous pouvez exprimer l'intersection à travers </font></font></em><code>extends</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais l'union à travers </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne le peut pas. </font><font style="vertical-align: inherit;">C'est </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste plus court. </font></font><br>
<br>
</em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aide uniquement à fusionner les déclarations. </font><font style="vertical-align: inherit;">Les types de bibliothèques doivent toujours être exprimés à travers </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car cela permettra à d'autres développeurs de l'étendre avec leurs champs. </font><font style="vertical-align: inherit;">Donc, typiquement, par exemple, jQuery-plugins.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compatibilité des types</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a un problème - dans TypeScript, la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilité des types structurels</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela signifie que si les premier et deuxième types ont le même ensemble de champs, ce sont deux du même type. Par exemple, nous avons 10 types avec des noms différents, mais avec une structure identique (avec les mêmes champs). Si nous fournissons l'un des 10 types à une fonction qui accepte l'un d'entre eux, TypeScript ne s'en souciera pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En Java ou C #, au contraire, un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système de compatibilité nominale</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous allons écrire les 10 mêmes classes avec des champs identiques et une fonction qui en prend une. Une fonction n'acceptera pas d'autres classes si elles ne sont pas des descendants directs du type auquel la fonction est destinée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problème de compatibilité structurelle est résolu en ajoutant un statut au champ: </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou</font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais les types de somme sont un moyen d'exprimer du code plus sémantiquement que la façon dont il est stocké dans la base de données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour un exemple, nous nous adresserons à ReasonML. Voici à quoi ressemble ce type.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task =<font></font>
| Initial({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| InWork({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| Finished({<font></font>
        <span class="hljs-attr">id</span>: int,
        <span class="hljs-attr">whoCreated</span>: int,
        <span class="hljs-attr">finshDate</span>: <span class="hljs-built_in">Date</span>
    })</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les mêmes champs, sauf qu'à la </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si vous regardez attentivement, nous notons </font></font><code>Initial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>InWork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Finished</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ils ne sont pas situés à gauche, dans le nom du type, mais à droite dans la définition. Ce n'est pas seulement une ligne dans le titre, mais une partie d'un type distinct, nous pouvons donc distinguer le premier du second. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Piratage de la vie</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour les types génériques (comme vos entités de domaine), créez un fichier </font></font><code>global.d.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ajoutez-y tous les types. Ils seront automatiquement visibles dans toute la base de code TypeScript sans avoir besoin d'une importation explicite. Cela est pratique pour la migration, car vous n'avez pas à vous soucier de l'emplacement des types. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment procéder en utilisant l'exemple du code Redux primitif.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state, action) = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">erro</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Réécrivez le code en TypeScript. Commençons par renommer le fichier - de </font></font><code>.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">à </font></font><code>.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Activez toutes les options d'état et l'option noImplicitAny. Cette option recherche les fonctions dans lesquelles le type de paramètre n'est pas spécifié et est utile au stade de la migration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typable </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ajouter un champ </font></font><code>isFetching</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(qui ne peut pas l'être) et </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">title</span>: string }<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.jpg"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.png"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}</code></pre><br>
<em><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lifehack a jeté un coup d'œil à la </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plongée profonde TypeScript</font></font></em></a><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;"> de Basarat Ali Syed </font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. C'est un peu daté, mais toujours utile pour ceux qui veulent plonger dans TypeScript. Découvrez l'état actuel de TypeScript sur le </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog de</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marius Schulz. Il écrit sur de nouvelles fonctionnalités et astuces. Étudiez également les </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journaux des modifications</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , il n'y a pas seulement des informations sur les mises à jour, mais aussi comment les utiliser.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Actions restantes. Nous taperons et déclarerons chacun d'eux.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
}<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span><font></font>
}<font></font>
<font></font>
type Actions = FetchAction | SuccessAction | FailAction</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le champ </font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour tous les types est différent, ce n'est pas seulement une chaîne, mais une chaîne spécifique - un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">littéral de chaîne</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C'est le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discriminateur même</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - l'étiquette par laquelle nous distinguons tous les cas. </font><font style="vertical-align: inherit;">Nous avons obtenu un syndicat discriminé et, par exemple, nous pouvons comprendre ce qui est dans la charge utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mettez à jour le code Redux d'origine:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un danger ici si nous écrivons </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... alors tout va se casser, car ce n'est plus un discriminateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette action, le type peut être n'importe quelle chaîne et non un discriminateur spécifique. </font><font style="vertical-align: inherit;">Après cela, TypeScript ne pourra pas distinguer une action d'une autre et trouver des erreurs. </font><font style="vertical-align: inherit;">Par conséquent, il doit y avoir exactement un littéral de chaîne. </font><font style="vertical-align: inherit;">De plus, nous pouvons ajouter cette conception: </font></font><code>type ActionType = Actions["type"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trois de nos options apparaîtront dans les invites. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/gm/si/ufgmsit8lx5zzmmd9tvot5ibg5u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous écrivez ...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... alors les invites seront simples </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car toutes les autres lignes ne sont plus importantes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z1/g1/qe/z1g1qecermtbhjq62vju5ujmwv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons tous tapé et obtenu le type de montant.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vérification exhaustive</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imaginez une situation hypothétique où la gestion des erreurs n'est pas ajoutée au code.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-comment">//case "TASK_FAIL":</span>
            <span class="hljs-comment">//return { isFetching: false, error: action.payload }</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une vérification exhaustive</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous aidera </font><font style="vertical-align: inherit;">- une autre propriété utile comme la somme </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l'occasion de vérifier que nous avons traité tous les cas possibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter une variable après l'instruction switch: </font></font><code>const exhaustiveCheck: never = action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
n'est jamais un type intéressant:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si elle est le résultat d'un retour de fonction, alors la fonction ne se termine jamais correctement (par exemple, elle renvoie toujours une erreur ou est exécutée sans fin);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'il s'agit d'un type, ce type ne peut pas être créé sans effort supplémentaire.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, le compilateur indiquera l'erreur «Le type« FailAction »n'est pas attribuable au type« jamais »». </font><font style="vertical-align: inherit;">Nous avons trois types d'actions possibles, dont nous n'avons pas traité </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est le cas </font></font><code>FailAction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais à jamais, ce n'est pas «assignable». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutons le traitement </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et il n'y aura plus d'erreurs. </font><font style="vertical-align: inherit;">Traité </font></font><code>"TASK_FETCH"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- renvoyé, traité </font></font><code>"TASK_SUCCESS"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- retourné, traité </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lorsque nous avons traité les trois fonctions, quelle pourrait être l'action? </font><font style="vertical-align: inherit;">Rien - </font></font><code>never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ajoutez une autre action, le compilateur vous indiquera celles qui ne sont pas traitées. </font><font style="vertical-align: inherit;">Cela vous aidera si vous souhaitez répondre à toutes les actions, et si ce n'est qu'à une sélection, alors non.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premier conseil</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire un effort.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au début, il sera difficile de plonger: lisez le type de somme, puis les produits, les types de données algébriques, etc. dans la chaîne. </font><font style="vertical-align: inherit;">Faudra faire un effort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous plongeons plus profondément, la pression de la colonne d'eau au-dessus de nous augmente. </font><font style="vertical-align: inherit;">À une certaine profondeur, la force de flottabilité et la pression d'eau au-dessus de nous sont équilibrées. </font><font style="vertical-align: inherit;">Il s'agit d'une zone de "flottabilité neutre", dans laquelle nous sommes en apesanteur. </font><font style="vertical-align: inherit;">Dans cet état, nous pouvons nous tourner vers d'autres types de systèmes ou langages.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Système de type nominal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la Rome antique, les habitants avaient trois composantes du nom: nom, prénom et "surnom". </font><font style="vertical-align: inherit;">Le nom lui-même est «nomen». </font><font style="vertical-align: inherit;">De là vient le système de type nominal - "nominal". </font><font style="vertical-align: inherit;">C'est parfois utile. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous avons un tel code de fonction.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> string
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> string<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchStarredRepos = (<font></font>
    nodeEnv: string,<font></font>
    <span class="hljs-attr">githubUrl</span>: string<font></font>
): <span class="hljs-built_in">Promise</span>&lt;GithubRepo[ ]&gt; =&gt; {
    <span class="hljs-keyword">if</span> (nodeEnv = <span class="hljs-string">"production"</span>) {
        <span class="hljs-comment">// log call</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'$githubUrl}/users/saitonakamura/starred'</span>)<font></font>
        .then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuration est sur l'API: </font></font><code>GITHUB_URL=https://api.github.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La méthode </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API extrait les référentiels sur lesquels nous mettons un astérisque. </font><font style="vertical-align: inherit;">Et si </font></font><code>nodeEnv = "production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il enregistre cet appel, par exemple, pour les mesures. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la fonction que nous voulons développer (UI).</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> StarredRepos = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> [starredRepos, setStarredRepos] = useState&lt;GithubRepo[ ] | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (!starredRepos) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading…<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {starredRepos.map(repo =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.name}</span>&gt;</span>repo.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><font></font>
    )<font></font>
}<font></font>
<font></font>
type GithubRepo = {<font></font>
    <span class="hljs-attr">name</span>: string<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction sait déjà comment afficher les données, et s'il n'y en a pas, alors un chargeur. </font><font style="vertical-align: inherit;">Il reste à ajouter un appel API et à remplir les données.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarredRepos(githubUrl, nodeEnv).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais si nous exécutons ce code, tout tombera. </font><font style="vertical-align: inherit;">Dans le panneau du développeur, nous constatons qu'il </font></font><code>fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accède à l'adresse </font></font><code>'/users/saitonakamura/starred'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- githubUrl a disparu quelque part. </font><font style="vertical-align: inherit;">Il s'avère que tout cela en raison de la conception étrange - </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vient en premier. </font><font style="vertical-align: inherit;">Bien sûr, il peut être tentant de tout changer, mais la fonction peut être utilisée à d'autres endroits de la base de code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais que se passe-t-il si le compilateur le demande à l'avance? </font><font style="vertical-align: inherit;">Ensuite, vous n'avez pas à passer par tout le cycle de lancement, à détecter une erreur ou à rechercher les raisons.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'image de marque</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript a un hack pour cela - les types de marque. </font><font style="vertical-align: inherit;">Créez </font></font><code>Brand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(chaîne) </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et deux types. </font><font style="vertical-align: inherit;">Nous allons créer le même type pour </font></font><code>NodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Brand&lt;T, B extends string&gt; = T &amp; { readonly _brand: B }<font></font>
<font></font>
type GithubUrl = Brand&lt;string, <span class="hljs-string">"githubUrl"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> GithubUrl<font></font>
<font></font>
type NodeEnv = Brand&lt;string, <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous obtenons une erreur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/_e/j-/qi_ej-yne7xhcj4qmozvbw6r7qc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est </font><font style="vertical-align: inherit;">maintenant </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impossible de s’attribuer mutuellement, car ce sont des types nominaux. </font><font style="vertical-align: inherit;">Discret, mais nominal. </font><font style="vertical-align: inherit;">Maintenant, nous ne pouvons pas les échanger ici - nous les changeons dans une autre partie du code.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarresRepos(nodeEnv, githubUrl).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, tout va bien - ils ont </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des primitives de marque</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le branding est utile lorsque plusieurs arguments (chaînes, nombres) sont rencontrés. Ils ont une certaine sémantique (coordonnées x, y), et ils ne doivent pas être confondus. C'est pratique lorsque le compilateur vous dit qu'ils sont confus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a deux problèmes. Tout d'abord, TypeScript n'a pas de types nominaux natifs. Mais il y a de l'espoir qu'il sera résolu, une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion de ce problème est en</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cours dans le référentiel de langue </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième problème est «comme», il n'y a aucune garantie que le </font></font><code>GITHUB_URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien n'est pas rompu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi qu'avec </font></font><code>NODE_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Très probablement, nous voulons non seulement une chaîne, mais </font></font><code>"production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>"development"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type NodeEnv = Brand&lt;<span class="hljs-string">"production"</span> | <span class="hljs-string">"development"</span> | <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela doit être vérifié. </font><font style="vertical-align: inherit;">Je vous réfère aux concepteurs intelligents et au rapport de Sergey Cherepanov, " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conception d'un domaine avec TypeScript dans un style fonctionnel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxième et troisième conseils</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fais attention.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, arrêtez-vous et regardez autour de vous: à d'autres langages, frameworks, systèmes de types. </font><font style="vertical-align: inherit;">Apprenez de nouveaux principes et apprenez des leçons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous passons le point de "flottabilité neutre", l'eau presse plus fort et nous tire vers le bas.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se détendre.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plongez plus profondément et laissez TypeScript faire son travail.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce que TypeScript peut faire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript peut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imprimer des types</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
})<font></font>
<font></font>
type FetchAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>,<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a TypeScript pour cela </font></font><code>ReturnType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il obtient la valeur de retour de la fonction:</font></font><pre><code class="javascript hljs">type FetchAction = ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On y passe le type de fonction. </font><font style="vertical-align: inherit;">Nous ne pouvons tout simplement pas écrire une fonction: pour prendre un type dans une fonction ou une variable, nous devons écrire </font></font><code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On voit dans les astuces </font></font><code>type: string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6w/n0/tq/6wn0tq3zjhnnoqvjrk0saubafak.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est mauvais - le discriminateur se cassera parce qu'il y a un objet littéral.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous créons un objet en JavaScript, il est modifiable par défaut. </font><font style="vertical-align: inherit;">Cela signifie que dans un objet avec un champ et une chaîne, nous pouvons plus tard changer la chaîne en une autre. </font><font style="vertical-align: inherit;">Par conséquent, TypeScript étend une chaîne spécifique à n'importe quelle chaîne pour les objets mutables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons en quelque sorte aider TypeScript. </font><font style="vertical-align: inherit;">Il y a autant de const pour cela.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajouter - la chaîne disparaîtra immédiatement dans les invites. </font><font style="vertical-align: inherit;">Nous pouvons écrire ceci non seulement à travers la ligne, mais en général tout le littéral.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le type (et tous les champs) deviendra alors en lecture seule.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {<font></font>
    readonly type: <span class="hljs-string">"TASK_FETCH"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci est utile car il est peu probable que vous changiez la mutabilité de votre action. </font><font style="vertical-align: inherit;">Par conséquent, nous ajoutons comme const partout.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
type Actions =<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createSuccess&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFail&gt;<font></font>
<font></font>
type State =<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; task: Task }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; error: <span class="hljs-built_in">Error</span> }<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
  <span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
  <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les actions de saisie de code ont été réduites et ajoutées en tant que const. </font><font style="vertical-align: inherit;">TypeScript a tout compris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript peut </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">afficher l'état</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est représenté par l'union dans le code ci-dessus avec trois états possibles de isFetching: true, false ou Task. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilisez type State = ReturnType. </font><font style="vertical-align: inherit;">Les invites TypeScript indiquent qu'il existe une dépendance circulaire. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/jk/vu/vejkvuzbnzraxku1y7yfm5qefhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Raccourcir.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br>
<code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cessé de maudire, mais maintenant il l'est </font></font><code>any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car nous avons une dépendance cyclique. </font><font style="vertical-align: inherit;">Nous tapons l'argument.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state: { isFetching: <span class="hljs-literal">true</span> }, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conclusion est prête. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i-/7f/mt/i-7fmtcvakp9l6ldfo98cqxfbwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conclusion est similaire à ce que nous avions à l' </font><font style="vertical-align: inherit;">origine: </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il y a des champs poubelles ici </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais avec le type </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le champ semble être là, mais il ne semble pas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quatrième astuce</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne surchargez pas.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous vous détendez et plongez trop profondément, il se peut qu'il n'y ait pas assez d'oxygène pour revenir en arrière. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La formation aussi: si vous êtes trop immergé dans la technologie et décidez de l'appliquer partout, vous rencontrerez très probablement des erreurs dont vous ne connaissez pas les raisons. </font><font style="vertical-align: inherit;">Cela entraînera un rejet et ne voudra plus utiliser de types statiques. </font><font style="vertical-align: inherit;">Essayez d'évaluer votre force.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment TypeScript ralentit le développement</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La prise en charge de la saisie prendra un certain temps. </font><font style="vertical-align: inherit;">Il n'a pas le meilleur UX - il donne parfois des erreurs complètement incompréhensibles, comme tout autre type de système, comme dans Flow ou Haskell.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus le système est expressif, plus l'erreur est difficile.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La valeur du système de type est qu'il fournit une rétroaction rapide lorsque des erreurs se produisent. Le système affichera les erreurs et prendra moins de temps pour les trouver et les corriger. Si vous passez moins de temps à corriger les erreurs, plus de solutions architecturales recevront plus d'attention. Les types ne ralentissent pas le développement si vous apprenez à travailler avec eux.</font></font><br>
<br>
<blockquote>              <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">++</a>.  -  ,   ,        (25  26 )  -      (27  — 10 ). <br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>   (5900  ),  ++            IT-,    . <br>
<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AvitoTech</a>  FrontendConf 2019    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">youtube-</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@FrontendConfChannel</a>,       . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499624/index.html">Présentation des outils Ansible</a></li>
<li><a href="../fr499626/index.html">SOA sur Laravel et JSON-RPC 2.0</a></li>
<li><a href="../fr499628/index.html">Entretiens de développement: choisir des amis</a></li>
<li><a href="../fr499630/index.html">Battement. Spring Update 2020</a></li>
<li><a href="../fr499632/index.html">Amélioration de la qualité audio de Google Duo avec WaveNetEQ</a></li>
<li><a href="../fr499636/index.html">React Native pour les plus petits. Expérience de développement mobile</a></li>
<li><a href="../fr499642/index.html">Pixockets: comment nous avons écrit notre propre bibliothèque réseau pour le serveur de jeux</a></li>
<li><a href="../fr499644/index.html">Création de robots (RPA) avec les outils AutoTest</a></li>
<li><a href="../fr499646/index.html">5 règles pour intégrer UX dans Agile et Scrum</a></li>
<li><a href="../fr499648/index.html">«Un game designer est toujours un joueur»: que fait un spécialiste, quelles compétences sont importantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>