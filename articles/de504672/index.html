<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìì üë©üèø‚Äçüî¨ üê¥ DEVOXX UK. Kubernetes in der Produktion: Blau / Gr√ºn-Bereitstellung, automatische Skalierung und Bereitstellungsautomatisierung. Teil 2 ‚ùÑÔ∏è üé® ü§ë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes ist ein gro√üartiges Tool zum Ausf√ºhren von Docker-Containern in einer Cluster-Produktionsumgebung. Es gibt jedoch Aufgaben, die Kubernetes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DEVOXX UK. Kubernetes in der Produktion: Blau / Gr√ºn-Bereitstellung, automatische Skalierung und Bereitstellungsautomatisierung. Teil 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/504672/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes ist ein gro√üartiges Tool zum Ausf√ºhren von Docker-Containern in einer Cluster-Produktionsumgebung. Es gibt jedoch Aufgaben, die Kubernetes nicht l√∂sen kann. Bei h√§ufigen Bereitstellungen in einer Produktionsumgebung ben√∂tigen wir eine vollautomatische Blue / Green-Bereitstellung, um Ausfallzeiten in diesem Prozess zu vermeiden, f√ºr die auch externe HTTP-Anforderungen und SSL-Uploads erforderlich sind. Dies erfordert die Integration mit einem Load Balancer wie ha-proxy. Eine weitere Aufgabe ist die halbautomatische Skalierung des Kubernetes-Clusters selbst bei der Arbeit in der Cloud, beispielsweise die teilweise Reduzierung der Cluster-Skalierung bei Nacht.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl Kubernetes diese Funktionen nicht standardm√§√üig bietet, bietet es eine API, mit der solche Probleme gel√∂st werden k√∂nnen. Kubernetes Cluster-Tools f√ºr die automatisierte Bereitstellung und Skalierung von Blau / Gr√ºn wurden im Rahmen des Open-Source-Projekts Cloud RTI entwickelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Video-Transkript wird beschrieben, wie Sie Kubernetes zusammen mit anderen Open Source-Komponenten konfigurieren, um eine produktionsbereite Umgebung zu erhalten, die Code aus dem Commit f√ºr die Festschreibung von Git Commits ohne Ausfallzeiten in der Produktion akzeptiert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cy/4y/jm/cy4yjm9zwmpfpvtfwhwfigavpkw.jpeg"><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEVOXX UK. Kubernetes in der Produktion: Blau / Gr√ºn-Bereitstellung, automatische Skalierung und Bereitstellungsautomatisierung. Teil 1</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem Sie von au√üen auf Ihre Anwendungen zugegriffen haben, k√∂nnen Sie mit der vollst√§ndigen Konfiguration der Automatisierung beginnen, dh sie auf die Stufe bringen, auf der Sie das Git-Commit ausf√ºhren und sicherstellen k√∂nnen, dass dieses Git-Commit in der Produktion endet. Nat√ºrlich m√∂chten wir bei der Implementierung dieser Schritte und bei der Implementierung der Bereitstellung keine Ausfallzeiten haben. Jede Automatisierung in Kubernetes beginnt also mit einer API.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5q/w4/ng/5qw4ngl2hrnecjzk4sfvhhepx_k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes ist kein Tool, das produktiv ‚Äûout of the box‚Äú eingesetzt werden kann. Nat√ºrlich k√∂nnen Sie dies tun, Kubectl verwenden und so weiter, aber dennoch ist die API das Interessanteste und N√ºtzlichste an dieser Plattform. Mit der API als Funktionsumfang k√∂nnen Sie auf fast alles zugreifen, was Sie in Kubernetes tun m√∂chten. Kubectl selbst verwendet auch die REST-API.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist REST, sodass Sie alle Sprachen und Tools verwenden k√∂nnen, um mit dieser API zu arbeiten. Benutzerbibliotheken erleichtern Ihnen jedoch das Leben erheblich. Mein Team hat zwei solcher Bibliotheken geschrieben: eine f√ºr Java / OSGi und eine f√ºr Go. Die zweite wird nicht oft verwendet, aber auf jeden Fall stehen Ihnen diese n√ºtzlichen Dinge zur Verf√ºgung. Sie sind ein teilweise lizenziertes Open-Source-Projekt. Es gibt viele solcher Bibliotheken f√ºr verschiedene Sprachen, sodass Sie die am besten geeignete ausw√§hlen k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ej/bj/ey/ejbjeyepppr2tet3aupem789num.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie mit der Automatisierung der Bereitstellung beginnen, m√ºssen Sie sicherstellen, dass f√ºr diesen Prozess keine Ausfallzeiten auftreten. Zum Beispiel f√ºhrt unser Team die Produktionsbereitstellung mitten am Tag durch, wenn die Mitarbeiter ihre Anwendungen optimal nutzen. Daher ist es sehr wichtig, Verz√∂gerungen in diesem Prozess zu vermeiden. Um Ausfallzeiten zu vermeiden, werden zwei Methoden verwendet: Blau / Gr√ºn-Bereitstellung oder fortlaufendes Update. Im letzteren Fall werden 5 Replikate der Anwendung nacheinander aktualisiert. Diese Methode funktioniert hervorragend, funktioniert jedoch nicht, wenn Sie w√§hrend des Bereitstellungsprozesses verschiedene Versionen der Anwendung gleichzeitig ausf√ºhren. In diesem Fall k√∂nnen Sie die Benutzeroberfl√§che aktualisieren, w√§hrend das Backend mit der alten Version funktioniert und die Anwendung nicht mehr funktioniert.Unter dem Gesichtspunkt der Programmierung ist es daher ziemlich schwierig, unter solchen Bedingungen zu arbeiten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist einer der Gr√ºnde, warum wir die blau / gr√ºne Bereitstellung bevorzugen, um die Bereitstellung unserer Anwendungen zu automatisieren. Bei dieser Methode m√ºssen Sie sicherstellen, dass zu einem bestimmten Zeitpunkt nur eine Version der Anwendung aktiv ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der blau / gr√ºne Bereitstellungsmechanismus ist wie folgt. Wir erhalten Datenverkehr f√ºr unsere Anwendungen √ºber ha-proxy, wodurch die Ausf√ºhrung von Anwendungsreplikaten derselben Version geleitet wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine neue Bereitstellung ausgef√ºhrt wird, verwenden wir Deployer, der mit neuen Komponenten bereitgestellt wird, und stellen die neue Version bereit. Das Bereitstellen einer neuen Version einer Anwendung bedeutet, dass ein neuer Satz von Replikaten "aufsteigt". Danach werden diese Replikate der neuen Version in einem separaten, neuen Pod gestartet. Ha-proxy wei√ü jedoch nichts √ºber sie und hat ihnen bisher keine Arbeitslast gesendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher ist es zun√§chst erforderlich, den Zustand neuer Versionen von Health Cheeking zu √ºberpr√ºfen, um sicherzustellen, dass die Replikate bereit sind, die Last zu bedienen.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/dx/qk/vd/dxqkvdwkbon86_g0l0plg-dqezu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Bereitstellungskomponenten m√ºssen irgendeine Form von Health Cheek unterst√ºtzen. Dies kann eine sehr einfache HTTP-Pr√ºfung mit einem Anruf sein, wenn Sie einen Code mit dem Status 200 erhalten, oder eine eingehendere Pr√ºfung, bei der Sie die Verbindung von Replikaten mit der Datenbank und anderen Diensten, die Stabilit√§t der Verbindungen der dynamischen Umgebung, ob alles startet und ordnungsgem√§√ü funktioniert, √ºberpr√ºfen. Dieser Vorgang kann sehr kompliziert sein. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lr/9t/o4/lr9to4uiafxnxpjfbuyzd3ubtgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem das System √ºberpr√ºft hat, ob alle aktualisierten Replikate betriebsbereit sind, aktualisiert Deployer die Konfiguration und √ºbergibt die korrekte Konfiguration, wodurch ha-proxy neu konfiguriert wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kw/q1/s7/kwq1s7fkzffaby-ajt6jyrg2vra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erst danach wird der Datenverkehr mit Repliken der neuen Version nach unten geleitet, und die alte Version verschwindet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/q5/c6/waq5c6mmixf0j3twtrhetjjdvx0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Mechanismus ist kein Merkmal von Kubernetes. Das blau / gr√ºne Bereitstellungskonzept gibt es schon seit geraumer Zeit und es wurde immer ein Load Balancer verwendet. Zun√§chst leiten Sie den gesamten Datenverkehr auf die alte Version der Anwendung und √ºbertragen ihn nach dem Upgrade vollst√§ndig auf die neue Version. Dieses Prinzip wird nicht nur in Kubernetes angewendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werde ich Ihnen eine neue Bereitstellungskomponente vorstellen - Deployer, die eine Integrit√§tspr√ºfung durchf√ºhrt, Proxys neu konfiguriert usw. Dies ist ein Konzept, das nicht f√ºr die Au√üenwelt gilt und innerhalb von Kubernetes existiert. Ich werde zeigen, wie Sie mit Open-Source-Tools Ihr eigenes Deployer-Konzept erstellen k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als erstes erstellt Deployer einen RC-Replikationscontroller mithilfe der Kubernetes-API. Diese API erstellt Pods und Services f√ºr die weitere Bereitstellung, dh sie erstellt einen v√∂llig neuen Cluster f√ºr unsere Anwendungen. Sobald der RC √ºberpr√ºft, ob die Replikate gestartet wurden, √ºberpr√ºft er ihre Integrit√§tspr√ºfung. Zu diesem Zweck verwendet Deployer den Befehl GET / health. Es startet die entsprechenden √úberpr√ºfungskomponenten und √ºberpr√ºft alle Elemente, die den Betrieb des Clusters sicherstellen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/lr/8u/kmlr8uloqusoeejhd-7dquyzu7q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem alle Pods ihren "Zustand" gemeldet haben, erstellt Deployer ein neues Konfigurationselement - den verteilten Speicher usw., der in Kubernetes verwendet wird, einschlie√ülich zum Speichern der Load Balancer-Konfiguration. Wir schreiben Daten in etcd und ein kleines Tool, confd, √ºberwacht etcd auf neue Daten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn er √Ñnderungen an der Erstkonfiguration feststellt, generiert er eine neue Einstellungsdatei und √ºbergibt sie an ha-proxy. In diesem Fall wird ha-proxy neu gestartet, ohne dass Verbindungen verloren gehen, und die Last wird mit neuen Diensten behoben, die die neue Version unserer Anwendungen bereitstellen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h2/1k/os/h21kosweevmblkultqa8kspeuri.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen, gibt es trotz der F√ºlle an Komponenten nichts Kompliziertes. </font><font style="vertical-align: inherit;">Sie m√ºssen nur mehr auf die API und etcd achten. </font><font style="vertical-align: inherit;">Ich m√∂chte Ihnen etwas √ºber den Open-Source-Deployer erz√§hlen, den wir selbst verwenden - dies ist Amdatu Kubernetes Deployer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/oj/vt/irojvt6tjy6vgckfsizgnycysdm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein Kubernetes Deployment Orchestration-Tool mit den folgenden Funktionen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blau / Gr√ºn-Bereitstellung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einrichten eines externen Load Balancers;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deployment Descriptor Management</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chliches Bereitstellungsmanagement</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integrit√§tspr√ºfungen w√§hrend der Bereitstellung</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierung von Umgebungsvariablen in Pods.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Deployer wurde √ºber der Kubernetes-API erstellt und bietet eine REST-API zum Verwalten von Deskriptoren und Bereitstellungen sowie eine Websocket-API f√ºr Stream-Protokolle w√§hrend der Bereitstellung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Load Balancer-Konfigurationsdaten werden in etcd abgelegt, sodass Sie ha-proxy nicht mit "out of the box" -Unterst√ºtzung verwenden k√∂nnen. Es ist jedoch einfach, Ihre eigene Balancer-Konfigurationsdatei zu verwenden. Amdatu Deployer ist wie Kubernetes selbst in Go geschrieben und von Apache lizenziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich diese Version des Deployers verwendet habe, habe ich den folgenden Deployment-Deskriptor verwendet, der die ben√∂tigten Parameter angibt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_p/fr/ht/_pfrhtrtusrz0ua6480jo3acqvo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der wichtigen Parameter dieses Codes ist die Aktivierung des Flags "useHealthCheck". Wir m√ºssen angeben, dass w√§hrend des Bereitstellungsprozesses eine Integrit√§tspr√ºfung erforderlich ist. Diese Option kann deaktiviert werden, wenn f√ºr die Bereitstellung Container von Drittanbietern verwendet werden, die nicht √ºberpr√ºft werden m√ºssen. Dieser Deskriptor gibt auch die Anzahl der Replikate und die Frontend-URL an, die ha-proxy ben√∂tigt. Am Ende befindet sich das Spezifikationsflag f√ºr den Podspec-Pod, der Kubernetes aufruft, um Informationen zur Portkonfiguration, zum Image usw. zu erhalten. Dies ist ein ziemlich einfacher Deskriptor im JSON-Format.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres Tool, das Teil des Amdatu Open Source-Projekts ist, ist Deploymentctl. Es verf√ºgt √ºber eine Benutzeroberfl√§che zur Konfiguration der Bereitstellung, speichert den Bereitstellungsverlauf und enth√§lt Webhooks f√ºr R√ºckrufe durch Benutzer und Entwickler von Drittanbietern. Sie k√∂nnen die Benutzeroberfl√§che nicht verwenden, da Amdatu Deployer selbst eine REST-API ist. Diese Schnittstelle erleichtert Ihnen jedoch die Bereitstellung ohne API. Deploymentctl wurde in OSGi / Vertx mit Angular 2 geschrieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werde ich das Obige auf dem Bildschirm anhand einer vorgefertigten Aufzeichnung demonstrieren, damit Sie nicht warten m√ºssen. Wir werden eine einfache Anwendung auf Go bereitstellen. Keine Sorge, wenn Sie Go noch nicht kennengelernt haben, ist dies eine sehr einfache Anwendung. Sie sollten also alles verstehen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ad/rq/ih/adrqihjjsirswywycn8zcm_ypsy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier erstellen wir einen HTTP-Server, der nur auf / health reagiert, sodass diese Anwendung nur die Integrit√§tspr√ºfung und sonst nichts √ºberpr√ºft. Wenn die Pr√ºfung bestanden ist, wird die unten gezeigte JSON-Struktur aufgerufen. Es enth√§lt die Version der Anwendung, die vom Bereitsteller bereitgestellt wird, die Meldung, die oben in der Datei angezeigt wird, und den booleschen logischen Datentyp - unabh√§ngig davon, ob unsere Anwendung funktioniert oder nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mit der letzten Zeile ein wenig geschummelt, weil ich einen festen booleschen Wert oben in die Datei eingef√ºgt habe, was mir in Zukunft helfen wird, selbst eine "ungesunde" Anwendung bereitzustellen. Wir werden uns sp√§ter darum k√ºmmern.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also lasst uns anfangen. Zuerst √ºberpr√ºfen wir mit dem Befehl ~ kubectl get pods, ob Pods ausgef√ºhrt werden. Wenn die Frontend-URL keine Antwort gibt, stellen wir sicher, dass derzeit keine Bereitstellungen ausgef√ºhrt werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qa/vs/kx/qavskxpsjbdy93vis6wd4xp6tas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als N√§chstes sehen Sie auf dem Bildschirm die von mir erw√§hnte Deploymentctl-Oberfl√§che, in der die Bereitstellungsparameter festgelegt sind: Namespace, Anwendungsname, Bereitstellungsversion, Anzahl der Replikate, Frontend-URL, Containername, Image, Ressourcenlimits, Portnummer zur √úberpr√ºfung der Integrit√§tspr√ºfung usw. . Ressourcenlimits sind sehr wichtig, da Sie so die maximal m√∂gliche Menge an "Eisen" verwenden k√∂nnen. Hier k√∂nnen Sie auch das Bereitstellungsprotokoll des Bereitstellungsprotokolls anzeigen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/fk/wb/g_fkwbqrgrbuaii4xmoqhmds3lu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den Befehl ~ kubectl get pods jetzt wiederholen, k√∂nnen Sie sehen, dass das System 20 Sekunden lang ‚Äûeinfriert‚Äú, w√§hrenddessen die Neukonfiguration des ha-Proxys erfolgt. Danach beginnt es unter und unser Replikat wird im Bereitstellungsprotokoll angezeigt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vm/eb/kb/vmebkbw-zpzs2yjjex70jyiz2gg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine Wartezeit von 20 Sekunden aus dem Video herausgeschnitten, und jetzt sehen Sie auf dem Bildschirm, dass die erste Version der Anwendung bereitgestellt wird. All dies wurde nur mit Hilfe der Benutzeroberfl√§che durchgef√ºhrt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/nw/dq/btnwdq4bpxvs3xloqvdfo01nwla.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir jetzt die zweite Version. Dazu √§ndere ich die Meldung der Anwendung mit "Hallo, Kubernetes!" Bei ‚ÄûHallo, Deployer!‚Äú erstellt das System dieses Image und platziert es in der Docker-Registrierung. Anschlie√üend klicken Sie einfach erneut auf die Schaltfl√§che ‚ÄûDeploy‚Äú im Deploymentctl-Fenster. In diesem Fall wird das Bereitstellungsprotokoll automatisch auf dieselbe Weise gestartet wie bei der Bereitstellung der ersten Version der Anwendung.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7f/fb/hx/7ffbhx4jbq_bwxyxskyfbhqg0cy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Befehl ~ kubectl get pods zeigt an, dass derzeit 2 Versionen der Anwendung ausgef√ºhrt werden. Das Front-End zeigt jedoch an, dass noch Version 1 ausgef√ºhrt wird. Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gu/xz/xg/guxzxgf4t6g8xxruexeuptcebze.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Load Balancer wartet, bis die Integrit√§tspr√ºfung ausgef√ºhrt wird, und leitet den Datenverkehr dann zur neuen Version um. Nach 20 Sekunden wechseln wir zu Curl und stellen fest, dass wir jetzt Version 2 der Anwendung bereitgestellt haben und die erste entfernt wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cq/jp/0k/cqjp0kwmkhlufezt-hzs-80fezq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war die Bereitstellung einer "gesunden" - gesunden - Anwendung. Mal sehen, was passiert, wenn ich f√ºr die neue Version der Anwendung den Wert des Parameters "Healthy" von "true" in "false" √§ndere. Das hei√üt, ich werde versuchen, eine fehlerhafte Anwendung bereitzustellen, die die Integrit√§tspr√ºfung nicht bestanden hat. Dies kann passieren, wenn in der Entwicklungsphase einige Konfigurationsfehler in der Anwendung gemacht wurden und diese in dieser Form in Produktion ging.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, durchl√§uft die Bereitstellung alle oben genannten Schritte, und ~ kubectl get pods zeigt an, dass beide Pods ausgef√ºhrt werden. Im Gegensatz zur vorherigen Bereitstellung zeigt das Protokoll jedoch den Status des Zeitlimits an. Das hei√üt, aufgrund der Tatsache, dass die Integrit√§tspr√ºfung nicht bestanden wurde, kann die neue Version der Anwendung nicht bereitgestellt werden. Als Ergebnis sehen Sie, dass das System wieder die alte Version der Anwendung verwendet hat und die neue Version einfach gel√∂scht wurde.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/iv/qz/kqivqzsf3ghxznqksadtfobhzfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gute daran ist, dass selbst wenn eine gro√üe Anzahl von Anforderungen gleichzeitig in die Anwendung eingehen, diese w√§hrend der Implementierung des Bereitstellungsverfahrens keine Ausfallzeiten bemerken. Wenn Sie diese Anwendung mit dem Gatling-Framework testen, das die maximal m√∂gliche Anzahl von Anforderungen sendet, wird keine dieser Anforderungen gel√∂scht. Dies bedeutet, dass unsere Benutzer nicht einmal Versionsaktualisierungen in Echtzeit bemerken. Wenn dies fehlschl√§gt, wird die Arbeit an der alten Version fortgesetzt. Wenn dies erfolgreich ist, wechseln Benutzer zur neuen Version.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt nur eine Sache, die zu einem Fehler f√ºhren kann: Wenn die Integrit√§tspr√ºfung erfolgreich war und die Anwendung abst√ºrzte, sobald sie die Arbeitslast erhalten hat, tritt der Zusammenbruch erst nach Abschluss der Bereitstellung auf. In diesem Fall m√ºssen Sie manuell auf die alte Version zur√ºcksetzen. Wir haben uns also angesehen, wie man Kubernetes mit seinen Open-Source-Tools verwendet. Der Bereitstellungsprozess wird viel einfacher, wenn Sie diese Tools in die Pipelines zum Erstellen / Bereitstellen von Pipelines einbetten / bereitstellen. Gleichzeitig k√∂nnen Sie zum Starten der Bereitstellung sowohl die Benutzeroberfl√§che verwenden als auch diesen Prozess vollst√§ndig automatisieren, indem Sie beispielsweise Commit to Master anwenden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/4w/s6/xp4ws6tpk0katzykjamtvd1tuz8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Build Server Build Server erstellt ein Docker-Image, f√ºgt es in den Docker Hub oder eine andere von Ihnen verwendete Registrierung ein. Der Docker-Hub unterst√ºtzt Webhook, sodass wir die Remote-Bereitstellung √ºber Deployer wie oben gezeigt starten k√∂nnen. Auf diese Weise k√∂nnen Sie die Bereitstellung der Anwendung in der potenziellen Produktion vollst√§ndig automatisieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fahren wir mit dem n√§chsten Thema fort - der Skalierung des Kubernetes-Clusters. Beachten Sie, dass der Befehl kubectl ein Skalierungsbefehl ist. Mit Hilfe eines anderen k√∂nnen Sie die Anzahl der Replikate in unserem Cluster problemlos erh√∂hen. In der Praxis m√∂chten wir jedoch normalerweise die Anzahl der Knoten erh√∂hen, nicht die Anzahl der Knoten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gh/za/t9/ghzat9sqpdai1jdgg3wabhrfeka.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig m√ºssen Sie m√∂glicherweise w√§hrend der Arbeitszeit die Anzahl der ausgef√ºhrten Instanzen der Anwendung erh√∂hen und nachts, um die Kosten f√ºr Amazon-Dienste zu senken, verringern. Dies bedeutet nicht, dass nur die Anzahl der Pods f√ºr die Skalierung ausreicht, denn selbst wenn einer der Knoten nicht ausgelastet ist, m√ºssen Sie Amazon daf√ºr bezahlen. Das hei√üt, zusammen mit der Skalierung der Herde m√ºssen Sie die Anzahl der verwendeten Maschinen skalieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies kann schwierig sein, da Kubernetes unabh√§ngig davon, ob wir Amazon oder einen anderen Cloud-Dienst verwenden, nichts √ºber die Anzahl der verwendeten Computer wei√ü. Es fehlt ein Tool, mit dem Sie das System auf Knotenebene skalieren k√∂nnen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h8/6d/js/h86djs8fjx9qwpqos9lwpoknxno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir m√ºssen uns also um die Knoten und die Pods k√ºmmern. Wir k√∂nnen den Start neuer Knoten mithilfe der AWS-API und der Skalierungsgruppencomputer einfach skalieren, um die Anzahl der Kubernetes-Arbeitsknoten zu konfigurieren. Sie k√∂nnen auch Cloud-Init oder ein √§hnliches Skript verwenden, um Knoten in einem Kubernetes-Cluster zu registrieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der neue Computer startet in der Scaling-Gruppe, initiiert sich als Knoten, registriert sich in der Registrierung des Assistenten und beginnt mit der Arbeit. Danach k√∂nnen Sie die Anzahl der Replikate erh√∂hen, die auf den resultierenden Knoten verwendet werden sollen. Das Reduzieren des Ma√üstabs erfordert mehr Aufwand, da Sie sicherstellen m√ºssen, dass ein solcher Schritt nicht zur Zerst√∂rung bereits laufender Anwendungen f√ºhrt, nachdem "unn√∂tige" Maschinen ausgeschaltet wurden. Um dieses Szenario zu verhindern, m√ºssen Sie die Knoten in den Status "nicht planbar" versetzen. Dies bedeutet, dass der Standardplaner beim Planen von DaemonSet-Pods diese Knoten ignoriert. Der Scheduler l√∂scht nichts von diesen Servern, startet dort aber auch keine neuen Container. Der n√§chste Schritt besteht darin, den Abflussknoten zu verschieben, dh die Arbeitsherde von dieser auf eine andere Maschine oder andere Knoten zu √ºbertragen, die √ºber eine ausreichende Kapazit√§t daf√ºr verf√ºgen.Nachdem Sie √ºberpr√ºft haben, dass sich auf diesen Knoten keine Container mehr befinden, k√∂nnen Sie sie aus Kubernetes entfernen. Danach h√∂ren sie f√ºr Kubernetes einfach auf zu existieren. Als N√§chstes m√ºssen Sie die AWS-API verwenden, um unn√∂tige Knoten oder Computer zu deaktivieren.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen Amdatu Scalerd verwenden, ein weiteres Open-Source-Skalierungswerkzeug, das der AWS-API √§hnelt. Es bietet eine CLI zum Hinzuf√ºgen oder Entfernen von Knoten in einem Cluster. Die interessante Funktion ist die M√∂glichkeit, den Scheduler mithilfe der folgenden JSON-Datei zu konfigurieren. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/0b/8z/e1/0b8ze13eeahulvu7j2cbuu2m8fe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der angezeigte Code halbiert die Kapazit√§t des Clusters nachts. Es wird als Anzahl der verf√ºgbaren Replikate und als gew√ºnschte Kapazit√§t des Amazon-Clusters konfiguriert. Durch die Verwendung dieses Schedulers wird die Anzahl der Knoten nachts automatisch reduziert und morgens erh√∂ht, wodurch die Kosten f√ºr die Verwendung von Knoten eines Cloud-Dienstes wie Amazon gespart werden. Diese Funktion ist nicht in Kubernetes integriert. Mit Scalerd k√∂nnen Sie diese Plattform jedoch nach Ihren W√ºnschen skalieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte Ihre Aufmerksamkeit auf die Tatsache lenken, dass mir viele Leute sagen: "Das ist alles gut, aber was ist mit meiner Datenbank, die sich normalerweise in einem statischen Zustand befindet?" Wie kann ich so etwas in einer dynamischen Umgebung wie Kubernetes ausf√ºhren? Meiner Meinung nach sollten Sie dies nicht tun, sollten nicht versuchen, den Betrieb des Data Warehouse in Kubernetes zu organisieren. Technisch ist dies m√∂glich, und es gibt Handb√ºcher im Internet zu diesem Thema, aber es wird Ihr Leben ernsthaft verkomplizieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, das Konzept des persistenten Speichers existiert in Kubernetes, und Sie k√∂nnen versuchen, Data Warehouses wie Mongo oder MySQL auszuf√ºhren, aber dies ist eine ziemlich zeitaufw√§ndige Aufgabe. Dies liegt an der Tatsache, dass Data Warehouses die Interaktion mit einer dynamischen Umgebung nicht vollst√§ndig unterst√ºtzen. Die meisten Datenbanken erfordern eine erhebliche Optimierung, einschlie√ülich der manuellen Konfiguration des Clusters. Sie m√∂gen keine automatische Skalierung und √§hnliche Dinge. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erschweren Sie daher nicht Ihr Leben, wenn Sie versuchen, ein Data Warehouse in Kubernetes zu starten. Organisieren Sie ihre Arbeit auf traditionelle Weise mit vertrauten Diensten und geben Sie Kubernetes die M√∂glichkeit, sie zu nutzen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jt/ae/w4/jtaew4lftz8i845qgy8pa6bculm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende des Themas m√∂chte ich Ihnen die Cloud RTI-Plattform vorstellen, die auf Kubernetes basiert und an der mein Team arbeitet. Es bietet zentralisierte Protokollierung, √úberwachung von Anwendungen und Clustern sowie viele andere n√ºtzliche Funktionen, die f√ºr Sie n√ºtzlich sind. Es verwendet verschiedene Open-Source-Tools wie Grafana, um die √úberwachung anzuzeigen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oo/uj/mz/ooujmzx3ukdhlcqyxxwqszgelts.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/ec/cd/5j/eccd5j4rch3uhdrqey516jdxnva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde die Frage aufgeworfen, warum der ha-proxy Load Balancer mit Kubernetes verwendet wird. Gute Frage, denn derzeit gibt es zwei Stufen des Lastausgleichs. Kubernetes-Dienste befinden sich weiterhin auf virtuellen IP-Adressen. Sie k√∂nnen sie nicht f√ºr externe Host-Ports verwenden, da sich die Adresse √§ndert, wenn Amazon seinen Cloud-Host neu startet. Aus diesem Grund stellen wir Ha-Proxy-Dienste vor Dienste, um eine statischere Struktur f√ºr eine nahtlose Verkehrsinteraktion mit Kubernetes zu schaffen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere gute Frage ist, wie ich das Datenbankschema w√§hrend der blau / gr√ºnen Bereitstellung √§ndern kann. </font><font style="vertical-align: inherit;">Tatsache ist, dass das √Ñndern des Datenbankschemas unabh√§ngig von der Verwendung von Kubernetes eine komplexe Aufgabe ist. </font><font style="vertical-align: inherit;">Sie m√ºssen die Kompatibilit√§t des alten und des neuen Schemas sicherstellen. Anschlie√üend k√∂nnen Sie die Datenbank aktualisieren und anschlie√üend die Anwendungen selbst aktualisieren. </font><font style="vertical-align: inherit;">Sie k√∂nnen die Datenbank im laufenden Betrieb austauschen und anschlie√üend die Anwendungen aktualisieren. </font><font style="vertical-align: inherit;">Ich kenne Leute, die einen v√∂llig neuen Datenbankcluster mit einem neuen Schema heruntergeladen haben. Dies ist eine Option, wenn Sie eine schemenlose Datenbank wie Mongo haben, aber auf jeden Fall ist dies keine leichte Aufgabe. </font><font style="vertical-align: inherit;">Wenn Sie keine Fragen mehr haben, vielen Dank f√ºr Ihre Aufmerksamkeit!</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-Ci4vd4rh4M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank f√ºr Ihren Aufenthalt bei uns. Gef√§llt dir unser Artikel? M√∂chten Sie weitere interessante Materialien sehen? Unterst√ºtzen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS f√ºr Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns f√ºr Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit √ºber VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal g√ºnstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie mehr √ºber</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Aufbau eines Infrastrukturgeb√§udes. </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern f√ºr 9.000 Euro f√ºr einen Cent?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de504660/index.html">Prinzessin Frosch 2.0 alias Pelophylax ridibundus</a></li>
<li><a href="../de504662/index.html">Musik zeichnen: Sargtanz in Pure Data</a></li>
<li><a href="../de504664/index.html">Intelligentes Hinzuf√ºgen von Musikgruppen zu Google Sheets √ºber VK API, Tampermonkey und Telegram Bot</a></li>
<li><a href="../de504668/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 346 (vom 25. bis 31. Mai)</a></li>
<li><a href="../de504670/index.html">Einheitliches Staatsexamen in Informatik oder Leiden</a></li>
<li><a href="../de504674/index.html">Basis f√ºr ein gro√ües modulares SPA auf Laravel + Vue + ElementUI mit CRUD-Generator</a></li>
<li><a href="../de504676/index.html">F√ºgen Sie Ihrem Spiel eine Prise Zuf√§lligkeit hinzu</a></li>
<li><a href="../de504678/index.html">ITMO Research_ Podcast: Wie man die Synchronisation von AR-Inhalten mit der Show auf der Skala des gesamten Stadions angeht</a></li>
<li><a href="../de504680/index.html">√úbersicht √ºber die NLP-Bibliothek von SpaL</a></li>
<li><a href="../de504682/index.html">Nostalgie Post: j2me, Schwerkraft trotzt, 64kb</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>