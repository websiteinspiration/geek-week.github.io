<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûï ü§∞üèø üì£ Algorithms for post-processing of text field recognition results üóûÔ∏è üëµüèø üöî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(image taken from here )
 
 Today we would like to tell you about the task of post-processing the results of recognition of text fields based on a pri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Algorithms for post-processing of text field recognition results</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/smartengines/blog/498520/"><img src="https://habrastorage.org/webt/we/b4/48/web4484wjnlsdgvcvav8khbyirq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(image taken </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Today we would like to tell you about the task of post-processing the results of recognition of text fields based on a priori knowledge of the field. Earlier, we already wrote about the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method of field correction based on trigrams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which allows you to correct some recognition errors of words written in natural languages. However, a significant part of important documents, including identification documents, are fields of a different nature - dates, numbers, VIN-codes of cars, TIN and SNILS numbers, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">machine-readable zones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with their checksums and more. </font><font style="vertical-align: inherit;">Although they cannot be attributed to the fields of a natural language, nevertheless, such fields often have some, sometimes implicit, language model, which means that some correction algorithms can also be applied to them. </font><font style="vertical-align: inherit;">In this post, we will discuss two mechanisms for post-processing recognition results that can be used for a large number of documents and field types.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The language model of the field can be conditionally divided into three components:</font></font><br>
<ol>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntax</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : rules governing the structure of a text field representation. </font><font style="vertical-align: inherit;">Example: the ‚Äúdocument expiration date‚Äù field in a machine-readable zone is represented as seven digits ‚ÄúDDDDDDD‚Äù.</font></font><br>
</li>
<li><em> </em>: ,         . :   ‚Äú    ‚Äù -     ‚Äì     , 3-  4-  ‚Äì  , 5-  6- ‚Äì  ,  7-  ‚Äì  .<br>
</li>
<li><em> </em>: ,           . :  ‚Äú    ‚Äù    ,     ,   ‚Äú ‚Äù.<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having information about the semantic and syntactic structure of the document and the recognized field, you can build a specialized algorithm for post-processing the recognition result. However, taking into account the need to support and develop recognition systems and the complexity of their development, it is interesting to consider ‚Äúuniversal‚Äù methods and tools that would allow, with minimal effort (from the developers), to build a fairly good post-processing algorithm that would work with an extensive class documents and fields. The methodology for setting up and supporting such an algorithm would be unified, and only the language model would be a variable component of the algorithm structure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is worth noting that post-processing of text field recognition results is not always useful, and sometimes even harmful: if you have a fairly good line recognition module and you work in critical systems with identification documents, then some kind of post-processing it is better to minimize and produce results ‚Äúas is‚Äù, or clearly monitor any changes and report them to the client. However, in many cases, when it is known that the document is valid, and that the language model of the field is reliable, the use of post-processing algorithms can significantly increase the final recognition quality.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the article will discuss two post-processing methods that claim to be universal. </font><font style="vertical-align: inherit;">The first is based on weighted finite converters, requires a description of the language model in the form of a finite state machine, is not very easy to use, but more universal. </font><font style="vertical-align: inherit;">The second one is easier to use, more efficient, requires only writing a function for checking the validity of the field value, but also has a number of disadvantages.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weighted End Transmitter Method</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A beautiful and fairly general model that allows you to build a universal algorithm for post-processing recognition results is described </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this work</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The model relies on the data structure of Weighted Finite-State Transducers (WFST). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WFSTs are a generalization of weighted finite state machines - if a weighted finite state machine encodes some weighted language </font></font><img src="https://habrastorage.org/getpro/habr/post_images/899/a67/551/899a675510d28419769a9b42281f0c65.svg" alt="L"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(i.e., a weighted set of lines over a certain alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), then WFST encodes a weighted map of a language </font></font><img src="https://habrastorage.org/getpro/habr/post_images/a2a/b58/822/a2ab5882273242f94981925836a91ec8.svg" alt="L_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">above the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/2a6/b12/09b/2a6b1209bdf752a5f991cb012b5b791a.svg" alt="A_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into a language </font></font><img src="https://habrastorage.org/getpro/habr/post_images/3c4/611/0c4/3c46110c45a2c9d8d3c279cad331920b.svg" alt="L_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">above the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/e9f/c45/bcf/e9fc45bcff4c99d6b42a83b8da01eabd.svg" alt="A_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A weighted finite state machine, taking a string </font></font><img src="https://habrastorage.org/getpro/habr/post_images/5bf/27c/73c/5bf27c73c71f303844ee4973cab18377.svg" alt="S"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">over the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, assigns some weight to it </font></font><img src="https://habrastorage.org/getpro/habr/post_images/02b/27e/089/02b27e089139bd8efdfe985192ec9336.svg" alt="w"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, whereas WFST, taking a string</font></font><img src="https://habrastorage.org/getpro/habr/post_images/325/913/78f/32591378f1f3c477755274a1269b0f49.svg" alt="S_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">over the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/2a6/b12/09b/2a6b1209bdf752a5f991cb012b5b791a.svg" alt="A_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, associates with it a set of (possibly infinite) pairs </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d13/6d6/65d/d136d665d0c512df23a1eae1000eb95f.svg" alt="\ {&amp; lt; S_2 ^ 1, w_1 &amp; gt ;, \ ldots, &amp; lt; S_2 ^ k, w_k &amp; gt ;, \ ldots \}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/917/beb/0cc/917beb0cc43863c39e8041595dc6f95c.svg" alt="S_2 ^ i"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the line above the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/e9f/c45/bcf/e9fc45bcff4c99d6b42a83b8da01eabd.svg" alt="A_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into which the line is converted </font></font><img src="https://habrastorage.org/getpro/habr/post_images/325/913/78f/32591378f1f3c477755274a1269b0f49.svg" alt="S_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><img src="https://habrastorage.org/getpro/habr/post_images/9c6/a44/e8e/9c6a44e8ed4cb10046e00346c6b58b15.svg" alt="w_i"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the weight of such a conversion. Each transition of the converter is characterized by two states (between which the transition is made), the input characters (from the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/2a6/b12/09b/2a6b1209bdf752a5f991cb012b5b791a.svg" alt="A_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), the output characters (from the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/e9f/c45/bcf/e9fc45bcff4c99d6b42a83b8da01eabd.svg" alt="A_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and the weight of the transition. An empty character (empty string) is considered to be an element of both alphabets. The </font><font style="vertical-align: inherit;">weight of the </font><font style="vertical-align: inherit;">string </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to string </font><font style="vertical-align: inherit;">conversion </font></font><img src="https://habrastorage.org/getpro/habr/post_images/92f/e45/5fc/92fe455fc98f988c4d76f3d76b36d7ef.svg" alt="Y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the sum of the products of the transition weights along all the paths on which the concatenation of the input characters forms the string </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and the concatenation of the output characters forms the string</font></font><img src="https://habrastorage.org/getpro/habr/post_images/92f/e45/5fc/92fe455fc98f988c4d76f3d76b36d7ef.svg" alt="Y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and which transfer the converter from the initial state to one of the terminal ones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The composition operation is determined over WFST, on which the post-processing method is based. Let two transformers be given </font></font><img src="https://habrastorage.org/getpro/habr/post_images/173/a12/2f7/173a122f7849b9134ce2718c6e02ab46.svg" alt="T_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><img src="https://habrastorage.org/getpro/habr/post_images/052/301/117/052301117e72c384454188c12ba6ec0b.svg" alt="T_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><img src="https://habrastorage.org/getpro/habr/post_images/173/a12/2f7/173a122f7849b9134ce2718c6e02ab46.svg" alt="T_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convert the line </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">above </font></font><img src="https://habrastorage.org/getpro/habr/post_images/bf4/953/6ff/bf49536ff21c20c8dd6a6c30fa00884f.svg" alt="A_x"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the line </font></font><img src="https://habrastorage.org/getpro/habr/post_images/92f/e45/5fc/92fe455fc98f988c4d76f3d76b36d7ef.svg" alt="Y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">above </font></font><img src="https://habrastorage.org/getpro/habr/post_images/ea9/1a9/a75/ea91a9a754c501c4e117285194fc1d8c.svg" alt="A_y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the weight </font></font><img src="https://habrastorage.org/getpro/habr/post_images/f8d/841/546/f8d84154605b3652f439d036c0ae04ca.svg" alt="w_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><img src="https://habrastorage.org/getpro/habr/post_images/052/301/117/052301117e72c384454188c12ba6ec0b.svg" alt="T_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">convert </font></font><img src="https://habrastorage.org/getpro/habr/post_images/92f/e45/5fc/92fe455fc98f988c4d76f3d76b36d7ef.svg" alt="Y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">over </font></font><img src="https://habrastorage.org/getpro/habr/post_images/ea9/1a9/a75/ea91a9a754c501c4e117285194fc1d8c.svg" alt="A_y"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the line </font></font><img src="https://habrastorage.org/getpro/habr/post_images/be9/efa/777/be9efa77761b1343076071d07add5798.svg" alt="Z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">above </font></font><img src="https://habrastorage.org/getpro/habr/post_images/b04/afc/54f/b04afc54f564b1e7dc5ff1c3a8ec48cf.svg" alt="A_z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the weight </font></font><img src="https://habrastorage.org/getpro/habr/post_images/1ad/f05/4f5/1adf054f58e7620e4f853f436b39fcaa.svg" alt="w_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Then the converter </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d0f/ef7/45a/d0fef745aef55c9cccf5c3b3999dbdb3.svg" alt="T_1 \ circ T_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, called the composition of the converters, converts the string </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into a string </font></font><img src="https://habrastorage.org/getpro/habr/post_images/be9/efa/777/be9efa77761b1343076071d07add5798.svg" alt="Z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a weight</font></font><img src="https://habrastorage.org/getpro/habr/post_images/6b6/267/867/6b6267867aed215a641ef6b00fdbf382.svg" alt="w_1 \ cdot w_2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The composition of the transducers is a computationally expensive operation, but it can be calculated lazily - the states and transitions of the resulting transducer can be constructed at the moment when they need to be accessed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm for post-processing the recognition result based on WFST is based on three main sources of information - the hypothesis </font></font><img src="https://habrastorage.org/getpro/habr/post_images/c25/cdf/6f3/c25cdf6f30745730e0ef76706327c970.svg" alt="Hm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">model, the error model, </font></font><img src="https://habrastorage.org/getpro/habr/post_images/efb/79e/7df/efb79e7df0792cea483c6ed41efea702.svg" alt="EM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the language model </font></font><img src="https://habrastorage.org/getpro/habr/post_images/b8f/002/734/b8f002734a17c86c9be6e9e3aa8cdfb0.svg" alt="LM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. All three models are presented in the form of weighted final transducers:</font></font><br>
<br>
<ol>
<li><em> </em> <img src="https://habrastorage.org/getpro/habr/post_images/c25/cdf/6f3/c25cdf6f30745730e0ef76706327c970.svg" alt="Hm">       (  WFST ‚Äì      ,       ),  ,    .  ,         <img src="https://habrastorage.org/getpro/habr/post_images/2b4/73f/d75/2b473fd75c118eae403e73e06abc0cfc.svg" alt="C_1, C_2, \ldots, C_N">,                 (): <img src="https://habrastorage.org/getpro/habr/post_images/efd/145/e4a/efd145e4a2defc2ed71b4e24bf8e9bd1.svg" alt="C_i = \{&amp;lt;a_{i1}, q_{i1}&amp;gt;, \ldots, &amp;lt;a_{ik}, q_{ik}&amp;gt;\}">,  <img src="https://habrastorage.org/getpro/habr/post_images/af8/a1c/f66/af8a1cf667abc5982ba8b1008ab1d698.svg" alt="a_{ij}"> ‚Äì <img src="https://habrastorage.org/getpro/habr/post_images/c73/07a/1bf/c7307a1bf9d387db2abbcfc4215797c1.svg" alt="j">-  , <img src="https://habrastorage.org/getpro/habr/post_images/8c6/26b/064/8c626b0640801ca8b783dd4d27187a9e.svg" alt="q_{ij}"> ‚Äì  ()  .           <img src="https://habrastorage.org/getpro/habr/post_images/c3c/523/a87/c3c523a878065a0846fa7e92f7e5293c.svg" alt="(N+1)">- ,   : <img src="https://habrastorage.org/getpro/habr/post_images/5f8/55a/b76/5f855ab76444c11e5dff28e478ebe06a.svg" alt="0">-   , <img src="https://habrastorage.org/getpro/habr/post_images/a1e/39d/a1c/a1e39da1c84981d7264baa207047222a.svg" alt="N">- ‚Äì ,    <img src="https://habrastorage.org/getpro/habr/post_images/afd/e82/597/afde825977cf3ca73a2f1952aa66c2cd.svg" alt="(i-1)">-  <img src="https://habrastorage.org/getpro/habr/post_images/75c/b01/aa8/75cb01aa8d9f97db4343ac0c5ef11b2d.svg" alt="i">-     <img src="https://habrastorage.org/getpro/habr/post_images/0c5/724/5db/0c57245dbd3c18e987498491056a7911.svg" alt="C_i">.  <img src="https://habrastorage.org/getpro/habr/post_images/c73/07a/1bf/c7307a1bf9d387db2abbcfc4215797c1.svg" alt="j">-        <img src="https://habrastorage.org/getpro/habr/post_images/af8/a1c/f66/af8a1cf667abc5982ba8b1008ab1d698.svg" alt="a_{ij}">,       .       ,       .<br>
<img src="https://habrastorage.org/webt/7k/jo/13/7kjo13f-3_8ydvxj2ub421zhzyq.png"><br>
. 1.   ,    WFST (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>).     .<br>
</li>
</ol><br>
<ol>
<li><em> </em> <img src="https://habrastorage.org/getpro/habr/post_images/efb/79e/7df/efb79e7df0792cea483c6ed41efea702.svg" alt="EM">    ,    ,          .           WFST    (     ).         .  ,            .<br>
</li>
<li><em> </em> <img src="https://habrastorage.org/getpro/habr/post_images/b8f/002/734/b8f002734a17c86c9be6e9e3aa8cdfb0.svg" alt="LM">            . ..    ,       (      ).<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After defining a model of hypotheses, errors, and a language model, the task of post-processing recognition results can now be posed as follows: consider the composition of all three models </font></font><img src="https://habrastorage.org/getpro/habr/post_images/258/b21/786/258b217865a28732f7efea99f27844a5.svg" alt="T=HM\circ EM\circ LM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(in terms of WFST composition). The converter </font></font><img src="https://habrastorage.org/getpro/habr/post_images/365/0cb/4e8/3650cb4e8670eeb97ce55a835259374a.svg" alt="T"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encodes all possible conversions of strings </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the hypothesis model </font></font><img src="https://habrastorage.org/getpro/habr/post_images/c25/cdf/6f3/c25cdf6f30745730e0ef76706327c970.svg" alt="HM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">into strings </font></font><img src="https://habrastorage.org/getpro/habr/post_images/be9/efa/777/be9efa77761b1343076071d07add5798.svg" alt="Z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the language model </font></font><img src="https://habrastorage.org/getpro/habr/post_images/b8f/002/734/b8f002734a17c86c9be6e9e3aa8cdfb0.svg" alt="LM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, applying </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fb1/4b2/485/fb14b2485daa4b8f13252981a33df4e5.svg" alt="X"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transforms encoded in the error model </font><font style="vertical-align: inherit;">to strings </font></font><img src="https://habrastorage.org/getpro/habr/post_images/efb/79e/7df/efb79e7df0792cea483c6ed41efea702.svg" alt="EM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Moreover, the weight of such a transformation includes the weight of the original hypothesis, the weight of the transformation, and the weight of the resulting string (in the case of a weighted language model). Accordingly, in such a model, the optimal post-processing of the recognition result will correspond to the optimal (in terms of weight) path in the converter</font></font><img src="https://habrastorage.org/getpro/habr/post_images/365/0cb/4e8/3650cb4e8670eeb97ce55a835259374a.svg" alt="T"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translating it from the initial to one of the terminal states. The input line along this path will correspond to the selected initial hypothesis, and the output line to the corrected recognition result. The optimal path can be sought using algorithms for finding the shortest paths in directed graphs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The advantages of this approach are its generality and flexibility. The error model, for example, can be easily expanded in such a way as to take into account deletions and additions of characters (for this, it is only worth adding transitions with an empty output or input symbol, respectively, to the error model). However, this model has significant disadvantages. First, the language model here should be presented as a finite weighted finite transformer. For complex languages, such an automaton can turn out to be rather cumbersome, and in case of a change or refinement of the language model, it will be necessary to rebuild it. It should also be noted that the composition of the three transducers as a result has, as a rule, an even more bulky transducer,and this composition is calculated every time you start post-processing one recognition result. Due to the bulkiness of the composition, the search for the optimal path in practice has to be performed with heuristic methods such as A * -search.</font></font><br>
<br>
<h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the model of verifying grammars, it is possible to construct a simpler model of the task of post-processing recognition results, which will not be as general as the model based on WFST, but easily extensible and easy to implement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A checking grammar is a pair </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fd3/47b/00c/fd347b00c55ac4ec6540b463ad680c1b.svg" alt="G=&amp;lt;A,P&amp;gt;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the alphabet, and </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the predicate of admissibility of a string over the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, i.e. </font></font><img src="https://habrastorage.org/getpro/habr/post_images/282/f7a/5f2/282f7a5f2b4b8217fcb3e2f19c580e65.svg" alt="P:A^*\rightarrow\{0,1\}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A checking grammar encodes a certain language over the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as follows: a line </font></font><img src="https://habrastorage.org/getpro/habr/post_images/cbd/a7d/cf3/cbda7dcf37fe5ffdfb068437f1a9639d.svg" alt="S\in A^*"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">belongs to the language if the predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes a true value on this line. It is worth noting that checking grammar is a more general way of representing a language model than a state machine. Indeed, any language represented as a finite state machine</font></font><img src="https://habrastorage.org/getpro/habr/post_images/365/0cb/4e8/3650cb4e8670eeb97ce55a835259374a.svg" alt="T"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, can be represented in the form of a checking grammar (with a predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/3de/a6c/104/3dea6c104ca5878cea71b4e0f6a431df.svg" alt="P(S)\Leftrightarrow S\in \mathrm{acc}(T)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/ee2/9d3/119/ee29d3119304322fc8ff23735ff9c8bd.svg" alt="\mathrm{acc}(T)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the set of lines accepted by the automaton </font></font><img src="https://habrastorage.org/getpro/habr/post_images/365/0cb/4e8/3650cb4e8670eeb97ce55a835259374a.svg" alt="T"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. However, not all languages ‚Äã‚Äãthat can be represented as a checking grammar are representable as a finite automaton in the general case (for example, a language of words of unlimited length over alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/a98/43f/42d/a9843f42dac088912b353acfdcb9a4d1.svg" alt="A=\{a,b\}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, in which the number of characters is </font></font><img src="https://habrastorage.org/getpro/habr/post_images/77a/3eb/b47/77a3ebb4782888583e97885d3053b554.svg" alt="a"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">greater than the number of characters </font></font><img src="https://habrastorage.org/getpro/habr/post_images/428/1f5/336/4281f5336579f64aa8eac86ca1503e43.svg" alt="b"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let the recognition result (hypothesis model) be given as a sequence of cells</font></font><img src="https://habrastorage.org/getpro/habr/post_images/2b4/73f/d75/2b473fd75c118eae403e73e06abc0cfc.svg" alt="C_1, C_2, \ldots, C_N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(same as in the previous section). For convenience, we assume that each cell contains K alternatives and all alternative estimates take a positive value. Evaluation (weight) of the string will be considered the product of the ratings of each of the characters of this string. If the language model is specified in the form of a checking grammar </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fd3/47b/00c/fd347b00c55ac4ec6540b463ad680c1b.svg" alt="G=&amp;lt;A,P&amp;gt;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then the post-processing problem can be formulated as a discrete optimization (maximization) problem on a set of controls </font></font><img src="https://habrastorage.org/getpro/habr/post_images/6ef/02b/580/6ef02b58077800a2b22a5e71ecc6eeec.svg" alt="A^N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the set of all lines of length </font></font><img src="https://habrastorage.org/getpro/habr/post_images/a1e/39d/a1c/a1e39da1c84981d7264baa207047222a.svg" alt="N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">over the alphabet </font></font><img src="https://habrastorage.org/getpro/habr/post_images/4e1/b49/a1f/4e1b49a1f827737c3c2fec7b6eeef35b.svg" alt="A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) with an admissibility predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and functional </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8d9/20b/0e8/8d920b0e847b392accd0e0d75498c7ed.svg" alt="F(S)=\prod_{i=1}^{N}q_i(S_i)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/1d3/735/3a3/1d37353a3480e6c9e24bf62a3fc10f3b.svg" alt="q_i(S_i)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the symbol estimate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/7a3/62f/59e/7a362f59eba33ebc236fefd712440e76.svg" alt="S_i"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font><img src="https://habrastorage.org/getpro/habr/post_images/75c/b01/aa8/75cb01aa8d9f97db4343ac0c5ef11b2d.svg" alt="i"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ith cell .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any discrete optimization problem (i.e., with a finite set of controls) can be solved using a complete enumeration of controls. The described algorithm efficiently iterates over the controls (rows) in decreasing order of the functional value until the validity predicate accepts the true value. We set as the </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8da/056/75e/8da05675e58b0287c1cca7e37cdc1d99.svg" alt="M"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maximum number of iterations of the algorithm, i.e. the maximum number of rows with the maximum estimate on which the predicate will be calculated. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we sort the alternatives in descending order of estimates, and we further assume that for any cell the </font></font><img src="https://habrastorage.org/getpro/habr/post_images/0c5/724/5db/0c57245dbd3c18e987498491056a7911.svg" alt="C_i"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inequality </font></font><img src="https://habrastorage.org/getpro/habr/post_images/200/613/c3d/200613c3daed32c6a4e077ebbef7b2d0.svg" alt="q_{ij}\ge q_{ik}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for </font><font style="vertical-align: inherit;">is true </font></font><img src="https://habrastorage.org/getpro/habr/post_images/e18/bc0/ef5/e18bc0ef500bf2eacf31394cbb669379.svg" alt="j&amp;lt;k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The position will be the sequence of indices </font></font><img src="https://habrastorage.org/getpro/habr/post_images/6c8/161/6fd/6c81616fd0777598b5f72bb00fd1d82f.svg" alt="j_1,\ldots,j_N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corresponding to the row</font></font><img src="https://habrastorage.org/getpro/habr/post_images/bff/a11/709/bffa1170928103888512e8f4abdf6e06.svg" alt="a_{1j_1},\ldots,a_{Nj_N}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Position evaluation, i.e. functional value in that position, consider the product alternatives assessments corresponding to the indices included in position: </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d10/5a5/397/d105a539751b437b9b41c67ac7ed1c5b.svg" alt="\prod_{i=1}^N q_i{j_i}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To store positions, you need the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> data structure </font><font style="vertical-align: inherit;">, which allows you to add new positions (with getting their addresses), get the position at the address and check whether the specified position is added to the database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the process of listing positions, we will select an unviewed position with a maximum rating, and then add to the queue for consideration of </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> all positions that can be obtained from the current one by adding one to one of the indices included in the position. The queue for consideration </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will contain triples </font></font><img src="https://habrastorage.org/getpro/habr/post_images/959/6c2/843/9596c2843676ec22e1ca35c324669dbd.svg" alt="&amp;lt;Q,R,I&amp;gt;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where</font></font><img src="https://habrastorage.org/getpro/habr/post_images/859/cfd/804/859cfd804dfe88b1fdb1b431d440de8e.svg" alt="Q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- evaluation of the position not </font></font><img src="https://habrastorage.org/getpro/habr/post_images/bc2/e13/169/bc2e1316980f83eed49a82ca5dd0f525.svg" alt="R"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reviewed </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">- address of the position viewed in </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from which this position was obtained, </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fdf/d51/092/fdfd51092bb8d23740bdaae45950aa8f.svg" alt="I"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- index of the position element with the address </font></font><img src="https://habrastorage.org/getpro/habr/post_images/bc2/e13/169/bc2e1316980f83eed49a82ca5dd0f525.svg" alt="R"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that was increased by one to obtain this position. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positioning a PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> queue </font><font style="vertical-align: inherit;">will require a data structure that allows you to add another triple </font></font><img src="https://habrastorage.org/getpro/habr/post_images/959/6c2/843/9596c2843676ec22e1ca35c324669dbd.svg" alt="&amp;lt;Q,R,I&amp;gt;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as well as retrieve a triple with maximum rating </font></font><img src="https://habrastorage.org/getpro/habr/post_images/859/cfd/804/859cfd804dfe88b1fdb1b431d440de8e.svg" alt="Q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the first iteration of the algorithm, it is necessary to consider the position </font></font><img src="https://habrastorage.org/getpro/habr/post_images/050/6aa/323/0506aa3230e4366f656c45913cf57b70.svg" alt="S_1=\{1,1,\ldots,1\}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the maximum estimate. If the predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes the true value on the line corresponding to this position, then the algorithm ends. Otherwise, the position is </font></font><img src="https://habrastorage.org/getpro/habr/post_images/325/913/78f/32591378f1f3c477755274a1269b0f49.svg" alt="S_1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">added to </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and in</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adds all triples of the view </font></font><img src="https://habrastorage.org/getpro/habr/post_images/72e/309/388/72e309388903ac3376e98d8e64316b3f.svg" alt="&amp;lt;Q\cdot q_{i2}/q_{i1},R(S_1),i&amp;gt;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for all </font></font><img src="https://habrastorage.org/getpro/habr/post_images/f10/c62/9c6/f10c629c68a8bd9faeb57dbc4b293b4e.svg" alt="i\in\{1,\ldots,N\}"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/42e/06f/198/42e06f19806b7f405c5c29221d5331ee.svg" alt="R(S_1)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the address of the starting position in </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . At each subsequent iteration of the algorithm, the </font><font style="vertical-align: inherit;">triple </font><font style="vertical-align: inherit;">with the maximum value of the estimate </font><font style="vertical-align: inherit;">is extracted </font><font style="vertical-align: inherit;">from the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the position in </font><font style="vertical-align: inherit;">question is restored </font><font style="vertical-align: inherit;">to the address of the initial position </font><font style="vertical-align: inherit;">and index </font><font style="vertical-align: inherit;">. If the position </font><font style="vertical-align: inherit;">has already been added to the database of the considered </font><em><font style="vertical-align: inherit;">PositionBase</font></em><font style="vertical-align: inherit;"> positions </font><font style="vertical-align: inherit;">, then it is skipped and the </font><font style="vertical-align: inherit;">next three with the maximum value of the estimate is extracted </font><font style="vertical-align: inherit;">from the </font><em><font style="vertical-align: inherit;">PositionQueue</font></em><font style="vertical-align: inherit;"> . Otherwise, the </font><font style="vertical-align: inherit;">predicate value is checked </font><font style="vertical-align: inherit;">on the line corresponding to the position </font><font style="vertical-align: inherit;">. If the predicate</font></font><img src="https://habrastorage.org/getpro/habr/post_images/959/6c2/843/9596c2843676ec22e1ca35c324669dbd.svg" alt="&amp;lt;Q,R,I&amp;gt;"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/859/cfd/804/859cfd804dfe88b1fdb1b431d440de8e.svg" alt="Q"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/bc2/e13/169/bc2e1316980f83eed49a82ca5dd0f525.svg" alt="R"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/fdf/d51/092/fdfd51092bb8d23740bdaae45950aa8f.svg" alt="I"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/5bf/27c/73c/5bf27c73c71f303844ee4973cab18377.svg" alt="S"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/5bf/27c/73c/5bf27c73c71f303844ee4973cab18377.svg" alt="S"><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/859/cfd/804/859cfd804dfe88b1fdb1b431d440de8e.svg" alt="Q"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/5bf/27c/73c/5bf27c73c71f303844ee4973cab18377.svg" alt="S"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">takes the true value on this line, then the algorithm ends. If the predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not accept the true value on this line, then the line is </font></font><img src="https://habrastorage.org/getpro/habr/post_images/5bf/27c/73c/5bf27c73c71f303844ee4973cab18377.svg" alt="S"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">added to the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (with the address assigned </font></font><img src="https://habrastorage.org/getpro/habr/post_images/3a1/668/281/3a1668281daf18680a259de22f952e27.svg" alt="R(S)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), </font><font style="vertical-align: inherit;">all derived positions are added to the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> queue </font><font style="vertical-align: inherit;">, and the next iteration proceeds.</font></font><br>
<br>
<pre><code class="plaintext hljs">FindSuitableString(M, N, K, P, C[1], ..., C[N]):<font></font>
      i : 1 ... N:<font></font>
         C[i]    <font></font>
    ( )<font></font>
     PositionBase  PositionQueue<font></font>
    S_1 = {1, 1, 1, ..., 1}<font></font>
     P(S_1): <font></font>
        : S_1,  <font></font>
    ( )<font></font>
     S_1  PositionBase   R(S_1)<font></font>
      i : 1 ... N:<font></font>
         K &gt; 1, :<font></font>
              &lt;Q * q[i][2] / q[i][1], R(S_1), i&gt;  PositionQueue<font></font>
        ( )<font></font>
    ( )<font></font>
        PositionBase  M:<font></font>
           PositionQueue:<font></font>
              PositionQueue  &lt;Q, R, I&gt;   Q<font></font>
            S_from =   PositionBase   R<font></font>
            S_curr = {S_from[1], S_from[2], ..., S_from[I] + 1, ..., S_from[N]}<font></font>
             S_curr   PositionBase:<font></font>
                 <font></font>
            :<font></font>
                 S_curr  PositionBase   R(S_curr)<font></font>
            ( )<font></font>
             P(S_curr):<font></font>
                : S_curr,  <font></font>
            ( )<font></font>
              i : 1 ... N:<font></font>
                 K &gt; S_curr[i]:<font></font>
                      &lt;Q * q[i][S_curr[i] + 1] / q[i][S_curr[i]], <font></font>
                                     R(S_curr),<font></font>
                                     i&gt;  PositionQueue<font></font>
                ( )<font></font>
            ( )<font></font>
               <font></font>
        ( )<font></font>
    ( )<font></font>
        M <font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that during the </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8da/056/75e/8da05675e58b0287c1cca7e37cdc1d99.svg" alt="M"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iterations the predicate will be checked no more than </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8da/056/75e/8da05675e58b0287c1cca7e37cdc1d99.svg" alt="M"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">once, there will be no more </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8da/056/75e/8da05675e58b0287c1cca7e37cdc1d99.svg" alt="M"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">additions to the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and addition to the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , extraction from the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as well as a search in the </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will occur no more than </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d3c/ea0/60e/d3cea060e08931d2d2ae58bc4c90f712.svg" alt="M\cdot N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">once. If the implementation </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionQueue</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used "bunch" of data structure, and for the organization </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionBase</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the data structure "Bor", the complexity of the algorithm is </font></font><img src="https://habrastorage.org/getpro/habr/post_images/8f6/6c0/ef2/8f66c0ef2fb6320ab87d5f1e728d4586.svg" alt="O\left(M \cdot \left(p(N) +N^2+N \log(M\cdot N)\right)\right)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, where </font></font><img src="https://habrastorage.org/getpro/habr/post_images/3bd/ae2/7e6/3bdae27e65ac0c352379343b50b3a1b0.svg" alt="p(N)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- trudoemost test predicate </font></font><img src="https://habrastorage.org/getpro/habr/post_images/d01/0b8/a41/d010b8a414d72f3ae43997a3a0c383db.svg" alt="P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the length of the line </font></font><img src="https://habrastorage.org/getpro/habr/post_images/a1e/39d/a1c/a1e39da1c84981d7264baa207047222a.svg" alt="N"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhaps the most important drawback of the algorithm based on checking grammars is that it cannot process hypotheses of different lengths (which may arise due to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segmentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> errors </font><font style="vertical-align: inherit;">: loss or occurrence of extra characters, gluing and cutting characters, etc.), whereas changes in hypotheses such as ‚Äúdeleting a character‚Äù, ‚Äúadding a character‚Äù, or even ‚Äúreplacing a character with a pair‚Äù can be encoded in the error model of the WFST-based algorithm.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the speed and ease of use (when working with a new type of field you just need to give the algorithm access to the value validation function) make the method based on checking grammars a very powerful tool in the arsenal of the developer of document recognition systems. </font><font style="vertical-align: inherit;">We use this approach for a large number of various fields, such as various dates, bank card number (predicate - checking the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moon code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), fields of machine-readable document areas with checksums, and many others.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The publication was prepared on the basis of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A universal algorithm for post-processing recognition results based on validating grammars. </font><font style="vertical-align: inherit;">K.B. </font><font style="vertical-align: inherit;">Bulatov, D.P. </font><font style="vertical-align: inherit;">Nikolaev, V.V. </font><font style="vertical-align: inherit;">Postnikov. </font><font style="vertical-align: inherit;">Proceedings of ISA RAS, Vol. 65, No. 4, 2015, pp. 68-73.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498504/index.html">New Year greetings and COVID-19: how hackers use the news</a></li>
<li><a href="../en498510/index.html">X. An overview of the boxed version of telephony and connecting to a remote site</a></li>
<li><a href="../en498512/index.html">Fighting traffic jams in a small town for a small budget: results of 6 months of the project</a></li>
<li><a href="../en498516/index.html">Postman - AutoMetrica Metrics in AppMetrica</a></li>
<li><a href="../en498518/index.html">A simplified approach to calculating the date of availability of custom-made production</a></li>
<li><a href="../en498524/index.html">AppCode 2020.1: performance improvements, auto-completion until the end of indexing, documentation generation and much more</a></li>
<li><a href="../en498526/index.html">What's New in Ubuntu 20.04</a></li>
<li><a href="../en498528/index.html">Between home and office. How to organize the work of a distributed team</a></li>
<li><a href="../en498534/index.html">Recognition of documents and persons: a union in the name of freedom or a step towards a digital dictatorship?</a></li>
<li><a href="../en498536/index.html">How to reuse code with symfony 5 bundles? Part 2. We take out the code in the bundle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>