<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∑Ô∏è üëÇüèΩ üëéüèΩ Postman - AutoMetrica Metrics in AppMetrica ü§π üôáüèΩ ‚ù£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction
 Recently, the task arose to periodically check whether all events in the mobile application are working correctly, whether they are t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Postman - AutoMetrica Metrics in AppMetrica</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498516/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Introduction</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently, the task arose to periodically check whether all events in the mobile application are working correctly, whether they are transmitted to AppMetrica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will omit the details of integration, meaning that it is already in the MP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I found two options for verification:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via web interface</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via API</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If one or two events can be viewed on the web interface, then when there are dozens and hundreds of them, you can‚Äôt do without an API. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just in case, I‚Äôll explain that you can of course make your back, and everything will work quickly and reliably, but this is expensive in terms of development and support in the future, so in this article I will try to describe how you can build such a system with minimal effort and with minimal coding .</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Setting up Environments</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need fields with variable data that will be used in our GET request. </font><font style="vertical-align: inherit;">For the current task, we need the following fields:</font></font><br>
<br>
<pre><code class="plaintext hljs">FirstData<font></font>
LastData<font></font>
OperationSystem<font></font>
event<font></font>
MinUsers<font></font>
Params<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what Postman looks like:</font></font><br>
<br>
<img src="https://i.postimg.cc/G35pjzqV/postman-2.png" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Setting up Collections</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now create a Collection with a GET request and test. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/pf/_c/hupf_cmeidifenfanmldelmxgjs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.1. Getting links from AppMetrica </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.1.1. We configure the filter by the date of the event. Usually I choose yesterday, because The daily request metric will be fully compiled and available the next day. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/il/zq/huilzq4gxwjkonk64mucds3ponm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.1.2. Set up the Events filter: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bn/cz/53/bncz53prddx0_qpgvmmkqydqhhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.1.3. Total, we got: The </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
number of users who opened the mobile application, and at the same time activated the event wired into it called app_launch with the app parameter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the event did not work (in the mobile application that day), then there would be zero users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.1.4. Export the link for use through the API: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q1/1u/86/q11u86m7wqw5xe9cj77xh8r32ng.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.2. Paste the resulting link into Postman into the created Collections. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.3. Params Section</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The necessary fields for the GET request have already been transferred to it. </font><font style="vertical-align: inherit;">Now we will make them variable so that the data in the request can change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Find the name of the event and change it to a formula to bind it to our Environments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We take the name of the formula from the field name in the Environments section: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/ms/rc/o-msrchsuhfh8i004fljgtxyjms.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also act with all the fields of the Params section:</font></font><br>
<br>
<pre><code class="plaintext hljs">FirstData<font></font>
LastData<font></font>
OperationSystem<font></font>
Event<font></font>
params</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
example: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8g/rd/eg/8grdegvjfelu0qamdc4vberjvrc.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.4. </font><font style="vertical-align: inherit;">Headers section. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this section, we log in to AppMetrica so that the server skips our requests. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For now, we just need to fill out</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">field name: Authorization</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">field value: OAuth ***** (you need to get the token of your application)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.5. </font><font style="vertical-align: inherit;">You can try to make the first request. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A body with statistics should come: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/nf/th/rqnfthnw4xvef-czad2r1vnwmka.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compare it with the web interface. </font><font style="vertical-align: inherit;">Does it match? </font><font style="vertical-align: inherit;">So we are on the right track! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.6. </font><font style="vertical-align: inherit;">Pre-request Script Section </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.6.1. </font><font style="vertical-align: inherit;">In this section, we will attach data in environments to a file with data in CSV format.</font></font><br>
<br>
<pre><code class="plaintext hljs">console.log("event = " + data.event)
</code></pre><br>
<img src="https://habrastorage.org/webt/zf/v6/df/zfv6df_tgtzgozc-jobydg8lm_i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.7. </font><font style="vertical-align: inherit;">Tests section </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It contains the holy of holies of the entire event, namely the test case code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Below is the code for the current task with comments:</font></font><br>
<br>
<pre><code class="plaintext hljs">pm.test(" ", function () {<font></font>
    pm.response.to.have.status(200); //  ,   <font></font>
});<font></font>
<font></font>
const jsonData = pm.response.json();  //,    .<font></font>
pm.test('   data - ' //   <font></font>
+ pm.iterationData.get("event")+  // ,      CSV   -<font></font>
'.' //     .<font></font>
+pm.iterationData.get("params"), //   ,      CSV   -<font></font>
() =&gt; {<font></font>
    pm.expect(jsonData.totals[0] &gt;= 1) //     <font></font>
    .to.be.true; // ,    PASS  FAIL<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.8. </font><font style="vertical-align: inherit;">Check: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run the query, see the test results: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/dr/8k/qodr8ktyi2yxpx87a6tuv3icb9g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The fact that the names of events and parameters are not visible is not a bug, the CSV file is not yet connected. </font><font style="vertical-align: inherit;">More on that later, the main thing is that everything works. </font><font style="vertical-align: inherit;">Instead of linking to a file, you can simply add text or a link to the environment. </font><font style="vertical-align: inherit;">There are no boundaries for creativity.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Configure Runner</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now we have to take the first step to ensure that it is an auto test, namely connect a data file to it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.1. </font><font style="vertical-align: inherit;">Adding an event list file for tests </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will create a simple CSV data file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first line will be the name of the field for environment </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, there will be lines with the value of the environment field. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/tg/m8/8jtgm82ymwrmkurp052k1fg3xu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2. </font><font style="vertical-align: inherit;">Runner Run </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/5c/5u/bw5c5ualaqpdcsisjsl6reocago.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Select the folder with the collection. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.1. </font><font style="vertical-align: inherit;">Select the desired request. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.2. </font><font style="vertical-align: inherit;">Select the desired Environment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.3. </font><font style="vertical-align: inherit;">We see the number of cases corresponding to the downloaded file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.4. </font><font style="vertical-align: inherit;">We introduce a delay between cases so as not to load the server. </font><font style="vertical-align: inherit;">I entered 100ms just in case. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.5. </font><font style="vertical-align: inherit;">We load the CSV file with a list of events and parameters.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2.6. </font><font style="vertical-align: inherit;">We look, whether the Postman file is correctly recognized. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.3. </font><font style="vertical-align: inherit;">Click RUN, enjoy the result. </font><font style="vertical-align: inherit;">The soldier is sleeping, tests are running!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/ve/ey/rlveeyxwqtbs-e1dj36xuujlvls.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Export report</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is already a matter of taste. </font><font style="vertical-align: inherit;">You can work with the report in JSON. </font><font style="vertical-align: inherit;">So far, I copied everything from VSON to Excel and got an understanding of where the traffic is and where not: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0z/al/ig/0zaligyf7t79io7pzdr52wmla0y.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Materials used: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postman </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppMetrica</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498498/index.html">Investigation: what is higher than thread priorities in Windows?</a></li>
<li><a href="../en498500/index.html">What to see in quarantine? A selection of materials from Technostream (part 1)</a></li>
<li><a href="../en498504/index.html">New Year greetings and COVID-19: how hackers use the news</a></li>
<li><a href="../en498510/index.html">X. An overview of the boxed version of telephony and connecting to a remote site</a></li>
<li><a href="../en498512/index.html">Fighting traffic jams in a small town for a small budget: results of 6 months of the project</a></li>
<li><a href="../en498518/index.html">A simplified approach to calculating the date of availability of custom-made production</a></li>
<li><a href="../en498520/index.html">Algorithms for post-processing of text field recognition results</a></li>
<li><a href="../en498524/index.html">AppCode 2020.1: performance improvements, auto-completion until the end of indexing, documentation generation and much more</a></li>
<li><a href="../en498526/index.html">What's New in Ubuntu 20.04</a></li>
<li><a href="../en498528/index.html">Between home and office. How to organize the work of a distributed team</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>