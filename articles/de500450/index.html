<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍳 👏🏻 🌼 Erstellen eines MIDI-Keyboards aus einem Synthesizer für alte Kinder 😗 🤾🏽 👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Als ich eines Tages nach Hause zurückkehrte, sah ich in der Nähe der Müllrutsche im Eingang einen alten Kinderspielzeugsynthesizer. Vorbei, da es „sün...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erstellen eines MIDI-Keyboards aus einem Synthesizer für alte Kinder</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500450/"><img src="https://habrastorage.org/webt/-g/1_/nu/-g1_nu7zf-kudqjkv5ygvqjysao.jpeg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich eines Tages nach Hause zurückkehrte, sah ich in der Nähe der Müllrutsche im Eingang einen alten Kinderspielzeugsynthesizer. Vorbei, da es „sündig“ war, es aus dem Müll zu holen, aber in meinem Herzen wollte ich es da rausziehen. Bereits spät in der Nacht, gegen 2 Uhr, beschloss ich zu sehen, ob sie noch dort stand. Und ja, sie war immer noch da! In ihrem Aussehen war sie völlig ganz und sauber, so dass es keine Zimperlichkeit gab, um sie nicht zu nehmen. Also ja, ich habe sie genommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wollte schon lange ein Klavier für mich, ich bin kein professioneller Musiker, sondern nur um mich zu verwöhnen - warum nicht? Etwas zu kaufen "um mich verwöhnen zu lassen" Ich wurde "von einer Kröte erwürgt" und hier - ein kostenloses Spielzeug. Als ich es aus dem Papierkorb nahm, dachte ich nicht einmal daran, es als Kinderspielzeug zu verwenden. Ich dachte sofort: "Ohhhh ... eine gute Basis, um zu versuchen, ein MIDI-Keyboard herzustellen."</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich bereits Erfahrung in der Kommunikation mit professionellen Keyboards und MIDI-Keyboards habe, habe ich sofort alle Nachteile meiner Idee verstanden. Das heißt, ein Spielzeug wird tatsächlich ein Spielzeug bleiben. Auf dieser Grundlage wird es unmöglich sein, die Kraft von Tastenanschlägen zu realisieren. Die „leichten“ Plastikschlüssel selbst, die ebenfalls unvollständig sind, werden es nicht ermöglichen, etwas Wertvolles daran auszuführen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst wurde der Spielzeugsynthesizer "bis zur Schraube" zerlegt, der gesamte Kunststoff wurde gut mit Seife gewaschen. Die Karten und Kontaktschlüsselgruppen werden ebenfalls gereinigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Demontage wurde verstanden, warum die Leute es wegwarfen. Ein Spielzeug (ich weiß nicht warum: von Zeit zu Zeit, aufgrund der chinesischen Qualität der Komponenten oder der schwierigen Bedienung) Erstens: Die eingebauten Lautsprecher fielen auseinander, und zweitens: Ein defekter Stecker steckte in der Kopfhörerbuchse, sodass es praktisch keine Möglichkeit gab, sie herauszuziehen . Nachdem das Spielzeug aufgehört hatte, mit den eingebauten Lautsprechern zu spielen, benutzten sie es wahrscheinlich mit Kopfhörern, und nachdem sie den Stecker dort gebrochen hatten, warfen sie ihn einfach weg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Inneren bestand der Spielzeugsynthesizer aus drei Platinen, die durch eine Kabelschleife miteinander verbunden waren. Die zentrale Platine, die für die Erzeugung von Ton und anderen Dingen verantwortlich war, wurde sofort von den beiden anderen Platinen abgelötet und beiseite gelegt. Auf den beiden anderen Brettern befanden sich Kontakte für die Tasten auf der Vorderseite des Spielzeugs und die Klaviertasten. Ich habe die PBS-Steckverbinder mit ihnen verlötet, zumal der Lochabstand auf den Platinen nur 2,54 mm betrug. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bp/mh/qc/bpmhqcxmblsmtoqy7zu7wfbqwm4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nj/dr/us/njdrusxpjqa57hm8ezczbzidcu0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach habe ich ein paar Stunden damit verbracht, Diagramme dieser Tafeln mit Schlüsseln zu erstellen. Wie sich herausstellte, ist das Schema eine einfache Matrixtastatur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yt/uh/m6/ytuhm6oamte_d4mo60zuvzucqfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dem Bild in gelben Kreisen sind die Nummern die Nummern der "horizontalen" Kontakte und die Nummern auf den Tasten die Nummern der "vertikalen" Kontakte im PBS-13-Anschluss auf der Tastaturplatine.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m6/qc/lk/m6qclkogjo6vprfkk4ywi2qtqzq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/n0/lz/tf/n0lztfhulhpdeytl2ltfl0zxqna.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bw/w2/pa/bww2pa-cgsmxubbn2ixa2sr373w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach wurde alles in eine Ecke geworfen und ein Jahr lang abgestaubt. Und dann begann die Zeit der Selbstisolation ... Es wurde langweilig und ich wollte etwas mit meinen eigenen Händen tun, zumal es nirgendwo hin geht und es unmöglich ist ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende beschloss ich, dieses Spielzeug zumindest ein wenig fertigzustellen. Die Arduino-Karte wurde als Grundlage für die Steuerung verwendet, und da die Anzahl der Schlüsselketten größer ist als die Anzahl der Arduino-UNO-Pins, habe ich mich für die Schieberegister 74HC595 und 74HC165 entschieden. Als Ergebnis haben wir ein solches Schema bekommen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/y9/m9/_jy9m906okczf38_zjmeyvy9qbc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Schaltung wurde ursprünglich auf einem lötfreien Steckbrett montiert. Um die Funktionsfähigkeit der Schaltung zu testen (dass es nirgendwo Fehler in den Verbindungen gibt), wurde ein Testprogramm entwickelt, das zeigte, dass alles zu funktionieren schien. Der Algorithmus des Testprogramms war einfach: Einer der Ausgänge des Shift-Ausgangschips wird eingeschaltet und die Werte werden in einem Zyklus vom Shift-Eingangschip gelesen, während die Tasten gedrückt werden. Auf den ersten Blick deutete nichts auf Probleme hin ... und alles schien gut zu funktionieren ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/uh/an/bxuhanfuxtixrojargnmaeqv5oe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den nächsten Tagen arbeitete ich langsam an „Hausaufgaben“, nämlich dem sorgfältigen Löten aller Komponenten des Boards auf ein Steckbrett. Ich habe alles bei mir gesammelt. Er nahm den Arduino NANO als Kontrollplatine.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2o/h9/f-/2oh9f-a8fplwk8bqnt5dultsxee.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solches „Sandwich“ von den Brettern ist darauf zurückzuführen, dass sich die beiden Bretter des Spielzeugs (eines mit Knöpfen und das andere mit der Tastatur) auf verschiedenen Ebenen befinden. Bevor ich alles verlötete, dachte ich: „Ist es möglich, es irgendwie miteinander zu verbinden? die Komponenten, die ich zu Hause habe, um mehr oder weniger gut auszusehen? “ Und so stellte sich heraus, dass zwei Platinen durch Steckverbinder miteinander verbunden waren. Aus meiner Sicht hat es sich für die Heimoption als recht gut herausgestellt, wenn wir in Selbstisolation sitzen. Alles, was ich tun musste, war das Steckbrett zu schneiden und den Spielzeugkörper leicht zu modifizieren, damit Sie das USB-Kabel an das Arduino-Brett anschließen konnten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bb/xz/md/bbxzmdv5zabj-jq6hlyg7jhjpxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Erkenntnis, dass das Gerät nicht genau so funktioniert, wie ich es wollte, kam, als ich das Testprogramm fertigstellte. Der Algorithmus war einfach: Schalten Sie jeden Ausgang des 74HC595-Chips unter Berücksichtigung des Status der Eingänge des 74HC165-Chips ein und schreiben Sie das Ergebnis in separate Variablen. Insgesamt sind 5 Ausgänge des 74HC595 mit der Tastatur verbunden, sodass ich nach dieser Abfrage am Ende 40 Bit (5 * 8) Daten erhalten habe. Eine Zeichenfolge von 40 Bit wurde an die Konsole ausgegeben, und Tasten wurden gedrückt, um zu sehen, wie das Gerät gleichzeitig Tastenanschläge mehrerer Tasten verarbeitet.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d0/ra/o7/d0rao77gsxvrvtbeumy1ufguxsw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier trat das Problem auf: Wenn Sie eine Taste drücken, war alles in Ordnung, aber wenn Sie versuchen, mehr als zwei Tasten gleichzeitig zu drücken, trat eine Situation auf, in der es unmöglich war, vorherzusagen, was gelesen werden würde. Das Ergebnis könnte bei einer Kombination korrekt und bei einer anderen völlig unvorhersehbar sein. Das Problem war, dass das Merkmal dieses Schemas nicht berücksichtigt wurde. Wenn mehrere Tasten gleichzeitig gedrückt werden, werden nicht nur mehrere Vertikale des Tastaturscans geschlossen (dies ist zulässig), sondern es können auch mehrere horizontale Linien durch die Tasten geschlossen werden (was keinesfalls zulässig ist). Weitere Informationen zu diesem Problem und dessen Lösung finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich habe die „Hauptlösung“ des Problems gewählt, nämlich: Ich habe beschlossen, dass für jede Taste in der Tastatur eine Diode vorhanden ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Kopf begann ich schon mental darüber nachzudenken, wie ich die Spuren auf der Platine abschneiden und die Diode in das SMD-Gehäuse in die Lücke stecken müsste. Ich stieg in meine Lagerräume und sah, dass ich im SMD-Gehäuse einfach nicht so viele Dioden hatte (vergessen Sie nicht, dass wir alle auf Selbstisolierung sitzen und es nicht sehr gut möglich ist, in den Laden für Funkkomponenten zu gehen - da dies definitiv keine wesentlichen Waren sind). Ein wenig verärgert beschloss ich, mir die Platine genauer anzusehen: Es ist möglicherweise möglich, Ausgangsdioden auf einige der Spuren zu setzen (ich hatte auch einige davon). Und dann habe ich gesehen, dass jeder Schlüssel einen Jumper hat (die Platine ist einseitig) und die Schaltung so hergestellt ist, dass Sie anstelle dieses Jumpers eine Diode einsetzen können. Ich dachte sofort - Sie müssen nicht einmal etwas schneiden, Sie müssen nur überall Ausgangsdioden anstelle von Jumpern einsetzen.Ich hatte auch nicht so viele Ausgangsdioden. Ein Gedanke schoss mir durch den Kopf: "Vielleicht LEDs?" Die Schaltung arbeitet mit +5 V und wenn Sie rote LEDs mit einem minimalen Spannungsabfall (zwischen den LEDs) platzieren, sollte am Ende eine logische Ebene für die korrekte Bestimmung vorhanden sein: Die Taste wird gedrückt oder nicht.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/1c/37/ff1c37wrrsclbwl0d7edw1x-ork.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Sinne stieg ich wieder in meine Aktien und griff nach den roten LEDs, wo immer es möglich war. Es gab genau so viele wie die Tasten auf der Tastatur! Dies ist ein Zeichen, dachte ich und löte zum Testen mehrere LEDs anstelle von Jumpern. Testergebnisse zeigten, dass die Lösung funktioniert. Danach habe ich die restlichen LEDs anstelle von Jumpern gelötet. Das Testprogramm hat gezeigt, dass Sie mindestens alle Tasten gleichzeitig drücken können und alle korrekt gelesen werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g8/i0/-b/g8i0-b1rwc2ykc3oq1hcecu-ohs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe beschlossen, keine Dioden auf die zusätzlichen Knöpfe am Spielzeug zu setzen, da es unwahrscheinlich ist, dass sie von mehreren Teilen gleichzeitig gedrückt werden. Außerdem habe ich im Programm noch keine Bearbeitung zum Klicken auf diese Schaltflächen. Nun, ich habe noch nicht entschieden, wie ich sie verwenden soll.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist an der Zeit herauszufinden, wie dieses Gerät als MIDI-Keyboard auf Ihrem Computer angezeigt wird und in welchem ​​Format Sie Daten senden müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die im Internet gefundenen Informationen sagten mir, dass es möglich ist, ein MIDI-Keyboard aus Arduino sehr einfach und einfach durch Eingießen von Firmware zu erstellen, wodurch der Computer es nicht als COM-Port, sondern als MIDI-Keyboard sieht. Anfangs habe ich mich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von dieser Entscheidung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leiten </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">lassen</font></a><font style="vertical-align: inherit;"> und nicht besonders darauf eingegangen, wie sie umgesetzt wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich zu ihm kam und es sorgfältig las, wurde mir klar, dass mein Arduino NANO-Board für diese Lösung nicht geeignet sein würde, da es einen COM-Anschluss auf der Basis des CH340-Chips hatte. </font><font style="vertical-align: inherit;">Um die Firmware über den obigen Link zu verwenden, sind nur Karten geeignet, die bereits einen USB-Anschluss am Controller haben (z. B. AtMega32u4), oder die Kommunikation über den COM-Anschluss erfolgt nicht über FT232RL-Konvertierungschips oder ähnliches, sondern über AtMega-Mikrocontroller. </font><font style="vertical-align: inherit;">Daher muss die Firmware auf der Karte die Daten im MIDI-Format an den COM-Port senden. Auf dem Computer müssen Sie Software installieren und konfigurieren, die diese Daten abfängt und an den virtuellen MIDI-Port überträgt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus zum Lesen von Tasten und Generieren von MIDI-Befehlen war wie folgt:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jj/-2/d6/jj-2d67yncypthxguaeyvotcvue.jpeg"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Programm für den Arduino NANO-Controller sieht jetzt so aus.</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">//    +5V<font></font>
//   ST_CP  74HC595<font></font>
#define latchPin      11<font></font>
//   SH_CP  74HC595<font></font>
#define clockPin      13<font></font>
//   DS  74HC595<font></font>
#define dataPin       12<font></font>
<font></font>
//     +5V<font></font>
#define latchPin_IN   9<font></font>
#define clockPin_IN   10<font></font>
#define dataPin_IN    8<font></font>
<font></font>
// ,       1-16    <font></font>
#define BUT_OUT0      7<font></font>
#define BUT_OUT1      6<font></font>
#define BUT_OUT2      5<font></font>
#define BUT_OUT3      4<font></font>
<font></font>
byte but_out[4] = {BUT_OUT0, BUT_OUT1, BUT_OUT2, BUT_OUT3};<font></font>
//       <font></font>
byte kbd_in[5] = {0, 0, 0, 0, 0};<font></font>
byte kbd_in_new[5] = {0, 0, 0, 0, 0};<font></font>
<font></font>
//       <font></font>
byte btn_in[4] = {0, 0, 0, 0};<font></font>
byte btn_in_new[4] = {0, 0, 0, 0};<font></font>
<font></font>
//  3  -   (1 - , 0 - )<font></font>
byte kbd_out = 0b11100000;<font></font>
<font></font>
//  <font></font>
void init_electronics() {<font></font>
  //  ,   +5V<font></font>
  //  OUTPUT<font></font>
  pinMode(latchPin, OUTPUT);<font></font>
  pinMode(clockPin, OUTPUT);<font></font>
  pinMode(dataPin, OUTPUT);<font></font>
<font></font>
  //  ,   +5V<font></font>
  pinMode(latchPin_IN, OUTPUT);<font></font>
  pinMode(clockPin_IN, OUTPUT);<font></font>
  pinMode(dataPin_IN, INPUT);<font></font>
<font></font>
  //          <font></font>
  for (byte i = 0; i &lt; 4; i++) pinMode(but_out[i], OUTPUT);<font></font>
}<font></font>
<font></font>
//      74HC595<font></font>
void write_5V(byte a) {<font></font>
    digitalWrite(latchPin, LOW);<font></font>
    //    dataPin<font></font>
    shiftOut(dataPin, clockPin, MSBFIRST, a); <font></font>
     //"" ,      <font></font>
    digitalWrite(latchPin, HIGH); <font></font>
}<font></font>
<font></font>
void read_5V(byte *btn, byte *kbd) {<font></font>
  digitalWrite(clockPin_IN, HIGH);<font></font>
  digitalWrite(latchPin_IN, LOW);<font></font>
  digitalWrite(latchPin_IN, HIGH);<font></font>
  <font></font>
  //    -    <font></font>
  *btn = shiftIn(dataPin_IN, clockPin_IN, LSBFIRST);<font></font>
  <font></font>
  //    -    <font></font>
  *kbd = shiftIn(dataPin_IN, clockPin_IN, LSBFIRST);<font></font>
}<font></font>
<font></font>
void setup() {<font></font>
  init_electronics();<font></font>
  write_5V(kbd_out);<font></font>
  Serial.begin(115200);<font></font>
}<font></font>
<font></font>
//       ,   <font></font>
void read_kbd_and_btn_state(byte *btn, byte *kbd) {<font></font>
 byte tmp;<font></font>
  for (byte i = 0; i &lt; 5; i++) {<font></font>
    write_5V(kbd_out | (1 &lt;&lt; i));<font></font>
    read_5V(&amp;tmp, &amp;kbd[i]);<font></font>
  }<font></font>
}<font></font>
<font></font>
void noteOn(int cmd, int pitch, int velocity) {<font></font>
  Serial.write(cmd);<font></font>
  Serial.write(pitch);<font></font>
  Serial.write(velocity);<font></font>
}<font></font>
<font></font>
//     num  ,   <font></font>
// 0 -  0,  0<font></font>
// 1 -  0,  1<font></font>
// 2 -  1,  1<font></font>
// 3 -  1,  0<font></font>
byte compare_bit(byte old_state, byte new_state, byte num) {<font></font>
  byte tmp_old, tmp_new;<font></font>
  tmp_old = (old_state &gt;&gt; num) &amp; 1;<font></font>
  tmp_new = (new_state &gt;&gt; num) &amp; 1;<font></font>
  if ((tmp_old == 0) &amp;&amp; (tmp_new == 0)) return 0;<font></font>
  if ((tmp_old == 0) &amp;&amp; (tmp_new == 1)) return 1;<font></font>
  if ((tmp_old == 1) &amp;&amp; (tmp_new == 1)) return 2; <font></font>
  if ((tmp_old == 1) &amp;&amp; (tmp_new == 0)) return 3;  <font></font>
}<font></font>
<font></font>
void loop() {<font></font>
  read_kbd_and_btn_state(btn_in_new, kbd_in_new);<font></font>
  for (byte i = 0; i &lt; 5; i++) {<font></font>
    for (byte j = 0; j &lt; 8; j++) {<font></font>
      switch (compare_bit(kbd_in[i], kbd_in_new[i], 7 - j)) {<font></font>
        //  <font></font>
        case 1: noteOn(0x90, 0x1D + (8 * i + j), 0x7F);<font></font>
                break;<font></font>
        //  <font></font>
        case 2: //noteOn(0x00, 0x1D + (8 * i + j), 0x7F);<font></font>
                break;<font></font>
        //  <font></font>
        case 3: noteOn(0x90, 0x1D + (8 * i + j), 0x00);<font></font>
                break;<font></font>
      }<font></font>
    }<font></font>
    kbd_in[i] = kbd_in_new[i];<font></font>
  }<font></font>
} <font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es macht keinen Sinn, detailliert zu beschreiben, wie man mit MIDI-Daten arbeitet, da diese hier gelesen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden können.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich werde näher auf die Software für den Computer und die Probleme eingehen, auf die ich gestoßen bin. Probleme traten einfach aufgrund des Mangels an normaler Dokumentation für diese Software auf. Damit der Computer MIDI-Daten von einem Gerät wie meinem erfolgreich empfangen kann, benötigen Sie zwei Programme: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loopMIDI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serial-Midi Converter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Für Serial-MIDI Converter müssen Sie auch Java installieren, wenn es nicht auf dem Computer installiert ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten das Programm loopMIDI und erstellen zwei virtuelle Ports. Ich nannte sie Arduino IN und Arduino OUT. Dieses Programm wird ein virtuelles MIDI-Gerät sein.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/he/e8/do/hee8doojjloz3jiocd58qpugocg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie als Nächstes den Serial-MIDI Converter aus und führen Sie ihn beim Start durch. Leider müssen Sie dies jedes Mal tun, wenn Sie es starten, aber es ist nicht sehr beängstigend, es wird buchstäblich in vier Tastenanschlägen auf der Tastatur ausgeführt. Die COM-Port-Nummer kann unterschiedlich sein. Sie wird auf dem Computer angezeigt, wenn die Arduino NANO-Karte angeschlossen ist. Die Portgeschwindigkeit wird in der Arduino NANO-Firmware eingestellt. Die roten Pfeile zeigen meine Einstellungen an, bei denen alles für mich funktioniert hat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zu/qj/l0/zuqjl0ruk96yomobfupdvbstgps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich ist der Einrichtungsvorgang abgeschlossen und Sie können bereits eine Software verwenden, die Sounds wiedergibt, indem Sie Tastenanschläge vom Gerät akzeptieren. In den Softwareeinstellungen müssen Sie "Arduino_OUT" als Eingabe auswählen. Im Bild unten ein Beispiel für die Konfiguration von Kontakt Player. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/eu/uu/qseuuugs_lbaywuoplve0qgc2wg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es funktioniert letztendlich so:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cOnQOAYKlg0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was weiter? </font><font style="vertical-align: inherit;">Und dann passierte alles genau so, wie ich es erwartet hatte - das Spielzeug bleibt ein Spielzeug mit genau den Mängeln, die ich am Anfang erwähnt habe. </font><font style="vertical-align: inherit;">Wahrscheinlich wird das Kind dieses Spiel in einem Summen spielen, aber für einen Erwachsenen nach normalen Tasteninstrumenten ... Es ist einfacher, ein gebrauchtes MIDI-Keyboard billig zu kaufen, und es ist viel besser als dieses Spielzeug. </font><font style="vertical-align: inherit;">Ich habe beschlossen, dieses Spielzeug so zu belassen, wie es ist, aber einige Änderungen daran vorzunehmen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie den Originaletui.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie funktionierende Lautsprecher auf und stellen Sie einen Verstärker für sie her.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie es im Modus „Kinderspielzeug“ funktionieren, ohne eine Verbindung zu einem Computer herzustellen, damit es selbst Sounds abspielen kann.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ermöglichen Sie den Anschluss von FootSwitch (dasselbe Pedal am Klavier unten), damit Sie den Ton nach dem Loslassen der Tasten wie bei einem normalen Instrument halten können.</font></font></li>
<li>    ,       .</li>
<li>    ,      -,      .</li>
</ol><br>
<img src="https://habrastorage.org/webt/qa/79/bk/qa79bkjnapd9sf84teo-y_nxn0g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich kann die meisten Punkte nicht umsetzen, während wir alle "zu Hause" zusammen sind, da ich zu Hause einfach nicht alle erforderlichen Komponenten dafür habe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Absatz 3 im Internet zu implementieren, wurde eine Lösung namens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SamplerBox gefunden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Wesentliche des Projekts ist, dass Sie jedes MIDI-Keyboard an das Raspberry Pi-Board anschließen können, das MIDI-Befehle vom Keyboard verarbeitet und Sounds spielt oder Instrumente usw. wechselt. Es bleibt nur, die Raspberry Pi-Platine in den Spielzeugkörper zu stecken, ohne die Möglichkeit zu haben, die SD-Karte auszutauschen (ohne das Gehäuse zu zerlegen). Konfigurieren Sie die Tasten am Spielzeugkörper so, dass sie die Werkzeuge wechseln. Dies reicht aus, um dieses Projekt in dieser Form zu belassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber all dies wird nach dem Ende der Zeit der Selbstisolation geschehen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass jemand meine Erfahrung nützlich findet.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de500436/index.html">Kommen von binären neuronalen Netzen basierend auf zufälligen Neuronen und logischen Funktionen</a></li>
<li><a href="../de500438/index.html">SFTP und FTPS</a></li>
<li><a href="../de500444/index.html">9 Python-Programmierkenntnisse, die Anfänger von erfahrenen unterscheiden</a></li>
<li><a href="../de500446/index.html">Ein paar Worte zu R2DBC und PostgreSQL</a></li>
<li><a href="../de500448/index.html">Prometheus: HTTP-Überwachung über den Blackbox-Exporter</a></li>
<li><a href="../de500452/index.html">Hohe Argumentation für tiefes Lernen</a></li>
<li><a href="../de500454/index.html">"Welche Yachthäfen?" oder wir steuern den Controller über Bluetooth mit einer mobilen Anwendung auf Xamarin (Android)</a></li>
<li><a href="../de500456/index.html">BpfTrace - endlich ein vollständiger Ersatz für Dtrace unter Linux</a></li>
<li><a href="../de500458/index.html">Technische Funktionen für Online-Sprache: Starter Pack</a></li>
<li><a href="../de500462/index.html">Erkennen von Szenenänderungen und Speichern von h264-Videoclips auf Raspberry Pi ohne Dekodierung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>