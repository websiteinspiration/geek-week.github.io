<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐨 🍌 👍🏿 .NET Frameworkアプリケーション用のLinuxコンテナー（.Net Coreへの移行が難しい場合） 👨🏽‍🤝‍👨🏻 👹 👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル。
 
 少なくとも私にとっては、非定型的な仕事とその解決策を世界に共有したいと思います。以下で説明することは、状況からの理想的な方法ではない可能性がありますが、機能し、意図したとおりに機能します。
 
 設定と背景
 仕事のタスクがありました：サイトでさまざまな機器、材料、オブジ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.NET Frameworkアプリケーション用のLinuxコンテナー（.Net Coreへの移行が難しい場合）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498396/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少なくとも私にとっては、非定型的な仕事とその解決策を世界に共有したいと思います。</font><font style="vertical-align: inherit;">以下で説明することは、状況からの理想的な方法ではない可能性がありますが、機能し、意図したとおりに機能します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定と背景</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仕事のタスクがありました：サイトでさまざまな機器、材料、オブジェクトのBIMモデルの3Dプレビューを作成する必要があります。</font><font style="vertical-align: inherit;">軽量でシンプルなものが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサイトでは、これらのオブジェクトのモデルが保存され、さまざまな</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CADシステムの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自の形式で</font><font style="vertical-align: inherit;">、および3Dモデルのオープン形式の</font><font style="vertical-align: inherit;">形式でダウンロードできます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その中には</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFC</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマットがあります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この問題を解決するためのソースとして使用します。</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションの1つとその機能</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正式には、Webページに表示する何かの* .ifcコンバーターの記述に制限することができます。</font><font style="vertical-align: inherit;">これが私が始めたところです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような変換のために</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すばらしいツールキットである</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;">xBIMツールキット</font></b></a><font style="vertical-align: inherit;">が選択されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このツールの使用例は</font><font style="vertical-align: inherit;">、IFCとWeb形式に特化した* .wexBIMの操作方法を</font><font style="vertical-align: inherit;">簡単かつ明確に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">説明</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しています。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、* .ifcを* .wexBIMに変換します。</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> Xbim.Ifc;
<span class="hljs-keyword">using</span> Xbim.ModelGeometry.Scene;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CreateWexBIM</span><font></font>
{<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> fileName = <span class="hljs-string">"SampleHouse.ifc"</span>;
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> model = IfcStore.Open(fileName))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> Xbim3DModelContext(model);<font></font>
                context.CreateContext();<font></font>
<font></font>
                <span class="hljs-keyword">var</span> wexBimFilename = Path.ChangeExtension(fileName, <span class="hljs-string">"wexBIM"</span>);
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBiMfile = File.Create(wexBimFilename))<font></font>
                {<font></font>
                    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBimBinaryWriter = <span class="hljs-keyword">new</span> BinaryWriter(wexBiMfile))<font></font>
                    {<font></font>
                        model.SaveAsWexBim(wexBimBinaryWriter);<font></font>
                        wexBimBinaryWriter.Close();<font></font>
                    }<font></font>
                    wexBiMfile.Close();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、結果のファイルは「プレーヤー」</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM WeXplorerで</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .wexBIMをページに埋め込む例：</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello building!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/xbim-viewer.debug.bundle.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> xViewer(<span class="hljs-string">'viewer'</span>);
            viewer.load(<span class="hljs-string">'data/SampleHouse.wexbim'</span>);
            viewer.start();
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さあ、行きましょう。</font><font style="vertical-align: inherit;">私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から核種</font><font style="vertical-align: inherit;">を取り</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">* .ifcファイルへの一連のパスを入力として受け取るコンソールアプリケーションを書いていて、その横に一連の* .wexBIMファイルを追加しています。</font><font style="vertical-align: inherit;">すべてをサイトにアップロードできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、どういうわけか非常に単純です...このプログラムを一種のサービスにしたいのです。これは、ポータルへの* .ifcアップロードイベント時に、必要な* .wexBIMをすぐに作成し、準備されたコンテナーにすぐに表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、私は新しい要件を形成します：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から変換タスクを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">取得し</font></a><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク自体をバイナリメッセージの形式で表示したいのですが、実際には、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protobuf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルに</font><font style="vertical-align: inherit;">記述されているクラスによる逆シリアル化の準備ができてい</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクは、当社からソース* .ifcファイルをダウンロードするためのリンクが含まれます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minioを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> タスクは、Minioのどのバケットに結果を追加するかも教えてくれます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション自体を.netコア3.1で構築し、「Dockerファーム」のLinux Dockerコンテナー内で動作させます。</font></font></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の困難と慣習</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の4つの実装ポイントについては詳しく説明しません。</font><font style="vertical-align: inherit;">多分後で。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションにジョブキューをリッスンさせ</font><font style="vertical-align: inherit;">、ジョブメッセージの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CorrelationId</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から結果を含むメッセージをキューに送信させました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">protobufから生成された要求/応答クラスをねじ込みました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minioで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルをダウンロード/アップロードすることを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">教えた</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはすべて、コンソールアプリケーションプロジェクトで行います。</font><font style="vertical-align: inherit;">プロジェクト設定：</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.1<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、Windows 10を搭載した私のマシンでは、すべてが完全にデバッグされて機能します。</font><font style="vertical-align: inherit;">しかし、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSLで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションを実行しようとすると</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.IO.FileLoadException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーが発生します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全なエラー情報：</font></font></b>
                        <div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileLoadException"</span>,
  <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Failed to load Xbim.Geometry.Engine64.dll"</span>,
  <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"Void .ctor(Microsoft.Extensions.Logging.ILogger`1[Xbim.Geometry.Engine.Interop.XbimGeometryEngine])"</span>,
  <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.get_Engine()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.CreateContext(ReportProgressDelegate progDelegate, Boolean adjustWcs)\r\n at My.Converter.ConvertIfc.CreateWebIfc(String ifcFileFullPath, String wexBIMFolder)"</span>,
  <span class="hljs-attr">"Data"</span>: {},
  <span class="hljs-attr">"InnerException"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileNotFoundException"</span>,
    <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Could not load file or assembly 'Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified."</span>,
    <span class="hljs-attr">"FileName"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null"</span>,
    <span class="hljs-attr">"FusionLog"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"System.Reflection.RuntimeAssembly nLoad(System.Reflection.AssemblyName, System.String, System.Reflection.RuntimeAssembly, System.Threading.StackCrawlMark ByRef, Boolean, System.Runtime.Loader.AssemblyLoadContext)"</span>,
    <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, RuntimeAssembly assemblyContext, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, StackCrawlMark&amp; stackMark, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.Assembly.Load(String assemblyString)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)"</span>,
    <span class="hljs-attr">"Data"</span>: {},
    <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"System.Private.CoreLib"</span>,
    <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2147024894</span><font></font>
  },<font></font>
  <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.Interop"</span>,
  <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2146232799</span>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクティブなグーグルと思慮深い読書のセッションは、私が非常に注意力がないことを私に示しました：</font></font><br>
<blockquote>Recently at work, we were evaluating a few options to render building models in the browser. Building Information Modeling (BIM) in interoperability scenarios is done via Industry Foundation Classes, mostly in the STEP Physical File format. The schema is quite huge and complex with all the things you have to consider, so we were glad to find the xBim open source project on GitHub. They've got both projects to visualize building models in the browser with WebGL as well as conversion tools to create the binary-formatted geometry mesh. To achieve that, native C++ libraries are dynamically loaded (so no .Net Core compatibility) which must be present in the bin folder. The C++ libraries are expected either in the same folder as the application binaries or in a x64 (or x86, respectively) sub folder (See <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">here</a> for more details). In regular projects, the xBim.Geometry NuGet package adds a build task to copy the dlls into the build output folder, but this doesn't work with the new tooling. You can, however, get it to work in Visual Studio 2015 by taking care of supplying the interop dlls yourself.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、同様の困難は私だけではありません。</font><font style="vertical-align: inherit;">多くの人々は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Net CoreでxBIMを望んでい</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要ではありませんが、それは大きく変化します...すべて</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">通常Xbim.Geometry.Engine64.dll</font></i><font style="vertical-align: inherit;">をロードできないことに</font><i><font style="vertical-align: inherit;">依存</font></i><font style="vertical-align: inherit;">してい</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">マシンに</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vc_redist.x64.exe</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">私のオプションは何ですか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が最初に思ったのは、「完全な.Net Frameworkを備えたWindowsコンテナを使用できますか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコンテナーにVisual Studio 2015、2017、2019用のMicrosoft Visual C ++再頒布可能パッケージを提供すれば、すべて問題ありませんか？」</font><font style="vertical-align: inherit;">私はこれを試しました：</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DockerのWindowsイメージをテストします。</font></font></b>
                        <div class="spoiler_text"> .Net Core :<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>net47<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br>
Dockerfile:<br>
<br>
<pre><code class="powershell hljs">FROM microsoft/dotnet<span class="hljs-literal">-framework</span>:<span class="hljs-number">4.7</span><font></font>
WORKDIR /bimlibconverter<font></font>
<span class="hljs-built_in">COPY</span> lib/VC_redist.x64.exe /VC_redist.x64.exe<font></font>
RUN C:\VC_redist.x64.exe /quiet /install<font></font>
<span class="hljs-built_in">COPY</span> bin/Release .<font></font>
ENTRYPOINT [<span class="hljs-string">"MyConverter.exe"</span>]</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、それはうまくいった...それは生きている！</font><font style="vertical-align: inherit;">だが。</font><font style="vertical-align: inherit;">しかし、Dockerを備えたホストLinuxマシンはどうでしょうか？</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上のイメージを含むコンテナーをドライブすることはできません</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">外に出る必要があります...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥協と否定</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webでもう一度検索すると</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、記事が表示されました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その中で、著者は同様の実装を必要とします：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらに悪いことに、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのバイナリは32ビット（x86）です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部には、ビジュアルC ++再配布可能ランタイムコンポーネントが必要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部には.NETランタイムが必要です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドラインインターフェイス（CLI）のみを使用している場合でも、ウィンドウシステムが必要な場合があります。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、Linuxアプリケーションでwineを使ってWindowsアプリケーションを実行する可能性について説明しています。</font><font style="vertical-align: inherit;">好奇心が強い、私は決めた。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのテスト、バグ、および追加を行った後、Dockerfileを受け取りました。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wine、.Net Framework、vcredistを搭載したUbuntuベースのDockerイメージ：</font></font></b>
                        <div class="spoiler_text"><pre><code class="powershell hljs"><font></font>
FROM ubuntu:latest<font></font>
<span class="hljs-comment">#  x86</span>
RUN dpkg -<span class="hljs-literal">-add</span><span class="hljs-literal">-architecture</span> i386 \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-get</span> update \
    <span class="hljs-comment">#   </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        software<span class="hljs-literal">-properties</span><span class="hljs-literal">-common</span> \<font></font>
        gnupg2 \<font></font>
        <span class="hljs-built_in">wget</span> \<font></font>
        xvfb \<font></font>
        cabextract \<font></font>
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; <span class="hljs-built_in">wget</span> <span class="hljs-literal">-nv</span> https://dl.winehq.org/wine<span class="hljs-literal">-builds</span>/winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-key</span> add winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-add</span><span class="hljs-literal">-repository</span> <span class="hljs-string">'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'</span> \
    <span class="hljs-comment">#     Wine</span>
    &amp;&amp; <span class="hljs-built_in">add-apt</span><span class="hljs-literal">-repository</span> ppa:cybermax<span class="hljs-literal">-dexter</span>/sdl2<span class="hljs-literal">-backport</span> \
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        winehq<span class="hljs-literal">-staging</span> \<font></font>
        winbind \<font></font>
    <span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo<font></font>
<span class="hljs-comment">#    Wine</span>
ENV WINEDEBUG=fixme<span class="hljs-literal">-all</span><font></font>
ENV WINEPREFIX=/root/.net<font></font>
ENV WINEARCH=win64<font></font>
<span class="hljs-comment">#  Wine</span><font></font>
RUN winecfg \<font></font>
    <span class="hljs-comment"># winetricks,   .Net Framework  </span>
    &amp;&amp; <span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks \
    <span class="hljs-literal">-O</span> /usr/local/bin/winetricks \<font></font>
    &amp;&amp; chmod +x /usr/local/bin/winetricks \<font></font>
<span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo \<font></font>
    <span class="hljs-comment"># Wine   </span>
    &amp;&amp; wineboot <span class="hljs-literal">-u</span> &amp;&amp; winetricks <span class="hljs-literal">-q</span> dotnet472 &amp;&amp; xvfb<span class="hljs-literal">-run</span> winetricks <span class="hljs-literal">-q</span> vcrun2015<font></font>
<font></font>
WORKDIR /root/.net/drive_c/myconverter/<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-built_in">COPY</span> /bin/Release/ /root/.net/drive_c/myconverter/<font></font>
<font></font>
ENTRYPOINT [<span class="hljs-string">"wine"</span>, <span class="hljs-string">"MyConverter.exe"</span>]
</code></pre><br>
UPD:        .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link">rueler</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビルドは高速ではありませんが、正常に終了します。</font><font style="vertical-align: inherit;">やってみる、チェック。</font><font style="vertical-align: inherit;">動作します！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果、結論、考え</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動いた。</font><font style="vertical-align: inherit;">出力は、DockerコンテナーのLinuxイメージです。</font><font style="vertical-align: inherit;">これは「ふくらんでいる」（約5.2GB）ですが、起動は非常に速く、内部では.Net Framework 4.7でWindowsコンソールアプリケーションが実行され、RabbitMQをリッスンし、ログを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graylog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">書き込み</font><font style="vertical-align: inherit;">、ファイルを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Minio</font></a><font style="vertical-align: inherit;">にダウンロードしてアップロードします。</font><font style="vertical-align: inherit;">リモートDocker APIでアプリを更新します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実用的な専用タスクのソリューションが実装されています。</font><font style="vertical-align: inherit;">おそらく、そしておそらく、普遍的ではありません。</font><font style="vertical-align: inherit;">でも基本的には満足しました。</font><font style="vertical-align: inherit;">多分誰かも便利になるでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読んでくれてありがとう。</font><font style="vertical-align: inherit;">私は初めてHabrについて書きます。</font><font style="vertical-align: inherit;">コメントでお会いしましょう。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja498378/index.html">アジャイルによるスラムのイブニングスクールのお知らせ</a></li>
<li><a href="../ja498380/index.html">動作中のオーバートンのウィンドウ：パンデミックを使用して私たちの自由を制限する方法</a></li>
<li><a href="../ja498390/index.html">IAR + Clion =友情</a></li>
<li><a href="../ja498392/index.html">18のGitLab機能がオープンソースに</a></li>
<li><a href="../ja498394/index.html">Screaming FrogとNetpeak Spiderの7つの無料アナログ</a></li>
<li><a href="../ja498398/index.html">KOMPAS開発者-デザイナーまたはプログラマー？</a></li>
<li><a href="../ja498402/index.html">ブドウ糖とそれを一緒に食べるもの</a></li>
<li><a href="../ja498404/index.html">ビデオ会議は簡単で無料です</a></li>
<li><a href="../ja498406/index.html">優秀な若いプログラマーの個性がどのように破壊されたか</a></li>
<li><a href="../ja498410/index.html">PC用VivaldiおよびAndroid用Vivaldi-スコア3.0のチームゲーム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>