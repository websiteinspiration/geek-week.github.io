<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🎨 🏴󠁧󠁢󠁥󠁮󠁧󠁿 🤘🏼 Damn old CRM ⛅️ 🤸🏾 🖖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All last year, our guys finished CRM 2.0 with BPMS Camunda and only ten processes instead of hundreds of statuses, and then tried to roll it out to us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Damn old CRM</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skyeng/blog/501508/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All last year, our guys finished CRM 2.0 with BPMS Camunda and only ten processes instead of hundreds of statuses, and then tried to roll it out to users and services without dropping anything. I hope that after finally cutting out the first tcm-ku (the oldest part of all Skyeng) from our ecosystem, they will share the rake and finds here. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xb/l2/tx/xbl2txmfq3_tqyihpdzi6jm-i-k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the meantime, having become interested in the topic, I found a similar case - and decided to ask Dmitry Kosov from Finam about their experience of abandoning the heritage of the early 2010s.</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , I’m the same </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Seryozha from Bryansk”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> who decided to pump up development knowledge by blogging and screencasts on PHP. </font><font style="vertical-align: inherit;">This year I want to add a podcast to my activities: invite industry colleagues to it. </font><font style="vertical-align: inherit;">In the first episode, the story of the move from the first Zend to Symfony. </font><font style="vertical-align: inherit;">If you want more technical details, also check out </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima’s talk on Youtube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Well, in our discussion after the report you will know:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how not to lose and find motivation, if you understand that it’s a whole year before launching your code on production,</font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">why any documentation if it’s not lying, it’s lying,</font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and how the process of two-year refactoring is organized without stopping the production of features using the example of a real project and team.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enjoy reading or listening</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://w.soundcloud.com/player/" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What frameworks were chosen between 2011? </font><font style="vertical-align: inherit;">And how to choose a new one in 2016</font></font><br>
</h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima, Finam:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I specifically looked, preparing for release: we have exactly 4,600 files in the daddy, where exactly our code is not vendor, not any js. </font><font style="vertical-align: inherit;">This daddy weighs 16 meters. </font><font style="vertical-align: inherit;">And the first commit we would have made already in December 2011, - its author is still working, this is our team leader. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, the stack was selected correctly. </font><font style="vertical-align: inherit;">And even in 2012, it was quite modern - the first Zend was quite relevant. </font><font style="vertical-align: inherit;">I then worked at another job, but I remember that just in the 12th somewhere in the late spring, we chose the stack for a new project. </font><font style="vertical-align: inherit;">We looked at:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zend - the second one just came out, but was too young, there was no community for him,</font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first Yii - but we didn’t like the ActiveRecord concept, </font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phalcon, </font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and something else from exotic. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And they also chose the first Zend. </font><font style="vertical-align: inherit;">At that moment it was a good, relevant choice. </font><font style="vertical-align: inherit;">But the tongue went forward. </font><font style="vertical-align: inherit;">But you want to use normal namespaces, rather than naming classes through underscores. </font><font style="vertical-align: inherit;">I would like to connect some ready-made libraries from open source, which, of course, no one writes under the first Zend. </font><font style="vertical-align: inherit;">I would like to attract employees to the team - a couple of times when we were looking for new people, for some it was written directly on the face: “I won’t take it”. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ultimately, the first Zend simply stopped supporting it. </font><font style="vertical-align: inherit;">For example, at 7.0 they still released a security update patch, and we patched 7.2 and 7.3 ourselves.</font></font><br>
<br>
<h3><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We pulled a little with the beginning of the relocation process.</font></font></i></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There was no global risk - we just looked at what is modern, relevant. </font><font style="vertical-align: inherit;">Compared with that on other projects: we are not the only PHP team in the company. </font><font style="vertical-align: inherit;">We realized that Symfony was happy with everyone - it looked like a project that will live for a number of years, has an extensive community, a lot of ready-made libraries, new utilities, and so on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I started this business - I was digging in the first moments just for moving, on the movement towards Symfony. </font><font style="vertical-align: inherit;">When I arrived, I was immersed in different parts of the project so that I could get to know it as widely as possible - and by the time large-scale refactoring began, I knew it well enough. </font><font style="vertical-align: inherit;">And another comrade came after we started. </font><font style="vertical-align: inherit;">We immersed him in the process - but tried not to scare him much. </font><font style="vertical-align: inherit;">At least at the beginning)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OK. </font><font style="vertical-align: inherit;">We have chosen a framework. </font><font style="vertical-align: inherit;">What's next?</font></font></h2><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seryozha, Skyeng:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are two ways - you can rewrite everything at once. </font><font style="vertical-align: inherit;">You can try to slowly drag and drop. </font><font style="vertical-align: inherit;">Where did you start? </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima, Finam:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We started with the holivar, which way to go. </font><font style="vertical-align: inherit;">No one has had the experience of rewriting such a volume. </font><font style="vertical-align: inherit;">For example, from my previous job I had experience rewriting a small autonomous service - there we just froze development for a month, rewrote everything and went on. </font><font style="vertical-align: inherit;">Here we would not have been enough for a year. </font><font style="vertical-align: inherit;">Maybe we would have managed to make 80 percent in a year, but, you know ...</font></font><br>
<br>
<h3><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a principle: the first 80% of the work takes 80% of the time. </font><font style="vertical-align: inherit;">The remaining 20% ​​of the work will take another 80% of the time.</font></font></i></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was impossible to stop the application and its current tasks. And there are exactly two concepts for this case: either you are doing something with the current application, or you are deploying a new one. We dismissed the option of deploying a new one - because there is a lot of code. As a result, we deployed the Symfony application not near our old one, but on top of it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But why so. </font><font style="vertical-align: inherit;">We have more than 250 tables in the database, and if you remove some service plates, these are about 200 entities. </font><font style="vertical-align: inherit;">They are quite strongly connected with each other and due to this number of connections it is very difficult to beat the code into some autonomous logical pieces. </font><font style="vertical-align: inherit;">Do not break it, anyway, a connection will stick out of this piece: for example, calls and telephony are connected with managers and clients. </font><font style="vertical-align: inherit;">Therefore, we realized: if you deploy a new application, start writing new features for it, and slowly transferring old ones, this will result in double work. </font><font style="vertical-align: inherit;">After all, the code that we will transfer to the new application cannot be completely cut out from the old. </font><font style="vertical-align: inherit;">And we will have to support him in two places.</font></font><br>
<br>
<h3><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then we remembered another experience that our team already had.</font></font></i></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the experience of rewriting a layer to access data. Because once upon a time, along with the first Zend, Mongo was chosen as the main database. But practice has shown that the choice is not very correct. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seryozha, Skyeng:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yes, you have all the relational connections, but you have chosen a document-oriented database. </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima, Finam:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Yes, and when I arrived, the guys were just in the process of copying from Mongo to PostgreSQL ... And we got the idea that we have a data access layer. And since we already know how to rewrite layers for data access, maybe we will take it a little wider from it and immediately grab the ORM layer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you imagine the application as such a pie, there will be 5 layers: ORM, data access, business logic, controller, views. </font><font style="vertical-align: inherit;">And we can touch 2.5 layers - completely change ORM and access to data, plus partially - business logic. </font><font style="vertical-align: inherit;">Not the algorithms themselves, but those classes and objects with which these algorithms work. </font><font style="vertical-align: inherit;">I clearly knew that it is possible to digest the doctrine separately, well, I did it.</font></font><br>
<br>
<h3><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So I got into our bootstrap, initialized the doctrine there, prescribed all the necessary settings - and gave the guys a code review with the words: “Well, someone should have started this.”</font></font></i></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The beginning of the path may look something like this. </font><font style="vertical-align: inherit;">And then we applied the principle that a mammoth should be eaten in parts. </font><font style="vertical-align: inherit;">Sometimes the pieces turned out to be more than we thought, but the basic task of the two-week sprint was to take one move - and we made sure that there were no feature tasks in the same area.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I caught bugs, rolled back, rolled out</font></font></h2><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seryozha, Skyeng:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Still, refactoring is a crucial thing, how did you insure yourself? </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima, Finam:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We have a number of unit tests - they cover key points. </font><font style="vertical-align: inherit;">There are a number of functional tests automated by our tester. </font><font style="vertical-align: inherit;">The main job of CRM is working with data. </font><font style="vertical-align: inherit;">And to test without data, with unit tests it’s not always possible: it’s easier to send a package, check that it is processed normally, that an entity with the necessary parameters was created on it.</font></font><br>
<br>
<h3><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturally, we checked a lot with our hands: especially some key and important things, like the same clients and calls.</font></font></i></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I remember well how I did this task. I called our head of the call center, and we agreed that when they run out of work and only the attendant remains, I will give my best, and the attendant will check everything on real calls. I gave my best, watched in the logs, caught a bunch of bugs, rolled away, ruled them, warned the attendant, rolled out, again caught the next bundle, rolled back ... And so a few iterations. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seryozha, Skyeng:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Having </font><b><font style="vertical-align: inherit;">gone</font></b><font style="vertical-align: inherit;"> all the way, but now it’s probably more than half the way, what would you advise then? </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dima, Finam:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would probably advise deploying the same Symfony application on top of ours a little earlier. To make sure that what we write, what we do, it really works. I remember how we deployed it, launched it first from the console, then from the controller, knocked on our layer of business logic - and made sure that the application sees it, can access all services, pull all methods, unload the results. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I just realized how strong a motivator was the realization that we really wrote everything correctly. To check that you are going in the right direction, to make sure that you are doing everything correctly, should be done early.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not at the first steps, but when you already have something written, take it like this, shoot for a year in advance, organize such a local time machine, make sure that you are doing everything right - this will give you strength. </font><font style="vertical-align: inherit;">And you will go further.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks for reading and listening. </font><font style="vertical-align: inherit;">More PHP podcasts can be found </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And if you want more interesting reports and conversations around them, "come" to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">third virtual PHP-meeting</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on May 30.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501496/index.html">Comet Lake, completion of the iteration</a></li>
<li><a href="../en501498/index.html">How much C ++ code needs to be written to parse the Authorization HTTP header using easy_parser from RESTinio?</a></li>
<li><a href="../en501500/index.html">Visual hack: what threatens and how to protect yourself from spying</a></li>
<li><a href="../en501502/index.html">New Lab Digital Synthesis Continues Harris Book and Helps Make FPGA Video Game</a></li>
<li><a href="../en501506/index.html">About GDI leaks and the importance of luck</a></li>
<li><a href="../en501510/index.html">A new look at Fullstack development with the Ruby on Rails framework</a></li>
<li><a href="../en501516/index.html">Let's turn off the vacuum ?! Alexey Lesovsky</a></li>
<li><a href="../en501520/index.html">C # 8 and null validity. How do we live with this</a></li>
<li><a href="../en501522/index.html">Free Skillbox Webinars: Writing Games in PHP, Unity and Unreal Engine</a></li>
<li><a href="../en501524/index.html">Secrets of synchronizing the electromagnetic fields of the Earth and a living organism</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>