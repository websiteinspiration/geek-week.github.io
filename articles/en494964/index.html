<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍✈️ 👍🏿 ⛎ Neural networks and trading. Practical implementation 😽 🚞 🎟️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The trading fashion is experiencing ups and downs along with the Bitcoin exchange rate. Now this topic is at a low point after incredible growth in 20...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Neural networks and trading. Practical implementation</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494964/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The trading fashion is experiencing ups and downs along with the Bitcoin exchange rate. Now this topic is at a low point after incredible growth in 2018. Many during this time managed to get acquainted with crypto-exchanges - they delved into the topic, studied, traded, lost money, and even sometimes earned. As a result, the fashion passed, but the experience remained, albeit negative. The words “long”, “short”, “spread”, “diver” can be heard from those from whom you certainly do not expect this. But not only the “hands” trade attracted attention, there are also trading bots. What do we have in this area, what is the experience of the last 2-3 years talking about?</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, there is nothing good in this area either. There are many tools for writing trading bots, but there are no stably profitable strategies. In the best case, a working solution needs to be constantly serviced by a pair of trader-programmer changing settings for the current market. The standard result after connecting a fully autonomous bot to the deposit is to drain the deposit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last hope remains - neural networks. This certainly should happen, because the neural network learns as a person and adapts itself to the market. How are you doing in this area? Well ... you guessed it. Everything is bad, there are many conversations, but there are no working solutions. Everything is very bad! A vivid example of this is the MQL5 community application store. Behind the MQL5 brand is a professional trading platform - MetaTrader5 plus a huge community of traders and programmers. So in this store there is a section for solutions based on neural networks, there are many bots, but not a single real one. Adding a bot using a neural network is prohibited by the rules. It's hard to believe, but it is. The ban on connecting an external API excludes the possibility of using neural networks, and the tools built into MQL5 do not work in practice. I discussed this issue with MQL5 tech support,I didn’t receive a clear answer. As a result, there is nothing really working out of the box on the market, the solutions from the “teach yourself” series laid out on the github are not taken into account.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Okay, I’m finishing with the introduction, I’m getting down to business. I managed to train a neural network, there are worthy results in the real market. Further without going into details, I will describe how this was done.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first and main mistake of everyone who is trying to teach the neural network to trade is the trading thinking about the market. Usually, a trader tries to implement a solution based on neural networks together with a programmer who previously wrote bots. The trading bot algorithm solves the problem of finding the correct entry point to the position and determining the “take” and “stop”. If you have this task in mind when designing a neural network, then nothing will work. You can endlessly sort out ingenious options for input data, apply or not give indicators, try different types of neural networks, substitute crutches as training only in certain areas, or train showing only known patterns. Will not work.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With a neural network, you need to look like a child, look at the world through her eyes and start with simple tasks. The simplest question that can be asked is “where will the price go through X candles, up or down?”. It doesn’t matter how much the price changes and it doesn’t matter that the answer cannot be turned into a trading strategy. We forget about trading, now the main task is to educate the network at least something, just get the right answer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had this initial task solved after 100,500 input selections. </font><font style="vertical-align: inherit;">Used TensoFlow plus Keras, a network of Sequental Dense. </font><font style="vertical-align: inherit;">Input dataset for 200-300 thousand examples, input vector 250-350 feature. </font><font style="vertical-align: inherit;">The form of the answer follows from the posed network of the question — the binary classification “up” or “down”. </font><font style="vertical-align: inherit;">The input was prepared by the bot in MQL5. </font><font style="vertical-align: inherit;">A bot running through a story forms a regular csv file, each line is a vector. </font><font style="vertical-align: inherit;">At the end of each vector, the correct answer is 1: 0 if up, 0: 1 if down. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are some suggestions for those who try:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">He studies well within the forecast from 15 minutes to 60 minutes. </font><font style="vertical-align: inherit;">At a shorter period, the chaos of the price movement grows, at a larger period the external influence increases - news and so on, 15-60 minutes the most “technical” zone.</font></font></li>
<li>     BTCUSD,    EURUSD.   —  .</li>
<li>     «     ?     ?».          ,   .</li>
<li>               ,   50%  .   ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to understand what material we are dealing with. The market is 95% chaos. When we submit training data to the network and indicate the correct answer, we are actually feeding it chaos. It’s like trying to train a neural network to distinguish a cat from a dog, and on training to show it butterflies, stars and zodiac signs, there will be no result. So it is here, but, fortunately, the market gives about 5% of the really working patterns that the network can catch and this will be reflected in its answers. Therefore, pay attention to the analysis of test results. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using this approach, I got the following result:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
in about 2% of the answers, the network guesses the further movement in the ratio of 2 correct answers to 1 incorrect. When testing in the real market, this is exactly what happens, but another problem arises. After all, we have only 2% of the questions answered, ignore the rest. Those. We launch a neuro in the real market on a timeframe of 5 minutes and wait ... at 2% - it’s only every 50th candle will be answered, one answer in 4 hours! And what to do with it? Well, if the answer was “buy / sell”, then 6 transactions a day is normal, and here the abstract “up / down” and then inaccurate, complete disappointment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, I solved this problem relatively easily - just every 5 minutes you need to interview not one model, but 20-30 models, as a result of answers there will be enough. Models are trained on different input data and, accordingly, are trained on different patterns. In practice, it turns out that the models honk on different candles, activating together only in obvious, predictable places and do not overlap each other. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To summarize, now there is something that can be launched in the real market and have up / down signals with average mining. Already more fun, but the practical sense is still zero.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A few words about the implementation. It worked for me on a bunch of MQL5 plus Keras. A bot launched in MetaTrader5 on each candlestick prepared data for a neural network and passed through a socket to a python script, which in turn polled all models and, when it passed an acceptable threshold, sent a signal to the Telegram channel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the circuit works, but cannot be applied. It was not possible to add signals to some strategy. The main drawback is the discreteness of the answers. The answer is an event that you need to somehow react to - look at the market situation, think whether the network is right or not, etc. On one candle, one model could signal up, and another down, and which one to believe? As a result, the idea was born to abandon the threshold for passing the answer, and to begin to respect each answer of the network, albeit with a low degree of confidence. If you start to average all the answers into a single common opinion and consider this as a network response, then the answer becomes a completely different quality. In this case, the knowledge of all models begins to take shape, and this is a huge amount of joint training.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Whether it was long, short, but after all the alterations, I began to receive uniform responses of the neural network for each candle, expressed as a percentage of the expected working time from -100% to + 100%. The sign reflects the expected up / down direction. It became clear that now there is a sense in every answer. It works! I myself have trading experience and saw how the behavior of the network in front of my eyes became meaningful. Sometimes its logic was understandable, sometimes it wasn’t, but its answers always felt its own, often paradoxical, vision of the market. In addition to this, it turned out that the higher the network confidence, the closer the expected development to the right time and vice versa. Low confidence seemed to say "what will happen in 15 minutes I don’t know, but the general trend is up."</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From this place, I realized that trying to formalize all this into buy / sell signals is like hammering nails with a microscope. What was needed was some kind of tool for visualizing the signals of the neural network — a graphic display of the level of “confidence” on each candle. A wide range of MQL5 tools made it possible to put all this into Expert for MetaTrader5. "Expert" through the API receives the responses of the neural network and is engaged only in rendering. Here is an example of his work on BTCUSD M1: The </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/8c5/976/ce2/8c5976ce22fbaa03814683028e479a8f.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
colored area at the top is the forecast “down”, the area below is the forecast “up”, the thickness is the degree of confidence. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At this stage, the quality of the forecast does not matter, it is important that the neural network demonstrates a quite adequate opinion about the market situation. You can always upgrade the network even more, the main thing is that it works!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, today there is Expert for MetaTrader5 with two types of forecasts - short-term and long-term. </font><font style="vertical-align: inherit;">Statistics are gradually accumulating, there is feedback from traders. </font><font style="vertical-align: inherit;">The result obtained inspires further work, now we need to get to the cherished "buy / sell" teams. </font><font style="vertical-align: inherit;">This can be done by significantly increasing the quality of the forecast. </font><font style="vertical-align: inherit;">Then I see this development path:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is necessary to prepare a dozen forecasts in the interval between 15 and 60 minutes. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">start predicting “up / down” for 20, 25, 30, 35 minutes and so on up to 60. Each forecast, I recall, is built from the answers of about 20 models.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Having such a volume of information on each minute candle, it is possible and necessary to analyze it with another neural network. </font><font style="vertical-align: inherit;">The connection between forecasts at different time intervals can be completely nontrivial, therefore, a neural network here will be appropriate.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The dataset for this neural network will not be as noisy as that of its younger comrades, therefore, it must be trained not in a banal “up / down”, but in predicting the strength of an asset’s movement, and this is a direct exit to “buy / sell”.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all I wanted to tell you today. </font><font style="vertical-align: inherit;">Work continues, I think there will be more articles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, this Expert for MetaTrader5 is distributed free of charge, if you want to see the work of a neural network in the real market, please contact.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en494940/index.html">DevOps - what is it, why, and how much is it in demand?</a></li>
<li><a href="../en494942/index.html">CGI at home with Unreal Engine and iPhone</a></li>
<li><a href="../en494948/index.html">Create a VIP mailbox in Zimbra Collaboration Open-Source Edition</a></li>
<li><a href="../en494950/index.html">Some storage trends to look out for</a></li>
<li><a href="../en494956/index.html">Data Byte Life</a></li>
<li><a href="../en494966/index.html">SCRUM: a poem about love and pain</a></li>
<li><a href="../en494968/index.html">Underwater Internet Cables: Who Routes Them</a></li>
<li><a href="../en494970/index.html">Introversion: randomness within the margin of error, or evolutionary mechanism of species conservation?</a></li>
<li><a href="../en494972/index.html">SEMrush vs SimilarWeb - who is more accurate?</a></li>
<li><a href="../en494978/index.html">What is Windows PowerShell and what does it eat? Part 4: Working with objects, custom classes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>