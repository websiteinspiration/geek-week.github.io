<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—½ ğŸš† ğŸ‘©ğŸ¿â€ğŸ­ Top Fakapov Cyan ğŸ™ï¸ ğŸ° ğŸ—¨ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gut zu allen!Â 
 
 Mein Name ist Nikita, ich bin Teamleiter der Cyan-Ingenieure. Eine meiner Aufgaben im Unternehmen ist es, die Anzahl der VorfÃ¤lle im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Top Fakapov Cyan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cian/blog/499542/"><img src="https://habrastorage.org/webt/zy/iu/-q/zyiu-qkcptbeezgf_c5adiagete.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gut zu allen!&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Name ist Nikita, ich bin Teamleiter der Cyan-Ingenieure. </font><font style="vertical-align: inherit;">Eine meiner Aufgaben im Unternehmen ist es, die Anzahl der VorfÃ¤lle im Zusammenhang mit der Infrastruktur auf dem Produkt auf Null zu reduzieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was spÃ¤ter besprochen wird, hat uns viel Schmerz bereitet, und der Zweck dieses Artikels ist es, andere Menschen daran zu hindern, unsere Fehler zu wiederholen oder zumindest ihre Auswirkungen zu minimieren.&nbsp;</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrÃ¤ambel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war einmal, als Cyan aus Monolithen bestand und es noch keine Hinweise auf Mikrodienste gab. Wir haben die VerfÃ¼gbarkeit der Ressource durch ÃœberprÃ¼fen von 3-5 Seiten gemessen.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antwort - alles ist in Ordnung, antworten Sie nicht lange - Alarm. </font><font style="vertical-align: inherit;">Wie viel Zeit sie nicht arbeiten sollten, damit dies als Vorfall betrachtet wird, entschieden die Leute bei Besprechungen. </font><font style="vertical-align: inherit;">Ein Team von Ingenieuren war immer an der Untersuchung des Vorfalls beteiligt. </font><font style="vertical-align: inherit;">Als die Untersuchung abgeschlossen war, schrieben sie eine Obduktion - eine Art Bericht an die Post in dem Format: Was war, wie lange, was wurde im Moment getan, was wird in Zukunft getan werden.&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Hauptseiten der Website oder wie wir es verstehen, haben den Boden gebrochen</font></font></h3>&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die PrioritÃ¤t des Fehlers irgendwie zu verstehen, haben wir die wichtigsten Seiten der Website fÃ¼r die GeschÃ¤ftsfunktionalitÃ¤t hervorgehoben. </font><font style="vertical-align: inherit;">Demnach berÃ¼cksichtigen wir die Anzahl erfolgreicher / erfolgloser Anfragen und Timeouts. </font><font style="vertical-align: inherit;">Also messen wir die Betriebszeit.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nehmen wir an, wir finden heraus, dass es eine Reihe sehr wichtiger Bereiche auf der Website gibt, die fÃ¼r den Hauptdienst verantwortlich sind - die Suche und Einreichung von AnkÃ¼ndigungen. </font><font style="vertical-align: inherit;">Wenn die Anzahl der fehlgeschlagenen Anforderungen mehr als 1% betrÃ¤gt, ist dies ein kritischer Vorfall. </font><font style="vertical-align: inherit;">Wenn der Prozentsatz der Fehler innerhalb von 15 Minuten zur Hauptsendezeit 0,1% Ã¼berschreitet, wird dies ebenfalls als kritischer Vorfall angesehen. </font><font style="vertical-align: inherit;">Diese Kriterien decken die meisten VorfÃ¤lle ab, der Rest geht Ã¼ber den Rahmen dieses Artikels hinaus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ot/mw/k9/otmwk90qyl-jcomorjhkofebrgq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Top besten Cyan VorfÃ¤lle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben also genau gelernt, festzustellen, dass der Vorfall passiert ist.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wird jeder Vorfall in unserem Land detailliert beschrieben und im Jira-Epos widergespiegelt. </font><font style="vertical-align: inherit;">Ãœbrigens: DafÃ¼r haben wir ein separates Projekt namens FAIL gestartet - darin kÃ¶nnen nur Epen erstellt werden.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie alle Fehler der letzten Jahre sammeln, sind die FÃ¼hrer:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mssql-bezogene VorfÃ¤lle;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VorfÃ¤lle durch externe Faktoren;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Admin-Fehler.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns nÃ¤her auf die Fehler von Admins sowie auf einige andere interessante Fehler eingehen.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FÃ¼nfter Platz - "Bestellung im DNS aufgeben"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es war ein regnerischer Dienstag. Wir haben beschlossen, den DNS-Cluster zu bereinigen.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich wollte die internen DNS-Server von bind auf powerdns Ã¼bertragen und dabei vÃ¶llig separate Server hervorheben, auf denen es auÃŸer DNS nichts gibt.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben an jedem Standort unserer DomÃ¤nencontroller einen DNS-Server platziert, und der Moment kam, als die Zonen von Bind zu PowerDNS verschoben und die Infrastruktur auf neue Server umgestellt wurden.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem HÃ¶hepunkt des Umzugs befand sich von allen Servern, die in der lokalen Caching-Bindung auf allen Servern angegeben waren, nur einer im Rechenzentrum in St. Petersburg. Dieser DC wurde ursprÃ¼nglich fÃ¼r uns als unkritisch deklariert, wurde aber plÃ¶tzlich zu einem einzigen Fehlerpunkt.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerade wÃ¤hrend einer solchen Umsiedlungsperiode fiel der Kanal zwischen Moskau und St. Petersburg. </font><font style="vertical-align: inherit;">Wir blieben tatsÃ¤chlich fÃ¼nf Minuten ohne DNS und standen auf, als der Hoster die Probleme behebte.&nbsp;</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlussfolgerungen:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wenn wir bei der Vorbereitung der Arbeit frÃ¼her externe Faktoren vernachlÃ¤ssigt haben, sind diese jetzt auch in der Liste der Vorbereitungen enthalten. </font><font style="vertical-align: inherit;">Und jetzt bemÃ¼hen wir uns sicherzustellen, dass alle Komponenten n-2 reserviert sind, und fÃ¼r die Dauer der Arbeit kÃ¶nnen wir dieses Niveau auf n-1 senken.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Markieren Sie bei der Erstellung eines Aktionsplans die Punkte, an denen der Dienst mÃ¶glicherweise ausfÃ¤llt, und Ã¼berlegen Sie sich im Voraus das Szenario, in dem alles â€schlimmer als nirgendwoâ€œ gelaufen ist.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verteilen Sie interne DNS-Server nach verschiedenen Standorten / Rechenzentren / Racks / Switches / EingÃ¤ngen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legen Sie auf jedem Server einen lokalen DNS-Caching-Server ab, der Anforderungen an die wichtigsten DNS-Server umleitet. Wenn dieser nicht verfÃ¼gbar ist, antwortet er aus dem Cache.&nbsp;</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vierter Platz - "Nginx aufrÃ¤umen"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines schÃ¶nen Tages entschied unser Team, dass â€genug, um es auszuhaltenâ€œ, und der Prozess der Umgestaltung von Nginx-Konfigurationen begann. </font><font style="vertical-align: inherit;">Das Hauptziel ist es, Konfigurationen in eine intuitive Struktur zu bringen. </font><font style="vertical-align: inherit;">Zuvor war alles â€historisch etabliertâ€œ und es gab keine Logik an sich. </font><font style="vertical-align: inherit;">Jetzt wurde jeder Servername in die gleichnamige Datei aufgenommen und alle Konfigurationen in Ordnern verteilt. </font><font style="vertical-align: inherit;">Die Konfiguration enthÃ¤lt Ã¼brigens 253949 Zeilen oder 7836520 Zeichen und nimmt fast 7 Megabyte ein. </font><font style="vertical-align: inherit;">Struktur der obersten Ebene:&nbsp;</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nginx-Struktur</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">â”œâ”€â”€ access<font></font>
â”‚ &nbsp; â”œâ”€â”€ allow.list<font></font>
...<font></font>
â”‚ &nbsp; â””â”€â”€ whitelist.conf<font></font>
â”œâ”€â”€ geobase<font></font>
â”‚ &nbsp; â”œâ”€â”€ exclude.conf<font></font>
...<font></font>
â”‚ &nbsp; â””â”€â”€ geo_ip_to_region_id.conf<font></font>
â”œâ”€â”€ geodb<font></font>
â”‚ &nbsp; â”œâ”€â”€ GeoIP.dat<font></font>
â”‚ &nbsp; â”œâ”€â”€ GeoIP2-Country.mmdb<font></font>
â”‚ &nbsp; â””â”€â”€ GeoLiteCity.dat<font></font>
â”œâ”€â”€ inc<font></font>
â”‚ &nbsp; â”œâ”€â”€ error.inc<font></font>
...<font></font>
â”‚ &nbsp; â””â”€â”€ proxy.inc<font></font>
â”œâ”€â”€ lists.d<font></font>
â”‚ &nbsp; â”œâ”€â”€ bot.conf<font></font>
...<font></font>
â”‚ &nbsp; â”œâ”€â”€ dynamic<font></font>
â”‚ &nbsp; â””â”€â”€ geo.conf<font></font>
â”œâ”€â”€ lua<font></font>
â”‚ &nbsp; â”œâ”€â”€ cookie.lua<font></font>
â”‚ &nbsp; â”œâ”€â”€ log<font></font>
â”‚ &nbsp; â”‚ &nbsp; â””â”€â”€ log.lua<font></font>
â”‚ &nbsp; â”œâ”€â”€ logics<font></font>
â”‚ &nbsp; â”‚ &nbsp; â”œâ”€â”€ include.lua<font></font>
â”‚ &nbsp; â”‚ &nbsp; â”œâ”€â”€ ...<font></font>
â”‚ &nbsp; â”‚ &nbsp; â””â”€â”€ utils.lua<font></font>
â”‚ &nbsp; â””â”€â”€ prom<font></font>
â”‚ &nbsp; &nbsp; &nbsp; â”œâ”€â”€ stats.lua<font></font>
â”‚ &nbsp; &nbsp; &nbsp; â””â”€â”€ stats_prometheus.lua<font></font>
â”œâ”€â”€ map.d<font></font>
â”‚ &nbsp; â”œâ”€â”€ access.conf<font></font>
â”‚ &nbsp; â”œâ”€â”€ ..&nbsp;<font></font>
â”‚ &nbsp; â””â”€â”€ zones.conf<font></font>
â”œâ”€â”€ nginx.conf<font></font>
â”œâ”€â”€ robots.txt<font></font>
â”œâ”€â”€ server.d<font></font>
â”‚ &nbsp; â”œâ”€â”€ cian.ru<font></font>
â”‚ &nbsp; â”‚ &nbsp; â”œâ”€â”€ cian.ru.conf<font></font>
â”‚ &nbsp; â”‚ &nbsp; â”œâ”€â”€ ...<font></font>
â”‚ &nbsp; â”‚ &nbsp; â””â”€â”€ my.cian.ru.conf<font></font>
â”œâ”€â”€ service.d<font></font>
â”‚ &nbsp; â”œâ”€â”€ ...<font></font>
â”‚ &nbsp; â””â”€â”€ status.conf<font></font>
â””â”€â”€ upstream.d<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€ cian-mcs.conf<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€ ...<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ wafserver.conf</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde viel besser, aber beim Umbenennen und Verteilen der Konfigurationen hatten einige von ihnen die falsche Erweiterung und fielen nicht in die include * .conf-Direktive. </font><font style="vertical-align: inherit;">Infolgedessen war ein Teil der Hosts nicht mehr verfÃ¼gbar und gab 301 an den Haupt-Host zurÃ¼ck. </font><font style="vertical-align: inherit;">Aufgrund der Tatsache, dass der Antwortcode nicht 5xx / 4xx war, wurde dies nicht sofort bemerkt, sondern nur am Morgen. </font><font style="vertical-align: inherit;">Danach haben wir begonnen, Tests zum Testen von Infrastrukturkomponenten zu schreiben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse:</font></font></b>&nbsp;<br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strukturieren Sie Konfigurationen richtig (nicht nur Nginx) und denken Sie in einem frÃ¼hen Stadium des Projekts Ã¼ber die Struktur nach. </font><font style="vertical-align: inherit;">So machen Sie sie fÃ¼r das Team verstÃ¤ndlicher, was wiederum die TTM verringert.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie fÃ¼r einige Infrastrukturkomponenten Tests. </font><font style="vertical-align: inherit;">Beispiel: ÃœberprÃ¼fen Sie, ob alle wichtigen Servernamen den richtigen Status + Antworttext zurÃ¼ckgeben. </font><font style="vertical-align: inherit;">Es reicht aus, nur ein paar Skripte zur Hand zu haben, die die Grundfunktionen der Komponente Ã¼berprÃ¼fen, damit Sie sich nicht um 3 Uhr morgens daran erinnern, was noch Ã¼berprÃ¼ft werden muss.&nbsp;</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dritter Platz - "PlÃ¶tzlich beendeter Platz in Cassandra"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Daten wuchsen stetig und alles war in Ordnung, bis die Reparatur groÃŸer FÃ¤lle in den Cassandra-Cluster fiel, weil die Komprimierung nicht funktionieren konnte.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An einem regnerischen Tag verwandelte sich der Haufen fast in einen KÃ¼rbis, nÃ¤mlich:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlÃ¤tze blieben etwa 20% des gesamten Clusters;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist unmÃ¶glich, Knoten vollstÃ¤ndig hinzuzufÃ¼gen, da die Bereinigung nach dem HinzufÃ¼gen eines Knotens aufgrund von Platzmangel auf Partitionen nicht funktioniert.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Leistung nimmt leicht ab, da die Verdichtung nicht funktioniert.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Cluster befindet sich im Notfallmodus.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/lp/ah/ie/lpahie7bann64sajoibumpqbr5g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beenden - fÃ¼gte weitere 5 Knoten ohne Bereinigung hinzu. Danach wurden sie systematisch aus dem Cluster entfernt und als leere Knoten, auf denen der Ort endete, erneut eingegeben. </font><font style="vertical-align: inherit;">Die Zeit verbrachte viel mehr als wir mÃ¶chten. </font><font style="vertical-align: inherit;">Es bestand die Gefahr einer teilweisen oder vollstÃ¤ndigen UnzugÃ¤nglichkeit des Clusters.&nbsp;</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle Cassandra-Server sollten nicht mehr als 60% des Speicherplatzes auf jeder Partition einnehmen.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sollten nicht mehr als 50% CPU geladen sein.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verstopfen Sie nicht die KapazitÃ¤tsplanung und denken Sie fÃ¼r jede Komponente anhand ihrer Besonderheiten nach.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je mehr Knoten im Cluster vorhanden sind, desto besser. </font><font style="vertical-align: inherit;">Server mit einer geringen Datenmenge werden schneller migriert, und ein solcher Cluster lÃ¤sst sich leichter wiederbeleben.&nbsp;</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweiter Platz - â€Daten aus dem SchlÃ¼sselwertspeicher des Konsuls sind verschwundenâ€œ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ¼r die Serviceerkennung verwenden wir, wie viele andere auch, den Konsul. Hier wird sein SchlÃ¼sselwert aber auch fÃ¼r blau-grÃ¼ne Monolithenberechnungen verwendet. Es speichert Informationen zu aktiven und inaktiven Upstreams, die wÃ¤hrend der Bereitstellung die Position wechseln. Zu diesem Zweck wurde ein Bereitstellungsdienst geschrieben, der mit KV interagierte. Irgendwann verschwanden die Daten von KV. Aus dem Speicher wiederhergestellt, jedoch mit einer Reihe von Fehlern. Infolgedessen war die Last im Upstream wÃ¤hrend der Berechnung ungleichmÃ¤ÃŸig verteilt, und wir haben viele 502 Fehler aufgrund der Ãœberlastung der Backends auf der CPU erhalten. Infolgedessen sind wir vom Konsul KV zu Postgres gewechselt, von wo aus es nicht so einfach ist, sie zu entfernen.&nbsp;&nbsp; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse:</font></font><br>
</b><br>
<ul>
<li>  -           . ,       ES â€”        ,    ,   ,    action.destructive_requires_name: true.</li>
<li>      . ,    ( , &nbsp;python),      .</li>
</ul><br>
<h4>  â€” Â« Â»&nbsp;</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendwann stellten wir eine ungleichmÃ¤ÃŸige Lastverteilung auf dem Nginx-Upstream fest, wenn sich im Backend mehr als 10 Server befanden. Aufgrund der Tatsache, dass Round-Robin Anfragen von 1 bis zum letzten Upstream in der richtigen Reihenfolge sendete und jedes Nginx-Reload von Anfang an begann, hatte der erste Upstream immer mehr Anfragen als der Rest. Infolgedessen arbeiteten sie langsamer und die gesamte Site litt darunter. Dies machte sich mit zunehmendem Verkehrsaufkommen bemerkbar. Nur Nginx zu aktualisieren, um Random zu aktivieren, hat nicht funktioniert - Sie mÃ¼ssen eine Reihe von Lua-Code wiederholen, der in Version 1.15 (zu diesem Zeitpunkt) nicht gestartet wurde. Ich musste unser Nginx 1.14.2 patchen und zufÃ¤llige UnterstÃ¼tzung einfÃ¼hren. Dies lÃ¶ste das Problem. Dieser Fehler gewinnt die Nominierung "Captain Non-Offensichtlichkeit". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlussfolgerungen:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es war sehr interessant und aufregend, diesen Fehler zu untersuchen.&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Richten Sie die Ãœberwachung so ein, dass solche Schwankungen schnell erkannt werden kÃ¶nnen. </font><font style="vertical-align: inherit;">Sie kÃ¶nnen beispielsweise ELK verwenden, um die RPS auf jedem Backend jedes Upstreams zu Ã¼berwachen und ihre Antwortzeit aus Sicht von Nginx zu Ã¼berwachen. </font><font style="vertical-align: inherit;">In diesem Fall hat es uns geholfen, das Problem zu identifizieren.&nbsp;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen hÃ¤tten die meisten Fehler mit einer gewissenhafteren Herangehensweise an das, was Sie tun, vermieden werden kÃ¶nnen. </font><font style="vertical-align: inherit;">Sie mÃ¼ssen sich immer an das Murphy-Gesetz erinnern:&nbsp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles, was schief gehen kann, wird schief gehen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und darauf basierende Komponenten bauen.&nbsp;</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499528/index.html">Eine "atemberaubende" mathematische BrÃ¼cke, die Ã¼ber Fermats groÃŸen Satz hinausgeht</a></li>
<li><a href="../de499532/index.html">WÃ¶rter in Zahlen: kostenlose Blog-Analyse habravebinary mit Yandex.Metrica</a></li>
<li><a href="../de499534/index.html">Entwicklungshandbuch fÃ¼r Python-Backend-Dienste</a></li>
<li><a href="../de499536/index.html">Growbox als Methode, sich selbst zu kennen</a></li>
<li><a href="../de499540/index.html">So funktioniert das Rendern von 3D-Spielen: Texturierung und Texturfilterung</a></li>
<li><a href="../de499544/index.html">Lernen Sie neuronale Netze in Google Sheets</a></li>
<li><a href="../de499546/index.html">Firmware-Entwicklung fÃ¼r eine analoge Videokamera EVR-Y2022F</a></li>
<li><a href="../de499548/index.html">Maske - FÃ¼rsorge fÃ¼r andere oder eine Illusion von Sicherheit?</a></li>
<li><a href="../de499550/index.html">Low-Code-LÃ¶sungen fÃ¼r Ã–kosysteme</a></li>
<li><a href="../de499556/index.html">Game Server auf MS Orleans - Teil 3: Zusammenfassung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>