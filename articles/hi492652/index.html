<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüé® ü§öüèΩ ü§ôüèæ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ñ‡•á‡§≤ "‡§Æ‡•Ç‡§∞‡•ç‡§ñ" ‡§¶‡•ã M5Stack ‡§™‡§∞ üåü üèø üåº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‡§™‡§æ‡§† ‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø
 

‡§Ü‡§ú ‡§π‡§Æ ‡§¶‡•ã ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ó‡•á‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§ñ‡•á‡§≤ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à? ‡§Ü‡§á‡§è ‡§è‡§ï ‡§≤‡•ã‡§ï‡§™‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ó‡•á‡§Æ "‡§´‡§º‡•Ç‡§≤" ‡§≤‡§ø‡§ñ‡•á‡§Ç, ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>‡§ï‡§æ‡§∞‡•ç‡§° ‡§ñ‡•á‡§≤ "‡§Æ‡•Ç‡§∞‡•ç‡§ñ" ‡§¶‡•ã M5Stack ‡§™‡§∞</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492652/"><h2 id="cel-uroka"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§™‡§æ‡§† ‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§Ü‡§ú ‡§π‡§Æ ‡§¶‡•ã ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ó‡•á‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á‡•§ </font><font style="vertical-align: inherit;">‡§ï‡•ç‡§Ø‡§æ ‡§ñ‡•á‡§≤ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à? </font><font style="vertical-align: inherit;">‡§Ü‡§á‡§è ‡§è‡§ï ‡§≤‡•ã‡§ï‡§™‡•ç‡§∞‡§ø‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§° ‡§ó‡•á‡§Æ "‡§´‡§º‡•Ç‡§≤" ‡§≤‡§ø‡§ñ‡•á‡§Ç, ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø ‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§°‡•ã‡§Ç ‡§∏‡•á ‡§õ‡•Å‡§ü‡§ï‡§æ‡§∞‡§æ ‡§™‡§æ‡§®‡§æ ‡§π‡•à‡•§ </font><font style="vertical-align: inherit;">‡§Ü‡§™ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§Ø‡§π‡§æ‡§Ç</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">‡§ú‡§æ‡§® ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</font></a><font style="vertical-align: inherit;"> ‡•§</font></font></p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/2bc/4b7/69d/2bc4b769db51d266ee7fc7d18e88c475.jpg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§ö‡§ø‡§§‡•ç‡§∞ 1‡•§</font></font></p><a name="habracut"></a><br>
<h2 id="nemnogo-teorii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§ ‡§ï‡•Ä ‡§¨‡§ø‡§ü</font></font></h2><br>
<p>  ‚Äî     RS-232,     ,   ,     .   "",         ,    .     RS-232,    M5STACK     TTL. </p><br>
<p>RS-232   "0"    -3  -25 ,    "1"  +3  +25 .    RS-232  TTL   "0"     0 ,    "1"    ,   3.3  5  (. 2).</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/3a1/bb0/0e0/3a1bb00e0b2c1087d74753548862a293.jpg"><br>
<em> 2.    RS-232  TTL</em></p><br>
<p>      M5STACK    / R0, R2 (RX)  T0, T2 (TX) (. 3),   USB .  ,          ,        0  1   .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/b77/313/942/b773139423c2f499729b4a8fb0676d7a.jpg"><br>
<em> 3.       </em></p><br>
<p>         Serial  Arduino IDE <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://www.arduino.cc/reference/en/language/functions/communication/serial/</a></p><br>
<p>    ASCII,        : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">https://en.wikipedia.org/wiki/ASCII</a></p><br>
<p><strong>   </strong></p><br>
<ul>
<li>M5STACK (2 .);</li>
<li> USB-C    (2 .);</li>
<li>    .</li>
</ul><br>
<h2 id="nachnyom">!</h2><br>
<h3 id="shag-1-pristupim-s-samogo-glavnogo---logotip"> 1.     ‚Äî </h3><br>
<p>   ,         .     ,  MS Office Word  Paint (. 4). </p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/98e/d89/945/98ed899458f0399d4c87143e4ed988c1.jpg"><br>
<em> 4.     MS Office Word  Paint :)</em></p><br>
<p>      1.2.1 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="http://forum.m5stack.com/topic/49/lesson-1-2-1-lcd-how-to-create-image-array" rel="nofollow">http://forum.m5stack.com/topic/49/lesson-1-2-1-lcd-how-to-create-image-array</a>         logo.c,    .</p><br>
<pre><code class="plaintext hljs">extern unsigned char logo[];</code></pre><br>
<h3 id="shag-2-sozdadim-strukturu-kolody-kart"> 2.    </h3><br>
<p>    ,   36 .  6    .     12 .    10 ,   .        ,  7.      : (    ‚Äî  ;   ;   ;   )  :  ,  ,  ,  ,  .  ,     .       (. 5).</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/2e2/fde/a75/2e2fdea75bf704448561501b453dc46b.jpg"><br>
<em> 5.      <br>
</em></p><br>
<h1 id="define-playeramount-6">define playerAmount 6</h1><br>
<pre><code class="plaintext hljs">#define fullAmount 36<font></font>
#define playerFieldAmount 10<font></font>
#define gameFieldAmount 6<font></font>
<font></font>
struct playCard<font></font>
{<font></font>
  int card;<font></font>
  int suit;<font></font>
  int color;<font></font>
  int property = -1; // -2 not avaiable, -1 free, 0 trump, 1 player #1, 2 player #2<font></font>
  int field; // + player field, - game field<font></font>
};<font></font>
<font></font>
String cards[9] = {"6", "7", "8", "9", "10", "J", "Q", "K", "A"};<font></font>
char suits[4] = {3, 4, 5, 6}; // , , , <font></font>
int colors[2] = {0xe8e4, 0x00}; // red, black<font></font>
playCard deckCards[fullAmount];</code></pre><br>
<h3 id="shag-3-napishem-pravila-igry"> 3.   </h3><br>
<p>.  1.        ,  ,              (. 5.1):</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/55d/c35/a41/55dc35a41f735f84335beda800aca546.jpg"><br>
<em> 5.1.     </em></p><br>
<pre><code class="plaintext hljs">if ((opponentSteps == playerSteps) &amp;&amp; (playerSteps == 0))<font></font>
{<font></font>
  deckCards[selectedCard].field = -1;<font></font>
  sync();<font></font>
}</code></pre><br>
<p>.  2.      ,        ,    (. 5.2)        ,          :</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/d33/dc8/b4f/d33dc8b4f3ea7163fa37cd16ccf1a232.jpg"><br>
<em> 5.1.     </em></p><br>
<pre><code class="plaintext hljs">else if (opponentSteps &gt; playerSteps)<font></font>
{<font></font>
  if ((((deckCards[selectedCard].card &gt; deckCards[pfCardId].card) &amp;&amp; (deckCards[selectedCard].suit == deckCards[pfCardId].suit)) || ((deckCards[selectedCard].suit == trumpSuit) &amp;&amp; (deckCards[pfCardId].suit != trumpSuit))))<font></font>
  {<font></font>
    deckCards[selectedCard].field = -opponentSteps;<font></font>
    sync();<font></font>
  }<font></font>
}</code></pre><br>
<p>.  3.    ,              ,     :</p><br>
<pre><code class="plaintext hljs">else if (opponentSteps == playerSteps)<font></font>
{<font></font>
  for (int i = 0; i &lt; fullAmount; i++)<font></font>
  {<font></font>
    if ((deckCards[selectedCard].card == deckCards[i].card) &amp;&amp; (deckCards[i].field &lt; 0) &amp;&amp; (deckCards[i].property != -2))<font></font>
    {<font></font>
      deckCards[selectedCard].field = -(playerSteps + 1);<font></font>
      sync();<font></font>
      break;<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<p>/.  1.      ,        :</p><br>
<pre><code class="plaintext hljs">if (opponentSteps == playerSteps) // <font></font>
{<font></font>
    for (int i = 0; i &lt; fullAmount; i++)<font></font>
    {<font></font>
        if (deckCards[i].field &lt; 0)<font></font>
        {<font></font>
            deckCards[i].property = -2;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>/.  2.      ,  ,          :</p><br>
<pre><code class="plaintext hljs">else if (opponentSteps &gt; playerSteps) //    <font></font>
{<font></font>
    for (int i = 0; i &lt; fullAmount; i++)<font></font>
    {<font></font>
        if ((deckCards[i].field &lt; 0) &amp;&amp; (deckCards[i].property != -2))<font></font>
        {<font></font>
            addPlayerCard(playerId, i);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="shag-4-narisuem-karty"> 4.  </h3><br>
<p>           M5STACK,           .</p><br>
<pre><code class="plaintext hljs">void drawCard(int x, int y, playCard card) {<font></font>
    M5.Lcd.fillRoundRect(x, y, 30, 50, 5, 0xffff);<font></font>
    M5.Lcd.drawRoundRect(x, y, 30, 50, 5, 0x00);<font></font>
    M5.Lcd.setTextSize(2);<font></font>
    M5.Lcd.setTextColor(colors[card.color]);<font></font>
    M5.Lcd.setCursor((x + 3), (y + 6));<font></font>
    M5.Lcd.print(cards[card.card]);<font></font>
    M5.Lcd.setTextSize(3);<font></font>
    M5.Lcd.setCursor((x + 8), (y + 24));<font></font>
    M5.Lcd.print(suits[card.suit]);<font></font>
}<font></font>
<font></font>
void drawEmptyCard(int x, int y) {<font></font>
  M5.Lcd.fillRect(x, y, 30, 50, 0x2589);<font></font>
  M5.Lcd.drawRoundRect(x, y, 30, 50, 5, 0x00);<font></font>
}</code></pre><br>
<blockquote>   Windows:            Alt       3  6,     .</blockquote><br>
<h3 id="shag-5-napishem-animaciyu-dvizheniya-kart"> 5.    </h3><br>
<pre><code class="plaintext hljs">void drawSelect(playCard card) {<font></font>
    int n = card.field - 1;<font></font>
    int x = 10 + (n * 30);<font></font>
    int y = (yPlayerField - 10);<font></font>
    drawEmptyCard(x, yPlayerField);<font></font>
    drawCard(x, y, card);<font></font>
}<font></font>
<font></font>
void clearSelect(playCard card) {<font></font>
    int n = card.field - 1;<font></font>
    int x = 10 + (n * 30);<font></font>
    int y = (yPlayerField - 10);<font></font>
    M5.Lcd.fillRect(x, y, 30, 50, 0x2589);<font></font>
    drawCard(x, yPlayerField, card);<font></font>
}</code></pre><br>
<h3 id="shag-6-narisuem-igrovoy-stol-i-menyu"> 6.     </h3><br>
<pre><code class="plaintext hljs">void drawGameTable() {<font></font>
    M5.Lcd.fillScreen(0x2589); // green table<font></font>
    drawAllFields();<font></font>
}<font></font>
<font></font>
void drawMenu() {<font></font>
    M5.Lcd.fillRect(0, 0, 320, 20, 0x00); // score bar<font></font>
    M5.Lcd.fillRect(0, 220, 320, 20, 0x00); // menu bar<font></font>
    /* menu buttons */<font></font>
    M5.Lcd.setTextSize(2);<font></font>
    M5.Lcd.setTextColor(0x7bef);<font></font>
    M5.Lcd.setCursor(62, 223);<font></font>
    M5.Lcd.print("G");<font></font>
    M5.Lcd.setCursor(155, 223);<font></font>
    M5.Lcd.print("A");<font></font>
    M5.Lcd.setCursor(247, 223);<font></font>
    M5.Lcd.print("S");<font></font>
}</code></pre><br>
<h3 id="shag-7-obnovlenie-grafiki"> 7.  </h3><br>
<pre><code class="plaintext hljs">void updateGraphics() {<font></font>
    drawGameTable();<font></font>
    drawMenu();<font></font>
    drawPlayerId();<font></font>
    drawRest();<font></font>
    for (int i = 0; i &lt; fullAmount; i++)<font></font>
    {<font></font>
        if (deckCards[i].property == playerId)<font></font>
        {<font></font>
            if (deckCards[i].field &gt; 0) // if in the hands of<font></font>
                drawPlayerCard(deckCards[i]); <font></font>
            else // if in the playing field<font></font>
                drawPlPfCard(deckCards[i]); <font></font>
        }<font></font>
        else if (deckCards[i].property == getOpponentId())<font></font>
        {<font></font>
            if (deckCards[i].field &lt; 0)<font></font>
                drawOpPfCard(deckCards[i]); // draw opponent's cards in the playing field<font></font>
        }<font></font>
        else if (deckCards[i].property == 0)<font></font>
        {<font></font>
            drawTrumpCard(deckCards[i]);<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<blockquote>  (, drawPlayerId())            ;)</blockquote><br>
<h3 id="shag-8-napishem-funkcii-dlya-priyomaotpravki-dannyh-cherez-posledovatelnyy-port"> 8.    /    </h3><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/a7c/649/ff0/a7c649ff0fe2f3e5f0763730982292cb.jpg"><br>
<em> 5.3</em></p><br>
<p>                   .    ,        .   ,    true  false.</p><br>
<pre><code class="plaintext hljs">bool serialWriteStr(String str) {<font></font>
    Serial.print(str);<font></font>
    Serial.print('\n');<font></font>
    String input = serialReadStr(); <font></font>
    if (input != "")<font></font>
    {<font></font>
        if (input[0] == (char)0x04) return true;<font></font>
    }<font></font>
    return false;<font></font>
}</code></pre><br>
<p>     timeout (3000 )   ,           .      .</p><br>
<pre><code class="plaintext hljs">String serialReadStr() {<font></font>
    String buf = "";<font></font>
    long timeout = 3000;<font></font>
    long previousMillis = millis();<font></font>
    while (true)<font></font>
    {<font></font>
        unsigned long currentMillis = millis();<font></font>
        if (currentMillis - previousMillis &gt; timeout) break;<font></font>
        if (Serial.available() &gt; 0)<font></font>
        {<font></font>
            char chr = (char)Serial.read();<font></font>
            if ((chr != (char)0x16) &amp;&amp; (chr != (char)0x04) &amp;&amp; (buf == "")) // clear trash<font></font>
            {<font></font>
                Serial.read();<font></font>
            }<font></font>
            else<font></font>
            {<font></font>
                if (chr == '\n')<font></font>
                    break;<font></font>
                else<font></font>
                    buf += chr;<font></font>
            }  <font></font>
        }<font></font>
    }   <font></font>
    if (buf != "")<font></font>
    {<font></font>
        Serial.print((char)0x04);<font></font>
        Serial.print('\n');<font></font>
    }<font></font>
    return buf;<font></font>
}</code></pre><br>
<h3 id="shag-9-sdelaem-obrabotku-vhodyaschih-paketov-dannyh"> 9.     </h3><br>
<p> ,   ,        (. 6).  ,  ,    .      (parseString),       ,      (   Split  JS).</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/740/0d6/2be/7400d62be0141c77b05d266cd1813413.jpg"><br>
<em> 6.   </em></p><br>
<pre><code class="plaintext hljs">bool serialRecivePacket() {<font></font>
    String input = serialReadStr(); <font></font>
    if (input.length() &gt; 0)<font></font>
    {<font></font>
        if ((char)input[0] == (char)0x16) <font></font>
        {<font></font>
            input[0] = ' ';<font></font>
            char groupType = ((parseString(0, (char)0x1d, input)).toInt()) + '0';<font></font>
            String groupData = parseString(1, (char)0x1d, input);<font></font>
            int groupDataLenmo = (groupData.length() - 1);<font></font>
            if (groupData[groupDataLenmo] == (char)0x03)  <font></font>
            {<font></font>
                groupData[groupDataLenmo] = ' '; <font></font>
                if (groupType == (char)0x31) updateReciveDeckCards(groupData); <font></font>
                else if (groupType == (char)0x32) playerId = 2; <font></font>
                return true;<font></font>
            }<font></font>
        }<font></font>
    return false;<font></font>
    }<font></font>
}<font></font>
<font></font>
String parseString(int idSeparator, char separator, String str) { // like split JS<font></font>
    String output = "";<font></font>
    int separatorCout = 0;<font></font>
    for (int i = 0; i &lt; str.length(); i++)<font></font>
    {<font></font>
        if ((char)str[i] == separator)<font></font>
        {<font></font>
            separatorCout++;<font></font>
        }<font></font>
        else<font></font>
        {<font></font>
            if (separatorCout == idSeparator)<font></font>
        {<font></font>
            output += (char)str[i];<font></font>
        }<font></font>
        else if (separatorCout &gt; idSeparator)<font></font>
        {<font></font>
            break;<font></font>
        }<font></font>
    }<font></font>
    return output;<font></font>
}</code></pre><br>
<blockquote>   parseString:<br>
<blockquote>parseString(1, ':', "cat:Bob,Jack:dog:Martin,Kelvin"); -----&gt; Bob,Jack<br>
<br>
parseString(0, ',', "Bob,Jack"); -----&gt; Bob<br>
<br>
parseString(1, ',', "Bob,Jack"); -----&gt; Jack</blockquote><br>
</blockquote><br>
<h3 id="shag-10-realizuem-sistemu-zadayuschuyu-nomer-igroka"> 10.     </h3><br>
<p>     ,       ,     , ,   " !" (. 7). -     .  ,     " !"      2.</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/45a/d75/37d/45ad7537d69782bbe00cca3f2ce71270.jpg"><br>
<em> 7.       <br>
</em><br>
void handshakePlayerId() {<br>
long tpid = random(10, 1001) * 10;<br>
long previousMillis = millis();<br>
while (!serialRecivePacket())<br>
{<br>
unsigned long currentMillis = millis();<br>
if (currentMillis ‚Äî previousMillis &gt; tpid) break;<br>
}<br>
while (!serialSendPlayerTId());<br>
}</p><br>
<pre><code class="plaintext hljs">bool serialSendPlayerTId() {<font></font>
    String str = "";<font></font>
    str += (char)0x16; <font></font>
    str += (char)0x32; // type "player id selector"<font></font>
    str += (char)0x1d;<font></font>
    str += (char)0x03; <font></font>
    return serialWriteStr(str);<font></font>
}</code></pre><br>
<h3 id="shag-11-upakuem-i-raspakuem-paket-s-kartoy"> 11.      </h3><br>
<pre><code class="plaintext hljs">bool serialSendDeckCards() {<font></font>
    String str = "";<font></font>
    str += (char)0x16; <font></font>
    str += (char)0x31; // type "card transfer flag"<font></font>
    str += (char)0x1d; <font></font>
    for (int i = 0; i &lt; fullAmount; i++)<font></font>
    {<font></font>
        str += (char)0x1e; <font></font>
        str += deckCards[i].card;<font></font>
        str += (char)0x1f; <font></font>
        str += deckCards[i].suit;<font></font>
        str += (char)0x1f;<font></font>
        str += deckCards[i].color;<font></font>
        str += (char)0x1f;<font></font>
        str += deckCards[i].property;<font></font>
        str += (char)0x1f;<font></font>
        str += deckCards[i].field;<font></font>
    }<font></font>
    str += (char)0x03; <font></font>
    return serialWriteStr(str);<font></font>
}<font></font>
<font></font>
void updateReciveDeckCards(String groupData) {<font></font>
    for (int i = 0; i &lt; fullAmount; i++)<font></font>
    {<font></font>
        /* update new card */<font></font>
        String record = parseString(i, (char)0x1e, groupData);<font></font>
        deckCards[i].card = (int8_t)(parseString(0, (char)0x1f, record).toInt());<font></font>
        deckCards[i].suit = (int8_t)(parseString(1, (char)0x1f, record).toInt());<font></font>
        deckCards[i].color = (int8_t)(parseString(2, (char)0x1f, record).toInt());<font></font>
        deckCards[i].property = (int8_t)(parseString(3, (char)0x1f, record).toInt());<font></font>
        deckCards[i].field = (int8_t)(parseString(4, (char)0x1f, record).toInt());<font></font>
    }<font></font>
    getTrumpCard();<font></font>
    updateGraphics();<font></font>
    checkWinner();<font></font>
}</code></pre><br>
<blockquote>  (, getTrumpCard())            ;)</blockquote><br>
<h3 id="shag-12-napishem-funkciyu-sinhronizacii"> 12.   </h3><br>
<p>        .            .          loop().              .             .</p><br>
<pre><code class="plaintext hljs">void sync(bool auto_ = false) {<font></font>
    if (queue != playerId) <font></font>
    {<font></font>
        while (!serialRecivePacket());<font></font>
        queue = playerId;<font></font>
    }<font></font>
    else<font></font>
    {<font></font>
        if (!auto_)<font></font>
        {<font></font>
          while (!serialSendDeckCards());<font></font>
          updateGraphics();<font></font>
          checkWinner();<font></font>
          queue = getOpponentId();<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<h3 id="shag-13-kto-zhe-vyigral"> 13.   ?</h3><br>
<p> whoWin()   ,    -1,    .<br>
   ,         ,   .    10 (playerFieldAmount)   ,   .</p><br>
<pre><code class="plaintext hljs">int whoWin() {<font></font>
    int opponentId = getOpponentId();<font></font>
    int playerAmount_ = getAmount(playerId);<font></font>
    int opponentAmount = getAmount(opponentId);<font></font>
    if ((playerAmount_ == 0) || (opponentAmount &gt;= playerFieldAmount)) return playerId;<font></font>
    if ((opponentAmount == 0) || (playerAmount_ &gt;= playerFieldAmount)) return opponentId;<font></font>
    return -1; <font></font>
}<font></font>
<font></font>
void checkWinner() {<font></font>
    int winner = whoWin();<font></font>
    if (winner != -1) drawWinnerShow(winner);<font></font>
}</code></pre><br>
<h3 id="shag-14-soberyom-ves-kod-voedino-i-zagruzim-ego-v-ustroystvo"> 14.         </h3><br>
<blockquote>:     ,     beta-,      .   !</blockquote><p>   Arduino IDE      .</p><br>
<h3 id="shag-15-zapusk"> 15. </h3><br>
<p>      (. 5.1).        (. 8).  ! (. 8.1).</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/e4a/be2/5f5/e4abe25f50720521801ed574d3a148fe.jpg"><br>
<em> 8.   </em></p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/51a/06e/5d0/51a06e5d045e693cafb24f828681a1f6.jpg"><br>
<em> 8.1. !</em></p><br>
<h2 id="zagruzki--ssylki"> \ </h2><br>
<p> M5Stack  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">   </a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi492628/index.html">‡§ï‡•ã‡§∞‡•ã‡§®‡§µ‡§æ‡§Ø‡§∞‡§∏ (‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§¶‡§∞ ‡§ó‡§£‡§®‡§æ) ‡§µ‡§æ‡§≤‡•á ‡§∞‡•ã‡§ó‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§Ö‡§Ç‡§§‡§∞‡§æ‡§≤</a></li>
<li><a href="../hi492632/index.html">‡§∏‡§Ç‡§ó‡•É‡§π‡•Ä‡§§ ‡§≤‡§ò‡•Å ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø: ‡§Ü‡§§‡§Ç‡§ï ‡§ï‡§æ‡§∞‡§£ ‡§ï‡§æ ‡§¶‡•Å‡§∂‡•ç‡§Æ‡§® ‡§π‡•à</a></li>
<li><a href="../hi492636/index.html">‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡•Ä ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à?</a></li>
<li><a href="../hi492638/index.html">‡§¨‡§§‡§ñ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï Redux ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§∏‡•ç‡§ï‡•á‡§≤‡§ø‡§Ç‡§ó</a></li>
<li><a href="../hi492642/index.html">‡§ó‡§§‡§ø‡§∂‡•Ä‡§≤ microservices ‡§ï‡•á ‡§∏‡§æ‡§• ‡§è‡§ï ‡§∏‡•ç‡§ï‡•á‡§≤‡•á‡§¨‡§≤ ‡§î‡§∞ ‡§≤‡§ö‡•Ä‡§≤‡§æ ‡§µ‡§æ‡§∏‡•ç‡§§‡•Å‡§ï‡§≤‡§æ ‡§¨‡§®‡§æ‡§è‡§Å</a></li>
<li><a href="../hi492658/index.html">‡§Æ‡•à‡§Ç ‡§è‡§ï ‡§∞‡§ø‡§Æ‡•ã‡§ü ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡§∞ ‡§ó‡§Ø‡§æ - ‡§è‡§ï ‡§™‡•â‡§°‡§ï‡§æ‡§∏‡•ç‡§ü ‡§≤‡•â‡§®‡•ç‡§ö ‡§ï‡§ø‡§Ø‡§æ: ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§Ø‡§æ ‡§™‡§¢‡§º‡§®‡§æ ‡§π‡•à - 5 ‡§∏‡§ø‡§¶‡•ç‡§ß ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç</a></li>
<li><a href="../hi492660/index.html">‡§ï‡•ã‡§∞‡•ã‡§®‡§æ‡§µ‡§æ‡§Ø‡§∞‡§∏ ‡§ï‡•á ‡§ñ‡§ø‡§≤‡§æ‡§´ ‡§™‡•Ç‡§∞‡•Ä ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ‡•§ ‡§á‡§Ç‡§ü‡•á‡§≤ ‡§ï‡•Ä ‡§ï‡§π‡§æ‡§®‡§ø‡§Ø‡§æ‡§Ç</a></li>
<li><a href="../hi492662/index.html">‡§ï‡•à‡§∏‡•á ‡§Æ‡•à‡§Ç‡§®‡•á ‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§è‡§ï ‡§µ‡§ø‡§∂‡•ç‡§µ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§® ‡§¶‡§ø‡§Ø‡§æ</a></li>
<li><a href="../hi492666/index.html">‡§Æ‡§æ‡§≤‡•ç‡§ü‡•á‡§ó‡•ã ‡§™‡§æ‡§∞‡•ç‡§ü 4. ‡§µ‡•Ä‡§ï‡•á, ‡§á‡§Ç‡§∏‡•ç‡§ü‡§æ‡§ó‡•ç‡§∞‡§æ‡§Æ, ‡§≤‡§ø‡§Ç‡§ï‡•ç‡§°‡§á‡§® ‡§î‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§ï‡•ç‡§∞‡§ø‡§ü‡§∞‡•ç‡§∏</a></li>
<li><a href="../hi492668/index.html">COVID-19 ‡§ü‡•Ä‡§ï‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ó‡§æ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>