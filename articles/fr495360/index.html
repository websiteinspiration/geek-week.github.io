<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¨ ‚û∞ ‚ù§Ô∏è Comment nous avons automatis√© le portage des produits de C # vers C ++ üõ∑ üì∞ üî°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr. Dans cet article, je parlerai de la fa√ßon dont nous avons r√©ussi √† organiser une version mensuelle des biblioth√®ques pour le langage C ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons automatis√© le portage des produits de C # vers C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour, Habr. </font><font style="vertical-align: inherit;">Dans cet article, je parlerai de la fa√ßon dont nous avons r√©ussi √† organiser une version mensuelle des biblioth√®ques pour le langage C ++, dont le code source est d√©velopp√© en C #. </font><font style="vertical-align: inherit;">Il ne s'agit pas de C ++ manag√©, ni m√™me de cr√©er un pont entre C ++ non manag√© et l'environnement CLR - il s'agit d'automatiser la g√©n√©ration de code C ++ qui r√©p√®te l'API et les fonctionnalit√©s du code C # d'origine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons √©crit l'infrastructure n√©cessaire pour traduire le code entre les langues et √©muler nous-m√™mes les fonctions de la biblioth√®que .Net, r√©solvant ainsi un probl√®me g√©n√©ralement consid√©r√© comme acad√©mique. Cela nous a √©galement permis de commencer √† publier des versions mensuelles de produits pr√©-Donets pour le langage C ++, en obtenant le code de chaque version √† partir de la version correspondante du code C #. Dans le m√™me temps, les tests qui couvraient le code d'origine sont port√©s avec lui et vous permettent de contr√¥ler les performances de la solution r√©sultante avec des tests sp√©cialement √©crits en C ++.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, je d√©crirai bri√®vement l'histoire de notre projet et les technologies qui y sont utilis√©es. </font><font style="vertical-align: inherit;">Je n'aborderai les questions de justification √©conomique qu'en passant, car le c√¥t√© technique m'est beaucoup plus int√©ressant. </font><font style="vertical-align: inherit;">Dans les articles suivants de la s√©rie, je pr√©vois de m'attarder sur des sujets tels que la g√©n√©ration de code et la gestion de la m√©moire, ainsi que sur certains autres, si la communaut√© a des questions pertinentes.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initialement, notre entreprise √©tait engag√©e dans la sortie de biblioth√®ques pour la plate-forme .Net. </font><font style="vertical-align: inherit;">Ces biblioth√®ques fournissent principalement des API pour travailler avec certains formats de fichiers (documents, tableaux, diapositives, graphiques) et protocoles (e-mail), occupant une certaine niche sur le march√© pour de telles solutions. </font><font style="vertical-align: inherit;">Tout le d√©veloppement a √©t√© r√©alis√© en C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä la fin des ann√©es 2000, la soci√©t√© a d√©cid√© de p√©n√©trer un nouveau march√© pour elle-m√™me, commen√ßant √† lancer des produits similaires pour Java. Un d√©veloppement √† partir de z√©ro n√©cessiterait √©videmment un investissement de ressources comparable au d√©veloppement initial de tous les produits concern√©s. L'option d'encapsuler le code Donnet dans une couche qui traduit les appels et les donn√©es de Java vers .Net et vice versa a √©galement √©t√© rejet√©e pour certaines raisons. Au lieu de cela, la question a √©t√© pos√©e de savoir s'il √©tait possible de migrer compl√®tement le code existant vers la nouvelle plateforme. Cela √©tait d'autant plus pertinent qu'il ne s'agissait pas d'une promotion ponctuelle, mais d'une version mensuelle des nouvelles versions de chaque produit, synchronis√©es entre deux langues.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a √©t√© d√©cid√© de diviser la d√©cision en deux parties. </font><font style="vertical-align: inherit;">Le premier - le soi-disant Porter - convertirait la syntaxe du code source C # en Java, rempla√ßant simultan√©ment les types et m√©thodes .Net par leurs homologues des biblioth√®ques Java. </font><font style="vertical-align: inherit;">La seconde - la biblioth√®que - imiterait le travail des parties de la biblioth√®que .Net pour lesquelles il est difficile ou impossible d'√©tablir une correspondance directe avec Java, attirant pour cela des composants tiers disponibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En faveur de la faisabilit√© principale d'un tel plan, les intervenants suivants ont pris la parole:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur le plan id√©ologique, les langages C # et Java sont assez similaires - du moins, avec la structure des types et l'organisation du travail avec la m√©moire;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agissait de porter des biblioth√®ques, il n'√©tait pas n√©cessaire de porter l'interface graphique;</font></font></li>
<li>  ,  , -    ,        System.Net  System.Drawing;</li>
<li>   ,        .Net ( Framework,   Standard   Xamarin),          .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'entrerai pas dans les d√©tails, car ils m√©ritent un article s√©par√© (et non un). </font><font style="vertical-align: inherit;">Je peux seulement dire qu'il a fallu environ deux ans entre le d√©but du d√©veloppement et la sortie du premier produit Java, et depuis lors, la sortie des produits Java est devenue une pratique courante de l'entreprise. </font><font style="vertical-align: inherit;">Au cours du d√©veloppement du projet, le porteur est pass√© d'un simple utilitaire qui convertit le texte selon les r√®gles √©tablies √† un g√©n√©rateur de code complexe qui fonctionne avec la repr√©sentation AST du code source. </font><font style="vertical-align: inherit;">La biblioth√®que est √©galement envahie de code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le succ√®s de la direction Java a d√©termin√© le d√©sir de l'entreprise de se d√©velopper davantage sur de nouveaux march√©s, et en 2013, la question a √©t√© soulev√©e de la sortie de produits pour le langage C ++ dans un sc√©nario similaire.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation du probl√®me</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'assurer la publication de versions positives des produits, il √©tait n√©cessaire de cr√©er un cadre qui vous permettrait d'obtenir du code C ++ √† partir de code C # arbitraire, de le compiler, de le v√©rifier et de le donner au client. Il s'agissait de biblioth√®ques avec des volumes allant de plusieurs centaines de milliers √† plusieurs millions de lignes (hors d√©pendances).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le m√™me temps, l'exp√©rience avec le porteur Java a √©t√© prise en compte: au d√©part, alors qu'il ne s'agissait que d'un simple outil de conversion de syntaxes, la pratique de finaliser manuellement le code port√© s'est naturellement impos√©e. √Ä court terme, ax√© sur la publication rapide des produits, cela √©tait pertinent, car cela permettait d'acc√©l√©rer le processus de d√©veloppement, mais √† long terme, cela augmentait consid√©rablement les co√ªts de pr√©paration de chaque version pour la publication en raison de la n√©cessit√© de corriger chaque erreur de traduction √† chaque fois qu'elle se produisait.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, cette complexit√© √©tait g√©rable - du moins en ne transf√©rant que des correctifs dans le code Java r√©sultant, qui sont calcul√©s comme la diff√©rence entre la sortie du porteur pour les deux prochaines r√©visions du code C #. Cette approche a permis de corriger chaque ligne port√©e une seule fois et d'utiliser √† l'avenir le code d√©j√† modifi√© o√π aucune modification n'a √©t√© apport√©e. Cependant, lors du d√©veloppement d'un porteur positif, l'objectif √©tait de se d√©barrasser de l'√©tape de correction du code port√©, au lieu de fixer le cadre lui-m√™me. Ainsi, chaque erreur de traduction arbitrairement rare serait corrig√©e une fois - dans le code de porteur, et ce correctif s'appliquerait √† toutes les versions futures de tous les produits port√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du porteur lui-m√™me, il √©tait √©galement n√©cessaire de d√©velopper une biblioth√®que en C ++ qui r√©soudrait les probl√®mes suivants:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âmulation de l'environnement .Net dans la mesure o√π il est n√©cessaire que le code port√© fonctionne;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adapter le code C # port√© aux r√©alit√©s du C ++ (structure de type, gestion de la m√©moire, autre code de service);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lisser les diff√©rences entre ¬´C # r√©√©crit¬ª et C ++ proprement dit, pour permettre aux programmeurs peu familiers avec les paradigmes .Net d'utiliser du code port√©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour des raisons √©videntes, aucune tentative n'a √©t√© faite pour mapper directement les types .Net aux types de la biblioth√®que standard. </font><font style="vertical-align: inherit;">Au lieu de cela, il a √©t√© d√©cid√© de toujours utiliser les types de sa biblioth√®que en remplacement des types Donnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nombreux lecteurs se demanderont imm√©diatement pourquoi ils n'ont pas utilis√© les impl√©mentations existantes comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il y avait des raisons √† cela.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En attirant une biblioth√®que aussi compl√®te, il serait possible de satisfaire uniquement la premi√®re exigence, mais pas la deuxi√®me et non la troisi√®me.</font></font></li>
<li> Mono   C# ,  ,   ,       .</li>
<li>      (API,  ,   ,   C++,   )   ,     .</li>
<li>    ,    .Net,                  .  ,           ,      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Th√©oriquement, une telle biblioth√®que pourrait √™tre traduite en C ++ enti√®rement √† l'aide d'un port, cependant, cela n√©cessiterait un porteur enti√®rement fonctionnel au tout d√©but du d√©veloppement, car sans biblioth√®que syst√®me, le d√©bogage de tout code port√© est impossible en principe. De plus, la question de l'optimisation du code traduit de la biblioth√®que syst√®me serait encore plus aigu√´ que pour le code des produits port√©s, car les appels √† la biblioth√®que syst√®me ont tendance √† devenir un goulot d'√©tranglement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, il a √©t√© d√©cid√© de d√©velopper la biblioth√®que en tant qu'ensemble d'adaptateurs permettant d'acc√©der √† des fonctions d√©j√† impl√©ment√©es dans des biblioth√®ques tierces, mais via une API de type .Net (similaire √† Java). Cela r√©duirait le travail et utiliserait des composants C ++ pr√™ts √† l'emploi, d√©j√† optimis√©s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une exigence importante pour le cadre √©tait que le code port√© devait pouvoir fonctionner dans le cadre des applications utilisateur (en ce qui concerne les biblioth√®ques). Cela signifiait que le mod√®le de gestion de la m√©moire aurait d√ª √™tre pr√©cis√© aux programmeurs C ++, car nous ne pouvons pas forcer le code client arbitraire √† s'ex√©cuter dans un environnement de r√©cup√©ration de place. L'utilisation de pointeurs intelligents a √©t√© choisie comme mod√®le de compromis. Sur la fa√ßon dont nous avons r√©ussi √† assurer une telle transition (en particulier, pour r√©soudre le probl√®me des r√©f√©rences circulaires), je discuterai dans un article s√©par√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre exigence √©tait la possibilit√© de porter non seulement des biblioth√®ques, mais aussi des tests pour celles-ci. </font><font style="vertical-align: inherit;">La soci√©t√© poss√®de une culture √©lev√©e de couverture des tests de ses produits, et la possibilit√© d'ex√©cuter en C ++ les m√™mes tests qui ont √©t√© √©crits pour le code d'origine simplifierait consid√©rablement la recherche de probl√®mes apr√®s la traduction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les exigences restantes (format de lancement, couverture des tests, technologie, etc.) concernaient principalement les m√©thodes de travail avec le projet et sur le projet. </font><font style="vertical-align: inherit;">Je ne m'attarderai pas sur eux.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©cit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de continuer, je dois dire quelques mots sur la structure de l'entreprise. L'entreprise travaille √† distance, toutes les √©quipes y sont r√©parties. Le d√©veloppement d'un certain produit est g√©n√©ralement la responsabilit√© d'une √©quipe, unie par la langue (presque toujours) et la g√©ographie (principalement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le travail actif sur le projet a commenc√© √† l'automne 2013. En raison de la structure distribu√©e de l'entreprise, et √©galement en raison de certains doutes quant au succ√®s du d√©veloppement, trois versions du cadre ont √©t√© lanc√©es imm√©diatement: deux d'entre elles servaient un produit chacune, la troisi√®me en couvrait trois √† la fois. On a suppos√© que cela arr√™terait alors le d√©veloppement de solutions moins efficaces et r√©allouerait les ressources si n√©cessaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'avenir, quatre autres √©quipes se sont jointes aux travaux sur le cadre ¬´commun¬ª, dont deux ont par la suite reconsid√©r√© leur d√©cision et refus√© de publier des produits pour C ++. D√©but 2017, il a √©t√© d√©cid√© d'arr√™ter le d√©veloppement d'une des solutions ¬´individuelles¬ª et de transf√©rer l'√©quipe correspondante pour travailler avec un cadre ¬´commun¬ª. Le d√©veloppement arr√™t√© supposait l'utilisation du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boehm GC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme moyen de gestion de la m√©moire et contenait une impl√©mentation beaucoup plus riche de certaines parties de la biblioth√®que syst√®me, qui a ensuite √©t√© transf√©r√©e vers la solution ¬´g√©n√©rale¬ª.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, deux d√©veloppements sont arriv√©s √† la ligne d'arriv√©e - c'est-√†-dire √† la sortie des produits port√©s - un ¬´individuel¬ª et un ¬´collectif¬ª. Les premi√®res versions bas√©es sur notre framework (¬´commun¬ª) ont eu lieu en f√©vrier 2018. Par la suite, les versions des six √©quipes utilisant cette solution sont devenues mensuelles et le framework lui-m√™me a √©t√© publi√© en tant que produit distinct de la soci√©t√©. M√™me la question a √©t√© pos√©e de le rendre open-source, mais cette discussion n'est pas encore d√©velopp√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipe, qui a continu√© √† travailler de mani√®re ind√©pendante sur un cadre similaire, a √©galement publi√© sa premi√®re version C ++ en 2018.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les premi√®res versions contenaient des versions tronqu√©es des produits originaux, ce qui permettait de retarder autant que possible le travail de diffusion de pi√®ces sans importance. </font><font style="vertical-align: inherit;">Dans les versions ult√©rieures, une addition par partie de fonctionnalit√©s s'est produite (et se produit).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organisation des travaux sur le projet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'organisation d'un travail commun sur le projet par plusieurs √©quipes a r√©ussi √† subir des changements importants. Initialement, il a √©t√© d√©cid√© qu'une grande √©quipe ¬´centrale¬ª serait responsable du d√©veloppement, du support et de la fixation du cadre, tandis que les petites √©quipes ¬´produit¬ª impliqu√©es dans la sortie des produits finaux en C ++ seraient principalement charg√©es d'essayer de porter leur code et fournir des commentaires (informations sur les erreurs de portage, de compilation et d'ex√©cution). Un tel sch√©ma s'est toutefois av√©r√© improductif, car l'√©quipe centrale √©tait surcharg√©e de demandes de toutes les √©quipes ¬´produits¬ª, et elles ne pouvaient pas avancer tant que les probl√®mes rencontr√©s n'√©taient pas r√©solus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour des raisons largement ind√©pendantes de l'√©tat de cette √©volution particuli√®re, il a √©t√© d√©cid√© de dissoudre l'√©quipe ¬´centrale¬ª et de transf√©rer les personnes vers des √©quipes ¬´produit¬ª, d√©sormais charg√©es de fixer le cadre √† leurs besoins. Dans ce cas, chaque √©quipe d√©ciderait elle-m√™me d'utiliser ses bases communes ou de g√©n√©rer sa propre fourchette du projet. Un tel √©nonc√© de la question √©tait pertinent pour le cadre Java, dont le code √©tait stable √† l'√©poque, mais la consolidation des efforts √©tait n√©cessaire pour remplir la biblioth√®que C ++ d√®s que possible, afin que les √©quipes continuent de travailler ensemble.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette forme de travail avait aussi ses inconv√©nients, donc √† l'avenir une autre r√©forme a √©t√© r√©alis√©e. L'√©quipe ¬´centrale¬ª a √©t√© reconstitu√©e, bien que dans une composition plus petite, mais avec des fonctions diff√©rentes: d√©sormais elle n'√©tait pas responsable du d√©veloppement proprement dit du projet, mais de l'organisation d'un travail commun sur celui-ci. Cela comprenait la prise en charge de l'environnement CI, l'organisation des pratiques de demande de fusion, la tenue de r√©unions r√©guli√®res avec les participants au d√©veloppement, la documentation de support, la couverture des tests, l'aide aux solutions architecturales et au d√©pannage, etc. En outre, l'√©quipe a entrepris des travaux pour √©liminer la dette technique et d'autres domaines √† forte intensit√© de ressources. Dans ce mode, le d√©veloppement se poursuit √† ce jour.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, le projet a √©t√© initi√© par les efforts de plusieurs (environ cinq) d√©veloppeurs et comptait au mieux une vingtaine de personnes. Une dizaine √† quinze personnes responsables du d√©veloppement et du support du framework et de la sortie de six produits port√©s peuvent √™tre consid√©r√©es comme une valeur stable ces derni√®res ann√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur de ces lignes a rejoint l'entreprise mi-2016, commen√ßant √† travailler dans l'une des √©quipes diffusant leur code √† l'aide d'une solution ¬´commune¬ª. Au cours de l'hiver de la m√™me ann√©e, quand il a √©t√© d√©cid√© de recr√©er l'√©quipe ¬´centrale¬ª, je suis pass√©e au poste de chef d'√©quipe. Ainsi, mon exp√©rience dans le projet aujourd'hui est de plus de trois ans et demi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'autonomie des √©quipes charg√©es de la sortie des produits port√©s a conduit au fait que dans certains cas, il s'est av√©r√© plus facile pour les d√©veloppeurs de compl√©ter le porteur avec des modes de fonctionnement que de faire des compromis sur le comportement √† adopter par d√©faut. </font><font style="vertical-align: inherit;">Cela explique plus que vous ne le pensez, le nombre d'options disponibles lors de la configuration du portier.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les technologies</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de parler des technologies utilis√©es dans le projet. Porter est une application console √©crite en C #, car sous cette forme, il est plus facile d'incorporer dans des scripts qui effectuent des t√¢ches telles que des "tests d'ex√©cution de compilation de port". De plus, il existe un composant GUI qui vous permet d'atteindre les m√™mes objectifs en cliquant sur les boutons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ancienne biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NRefactory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est charg√©e d'analyser le code et de r√©soudre la s√©mantique </font><font style="vertical-align: inherit;">. Malheureusement, au moment du d√©marrage du projet, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roslyn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'√©tait pas encore disponible, bien que la migration vers celui-ci, bien s√ªr, soit dans nos plans. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Porter utilise </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">des</font></a><font style="vertical-align: inherit;"> passerelles en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bois AST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour collecter des informations et g√©n√©rer du code de sortie C ++. Lorsque du code C ++ est g√©n√©r√©, la repr√©sentation AST n'est pas cr√©√©e et tout le code est enregistr√© en texte brut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de nombreux cas, le porteur a besoin d'informations suppl√©mentaires pour un r√©glage fin. Ces informations lui sont transmises sous forme d'options et d'attributs. Les options s'appliquent imm√©diatement √† l'ensemble du projet et vous permettent de d√©finir, par exemple, les noms des membres de macro d'exportation des classes ou des d√©finitions de pr√©processeur C # utilis√©s dans l'analyse de code. Les attributs sont accroch√©s aux types et aux entit√©s et d√©terminent le traitement qui leur est sp√©cifique (par exemple, la n√©cessit√© de g√©n√©rer des mots cl√©s ¬´const¬ª ou ¬´mutable¬ª pour les membres de la classe ou de les exclure du portage).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les classes et structures C # sont traduites en classes C ++, leurs membres et le code ex√©cutable sont traduits dans les √©quivalents les plus proches. Les types et m√©thodes g√©n√©riques sont mapp√©s aux mod√®les C ++. Les liens C # sont traduits en pointeurs intelligents (forts ou faibles) d√©finis dans la biblioth√®que. Plus de d√©tails sur les principes du porteur seront discut√©s dans un article s√©par√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'assembly C # d'origine est converti en projet C ++, qui au lieu des biblioth√®ques .Net d√©pend de notre biblioth√®que partag√©e. Ceci est illustr√© dans le diagramme suivant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/of/d1/s-/ofd1s-pimst_5rrcxzz8t-fh0nq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cmake est utilis√© pour construire la biblioth√®que et les projets port√©s. Les compilateurs VS 2017 et 2019 (Windows), GCC et Clang (Linux) sont actuellement pris en charge.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme mentionn√© ci-dessus, la plupart de nos impl√©mentations .Net sont de fines couches de biblioth√®ques tierces qui effectuent la majeure partie du travail. </font><font style="vertical-align: inherit;">Il comprend:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour travailler avec des graphiques;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour prendre en charge les fonctions de cryptage;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour travailler avec des cha√Ænes, des encodages et des cultures;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libxml2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour travailler avec XML;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCRE2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour travailler avec des expressions r√©guli√®res;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - pour impl√©menter des fonctions de compression;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √† des fins diverses;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs autres biblioth√®ques.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le portier et la biblioth√®que sont couverts par de nombreux tests. </font><font style="vertical-align: inherit;">Les tests de biblioth√®que utilisent le framework gtest. </font><font style="vertical-align: inherit;">Les tests de Porter sont √©crits principalement en NUnit / xUnit et sont divis√©s en plusieurs cat√©gories, certifiant que:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la sortie du porteur sur ces fichiers d'entr√©e correspond √† la cible;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la sortie des programmes port√©s apr√®s compilation et lancement co√Øncide avec la cible;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les tests NUnit des projets d'entr√©e sont convertis avec succ√®s en tests gtest dans les projets port√©s et r√©ussissent;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'API des projets port√©s fonctionne correctement en C ++;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'impact des options et des attributs individuels sur le processus de traduction est comme pr√©vu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour stocker le code source </font><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jenkins a √©t√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> choisi comme environnement CI </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Les produits port√©s sont disponibles sous forme de packages Nuget et d'archives de t√©l√©chargement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®mes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En travaillant sur le projet, nous avons d√ª faire face √† beaucoup de probl√®mes. </font><font style="vertical-align: inherit;">Certains √©taient attendus, tandis que d'autres sont d√©j√† apparus dans le processus. </font><font style="vertical-align: inherit;">Nous √©num√©rons bri√®vement les principaux.</font></font><br>
<br>
<ol>
<li><b>     .Net  C++.</b><br>
  ,   C++    Object,       RTTI.           .Net   STL.</li>
<li><b>   .</b><br>
       ,          ,    . ,  C#     ,   C++ ‚Äî .</li>
<li><b>  .</b><br>
   ‚Äî   .          ,   .   ,            .</li>
<li><b>    .</b><br>
 C++   ,        ,        .</li>
<li><b>    C#.</b><br>
 C#    ,      C++.    ,     :<br>
<br>
<ul>
<li>   ,    ;</li>
<li>   ,       (,       yeild);</li>
<li>,      (,            ,       ,        C#);</li>
<li>,   C++ (,  C#        foreground-).</li>
</ul></li>
<li><b>  .</b><br>
,        .Net  ,          .</li>
<li><b>   .</b><br>
- ,     ,        ¬´¬ª ,     .  ,  ,  ,     ,     using,             -.                 .   ,             .</li>
<li><b> .</b><br>
         ,    ,   ,  ,   ,    /     -          .</li>
<li><b>    .</b><br>
     .       ,           .    ,       ,      ,     .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Difficult√©s de protection de la propri√©t√© intellectuelle. </font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le code C # est assez facilement obscurci par des solutions encadr√©es, alors en C ++, vous devez faire des efforts suppl√©mentaires, car de nombreux membres de classe ne peuvent pas √™tre supprim√©s des fichiers d'en-t√™te sans cons√©quences. </font><font style="vertical-align: inherit;">La traduction de classes et de m√©thodes g√©n√©riques en mod√®les cr√©e √©galement des vuln√©rabilit√©s en exposant des algorithmes.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malgr√© cela, le projet est tr√®s int√©ressant d'un point de vue technique. </font><font style="vertical-align: inherit;">Travailler dessus vous permet d'apprendre beaucoup et d'apprendre beaucoup. </font><font style="vertical-align: inherit;">La nature acad√©mique de la t√¢che y contribue √©galement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cadre du projet, nous avons pu mettre en place un syst√®me qui r√©sout un probl√®me acad√©mique int√©ressant pour son application pratique directe. Nous avons organis√© un num√©ro mensuel des biblioth√®ques d'entreprise dans une langue √† laquelle elles n'√©taient pas initialement destin√©es. Il s'est av√©r√© que la plupart des probl√®mes sont enti√®rement r√©solubles et la solution qui en r√©sulte est fiable et pratique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bient√¥t, il est pr√©vu de publier deux autres articles. L'un d'eux d√©crira en d√©tail, avec des exemples, comment fonctionne un porteur et comment les constructions C # sont affich√©es en C ++. Dans un autre discours, nous parlerons de la fa√ßon dont nous avons r√©ussi √† assurer la compatibilit√© des mod√®les de m√©moire de deux langues.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais essayer de r√©pondre aux questions dans les commentaires. </font><font style="vertical-align: inherit;">Si les lecteurs s'int√©ressent √† d'autres aspects de notre d√©veloppement et que les r√©ponses commencent √† d√©passer la correspondance dans les commentaires, nous envisagerons la possibilit√© de publier de nouveaux articles.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495344/index.html">Unifier: comment Lamoda rend ses services Go coh√©rents</a></li>
<li><a href="../fr495346/index.html">De l'erreur √† l'alerte avec des actions</a></li>
<li><a href="../fr495350/index.html">Serveur Web domestique ou votre propre h√©bergeur</a></li>
<li><a href="../fr495354/index.html">Comment publier des produits en continu en 20 langues et ne pas mourir?</a></li>
<li><a href="../fr495356/index.html">Impl√©mentation de l'algorithme de consensus RAFT pour le stockage KV distribu√© en Java</a></li>
<li><a href="../fr495362/index.html">Auto-isolement et programme: comment ne pas devenir fou √† la maison et passer du temps utilement</a></li>
<li><a href="../fr495364/index.html">Guide de style API, ou ne faites pas r√©fl√©chir les utilisateurs</a></li>
<li><a href="../fr495366/index.html">16 types de programmeurs ou d√©veloppeurs ne sont pas les m√™mes robots</a></li>
<li><a href="../fr495368/index.html">Nous nous auto-enregistrons pour les auto-chiens qui se prom√®nent dans des conditions d'auto-isolement</a></li>
<li><a href="../fr495370/index.html">Le public est mauvais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>