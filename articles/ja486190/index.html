<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲🏼 ☕️ 👩‍💼 Yandex.Cloud用にKubernetesでCSIドライバーを開発した経験 😾 🎅🏻 🥃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="FlandがYandex.Cloud のCSI（Container Storage Interface）ドライバーのアルファバージョンをリリースすることにより、Kubernetesのオープンソースツールへの貢献を補充していることをお知らせいたします。
 
 しかし、実装の詳細に進む前に、Yandex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Yandex.Cloud用にKubernetesでCSIドライバーを開発した経験</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/486190/"><img src="https://habrastorage.org/webt/1y/to/tn/1ytotnf73zepbwfalhzoropf9qa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FlandがYandex.Cloud </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のCSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Container Storage Interface）</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドライバーのアルファバージョンを</font></a><font style="vertical-align: inherit;">リリースすることにより、Kubernetesのオープンソースツールへの貢献を補充していることをお知らせ</font><font style="vertical-align: inherit;">いたします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、実装の詳細に進む前に、Yandexがすでに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetesサービスのマネージドサービスを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持っているのに、なぜこれが必要なのかという質問に答え</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どうしてこれなの？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
社内では、Kubernetesの運用開始当初から（つまり、数年間）、独自のツール（デッキハウス）が開発されていますが、ちなみに、これもオープンソースプロジェクトとしてすぐに利用できるようにする予定です。その助けを借りて、すべてのクラスターを一律に構成および構成します。現在、最も多様なハードウェア構成と利用可能なすべてのクラウドサービスに100以上のクラスターがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ディックハウスを使用するクラスターには、バランサー、便利なチャート、メトリックスおよびアラートによるモニタリング、すべてのダッシュボードにアクセスするための外部プロバイダーを介したユーザー認証など、作業に必要なすべてのコンポーネントがあります。</font><font style="vertical-align: inherit;">多くの場合不可能であるか、コンポーネントの半分を無効にする必要が生じるため、このような「ポンプアップ」されたクラスターをマネージドソリューションに配置しても意味がありません。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：これは私たちの経験であり、非常に具体的です。</font><font style="vertical-align: inherit;">既製のソリューションを使用するのではなく、誰もが独立してKubernetesクラスタのデプロイメントに従事すべきであると主張することは決してありません。</font><font style="vertical-align: inherit;">ちなみに、YandexのKubernetesの運用に関する実際の経験はありません。この記事では、このサービスの評価は行いません。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それは誰のためのものですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
：だから、我々はすでに、現代Kubernetes内のストレージへのアプローチについて話しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSIは、どのよう</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に動作</font><font style="vertical-align: inherit;">し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どのようにコミュニティが来た</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このアプローチに。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、多くの大規模なクラウドサービスプロバイダーが、クラウドドライブをKubernetesの永続ボリュームとして使用するためのドライバーを開発しています。サプライヤーがそのようなドライバーを持っていないが、必要なすべての機能がAPIを通じて提供されている場合、ドライバーを自分で実装することを妨げるものは何もありません。そして、それはYandex.Cloudで起こりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発の基礎として、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DigitalOceanクラウドのCSIドライバーと</font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドライバー</font></a><font style="vertical-align: inherit;">からいくつかのアイデアを採用しました。</font><font style="vertical-align: inherit;">これらのクラウド（GoogleとYandex）のAPIとの相互作用には多くの類似点があるためです。特に、APIと</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex</font></font></a><font style="vertical-align: inherit;"></font><code>Operation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、時間のかかる操作（新しいディスクの作成など）のステータスを追跡</font><font style="vertical-align: inherit;">するオブジェクト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">返します</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Cloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> APIを操作するには、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Yandex.Cloud Go SDKを使用し</font></a><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行われた作業の結果は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">公開され</font></a><font style="vertical-align: inherit;">、何らかの理由でYandex.Cloud仮想マシンに独自のKubernetesのインストールを使用し（既製のマネージドクラスターではない）、CSIを介してディスクを使用（注文）したい場合に役立ちます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な特徴</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、ドライバーは次の関数をサポートしています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> クラスタ内のノードのトポロジに従って、クラスタのすべてのゾーンでディスクを順序付けします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 以前に注文したディスクを削除します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクのオフラインサイズ変更（Yandex。Cloud </font><font style="vertical-align: inherit;">は、仮想マシンにマウントされているディスク</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">増加を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">サポートしていません</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">できるだけ簡単にサイズを変更するためにドライバーを変更する方法については、以下を参照してください。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来的には、スナップショットディスクの作成と削除のサポートを実装する予定です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主な困難とその克服</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yandex.Cloud APIでリアルタイムにディスクを拡張する機能がないことは、PV（永続ボリューム）のサイズ変更操作を複雑にする制限です。この場合、ディスクを使用するアプリケーションのポッドを停止する必要があります。これにより、簡単にアプリケーション。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">CSI仕様に</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
よると</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、CSI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラーがディスクのサイズを「オフライン」にしか変更できないと報告した場合（</font></font><code>VolumeExpansion.OFFLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、ディスクを増やすプロセスは次のようになります。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインに</font></font><code>VolumeExpansion.OFFLINE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張機能</font><font style="vertical-align: inherit;">しかなく</font><font style="vertical-align: inherit;">、ボリュームが現在公開されているか、ノードで利用できる場合は、次の</font></font><code>ControllerExpandVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれかの後にのみ呼び出す必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインにはコントローラー</font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能があり、</font></font><code>ControllerUnpublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常に呼び出されました。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または他の</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインにはコントローラー</font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能がなく、プラグインにはノード</font></font><code>STAGE_UNSTAGE_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能があり、</font></font><code>NodeUnstageVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常に完了しています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または他の</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインにはコントローラー</font></font><code>PUBLISH_UNPUBLISH_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能もノード</font></font><code>STAGE_UNSTAGE_VOLUME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font><font style="vertical-align: inherit;">もない</font><font style="vertical-align: inherit;">ため、</font></font><code>NodeUnpublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常に完了しました。</font></font></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、ディスクを増やす前に仮想マシンからディスクを切断する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、残念ながら、</font><font style="vertical-align: inherit;">サイドカーによるCSI仕様の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらの要件を満たしていません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><code>csi-attacher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マウント間に必要なギャップがあることに責任を負うはず</font><font style="vertical-align: inherit;">のsidecar-container </font><font style="vertical-align: inherit;">では、この機能はオフラインサイズ変更では実装されません。</font><font style="vertical-align: inherit;">これに関する議論は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から始まり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコンテキストでのサイドカーコンテナーとは何ですか？</font><font style="vertical-align: inherit;">CSIプラグイン自体はKubernetes APIと相互作用しませんが、サイドカーコンテナーが送信するgRPC呼び出しにのみ応答します。</font><font style="vertical-align: inherit;">後者は</font><font style="vertical-align: inherit;">Kubernetesコミュニティ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって開発され</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今回のケース（CSIプラグイン）では、ディスクを増やす操作は次のとおりです。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC呼び出しを受け取ります</font></font><code>ControllerExpandVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> APIでディスクを増やそうとしていますが、ディスクがマウントされているため、操作を実行できないというエラーが表示されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスク識別子は、増加操作を実行する必要があるディスクを含むマップに保存します。</font><font style="vertical-align: inherit;">さらに、簡潔にするために、このマップをと呼び</font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクを使用するポッドを手動で削除します。</font><font style="vertical-align: inherit;">Kubernetesが再起動します。</font><font style="vertical-align: inherit;">マウント</font></font><code>ControllerPublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しようとしたときに増加操作が完了する前に</font><font style="vertical-align: inherit;">ディスクにマウントする時間がないため（</font><font style="vertical-align: inherit;">）、このディスクがまだ残っていることを確認し</font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てエラーを返します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSIドライバーは、サイズ変更操作を再実行しようとしています。</font><font style="vertical-align: inherit;">操作が成功した場合は、からディスクを削除し</font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜなら </font><font style="vertical-align: inherit;">欠けている識別子ディスクは</font></font><code>volumeResizeRequired</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それは</font></font><code>ControllerPublishVolume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ディスクがマウントされ、ポッド開始成功しています。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべては十分に単純に見えますが、いつものように落とし穴があります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部リサイザ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はディスク</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">拡張</font></a><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">関与し</font><font style="vertical-align: inherit;">ます。これは、操作中にエラーが発生した場合、</font><font style="vertical-align: inherit;">最大1000秒のタイムアウト時間で指数関数的に増加</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">するキュー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">使用します</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DefaultControllerRateLimiter</span><span class="hljs-params">()</span> <span class="hljs-title">RateLimiter</span></span> {
  <span class="hljs-keyword">return</span> NewMaxOfRateLimiter(<font></font>
  NewItemExponentialFailureRateLimiter(<span class="hljs-number">5</span>*time.Millisecond, <span class="hljs-number">1000</span>*time.Second),
  <span class="hljs-comment">// 10 qps, 100 bucket size.  This is only for retry speed and its only the overall factor (not per item)</span>
  &amp;BucketRateLimiter{Limiter: rate.NewLimiter(rate.Limit(<span class="hljs-number">10</span>), <span class="hljs-number">100</span>)},<font></font>
  )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、定期的にディスクを増やす操作が15分以上延長され、対応するポッドにアクセスできなくなることがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
潜在的なダウンタイムを簡単かつ苦痛なく削減できる唯一のオプションは、最大タイムアウト制限が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5秒の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョンの外部リサイザを使用することでした</font><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<pre><code class="go hljs">workqueue.NewItemExponentialFailureRateLimiter(<span class="hljs-number">5</span>*time.Millisecond, <span class="hljs-number">5</span>*time.Second)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オフラインでディスクのサイズ変更を行うと、すぐにすべてのクラウドプロバイダーから姿を消すため、ディスカッションを開始して外部リサイザにパッチを適用する必要はないと考えました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使い始めるには？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このドライバーは、Kubernetesバージョン1.15以降でサポートされています。</font><font style="vertical-align: inherit;">ドライバーが機能するには、次の要件を満たす必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグは</font><font style="vertical-align: inherit;">、APIサーバーとkubeletの</font></font><code>--allow-privileged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値に設定され</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"></font><code>--feature-gates=VolumeSnapshotDataSource=true,KubeletPluginsWatcher=true,CSINodeInfo=true,CSIDriverRegistry=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIサーバーとkubeletに</font><font style="vertical-align: inherit;">含ま</font><font style="vertical-align: inherit;">れています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伝播マウント（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マウント伝播</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）がクラスターに含まれている必要があります。</font><font style="vertical-align: inherit;">Dockerを使用する場合、共有マウントが許可されるようにデーモンを構成する必要があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インストール自体に必要なすべての手順は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">READMEで説明されています</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">インストールとは、マニフェストからKubernetesにオブジェクトを作成することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドライバーを機能させるには、次のものが必要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェストでYandex.Cloudカタログディレクトリ（</font></font><code>folder-id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">の識別子を示します</font><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメントを参照</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSIドライバーのYandex.Cloud APIと対話するには、サービスアカウントが使用されます。</font><font style="vertical-align: inherit;">シークレットマニフェストでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">承認済みのキー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をサービスアカウントに</font><font style="vertical-align: inherit;">渡す必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ドキュメントに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サービスアカウントを作成してキーを取得する方法が</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">記載され</font></a><font style="vertical-align: inherit;">ています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">試してみてください。</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題が発生した</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は、</font><font style="vertical-align: inherit;">フィードバックや</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">新しい問題</font></a><font style="vertical-align: inherit;">を受け取って喜んで対応します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらなるサポート</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果として、このCSIドライバーを実装したのは、Goでのアプリケーションの作成を楽しみたいという大きな願望からではなく、社内での緊急の必要性のためです。</font><font style="vertical-align: inherit;">独自の実装をサポートすることはお勧めできないようです。そのため、Yandexが関心を示し、ドライバーのサポートを継続することを決定した場合、喜んでリポジトリを転送します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、おそらく、KubernetesマネージドクラスターのYandexには、オープンソースでリリースできるCSIドライバーの独自の実装があります。</font><font style="vertical-align: inherit;">この開発オプションは私たちにも好意的です。コミュニティは、サードパーティ企業ではなく、サービスプロバイダーからの実績のあるドライバーを使用できるようになります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Kubernetes CCM (Cloud Controller Manager)  .</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     Kubernetes:  Flexvolume  CSI</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Container Storage Interface ( Kubernetes   )</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Kubernetes-   ?  addon-operator</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   Kubernetes (   )</a>».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486178/index.html">FOSSニュースNo. 1-2020年1月27日〜2020年2月2日の無料およびオープンソースニュースのレビュー</a></li>
<li><a href="../ja486180/index.html">サーバーレスアプリケーションを作成するためのヒントとソース</a></li>
<li><a href="../ja486184/index.html">検索を効果的に使用する方法</a></li>
<li><a href="../ja486186/index.html">壊滅的なクラウド：仕組み</a></li>
<li><a href="../ja486188/index.html">PostgreSQL wal-gバックアップシステムの紹介</a></li>
<li><a href="../ja486192/index.html">サイバー詐欺師が携帯電話会社をハッキングして、加入者の電話番号にアクセスする</a></li>
<li><a href="../ja486194/index.html">Proxmox VEのバックアップについて</a></li>
<li><a href="../ja486198/index.html">話すのは難しいです。非プログラマーとのコミュニケーションに関するエッセイ</a></li>
<li><a href="../ja486200/index.html">Dockerのヒント：ジャンクからマシンをクリーンアップする</a></li>
<li><a href="../ja486202/index.html">AlpineはDockerビルドをPythonで50倍遅く収集し、イメージを2倍重い</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>