<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÇÔ∏è ü•ô üë®üèª‚Äçüîß Explore o bug do iOS com o Hopper üë®üèæ‚Äçüéì ü§æüèΩ üë†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°! Meu nome √© Alexander Nikishin, estou desenvolvendo aplicativos iOS no Badoo. No artigo, falarei sobre como investigamos um bug no UIKit, que a Ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Explore o bug do iOS com o Hopper</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/504084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√°! Meu nome √© Alexander Nikishin, estou desenvolvendo aplicativos iOS no Badoo. No artigo, falarei sobre como investigamos um bug no UIKit, que a Apple n√£o quis corrigir por seis meses. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/mh/ea/tmmheaww_pwtz36zltfmiyqgadu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo come√ßou em agosto de 2019 com as primeiras vers√µes beta do iOS 13. Em seguida, encontramos um problema. Nas aplica√ß√µes Badoo e Bumble, estamos constantemente trabalhando para melhorar as interfaces e, por exemplo, tentamos otimizar o processo de registro tedioso e n√£o amado o m√°ximo poss√≠vel. As dicas de ferramentas preditivas sistem√°ticas acima do teclado s√£o uma √≥tima maneira de reduzir o n√∫mero de cliques do usu√°rio ao inserir dados. No entanto, na nova vers√£o do iOS, ficamos surpresos ao descobrir que as solicita√ß√µes para inserir o n√∫mero de telefone haviam desaparecido.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/qh/qe/tp/qhqetpwinu9_mvbd5gms1dyrvu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a vers√£o GM foi lan√ßada, percebemos que o problema n√£o estava resolvido. Pareceu-nos que um erro t√£o √≥bvio simplesmente n√£o poderia ser desperdi√ßado pelos testes de regress√£o, que a Apple provavelmente possu√≠a em seu arsenal, e come√ßamos a esperar por uma corre√ß√£o no primeiro grande pacote de atualiza√ß√£o. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros desenvolvedores esperavam por</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isso </font><font style="vertical-align: inherit;">. No entanto, com o lan√ßamento da vers√£o 13.1, nada mudou e n√£o tivemos escolha a n√£o ser abrir o radar, o que fizemos no in√≠cio de outubro. O tempo passou, o iOS 13.2 e 13.3 saiu e o bug ainda n√£o foi corrigido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em fevereiro, nossa equipe de registro conseguiu um tempo livre trabalhando no backlog e decidi investigar um pouco mais esse problema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßar a cavar, voc√™ tinha que descobrir qual o caminho a fazer. Como as dicas continuaram a funcionar em alguns tipos de teclados, o primeiro pensamento foi estudar a hierarquia de suas visualiza√ß√µes em diferentes vers√µes do iOS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/sw/px/mvswpxpjqpsfjh2bqdcn1vlz8sk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS 12 vs iOS 13</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Imediatamente ficou claro que a Apple no iOS 13 refatorou a implementa√ß√£o do teclado e destacou os prompts em um controlador separado ( </font></font><code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Obviamente, a tend√™ncia para a modulariza√ß√£o e decomposi√ß√£o tamb√©m a alcan√ßou (a prop√≥sito, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Loenko falou</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recentemente sobre nossa experi√™ncia em sua aplica√ß√£o </font><font style="vertical-align: inherit;">). Provavelmente, por causa disso, houve uma regress√£o da funcionalidade. O c√≠rculo de buscas come√ßou a diminuir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acho que a maioria dos desenvolvedores de iOS sabe que √© f√°cil encontrar interfaces de classes de sistema privadas em dom√≠nio p√∫blico: basta inserir uma consulta no mecanismo de pesquisa. No estudo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma interface de classe</font></font></a> <code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no olho, captura um de seus m√©todos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ex/vt/ry/exvtrycfpe8qra7wrgux5khrqka.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
parece que havia uma pista, que √© bastante f√°cil de verificar, usando as boas e antigas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fun√ß√µes de implementa√ß√£o de falsifica√ß√£o de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ferramentas </font><font style="vertical-align: inherit;">(Swizzling). Vamos us√°-lo para que uma fun√ß√£o "sob suspeita" sempre retorne o valor verdadeiro:</font></font><br>
<br>
<pre><code class="objectivec hljs">+(<span class="hljs-keyword">void</span>)swizzleIsVisibleForInputDelegate {<font></font>
    SEL targetSelector = sel_getUid(<span class="hljs-string">"isVisibleForInputDelegate:inputViews:"</span>);<font></font>
    Class targetClass = <span class="hljs-built_in">NSClassFromString</span>(@‚Äù<span class="hljs-built_in">UIPredictionViewController</span>‚Äù);
    <span class="hljs-keyword">if</span> (targetClass == <span class="hljs-literal">nil</span>) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (![targetClass instancesRespondToSelector:targetSelector]) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
<font></font>
    Method method = class_getInstanceMethod(targetClass, targetSelector);<font></font>
    <span class="hljs-keyword">if</span> (method == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
<font></font>
    IMP originalImplementation = method_getImplementation(method);<font></font>
    IMP newImp = imp_implementationWithBlock(^<span class="hljs-built_in">BOOL</span>(<span class="hljs-keyword">id</span> me, <span class="hljs-keyword">id</span> delegate, <span class="hljs-keyword">id</span> views) {
        <span class="hljs-comment">//   ,        . </span>
        <span class="hljs-built_in">BOOL</span> result = ((<span class="hljs-keyword">bool</span> (*)(<span class="hljs-keyword">id</span>,SEL,<span class="hljs-keyword">id</span>,<span class="hljs-keyword">id</span>))originalImplementation)(me, targetSelector, delegate, views);
        <span class="hljs-keyword">if</span> ([delegate isKindOfClass:[<span class="hljs-built_in">UITextField</span> <span class="hljs-keyword">class</span>]] &amp;&amp; [delegate keyboardType] == <span class="hljs-built_in">UIKeyboardTypePhonePad</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    });<font></font>
<font></font>
    method_setImplementation(method, newImp);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reiniciando o projeto de teste, descobri que os prompts do telefone retornavam ao iOS 13 e est√£o funcionando "no modo normal". Isso poderia encerrar a investiga√ß√£o e, talvez, at√© com muito cuidado, usar esta solu√ß√£o de diretrizes da Apple perigosa e proibida no assembly de libera√ß√£o com a capacidade de ativar / desativar remotamente para alguns usu√°rios (para a op√ß√£o de gerenciamento remoto de recursos, voc√™ pode ver a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grava√ß√£o do relat√≥rio da</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> minha colega Katerina Trofimenko). No entanto, nunca deixei de me perguntar por que essa fun√ß√£o retorna falsa ao usar o tipo de teclado do telefone.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para chegar √† verdade, precisamos do c√≥digo fonte da fun√ß√£o. Obviamente, a Apple n√£o distribui o c√≥digo do componente iOS para a direita e para a esquerda, portanto, n√£o √© poss√≠vel fazer uma pesquisa no Google. Existe apenas uma maneira de fazer a engenharia reversa para descompilar o c√≥digo bin√°rio. Antes, eu j√° ouvira falar de um produto como o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v√°rias vezes e lia v√°rios artigos sobre seu uso para aprofundar o conhecimento das bibliotecas de sistemas, mas nunca o usei. E imediatamente fiquei agradavelmente surpreendido: verificou-se que, para brincar e aprender as ferramentas, nem √© necess√°rio comprar a vers√£o completa. A vers√£o demo inclui sess√µes de trabalho intermin√°veis ‚Äã‚Äãde 30 minutos, sem a capacidade de salvar o √≠ndice e fazer altera√ß√µes nos arquivos bin√°rios, o que significa que √© uma excelente plataforma para experimenta√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo do mesmo</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface privada </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">publicada</font></a><font style="vertical-align: inherit;"> , voc√™ pode descobrir o que </font></font><code>UIPredictionViewController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faz parte da estrutura UIKitCore. Tudo o que resta √© encontr√°-lo e envi√°-lo para o Hopper. Arquivos de estrutura bin√°ria est√£o localizados nas profundezas do Xcode. Aqui, por exemplo, est√° o caminho completo para o UIKitCore que precisamos:</font></font><br>
<br>
<pre><code class="plaintext hljs">/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/PrivateFrameworks/UIKitCore.framework/UIKitCore</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criamos um arquivo de arrastar e soltar no Hopper, confirmamos a a√ß√£o na caixa de di√°logo do sistema e aguardamos a conclus√£o da indexa√ß√£o (no caso de uma estrutura t√£o grande como o UIKit, isso pode levar de quatro a seis minutos). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A interface do programa √© bastante simples, observarei apenas os principais elementos necess√°rios para a minha pesquisa. </font><font style="vertical-align: inherit;">No painel esquerdo da interface, voc√™ pode encontrar a linha de pesquisa atrav√©s da qual o c√≥digo √© navegado. </font><font style="vertical-align: inherit;">Ao pesquisar o nome da classe em que estamos interessados, obtemos rapidamente a fun√ß√£o em estudo, seu c√≥digo de assembler √© aberto na janela principal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gi/qf/94/giqf94bvzg42e1zspxys3880gy4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na barra de tarefas superior, existem bot√µes para alternar os modos de exibi√ß√£o de c√≥digo. </font><font style="vertical-align: inherit;">Da esquerda para a direita:</font></font><br>
<br>
<img width="200" src="https://habrastorage.org/webt/ho/i-/ig/hoi-igmtwupaitvjpqolbwckmya.png"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo ASM - c√≥digo do assembler;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo CFG - c√≥digo do assembler na forma de um diagrama de blocos (√°rvore), onde os trechos de c√≥digo s√£o combinados em blocos e as transi√ß√µes s√£o mostradas como ramifica√ß√µes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo pseudo-c√≥digo - o pseudo-c√≥digo gerado (falaremos mais sobre isso abaixo);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O modo hexadecimal √© uma representa√ß√£o hexadecimal de um arquivo bin√°rio, ou abracadabra, que n√£o nos ajuda muito em nossa pesquisa.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ precisa descobrir o que acontece dentro da fun√ß√£o. </font><font style="vertical-align: inherit;">Seu corpo √© bastante longo, ent√£o apenas os gurus do ASM, a quem n√£o posso me chamar, podem entender a l√≥gica observando o c√≥digo do assembler. </font><font style="vertical-align: inherit;">Para fazer isso, o modo pseudo-c√≥digo ajudar√°, no qual Hopper simplifica as opera√ß√µes de montagem o m√°ximo poss√≠vel, substituindo nomes de fun√ß√µes reais sempre que poss√≠vel e usando nomes de registradores como vari√°veis. </font><font style="vertical-align: inherit;">Parece assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ph/0w/cy/ph0wcy7eq21kozwiapjtw3mihuu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta apenas passar pela l√≥gica da fun√ß√£o e entender em qual de seus ramos ca√≠mos. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Pontos de interrup√ß√£o simb√≥licos</font></a><font style="vertical-align: inherit;"> me ajudaram com isso.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que pode ser instalado nas chamadas do sistema, imprimindo simultaneamente todas as vari√°veis ‚Äã‚Äãnecess√°rias e os resultados das chamadas de fun√ß√£o no console do Xcode. Usando essa maneira simples, descobri que a execu√ß√£o da fun√ß√£o √© interrompida por uma sa√≠da antecipada devido ao fato de uma das condi√ß√µes n√£o funcionar no bloco de c√≥digo de exemplo. Vamos descobrir o que est√° acontecendo aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pouco de contexto: no registro rbx, um pouco mais alto no c√≥digo (que eu omiti por simplicidade) √© um link para o objeto que implementa o protocolo </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UITextInputTraits_Private</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(esta √© uma vers√£o estendida do protocolo p√∫blico </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UITextInputTraits</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a primeira das condi√ß√µes √© verificar se os prompts n√£o est√£o ocultos pela configura√ß√£o do campo de entrada. Na depura√ß√£o, voc√™ pode ver que est√° executando: property</font></font><code>hidePrediction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna falso. A segunda condi√ß√£o √© verificar se o teclado n√£o est√° no modo "dividido" (no seu iPad, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pressione o bot√£o inferior direito</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas 2-3% dos usu√°rios sabem disso). Com isso tamb√©m tudo est√° em ordem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ir em frente. No est√°gio seguinte, come√ßam as manipula√ß√µes </font></font><code>keyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que sugere que a verdade est√° em algum lugar pr√≥ximo. Primeiro, √© verificado se o atual √© </font></font><code>keyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menor ou igual a 0xb (ou 11 no formato decimal). Se abrirmos a declara√ß√£o no Xcode </font></font><code>UIKeyboardType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, veremos que existem 13 tipos de teclados e um deles (</font></font><code>UIKeyboardTypeAlphabet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) foi descontinuado e declarado como uma refer√™ncia para outro tipo. Ou seja, existem 12 tipos de enum: se voc√™ come√ßar de 0, o √∫ltimo ter√° um valor igual a 11. Em outras palavras, o c√≥digo valida o valor na forma de uma verifica√ß√£o de estouro e, novamente, passa com √™xito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, vemos uma condi√ß√£o muito estranha </font></font><code>if (!COND)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, durante muito tempo, n√£o consegui entender o que estava verificando, j√° que a vari√°vel COND n√£o foi declarada em nenhum outro lugar do c√≥digo. Al√©m disso, meus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pontos de interrup√ß√£o simb√≥licos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mostraram que √© precisamente a falha em cumprir essa condi√ß√£o que leva a uma sa√≠da antecipada da fun√ß√£o. E aqui n√£o temos escolha a n√£o ser retornar ao modo ASM e estudar esta parte do c√≥digo no formato assembler.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encontrar essa condi√ß√£o na listagem do ASM, voc√™ pode usar a op√ß√£o ‚ÄúSem duplica√ß√£o de c√≥digo‚Äù, que mostrar√° o pseudoc√≥digo n√£o na forma de c√≥digo-fonte com condi√ß√µes if-else, mas na forma de blocos de c√≥digo e transi√ß√µes exclusivos na forma de goto. Nesse caso, veremos a posi√ß√£o do in√≠cio desses blocos no arquivo bin√°rio e usaremos esse ponteiro para pesquisar no modo ASM. Ent√£o, descobri que o bloco em que estamos interessados ‚Äã‚Äãest√° localizado em fe79f4: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/ev/wk/yuevwkuqmhpb5ht5ds2l3mgiz1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando ao modo ASM, podemos encontrar facilmente este bloco: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g1/0e/u4/g10eu4epacglmci1utx7gpue_ii.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chegamos √† parte mais dif√≠cil, onde analisaremos as tr√™s linhas do c√≥digo do montador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reconheci a primeira linha da minha mem√≥ria (gra√ßas √†s li√ß√µes dos montadores em meu MIET nativo, finalmente chegou o momento da minha vida em que o ensino superior foi √∫til!). Tudo √© bem simples aqui: a constante 0x930 (100100110000 em formato bin√°rio) √© colocada no registro ecx. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na segunda linha, vemos a instru√ß√£o bt executada nos registradores </font></font><code>exc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O valor de um que j√° sabemos, o valor do segundo, pode ser visto na captura de tela anterior: </font></font><code>rax = [rbx keyboardType]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- cont√©m o tipo atual de teclado. </font></font><code>rax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- este √© o registro inteiro de 64 bits, </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- esta √© sua parte de 32 bits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com os dados decididos, resta entender a l√≥gica da equipe. O Google nos leva a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta descri√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<blockquote>Selects the bit in a bit string (specified with the first operand, called the bit base) at the bit-position designated by the bit offset operand (second operand) and stores the value of the bit in the CF flag.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A instru√ß√£o extrai um pouco do primeiro operando (constante 0x930) na posi√ß√£o especificada pelo segundo operando (tipo de teclado) e o coloca em CF ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinalizador de transporte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Ou seja, como resultado, o CF conter√° 0 ou 1, dependendo do tipo de teclado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prosseguimos para a √∫ltima opera√ß√£o </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, com a seguinte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descri√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<code>Jump short if below (CF=1)</code> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â f√°cil adivinhar que h√° uma transi√ß√£o para a fun√ß√£o (sa√≠da antecipada) se CF for 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, o quebra-cabe√ßa come√ßa a somar. Temos uma m√°scara de bits 100100110000 (cont√©m 12 bits de acordo com o n√∫mero de tipos de teclado dispon√≠veis) e determina a condi√ß√£o para sa√≠da antecipada. Agora, se verificarmos a disponibilidade de dicas para todos os tipos de teclados em ordem crescente </font></font><code>rawValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tudo estar√° no lugar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/gm/xw/yjgmxwjm7pes1dooauar9gksqxm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No iOS 12, n√£o encontraremos essa l√≥gica - as dicas funcionam para qualquer tipo de teclado. Eu suspeito que, no iOS 13, a Apple decidiu desativar as dicas para teclados digitais, o que √© compreens√≠vel em princ√≠pio: n√£o consigo criar um cen√°rio em que o sistema precise solicitar n√∫meros. Aparentemente, por engano, uma ‚Äúm√£o quente‚Äù tamb√©m atingiu </font></font><code>UIKeyboardTypePhonePad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que √© muito semelhante a um teclado num√©rico comum. Ao mesmo tempo </font></font><code>UIKeyboardTypeNamePhonePad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, combinando um teclado QWERTY para procurar contatos telef√¥nicos e exatamente o mesmo teclado digital desativado, ele continuou a mostrar avisos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minha surpresa, trabalhar com Hopper acabou sendo muito agrad√°vel e divertido, por um longo tempo eu n√£o recebi tanto f√£. </font><font style="vertical-align: inherit;">Compartilhei as descobertas com os engenheiros da Apple no meu relat√≥rio de erros e seu status mudou com o tempo para "Corre√ß√£o potencial identificada - para uma futura atualiza√ß√£o do sistema operacional". </font><font style="vertical-align: inherit;">Espero que a corre√ß√£o alcance os usu√°rios em futuras atualiza√ß√µes. </font><font style="vertical-align: inherit;">Ao mesmo tempo, o Hopper pode ser usado n√£o apenas para encontrar as causas dos seus erros ou da Apple, mas tamb√©m para detectar corre√ß√µes da Apple para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programas de terceiros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt504070/index.html">Estudante de gradua√ß√£o resolveu um problema topol√≥gico h√° meio s√©culo</a></li>
<li><a href="../pt504072/index.html">Contrato ideal do usu√°rio: como minimizar os riscos para os desenvolvedores</a></li>
<li><a href="../pt504074/index.html">Glass Nightmare: Limpando a heran√ßa nuclear da Guerra Fria de Hanford</a></li>
<li><a href="../pt504080/index.html">Como os funcion√°rios da Apple e do Google ajudam os funcion√°rios da √°rea de sa√∫de a acompanhar o coronav√≠rus juntos</a></li>
<li><a href="../pt504082/index.html">O que faremos com os 1,2 GHz adicionais?</a></li>
<li><a href="../pt504086/index.html">Simuladores de sistemas de computadores - eles parecem realidade</a></li>
<li><a href="../pt504088/index.html">Registro Avan√ßado do Windows. Procurando por mimikatz</a></li>
<li><a href="../pt504092/index.html">Uma primeira olhada nos registros e tuplas JavaScript</a></li>
<li><a href="../pt504096/index.html">Maneira ideal para iniciantes em C ++ / Qt</a></li>
<li><a href="../pt504098/index.html">V√≠deo Dipfake um quadro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>