<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚩 👨‍👨‍👧‍👦 📡 About mutable methods of a Math object in JavaScript 📇 🤛🏿 🗨️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we are publishing a translation of an article on mathematical calculations in JavaScript, which is a written version of its author’s presentatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>About mutable methods of a Math object in JavaScript</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/489826/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Today we are publishing a translation of an article on mathematical calculations in JavaScript, which is a written version of its author’s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">WaffleJS</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And this statement itself was a bit of a continuation of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conversation on Twitter.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c50/bea/705/c50bea705dc18becfec75951a06de4df.jpg"></div></a><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math education</font></font></font></i><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interest in math</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It all started with my mathematical education, with the receipt of which I delayed somewhat. When I studied computer science, I could communicate with world-class mathematics teachers, but I missed this opportunity. I did not like math: the topics studied were very far from practice. In addition, I was already out of balance by a deeply theoretical program of computer training. I then believed that she was divorced from life, and, for the most part, I continue to think so. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But now, a few years after I completed my studies, a thirst for learning mathematics woke up in me. I was inspired by what effect even a small application of mathematical knowledge can have on my work and on my hobby. But I did not have a clear study plan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then, in 2012, I found a way to study math by starting work on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Statistics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font><font style="vertical-align: inherit;">. Since then I have expanded and supported this project. Now it includes implementations of many algorithms; it turned out to be one of the most “ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starry</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” mathematical JavaScript libraries. And, apparently, people really use this library. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But I started work in 2012. If we talk about how technology has changed over this time, then it was a very, very long time ago. Since then, 8 LTS releases of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> have been released </font><font style="vertical-align: inherit;">. Since then, JavaSript itself and the environments in which programs written in this language work have changed a lot. In 2012, the React library did not yet exist, then the first commit to the Babel project was not yet made.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d8/832/415/5d8832415ee3bf56c1f3a18e294f39fb.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The passage of time</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Over the years, I noticed that my tests crashed when updating Node.js. </font><font style="vertical-align: inherit;">For example, I might have something like this test:</font></font><br>
<br>
<pre><code class="javascript hljs">t.equal(ss.gamma(<span class="hljs-number">11.54</span>), <span class="hljs-number">13098426.039156161</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This test works fine in Node.js v10, but breaks in Node.js v12. </font><font style="vertical-align: inherit;">And here it’s not some super-complicated method that is tested: the function is </font></font><code>gamma</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implemented using standard JavaScript functions - </font></font><code>Math.pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.sqrt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arithmetic</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I know what you can think of here: arithmetic. </font><font style="vertical-align: inherit;">On Twitter, heated discussions periodically flare up due to the results of calculating the following expression:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> = <span class="hljs-number">0.30000000000000004</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, as I already </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wrote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , all popular programming languages ​​behave this way, even old-fashioned and pedantic ones like Haskell. </font><font style="vertical-align: inherit;">Floating-point arithmetic may look strange, but they behave the same, their behavior is well-documented. </font><font style="vertical-align: inherit;">Namely, we are talking about the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IEEE 754</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> standard </font><font style="vertical-align: inherit;">, the requirements of which are strictly implemented in programming languages. </font><font style="vertical-align: inherit;">So, then the problem is not arithmetic: the implementation of addition, subtraction, division and multiplication in languages, programming can be said to be “carved in stone”.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math object</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My problem was in the standard JavaScript object </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In particular, in all </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">methods of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this object. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Techniques such as </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.cos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Math.tan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- is the basic ingredients for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geometric</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and other calculations. </font><font style="vertical-align: inherit;">When I understood this, I began to separately study the changes in the behavior of the basic methods of the object </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in different versions of Node.js. </font><font style="vertical-align: inherit;">Here are some examples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calculation </font></font><code>Math.tanh(0.1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Node 4</span>
<span class="hljs-number">0.09966799462495590234</span>
<span class="hljs-comment">// Node 6</span>
<span class="hljs-number">0.09966799462495581907</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Calculation </font></font><code>Math.pow(1/3, 3)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// Node 10</span>
<span class="hljs-number">0.03703703703703703498</span>
<span class="hljs-comment">// Node 12</span>
<span class="hljs-number">0.03703703703703702804</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even worse, this problem is not only apparent in Node.js. </font><font style="vertical-align: inherit;">The same thing happens in browsers, and in other environments that support JavaScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This leads us to the following question: what is mathematical calculation?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a45/45e/f7c/a4545ef7cf6e282546aee3ea506d762f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphical representation of calculations</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Trigonometric methods are easy to visualize. If you have a single circle and several months of high school at your disposal, then you know that the cosine and sine are the coordinates of a certain point on the edge of the circle, and that the graphs of the functions sin and cos look like waves. In fact, in high school they are studying how to obtain these values, but the method used for this - the</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taylor series</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - relies on an infinite series, and it is not easy for a computer to solve such problems.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's what you can learn from</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regarding the sine calculation algorithm: “There is no standard algorithm for calculating the sine. IEEE 754-2008, the most widely used standard for floating point calculations, does not affect the calculation of trigonometric functions like a sine. " </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Computers use many different approximations and algorithms to perform calculations, something like </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORDIC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , all sorts of tricky tricks and lookup tables. All this heterogeneity explains the presence of many </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fastmath libraries</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on GitHub </font><font style="vertical-align: inherit;">. The fact is that there are many ways to implement the method </font></font><code>Math.sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. And other functions too. For example, as you know, Quake III Arena used a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">replacing the standard inverse square root calculation method to speed up rendering. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, mathematical calculations are the result of the implementation of certain algorithms. In practice, many common algorithms and their variants are used. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The JavaScript specification, instead of specifying which particular algorithm to use in language implementations, gives implementations a lot of room for maneuver in terms of functions used in mathematical calculations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is what the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> says about this </font><font style="vertical-align: inherit;">(ECMA-262, 10 edition, section 20.2.2):</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"The behavior of the functions acos, acosh, asin, asinh, atan, atanh, atan2, cbrt, cos, cosh, exp, expm1, hypot, log, log1p, log2, log10, pow, random, sin, sinh, sqrt, tan and tanh it is not fully described here, with the exception of the requirements for the return of certain results for specific values ​​of the arguments, which are noteworthy boundary cases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I don’t know how the internal activities of the members of the committee responsible for the ECMA-262 standard work, but I believe that they made the standard so that there would not be a compatibility crisis in JavaScript if Intel or AMD issued new ultrafast mathematical instructions in their fresh processors.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the fact that there are many widely used JavaScript interpreters, due to the fact that JavaScript is often used in browsers, and between browsers there is still something like competition, and due to the fact that even popular JavaScript implementations are under constant pressure and forced to evolve quickly, providing the best performance ... because of all this, we have what we have. </font><font style="vertical-align: inherit;">Anyone who uses JavaScript will regularly experience the fact that in different implementations the results of mathematical calculations performed by the means of the object </font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are different. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is not as significant in other interpreted languages, since they usually have some “canonical” implementations. </font><font style="vertical-align: inherit;">For example, this is true for the Python interpreter.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where are the calculations performed?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's take a closer look at exactly where the calculations are performed. </font><font style="vertical-align: inherit;">In the case of JavaScript, there are three areas in which basic mathematical calculations are performed:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Language interpreter (C ++ and C code of a specific JavaScript implementation).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript code, for example, code for specialized libraries.</font></font></li>
</ol><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍1. </font><font style="vertical-align: inherit;">CPU</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first idea that came to my mind when I thought about the places where the calculations are made was that the calculations are performed in the processor. I suggested that since processors implement arithmetic calculations, they can also implement some more complex calculations. It turned out that the processors have instructions for performing trigonometric and other calculations, but these instructions are rarely used. For example, the implementation of the sine calculation in processors with x86 architecture was not very popular, since this implementation does not necessarily turn out to be faster than software implementations (those that use processor arithmetic operations). In addition, it is not necessarily more accurate than software implementations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intel also suffered a shame due to the very strong</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overestimation of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> accuracy of trigonometric operations in the documentation. </font><font style="vertical-align: inherit;">Such errors are especially tragic due to the fact that a microchip, unlike a program, cannot be patched.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍2. </font><font style="vertical-align: inherit;">Language interpreter</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how the computing subsystems work in most JavaScript implementations. </font><font style="vertical-align: inherit;">They implement these subsystems in various ways.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The V8 and SpiderMonkey engines use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fdlibm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library ports for calculations </font><font style="vertical-align: inherit;">, which are slightly different. </font><font style="vertical-align: inherit;">This library, originally written at Sun Microsystems, has been handed down from generation to generation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptCore (Safari) uses the cmath library to perform most operations.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer uses both cmath and some blocks of code written in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assembler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Here even trigonometric methods of processors were used - in the event that the browser was compiled for processors that had similar instructions.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For historical reasons, the tools used to perform calculations in different JS engines have changed. </font><font style="vertical-align: inherit;">So, V8 used its own solution for calculations, then the </font><font style="vertical-align: inherit;">fdlibm </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript port was</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used, and only then the C version of fdlibm was used.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Why is this a problem?</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The point here is that all this reduces the ability of JavaScript to produce uniform results in solving any problems involving mathematical calculations. </font><font style="vertical-align: inherit;">This is especially hard on Data Science. </font><font style="vertical-align: inherit;">I would like JavaScript to be better suited for doing Data Science calculations in a browser. </font><font style="vertical-align: inherit;">Moreover, the inability to produce uniform results means the aggravation of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the reproducibility crisis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is characteristic of all sciences. </font><font style="vertical-align: inherit;">This is not to mention some other JavaScript problems, such as features of typing numbers and the lack of a widely used library for working with data frames.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍3. </font><font style="vertical-align: inherit;">Using specialized libraries</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a reliable way for us to do the calculations in JavaScript. It consists in using specialized libraries. So, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stdlib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">implements high-level calculations using only arithmetic operations. Arithmetic calculations are fully described in the specifications, they are standard, so the results returned by stdlib give us, regardless of the platform on which the code is executed, completely uniform results. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is achieved at the cost of complexity and speed of decisions. The stdlib methods are not as fast as the built-in methods. In addition, in order to "just count the sine", you need to connect a whole library to the project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, if you think more broadly, this is completely normal. The WebAssembly platform, for example, does not give the programmer any means to perform high-level mathematical calculations. In the documentation for it, it is recommended that you independently include implementations of the corresponding mechanisms in your own modules: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“WebAssembly does not include its own implementations of mathematical functions — like sin, cos, exp, pow, and so on. WebAssembly's strategy for such functions is to allow developers to implement them as library tools in the WebAssembly platform itself (note that the x86 platform's sin and cos instructions are slow and inaccurate, and these days, anyway, try not to use). ”</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how compiled languages ​​always worked: when a program written in C is compiled, methods imported from </font></font><code>math.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are included in the compiled program.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using epsilon Value</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If someone doesn’t want to include the stdlib library in his JavaScript project for performing calculations, but needs to test the code that performs some complex calculations, then he probably should resort to the method that is already used in the simple-statistics library. It is about using a value </font></font><code>epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that defines the boundaries within which the differences in numbers are not taken into account. If we consider the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">options for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the epsilon symbol in mathematics, then we can say that I am talking about it as an “arbitrary small positive value”. Simple-statistics </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the epsilon value of equal </font></font><code>0.0001</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you need to find out if two numbers are equal, a condition of the form is checked</font></font><code>Math.abs(result — expected) &lt; epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If this condition turns out to be true, then we can say that the difference between the numbers falls within the given range and consider them equal.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additions</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Accuracy</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commentators on Twitter pointed out that the variations in the results obtained in the example are outside the range of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significant digits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of the floating point number. </font><font style="vertical-align: inherit;">From a technical point of view, this is correct, and this means that you can find a more accurate way to compare numbers than the one that involves using a value </font></font><code>epsilon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">But in practice the same story here - the numbers at the end of the number affect the result and introduce inaccuracies in the final result. </font><font style="vertical-align: inherit;">In addition, the examples given here are not exhaustive. </font><font style="vertical-align: inherit;">The fact is that the implementation features of JavaScript interpreters can, without departing from the specification, lead to the appearance of differences in most of the numerical results.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍JavaScript</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not want to criticize JavaScript. </font><font style="vertical-align: inherit;">I believe that JavaScript made a justifiable compromise, taking into account the uncertainty of the future and the number of platforms on which language implementations are created. </font><font style="vertical-align: inherit;">I must say, it is very difficult to directly compare JavaScript and other languages. </font><font style="vertical-align: inherit;">The point is the JavaScript ecosystem. </font><font style="vertical-align: inherit;">The fact that at the same time there are many interpreters of the same language is completely atypical for other languages. </font><font style="vertical-align: inherit;">And this, in addition, is one of the main strengths of JavaScript. </font><font style="vertical-align: inherit;">Further, one cannot fail to say that these are phenomena of a completely different plan than those that occur in the language itself. </font><font style="vertical-align: inherit;">And JavaScript changes over time and a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lot of good things</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> appear in it </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Stdlib or epsilon?</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I believe that in practice in most cases it is worth using the approach that implies the use of the epsilon value. </font><font style="vertical-align: inherit;">The stdlib library is a wonderful powerful tool, but the price of including an additional library for mathematical calculations in the project can be quite high. </font><font style="vertical-align: inherit;">And in most cases, small discrepancies in the results of calculations do not matter for applications.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here I would like to draw conclusions from the foregoing and share some thoughts.</font></font><br>
<br>
<ol>
<li>,     ,   ,    .         .     —    « ». ,   ,   ,   <code>Math.sin</code>   ,   ,      ,      .      ,   ,      ,   ,   ,   .    ,       ,   ,       .</li>
<li>      . ,   ,       Node.js,         ,    ,     simply-statistics.    ,    , ,     ,      .  —    .</li>
<li>  ,    .    V8,      ,   .    ,    .    , ,         ,     .</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dear readers! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have you encountered problems regarding changes in calculation results when upgrading to new versions of Node.js?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489812/index.html">Configure LDAP in Oracle BI</a></li>
<li><a href="../en489818/index.html">JavaScript and more: 4 creative approaches to measuring time in browsers</a></li>
<li><a href="../en489820/index.html">Styling the good old button element</a></li>
<li><a href="../en489822/index.html">Generating pseudo-random numbers using a cellular automaton: Rule 30</a></li>
<li><a href="../en489824/index.html">7 open source cloud security monitoring tools worth knowing</a></li>
<li><a href="../en489828/index.html">Working with GeoJSON in Node.js: a practical introduction</a></li>
<li><a href="../en489832/index.html">Man-made atomic beads: manipulations with macrocycles</a></li>
<li><a href="../en489834/index.html">Embed your Smart Home device in the SmartThings ecosystem</a></li>
<li><a href="../en489836/index.html">Lidars of the future: 11,000 lasers instead of 128</a></li>
<li><a href="../en489838/index.html">Nuxt Server-Side Memory Leak Using SSR (Server Side Rendering)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>