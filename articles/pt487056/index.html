<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå≥ üë©üèø‚Äçü§ù‚Äçüë®üèΩ üçç √â perigoso manter o RDP aberto na Internet? üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø üé≠ üìÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Frequentemente, leio a opini√£o de que manter a porta RDP (Protocolo de √Årea de Trabalho Remota) aberta na Internet √© muito insegura e voc√™ n√£o precisa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>√â perigoso manter o RDP aberto na Internet?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487056/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frequentemente, leio a opini√£o de que manter a porta RDP (Protocolo de √Årea de Trabalho Remota) aberta na Internet √© muito insegura e voc√™ n√£o precisa. </font><font style="vertical-align: inherit;">E voc√™ precisa conceder acesso ao RDP por meio de uma VPN ou apenas de determinados endere√ßos IP "brancos".</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administro v√°rios Windows Server para pequenas empresas, nas quais fui encarregado de fornecer acesso remoto ao Windows Server para contadores. </font><font style="vertical-align: inherit;">Uma tend√™ncia t√£o moderna √© trabalhar em casa. </font><font style="vertical-align: inherit;">Rapidamente, percebi que atormentar os contadores da VPN √© uma tarefa ingrata, e coletar todos os IPs da lista de desbloqueio n√£o funcionar√°, porque os endere√ßos IP das pessoas s√£o din√¢micos.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, segui o caminho mais simples - encaminhei a porta RDP. </font><font style="vertical-align: inherit;">Agora, para acessar, os contadores precisam executar o RDP e inserir o nome do host (incluindo porta), nome de usu√°rio e senha.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neste artigo, compartilharei minha experi√™ncia (positiva e n√£o t√£o boa) e recomenda√ß√µes.</font></font></p><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os riscos</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais s√£o os riscos de abrir a porta RDP?</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Acesso n√£o autorizado a dados confidenciais:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
se algu√©m selecionar uma senha para o RDP, ele poder√° obter os dados que voc√™ deseja manter privados: status da conta, saldos, dados do cliente, ...</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Perda de dados, por</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
exemplo, como resultado da opera√ß√£o de um v√≠rus criptogr√°fico. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou a√ß√£o direcionada de um invasor.</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Perda da esta√ß√£o de trabalho: os</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
trabalhadores precisam trabalhar e o sistema est√° comprometido, √© preciso reinstalar / restaurar / configurar.</font></font></p><br>
<p><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Compromisso da rede local</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se um invasor obtiver acesso a um computador com Windows, a partir desse computador, ele poder√° acessar sistemas que n√£o s√£o acess√≠veis de fora, da Internet. </font><font style="vertical-align: inherit;">Por exemplo, para arquivar bolas, para impressoras de rede etc.</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu tive um caso em que o Windows Server pegou um cryptor</font></font></b><div class="spoiler_text"><p>         C:,       NAS  .   NAS  Synology,   snapshots,  NAS    5 ,  Windows Server   .</p></div></div><br>
<h3>  </h3><br>
<p>  Windows Servers   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Winlogbeat</a>,     ElasticSearch.  Kibana   ,       .<br>
   ,      .</p><br>
<p>  :<br>
<b>a) RDP  -.</b><br>
     RDP      3389,  443 ‚Äî     HTTPS.    ,  ,     .     :</p><br>
<img src="https://habrastorage.org/webt/oc/mw/2k/ocmw2kyswnbz7foc09-2-z1ln-q.png" alt="Logs do Windows em Kibana"><br>
<p>,      400 000     RDP.<br>
,      55 001 IP  ( IP     ).</p><br>
<p>     ,    fail2ban,  </p><br>
<div class="spoiler"><b class="spoiler_title"> Windows   - .</b><div class="spoiler_text"><p>     ,     ,       :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/glasnt/wail2ban</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/EvanAnderson/ts_block</a></p><br>
<p>   ,     .</p><br>
<p>        ‚Äî   .</p></div></div><br>
<p><strong>Update</strong>:   ,   443 ‚Äî  ,      (32000+),   443  ,   RDP    ‚Äî  .</p><br>
<p><strong>Update:</strong>   ,    :<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/digitalruby/ipban</a></p><br>
<p>  IPBan,     :<br>
<img src="https://habrastorage.org/webt/oq/q1/ir/oqq1irnzeagwsqnbfpe4gbl9f_o.jpeg" alt="imagem"></p><br>
<div class="spoiler"><b class="spoiler_title"> IPBan   </b><div class="spoiler_text"><p>2020-02-11 00:01:18.2517|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.228,, RDP, 1<br>
2020-02-11 00:01:18.2686|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.228, Administrator, RDP, 2<br>
2020-02-11 00:02:49.7098|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147,, RDP, 3<br>
2020-02-11 00:02:49.7098|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147, Administrator, RDP, 4<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.184.20,, RDP, 5<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 95.213.184.20, user name:, config black listed: False, count: 5, extra info:<br>
2020-02-11 00:04:20.9878|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.184.20, Administrator, RDP, 5<br>
2020-02-11 00:04:21.0040|WARN|DigitalRuby.IPBanCore.Logger|IP 95.213.184.20, Administrator, RDP ban pending.<br>
2020-02-11 00:04:21.1237|WARN|DigitalRuby.IPBanCore.Logger|Updating firewall with 1 entries‚Ä¶<br>
2020-02-11 00:05:36.6525|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.24,, RDP, 3<br>
2020-02-11 00:05:36.6566|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 31.131.251.24, Administrator, RDP, 4<br>
2020-02-11 00:07:22.4729|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225, Administrator, RDP, 3<br>
2020-02-11 00:07:22.4894|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225,, RDP, 4<br>
2020-02-11 00:08:53.1731|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 45.141.86.141,, RDP, 3<br>
2020-02-11 00:08:53.1731|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 45.141.86.141, Administrator, RDP, 4<br>
2020-02-11 00:09:23.4981|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 68.129.202.154,, RDP, 1<br>
2020-02-11 00:09:23.5022|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 68.129.202.154, ADMINISTRATOR, RDP, 2<br>
2020-02-11 00:10:39.0282|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147,, RDP, 5<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 95.213.143.147, user name:, config black listed: False, count: 5, extra info:<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 95.213.143.147, Administrator, RDP, 5<br>
2020-02-11 00:10:39.0336|WARN|DigitalRuby.IPBanCore.Logger|IP 95.213.143.147, Administrator, RDP ban pending.<br>
2020-02-11 00:10:39.1155|WARN|DigitalRuby.IPBanCore.Logger|Updating firewall with 1 entries‚Ä¶<br>
2020-02-11 00:12:09.6470|WARN|DigitalRuby.IPBanCore.Logger|Login failure: 82.202.249.225,, RDP, 5<br>
2020-02-11 00:12:09.6470|WARN|DigitalRuby.IPBanCore.Logger|Banning ip address: 82.202.249.225, user name:, config black listed: False, count: 5, extra info: </p></div></div><br>
<p><b>b)   username,   </b><br>
,        .<br>
    :    ‚Äî    ,  . :         . ,      - :      DESKTOP-DFTHD7C       DFTHD7C:</p><br>
<img src="https://habrastorage.org/webt/4i/pp/2b/4ipp2bcvy1zml2ero2hwur2_hnu.png" alt="imagem"><br>
<p>,      DESKTOP-MARIA,         MARIA.</p><br>
<p>,     :   ,    ‚Äî    "administrator".   ,      Windows,   . </p><br>
<div class="spoiler"><b class="spoiler_title">  -   .</b><div class="spoiler_text"><p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts#administrator-account</a><br>
Administrator account<br>
The default local Administrator account is a user account for the system administrator. Every computer has an Administrator account (SID S-1-5-domain-500, display name Administrator). The Administrator account is the first account that is created during the Windows installation.</p><br>
<p>The Administrator account has full control of the files, directories, services, and other resources on the local computer. The Administrator account can create other local users, assign user rights, and assign permissions. The Administrator account can take control of local resources at any time simply by changing the user rights and permissions.</p><br>
<p>The default Administrator account cannot be deleted or locked out, but it can be renamed or disabled.</p></div></div><br>
<p>    :         .<br>
  ,        Administrator   Murmansk#9.     ,    ,          ,  ,   ‚Äî .<br>
   Administrator  ,    ?   !</p><br>
<p>   : </p><br>
<ul>
<li>      </li>
<li>,      Administrator</li>
<li>  </li>
</ul><br>
<p>  ,  ,   Windows Server    -  -  ,  .</p><br>
<p>  ,  ?<br>
     ,       RDP,    :</p><br>
<ul>
<li>  IP</li>
<li>   (hostname)</li>
<li> </li>
<li>GeoIP </li>
</ul><br>
<p>     ‚Äî   .</p><br>
<p>,   - IP -  ,    IP ( )     PowerShell:</p><br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-NetFirewallRule</span> <span class="hljs-literal">-Direction</span> Inbound <span class="hljs-literal">-DisplayName</span> <span class="hljs-string">"fail2ban"</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">"fail2ban"</span> <span class="hljs-literal">-RemoteAddress</span> (<span class="hljs-string">"185.143.0.0/16"</span>, <span class="hljs-string">"185.153.0.0/16"</span>, <span class="hljs-string">"193.188.0.0/16"</span>) <span class="hljs-literal">-Action</span> Block</code></pre><br>
<p>  Elastic,  Winlogbeat   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Auditbeat</a>,         .   SIEM (Security Information &amp; Event Management)   Kibana.      ,      ‚Äî  Auditbeat     Linux ,  SIEM      .</p><br>
<p>   :</p><br>
<ul>
<li>   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">colocar as atualiza√ß√µes de seguran√ßa no prazo</font></font></li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B√¥nus: uma lista dos 50 usu√°rios mais frequentemente usados ‚Äã‚Äãpara tentativas de login via RDP</font></font></b><div class="spoiler_text"><div class="scrollable-table"><table>
<thead>
<tr>
<th>Ôªø"user.name: Descending"</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>dfthd7c (hostname)</td>
<td>842941</td>
</tr>
<tr>
<td>winsrv1 (hostname)</td>
<td>266525</td>
</tr>
<tr>
<td>ADMINISTRATOR</td>
<td>180678</td>
</tr>
<tr>
<td>administrator</td>
<td>163842</td>
</tr>
<tr>
<td>Administrator</td>
<td>53541</td>
</tr>
<tr>
<td>michael</td>
<td>23101</td>
</tr>
<tr>
<td>server</td>
<td>21983</td>
</tr>
<tr>
<td>steve</td>
<td>21936</td>
</tr>
<tr>
<td>john</td>
<td>21927</td>
</tr>
<tr>
<td>paul</td>
<td>21913</td>
</tr>
<tr>
<td>reception</td>
<td>21909</td>
</tr>
<tr>
<td>mike</td>
<td>21899</td>
</tr>
<tr>
<td>office</td>
<td>21888</td>
</tr>
<tr>
<td>scanner</td>
<td>21887</td>
</tr>
<tr>
<td>scan</td>
<td>21867</td>
</tr>
<tr>
<td>david</td>
<td>21865</td>
</tr>
<tr>
<td>chris</td>
<td>21860</td>
</tr>
<tr>
<td>owner</td>
<td>21855</td>
</tr>
<tr>
<td>manager</td>
<td>21852</td>
</tr>
<tr>
<td>administrateur</td>
<td>21841</td>
</tr>
<tr>
<td>brian</td>
<td>21839</td>
</tr>
<tr>
<td>administrador</td>
<td>21837</td>
</tr>
<tr>
<td>mark</td>
<td>21824</td>
</tr>
<tr>
<td>staff</td>
<td>21806</td>
</tr>
<tr>
<td>ADMIN</td>
<td>12748</td>
</tr>
<tr>
<td>ROOT</td>
<td>7772</td>
</tr>
<tr>
<td>ADMINISTRADOR</td>
<td>7325</td>
</tr>
<tr>
<td>SUPPORT</td>
<td>5577</td>
</tr>
<tr>
<td>SOPORTE</td>
<td>5418</td>
</tr>
<tr>
<td>USER</td>
<td>4558</td>
</tr>
<tr>
<td>admin</td>
<td>2832</td>
</tr>
<tr>
<td>TEST</td>
<td>1928</td>
</tr>
<tr>
<td>MySql</td>
<td>1664</td>
</tr>
<tr>
<td>Admin</td>
<td>1652</td>
</tr>
<tr>
<td>GUEST</td>
<td>1322</td>
</tr>
<tr>
<td>USER1</td>
<td>1179</td>
</tr>
<tr>
<td>SCANNER</td>
<td>1121</td>
</tr>
<tr>
<td>SCAN</td>
<td>1032</td>
</tr>
<tr>
<td>ADMINISTRATEUR</td>
<td>842</td>
</tr>
<tr>
<td>ADMIN1</td>
<td>525</td>
</tr>
<tr>
<td>BACKUP</td>
<td>518</td>
</tr>
<tr>
<td>MySqlAdmin</td>
<td>518</td>
</tr>
<tr>
<td>RECEPTION</td>
<td>490</td>
</tr>
<tr>
<td>USER2</td>
<td>466</td>
</tr>
<tr>
<td>TEMP</td>
<td>452</td>
</tr>
<tr>
<td>SQLADMIN</td>
<td>450</td>
</tr>
<tr>
<td>USER3</td>
<td>441</td>
</tr>
<tr>
<td>1</td>
<td>422</td>
</tr>
<tr>
<td>MANAGER</td>
<td>418</td>
</tr>
<tr>
<td>OWNER</td>
<td>410</td>
</tr>
</tbody>
</table></div></div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt487056/">https://habr.com/ru/post/pt487056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487042/index.html">Ryzen Threadripper 3990X de 64 n√∫cleos derrota todos os processadores Intel em testes, incluindo US $ 20.000 em Xeon</a></li>
<li><a href="../pt487044/index.html">Privacidade? N√£o n√£o ouvi</a></li>
<li><a href="../pt487046/index.html">Como criar uma biblioteca nativa para Android</a></li>
<li><a href="../pt487052/index.html">Kaboom: um sapador incomum</a></li>
<li><a href="../pt487054/index.html">ROS: Dedicado aos presos no Gazebo ... Plataforma para um rob√¥ por 28.000 rublos</a></li>
<li><a href="../pt487058/index.html">"Hadoop. ZooKeeper ‚Äùda s√©rie Technostream do Mail.Ru Group‚Äú Processamento Distribu√≠do de Dados Grandes no Hadoop ‚Äù</a></li>
<li><a href="../pt487060/index.html">Voc√™ est√° usando o Google Chrome? Ent√£o, o Google coleta seus dados por meio de dados de clientes-X</a></li>
<li><a href="../pt487062/index.html">A CBS permitiu que os usu√°rios do Linux assistissem a Star Trek, gra√ßas a ela por isso</a></li>
<li><a href="../pt487064/index.html">Meu segundo ano como desenvolvedor independente</a></li>
<li><a href="../pt487066/index.html">Trabalhar com o chip chin√™s ADC Hx711</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>