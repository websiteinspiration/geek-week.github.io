<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚öïÔ∏è ü§∏üèº üî° HighLoad ++, Mikhail Tyulenev (MongoDB): Coh√©rence causale: de la th√©orie √† la pratique üîö üíáüèΩ ü¶ï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La prochaine conf√©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 √† Saint-P√©tersbourg. 
 D√©tails et billets ici . HighLoad ++ Siberia 2019. Salle "...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Tyulenev (MongoDB): Coh√©rence causale: de la th√©orie √† la pratique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/487638/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine conf√©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 √† Saint-P√©tersbourg. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©tails et billets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Siberia 2019. Salle "Krasnoyarsk". 25 juin, 12h00. R√©sum√©s et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ok/iw/mz/okiwmzx4qkp6dxvjvqjxvfzqtnk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il arrive que des exigences pratiques entrent en conflit avec une th√©orie o√π les aspects importants pour un produit commercial ne sont pas pris en compte. Ce rapport pr√©sente le processus de s√©lection et de combinaison de diff√©rentes approches pour cr√©er des composants de coh√©rence causale bas√©s sur la recherche universitaire bas√©e sur les exigences d'un produit commercial. Les √©tudiants apprendront les approches th√©oriques existantes des horloges logiques, le suivi des d√©pendances, la s√©curit√© du syst√®me, la synchronisation d'horloge et pourquoi MongoDB s'est arr√™t√© sur telle ou telle solution.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Tyulenev (ci-apr√®s - MT):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vais parler de coh√©rence causale - c'est une fonctionnalit√© sur laquelle nous avons travaill√© dans MongoDB. </font><font style="vertical-align: inherit;">Je travaille dans un groupe de syst√®mes distribu√©s, nous l'avons fait il y a environ deux ans. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ih/xx/xg/ihxxxghkrknnqdxg7tb4w97izi0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le processus, j'ai d√ª me familiariser avec beaucoup de recherches acad√©miques, car cette fonctionnalit√© est bien √©tudi√©e. </font><font style="vertical-align: inherit;">Il s'est av√©r√© que pas un seul article ne correspond √† ce qui est requis dans la production, la base de donn√©es compte tenu des exigences tr√®s sp√©cifiques qui se trouvent probablement dans toutes les applications de production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais parler de la fa√ßon dont nous, en tant que consommateur de recherche universitaire, en pr√©parons quelque chose que nous pouvons ensuite pr√©senter √† nos utilisateurs comme un plat pr√™t √† l'emploi qui est pratique, s√ªr √† utiliser.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coh√©rence causale. </font><font style="vertical-align: inherit;">D√©finissons les concepts</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, je veux d√©crire en termes g√©n√©raux ce qu'est la coh√©rence causale. Il y a deux personnages - Leonard et Penny (la s√©rie "The Big Bang Theory"): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/nw/lr/7qnwlrmqtidow8cl_jrdakec3d0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que Penny soit en Europe, et Leonard veut faire une sorte de surprise pour elle, une f√™te. Et il ne pense √† rien de mieux que de la jeter hors de la liste d'amis, d'envoyer √† tous ses amis une mise √† jour sur le flux: "Rendons Penny heureuse!" (elle en Europe, pendant son sommeil, ne voit pas tout cela et ne peut pas voir, car elle n'est pas l√†). √Ä la fin, il supprime ce post, l'efface du "Feed" et restaure l'acc√®s pour qu'il ne remarque rien et qu'il n'y ait pas de scandale.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout va bien, mais supposons que le syst√®me soit distribu√© et que les √©v√©nements se soient un peu mal pass√©s. </font><font style="vertical-align: inherit;">Par exemple, il se peut que la restriction d'acc√®s √† Penny se soit produite apr√®s la publication de ce message, si les √©v√©nements ne sont pas li√©s par une relation causale. </font><font style="vertical-align: inherit;">En fait, il s'agit d'un exemple de cas o√π la coh√©rence causale est requise pour remplir une fonction m√©tier (dans ce cas). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, ce sont des propri√©t√©s assez banales de la base de donn√©es - tr√®s peu de personnes les prennent en charge. </font><font style="vertical-align: inherit;">Passons aux mod√®les.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®les de coh√©rence</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce qu'un mod√®le de coh√©rence dans les bases de donn√©es en g√©n√©ral? </font><font style="vertical-align: inherit;">Ce sont quelques-unes des garanties qu'un syst√®me distribu√© donne quant aux donn√©es et dans quel ordre le client peut recevoir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En principe, tous les mod√®les de coh√©rence se r√©sument √† la r√©partition du syst√®me comme un syst√®me qui fonctionne, par exemple, sur le m√™me signe de t√™te sur un ordinateur portable. </font><font style="vertical-align: inherit;">Et c'est √† quel point le syst√®me, qui fonctionne sur des milliers de ¬´n≈ìuds¬ª g√©o-distribu√©s, est similaire √† un ordinateur portable, dans lequel toutes ces propri√©t√©s sont ex√©cut√©es automatiquement en principe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, les mod√®les de coh√©rence ne s'appliquent qu'aux syst√®mes distribu√©s. </font><font style="vertical-align: inherit;">Tous les syst√®mes qui existaient auparavant et fonctionnaient sur la m√™me √©chelle verticale n'ont pas rencontr√© de tels probl√®mes. </font><font style="vertical-align: inherit;">Il y avait une m√©moire tampon, et tout √©tait toujours lu √† partir de celle-ci.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®le solide</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, le tout premier mod√®le est Strong (ou la ligne de capacit√© de mont√©e, comme on l'appelle souvent). </font><font style="vertical-align: inherit;">Il s'agit d'un mod√®le de coh√©rence qui garantit que chaque modification, d√®s r√©ception de la confirmation de son apparition, est visible pour tous les utilisateurs du syst√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela cr√©e un ordre global de tous les √©v√©nements de la base de donn√©es. </font><font style="vertical-align: inherit;">Il s'agit d'une propri√©t√© de consistance tr√®s forte et g√©n√©ralement tr√®s co√ªteuse. </font><font style="vertical-align: inherit;">Cependant, il est tr√®s bien entretenu. </font><font style="vertical-align: inherit;">C'est tout simplement tr√®s cher et lent - ils sont tout simplement rarement utilis√©s. </font><font style="vertical-align: inherit;">C'est ce qu'on appelle la capacit√© de mont√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe une autre propri√©t√©, plus puissante, prise en charge dans le "Spanner" - appel√© coh√©rence externe. </font><font style="vertical-align: inherit;">Nous parlerons de lui un peu plus tard.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Causal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui suit est Causal, juste ce dont je parlais. Il y a plusieurs sous-niveaux entre Strong et Causal dont je ne parlerai pas, mais ils se r√©sument tous √† Causal. C'est un mod√®le important car c'est le plus fort de tous les mod√®les, la plus forte coh√©rence en pr√©sence d'un r√©seau ou de partitions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les causalit√©s sont en fait une situation dans laquelle les √©v√©nements sont li√©s par une relation causale. Tr√®s souvent, ils sont per√ßus comme des droits de lecture sur le point de vue du client. Si le client a observ√© certaines valeurs, il ne peut pas voir les valeurs qui √©taient dans le pass√©. Il commence d√©j√† √† voir des lectures de pr√©fixes. Tout revient √† la m√™me chose.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les causes comme mod√®le de coh√©rence sont un ordre partiel des √©v√©nements sur le serveur, dans lequel les √©v√©nements de tous les clients sont observ√©s dans la m√™me s√©quence. </font><font style="vertical-align: inherit;">Dans ce cas, Leonard et Penny.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âventuel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisi√®me mod√®le est la coh√©rence √©ventuelle. C'est ce qui prend en charge absolument tous les syst√®mes distribu√©s, un mod√®le minimal qui a g√©n√©ralement du sens. Cela signifie ce qui suit: lorsque nous avons des modifications dans les donn√©es, elles deviennent coh√©rentes √† un moment donn√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä un tel moment, elle ne dit rien, sinon elle se transformerait en coh√©rence externe - il y aurait une histoire compl√®tement diff√©rente. N√©anmoins, il s'agit d'un mod√®le tr√®s populaire, le plus courant. Par d√©faut, tous les utilisateurs de syst√®mes distribu√©s utilisent la coh√©rence √©ventuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je veux donner quelques exemples comparatifs: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yn/5s/p9/yn5sp9tyjn4dh4q3vonroirvxic.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
que signifient ces fl√®ches?</font></font><br>
<br>
<ul>
<li><b>Latency.</b>          :    ,       ,    ,     .   Eventual Consistency   ,   ,  ,    memory       .</li>
<li><b>Availability.</b>           , partitions,  -  ‚Äì      ,    ,         - . Eventual Consistency        ‚Äì    ,  .</li>
<li><b>Anomalies.</b>  , ,   .  Strong Consistency       ,  Eventual Consistency     .  :     Eventual Consistency,    ?    ,  Eventual Consistency- ,   , ,    ;        -   ;       .   ,       .</li>
</ul><br>
<h3> CAP</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand vous voyez les mots coh√©rence, disponibilit√© - qu'est-ce qui vous vient √† l'esprit? Droite - Th√©or√®me CAP! Maintenant, je veux dissiper le mythe ... Ce n'est pas moi - il y a Martin Kleppman, qui a √©crit un merveilleux article, un merveilleux livre. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-k/rc/v1/-krcv1vofhv9ofnwbty6ql6hvhg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le th√©or√®me de la PAC est un principe formul√© dans les ann√©es 2000 selon lequel Coh√©rence, Disponibilit√©, Partitions: prenez deux, et vous ne pouvez pas en choisir trois. C'√©tait un certain principe. Il a √©t√© prouv√© comme th√©or√®me quelques ann√©es plus tard par Gilbert et Lynch. Puis il est devenu utilis√© comme mantra - les syst√®mes ont commenc√© √† √™tre divis√©s en CA, CP, AP et ainsi de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce th√©or√®me a en fait √©t√© prouv√© pour les raisons suivantes ... Premi√®rement, la disponibilit√© n'√©tait pas consid√©r√©e comme une valeur continue de z√©ro √† des centaines (0 - le syst√®me est "mort", 100 - r√©pond rapidement; nous sommes tellement habitu√©s √† le consid√©rer), mais comme une propri√©t√© de l'algorithme , ce qui garantit qu'avec toutes ses ex√©cutions, il renvoie des donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a pas un mot sur le temps de r√©ponse! Il existe un algorithme qui renvoie des donn√©es apr√®s 100 ans - un algorithme disponible parfaitement fin, qui fait partie du th√©or√®me CAP. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxi√®mement: un th√©or√®me a √©t√© prouv√© pour les changements dans les valeurs de la m√™me cl√©, malgr√© le fait que ces changements sont une ligne redimensionnable. Cela signifie qu'en fait, ils ne sont pratiquement pas utilis√©s, car les mod√®les sont diff√©rents Coh√©rence √©ventuelle, forte coh√©rence (peut-√™tre).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi tout √ßa? </font><font style="vertical-align: inherit;">De plus, le th√©or√®me de CAP sous la forme dans laquelle il est prouv√© qu'il n'est pratiquement pas applicable est rarement utilis√©. </font><font style="vertical-align: inherit;">Sous une forme th√©orique, cela limite en quelque sorte tout. </font><font style="vertical-align: inherit;">Il s'av√®re qu'un certain principe est intuitivement vrai, mais en aucun cas, en g√©n√©ral, n'est prouv√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coh√©rence causale - le mod√®le le plus solide</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui se passe maintenant - vous pouvez obtenir les trois choses: coh√©rence, disponibilit√© peut √™tre obtenue en utilisant des partitions. </font><font style="vertical-align: inherit;">En particulier, la coh√©rence causale est le mod√®le de coh√©rence le plus fort qui, en pr√©sence de partitions (coupures de r√©seau), fonctionne toujours. </font><font style="vertical-align: inherit;">Par cons√©quent, il est d'un grand int√©r√™t, et nous y sommes donc engag√©s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/4s/k8/ty4sk8sx4n73xnsxlkw2wtb1ity.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, cela simplifie le travail des d√©veloppeurs d'applications. </font><font style="vertical-align: inherit;">En particulier, il y a beaucoup de soutien du serveur: lorsque tous les enregistrements qui se produisent √† l'int√©rieur d'un client sont garantis pour arriver dans cet ordre sur l'autre client. </font><font style="vertical-align: inherit;">Deuxi√®mement, il r√©siste aux partitions.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuisine int√©rieure MongoDB</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En souvenir de ce d√©jeuner, nous passons √† la cuisine. Je vais parler du mod√®le de syst√®me, √† savoir ce qu'est MongoDB pour ceux qui ont entendu parler pour la premi√®re fois d'une telle base de donn√©es. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/-b/kj/fn-bkjwvkdxcokzum9xwwkshcu8.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/2u/qz/3g/2uqz3gts5ipfvvojtpo2epigtf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MongoDB (ci-apr√®s d√©nomm√© ¬´MongoBD¬ª) est un syst√®me distribu√© qui prend en charge la mise √† l'√©chelle horizontale, c'est-√†-dire le d√©coupage; et au sein de chaque fragment, il prend √©galement en charge la redondance des donn√©es, c'est-√†-dire la r√©plication. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le sharding dans ¬´MongoBD¬ª (base de donn√©es non relationnelle) effectue un √©quilibrage automatique, c'est-√†-dire chaque collection de documents (ou ¬´tableau¬ª en termes de donn√©es relationnelles) en morceaux, et d√©j√† le serveur les d√©place automatiquement entre les fragments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le routeur de requ√™tes qui distribue les requ√™tes pour le client est un client via lequel il fonctionne. Il sait d√©j√† o√π et quelles donn√©es se trouvent, envoie toutes les demandes au bon fragment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autre point important: MongoDB est un ma√Ætre unique. </font><font style="vertical-align: inherit;">Il existe un principal - il peut prendre des enregistrements qui prennent en charge les cl√©s qu'il contient. </font><font style="vertical-align: inherit;">Vous ne pouvez pas faire d'√©criture multi-ma√Ætre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons fait la version 4.2 - de nouvelles choses int√©ressantes y sont apparues. </font><font style="vertical-align: inherit;">En particulier, ils ont ins√©r√© Lucene - la recherche - c'√©tait ex√©cutable java directement dans "Mongo", et l√†, il est devenu possible de rechercher √† travers Lucene, la m√™me que dans "Elastic". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ils ont fait un nouveau produit - Graphiques, il est √©galement disponible sur Atlas (le propre Cloud de Mongo). </font><font style="vertical-align: inherit;">Ils ont un niveau gratuit - vous pouvez jouer avec. </font><font style="vertical-align: inherit;">J'ai vraiment aim√© les graphiques - la visualisation des donn√©es est tr√®s intuitive.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingr√©dients de coh√©rence causale</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai compt√© environ 230 articles publi√©s sur ce sujet - de Leslie Lampert. </font><font style="vertical-align: inherit;">Maintenant, de ma m√©moire, je vais vous apporter quelques parties de ces documents. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2_/dt/2n/2_dt2nhood8jlup51kyeddsy7w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a commenc√© avec un article de Leslie Lampert, √©crit dans les ann√©es 1970. </font><font style="vertical-align: inherit;">Comme vous pouvez le voir, certaines recherches sur ce sujet sont toujours en cours. </font><font style="vertical-align: inherit;">D√©sormais, la coh√©rence causale conna√Æt un int√©r√™t pour le d√©veloppement de syst√®mes distribu√©s.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limites</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelles sont les limitations? </font><font style="vertical-align: inherit;">C'est en fait l'un des points principaux, car les restrictions que les syst√®mes de production imposent sont tr√®s diff√©rentes des restrictions qui existent dans les articles acad√©miques. </font><font style="vertical-align: inherit;">Ils sont souvent assez artificiels.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qd/nh/ql/qdnhql6zcor1hzt53ur72spzqzy.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, "MongoDB" est un seul ma√Ætre, comme je l'ai d√©j√† dit (cela simplifie grandement).</font></font></li>
<li> ,   10     .     -  ,      .</li>
<li>   ,   ,      ,    binary,     ,    .</li>
<li>  ,   Research  :      . ¬´¬ª ‚Äì  . ,     ,  ‚Äì    .  ,     .</li>
<li>  ,     ‚Äì  :    ,   performance degradation   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre point est g√©n√©ralement anti-acad√©mique: la compatibilit√© des versions pr√©c√©dentes et futures. </font><font style="vertical-align: inherit;">Les anciens pilotes doivent prendre en charge les nouvelles mises √† jour et la base de donn√©es doit prendre en charge les anciens pilotes.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, tout cela impose des limites.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Composants de coh√©rence causale</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais maintenant parler de certains composants. </font><font style="vertical-align: inherit;">Si nous consid√©rons la coh√©rence causale g√©n√©rale, nous pouvons distinguer les blocs. </font><font style="vertical-align: inherit;">Nous avons choisi parmi les ≈ìuvres appartenant √† un certain bloc: le suivi des d√©pendances, le choix des heures, la fa√ßon dont ces montres peuvent √™tre synchronis√©es entre elles et la fa√ßon dont nous assurons la s√©curit√© - voici un plan approximatif de ce dont je vais parler:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/rb/rq/zvrbrqunyfdrj1pmbrjncugqed4.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suivi complet des d√©pendances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-il n√©cessaire? Afin que, lorsque les donn√©es sont r√©pliqu√©es - chaque enregistrement, chaque modification de donn√©es contienne des informations sur les modifications dont elle d√©pend. Le tout premier et na√Øf changement est lorsque chaque message qui contient un enregistrement contient des informations sur les messages pr√©c√©dents: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gk/ue/jh/gkuejhztxm81mfji3fazhsmbmbm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, le nombre d'accolades est le nombre d'enregistrements. Parfois, ces enregistrements avec des valeurs sont m√™me transf√©r√©s dans leur int√©gralit√©, parfois certaines versions sont transf√©r√©es. L'essentiel est que chaque changement contient des informations sur le pr√©c√©dent (√©videmment, il porte tout en soi).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi avons-nous d√©cid√© de ne pas utiliser cette approche (suivi complet)? </font><font style="vertical-align: inherit;">√âvidemment, parce que cette approche n'est pas pratique: tout changement dans le r√©seau social d√©pend de tous les changements pr√©c√©dents dans ce r√©seau social, transmettant, disons, Facebook ou Vkontakte √† chaque mise √† jour. </font><font style="vertical-align: inherit;">N√©anmoins, il y a beaucoup de recherches √† savoir le suivi complet des d√©pendances - ce sont des r√©seaux sociaux, pour certaines situations, cela fonctionne vraiment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suivi explicite des d√©pendances</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le suivant est plus limit√©. </font><font style="vertical-align: inherit;">Ici aussi, la transmission d'informations est envisag√©e, mais uniquement celle qui en d√©pend clairement. </font><font style="vertical-align: inherit;">Ce qui d√©pend de ce qui, en r√®gle g√©n√©rale, est d√©j√† d√©termin√© par Application. </font><font style="vertical-align: inherit;">Lorsque les donn√©es sont r√©pliqu√©es, seules les r√©ponses sont renvoy√©es lorsqu'une demande est effectu√©e, lorsque les d√©pendances pr√©c√©dentes ont √©t√© satisfaites, c'est-√†-dire affich√©es. </font><font style="vertical-align: inherit;">C'est l'essence m√™me du fonctionnement de la coh√©rence causale. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y_/jc/mw/y_jcmwt2w-vqj9guslui0wl8vgi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elle voit que l'enregistrement 5 d√©pend des enregistrements 1, 2, 3, 4 - respectivement, elle attend que le client ait acc√®s aux modifications apport√©es par le d√©cret d'acc√®s de Penny lorsque toutes les modifications pr√©c√©dentes ont d√©j√† √©t√© transmises √† la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela ne nous convient pas non plus, car de toute fa√ßon il y a trop d'informations, et cela va ralentir. </font><font style="vertical-align: inherit;">Il y a une approche diff√©rente ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horloge Lamport</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils sont tr√®s vieux. L'horloge Lamport implique que ces d√©pendances sont regroup√©es dans une fonction scalaire appel√©e horloge Lamport. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fonction scalaire est un nombre abstrait. Souvent appel√© temps logique. A chaque √©v√©nement, ce compteur augmente. Le compteur, qui est actuellement connu du processus, envoie chaque message. Il est clair que les processus peuvent √™tre d√©synchronis√©s, ils peuvent avoir des temps compl√®tement diff√©rents. N√©anmoins, le syst√®me √©quilibre en quelque sorte l'horloge avec une telle messagerie. Que se passe-t-il dans ce cas?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai divis√© ce gros fragment en deux pour qu'il soit clair: les amis peuvent vivre dans un n≈ìud qui contient un morceau de la collection, et Feed peut vivre dans un autre n≈ìud qui contient un morceau de cette collection. C'est clair comment ils peuvent se d√©tourner? Tout d'abord, Feed dit ¬´R√©pliqu√©¬ª, puis Amis. Si le syst√®me ne fournit aucune garantie que Feed ne sera pas affich√© jusqu'√† ce que les d√©pendances Friends dans la collection Friends soient √©galement livr√©es, alors nous aurons juste une situation que j'ai mentionn√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous voyez comment le temps du compteur augmente logiquement sur le flux:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gv/pz/vw/gvpzvwwxqonuthkwv6j2ez0fruc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, la propri√©t√© principale de cette horloge Lamport et de la coh√©rence causale (expliqu√©e par l'horloge Lamport) est la suivante: si nous avons des √©v√©nements A et B et que l'√©v√©nement B d√©pend de l'√©v√©nement A *, il s'ensuit que le LogicalTime de l'√©v√©nement A est moins que LogicalTime de l'√©v√©nement B. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* On dit parfois que A s'est produit avant B, c'est-√†-dire A s'est produit avant B - c'est une sorte de relation qui ordonne partiellement l'ensemble des √©v√©nements qui se sont g√©n√©ralement produits.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
L'inverse est faux. C'est en fait l'un des principaux inconv√©nients de l'horloge Lamport - la commande partielle. Il y a un concept d'√©v√©nements simultan√©s, c'est-√†-dire d'√©v√©nements dans lesquels ni (A ne s'est produit avant B) ni (A s'est produit avant B). Un exemple est l'ajout parall√®le de Leonard √† des amis de quelqu'un d'autre (pas m√™me Leonard, mais Sheldon, par exemple).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est la propri√©t√© qui est souvent utilis√©e lorsque vous travaillez avec des montres Lamport: elles regardent exactement la fonction et en tirent une conclusion - peut-√™tre que ces √©v√©nements sont d√©pendants. </font><font style="vertical-align: inherit;">Parce que dans un sens, cela est vrai: si LogicalTime A est inf√©rieur √† LogicalTime B, alors B ne peut pas se produire avant A; </font><font style="vertical-align: inherit;">et si plus, alors peut-√™tre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horloge vectorielle</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©veloppement logique des montres Lamport est l'horloge vectorielle. Ils diff√®rent en ce que chaque n≈ìud qui est ici contient sa propre horloge distincte, et ils sont transmis en tant que vecteur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce cas, vous voyez que l'index z√©ro du vecteur est responsable de Feed, et le premier index du vecteur est pour Friends (chacun de ces n≈ìuds). Et maintenant, ils vont augmenter: l'indice z√©ro du "Feed" augmente lors de l'enregistrement - 1, 2, 3: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/xm/cd/cvxmcdiz_dgbjsu7elnj3xt2hcc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment l'horloge vectorielle est-elle meilleure? Le fait qu'ils peuvent d√©terminer quels √©v√©nements sont simultan√©s et quand ils se produisent sur diff√©rents n≈ìuds. Ceci est tr√®s important pour un syst√®me de partage comme le MongoBD. Cependant, nous n'avons pas choisi cela, bien que ce soit une chose merveilleuse, et cela fonctionne tr√®s bien, et cela nous conviendrait probablement ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous avons 10 000 fragments, nous ne pouvons pas transf√©rer 10 000 composants, m√™me si nous compressons, nous pensons √† autre chose - tout de m√™me, la charge utile sera plusieurs fois inf√©rieure au volume de ce vecteur entier. </font><font style="vertical-align: inherit;">Par cons√©quent, broyant nos c≈ìurs et nos dents, nous avons abandonn√© cette approche et sommes pass√©s √† une autre.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spanner TrueTime. </font><font style="vertical-align: inherit;">Horloge atomique</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai dit qu'il y aurait une histoire √† propos de Spanner. C'est une bonne chose, au 21e si√®cle: horloges atomiques, synchronisation GPS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle id√©e? Spanner est un syst√®me Google qui a r√©cemment √©t√© mis √† la disposition des utilisateurs (ils y ont attach√© SQL). Chaque transaction y a un horodatage. √âtant donn√© que l'heure est synchronis√©e *, chaque √©v√©nement peut √™tre affect√© √† une heure sp√©cifique - l'horloge atomique a un temps d'attente, apr√®s quoi il est garanti qu'un autre temps se produira. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/vw/e3/znvwe3zwpqvjhsx-qglxpbqen9g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, en √©crivant simplement dans la base de donn√©es et en attendant un certain laps de temps, la s√©rialisation de l'√©v√©nement est automatiquement garantie. Ils ont le mod√®le de coh√©rence le plus solide, qui en principe peut √™tre imagin√© - c'est la coh√©rence externe.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* C'est le principal probl√®me des montres Lampart - elles ne sont jamais synchrones sur les syst√®mes distribu√©s. </font><font style="vertical-align: inherit;">Ils peuvent diverger, m√™me avec NTP, ils ne fonctionnent toujours pas tr√®s bien. </font><font style="vertical-align: inherit;">"Spanner" a une horloge atomique et la synchronisation semble √™tre alors microsecondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi n'avons-nous pas choisi? </font><font style="vertical-align: inherit;">Nous ne supposons pas que nos utilisateurs ont une horloge atomique int√©gr√©e. </font><font style="vertical-align: inherit;">Quand ils apparaissent, √©tant int√©gr√©s dans chaque ordinateur portable, il y aura une sorte de synchronisation GPS super cool - alors oui ... En attendant, le meilleur qui soit possible est Amazon, des stations de base pour les fanatiques ... Par cons√©quent, nous avons utilis√© d'autres montres.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horloge hybride</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est en fait ce qui coche le ¬´MongoBD¬ª tout en assurant la coh√©rence causale. </font><font style="vertical-align: inherit;">Quels sont-ils hybrides? </font><font style="vertical-align: inherit;">Un hybride est une valeur scalaire, mais il se compose de deux composants:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hi/wz/uv/hiwzuvz-czbmb52b9iypojrr0_u.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le premier est l'√®re Unix (combien de secondes se sont √©coul√©es depuis le "d√©but du monde informatique").</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le second est un incr√©ment, √©galement un entier non sign√© 32 bits.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout, en fait. </font><font style="vertical-align: inherit;">Il existe une telle approche: la partie responsable de l'heure est synchronis√©e en permanence avec l'horloge; </font><font style="vertical-align: inherit;">chaque fois qu'une mise √† jour se produit, cette partie est synchronis√©e avec l'horloge et il s'av√®re que l'heure est toujours plus ou moins correcte, et l'incr√©mentation vous permet de distinguer les √©v√©nements qui se sont produits en m√™me temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi est-ce important pour MongoBD? </font><font style="vertical-align: inherit;">Parce qu'il vous permet de cr√©er des restaurations de sauvegarde √† un certain moment, c'est-√†-dire que l'√©v√©nement est index√© par le temps. </font><font style="vertical-align: inherit;">Ceci est important lorsque certains √©v√©nements sont n√©cessaires; </font><font style="vertical-align: inherit;">pour une base de donn√©es, les √©v√©nements sont des modifications de la base de donn√©es qui se produisent √† certains moments dans le temps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne vous dirai que la raison la plus importante (s'il vous pla√Æt, ne le dites √† personne)! </font><font style="vertical-align: inherit;">Nous l'avons fait parce que les donn√©es index√©es ordonn√©es dans MongoDB OpLog ressemblent √† ceci. </font><font style="vertical-align: inherit;">OpLog est une structure de donn√©es qui contient absolument toutes les modifications dans la base de donn√©es: elles vont d'abord √† OpLog, puis elles sont d√©j√† appliqu√©es au stockage lui-m√™me dans le cas o√π il s'agit d'une date ou d'un fragment r√©pliqu√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'√©tait la raison principale. </font><font style="vertical-align: inherit;">N√©anmoins, il existe √©galement des exigences pratiques pour d√©velopper la base de donn√©es, ce qui signifie qu'elle doit √™tre simple - il y a peu de code, aussi peu de choses bris√©es que possible qui doivent √™tre r√©√©crites et test√©es. </font><font style="vertical-align: inherit;">Le fait que nos oplogs aient √©t√© index√©s par une montre hybride nous a beaucoup aid√©s et nous a permis de faire le bon choix. </font><font style="vertical-align: inherit;">Cela a vraiment pay√© et a fonctionn√© comme par magie sur le tout premier prototype. </font><font style="vertical-align: inherit;">C'√©tait tr√®s cool!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisation d'horloge</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe plusieurs m√©thodes de synchronisation d√©crites dans la litt√©rature scientifique. </font><font style="vertical-align: inherit;">Je parle de synchronisation lorsque nous avons deux fragments diff√©rents. </font><font style="vertical-align: inherit;">S'il n'y a qu'un seul jeu de r√©pliques, il n'y a pas besoin de synchronisation: c'est un ¬´ma√Ætre unique¬ª; </font><font style="vertical-align: inherit;">nous avons un OpLog dans lequel toutes les modifications entrent - dans ce cas, tout est d√©j√† s√©quentiellement ordonn√© dans le "Oplog" lui-m√™me. </font><font style="vertical-align: inherit;">Mais si nous avons deux fragments diff√©rents, la synchronisation de l'heure est importante ici. </font><font style="vertical-align: inherit;">Ici, les horloges vectorielles ont aid√© davantage! </font><font style="vertical-align: inherit;">Mais nous n'en avons pas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ei/kq/bk/eikqbkbbzrsdquzxjxlzayc81qq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me est Heartbeats. </font><font style="vertical-align: inherit;">Vous pouvez √©changer certains signaux qui se produisent √† chaque unit√© de temps. </font><font style="vertical-align: inherit;">Mais les Hartbits sont trop lents, nous ne pouvons pas fournir de latence √† notre client.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vrai temps est, bien s√ªr, une chose merveilleuse. </font><font style="vertical-align: inherit;">Mais, encore une fois, c'est probablement l'avenir ... Bien que l'Atlas puisse d√©j√† √™tre fait, il existe d√©j√† des synchroniseurs horaires "amazoniens" rapides. </font><font style="vertical-align: inherit;">Mais il ne sera pas accessible √† tous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le bavardage, c'est quand tous les messages incluent du temps. </font><font style="vertical-align: inherit;">C'est √† peu pr√®s ce que nous utilisons. </font><font style="vertical-align: inherit;">Chaque message entre les n≈ìuds, un pilote, un routeur de n≈ìuds de donn√©es, absolument tout pour ¬´MongoDB¬ª - ce sont des √©l√©ments, des composants de base de donn√©es qui contiennent une horloge qui coule. </font><font style="vertical-align: inherit;">Partout o√π ils ont le sens du temps hybride, il se transmet. </font><font style="vertical-align: inherit;">64 bits? </font><font style="vertical-align: inherit;">Cela permet, c'est possible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment tout cela fonctionne-t-il ensemble?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, je regarde un jeu de r√©pliques pour le rendre un peu plus facile. Il y a primaire et secondaire. Le secondaire effectue la r√©plication et n'est pas toujours enti√®rement synchronis√© avec le primaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un insert (insert) dans les "Primaires" avec une certaine valeur de temps. Cet insert augmente le compteur interne de 11, s'il est maximum. Ou il v√©rifiera les valeurs d'horloge et se synchronisera par l'horloge si l'horloge est plus grande. Cela vous permet de trier par heure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir enregistr√© un disque, un moment important se produit. Les heures sont en ¬´MongoDB¬ª et ne sont incr√©ment√©es que si elles sont enregistr√©es dans ¬´Oplog¬ª. Il s'agit d'un √©v√©nement qui modifie l'√©tat du syst√®me. Absolument dans tous les articles classiques, un √©v√©nement est consid√©r√© comme un message entrant dans un n≈ìud: un message est arriv√© - cela signifie que le syst√®me a chang√© d'√©tat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est d√ª au fait qu'au cours de l'√©tude, il n'est pas enti√®rement possible de comprendre comment ce message sera interpr√©t√©. Nous savons avec certitude que s'il n'est pas refl√©t√© dans l '¬´Oplog¬ª, il ne sera en aucun cas interpr√©t√©, et seule l'entr√©e dans l' ¬´Oplog¬ª est un changement dans l'√©tat du syst√®me. Cela simplifie tout pour nous: le mod√®le simplifie et nous permet d'organiser dans le cadre d'un jeu de r√©pliques, et bien d'autres choses utiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il renvoie la valeur qui a d√©j√† √©t√© enregistr√©e dans le ¬´Oplog¬ª - nous savons que dans le ¬´Oplog¬ª cette valeur se trouve d√©j√†, et son heure est 12. Maintenant, disons, la lecture commence √† partir d'un autre n≈ìud (secondaire), et elle transf√®re d√©j√† apr√®s ClusterTime lui-m√™me message. Il dit: ¬´J'ai besoin de tout ce qui s'est pass√© apr√®s au moins 12 ou pendant douze¬ª (voir fig. Ci-dessus).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ce qu'on appelle Causal a consistent (CAT). Il existe un tel concept en th√©orie qu'il s'agit d'une tranche de temps, qui est coh√©rente en soi. Dans ce cas, nous pouvons dire que c'est l'√©tat du syst√®me qui a √©t√© observ√© au moment 12. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, il n'y a rien ici, car il semble imiter la situation lorsque le secondaire a besoin de r√©pliquer les donn√©es du primaire. Il attend ... Et maintenant, les donn√©es sont arriv√©es - renvoie ces valeurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a1/q7/3q/a1q73qclyk9sn567b2x8szr_ejm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voil√† comment tout cela fonctionne. Presque.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que signifie "presque"? Supposons qu'il y ait une personne qui a lu et compris comment tout cela fonctionne. J'ai r√©alis√© que chaque fois que ClusterTime se produit, il met √† jour l'horloge logique interne, puis l'enregistrement suivant augmente d'une unit√©. Cette fonction occupe 20 lignes. Supposons que cette personne transmette le plus grand nombre possible de 64 bits, moins un. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi moins un? Parce que l'horloge interne est substitu√©e √† cette valeur (√©videmment, c'est la plus grande possible et plus que l'heure actuelle), alors il y aura une entr√©e dans le "Olog", et l'horloge augmentera d'une unit√© de plus - et il y aura d√©j√† une valeur maximale (il y a simplement toutes les unit√©s, il n'y a nulle part o√π aller , entiers non sign√©s).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est clair qu'apr√®s cela, le syst√®me devient compl√®tement inaccessible pour rien. </font><font style="vertical-align: inherit;">Il ne peut √™tre d√©charg√©, nettoy√© - beaucoup de travail manuel. </font><font style="vertical-align: inherit;">Disponibilit√© totale: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/lz/fs/iulzfslzcst3tn9c-qpouy9zqsk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, si cela est r√©pliqu√© ailleurs, le cluster entier se couche simplement. </font><font style="vertical-align: inherit;">Une situation absolument inacceptable que n'importe qui peut organiser tr√®s rapidement et simplement! </font><font style="vertical-align: inherit;">Par cons√©quent, nous avons consid√©r√© ce moment comme l'un des plus importants. </font><font style="vertical-align: inherit;">Comment l'emp√™cher?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre fa√ßon est de signer clusterTime</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est donc transmis dans le message (avant le texte bleu). Mais nous avons √©galement commenc√© √† g√©n√©rer une signature (texte bleu): la </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zg/9r/iu/zg9riuabqzdlnw9dwttrwkwzkmi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
signature est g√©n√©r√©e par une cl√© qui est stock√©e √† l'int√©rieur de la base de donn√©es, √† l'int√©rieur du p√©rim√®tre prot√©g√©; il est g√©n√©r√©, mis √† jour (les utilisateurs ne voient rien). Le hachage est g√©n√©r√© et chaque message est sign√© lors de la cr√©ation et valid√© √† r√©ception. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablement, la question se pose chez les gens: "Combien cela ralentit-il?" J'ai dit que cela devrait fonctionner rapidement, surtout en l'absence de cette fonctionnalit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que signifie utiliser la coh√©rence causale dans ce cas? Cela affichera le param√®tre afterClusterTime. Et sans cela, il passera simplement des valeurs de toute fa√ßon. Le bavardage, depuis la version 3.6, fonctionne toujours.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous laissons la g√©n√©ration constante de signatures, cela ralentira le syst√®me m√™me en l'absence de fonctionnalit√©s, ce qui ne correspond pas √† nos approches et exigences. </font><font style="vertical-align: inherit;">Et qu'avons-nous fait?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fais-le vite!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une chose assez simple, mais l'astuce est int√©ressante - je vais la partager, peut-√™tre que quelqu'un sera int√©ress√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un hachage qui stocke les donn√©es sign√©es. </font><font style="vertical-align: inherit;">Toutes les donn√©es passent par le cache. </font><font style="vertical-align: inherit;">Le cache ne signe pas sp√©cifiquement l'heure, mais la plage. </font><font style="vertical-align: inherit;">Lorsqu'une certaine valeur arrive, nous g√©n√©rons une plage, masquons les 16 derniers bits et nous signons cette valeur: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s8/ml/3a/s8ml3aaec2pj5xl8t0zvkrp7iik.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En recevant une telle signature, nous acc√©l√©rons (conditionnellement) le syst√®me de 65 000 fois. </font><font style="vertical-align: inherit;">Cela fonctionne tr√®s bien: quand ils ont fait les exp√©riences, le temps o√π nous avions une mise √† jour coh√©rente y √©tait vraiment r√©duit de 10 mille fois. </font><font style="vertical-align: inherit;">Il est clair que lorsqu'ils sont en d√©saccord, cela ne fonctionne pas. </font><font style="vertical-align: inherit;">Mais dans la plupart des cas pratiques, cela fonctionne. </font><font style="vertical-align: inherit;">La combinaison de la signature Range avec la signature a r√©solu le probl√®me de s√©curit√©.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'avons-nous appris?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le√ßons que nous en avons tir√©es:</font></font><br>
<br>
<ul>
<li>  , , ,       .     -  ( ,      . .),  , .   ,       ,    ,   .        ‚Äì   .<br>
<br>
,     ,      (¬´¬ª, ) ‚Äì      .     ?    .     ,      .   ‚Äì   ,   .</li>
<li>    .  ,        ¬´¬ª     ,   ,  ,      availability, latency  .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La derni√®re est que nous avons d√ª consid√©rer diff√©rentes id√©es et combiner plusieurs articles g√©n√©ralement diff√©rents dans une m√™me approche. </font><font style="vertical-align: inherit;">L'id√©e de signer, par exemple, est venue d'un article qui a examin√© le protocole Paxos, qui pour les non-byzantins Faylor dans le protocole d'autorisation, pour les byzantins en dehors du protocole d'autorisation ... En g√©n√©ral, c'est exactement ce que nous avons fait au final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a absolument rien de nouveau ici! </font><font style="vertical-align: inherit;">Mais d√®s que nous avons tout m√©lang√© ... C'est comme dire que la recette de la salade Olivier est absurde, car les ≈ìufs, la mayonnaise et les concombres ont d√©j√† √©t√© invent√©s ... C'est √† peu pr√®s la m√™me histoire.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/6o/pc/q8/6opcq8ew4bcry9qnt0lsdlasflo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je terminerai l√†-dessus. </font><font style="vertical-align: inherit;">Remercier!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des questions</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question du public (ci-apr√®s - B):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Merci, Michael pour le rapport! Le th√®me du temps est int√©ressant. Vous utilisez des ragots. Ils ont dit que chacun a son propre temps, tout le monde conna√Æt son heure locale. Si je comprends bien, nous avons un pilote - il peut y avoir de nombreux clients avec des pilotes, des planificateurs de requ√™tes aussi, beaucoup d'√©clats ... Mais √† quoi va servir le syst√®me si nous avons soudainement un √©cart: quelqu'un d√©cide qu'il est pour une minute devant, quelqu'un - une minute derri√®re? O√π allons-nous nous retrouver? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Grande question vraiment! Je voulais juste parler des √©clats. Si je comprends bien la question, nous avons cette situation: il y a les fragments 1 et 2, la lecture se produit √† partir de ces deux fragments - ils ont un √©cart, ils n'interagissent pas l'un avec l'autre, parce que le temps qu'ils connaissent est diff√©rent, en particulier le temps Ils existent dans les oplogs.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons que le fragment 1 ait enregistr√© un million d'enregistrements, que le fragment 2 n'a rien fait du tout et que la demande soit arriv√©e en deux fragments. Et le premier a AfterClusterTime plus d'un million. Dans une telle situation, comme je l'ai expliqu√©, le fragment 2 ne r√©pondra jamais du tout. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je voulais savoir comment ils se synchronisent et choisissent une heure logique? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tr√®s facile √† synchroniser. Shard, quand afterClusterTime vient √† lui, et il ne trouve pas l'heure dans le ¬´Catch¬ª - ne lance pas approuv√©. Autrement dit, il l√®ve la main √† cette valeur avec ses mains. Cela signifie qu'il n'a aucun √©v√©nement correspondant √† cette requ√™te. Il cr√©e cet √©v√©nement artificiellement et devient ainsi le Causal Consistent. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et si apr√®s cela, d'autres √©v√©nements perdus quelque part sur le r√©seau lui reviennent encore? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Le tesson est agenc√© de fa√ßon √† ce qu'il ne vienne plus, puisqu'il s'agit d'un seul ma√Ætre. S'il a d√©j√† enregistr√©, alors ils ne viendront pas, mais seront apr√®s. Il ne peut pas arriver que quelque part quelque chose soit bloqu√©, alors il ne fera pas d'√©criture, puis ces √©v√©nements sont arriv√©s - et la coh√©rence causale a √©t√© viol√©e. Quand il n'√©crit pas, ils doivent tous venir ensuite (il les attendra). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t2/wb/oo/t2wboofhfs7qpepqz8zwsm1o0u4.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- J'ai quelques questions concernant les lignes. La coh√©rence causale suppose qu'il existe une certaine file d'attente d'actions √† effectuer. Que se passe-t-il si nous perdons un colis? Alors le 10 est all√©, le 11 ... le 12 a disparu, et tout le monde attend qu'il se r√©alise. Et soudain notre voiture est morte, nous ne pouvons plus rien faire. Y a-t-il une longueur de file d'attente maximale qui s'accumule avant son ex√©cution? Quel √©chec fatal survient lorsqu'un √©tat est perdu? De plus, si nous √©crivons qu'il existe une sorte d'√©tat ant√©rieur, alors devrions-nous en quelque sorte partir de lui? Et ils ne l'ont pas pouss√©! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Aussi une merveilleuse question! Qu'est-ce que nous faisons? MongoDB a le concept d'enregistrements de quorum, les lectures de quorum. Quand un message peut-il dispara√Ætre? Lorsque l'enregistrement n'est pas le quorum ou lorsque la lecture n'est pas le quorum (certaines ordures peuvent √©galement coller). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce qui concerne la coh√©rence causale, nous avons effectu√© un grand test exp√©rimental, qui a abouti au fait que lorsque l'enregistrement et la lecture ne sont pas du quorum, des violations de coh√©rence causale se produisent. Exactement ce que vous dites!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre conseil: utilisez au moins la lecture du quorum lorsque vous utilisez la coh√©rence causale. Dans ce cas, rien ne sera perdu, m√™me si l'enregistrement de quorum est perdu ... Il s'agit d'une situation orthogonale: si l'utilisateur ne veut pas que les donn√©es soient perdues, vous devez utiliser l'enregistrement de quorum. La coh√©rence causale ne garantit pas la durabilit√©. La garantie de durabilit√© est fournie par la r√©plication et les machines associ√©es √† la r√©plication. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lorsque nous cr√©ons une instance que le sharding fait pour nous (pas ma√Ætre, mais esclave, respectivement), elle s'appuie sur l'heure unix de sa propre machine ou sur l'heure du ¬´ma√Ætre¬ª; synchronis√© pour la premi√®re fois ou p√©riodiquement? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Maintenant, je vais √™tre clair. √âclat (c.-√†-d. Partition horizontale) - il y a toujours primaire. Et dans un √©clat, il peut y avoir un ¬´ma√Ætre¬ª et il peut y avoir des r√©pliques. Mais le fragment prend toujours en charge l'√©criture, car il doit prendre en charge un certain domaine (le principal est dans le fragment). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Autrement dit, tout d√©pend uniquement du "ma√Ætre"? Toujours utiliser l'heure "ma√Ætre"? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui. On peut dire au figur√©: l'horloge tourne quand il y a un enregistrement dans le "master", dans le "Oplog". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous avons un client qui se connecte, et il n'a besoin de rien savoir du temps? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En g√©n√©ral, vous n'avez besoin de rien savoir! Si nous parlons de la fa√ßon dont cela fonctionne sur le client: chez le client, lorsqu'il veut utiliser la coh√©rence causale, il doit ouvrir une session. Maintenant, tout est l√†: √† la fois les transactions dans la session et la r√©cup√©ration des droits ... Une session est un ordre des √©v√©nements logiques se produisant avec un client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il ouvre cette session et dit qu'il souhaite la coh√©rence causale (si par d√©faut la session prend en charge la coh√©rence causale), tout fonctionne automatiquement. Le conducteur se souvient de cette heure et l'augmente lorsqu'il re√ßoit un nouveau message. Il se souvient de la r√©ponse qui a renvoy√© la pr√©c√©dente du serveur qui a renvoy√© les donn√©es. La demande suivante contiendra afterCluster ("le temps est sup√©rieur √† cela").</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le client n'a absolument besoin de rien savoir! C'est absolument opaque pour lui. Si les gens utilisent ces fonctionnalit√©s, que puis-je faire? Tout d'abord, vous pouvez lire les secondaires en toute s√©curit√©: vous pouvez √©crire en primaire, lire √† partir de secondaires r√©pliqu√©s g√©ographiquement et √™tre s√ªr que cela fonctionne. Dans le m√™me temps, les sessions enregistr√©es sur Primary peuvent √™tre transf√©r√©es m√™me sur Secondary, c'est-√†-dire que vous pouvez utiliser non pas une session, mais plusieurs. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Le th√®me de la coh√©rence √©ventuelle est √©troitement li√© √† la nouvelle couche de science informatique - types de donn√©es CRDT (Conflict-free Replicated Data Types). Avez-vous envisag√© l'int√©gration de ces types de donn√©es dans la base de donn√©es et que pouvez-vous en dire? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bonne question! CRDT a du sens pour les conflits d'√©criture: dans MongoDB - ma√Ætre unique. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- J'ai une question des devops. Dans le monde r√©el, il y a de telles situations j√©suites lorsque l'√©chec byzantin se produit et que les m√©chants √† l'int√©rieur du p√©rim√®tre prot√©g√© commencent √† s'en tenir au protocole, √† envoyer des colis d'artisanat d'une mani√®re sp√©ciale? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8d/m3/p5/8dm3p5em6rsqsv2ojzy-vdylffg.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Les m√©chants √† l'int√©rieur du p√©rim√®tre sont comme un cheval de Troie! Les mauvaises personnes √† l'int√©rieur du p√©rim√®tre peuvent faire beaucoup de mauvaises choses. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Il est clair que laisser un trou dans le serveur, √† peu pr√®s, √† travers lequel vous pouvez coller le zoo des √©l√©phants et effondrer le cluster entier pour toujours ... Il faudra du temps pour une r√©cup√©ration manuelle ... C'est, pour le moins, mal. D'un autre c√¥t√©, c'est curieux: dans la vraie vie, dans la pratique, il y a des situations o√π des attaques internes naturellement similaires se produisent? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Comme je rencontre rarement des failles de s√©curit√© dans la vie r√©elle, je ne peux pas dire - peut-√™tre qu'elles se produisent. Mais si nous parlons de philosophie de d√©veloppement, nous le pensons: nous avons un p√©rim√®tre qui fournit les gars qui assurent la s√©curit√© - c'est un ch√¢teau, un mur; et √† l'int√©rieur du p√©rim√®tre, vous pouvez faire tout ce que vous voulez. Il est clair qu'il y a des utilisateurs avec la possibilit√© de ne regarder que, et il y a des utilisateurs avec la possibilit√© d'effacer le r√©pertoire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon les droits, les dommages que les utilisateurs peuvent faire peuvent √™tre une souris ou un √©l√©phant. Il est clair qu'un utilisateur disposant de tous les droits peut tout faire. Un utilisateur avec des droits de pr√©judice non √©tendus peut causer beaucoup moins. En particulier, il ne peut pas briser le syst√®me. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dans le p√©rim√®tre s√©curis√©, quelqu'un a grimp√© pour former des protocoles inattendus pour le serveur afin de configurer le serveur avec un cancer, et si vous avez de la chance, alors tout le cluster ... Est-ce que √ßa arrive si bien? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je n'ai jamais entendu parler de telles choses. Le fait que vous puissiez ainsi remplir le serveur n'est pas un secret. Remplir √† l'int√©rieur, √™tre du protocole, √™tre un utilisateur autoris√© qui peut √©crire quelque chose comme √ßa dans un message ... En fait, c'est impossible, car de toute fa√ßon ce sera v√©rifi√©. Il est possible de d√©sactiver cette authentification pour les utilisateurs qui ne le souhaitent pas - c'est alors leur probl√®me; grosso modo, ils ont eux-m√™mes d√©truit les murs et vous pouvez y entasser un √©l√©phant, qui va fouler aux pieds ... En g√©n√©ral, vous pouvez vous habiller en r√©parateur, venez le chercher! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Merci pour le rapport. </font><font style="vertical-align: inherit;">Sergey (Yandex). </font><font style="vertical-align: inherit;">Dans ¬´Mong¬ª, il existe une constante qui limite le nombre de membres votants dans le jeu de r√©pliques, et cette constante est 7 (sept). </font><font style="vertical-align: inherit;">Pourquoi est-ce une constante? </font><font style="vertical-align: inherit;">Pourquoi n'est-ce pas une sorte de param√®tre? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Replica Set, nous avons √©galement 40 n≈ìuds. </font><font style="vertical-align: inherit;">Il y a toujours une majorit√©. </font><font style="vertical-align: inherit;">Je ne sais pas quelle version ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans le jeu de r√©plicas, vous pouvez ex√©cuter des membres non votants, mais votant - un maximum de 7. Comment, dans ce cas, subir un arr√™t si le jeu de r√©plicas est tir√© vers 3 centres de donn√©es? </font><font style="vertical-align: inherit;">Un centre de donn√©es peut facilement s'√©teindre et une autre machine tombe en panne. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - C'est d√©j√† un peu en dehors du champ d'application du rapport. </font><font style="vertical-align: inherit;">C'est une question courante. </font><font style="vertical-align: inherit;">Peut-√™tre que je pourrai alors lui dire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9t/cr/ga/9tcrgaodiufisllhrktf_5iok_a.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UnAprFMX1d4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicit√© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des mat√©riaux plus int√©ressants? Soutenez-nous en passant une commande ou en recommandant √† vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les d√©veloppeurs √† partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entr√©e de gamme que nous avons invent√© pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la v√©rit√© sur VPS (KVM) E5-2697 v3 (6 c≈ìurs) 10 Go DDR4 480 Go SSD 1 Gbit / s √† partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donn√©es Equinix Tier IV √† Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV √† partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - √† partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©ation d'un b√¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr487626/index.html">Comment fonctionnent les capteurs de stationnement et comment le tromper</a></li>
<li><a href="../fr487628/index.html">Diagnostic du vieillissement bas√© sur 9 caract√©ristiques des signes du vieillissement</a></li>
<li><a href="../fr487630/index.html">L'algorithme le plus simple pour cr√©er un puzzle de terrain (partie 1)</a></li>
<li><a href="../fr487632/index.html">¬´Chers coll√®gues, respirez plus tranquillement¬ª: pourquoi le bruit des bureaux nous rend fous - nous discutons de la recherche</a></li>
<li><a href="../fr487636/index.html">API pour lesquelles il vaut enfin la peine de passer de Java 8. Partie 2</a></li>
<li><a href="../fr487640/index.html">Test d'automatisation de jeu</a></li>
<li><a href="../fr487644/index.html">Obtenir des cotations boursi√®res en utilisant Python</a></li>
<li><a href="../fr487646/index.html">√âtoile √† neutrons du tube √† essai. Sonoluminescence</a></li>
<li><a href="../fr487648/index.html">Il pourrait s'agir d'un autre framework javascript.</a></li>
<li><a href="../fr487650/index.html">Esp√©rons sur le SDK et ne vous trompez pas: le probl√®me des parchemins imbriqu√©s dans le BottomSheetBehavior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>