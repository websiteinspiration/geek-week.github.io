<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ ๐บ๏ธ ูุตุงุฆุญ ูุญูู Kubernetes: ููุฒุงุช ููุช ุชุดุบูู ุฅููุงู ุงูุชุดุบูู ุงูุฑุงุฆุนุฉ ูู NGINX ู PHP-FPM ๐๐ฝ ๐ ๐ฉโโ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุดุฑุท ูููุฐุฌู ูุชูููุฐ CI / CD ูู Kubernetes: ูุฌุจ ุฃู ูููู ุงูุชุทุจูู ูุงุฏุฑูุง ุนูู ุงูุชููู ุนู ูุจูู ุทูุจุงุช ุงูุนููุงุก ุงูุฌุฏูุฏุฉ ูุจู ุงูุชููู ุ ูุงูุฃูู ูู ุฐูู ุ ุฅููุงู ุงูุทูุจุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ูุตุงุฆุญ ูุญูู Kubernetes: ููุฒุงุช ููุช ุชุดุบูู ุฅููุงู ุงูุชุดุบูู ุงูุฑุงุฆุนุฉ ูู NGINX ู PHP-FPM</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/489994/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุฑุท ูููุฐุฌู ูุชูููุฐ CI / CD ูู Kubernetes: ูุฌุจ ุฃู ูููู ุงูุชุทุจูู ูุงุฏุฑูุง ุนูู ุงูุชููู ุนู ูุจูู ุทูุจุงุช ุงูุนููุงุก ุงูุฌุฏูุฏุฉ ูุจู ุงูุชููู ุ ูุงูุฃูู ูู ุฐูู ุ ุฅููุงู ุงูุทูุจุงุช ุงูุญุงููุฉ ุจูุฌุงุญ. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/ry/ef/karyefzfd99wtpxne9r_o73wies.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุญ ูู ุงูุงูุชุซุงู ููุฐุง ุงูุดุฑุท ุจุนุฏู ุชุญููู ุฃู ููุช ุชุนุทู ุฃุซูุงุก ุงููุดุฑ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุญุชู ุนูุฏ ุงุณุชุฎุฏุงู ุงูุญุฒู ุงูุดุงุฆุนุฉ ุฌุฏูุง (ูุซู NGINX ู PHP-FPM) ุ ูุฏ ุชูุงุฌู ุตุนูุจุงุช ุชุคุฏู ุฅูู ุฒูุงุฏุฉ ูู ุงูุฃุฎุทุงุก ูุน ูู ุนูููุฉ ูุดุฑ ...</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุฉ. </font><font style="vertical-align: inherit;">ููู ูุนูุด ุฌุฑุงุจ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ูุดุฑูุง </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ุงูููุงูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงููุนู ุจุงูุชูุตูู ุญูู ุฏูุฑุฉ ุญูุงุฉ ุงููุจุณููุฉ </font><font style="vertical-align: inherit;">. ูู ุณูุงู ูุฐุง ุงูููุถูุน ุ ูุญู ููุชููู ุจูุง ููู: ูู ุงููุญุธุฉ ุงูุชู ูุฏุฎู ูููุง ุงูุจูุฏ ุฅูู ุญุงูุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅููุงุก</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุชููู ุฅุฑุณุงู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุฅููู ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชู ุฅุฒุงูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฑุงุจ </font><font style="vertical-align: inherit;">ูู ูุงุฆูุฉ ููุงุท ุงูููุงูุฉ ููุฎุฏูุฉ). ูุจุงูุชุงูู ุ ูุชุฌูุจ ุชููู ุงูุนูู ุฃุซูุงุก ุงููุดุฑ ุ ูู ุฌุงูุจูุง ุ ูููู ุญู ูุดููุฉ ุฅููุงู ุงูุชุทุจูู ุจุดูู ุตุญูุญ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฌุจ ุฃู ูุชุฐูุฑ ุฃูุถูุง ุฃู ูุชุฑุฉ ุงูุณูุงุญ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 ุซุงููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุดูู ุงูุชุฑุงุถู </font><font style="vertical-align: inherit;">: ุจุนุฏ ุฐูู ุ ุณูุชู ุฅููุงุก ุงูููุฏ ููุฌุจ ุฃู ูุชููู ุงูุชุทุจูู ูู ูุนุงูุฌุฉ ุฌููุน ุงูุทูุจุงุช ูุจู ูุฐู ุงููุชุฑุฉ. </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุญูุธุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ุนูู ุงูุฑุบู ูู ุฃู ุฃู ุทูุจ ูุชู ุชุดุบููู ูุฃูุซุฑ ูู 5-10 ุซูุงูู ููุซู ูุดููุฉ ุจุงููุนู ุ ููู ูุณุงุนุฏู ุงูุฅุบูุงู ุงูุฑุดูู ุจุนุฏ ุงูุขู ...</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูููู ุฃูุถู ููุง ูุญุฏุซ ุนูุฏูุง ุชูุชูู pod ูู ุนูููุง ุ ูููู ุฏุฑุงุณุฉ ุงููุฎุทุท ุงูุชุงูู: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zx/pt/ou/zxptou-qe7zxqgab6pszsdo5vlk.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A1 ุ B1 - ุงูุญุตูู ุนูู ุชุบููุฑุงุช ุญูู ุญุงูุฉ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฌุฒุก </font><font style="vertical-align: inherit;">ุงููุฑุนู </font><font style="vertical-align: inherit;">A2: ุฅุฑุณุงู SIGTERM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B2 - ุฅุฒุงูุฉ pod ูู ููุงุท ุงูููุงูุฉ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B3 - ุงูุญุตูู ุนูู ุงูุชุบููุฑุงุช (ุชุบูุฑุช ูุงุฆูุฉ ููุงุท ุงูููุงูุฉ) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
B4 - ุชุญุฏูุซ ููุงุนุฏ iptables</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ููุงุญุธุฉ: ูุง ูุชู ุฅุฒุงูุฉ pod endpod ูุฅุฑุณุงู SIGTERM ุจุงูุชุณูุณู ุ ูููู ุจุงูุชูุงุฒู. ููุธุฑูุง ูุญูููุฉ ุฃู Ingress ูุง ุชุชููู ูุงุฆูุฉ ูุญุฏุซุฉ ุจููุงุท ุงูููุงูุฉ ุนูู ุงูููุฑ ุ ุณูุชู ุฅุฑุณุงู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ูู ุงูุนููุงุก ุฅูู pod ุ ููุง ุณูุคุฏู ุฅูู ุญุฏูุซ 500 ุฎุทุฃ ุฃุซูุงุก ุฅููุงุก pod</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุฌููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุงุฏ ุฃูุซุฑ ุชูุตููุงู ุญูู ูุฐุง ุงูููุถูุน </font><font style="vertical-align: inherit;">)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุฃูุช ุจุญุงุฌุฉ ุฅูู ุญู ูุฐู ุงููุดููุฉ ุจุงูุทุฑู ุงูุชุงููุฉ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฑุณุงู ุฑุคูุณ ุงูุงุชุตุงู: ุงุณุชุฌุงุจุฉ ูุฑูุจุฉ (ุฅุฐุง ูุงูุช ุชุชุนูู ุจุชุทุจูู HTTP).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฐุง ูู ุชูู ููุงู ุทุฑููุฉ ูุฅุฌุฑุงุก ุชุบููุฑุงุช ุนูู ุงูุฑูุฒ ุ ูุฅู ุงูููุงูุฉ ุชุตู ุญูุงู ุณูุณูุญ ูู ุจูุนุงูุฌุฉ ุงูุทูุจุงุช ุญุชู ููุงูุฉ ุงููุชุฑุฉ ุงูุฑุดููุฉ.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุฉ. </font><font style="vertical-align: inherit;">ููู ุชููู NGINX ู PHP-FPM ุนูููุงุชููุง</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nginx</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุจุฏุฃ ุจู NGINX ุ ูุฃู ูู ุดูุก ุฃุตุจุญ ุฃูุซุฑ ุฃู ุฃูู ูุถูุญูุง ูุนูุง. </font><font style="vertical-align: inherit;">ููุบูุณูุง ูู ุงููุธุฑูุฉ ุ ูุชุนูู ุฃู NGINX ูุฏููุง ุนูููุฉ ุฑุฆูุณูุฉ ูุงุญุฏุฉ ูุงูุนุฏูุฏ ูู "ุงูุนูุงู" - ูุฐู ุนูููุงุช ุชุงุจุนุฉ ุชุนุงูุฌ ุทูุจุงุช ุงูุนููุงุก. </font><font style="vertical-align: inherit;">ูุชู ุชูููุฑ ููุฒุฉ ููุงุฆูุฉ: ุงุณุชุฎุฏุงู ุงูุฃูุฑ </font></font><code>nginx -s &lt;SIGNAL&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅููุงุก ุงูุนูููุงุช ุฅูุง ูู ูุถุน ุฅููุงู ุงูุชุดุบูู ุงูุณุฑูุน ุฃู ูู ุฅููุงู ุชุดุบูู ุฑุดูู. </font><font style="vertical-align: inherit;">ูู ุงููุงุถุญ ุฃููุง ููุชููู ุจุงูุชุญุฏูุฏ ุจุงูุฎูุงุฑ ุงูุฃุฎูุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ูู ุดูุก ุจุณูุท: ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุฑ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุฎุทุงู preStop</font></a><font style="vertical-align: inherit;"> ุงูุฐู ุณูุฑุณู ุฅุดุงุฑุฉ ุญูู ุฅููุงู ุงูุชุดุบูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">ุงูุขูู</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูููู ุงูููุงู ุจุฐูู ูู ุงููุดุฑ ุ ูู ูุชูุฉ ุงูุญุงููุฉ:</font></font><br>
<br>
<pre><code class="plaintext hljs">       lifecycle:<font></font>
          preStop:<font></font>
            exec:<font></font>
              command:<font></font>
              - /usr/sbin/nginx<font></font>
              - -s<font></font>
              - quit</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ูู ุงูููุช ุงูุฐู ูููู ููู ุงูุจูุฏ ุนููู ูู ุณุฌูุงุช ุญุงููุงุช NGINX ุ ุณูุฑู ูุง ููู:</font></font><br>
<br>
<pre><code class="plaintext hljs">2018/01/25 13:58:31 [notice] 1#1: signal 3 (SIGQUIT) received, shutting down<font></font>
2018/01/25 13:58:31 [notice] 11#11: gracefully shutting down</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฐุง ุณูุนูู ูุง ูุญุชุงุฌู: ุชูุชุธุฑ NGINX ุฅุชูุงู ุงูุงุณุชุนูุงูุงุช ุ ุซู ุชูุชู ุงูุนูููุฉ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุณูุชู ููุงูุดุฉ ูุดููุฉ ุดุงุฆุนุฉ ุฃุฏูุงู ุ ูุฃูู ุ ุญุชู ุฅุฐุง ูุงู ููุงู ุฃูุฑ ุ ูุง </font></font><code>nginx -s quit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุชูู ุงูุนูููุฉ ุจุดูู ุตุญูุญ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ูุฐู ุงููุฑุญูุฉ ุงูุชูููุง ูู NGINX: ุนูู ุงูุฃูู ููููู ุฃู ุชููู ูู ุงูุณุฌูุงุช ุฃู ูู ุดูุก ูุนูู ููุง ููุจุบู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุฐุง ุนู PHP-FPMุ </font><font style="vertical-align: inherit;">ููู ูุชุนุงูู ูุน ุงูุงุบูุงู ุงูุฑุดููุ </font><font style="vertical-align: inherit;">ุฏุนูุง ูุญุตู ุนูู ุญู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-FPM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุญุงูุฉ PHP-FPM ุ ูุนูููุงุช ุฃูู ููููุงู. </font><font style="vertical-align: inherit;">ุฅุฐุง ุฑูุฒุช ุนูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฏููู ุงูุฑุณูู ูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PHP-FPM ุ ูุณูุฎุจุฑู ุฃูู ูุชู ุชููู ุฅุดุงุฑุงุช POSIX ุงูุชุงููุฉ:</font></font><br>
<br>
<ol>
<li> <code>SIGINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>SIGTERM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ุฅููุงู ุงูุชุดุบูู ุงูุณุฑูุน.</font></font></li>
<li> <code>SIGQUIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ุฅุบูุงู ุฑุดูู (ูุง ูุญุชุงุฌู).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจููุฉ ุงูุฅุดุงุฑุงุช ูู ูุฐู ุงููุดููุฉ ููุณุช ูุทููุจุฉ ุ ูุฐูู ุ ุชู ุญุฐู ุชุญููููุง. </font><font style="vertical-align: inherit;">ูุฅููุงู ุงูุนูููุฉ ุจุดูู ุตุญูุญ ุ ุณุชุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุฎุทุงู preStop ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="plaintext hljs">        lifecycle:<font></font>
          preStop:<font></font>
            exec:<font></font>
              command:<font></font>
              - /bin/kill<font></font>
              - -SIGQUIT<font></font>
              - "1"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููููุฉ ุงูุฃููู ุ ูุฐุง ูู ูู ูุง ูู ูุทููุจ ูุฅุฌุฑุงุก ุฅุบูุงู ุฑุดูู ูู ููุชุง ุงูุญุงููุชูู. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุฅู ุงููููุฉ ุฃูุซุฑ ุชุนููุฏูุง ููุง ุชุจุฏู ุนููู. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ูุญุตูุง ุญุงูุชูู ูู ููุฌุญ ููู ุงูุฅุบูุงู ุงูุฑุดูู ูุชุณุจุจ ูู ุนุฏู ุฅููุงููุฉ ุงููุตูู ุฅูู ุงููุดุฑูุน ุนูู ุงููุฏู ุงููุตูุฑ ุฃุซูุงุก ุงููุดุฑ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฑุณุฉ. </font><font style="vertical-align: inherit;">ูุดุงูู ูุญุชููุฉ ูุน ุฅุบูุงู ุฑุดูู</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nginx</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูู ุงููููุฏ ุฃู ูุชุฐูุฑ: ุจุงูุฅุถุงูุฉ ุฅูู ุชูููุฐ ุงูุฃูุฑ ุ </font></font><code>nginx -s quit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงู ุฎุทูุฉ ุฃุฎุฑู ูุฌุจ ุงูุงูุชุจุงู ุฅูููุง. ูุงุฌูุชูุง ูุดููุฉ ุนูุฏูุง ุฃุฑุณูุช NGINX ุจุฏูุงู ูู ุฅุดุงุฑุฉ SIGQUIT SIGTERM ุนูู ุฃู ุญุงู ุ ูุงูุชู ูู ุชูุชูู ุงูุทูุจุงุช ุจุดูู ุตุญูุญ. ูููู ุงูุนุซูุฑ ุนูู ุญุงูุงุช ููุงุซูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ููุฃุณู ุ ูู ูุชููู ูู ุชุญุฏูุฏ ุณุจุจ ูุญุฏุฏ ููุฐุง ุงูุณููู: ูุงู ููุงู ุดู ูู ุฅุตุฏุงุฑ NGINX ุ ูููู ูู ูุชู ุชุฃููุฏู. ูุงูุช ุงูุฃุนุฑุงุถ ุฃูู ูู ุณุฌูุงุช ุญุงููุฉ NGINX ููุญุธุช ุงูุฑุณุงุฆู </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ูุฃุฎุฐ ููุชูุญ ุฑูู 10 ุงููุณุงุฑ ูู ุงุชุตุงู 5"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุจุนุฏ ุฐูู ุชููู ุงูุฌุฑุงุจ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููููุง ููุงุญุธุฉ ูุซู ูุฐู ุงููุดููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู ุงูุฅุฌุงุจุงุช ุนูู Ingress ุงูุชู ูุญุชุงุฌูุง: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/sz/ip/umszip1dlpudotn2dstg17qfnzs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุคุดุฑุงุช ุฑูุฒ ุงูุญุงูุฉ ูู ููุช ุงููุดุฑ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุฐู ุงูุญุงูุฉ ุ ูุญุตู ููุท ุนูู ุฑูุฒ ุงูุฎุทุฃ 503 ูู Ingress ููุณูุง: ูุง ูููููุง ุงููุตูู ุฅูู ุญุงููุฉ NGINX ุ ูุฃููุง ูู ุชุนุฏ ูุชุงุญุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุธุฑุช ุฅูู ุณุฌูุงุช ุงูุญุงููุฉ ุจุงุณุชุฎุฏุงู NGINX ุ ูุณุชุญุชูู ุนูู ูุง ููู:</font></font><br>
<br>
<pre><code class="plaintext hljs">[alert] 13939#0: *154 open socket #3 left in connection 16<font></font>
[alert] 13939#0: *168 open socket #6 left in connection 13</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุชุบููุฑ ุฅุดุงุฑุฉ ุงูุชููู ุ ุชุจุฏุฃ ุงูุญุงููุฉ ูู ุงูุชููู ุจุดูู ุตุญูุญ: ููุฐุง ูุคูุฏ ูู ุฎูุงู ุญูููุฉ ุฃู ุฎุทุฃ 503 ูู ูุนุฏ ููุงุญุธูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงุฌูุช ูุดููุฉ ููุงุซูุฉ ุ ููู ุงูููุทูู ูุนุฑูุฉ ุฃู ุฅุดุงุฑุฉ ุชููู ูุชู ุงุณุชุฎุฏุงููุง ูู ุงูุญุงููุฉ ูููู ูุจุฏู ุฎุทุงู preStop ุจุงูุถุจุท. </font><font style="vertical-align: inherit;">ูู ุงููููู ุฃู ุงูุณุจุจ ูููู ุจุงูุถุจุท ูู ุฐูู.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-FPM ... ูุงููุฒูุฏ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชู ูุตู ูุดููุฉ PHP-FPM ุจุดูู ุชุงูู: ููู ูุง ุชูุชุธุฑ ุงูุชูุงู ุงูุนูููุงุช ุงููุฑุนูุฉ ุ ูุชููููุง ุ ุจุณุจุจ ูุฌูุฏ 502 ุฎุทุฃ ุฃุซูุงุก ุงููุดุฑ ูุงูุนูููุงุช ุงูุฃุฎุฑู. ูููุฐ ุนุงู 2005 ูุงูุช ููุงู ุนุฏุฉ ุฑุณุงุฆู ุฎุทุฃ ุนูู bugs.php.net (ุนูู ุณุจูู ุงููุซุงูุ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ุงูุชู ุชุตู ูุฐู ุงููุดููุฉ. ูููู ุฑุจูุง ูู ุชุฑู ุฃู ุดูุก ูู ุงูุณุฌูุงุช: ุณุชุนูู PHP-FPM ุนู ุงูุชูุงู ุนูููุชูุง ุฏูู ุฃู ุฃุฎุทุงุก ุฃู ุฅุดุนุงุฑุงุช ูู ุฌูุงุช ุฎุงุฑุฌูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงููุดููุฉ ููุณูุง ูุฏ ุชุนุชูุฏ ุ ุฅูู ุญุฏ ุฃูู ุฃู ุฃูุจุฑ ุ ุนูู ุงูุชุทุจูู ููุณู ููุฏ ูุง ุชุธูุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงููุฑุงูุจุฉ. ุฅุฐุง ููุช ูุง ุชุฒุงู ุชูุงุฌูู ุ ูุญููุฆุฐู ูุชุจุงุฏุฑ ุฅูู ุงูุฐูู ุญู ุจุฏูู ุจุณูุท: ุฃุถู ุฎุทุงู preStop ุจุงุณุชุฎุฏุงู</font></font><code>sleep(30)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุณูุณูุญ ูู ุจุฅููุงู ุฌููุน ุงูุทูุจุงุช ุงูุชู ูุงูุช ูู ูุจู (ูุญู ูุง ููุจู ุทูุจุงุช ุฌุฏูุฏุฉ ุ ุญูุซ ุฅู ุงูุฌุฑุงุจ ููุฌูุฏ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุนู</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุญุงูุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅููุงุก</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ุ ูุจุนุฏ 30 ุซุงููุฉ ุณููุชูู ุงูุฌุฑุงุจ ููุณู ุจุฅุดุงุฑุฉ </font></font><code>SIGTERM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุชุถุญ ุฃูู </font></font><code>lifecycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุญุงููุฉ ุณุชุจุฏู ููุง ููู:</font></font><br>
<br>
<pre><code class="plaintext hljs">    lifecycle:<font></font>
      preStop:<font></font>
        exec:<font></font>
          command:<font></font>
          - /bin/sleep<font></font>
          - "30"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ูุธุฑูุง ููุคุดุฑ 30 ุซุงููุฉ ุ </font></font><code>sleep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู </font><font style="vertical-align: inherit;">ุจุฒูุงุฏุฉ ููุช ุงููุดุฑ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุดูู ููุญูุธ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุญูุซ ุณูุชู ุฅููุงุก ูู ุฌุฑุงุจ ููุฏุฉ </font><font style="vertical-align: inherit;">30 ุซุงููุฉ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฃูู</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ููู ุฃูุฑ ุณูุฆ. ูุง ุงูุฐู ูููู ุนููู ุจูุฐุงุ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ููุชูู ุฅูู ุงูุทุฑู ุงููุณุคูู ุนู ุงูุชูููุฐ ุงููุจุงุดุฑ ููุชุทุจูู. ูู ุญุงูุชูุง ุ ูุฐู ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-FPM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุงูุชู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชุฑุงูุจ ุจุดูู ุงูุชุฑุงุถู ุชูููุฐ ุงูุนูููุงุช ุงูุชุงุจุนุฉ ููุง</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ูุชู ุฅููุงุก ุงูุนูููุฉ ุงูุฑุฆูุณูุฉ ุนูู ุงูููุฑ. ูููู ุชุบููุฑ ูุฐุง ุงูุณููู ุจุงุณุชุฎุฏุงู ุชูุฌูู </font></font><code>process_control_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏุฏ ุงูุญุฏูุฏ ุงูุฒูููุฉ ูุงูุชุธุงุฑ ุงูุฅุดุงุฑุงุช ูู ุงููุนูู ูู ุฎูุงู ุงูุนูููุงุช ุงููุฑุนูุฉ. ุฅุฐุง ููุช ุจุชุนููู ุงููููุฉ ุฅูู 20 ุซุงููุฉ ุ ูุณูู ูุบุทู ูุฐุง ูุนุธู ุงูุทูุจุงุช ุงูุชู ูุชู ุชุดุบูููุง ูู ุงูุญุงููุฉ ุ ูุจุนุฏ ุงูุชูุงููุง ุ ุณูุชู ุฅููุงู ุงูุนูููุฉ ุงูุฑุฆูุณูุฉ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุน ูุฐู ุงููุนุฑูุฉ ุ ุณูุนูุฏ ุฅูู ูุดููุชูุง ุงูุฃุฎูุฑุฉ. ููุง ุณุจู ุฐูุฑู ุ ูุฅู Kubernetes ููุณุช ููุตุฉ ูุชุฌุงูุณุฉ: ูุณุชุบุฑู ุจุนุถ ุงูููุช ููุชูุงุนู ุจูู ููููุงุชูุง ุงููุฎุชููุฉ. ูุฐุง ุตุญูุญ ุจุดูู ุฎุงุต ุนูุฏูุง ููุธุฑ ูู ุนูู Ingresss ูุงูููููุงุช ุงูุฃุฎุฑู ุฐุงุช ุงูุตูุฉ ุ ูุฃูู ุจุณุจุจ ูุฐุง ุงูุชุฃุฎูุฑ ูู ููุช ุงููุดุฑ ุ ูู ุงูุณูู ุงูุญุตูู ุนูู ุฒูุงุฏุฉ ูุฏุฑูุง 500 ุฎุทุฃ. ุนูู ุณุจูู ุงููุซุงู ุ ูุฏ ูุญุฏุซ ุฎุทุฃ ูู ูุฑุญูุฉ ุฅุฑุณุงู ุทูุจ ุฅูู ุงูููุจุน ุ ูููู "ุงููุฌูุฉ ุงูุฒูููุฉ" ููุชูุงุนู ุจูู ุงูููููุงุช ูุตูุฑุฉ ููุนูุง ูุง - ุฃูู ูู ุซุงููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ุ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุงูุชุฑุงู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุน ุงูุชูุฌูู ุงููุฐููุฑ ุฃุนูุงู </font></font><code>process_control_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ุงุณุชุฎุฏุงู ุงูุจูุงุก ุงูุชุงูู ูู ุฃุฌู </font></font><code>lifecycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">lifecycle:<font></font>
  preStop:<font></font>
    exec:<font></font>
      command: ["/bin/bash","-c","/bin/sleep 1; kill -QUIT 1"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุฐู ุงูุญุงูุฉ ุ ูุญู ูุนูุถ ุงูุชุฃุฎูุฑ ูู ูุจู ุงููุฑูู </font></font><code>sleep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุฒูุฏ ูู ููุช ุงููุดุฑ ุจุดูู ููุญูุธ: ูู ููุงู ูุฑู ููุญูุธ ุจูู 30 ุซุงููุฉ ููุงุญุฏุฉุ .. ูู ุงููุงูุน ุ ูุชู ุงูุงุนุชูุงุก ุจู "ุงููุธููุฉ ุงูุฑุฆูุณูุฉ" </font></font><code>process_control_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ูุชู </font></font><code>lifecycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงููุง ููุท ูู "ุดุจูุฉ ุฃูุงู" ูู ุญุงูุฉ ุงูุชุฃุฎูุฑ. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุนุงู ุ ูุฅู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุณููู ุงูููุตูู ูุงูุญู ุงูุจุฏูู ุงูููุงุจู ููุณ ููุท PHP-FPM</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ูุฏ ุชูุดุฃ ุญุงูุฉ ููุงุซูุฉ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุนูุฏ ุงุณุชุฎุฏุงู ูุบุงุช / ุฃุทุฑ ุฃุฎุฑู. </font><font style="vertical-align: inherit;">ุฅุฐุง ูู ุชุชููู ูู ุฅุตูุงุญ ุฅููุงู ุงูุชุดุบูู ุงูุขูู ุจุทุฑู ุฃุฎุฑู - ุนูู ุณุจูู ุงููุซุงู ุ ุฃุนุฏ ูุชุงุจุฉ ุงูุดูุฑุฉ ุจุญูุซ ูุนุงูุฌ ุงูุชุทุจูู ุฅุดุงุฑุงุช ุงูุฅููุงุก ุจุดูู ุตุญูุญ - ููููู ุงุณุชุฎุฏุงู ุงูุทุฑููุฉ ุงูููุถุญุฉ. </font><font style="vertical-align: inherit;">ูุฏ ูุง ูููู ุฃุฌูู ุ ูููู ูุนูู.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฑุณุฉ. </font><font style="vertical-align: inherit;">ุญูู ุงูุงุฎุชุจุงุฑ ููุชุญูู ูู ุฃุฏุงุก ุฌุฑุงุจ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงุฎุชุจุงุฑ ุงูุญูู ูู ุฅุญุฏู ุงูุทุฑู ููุชุญูู ูู ููููุฉ ุนูู ุงูุญุงููุฉ ุ ูุฃู ูุฐุง ุงูุฅุฌุฑุงุก ูุฌุนูู ุฃูุฑุจ ุฅูู ุธุฑูู ุงููุชุงู ุงูุญููููุฉ ุนูุฏูุง ูุฒูุฑ ุงููุณุชุฎุฏููู ุงููููุน. ููููู ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุฎุชุจุงุฑ ุงูุชูุตูุงุช ุฃุนูุงู </font><font style="vertical-align: inherit;">: ููู ูุบุทู ุฌููุน ุงุญุชูุงุฌุงุชูุง ุจุดูู ูุซุงูู. ูููุง ููู ูุตุงุฆุญ ูุญูู ููุงุฎุชุจุงุฑ ุจุดูู ูุงุถุญ - ุจูุถู ุงูุฑุณูู ุงูุจูุงููุฉ ูู Grafana ู Yandex.Tank ููุณูุง - ูุซุงู ูู ุชุฌุฑุจุชูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃูู ุดูุก ููุง ูู </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญูู ูู ุงูุชุบููุฑุงุช ูู ุงููุฑุงุญู.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุจุนุฏ ุฅุถุงูุฉ ุฅุตูุงุญ ุฌุฏูุฏ ุ ูู ุจุชุดุบูู ุงูุงุฎุชุจุงุฑ ููุนุฑูุฉ ูุง ุฅุฐุง ูุงูุช ุงููุชุงุฆุฌ ูุฏ ุชุบูุฑุช ููุงุฑูุฉ ุจุงูุฅุทูุงู ุงูุณุงุจู. ุฎูุงู ุฐูู ุ ุณูููู ูู ุงูุตุนุจ ุชุญุฏูุฏ ุญููู ุบูุฑ ูุนุงูุฉ ุ ููู ุงููุณุชูุจู ููููู ููุท ุฅูุญุงู ุงูุถุฑุฑ (ุนูู ุณุจูู ุงููุซุงู ุ ุฒูุงุฏุฉ ููุช ุงููุดุฑ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุฐูุฑ ุขุฎุฑ - ุงูุธุฑ ุฅูู ุณุฌูุงุช ุงูุญุงููุฉ ุฃุซูุงุก ุฅููุงุฆูุง. ูู ูุชู ุชุณุฌูู ูุนูููุงุช ุฅููุงู ุงูุชุดุบูู ุงูููุชุงุฒุฉ ููุงูุ ูู ููุงู ุฃู ุฃุฎุทุงุก ูู ุงูุณุฌูุงุช ุนูุฏ ุงููุตูู ุฅูู ุงูููุงุฑุฏ ุงูุฃุฎุฑู (ุนูู ุณุจูู ุงููุซุงู ุ ุญุงููุฉ PHP-FPM ุงููุฌุงูุฑุฉ)ุ ุฃุฎุทุงุก ุงูุชุทุจูู ููุณู (ููุง ูู ุญุงูุฉ NGINX ุงูููุตููุฉ ุฃุนูุงู)ุ ุขูู ุฃู ุชุณุงุนุฏ ุงููุนูููุงุช ุงูุชูููุฏูุฉ ุงููุงุฑุฏุฉ ูู ูุฐู ุงูููุงูุฉ ุนูู ููู ูุง ูุญุฏุซ ููุญุงููุฉ ุจุดูู ุฃูุถู ุฃุซูุงุก ุฅููุงุฆูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐูู ุ ุชู ุฅุฌุฑุงุก ุฃูู ุงุฎุชุจุงุฑ ุชุฌุฑูุจู ุจุฏูู </font></font><code>lifecycle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุจุฏูู ุชูุฌููุงุช ุฅุถุงููุฉ ูุฎุงุฏู ุงูุชุทุจูู (</font></font><code>process_control_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู PHP-FPM). ูุงู ุงูุบุฑุถ ูู ูุฐุง ุงูุงุฎุชุจุงุฑ ูู ุชุญุฏูุฏ ุงูุนุฏุฏ ุงูุชูุฑูุจู ููุฃุฎุทุงุก (ููุง ุฅุฐุง ูุงูุช ููุฌูุฏุฉ ุนูู ุงูุฅุทูุงู). ุฃูุถูุง ุ ูู ุงููุนูููุงุช ุงูุฅุถุงููุฉ ุ ูุฌุจ ุฃู ูููู ูุนุฑูููุง ุฃู ูุชูุณุท โโููุช ุงููุดุฑ ููู ูููุฏ ูุงู ุญูุงูู 5-10 ุซูุงูู ูุญุงูุฉ ุงูุงุณุชุนุฏุงุฏ ุงููุงูู. ุงููุชุงุฆุฌ ูู ููุง ููู: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/yw/ap/ceywapg8q2kpztr-zdslhjy8brm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุธูุฑ ุจูุนุฉ ูู ุฃุฎุทุงุก 502 ุนูู ููุญุฉ ูุนูููุงุช Yandex.Tank ุ ูุงูุชู ุญุฏุซุช ูู ููุช ุงููุดุฑ ูุงุณุชูุฑุช ููุฏุฉ ุชุตู ุฅูู 5 ุซูุงูู. ูู ุงูููุชุฑุถ ุฃู ูุฐุง ุฃููู ุงูุทูุจุงุช ุงูุญุงููุฉ ููุฌุฑุงุจ ุงููุฏูู ุนูุฏูุง ุชู ุฅููุงุคู. ุจุนุฏ ุฐูู ุ ุธูุฑุช 503 ุฃุฎุทุงุก ุ ูุงูุชู ูุชุฌุช ุนู ุญุงููุฉ NGINX ูุชูููุฉ ุ ูุงูุชู ุชู ูุตููุง ุฃูุถูุง ุจุณุจุจ ุงููุงุฌูุฉ ุงูุฎูููุฉ (ุจุณุจุจ ุนุฏู ุชููู Ingress ูู ุงูุงุชุตุงู ุจูุง). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ูุฑู ููู</font></font><code>process_control_timeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู PHP-FPM ุณุชุณุงุนุฏูุง ูู ุงูุชุธุงุฑ ุงูุชูุงู ุงูุนูููุงุช ุงููุฑุนูุฉ ุ ุฃู </font><font style="vertical-align: inherit;">ุฅุตูุงุญ ูุซู ูุฐู ุงูุฃุฎุทุงุก. </font><font style="vertical-align: inherit;">ุงููุดุฑ ุงููุชูุฑุฑ ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุชูุฌูู: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/8g/0c/t58g0cs5b6umhjkmvlhjktbkio0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุนุฏ ููุงู ุงููุฒูุฏ ูู ุงูุฃุฎุทุงุก ุฃุซูุงุก ูุดุฑ 500s! </font><font style="vertical-align: inherit;">ุงููุดุฑ ูุงุฌุญ ุ ูุนูู ุงูุฅุบูุงู ุงูุฑุดูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ูุฌุฏุฑ ุชุฐูุฑ ุงููุญุธุฉ ูุน ุญุงููุงุช Ingress ุ ููู ูุณุจุฉ ุตุบูุฑุฉ ูู ุงูุฃุฎุทุงุก ุงูุชู ูููู ุฃู ููุน ูููุง ุจุณุจุจ ุงููุงุฑู ุงูุฒููู. </font><font style="vertical-align: inherit;">ูุชุฌูุจูุง ุ ูุจูู ุฅุถุงูุฉ ุงูุจูุงุก ูุน </font></font><code>sleep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฑุงุฑ ุงููุดุฑ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูู ุญุงูุชูุง ุงูุฎุงุตุฉ ุ ูู ุชูู ููุงู ุชุบููุฑุงุช ูุฑุฆูุฉ (ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูุฑุฉ ุฃุฎุฑู).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชูุชุงุฌ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฅููุงู ุงูุนูููุฉ ุจุดูู ุตุญูุญ ุ ูุชููุน ุงูุณููู ุงูุชุงูู ูู ุงูุชุทุจูู:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชุธุฑ ุจุถุน ุซูุงูู ุ ุซู ุชููู ุนู ูุจูู ุงูุงุชุตุงูุงุช ุงูุฌุฏูุฏุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชุธุฑ ุญุชู ุชูุชูู ุฌููุน ุงูุทูุจุงุช ูุชุบูู ุฌููุน ุงูุงุชุตุงูุงุช ุงููุณุชูุฑุฉ ุงูุชู ูุง ุชููุฐ ุงูุทูุจุงุช.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃููู ุนูููุชู.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ูุง ูููู ูุฌููุน ุงูุชุทุจููุงุช ุงูุนูู ุจูุฐู ุงูุทุฑููุฉ. </font><font style="vertical-align: inherit;">ุฃุญุฏ ุญููู ุงููุดููุฉ ูู ุญูุงุฆู Kubernetes ูู:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุถุงูุฉ ุฎุทุงู ูุจู ุงูุฅููุงู ููุชุธุฑ ุจุถุน ุซูุงูู</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุฑุงุณุฉ ููู ุชูููู ุงููุงุฌูุฉ ุงูุฎูููุฉ ูููุนููุงุช ุฐุงุช ุงูุตูุฉ.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุญ ููุง ูุซุงู NGINX ุจููู ุฃูู ุญุชู ุงูุชุทุจูู ุงูุฐู ูุฌุจ ุนููู ูู ุงูุจุฏุงูุฉ ูุนุงูุฌุฉ ุงูุฅุดุงุฑุงุช ุจุดูู ุตุญูุญ ููุฅูุฌุงุฒ ูุฏ ูุง ููุนู ุฐูู ุ ูุฐูู ูู ุงูููู ุงูุชุญูู ูู ูุฌูุฏ 500 ุฎุทุฃ ุฃุซูุงุก ูุดุฑ ุงูุชุทุจูู. ููุง ูุณูุญ ูู ุจุงููุธุฑ ุฅูู ุงููุดููุฉ ุนูู ูุทุงู ุฃูุณุน ูุนุฏู ุงูุชุฑููุฒ ุนูู ุฌุฑุงุจ ุฃู ุญุงููุฉ ูููุตูุฉ ุ ูููู ุงูุธุฑ ุฅูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุจุฃููููุง ููู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงุณุชุฎุฏุงู Yandex.Tank ูุฃุฏุงุฉ ุงุฎุชุจุงุฑ ุจุงูุงูุชุฑุงู ูุน ุฃู ูุธุงู ูุฑุงูุจุฉ (ูู ุญุงูุชูุง ุ ุชู ุฃุฎุฐ ุงูุจูุงูุงุช ูู Grafana ูุน ุฎูููุฉ ูู ุดูู Prometheus ููุงุฎุชุจุงุฑ). ุชุธูุฑ ูุดุงูู ุงูุฅุบูุงู ุงูุฑุดูู ุจูุถูุญ ุชุญุช ุงูุฃุญูุงู ุงูุซูููุฉ ุงูุชู ูููู ุฃู ูููุฏูุง ุงููุนูุงุฑ ุ ูุชุณุงุนุฏ ุงููุฑุงูุจุฉ ุนูู ุชุญููู ุงููููู ุจูุฒูุฏ ูู ุงูุชูุงุตูู ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ ุฃู ุจุนุฏู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฑุฏ ุนูู ุงูุชุนูููุงุช ุนูู ุงูููุงู: ูู ุงูุฌุฏูุฑ ุจุงูุฐูุฑ ุฃู ุงููุดููุงุช ูุงูุญููู ููุตููุฉ ููุง ูููุง ูุชุนูู ุจู NGINX Ingress. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุญุงูุงุช ุงูุฃุฎุฑู ุ ููุงู ุญููู ุฃุฎุฑู ุ ุฑุจูุง ุ ุณูุฃุฎุฐูุง ุจุนูู ุงูุงุนุชุจุงุฑ ูู ุงูููุงุฏ ุงูุชุงููุฉ ูู ุงูุฏูุฑุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุญุธุฉ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃุฎุฑู ูู ุฏูุฑุฉ ุงููุตุงุฆุญ ูุงูุญูู K8s:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุญุงุช ุงูุฃุฎุทุงุก ุงูุดุฎุตูุฉ ูู NGINX Ingress</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญูู ุชุฎุตูุต ุงูุนูุฏ ูุงูุญูู ุนูู ุชุทุจูู ุงูููุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุตูู ุฅูู ููุงูุน ุฏูู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ุ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณุฑูุน ุชูููุฏ ููุงุนุฏ ุงูุจูุงูุงุช ุงููุจูุฑุฉ.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar489984/index.html">AMA ุนู udalenka: ุงุณุฃู - ูุฌูุจ</a></li>
<li><a href="../ar489986/index.html">ุฃุฏุงุฉ Power Power Designer Utility - ุฃุฏุงุฉ ุชุทููุฑ ุฅููุชุฑูููุงุช ุงูุทุงูุฉ</a></li>
<li><a href="../ar489988/index.html">"ุถุน ูุฏูู ูู ุงูููุงุก!": ูุฑุงุฌุนุฉ ุฃุญุงุฏูุฉ ูููุญุฉ ุชุญูู Playme TIO S</a></li>
<li><a href="../ar489990/index.html">ููู ุฃููุฐ ููุชุจ ุงูุฎุฏูุฉ ุดุฑูุฉ ุฎุฏูุงุช ุ ุฃู ูุงุฐุง ูู ููุง ุนูููุ</a></li>
<li><a href="../ar489992/index.html">ุงูุฅุบูุงู ุงูุตุญูุญ ููุฌุฑุงุจ ูู ูุชูุฉ Kubernetes</a></li>
<li><a href="../ar489998/index.html">11. Fortinet ุงูุดุฑูุน ูู v6.0. ุงูุชุฑุฎูุต</a></li>
<li><a href="../ar490002/index.html">ููููุฉ ุงูุฑุณู ุงูุจูุงูู ุนูู Kotlin ู Micronaut ูุฅูุดุงุก ููุทุฉ ูุตูู ูุงุญุฏุฉ ุฅูู API ููุนุฏูุฏ ูู ุงูุฎุฏูุงุช ุงูุตุบูุฑุฉ</a></li>
<li><a href="../ar490006/index.html">ุจุฑูุงูุฌ ุชุนูููู ููููุงุตูุงุช ุงููููุฉ</a></li>
<li><a href="../ar490010/index.html">ูุญุต ูุธุงู ุงูููุน ููุชุญูู ูู ุตุญุฉ ุงูููุณููู</a></li>
<li><a href="../ar490012/index.html">ุงูุชูุจููุงุช ูุงูุฎุทุฃ ูู ุงูุชุฎุฒูู ุ ูููููุฉ ุงูุชุนุงูู ูุนูุงุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>