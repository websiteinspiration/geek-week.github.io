<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§™ğŸ¾ ğŸª ğŸ§” Zabbixã§PortSecurity Cisco Switchã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹ ğŸ‘©ğŸ»â€ğŸš’ ğŸ¿ ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã‚“ã«ã¡ã¯è¦ªæ„›ãªã‚‹habrosocietyï¼
 

ç§ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼ã‚„ä»–ã®ITå…„å¼Ÿã®æ´»å‹•ã‚’ä¿ƒé€²ã™ã‚‹ç¤¾å†…ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã„ãã¤ã‹ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ç½®ãã“ã¨ã«ã—ã¾ã—ãŸã€‚
 

ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä¸æ­£ã«æ¥ç¶šã•ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã®æ¨™æº–çš„ãªï¼ˆå¤šãã®ãƒ™ãƒ³ãƒ€ãƒ¼å‘ã‘ã®ï¼‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã‚ã‚‹PortSec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Zabbixã§PortSecurity Cisco Switchã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481658/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚“ã«ã¡ã¯è¦ªæ„›ãªã‚‹habrosocietyï¼</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯</font><font style="vertical-align: inherit;">ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼ã‚„ä»–ã®ITå…„å¼Ÿã®æ´»å‹•ã‚’ä¿ƒé€²ã™ã‚‹</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¤¾å†…</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’</font><font style="vertical-align: inherit;">ã„ãã¤ã‹ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ç½®ãã“ã¨ã«ã—ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä¸æ­£ã«æ¥ç¶šã•ã‚Œã‚‹ã®ã‚’</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜²ã</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŸã‚ã®æ¨™æº–çš„ãªï¼ˆå¤šãã®ãƒ™ãƒ³ãƒ€ãƒ¼å‘ã‘ã®ï¼‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã‚ã‚‹</font><em><font style="vertical-align: inherit;">PortSecurity</font></em><font style="vertical-align: inherit;">ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–ã«ç„¦ç‚¹ã‚’å½“ã¦</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯å…ƒã€…</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ã‚¹ã‚³ã®</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¤ãƒƒãƒç”¨ã«ä½œæˆã•ã‚Œã¾ã—ãŸ</font><font style="vertical-align: inherit;">ãŒã€å¿…è¦ã«å¿œã˜ã¦ã€SNMPãƒˆãƒ©ãƒƒãƒ—ã«åŸºã¥ã„ã¦ä»»æ„ã®ã‚¹ã‚¤ãƒƒãƒãŠã‚ˆã³ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦ç°¡å˜ã«çµ‚äº†ã§ãã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èˆˆå‘³ãŒã‚ã‚Œã°ã€kutã¸ã‚ˆã†ã“ã...</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ãŸã¡ãŒè©±ã—ã¦ã„ã‚‹ã“ã¨ã«ã¤ã„ã¦ã®ç°¡å˜ãªä½™è«‡ã€‚ </font></font></p><br>
<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PortSecurity</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼</font><font style="vertical-align: inherit;">ã¯ã€ã‚±ã‚·ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åŸºã¥ã„ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¹ã‚¤ãƒƒãƒã‚¢ã‚¯ã‚»ã‚¹ãƒãƒ¼ãƒˆã¯ã€ç€ä¿¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«å¯¾ã—ã¦æŒ‡å®šã•ã‚ŒãŸæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯1ã¤ï¼‰ã®ãƒãƒ”ãƒ¼ã‚’èª¿ã¹ã€æ–°ã—ã„ãƒãƒ”ãƒ¼ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨ã€ãƒãƒ¼ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¿è­·ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¹ã‚¤ãƒƒãƒã¯</font><font style="vertical-align: inherit;">ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­å®šã§æŒ‡å®šã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã«</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SNMP</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒˆãƒ©ãƒƒãƒ—ã‚’</font><font style="vertical-align: inherit;">é€ä¿¡ã™ã‚‹ã“ã¨ã‚‚ã§ã</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã«ã¯3ã¤ã®ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ã€‚</font></font></p><br>
<ol>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shutdown-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ãƒãƒ¼ãƒˆ+ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snmp-trap</font></font></em></li>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restrict-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ˜ãªmac + </font><em><font style="vertical-align: inherit;">snmp-trap</font></em><font style="vertical-align: inherit;">ã‹ã‚‰ã®ç€ä¿¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’åˆ¶é™ã—</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã™</font></font></em></li>
<li><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protected- </font></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒˆãƒ©ãƒƒãƒ—</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªã—ã§ã€æœªçŸ¥ã®Macã‹ã‚‰ã®ç€ä¿¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã«åˆ¶é™ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤šã‹ã‚Œå°‘ãªã‹ã‚Œå¤§è¦æ¨¡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ã€</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PortSecurity</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¤ãƒ™ãƒ³ãƒˆ</font><font style="vertical-align: inherit;">ãŒç¶™ç¶šã—ã¦ã„ã‚‹ãŸã‚ã€ç›£è¦–ã«éå¸¸ã«å½¹ç«‹ã¡ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã€è¦‹å‡ºã—ã‹ã‚‰æ¬¡ã®ã‚ˆã†ã«</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Zabbix</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p>   <em>Zabbix</em>   ,        .     ,    .    â€”    - (<em>trap handler</em>)    <em>SNMP</em>-.      <em>python</em>     <em>snmptrapd</em>.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">github</a>.</p><br>
<p>   ,   .</p><br>
<p>       : </p><br>
<h5 id="1-kommutator-cisco--2-demon-snmptrapd--3-the-script--4-zabbix">[1.  cisco] â†’ [2.  snmptrapd] â†’ [3. the script] â†’ [4. Zabbix]</h5><br>
<p>        </p><br>
<h4 id="1-cisco">1. Cisco</h4><br>
<p>   <em>host</em>       </p><br>
<pre><code class="bash hljs">snmp-server <span class="hljs-built_in">enable</span> traps port-security<font></font>
snmp-server <span class="hljs-built_in">enable</span> traps errdisable<font></font>
snmp-server host 10.1.0.1 version 2c public</code></pre><br>
<p> ,      <em>PortSecurity</em>. </p><br>
<p>   <em>PortSecurity</em>       <em>+</em>.       .   <em>restricted</em></p><br>
<pre><code class="bash hljs"> switchport port-security maximum 2<font></font>
 switchport port-security<font></font>
 switchport port-security violation restrict<font></font>
 switchport port-security mac-address sticky<font></font>
 switchport port-security mac-address sticky 1111.11co.ffee vlan access<font></font>
 switchport port-security mac-address sticky 0000.0000.beef vlan voice</code></pre><br>
<p>       <em>autorecovery</em>,             .  ,    ,        .</p><br>
<pre><code class="bash hljs">errdisable recovery cause psecure-violation<font></font>
errdisable recovery interval 300</code></pre><br>
<p>    . </p><br>
<p>   PortSecutity     </p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Cisco IOS Software Configuration Guide: Configuring Port Security</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Port security  xgu.ru</a></li>
</ul><br>
<h4 id="2-snmptrapd">2. snmptrapd</h4><br>
<p><em>snmptrapd</em> â€”      <em>snmp</em>-.  Ubuntu   </p><br>
<pre><code class="bash hljs">&gt; sudo apt install snmptrapd</code></pre><br>
<p>    <em>/etc/snmp/snmptrapd.conf</em></p><br>
<p>             (restricted|shutdown). </p><br>
<p>    :</p><br>
<ol>
<li>CISCO-ERR-DISABLE-MIB::cErrDisableInterfaceEvent (1.3.6.1.4.1.9.9.548.0.1.1) â€”     shutdown</li>
<li>ciscoPortSecurityMIB::cpsSecureMacAddrViolation (1.3.6.1.4.1.9.9.315.0.0.1) â€”     restrict</li>
</ol><br>
<p>    snmptrapd /etc/snmp/snmptrapd.conf   :</p><br>
<pre><code class="bash hljs">authCommunity   <span class="hljs-built_in">log</span>,execute,net public<font></font>
traphandle .1.3.6.1.4.1.9.9.315.0.0.1 /etc/zabbix/externalscripts/traphandlers/cisco-psec-traphandler.py<font></font>
traphandle .1.3.6.1.4.1.9.9.548.0.1.1 /etc/zabbix/externalscripts/traphandlers/cisco-psec-traphandler.py</code></pre><br>
<p>,  ,       <strong>315</strong>  <strong>548</strong>.</p><br>
<h4 id="3-the-script">3. the script</h4><br>
<p>       ,          ()     / .        ,       . , ,                  <em>config.ini</em>.</p><br>
<p>, , c onfig.ini  .      </p><br>
<pre><code class="bash hljs">[snmp]<font></font>
community = public<font></font>
<font></font>
[api]<font></font>
zabbix_url = https://zabbix.acme.loc<font></font>
zabbix_user = api_ro<font></font>
zabbix_passwd = neskazhu<font></font>
<font></font>
[zabbix]<font></font>
server = 10.1.1.1<font></font>
port = 10051<font></font>
zabbix_sender = /usr/bin/zabbix_sender<font></font>
<font></font>
<span class="hljs-comment">#the predefined keyname of an item that has to be created for a given host in Zabbix</span><font></font>
trapkeyname_disable = ErrDisable<font></font>
trapkeyname_restrict = ErrRestrict<font></font>
<font></font>
[logging]<font></font>
logfile = /var/<span class="hljs-built_in">log</span>/cisco-errdisable-traphandler.log<font></font>
loglevel = INFO</code></pre><br>
<p>       .    snmp-community,        <em>Zabbix</em>  <em>Zabbix_API</em>  <em>zabbix_sender</em>. </p><br>
<p>,    â€”   <em>trapkeyname_disable</em>  <em>trapkeyname_restrict</em>. </p><br>
<p>      <strong>548</strong>  <strong>315</strong>      <em>Items</em> ( )   <em>Zabbix</em>.</p><br>
<p> .    ,        : <strong>315</strong>  <strong>548</strong>. </p><br>
<p>       :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> <span class="hljs-string">"548.0.1.1"</span> <span class="hljs-keyword">in</span> trapstr:<font></font>
    mode = <span class="hljs-string">"disable"</span>
    trapkeyname = <span class="hljs-string">"trapkeyname_disable"</span><font></font>
<font></font>
<span class="hljs-keyword">elif</span> <span class="hljs-string">"315.0.0.1"</span> <span class="hljs-keyword">in</span> trapstr:<font></font>
    mode = <span class="hljs-string">"restrict"</span>
    trapkeyname = <span class="hljs-string">"trapkeyname_restrict"</span><font></font>
<font></font>
<span class="hljs-keyword">else</span>:<font></font>
    logging.error(<span class="hljs-string">"Unknown trap. Discarding ..."</span>)<font></font>
    exit(<span class="hljs-number">1</span>)</code></pre><br>
<p>    <em>Zabbix</em>  <em>Zabbix_API</em>  ,                .    <em>ZabbixAPI</em>    <em>host.get</em>  <em>item.get</em>.  .</p><br>
<p>   . </p><br>
<p>,       .  <br>
  548:</p><br>
<pre><code class="bash hljs">switch-20<font></font>
UDP: [0.0.0.0]-&gt;[192.168.99.20]:-2039<font></font>
DISMAN-EVENT-MIB::sysUpTimeInstance 338:5:51:38.08<font></font>
SNMPv2-MIB::snmpTrapOID.0 CISCO-ERR-DISABLE-MIB::cErrDisableInterfaceEvent<font></font>
cErrDisableIfStatusCause.10640.0 9</code></pre><br>
<p>    315: </p><br>
<pre><code class="bash hljs">switch-27<font></font>
UDP: [0.0.0.0]-&gt;[192.168.99.27]:-13209<font></font>
DISMAN-EVENT-MIB::sysUpTimeInstance 342:22:17:16.63<font></font>
SNMPv2-MIB::snmpTrapOID.0 CISCO-PORT-SECURITY-MIB::cpsSecureMacAddrViolation<font></font>
IF-MIB::ifIndex.10028 10028<font></font>
IF-MIB::ifName.10028 FastEthernet0/28<font></font>
CISCO-PORT-SECURITY-MIB::cpsIfSecureLastMacAddress.10028 0:22:55:88:ee:dd</code></pre><br>
<p>,        .           <em>ASN.1</em>,     .          .</p><br>
<p>         :</p><br>
<p> 548:</p><br>
<pre><code class="bash hljs">iso.3.6.1.2.1.1.3.0 21:19:06.72<font></font>
iso.3.6.1.6.3.1.1.4.1.0 iso.3.6.1.4.1.9.9.548.0.1.1<font></font>
iso.3.6.1.4.1.9.9.548.1.3.1.1.2.10640.0 9</code></pre><br>
<p> 315:</p><br>
<pre><code class="bash hljs">iso.3.6.1.2.1.1.3.0 342:22:17:16.63<font></font>
iso.3.6.1.6.3.1.1.4.1.0 iso.3.6.1.4.1.9.9.315.0.0.1<font></font>
iso.3.6.1.2.1.2.2.1.1.10028 10028<font></font>
iso.3.6.1.2.1.31.1.1.1.1.10028 <span class="hljs-string">"FastEthernet0/28"</span>
iso.3.6.1.4.1.9.9.315.1.2.1.1.10.10028 <span class="hljs-string">"00 22 55 88 EE DD "</span></code></pre><br>
<p> <em>ASN.1</em>,     ,           <em>json</em>  <em>xml</em>.        .                  .    ,   , <em>snmp</em>   .  <em>gNMI</em>   .     .    .</p><br>
<p>   ,     <strong>315</strong>         -,    <em>port-security</em>.     . </p><br>
<p>   <strong>548</strong>-  .       (switch-20) (            <em>forward</em>  <em>snmptrapd</em>),             â€” <em>SNMP ifIndex</em>. </p><br>
<p>       <em>iso.3.6.1.4.1.9.9.548.1.3.1.1.2.10640.0 9</em>    <strong>10640</strong> </p><br>
<p> ,   <em>ifIndex</em>    ,       <em>SNMP</em>.       <strong><em>find_ifDesc_from_ifIndex()</em></strong>.           <em>SNMP</em>       snmp-community,       <em>config.ini</em>. </p><br>
<p>       :</p><br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> mode <span class="hljs-keyword">is</span> <span class="hljs-string">"disable"</span>:<font></font>
    trapvalue = traplist[<span class="hljs-number">-2</span>]<font></font>
    ifIndex = trapvalue.split(<span class="hljs-string">"."</span>)[<span class="hljs-number">-2</span>]<font></font>
    ifName = find_ifDesc_from_ifIndex(ip, ifIndex, snmp_config[<span class="hljs-string">'community'</span>])<font></font>
<font></font>
<span class="hljs-keyword">elif</span> mode <span class="hljs-keyword">is</span> <span class="hljs-string">"restrict"</span>:<font></font>
    ifName = traplist[<span class="hljs-number">7</span>].strip(<span class="hljs-string">'"'</span>)<font></font>
    mac = <span class="hljs-string">':'</span>.join(traplist[<span class="hljs-number">-7</span>:<span class="hljs-number">-1</span>]).strip(<span class="hljs-string">'"'</span>)
</code></pre><br>
<p>          </p><br>
<ol>
<li>( ,  ,  )</li>
<li>( ,  , -,  )</li>
</ol><br>
<p>     <em>Zabbix</em>-. </p><br>
<p>     <em>Zabbix</em>        <em>API</em>.  (   ,      )      â€”  <strong><em>zabbix_sender</em></strong>. </p><br>
<p><strong><em>zabbix_sender</em></strong>   <em>hostname</em>  <em>key:value</em>   <em>value</em> â€”       ,              <em>Zabbix</em>.         <em>config.ini</em>   <em>trapkeyname_</em>.   <em>value</em>     ,      -.</p><br>
<h5 id="ustanovka-skripta"> </h5><br>
<p>    .    <em>snmptrapd</em>   <em>Zabbix</em>   .       <em>/etc/zabbix/external-scripts</em>    "    ". </p><br>
<p>     ,     requirements.txt.</p><br>
<p>      :</p><br>
<pre><code class="bash hljs">sudo -H pip install -r requirements.txt</code></pre><br>
<p>     <em>zabbix_sender</em>. </p><br>
<p>   <em>Ubuntu</em>    ,     <em>zabbix-sender</em>,      .  .. <em>sudo apt install zabbix-sender</em></p><br>
<h4 id="4-zabbix">4. Zabbix</h4><br>
<p> <em>Zabbix</em>   ,      ,     (Items)       .    ,            <em>config.ini</em>.    .            . </p><br>
<p>   Zabbix             <em>Zabbix</em>  <em>API</em>.      read-only         Frontend.</p><br>
<p>     : </p><br>
<p><img src="https://habrastorage.org/webt/ge/46/mj/ge46mjnp2x-jzyxmi5hehswifr4.png"></p><br>
<p>..  ,      <em>catalyst100</em>   <em>Fa0/2</em>  - <em>00:22:55:D4:3F:51</em> </p><br>
<p>, ,    .   ,   <em>Zabbix</em>,   Problems       20       .    -  17 ,       23.         .    :</p><br>
<pre><code class="bash hljs"><span class="hljs-variable">$ZABBIX_FRONTEND_HOME</span>/include/items.inc.php</code></pre><br>
<p>   :</p><br>
<pre><code class="php hljs">        <span class="hljs-keyword">switch</span> ($item[<span class="hljs-string">'value_type'</span>]) {
                <span class="hljs-keyword">case</span> ITEM_VALUE_TYPE_STR:<font></font>
                        $mapping = getMappedValue($value, $item[<span class="hljs-string">'valuemapid'</span>]);
                <span class="hljs-comment">// break; is not missing here</span>
                <span class="hljs-keyword">case</span> ITEM_VALUE_TYPE_TEXT:
                <span class="hljs-keyword">case</span> ITEM_VALUE_TYPE_LOG:
                        <span class="hljs-keyword">if</span> ($trim &amp;&amp; mb_strlen($value) &gt; <span class="hljs-number">20</span>) {<font></font>
                                $value = mb_substr($value, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>).<span class="hljs-string">'...'</span>;<font></font>
                        }<font></font>
</code></pre><br>
<p>    20-.   30.   .      .      .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSç§ã¯</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ã‚°</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨å‘¼ã°ã‚Œã‚‹1ã¤ã®Zabbixå›ºæœ‰ã®ãƒãƒƒãƒ—ã‚’å…±æœ‰ã—ãŸã„ã¨æ€ã„</font><em><font style="vertical-align: inherit;">ã¾ã™</font></em><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ãŠãã‚‰ãå¤šãã®äººãŒçŸ¥ã£ã¦ã„ã¾ã™ãŒã€å¤šãã¯å˜ã«èˆˆå‘³ãŒãªã„ã®ã§éš ã•ã‚Œã¾ã—ãŸï¼š</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zabbixã‚¿ã‚°</font></font></b><div class="spoiler_text"><p>    Actions:<br>
<img src="https://habrastorage.org/webt/gh/ua/ne/ghuanea2za4pvyjm2b2vlmsgjyk.png"></p><br>
<p>tag <em>portsecurity</em>           <em>Actions</em><br>
   .  .  ,      . </p></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ppsè¨˜äº‹ã®ç¬¬2éƒ¨ãŒå®Œæˆã—ã¾ã—ãŸã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbixãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒãƒ¼ãƒˆã®ãƒ­ãƒƒã‚¯è§£é™¤</font></font></a></p><cut></cut></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481644/index.html">21ä¸–ç´€ã®SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç”Ÿãæ®‹ã‚‹æ–¹æ³•ï¼šã‚¯ãƒ©ã‚¦ãƒ‰ã€Kubernetesã€PostgreSQLãƒãƒ«ãƒãƒã‚¹ã‚¿ãƒ¼</a></li>
<li><a href="../ja481648/index.html">Junos PyEZã¯ã€ç„¡æ–™ã®IPv4ã‚µãƒ–ãƒãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã®ä¾‹ã¨ã—ã¦</a></li>
<li><a href="../ja481652/index.html">ãƒãƒƒã‚¯ãƒ‰ã‚¢ï¼ˆï¼Ÿï¼‰BlackBerry Androidã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</a></li>
<li><a href="../ja481654/index.html">QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒãƒœãƒƒãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€Test ITã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦äººç”Ÿã‚’æ¥½ã«ã—ãŸæ–¹æ³•ã®ç‰©èª</a></li>
<li><a href="../ja481656/index.html">PagerDutyã€ã¾ãŸã¯æ‰‹è¡“éƒ¨é–€ãŒå¤œçœ ã‚Œãªã„ç†ç”±</a></li>
<li><a href="../ja481662/index.html">Kubernetesã§ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ§‹ç¯‰ãŠã‚ˆã³è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã®æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’è©¦ã™</a></li>
<li><a href="../ja481664/index.html">ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã®ä¾¡æ ¼ã¨ã‚³ã‚¹ãƒˆï¼šAWS Lambda</a></li>
<li><a href="../ja481666/index.html">ã‚«ã‚¹ã‚¿ãƒ SwiftLintãƒ«ãƒ¼ãƒ«</a></li>
<li><a href="../ja481670/index.html">AWSã‚¯ãƒ©ã‚¦ãƒ‰å°å…¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã™ã‚‹</a></li>
<li><a href="../ja481672/index.html">ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ãƒ«ã‚ªãƒ¼ãƒˆãƒãƒˆãƒ³</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>