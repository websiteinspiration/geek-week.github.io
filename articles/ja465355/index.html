<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕔 🧥 🚮 「a」が「a」と等しくない場合。1つのハックをきっかけに 🎩 👉🏼 🎫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="友人の一人に不愉快な話が起こった。しかし、それがミハイルにとって不快であることが判明した限り、それは私にとっても同じくらい楽しかったです。
 
 私の友人はかなりUNIXユーザーであると言わなければなりません。彼は自分でシステムをインストールし、mysql、phpをインストールして、最も単純なngi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>「a」が「a」と等しくない場合。1つのハックをきっかけに</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465355/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">友人の一人に不愉快な話が起こった。しかし、それがミハイルにとって不快であることが判明した限り、それは私にとっても同じくらい楽しかったです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の友人はかなり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font><font style="vertical-align: inherit;">であると言わなければなりません</font><font style="vertical-align: inherit;">。彼は自分でシステムをインストールし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">インストール</font><font style="vertical-align: inherit;">して、最も単純な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">設定を行う</font><font style="vertical-align: inherit;">ことができ</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして彼は建設ツールに専用のダースと半分のサイトを持っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チェーンソーに特化したこれらのサイトの1つは、TOP検索エンジンにしっかりと座っています。このサイトは非営利のレビュアーですが、誰かが喉を横切って彼を攻撃することに慣れています。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDoS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ブルートフォース、コメントの</font><font style="vertical-align: inherit;">いずれかで</font><font style="vertical-align: inherit;">わいせつな書き込みが行われ、ホスティングとILVに悪用が送信されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
突然、すべてが落ち着き、この沈静は良くなく、サイトは徐々に結果のトップラインを離れ始めました。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/528/5d5/582/5285d55827ddf5cb5705b364a417828f.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはことわざで、それからアドミンバイク自体。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電話が鳴ったとき、その時間は眠りに近づいていました。「サンヤ、私のサーバーを見ないの？</font><font style="vertical-align: inherit;">彼らは私をハッキングしたように思えますが、それを証明することはできませんが、その気持ちは3週目に残っています。</font><font style="vertical-align: inherit;">多分それは私がパラノイアを治療するためのちょうど時です？」</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の30分で、次のように要約できます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">繁殖地はかなり肥沃でした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラッカーはスーパーユーザー権限を取得する可能性があります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻撃（発生した場合）は、特にこのサイトを標的としました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題領域は修正され、侵入の事実があったかどうかを理解するだけで済みます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハッキングでは、サイトのコードやデータベースにアクセスできませんでした。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の段落について。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f7f/a85/93d/f7fa8593d835c577dd321eec9e30e2e4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
白いIPフロントエンドだけが世界を調べています。</font><font style="vertical-align: inherit;">http（s）を除いて、バックエンドとフロントエンドの間の交換はありません。ユーザー/パスワードは異なり、キーは交換されません。</font><font style="vertical-align: inherit;">灰色のアドレスでは、80/443を除くすべてのポートが閉じています。</font><font style="vertical-align: inherit;">ホワイトIPバックエンドは、マイケルが完全に信頼している2人のユーザーにのみ知られています。</font><i><font style="vertical-align: inherit;">Debian 9が</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フロントエンドにインストールされており</font><font style="vertical-align: inherit;">、電話がかかるまでに、システムは外部ファイアウォールによって世界から隔離されて停止しています。</font><font style="vertical-align: inherit;">
「OK、アクセスを許可して」私は1時間睡眠を延期することにしました。</font><font style="vertical-align: inherit;">「私は自分の目で見ます。」</font><font style="vertical-align: inherit;">
以下〜とする：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">$ grep -F PRETTY_NAME /etc/*releas*<font></font>
PRETTY_NAME="Debian GNU/Linux 9 (stretch)"<font></font>
$ `echo $SHELL` --version<font></font>
GNU bash, version 4.4.12(1)-release (x86_64-pc-linux-gnu)<font></font>
$ nginx -v<font></font>
nginx version: nginx/1.10.3<font></font>
$ gdb --version<font></font>
GNU gdb (Debian 8.2.1-2) 8.2.1<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハッキングの可能性を求めて</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーを最初に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rescue-modeで起動します</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私はディスクをマウントし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログ、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">履歴</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、システムログなどを</font><font style="vertical-align: inherit;">めくります</font><font style="vertical-align: inherit;">。可能であれば、ファイルの作成日を確認しますが、通常のクラッカーが彼の後ろを「汗をかく」し、Mishaが検索中にすでに「踏みにじられ」ていることはわかっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は通常モードで起動します。特に何を探すべきかまだわからないので、構成を勉強しています。</font><font style="vertical-align: inherit;">彼は主に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginxに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主に興味を持っています。</font><font style="vertical-align: inherit;">なぜなら、一般的に、フロントエンドには彼以外に何もないからです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定は小さく、十数個のファイルによく構造化されてい</font><font style="vertical-align: inherit;">ます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キューで</font><font style="vertical-align: inherit;">それらを調べ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">すべてがきれいなようですが、いくつかの</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インクルードを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見逃した</font><font style="vertical-align: inherit;">ことはありません。完全なリストを作成します。</font></font><br>
<br>
<pre><code class="plaintext hljs">$ nginx -T<font></font>
nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok<font></font>
nginx: configuration file /usr/local/etc/nginx/nginx.conf test is successful<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理解できませんでした：「リスティングはどこにありますか？」</font></font><br>
<br>
<pre><code class="plaintext hljs">$ nginx -V<font></font>
nginx version: nginx/1.10.3<font></font>
TLS SNI support enabled<font></font>
configure arguments: --with-cc-opt='-g -O2' --with-ld-opt='-Wl,-z,relro -Wl,-z,now' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_sub_module --with-stream=dynamic --with-stream_ssl_module --with-mail=dynamic --with-mail_ssl_module<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つ目はリストの質問に追加されます。「なぜnginxのこのような古いバージョンなのですか？」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、システムはバージョンが新しくインストールされたと信じています：</font></font><br>
<br>
<pre><code class="plaintext hljs">$ dpkg -l nginx | grep "[n]ginx"<font></font>
ii  nginx          1.14.2-2+deb10u1 all          small, powerful, scalable web/proxy server<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は呼んだ：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ミシャ、なぜ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を再構築したの</font><font style="vertical-align: inherit;">ですか？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -わかりました、どうすればいいのかわかりません！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -わかりました、スリープ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nginxは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明確に再構築されており、 "-T"のリストは理由により非表示になっています。</font><font style="vertical-align: inherit;">ハッキングについては間違いありません。ハッキングを受け入れるだけでかまいません（とにかく、Mishaがサーバーを新しいサーバーに交換したため）、問題が解決したと考えてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、誰かが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root権限を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得した</font><font style="vertical-align: inherit;">ため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムの再インストール</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみを行い</font><font style="vertical-align: inherit;">、そこであまり消費されないものを探す</font><font style="vertical-align: inherit;">ことは理にかなっています</font><font style="vertical-align: inherit;">が、今回は好奇心が夢を打ち破りました。</font><font style="vertical-align: inherit;">彼らが私たちから隠したかったものを見つける方法は？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トレースしてみましょう：</font></font><br>
<br>
<pre><code class="plaintext hljs">$ strace nginx -T
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トレースを確認すると、明らかに十分なラインがありません </font></font><br>
<br>
<pre><code class="plaintext hljs">write(1, "/etc/nginx/nginx.conf", 21/etc/nginx/nginx.conf)   = 21<font></font>
write(1, "...<font></font>
write(1, "\n", 1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみのために、結論を比較してください</font></font><br>
<br>
<pre><code class="plaintext hljs">$ strace nginx -T 2&gt;&amp;1 | wc -l<font></font>
264<font></font>
$ strace nginx -t 2&gt;&amp;1 | wc -l<font></font>
264<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はコード</font><i><font style="vertical-align: inherit;">/src/core/nginx.cの</font></i><font style="vertical-align: inherit;">一部だと思います</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="cpp hljs">            <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;<font></font>
<font></font>
            <span class="hljs-keyword">case</span> <span class="hljs-string">'T'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;<font></font>
                ngx_dump_config = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
形にされました：</font></font><br>
<br>
<pre><code class="cpp hljs">            <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;<font></font>
<font></font>
            <span class="hljs-keyword">case</span> <span class="hljs-string">'T'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;
                <span class="hljs-comment">//ngx_dump_config = 1;</span>
                <span class="hljs-keyword">break</span>;
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
または</font></font><br>
<br>
<pre><code class="cpp hljs">            <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;<font></font>
<font></font>
            <span class="hljs-keyword">case</span> <span class="hljs-string">'T'</span>:<font></font>
                ngx_test_config = <span class="hljs-number">1</span>;<font></font>
                ngx_dump_config = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">break</span>;
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、-Tによるリストは表示されません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、どのように私たちの設定を見るのですか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の考えが真実であり、問​​題が変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ngx_dump_config</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみにある場合</font><font style="vertical-align: inherit;">、キー</font><i><font style="vertical-align: inherit;">--with-cc-opt </font></i><i><font style="vertical-align: inherit;">-gが</font></i><font style="vertical-align: inherit;">存在し、最適化</font><i><font style="vertical-align: inherit;">-O2</font></i><font style="vertical-align: inherit;">が害を</font><i><font style="vertical-align: inherit;">及ぼさ</font></i><font style="vertical-align: inherit;">ない</font><font style="vertical-align: inherit;">ことを期待している</font><font style="vertical-align: inherit;">ため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用してインストールを試み</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この場合、</font><i><font style="vertical-align: inherit;">ngx_dump_config</font></i><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">ケース 'T'：</font></i><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">どの</font><font style="vertical-align: inherit;">ように処理される</font><font style="vertical-align: inherit;">かがわからないため</font><font style="vertical-align: inherit;">、このブロックを呼び出さず、</font><i><font style="vertical-align: inherit;">ケース 't'</font></i><font style="vertical-align: inherit;">を使用してインストールし</font><i><font style="vertical-align: inherit;">ます。</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「-T」と一緒に「-t」を使用できるのはなぜですか</font></font></b><div class="spoiler_text">  <i>if(ngx_dump_config)</i>   <i>if(ngx_test_config)</i>:<br>
<pre><code class="cpp hljs">    <span class="hljs-keyword">if</span> (ngx_test_config) {
        <span class="hljs-keyword">if</span> (!ngx_quiet_mode) {<font></font>
            ngx_log_stderr(<span class="hljs-number">0</span>, <span class="hljs-string">"configuration file %s test is successful"</span>,<font></font>
                           cycle-&gt;conf_file.data);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (ngx_dump_config) {<font></font>
            cd = cycle-&gt;config_dump.elts;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; cycle-&gt;config_dump.nelts; i++) {<font></font>
<font></font>
                ngx_write_stdout(<span class="hljs-string">"# configuration file "</span>);<font></font>
                (<span class="hljs-keyword">void</span>) ngx_write_fd(ngx_stdout, cd[i].name.data,<font></font>
                                    cd[i].name.len);<font></font>
                ngx_write_stdout(<span class="hljs-string">":"</span> NGX_LINEFEED);<font></font>
<font></font>
                b = cd[i].buffer;<font></font>
<font></font>
                (<span class="hljs-keyword">void</span>) ngx_write_fd(ngx_stdout, b-&gt;pos, b-&gt;last - b-&gt;pos);<font></font>
                ngx_write_stdout(NGX_LINEFEED);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
    }<font></font>
</code></pre><br>
,      ,    <i>case 'T':</i>,     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx.confをテストする</font></font></b><div class="spoiler_text">      ,        <i>nginx</i> :<br>
<br>
<pre><code class="nginx hljs"><span class="hljs-section">events</span> {<font></font>
}<font></font>
<font></font>
<span class="hljs-section">http</span> {
	<span class="hljs-attribute">include</span> /etc/nginx/sites-enabled/*;<font></font>
}<font></font>
</code></pre><br>
       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバッガーを実行する</font></font></b><div class="spoiler_text"><pre><code class="plaintext hljs">$ gdb --silent --args nginx -t<font></font>
Reading symbols from nginx...done.<font></font>
(gdb) break main<font></font>
Breakpoint 1 at 0x1f390: file src/core/nginx.c, line 188.<font></font>
(gdb) run<font></font>
Starting program: nginx -t<font></font>
[Thread debugging using libthread_db enabled]<font></font>
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".<font></font>
<font></font>
Breakpoint 1, main (argc=2, argv=0x7fffffffebc8) at src/core/nginx.c:188<font></font>
188     src/core/nginx.c: No such file or directory.<font></font>
(gdb) print ngx_dump_config=1<font></font>
$1 = 1<font></font>
(gdb) continue<font></font>
Continuing.<font></font>
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<font></font>
nginx: configuration file /etc/nginx/nginx.conf test is successful<font></font>
# configuration file /etc/nginx/nginx.conf:<font></font>
events {<font></font>
}<font></font>
<font></font>
http {<font></font>
map $http_user_agent $sign_user_agent<font></font>
{<font></font>
"~*yandex.com/bots" 1;<font></font>
"~*www.google.com/bot.html" 1;<font></font>
default 0;<font></font>
}<font></font>
<font></font>
map $uri $sign_uri<font></font>
{<font></font>
"~*/wp-" 1;<font></font>
default 0;<font></font>
}<font></font>
<font></font>
map :$sign_user_agent:$sign_uri $sign_o<font></font>
{<font></font>
:1:0 o;<font></font>
default ;<font></font>
}<font></font>
<font></font>
map :$sign_user_agent:$sign_uri $sign_a<font></font>
{<font></font>
:1:0 a;<font></font>
default ;<font></font>
}<font></font>
<font></font>
sub_filter_once off;<font></font>
sub_filter '' $sign_o;<font></font>
sub_filter '' $sign_a;<font></font>
<font></font>
        include /etc/nginx/sites-enabled/*;<font></font>
}<font></font>
# configuration file /etc/nginx/sites-enabled/default:<font></font>
<font></font>
[Inferior 1 (process 32581) exited normally]<font></font>
(gdb) quit<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手順：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">main（）</font></i><font style="vertical-align: inherit;">関数にブレークポイントを設定する</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムを実行する</font></font></li>
<li><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">config ngx_dump_config = 1の</font></i><font style="vertical-align: inherit;">出力を定義する変数の値を変更します</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムを続行/終了する</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、実際の構成は私たちのものとは異なります。ここから偽の部分を選択します。</font></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">map</span> <span class="hljs-variable">$http_user_agent</span> <span class="hljs-variable">$sign_user_agent</span><font></font>
{<font></font>
"~*yandex.com/bots" 1;<font></font>
"~*www.google.com/bot.html" 1;<font></font>
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">map</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$sign_uri</span><font></font>
{<font></font>
"~*/wp-" 1;<font></font>
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">map</span> :<span class="hljs-variable">$sign_user_agent</span>:<span class="hljs-variable">$sign_uri</span> <span class="hljs-variable">$sign_o</span><font></font>
{<font></font>
:1:0 o;<font></font>
<span class="hljs-attribute">default</span> ;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">map</span> :<span class="hljs-variable">$sign_user_agent</span>:<span class="hljs-variable">$sign_uri</span> <span class="hljs-variable">$sign_a</span><font></font>
{<font></font>
:1:0 a;<font></font>
<span class="hljs-attribute">default</span> ;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">sub_filter_once</span> <span class="hljs-literal">off</span>;
<span class="hljs-attribute">sub_filter</span> <span class="hljs-string">''</span> <span class="hljs-variable">$sign_o</span>;
<span class="hljs-attribute">sub_filter</span> <span class="hljs-string">''</span> <span class="hljs-variable">$sign_a</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで何が起こっているのかを順番に考えてみましょう。</font><i><font style="vertical-align: inherit;">User-Agent</font></i><font style="vertical-align: inherit;">のyandex / googleで</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
定義</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">map</span> <span class="hljs-variable">$http_user_agent</span> <span class="hljs-variable">$sign_user_agent</span><font></font>
{<font></font>
"~*yandex.com/bots" 1;<font></font>
"~*www.google.com/bot.html" 1;<font></font>
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワードプレスサービスページは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除外されてい</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます：</font></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">map</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$sign_uri</span><font></font>
{<font></font>
"~*/wp-" 1;<font></font>
<span class="hljs-attribute">default</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、上記の両方の条件に該当する方 </font></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">map</span> :<span class="hljs-variable">$sign_user_agent</span>:<span class="hljs-variable">$sign_uri</span> <span class="hljs-variable">$sign_o</span><font></font>
{<font></font>
:1:0 o;<font></font>
<span class="hljs-attribute">default</span> ;<font></font>
}<font></font>
<font></font>
<span class="hljs-attribute">map</span> :<span class="hljs-variable">$sign_user_agent</span>:<span class="hljs-variable">$sign_uri</span> <span class="hljs-variable">$sign_a</span><font></font>
{<font></font>
:1:0 a;<font></font>
<span class="hljs-attribute">default</span> ;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページの</font><font style="vertical-align: inherit;">
テキストで、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「o」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「o」に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「a」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「a」に変更され</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="nginx hljs"><span class="hljs-attribute">sub_filter_once</span> <span class="hljs-literal">off</span>;
<span class="hljs-attribute">sub_filter</span> <span class="hljs-string">''</span> <span class="hljs-variable">$sign_o</span>;
<span class="hljs-attribute">sub_filter</span> <span class="hljs-string">''</span> <span class="hljs-variable">$sign_a</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、右のことだけを繊細だ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！「」=「」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">としては、同様に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！「の」=「O」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/528/5d5/582/5285d55827ddf5cb5705b364a417828f.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変更されたごみは、検索エンジンのボットは、ラテン語で、通常の100％-kirillicheskogoテキストの代わりにしているこのように希釈した</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'o'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これがSEOにどのように影響するかについては説明しませんが、そのようなリテラルハッシュがSERPの位置にプラスの影響を与えるとは考えられません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファンタジーを持つ男とは何ですか。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GDB </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gdbを使用した</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">デバッグ</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">（1）</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://nginx.org/en/docs/http/ngx_"><font style="vertical-align: inherit;">-Linuxの</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">マニュアルページ</font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strace（1）</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://nginx.org/en/docs/http/ngx_"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Linuxの</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">マニュアルページ</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=http://nginx.org/en/docs/http/ngx_"><font style="vertical-align: inherit;">Nginx-モジュールngx_http_sub_module </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鋸、チェーンソー、電動鋸について</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465343/index.html">1年半エンジンとゲームをどのように作成したか。二部。インフラ</a></li>
<li><a href="../ja465345/index.html">FunCorpモバイル採用イベント</a></li>
<li><a href="../ja465349/index.html">アジャイルが必要ですか？テストする5つのモデル</a></li>
<li><a href="../ja465351/index.html">ゴステンダーを獲得した人々の頻繁な問題</a></li>
<li><a href="../ja465353/index.html">ICSセキュリティ監査</a></li>
<li><a href="../ja465357/index.html">選択：米国への「専門的」移住に関する9つの有用な資料</a></li>
<li><a href="../ja465359/index.html">Huawei CloudCampus：高度なクラウドサービスインフラストラクチャ</a></li>
<li><a href="../ja465361/index.html">カザンのデジタル交差点：交通安全技術が都市に導入される方法</a></li>
<li><a href="../ja465363/index.html">Natas Web。Webの脆弱性の悪用を目的としたCTFプラットフォームの通過。パート5</a></li>
<li><a href="../ja465365/index.html">Windows 10セットアップスクリプト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>