<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèº üíØ ‚è±Ô∏è Sensor gerak dan koneksi registrasi video dan alarm di Home Assistant on Raspberry pi üíΩ üë©‚Äçüë©‚Äçüëß‚Äçüë¶ üö∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya ingin berbicara tentang pengalaman kecil saya bekerja dengan Home Assistant (selanjutnya disebut HA) pada Raspberry pi dan tentang menghubungkan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sensor gerak dan koneksi registrasi video dan alarm di Home Assistant on Raspberry pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486654/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya ingin berbicara tentang pengalaman kecil saya bekerja dengan Home Assistant (selanjutnya disebut HA) pada Raspberry pi dan tentang menghubungkan fungsi registrasi video, sensor gerak dan, dengan demikian, fungsi keamanan rumah untuk menerima gambar melalui pos jika terjadi operasi "keamanan". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentu saja, salah satu alasannya adalah keinginan untuk memahami dari umpan balik Anda bahwa apa yang saya lakukan "salah" setelah semua, menerapkan skenario ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada tiga cara untuk mengonfigurasi fungsi di atas: "tanpa masalah", "pendek" dan "independen". Dalam kasus pertama, Anda, telah mengunduh gambar yang sudah selesai dari situs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ViaMyBox.com/downloadpage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk pi Raspberry Anda, Anda dapat melihat bagaimana semuanya terlihat dalam formulir yang sudah dikonfigurasi. Dalam kasus kedua, Anda dapat mengunduh zip dari situs web atau dari proyek github, menginstal dan menginstal gambar buruh pelabuhan HA melalui utilitas (sudo via-setup.sh) untuk melihat bagaimana semuanya dikonfigurasi. Dan akhirnya, cara ketiga adalah mengatur "semuanya dengan cara Anda sendiri": ambil sesuatu yang berguna dari situs atau githab proyek, atau dari tutorial ini. Tautan ke semuanya di akhir artikel.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Misalkan Anda sudah memiliki Home Assistant (HA) yang berfungsi. Pada artikel ini, kami hanya akan mempertimbangkan aspek pembentukan konfigurasi yaml dan deskripsi urutan aturan dan kondisi yang mengarah pada tindakan tertentu, dalam kasus kami, koneksi "keamanan rumah" dan skrip yang mulai mengambil gambar dalam waktu 5 detik setelah sensor gerak dipicu. Dan sebagai hasilnya, Home Assistant mengirim gambar yang diambil melalui pos. Saya bukan spesialis dalam yaml atau dalam membuat konfigurasi untuk Home Assistant, tetapi, mengikuti contoh yang berfungsi, saya mendapat konfigurasi yang berfungsi, yang ingin saya bagikan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua file yang akan kita rujuk, saya akan paparkan di akhir artikel untuk ulasan yang lebih nyaman. Saya tidak akan membahas karya skrip untuk merekam video menggunakan bash atau python dalam contoh ini. Hanya Asisten Rumah. Tetapi jika Anda memiliki pertanyaan - Selamat Datang! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada akhirnya, semuanya terlihat seperti ini untuk saya (disorot dengan warna merah yang akan kita bahas dalam artikel): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3u/ol/s8/3uols87hy7mnocdgbj-k-mfbp-a.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/v9/ib/8s/v9ib8sthumy5p5hphabioyvr1ie.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan Raspberry pi sebagai platform. Dan jalur saya ke file konfigurasi adalah / usr / share / hassio / homeassistant /. Jalur ke file konfigurasi Anda mungkin berbeda dari jalur saya. Pada waktu itu, saya memiliki Asisten Rumah 0.101.3. Kami akan tertarik dengan file konfigurasi di direktori ini: configuration.yaml dan automation.yaml.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah setiap perubahan pada file-file ini, penting untuk diingat bahwa akan perlu untuk memeriksa konfigurasi setelah perubahan kami untuk setiap kesalahan yang dibuat di dalamnya. Ini dilakukan pada tab Beranda Asisten dasbor -&gt; Konfigurasi -&gt; Kontrol Server -&gt; Periksa Konfigurasi. Dan kemudian, di tempat yang sama kami melakukan Reload Automations dan Reload Script, jika verifikasi berhasil. Dan, jika ragu, - Manajemen Server restart di tab yang sama secara akurat memperbarui konfigurasi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor gerak HC-SR501 terhubung ke bus Raspberry pi GPIO. Kita perlu menghubungkan ketiga kabel kontak dengan benar ke GPIO, dan kita dapat menggunakan sensor kita dalam aksi. Sensor memiliki tiga kontak: power gcc (+), zero gnd (-), control contact (data). Setelah membaca deskripsi GPIO, saya menghubungkannya ke raspberry saya sebagai berikut. Saya menghubungkan hc-sr501 ke konektor GPIO: pin # 2 - 5.5vvcc; pin # 26 (baris ke-13) - kontak data dan pin # 6 - gnd (-) dari sensor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan kamera usb atau kamera csi bersamaan dengan mjpg-streamer sebagai sumber foto. Cara menginstal dan mengkonfigurasi mjpg-streamer di Raspberry pi, kami tidak akan mempertimbangkannya di sini. Contoh instalasi cepat di Internet banyak. Namun, saya ingin mengatakan bahwa saya menggunakan data dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemasangan modul ini juga dijelaskan secara rinci di sana. </font><font style="vertical-align: inherit;">Atau gunakan metode apa pun yang nyaman bagi Anda untuk mengambil foto dan video. </font><font style="vertical-align: inherit;">Setelah semua, apa script bash untuk mengikat ke HA, pada akhirnya, terserah Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami sekarang akan menjelaskan sensor kami di configuration.yaml, katakanlah, melalui baris perintah:</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo nano /usr/share/hassio/homeassistant/configuration.yaml</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
meskipun menggunakan notepad ++ dengan winscp mungkin lebih nyaman ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggambarkan urutan pengaturan untuk HC-SR501 seperti ini:</font></font><br>
<br>
<pre><code class="plaintext hljs">binary_sensor:<font></font>
  - platform: rpi_gpio<font></font>
    #name: HC-SR501<font></font>
    ports:<font></font>
      7: Sensor HC-SR501<font></font>
    invert_logic: false<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa di sini yang penting adalah pengaturan di garis yang menggambarkan koneksi ke kontak kontrol (data) dari sensor: pin </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
port </font><font style="vertical-align: inherit;"># 7 </font><font style="vertical-align: inherit;">: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7: Sensor HC-SR501 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Home Assistant memiliki alat bawaan untuk mengaktifkan fungsi keamanan rumah. </font><font style="vertical-align: inherit;">Kami akan menjelaskannya di konfigurasi </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">kami.yaml</font></a><font style="vertical-align: inherit;"> , menggunakan deskripsi: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.home-assistant.io/integrations/manual</font></font></a><br>
<br>
<pre><code class="plaintext hljs">alarm_control_panel:<font></font>
  - platform: manual<font></font>
    name: Home Alarm<font></font>
    pending_time: 60<font></font>
     delay time 40<font></font>
     triggered:<font></font>
    pending_time: 0<font></font>
    code: 1234<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengaturan ini berarti bahwa kita memiliki 60 detik untuk meninggalkan rumah (setelah waktu ini alarm akan menyala), dan 40 detik untuk mematikannya (dengan kata sandi 1234) setelah kembali ke rumah. Untuk beberapa alasan, Anda selalu pergi lebih lama dari yang Anda datangi.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan menjelaskan mekanisme untuk menghidupkan dan mematikan foto dengan pengoperasian sensor gerak dalam konfigurasi kami.yaml (lebih lanjut tentang platform switch - command_line dapat ditemukan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="plaintext hljs"> - platform: command_line<font></font>
   switches:<font></font>
      start_stop_motion_rec_timelapse:<font></font>
        friendly_name: 'Record motion timelapse video'<font></font>
        command_on: 'curl http://localhost/start_mjpgstrm.php  &amp;&amp; curl http://localhost//rec-motion-mjpg.php'<font></font>
        command_off: 'curl http://localhost/stop_mjpgstrm.php &amp;&amp; curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kami menautkan perintah aktifkan perintah command_on dan command_off dari skrip kami yang mengontrol perekaman kamera. Dalam hal ini, ketika command_on dieksekusi, 2 skrip dieksekusi secara berurutan. Ini meluncurkan mjpg-streamer dan memicu perekaman sensor gerak. Akses ke skrip bash melalui file php dari situs yang berfungsi di Raspberry pi. Untuk melakukan ini, saya mengkonfigurasi nginx dan akses web, dan ketika mengakses melalui browser dalam bentuk http: // &lt;alamat ip Raspberry pi Anda&gt; /st__mjpgstrm.php, skrip php kami harus dieksekusi. Script ini mengeksekusi mjpg-streamer dalam situasi ini.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak mempertimbangkan konfigurasi akses web dalam artikel ini. Jelas, ini bukan keamanan, tetapi karena saya memiliki HA di buruh pelabuhan, saya dihadapkan pada kenyataan bahwa saya memiliki lingkungan buruh pelabuhan yang terisolasi dan "dunia luar" dari OS yang dapat saya lihat dengan menghubungi situs saya melalui php. Mungkin ada banyak solusi yang baik dari buruh pelabuhan atau guru HA. Menulis, akan menarik untuk diketahui! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan meninggalkan daftar skrip ini di bawah artikel, kami tidak akan memikirkannya. Pada artikel ini saya hanya ingin melacak pembentukan urutan tindakan di Home Assistant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini ditempatkan di objek start_stop_motion_rec_timelapse.Ini akan menjadi saklar visual kami, yang dengannya kami akan mengontrol perekaman foto ketika sensor gerak dipicu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/jb/kz/j4jbkzlnslehtgai7ak93blgqnm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita dapat memvisualisasikan objek-objek ini yang dibuat oleh kita di tab Home Assistant -&gt; Overwiew, mengalihkan aktivasi mode konfigurasi UI di sudut kanan atas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s5/r8/31/s5r831pi5yqbp6zpph6gy_yen2g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mulai ulang HA di browser di tab "Konfigurasi -&gt; Kontrol Server" untuk mengambil konfigurasi kita.yaml. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, pilih tanda tambah kuning di bagian bawah jendela browser, klik pada kartu Entitas dan lampirkan objek yang kami buat ke peta. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t5/6c/i_/t56ci_fwyo5z_vojj6iywesnwno.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk sensor kami, pilih kartu sensor. Ini akan terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hi/h-/9d/hih-9d8acqpf9lxmub8pqpxbm2y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat dalam gambar, di bidang kedua entitas, saklar di atas adalah: switch.start_stop_motion_rec_timelapse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hal ini memungkinkan kita untuk menghidupkan dan mematikan rekaman kita pada sensor gerak, terlepas dari masuknya fungsi "keamanan rumah". Dan, secara umum, seharusnya sudah berfungsi setelah semua tindakan di atas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, dan karenanya, peta panel alarm: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/om/ob/m-omobeh7bj-auliurl9abujbhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada hal menarik lainnya. Saya menggunakan Home Assistant sebagai wadah buruh pelabuhan. Dalam hal ini, path ke skrip kami akan berbeda dari path asli ke file skrip. Setelah semua, struktur file di dalam wadah divirtualisasikan dan terhubung dengan struktur file nyata melalui volume docker yang dipasang. Ini terlihat seperti ini: Path di dalam wadah: / config / scripts / Path di dalam OS: / usr / share / hassio / homeassiatnt / scripts. Jadi lihat pengaturan wadah Anda, bagaimana volume ini dikonfigurasi di bidang Binds. Jika Anda memiliki HA di sana.</font></font><br>
<br>
<pre><code class="plaintext hljs">sudo docker inspect homeassistant|less
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika sensor gerak dipicu, pada saat alarm dinyalakan: Saya ingin, selain fakta bahwa kita memulai fotografi cepat (foto timelapse), saya akan menerima peringatan melalui pos dan foto. Saya memparalelkan proses. Di foto pertama, logging (snapshot timelapse) terjadi dalam beberapa detik setelah sensor dipicu. Untuk melakukan ini, saya menjalankan mjpg-streamer curl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost / start_mjpgstrm.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mulai php: surl </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http: //localhost/rec-motion-mjpg.php</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dia, pada gilirannya, menjalankan skrip python mov.py. Semua file dan tautan yang dijelaskan ada di akhir artikel dengan referensi. Dan skrip takeSnapshotWebcam.sh lainnya mengambil snapshot, yang saya kirim email. Saya jelaskan skrip-skrip ini dalam konfigurasi kita.</font></font><br>
<br>
<pre><code class="plaintext hljs">shell_command:<font></font>
#      <font></font>
  take_snapshot_webcam: '/config/scripts/takeSnapshotWebcam.sh'<font></font>
#  mjpg-streamer <font></font>
  start_mgpg_streamer: 'curl http://localhost/start_mjpgstrm.php'<font></font>
# mjpg-streamer<font></font>
  stop_mgpg_streamer: 'curl http://localhost/stop_mjpgstrm.php'<font></font>
#      5 <font></font>
  start_motion_rec: 'curl http://localhost/rec-motion-mjpg.php'<font></font>
# <font></font>
  stop_motion_rec: 'curl http://localhost/rec-motion-mjpg-stop.php'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sana, di configuration.yaml, kami menjelaskan objek kami untuk mengirim surat:</font></font><br>
<br>
<pre><code class="plaintext hljs">notify:<font></font>
  - name: ha_sendmail<font></font>
    platform: smtp<font></font>
#    gmail<font></font>
    server: smtp.gmail.com<font></font>
    port: 587<font></font>
    timeout: 15<font></font>
#  <font></font>
    sender: user@gmail.com<font></font>
    encryption: starttls<font></font>
    username: user@gmail.com<font></font>
    password: passwd<font></font>
#  (       ,    )<font></font>
    recipient:<font></font>
      - user@gmail.com<font></font>
    sender_name: My Home Assistant<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poin penting! </font><font style="vertical-align: inherit;">Agar HA kami dapat terhubung dan mengirim surat (bidang pengirim), kami harus mengaktifkan gmail untuk menggunakan kotak ini ke layanan HA kami. </font><font style="vertical-align: inherit;">Cara melakukan ini adalah tautannya di sini: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myaccount.google.com/lesssecureapps</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dan kemudian, kami menjelaskan mekanisme otomatisasi itu sendiri ketika alarm home_alarm dihidupkan di automation.yaml:</font></font><br>
<br>
<pre><code class="plaintext hljs">#   (alias) ‚Äú  ,   ‚Äù<font></font>
- alias: 'Trigger alarm while armed away'<font></font>
#alias ,     ‚Äúon‚Äù<font></font>
  trigger: <font></font>
    - platform: state<font></font>
      entity_id: binary_sensor.sensor_hc_sr501<font></font>
      to: 'on'<font></font>
# ,         ‚Äúarmed away‚Äù<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      state: armed_away<font></font>
#     <font></font>
  action:<font></font>
# mjpg-streamer ( )<font></font>
    - service: shell_command.start_mgpg_streamer<font></font>
# ,   <font></font>
    - service: shell_command.start_motion_rec<font></font>
#    ‚Äú  ‚Äù   HA   ‚Äú ‚Äù<font></font>
    - service: alarm_control_panel.alarm_trigger<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Banyak kondisi dan tindakan berikut adalah untuk mengirim pesan konsol saat menonaktifkan "keamanan" dan mematikan skrip rekaman gerak kami:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm is Disarmed'<font></font>
  trigger:<font></font>
    - platform: state<font></font>
      entity_id: alarm_control_panel.home_alarm<font></font>
      to: 'disarmed'<font></font>
  action:<font></font>
    - service: shell_command.stop_mgpg_streamer<font></font>
    - service: shell_command.stop_motion_rec<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: The alarm is Disarmed at {{ states('sensor.date_time') }}"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan akhirnya, kelompok ketiga - kami mengirim surat dengan foto:</font></font><br>
<br>
<pre><code class="plaintext hljs">- alias: 'Send notification when alarm triggered'<font></font>
  trigger: <font></font>
   - platform: state<font></font>
     entity_id: alarm_control_panel.home_alarm<font></font>
     to: 'triggered'<font></font>
  action:<font></font>
    - service: persistent_notification.create<font></font>
      data:<font></font>
       message: Notification when alarm triggered. Motion sensor HC-SR501 detected.<font></font>
    - delay:<font></font>
       seconds: 4<font></font>
#     <font></font>
    - service: script.webcam_snapshot<font></font>
#      configuration.yaml: notify.ha_sendmail<font></font>
    - service: notify.ha_sendmail<font></font>
      data:<font></font>
        title: 'Intruder alert'<font></font>
        message: '{{now().strftime("%H:%M %Y-%m-%d")}}:Notification when alarm triggered. Motion sensor HC-SR501 detected.'<font></font>
        data:<font></font>
           images:<font></font>
#      script.webcam_snapshot  <font></font>
              - /config/camera/snapshot.jpg<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingat bahwa tata letak baris penting dalam file yaml, dan karakter spasi sebelum perintah memainkan peran penting dalam pembentukan blok kode, strukturnya. </font><font style="vertical-align: inherit;">Periksa semua perubahan pada yaml Anda melalui Konfigurasi Home Assistant (HA) -&gt; Kontrol Server -&gt; Periksa Konfigurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Segalanya tampak, dan pi Raspberry Anda berubah menjadi elegan ... jika petir tidak macet!) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini dia - otomatisasi HA yang berfungsi, Dibuat khusus! </font><font style="vertical-align: inherit;">Pastikan untuk menulis kepada saya apa yang Anda pikirkan tentang ini! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan, jika Anda masih membaca sampai akhir, saya menawarkan tautan yang dijanjikan: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://viamybox.com/downloadpage </font></font><br>
</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/viatc/viamybox File</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
konfigurasi yang dijelaskan di sini: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">automation.yaml, configuration.yaml, takeSnapshotWebcam. sh, rec-motion-mjpg.php, mov.py</font></font></a></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id486644/index.html">Antena DIY dalam 5 menit</a></li>
<li><a href="../id486646/index.html">Pergi dari jQuery ke Svelte, tanpa rasa sakit</a></li>
<li><a href="../id486648/index.html">AWS Lambda Beraksi di Jawa 11. Pergi ke Serverless untuk Produksi</a></li>
<li><a href="../id486650/index.html">Memori dinamis dalam sistem waktu nyata yang sulit</a></li>
<li><a href="../id486652/index.html">"Kritik murni alasan" untuk programmer</a></li>
<li><a href="../id486656/index.html">Bagaimana cara menambahkan karakter baru ke Unicode: pengalaman orang awam</a></li>
<li><a href="../id486658/index.html">Plugin Strategi Moksi</a></li>
<li><a href="../id486660/index.html">Gagasan dari meja: Pakaian antariksa Metro</a></li>
<li><a href="../id486664/index.html">Retas Kotak. Passage RE. Metasploit, muat di dokumen kantor, serangan Zip Slip, sedikit tentang PowerSploit dan token</a></li>
<li><a href="../id486666/index.html">Mobil salju, bir, dan turunan cuaca</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>