<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÑ üôåüèø üêò C√≥mo Smartcalls se convirti√≥ en Voximplant Kit - caracter√≠sticas de cambio de marca y asesino ü§¢ üë©üèΩ‚Äçüé§ üë®üèº‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante mucho tiempo estuvimos preparando una actualizaci√≥n de Smartcalls, un editor visual para llamadas salientes, y ahora sucedi√≥. Hoy, debajo del ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C√≥mo Smartcalls se convirti√≥ en Voximplant Kit - caracter√≠sticas de cambio de marca y asesino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/492232/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/by/c2/ih/byc2ihl70ggcz-ftm-a4ziskyvo.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante mucho tiempo estuvimos preparando una actualizaci√≥n de Smartcalls, un editor visual para llamadas salientes, y ahora sucedi√≥. </font><font style="vertical-align: inherit;">Hoy, debajo del gato, hablaremos sobre los cambios de UI / UX y subiremos bajo el cap√≥ del modo de demostraci√≥n para mostrar c√≥mo domesticamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JointJS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© ha cambiado realmente?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De lo m√°s obvio: un nuevo nombre y URL, lo que significa que el kit Voximplant est√° disponible en el enlace apropiado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voximplant.com/kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tambi√©n modificamos la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p√°gina de registro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ahora es as√≠:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/jh/vc/cljhvcpw84_miyo3xcr8tsamgwo.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque el concepto se ha mantenido igual, la interfaz del producto ha cambiado significativamente, haci√©ndose m√°s f√°cil de usar. </font><font style="vertical-align: inherit;">El men√∫ superior migr√≥ a la izquierda, lo que hizo que navegar por los bloques fuera m√°s l√≥gico y conveniente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/9y/hf/zr9yhfrpoz4qjawojzkqgdl5kpa.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, ahora est√° disponible la agrupaci√≥n y clasificaci√≥n de guiones y grabaciones de audio, b√∫squeda por n√∫meros, as√≠ como tarjetas de campa√±a con informaci√≥n breve sobre ellos, incluidos nuevos indicadores: la duraci√≥n promedio de una llamada exitosa y la cantidad total gastada.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/yf/12/kgyf12bkj5jjx_cffukvfnqnk7g.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a las integraciones: la interfaz f√°cil de usar lleg√≥ a la configuraci√≥n del correo, y en las pesta√±as Dialogflow, SIP, Variables globales, apareci√≥ una b√∫squeda y clasificaci√≥n de archivos por ID y host.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/wm/dj/srwmdjgvejupi9urypqn1iyglzk.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 En general, mucho nuevo y genial! </font><font style="vertical-align: inherit;">Lea m√°s sobre los cambios </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en nuestro blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero lo m√°s importante es el editor.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modo de demostraci√≥n (spoiler: esta es la principal caracter√≠stica asesina).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/po/du/7mpoduas-ap0m6lbi-o12g9eyd0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecuci√≥n de script en tiempo real con resaltado de los bloques involucrados, y despu√©s de la ejecuci√≥n, el resultado de una llamada (Flow and Log), lo que hace que la depuraci√≥n de scripts sea a√∫n m√°s f√°cil y r√°pida.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_i/vl/0a/_ivl0ayzlmrojpumqdf_knc99ie.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver el video del modo de demostraci√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o probarlo usted mismo despu√©s de registrarse con el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kit Voximplant</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y c√≥mo se implementa todo esto, lo diremos en la siguiente secci√≥n. </font><font style="vertical-align: inherit;">Nuevas caracter√≠sticas del editor:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deshacer / rehacer (1 en la imagen a continuaci√≥n);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teclas de acceso r√°pido (2);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">men√∫ emergente donde puede alinear los bloques y enlaces entre ellos con un solo clic, cambiar la escala, trabajar con miniMap, expandir el script a pantalla completa y tambi√©n compartirlo (copiar o guardar como png) (3);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">haga clic con el bot√≥n derecho en el men√∫ contextual;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copiar bloques, no solo dentro del mismo script, sino tambi√©n entre diferentes scripts e incluso (!) diferentes cuentas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloquear / desbloquear bloque: se puede mover un bloque bloqueado, pero NO es posible editarlo para evitar cambios no deseados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambio de color: visualmente puede seleccionar varios bloques "relacionados";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buscar por nombres y contenidos de bloques usados;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bloque "Men√∫ interactivo": la capacidad de intercambiar puertos (opciones de respuesta) en lugares simplemente arrastrando y soltando.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wp/fw/u4/wpfwu4ddvz--h5gd0yqm9ipcfzs.png" alt="imagen"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revelamos las cartas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hora de descubrir c√≥mo se implementa la animaci√≥n de bloque en el c√≥digo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/qo/cz/zoqoczrubc5rvxijm-cshjukoq0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El editor llama a nuestro m√©todo API HTTP - StartScenarios - para ejecutar el script en la nube. </font><font style="vertical-align: inherit;">La nube Voximplant inicia el script y lo entrega al editor media_access_url. </font><font style="vertical-align: inherit;">A partir de este momento, el editor extrae media_access_url cada segundo y recibe informaci√≥n sobre c√≥mo el script "viaja" a trav√©s de los bloques en respuesta; en funci√≥n de estos datos, el editor resalta los bloques necesarios y anima las conexiones entre ellos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El historial es un objeto JSON con los siguientes campos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marca de tiempo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idSource - bloque inicial;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idTarget - bloque final;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puerto - puerto (puede haber varias salidas de 1 bloque).</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wl/qt/ht/wlqthtjgn0l2bnwfoqophwregpy.png" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la ayuda de estas variables personalizadas y de servicio, el front-end comprende a qu√© bloque pasa durante cada prueba. </font><font style="vertical-align: inherit;">¬øC√≥mo entiende esto? </font><font style="vertical-align: inherit;">Cuando se produce una construcci√≥n visual (se agrega un nuevo bloque), se le asigna inmediatamente una identificaci√≥n, que luego se usa en el historial como idSource / idTarget. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar esta funcionalidad, utilizamos la biblioteca JointJS, pero hab√≠a un c√≥digo auto escrito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con el m√©todo principal selectBlock (), funciona de la siguiente manera: revisamos la matriz del historial de movimientos (idSource, idTarget) y tan pronto como encontremos los puntos de inicio y fin, busquemos la conexi√≥n entre ellos:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> link = <span class="hljs-keyword">this</span>.editor.getTestLink(sourceCell, portId);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hay una conexi√≥n entre ellos, entonces animamos una pelota que corre a lo largo de la l√≠nea de comunicaci√≥n:</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (link) <span class="hljs-keyword">this</span>.setLinkAnimation(link);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se llama al m√©todo selectBlock () despu√©s de cada actualizaci√≥n de this.testHistory. </font><font style="vertical-align: inherit;">Dado que varios bloques pasados ‚Äã‚Äãpueden llegar a this.testHistory a la vez, llamamos recursivamente selectBlock una vez cada 700 ms (este es el tiempo aproximado dedicado a animar el movimiento de bloque a bloque):</font></font><br>
<br>
<pre><code class="javascript hljs">setTimeout(<span class="hljs-keyword">this</span>.selectBlock, <span class="hljs-number">700</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el c√≥digo para este m√©todo es el siguiente. </font><font style="vertical-align: inherit;">Preste atenci√≥n a los m√©todos selectTestBlock y getTestLink, l√≠neas 7 y 10; ahora hablaremos de ellos por separado:</font></font><br>
<br>
<div class="oembed"><script type="text/javascript" src="https://gist.github.com/5ffed5b2bbb82d4a3eff6df3f153a1ed.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist101791201" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-selectblock-js" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-selectblock-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-selectblock-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-selectblock-js-LC2" class="blob-code blob-code-inner js-file-line">     <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt; </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testHistory </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">length </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span> <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-selectblock-js-LC3" class="blob-code blob-code-inner js-file-line">       <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const </font></font></span> <span class="pl-s1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span> <span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esto </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">historyIndex </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-selectblock-js-LC4" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idTarget</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-selectblock-js-LC5" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCellId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">idSource</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-selectblock-js-LC6" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">portId</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">testHistory</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-c1">port</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-selectblock-js-LC7" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">targetCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">selectTestBlock</span><span class="pl-kos">(</span><span class="pl-s1">targetCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-selectblock-js-LC8" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">const</span> <span class="pl-s1">sourceCell</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getCell</span><span class="pl-kos">(</span><span class="pl-s1">sourceCellId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-selectblock-js-LC9" class="blob-code blob-code-inner js-file-line">       <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">sourceCell</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">targetCell</span><span class="pl-kos">)</span> <span class="pl-kos">{</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-selectblock-js-LC10" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">const</span> <span class="pl-s1">link</span> <span class="pl-c1">=</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">editor</span><span class="pl-kos">.</span><span class="pl-en">getTestLink</span><span class="pl-kos">(</span><span class="pl-s1">sourceCell</span><span class="pl-kos">,</span> <span class="pl-s1">portId</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-selectblock-js-LC11" class="blob-code blob-code-inner js-file-line">         <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span> <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-en">setLinkAnimation</span><span class="pl-kos">(</span><span class="pl-s1">link</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-selectblock-js-LC12" class="blob-code blob-code-inner js-file-line">       <span class="pl-kos">}</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-selectblock-js-LC13" class="blob-code blob-code-inner js-file-line">       <span class="pl-smi">this</span><span class="pl-kos">.</span><span class="pl-c1">historyIndex</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span><span class="pl-kos">;</span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-selectblock-js-LC14" class="blob-code blob-code-inner js-file-line">       <span class="pl-en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setTimeout </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></span><span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span> <span class="pl-c1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700 </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-selectblock-js-LC15" class="blob-code blob-code-inner js-file-line">     <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
      <tr>
        <td id="file-selectblock-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-selectblock-js-LC16" class="blob-code blob-code-inner js-file-line">   <span class="pl-kos"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver en bruto</font></font></a>
        <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selectBlock.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        alojado con ‚ù§ por </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a>
      </div>
    </div>
</div>
</div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dibujar una conexi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo getTestLink () ayuda a obtener la conexi√≥n entre los bloques; se basa en getConnectedLinks (), un m√©todo incorporado de JointJS que toma una entrada de bloque y devuelve una matriz de enlaces. </font><font style="vertical-align: inherit;">En nuestra implementaci√≥n, buscamos en la matriz resultante un enlace con un puerto, donde la propiedad de origen tiene el valor portId:</font></font><br>
<br>
<pre><code class="javascript hljs">link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
     <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, si hay un enlace, res√°ltelo:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo de m√©todo:</font></font><br>
<br>
<pre><code class="javascript hljs">getTestLink(sourceCell: Cell, <span class="hljs-attr">portId</span>: string): Link {
  <span class="hljs-keyword">let</span> link = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (sourceCell &amp;&amp; sourceCell.id) {
    <span class="hljs-keyword">let</span> cell = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (sourceCell.type === <span class="hljs-string">'ScenarioStart'</span> || sourceCell.type === <span class="hljs-string">'IncomingStart'</span>) {<font></font>
      cell = <span class="hljs-keyword">this</span>.getStartCell()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      cell = <span class="hljs-keyword">this</span>.graph.getCell(sourceCell.id);<font></font>
    }<font></font>
    link = <span class="hljs-keyword">this</span>.graph.getConnectedLinks(cell, {<span class="hljs-attr">outbound</span> : <span class="hljs-literal">true</span>}).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> item.get(<span class="hljs-string">'source'</span>).port === portId;<font></font>
    });<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> link ? (link.toFront() &amp;&amp; link) : <span class="hljs-literal">null</span>;<font></font>
}<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La animaci√≥n de una pelota corriendo se implementa completamente por medio de JointJS ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ver demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos movemos al bloque actual</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Llamamos al m√©todo selectTestBlock () cuando es necesario seleccionar el bloque final y mover el lienzo hacia √©l. </font><font style="vertical-align: inherit;">Aqu√≠ obtenemos las coordenadas del centro del bloque:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> center = cell.getBBox().center();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego llame a setTestCell () para colorear el bloque:</font></font><br>
<br>
<pre><code class="javascript hljs">editor.tester.setTestCell(cell);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, ampliamos su centro usando la funci√≥n de escritura autom√°tica zoomToCell () (es la m√°s interesante, pero al final):</font></font><br>
<br>
<pre><code class="javascript hljs">editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo de m√©todo:</font></font><br>
<br>
<pre><code class="javascript hljs">selectTestBlock(id: string): Cell {
 <span class="hljs-keyword">const</span> cell = (id === <span class="hljs-string">'ScenarioStart'</span>) ? editor.tester.getStartCell() : editor.graph.getCell(id);
 <span class="hljs-keyword">if</span> (cell) {
   <span class="hljs-keyword">const</span> center = cell.getBBox().center();<font></font>
   editor.tester.setTestCell(cell);<font></font>
   editor.paperController.zoomToCell(center, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);<font></font>
 }<font></font>
 <span class="hljs-keyword">return</span> cell;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©todo para colorear: encuentre el elemento SVG de nuestro bloque y agregue la clase CSS. Es probado para que el bloque sea de color:</font></font><br>
<br>
<pre><code class="javascript hljs">setTestCell(cell: Cell): <span class="hljs-keyword">void</span> {
 <span class="hljs-keyword">const</span> view = cell.findView(<span class="hljs-keyword">this</span>.paper);
 <span class="hljs-keyword">if</span> (view) view.el.classList.add(<span class="hljs-string">'is-tested'</span>);<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zoom suave</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, zoomToCell ()! JointJS tiene un m√©todo incorporado para mover el lienzo a lo largo de los ejes X e Y, al principio quer√≠an tomarlo. Sin embargo, este m√©todo usa la transformaci√≥n como un atributo de la etiqueta SVG; no admite animaci√≥n fluida en el navegador Firefox + y solo usa la CPU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hicimos un peque√±o truco: escribimos nuestra funci√≥n zoomToCell (), que, en esencia, hace lo mismo, pero las conversiones se transforman como CSS en l√≠nea, esto permite renderizar usando la GPU (porque WebGL est√° conectado al proceso). Por lo tanto, se resuelve el problema de compatibilidad entre navegadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestra funci√≥n no solo mueve el lienzo en XY, sino que tambi√©n nos permite escalar (hacer zoom) simult√°neamente mediante el uso de la matriz de transformaci√≥n.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La propiedad will-change de la clase .animate-viewport le dice al navegador que el elemento se cambiar√° y que se deben aplicar optimizaciones, incluido el uso de la GPU, y la propiedad de transici√≥n establece la suavidad de mover el lienzo al bloque:</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-class">.animate-viewport</span> {
 <span class="hljs-attribute">will-change</span>: transform;
 <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease-in-out;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo nuestro c√≥digo de m√©todo est√° a continuaci√≥n:</font></font><br>
<br>
<pre><code class="javascript hljs">public zoomToCell(center: g.Point, <span class="hljs-attr">zoom</span>: number, <span class="hljs-attr">offset</span>: boolean = <span class="hljs-literal">true</span>): <span class="hljs-keyword">void</span> {
   <span class="hljs-keyword">this</span>.updateGridSize();
   <span class="hljs-keyword">const</span> currentMatrix = <span class="hljs-keyword">this</span>.paper.layers.getAttribute(<span class="hljs-string">'transform'</span>);
   <span class="hljs-comment">//   svg-,        center</span>
   <span class="hljs-comment">//   ,     style</span>
   <span class="hljs-keyword">const</span> { a, b, c, d, e, f } = <span class="hljs-keyword">this</span>.zoomMatrix(zoom, center, offset);
   <span class="hljs-comment">//  FireFox    ,       </span>
   <span class="hljs-keyword">this</span>.paper.layers.style.transform = currentMatrix;
   <span class="hljs-comment">//    FF  ,     ,    </span>
   setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
     <span class="hljs-comment">//  CSS- .animate-viewport,    - transition;</span>
     <span class="hljs-comment">//    style      - transition</span>
     <span class="hljs-keyword">this</span>.paper.layers.classList.add(<span class="hljs-string">'animate-viewport'</span>);
     <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-string">`matrix(<span class="hljs-subst">${ a }</span>, <span class="hljs-subst">${ b }</span>, <span class="hljs-subst">${ c }</span>, <span class="hljs-subst">${ d }</span>, <span class="hljs-subst">${ e }</span>, <span class="hljs-subst">${ f }</span>)`</span>;
     <span class="hljs-keyword">const</span> duration = <span class="hljs-built_in">parseFloat</span>(getComputedStyle(<span class="hljs-keyword">this</span>.paper.layers)[<span class="hljs-string">'transitionDuration'</span>]) * <span class="hljs-number">1000</span>;
     <span class="hljs-comment">//        style;</span>
     <span class="hljs-comment">//      joint</span>
     setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
       <span class="hljs-keyword">this</span>.paper.layers.classList.remove(<span class="hljs-string">'animate-viewport'</span>);
       <span class="hljs-keyword">this</span>.paper.layers.style.transform = <span class="hljs-literal">null</span>;
       <span class="hljs-keyword">this</span>.paper.matrix(newMatrix);
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:zoom'</span>);
       <span class="hljs-keyword">this</span>.updateGridSize();
       <span class="hljs-keyword">this</span>.paper.trigger(<span class="hljs-string">'paper:update'</span>);<font></font>
     }, duration);<font></font>
   }, <span class="hljs-number">100</span>);<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final result√≥ que, a veces, incluso los m√°s avanzados deben terminar con un archivo :) Esperamos que haya disfrutado cavando en el interior de la ballena (no importa lo espeluznante que parezca). </font><font style="vertical-align: inherit;">¬°Le deseamos un desarrollo exitoso con el kit Voximplant y m√°s!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es492218/index.html">Reglas de dise√±o de iconos para recordar</a></li>
<li><a href="../es492220/index.html">5 secretos poco conocidos de los pandas</a></li>
<li><a href="../es492222/index.html">Calificaciones CTFZone 2019: Pollo</a></li>
<li><a href="../es492226/index.html">Comparaci√≥n de precios en Kubernetes gestionados (2020)</a></li>
<li><a href="../es492228/index.html">Como Sports.ru escribi√≥ su editor WYSIWYG</a></li>
<li><a href="../es492234/index.html">Investigaci√≥n: por qu√© las personas est√°n listas para recibir menos en proyectos sociales</a></li>
<li><a href="../es492242/index.html">M5Stack y sus contactos</a></li>
<li><a href="../es492244/index.html">Remoci√≥n por el per√≠odo de coronavirus: ¬øarresto domiciliario o tiempo de oportunidad?</a></li>
<li><a href="../es492246/index.html">Coronavirus: posibles implicaciones para la sociedad, la econom√≠a y la medicina</a></li>
<li><a href="../es492248/index.html">Debouncing with React Hooks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>