<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎬 ✉️ 🛌🏻 Wie wir den Schulen geholfen haben, auf Fernunterricht umzusteigen und mit der Belastung fertig zu werden 🥚 🅱️ 🌝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Alexey Vakhov, ich bin der technische Direktor von Uchi.ru. Mitte März, als die Schulen auf Fernunterricht umstellten, stell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie wir den Schulen geholfen haben, auf Fernunterricht umzusteigen und mit der Belastung fertig zu werden</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/uchi_ru/blog/498906/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! Mein Name ist Alexey Vakhov, ich bin der technische Direktor von Uchi.ru. Mitte März, als die Schulen auf Fernunterricht umstellten, stellten wir Lehrern und Schülern verschiedene Dienste für Online-Klassen zur Verfügung. Nach unseren Berechnungen hatten wir einen Sicherheitsspielraum, um dem 1,5- bis 2-fachen der Last standzuhalten. Mitte April wuchs unser Verkehr um das Achtfache. Ich musste viel tun, um über Wasser zu bleiben. Vielleicht braucht jemand unsere Erfahrung, um diese oder eine zukünftige Krise zu überleben.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben solche Überraschungen nicht erwartet und waren nicht bereit dafür, wahrscheinlich war kein einziges Unternehmen in Russland oder auf der Welt dazu bereit. Normalerweise ist die Aktivität auf Uchi.ru im März im Vergleich zum Herbst aufgrund des Frühlings und der bevorstehenden Sommerferien geringer. Zu diesem Zeitpunkt bereiten wir uns bereits auf den September vor: Wir sägen Merkmale, führen Umgestaltungen durch, führen umfangreiche architektonische Änderungen durch und führen eine weitere angenehme Routine durch. Diesmal war es jedoch anders. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die maximale Anzahl von Unique Usern auf der Website erreichte gleichzeitig 240.000, wir haben das vorherige Maximum des aktuellen Schuljahres bei 30.000 Personen aufgezeichnet. Zu diesem Zeitpunkt wuchs die Last jeden Tag und wir arbeiteten rund um die Uhr, um den Standort zu stabilisieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine solche Last auf die Site fällt, werden in der Regel Anwendungen, Dienste, Balancer, Basen, Web und Kanäle gebildet. </font><font style="vertical-align: inherit;">Alle "Engpässe" der Infrastruktur werden aufgedeckt. </font><font style="vertical-align: inherit;">Unter solchen Bedingungen ist es schwierig, Probleme zu diagnostizieren - symptomatisch ist alles fehlerhaft. </font><font style="vertical-align: inherit;">Es ist leicht zu reparieren, wenn der Verkehr reibungslos wächst und eines ausfällt. </font><font style="vertical-align: inherit;">Wenn die Last in Aufregung gerät, besteht eines der großen Probleme darin, die Ursachen von Fehlern zu verstehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Strategie für das Arbeiten unter solchen Bedingungen besteht darin, zu beseitigen, was die Site am meisten trifft, dann den nächst schmerzhaftesten Punkt zu finden, gleichzeitig nach potenziellen Problemen zu suchen und diese zu beheben und so weiter. </font><font style="vertical-align: inherit;">Hier sind einige der bemerkenswertesten Dinge, die wir getan haben, um die Plattform zu stabilisieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verlassen Sie sich auf sich</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während einer Krise vor dem Verkehr werden Sie als Team eins. Es hängt von Ihren Mitarbeitern ab, ob Sie Lösungen finden, mit der Krise fertig werden oder nicht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt keine Leute in der Branche, die kommen, in Ihr komplexes System schauen, sofort etwas tun und alles wäre in Ordnung. Natürlich gibt es auf der Welt genügend Spezialisten, die die Aufgabe bewältigen, wenn Zeit bleibt. Wenn jedoch gerade eine grundlegende Lösung benötigt wird, können Sie sich nur auf Ihr Team verlassen, das das System und seine Besonderheiten kennt. Das Ergebnis und die Verantwortung für das Geschäft liegt beim Team. Eine externe Untersuchung ist ratsam, um punktweise zu verbinden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die operative Koordination des Anti-Krisen-Teams in einem speziellen Chat in Slack half uns, schnell zu navigieren und unsere Arbeit aufzubauen, die alle hier und jetzt gelöst wurden. </font><font style="vertical-align: inherit;">Wir haben die Verantwortungsbereiche zwischen den Mitarbeitern aufgeteilt, sodass es keine Kreuzungen gab und die Jungs keine Doppelarbeit geleistet haben. </font><font style="vertical-align: inherit;">An den schwierigsten Tagen musste ich buchstäblich rund um die Uhr in Kontakt bleiben.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweiterte Cloud</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sich nicht gegen alle Krisen versichern, aber es ist wichtig, flexibel zu sein. </font><font style="vertical-align: inherit;">Der Wolkenstapel gab uns eine solche Plastizität und die Möglichkeit, auch bei einem derart dramatischen Lastanstieg über Wasser zu bleiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anfangs haben wir die Ressourcen unter der erhöhten Last erhöht, aber irgendwann sind wir auf die Quoten der Region unseres Cloud-Anbieters gestoßen. </font><font style="vertical-align: inherit;">Auf seiner Ebene traten Probleme auf: Unsere virtuellen Server waren von Nachbarn betroffen, auf denen auch der Datenverkehr zunahm, was zu Fehlern beim Betrieb unserer Anwendungen führte. </font><font style="vertical-align: inherit;">Dies wurde erwartet: Wir sind auf den Anbieter und seine Infrastruktur angewiesen, die wiederum eine hohe Belastung erfahren haben. </font><font style="vertical-align: inherit;">Wir haben einige Ressourcen von virtuellen Maschinen ohne Priorität für den Hauptstandort freigegeben. </font><font style="vertical-align: inherit;">Mit dem Anbieter haben wir eine dedizierte Ressource vereinbart.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbesserte Überwachungstools</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während der Krise hat der Alarm seine Funktion nicht erfüllt. </font><font style="vertical-align: inherit;">Alle Teammitglieder überwachten bereits alle Systeme rund um die Uhr, und das Incident Management wurde auf ständige Arbeit an allen Fronten reduziert. </font><font style="vertical-align: inherit;">Um die aufgetretenen Probleme vollständig zu diagnostizieren, hatten wir zu wenig Daten. </font><font style="vertical-align: inherit;">Zum Überwachen virtueller Maschinen verwenden wir beispielsweise den Standardknotenexporter für Prometheus. </font><font style="vertical-align: inherit;">Er ist gut darin, das große Ganze zu sehen, denn bei näherer Betrachtung begann eine einzelne virtuelle Maschine, NetData zu verwenden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimierter Cache-Speicher</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Problem trat auch bei Schlüsselwertspeichern auf. </font><font style="vertical-align: inherit;">In einer der Anwendungen konnte Redis nicht damit umgehen - in einer einzigen Kopie kann es nur auf einem Kern arbeiten. </font><font style="vertical-align: inherit;">Daher verwendeten sie eine Redis-Gabel namens KeyDB, die in mehreren Threads arbeiten kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Bandbreite in einer anderen Anwendung zu erhöhen, haben wir 10 unabhängige Redis'ov erhöht. </font><font style="vertical-align: inherit;">Sie werden von unserem Service Mesh vertreten, das auch Schlüssel abschüttelt. </font><font style="vertical-align: inherit;">Selbst wenn ein oder zwei Redis abstürzen, verursacht dies keine Probleme aufgrund von konsistentem Hashing. </font><font style="vertical-align: inherit;">Außerdem müssen sie praktisch nicht verabreicht werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Netzwerk wurde erweitert</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie wissen, reichen 640 Kb für alle. </font><font style="vertical-align: inherit;">Wir haben immer private / 24-Subnetze verwendet, aber vor dem Hintergrund der Quarantäne mussten wir dringend auf / 22 erweitern. </font><font style="vertical-align: inherit;">Jetzt bietet das Netzwerk viermal so viele Server, wir hoffen, dass es mit Sicherheit ausreicht.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PgBouncer separat durchgeführt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als relationale Datenbank verwenden wir PostgreSQL überall, einige kleine virtuelle Instanzen und irgendwo - die Installation mehrerer großer dedizierter Server für den Master und die Replikate. Der offensichtliche Engpass dieser Architektur ist der Master, der im Idealfall nur für die Aufnahme verwendet wird und nicht horizontal skaliert. Mit dem Anstieg des Datenverkehrs begannen wir, uns auf der CPU auszuruhen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig verwenden wir PgBouncer, der auf dem Assistenten und auf jedem Replikat installiert wurde, um die Verbindungen zu verwalten. </font><font style="vertical-align: inherit;">An einem Port kann nicht mehr als ein Prozessorkern verwendet werden. Auf jedem Server gab es also mehrere Bouncer. </font><font style="vertical-align: inherit;">Irgendwann wurde klar, dass PgBouncer selbst den materiellen Teil der CPU von der Basis entfernte, und bei maximaler Last war ein rascher Anstieg des Lastdurchschnitts und ein Rückgang der Systemleistung zu verzeichnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Türsteher auf einen separaten Server verschoben, wodurch wir 20-25% der CPU auf jedem Datenbankserver einsparen konnten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit Überraschungen konfrontiert</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insbesondere in Krisenzeiten kann nur einem Tool nicht vertraut werden. Im Gegenteil, die Redundanz der Werkzeuge hilft, weil sie ein objektiveres Bild ermöglicht. Bekannte Tools versagen aus verschiedenen Gründen. Um beispielsweise die Anzahl der Personen auf einer Website zu schätzen, verwenden wir normalerweise einen Echtzeit-Google Analytics-Bericht, bei dem es sich um eine vertrauliche und genaue Metrik handelt. Aber manchmal ist es fehlerhaft und dieses Mal mussten wir uns interne Metriken wie die Anzahl der Seitenaufrufereignisse und die Anzahl der Anforderungen pro Sekunde ansehen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die zentralisierte Protokollierung verwenden wir ELK. </font><font style="vertical-align: inherit;">Unsere Protokolllieferungspipeline basiert auf Apache Kafka und Elastic Filebeat. </font><font style="vertical-align: inherit;">Unter hoher Last wurde die Verwaltung des Holzförderers eingestellt, die Protokolle gingen verloren oder blieben zurück. </font><font style="vertical-align: inherit;">Wir haben die Geschwindigkeit der Protokollübertragung und der Speicherindizierung erhöht, indem wir die Elasticsearch-Indizes bearbeitet, die Anzahl der Partitionen in Kafka und Filebeat erhöht und die Komprimierung in allen Phasen optimiert haben. </font><font style="vertical-align: inherit;">Aufgrund der Tatsache, dass die Pipeline zum Sammeln von Protokollen von der Produktion getrennt ist, hatten Probleme mit dem erhöhten Datenverkehr der Protokolle keine Auswirkungen auf die Funktionsweise des Standorts.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akzeptierte die Spielregeln</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist unmöglich, sich im Voraus auf jede Krise vorzubereiten, aber Sie können zunächst versuchen, ein flexibles System aufzubauen. </font><font style="vertical-align: inherit;">Startups oder Unternehmen, die nach und nach aufhören, Startups zu sein, ist es in einer ruhigen Zeit nicht immer vernünftig, sich auf ein abnormales Verkehrswachstum vorzubereiten: Die Ressourcen des Teams sind begrenzt. </font><font style="vertical-align: inherit;">Wenn wir ihre Vorbereitung auf etwas aufgeben, das niemals passieren kann, bleibt keine Kraft mehr für das Hauptprodukt. </font><font style="vertical-align: inherit;">Es ist viel wichtiger, im Moment richtig zu reagieren und keine Angst vor mutigen Entscheidungen zu haben. </font><font style="vertical-align: inherit;">Das Ergebnis ihrer Krise ist in der Regel ein Ausstieg auf ein qualitativ neues Niveau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist so ein lustiger Frühling in diesem Jahr. </font><font style="vertical-align: inherit;">Wenn es den Anschein hat, dass alles Mögliche getan wurde, stellt sich manchmal heraus, dass dies nur der Anfang ist.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498892/index.html">Die letzte Überprüfung der Renga-API</a></li>
<li><a href="../de498894/index.html">Normaler Flug</a></li>
<li><a href="../de498898/index.html">Neuronale Netze für Kinder: Erklären Sie so einfach wie möglich</a></li>
<li><a href="../de498900/index.html">Rosbank Java-Schule - Lernergebnisse</a></li>
<li><a href="../de498904/index.html">Hinzufügen von Parallel Computing zu Pandas</a></li>
<li><a href="../de498910/index.html">Kommerzielle Astronautik - Mythen und Realität</a></li>
<li><a href="../de498912/index.html">Anti-Krisen-Abteilung von Habr</a></li>
<li><a href="../de498914/index.html">Wachsende KI - Genetische Algorithmen: Eine Einführung</a></li>
<li><a href="../de498918/index.html">Ihre Aussage ist 100% richtig, verfehlt nur den Punkt</a></li>
<li><a href="../de498920/index.html">Zahlungssysteme. Rüstungs- und Muschelwettbewerb</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>