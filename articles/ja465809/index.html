<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔙 🤵 🤩 時期尚早の最適化の罠に陥らないでください 🤤 ♠️ 😘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="かつてドナルドクヌースは後に有名になった言葉を次のように述べています。時期尚早の最適化は、プログラミングにおけるすべての悪（または少なくともその大部分）の根源です。 この資料の著者は、私たちが本日翻訳を公開していますが、彼がいかにして時期尚早な最適化の罠に陥ったか、そして彼自身の苦い経験から、時期尚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>時期尚早の最適化の罠に陥らないでください</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/465809/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かつて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドナルドクヌース</font></a><font style="vertical-align: inherit;">は後に有名になった言葉を次のように述べています。</font><font style="vertical-align: inherit;">時期尚早の最適化は、プログラミングにおけるすべての悪（または少なくともその大部分）の根源です。</font><font style="vertical-align: inherit;">
この資料の著者は、私たちが本日翻訳を公開していますが、彼がいかにして時期尚早な最適化の罠に陥ったか、そして彼自身の苦い経験から、時期尚早な最適化がすべての悪の根であるということをどのように理解したかについて話したいと思います。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/ps/qf/uj/psqfujg9tiki8nv85hrvqqwpyfy.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームGeoArenaオンライン</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数年前、私はWebゲームGeoArena Onlineに取り組みました（その後、私</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はそれ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">販売し</font></a><font style="vertical-align: inherit;">、新しい所有者が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geoarena.ioに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿しました</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">それは「最後の生存者」のスタイルのマルチプレイヤーゲームでした。</font><font style="vertical-align: inherit;">そこで、プレイヤーは船をコントロールし、他のプレイヤーと1対1で戦いました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f49/a9d/bcc/f49a9dbcc8d59ab914ce355de6231696.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームGeoArenaオンライン</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/259/3b0/346/2593b03467d1c05d04b3b23022e131c6.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲームGeoArena Online</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パーティクルとエフェクトでいっぱいの世界であるダイナミックゲーム</font><i><font color="#999999"><font style="vertical-align: inherit;">の</font></font></i><font style="vertical-align: inherit;">作業には、深刻なコンピューティングリソースが必要です。</font><font style="vertical-align: inherit;">その結果、一部の古いコンピュータのゲームは、特に緊迫した瞬間に「スローダウン」しました。</font><font style="vertical-align: inherit;">生産性の問題に無関心ではない私は、この問題の解決策に興味を持って取り上げました。</font><font style="vertical-align: inherit;">「GeoArenaのクライアント側のJavaScript部分をスピードアップするにはどうすればよいですか」と私は自問しました。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fast.jsライブラリ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インターネットで少し検索したところ、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライブラリが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">見つかり</font></a><font style="vertical-align: inherit;">ました</font><font style="vertical-align: inherit;">。これは「非常に高速なJavaScriptプログラムの開発を簡素化することを目的としたマイクロ最適化のコレクション」でした。このライブラリは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array.prototype.forEach（）の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">組み込みの</font></a><font style="vertical-align: inherit;">標準メソッドのより高速な実装の可用性によって加速されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは非常に興味深いものでした。 GeoArenaは多くの配列を使用し、配列を使用して多くの操作を実行したため、fast.jsを使用するとゲームの高速化に非常に役立ちます。</font><font style="vertical-align: inherit;">fast.js </font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">README</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、以下の研究生産性の結果が含まれています</font></font><code>forEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">Native .forEach() vs fast.forEach() (<span class="hljs-number">10</span> items)<font></font>
&nbsp;&nbsp;✓&nbsp; <span class="hljs-built_in">Array</span>::forEach() x <span class="hljs-number">8</span>,<span class="hljs-number">557</span>,<span class="hljs-number">082</span> ops/sec ±<span class="hljs-number">0.37</span>% (<span class="hljs-number">97</span> runs sampled)<font></font>
&nbsp;&nbsp;✓&nbsp; fast.forEach() x <span class="hljs-number">8</span>,<span class="hljs-number">799</span>,<span class="hljs-number">272</span> ops/sec ±<span class="hljs-number">0.41</span>% (<span class="hljs-number">97</span> runs sampled)<font></font>
<font></font>
&nbsp;&nbsp;<span class="hljs-attr">Result</span>: fast.js is <span class="hljs-number">2.83</span>% faster than <span class="hljs-built_in">Array</span>::forEach().</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の外部ライブラリに実装されているメソッドを標準バージョンよりも高速にするにはどうすればよいですか？</font><font style="vertical-align: inherit;">問題は、1つのトリックがあったということです（これらのトリックは、見ているところすべてにあります）。</font><font style="vertical-align: inherit;">このライブラリは、スパースでない配列を扱う場合にのみ適していました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような配列の簡単な例をいくつか示します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//  -  :   1  .</span><font></font>
<font></font>
<span class="hljs-keyword">const</span> sparse1 = [<span class="hljs-number">0</span>, , <span class="hljs-number">1</span>];
<span class="hljs-built_in">console</span>.log(sparse1.length); <span class="hljs-comment">// 3</span><font></font>
<font></font>
<span class="hljs-comment">//  -  </span>
<span class="hljs-keyword">const</span> sparse2 = [];<font></font>
<font></font>
<span class="hljs-comment">// ...   - .   0 - 4    .</span><font></font>
<font></font>
sparse2[<span class="hljs-number">5</span>] = <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.log(sparse2.length); <span class="hljs-comment">// 6</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリがスパース配列で正常に機能しない理由を理解するために、そのソースコードを調べました。</font></font><code>forEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.js </font><font style="vertical-align: inherit;">の実装</font><font style="vertical-align: inherit;">はループに基づい</font><font style="vertical-align: inherit;">ていること</font><font style="vertical-align: inherit;">がわかりました</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">メソッドの簡単な実装は</font></font><code>forEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のようになります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//     .</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fastForEach</span>(<span class="hljs-params">array, f</span>) </span>{
&nbsp;&nbsp;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.length; i++) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;f(array[i], i, array);<font></font>
&nbsp;&nbsp;}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> sparseArray = [<span class="hljs-number">1</span>, , <span class="hljs-number">2</span>];
<span class="hljs-keyword">const</span> print = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(x);<font></font>
<font></font>
fastForEach(sparseArray, print); <span class="hljs-comment">//  print() 3 .</span>
sparseArray.forEach(print); <span class="hljs-comment">//  print()  2 .</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド呼び出し</font></font><code>fastForEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、3つの値の結論につながります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">1</span>
<span class="hljs-literal">undefined</span>
<span class="hljs-number">2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出し</font></font><code>sparseArray.forEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、2つの値の結論のみを導きます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-number">1</span>
<span class="hljs-number">2</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この違いは、コールバック関数の使用に関するJS仕様が、そのような関数</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がリモートまたは初期化されていない配列インデックス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（「ホール」とも呼ばれる）</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">で呼び出されるべきではないことを</font></a><font style="vertical-align: inherit;">示しているという事実によるもの</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">実装</font></font><code>fastForEach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、配列に「穴」の存在をチェックしませんでした。</font><font style="vertical-align: inherit;">これにより、スパース配列での正しい処理を犠牲にして速度が向上しました。</font><font style="vertical-align: inherit;">スパース配列はGeoArenaでは使用されなかったので、これは私にとっては完璧でした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この時点で、fast.jsで簡単なテストを行う必要があります。</font><font style="vertical-align: inherit;">ライブラリをインストールし、オブジェクトの標準メソッドを</font></font><code>Array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.jsから</font><font style="vertical-align: inherit;">メソッドに変更して</font><font style="vertical-align: inherit;">、ゲームのパフォーマンスをテストする必要があります。</font><font style="vertical-align: inherit;">しかし、代わりに、私は完全に異なる方向に移動しました。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の開発はfaster.jsと呼ばれています</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私に住んでいるマニアの完璧主義者は、ゲームのパフォーマンスを最適化することから、すべてを完全に絞り出したいと思っていました。</font><font style="vertical-align: inherit;">fast.jsライブラリは、その使用がそのメソッドの呼び出しを意味するため、十分なソリューションとは思えませんでした。</font><font style="vertical-align: inherit;">次に私は考えました。「配列の標準的なメソッドを、これらのメソッドの実装を新しくより高速なコードに埋め込むだけで置き換えるとどうなるでしょうか。</font><font style="vertical-align: inherit;">これにより、ライブラリメソッドを呼び出す必要がなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンパイラを作成するという独創的なアイデアに私を導いたのはこのアイデア</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でした</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">fast.jsの代わりに使用する予定でした。</font><font style="vertical-align: inherit;">たとえば、以下はソースコードスニペットです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//  </span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> results = arr.map(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-number">2</span> * e);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fast.jsコンパイラは、このコードを次のコードに変換します-高速ですが、見栄えが悪くなります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//      faster.js</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(arr.length);
<span class="hljs-keyword">const</span> _f = (<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-number">2</span> * e);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> _i = <span class="hljs-number">0</span>; _i &lt; arr.length; _i++) {<font></font>
&nbsp;&nbsp;results[_i] = _f(arr[_i], _i, arr);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fast.jsの作成は、fast.jsを支えるのと同じアイデアによって促されました。</font><font style="vertical-align: inherit;">つまり、スパース配列のサポートが拒否されたことによるパフォーマンスのマイクロ最適化について話しているのです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一見すると、faster.jsは非常に成功した開発のように思えました。</font><font style="vertical-align: inherit;">以下は、faster.jsパフォーマンス調査の結果です。</font></font><br>
<br>
<pre><code class="javascript hljs">&nbsp;&nbsp;array-filter large<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ native x <span class="hljs-number">232</span>,<span class="hljs-number">063</span> ops/sec ±<span class="hljs-number">0.36</span>% (<span class="hljs-number">58</span> runs sampled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ faster.js x <span class="hljs-number">1</span>,<span class="hljs-number">083</span>,<span class="hljs-number">695</span> ops/sec ±<span class="hljs-number">0.58</span>% (<span class="hljs-number">57</span> runs sampled)<font></font>
faster.js is <span class="hljs-number">367.0</span>% faster (<span class="hljs-number">3.386</span>μs) than native<font></font>
<font></font>
&nbsp;&nbsp;array-map large<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ native x <span class="hljs-number">223</span>,<span class="hljs-number">896</span> ops/sec ±<span class="hljs-number">1.10</span>% (<span class="hljs-number">58</span> runs sampled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ faster.js x <span class="hljs-number">1</span>,<span class="hljs-number">726</span>,<span class="hljs-number">376</span> ops/sec ±<span class="hljs-number">1.13</span>% (<span class="hljs-number">60</span> runs sampled)<font></font>
faster.js is <span class="hljs-number">671.1</span>% faster (<span class="hljs-number">3.887</span>μs) than native<font></font>
<font></font>
&nbsp;&nbsp;array-reduce large<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ native x <span class="hljs-number">268</span>,<span class="hljs-number">919</span> ops/sec ±<span class="hljs-number">0.41</span>% (<span class="hljs-number">57</span> runs sampled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ faster.js x <span class="hljs-number">1</span>,<span class="hljs-number">621</span>,<span class="hljs-number">540</span> ops/sec ±<span class="hljs-number">0.80</span>% (<span class="hljs-number">57</span> runs sampled)<font></font>
faster.js is <span class="hljs-number">503.0</span>% faster (<span class="hljs-number">3.102</span>μs) than native<font></font>
<font></font>
&nbsp;&nbsp;array-reduceRight large<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ native x <span class="hljs-number">68</span>,<span class="hljs-number">671</span> ops/sec ±<span class="hljs-number">0.92</span>% (<span class="hljs-number">53</span> runs sampled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;✓ faster.js x <span class="hljs-number">1</span>,<span class="hljs-number">571</span>,<span class="hljs-number">918</span> ops/sec ±<span class="hljs-number">1.16</span>% (<span class="hljs-number">57</span> runs sampled)<font></font>
faster.js is <span class="hljs-number">2189.1</span>% faster (<span class="hljs-number">13.926</span>μs) than native</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完全なテスト結果は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それらは15インチMacBook Pro 2018のNode v8.16.1で実行されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の開発は標準の実装より2000％速いですか？</font><font style="vertical-align: inherit;">このような生産性の大幅な向上は、間違いなく、どのようなプログラムにも最も大きなプラスの影響を与える可能性があるものです。</font><font style="vertical-align: inherit;">正しい？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいえ、そうではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単な例を考えてみましょう。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平均的なGeoArenaゲームが5,000ミリ秒（ms）の計算を必要とすることを想像してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.jsコンパイラーは、配列メソッドの実行を平均10倍高速化します（これは概算であり、さらに過大評価されています。ほとんどの実際のアプリケーションでは、2倍の加速さえありません）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ここで本当に興味深い質問があります。「これらの5000ミリ秒のどの部分が配列メソッドの実装に費やされているのですか？」です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
半分としましょう。</font><font style="vertical-align: inherit;">つまり、2500 msは配列メソッドに費やされ、残りの2500 msはその他すべてに費やされます。</font><font style="vertical-align: inherit;">その場合、faster.jsを使用すると、パフォーマンスが大幅に向上します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd3/1fb/d74/cd31fbd7429d4ce60636a7031c657ac2.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件付きの例：プログラムの実行時間が大幅に短縮され</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
た結果、計算の合計実行時間が45％削減されたことがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、これらすべての議論は現実とはかけ離れています。もちろん、GeoArenaは多くの配列メソッドを使用します。しかし、さまざまなタスクのコード実行時間の実際の分布は次のようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ae/7b8/2ff/2ae7b82ffd8c59c1632f7bab32d2b7fc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">厳しい現実</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
悲しい-私は何を言うことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ドナルドクヌースが警告した間違いです。私はそれらが適用されるべきものに私の努力を入れなかった、そしてそれがやる価値があるときにそれをしなかった。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは簡単な数学が登場します。何かがプログラムの実行時間の1％しかかからない場合、これを最適化しても、生産性は1％だけ向上します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ドナルドクヌースが「必要な場所ではない」と言ったときに、まさにそれを念頭に置いていました。また、「必要な場所」について考えると、これらはパフォーマンスのボトルネックを表すプログラムの一部であることがわかります。これらは、プログラムの全体的なパフォーマンスに大きく貢献するコードです。ここでは、「生産性」の概念が非常に広い意味で使用されています。これには、プログラムのランタイム、コンパイルされたコードのサイズなどが含まれます。パフォーマンスに大きな影響を与えるプログラムのその部分での10％の改善は、いくつかの小さなことでの100％の改善よりも優れています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クヌートはまた、努力の適用について「必要なときではない」と語った。</font><font style="vertical-align: inherit;">ここでのポイントは、必要なときにだけ何かを最適化する必要があるということです。</font><font style="vertical-align: inherit;">もちろん、最適化について考える十分な理由がありました。</font><font style="vertical-align: inherit;">しかし、faster.jsの開発を開始し、その前にGeoArenaでfast.jsライブラリをテストすることさえしなかったことを覚えていますか？</font><font style="vertical-align: inherit;">私のゲームでfast.jsのテストに費やされた分は、何週間もの作業を節約します。</font><font style="vertical-align: inherit;">私が陥ったのと同じ罠に陥らないでほしい。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fast.jsの実験に興味がある場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモ</font><font style="vertical-align: inherit;">をご覧ください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">どのような結果が得られるかは、デバイスとブラウザーによって異なります。</font><font style="vertical-align: inherit;">ここでは、たとえば、15インチMacBook Pro 2018の私のChrome 76で何が起こったか。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08d/7f9/05c/08d7f905cc232d83c0b17a9107d2abd5.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faster.jsのテスト結果</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
GeoArenaでfaster.jsを使用した実際の結果について知りたい場合があります。</font><font style="vertical-align: inherit;">私がゲームがまだ私のものだったとき（言ったように、私はそれを販売しました）、いくつかの基本的な調査を行いました。</font><font style="vertical-align: inherit;">その結果、次のことが判明しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.jsを使用すると、一般的なゲームのメインゲームサイクルの実行が約1％高速化されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fast.jsの使用により、ゲームのバンドルのサイズが0.3％増加しました。</font><font style="vertical-align: inherit;">これにより、ゲームページの読み込みが少し遅くなりました。</font><font style="vertical-align: inherit;">バンドルのサイズは、faster.jsが標準の短いコードを高速に変換するだけでなく、長いコードに変換するために大きくなっています。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、faster.jsには長所と短所がありますが、この私の開発はGeoArenaのパフォーマンスにあまり影響を与えませんでした。</font><font style="vertical-align: inherit;">fast.jsを使用して最初にゲームをテストするのが面倒だったとしたら、もっと早く理解できただろう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の話があなたへの警告として役立つかもしれません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時期尚早の最適化の罠に陥りましたか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465797/index.html">遺伝的アルゴリズム（またはクライアントは常に王様です-そしてしばしばばか者です）</a></li>
<li><a href="../ja465801/index.html">フードデザインダイジェスト2019年8月</a></li>
<li><a href="../ja465803/index.html">Goプロジェクトを構築するためのMavenの方法</a></li>
<li><a href="../ja465805/index.html">Gigatron-プロセッサーなしの自家製マイクロコンピューター</a></li>
<li><a href="../ja465807/index.html">人気のJavaScriptライブラリが端末に広告を表示し始めた経緯</a></li>
<li><a href="../ja465811/index.html">クリーンなReactコードを書くための14のヒント。パート1</a></li>
<li><a href="../ja465813/index.html">クリーンなReactコードを書くための14のヒント。パート2</a></li>
<li><a href="../ja465815/index.html">科学者たちは神経細胞のクラスターを成長させ、ISSに送りました</a></li>
<li><a href="../ja465817/index.html">不快感が開発プロセスの改善にどのように役立つか。</a></li>
<li><a href="../ja465819/index.html">理想的なLAN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>