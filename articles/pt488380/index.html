<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëßüèø üëçüèæ üà∏ O in√≠cio mais f√°cil no STM atrav√©s de "um local" üßïüèø ü§æüèΩ üë©üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Provavelmente, o tempo das guerras religiosas da AVR contra o STM j√° passou, mas n√£o, n√£o, sim, h√° surtos de confrontos entre os dois campos. Quase qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>O in√≠cio mais f√°cil no STM atrav√©s de "um local"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488380/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provavelmente, o tempo das guerras religiosas da AVR contra o STM j√° passou, mas n√£o, n√£o, sim, h√° surtos de confrontos entre os dois campos. Quase qualquer publica√ß√£o sobre artesanato AVR definitivamente ter√° um coment√°rio como "Sim, quanto voc√™ pode transar com sua av√≥, √© hora de mudar para o STM", ent√£o h√° uma varia√ß√£o no assunto de pre√ßo, n√∫mero de pernas e temporizadores. Se o STMshcher for mais avan√ßado, certamente haver√° uma indica√ß√£o de que n√£o h√° DMA no AVR e n√£o haver√°, portanto o AVR deve morrer. Por que um simples DMA de term√¥metro intermitente, uma montanha de temporizadores de 16 bits, 100 pernas e um ADC de 12 bits, normalmente ningu√©m explica. Por que precisamos de um harvester em um dispositivo que o Tiny13 possa retirar facilmente, que ao mesmo tempo n√£o √© carregado nem em um ter√ßo de seus recursos, ningu√©m vai entender. Voc√™ s√≥ precisa mudar para o STM32, e √© isso. Por aqui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E devo dizer que as pessoas anseiam por novidades. Mas s√©rio, posso tentar? E se voc√™ gostar? Aqui est√° apenas o Manual de Refer√™ncia do popular STM32F103C8T6, no qual o tablet Blue de 1126 p√°ginas mais maci√ßo se baseia, de alguma forma, ele realmente n√£o tem um "in√≠cio r√°pido". Mesmo um utilit√°rio separado, t√£o odiado pelos anci√£os ‚Äúkalokub‚Äù, e que deve ser estudado, o que √© o qu√™. Sim, e tendo mergulhado no Cube, √© improv√°vel que comece em 5 minutos, o cal√ßado gerado por ele n√£o √© a mat√©ria de leitura mais acess√≠vel para a noite, √© apenas para entrar na testa, sobre a qual nem todo mundo pode falar por l√°.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In√∫meros artigos, semelhantes a este, sobre o in√≠cio r√°pido e f√°cil no STM merecem uma discuss√£o separada. Para todos esses artigos, a princ√≠pio fiquei muito confuso com uma circunst√¢ncia. Em nenhum lugar h√° uma explica√ß√£o detalhada do que realmente estamos escrevendo aqui. Um monte de capturas de tela de como criar um projeto e, em seguida, imediatamente uma parede de c√≥digo, fa√ßa assim! E o que h√°, por que, por que √©, de onde obter todas essas palavras aparentemente compreens√≠veis, ningu√©m se aprofunda, porque as for√ßas se esgotaram ao escrever um manual sobre a instala√ß√£o de Cale e Cuba e ao lan√ßar o projeto. Somente ap√≥s algum tempo, individual para cada um, √© que o entendimento do que est√° acontecendo e por que vem. Por sua vez, proponho uma maneira de come√ßar n√£o do come√ßo, como todo mundo, mas do fim. Agora faremos o oposto, n√£o configuramos o controlador, escrevemos o c√≥digo e o estreamos, mas continuamos imediatamente para a depura√ß√£o,e registre nossas a√ß√µes na forma de c√≥digo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, instalamos o Keil como um ambiente gratuito (at√© 32 KB de c√≥digo). N√£o descreveremos essa a√ß√£o, ela est√° na Internet e o passo a passo do instalador deve ser dominado pela pessoa que vai ao STM. Iniciamos o projeto: Projeto-Novo projeto uVision, criamos uma pasta e um arquivo de projeto. A janela de sele√ß√£o do controlador √© aberta, insira 103C8 na pesquisa e concorde com o √∫nico modelo selecionado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, chegamos √† janela de sele√ß√£o da biblioteca:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/ox/yf/4voxyfdppukch2gamrnsguvzbfk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui colocamos tr√™s daws: CMSIS-CORE, Inicializa√ß√£o do dispositivo e GPIO do dispositivo. Este conjunto √© suficiente para saltar uma perna, acendendo o LED. Ent√£o voc√™ ainda precisa configurar, voc√™ n√£o pode chegar a lugar algum disso. Alt + F7 inicia a janela de configura√ß√µes localizada Op√ß√µes do projeto para destino, na guia ‚ÄúSa√≠da‚Äù, voc√™ precisa marcar a caixa de sele√ß√£o ‚ÄúCriar arquivo HEX‚Äù para criar um arquivo de firmware que enviaremos para o controlador. Em seguida, na guia "Debug", selecionamos o ST-Link, que, de fato, carregar√° o firmware e ser√° iniciado: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/uw/6l/kduw6ltbrav_uadgbbrp93w5oke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pelo bot√£o "Setting" ao lado da janela de sele√ß√£o do programador, chegamos √† janela "Cortex-M Target Driver Setup", na janela " Download em Flash "coloque uma daw" Redefinir e executar ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na √°rvore do projeto, clique com o bot√£o direito do mouse na pasta "Source Group 1", no assistente que se abre, crie o arquivo main.c, no qual iremos escrever o c√≥digo em breve. No main.c aberto, clique com o bot√£o direito do mouse na primeira e mais importante inclus√£o: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qc/zp/ju/qczpjupur2s0vqx-reffsuzy5qo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adicione o c√≥digo que consiste em main e infinito enquanto:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
int main(){<font></font>
	while(1){<font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Curiosamente, isso √© tudo por enquanto, este √© um programa pronto e compreens√≠vel que compila e carrega corretamente no controlador. Pressionamos F7 e vemos que o firmware foi montado com sucesso, n√£o h√° erros ou avisos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4b/bs/d3/4bbsd3ca51m6nmrx4gon6a_rwyw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir deste momento, o controlador est√° totalmente acess√≠vel para n√≥s, podemos inseri-lo sob a linha de depura√ß√£o e girar em todas as dire√ß√µes, e ele responder√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As teclas Ctrl + F5 nos levam √† depura√ß√£o, e o bot√£o ‚ÄúSystem Viewer Windows‚Äù permite iniciar as janelas para controlar os registros de registro e controlar as pernas do GPIO. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1e/ri/u1/1eriu1hhnribtydyhsaq-i36lr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, sugiro que voc√™ ainda use o Manual de Refer√™ncia, especialmente porque voc√™ nem precisa baix√°-lo, ele estar√° dispon√≠vel clicando na guia "Livros" do menu "Visualizar":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/4j/hm/fx4jhmgymzqzczhfcqto1wusr2m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, proponho usar o seguinte racioc√≠nio. Pela pinagem no Blue Tablet, pode-se ver que o LED trava na parte da porta 13. V√°rios recursos e discuss√µes da Internet sempre mencionam que, antes de voc√™ fazer algo no STM, √© necess√°rio ativar algo, caso contr√°rio, acerte o rel√≥gio. Sem mais delongas, escrevemos na caixa de pesquisa do leitor de pdf o que precisamos: habilitar a porta C: ‚ÄúPORT C CLOCK ENABLE‚Äù. Entramos na figura a seguir: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/lh/vs/qflhvsoyc3fhyds54-clxwq0eqo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir disso, podemos concluir que o rel√≥gio da porta C est√° ativado no registro IOPCEN. Com esse conhecimento, vamos para a guia RCC no modo de depura√ß√£o e inserimos esse nome na barra de pesquisa: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/x4/3q/z0x43qbnbga_-q0voxoajotxuqs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Marque a caixa de sele√ß√£o necess√°ria com uma marca de sele√ß√£o e, a partir deste momento, consideramos a porta C ativada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, lembrando-se do AVR de longa dura√ß√£o, procuraremos a configura√ß√£o do pino real. Para que funcione, √© necess√°rio explicar exatamente o que queremos dele. E queremos pular com o p√© n√∫mero 13 da porta C, para isso precisamos definir o modo de opera√ß√£o. Na barra de pesquisa do Manual do Referense, dirigimos em "Configura√ß√£o de bit de porta", que expressa nosso desejo de ler onde as configura√ß√µes de perna est√£o ocultas. A pesquisa nos leva a uma tabela da qual se segue que, para atribuir uma perna como uma sa√≠da, √© necess√°rio configurar os registros MODE e CNF: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/c4/ot/odc4oti0osjwy9qvuax79slsqv4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na tabela No. 20, √© claro que, para atribuir uma perna como uma sa√≠da Push-Pull, √© necess√°rio redefinir os registros CNF0 e CNF1 e o estado do par MODE0 e MODE1 est√£o descritos na tabela No. 21, selecionarei a op√ß√£o superior, at√© 10MHz, MODE0 = 1, MODE1 = 0. √â o que farei na janela GPIOC para os registros CNF13 e MODE13</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-n/x5/y3/-nx5y33grvntsdchwf7emhxlgnc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora configuramos o rel√≥gio e o modo de opera√ß√£o da porta. √â hora de descobrir exatamente como pular uma perna. Em ingl√™s, defina o bit da porta como "Port bit set" e procuraremos esta frase no manual: A </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/l8/r2/nwl8r2ne5djl9o3hmpwxg2eigg0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pesquisa nos leva a uma p√°gina com uma tabela, que mostra claramente que o registro BSRR, composto por pares BS e BR, √© respons√°vel por definir o status da perna da porta , Bit set e Bit reset, respectivamente. Encontramos esses registros na janela GPIOC no modo de depura√ß√£o e desfrutamos do controle da perna n√∫mero 13 diretamente, cutucando gralhas com o mouse nas caixas de sele√ß√£o correspondentes:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ob/vj/c3/obvjc3gnvzem1sh6tecfly7quyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um LED no quadro azul est√° pendurado entre a perna e o VCC, controlando-o de volta ao nome do registro. O Bit Set (registro BS13) o apaga e o Bit Reset (registro BR13) o acende. Estes s√£o registros de opera√ß√µes at√¥micas, s√£o redefinidos ap√≥s definir a caixa de sele√ß√£o. √â poss√≠vel controlar o p√© atrav√©s do registrador ODR (se√ß√£o 9.2.4 Registrador de dados de sa√≠da da porta (GPIOx_ODR) no manual de refer√™ncia), mostra claramente o que leva √† instala√ß√£o e redefini√ß√£o da gralha. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/rd/ou/nvrdouc1ano_fn8gdpdplk2v5rq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um LED verde e verde esmaecido indica que tudo est√° funcionando corretamente. Resta apenas escrever tudo isso na forma de c√≥digo no arquivo main.c. √â aqui que as pr√≥prias passas aparecem, o que distingue esse m√©todo de compreender o controlador STM atrav√©s da depura√ß√£o dos outros com os quais toda a Internet est√° cheia. Sugiro apenas reescrever o que vemos na janela de depura√ß√£o no c√≥digo. Exemplo:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/f9/ww/kqf9wwqdt2ydqoz9ovv1f9k2xt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defina o modo de opera√ß√£o da porta e ative o rel√≥gio; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/a-/fk/iua-fkaw0im1tjbpxqm4kwpruio.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles ligaram a perna do porto, esperaram, desligaram e assim por diante:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
<font></font>
int main(){<font></font>
	RCC-&gt;APB2ENR=0x00000010;			//  <font></font>
	GPIOC-&gt;CRH=0x44144444;			//   Push-Pull  10MHz<font></font>
	int i;								//     / <font></font>
	while(1){<font></font>
		GPIOC-&gt;ODR=0x00002000;		//  LED,      <font></font>
		i=2000000;					//    <font></font>
		while (i) i--;					// <font></font>
		GPIOC-&gt;ODR=0x00000000;		//  LED<font></font>
		i=2000000;					//  <font></font>
		while (i) i--;					<font></font>
	}<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, esse m√©todo est√° longe de ser o melhor e n√£o est√° correto, mas, na minha opini√£o, o mais compreens√≠vel e simples. Al√©m disso, ele come√ßa a trabalhar com uma folha de dados (manual de refer√™ncia) e n√£o se assusta, como ler mana e escrever c√≥digos de p√°gina de v√°rias p√°ginas para o Blink. Sim, n√£o h√° camadas de abstra√ß√µes, muita coisa foi perdida, mas acho que voc√™ pode perdoar isso pelo come√ßo elementar. A leitura de mana e o trabalho correto com os registros √© que agora temos um LED piscando e basicamente entendemos como e o que fizemos e, mais importante, de onde vieram todas essas abrevia√ß√µes. Se me mostrassem essa maneira de estudar o STM antes, talvez eu n√£o tivesse coletado mais de 9.000 programadores diferentes para o AVR nos quais n√£o havia depura√ß√£o, mas teria adotado o Cortex imediatamente. De fato, no AVR n√£o h√° depura√ß√£o intelig√≠vel e acess√≠vel, mas, de qualquer maneira, √© muito cedo para esquecer o Tiny13. Ela tira suas tarefas.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt488368/index.html">O que aprendi enquanto trabalhava no meu primeiro projeto em larga escala</a></li>
<li><a href="../pt488370/index.html">TDD para microcontroladores. Parte 2: Como os espi√µes se livram dos v√≠cios</a></li>
<li><a href="../pt488374/index.html">Telegrama + 1C + Webhooks + Apache + Certificado autoassinado</a></li>
<li><a href="../pt488376/index.html">Quando o princ√≠pio "para o inferno com tudo, pegue e fa√ßa!" n√£o funciona: notas de procrastinador</a></li>
<li><a href="../pt488378/index.html">Brevemente sobre nomea√ß√£o em JS</a></li>
<li><a href="../pt488382/index.html">Eu adiciono um atraso de 3-25 segundos aos sites que visito</a></li>
<li><a href="../pt488386/index.html">Casos para aplicar ferramentas de an√°lise de anomalias de rede: ataques atrav√©s de plug-ins de navegador</a></li>
<li><a href="../pt488388/index.html">Autentica√ß√£o b√°sica de login e HTTP novamente</a></li>
<li><a href="../pt488390/index.html">Como fazer amigos do Telegram bot com o OpenId Connect</a></li>
<li><a href="../pt488392/index.html">Imagens prontas para produ√ß√£o para k8s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>