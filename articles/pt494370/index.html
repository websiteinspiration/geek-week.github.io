<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕒 👩🏼‍🍳 🚹 Arquitetura limpa através dos olhos de um desenvolvedor Python 👩🏾‍🤝‍👨🏿 📞 🚵🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá! Meu nome é Eugene, sou desenvolvedor de Python. No último ano e meio, nossa equipe começou a aplicar ativamente os princípios da Arquitetura Limp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Arquitetura limpa através dos olhos de um desenvolvedor Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/494370/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá! Meu nome é Eugene, sou desenvolvedor de Python. No último ano e meio, nossa equipe começou a aplicar ativamente os princípios da Arquitetura Limpa, afastando-se do modelo clássico do MVC. E hoje vou falar sobre como chegamos a isso, o que isso nos dá e por que a transferência direta de abordagens de outros PLs nem sempre é uma boa solução.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/hs/tl/t_hstlzmkevavrg4y8tazjdfu4c.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Python é minha principal ferramenta de desenvolvimento há mais de sete anos. Quando me perguntam o que mais gosto nele, respondo que essa é sua </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excelente legibilidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O primeiro conhecido começou com a leitura do livro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Programming a Collective Mind”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eu estava interessado nos algoritmos descritos nele, mas todos os exemplos estavam em uma linguagem que ainda não me era familiar. Isso não era usual (o Python ainda não era popular no aprendizado de máquina), as listagens eram frequentemente escritas em pseudo-código ou usando diagramas. Mas, depois de uma rápida introdução à linguagem, apreciei sua concisão: tudo era </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fácil e claro, nada supérfluo e perturbador, apenas a essência do processo descrito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O principal mérito disso é o design incrível da linguagem, o açúcar sintático muito intuitivo. </font><font style="vertical-align: inherit;">Essa expressividade sempre foi apreciada na comunidade. </font><font style="vertical-align: inherit;">O que é " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importar isso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", necessariamente presente nas primeiras páginas de qualquer livro: parece um superintendente invisível, avalia constantemente suas ações. </font><font style="vertical-align: inherit;">Nos fóruns, valia a pena para um iniciante usar de alguma forma o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CamelCase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no nome da variável na listagem; assim, imediatamente o ângulo de discussão mudou para o idioma do código proposto com referências ao PEP8.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A busca pela elegância e o poderoso dinamismo da linguagem criaram muitas bibliotecas com uma API verdadeiramente deliciosa.&nbsp;</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o Python, apesar de poderoso, é apenas uma ferramenta que permite escrever códigos expressivos e auto-documentáveis, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não garante isso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nem a conformidade com o PEP8. </font><font style="vertical-align: inherit;">Quando nossa aparentemente simples loja on-line no Django começa a ganhar dinheiro e, como resultado, aprimora os recursos, a certa altura percebemos que não é tão simples, e até mesmo fazer mudanças básicas exige cada vez mais esforço, e o mais importante, essa tendência </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">está crescendo. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que aconteceu e quando tudo deu errado?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código incorreto</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Código incorreto não é aquele que não segue o PEP8 ou não atende aos requisitos de complexidade ciclomática. </font><font style="vertical-align: inherit;">O código incorreto é, antes de tudo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dependências não controladas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que levam ao fato de que uma mudança em um local do programa leva a alterações imprevisíveis em outras partes. </font><font style="vertical-align: inherit;">Estamos perdendo o controle sobre o código; expandir a funcionalidade requer um estudo detalhado do projeto. </font><font style="vertical-align: inherit;">Esse código perde sua flexibilidade e, por assim dizer, resiste a fazer alterações, enquanto o próprio programa se torna "frágil".&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura limpa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A arquitetura escolhida do aplicativo deve evitar esse problema, e não somos os primeiros a encontrar isso: houve uma discussão na comunidade Java sobre a criação de um design de aplicativo ideal por um longo tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2000, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robert Martin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (também conhecido como tio Bob) em seu artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Principles of Design and Design</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " reuniu cinco princípios para o design de aplicativos OOP sob o memorável acrônimo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOLID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esses princípios foram bem recebidos pela comunidade e foram muito além do ecossistema Java. No entanto, eles são muito abstratos por natureza. Mais tarde, houve várias tentativas de desenvolver um design geral de aplicativo com base nos princípios do SOLID. Isso inclui: “Arquitetura hexagonal”, “Portas e adaptadores”, “Arquitetura bulbosa” e todos eles têm muito em comum, embora diferentes detalhes de implementação. E em 2012, um artigo foi publicado pelo mesmo Robert Martin, onde ele propôs sua própria versão chamada “ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura Limpa</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c32/3a9/769/c323a9769c90f4e28a17e1d5c05ab160.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com o tio Bob, a arquitetura é principalmente " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fronteiras e barreiras</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", é necessário entender claramente as necessidades e limitar as interfaces de software para não perder o controle sobre o aplicativo. Para isso, o programa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é dividido em camadas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mudando de uma camada para outra, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas os dados</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem ser transferidos </font><font style="vertical-align: inherit;">(estruturas simples e </font><font style="vertical-align: inherit;">objetos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem atuar como dados </font><font style="vertical-align: inherit;">) - essa é a regra dos limites. </font><font style="vertical-align: inherit;">Outra frase citada com mais frequência que “o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicativo deve gritar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” significa que o principal no aplicativo não é a estrutura usada ou a tecnologia de armazenamento de dados, mas o que esse aplicativo realmente faz, qual a função que ele executa - a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lógica de negócios do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aplicativo . </font><font style="vertical-align: inherit;">Portanto, as camadas não têm uma estrutura linear, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">têm uma hierarquia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Daí mais duas regras:</font></font><br>
 <br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade para a camada interna</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - é a camada interna que determina a interface através da qual ela irá interagir com o mundo exterior;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de dependência</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - As dependências devem ser direcionadas da camada interna para a externa.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A última regra é bastante atípica no mundo Python. </font><font style="vertical-align: inherit;">Para aplicar qualquer cenário complicado de lógica de negócios, você sempre precisa acessar serviços externos (por exemplo, um banco de dados), mas para evitar essa dependência, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">própria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> camada de lógica de negócios </font><b><font style="vertical-align: inherit;">deve declarar a interface</font></b><font style="vertical-align: inherit;"> pela qual interagirá com o mundo externo. </font><font style="vertical-align: inherit;">Essa técnica é chamada de " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inversão de dependência</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " (a letra D no SOLID) e é amplamente usada em idiomas com tipagem estática. </font><font style="vertical-align: inherit;">Segundo Robert Martin, esta é a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal vantagem que veio com o OOP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas três regras são a essência da arquitetura limpa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de passagem de fronteira;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de dependência;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade da camada interna.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As vantagens dessa abordagem incluem:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilidade de teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - as camadas são isoladas, respectivamente, podem ser testadas sem remendo de macacos, você pode definir granularmente o revestimento para diferentes camadas, dependendo do grau de importância;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A facilidade de alterar as regras de negócios</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , uma vez que todas elas são coletadas em um único local, não são espalhadas pelo projeto e não são misturadas ao código de baixo nível;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Independência de agentes externos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : em alguns casos, a presença de abstrações entre a lógica de negócios e o mundo externo permite alterar fontes externas sem afetar as camadas internas. </font><font style="vertical-align: inherit;">Funciona se você não vinculou a lógica de negócios aos recursos específicos de agentes externos, por exemplo, transações de banco de dados;</font></font></li>
<li><b> </b>,   ,     ,      .</li>
</ul><br>
<blockquote>     ,    .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.     «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Clean Architecture</a>».<br>
</blockquote><br>
<h2>  Python</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta é uma teoria, exemplos de aplicação prática podem ser encontrados no artigo original, relatórios e livro de Robert Martin. Eles contam com vários padrões de design comuns do mundo Java: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptador, Gateway, Interactor, Fasade, Repository, DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, e o Python? Como eu disse, o laconicismo é valorizado na comunidade Python.O que criou raízes em outros está longe do fato de que ele criará raízes conosco. A primeira vez que me virei para esse tópico há três anos, não havia muitos materiais sobre o uso da arquitetura limpa no Python, mas o primeiro link no Google foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leonardo Giordani: o autor descreve detalhadamente o processo de criação de uma API para um site de pesquisa de propriedades usando o método TDD, aplicando arquitetura limpa.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, apesar da explicação escrupulosa e de seguir todos os cânones do tio Bob, este exemplo é bastante </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assustador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A API do projeto consiste em um método - obter uma lista com um filtro disponível. Eu acho que, mesmo para um desenvolvedor iniciante, o código para esse projeto não terá mais de 15 linhas. Mas neste caso, ele pegou seis pacotes. Você pode se referir a um layout não totalmente bem-sucedido, e isso é verdade, mas, em qualquer caso, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é difícil alguém explicar a eficácia dessa abordagem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , referindo-se a este projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há um problema mais sério, se você não ler o artigo e começar imediatamente a estudar o projeto, será bastante difícil de entender. Considere a implementação da lógica de negócios:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> rentomatic.response_objects <span class="hljs-keyword">import</span> response_objects <span class="hljs-keyword">as</span> res<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>(<span class="hljs-params">object</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self, request_object</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_object:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_from_invalid_request_object(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_object)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.list(filters=request_object.filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseSuccess(rooms)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_system_error(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{}: {}"</span>.format(exc.__class__.__name__, <span class="hljs-string">"{}"</span>.format(exc)))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A classe RoomListUseCase que implementa a lógica de negócios (não muito semelhante à lógica de negócios, certo?) Do projeto é inicializado pelo objeto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mas o que é um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositório</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Claro que, a partir do contexto, podemos compreender que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementa o modelo de repositório para acessar dados, se olharmos para o corpo de RoomListUseCase, entendemos que ele deve ter um método lista, cuja entrada é uma lista de filtros, que não está claro na saída, você precisa olhar no ResponseSuccess. E se o cenário for mais complexo, com acesso múltiplo à fonte de dados? Acontece que, para entender o que é um repositório, você pode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas se referir à implementação</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas onde ela está localizada? Ele está em um módulo separado, que não está de forma alguma associado ao RoomListUseCase. Portanto, para entender o que está acontecendo, você precisa ir para o nível superior (o nível da estrutura) e ver o que é alimentado na entrada da classe ao criar o objeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode pensar que listo as desvantagens da digitação dinâmica, mas isso não é totalmente verdade. É </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a digitação dinâmica que permite escrever código expressivo e compacto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A analogia com microsserviços vem à mente: quando cortamos um monólito em microsserviços, o design ganha rigidez adicional, pois tudo pode ser feito dentro do microsserviço (PL, frameworks, arquitetura), mas deve estar em conformidade com a interface declarada. Então aqui: quando dividimos nosso projeto em camadas,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os relacionamentos entre as camadas devem ser consistentes com o contrato</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , enquanto dentro da camada, o contrato é opcional. Caso contrário, você precisa manter um contexto bastante amplo em sua cabeça. Lembre-se de que eu disse que o problema com código incorreto é dependências e, portanto, sem uma interface explícita, voltamos novamente para onde queríamos fugir - para a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausência de relacionamentos explícitos de causa-efeito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote>    <i>repo</i>     RoomListUseCase,    execute — <b>   </b>.       -    ,   ,     .     -        . ,   ,    ,  <i>repo</i>   .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, naquela época eu abandonei a Arquitetura Limpa em um novo projeto, novamente aplicando o MVC clássico. Mas, depois de preencher o próximo lote de cones, ele voltou a essa idéia um ano depois, quando finalmente começamos a lançar serviços no Python 3.5+. Como você sabe, ele trouxe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anotações de tipo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes de dados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Duas poderosas ferramentas de descrição de interface. Com base nelas, esbocei um protótipo do serviço, e o resultado já era muito melhor: as camadas pararam de se espalhar, apesar do fato de ainda haver muito código, principalmente na integração com a estrutura. Mas isso foi suficiente para começar a aplicar essa abordagem em pequenos projetos. Gradualmente, começaram a aparecer estruturas focadas no uso máximo de anotações de tipo: apistar (agora estrela), quadro de fundição. O pacote pydantic / FastAPI agora é comum e a integração com essas estruturas se tornou muito mais fácil. É assim que o exemplo acima de restomatic / services.py seria:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, List
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span>(<span class="hljs-params">BaseModel</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;code: str<font></font>
&nbsp;&nbsp;&nbsp;size: int<font></font>
&nbsp;&nbsp;&nbsp;price: int<font></font>
&nbsp;&nbsp;&nbsp;latitude: float<font></font>
&nbsp;&nbsp;&nbsp;longitude: float<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomFilter</span>(<span class="hljs-params">BaseModel</span>):</span>
&nbsp;&nbsp;&nbsp;code: Optional[str] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_min: Optional[int] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_max: Optional[int] = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomStorage</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span> ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo: RoomStorage</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoomListUseCase - uma classe que implementa a lógica de negócios do projeto. Você não deve prestar atenção ao fato de que tudo o que o método show_rooms faz é chamar o RoomStorage (eu não vim com esse exemplo). Na vida real, também pode haver um cálculo de desconto, classificando uma lista com base em anúncios etc. No entanto, o módulo é auto-suficiente. Se quisermos usar esse cenário em outro projeto, teremos que implementar o RoomStorage. E o que é necessário para isso é claramente visível desde o módulo. Diferentemente do exemplo anterior, essa camada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é auto-suficiente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, ao mudar, não é necessário manter todo o contexto em mente. De dependências não sistêmicas apenas pydantic, por que, ficará claro no plug-in da estrutura. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem dependências</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, outra maneira de melhorar a legibilidade do código, não o contexto adicional, mesmo um desenvolvedor iniciante será capaz de entender o que este módulo faz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um cenário de lógica de negócios não precisa ser uma classe; abaixo está um exemplo de cenário semelhante na forma de uma função:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rool_list_use_case</span>(<span class="hljs-params">filters: RoomFilter, repo: RoomStorage</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;rooms = repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui está a conexão com o framework:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> rentomatic <span class="hljs-keyword">import</span> services, adapters<font></font>
app = FastAPI()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_use_case</span>() -&gt; services.RoomListUseCase:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> services.RoomListUseCase(adapters.MemoryStorage())<font></font>
<font></font>
<span class="hljs-meta">@app.post("/rooms", response_model=List[services.Room])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rooms</span>(<span class="hljs-params">filters: services.RoomFilter, use_case=Depends(<span class="hljs-params">get_use_case</span>)</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> use_case.show_rooms(filters)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando a função get_use_case, o FastAPI implementa o padrão de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Injeção de Dependência</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Não precisamos nos preocupar com a serialização de dados, todo o trabalho é feito pela FastAPI em conjunto com a pydantic. Infelizmente, os dados nem sempre são formato de lógica de negócios adequado para transmissão ao vivo no restaurante &lt;e, pelo contrário, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a lógica de negócios não sabe onde os dados vieram - com barras, pedido corpo, biscoitos, etc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse caso, o corpo da função da sala terá uma certa conversão de dados de entrada e saída, mas na maioria dos casos, se trabalharmos com a API, uma função proxy tão fácil será suficiente.&nbsp;</font></font><br>
<br>
<blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>   , ,    ,    RoomStorage.  ,     15 ,     ,      ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intencionalmente, não separei a camada da lógica de negócios, como sugere o modelo canônico de Arquitetura Limpa. </font><font style="vertical-align: inherit;">A classe Room deveria estar na camada de região do domínio da entidade que representa a região do domínio, mas, para este exemplo, não há necessidade disso. </font><font style="vertical-align: inherit;">Ao combinar as camadas Entity e UseCase, o projeto não deixa de ser uma implementação de Arquitetura Limpa. </font><font style="vertical-align: inherit;">O próprio Robert Martin disse repetidamente que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">número de camadas pode variar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tanto para cima quanto para baixo. </font><font style="vertical-align: inherit;">Ao mesmo tempo, o projeto atende aos principais critérios da arquitetura limpa:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passagem de fronteira: modelos pydantic, que são essencialmente DTOs, </font><b><font style="vertical-align: inherit;">atravessam fronteiras</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de dependência</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a camada de lógica de negócios é independente de outras camadas;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade para a camada interna</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : é a camada de lógica de negócios que define a interface (RoomStorage), através da qual a lógica de negócios interage com o mundo externo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, vários projetos de nossa equipe, implementados usando a abordagem descrita, estão trabalhando no produto. </font><font style="vertical-align: inherit;">Eu tento organizar até os menores serviços dessa maneira. </font><font style="vertical-align: inherit;">Ele treina bem - perguntas sobre as quais eu não havia pensado antes surgiram. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, o que é lógica de negócios aqui? </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso está longe de ser sempre óbvio, por exemplo, se você estiver escrevendo algum tipo de proxy. </font><font style="vertical-align: inherit;">Outro ponto importante é </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprender a pensar de maneira diferente.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Quando obtemos uma tarefa, geralmente começamos a pensar nas estruturas, nos serviços utilizados, se haverá uma necessidade de uma linha aqui, onde é melhor armazenar esses dados, que podem ser armazenados em cache. Na abordagem que dita a Arquitetura Limpa, devemos primeiro implementar a lógica de negócios e só depois passar à implementação da interação com a infraestrutura, pois, segundo Robert Martin, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal tarefa da arquitetura</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é atrasar o momento em que a conexão com qualquer A camada de infraestrutura será parte integrante do seu aplicativo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, vejo uma perspectiva favorável ao uso da Arquitetura Limpa no Python. </font><font style="vertical-align: inherit;">Mas o formulário, provavelmente, será significativamente diferente de como é aceito em outros PLs. </font><font style="vertical-align: inherit;">Nos últimos anos, vi um aumento significativo no interesse pelo tópico da arquitetura na comunidade. </font><font style="vertical-align: inherit;">Portanto, no último PyCon, havia vários relatórios sobre o uso de DDD, e os funcionários dos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laboratórios a seco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devem ser anotados separadamente </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em nossa empresa, muitas equipes já estão implementando a abordagem descrita em um grau ou outro. </font><font style="vertical-align: inherit;">Estamos todos fazendo a mesma coisa, crescemos, nossos projetos cresceram, a comunidade Python tem que trabalhar com isso, definir o estilo e a linguagem comuns que, por exemplo, uma vez se tornaram para todo o Django.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt494350/index.html">Resumo de eventos on-line de março e abril</a></li>
<li><a href="../pt494354/index.html">Conhecimento e condição</a></li>
<li><a href="../pt494356/index.html">Tutorial para iniciantes no Aircrack-ng do Linux</a></li>
<li><a href="../pt494364/index.html">GDPR: consentimento para o processamento de dados pessoais</a></li>
<li><a href="../pt494366/index.html">Mitaps on-line para toda a semana, a partir de 27 de março (para back, mobile, QA, PM e tudo)</a></li>
<li><a href="../pt494372/index.html">Software de verificação totalmente russo - uma visão interna</a></li>
<li><a href="../pt494374/index.html">Ônibus elétricos e suas baterias: o que é titanato de lítio? (Parte 1)</a></li>
<li><a href="../pt494376/index.html">Buffer de profundidade hierárquica</a></li>
<li><a href="../pt494380/index.html">Introdução ao Gerenciamento Estratégico de Produtos</a></li>
<li><a href="../pt494384/index.html">Pesquisa funcional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>