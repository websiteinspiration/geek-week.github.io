<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïí üë©üèº‚Äçüç≥ üöπ Arquitetura limpa atrav√©s dos olhos de um desenvolvedor Python üë©üèæ‚Äçü§ù‚Äçüë®üèø üìû üöµüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°! Meu nome √© Eugene, sou desenvolvedor de Python. No √∫ltimo ano e meio, nossa equipe come√ßou a aplicar ativamente os princ√≠pios da Arquitetura Limp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Arquitetura limpa atrav√©s dos olhos de um desenvolvedor Python</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/exness/blog/494370/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ol√°! Meu nome √© Eugene, sou desenvolvedor de Python. No √∫ltimo ano e meio, nossa equipe come√ßou a aplicar ativamente os princ√≠pios da Arquitetura Limpa, afastando-se do modelo cl√°ssico do MVC. E hoje vou falar sobre como chegamos a isso, o que isso nos d√° e por que a transfer√™ncia direta de abordagens de outros PLs nem sempre √© uma boa solu√ß√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t_/hs/tl/t_hstlzmkevavrg4y8tazjdfu4c.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Python √© minha principal ferramenta de desenvolvimento h√° mais de sete anos. Quando me perguntam o que mais gosto nele, respondo que essa √© sua </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">excelente legibilidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O primeiro conhecido come√ßou com a leitura do livro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúProgramming a Collective Mind‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Eu estava interessado nos algoritmos descritos nele, mas todos os exemplos estavam em uma linguagem que ainda n√£o me era familiar. Isso n√£o era usual (o Python ainda n√£o era popular no aprendizado de m√°quina), as listagens eram frequentemente escritas em pseudo-c√≥digo ou usando diagramas. Mas, depois de uma r√°pida introdu√ß√£o √† linguagem, apreciei sua concis√£o: tudo era </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√°cil e claro, nada sup√©rfluo e perturbador, apenas a ess√™ncia do processo descrito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O principal m√©rito disso √© o design incr√≠vel da linguagem, o a√ß√∫car sint√°tico muito intuitivo. </font><font style="vertical-align: inherit;">Essa expressividade sempre foi apreciada na comunidade. </font><font style="vertical-align: inherit;">O que √© " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importar isso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", necessariamente presente nas primeiras p√°ginas de qualquer livro: parece um superintendente invis√≠vel, avalia constantemente suas a√ß√µes. </font><font style="vertical-align: inherit;">Nos f√≥runs, valia a pena para um iniciante usar de alguma forma o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CamelCase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no nome da vari√°vel na listagem; assim, imediatamente o √¢ngulo de discuss√£o mudou para o idioma do c√≥digo proposto com refer√™ncias ao PEP8.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A busca pela eleg√¢ncia e o poderoso dinamismo da linguagem criaram muitas bibliotecas com uma API verdadeiramente deliciosa.&nbsp;</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o Python, apesar de poderoso, √© apenas uma ferramenta que permite escrever c√≥digos expressivos e auto-document√°veis, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o garante isso</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nem a conformidade com o PEP8. </font><font style="vertical-align: inherit;">Quando nossa aparentemente simples loja on-line no Django come√ßa a ganhar dinheiro e, como resultado, aprimora os recursos, a certa altura percebemos que n√£o √© t√£o simples, e at√© mesmo fazer mudan√ßas b√°sicas exige cada vez mais esfor√ßo, e o mais importante, essa tend√™ncia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° crescendo. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que aconteceu e quando tudo deu errado?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo incorreto</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo incorreto n√£o √© aquele que n√£o segue o PEP8 ou n√£o atende aos requisitos de complexidade ciclom√°tica. </font><font style="vertical-align: inherit;">O c√≥digo incorreto √©, antes de tudo, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depend√™ncias n√£o controladas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que levam ao fato de que uma mudan√ßa em um local do programa leva a altera√ß√µes imprevis√≠veis em outras partes. </font><font style="vertical-align: inherit;">Estamos perdendo o controle sobre o c√≥digo; expandir a funcionalidade requer um estudo detalhado do projeto. </font><font style="vertical-align: inherit;">Esse c√≥digo perde sua flexibilidade e, por assim dizer, resiste a fazer altera√ß√µes, enquanto o pr√≥prio programa se torna "fr√°gil".&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura limpa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A arquitetura escolhida do aplicativo deve evitar esse problema, e n√£o somos os primeiros a encontrar isso: houve uma discuss√£o na comunidade Java sobre a cria√ß√£o de um design de aplicativo ideal por um longo tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2000, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robert Martin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (tamb√©m conhecido como tio Bob) em seu artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Principles of Design and Design</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " reuniu cinco princ√≠pios para o design de aplicativos OOP sob o memor√°vel acr√¥nimo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOLID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esses princ√≠pios foram bem recebidos pela comunidade e foram muito al√©m do ecossistema Java. No entanto, eles s√£o muito abstratos por natureza. Mais tarde, houve v√°rias tentativas de desenvolver um design geral de aplicativo com base nos princ√≠pios do SOLID. Isso inclui: ‚ÄúArquitetura hexagonal‚Äù, ‚ÄúPortas e adaptadores‚Äù, ‚ÄúArquitetura bulbosa‚Äù e todos eles t√™m muito em comum, embora diferentes detalhes de implementa√ß√£o. E em 2012, um artigo foi publicado pelo mesmo Robert Martin, onde ele prop√¥s sua pr√≥pria vers√£o chamada ‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitetura Limpa</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c32/3a9/769/c323a9769c90f4e28a17e1d5c05ab160.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com o tio Bob, a arquitetura √© principalmente " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fronteiras e barreiras</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", √© necess√°rio entender claramente as necessidades e limitar as interfaces de software para n√£o perder o controle sobre o aplicativo. Para isso, o programa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© dividido em camadas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mudando de uma camada para outra, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas os dados</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem ser transferidos </font><font style="vertical-align: inherit;">(estruturas simples e </font><font style="vertical-align: inherit;">objetos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem atuar como dados </font><font style="vertical-align: inherit;">) - essa √© a regra dos limites. </font><font style="vertical-align: inherit;">Outra frase citada com mais frequ√™ncia que ‚Äúo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicativo deve gritar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù significa que o principal no aplicativo n√£o √© a estrutura usada ou a tecnologia de armazenamento de dados, mas o que esse aplicativo realmente faz, qual a fun√ß√£o que ele executa - a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√≥gica de neg√≥cios do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aplicativo . </font><font style="vertical-align: inherit;">Portanto, as camadas n√£o t√™m uma estrutura linear, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√™m uma hierarquia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Da√≠ mais duas regras:</font></font><br>
 <br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade para a camada interna</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √© a camada interna que determina a interface atrav√©s da qual ela ir√° interagir com o mundo exterior;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de depend√™ncia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - As depend√™ncias devem ser direcionadas da camada interna para a externa.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A √∫ltima regra √© bastante at√≠pica no mundo Python. </font><font style="vertical-align: inherit;">Para aplicar qualquer cen√°rio complicado de l√≥gica de neg√≥cios, voc√™ sempre precisa acessar servi√ßos externos (por exemplo, um banco de dados), mas para evitar essa depend√™ncia, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥pria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> camada de l√≥gica de neg√≥cios </font><b><font style="vertical-align: inherit;">deve declarar a interface</font></b><font style="vertical-align: inherit;"> pela qual interagir√° com o mundo externo. </font><font style="vertical-align: inherit;">Essa t√©cnica √© chamada de " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invers√£o de depend√™ncia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " (a letra D no SOLID) e √© amplamente usada em idiomas com tipagem est√°tica. </font><font style="vertical-align: inherit;">Segundo Robert Martin, esta √© a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal vantagem que veio com o OOP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas tr√™s regras s√£o a ess√™ncia da arquitetura limpa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de passagem de fronteira;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de depend√™ncia;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade da camada interna.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As vantagens dessa abordagem incluem:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facilidade de teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - as camadas s√£o isoladas, respectivamente, podem ser testadas sem remendo de macacos, voc√™ pode definir granularmente o revestimento para diferentes camadas, dependendo do grau de import√¢ncia;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A facilidade de alterar as regras de neg√≥cios</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , uma vez que todas elas s√£o coletadas em um √∫nico local, n√£o s√£o espalhadas pelo projeto e n√£o s√£o misturadas ao c√≥digo de baixo n√≠vel;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Independ√™ncia de agentes externos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : em alguns casos, a presen√ßa de abstra√ß√µes entre a l√≥gica de neg√≥cios e o mundo externo permite alterar fontes externas sem afetar as camadas internas. </font><font style="vertical-align: inherit;">Funciona se voc√™ n√£o vinculou a l√≥gica de neg√≥cios aos recursos espec√≠ficos de agentes externos, por exemplo, transa√ß√µes de banco de dados;</font></font></li>
<li><b> </b>,   ,     ,      .</li>
</ul><br>
<blockquote>     ,    .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>.     ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Clean Architecture</a>¬ª.<br>
</blockquote><br>
<h2>  Python</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma teoria, exemplos de aplica√ß√£o pr√°tica podem ser encontrados no artigo original, relat√≥rios e livro de Robert Martin. Eles contam com v√°rios padr√µes de design comuns do mundo Java: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptador, Gateway, Interactor, Fasade, Repository, DTO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, e o Python? Como eu disse, o laconicismo √© valorizado na comunidade Python.O que criou ra√≠zes em outros est√° longe do fato de que ele criar√° ra√≠zes conosco. A primeira vez que me virei para esse t√≥pico h√° tr√™s anos, n√£o havia muitos materiais sobre o uso da arquitetura limpa no Python, mas o primeiro link no Google foi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o projeto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leonardo Giordani: o autor descreve detalhadamente o processo de cria√ß√£o de uma API para um site de pesquisa de propriedades usando o m√©todo TDD, aplicando arquitetura limpa.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, apesar da explica√ß√£o escrupulosa e de seguir todos os c√¢nones do tio Bob, este exemplo √© bastante </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assustador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A API do projeto consiste em um m√©todo - obter uma lista com um filtro dispon√≠vel. Eu acho que, mesmo para um desenvolvedor iniciante, o c√≥digo para esse projeto n√£o ter√° mais de 15 linhas. Mas neste caso, ele pegou seis pacotes. Voc√™ pode se referir a um layout n√£o totalmente bem-sucedido, e isso √© verdade, mas, em qualquer caso, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© dif√≠cil algu√©m explicar a efic√°cia dessa abordagem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , referindo-se a este projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um problema mais s√©rio, se voc√™ n√£o ler o artigo e come√ßar imediatamente a estudar o projeto, ser√° bastante dif√≠cil de entender. Considere a implementa√ß√£o da l√≥gica de neg√≥cios:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> rentomatic.response_objects <span class="hljs-keyword">import</span> response_objects <span class="hljs-keyword">as</span> res<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>(<span class="hljs-params">object</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self, request_object</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_object:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_from_invalid_request_object(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_object)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.list(filters=request_object.filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseSuccess(rooms)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> res.ResponseFailure.build_system_error(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-string">"{}: {}"</span>.format(exc.__class__.__name__, <span class="hljs-string">"{}"</span>.format(exc)))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A classe RoomListUseCase que implementa a l√≥gica de neg√≥cios (n√£o muito semelhante √† l√≥gica de neg√≥cios, certo?) Do projeto √© inicializado pelo objeto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mas o que √© um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reposit√≥rio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? Claro que, a partir do contexto, podemos compreender que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementa o modelo de reposit√≥rio para acessar dados, se olharmos para o corpo de RoomListUseCase, entendemos que ele deve ter um m√©todo lista, cuja entrada √© uma lista de filtros, que n√£o est√° claro na sa√≠da, voc√™ precisa olhar no ResponseSuccess. E se o cen√°rio for mais complexo, com acesso m√∫ltiplo √† fonte de dados? Acontece que, para entender o que √© um reposit√≥rio, voc√™ pode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas se referir √† implementa√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas onde ela est√° localizada? Ele est√° em um m√≥dulo separado, que n√£o est√° de forma alguma associado ao RoomListUseCase. Portanto, para entender o que est√° acontecendo, voc√™ precisa ir para o n√≠vel superior (o n√≠vel da estrutura) e ver o que √© alimentado na entrada da classe ao criar o objeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode pensar que listo as desvantagens da digita√ß√£o din√¢mica, mas isso n√£o √© totalmente verdade. √â </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a digita√ß√£o din√¢mica que permite escrever c√≥digo expressivo e compacto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A analogia com microsservi√ßos vem √† mente: quando cortamos um mon√≥lito em microsservi√ßos, o design ganha rigidez adicional, pois tudo pode ser feito dentro do microsservi√ßo (PL, frameworks, arquitetura), mas deve estar em conformidade com a interface declarada. Ent√£o aqui: quando dividimos nosso projeto em camadas,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os relacionamentos entre as camadas devem ser consistentes com o contrato</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , enquanto dentro da camada, o contrato √© opcional. Caso contr√°rio, voc√™ precisa manter um contexto bastante amplo em sua cabe√ßa. Lembre-se de que eu disse que o problema com c√≥digo incorreto √© depend√™ncias e, portanto, sem uma interface expl√≠cita, voltamos novamente para onde quer√≠amos fugir - para a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aus√™ncia de relacionamentos expl√≠citos de causa-efeito</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote>    <i>repo</i>     RoomListUseCase,    execute ‚Äî <b>   </b>.       -    ,   ,     .     -        . ,   ,    ,  <i>repo</i>   .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, naquela √©poca eu abandonei a Arquitetura Limpa em um novo projeto, novamente aplicando o MVC cl√°ssico. Mas, depois de preencher o pr√≥ximo lote de cones, ele voltou a essa id√©ia um ano depois, quando finalmente come√ßamos a lan√ßar servi√ßos no Python 3.5+. Como voc√™ sabe, ele trouxe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anota√ß√µes de tipo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classes de dados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Duas poderosas ferramentas de descri√ß√£o de interface. Com base nelas, esbocei um prot√≥tipo do servi√ßo, e o resultado j√° era muito melhor: as camadas pararam de se espalhar, apesar do fato de ainda haver muito c√≥digo, principalmente na integra√ß√£o com a estrutura. Mas isso foi suficiente para come√ßar a aplicar essa abordagem em pequenos projetos. Gradualmente, come√ßaram a aparecer estruturas focadas no uso m√°ximo de anota√ß√µes de tipo: apistar (agora estrela), quadro de fundi√ß√£o. O pacote pydantic / FastAPI agora √© comum e a integra√ß√£o com essas estruturas se tornou muito mais f√°cil. √â assim que o exemplo acima de restomatic / services.py seria:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, List
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span>(<span class="hljs-params">BaseModel</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;code: str<font></font>
&nbsp;&nbsp;&nbsp;size: int<font></font>
&nbsp;&nbsp;&nbsp;price: int<font></font>
&nbsp;&nbsp;&nbsp;latitude: float<font></font>
&nbsp;&nbsp;&nbsp;longitude: float<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomFilter</span>(<span class="hljs-params">BaseModel</span>):</span>
&nbsp;&nbsp;&nbsp;code: Optional[str] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_min: Optional[int] = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;price_max: Optional[int] = <span class="hljs-literal">None</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomStorage</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span> ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoomListUseCase</span>:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, repo: RoomStorage</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.repo = repo<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_rooms</span>(<span class="hljs-params">self, filters: RoomFilter</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rooms = self.repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RoomListUseCase - uma classe que implementa a l√≥gica de neg√≥cios do projeto. Voc√™ n√£o deve prestar aten√ß√£o ao fato de que tudo o que o m√©todo show_rooms faz √© chamar o RoomStorage (eu n√£o vim com esse exemplo). Na vida real, tamb√©m pode haver um c√°lculo de desconto, classificando uma lista com base em an√∫ncios etc. No entanto, o m√≥dulo √© auto-suficiente. Se quisermos usar esse cen√°rio em outro projeto, teremos que implementar o RoomStorage. E o que √© necess√°rio para isso √© claramente vis√≠vel desde o m√≥dulo. Diferentemente do exemplo anterior, essa camada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© auto-suficiente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, ao mudar, n√£o √© necess√°rio manter todo o contexto em mente. De depend√™ncias n√£o sist√™micas apenas pydantic, por que, ficar√° claro no plug-in da estrutura. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sem depend√™ncias</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, outra maneira de melhorar a legibilidade do c√≥digo, n√£o o contexto adicional, mesmo um desenvolvedor iniciante ser√° capaz de entender o que este m√≥dulo faz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um cen√°rio de l√≥gica de neg√≥cios n√£o precisa ser uma classe; abaixo est√° um exemplo de cen√°rio semelhante na forma de uma fun√ß√£o:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rool_list_use_case</span>(<span class="hljs-params">filters: RoomFilter, repo: RoomStorage</span>) -&gt; List[Room]:</span><font></font>
&nbsp;&nbsp;&nbsp;rooms = repo.get_rooms(filters=filters)<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> rooms</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui est√° a conex√£o com o framework:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> rentomatic <span class="hljs-keyword">import</span> services, adapters<font></font>
app = FastAPI()<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_use_case</span>() -&gt; services.RoomListUseCase:</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> services.RoomListUseCase(adapters.MemoryStorage())<font></font>
<font></font>
<span class="hljs-meta">@app.post("/rooms", response_model=List[services.Room])</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rooms</span>(<span class="hljs-params">filters: services.RoomFilter, use_case=Depends(<span class="hljs-params">get_use_case</span>)</span>):</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> use_case.show_rooms(filters)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando a fun√ß√£o get_use_case, o FastAPI implementa o padr√£o de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inje√ß√£o de Depend√™ncia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o precisamos nos preocupar com a serializa√ß√£o de dados, todo o trabalho √© feito pela FastAPI em conjunto com a pydantic. Infelizmente, os dados nem sempre s√£o formato de l√≥gica de neg√≥cios adequado para transmiss√£o ao vivo no restaurante &lt;e, pelo contr√°rio, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a l√≥gica de neg√≥cios n√£o sabe onde os dados vieram - com barras, pedido corpo, biscoitos, etc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse caso, o corpo da fun√ß√£o da sala ter√° uma certa convers√£o de dados de entrada e sa√≠da, mas na maioria dos casos, se trabalharmos com a API, uma fun√ß√£o proxy t√£o f√°cil ser√° suficiente.&nbsp;</font></font><br>
<br>
<blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>   , ,    ,    RoomStorage.  ,     15 ,     ,      ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intencionalmente, n√£o separei a camada da l√≥gica de neg√≥cios, como sugere o modelo can√¥nico de Arquitetura Limpa. </font><font style="vertical-align: inherit;">A classe Room deveria estar na camada de regi√£o do dom√≠nio da entidade que representa a regi√£o do dom√≠nio, mas, para este exemplo, n√£o h√° necessidade disso. </font><font style="vertical-align: inherit;">Ao combinar as camadas Entity e UseCase, o projeto n√£o deixa de ser uma implementa√ß√£o de Arquitetura Limpa. </font><font style="vertical-align: inherit;">O pr√≥prio Robert Martin disse repetidamente que o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de camadas pode variar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tanto para cima quanto para baixo. </font><font style="vertical-align: inherit;">Ao mesmo tempo, o projeto atende aos principais crit√©rios da arquitetura limpa:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passagem de fronteira: modelos pydantic, que s√£o essencialmente DTOs, </font><b><font style="vertical-align: inherit;">atravessam fronteiras</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regra de depend√™ncia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a camada de l√≥gica de neg√≥cios √© independente de outras camadas;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A regra de prioridade para a camada interna</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : √© a camada de l√≥gica de neg√≥cios que define a interface (RoomStorage), atrav√©s da qual a l√≥gica de neg√≥cios interage com o mundo externo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, v√°rios projetos de nossa equipe, implementados usando a abordagem descrita, est√£o trabalhando no produto. </font><font style="vertical-align: inherit;">Eu tento organizar at√© os menores servi√ßos dessa maneira. </font><font style="vertical-align: inherit;">Ele treina bem - perguntas sobre as quais eu n√£o havia pensado antes surgiram. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, o que √© l√≥gica de neg√≥cios aqui? </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso est√° longe de ser sempre √≥bvio, por exemplo, se voc√™ estiver escrevendo algum tipo de proxy. </font><font style="vertical-align: inherit;">Outro ponto importante √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprender a pensar de maneira diferente.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Quando obtemos uma tarefa, geralmente come√ßamos a pensar nas estruturas, nos servi√ßos utilizados, se haver√° uma necessidade de uma linha aqui, onde √© melhor armazenar esses dados, que podem ser armazenados em cache. Na abordagem que dita a Arquitetura Limpa, devemos primeiro implementar a l√≥gica de neg√≥cios e s√≥ depois passar √† implementa√ß√£o da intera√ß√£o com a infraestrutura, pois, segundo Robert Martin, a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal tarefa da arquitetura</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© atrasar o momento em que a conex√£o com qualquer A camada de infraestrutura ser√° parte integrante do seu aplicativo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, vejo uma perspectiva favor√°vel ao uso da Arquitetura Limpa no Python. </font><font style="vertical-align: inherit;">Mas o formul√°rio, provavelmente, ser√° significativamente diferente de como √© aceito em outros PLs. </font><font style="vertical-align: inherit;">Nos √∫ltimos anos, vi um aumento significativo no interesse pelo t√≥pico da arquitetura na comunidade. </font><font style="vertical-align: inherit;">Portanto, no √∫ltimo PyCon, havia v√°rios relat√≥rios sobre o uso de DDD, e os funcion√°rios dos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laborat√≥rios a seco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devem ser anotados separadamente </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Em nossa empresa, muitas equipes j√° est√£o implementando a abordagem descrita em um grau ou outro. </font><font style="vertical-align: inherit;">Estamos todos fazendo a mesma coisa, crescemos, nossos projetos cresceram, a comunidade Python tem que trabalhar com isso, definir o estilo e a linguagem comuns que, por exemplo, uma vez se tornaram para todo o Django.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt494350/index.html">Resumo de eventos on-line de mar√ßo e abril</a></li>
<li><a href="../pt494354/index.html">Conhecimento e condi√ß√£o</a></li>
<li><a href="../pt494356/index.html">Tutorial para iniciantes no Aircrack-ng do Linux</a></li>
<li><a href="../pt494364/index.html">GDPR: consentimento para o processamento de dados pessoais</a></li>
<li><a href="../pt494366/index.html">Mitaps on-line para toda a semana, a partir de 27 de mar√ßo (para back, mobile, QA, PM e tudo)</a></li>
<li><a href="../pt494372/index.html">Software de verifica√ß√£o totalmente russo - uma vis√£o interna</a></li>
<li><a href="../pt494374/index.html">√înibus el√©tricos e suas baterias: o que √© titanato de l√≠tio? (Parte 1)</a></li>
<li><a href="../pt494376/index.html">Buffer de profundidade hier√°rquica</a></li>
<li><a href="../pt494380/index.html">Introdu√ß√£o ao Gerenciamento Estrat√©gico de Produtos</a></li>
<li><a href="../pt494384/index.html">Pesquisa funcional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>