<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§“ğŸ» ğŸ‘ŒğŸ» ğŸ‘†ğŸ¼ Blendingå’ŒUnity Terrainï¼šå¦‚ä½•æ‘†è„±äº¤å‰ç‚¹å¹¶åœæ­¢ä½¿çœ¼ç›å—ä¼¤ ğŸ‘©â€ğŸ¨ ğŸ€ ğŸ‘¨ğŸ¼â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ºäº†åœ¨æ¸¸æˆä¸­è·å¾—é€¼çœŸçš„ä¸–ç•Œï¼Œæœ‰å¿…è¦è€ƒè™‘å„ç§åœ°å½¢ç›¸äº’ä¹‹é—´ä»¥åŠä¸å…¶ä»–æ¨¡å‹ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚è€Œä¸”ï¼Œå¦‚æœ3Dæ¨¡å‹ä¹‹é—´çš„å¯è§ç›¸äº¤çº¿ç ´åäº†å›¾åƒçš„å®Œæ•´æ€§ï¼Œåˆ™å€¼å¾—è€ƒè™‘å¦‚ä½•æ¶ˆé™¤å®ƒä»¬ã€‚è¿™ç§çº¿æ¡æœ€å¸¸è§çš„æƒ…å†µï¼ˆå¯èƒ½ä¸ºè®¸å¤šäººæ‰€ç†Ÿæ‚‰ï¼‰æ˜¯å…·æœ‰ä¸é€æ˜å‡ ä½•å½¢çŠ¶çš„ç²’å­çš„å¹¿å‘Šç‰Œçš„äº¤é›†ã€‚
 
 
 
 å¦ä¸€ä¸ªä¾‹å­æ˜¯åœ¨â€œå®¤å¤–â€åœºæ™¯ä¸­ï¼Œå²©çŸ³å’Œæ¤...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blendingå’ŒUnity Terrainï¼šå¦‚ä½•æ‘†è„±äº¤å‰ç‚¹å¹¶åœæ­¢ä½¿çœ¼ç›å—ä¼¤</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/490226/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†åœ¨æ¸¸æˆä¸­è·å¾—é€¼çœŸçš„ä¸–ç•Œï¼Œæœ‰å¿…è¦è€ƒè™‘å„ç§åœ°å½¢ç›¸äº’ä¹‹é—´ä»¥åŠä¸å…¶ä»–æ¨¡å‹ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œå¦‚æœ3Dæ¨¡å‹ä¹‹é—´çš„å¯è§ç›¸äº¤çº¿ç ´åäº†å›¾åƒçš„å®Œæ•´æ€§ï¼Œåˆ™å€¼å¾—è€ƒè™‘å¦‚ä½•æ¶ˆé™¤å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">è¿™ç§çº¿æ¡æœ€å¸¸è§çš„æƒ…å†µï¼ˆå¯èƒ½ä¸ºè®¸å¤šäººæ‰€ç†Ÿæ‚‰ï¼‰æ˜¯å…·æœ‰ä¸é€æ˜å‡ ä½•å½¢çŠ¶çš„ç²’å­çš„å¹¿å‘Šç‰Œçš„äº¤é›†ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ja/va/g2/javag2i9gc9lhkwohebgbyklsjc.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦ä¸€ä¸ªä¾‹å­æ˜¯åœ¨â€œå®¤å¤–â€åœºæ™¯ä¸­ï¼Œå²©çŸ³å’Œæ¤è¢«ä¸æ™¯è§‚è¡¨é¢çš„äº¤æ±‡å¤„ä»¤äººä¸å®‰çš„è‡ªç„¶æˆåˆ†ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/v0/k6/s9/v0k6s98hdon17qotuaryat0vogs.png" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†å„ç§å¹³æ»‘æ–¹æ³•ï¼ˆSSAAï¼ŒMSAAï¼ŒCSAAï¼ŒFXAAï¼ŒNFAAï¼ŒCMAAï¼ŒDLAAï¼ŒTAAç­‰ï¼‰ï¼Œè¿™äº›æ–¹æ³•è™½ç„¶å¯ä»¥ç¼“è§£è¿™ç§ç›¸äº¤çº¿çš„åæ„Ÿï¼Œä½†ä¸èƒ½å®Œå…¨çº æ­£è¿™ç§æƒ…å†µï¼Œä½†è¿˜æœ‰æ›´æœ‰æ•ˆçš„æŠ€æœ¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†è€ƒè™‘å®ƒä»¬ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·±åº¦èåˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unityæœ‰ä¸€ä¸ªå†…ç½®è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥æ¶ˆé™¤é€æ˜ç²’å­å’Œç§°ä¸ºè½¯ç²’å­çš„ä¸é€æ˜å‡ ä½•ä¹‹é—´çš„å¯è§ç›¸äº¤ã€‚</font><font style="vertical-align: inherit;">æ”¯æŒæ­¤æ•ˆæœçš„ç€è‰²å™¨è¿›ä¸€æ­¥æé«˜äº†ç²’å­çš„é€æ˜åº¦ï¼Œå…·ä½“å–å†³äºç²’å­ç‰‡æ®µçš„æ·±åº¦ä¸ä¸é€æ˜å‡ ä½•ä½“çš„æ·±åº¦ä¹‹é—´çš„å·®å¼‚æœ‰å¤šå°ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mz/wx/9k/mzwx9kecz9hkjps0laijveek-54.png" alt="å›¾ç‰‡"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½¯ç²’å­çš„æ“ä½œåŸç†</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ˜¾ç„¶ï¼Œä¸ºäº†æ­£ç¡®æ“ä½œè½¯ç²’å­ï¼Œéœ€è¦æ·±åº¦ç¼“å†²åŒºã€‚</font><font style="vertical-align: inherit;">åœ¨å»¶è¿Ÿç€è‰²çš„æƒ…å†µä¸‹ï¼Œæ·±åº¦ç¼“å†²åŒºæ˜¯åœ¨æ¸²æŸ“å…¨å±ç¼“å†²åŒºçš„é˜¶æ®µå½¢æˆçš„ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°MRTï¼ˆå¤šä¸ªæ¸²æŸ“ç›®æ ‡ï¼Œè€Œä¸æ˜¯ç£å…±æŒ¯æ–­å±‚æ‰«æï¼‰ï¼Œå…¶å­˜åœ¨æ²¡æœ‰ç”¨é¢å¤–çš„è®¡ç®—æˆæœ¬æ¥è¡¨ç¤ºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å‰å‘é˜´å½±å’Œä½¿ç”¨Unity Legacy Pipelineçš„æƒ…å†µä¸‹ï¼Œéœ€è¦é¢å¤–çš„éå†æ‰èƒ½å°†ä¸é€æ˜çš„å‡ ä½•ä½“å‘ˆç°åˆ°æ·±åº¦ç¼“å†²åŒº</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡å°†é€‚å½“çš„å€¼åˆ†é…ç»™Camera.depthTextureModeå±æ€§æ¥æ¿€æ´»æ­¤è¿‡ç¨‹ã€‚</font><font style="vertical-align: inherit;">è¯¥å±æ€§åœ¨æ£€æŸ¥å™¨çª—å£ä¸­ä¸å¯ç”¨ï¼Œä½†åœ¨API </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2]ä¸­</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ç”¨</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­£å‘é˜´å½±å®ç°è‡ªå·±çš„Scriptable Render Pipelineç‰ˆæœ¬ï¼Œå€ŸåŠ©MRTï¼Œå®ƒå¯ä»¥åŒæ—¶æ¸²æŸ“æ·±åº¦ç¼“å†²åŒºå’Œé¢œè‰²ç¼“å†²åŒºã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7z/-b/1l/7z-b1lg9zs8xbsywe6evbmanfiw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¶ˆé™¤æ”¯æŒè½¯ç²’å­çš„ç€è‰²å™¨ä¸­çš„ç›¸äº¤çº¿</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
é€šå¸¸ï¼Œä½¿ç”¨æ·±åº¦èåˆæ–¹æ³•æ¶ˆé™¤3Dæ¨¡å‹ä¸æ™¯è§‚çš„å¯è§ç›¸äº¤æ²¡æœ‰æŠ€æœ¯éšœç¢ï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="css hljs">// <span class="hljs-selector-tag">Blending</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">depth</span> <span class="hljs-selector-tag">buffer</span><font></font>
<font></font>
<span class="hljs-selector-id">#include</span> "<span class="hljs-selector-tag">UnityCG</span><span class="hljs-selector-class">.cginc</span>"<font></font>
<font></font>
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendStart</span>;
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendEnd</span>;
<span class="hljs-selector-tag">UNITY_DECLARE_DEPTH_TEXTURE</span>(_<span class="hljs-selector-tag">CameraDepthTexture</span>);<font></font>
<font></font>
<span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">v2f</span><font></font>
{<font></font>
    // ...<font></font>
<font></font>
    half4 <span class="hljs-attribute">projPos </span>: TEXCOORD0;<font></font>
};<font></font>
<font></font>
<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">vert</span>(<span class="hljs-selector-tag">appdata</span> <span class="hljs-selector-tag">v</span>)<font></font>
{<font></font>
    v2f o;<font></font>
    UNITY_INITIALIZE_OUTPUT(v2f,o);<font></font>
<font></font>
    // ...<font></font>
<font></font>
    o.projPos = ComputeScreenPos(o.pos);<font></font>
    COMPUTE_EYEDEPTH(o.projPos.z);<font></font>
<font></font>
    // ...<font></font>
<font></font>
    return o;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">fixed4</span> <span class="hljs-selector-tag">frag</span>(<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">i</span>) : <span class="hljs-selector-tag">COLOR</span><font></font>
{     <font></font>
    fixed4 result = 0;<font></font>
      <font></font>
    // ... <font></font>
<font></font>
    float depth = SAMPLE_DEPTH_TEXTURE_PROJ(_CameraDepthTexture, UNITY_PROJ_COORD(i.projPos));<font></font>
    float sceneZ = LinearEyeDepth(depth);<font></font>
    float partZ = i.projPos.z;<font></font>
    float fade = saturate( sceneZ - partZ );<font></font>
    result.a = smoothstep( BlendStart, BlendEnd, fade );<font></font>
<font></font>
    // ... <font></font>
       <font></font>
    return result; <font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬ä¸€ä¸ªç¼ºç‚¹ä¸æ€§èƒ½æœ‰å…³ã€‚æ·±åº¦æ··åˆåœ¨ç¡¬ä»¶ç®¡é“æ··åˆé˜¶æ®µå³ç‰‡æ®µç€è‰²å™¨çš„æ …æ ¼åŒ–å’Œè®¡ç®—ä¹‹åç«‹å³èµ·ä½œç”¨ã€‚åœ¨æ­¤é˜¶æ®µï¼Œ</font><font style="vertical-align: inherit;">æ ¹æ®å¯¹API </font><sup><font style="vertical-align: inherit;">[6] [7] [8] [9]</font></sup><font style="vertical-align: inherit;">çš„è°ƒç”¨é¢„å®šä¹‰çš„å…¬å¼</font><font style="vertical-align: inherit;">ï¼Œå°†ç‰‡æ®µç€è‰²å™¨çš„æ‰§è¡Œç»“æœä¸è®°å½•åœ¨è¾“å‡ºç¼“å†²åŒº</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] [4] [5]ä¸­</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç»“æœæ··åˆ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å®Œå…¨åƒå…¶20å¹´å‰çš„å·¥ä½œä¸€æ ·ï¼Œè¿™æ˜¯æ‰€æœ‰ç¡¬ä»¶ç®¡é“ä¸­è¿›å±•æœ€å°‘çš„éƒ¨åˆ†ã€‚ GPUä»å†…å­˜è¯»å–å€¼ï¼Œå°†å…¶ä¸ç‰‡æ®µç€è‰²å™¨çš„å€¼æ··åˆï¼Œç„¶åå°†å…¶å†™å›å†…å­˜ã€‚</font></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºå®Œå…¨é€æ˜æˆ–éƒ¨åˆ†é€æ˜çš„3Dæ¨¡å‹ï¼Œä½¿ç”¨æ·±åº¦èåˆè¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚é€æ˜-ä¾‹å¦‚ï¼Œç²’å­å¹¿å‘Šç‰Œ-å³ä½¿æ²¡æœ‰æ·±åº¦èåˆï¼Œæ•´ä¸ªæ¸²æŸ“ä¹Ÿæ˜¯é€æ˜çš„ã€‚å¯¹äºä¸é€æ˜çš„3Dæ¨¡å‹ï¼Œåœ¨æ·±åº¦èåˆæ—¶ï¼ŒçœŸå®ï¼Œæœ‰å½¢ï¼Œå¯è§çš„é€æ˜åº¦å°†åªå…·æœ‰éå¸¸å°‘é‡çš„ç‰‡æ®µï¼Œè€Œå¤§å¤šæ•°ç‰‡æ®µå°†ä¿æŒä¸é€æ˜ã€‚ä½†æ˜¯åè€…å®Œå…¨ä¸æ„å‘³ç€æ··åˆå°†ä¸ä¼šç”¨äºæ¸²æŸ“-å®ƒå°†åªæ˜¯é—²ç½®å·¥ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬äºŒä¸ªç¼ºç‚¹ä¸å¦‚ä½•é€‰æ‹©ç”¨äºæ··åˆçš„é¢œè‰²æœ‰å…³ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç„¶åæ··åˆåœ¨ç‰¹å®šå±å¹•åƒç´ ä¸­çš„æ‰€æœ‰ç‰‡æ®µéƒ½ä½äºä»ç›¸æœºçš„ä¸–ç•Œä½ç½®å‘å‡ºå¹¶ç©¿è¿‡æ­¤å±å¹•åƒç´ çš„ä¸–ç•Œä½ç½®çš„ä¸€æ¡å…‰çº¿ä¸Šã€‚åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€åœ¨ç›¸æœºä½ç½®æˆ–æ–¹å‘å‘ç”Ÿä»»ä½•å˜åŒ–æ—¶ï¼Œéƒ½å°†è§‚å¯Ÿåˆ°è§†å·®ï¼šé è¿‘ç›¸æœºçš„3Dæ¨¡å‹ç‰‡æ®µçš„ç§»åŠ¨é€Ÿåº¦å°†æ¯”è·ç¦»ç›¸æœºè¾ƒè¿œçš„æ™¯è§‚ç‰‡æ®µçš„ç§»åŠ¨é€Ÿåº¦æ›´å¿«</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[10] [11]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ä»è¿‘è·ç¦»è§‚çœ‹æ—¶ï¼Œæ‘„åƒæœºçš„æ¨ªå‘ä½ç§»æ’å®šï¼Œè¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hz/sc/78/hzsc78n3vvddbvvlgrb3hqkfwxc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨ç›¸æœºæ—¶çš„æ¨ªå‘è§†å·®ï¼šä¸æ™¯è§‚ç‰‡æ®µç›¸æ¯”ï¼Œ3Dæ¨¡å‹çš„ç‰‡æ®µç§»åŠ¨çš„è·ç¦»æ›´å¤§</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/5v/zf/wj/5vzfwjmabznaiprchenxb9eqy3q.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§»åŠ¨ç›¸æœºæ—¶çš„æ¨ªå‘è§†å·®ï¼šå°†ç›¸æœºå›ºå®šåœ¨æ™¯è§‚ç‰‡æ®µä¸Šæ—¶ï¼Œæ¨¡å‹ç‰‡æ®µçš„ç§»åŠ¨é€Ÿåº¦éå¸¸æ˜æ˜¾</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ï¼›æ—‹è½¬ç›¸æœºæ—¶ï¼Œä¼šæ²¿å±å¹•åæ ‡çš„ä¸¤ä¸ªè½´ç«‹å³è§‚å¯Ÿåˆ°è§†å·®ã€‚ä½†æ˜¯ï¼Œåœ¨åŠ¨åŠ›å­¦ä¸­ï¼Œè¿™ä¸å¦‚æ¨ªå‘è§†å·®æ˜æ˜¾ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/ew/jn/qsewjnfucpdriai47zh9032fwcm.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸æœºç§»åŠ¨æ—¶çš„æ–¹ä½è§’è§†å·®ï¼šå½“ç¢ç‰‡æ²¿ä¸¤ä¸ª</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
è½´</font><i><font style="vertical-align: inherit;">ç§»åŠ¨æ—¶ï¼Œå¤§è„‘æ›´éš¾è¯†åˆ«è§†å·®æ¨¡å¼ï¼Œä½†</font></i><font style="vertical-align: inherit;">æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ·±åº¦æ··åˆçš„å¤–è§‚å–å†³äºè§‚å¯Ÿè€…è§‚å¯Ÿé£æ™¯çš„è§’åº¦è€Œå˜åŒ–ã€‚å½“è§†çº¿æ–¹å‘å‚ç›´äºé£æ™¯è¡¨é¢çš„æ³•çº¿æ—¶ï¼ŒèåˆåŒºåŸŸå‡ ä¹å˜å¾—ä¸å¯è§ï¼Œä½†æ˜¯å¦‚æœæ‚¨å‘ä¸‹å€¾æ–œç›¸æœºï¼Œåˆ™è¯¥åŒºåŸŸçš„å¤§å°ä¼šè¿…é€Ÿå¢åŠ ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hd/r8/gs/hdr8gs_ha63gspkr_eaxowjosna.png"><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ·±åº¦</font><i><font style="vertical-align: inherit;">å€¾æ–œæ‘„å½±æœºçš„åŒæ—¶æ›´æ”¹æ··åˆåŒºåŸŸçš„å®½åº¦</font></i><font style="vertical-align: inherit;">å¦‚æœä¸æ˜¯å› ä¸º3Dæ¨¡å‹ä¸æ™¯è§‚çš„ç›¸äº¤è¿‡å¤šï¼Œæ··åˆå¯èƒ½æ˜¯æ¶ˆé™¤3Dæ¨¡å‹ä¸æ™¯è§‚çš„ç›¸äº¤çº¿çš„å¥½é€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">æ­¤æ–¹æ³•æ›´é€‚åˆäºéé™æ€çš„ç²’å­æ•ˆæœï¼Œå¹¶ä¸”é€šå¸¸ä¸åŒ…å«é«˜åº¦è¯¦ç»†çš„çº¹ç†ï¼Œå› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ä¼šè§‚å¯Ÿåˆ°è§†å·®æ•ˆæœã€‚</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é«˜åº¦å›¾èåˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®æ–½æ™¯è§‚èåˆçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é«˜åº¦å›¾ï¼ŒUnityæä¾›äº†é€šè¿‡TerrainData API </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[12]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¿é—®çš„é«˜åº¦å›¾</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŸ¥é“Terrainå¯¹è±¡çš„ä½ç½®å’ŒTerrainDataä¸­æŒ‡ç¤ºçš„åœ°å½¢å°ºå¯¸ï¼Œå¹¶ä¸”æ‰‹å¤´æœ‰ä¸€ä¸ªâ€œé«˜åº¦å›¾â€ï¼Œæ‚¨å¯ä»¥è®¡ç®—åœ¨ä¸–ç•Œåæ ‡ä¸­æŒ‡å®šçš„ä»»ä½•ç‚¹çš„åœ°å½¢é«˜åº¦ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/69/za/ga69zap3c3xnluhjfm68g4_roto.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡‡æ ·é«˜åº¦å›¾æ‰€éœ€çš„åœ°å½¢å‚æ•°</font></font></i><br>
<br>
<pre><code class="css hljs">// <span class="hljs-selector-tag">Setting</span> <span class="hljs-selector-tag">up</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">heightmap</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">uniforms</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">use</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">shaders</span>... <font></font>
<font></font>
<span class="hljs-selector-tag">Shader</span><span class="hljs-selector-class">.SetGlobalTexture</span>(<span class="hljs-selector-tag">Uniforms</span><span class="hljs-selector-class">.TerrainHeightmap</span>, <span class="hljs-selector-tag">terrain</span><span class="hljs-selector-class">.terrainData</span><span class="hljs-selector-class">.heightmapTexture</span>);
<span class="hljs-selector-tag">Shader</span><span class="hljs-selector-class">.SetGlobalVector</span>(<span class="hljs-selector-tag">Uniforms</span><span class="hljs-selector-class">.HeightmapScale</span>, <span class="hljs-selector-tag">terrain</span><span class="hljs-selector-class">.terrainData</span><span class="hljs-selector-class">.heightmapScale</span>);
<span class="hljs-selector-tag">Shader</span><span class="hljs-selector-class">.SetGlobalVector</span>(<span class="hljs-selector-tag">Uniforms</span><span class="hljs-selector-class">.TerrainSize</span>, <span class="hljs-selector-tag">terrain</span><span class="hljs-selector-class">.terrainData</span><span class="hljs-selector-class">.size</span>);
<span class="hljs-selector-tag">Shader</span><span class="hljs-selector-class">.SetGlobalVector</span>(<span class="hljs-selector-tag">Uniforms</span><span class="hljs-selector-class">.TerrainPos</span>, <span class="hljs-selector-tag">terrain</span><span class="hljs-selector-class">.transform</span><span class="hljs-selector-class">.position</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½äº†ï¼Œç°åœ¨ï¼Œåœ¨è®¡ç®—äº†æ™¯è§‚çš„é«˜åº¦ä¹‹åï¼Œæ‚¨è¿˜å¯ä»¥åœ¨ç€è‰²å™¨ä¸­è®¡ç®—uvåæ ‡ï¼Œä»¥åœ¨ä¸–ç•Œåæ ‡ä¸­é‡‡æ ·æ™¯è§‚çš„é«˜åº¦å›¾ã€‚</font></font><br>
<br>
<pre><code class="css hljs">// <span class="hljs-selector-tag">Computes</span> <span class="hljs-selector-tag">UV</span> <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">sampling</span> <span class="hljs-selector-tag">terrain</span> <span class="hljs-selector-tag">heightmap</span>... <font></font>
<font></font>
<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">TerrainUV</span>(<span class="hljs-selector-tag">float3</span> <span class="hljs-selector-tag">worldPos</span>)<font></font>
{<font></font>
    return (worldPos.xz - TerrainPos.xz) / TerrainSize.xz;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†èƒ½å¤Ÿåœ¨ç‰‡æ®µç€è‰²å™¨å’Œé¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå°†tex2Dlodå‡½æ•°ç”¨äºé‡‡æ ·ã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œé«˜åº¦å›¾æ²¡æœ‰Mipçº§åˆ«ï¼Œå› æ­¤ä½¿ç”¨è‡ªåŠ¨è®¡ç®—Mipçº§åˆ«çš„tex2Då‡½æ•°å¯¹å…¶è¿›è¡Œé‡‡æ ·åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</font></font><br>
<br>
<pre><code class="css hljs">// <span class="hljs-selector-tag">Returns</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">height</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">terrain</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">given</span> <span class="hljs-selector-tag">position</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">world</span> <span class="hljs-selector-tag">space</span>... <font></font>
<font></font>
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">TerrainHeight</span>(<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">terrainUV</span>)<font></font>
{<font></font>
    float heightmapSample = tex2Dlod(TerrainHeightmap, float4(terrainUV,0,0));<font></font>
    return TerrainPos.y + UnpackHeightmap(heightmapSample) * HeightmapScale.y * 2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥å°è¯•é€šè¿‡é€æ˜åº¦é‡ç°æ¶ˆé™¤äº¤é›†çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€ä½¿ç”¨æ·±åº¦ç¼“å†²åŒºã€‚</font><font style="vertical-align: inherit;">è¿™ä¸èƒ½è§£å†³ä¸è¯¥æ–¹æ³•ç›¸å…³çš„å…¶ä»–é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨é«˜åº¦å›¾éªŒè¯æ··åˆçš„å¯æ“ä½œæ€§ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="css hljs">// <span class="hljs-selector-tag">Blending</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">terrain</span> <span class="hljs-selector-tag">heightmap</span><font></font>
<font></font>
<span class="hljs-selector-id">#include</span> "<span class="hljs-selector-tag">UnityCG</span><span class="hljs-selector-class">.cginc</span>"<font></font>
<font></font>
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendStart</span>;
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendEnd</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">sampler2D_float</span> <span class="hljs-selector-tag">TerrainHeightmap</span>; 
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">HeightmapScale</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainSize</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainPos</span>;        <font></font>
<font></font>
<span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">v2f</span><font></font>
{<font></font>
   // ...<font></font>
<font></font>
   float3 <span class="hljs-attribute">worldPos </span>: TEXCOORD0;<font></font>
   float2 <span class="hljs-attribute">heightMapUV </span>: TEXCOORD1;<font></font>
<font></font>
   // ...<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">vert</span>(<span class="hljs-selector-tag">appdata</span> <span class="hljs-selector-tag">v</span>)<font></font>
{<font></font>
    v2f o;<font></font>
    UNITY_INITIALIZE_OUTPUT(v2f,o);<font></font>
   <font></font>
    // ...<font></font>
    <font></font>
    o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font>
    o.heightMapUV = TerrainUV(o.worldPos);<font></font>
<font></font>
    // ...<font></font>
<font></font>
    return o;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">fixed4</span> <span class="hljs-selector-tag">frag</span>(<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">i</span>) : <span class="hljs-selector-tag">COLOR</span><font></font>
{<font></font>
    fixed4 result = 0;<font></font>
<font></font>
    // ... <font></font>
<font></font>
    half height = TerrainHeight(i.heightMapUV);<font></font>
    half deltaHeight = i.worldPos.y - height;<font></font>
    result.a = smoothstep( BlendStart, BlendEnd, deltaHeight );<font></font>
<font></font>
    // ... <font></font>
       <font></font>
    return result; <font></font>
}</code></pre><br>
</div></div><br>
<br>
<img src="https://habrastorage.org/webt/zl/fl/nz/zlflnzwmh3tl6z_dhlvxowot4he.png"><br>
<img src="https://habrastorage.org/webt/-k/qc/f8/-kqcf8fgcmkjj7kt3gxmfpz31zu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·±åº¦æ··åˆå’Œé«˜ç¨‹æ··åˆã€‚</font><font style="vertical-align: inherit;">ç›¸åŒçš„ç€è‰²å™¨å‚æ•°ä¼šå¯¼è‡´æ··åˆåŒºåŸŸçš„å®½åº¦ä¸åŒï¼Œ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä¸¤ç§æ–¹æ³•çš„æ’å›¾ä½¿ç”¨ç›¸åŒçš„æ··åˆå‚æ•°ã€‚</font><font style="vertical-align: inherit;">èåˆåŒºåŸŸçš„å®½åº¦åœ¨è§†è§‰ä¸Šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºä¸é«˜åº¦å›¾çš„èåˆå¹¶ä¸å–å†³äºè§‚å¯Ÿè€…çš„è§†çº¿ä¸æ™¯è§‚æ³•çº¿ä¹‹é—´çš„è§’åº¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸é«˜åº¦å›¾è¿›è¡Œæ··åˆè‡³å°‘æ¯”åœ¨æ·±åº¦ä¸Šè¿›è¡Œæ··åˆæ›´å¥½ï¼šå®ƒæ ¡æ­£äº†è‚‰çœ¼å¯è§çš„æ··åˆå¯¹ç›¸æœºæ³¨è§†é£æ™¯çš„ä¾èµ–å…³ç³»ã€‚</font><font style="vertical-align: inherit;">ä¸å¹¸çš„æ˜¯ï¼Œä»ç„¶ä¼šè§‚å¯Ÿåˆ°è§†å·®æ•ˆæœã€‚</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›­æ—ç»¿åŒ–æ”¹é€ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦æ¶ˆé™¤è§†å·®ï¼Œæ‚¨éœ€è¦å°†3Dæ¨¡å‹çš„ä¸€éƒ¨åˆ†ä¸å‚ç›´ä¸‹æ–¹çš„é£æ™¯éƒ¨åˆ†æ··åˆåœ¨ä¸€èµ·ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨äºæ··åˆçš„é¢œè‰²é€‰æ‹©ä¸å–å†³äºç›¸æœºçš„ä½ç½®å’Œæ–¹å‘ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h8/en/8t/h8en8tgwnrmjvhnunm0wkgcr3cu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•ä¿®å¤è§†å·®ï¼šé€‰æ‹©ç”¨äºæ··åˆçš„æ™¯è§‚ç‰‡æ®µ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ›´å¤šåœ°è®¨è®ºè™šæ‹Ÿæ™¯è§‚ç‰‡æ®µã€‚æ ¹æ®ç›¸æœºçš„ä½ç½®ï¼Œæœ‰å¯èƒ½éœ€è¦å°†3Dæ¨¡å‹çš„ç‰‡æ®µæ··åˆåœ¨ä¸€èµ·çš„é£æ™¯ç‰‡æ®µç”šè‡³éƒ½ä¸ä¼šè½å…¥ç›¸æœºçš„è§†é‡ä¸­ã€‚åœ¨å±å¹•ç©ºé—´ï¼ˆSSLRï¼‰ä¸­æ¸²æŸ“å±€éƒ¨åå°„æ—¶ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚å®ƒåŒ…å«ä»¥ä¸‹äº‹å®ï¼šä¸å¯èƒ½æ¸²æŸ“ä¸åœ¨å±å¹•ä¸Šçš„ç‰‡æ®µçš„åå°„</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ™¯è§‚çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Unity APIæä¾›çš„è¾…åŠ©çº¹ç†é«˜ç²¾åº¦åœ°é‡å»ºè™šæ‹Ÿç‰‡æ®µçš„é¢œè‰²ï¼šæ³•çº¿è´´å›¾</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå…‰è´´å›¾</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[15]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç”¨äºæ··åˆå›¾å±‚çš„åŠ æƒçº¹ç†</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[16]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥åŠåŒ…å«åœ¨å…¶ä¸­çš„çº¹ç†å±‚çš„ç»„æˆ</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[17]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ff/hu/zr/ffhuzriatn-pfjxf-nendtckscm.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡å»ºæ™¯è§‚ç‰‡æ®µ</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ ¹æ®ä¸é«˜åº¦å›¾ç›¸åŒçš„UV </font><i><font style="vertical-align: inherit;">å¯¹æ„æˆæ™¯è§‚çš„</font></i><font style="vertical-align: inherit;">æ‰€æœ‰çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚</font><font style="vertical-align: inherit;">åœ¨å›¾å±‚çš„æƒ…å†µä¸‹ï¼Œé‡‡æ ·åæ ‡é€šè¿‡ä¸ºç‰¹å®šå›¾å±‚</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[18] [19]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡å®šçš„å¹³é“ºå‚æ•°è¿›è¡Œè°ƒæ•´</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="css hljs">// <span class="hljs-selector-tag">Blending</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">reconstructed</span> <span class="hljs-selector-tag">terrain</span> <span class="hljs-selector-tag">fragments</span><font></font>
<font></font>
<span class="hljs-selector-id">#include</span> "<span class="hljs-selector-tag">UnityCG</span><span class="hljs-selector-class">.cginc</span>"<font></font>
<font></font>
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendStart</span>;
<span class="hljs-selector-tag">float</span> <span class="hljs-selector-tag">BlendEnd</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">sampler2D_float</span> <span class="hljs-selector-tag">TerrainHeightmapTexture</span>;
<span class="hljs-selector-tag">sampler2D_float</span> <span class="hljs-selector-tag">TerrainNormalTexture</span>;
<span class="hljs-selector-tag">sampler2D</span> <span class="hljs-selector-tag">TerrainAlphaMap</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">HeightmapScale</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainSize</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainPos</span>;
<span class="hljs-selector-tag">Float4</span> <span class="hljs-selector-tag">TerrainLightmap_ST</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D</span>(<span class="hljs-selector-tag">TerrainSplatMap0</span>);
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D_NOSAMPLER</span>(<span class="hljs-selector-tag">TerrainNormalMap0</span>);
<span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">TerrainSplatMap0_ST</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D</span>(<span class="hljs-selector-tag">TerrainSplatMap1</span>);
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D_NOSAMPLER</span>(<span class="hljs-selector-tag">TerrainNormalMap1</span>);
<span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">TerrainSplatMap1_ST</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D</span>(<span class="hljs-selector-tag">TerrainSplatMap2</span>);
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D_NOSAMPLER</span>(<span class="hljs-selector-tag">TerrainNormalMap2</span>);
<span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">TerrainSplatMap2_ST</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D</span>(<span class="hljs-selector-tag">TerrainSplatMap3</span>);
<span class="hljs-selector-tag">UNITY_DECLARE_TEX2D_NOSAMPLER</span>(<span class="hljs-selector-tag">TerrainNormalMap3</span>);
<span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">TerrainSplatMap3_ST</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">v2f</span><font></font>
{<font></font>
   // ...<font></font>
<font></font>
   float3 <span class="hljs-attribute">worldPos </span>: TEXCOORD0;<font></font>
   float2 <span class="hljs-attribute">heightMapUV </span>: TEXCOORD1;<font></font>
#if defined(LIGHTMAP_ON)<font></font>
   float2 <span class="hljs-attribute">modelLightMapUV </span>: TEXCOORD2;<font></font>
   float2 <span class="hljs-attribute">terrainLightMapUV </span>: TEXCOORD3;<font></font>
#endif<font></font>
<font></font>
   // ...<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">vert</span>(<span class="hljs-selector-tag">appdata</span> <span class="hljs-selector-tag">v</span>)<font></font>
{<font></font>
    v2f o;<font></font>
    UNITY_INITIALIZE_OUTPUT(v2f,o);<font></font>
   <font></font>
    // ...<font></font>
    <font></font>
    o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font>
    o.heightMapUV = TerrainUV(o.worldPos);<font></font>
<font></font>
#if defined(LIGHTMAP_ON)<font></font>
    o.modelLightMapUV = v.texcoord1.xy * unity_LightmapST.xy + unity_LightmapST.zw;<font></font>
    o.terrainLightMapUV = o.heightMapUV * TerrainLightmap_ST.xy + TerrainLightmap_ST.zw;<font></font>
#endif<font></font>
<font></font>
    // ...<font></font>
<font></font>
    return o;<font></font>
}<font></font>
<span class="hljs-selector-tag">half3</span> <span class="hljs-selector-tag">TerrainNormal</span>(<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">terrainUV</span>)<font></font>
{<font></font>
    return tex2Dlod( TerrainNormalTexture, float4(terrainUV,0,0) ).xyz * 2.0 - 1.0;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">TerrainSplatMap</span>(<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv0</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv1</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv2</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv3</span>, <span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">control</span>)<font></font>
{<font></font>
    half4 splat0 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainSplatMap0, TerrainSplatMap0, uv0);<font></font>
    half4 splat1 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainSplatMap1, TerrainSplatMap1, uv1);<font></font>
    half4 splat2 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainSplatMap2, TerrainSplatMap2, uv2);<font></font>
    half4 splat3 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainSplatMap3, TerrainSplatMap3, uv3);         <font></font>
    half4 result = splat0 * control.r + <font></font>
                   splat1 * control.g + <font></font>
                   splat2 * control.b + <font></font>
                   splat3 * control.a;<font></font>
    return result;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">half3</span> <span class="hljs-selector-tag">TerrainNormalMap</span>(<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv0</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv1</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv2</span>, <span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv3</span>, <span class="hljs-selector-tag">half4</span> <span class="hljs-selector-tag">control</span>)<font></font>
{<font></font>
    half4 n0 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainNormalMap0, TerrainSplatMap0, uv0);<font></font>
    half4 n1 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainNormalMap1, TerrainSplatMap1, uv1);<font></font>
    half4 n2 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainNormalMap2, TerrainSplatMap2, uv2);<font></font>
    half4 n3 = UNITY_SAMPLE_TEX2D_SAMPLER(TerrainNormalMap3, TerrainSplatMap3, uv3);<font></font>
    half3 result = UnpackNormalWithScale(n0, 1.0) * control.r +<font></font>
                   UnpackNormalWithScale(n1, 1.0) * control.g +<font></font>
                   UnpackNormalWithScale(n2, 1.0) * control.b +<font></font>
                   UnpackNormalWithScale(n3, 1.0) * control.a;<font></font>
    result.z += 1e-5;<font></font>
    return result;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">half3</span> <span class="hljs-selector-tag">TerrainLightmap</span>(<span class="hljs-selector-tag">float2</span> <span class="hljs-selector-tag">uv</span>, <span class="hljs-selector-tag">half3</span> <span class="hljs-selector-tag">normal</span>)<font></font>
{<font></font>
#if defined(LIGHTMAP_ON)<font></font>
#if defined(DIRLIGHTMAP_COMBINED)<font></font>
    half4 lm = UNITY_SAMPLE_TEX2D(unity_Lightmap, uv);<font></font>
    half4 lmd = UNITY_SAMPLE_TEX2D_SAMPLER(unity_LightmapInd, unity_Lightmap, uv);<font></font>
    half3 result = DecodeLightmapRGBM(lm, unity_Lightmap_HDR);<font></font>
    result = DecodeDirectionalLightmap(result, lmd, normal);<font></font>
#else<font></font>
    half4 lm = UNITY_SAMPLE_TEX2D(unity_Lightmap, uv);<font></font>
    half3 result = DecodeLightmapRGBM(lm, unity_Lightmap_HDR);<font></font>
#endif                <font></font>
#else<font></font>
    half3 result = UNITY_LIGHTMODEL_AMBIENT.rgb;<font></font>
#endif<font></font>
    return result;<font></font>
}<font></font>
<font></font>
<span class="hljs-selector-tag">fixed4</span> <span class="hljs-selector-tag">frag</span>(<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">i</span>) : <span class="hljs-selector-tag">COLOR</span><font></font>
{<font></font>
    fixed4 result = 0;<font></font>
<font></font>
    // ...<font></font>
<font></font>
    // compute model color and put it to the result<font></font>
<font></font>
    // ... <font></font>
<font></font>
    // reconstruction of terrain fragment<font></font>
<font></font>
    float2 splatUV0 = TRANSFORM_TEX(i.heightMapUV, TerrainSplatMap0);<font></font>
    float2 splatUV1 = TRANSFORM_TEX(i.heightMapUV, TerrainSplatMap1);<font></font>
    float2 splatUV2 = TRANSFORM_TEX(i.heightMapUV, TerrainSplatMap2);<font></font>
    float2 splatUV3 = TRANSFORM_TEX(i.heightMapUV, TerrainSplatMap3);<font></font>
<font></font>
    half4 control = tex2D(_TerrainAlphaMap, i.heightMapUV);<font></font>
    half4 terrainColor = TerrainSplatMap(splatUV0, splatUV1, splatUV2, splatUV3, control);<font></font>
<font></font>
    half3 terrainSurfaceNormal = TerrainNormal(i.heightMapUV);<font></font>
    half3 terrainSurfaceTangent = cross(terrainSurfaceNormal, float3(0,0,1));<font></font>
    half3 terrainSurfaceBitangent = cross(terrainSurfaceTangent, terrainSurfaceNormal);<font></font>
<font></font>
    half3 terrainNormal = TerrainNormalMap(splatUV0, splatUV1, splatUV2, splatUV3, control);<font></font>
    terrainNormal = terrainNormal.x * terrainSurfaceTangent + <font></font>
                    terrainNormal.y * terrainSurfaceBitangent + <font></font>
                    terrainNormal.z * terrainSurfaceNormal;<font></font>
    <font></font>
    half3 terrainLightmapColor = TerrainLightmap(i.heightMapUV, terrainNormal);<font></font>
    terrainColor *= terrainLightmapColor;<font></font>
<font></font>
    // blend model color &amp; terrain color<font></font>
<font></font>
    half height = TerrainHeight(i.heightMapUV);<font></font>
    half deltaHeight = i.worldPos.y - height;<font></font>
    half blendingWeight = smoothstep(BlendStart, BlendEnd, deltaHeight);<font></font>
<font></font>
    result.rgb = lerp(result.rgb, terrainColor, blendingFactor);<font></font>
       <font></font>
    return result; <font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œä¸æ™¯è§‚ç¢ç‰‡çš„é‡å»ºèåˆè§£å†³äº†æ·±åº¦èåˆå’Œä¸é«˜åº¦å›¾ï¼ˆåŒ…æ‹¬è§†å·®ï¼‰èåˆçš„æ‰€æœ‰å…¸å‹é—®é¢˜ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/pb/0s/mfpb0sfkav-hj-i5xhpll305drc.png"><br>
<img src="https://habrastorage.org/webt/ba/-z/x6/ba-zx6icghn-mnbreobdnekbjay.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›­æ—ç»¿åŒ–æ”¹é€ </font></font></i><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ°å½¢ç¢ç‰‡é‡å»ºæ€§èƒ½</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè¯¥é—®é—®é¢˜äº†ï¼Œè¿™ç§å¦¥åçš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿä¹ä¸€çœ‹ï¼Œé‡å»ºæ™¯è§‚ç¢ç‰‡çš„èµ„æºå¼ºåº¦è¿œè¿œè¶…è¿‡äº†alphaæ··åˆçš„èµ„æºå¼ºåº¦ã€‚ä¸ºäº†è¿›è¡Œé‡å»ºï¼Œæœ‰å¿…è¦ä»å†…å­˜ä¸­æ‰§è¡Œè®¸å¤šå…¶ä»–è¯»å–æ“ä½œã€‚å¯¹äºAlphaæ··åˆï¼Œæ‚¨åªéœ€è¦ä»å†…å­˜è¿›è¡Œä¸€æ¬¡è¯»å–æ“ä½œï¼Œè€Œå¯¹å†…å­˜è¿›è¡Œä¸€æ¬¡å†™å…¥æ“ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½å°†å–å†³äºç¡¬ä»¶å¹³å°çš„åŠŸèƒ½ã€‚çº¹ç†å‹ç¼©ï¼Œmipæ˜ å°„ï¼ŒGPUæ ¸å¿ƒå¤„ç†èƒ½åŠ›å’Œç‰¹å®šçš„ç¡¬ä»¶ç®¡é“ä¼˜åŒ–ï¼ˆæ—©æœŸæ·±åº¦æŠ‘åˆ¶ï¼‰æ”¯æŒç‰‡æ®µé‡å»ºã€‚ä¸alphaæ··åˆç›¸åï¼Œä¸Šé¢å·²ç»æåˆ°çš„äº‹å®å°†å‘æŒ¥ä½œç”¨ï¼Œå®ƒæ˜¯æ‰€æœ‰GPUä¸­æœ€ä¸å…ˆè¿›çš„éƒ¨åˆ†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œæ€»ä¼šæœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œåœ¨é‡å»ºé£æ™¯çš„é¢œè‰²çš„æƒ…å†µä¸‹ï¼Œä»…å¯¹äºä½äºä¸é«˜äºé£æ™¯è¡¨é¢ä¸Šæ–¹ä¸€å®šé«˜åº¦çš„3Dæ¨¡å‹çš„ç‹­çª„ç‰‡æ®µæ¡å¸¦è¿›è¡Œæ­¤é‡å»ºçš„éœ€è¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç€è‰²å™¨ä¸­çš„åŠ¨æ€åˆ†æ”¯å¯èƒ½ä¼šå¯¼è‡´å¯é¢„æµ‹çš„æ€§èƒ½ç»“æœï¼Œä½†æ˜¯åº”æ³¨æ„ä¸¤ç‚¹ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸æ»¡è¶³æ­¤æ¡ä»¶ï¼Œåˆ™åº”æŒ‰æ¡ä»¶è·³è¿‡ä¸å¿…è¦çš„è®¡ç®—ã€‚</font></font></li>
<li>       .   ,             ( ,  ),      GPU.    â€•   (branch granularity),  , , ,          ,      .         ,    ,       .  ,   GPU  ,     ,       . ,      GPU,   ,  1 (PowerVR SGX).</li>
</ol><br>
<img src="https://habrastorage.org/webt/i7/8y/x9/i78yx9mn7egjmojcmxl67crz1kc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§†åŒ–ä¸åŒç¨‹åº¦çš„è¿è´¯æ€§</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨é‡å»ºç‰‡æ®µçš„æƒ…å†µä¸‹ï¼Œè¦è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆ†æ”¯æ¡ä»¶å°†å…è®¸ä¸­æ–­èµ„æºå¯†é›†å‹æ“ä½œä»¥é‡å»ºæ™¯è§‚çš„é¢œè‰²ï¼Œå¹¶ä¸”è¯¥æ¡ä»¶æ˜¯ä¸€è‡´çš„ï¼Œé™¤äº†æå°‘æ•°çš„ç‰‡æ®µï¼ˆåœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œè¿™äº›ç‰‡æ®µæ˜¯åœ¨â€œçº¢è‰²â€å’Œâ€œç»¿è‰²â€åŒºåŸŸä¹‹é—´çš„è¾¹ç•Œä¸Šï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k3/do/ic/k3doicnobaqmuv82xbdfvq_kgas.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ™¯è§‚ç¢ç‰‡é‡å»ºçš„è¿è´¯æ€§</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å…³äºè¿™ç§æ··åˆæ–¹æ³•</font><i><font style="vertical-align: inherit;">ï¼Œ</font></i><font style="vertical-align: inherit;">ä»ç„¶éœ€è¦æ·»åŠ ä¸€äº›æ³¨é‡Šï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»…å½“æ™¯è§‚å¯ç”¨äº†</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â€œ</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»˜åˆ¶å®ä¾‹åŒ–â€æ¨¡å¼æ—¶ï¼ŒUnityæ‰ä¼šæä¾›æ‰€æœ‰å¿…è¦çš„çº¹ç†</font><sup><font style="vertical-align: inherit;">[20]</font></sup><font style="vertical-align: inherit;">ï¼Œå¦åˆ™æ³•çº¿è´´å›¾å°†ä¸å¯ç”¨ï¼Œä»è€Œä½¿æ‚¨æ— æ³•æ­£ç¡®åœ°é‡æ„æ™¯è§‚ç…§æ˜ä»¥è¿›è¡Œæ··åˆã€‚</font></font></li>
<li> Unity API    ,      (base map)         . -          .</li>
<li>         ,   API          (, Metal   16  ). </li>
<li>    3D-  ,     Terrain,     SRP.</li>
<li> 3D-      ,       3D-    . </li>
<li>,   Â«Â» ,     Â«Â»  .    ,  Â«Â»      ,             .  Â«Â»          .</li>
</ol><br>
<img src="https://habrastorage.org/webt/9z/yi/y-/9zyiy-6z47y7pxyonhwrl31zyoc.png"><br>
<i>    </i><br>
<br>
<br>
<h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è®¾è®¡3Dæ¨¡å‹æ—¶ï¼Œä¸å¯èƒ½è€ƒè™‘åˆ°åº”è¯¥ä½¿ç”¨è¿™äº›æ¨¡å‹çš„å„ç§åœ°å½¢æµ®é›•ã€‚é€šå¸¸ï¼Œ3Dæ¨¡å‹å¿…é¡»åœ¨æ™¯è§‚ä¸­æ·±æ·±â€œä¸‹æ²‰â€æˆ–æ—‹è½¬ä»¥éšè—çªå‡ºçš„é›¶ä»¶ï¼Œåä¹‹äº¦ç„¶-ä»¥ä¾¿æ˜¾ç¤ºåº”è¯¥å¯è§çš„éšè—é›¶ä»¶ã€‚ â€œé¢„çƒ­â€æ¨¡å‹é™åˆ¶äº†å®ƒä»¬çš„é€‚ç”¨æ€§ï¼Œå¦‚æœ3Dæ¨¡å‹çš„ç»˜åˆ¶æ—©äºæ™¯è§‚ï¼Œåˆ™è¿˜ä¼šå¯¼è‡´é€æ”¯æ•ˆæœã€‚åè¿‡æ¥ï¼Œè½¬å¼¯ä¹Ÿè¿œéé€‚ç”¨äºæ‰€æœ‰3Dæ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œä¸é€‚ç”¨äºæˆ¿å±‹å’Œæ ‘æœ¨ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/tg/8y/uetg8yx5ctdsn80stvnnezplgh4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦éšè—3Dæ¨¡å‹çš„çªå‡ºå…ƒç´ ï¼Œå¿…é¡»å°†å…¶â€œæ·¹æ²¡â€åœ¨æ™¯è§‚ä¸­</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ•æ‰æ˜¯å›¾å½¢ç¼–è¾‘å™¨ç”¨æˆ·ç†Ÿæ‚‰çš„ä¸€ä¸ªæœ¯è¯­ã€‚æ­¤åŠŸèƒ½å…è®¸æ§åˆ¶ç‚¹â€œç²˜è´´â€åˆ°ç©ºé—´ç½‘æ ¼çš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨3Dç¼–è¾‘å™¨ä¸­ç²˜è´´åˆ°å…¶ä»–å¯¹è±¡çš„é¢å’Œè¡¨é¢ã€‚åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æ•æ‰åˆ°æ™¯è§‚é«˜åº¦çš„åœ°å›¾å¯ä»¥å¤§å¤§ç®€åŒ–åœºæ™¯çš„è®¾è®¡ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4w/1t/xw/4w1txwi3vaczzpne7ewajozlymo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰æ•æ‰çš„3Dæ¨¡å‹ã€‚å…·æœ‰é¡¶ç‚¹æ•æ‰åŠŸèƒ½çš„3Dæ¨¡å‹ã€‚å…·æœ‰é¡¶ç‚¹æ•æ‰å’ŒèåˆåŠŸèƒ½çš„3Dæ¨¡å‹ã€‚å…·æœ‰é¡¶ç‚¹æ•æ‰ï¼Œæ··åˆå’Œé™æ€ç…§æ˜çš„3Dæ¨¡å‹</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®æ–½æ•æ‰çš„ä¸»è¦å›°éš¾æ˜¯ï¼Œæ‚¨éœ€è¦ç¡®å®š3Dæ¨¡å‹çš„å“ªäº›é¡¶ç‚¹éœ€è¦æ•æ‰åˆ°é«˜åº¦å›¾ï¼Œå“ªäº›é¡¶ç‚¹ä¸å€¼å¾—ã€‚</font><font style="vertical-align: inherit;">é¡¶ç‚¹ä»…åŒ…å«æœ‰å…³è¡¨é¢å±€éƒ¨æ€§è´¨çš„ä¿¡æ¯ï¼ˆè¿™è¿˜ä¸å¤Ÿï¼‰ï¼Œä¸åŒ…å«æœ‰å…³å…¶æ‹“æ‰‘ç»“æ„çš„ä»»ä½•ä¿¡æ¯ï¼ˆè¿™æ˜¯å¿…éœ€çš„ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ä¸€æ ·ï¼Œé€šè¿‡åœ¨é¡¶ç‚¹ä¸­ç›´æ¥å®ç°å¿…è¦çš„å‚æ•°ï¼Œæœ€å®¹æ˜“åœ¨å»ºæ¨¡é˜¶æ®µè§£å†³æ­¤é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºè¿™æ ·çš„å‚æ•°ï¼Œæ‚¨åº”è¯¥é€‰æ‹©ä¸€ä¸ªç›´è§‚çš„å±æ€§-ä¾‹å¦‚ï¼Œæ•æ‰çš„æƒé‡å› å­ï¼ˆè€Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„çµæ´»æ€§ï¼Œè€Œä¸æ˜¯åˆ°å¼€æ”¾æ›²é¢è¾¹ç•Œçš„è·ç¦»ï¼‰ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7b/gq/2b/7bgq2bdhdlr13qgeqpgcocvo0q8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•æ‰çš„åŠ æƒç¼–ç </font></font></i><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹ä»£ç </font></font></b><div class="spoiler_text"><pre><code class="css hljs">// <span class="hljs-selector-tag">Per-vertex</span> <span class="hljs-selector-tag">snapping</span> <span class="hljs-selector-tag">with</span> <span class="hljs-selector-tag">terrain</span> <span class="hljs-selector-tag">heightmap</span><font></font>
<font></font>
<span class="hljs-selector-id">#include</span> "<span class="hljs-selector-tag">UnityCG</span><span class="hljs-selector-class">.cginc</span>"<font></font>
<font></font>
<span class="hljs-selector-tag">sampler2D_float</span> <span class="hljs-selector-tag">TerrainHeightmapTexture</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">HeightmapScale</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainSize</span>;
<span class="hljs-selector-tag">float4</span> <span class="hljs-selector-tag">TerrainPos</span>;<font></font>
<font></font>
<span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">v2f</span><font></font>
{<font></font>
<font></font>
   // ...<font></font>
<font></font>
   float3 <span class="hljs-attribute">worldPos </span>: TEXCOORD0;<font></font>
   float2 <span class="hljs-attribute">heightMapUV </span>: TEXCOORD1;<font></font>
<font></font>
   // ...<font></font>
<font></font>
};<font></font>
<font></font>
<span class="hljs-selector-tag">v2f</span> <span class="hljs-selector-tag">vert</span>(<span class="hljs-selector-tag">appdata</span> <span class="hljs-selector-tag">v</span>)<font></font>
{<font></font>
    v2f o;<font></font>
    UNITY_INITIALIZE_OUTPUT(v2f,o);<font></font>
   <font></font>
    // ...<font></font>
    <font></font>
    o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font>
    o.heightMapUV = TerrainUV(o.worldPos);<font></font>
    float snappingWeight = v.color.r;                <font></font>
    half height = TerrainHeight( o.heightMapUV );                <font></font>
    o.worldPos.y = lerp( o.worldPos.y, height, snappingWeight );<font></font>
    o.pos = UnityWorldToClipPos( half4( o.worldPos, 1 ) );<font></font>
<font></font>
    // ...<font></font>
<font></font>
    return o;<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¡¶ç‚¹æ•æ‰çš„é€‚ç”¨æ€§å—åˆ°åœ°å½¢å’Œ3Dæ¨¡å‹è¡¨é¢ä¹‹é—´çš„ä¸€èˆ¬å¯¹åº”å…³ç³»çš„é™åˆ¶ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†å¼¥è¡¥å®ƒä»¬ä¹‹é—´çš„æ˜¾ç€å·®å¼‚ï¼Œæœ‰å¿…è¦ä½¿ç”¨å…¶ä»–æ›´å ç”¨èµ„æºçš„æ–¹æ³•-ä¾‹å¦‚ï¼Œä½¿ç”¨å¸¦æœ‰è’™çš®çš„3Dæ¨¡å‹ã€‚</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ¬æ–‡çš„ä¸»è¦æ€æƒ³æ˜¯ï¼šä»»ä½•è¶³å¤Ÿå¤æ‚ä¸”å…·æœ‰æ½œåœ¨å¯ä¼¸ç¼©æ€§çš„ç€è‰²å™¨éƒ½éœ€è¦åŸºæœ¬æ•°æ®ã€‚</font><font style="vertical-align: inherit;">å¼€å‘äººå‘˜çš„ä»»åŠ¡æ˜¯äº†è§£å›¾å½¢ç³»ç»Ÿçš„æ“ä½œæ–¹å¼ï¼šå®ƒæä¾›ä»€ä¹ˆæ•°æ®ï¼Œå¦‚ä½•å°†å®ƒä»¬å½¼æ­¤ç»„åˆä»¥åŠå¦‚ä½•åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå…‹æœé™åˆ¶å›¾å½¢æ•ˆæœå¯èƒ½æ€§çš„æ¡†æ¶çš„å”¯ä¸€é€‰æ‹©æ˜¯ç»„åˆå„ç§ç€è‰²å™¨çš„ç»“æœã€‚</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒæ–‡çŒ®</font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŸ¥çœ‹è¿ç»“</font></font></b><div class="spoiler_text"><sup>[1]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/Manual/SL-CameraDepthTexture.html</a><br>
<sup>[2]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/ScriptReference/Camera-depthTextureMode.html</a><br>
<sup>[3]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/ScriptReference/RenderTexture.html</a><br>
<sup>[4]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.khronos.org/opengl/wiki/Framebuffer_Object</a><br>
<sup>[5]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.microsoft.com/en-us/windows/win32/api/d3d11/nf-d3d11-id3d11device-createrendertargetview</a><br>
<sup>[6]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/ScriptReference/Rendering.BlendMode.html</a><br>
<sup>[7]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/ScriptReference/Rendering.BlendOp.html</a><br>
<sup>[8]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.khronos.org/opengl/wiki/Blending</a><br>
<sup>[9]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.microsoft.com/en-us/windows/win32/direct3d11/d3d10-graphics-programming-guide-blend-state</a><br>
<sup>[10]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Parallax</a><br>
<sup>[11]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Parallax_scrolling</a><br>
<sup>[12]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/TerrainData-heightmapTexture.html</a><br>
<sup>[13]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pdfs.semanticscholar.org/ce6c/fcafe3581a7e4d7184a9727cc504bdc6b295.pdf</a><br>
<sup>[14]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/Terrain-normalmapTexture.html</a><br>
<sup>[15]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/Terrain-lightmapIndex.html</a><br>
<sup>[16]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/TerrainData-alphamapTextures.html</a><br>
<sup>[17]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/TerrainData-terrainLayers.html</a><br>
<sup>[18]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/TerrainLayer-tileSize.html</a><br>
<sup>[19]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/TerrainLayer-tileOffset.html</a><br>
<sup>[20]</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.unity3d.com/2018.3/Documentation/ScriptReference/Terrain-drawInstanced.html</a><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490204/index.html">2020å¹´3æœˆHRå’ŒITæ‹›è˜äººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
<li><a href="../zh-CN490208/index.html">DUMP2020çš„åç«¯éƒ¨åˆ†ï¼šæˆterï¼Œè¿·ï¼Œå¤±è´¥</a></li>
<li><a href="../zh-CN490210/index.html">åŠ å¿«å‰ç«¯é€Ÿåº¦ã€‚å½“è®¸å¤šæœåŠ¡å™¨è¯·æ±‚éƒ½å¾ˆå¥½æ—¶</a></li>
<li><a href="../zh-CN490222/index.html">æ­»äº¡æ—¥æ ‡å‡†å›¾ä¹¦é¦†</a></li>
<li><a href="../zh-CN490224/index.html">æ—¶å°šçš„éšå½¢</a></li>
<li><a href="../zh-CN490232/index.html">ä½¿ç”¨AWS ELBè¿›è¡Œè´Ÿè½½å¹³è¡¡</a></li>
<li><a href="../zh-CN490242/index.html">SIM800xæ¨¡å—çš„GSMå®šä½æœåŠ¡åŠå…¶ä¸Yandex.Locator APIçš„é…åˆ</a></li>
<li><a href="../zh-CN490244/index.html">ä½¿ç”¨ctypesçš„Pythonä»£ç ä¼˜åŒ–</a></li>
<li><a href="../zh-CN490246/index.html">ä¹å¤´è›‡æ‹¥æŠ±å…‹é‡Œå§†æ—å®«å¡”ï¼šä¹å¤´è›‡2020å¹¶è¡Œå’Œåˆ†å¸ƒå¼è®¡ç®—ä¼šè®®</a></li>
<li><a href="../zh-CN490248/index.html">ç½‘ç»œç ”è®¨ä¼šâ€œ Winnum CNCï¼šæœ‰æ•ˆçš„ç›‘æ§â€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>