<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚åõÔ∏è üí§ üë©üèª‚Äçüé® Blockchain development for industry on Go. Part 1 üçä üôÜüèª ü•ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For four months now, I have been working on a project called ‚ÄúDevelopment of blockchain-based security and data management tools in government and ind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blockchain development for industry on Go. Part 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499732/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For four months now, I have been working on a project called ‚ÄúDevelopment of blockchain-based security and data management tools in government and industry‚Äù. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now I would like to talk about how I started this project, and now I will describe the program code in detail.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/319/86b/9a5/31986b9a5079081f4eb87335330d119c.jpg" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the first article in a series of articles. Here I describe the server and protocol. In fact, the reader can even write his own versions of these blockchain elements. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But the second part</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is about the data structures of the blockchain and transactions, as well as about the package that implements interaction with the database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Last year, at the Digital Break hackathon, they threw up the idea that for industry and the digital economy to make a useful system for technology of distributed registries, a grant was also issued for development by the Innovation Assistance Fund (about the grant, I should write a separate article for those who are just starting to do startups ), and now in order. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Development takes place in Go, and the database in which the blocks are stored is LevelDB.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main parts are the protocol, the server (which runs TCP and WebSocket - the first to synchronize the blockchain, the second to connect clients, send transactions and commands from JavaScript, for example.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned, this blockchain is primarily needed to automate and protect the exchange of products between suppliers and customers, or both in one person. They are in no hurry to trust each other. But the task is not only to create a ‚Äúcheckbook‚Äù with a built-in calculator, but a system with automation of most of the routine tasks that arise when working with the product life cycle. The byte code that is responsible for this business, as is customary for blockchains, is stored in the inputs and outputs of transactions (the transactions themselves are in blocks, the blocks in LevelDB are pre-encoded in the GOB format). First, let's talk about the protocol and server (aka node).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The protocol does not work hard, its whole point is that in response to a special command line, switch to the load mode of some data, usually a block or transaction, and it is also needed for exchanging inventory so that the node knows who it is connected to and how they have things to do (the nodes connected for the synchronization session are also called ‚Äúneighboring‚Äù because their IP is known and their state data is stored in memory). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Folders (directories as Linux calls them) are called packages in the understanding of Go-programmers, so at the beginning of each file with Go-code from this directory at the beginning they write package folder_name_where_sit_this_file. </font><font style="vertical-align: inherit;">Otherwise, the package cannot be fed to the compiler. </font><font style="vertical-align: inherit;">Well, this is not a secret for those who know this language. </font><font style="vertical-align: inherit;">These packages are:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Networking (server, client, protocol)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Structures of stored and transmitted data (block, transaction)</font></font></li>
<li>   (blockchain)</li>
<li>  (consensus)</li>
<li>    (xvm)</li>
<li>  (crypto, types)  .</li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is a link to github.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This is a training version, it lacks interprocess communication and several experimental components, for which the structure corresponds to the one under development. </font><font style="vertical-align: inherit;">If you have something to tell in the comments, I will gladly take into account the further development. </font><font style="vertical-align: inherit;">And now for the server and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> packages </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, take a look at server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The server routine acts as a data server running on top of the TCP protocol using data structures from the protocol package. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The routine uses the following packages: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">types</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The package </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itself</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contains </font><i><font style="vertical-align: inherit;">tcp_server.go</font></i><font style="vertical-align: inherit;"> data structure </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serve</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Serve <span class="hljs-keyword">struct</span> {<font></font>
	Port <span class="hljs-keyword">string</span>
	BufSize <span class="hljs-keyword">int</span><font></font>
	ST *types.Settings<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can take the following parameters:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Network port through which data will be exchanged</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JSON server configuration file</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run flag in debug mode (private blockchain)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Progress:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Read configuration from JSON file</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The debug mode flag is checked: if it is set, then the network synchronization scheduler is not launched and the blockchain does not load</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Initializing the configuration data structure and starting the server</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Starts the TCP server and network communication in accordance with the protocol.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It has a Serve data structure consisting of a port number, a buffer size, and a pointer to the </font><i><font style="vertical-align: inherit;">types.Settings</font></i><font style="vertical-align: inherit;"> structure</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li>  Run    (     ,           handle   )</li>
<li>  <i>handle</i>      ,        <i>protocol.Choice</i></li>
<li> <i>protocol.Choice</i>  <i>result</i>   . <i>result</i>    <i>protocol.Interprete</i>,   <i>intrpr</i> ‚Äî   <i>InterpreteData</i>,      </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then the switch is executed by </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intrpr.Commands [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in which one of the following is checked: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">result, inv, error</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and there is a </font><i><font style="vertical-align: inherit;">default</font></i><font style="vertical-align: inherit;"> section</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">result</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section, </font><font style="vertical-align: inherit;">there is a switch by the value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intrpr.Commands [1]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which checks the values ‚Äã‚Äãof </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bufferlength</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (in each case the corresponding function is called)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BufferLength functions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are located in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">srvlib.go</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">of the server package.</font></font><br>
<br>
<pre><code class="go hljs">GetVersion(conn net.Conn, version <span class="hljs-keyword">string</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
just prints to the console and sends the client the version passed in the parameter: </font></font><br>
<br>
<pre><code class="go hljs">conn.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"result:"</span> + version))</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function</font></font><br>
<br>
<pre><code class="go hljs">BufferLength(conn net.Conn, intrpr *protocol.InterpreteData)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
performs loading of a block, transaction or other specific data as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prints on the console the type of data specified in the protocol that needs to be accepted: </font></font><br>
<br>
<pre><code class="go hljs">fmt.Println(<span class="hljs-string">"DataType:"</span>, intrpr.Commands[<span class="hljs-number">2</span>])</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reads the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intrpr.Body</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in numeric variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buf_len</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creates a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newbuf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer of the </font><font style="vertical-align: inherit;">specified size:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, buf_len)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sends ok response: </font></font><br>
<br>
<pre><code class="go hljs">conn.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"result:ok"</span>))</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Produces a full buffer from the read stream: </font></font><br>
<br>
<pre><code class="go hljs">io.ReadFull(conn, newbuf)</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prints the contents of the buffer to the console </font></font><br>
<br>
<pre><code class="go hljs">fmt.Println(<span class="hljs-keyword">string</span>(newbuf))</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and the number of bytes read </font></font><br>
<br>
<pre><code class="go hljs">fmt.Println(<span class="hljs-string">"Bytes length:"</span>, n)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sends ok response: </font></font><br>
<br>
<pre><code class="go hljs">conn.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"result:ok"</span>))</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The methods from the server package are configured in such a way that they process the received data with functions from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> package </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocol</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The protocol serves as a tool that presents data during network communication. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choice (str string) (string, error)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performs the initial processing of the data received by the server, receives a string representation of the data and returns the string prepared for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interprete</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The input string is split into head and body using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReqParseN2 (str)</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> head is broken into elements and placed in the commands slice using ReqParseHead (head)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch (commands [0]) we</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> select the received command ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd, key, address</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section is triggered </font><font style="vertical-align: inherit;">)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In cmd, 2 </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch commands (commands [1]) are </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checked </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">- length</font></i><font style="vertical-align: inherit;"> and </font><i><font style="vertical-align: inherit;">getversion</font></i><font style="vertical-align: inherit;"> .</font></font></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> checks the data type in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commands [2]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and stores it in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datatype</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checks that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">body</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contains a string value</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-built_in">len</span>(body) &lt; <span class="hljs-number">1</span></code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Returns a response string: </font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-string">"result:bufferlength:"</span> + datatype + <span class="hljs-string">"/"</span> + body</code></pre></li>
<li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getversion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returns a string</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">return</span> <span class="hljs-string">"result:version/auto"</span></code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interprete</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It contains the InterpreteData structure and performs secondary processing of the </font><font style="vertical-align: inherit;">string </font><font style="vertical-align: inherit;">returned from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choice</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the formation of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InterpreteData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> InterpreteData <span class="hljs-keyword">struct</span> {<font></font>
	Head <span class="hljs-keyword">string</span>
	Commands []<span class="hljs-keyword">string</span>
	Body <span class="hljs-keyword">string</span>
	IsErr <span class="hljs-keyword">bool</span>
	ErrCode <span class="hljs-keyword">int</span> 
	ErrMessage <span class="hljs-keyword">string</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function </font></font><br>
<br>
<pre><code class="go hljs">Interprete(str <span class="hljs-keyword">string</span>) (*InterpreteData, error)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
accepts the string </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">result</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and creates a reference to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InterpreteData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Progress:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similarly, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choice</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retrieves head and body using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReqParseN2 (str)</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">head is broken into elements using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReqParseHead (head)</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InterpreteData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object is initialized </font><font style="vertical-align: inherit;">and a pointer to it is returned:</font></font></li>
</ul><br>
<pre><code class="go hljs">res := &amp;InterpreteData{<font></font>
	Head: head,<font></font>
	Commands: commands,<font></font>
	Body: body,<font></font>
}<font></font>
<span class="hljs-keyword">return</span> res, <span class="hljs-literal">nil</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This object is used in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.go</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of the main package.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The client package contains the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPConnect</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCPResponseData functions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function</font></font><br>
<br>
<pre><code class="go hljs">TCPConnect(s *types.Settings, data []<span class="hljs-keyword">byte</span>, payload []<span class="hljs-keyword">byte</span>)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
works as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A connection is made to the connection specified in the transferred settings object </font></font><br>
<br>
<pre><code class="go hljs">net.Dial(<span class="hljs-string">"tcp"</span>, s.Host + <span class="hljs-string">":"</span> + s.Port)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The data passed in the data parameter is transferred: </font></font><br>
<br>
<pre><code class="go hljs">conn.Write(data)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Read answer </font></font><br>
<br>
<pre><code class="go hljs">resp, n, _ := TCPResponseData(conn, s.BufSize)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and printed on the console </font></font><br>
<br>
<pre><code class="go hljs">fmt.Println(<span class="hljs-keyword">string</span>(resp[:n]))</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is transmitted then it is transmitted</font></font><br>
<br>
<pre><code class="go hljs">conn.Write(payload)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
and also reads the server response, printing it on the console</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function</font></font><br>
<br>
<pre><code class="go hljs"> TCPResponseData(conn net.Conn, bufsiz <span class="hljs-keyword">int</span>) ([]<span class="hljs-keyword">byte</span>, <span class="hljs-keyword">int</span>, error)</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
creates a buffer of the specified size, reads the server response there and returns this buffer and the number of bytes read, as well as an error object.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client routine</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Serves to transmit commands to the node servers, as well as to obtain brief statistics and testing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It can take the following parameters: a configuration file in JSON format, data to be transmitted to the server as a string, a path to the file to send to payload, a node scheduler emulation flag, the type of data to be transferred as a numerical value.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get the configuration </font></font><br>
<br>
<pre><code class="go hljs">st := types.ParseConfig(*config)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you are given an emu flag starts </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sheduler</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the flag f is specified indicating the path to the file, then load its data in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fdb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and send the contents to the server</font></font><br>
<br>
<pre><code class="go hljs">client.TCPConnect(st, []<span class="hljs-keyword">byte</span>(CMD_BUFFER_LENGTH + <span class="hljs-string">":"</span> + strconv.Itoa(*t) + <span class="hljs-string">"/"</span> + strconv.Itoa(fdblen)), fdb)</code></pre></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the file is not specified, then data from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flag is simply sent </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs">client.TCPConnect(st, []<span class="hljs-keyword">byte</span>(*data), <span class="hljs-literal">nil</span>)</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All of this is a simplified view showing the structure of the protocol. </font><font style="vertical-align: inherit;">During development, the necessary functionality is added to its structure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the second part I will talk about data structures for blocks and transactions, in 3 about a WebSocket server for connecting from JavaScript, in 4 we will consider a synchronization scheduler, then a stack machine that processes bytecode from inputs and outputs, cryptography and output pools.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499718/index.html">We understand VPN protocols</a></li>
<li><a href="../en499720/index.html">TypeScript Exercise Book</a></li>
<li><a href="../en499722/index.html">From Babel to GraphQL: HolyJS 2019 Moscow Talks</a></li>
<li><a href="../en499726/index.html">Handing over 15 million gadget developers</a></li>
<li><a href="../en499728/index.html">Jobs at Google. From Ukraine to Silicon Valley</a></li>
<li><a href="../en499736/index.html">What is taught at the Master of Software Engineering in St. Petersburg HSE</a></li>
<li><a href="../en499740/index.html">"Leak" of a base of specialists Habr Careers</a></li>
<li><a href="../en499742/index.html">Denial of Service Type: How DDoS is Progressing</a></li>
<li><a href="../en499744/index.html">Cloud Security Alarm Security Hub</a></li>
<li><a href="../en499750/index.html">How to scan the entire Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>