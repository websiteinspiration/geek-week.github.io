<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЩМя╕П тЬКЁЯП╛ ЁЯСЙЁЯП╝ .NET рдореЗрдВ Async рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ: рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕ ЁЯУП ЁЯСХ ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C # рдореЗрдВ async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд╛ рдЖрдЧрдорди рд╕рд░рд▓ рдФрд░ рд╕рд╣реА рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЕрдХреНрд╕рд░, рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.NET рдореЗрдВ Async рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ: рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/491236/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C # рдореЗрдВ async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд╛ рдЖрдЧрдорди рд╕рд░рд▓ рдФрд░ рд╕рд╣реА рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЕрдХреНрд╕рд░, рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рди рдХреЗрд╡рд▓ рдЙрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдереНрд░реЗрдбреНрд╕ рдХреЗ рд╕рд╛рде рдереЗ, рдмрд▓реНрдХрд┐ рдирдП рд▓реЛрдЧреЛрдВ рдХреЛ рднреА рдкреЗрд╢ рдХрд░рддреЗ рд╣реИрдВред рдЧрддрд┐рд░реЛрдз рдФрд░ рдЙрдбрд╝рд╛рдиреЗрдВ рдХрд╣реАрдВ рднреА рдирд╣реАрдВ рдЬрд╛рддреА рд╣реИрдВ - рд╡реЗ рдирд┐рджрд╛рди рдХрд░рдирд╛ рдХрдард┐рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/uz/8g/buuz8gok2hqubwnj1773hwimncq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджрд┐рдорд┐рддреНрд░реА рдЗрд╡рд╛рдиреЛрд╡ - рд╣реБрдЖрд╡реЗрдИ рдореЗрдВ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдПрдирд╛рд▓рд┐рд╕рд┐рд╕ рдЯреАрдорд▓реАрдб, рдЬреЗрдЯрдмрд╛рдЗрдиреНрд╕ рд░рд╛рдЗрдбрд░ рддрдХрдиреАрдХ рдХреЗ рдПрдХ рдкреВрд░реНрд╡ рдФрд░ рд░рд┐рд╕реНрдкреЗрд░ рдХреЛрд░ рдХреЗ рдбреЗрд╡рд▓рдкрд░: рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛рдПрдВ, рдХреИрд╢, рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЙрдЯрдиреЗрдЯ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдореНрдореЗрд▓рди рдореЗрдВ рдПрдХ рдирд┐рдпрдорд┐рдд рд╡рдХреНрддрд╛ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрдЯрд╕реНрдХреИрди рдХреЗ рддрд╣рдд - рдбреЛрдЯрдиреЗрдХреНрд╕реНрдЯ 2019 рдкрд╛рдЗрдЯрд░ рд╕рдореНрдореЗрд▓рди рд╕реЗ рджрд┐рдорд┐рддреНрд░реА рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХреА рд╡реАрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдФрд░ рдЯреЗрдХреНрд╕реНрдЯ рдЯреНрд░рд╛рдВрд╕рдХреНрд░рд┐рдкреНрдЯред</font></font><br>
<a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wM-h6P1BJRk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рдХреНрддрд╛ рдХреА рдУрд░ рд╕реЗ рдЖрдЧреЗ рдХрд╛ рдХрдердиред</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдмрд╣реБ-рдереНрд░реЗрдбреЗрдб рдпрд╛ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдореЗрдВ, рдХреБрдЫ рдЕрдХреНрд╕рд░ рдЯреВрдЯ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдЧрддрд┐рд░реЛрдз рдФрд░ рджреМрдбрд╝ рджреЛрдиреЛрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдПрдХ рджреМрдбрд╝ рдПрдХ рд╣рдЬрд╛рд░ рдореЗрдВ рд╕реЗ рдПрдХ рдмрд╛рд░ рджреБрд░реНрдШрдЯрдирд╛рдЧреНрд░рд╕реНрдд рд╣реЛрддреА рд╣реИ, рдЕрдХреНрд╕рд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдирд╣реАрдВ, рдХреЗрд╡рд▓ рдПрдХ рдмрд┐рд▓реНрдб рд╕рд░реНрд╡рд░ рдкрд░, рдФрд░ рдЗрд╕реЗ рдкрдХрдбрд╝рдиреЗ рдореЗрдВ рдХрдИ рджрд┐рди рд▓рдЧрддреЗ рд╣реИрдВред рдореБрдЭреЗ рдпрдХреАрди рд╣реИ рдХрд┐ рдХрдИ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣ рдПрдХ рдкрд░рд┐рдЪрд┐рдд рд╕реНрдерд┐рддрд┐ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдиреБрднрд╡реА рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рднреА рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВ рдЦреБрдж рдХреЛ рдпрд╣ рд╕реЛрдЪрдХрд░ рдкрд╛рддрд╛ рд╣реВрдВ рдХрд┐ рдХреБрдЫ рдЪреАрдЬреЛрдВ рдХреЛ рддреАрди рдЧреБрдирд╛ рдХрдо рдФрд░ рдЕрдзрд┐рдХ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рд▓реЛрдЧреЛрдВ рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╛рдзрди рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЛрдЧ рд╕рд┐рд░реНрдл рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЙрдирдХреА рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЯреВрд▓ рдореЗрдВ рдмрд╣реБрдд рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХреНрд╖рдорддрд╛рдПрдВ (рдХрднреА-рдХрднреА рдЕрддрд┐ рд╕реВрдХреНрд╖реНрдо рднреА рд╣реИрдВ), рд╕реЗрдЯрд┐рдВрдЧреНрд╕, рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн, рдЬреЛ рдЗрд╕ рддрдереНрдп рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рдХреИрд╕реЗ async рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдФрд░ </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ рд╡рд░реНрдЧ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреЛрдЬрдирд╛</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реНрдХреЙрди / рд╡реЗрдЯ рдХреЗ рд╕рд╛рде рд╣рд▓ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд░реЛрдЪ рдХреА рд╕рдорд╕реНрдпрд╛рдПрдВред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╡рд╛рджрд╛рд╕реНрдкрдж рдбрд┐рдЬрд╛рдЗрди рдХреЗ рдЙрджрд╛рд╣рд░рдгред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдХрд╛ рдПрдХ рдХрд╛рд░реНрдп рдЬрд┐рд╕реЗ рд╣рдо рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рд╣рд▓ рдХрд░реЗрдВрдЧреЗред</font></font></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдФрд░ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</font></font></h2><br>
<img src="https://habrastorage.org/webt/v1/ym/30/v1ym304jgxmwh_4kymlyqr4wddi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдореЗрдВ async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ? рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЛрдб рд╣реИ рдЬреЛ рд╕рд╛рдЭрд╛ рдХреА рдЧрдИ рдореЗрдореЛрд░реА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рдо рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, рд╣рдо рдЕрдиреБрд░реЛрдз рдХреЛ рдкрдврд╝рддреЗ рд╣реИрдВ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЕрд╡рд░реБрджреНрдз рдХрддрд╛рд░ рд╕реЗ рдлрд╝рд╛рдЗрд▓ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрдВрдЯрд░рдиреЗрдЯ рдпрд╛ рдбрд┐рд╕реНрдХ рд╕реЗ), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dequeue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд╡рд░реЛрдзрди рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">(рдЕрд╡рд░реБрджреНрдз рдЕрдиреБрд░реЛрдз рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд┐рддреНрд░реЛрдВ рдореЗрдВ рд▓рд╛рд▓ рд░рдВрдЧ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдереНрд░реЗрдбреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, </font><i><font style="vertical-align: inherit;">рд╢реЗрдбреНрдпреВрд▓рд░</font></i><font style="vertical-align: inherit;"> рдкрд░ рд▓реЛрдб рдмрдирд╛рддрд╛ рд╣реИ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд▓реЗрдХрд┐рди рдпрд╣ рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИред рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд▓реЛрдЧ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпреЗ рд╕рд┐рд╕реНрдЯрдо рдПрдХ рд▓рд╛рдЦ рдФрд░ рд▓рд╛рдЦ рдзрд╛рдЧреЗ рджреЛрдиреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВред рд▓реЗрдХрд┐рди рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдХреБрдЫ рдзрд╛рдЧреЗ рдмрд╕ рдирд╣реАрдВ рд▓рд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдереНрд░реЗрдб рд╣реИред рдХреЛрдИ рд╕рд╛рдорд╛рдиреНрдп рдкрд░реНрдпрд╛рдкреНрдд рдпреВрдЖрдИ рдлреНрд░реЗрдорд╡рд░реНрдХ рдирд╣реАрдВ рд╣реИрдВ рдЬрд╣рд╛рдВ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗрд╡рд▓ рдПрдХ рдзрд╛рдЧреЗ рд╕реЗ рдирд╣реАрдВ рд╣реЛрдЧреА, рдлрд┐рд░ рднреАред UI рдереНрд░реЗрдб рдХреЛ рдмреНрд▓реЙрдХ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдФрд░ рдЗрд╕реЗ рдмреНрд▓реЙрдХ рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВ рджреВрд╕рд░реЗ рдЯрд╛рд╕реНрдХ рдХреАред рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ рдХрд┐рд╕реА рддрд░рд╣ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд╣рдо рдЗрд╕реЗ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдХрд░реЗрдВрдЧреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рдореЗрдВ рд╕реЗ рдХрдИ рд▓реЛрдЧреЛрдВ рдиреЗ рд╕реБрдирд╛ рд╣реИ рдХрд┐ рд╕рдорд╛рдирддрд╛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЗ рд╕рдорд╛рди рдирд╣реАрдВ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ: рдХреНрдпрд╛ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдХреЛ рдЕрдзрд┐рдХ рдХреЙрдореНрдкреИрдХреНрдЯ, рд╕реБрдВрджрд░ рдФрд░ рддреЗрдЬ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рдХрд╛рд░реНрдп рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣рдореЗрдВ рдЗрд╕ рддрдВрддреНрд░ рдХреЛ рддрд╛рд▓реЗ, рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЗ рд╕рд╛рде рдЦреАрдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдпрд╛ рдХреНрдпрд╛ рдЗрд╕рд╕реЗ рдХрд┐рд╕реА рддрд░рд╣ рдмрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / рдЗрд╕рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рде рдорджрдж рдХрд╛ </font><i><font style="vertical-align: inherit;">рдЗрдВрддрдЬрд╛рд░</font></i><font style="vertical-align: inherit;"> рдХрд░ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд╛ рдкрде</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдФрд░ .NET рдореЗрдВ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЛ рджреЗрдЦреЗрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдХреЙрд▓ рдХрд░реЗрдВ</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function">Void <span class="hljs-title">Foo</span>(<span class="hljs-params"><span class="hljs-keyword">params</span>, Action callback</span>)</span> {тАж}<font></font>
 <font></font>
<font></font>
<span class="hljs-function">Void <span class="hljs-title">OurMethod</span>(<span class="hljs-params"></span>)</span> {<font></font>
    тАж<span class="hljs-comment">//synchronous code</span><font></font>
 <font></font>
    Foo(<span class="hljs-keyword">params</span>,() =&gt;{<font></font>
       тАж<span class="hljs-comment">//asynchronous code;continuation</span><font></font>
    });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреЙрд▓рдмреИрдХ рд╕реЗ рд╢реБрд░реВ рд╣реБрдИред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдХреЛрдб рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдФрд░ рджреВрд╕рд░реЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ - рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕рд▓реАред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдкрдврд╝рддреЗ рд╣реИрдВ, рдФрд░ рдЬрдм рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЖрдкрдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рднрд╛рдЧ рдХреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдХреЙрд▓рдмреИрдХ</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"><span class="hljs-keyword">params</span>, Action callback</span>)</span> {...} 
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Bar</span>(<span class="hljs-params">Action callback</span>)</span> {...}
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Baz</span>(<span class="hljs-params">Action callback</span>)</span> {...}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OurMethod</span>(<span class="hljs-params"></span>)</span> {<font></font>
    ... <span class="hljs-comment">//synchronous code</span><font></font>
    <font></font>
    Foo(<span class="hljs-keyword">params</span>, () =&gt; { <font></font>
      ... <span class="hljs-comment">//continuation 1 </span><font></font>
      Bar(() =&gt; {<font></font>
        <span class="hljs-comment">//continuation 2</span><font></font>
        Baz(() =&gt; {<font></font>
          <span class="hljs-comment">//continuation 3</span><font></font>
        }); <font></font>
      });<font></font>
    });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдПрдХ рдХреЙрд▓рдмреИрдХ рд╕реЗ рдЖрдк рдПрдХ рдФрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдЖрдк рддреАрд╕рд░реЗ рдХреЙрд▓рдмреИрдХ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдВрдд рдореЗрдВ рдпрд╣ рд╕рдм </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ рд╣реЗрд▓</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bf/vq/8g/bfvq8gknishmtrdwaiixz6mzuvs.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ: рдЕрдкрд╡рд╛рдж</font></font></h3><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"><span class="hljs-keyword">params</span>, Action onSuccess, Action onFailure</span>)</span> {...}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OurMethod</span>(<span class="hljs-params"></span>)</span> {<font></font>
    ... <span class="hljs-comment">//synchronous code </span>
    Foo(<span class="hljs-keyword">params</span>, () =&gt; {<font></font>
      ... <span class="hljs-comment">//asynchronous code on success </span><font></font>
    },<font></font>
    () =&gt; {<font></font>
        ... <span class="hljs-comment">//asynchronous code on failure</span><font></font>
    }); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдХрд╛рдо рдХрд░реЗрдВ? рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ReSharper, рдЬрдм рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрдкрд╡рд╛рджреЛрдВ рдФрд░ рдЕрдЪреНрдЫреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреЛрдб рдХреЗ рд╕рдмрд╕реЗ рд╕реБрдВрджрд░ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ - рдПрдХ рдЕрд╕рд╛рдзрд╛рд░рдг рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдФрд░ рдПрдХ рд╕рдлрд▓ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреЙрд▓рдмреИрдХ рд╣реИрдВред рдкрд░рд┐рдгрд╛рдо рд╕рд┐рд░реНрдл рдПрдХ рдРрд╕реА </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ рдирд░рдХ рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рд▓реЗрдХрд┐рди рд░реИрдЦрд┐рдХ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдкреЗрдбрд╝ рдХреА рддрд░рд╣ рд╣реИ, рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рднреНрд░рдорд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lg/hs/y3/lghsy31j9pke1do-8rpmcyuovfq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET рдореЗрдВ, рдкрд╣рд▓реЗ рдХреЙрд▓рдмреИрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдореЙрдбрд▓</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APM) </font><font style="vertical-align: inherit;">рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рд╡рд┐рдзрд┐ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ </font></font><code>AsyncCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреЛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рд╕рдорд╛рди рд╣реИ </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рд╣реИрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рддрд░реАрдХреЛрдВ рдХреЛ "рдЖрд░рдВрдн" рд╢рдмреНрдж рд╕реЗ рд╢реБрд░реВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдкрдврд╝рдирд╛ рдмрд┐рдЧреНрд░реЗрдб рд╣реИ), рдЬреЛ рдХреБрдЫ рд░рд┐рдЯрд░реНрди рджреЗрддрд╛ рд╣реИ </font></font><code>AsyncResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╕реНрд╡рдпрдВ</font></font><code>AsyncResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдПрдХ рд╣реИрдВрдбрд▓рд░ рд╣реИ рдЬреЛ рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ рдСрдкрд░реЗрд╢рди рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдПрдХ рддрдВрддреНрд░ рд╣реИ </font></font><code>WaitHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЖрдк </font></font><code>WaitHandle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕рдВрдЧрдд рд░реВрдк рд╕реЗ рдкреВрд░реНрдг рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдкрд░реЗрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рджреВрд╕рд░реА рдУрд░, рдЖрдк рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>EndOperation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>EndRead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд░реНрдерд╛рддреН </font><font style="vertical-align: inherit;">, рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рдФрд░ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд▓рдЯрдХрд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЬреЛ рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдХреЗ рд╕рдорд╛рди рд╣реИ </font></font><code>Task.Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рдХрдИ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ рдирд░рдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗ рд╣рдорд╛рд░реА рд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ </font><i><font style="vertical-align: inherit;">рд╣реИ</font></i><font style="vertical-align: inherit;"> ред рджреВрд╕рд░реЗ, рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЕрдкрд╡рд╛рджреЛрдВ рдХрд╛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИред рддреАрд╕рд░рд╛, рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдХреЙрд▓рдмреИрдХ рдХрд┐рд╕ рдереНрд░реЗрдб рдкрд░ рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ - рдХреЙрд▓ рдкрд░ рд╣рдорд╛рд░рд╛ рдХреЛрдИ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд╣реИред рдЪреМрдерд╛, рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ рдХрд┐ рдХреЙрд▓рдмреИрдХ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдХреИрд╕реЗ рдорд┐рд▓рд╛рдПрдВ? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/5z/xr/mr5zxr01ztmadod_fuetd3loqew.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреВрд╕рд░реЗ рдореЙрдбрд▓ рдХреЛ </font><i><font style="vertical-align: inherit;">рдЗрд╡реЗрдВрдЯ-рдЖрдзрд╛рд░рд┐рдд рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдкреИрдЯрд░реНрди</font></i><font style="vertical-align: inherit;"> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрд╣ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╢реАрд▓ рдХреЙрд▓рдмреИрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред рд╡рд┐рдзрд┐ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдЙрд╕ рд╡рд┐рдзрд┐ рдХреЗ рдкрд╛рд╕ рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ </font></font><code>OperationNameAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдИ рд╡рд╕реНрддреБ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдЗрд╕ рдШрдЯрдирд╛ рдХреЛ рдкреВрд░рд╛ рдХрд░рддреА рд╣реИ рдФрд░ рдЗрд╕ рдШрдЯрдирд╛ рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрддреА рд╣реИред рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ рджреЗрдЦрд╛, рдореЗрдВ </font></font><code>BeginOperationName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рд╡рд░реНрддрди </font></font><code>OperationNameAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╕реЙрдХреЗрдЯ рдХреНрд▓рд╛рд╕ рдореЗрдВ рдЬрд╛рдиреЗ рдкрд░ рдХрдиреНрдлреНрдпреВрдЬрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рджреЛ рдкреИрдЯрд░реНрди рдорд┐рдХреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ: </font></font><code>ConnectAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>BeginConnect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ рд░рджреНрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>OperationNameAsyncCancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред .NET рдореЗрдВ рдЪреВрдВрдХрд┐ рдпрд╣ рдХрд╣реАрдВ рдФрд░ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рд╣рд░ рдХреЛрдИ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рджреНрджреЛрдмрджрд▓ рдХрд░рддрд╛ рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдЖрдк рдЧрд▓рддреА рд╕реЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдПрдХ рд╡рд┐рдзрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЬрд░реВрд░реА рдирд╣реАрдВ рд╣реИ </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдПрдХ рд╕рдорд╛рди рдирд┐рд░реНрдорд╛рдг рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6s/w4/4u/6sw44uh3ljw5kwdkowtxylfz5xc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдореЙрдбрд▓ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ рдЬреЛ рдЬрд╛рд╡рд╛ рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдпрджрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рджреЗ рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">, рдФрд░ .NET рдореЗрдВ, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рд╕реНрдХ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреИрдЯрд░реНрди рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реВрдк </font><font style="vertical-align: inherit;">рдореЗрдВ, рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, "рдХрд╛рд░реНрдп"ред рдпрд╣ рд╡рд┐рдзрд┐ рдорд╛рдирддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдЧрдгрдирд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ, рдФрд░ рдЖрдк рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рд╕реНрдерд┐рддрд┐ (рдЪрд▓ рдпрд╛ рд╕рдорд╛рдкреНрдд) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред .NET рдореЗрдВ, </font></font><code>RnToCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреА </font><font style="vertical-align: inherit;">рдПрдХ рддрдерд╛рдХрдерд┐рдд </font><font style="vertical-align: inherit;">, рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЬреБрджрд╛рдИ рд╣реИ: рдХрд╛рд░реНрдп рдХреА рд╢реБрд░реБрдЖрдд рдФрд░ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдХрд░рдирд╛ред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рддреНрд░реБрдЯрд┐ рддрдм рд╣реЛрддреА рд╣реИ рдЬрдм рдХрд┐рд╕реА рдХрд╛рд░реНрдп рдкрд░ рдПрдХ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ </font></font><code>IsCompleted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдлрд▓ рдирд┐рд░рдВрддрд░рддрд╛ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди </font></font><code>RnToCompletion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Canceled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>Faulted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЗрд╕ рдкреНрд░рдХрд╛рд░, UI рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ "рд░рджреНрдж рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЕрдкрд╡рд╛рджреЛрдВ (рдирд┐рд╖реНрдкрд╛рджрди) рдХреА рд╡рд╛рдкрд╕реА рд╕реЗ рднрд┐рдиреНрди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред .NET рдореЗрдВ, рдПрдХ рднреЗрдж рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдпрджрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдЖрдкрдХреА рдЧрд▓рддреА рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рджреНрдж рдХрд░реЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдордЬрдмреВрд░ рдСрдкрд░реЗрд╢рдиред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET рдореЗрдВ, рдПрдХ рдЕрд╡рдзрд╛рд░рдгрд╛ рднреА рд╢реБрд░реВ рдХреА рдЧрдИ рдереА </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдереНрд░реЗрдбреНрд╕ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЕрдореВрд░реНрдд рд╣реИ рдЬреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдп рдХрд╣рд╛рдВ рдЪрд▓рд╛рдирд╛ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдбрд┐рдЬрд╛рдЗрди рд╕реНрддрд░ рдкрд░ рд░рджреНрджреАрдХрд░рдг рд╕рдорд░реНрдерди рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред .NET рдореЗрдВ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рдЧрднрдЧ рд╕рднреА рдСрдкрд░реЗрд╢рдВрд╕ рдХреЛ рдкрд╛рд╕ </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╕рднреА рднрд╛рд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ: рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЛрдЯрд▓рд┐рди рдореЗрдВ рдЖрдк рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░реНрд╡рд╡рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди .NET рдореЗрдВ рдЖрдк рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рд╕рдорд╛рдзрд╛рди рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рдмреАрдЪ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХрд╛ рд╡рд┐рднрд╛рдЬрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд╛рд░реНрдп рдХреЛ рд░рджреНрдж рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╕реНрд╡рдпрдВ рдХрд╛рд░реНрдпред рдЬрдм рдЖрдк рдПрдХ рдХрд╛рд░реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЕрдиреНрдпрдерд╛ рд░рджреНрдж рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ - рдЖрдкрдХреЛ рдЗрд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╡рд┐рд╢реЗрд╖ рдСрдмреНрдЬреЗрдХреНрдЯ </font></font><code>TaskCompletionSoure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдкреБрд░рд╛рдиреЗ рдПрдкреАрдЖрдИ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╡реЗрдВрдЯ-рдЖрдзрд╛рд░рд┐рдд рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреИрдЯрд░реНрди</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдореЙрдбрд▓ рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реИрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдкрдХреЛ рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд░рдиреЗ рдкрд░ рдЕрд╡рд╢реНрдп рдкрдврд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рддрд╕реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рднреА рд╕рдордЭреМрддреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рднреА рд╡рд┐рдзрд┐, рдХрд╛рд░реНрдп рдХреЛ рд▓реМрдЯрд╛рдиреЗ, рдЙрд╕реЗ рдЪрд╛рд▓реВ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрд╣ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ </font></font><code>Created</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрдмрдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рдорд╛рдкреНрдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>Async</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдореЗрд▓</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function">Task <span class="hljs-title">ourMethod</span>(<span class="hljs-params"></span>)</span> {
  <span class="hljs-keyword">return</span> Task.RunSynchronously(() =&gt;{<font></font>
    ... <span class="hljs-comment">//synchronous code</span><font></font>
  })<font></font>
  .ContinueWith(_ =&gt;{<font></font>
    Foo(); <span class="hljs-comment">//continuation 1</span><font></font>
  })<font></font>
  .ContinueWith(_ =&gt;{<font></font>
    Bar(); <span class="hljs-comment">//continuation 2</span><font></font>
  })<font></font>
  .ContinueWith(_ =&gt;{<font></font>
    Baz(); <span class="hljs-comment">//continuation 3</span><font></font>
  })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓рдмреИрдХ рдирд░рдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП </font><font style="vertical-align: inherit;">, рдпрд╣ рдХрдо рд╕реЗ рдХрдо рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдб рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд╡рдЬреВрдж рдЕрдзрд┐рдХ рд░реИрдЦрд┐рдХ рд░реВрдк рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕реБрдзрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рднреА рдиреБрдХрд╕рд╛рди рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ рдФрд░ рдЬрд╛рд░реА рд░рдЦреЗрдВ</font></font></h3><br>
<pre><code class="cs hljs">Task.Factory.StartNew(Action, <font></font>
  TaskCreationOptions, <font></font>
  TaskScheduler, <font></font>
  CancellationToken<font></font>
)<font></font>
Task.ContinueWith(Action&lt;Task&gt;, <font></font>
  TaskContinuationOptions, <font></font>
  TaskScheduler, <font></font>
  CancellationToken<font></font>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд╛рдирдХ рдХрд╛рд░реНрдп рд▓реЙрдиреНрдЪ рдХреЗ рджреМрд░рд╛рди рд╣рдореЗрдВ рддреАрди рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдУрд░ рдореБрдбрд╝рддреЗ рд╣реИрдВ: рдкрд╣рд▓рд╛ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ, рджреВрд╕рд░рд╛ рд╡рд╣ рд╣реИ рдЬрд┐рд╕ </font></font><code>scheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рддреАрд╕рд░рд╛ - </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w_/a4/fw/w_a4fwuiwflisfw-ifxqwtgnpxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TaskScheduler рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдп рдХрд╣рд╛рдБ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдРрд╕реА рд╡рд╕реНрддреБ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рд╡рд┐рдзрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрджрд┐ рдЖрдк рдХрд░рддреЗ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ </font></font><code>thread pool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рддреЛ рд╡рд┐рдзрд┐ </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдереНрд░реЗрдб рд▓реЗрддрд╛ рд╣реИ </font></font><code>thread pool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЖрдкрдХреЗ рдХрд╛рд░реНрдп рдХреЛ рд╡рд╣рд╛рдВ рднреЗрдЬрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдк </font></font><code>scheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдХреЛ </font><font style="vertical-align: inherit;">рд▓реЗрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ, рддреЛ рдпрд╣ рд╕рдм рдХреБрдЫ рдПрдХ рдХрддрд╛рд░ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ, рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдкрд░ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ .NET рдореЗрдВ рдЖрдк рдмрд┐рдирд╛ рдкрд╛рд╕ рдХрд┐рдП рдХрд╛рд░реНрдп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ: рддреЛ рдлрд┐рд░ .NET рдХреИрд╕реЗ рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдХрд┐рд╕ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛? рдЬрдм рдХрд╛рд░реНрдп </font></font><code>StartNew</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрджрд░ </font><font style="vertical-align: inherit;">рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ </font><font style="vertical-align: inherit;">рд╣реИ</font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ThreadStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрд╕реЗ рджрд┐рдпрд╛ рд╣реИ рдХрд┐ </font></font><code>Current</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдбрд┐рдЬрд╝рд╛рдЗрди рдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдХреЗ рдХрд╛рд░рдг рд╡рд┐рд╡рд╛рджрд╛рд╕реНрдкрдж рд▓рдЧрддрд╛ рд╣реИред рдРрд╕реЗ рдорд╛рдорд▓реЗ рдереЗ рдЬрдм </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдирд┐рд╣рд┐рдд рдерд╛ рдЬреЛ рдХрд╣реАрдВ </font></font><code>TaskScheduler.Current</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рдЧрд╣рд░рд╛рдИ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ </font><font style="vertical-align: inherit;">рдФрд░ рдПрдХ рдЕрдиреНрдп рдЕрдиреБрд╕реВрдЪрдХ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдЧрддрд┐рд░реЛрдз рдкреИрджрд╛ рд╣реБрдЖред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдк рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>TaskCreationOption.HideScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрд╣ рдПрдХ рдЦрддрд░реЗ рдХреА рдШрдВрдЯреА рд╣реИ рдЬреЛ рдХрд╣рддреА рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрдЫ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ рдЬреЛ </font></font><code>ThreadStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ </font><font style="vertical-align: inherit;">рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд╕рд╛рде рд╕рдм рдХреБрдЫ рд╕рдорд╛рди рд╣реИред рд╕рд╡рд╛рд▓ рдЙрдарддрд╛ рд╣реИ: рдпрд╣ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рдВрддрд░рддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХрд╣рд╛рдВ рд╕реЗ рдЖрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">? рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдЙрд╕ рдкрджреНрдзрддрд┐ рдореЗрдВ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдкрдиреЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдерд╛ </font></font><code>Continuation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЗрд╕реЗ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереНрд░реЗрдбрд╕реНрдЯреИрдЯрд┐рдХ рд╕реЗ </font><font style="vertical-align: inherit;">рднреА </font><font style="vertical-align: inherit;">рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд┐рд░рдВрддрд░рддрд╛ рдмрд╣реБрдд рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/-f/ne/bt-fnekfbdnfmn4n-u3zrvp7bdc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдУрд░ рдореБрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>TaskCreationOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>TaskContinuationOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЙрдирдХреА рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╣реИрдВред рдЗрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдкреИрд░рд╛рдореАрдЯрд░ рдПрдХ-рджреВрд╕рд░реЗ рдХреЛ рд░рджреНрдж рдХрд░рддреЗ рд╣реИрдВ, рдХреБрдЫ рдкрд░рд╕реНрдкрд░ рдЕрдирдиреНрдп рд╣реИрдВред рдЗрди рд╕рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рднреА рд╕рдВрднрд╡ рд╕рдВрдпреЛрдЬрдиреЛрдВ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╕рдм рдХреБрдЫ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдЬреЛ рд▓рд╛рд▓рд╕рд╛ рдХреЗ рд╕рд╛рде рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ рдХреБрдЫ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдордЭ рд╕реЗ рдмрд╛рд╣рд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ag/us/wh/aguswhpfaos0qjqvfopo_rr8aeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреИрд░рд╛рдореАрдЯрд░ </font></font><code>ExecuteSynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдпрд╛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдХрдИ рдЪреАрдЬреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jm/-c/zv/jm-czv9x4lhhmibfgxqxwjcvxqe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг: рд╣рдордиреЗ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд┐рдпрд╛, рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рд╢реБрднрд╛рд░рдВрдн рдХрд┐рдпрд╛ рдФрд░ рд╕рд╛рде рд╣реА рд╕рд╛рде рджреЛ рдорд╛рдкрджрдВрдб рджрд┐рдП</font></font><code>TaskContinuations.ExecuteSynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рдирд┐рд░рдВрддрд░рддрд╛ рд╢реБрд░реВ рдХреАред </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЗрд╕реЗ рдЙрд╕реА рд╕реНрдЯреИрдХ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд╣рд╛рдВ рдкрд┐рдЫрд▓рд╛ рдХрд╛рд░реНрдп рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рдпрд╛ рдЗрд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ </font></font><code>thread pool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ рддреАрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛрдЧрд╛: рдпрд╣ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/j6/8z/vvj68zu1keb_n50viyk4iqbydae.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskCompletionSource</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЬрдм рдЖрдк рдХрд╛рд░реНрдп рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдо </font></font><code>SetResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдкрд┐рдЫрд▓реЗ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдкреИрдЯрд░реНрди рдХреЛ рдХрд╛рд░реНрдп рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдирд┐рд░реНрдзрд╛рд░рд┐рдд </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВред рдЖрдк </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>tcs.Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ </font></font><code>finish</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдЖрдк рдХреЙрд▓ </font><font style="vertical-align: inherit;">рдХрд░реЗрдВрдЧреЗ рддреЛ рдпрд╣ рдХрд╛рд░реНрдп рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рдПрдЧрд╛ </font></font><code>tcs.SetResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдк рдЗрд╕реЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереНрд░реЗрдб рдкреВрд▓</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐рд░реЛрдз</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд┐рд▓реЗрдЧрд╛ </font><font style="vertical-align: inherit;">ред рд╕рд╡рд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдордиреЗ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рд╣реЛрдиреЗ рдкрд░ рднреА рдХреБрдЫ рдирд╣реАрдВ рд▓рд┐рдЦрд╛ рддреЛ рдХреНрдпреЛрдВ? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v5/g1/2b/v5g12bn0tycbshdrascqvi-hkug.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирдпрд╛ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рджреВрд╕рд░рд╛ рд╕реВрддреНрд░ рд╣реИ рдЬреЛ рдЗрд╕ рдХрд╛рд░реНрдп рдореЗрдВ рдХреБрдЫ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реМ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП рдЙрдореНрдореАрдж рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЧрд┐рд░ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ рд╣рдорд╛рд░рд╛ рдореБрдЦреНрдп рдзрд╛рдЧрд╛ - рд╣рд░рд╛ - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рдиреЗ рдХреЗ </font><i><font style="vertical-align: inherit;">рд▓рд┐рдП</font></i><font style="vertical-align: inherit;"> рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдФрд░ рдпрд╣ рд╣реИред рд╡рд╣ рд╕реНрдЯреИрдХ рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ, рд╕реНрдЯреИрдХ рд▓рдЯрдХрд╛ рд░рд╣рддрд╛ рд╣реИ, рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ</font></font><code>task.Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм </font></font><code>tcs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдЬрд╛рдЧрд░ рд╣реЛред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдиреАрд▓реЗ рдзрд╛рдЧреЗ рдореЗрдВ рд╣рдо </font></font><code>tcs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдлрд┐рд░ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">.NET рдХреЗ рдЖрдВрддрд░рд┐рдХ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЙрдирдХрд╛ </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рдЗрд╕ рдХреА рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ </font></font><code>tcs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛рдиреА рд╕реАрдзреЗ рдПрдХ рд╣реА рд╕реНрдЯреИрдХ рдкрд░, рдлрд┐рд░ </font></font><code>task.Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рд╕реНрдЯреИрдХ рдкрд░ рдЗрд╕реЗ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╣реБрдд рдЕрдЬреАрдм рд╣реИ, рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рд╣рдордиреЗ рдХрд╣реАрдВ рднреА рдирд╣реАрдВ рд▓рд┐рдЦрд╛ рд╣реИ </font></font><code>ExecuteSynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдВрднрд╡рдд: рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдФрд░ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЛ рдорд┐рд▓рд╛рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uv/7z/go/uv7zgosoif24okbeyq7fffwdz8o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдпрд╣ </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ рдХрд┐ рдЬрдм рд╣рдо </font><i><font style="vertical-align: inherit;">рд▓реЙрдХ рдХреЗ</font></i></font><code>SetResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрд╣рдд </font><font style="vertical-align: inherit;">рдХреЙрд▓ </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рддреЛ рдЖрдк рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдХреЙрд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд▓реЙрдХ рдХреЗ рддрд╣рдд рдЖрдк рдХреЗрд╡рд▓ рдХреБрдЫ рдЫреЛрдЯреА рд╕реА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреБрдЫ </font><i><font style="vertical-align: inherit;">рдПрдХреНрд╢рди-рдПрд╕ рдХреЗ</font></i><font style="vertical-align: inherit;"> рдиреАрдЪреЗ рдЪрд▓рд╛рдПрдВ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЕрд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╡реЗ рдХрд╣рд╛рдБ рд╕реЗ рдЖрдП рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХреИрд╕реЗ рдХрд░реЗрдВ?</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">var</span>  tcs  =  <span class="hljs-keyword">new</span>   TaskCompletionSource&lt;<span class="hljs-keyword">int</span>&gt;(<font></font>
       TaskContinuationsOptions.RunContinuationsAsynchronously  <font></font>
) ;<font></font>
<span class="hljs-keyword">lock</span>(mylock)<font></font>
{  <font></font>
    tcs.SetResult(O); <font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ </font></font><code>TaskCompletionSource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ </font><font style="vertical-align: inherit;">рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рд╕реНрдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдб рдХреЗ </font><font style="vertical-align: inherit;">рдЕрдиреБрдХреВрд▓рди рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд╛рдпрдХ </font><font style="vertical-align: inherit;">рд╣реИред </font><font style="vertical-align: inherit;">рд▓рдЧрднрдЧ рд╕рдм рдХреБрдЫ рдкреНрд░рддреАрдХреНрд╖рд┐рдд рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рдЯрд╛рд╕реНрдХ рдХреЙрдордкреНрд▓реЗрдХреНрд╢рдирд╕реНрд░реЛрд╕.рдСрдирдХрд╛рдВрдЙрдЯрд╕реИрд╢рдирдПрд╕реНрдЯреНрд░рд┐рдВрдХреНрд░рд┐рдпрд╕рд▓реА" рдХреЗ рд░реВрдк рдореЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рд╣рдореЗрд╢рд╛ рджреГрдврд╝рддрд╛ рд╕реЗ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рд▓рдЧрднрдЧ рд╣рдореЗрд╢рд╛ рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЗ </font></font><code>tcs.SetResult</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд╕ рдХреБрдЫ рд╣реИ рдЬрд┐рд╕рдХреЗ рддрд╣рдд рдХреБрдЫ рднреА рд▓реЙрдиреНрдЪ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ap/_-/ab/ap_-abu8wjhwxr0edsvayrcc-6w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП? </font><font style="vertical-align: inherit;">рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ </font></font><code>RunContinuationsAsynchronously</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ </font></font><code>ContinueWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рд╣рдорд╛рд░рд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рд╣рдорд╛рд░реЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/zj/6q/qbzj6q1fjhhqozii8yec5ok3pcy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдкреИрд░рд╛рдореАрдЯрд░ рдХреИрд╕реЗ рд╕рд╣рдЬ рдирд╣реАрдВ рд╣реИрдВ, рд╡реЗ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдЕрдВрддрд░рдВрдЧ рд╣реИрдВ, рдХреИрд╕реЗ рд╡реЗ рд╕рдВрдЬреНрдЮрд╛рдирд╛рддреНрдордХ рдЬрдЯрд┐рд▓рддрд╛ рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВ - рдпрд╣ рд▓рд┐рдЦрдирд╛ рдЗрддрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рддрд╛-рдкрд┐рддрд╛-рдмрдЪреНрдЪреЗ рдкрджрд╛рдиреБрдХреНрд░рдо</font></font></h3><br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
  <span class="hljs-comment">//... some parent activity</span><font></font>
<font></font>
   Task.Factory.StartNew(() =&gt; {<font></font>
      <span class="hljs-comment">//... some child activity</span><font></font>
   })<font></font>
<font></font>
})<font></font>
.ContinueWith(...) <span class="hljs-comment">// donтАЩt wait for child</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрд░реЗрдВрдЯ-рдЪрд╛рдЗрд▓реНрдб</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрджрд╛рдиреБрдХреНрд░рдо </font><font style="vertical-align: inherit;">рддрдм рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдЬрдм рдЖрдк рдПрдХ рдХрд╛рд░реНрдп рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рддрд╣рдд рджреВрд╕рд░рд╛ рдЪрд▓рд╛рддреЗ рд╣реИрдВред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрджрд┐ рдЖрдк рд▓рд┐рдЦрдирд╛ </font></font><code>ContinueWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ, рддреЛ рдЖрдк </font></font><code>ContinueWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗ рдЕрдВрджрд░ рдХрд╛ рд╢реБрднрд╛рд░рдВрдн рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/se/28/gwse28nxykd4vfwt_chfw0qjt_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдк рд▓рд┐рдЦреЗрдВрдЧреЗ </font></font><code>TaskCreationOptions.AttachedToParent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ </font></font><code>ContinueWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрддрдЬрд╛рд░ рд░рд╣реЗрдЧрд╛ред рдЖрдк рдЕрдкрдиреЗ рдЙрддреНрдкрд╛рджреЛрдВ рдореЗрдВ рдЗрд╕ рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рд░ рдХреЛрдИ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд╕рд╛рде рдЖ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдПрдХ рдкрджрд╛рдиреБрдХреНрд░рдо рд╣реИ, рдХрд╛рд░реНрдп рдХреЗ рд╕рд╛рде рд╕рдмрдЯрд╕реНрдХ рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдЙрдкрд╢реАрд░реНрд╖рдХ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реНрдХреЙрд╕реНрдХред рдХрд╣реАрдВ рднреА рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font></font><code>WaitForChildren</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдпрд╣ рдкреНрд░рддреАрдХреНрд╖рд╛ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рд╣реЛрддреА рд╣реИред рдпрд╣реА рд╣реИ, рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рд╢рд░реАрд░ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░реНрдг рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рддрдм рддрдХ рдЕрдкрдиреА рдирд┐рд░рдВрддрд░рддрд╛ рд╢реБрд░реВ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдмрдЪреНрдЪреЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗред</font></font><br>
<br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
  <span class="hljs-comment">//... some parent activity</span><font></font>
  Foo(); <font></font>
<font></font>
})<font></font>
.ContinueWith(...) <span class="hljs-comment">// still wait for child</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>)</span> { <font></font>
   Task.Factory.StartNew(() =&gt; {<font></font>
      <span class="hljs-comment">//... parent task to attach is in ThreadStatic</span><font></font>
   }, TaskCreationOptions.AttachedToParent); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдРрд╕реА рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд╛рд░реНрдп рдХреЛ рдХрд╣реАрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд </font></font><code>ThreadStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХреА рдЧрдИ рд╣рд░ рдЪреАрдЬ </font></font><code>AttachedToParent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЗрд╕ рдореВрд▓ рдХрд╛рд░реНрдп рдореЗрдВ рдЬреЛрдбрд╝ </font><font style="vertical-align: inherit;">рджрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЬрд╛рдПрдЧрд╛, рдЬреЛ рдХрд┐ рдПрдХ рдЦрддрд░реЗ рдХреА рдШрдВрдЯреА рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
  <span class="hljs-comment">//... some parent activity</span><font></font>
<font></font>
  Foo();<font></font>
}, TaskCreationOptions.DenyChildAttach)<font></font>
.ContinueWith(...) <span class="hljs-comment">// donтАЩt wait for child</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>)</span> { <font></font>
   Task.Factory.StartNew(() =&gt; {<font></font>
      <span class="hljs-comment">//... some child activity</span><font></font>
   }, TaskCreationOptions.AttachedToParent); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреВрд╕рд░реА рдУрд░, рдПрдХ рд╡рд┐рдХрд▓реНрдк рд╣реИ рдЬреЛ рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд░рджреНрдж рдХрд░рддрд╛ рд╣реИ </font></font><code>DenyChildAttach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЕрдХреНрд╕рд░ рд╣реЛрддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs">Task.Run(() =&gt; <font></font>
{<font></font>
  <span class="hljs-comment">//... some parent activity</span><font></font>
<font></font>
  Foo(); <font></font>
<font></font>
})<font></font>
.ContinueWith(...) <span class="hljs-comment">//donтАЩt wait for child</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>)</span> { <font></font>
   Task.Factory.StartNew(() =&gt; {<font></font>
      <span class="hljs-comment">//... some child activity</span><font></font>
    }, TaskCreationOptions.AttachedToParent); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдпрд╛рдж рд░рдЦрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ </font></font><code>Task.Run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рдорд╛рдирдХ рддрд░реАрдХрд╛ рд╣реИ, рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╣реЛрддрд╛ рд╣реИ </font></font><code>DenyChildAttach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдЬреЛ рдЖрдк рдореЗрдВ </font></font><code>ThreadStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдЯрд┐рд▓рддрд╛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред рдЖрдк рдпрд╣ рдирд╣реАрдВ рд╕рдордЭрддреЗ рдХрд┐ рдХрд╛рд░реНрдп рдХреИрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рд╕рдВрджрд░реНрдн рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдЬреЛ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддреА рд╣реИ, рд╡рд╣ async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреА рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╕реНрдерд┐рддрд┐ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдореЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреНрд░рд┐рдпрд╛рдПрдБ рд╣реИрдВред рдирд┐рд░рдВрддрд░рддрд╛ рдИрдорд╛рдирджрд╛рд░ рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╣реИред рдЬрдм рдЖрдк async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font></font><code>AttachedToParent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЯрд╛рдИ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рд╕рд╣реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k7/q5/vg/k7q5vgi8h9qwvvo3akgzow8vu_q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдкрдХреЗ рдкрд╛рд╕ рдирд┐рд░рдВрддрд░рддрд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдЫрд╣ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред рдЖрдкрдиреЗ рдЯрд╛рд╕реНрдХ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛, рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛</font></font><code>ContinueWith</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреНрд░рд╢реНрди: рдЗрд╕ рдирд┐рд░рдВрддрд░рддрд╛ рдХреА рдХреНрдпрд╛ рд╕реНрдерд┐рддрд┐ рд╣реЛрдЧреА? </font><font style="vertical-align: inherit;">рдкрд╛рдБрдЪ рд╕рдВрднрд╛рд╡рд┐рдд рдЙрддреНрддрд░ рд╣реИрдВ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреВрд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рддреНрд░реБрдЯрд┐ рдореЗрдВ рд╣реЛрдЧрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рд╕реНрддреАрдХрд░рдг рд╣реЛрдЧрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдкреВрд░реНрдгрддрд╛ рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪреЗрдЧрд╛, рдпрд╣ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдВрдЧ рдореЗрдВ рд╣реЛрдЧрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХрд▓реНрдк - "рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ"ред</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/5u/x5/1k/5ux51kwpr4aixg_2io3xroerxam.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХрд╛рд░реНрдп "рд░рджреНрдж" рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрд╣реАрдВ рднреА "рд░рджреНрдж" рд╢рдмреНрдж рдХрд╣реАрдВ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣рдо рд░рд┐рд╕реЗрдкреНрд╢рди рдлреЗрдВрдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЛрдб рдХреЛ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдкрдврд╝рддреЗ рд╣реИрдВ - рднрд▓реЗ рд╣реА рдЖрдк рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ 10 рдорд┐рдирдЯ рдкрд╣рд▓реЗ рдЬрд╛рдирддреЗ рд╣реЛрдВ - рдЖрдк рдЕрднреА рднреА рднреВрд▓ рдЬрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд▓рд┐рдЦреЛ рдорддред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рджреНрдж рдХрд░рдирд╛</font></font></h3><br>
<br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> OperationCanceledException(); <font></font>
});<font></font>
<font></font>
                                                      Failed</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдп рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рддреАрд╕рд░рд╛ рдкреИрд░рд╛рдореАрдЯрд░ kancellation рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рд▓рд┐рдЦрддреЗ рд╣реИрдВ </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">рдЕрд░реНрдерд╛рддреН </font><font style="vertical-align: inherit;">, рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреНрд░рд┐рдпрд╛ рдЬреЛ "рд░рджреНрдж" рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдХрд╛рд░реНрдп "рд╡рд┐рдлрд▓" рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╛рди </font><font style="vertical-align: inherit;">рдирд╣реАрдВ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> OperationCanceledException(cancellationToken); <font></font>
}, cancellationToken);<font></font>
<font></font>
                                                      Canceled</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>Canceled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдкрдХреЛ рдЗрд╕реЗ </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рд░рджреНрдж </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдлреЗрдВрдХрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ, рдЖрдк рдХрднреА рднреА рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
    cancellationToken.ThrowIfCancellationRequested(); <font></font>
}, cancellationToken);<font></font>
                                                       Canceled</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреНрдпрд╛ рд░рджреНрджреАрдХрд░рдг рдХреЛ рд░реЛрдХрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ? </font><font style="vertical-align: inherit;">рдХрд╣реАрдВ рдХрд╛рд░реНрдп рдХреЗ рдЕрдВрджрд░, рдЖрдк рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕реА рдиреЗ рдЖрдкрдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рд╣реИ: рдлреЗрдВрдХ рдлреЗрдВрдХ рд░рджреНрдж рдХрд░реЗрдВ, рдлрд┐рд░ рдХрд╛рд░реНрдп рд░рд╛рдЬреНрдп рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>Canceled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╛ рдХрд┐рд╕реА рдиреЗ рд░рди рд╕рдордп рдореЗрдВ "рд░рджреНрдж рдХрд░реЗрдВ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛ рдФрд░ рдХрд╛рд░реНрдп рдХреЛ рд░рджреНрдж рдХрд░ рджрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">JetBrains рдореЗрдВ рд╣рдорд╛рд░рд╛ рдЕрднреНрдпрд╛рд╕ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЗрди рдЯреЛрдХрди рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OperationCanceledException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд┐рд▓рддреА рд╣реИ </font><font style="vertical-align: inherit;">- рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдЬреЛ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдХреБрдЫ рд░рджреНрджреАрдХрд░рдг рд╣реБрдЖ рд╣реЛ, рддреЛ рдЖрдк рдЗрд╕реЗ рдЕрд▓рдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдмрд╕ рдХрд╛рд░реНрдп рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЙрдЧ рдЗрди рди рдХрд░реЗрдВ рдФрд░ рдЬрдм рдЖрдк рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ - рд▓реЙрдЧ рдЗрди рдХрд░реЗрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд╣рд░рд╛ рдвреЗрд░</font></font></h3><br>
<pre><code class="cs hljs">Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
    Foo();<font></font>
}, cancellationToken);<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>)</span> { <font></font>
     Bar() {<font></font>
       ...<font></font>
          Baz() {<font></font>
             <span class="hljs-comment">//how to get cancellation token?</span><font></font>
          } <font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЧрд╣рд░рд╛ рдвреЗрд░ рд╣реИред рдпрд╣ </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХрдорд╛рддреНрд░ рд╕реНрдкрд╖реНрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИ рдЬрд┐рд╕ рдкрд░ рд╣рдордиреЗ рдЪрд░реНрдЪрд╛ рдХреАред рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╕рднреА рдкрджрд╛рдиреБрдХреНрд░рдореЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рд░ рдЬрдЧрд╣ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдореБрдЭреЗ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЕрдЧрд░ рдПрдХ рдЧрд╣рд░реА рдкрджрд╛рдиреБрдХреНрд░рдо рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдкрдХреЛ рд░рд┐рд╕реЗрдкреНрд╢рди рдХреЛ рдлреЗрдВрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдкрдиреЗ рдХрд╛рдо рдХреЛ рдХрд╣реАрдВ рд╕рдмрд╕реЗ рдХрдо рд╕реНрддрд░ рдкрд░ рд░рджреНрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? рдРрд╕реА рд╣реА рдПрдХ рдЦрд╛рд╕ рдЯреНрд░рд┐рдХ рд╣реИ рдЬрд┐рд╕рдХрд╛ рд╣рдо рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВред рдЙрд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>AsyncLocal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">static</span> AsyncLocal&lt;Cancelation&gt; asyncLocalCancellation;<font></font>
<font></font>
Task.Factory.StartNew(() =&gt; <font></font>
{<font></font>
     asyncLocalCancellation.Set(cancellationToken) <font></font>
    Foo();<font></font>
}, cancellationToken); <span class="hljs-comment">// use AsyncLocal to put cancellation int</span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Foo</span>(<span class="hljs-params"></span>)</span> { 
     <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">Bar</span>(<span class="hljs-params"></span>)</span> {<font></font>
      ...<font></font>
         Baz() {<font></font>
             asyncLocalCancellation.Value.CheckForInterrupt(); <font></font>
         }<font></font>
   } <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ </font></font><code>ThreadStatic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ </font><font style="vertical-align: inherit;">рдЙрд╕реА </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ </font><font style="vertical-align: inherit;">рдХреЗ рд╕рдорд╛рди рд╣реИ </font></font><code>ThreadLocal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ async / рд╡реЗрдЯ рдХреЛрдб рдЯреНрд░рд┐рдк рд╕реЗ рдмрдЪрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рдЖрдкрдХрд╛ рдХреЛрдб рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╣реИ, рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдпрд╣ kancellation рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдбрд╛рд▓рддреЗ рд╣реИрдВ </font></font><code>AsyncLocal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдХрд╣реАрдВ рдЧрд╣рд░реЗ рд╕реНрддрд░ рдкрд░ рдЖрдк " </font></font><code>CheckForInterrupt Throw If Cancellation Requested</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font><font style="vertical-align: inherit;">рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░, рдпрд╣ рдПрдХрдорд╛рддреНрд░ рдкреИрд░рд╛рдореАрдЯрд░ </font></font><code>CancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ рдЬрд┐рд╕реЗ рд╕рдВрдкреВрд░реНрдг рдХреЛрдб рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдзрдмреНрдмрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди, рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рдЕрдзрд┐рдХрд╛рдВрд╢ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рд╣реБрдЖ </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдЗрд╕рд╕реЗ рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд▓рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕рд╛ рд░рд╛рдЬреНрдп: рд░рджреНрдж рдпрд╛ рд╡рд┐рдлрд▓ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдЬреНрдЮрд╛рдирд╛рддреНрдордХ рдЬрдЯрд┐рд▓рддрд╛</font></font></h3><br>
<pre><code class="cs hljs">Task.Factory.StartNew(Action, <font></font>
    TaskCreationOptions, <font></font>
    TaskScheduler, <font></font>
    CancellationToken<font></font>
)<font></font>
                                                   JetBrains.Lifetimes<font></font>
<font></font>
lifetime.Start(TaskScheduler, Action) <span class="hljs-comment">//puts lifetime in AsyncLocal</span><font></font>
<font></font>
lifetime.StartMainRead(Action) <font></font>
lifetime.StartMainWrite(TaskScheduler, Action) <font></font>
lifetime.StartBackgroundRead(TaskScheduler, Action)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдХреЛрдб рдХреЛ рдкрдврд╝рдирд╛ рдЬрд┐рддрдирд╛ рдХрдард┐рди рд╣реЛрддрд╛ рд╣реИ, рддреНрд░реБрдЯрд┐ рдХрд╛ рдЦрддрд░рд╛ рдЙрддрдирд╛ рд╣реА рдЕрдзрд┐рдХ рд╣реЛрддрд╛ рд╣реИред рдПрдХ рд╡рд░реНрд╖ рдХреЗ рдмрд╛рдж рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдЖрдк рдпрд╣ рднреВрд▓ рдЬрд╛рдПрдВрдЧреЗ рдХрд┐ рдпрд╣ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВред рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ рдкрд╛рд╕ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JetBrains.Lifetimes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдЖрдзреБрдирд┐рдХ рдЬреАрд╡рдирдХрд╛рд▓, рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдХреИрдВрд╕реЗрд▓реЗрд╢рдирдЯреЛрдХрди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╕реНрдЯрд╛рд░реНрдЯ рд╡рд┐рдзрд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреИрд╕рд╛ рдХрд┐ </font></font><code>Task.Factory.StartNew</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>TaskCreationOptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╢реЗрдбреНрдпреВрд▓рд░реНрд╕ рдХреА рдПрдХ рдЫреЛрдЯреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд░реАрдб рд▓реЙрдХ рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп рдереНрд░реЗрдб рдкрд░ рдХрд┐рд╕реА рдХрд╛рд░реНрдп рдХреЛ рд╢реЗрдбреНрдпреВрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣реА рд╣реИ, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реАрдб рд▓реЙрдХ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреБрдЫ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЪреБрдирддреЗ рд╣реИрдВ, рдпрд╣ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрд╕реВрдЪрдХ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рдореБрдЦреНрдп </font><i><font style="vertical-align: inherit;">рд▓реЙрдХ рдкрд░ рд░реАрдб рд▓реЙрдХ рдХреЗ</font></i><font style="vertical-align: inherit;"> рд╕рд╛рде рд╢реЗрдбреНрдпреВрд▓ рдХрд░рддрд╛ рд╣реИ</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╕рд╛рде рд╣реА рд░рд╛рдЗрдЯ рд▓реЙрдХ, рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдереНрд░реЗрдб рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп рдзрд╛рдЧрд╛ - рдФрд░ рдЕрдм рдлреЗрд░рдмрджрд▓ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрд░реАрдХреЗ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реЛ рдЧрдП рд╣реИрдВред рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ, рдЬреАрд╡рдирдХрд╛рд▓ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд░рджреНрдж рдХрд░ рджреЗрддрд╛ рд╣реИ </font></font><code>AsyncLocal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреЛрдб рдХреЛ рдХрд╛рдлреА рд╕рд░рд▓ рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/1n/gu/_h1ngucdl-vvbpyyalkk_gwvapu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ </font><font style="vertical-align: inherit;">рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдФрд░ рд╡реЗ рдХрд┐рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдХреЛрдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдбред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИ рдХрд┐ рдХреЛрдб ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЙрдпрд▓рд░-рдкреНрд▓реЗрдЯ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рдХреЗ </font><font style="vertical-align: inherit;">рдмрд╣реБрдд рдХрдо рджреЛрд╣рд░рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯреБрдХрдбрд╝реЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рджреВрд╕рд░реЗ, рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИ рдХрд┐ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЗ рд╕рдорд╛рди рд╣реИ, рдпрд╣ рдареАрдХ рд╡реИрд╕рд╛ рд╣реА рд╣реИ рдЬреИрд╕реЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕рд┐рдВрдХреНрд╕ / рд╡реЗрдЯ рдХреЗ рд▓рд┐рдП рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдЖрдк рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдЖрдкрдиреЗ рдереНрд░реЗрдбреНрд╕ рдХреЛ рдЙрдард╛рдП рдмрд┐рдирд╛, рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛ рд▓рд┐рдЦрд╛ рдерд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдВрдХрд▓рдХ рдХреНрдпрд╛ рддреИрдирд╛рдд рдХрд░реЗрдЧрд╛? рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдХрд╛рд░реНрдп рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдирд┐рд╖реНрдкрд╛рджрд┐рдд </font></font><code>InnerAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░реЗрдЧрд╛, рдЬрд╣рд╛рдВ рд╕реЗ рд╡рд┐рд╢реЗрд╖ рдЧреЗрдЯрд╡рд╛рдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдЖрдПрдЧрд╛ред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ </font></font><code>TaskAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЖрдк рдХрд┐рд╕реА рднреА рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рд╡реЗрдЯрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред рдирддреАрдЬрддрди, рд╣рдо рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>InnerAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>continuationCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрджрд┐ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реБрдЖ, рддреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рдВрддрд░рддрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╕рдВрдЧ рд╢реЗрдбреНрдпреВрд▓рд░</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рд╢реЗрдбреНрдпреВрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐, рднрд▓реЗ рд╣реА рдЖрдкрдиреЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрд╛рд░реЗ рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реЛ </font><font style="vertical-align: inherit;">, рдмрд┐рд▓рдХреБрд▓ рд╕рдм рдХреБрдЫ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХрд╣рд▓рд╛рдПрдЧрд╛ред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <font></font>
  synchronousCode();<font></font>
   <span class="hljs-keyword">await</span> InnerAsync();
   <span class="hljs-keyword">await</span> Task.Yield(); <span class="hljs-comment">//guaranteed !IsCompleted </span><font></font>
   continuationCode();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдЪрд╛рд▓ рд╣реИ </font></font><code>Task.Yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдп рд╣реИ рдЬреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рд╡реЗрдЯрд░ рд╣рдореЗрд╢рд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдЖрдПрдЧрд╛ </font></font><code>IsCompleted</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рддрджрдиреБрд╕рд╛рд░, </font></font><code>continuation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЗрд╕ рд╕реНрдерд╛рди рдкрд░ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдирд╣реАрдВ рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ред UI рдереНрд░реЗрдб рдХреЗ рд▓рд┐рдП, рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдЗрд╕ рдереНрд░реЗрдб рдХреЛ рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдирд╣реАрдВ рд▓реЗрддреЗ рд╣реИрдВред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jg/jy/7d/jgjy7dh0cnbslfcyk4jpyapc9du.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдзрд╛рдЧрд╛ рдХреИрд╕реЗ рдЪреБрдиреЗрдВ? </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / рдкреНрд░рддреАрдХреНрд╖рд┐рдд</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджрд░реНрд╢рди </font><font style="vertical-align: inherit;">рдпрд╣ рд╣реИ: рдЖрдк рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЗ рд╕рдорд╛рди рд▓рд┐рдЦрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереНрд░реЗрдб рдкреВрд▓ рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">рддреЛ рдЗрд╕рд╕реЗ рдЖрдкрдХреЛ </font><font style="vertical-align: inherit;">рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рд╣реИ - рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛрдб рдХреЛ рджреВрд╕рд░реЗ рдереНрд░реЗрдб рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕ рдмрд╛рдд рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдХрд┐ </font></font><code>InnerAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдЖрдк </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрддрдЬрд╛рд░</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░ </font><i><font style="vertical-align: inherit;">рд░рд╣реЗ рдереЗ</font></i><font style="vertical-align: inherit;"> рдпрд╛ рдирд╣реАрдВ </font><font style="vertical-align: inherit;">рддреЛ </font><font style="vertical-align: inherit;">рдпрд╣ </font><font style="vertical-align: inherit;">рдкреВрд░рд╛ рд╣реЛ </font><font style="vertical-align: inherit;">рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЖрдкрдХреЛ рдпреВрдЖрдИ рдереНрд░реЗрдб рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдп рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рддрдВрддреНрд░ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ: рдЗрд╕реЗ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ</font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕рд╕реЗ рдирд┐рд░реНрдорд╛рдг рд╣реЛрддрд╛ рд╣реИ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SynchronizationContext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреЛрд╕реНрдЯ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рдЪреАрдЬ рд╣реИ, рдЬреЛ рд╡рд┐рдзрд┐ рдХреЗ рд╕рдорд╛рди рд╣реИ </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ </font></font><code>TaskScheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреЛ рдкрд╣рд▓реЗ рдерд╛, рд╡рд╣ рдмрд╕ рд▓реЗрддрд╛ рд╣реИ </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдкреЛрд╕реНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрд╕ рдкрд░ рдЕрдкрдирд╛ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <font></font>
  synchronousCode();<font></font>
<font></font>
    <span class="hljs-keyword">await</span> InnerAsync().ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
    continuationCode(); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ </font></font><code>ContinueOnCapturedContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">.NET рдореЗрдВ рд╕рдмрд╕реЗ рдШреГрдгрд┐рдд API рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдкреАрдЖрдИ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡реЗрдЯрд░ рдмрдирд╛рддрд╛ рд╣реИ, рдЙрд╕рд╕реЗ рдЕрд▓рдЧ </font></font><code>TaskAwaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдмрджрд▓рддрд╛ рд╣реИ, рдпрд╣ рдЙрд╕реА рдзрд╛рдЧреЗ рдкрд░ рдЪрд▓рддрд╛ рд╣реИ, рдЙрд╕реА рд╕рдВрджрд░реНрдн рдореЗрдВ рдЬрд┐рд╕рдореЗрдВ рд╡рд┐рдзрд┐ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдИ </font></font><code>InnerAsync </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЬрд╣рд╛рдВ рдХрд╛рд░реНрдп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <font></font>
  synchronousCode();<font></font>
<font></font>
    <span class="hljs-keyword">await</span> InnerAsync().ConfigureAwait(continueOnCapturedContext: <span class="hljs-literal">false</span>); <font></font>
    continuationCode(); <span class="hljs-comment">//code must be absolutely context-agnostic</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╕рд▓рд╛рд╣ рдХреА рдПрдХ рдкрд╛рдЧрд▓ рд░рд╛рд╢рд┐ рд╣реИ: рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐рд░реЛрдз рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рддреЛ рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рд╕рднреА рдХрдиреНрдлрд┐рдЧрд░рдПрд╡рд┐рдЯ рдХреЛрдб рдХреЛ рд╕реНрдорд┐рдпрд░ рдХрд░реЗрдВ рдФрд░ рд╕рдмрдХреБрдЫ рдареАрдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЧрд▓рдд рддрд░реАрдХрд╛ рд╣реИред </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдпрд╛ рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ, рдХреБрдЫ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐рд░реЛрдз</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">//UI thread </span><font></font>
  synchronousCode();<font></font>
<font></font>
    <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">10</span>).ConfigureAwait(continueOnCapturedContext: <span class="hljs-literal">false</span>); <font></font>
    continuationCode();<font></font>
}<font></font>
myFuncAsync().Wait() <span class="hljs-comment">//on UI thread</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐рд░реЛрдз рд╣реИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">UI рдереНрд░реЗрдб рдкрд░, рдЙрдиреНрд╣реЛрдВрдиреЗ рджрд╕ рд╕реЗрдХрдВрдб рдЗрдВрддрдЬрд╛рд░ рдХрд┐рдпрд╛ рдФрд░ рдХрд┐рдпрд╛ </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдкрдиреЗ рдЬреЛ рдХрд┐рдпрд╛ рд╣реИ </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЙрд╕рдХреЗ </font><font style="vertical-align: inherit;">рдХрд╛рд░рдг </font><font style="vertical-align: inherit;">рдЗрд╕реЗ </font></font><code>continuationCode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрднреА рд▓реЙрдиреНрдЪ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдпрд╣ </font><font style="vertical-align: inherit;">рдХрднреА рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдЖрдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдм рдмрд╣реБрдд рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">OnBluttionClick</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">//UI thread </span>
  <span class="hljs-keyword">int</span> v = Button.Text.ParseInt();<font></font>
<font></font>
    <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">10</span>).ConfigureAwait(continueOnCapturedContext: <span class="hljs-literal">false</span>); <font></font>
  Button.Text.Set((v+<span class="hljs-number">1</span>).ToString());<font></font>
}<font></font>
myFuncAsync().Wait() <span class="hljs-comment">//on UI thread</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд▓реНрдкрдирд╛ рдХреАрдЬрд┐рдП рдХрд┐ рдпрд╣ рдХреБрдЫ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рд╣реИред рд╣рдордиреЗ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛, рдЗрд╕реЗ рд▓рд┐рдпрд╛ </font></font><code>Button.ParseInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрддрдЬрд╛рд░ рдХрд┐рдпрд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рд▓рд┐рдЦрд╛ </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдХрд╣рд╛: "рдХреГрдкрдпрд╛ рд╣рдорд╛рд░реЗ UI рд╕реНрдЯреНрд░реАрдо рдХреЛ рдмрдВрдж рди рдХрд░реЗрдВ, рдЬрд╛рд░реА рд░рдЦреЗрдВред" рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI рдереНрд░реЗрдб рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рдмрд╛рдж рджреВрд╕рд░рд╛ рднрд╛рдЧ </font><font style="vertical-align: inherit;">рднреА рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рджрд░реНрд╢рди рд╣реИ </font><font style="vertical-align: inherit;">ред рдпрд╣реА рд╣реИ, рдЖрдкрдХрд╛ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЗ рд╕рдорд╛рди рджрд┐рдЦрддрд╛ рд╣реИ, рдФрд░ рдЙрд╕реА рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдПрдХ рддреНрд░реБрдЯрд┐ рд╣реЛрдЧреАред рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ </font></font><code>Button.Text.Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рднреА рд╡рд┐рдзрд┐ рдХреЙрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЙрдирдХреЗ рд╕рдВрджрд░реНрдн рдХреЛ рднреА рдорд╛рдирддреА рд╣реИред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ? рддреБрдо рдпрд╣ рдХреЗрд░ рд╕рдХрддреЗ рд╣реЛ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">//UI thread </span><font></font>
  synchronousCode();<font></font>
<font></font>
    <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">10</span>).ConfigureAwait(continueOnCapturedContext: <span class="hljs-literal">false</span>); <font></font>
    continuationCode(); <span class="hljs-comment">//The same UI context</span><font></font>
}<font></font>
PumpUntil(() =&gt; task.IsCompleted);<font></font>
<span class="hljs-comment">//VS synchronization contexts always pump on any Wait</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UI рдереНрд░реЗрдб рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЛ рдЙрди </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереНрд░реЗрдбреНрд╕ рдкрд░ </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдкрд░ </font><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рдмрдВрдз рд▓рдЧрд╛рдирд╛ рд╣реЛрдЧрд╛, </font><font style="vertical-align: inherit;">рдЬрд┐рдирдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рд╣реЛред рдХрд░рдиреЗ </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рдмрдЬрд╛рдп </font></font><code>ConfigureAwait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдк рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдЗрд╕ рдХрддрд╛рд░ рдХреЛ рдкрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рд╛рде рд╣реА, рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рднреА рдкрдВрдк рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрджрд┐ рдЖрдк рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдФрд░ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЛ рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдорд┐рд╢реНрд░рдг рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдЗрд╕рд╕реЗ рдмрдЪрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреБрд░рд╛рдирд╛ рдХреЛрдб рд╣реИ, рдФрд░ рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдорд┐рд▓рд╛рдирд╛ рд╣реЛрдЧрд╛, рдлрд┐рд░ рдЖрдк UI рд╕реНрдЯреНрд░реАрдо рдХреЛ рдкрдВрдк рдХрд░реЗрдВрдЧреЗред рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдиреЗ рдЙрдореНрдореАрджреЛрдВ рдкрд░ рдпреВрдЖрдИ рдереНрд░реЗрдб рдХреЛ рдкрдВрдк рдХрд┐рдпрд╛, рдпрд╣ </font></font><code>SynchronizationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереЛрдбрд╝рд╛ рдмрджрд▓ рдЧрдпрд╛ред рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдкрд░ WaitHandle рдореЗрдВ рдЬрд╛рддреЗ рд╣реИрдВ </font></font><code>Wait</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рддреЛ рдЬрдм рдЖрдк рд▓рдЯрдХрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХрд╛ UI рд╕реНрдЯреНрд░реАрдо рдкрдВрдк рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╡реЗ </font><font style="vertical-align: inherit;">рджреМрдбрд╝ рдХреЗ рдкрдХреНрд╖ рдореЗрдВ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐рд░реЛрдз</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рджреМрдбрд╝ рдХреЗ </font><font style="vertical-align: inherit;">рдмреАрдЪ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pumpuntil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдПрдХ рдЧреИрд░-рдЖрджрд░реНрд╢ рдПрдкреАрдЖрдИ рд╣реИ, рдЕрд░реНрдерд╛рдд, рдЬрдм рдЖрдк рдПрдХ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЬрдЧрд╣ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреЛрдИ рдФрд░ рд░рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИ, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗред </font><font style="vertical-align: inherit;">рдорд┐рдХреНрд╕ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдФрд░ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдбред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдХреБрдЫ рднреА рд╣реЛ, рддреЛ рдкреВрд░реЗ рд░рд╛рдЗрдбрд░ рдХреЛ рдкреБрд░рд╛рдиреЗ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрднреА-рдХрднреА рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рднреА рд╣реЛрддреА рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрджрд░реНрдн рдмрджрд▓реЗрдВ</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <font></font>
  synchronousCode(); <span class="hljs-comment">// on initial context</span><font></font>
<font></font>
    <span class="hljs-keyword">await</span> myTaskScheduler;<font></font>
    continuationCode(); <span class="hljs-comment">//on scheduler context </span>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Async / wait</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рддрд░реАрдХрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>Awaiter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░ </font></font><code>scheduler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдзрд╛рдЧреЗ рдкрд░ рдХреВрджред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдореЗрдВ рдкреЛрд╕реНрдЯ рдкрдврд╝реА, рдЙрдиреНрд╣реЛрдВрдиреЗ рдмрд╣реБрдд рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд▓рд┐рдЦрд╛ рдХрд┐ рд╡рд┐рдзрд┐ рдХреЗ рдмреАрдЪ рдореЗрдВ рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ рдХреВрджрдирд╛ рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рд╡реЗ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдореЗрдВ рдПрдХ рдПрдкреАрдЖрдИ рд╣реИ рдЬреЛ рд╢реЗрдбреНрдпреВрд▓рд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдереНрд░реЗрдб рдкрд░ рдХреВрджрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд░рдЪрд┐рдд рд╕рдВрдЧрддрд┐</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyFuncAsync</span>(<span class="hljs-params"></span>)</span> { <font></font>
  synchronousCode(); <span class="hljs-comment">// on initial context</span><font></font>
<font></font>
    <span class="hljs-keyword">await</span> Task.Factory.StartNew(() =&gt; {...}, myTaskScheduler);<font></font>
    continuationCode(); <span class="hljs-comment">//on initial context </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирдП рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╡рд┐рд╕рд░реНрдЬрди рдХреЗ рд▓рд┐рдП рдФрд░ рдкреБрд░рд╛рдиреЗ рдкрд░ рд▓реМрдЯрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреБрдЫ рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдпрд╛ рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рд╕рдорд╛рдирддрд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рд╛рда рдХреЗ рджрд╢рдХ рдореЗрдВ, GoTo рдСрдкрд░реЗрдЯрд░ рдХреЛ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рдерд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрд░рдЪрдирд╛рддреНрдордХрддрд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рддрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рддреЛ рдпрд╣ рдпрд╣рд╛рдБ рд╣реИред </font><font style="vertical-align: inherit;">рдзрд╛рдЧреЗ рдкрд░ рдХреВрджрдирд╛ рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣реИрд░рд╛рдиреА рдХреА рдмрд╛рдд рд╣реИ, рдПрдХ async рд░рд╛рдЬреНрдп рдорд╢реАрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЬрд╣рд╛рдВ рдЖрдкрдХреА рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдк GoTo рдкрд░ рдХреВрджрддреЗ рд╣реИрдВ, рдЖрдк рдереНрд░реЗрдб рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдЗрд╕реЗ рдЯреИрдЧ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдорд┐рд▓рд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЕрдЬреАрдм рдФрд░ рджреБрд░реНрд▓рдн рд╕реНрдерд┐рддрд┐ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рднреА, </font><font style="vertical-align: inherit;">рдЙрд╕реА рд╕рдВрджрд░реНрдн рдореЗрдВ рд░рд┐рдЯрд░реНрди рдХрд╛ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрддрдЬрд╛рд░</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рдирд╛ </font><font style="vertical-align: inherit;">рдмреЗрд╣рддрд░ </font><font style="vertical-align: inherit;">рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдереНрд░реЗрдб рдкреВрд▓ рдореЗрдВ рдПрдХ рд╣реА рдереНрд░реЗрдб рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ рд╣реА рд╕рдВрджрд░реНрдн рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╡реНрдпрд╡рд╣рд╛рд░</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рдорд╛рди </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рдХреНрдпреЛрдВ </font><font style="vertical-align: inherit;">рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИ? </font><font style="vertical-align: inherit;">рдкреНрд░рддреАрдХреНрд╖рд╛ рдирд┐рд╖реНрдкрд╛рджрди рдЕрдиреБрдХреНрд░рдорд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдкрд╣рд▓рд╛ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ, рджреВрд╕рд░рд╛ рдХрд╛рд░реНрдп рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ - рд╣рдо рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдХреЛрдИ рд╕рдорд╛рдирддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрд╛рдВрд╢ рдЙрдкрдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП, рд╕рдорд╛рдирддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдорд╛рдирддрд╛рд╡рд╛рдж рд╕реНрд╡рдпрдВ рдЕрдиреБрдХреНрд░рдо рд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реАрд░рд┐рдпрд▓ рдХреЛрдб рд╕рдорд╛рдирд╛рдВрддрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рд░рд▓ рд╣реИ, рдпрд╣ рдПрдХ рд╕реНрд╡рдпрдВрд╕рд┐рджреНрдз рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдореЗрдВ рдХреБрдЫ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдФрд░ рдЖрдк рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyAsync</span>(<span class="hljs-params"></span>)</span> {<font></font>
<font></font>
  <span class="hljs-keyword">var</span> task1 = StartTask1Async();
  <span class="hljs-keyword">await</span> task1;<font></font>
<font></font>
  <span class="hljs-keyword">var</span> task2 = StartTask2Async();
  <span class="hljs-keyword">await</span> task2; <font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╡рд░реНрддреА рд╡реНрдпрд╡рд╣рд╛рд░</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyAsync</span>(<span class="hljs-params"></span>)</span> {
  <span class="hljs-keyword">var</span> task1 = StartTask1Async();
  <span class="hljs-keyword">var</span> task2 = StartTask2Async();<font></font>
<font></font>
  <span class="hljs-keyword">await</span> task1;
  <span class="hljs-keyword">await</span> task2; <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рдХрд╛рд░реНрдп рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рд╡рд┐рдзрд┐рдпрд╛рдБ рдХрд╛рд░реНрдп рдЪрд▓рд╛рдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рддреБрд░рдВрдд рд▓реМрдЯ рд╕рдХрддреА рд╣реИрдВ, рдлрд┐рд░ рдХреЛрдИ рд╕рдорд╛рдирддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдмрддрд╛ рджреЗрдВ рдХрд┐ рджреЛрдиреЛрдВ рдЯрд╛рд╕реНрдХ рдХреЛ рдЕрдВрдЬрд╛рдо рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЖрдк рдкрд╣рд▓реЗ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рдереЗ, рдлрд┐рд░ рдкрд╣рд▓реЗ рдЗрдВрддрдЬрд╛рд░ рдкрд░ рдЙрдбрд╝рд╛рди рднрд░реАред </font><font style="vertical-align: inherit;">рдпрд╛рдиреА рдЬреИрд╕реЗ рд╣реА рдЖрдкрдиреЗ рд▓рд┐рдЦрд╛ </font></font><code>await task1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдкрдиреЗ рдЙрддрд╛рд░ рджрд┐рдпрд╛ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рдХреА </font></font><code>exception task2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╡реИрдз рдХреЛрдб рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рдпрд╣ рдХреЛрдб рд╣реИ рдЬрд┐рд╕рдиреЗ .NET рдХреЛ рдЗрд╕ рддрдереНрдп рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ рдХрд┐ рд╕рдВрд╕реНрдХрд░рдг 4.5 рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдмрджрд▓ рдЧрдпрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрд╡рд╛рдж рд╕рдореНрднрд╛рд▓рдирд╛</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">MyAsync</span>(<span class="hljs-params"></span>)</span> {
  <span class="hljs-keyword">var</span> task1 = StartTask1Async();
  <span class="hljs-keyword">var</span> task2 = StartTask2Async(); <font></font>
<font></font>
  <span class="hljs-keyword">await</span> task1;
  <span class="hljs-keyword">await</span> task2;<font></font>
<font></font>
  <span class="hljs-comment">// if task1 throws exception and task2 throws exception we only throw and</span>
  <span class="hljs-comment">// handle task1тАЩs exception</span><font></font>
<font></font>
  <span class="hljs-comment">//4.0 -&gt; 4.5 framework: unhandled exceptions now donтАЩt crush process</span>
  <span class="hljs-comment">//still visible in UnobservedExceptionHandler</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ, рдЕрдирд╣реИрдиреНрдб рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди рдиреЗ рдмрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдлреЗрдВрдХ рджрд┐рдпрд╛, рдФрд░ рдЕрдЧрд░ рдЖрдкрдиреЗ рдХреБрдЫ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдирд╣реАрдВ рдкрдХрдбрд╝рд╛ </font></font><code>UnobservedExceptionHandler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдпрд╣ рдХреБрдЫ рдРрд╕рд╛ рднреА рд╣реИ </font></font><code>static</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕реЗ рдЖрдк рдЕрдиреБрд╕реВрдЪрд┐рдпреЛрдВ рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ), рддреЛ рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реБрдИред рдЕрдм рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╡реИрдз рдХреЛрдб рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐ .NET рдиреЗ рдЕрдкрдиреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛, рд▓реЗрдХрд┐рди рдЙрд╕рдиреЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдмрдирд╛рдП рд░рдЦрд╛ред</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">async</span>  Task  <span class="hljs-title">MyAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span>  {  <font></font>
<font></font>
  <span class="hljs-keyword">await</span>  <span class="hljs-function">SomeTask1  <span class="hljs-title">Async</span>(<span class="hljs-params">cancellationToken</span>)</span>; <font></font>
 <font></font>
  <span class="hljs-keyword">await</span>  <span class="hljs-function">Some <span class="hljs-title">Task2Async</span>(<span class="hljs-params"> cancellation  Token</span>)</span>; 
  <span class="hljs-comment">//you should always pass use async API with cancelationToken  if possible </span><font></font>
} <font></font>
  <font></font>
<span class="hljs-keyword">try</span> { 
    <span class="hljs-keyword">await</span>  MyAsync( cancellation  Token); <font></font>
} <span class="hljs-keyword">catch</span> (OperationException e) { <span class="hljs-comment">// do nothing: OCE happened</span>
} <span class="hljs-keyword">catch</span> (Exception e) { <font></font>
    log.Error(e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреЗрдЦреЗрдВ рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреИрд╕реЗ рдЪрд▓рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд░рджреНрджреАрдХрд░рдг рдЯреЛрдХреЗрди-рдПрд╕ рдХреЛ рдкреНрд░реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рднреА рдХреЛрдб рдХреЛ рд░рджреНрдж рдХрд░рдирд╛ "рд░рджреНрдж рдХрд░рдирд╛" рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font><font style="vertical-align: inherit;">Async рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рд╡реНрдпрд╡рд╣рд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдХрд╣реАрдВ рднреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>Task.Status ancellationToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдк рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдХреЗ рд╕рд╛рде рдЙрд╕реА рддрд░рд╣ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЗ рд╕рд╛рдеред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рд░рджреНрджреАрдХрд░рдг рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдорд┐рд▓рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЬрдм рдЖрдк рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд░рджреНрдж рдФрд░ рджреЛрд╖рдкреВрд░реНрдг рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реБрдЖ </font></font><code>OperationCanceledException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рд╕рд╛рдорд╛рдиреНрдп рдирд┐рд╖реНрдкрд╛рджрдиред </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЗрд╕реЗ рдкреНрд░рддрд┐рдЬреНрдЮрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдкрдХреЛ рдмрд╕ рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдХрд╛рд░реНрдп рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЯрд╛рд╕реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЖрдк рдЙрдбрд╝ рдЧрдП рд╣реЛрдВрдЧреЗ </font></font><code>AggregateException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдФрд░ async рдореЗрдВ, рдорд╛рдорд▓реЗ рдореЗрдВ рд╡реЗ </font></font><code>AggregateException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрд╢рд╛ рдмрд╣реБрдд рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдлреЗрдВрдХ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕рдореЗрдВ рдерд╛ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ - </font></font><code>OperationCanceled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)ред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдпреЛрдЧ рдореЗрдВ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд╡рд┐рдзрд┐</font></font></h3><br>
<pre><code class="cs hljs">DataTable&lt;File, ProcessedFile&gt; sharedMemory;<font></font>
<font></font>
<span class="hljs-comment">// in any thread</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SynchronousWorker</span>(<span class="hljs-params">...</span>)</span> {<font></font>
  File f = blockingQueue.Dequeue(); <font></font>
  ProcessedFile p = ProcessInParallel(f);<font></font>
<font></font>
  <span class="hljs-keyword">lock</span> (_lock) { <font></font>
    sharedMemory.<span class="hljs-keyword">add</span>(f, p);<font></font>
  } <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджрд╛рдирд╡ ReSharper рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ - рдПрдХ рд╕рдВрдкрд╛рджрдХ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдЦреЛрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рдЧрддрд┐рд╡рд┐рдзрд┐ рд╣реИ рдЬреЛ рдЗрд╕реЗ рдПрдХ рдЕрд╡рд░реБрджреНрдз рдХрддрд╛рд░ рдореЗрдВ рд░рдЦрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ </font></font><code>worker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╣рд╛рдВ рд╕реЗ рдкрдврд╝рддреА рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдпрд╣ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИ, рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ, рдмрдирд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>sharedMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ </font></font><code>sharedMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдХ рдХреЗ </font><font style="vertical-align: inherit;">рд╕рд╛рде </font><font style="vertical-align: inherit;">, рдЕрдиреНрдп рддрдВрддреНрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╡рд┐рдзрд┐</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрдм рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ, рд╣рдо рд╕рдм рд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рд╕реНрдерд╛рди рд▓реЗ рд▓реЗрдЧрд╛ </font></font><code>void</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рде </font></font><code>async Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ "Async" рд╢рдмреНрдж рд▓рд┐рдЦрдирд╛ рди рднреВрд▓реЗрдВред </font><font style="vertical-align: inherit;">рд╕рднреА рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдПрд╕рд┐рдВрдХреНрд╕ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП - рдпрд╣ рдПрдХ рд╕рдореНрдореЗрд▓рди рд╣реИред</font></font><br>
<br>
<pre><code class="cs hljs">DataTable&lt;File, ProcessedFile&gt; sharedMemory;
<span class="hljs-comment">// in any thread</span>
<span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">WorkerAsync</span>(<span class="hljs-params">...</span>)</span> {<font></font>
<font></font>
  File f = blockingQueue.Dequeue(); <font></font>
<font></font>
  ProcessedFile p = ProcessInParallel(f);<font></font>
<font></font>
  <span class="hljs-keyword">lock</span> (_lock) { <font></font>
    sharedMemory.<span class="hljs-keyword">add</span>(f, p);<font></font>
  } <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рд╣рдорд╛рд░реЗ рд╕рд╛рде рдХреБрдЫ рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ </font></font><code>blockingQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдЕрдЧрд░ рдХреБрдЫ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЖрджрд┐рдо рд╣реИ, рддреЛ рдХреБрдЫ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдЖрджрд┐рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-6/zk/8i/-6zk8ilnmdsonzd6zkafkcloqyi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдЖрджрд┐рдо рдХреЛ рдЪреИрдирд▓ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ: рд╡реЗ рдЪреИрдирд▓ рдЬреЛ рдкреИрдХреЗрдЬ рдореЗрдВ рд░рд╣рддреЗ рд╣реИрдВ </font></font><code>System.Threading.Channels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЖрдк рд╕реАрдорд┐рдд рдФрд░ рдЕрд╕реАрдорд┐рдд рдЪреИрдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдЖрдк рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк "рд╢реВрдиреНрдп" рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде рдПрдХ рдЪреИрдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рдд рдЗрд╕рдореЗрдВ рдмрдлрд░ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЗрд╕ рддрд░рд╣ рдХреЗ рдЪреИрдирд▓реЛрдВ рдХреЛ рд░реЗрдЬрд╝рд┐рдХреНрд╡реЗрдВрдЯ рдЪреИрдирд▓ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЧреЛ рдФрд░ рдХреЛрдЯрд▓рд┐рди рдореЗрдВ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдкреНрд░рдЪрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдФрд░ рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЕрдЧрд░ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдореЗрдВ рдЪреИрдирд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдкреИрдЯрд░реНрди рд╣реИред рдпрд╣реА рд╣реИ, рд╣рдо рдХрддрд╛рд░ рдХреЛ рдЪреИрдирд▓ рдореЗрдВ рдмрджрд▓рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рддрд░реАрдХреЗ рд╣реИрдВ </font></font><code>ReadAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>WriteAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProcessInParallel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдХрд╛ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдХреА рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд░рддрд╛ рд╣реИ</font></font><code>ProcessedFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдПрд╕рд┐рдВрдХреНрд╕ рд╣рдореЗрдВ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдирд╣реАрдВ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдЕрдзрд┐рдХ рдХреЙрдореНрдкреИрдХреНрдЯ рд░реВрдк рд╕реЗ?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдПрдВ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреЛрдб рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="cs hljs">DataTable&lt;File, ProcessedFile&gt; sharedMemory;<font></font>
<font></font>
<span class="hljs-comment">// in any thread</span>
<span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">WorkerAsync</span>(<span class="hljs-params">...</span>)</span> {<font></font>
<font></font>
  File f = <span class="hljs-keyword">await</span> channel.ReadAsync();<font></font>
<font></font>
  ProcessedFile p = <span class="hljs-keyword">await</span> ProcessInParallelAsync(f);<font></font>
<font></font>
  <span class="hljs-keyword">lock</span> (_lock) { <font></font>
    sharedMemory.<span class="hljs-keyword">add</span>(f, p);<font></font>
  } <font></font>
}</code></pre><br>
<img src="https://habrastorage.org/webt/e0/zt/8u/e0zt8ud_8b4_wsiqsrd9_baalwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡реЗ рдХреНрдпрд╛ рджрд┐рдЦрддреЗ рд╣реИрдВ </font></font><code>ProcessInParallel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдлрд╛рдЗрд▓ рд╣реИред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЗрд╕реЗ lexemes рдореЗрдВ рддреЛрдбрд╝рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рджреЛ рдХрд╛рд░реНрдп рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: рдЦреЛрдЬ рдХреИрд╢ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдПрдХ рд╡рд╛рдХреНрдпрд╡рд┐рдиреНрдпрд╛рд╕ рдкреЗрдбрд╝ рдХрд╛ рдирд┐рд░реНрдорд╛рдгред рдЙрд╕рдХреЗ рдмрд╛рдж "рд╢рдмреНрджрд╛рд░реНрде рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ" рдХрд╛ рдХрд╛рд░реНрдп рдЖрддрд╛ рд╣реИред рдпрд╣рд╛рдВ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ рд╕рднреА рдХрд╛рд░реНрдп рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЪрдХреНрд░реАрдп рдЧреНрд░рд╛рдл рдмрдирд╛рддреЗ рд╣реИрдВред рдпрд╣реА рд╣реИ, рдЖрдк рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдереНрд░реЗрдбреНрд╕ рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдХреБрдЫ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд░реНрднрд░рддрд╛рдПрдВ рд╣реИрдВ рдЬреЛ рдХрд╛рд░реНрдп рдЕрдиреНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЖрдкрдХреЛ рдРрд╕реЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдПрдХ рдЧреНрд░рд╛рдл рдорд┐рд▓рддрд╛ рд╣реИ, рдЖрдк рдХрд┐рд╕реА рднреА рддрд░рд╣ рдЙрдиреНрд╣реЗрдВ рдереНрд░реЗрдб рдХреЗ рд╕рд╛рде рдмрд┐рдЦреЗрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдХреНрдпрд╛ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛, рдЗрд╕реЗ рдЦреВрдмрд╕реВрд░рддреА рд╕реЗ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ? рд╣рдорд╛рд░реЗ рдХреЛрдб рдореЗрдВ, рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХрдИ рдмрд╛рд░ рд╣рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд╣рд░ рдмрд╛рд░ рдПрдХ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗред рдпрд╣ рд╢рд╛рдпрдж рд╣реА рдХрднреА рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдХреЛрдб рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xh/-h/3j/xh-h3jav69twzsqei3rrjbe2ymy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдЗрд╕ рдХрд╛рд░реНрдп рдЧреНрд░рд╛рдлрд╝ рдХреЛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: рдорд╛рди рд▓реЗрдВ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдореЗрдВ рдЕрдиреНрдп рдХрд╛рд░реНрдп рд╣реИрдВ, рдЬрд┐рд╕ рдкрд░ рдпрд╣ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ ExecuteBefore рд╢рдмреНрджрдХреЛрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╣рдо рдЕрдкрдиреА рд╡рд┐рдзрд┐ рдХрд╛ рдХрдВрдХрд╛рд▓ рд▓рд┐рдЦрддреЗ рд╣реИрдВред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдВрдХрд╛рд▓ рдХреЗ рдЙрдкрд╛рдп</font></font></h3> <br>
<pre><code class="cs hljs">Dictionary&lt;Action&lt;ProcessedFile&gt;, Action&lt;ProcessedFile&gt;[]&gt; ExecuteBefore; <span class="hljs-function"><span class="hljs-keyword">async</span> Task&lt;ProcessedFile&gt; <span class="hljs-title">ProcessInParallelAsync</span>(<span class="hljs-params"></span>)</span> {
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">new</span> ProcessedFile();<font></font>
<font></font>
<font></font>
  <span class="hljs-comment">// lots of work with toposort, locks, etc.</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> res; <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдк рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╕рд┐рд░-рдкрд░ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕ рдЧреНрд░рд╛рдл рдХреА рдПрдХ рдЯреЛрдкреЛрд▓реЙрдЬрд┐рдХрд▓ рд╕реЙрд░реНрдЯрд┐рдВрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдПрдХ рдХрд╛рд░реНрдп рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рдЖрд╢реНрд░рд┐рдд рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИ, рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдПрдХ рддрд╛рд▓рд╛ рдХреЗ рдиреАрдЪреЗ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ, рджреЗрдЦреЗрдВ рдХрд┐ рдХрд┐рди рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдХреЛрдИ рдЖрд╢реНрд░рд┐рдд рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рднрд╛рдЧреЛ, рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдмрд┐рдЦреЗрд░реЛ </font></font><code>Task Runner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рдФрд░ рдЕрдзрд┐рдХ рдХреЙрдореНрдкреИрдХреНрдЯ рд░реВрдк рд╕реЗ рд▓рд┐рдЦрддреЗ рд╣реИрдВ: рд╡рд┐рднрд┐рдиреНрди рдереНрд░реЗрдбреНрд╕ рдкрд░ рдЗрд╕ рддрд░рд╣ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдЧреНрд░рд╛рдл + рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рд╕рд╛рдордпрд┐рдХ рдЫрд╛рдВрдЯрдирд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕рд┐рдВрдЪ рдЖрд▓рд╕реА</font></font></h3><br>
<pre><code class="cs hljs">Dictionary&lt;Action&lt;ProcessedFile&gt;, Action&lt;ProcessedFile&gt;[]&gt; ExecuteBefore;
<span class="hljs-function"><span class="hljs-keyword">async</span> Task&lt;ProcessedFile&gt; <span class="hljs-title">ProcessInParallelAsync</span>(<span class="hljs-params"></span>)</span> {
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">new</span> ProcessedFile();
  <span class="hljs-keyword">var</span> lazy = <span class="hljs-keyword">new</span> Dictionary&lt;Action&lt;ProcessedFile&gt;, Lazy&lt;Task&gt;&gt;(); 
  <span class="hljs-keyword">foreach</span> ((action, beforeList) <span class="hljs-keyword">in</span> ExecuteBefore)<font></font>
    lazy[action] = <span class="hljs-keyword">new</span> Lazy&lt;Task&gt;(<span class="hljs-keyword">async</span> () =&gt; <font></font>
    {<font></font>
      <span class="hljs-keyword">await</span> Task.WhenAll(beforeList.Select(b =&gt; lazy[b].Value)) 
      <span class="hljs-keyword">await</span> Task.Yield();<font></font>
      action(res);<font></font>
}<font></font>
  <span class="hljs-keyword">await</span> Task.WhenAll(lazy.Values.Select(l =&gt; l.Value)) 
  <span class="hljs-keyword">return</span> res;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд╛рдордХ рдПрдХ рдкреИрдЯрд░реНрди рд╣реИ </font></font><code>Async Lazy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо рдЕрдкрдирд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ </font></font><code>ProcessedFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕ рдкрд░ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЖрдЗрдП рдПрдХ рд╢рдмреНрджрдХреЛрд╢ рдмрдирд╛рдПрдВ: рд╣рдо рдЕрдкрдиреЗ рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг (Action ProcessedFile) рдХреЛ рдХрд┐рд╕реА рдЯрд╛рд╕реНрдХ рдореЗрдВ рдпрд╛ рдХрд┐рд╕реА рдФрд░ рдЯрд╛рд╕реНрдХ рд╕реЗ рдЖрд▓рд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрд╡рд░реВрдкрд┐рдд рдХрд░реЗрдВрдЧреЗ рдФрд░ рдореВрд▓ рдЧреНрд░рд╛рдлрд╝ рдХреЗ рд╕рд╛рде рдЪрд▓реЗрдВрдЧреЗред рдЪрд░ рдореЗрдВ </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реА </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрд░рд╡рд╛рдИ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реЛрдЧреА </font><font style="vertical-align: inherit;">, рдФрд░ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ - рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рдкрд╣рд▓реЗ рдХрд┐рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдПред рдлрд┐рд░ рдмрдирд╛рдиреЗ </font></font><code>Lazy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗ </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо рдЯрд╛рд╕реНрдХ рдореЗрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВ </font></font><code>await</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдЙрди рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЬреЛ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдкреВрд░реЗ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред рдкрд╣рд▓реЗрд╡рд╛рджреА рдореЗрдВ, </font></font><code>Lazy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╢рдмреНрджрдХреЛрд╢ рдореЗрдВ рдЬреЛ рднреА рд╣реИ рдЙрд╕реЗ </font><font style="vertical-align: inherit;">рдЪреБрдиреЗрдВ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣рд╛рдВ рдХреБрдЫ рднреА рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХреЛрдб рдирд╣реАрдВ рдЧрд┐рд░реЗрдЧрд╛ </font></font><code>ItemNotFoundException in Dictionary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо рдЙрди рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЕрдВрдЬрд╛рдо рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдереЗ, рдХрд╛рд░реНрд░рд╡рд╛рдИ рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬ рдХрд░рдирд╛</font></font><code>Lazy Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдЕрдкрдиреА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдЕрдВрдЬрд╛рдо рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЖрдкрдХреЛ рдмрд╕ рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдЖрдк рдХрднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдХреНрдпрд╛ рдХреБрдЫ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реБрдЖ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреБрдЫ рднреА рд╢реБрд░реВ рдирд╣реАрдВ рд╣реБрдЖред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЙрдкрд╛рдп рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдзрд┐ 10 рдорд┐рдирдЯ рдореЗрдВ рд▓рд┐рдЦреА рдЧрдИ рд╣реИ, рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╕реНрдкрд╖реНрдЯ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдиреЗ рд╣рдорд╛рд░рд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛, рд╢реБрд░реВ рдореЗрдВ рдЗрд╕рдиреЗ рдЬрдЯрд┐рд▓ рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзреА рдХреЛрдб рдХреЗ рд╕рд╛рде рдХреБрдЫ рд╕реНрдХреНрд░реАрди рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░ рд▓рд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╡рд╣ рдмрд┐рд▓реНрдХреБрд▓ рд╕реБрд╕рдВрдЧрдд рд╣реИред </font><font style="vertical-align: inherit;">рдореИрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ </font></font><code>ConcurrentDictionary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдореИрдВ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ </font></font><code>Dictionary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЗрд╕реЗ рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдХреБрдЫ рднреА рдирд╣реАрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рд╕реБрд╕рдВрдЧрдд, рд╕реБрд╕рдВрдЧрдд рдХреЛрдб рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async-s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреВрдмрд╕реВрд░рддреА рд╕реЗ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ - рдмрдЧ рдХреЗ рдмрд┐рдирд╛ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рд▓реЗ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдПрдВ</font></font></h3><br>
<pre><code class="cs hljs">DataTable&lt;File, ProcessedFile&gt; sharedMemory;<font></font>
<font></font>
<span class="hljs-comment">// in any thread</span>
<span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">WorkerAsync</span>(<span class="hljs-params">...</span>)</span> {<font></font>
<font></font>
  File f = <span class="hljs-keyword">await</span> channel.ReadAsync();<font></font>
<font></font>
  ProcessedFile p = <span class="hljs-keyword">await</span> ProcessInParallelAsync(f);<font></font>
<font></font>
    <span class="hljs-keyword">lock</span> (_lock) {<font></font>
      sharedMemory.<span class="hljs-keyword">add</span>(f, p);<font></font>
   }<font></font>
 }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреНрдпрд╛ рдпрд╣ async рдФрд░ рдЗрди рддрд╛рд▓реЛрдВ рдореЗрдВ рдЦреАрдВрдЪрдиреЗ рд▓рд╛рдпрдХ рд╣реИ? рдЕрдм рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ async рддрд╛рд▓реЗ, async semaphores рд╣реИрдВ, рдЕрд░реНрдерд╛рдд, рд╕рдордХрд╛рд▓рд┐рдХ рдФрд░ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдореЗрдВ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рд╣реИред рдпрд╣ рдЕрд╡рдзрд╛рд░рдгрд╛ рдЧрд▓рдд рдкреНрд░рддреАрдд рд╣реЛрддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд▓реЙрдХ рдХреЗ рд╕рд╛рде рдЖрдк рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдХреБрдЫ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред рд╣рдорд╛рд░рд╛ рдХрд╛рдо рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрд╕рд╛рди рд╣реИред рдФрд░ рдЕрдЧрд░ рдпрд╣ рдЖрд╕рд╛рди рд╣реИ, рддреЛ рдХрдо рддреНрд░реБрдЯрд┐рдпрд╛рдВ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="cs hljs">Channel&lt;Pair&lt;File, ProcessedFile&gt;&gt; output;
<span class="hljs-comment">// in any thread</span>
<span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">WorkerAsync</span>(<span class="hljs-params">...</span>)</span> {<font></font>
<font></font>
  File f = <span class="hljs-keyword">await</span> channel.ReadAsync();<font></font>
<font></font>
  ProcessedFile p = <span class="hljs-keyword">await</span> ProcessInParallelAsync(f);<font></font>
  <font></font>
  <span class="hljs-keyword">await</span> output.WriteAsync(); <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдХреБрдЫ рдЪреИрдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдВ рдХреБрдЫ рдлрд╛рдЗрд▓ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕реНрдбрдлрд╛рдЗрд▓ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ </font></font><code>ReadAsync</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдЫ рдЕрдиреНрдп </font><font style="vertical-align: inherit;">рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕ рдЪреИрдирд▓ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдкреНрд░реЛрд╕реЗрд╕ </font><font style="vertical-align: inherit;">рдХрд░реЗрдЧреА, рдФрд░ рдпрд╣ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдХрд░реЗрдЧреАред рдЦреБрдж рдХреЛ рд▓реЙрдХ рдХрд░реЗрдВ, рд╕рдВрд░рдЪрдирд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪ рдХреЛ рд░реИрдЦрд┐рдХ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдЬрдЧрд╣ рдЬрд╣рд╛рдВ рд▓рдЧрд╛рддрд╛рд░ рд╕рднреА рдзрд╛рдЧреЗ рд╕рдорд╛рдирд╛рдВрддрд░ рд╣реЛрддреЗ рд╣реИрдВред рдФрд░ рд╣рдо рдЗрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЪреИрдирд▓ рдХреЗ рд╕рд╛рде рдмрджрд▓ рд░рд╣реЗ рд╣реИрдВред </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q_/qe/mf/q_qemfc4mssz9shitqlekzee6nc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: рд╢реНрд░рдорд┐рдХ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ </font></font><code>input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЙрдиреНрд╣реЗрдВ рдкреНрд░реЛрд╕реЗрд╕рд░ рдореЗрдВ рдХрд╣реАрдВ рднреЗрдЬрддреЗ рд╣реИрдВ, рдЬреЛ рд╕рдм рдХреБрдЫ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХреЛрдИ рд╕рдорд╛рдирддрд╛ рдирд╣реАрдВ рд╣реИред рдХреЛрдб рдмрд╣реБрдд рд╕рд░рд▓ рджрд┐рдЦрддрд╛ рд╣реИред рдореИрдВ рд╕рдордЭрддрд╛ рд╣реВрдВ рдХрд┐ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рдм рдХреБрдЫ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдРрд╕рд╛ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░, рдЬрдм рдЖрдк рдбреЗрдЯрд╛ рдкрд╛рдЗрдк рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрд╢рд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7k/9j/sv/7k9jsvdwqbqrzgbejoozsk5lj_s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рджреВрд╕рд░рд╛ рдЪреИрдирд▓ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдФрд░ рдЪреИрдирд▓реЛрдВ рд╕реЗ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдЪрдХреНрд░реАрдп рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЧреНрд░рд╛рдл рдмрдирддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЪрдХреНрд░реЛрдВ рдХрд╛ рдПрдХ рдЧреНрд░рд╛рдлред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдХрд┐ рд░реЛрдорди рдПрд▓рд┐рд╕рд╛рд░реЛрд╡ рдиреЗ 2018 рдореЗрдВ рдХреЛрдЯрд▓рд┐рдирдХреЛрдл рдХреЛ рдмрддрд╛рдпрд╛ред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЛрдВрдиреЗ рдЗрди рдЪреИрдирд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдЯрд▓рд┐рди рдкрд░ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд▓рд┐рдЦрд╛ рдерд╛, рдФрд░ рд╡рд╣рд╛рдВ рдЪрдХреНрд░ рдереЗ, рдФрд░ рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рд╕рдорд╕реНрдпрд╛ рдпрд╣ рдереА рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЧреНрд░рд╛рдлрд╝ рдореЗрдВ рдРрд╕реЗ рдЪрдХреНрд░ рд╣реИрдВ, рддреЛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕рдм рдХреБрдЫ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдбреЗрдбрд▓реЙрдХ рдЦрд░рд╛рдм рд╣реИрдВ рдХрд┐ рдЬрдм рдЖрдк рдереНрд░реЗрдбреНрд╕ рдХрд╛ рдПрдХ рд╕реНрдЯреИрдХ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛ рд╣рд▓ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рдХрдард┐рди рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд▓рдЯрдХрд╛ рд╣реБрдЖ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рд╕рд╣реА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рд░рд╛рдВрд╢</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЛрдб рдореЗрдВ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ рдмрдЪреЗрдВред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрд░рд┐рдпрд▓ рдХреЛрдб рд╕рдорд╛рдирд╛рдВрддрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рд░рд▓ рд╣реИред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рд╕рд░рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдиреНрдпреВрдирддрдо рдорд╛рдкрджрдВрдбреЛрдВ рдФрд░ рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЗрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВред</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдкрдиреЗ рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рд▓рд┐рдЦрдиреЗ рдХреА рдЖрджрдд рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд▓реА рд╣реИ, рдФрд░ рднрд▓реЗ рд╣реА рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЗ рд╕рдорд╛рди рд╣реИ, рддреЛ рд╡рд╣рд╛рдВ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдХреЛ рди рдЦреАрдВрдЪреЗрдВ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдХреЛрдб рдореЗрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ </font></font><code>async mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдлрд╝реАрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ, рдФрд░ рдЕрдиреНрдп </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрджреЗрд╢</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╛рдЗрдореЗрдЯрд┐рдВрдЧ </font><i><font style="vertical-align: inherit;">рдкрд╛рд╕ рдХрд░ рд░рд╣реЗ</font></i><font style="vertical-align: inherit;"> рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реАрд░рд┐рдпрд▓ рдХреЛрдб рд╕рдорд╛рдирд╛рдВрддрд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рд░рд▓ рд╣реИред рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд▓рд┐рдЦ тАЛтАЛрд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рджрд┐рдЦреЗ, рдмрд┐рдирд╛ рд╕рдорд╛рдирд╛рдВрддрд░ рдХреЛрдб рдФрд░ рд▓реЙрдХ рдХрд┐рдП, рддреЛ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЛ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рд▓рд┐рдЦреЗрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдЖрдЦрд┐рд░реА рдЪреАрдЬ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЙрджрд╛рд╣рд░рдгреЛрдВ рд╕реЗ рджреЗрдЦрд╛ред </font><font style="vertical-align: inherit;">рдЬрдм рдЖрдк рдЕрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдкрд░ рдХрдо рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЕрдиреБрдХрд░рдгреАрдп рд╕рдВрджрд░реНрдн рдХреЛрдб рдореЗрдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ рдХреА рдЧрд▓рддрдлрд╣рдореА рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЖрдк рдПрдХ рд╡рд░реНрд╖ рдореЗрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреВрд▓ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдЧрд░ рдХреЛрдИ рдЕрдиреНрдп рд╡реНрдпрдХреНрддрд┐ рдЗрд╕ рдХреЛрдб рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдореЗрдВ рдХреБрдЫ рдлрд┐рд░ рд╕реЗ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрди рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХреЛ рдЬрдиреНрдо рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдмрд╛рд░ рдкрддрд╛ рдерд╛, рдФрд░ рдирдП рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ рдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдХреЗ рдХрд╛рд░рдг рдирд╣реАрдВ рдкрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рдЦрд░рд╛рдм рдбрд┐рдЬрд╛рдЗрди рдХреЛ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдорд╛рдкрджрдВрдбреЛрдВ, рдЙрдирдХреЗ рд╕рдВрдпреЛрдЬрди рдФрд░ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдВрджрд░реНрдн рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИред</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдкрдврд╝рдирд╛ рд╣реИ?</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TAP рджрд╕реНрддрд╛рд╡реЗрдЬрд╝</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asyncs рдорд╛рд░реНрдЧрджрд░реНрд╢рди</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреАрд╡рди рдХрд╛рд▓</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">medium.com/@elizarov/deadlocks-in-non-hierarchical-csp-e5910d137cc</font></font></a></li>
</ul><br>
<blockquote>     -10     .     DotNext   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi491218/index.html">рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдорд┐рдпреЛ рдореЗрдВ рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ рдХрд╛ рдПрдХреАрдХрд░рдг</a></li>
<li><a href="../hi491224/index.html">рдПрдХ рдкреНрд░реЗрд╖рдг рд╕реЗрд╡рд╛ рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рди, рдпрд╛ рдХреИрд╕реЗ рдПрдХ рд╕реЗрд╡рд╛ рдХрдВрдкрдиреА рдкрд░рд┐рд╡рд╣рди рд▓рд╛рдЧрдд рдХреЛ 30% рддрдХ рдХрдо рдХрд░ рд╕рдХрддреА рд╣реИ</a></li>
<li><a href="../hi491230/index.html">рдореИрдВ 21 рд╕реНрдХреВрд▓ рдореЗрдВ рдХреИрд╕реЗ рдЧрдпрд╛ рдФрд░ рд░рд╣рд╕реНрдпреЛрдВ рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ рдХреИрд╕реЗ рд╣реБрдЖ</a></li>
<li><a href="../hi491232/index.html">RPA + рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ = рдмреБрджреНрдзрд┐рдорд╛рди рд╕реНрд╡рдЪрд╛рд▓рди</a></li>
<li><a href="../hi491234/index.html">3 рдбреА рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдореЙрдбрд▓рд┐рдВрдЧ рдкрд╛рд░реНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП SOLIDWORKS рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреАрди рдЯреНрд░рд┐рдХреНрд╕</a></li>
<li><a href="../hi491238/index.html">рдЖрдиреБрд╡рдВрд╢рд┐рдХ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдг II</a></li>
<li><a href="../hi491240/index.html">рдмрд╛рджрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдбрд╝рдХ: рдХрд▓ рдФрд░ рдЖрдЬ рдПрдбреЛрдм</a></li>
<li><a href="../hi491244/index.html">Ableton рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИ: Ableton Push 2 рдХреЛ VCV рд░реИрдХ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ</a></li>
<li><a href="../hi491246/index.html">DEFCON рд╕рдореНрдореЗрд▓рди 27. рдЖрдкрдХреА рдХрд╛рд░ рдореЗрд░реА рдХрд╛рд░ рд╣реИред рднрд╛рдЧ 2</a></li>
<li><a href="../hi491250/index.html">рдПрд▓рдИрдбреА рд▓реИрдВрдк рдЧреЙрд╕ рдмреЗрд╕рд┐рдХ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>