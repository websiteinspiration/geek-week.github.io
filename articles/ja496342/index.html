<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥄 💇🏽 📌 CI / CDプロセスの更新：teamcity 🈲 👩🏾‍🤝‍👨🏼 🙋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="これは、CI / CDプロセスの更新に関するシリーズの2番目の記事です。この時点までに、新しいツールをセットアップするための準備が行われていました。つまり、計画、毎日の集会、不一致の解決、一般的には、それなしでは適切に作業プロセスを構築することはできませんでした。これですべての問題が解決され、開発を...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI / CDプロセスの更新：teamcity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496342/"><img src="https://habrastorage.org/webt/cu/y-/hg/cuy-hgxvywohqkg_tbyr2wn268c.png" alt="画像" align="left" width="300"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、CI / CDプロセスの更新に関するシリーズの2番目の記事です。この時点までに、新しいツールをセットアップするための準備が行われていました。つまり、計画、毎日の集会、不一致の解決、一般的には、それなしでは適切に作業プロセスを構築することはできませんでした。これですべての問題が解決され、開発を継続できると確信しており、夏の初めにコードがブラックホールに陥ることはありません。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事リストの目次と前の短い結果を思い出させてください。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1：何であるか、なぜそうでないのか、計画、ちょっとしたバッシュ。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はこの部分をほぼテクニカルと呼んでいます。</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2：teamcity。</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3：タコの展開。</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パート4：舞台裏。不愉快な瞬間、将来の計画、おそらくFAQ。ほとんどの場合、ほぼテクニカルと呼ばれることもあります。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいアップデート配信システムの概念実証をお客様に提供し、既存のシステムの欠点を特定し、新しいシステムのベースを選択し、移行計画を作成し、水銀リポジトリをgitに変換しました。また、前のパートでは、後続のプロセス全体に影響を与えるプロジェクトの機能について説明しました。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、既存のソリューションは最新の要件を満たしていませんでした。最初は、おそらく1つのビルドがccnetで構成されていました。すべてが始まった最初のビルド（ビッグバンなど）。次に、それをすべて設定し、ctrl + c、ctrl + vを押して、数行を修正し、新しい構成を受け取った人はどうやら、その後のすべての時間で、ビルドサーバーのソースコードが60G以上を消費するように、これは十分な回数行われました。そして、これらは単なるソースです！また、ログ、ビルドアーティファクト、一時ファイルなどがあります。これだけで思いました。古いシステムを見ると、次のことがわかります。各モジュールに対してビルドステップが実行されました。実際、同じコアが組み立てられました。そして、このアセンブリはサーバー上の各モジュール（およびソース）に保存されました。ビルド結果（90％同一）はローカルリポジトリにプッシュされ（gitデプロイメント）、もちろん、その代わりになりました。これを残すことは可能であり、必要でした。&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般設定&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この段階では、設定済みのteamcityとタコがすでにあると想定されています。</font><font style="vertical-align: inherit;">インストールと構成の段階で、詳細に停止することはありません。</font><font style="vertical-align: inherit;">便宜上、タコのURLとapi-tokenをenv teamcityに指定します。ちなみに、ルートプロジェクトの場合、</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/vw/ir/savwiryxdsw8fpgrgvdzavejho0.png" alt="画像"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.apiUserPassword</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はteamcityユーザーへのapiアクセスです（後で必要になります）、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env .sourcePath-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルドファイルとソースファイルへのデフォルトパス、それぞれ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoApiKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoUrl-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トークンとタコのURL。</font><font style="vertical-align: inherit;">彼らはまだ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.teamcityUrlを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加しました。</font><font style="vertical-align: inherit;">ええと、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tt.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-テキスト変換ユーティリティへのパス。</font><font style="vertical-align: inherit;">このユーティリティは、すべての構成を生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サードパーティのプラグインのうち、Octopus Deploy統合のみがインストールされています。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに膨大な量のテキストをオーバーロードしないようにするために、注目に値する何かがあるステップのみが詳細に検討されます。</font><font style="vertical-align: inherit;">他のすべては、提示されたデータと読者の知識に基づいて理解できると想定されています。</font><font style="vertical-align: inherit;">いずれにせよ、ご不明な点がございましたらお答えいたします。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの内訳、バージョン、名前</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果はそのようなプロジェクトスキームでした（図として、マルチレベルリストの表示に問題があるため）：</font></font><br>
<img src="https://habrastorage.org/webt/-4/oq/gh/-4oqghadht5sr4rdpk7f3igz5do.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようにパッケージをバージョン管理します：major.minor.patch、ここでメジャーはこれまで1、マイナーはビルド構成のビルドカウンター、パッチは構成のビルドカウンターデプロイ（ビルド構成には必要ないため、常に0）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧バージョンについてはこちらをご覧ください。 gitタグに基づくように再設計しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/kl/ov/3vklovvjqjnhwa8yg0b3lxtduns.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、ここで1はメジャー、95はマイナー、1はパッチです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールの新しいプロセスでは、各モジュールにデプロイされる1つのビルドがあります。つまり、ソースコードは環境ごとに1つのコピーに格納され、ビルド結果もすべてのモジュールに共通であるためです。固有の構成とライブラリは、展開段階で個別のパッケージにパッケージ化されます。これにより、ディスクスペースが効果的に使用され、各パッケージの納期が短縮されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
準備段階で、構成ファイルの命名規則に関する別の短い会議がありました。以前は（それは正しかった）でしたが、常に同じではありませんでした。さらに、構成名には必ずしも十分な情報が含まれていませんでした。その結果、すべての構成名は次のようになりました</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ConfigurationType.Environment.ModName.config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで、ConfigurationTypeはAppSettings、Webなどにすることができます。</font><font style="vertical-align: inherit;">環境-開発、テスト、ステージング、本番。</font><font style="vertical-align: inherit;">ModNameは、モジュールの一意の名前です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのモジュールプロジェクトは同じ原理で動作します。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての環境には、次のようなビルド構成があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuget復元を実行します（NuGetインストーラー、nuget復元）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成を生成します（コマンドライン、テキスト変換）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Builditソリューション（Visual Studio SLN）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPathからzipでファイルを取得し、それをタコにプッシュします（タコデプロイ：プッシュパッケージ）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リリースの作成（デプロイなし）（Octopus deploy create release）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッチバージョンをリセットします（Powershell）</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テンプレートに基づいて機能し、次のことを行うデプロイ構成もあります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビルド段階（ステップ2）で生成された構成をピックアップします（Octopusはプッシュパッケージをデプロイします）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コアリリース（ビルドのステップ6で作成されたもの）をデプロイします（タコデプロイ：リリースをデプロイ）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個別リリースのデプロイ（現在の構成のステップ1で作成されたもの）（タコのデプロイ：リリースのデプロイ）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このモジュールのすべてのドメインのリストをログに表示します（テスターと開発者の便宜のための手順）。</font><font style="vertical-align: inherit;">（パワーシェル）。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デプロイ構成ごとに、ビルド構成が依存関係に追加されます。</font><font style="vertical-align: inherit;">これにより、ビルドが適切でない場合は、デプロイ時に自動的に起動でき、パッチバージョンをリセットすることもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deploy_all構成。</font><font style="vertical-align: inherit;">実際、これはビルドチェーンであり、関係がない場合は最初にビルドを実行してから、すべてのモードを同時にインストールする必要があることを説明しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは次のよう</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ps/ck/rqpsckl2g8rrt9voltbt082itcu.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
になります。いくつかのステップをもう少し詳しく</font><font style="vertical-align: inherit;">見てみ</font><font style="vertical-align: inherit;">ましょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.General設定</font></font></h3><br>
<img src="https://habrastorage.org/webt/g_/5j/b9/g_5jb95h7ei6qexbvckqd8sxs7e.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
珍しい唯一のビルド番号形式から。</font><font style="vertical-align: inherit;">後で説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.env</font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/nr/bx/a4nrbxt_8ol6yjuo64npqfxuota.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで興味深いのは：</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.coreProjectName-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクト全体に設定されます。</font><font style="vertical-align: inherit;">タコのプロジェクトを識別するために必要。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.Environment-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールサブプロジェクトに設定します。</font><font style="vertical-align: inherit;">環境に応じて正しい設定を選択する必要があります。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoChannel-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケットが入るタコのチャネル。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よう</font><i><font style="vertical-align: inherit;">env.Environment</font></i><font style="vertical-align: inherit;">。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.serviceName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はソリューションの名前です。</font><font style="vertical-align: inherit;">基本的に、変数は視覚化を容易にするために追加されます。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タコの</font><i><font style="vertical-align: inherit;">テナント</font></i><font style="vertical-align: inherit;">タグ。</font><font style="vertical-align: inherit;">タコのセクションで詳細をご覧ください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.4 </font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/da/r1/a4dar1z6_kawzfttqbuvoivu_mm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％env.serviceName％。％Build.number％</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
という名前のアーカイブに、</font><font style="vertical-align: inherit;">すべての構成を除くビルドの結果を含むディレクトリから</font><i><font style="vertical-align: inherit;">.zip</font></i><font style="vertical-align: inherit;">ファイルを</font><font style="vertical-align: inherit;">追加し、</font><font style="vertical-align: inherit;">bin / nativeフォルダーからdllを</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">最後のものは手動で一度Webサーバーに追加されたので、誰も再びそれらに触れることはありません。</font><font style="vertical-align: inherit;">必要に応じて、それらも手動で更新されます（このため、別のスクリプトを作成する予定ですが、正直に説明します）。</font><font style="vertical-align: inherit;">これは、これらのライブラリがIISプールによって「保持」されているためであり、展開を成功させるには、ライブラリを停止してから起動する必要があり、これにはしばらく時間がかかります。</font><font style="vertical-align: inherit;">これらのライブラリーをデプロイメントから除外することにより、プールを停止するステップをスキップできます。これにより、デプロイメントの時間が短縮され、ダウンタイムが短縮されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.5</font></font></h3><br>
<img src="https://habrastorage.org/webt/us/hu/zx/ushuzxwer8u3iwqnuuqpjbuoodo.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、[環境]フィールドが空である理由を除いて、すべてが明確になっていると思います。</font><font style="vertical-align: inherit;">パッケージが取得する環境では、タコはプレリリースタグ（チャネルで構成されている）に基づいて決定を行います。</font><font style="vertical-align: inherit;">このタグは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％build.number％に</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">含まれ</font><font style="vertical-align: inherit;">ています（Build.Generalの画面の同じステージング）。</font><font style="vertical-align: inherit;">したがって、この場合はより便利であることがわかりました。</font><font style="vertical-align: inherit;">また、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開プロセスを表示]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックボックスに注意を払う価値があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それがインストールされていない場合、タコが開始された（しかし、終了していない！）とすぐに、timsityはビルドが成功したと見なします。</font><font style="vertical-align: inherit;">つまり、チェックボックスがインストールされておらず、展開段階で問題が発生した場合、タコのインターフェースを見ない限り、そのことはわかりません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
異常なことは何もありません。powershellスクリプトとteamcityドキュメントからの情報だけです。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pair</span> = <span class="hljs-string">"%env.apiUserName%:%env.apiUserPassword%"</span>
<span class="hljs-variable">$encodedCreds</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String([<span class="hljs-type">System.Text.Encoding</span>]::ASCII.GetBytes(<span class="hljs-variable">$pair</span>))
<span class="hljs-variable">$basicAuthValue</span> = <span class="hljs-string">"Basic <span class="hljs-variable">$encodedCreds</span>"</span>
<span class="hljs-variable">$depUri</span>=<span class="hljs-string">"%env.teamcityUrl%/app/rest/buildTypes?locator=snapshotDependency:(from:(build:(id:%teamcity.build.id%)),includeInitial:false)"</span>
<span class="hljs-comment"># Get all dependencies of main build</span>
<span class="hljs-variable">$result</span> = (<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$depUri</span>)
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>.buildTypes.buildType.Count) { <span class="hljs-variable">$buildId</span> += <span class="hljs-variable">$result</span>.buildTypes.buildType.id }
<span class="hljs-variable">$buildId</span> = <span class="hljs-variable">$buildId</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">'Module_DeployAll'</span> }
<span class="hljs-comment"># Reset all child build counters to 1. This build counters are patch versions in every build. (1.build.patch)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buildId</span>.Count; <span class="hljs-variable">$i</span>++) {
  <span class="hljs-variable">$buildCounterUri</span> = <span class="hljs-string">"%env.teamcityUrl%/httpAuth/app/rest/buildTypes/"</span>+<span class="hljs-variable">$buildId</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-string">"/settings/buildNumberCounter"</span>
  <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Method</span> Put <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'accept'</span>=<span class="hljs-string">'text/plain'</span>; <span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$buildCounterUri</span> <span class="hljs-literal">-ContentType</span> <span class="hljs-string">"text/plain"</span> <span class="hljs-literal">-Body</span> <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、teamcityにapiユーザーが必要です（envが作成されています）。</font><font style="vertical-align: inherit;">ログインして、ビルド構成に依存するすべての構成を取得し、ビルドカウンターを1にリセットします。つまり、実際には、各パッチバージョンについて、これは特定のモジュールに対して同じビルドがデプロイされた回数を示しています。</font><font style="vertical-align: inherit;">1がない場合は、現在のバージョンでモジュールをデプロイまたは処理するプロセスに問題があり、注意が必要です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.General</font></font></h3><br>
<img src="https://habrastorage.org/webt/aa/lx/p4/aalxp4uzeiofjnfo0tfdx57z0cs.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョン形式：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.％dep.Module_Build.build.counter％。％Build.counter％-staging</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ここで</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％dep.Module_Build.build.counter％</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はteamcityシステム変数で、その値は対応するビルド構成のビルドカウンターに対応します（以下に追加する必要があります）依存関係）。</font><font style="vertical-align: inherit;">実際、ここで1はメジャーバージョン、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％dep.Module_Build.build.counter％</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はマイナー、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％build.counter％</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はパッチです。</font><font style="vertical-align: inherit;">ステージングは​​プレリリースタグです。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.Env</font></font></h3><br>
<img src="https://habrastorage.org/webt/wl/lc/sv/wllcsv3zxji40gzu-p1ef-vlgu4.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいモジュールを追加すると、そのデプロイメントの構成のみが追加され、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数の値が</font><i><font style="vertical-align: inherit;">示されます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他のすべての変数は、親プロジェクトから継承されます。</font><font style="vertical-align: inherit;">タコ</font><font style="vertical-align: inherit;">の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantModTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から形成され</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></h3><br>
<img src="https://habrastorage.org/webt/zt/yx/2q/ztyx2q7ffqxfpwxtsrrol6ojfqy.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コアパッケージを展開します。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のリリース番号-この環境で利用可能な最新のリリースを使用します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テナントタグ-クライアント/組織タグ。</font><font style="vertical-align: inherit;">タコのセクションで詳細をご覧ください。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追加のCLIパラメーター。</font><font style="vertical-align: inherit;">ここでは、パッケージが含まれるチャネルと追加のパラメーターを示します。</font><font style="vertical-align: inherit;">これについては、タコのセクションで個別に説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deploy.2と同様に、個別のモジュールパッケージのみがデプロイされます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.4</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タコからデータを受信するため、このステップについても以下で詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
会社のウェブサイトと特別モジュールの構成は同じ原理に基づいて構築されており、それらの主要な点は同じであるため、それらを同じように詳細に説明する意味はわかりません。それらは1つであり、何度もデプロイする必要はありません。実際には、nugetの復元、テキストの変換、msbuild、タコのプッシュ、タコの作成、リリース+デプロイがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独自の構成の詳細をご覧ください。</font><font style="vertical-align: inherit;">一部のModについては、環境がない場合があります（ステージングなど）。他のサーバーに展開するか、クライアントIDを手動で設定する必要があります（基本構成を取得し、Powershellを使用してその一部のフィールドを変更します）。</font><font style="vertical-align: inherit;">つまり、メインモジュールと同じ原理で動作します。</font><font style="vertical-align: inherit;">それらの独自性は、ステップが追加または変更されるか、デプロイメントサーバーが変更されてテンプレートに適合しないため、作成に少し時間がかかるという事実にあります。</font><font style="vertical-align: inherit;">幸い、それらはほとんどありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamcity：まとめ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
teamcityの実装により、アプリケーションのアセンブリプロセスに対するより最適なアプローチが可能になりました。今では、はるかに短い時間で済みます。毎回同じコードをビルドする代わりに、一度だけビルドします。また、ディスクスペース、ネットワークトラフィック、および計算時間をより有効に活用します。以前は、デプロイメント用のパッケージ（成果物を含むリポジトリー）の数は、モジュールの数と同じでした。各パッケージの重量は、圧縮された状態で約100Mでした。これで、パッケージの数はモジュールの数よりも1つ多くなり、1つのパッケージの重量はほぼ100Mで、残りのパッケージは約500Kです。さらに、よりユーザーフレンドリーなインターフェース、便利なログ、そして最も重要なこと-ビルドシステムを維持し、構成を追加する時間を短縮します。新しいモジュールの追加には15分から30分かかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それとは別に、新しい構成の作成とその後のメンテナンスにかかる時間を節約できるのは標準化であるため、テンプレートについても言及する必要があります。タコとのやり取り（デプロイ）のすべての構成は、単一のテンプレートに基づいて構築されています。第一に、それは統一することを可能にし、したがってプロセスを簡素化します。次に、すでに述べたように、新しい構成を追加する時間を節約できます。テンプレートを接続し、1つの変数を変更しただけです。そして最も重要なことに、テンプレートはメンテナンスを簡素化します。テンプレートに加えられたすべての変更は、テンプレートに基づく設定によって継承されます。したがって、すべての構成に一度にいくつかのステップを追加する必要がある場合、すべてをクリックする必要はなく、このステップをテンプレートに追加するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然、teamcityのセットアッププロセスはタコのセットアップと連動しています。</font><font style="vertical-align: inherit;">混乱する可能性が非常に高いため、本文中で並行して説明することは不可能です。</font><font style="vertical-align: inherit;">したがって、説明は共有されており、この部分では、CIを提供するためのステップのみが説明されています。</font><font style="vertical-align: inherit;">タコのセットアッププロセスについては、以下で説明します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja496332/index.html">Antidron：UAVとquadrocopter攻撃の反映</a></li>
<li><a href="../ja496334/index.html">Dell U4919DWレビュー：超ワイド49インチ曲面スクリーンモニター</a></li>
<li><a href="../ja496336/index.html">スマートメーターとは何ですか？</a></li>
<li><a href="../ja496338/index.html">危機とそれだけ</a></li>
<li><a href="../ja496340/index.html">Azure MLで画像を描画するための生成的競争ネットワークをトレーニングします</a></li>
<li><a href="../ja496344/index.html">オンラインハッカソンの隔離は適切なタイミングですか？</a></li>
<li><a href="../ja496346/index.html">ルートキットハンターのハッシュチェックを毎日のスクリプトに追加します</a></li>
<li><a href="../ja496348/index.html">Web Storage APIのケーススタディ</a></li>
<li><a href="../ja496350/index.html">通ることならず！-3Dプリンターがコロナウイルスに対応</a></li>
<li><a href="../ja496354/index.html">三元コンピュータープログラミング：エミュレーターで遊ぶ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>