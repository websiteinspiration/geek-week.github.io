<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸ³ ğŸ”• âœ‹ğŸ¿ ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãã«æœªå®šç¾©ã®å‹•ä½œã‚’å›é¿ã™ã‚‹ãŸã‚ã®æ‰‹æ³• ğŸ•´ğŸ¾ ğŸ§™ ğŸ—£ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®è¨˜äº‹ã§ã¯ã€æœ€æ–°ã®c ++ã§ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã®æœªå®šç¾©ã®å‹•ä½œã‚’å›é¿ã™ã‚‹ãŸã‚ã®åŸå› ã¨æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å›ºæœ‰ã®ã‚‚ã®ã¯ãªãã€ã™ã¹ã¦æ¨™æº–ã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚
 
 å‰æ›¸ã
 ã¾ãšã€ãƒãƒ–ãƒ¬ã«é–¢ã™ã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«é–¢ã™ã‚‹ä»–ã®è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãã«æœªå®šç¾©ã®å‹•ä½œã‚’å›é¿ã™ã‚‹ãŸã‚ã®æ‰‹æ³•</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455848/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€æœ€æ–°ã®c ++ã§ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã®æœªå®šç¾©ã®å‹•ä½œã‚’å›é¿ã™ã‚‹ãŸã‚ã®åŸå› ã¨æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å›ºæœ‰ã®ã‚‚ã®ã¯ãªãã€ã™ã¹ã¦æ¨™æº–ã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰æ›¸ã</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãšã€ãƒãƒ–ãƒ¬ã«é–¢ã™ã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«é–¢ã™ã‚‹ä»–ã®è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼š</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®3ã¤ã®æ™‚ä»£</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ¼ãƒ³</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ä¸€èˆ¬çš„ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜ä¸€è²¬ä»»ã®åŸå‰‡</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã«é•åã™ã‚‹3ã¤ã®æ–¹æ³•</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">-ãƒ‘ã‚¿ãƒ¼ãƒ³ã¾ãŸã¯ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼Ÿ</font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æœ€å¾Œã«ã€åŒã˜ãƒˆãƒ”ãƒƒã‚¯ã«è§¦ã‚ŒãŸãŒã€é€šéä¸­ã®è¨˜äº‹ï¼ˆæ¬ é™¥ã‚„åˆ¶é™ãŒè€ƒæ…®ã•ã‚Œãªã‹ã£ãŸå ´åˆã®ã¿ï¼‰ï¼š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tializedã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã¤ã¾ã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¨</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã®å¯¿å‘½ï¼‰</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ¬¡ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®å»ºç¯‰ç‰¹æ€§ã«é–¢ã™ã‚‹è¨˜äº‹ã§</font><font style="vertical-align: inherit;">ã¯ã‚ã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ã€Œã²ã©ãã¦ã²ã©ã„ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‹ã‚‰ç™½ãã¦ãµã‚ãµã‚ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’ä½œã‚‹æ–¹æ³•ã€ã¨ã„ã†è¨˜äº‹ã§</font><font style="vertical-align: inherit;">ã¯ã‚ã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã§</font><font style="vertical-align: inherit;">ã¯ã‚ã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«å¯¾ã™ã‚‹åå­—è»ã§</font><font style="vertical-align: inherit;">ã¯ã‚ã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰ã®è¨˜äº‹ã§</font><font style="vertical-align: inherit;">ã¯ã‚ã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã›ã‚“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã¯éå¸¸ã«é‡è¦ã§ã™ãŒã€æœ€æ–°ã®C ++ã§ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’ä½¿ç”¨ã™ã‚‹æŠ€è¡“çš„ãªå´é¢ã«ã¤ã„ã¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">è¨˜äº‹ã®ä¸»ãªæ³¨æ„ã¯ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®ç ´å£Šã®ç¬é–“ã«å‘ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã»ã¨ã‚“ã©ã®æƒ…å ±æºã§ã€ç ´å£Šã®å•é¡Œã¯ååˆ†ã«é–‹ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ã¯ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒä½œæˆã•ã‚ŒãŸç¬é–“ã«é‡ç‚¹ãŒç½®ã‹ã‚Œã€ç ´å£Šã«ã¤ã„ã¦ã¯ã€ã›ã„ãœã„ã€Œé€†ã®é †åºã§ç ´å£Šã•ã‚ŒãŸã€ãªã©ã¨è¡¨ç¾ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹ã«ã€Œã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³vsã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ›ãƒªãƒãƒ¼ã‚’é…ç½®ã—ãªã„ã‚ˆã†ã«ã€ã‚³ãƒ¡ãƒ³ãƒˆã®è¨˜äº‹ã®ç¯„å›²ã«å¾“ã£ã¦ãã ã•ã„ã€‚</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã˜ã‚ƒã€è¡Œã“ã†ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨™æº–ãŒè¨€ã†ã“ã¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¼•ç”¨ã¯C ++ 14æœ€çµ‚ãƒ‰ãƒ©ãƒ•ãƒˆN3936ã‹ã‚‰ã®ã‚‚ã®ã§ã™ã€‚</font><font style="vertical-align: inherit;">åˆ©ç”¨å¯èƒ½ãªC ++ 17ãƒ‰ãƒ©ãƒ•ãƒˆã¯ã€Œæœ€çµ‚ã€ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€ã‚‚é‡è¦ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ç¤ºã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ã¯é‡è¦ãªå ´æ‰€ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.3çµ‚äº†[basic.start.term] </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.åˆæœŸåŒ–ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã¤ã¾ã‚Šã€æœ‰åŠ¹æœŸé–“ï¼ˆ3.8ï¼‰ãŒé–‹å§‹ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã®é™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã‚’æŒã¤ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ï¼ˆ12.4ï¼‰ã¯ã€ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®çµæœã¨ã—ã¦ã€ãŠã‚ˆã³çµæœã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã¾ã™std :: exitï¼ˆ18.5ï¼‰ã®å‘¼ã³å‡ºã—ã€‚</font><font style="vertical-align: inherit;">ç‰¹å®šã®ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã‚’æŒã¤åˆæœŸåŒ–ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã®åˆæœŸé–¢æ•°ã‹ã‚‰æˆ»ã£ãŸçµæœã€ãŠã‚ˆã³ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒstd :: exitã‚’å‘¼ã³å‡ºã—ãŸçµæœã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚</font></font><b>The completions of the destructors for all initialized objects with thread storage duration within that thread are sequenced before the initiation of the destructors of any object with static storage duration. If the completion of the constructor or dynamic initialization of an object with thread storage duration is sequenced before that of another, the completion of the destructor of the second is sequenced before the initiation of the destructor of the first. If the completion of the constructor or dynamic initialization of an object with static storage duration is sequenced before that of another, the completion of the destructor of the second is sequenced before the initiation of the destructor of the first.</b> [ Note: This definition permits concurrent destruction. â€”end note ] If an object is initialized statically, the object is destroyed in the same order as if the object was dynamically initialized. For an object of array or class type, all subobjects of that object are destroyed before any block-scope object with static storage duration initialized during the construction of the subobjects is destroyed. If the destruction of an object with static or thread storage duration exits via an exception, std::terminate is called (15.5.1).<br>
<br>
2. <b>If a function contains a block-scope object of static or thread storage duration that has been destroyed and the function is called during the destruction of an object with static or thread storage duration, the program has undefined behavior if the flow of control passes through the definition of the previously destroyed blockscope object.</b> Likewise, the behavior is undefined if the block-scope object is used indirectly (i.e., through a pointer) after its destruction.<br>
<br>
<b>3. If the completion of the initialization of an object with static storage duration is sequenced before a call to std::atexit (see Â«cstdlibÂ», 18.5), the call to the function passed to std::atexit is sequenced before the call to the destructor for the object. If a call to std::atexit is sequenced before the completion of the initialization of an object with static storage duration, the call to the destructor for the object is sequenced before the call to the function passed to std::atexit. If a call to std::atexit is sequenced before another call to std::atexit, the call to the function passed to the second std::atexit call is sequenced before the call to the function passed to the first std::atexit call.</b><br>
<br>
4. If there is a use of a standard library object or function not permitted within signal handlers (18.10) that does not happen before (1.10) completion of destruction of objects with static storage duration and execution of std::atexit registered functions (18.5), the program has undefined behavior. [ Note: If there is a use of an object with static storage duration that does not happen before the objectâ€™s destruction, the program has undefined behavior. Terminating every thread before a call to std::exit or the exit from main is sufficient, but not necessary, to satisfy these requirements. These requirements permit thread managers as static-storage-duration objects. â€”end note ]<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5.ã€Œcstdlibã€ã§å®£è¨€ã•ã‚ŒãŸé–¢æ•°std :: abortï¼ˆï¼‰ã‚’å‘¼ã³å‡ºã™ã¨ã€ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å®Ÿè¡Œã›ãšã«ã€ã¾ãŸstd :: atexitï¼ˆï¼‰ã¾ãŸã¯std :: at_quick_exitï¼ˆï¼‰ã«æ¸¡ã•ã‚ŒãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã•ãšã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã—ã¾ã™ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è§£é‡ˆï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´æ£„ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨ã¯é€†ã®é †åºã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å³å¯†ã«è¨€ãˆã°ã€é™çš„ãªä¿å­˜æœŸé–“ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç ´æ£„ã•ã‚Œã€std :: atexitã«ç™»éŒ²ã•ã‚ŒãŸé–¢æ•°ãŒã€ãã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨ç™»éŒ²ã¨ã¯é€†ã®é †åºã§å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã¾ãŸã¯é™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã§ç ´æ£„ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€æœªå®šç¾©ã®å‹•ä½œãŒå«ã¾ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å†åˆæœŸåŒ–ã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨ï¼šæ¨™æº–ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¯ã€ã€Œé™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã‚’æŒã¤éãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã€ã¨å‘¼ã°ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®çµæœã€ã™ã¹ã¦ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã€ã™ã¹ã¦ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ¼ãƒ³ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ï¼‰ã€ãŠã‚ˆã³std :: atexitã¸ã®ã™ã¹ã¦ã®å‘¼ã³å‡ºã—ãŒã€ãã‚Œã‚‰ãŒä½œæˆ/ç™»éŒ²ã•ã‚Œã‚‹ã¨ã€å˜ä¸€ã®LIFOã‚­ãƒ¥ãƒ¼ã«åˆ†é¡ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®è¨˜äº‹ã«å½¹ç«‹ã¤æƒ…å ±ã¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.6.2éãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®åˆæœŸåŒ–[basic.start.init]ã«</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚‚å«ã¾ã‚Œã¦ã„</font><b><font style="vertical-align: inherit;">ã¾ã™</font></b><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æœ€ã‚‚é‡è¦ãªã‚‚ã®ã ã‘ã‚’æŒ™ã’ã¾ã™ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™çš„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœŸé–“ã‚’æŒã¤éãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã®å‹•çš„åˆæœŸåŒ–ã¯ã€é †åºä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ã‹ã€é †åºä»˜ã‘ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">[...]å˜ä¸€ã®ç¿»è¨³å˜ä½å†…ã§å®šç¾©ã•ã‚ŒãŸé †åºä»˜ã‘ã‚‰ã‚ŒãŸåˆæœŸåŒ–ã‚’æŒã¤å¤‰æ•°ã¯ã€ç¿»è¨³å˜ä½ã§ã®å®šç¾©ã®é †åºã§åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è§£é‡ˆï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å…¨æ–‡ã‚’è€ƒæ…®ã«å…¥ã‚Œã‚‹ï¼‰ï¼š1ã¤ã®ç¿»è¨³å˜ä½å†…ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¯ã€å®£è¨€é †ã«åˆæœŸåŒ–ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã«å«ã¾ã‚Œã‚‹ã‚‚ã®</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¨˜äº‹ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">githubã§</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¬é–‹ã•ã‚Œã¦ã„</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã¯ã€ã¾ã‚‹ã§åˆ¥ã®äººãŒæ›¸ã„ãŸã‹ã®ã‚ˆã†ã«ã€3ã¤ã®å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‚¯ãƒ©ã‚¹ï¼‰;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ãƒ¡ã‚¤ãƒ³ï¼‰ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚ˆã†ãªã‚‚ã®ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰åˆ†é›¢ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã¾ã™ãŒã€ä¸å¯èƒ½ã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«è¡Œå‹•ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ€åˆã«ã™ã¹ã¦ã‚’æ­£ã—ãè¡Œã„ã€æ¬¡ã«æ‰‹é¦–ã‚’æŒ¯ã‚‹ã ã‘ã§ã™ã¹ã¦ãŒå£Šã‚Œã¾ã™ã€‚æœ€åˆã«ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä¿®æ­£ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ã†ã¾ãã„ã‹ãªã„å ´åˆã¯ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä¿®æ­£ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã§ã¯ã€å¸¸ã«ã‚¨ãƒƒã‚¸ã«æ²¿ã£ã¦æ­©ãã¾ã™-ä»Šåº¦ã¯æ˜ã‚‹ã„å´ã«ã€æ¬¡ã«æš—ã„å´ã«ã€‚ãƒ€ãƒ¼ã‚¯ã‚µã‚¤ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€æœ€ã‚‚å›°é›£ãªã‚±ãƒ¼ã‚¹ãŒé¸æŠã•ã‚Œã¾ã—ãŸã€‚ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰å‘¼ã³å‡ºã™ã‚±ãƒ¼ã‚¹ãŒæœ€ã‚‚é›£ã—ã„ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ€å°åŒ–ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€ã€Œã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒç ´å£Šã•ã‚ŒãŸã‹ã©ã†ã‹ã€ã¨ã„ã†è³ªå•ãŒé–¢é€£ã™ã‚‹å ´åˆã«è©²å½“ã—ã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ã‚‹ç¨®ã®åˆæˆã‚±ãƒ¼ã‚¹ã€‚</font><font style="vertical-align: inherit;">å®Ÿéš›ã«ã¯ã€ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’å‘¼ã³å‡ºã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…è¦ã«å¿œã˜ã¦ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç ´å£Šã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ¼ãƒ³ã®3ã¤ã®ã‚¯ãƒ©ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonClassic-ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">å®Ÿéš›ã€ã“ã‚Œã¯ç›´æ¥å®Œå…¨ã«å¤å…¸çš„ã¨ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€è€ƒãˆã‚‰ã‚Œã‚‹3ã¤ã®ä¸­ã§æœ€ã‚‚å¤å…¸çš„ã§ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonShared-stdã‚’ä½¿ç”¨ï¼š:: shared_ptr;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonWeak-std :: weak_ptrã‚’ä½¿ç”¨ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ¼ãƒ³ã¯ã™ã¹ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã€ãã‚Œã‚’ç¶™æ‰¿ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã»ã¨ã‚“ã©ã®ä¾‹ã§ã¯ã€ãã‚Œã‚‰ã¯Payloadã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼åŒ–ã•ã‚Œã€std ::ã‚»ãƒƒãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®1ã¤ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯é–¢æ•°ã‚’æä¾›ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã»ã¨ã‚“ã©ã®ä¾‹ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ã€100ã®å€¤ã‚’å…¥åŠ›ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã€ãŠã‚ˆã³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆï¼‰ã‹ã‚‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®è¨ºæ–­å‡ºåŠ›ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªãœãã‚“ãªã«é›£ã—ã„ã®ã§ã™ã‹ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ãŸã¡ãŒãƒ€ãƒ¼ã‚¯ã‚µã‚¤ãƒ‰ã«ã„ã‚‹ã“ã¨ã‚’ç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã€‚</font><font style="vertical-align: inherit;">ç ´å£Šã•ã‚ŒãŸã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«å¯¾ã™ã‚‹ã‚¢ãƒ”ãƒ¼ãƒ«ã¯æœªå®šç¾©ã®å‹•ä½œã§ã™ãŒã€å¤–éƒ¨ã‹ã‚‰ã¯æ˜ç¤ºã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç ´æ£„ã•ã‚ŒãŸstd ::ã‚»ãƒƒãƒˆã«å€¤ã‚’è©°ã‚è¾¼ã‚“ã§ã‚‚ã€å¤–éƒ¨ã®æ˜ç¤ºãŒä¿è¨¼ã•ã‚Œãªã„ã“ã¨ã¯ç¢ºã‹ã§ã™ãŒã€ä¿¡é ¼ã§ãã‚‹æ–¹æ³•ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆå®Ÿéš›ã«ã¯ã€Linuxã®GCCã§ã¯ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®èª¤ã£ãŸä¾‹ã§ã¯ã€ç ´æ£„ã•ã‚ŒãŸstd ::ã‚»ãƒƒãƒˆãŒæ­£å¸¸ã«è©°ã‚è¾¼ã¾ã‚Œã€MSVSã§ã¯Windows-ãƒãƒ³ã‚°ã—ã¾ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">æœªå®šç¾©ã®å‹•ä½œã§ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®å‡ºåŠ›ãŒ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡Œã‚ã‚Œãªã„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å ´åˆãŒ</font><b><font style="vertical-align: inherit;">ã‚ã‚Š</font></b><font style="vertical-align: inherit;">ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€æ­£ã—ã„ä¾‹ã§ã¯ã€ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¾Œã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆï¼‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒãªã„ã“ã¨ã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã“ã¨ã€ãƒãƒ³ã‚°ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã“ã¨ã€èª¤ã£ãŸã‚±ãƒ¼ã‚¹ã§ã¯ã€ãã®ã‚ˆã†ãªã‚¢ãƒ”ãƒ¼ãƒ«ã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã€ãƒãƒ³ã‚°ã®ã„ãšã‚Œã‹ã€ã¾ãŸã¯ã™ã¹ã¦ã®çµ„ã¿åˆã‚ã›ã§ä¸€åº¦ã«ã™ã¹ã¦ãŒäºˆæœŸã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Payload.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;set&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Payload</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  Payload() = <span class="hljs-keyword">default</span>;<font></font>
  ~Payload() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
  Payload(<span class="hljs-keyword">const</span> Payload &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  Payload(Payload &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  Payload&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> Payload &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  Payload&amp; <span class="hljs-keyword">operator</span>=(Payload &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span>
  </span>{<font></font>
    m_data.emplace(value);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">set</span>&lt;<span class="hljs-keyword">int</span>&gt; m_data;<font></font>
};<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonClassic.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonClassic</span> :</span> <span class="hljs-keyword">public</span> T<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
  ~SingletonClassic()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~SingletonClassic()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  SingletonClassic(<span class="hljs-keyword">const</span> SingletonClassic &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonClassic(SingletonClassic &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  SingletonClassic&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> SingletonClassic &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonClassic&amp; <span class="hljs-keyword">operator</span>=(SingletonClassic &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">static</span> SingletonClassic&amp; <span class="hljs-title">instance</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"instance()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">static</span> SingletonClassic inst;
    <span class="hljs-keyword">return</span> inst;<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
  SingletonClassic()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"SingletonClassic()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
};<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonClassicã®ä¾‹1</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classic_Example1_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonClassic.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassicSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
    SingletonClassic&lt;Payload&gt;::instance();<font></font>
  }<font></font>
<font></font>
  ~ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-keyword">auto</span> &amp;instance = SingletonClassic&lt;Payload&gt;::instance();
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
      instance.add(i);<font></font>
  }<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of modified ClassicSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;ClassicSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;ClassicSingleThreadedUtility&gt;();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utilityUnique;</span>
<span class="hljs-comment">// - singleton;</span>
<span class="hljs-comment">// - emptyUnique.</span>
<span class="hljs-comment">// This order is correct</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonClassic()<br>
instance()<br>
~SingletonClassic()<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒä½œæˆã•ã‚Œã‚‹å‰ã«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯2ã¤ã®std :: unique_ptrã‚’ä½œæˆã—ã¾ã™ã€‚1ã¤ã¯ç©ºã§ã€ã‚‚ã†1ã¤ã¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å«ã¿ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œæˆé †åºï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ç©ºã®std :: unique_ptrã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ãã‚Œã«å¿œã˜ã¦ã€ç ´å£Šã®é †åºï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -ç©ºã®std :: unique_ptrã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‹ã‚‰ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¸ã®å‘¼ã³å‡ºã—ã¯æ­£ã—ã„ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã®ä¾‹2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ãŒåŒã˜ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œã‚’å–ã‚Šã€1è¡Œã§ã™ã¹ã¦ã‚’å°ç„¡ã—ã«ã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classic_Example2_incorrect.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonClassic.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassicSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
    SingletonClassic&lt;Payload&gt;::instance();<font></font>
  }<font></font>
<font></font>
  ~ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-keyword">auto</span> &amp;instance = SingletonClassic&lt;Payload&gt;::instance();
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
      instance.add(i);<font></font>
  }<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of modified ClassicSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;ClassicSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;ClassicSingleThreadedUtility&gt;();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utilityUnique;</span>
<span class="hljs-comment">// - singleton;</span>
<span class="hljs-comment">// - emptyUnique.</span>
<span class="hljs-comment">// This order seems to be correct ...</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// ... but user swaps unique_ptrs</span><font></font>
  emptyUnique.swap(utilityUnique);<font></font>
<font></font>
  <span class="hljs-comment">// Guaranteed destruction order is still the same:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique,</span>
  <span class="hljs-comment">// but now utilityUnique is empty, and emptyUnique is filled,</span>
  <span class="hljs-comment">// so destruction order is incorrect</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonClassic()<br>
~SingletonClassic()<br>
instance()<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œæˆã¨ç ´æ£„ã®é †åºã¯ä¿æŒã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã™ã¹ã¦ãŒã¾ã æ®‹ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€é•ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">emptyUnique.swapï¼ˆutilityUniqueï¼‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœªå®šç¾©ã®å‹•ä½œã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªãœãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®ã‚ˆã†ãªæ„šã‹ãªã“ã¨ã‚’ã—ãŸã®ã§ã™ã‹ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½¼ãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†…éƒ¨æ§‹é€ ã«ã¤ã„ã¦ä½•ã‚‚çŸ¥ã‚‰ãªã„ã‹ã‚‰ã§ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ã‚ãªãŸãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å†…éƒ¨æ§‹é€ ã‚’çŸ¥ã£ã¦ã„ã‚‹ãªã‚‰ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...ã¨ã«ã‹ãå®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€é–¢ä¸ã™ã‚‹ã®ã¯éå¸¸ã«ç°¡å˜ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ã‚ãªãŸã¯è‹¦ç—›ãªãƒ‡ãƒãƒƒã‚°ã«ã‚ˆã£ã¦æŠœã‘å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€ãªãœãªã‚‰ </font><font style="vertical-align: inherit;">ä½•ãŒèµ·ã“ã£ãŸã®ã‹ã‚’æ­£ç¢ºã«ç†è§£ã™ã‚‹ã“ã¨ã¯å®¹æ˜“ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ­£ã—ãä½¿ç”¨ã™ã‚‹å¿…è¦ãŒãªã„ã®ã¯ãªãœã§ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ã•ã¦ã€æ›¸ããƒ‰ãƒƒã‚¯ã«ã¯ã•ã¾ã–ã¾ãªç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ã‚’æŒ™ã’</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¾ã—ã‚‡ã†</font><b><font style="vertical-align: inherit;">ã€‚</font></b><font style="vertical-align: inherit;">ãã—ã¦ã€ã ã¾ã—ã«ãã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ã¦ã¿ã¾ã›ã‚“ã‹ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã®ä¾‹3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¨˜äº‹ã‚’æ•°æ—¥é–“ä½œæˆã™ã‚‹éç¨‹ã§ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å‰ã®ä¾‹ã‹ã‚‰ä¸æ˜ç¢ºãªå‹•ä½œã‚’æ’é™¤ã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã‚ã‚Šã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã¨æ€ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«ã€è§£æ±ºç­–ãŒæ€ã„ä»˜ãã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã¨èª¬æ˜ã§ã‚¹ãƒã‚¤ãƒ©ãƒ¼ã‚’é–‹ãå‰ã«ã€èª­è€…ãŒè‡ªåˆ†ã§çŠ¶æ³ã‹ã‚‰æŠœã‘å‡ºã™æ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹ã‚ˆã†ã«è©¦ã¿ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼ˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã®ã¿ï¼ï¼‰ã€‚</font><font style="vertical-align: inherit;">ã‚ˆã‚Šè‰¯ã„è§£æ±ºç­–ãŒã‚ã‚‹ã“ã¨ã‚’é™¤å¤–ã—ã¾ã›ã‚“ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classic_Example3_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonClassic.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassicSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-keyword">thread_local</span> <span class="hljs-keyword">auto</span> flag_strong = <span class="hljs-built_in">std</span>::make_shared&lt;<span class="hljs-keyword">char</span>&gt;(<span class="hljs-number">0</span>);<font></font>
    m_flag_weak = flag_strong;<font></font>
<font></font>
    SingletonClassic&lt;Payload&gt;::instance();<font></font>
  }<font></font>
<font></font>
  ~ClassicSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> ( !m_flag_weak.expired() )<font></font>
    {<font></font>
      <span class="hljs-keyword">auto</span> &amp;instance = SingletonClassic&lt;Payload&gt;::instance();
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
        instance.add(i);<font></font>
    }<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-built_in">std</span>::weak_ptr&lt;<span class="hljs-keyword">char</span>&gt; m_flag_weak;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of modified ClassicSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;ClassicSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;ClassicSingleThreadedUtility&gt;();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utilityUnique;</span>
<span class="hljs-comment">// - singleton;</span>
<span class="hljs-comment">// - emptyUnique.</span>
<span class="hljs-comment">// This order seems to be correct ...</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// ... but user swaps unique_ptrs</span><font></font>
  emptyUnique.swap(utilityUnique);<font></font>
<font></font>
  {<font></font>
    <span class="hljs-comment">// To demonstrate normal processing before application ends</span>
    <span class="hljs-keyword">auto</span> utility = ClassicSingleThreadedUtility();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// Guaranteed destruction order is still the same:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique,</span>
  <span class="hljs-comment">// but now utilityUnique is empty, and emptyUnique is filled,</span>
  <span class="hljs-comment">// so destruction order is incorrect ...</span>
  <span class="hljs-comment">// ... but utility uses a variable with thread storage duration to detect thread termination.</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonClassic()<br>
instance()<br>
instance()<br>
~SingletonClassic()<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èª¬æ˜</font></font></b><div class="spoiler_text">     .     ,      .     flag_strong  std::shared_ptr,   thread storage duration (.      ) â€”   ,        <b>    </b>,    â€”   .  flag_strong â€”    ,         weak-.<br>
<br>
      , ..    .  ,    ,   (  )   .        ,        â€”  ,   .<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³å…±æœ‰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
std :: shared_ptrã«åŸºã¥ã„ã¦å¤‰æ›´ã•ã‚ŒãŸã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ç§»ã‚Šã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonShared.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonShared</span> :</span> <span class="hljs-keyword">public</span> T<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
  ~SingletonShared()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~SingletonShared()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  SingletonShared(<span class="hljs-keyword">const</span> SingletonShared &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonShared(SingletonShared &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  SingletonShared&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> SingletonShared &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonShared&amp; <span class="hljs-keyword">operator</span>=(SingletonShared &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonShared&gt; <span class="hljs-title">instance</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"instance()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">// "new" and no std::make_shared because of private c-tor</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">auto</span> inst = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonShared&gt;(<span class="hljs-keyword">new</span> SingletonShared);
    <span class="hljs-keyword">return</span> inst;<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
  SingletonShared()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"SingletonShared()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
};<font></font>
</code></pre><br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ã‚ã€ã‚ã‚ã€æ–°ã—ã„æ¼”ç®—å­ã¯æœ€è¿‘ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚ä»£ã‚ã‚Šã«std :: make_sharedãŒå¿…è¦ã§ã™ï¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ã“ã‚Œã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã‚ˆã£ã¦é˜²æ­¢ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒï¼</font><font style="vertical-align: inherit;">ç§ã‚‚å•é¡ŒãŒã‚ã‚Šã¾ã™ï¼</font><font style="vertical-align: inherit;">stdã‚’å®£è¨€ã—ã¾ã™::ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’make_sharedã—ã¾ã™ï¼</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³PublicMorozovã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚åŒã˜std :: make_sharedã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§æä¾›ã•ã‚Œã¦ã„ãªã„ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®è¿½åŠ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³å…±æœ‰ã®ä¾‹1ãŠã‚ˆã³2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¾‹1ã¨2ã«å®Œå…¨ã«å¯¾å¿œã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">é‡è¦ãªå¤‰æ›´ã¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å¯¾ã—ã¦ã®ã¿è¡Œã‚ã‚Œã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯åŸºæœ¬çš„ã«åŒã˜ã¾ã¾ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®ä¾‹ã¨åŒæ§˜ã«ã€example-1ã¯æ­£ã—ãã€example-2ã¯æœªå®šç¾©ã®å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared_Example1_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonShared.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Payload.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
    SingletonShared&lt;Payload&gt;::instance();<font></font>
  }<font></font>
<font></font>
  ~SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">auto</span> instance = SingletonShared&lt;Payload&gt;::instance() )
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
        instance-&gt;add(i);<font></font>
  }<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of modified SharedSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SharedSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;SharedSingleThreadedUtility&gt;();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utilityUnique;</span>
<span class="hljs-comment">// - singleton;</span>
<span class="hljs-comment">// - emptyUnique.</span>
<span class="hljs-comment">// This order is correct</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonShared()<br>
instance()<br>
~SingletonShared()<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared_Example2_incorrect.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonShared.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
    SingletonShared&lt;Payload&gt;::instance();<font></font>
  }<font></font>
<font></font>
  ~SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// Sometimes this check may result as "false" even for destroyed singleton</span>
    <span class="hljs-comment">// preventing from visual effects of undefined behaviour ...</span>
    <span class="hljs-comment">//if ( auto instance = SingletonShared::instance() )</span>
    <span class="hljs-comment">//  for ( int i = 0; i &lt; 100; ++i )</span>
    <span class="hljs-comment">//    instance-&gt;add(i);</span><font></font>
<font></font>
    <span class="hljs-comment">// ... so this code will demonstrate UB in colour</span>
    <span class="hljs-keyword">auto</span> instance = SingletonShared&lt;Payload&gt;::instance();
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
      instance-&gt;add(i);<font></font>
  }<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of modified SharedSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SharedSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;SharedSingleThreadedUtility&gt;();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utilityUnique;</span>
<span class="hljs-comment">// - singleton;</span>
<span class="hljs-comment">// - emptyUnique.</span>
<span class="hljs-comment">// This order seems to be correct ...</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// ... but user swaps unique_ptrs</span><font></font>
  emptyUnique.swap(utilityUnique);<font></font>
<font></font>
  <span class="hljs-comment">// Guaranteed destruction order is the same:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique,</span>
  <span class="hljs-comment">// but now utilityUnique is empty, and emptyUnique is filled,</span>
  <span class="hljs-comment">// so destruction order is incorrect</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonShared()<br>
~SingletonShared()<br>
instance()<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³å…±æœ‰ã®ä¾‹3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã•ã¦ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã®ä¾‹3ã‚ˆã‚Šã‚‚ã“ã®å•é¡Œã‚’ä¿®æ­£ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£æ±ºç­–ã¯æ˜ç™½ã§ã™ã€‚ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã‚ˆã£ã¦è¿”ã•ã‚ŒãŸstd :: shared_ptrã®ã‚³ãƒ”ãƒ¼ã‚’ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«æ ¼ç´ã™ã‚‹ã“ã¨ã§ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®å¯¿å‘½ã‚’å»¶ã°ã™å¿…è¦ãŒã‚ã‚‹ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€SingletonSharedã‚’å‚™ãˆãŸã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§åºƒãè¤‡è£½ã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared_Example3_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonShared.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SharedSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_singleton(SingletonShared&lt;Payload&gt;::instance())<font></font>
  {<font></font>
  }<font></font>
<font></font>
  ~SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// Sometimes this check may result as "false" even for destroyed singleton</span>
    <span class="hljs-comment">// preventing from visual effects of undefined behaviour ...</span>
    <span class="hljs-comment">//if ( m_singleton )</span>
    <span class="hljs-comment">//  for ( int i = 0; i &lt; 100; ++i )</span>
    <span class="hljs-comment">//    m_singleton-&gt;add(i);</span><font></font>
<font></font>
    <span class="hljs-comment">// ... so this code will allow to demonstrate UB in colour</span>
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
      m_singleton-&gt;add(i);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonShared&lt;Payload&gt;&gt; m_singleton;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of SharedSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SharedSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;SharedSingleThreadedUtility&gt;();<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// This guarantee destruction in order:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique.</span>
  <span class="hljs-comment">// This order is correct ...</span>
  <span class="hljs-comment">// ... but user swaps unique_ptrs</span><font></font>
  emptyUnique.swap(utilityUnique);<font></font>
<font></font>
  <span class="hljs-comment">// Guaranteed destruction order is the same:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique,</span>
  <span class="hljs-comment">// but now utilityUnique is empty, and emptyUnique is filled,</span>
  <span class="hljs-comment">// so destruction order is incorrect...</span><font></font>
<font></font>
  <span class="hljs-comment">// ... but utility have made a copy of shared_ptr when it was available,</span>
  <span class="hljs-comment">// so it's correct again.</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonShared()<br>
~SingletonShared()<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ä»Šã€æ³¨æ„ã€å•é¡Œã¯æ¬¡ã®ã¨ãŠã‚Š</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã™ã€‚æœ¬å½“ã«ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®å¯¿å‘½ã‚’å»¶ã°ã—ãŸã„ã¨æ€ã„ã¾ã—ãŸã‹ï¼Ÿ</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã¨ã‚‚ã€ä¸ç¢ºå®šãªè¡Œå‹•ã‚’å–ã‚Šé™¤ãã€è¡¨é¢ä¸Šã«æ¨ªãŸã‚ã‚‹æ–¹æ³•ã¨ã—ã¦å»¶å‘½ã‚’é¸æŠã—ã¾ã—ãŸã‹ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰‹æ®µã«ã‚ˆã‚‹ç›®æ¨™ã®ä»£æ›¿ã¨ã„ã†å½¢ã§ã®ç†è«–çš„ãªèª¤ã‚Šã¯ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ï¼ˆã¾ãŸã¯å¾ªç’°å‚ç…§-å¿…è¦ãªã‚‚ã®ã¨å‘¼ã¶ï¼‰ã®ãƒªã‚¹ã‚¯ã«ã¤ãªãŒã‚Šã¾ã™ã€‚</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã„nuuuuuuuã€ã“ã‚Œã¯ã‚ãªãŸãŒä¸€ç”Ÿæ‡¸å‘½åŠªåŠ›ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„æ–¹æ³•ã§ã™ï¼ï¼Ÿ</font><font style="vertical-align: inherit;">ã‚ãªãŸã¯ãã‚“ãªã«é•·ã„é–“æ€ã„ã¤ãå¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€ãã—ã¦ã‚ãªãŸã¯ç¢ºã‹ã«å¶ç„¶ãã‚Œã‚’ã—ãªã„ã§ã—ã‚‡ã†ï¼</font></font></b><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CallbackPayload.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;functional&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallbackPayload</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  CallbackPayload() = <span class="hljs-keyword">default</span>;<font></font>
  ~CallbackPayload() = <span class="hljs-keyword">default</span>;<font></font>
<font></font>
  CallbackPayload(<span class="hljs-keyword">const</span> CallbackPayload &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  CallbackPayload(CallbackPayload &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  CallbackPayload&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> CallbackPayload &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  CallbackPayload&amp; <span class="hljs-keyword">operator</span>=(CallbackPayload &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCallback</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>()&gt; &amp;&amp;fn)</span>
  </span>{<font></font>
    m_callbackFn = <span class="hljs-built_in">std</span>::move(fn);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>()&gt; m_callbackFn;<font></font>
};<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SomethingWithVeryImportantDestructor.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomethingWithVeryImportantDestructor</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SomethingWithVeryImportantDestructor()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"SomethingWithVeryImportantDestructor()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
  ~SomethingWithVeryImportantDestructor()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~SomethingWithVeryImportantDestructor()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  SomethingWithVeryImportantDestructor(<span class="hljs-keyword">const</span> SomethingWithVeryImportantDestructor &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SomethingWithVeryImportantDestructor(SomethingWithVeryImportantDestructor &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  SomethingWithVeryImportantDestructor&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> SomethingWithVeryImportantDestructor &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SomethingWithVeryImportantDestructor&amp; <span class="hljs-keyword">operator</span>=(SomethingWithVeryImportantDestructor &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
};<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared_Example4_incorrect.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonShared.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CallbackPayload.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SomethingWithVeryImportantDestructor.h"</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SharedSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_singleton(SingletonShared&lt;CallbackPayload&gt;::instance())<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"SharedSingleThreadedUtility()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  ~SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~SharedSingleThreadedUtility()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCallback</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>()&gt; &amp;&amp;fn)</span>
  </span>{
    <span class="hljs-keyword">if</span> ( m_singleton )<font></font>
      m_singleton-&gt;setCallback(<span class="hljs-built_in">std</span>::move(fn));<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonShared&lt;CallbackPayload&gt;&gt; m_singleton;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">auto</span> utility = <span class="hljs-built_in">std</span>::make_shared&lt;SharedSingleThreadedUtility&gt;();
  <span class="hljs-keyword">auto</span> something = <span class="hljs-built_in">std</span>::make_shared&lt;SomethingWithVeryImportantDestructor&gt;();<font></font>
<font></font>
  <span class="hljs-comment">// lambda with "utility" and "something" captured</span><font></font>
  utility-&gt;setCallback( [utility, something](){} );<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonShared()<br>
SharedSingleThreadedUtility()<br>
SomethingWithVeryImportantDestructor()<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã¯ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Something-C-very-important-destructors</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆç§ãŒå¨åœ§çš„ã«è¿½åŠ ã—ãŸ</font><b><font style="vertical-align: inherit;">ã‚‚ã®</font></b><font style="vertical-align: inherit;">ã§ã™ï¼‰ã§ä½œæˆã•</font><font style="vertical-align: inherit;">ã‚Œã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãªã©ã®ä½ç½®ãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã§ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯å‘¼ã³å‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®ãŸã‚ï¼Ÿ</font><font style="vertical-align: inherit;">æ‰‹æ®µã«ã‚ˆã‚‹ç›®æ¨™ã®ä»£æ›¿ã®ãŸã‚ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³å¼±</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonWeak.h</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> once</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingletonWeak</span> :</span> <span class="hljs-keyword">public</span> T<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:<font></font>
  ~SingletonWeak()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~SingletonWeak()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  SingletonWeak(<span class="hljs-keyword">const</span> SingletonWeak &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonWeak(SingletonWeak &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  SingletonWeak&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> SingletonWeak &amp;) = <span class="hljs-keyword">delete</span>;<font></font>
  SingletonWeak&amp; <span class="hljs-keyword">operator</span>=(SingletonWeak &amp;&amp;) = <span class="hljs-keyword">delete</span>;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::weak_ptr&lt;SingletonWeak&gt; <span class="hljs-title">instance</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"instance()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-comment">// "new" and no std::make_shared because of private c-tor</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">auto</span> inst = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonWeak&gt;(<span class="hljs-keyword">new</span> SingletonWeak);
    <span class="hljs-keyword">return</span> inst;<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:<font></font>
  SingletonWeak()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"SingletonWeak()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
};<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã“ã®ã‚ˆã†ãªå¤‰æ›´ãŒåŠ ãˆã‚‰ã‚ŒãŸã¨ã—ã¦ã‚‚ã€ãã‚Œã¯ãã‚Œã»ã©é »ç¹ã«ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">std :: weak_ptrã§è£è¿”ã—ã«ãªã£ãŸã„ãã¤ã‹ã®å¥‡å¦™ãªå¤‰ç¨®ã«å‡ºä¼šã„ã¾ã—ãŸã€‚ã“ã‚Œã¯ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®å¯¿å‘½ã‚’å»¶ã°ã™ä»¥å¤–ã«ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã—ã¦ã„ãªã„ã‚ˆã†ã§ã™ã€‚</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stdã‚’ä½¿ç”¨ã—ãŸã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³:: weak_ptr</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weak_ptrã§sinlgetonã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã®ã¯æ­£ã—ã„æ–¹æ³•ã§ã™ã‹</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ­£ã—ãé©ç”¨ã™ã‚‹ã¨ã€ç§ãŒææ¡ˆã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼š</font></font><br>
 <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®é˜²æ­¢ãªã©ã€ä¸Šè¨˜ã®ä¾‹ã§èª¬æ˜ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ä¿è­·ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classic_Example3_correctã®thread_localã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚ˆã‚Šã‚‚æ­£ç¢ºã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæŠ˜ã‚ŠãŸãŸã¾ã‚Œã‚‹ç¬é–“ã‚’æ±ºå®šã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¨ãƒƒã‚¸ã«è¿‘ã¥ãã“ã¨ãŒã§ãã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®æ¨™ã‚’æ‰‹æ®µã§ä»£ç”¨ã™ã‚‹ã¨ã„ã†ç†è«–ä¸Šã®å•é¡Œã«æ‚©ã¾ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆã“ã®ç†è«–çš„ãªå•é¡Œã‹ã‚‰ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ä»¥å¤–ã®å…·ä½“çš„ãªã‚‚ã®ãŒç¾ã‚Œã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ï¼‰ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŸã ã—ã€æ¬ ç‚¹</font><font style="vertical-align: inherit;">ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®å¯¿å‘½ã‚’å»¶ã°ã—</font><font style="vertical-align: inherit;">ã¦</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚‚</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã‚¨ãƒƒã‚¸ã«</font><b><font style="vertical-align: inherit;">ã•ã‚‰ã«è¿‘ã¥ã</font></b><font style="vertical-align: inherit;">ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonWeakã®ä¾‹1</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shared_Example3_correct.cppã«ä¼¼ã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weak_Example1_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonWeak.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeakSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  WeakSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_weak(SingletonWeak&lt;Payload&gt;::instance())<font></font>
  {<font></font>
  }<font></font>
<font></font>
  ~WeakSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// Sometimes this check may result as "false" even in case of incorrect usage,</span>
    <span class="hljs-comment">// and there's no way to guarantee a demonstration of undefined behaviour in colour</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">auto</span> strong = m_weak.lock() )
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
        strong-&gt;add(i);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A weak copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::weak_ptr&lt;SingletonWeak&lt;Payload&gt;&gt; m_weak;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Create an empty unique_ptr</span>
<span class="hljs-comment">// 2. Create singleton (because of WeakSingleThreadedUtility c-tor)</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;WeakSingleThreadedUtility&gt; emptyUnique;
<span class="hljs-keyword">auto</span> utilityUnique = <span class="hljs-built_in">std</span>::make_unique&lt;WeakSingleThreadedUtility&gt;();<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// This guarantee destruction in order:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique.</span>
  <span class="hljs-comment">// This order is correct ...</span>
  <span class="hljs-comment">// ... but user swaps unique_ptrs</span><font></font>
  emptyUnique.swap(utilityUnique);<font></font>
<font></font>
  <span class="hljs-comment">// Guaranteed destruction order is the same:</span>
  <span class="hljs-comment">// - utilityUnique;</span>
  <span class="hljs-comment">// - singleton;</span>
  <span class="hljs-comment">// - emptyUnique,</span>
  <span class="hljs-comment">// but now utilityUnique is empty, and emptyUnique is filled,</span>
  <span class="hljs-comment">// so destruction order is incorrect...</span><font></font>
<font></font>
  <span class="hljs-comment">// ... but utility have made a weak copy of shared_ptr when it was available,</span>
  <span class="hljs-comment">// so it's correct again.</span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonWeak()<br>
~SingletonWeak()<br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonWeakã¨ã—ã¦SingletonSharedã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ç…©ã‚ã•ã‚Œã‚‹ã“ã¨ãŒãªã„ãŸã‚ã€ãªãœSingletonWeakãŒå¿…è¦ãªã®ã§ã™ã‹ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã„ã€èª°ã‚‚æ°—ã«ã—ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€SingletonWeakã‚’SingletonSharedã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æ°—ã«ã™ã‚‹äººã¯ã„ã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ãã‚Œã‚‰ã‚’æœ¬æ¥ã®ç›®çš„ã§ä½¿ç”¨ã™ã‚‹æ–¹ãŒã€ä»–ã®ç›®çš„ã§ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šã‚‚å°‘ã—ç°¡å˜ã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SingletonWeakã®ä¾‹2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shared_Example4_incorrectã¨ä¼¼ã¦ã„ã¾ã™ãŒã€ã“ã®å ´åˆã¯ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ã¿ãŒç™ºç”Ÿã—ã¾ã›ã‚“ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weak_Example2_correct.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonWeak.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CallbackPayload.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SomethingWithVeryImportantDestructor.h"</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeakSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  WeakSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_weak(SingletonWeak&lt;CallbackPayload&gt;::instance())<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"WeakSingleThreadedUtility()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  ~WeakSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"~WeakSingleThreadedUtility()"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCallback</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>()&gt; &amp;&amp;fn)</span>
  </span>{
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">auto</span> strong = m_weak.lock() )<font></font>
      strong-&gt;setCallback(<span class="hljs-built_in">std</span>::move(fn));<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A weak copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::weak_ptr&lt;SingletonWeak&lt;CallbackPayload&gt;&gt; m_weak;<font></font>
};<font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">auto</span> utility = <span class="hljs-built_in">std</span>::make_shared&lt;WeakSingleThreadedUtility&gt;();
  <span class="hljs-keyword">auto</span> something = <span class="hljs-built_in">std</span>::make_shared&lt;SomethingWithVeryImportantDestructor&gt;();<font></font>
<font></font>
  <span class="hljs-comment">// lambda with "utility" and "something" captured</span><font></font>
  utility-&gt;setCallback( [utility, something](){} );<font></font>
<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonWeak()<br>
WeakSingleThreadedUtility()<br>
SomethingWithVeryImportantDestructor()<br>
~SingletonWeak()<br>
~SomethingWithVeryImportantDestructor()<br>
~WeakSingleThreadedUtility()<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµè«–ã®ä»£ã‚ã‚Šã«</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã®ãã®ã‚ˆã†ãªå¤‰æ›´ã¯ã€ä¸ç¢ºå®šãªå‹•ä½œã‹ã‚‰ã‚ãªãŸã‚’æ•‘ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã¯å¹¸ã›ãªçµ‚ã‚ã‚Šã¯ãªã„ã¨ç´„æŸã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ¬¡ã®ä¾‹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å·§å¦™ãªå¦¨å®³è¡Œç‚ºãŒã€ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã§é©åˆ‡ãªè€ƒãˆæŠœã‹ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã•ãˆç ´å£Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼ˆãŸã ã—ã€</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯å¶ç„¶ã§ã¯ã»ã¨ã‚“ã©ä¸å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’</font><font style="vertical-align: inherit;">èªã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“</font><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shared_Example5_incorrect.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonShared.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  SharedSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_singleton(SingletonShared&lt;Payload&gt;::instance())<font></font>
  {<font></font>
  }<font></font>
<font></font>
  ~SharedSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// Sometimes this check may result as "false" even for destroyed singleton</span>
    <span class="hljs-comment">// preventing from visual effects of undefined behaviour ...</span>
    <span class="hljs-comment">//if ( m_singleton )</span>
    <span class="hljs-comment">//  for ( int i = 0; i &lt; 100; ++i )</span>
    <span class="hljs-comment">//    m_singleton-&gt;add(i);</span><font></font>
<font></font>
    <span class="hljs-comment">// ... so this code will allow to demonstrate UB in colour</span>
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
      m_singleton-&gt;add(i);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;SingletonShared&lt;Payload&gt;&gt; m_singleton;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cracker</span><span class="hljs-params">()</span>
</span>{<font></font>
  SharedSingleThreadedUtility();<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Register cracker() using std::atexit</span>
<span class="hljs-comment">// 2. Create singleton</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-keyword">auto</span> reg = [](){ <span class="hljs-built_in">std</span>::atexit(&amp;cracker); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }();
<span class="hljs-keyword">auto</span> utility = SharedSingleThreadedUtility();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utility;</span>
<span class="hljs-comment">// - singleton.</span>
<span class="hljs-comment">// This order is correct.</span>
<span class="hljs-comment">// Additionally, there's a copy of shared_ptr in the class instance...</span>
<span class="hljs-comment">// ... but there was std::atexit registered before singleton,</span>
<span class="hljs-comment">// so cracker() will be invoked after destruction of utility and singleton.</span>
<span class="hljs-comment">// There's second try to create a singleton - and it's incorrect.</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonShared()<br>
~SingletonShared()<br>
instance()<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weak_Example3_incorrect.cpp</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"SingletonWeak.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Payload.h"</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeakSingleThreadedUtility</span>
{</span>
<span class="hljs-keyword">public</span>:<font></font>
  WeakSingleThreadedUtility()<font></font>
      <span class="hljs-comment">// To ensure that singleton will be constucted before utility</span><font></font>
      : m_weak(SingletonWeak&lt;Payload&gt;::instance())<font></font>
  {<font></font>
  }<font></font>
<font></font>
  ~WeakSingleThreadedUtility()<font></font>
  {<font></font>
    <span class="hljs-comment">// Sometimes this check may result as "false" even in case of incorrect usage,</span>
    <span class="hljs-comment">// and there's no way to guarantee a demonstration of undefined behaviour in colour</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">auto</span> strong = m_weak.lock() )
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<font></font>
        strong-&gt;add(i);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword">private</span>:
  <span class="hljs-comment">// A weak copy of smart pointer, not a reference</span>
  <span class="hljs-built_in">std</span>::weak_ptr&lt;SingletonWeak&lt;Payload&gt;&gt; m_weak;<font></font>
};<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cracker</span><span class="hljs-params">()</span>
</span>{<font></font>
  WeakSingleThreadedUtility();<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// 1. Register cracker() using std::atexit</span>
<span class="hljs-comment">// 2. Create singleton</span>
<span class="hljs-comment">// 3. Create utility</span>
<span class="hljs-keyword">auto</span> reg = [](){ <span class="hljs-built_in">std</span>::atexit(&amp;cracker); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; }();
<span class="hljs-keyword">auto</span> utility = WeakSingleThreadedUtility();<font></font>
<font></font>
<span class="hljs-comment">// This guarantee destruction in order:</span>
<span class="hljs-comment">// - utility;</span>
<span class="hljs-comment">// - singleton.</span>
<span class="hljs-comment">// This order is correct.</span>
<span class="hljs-comment">// Additionally, there's a copy of shared_ptr in the class instance...</span>
<span class="hljs-comment">// ... but there was std::atexit registered before singleton,</span>
<span class="hljs-comment">// so cracker() will be invoked after destruction of utility and singleton.</span>
<span class="hljs-comment">// There's second try to create a singleton - and it's incorrect.</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</font></font></b><div class="spoiler_text">instance()<br>
SingletonWeak()<br>
~SingletonWeak()<br>
instance()<br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455834/index.html">Linuxã‚µãƒ¼ãƒãƒ¼ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼š5ã¤ã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒ„ãƒ¼ãƒ«</a></li>
<li><a href="../ja455840/index.html">è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã€‚çµ„æˆã€ãƒ¬ã‚¸ãƒ¥ãƒ¼ã‚µãƒ¼ã€FP</a></li>
<li><a href="../ja455842/index.html">å˜ä¸€ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆã‚’åºƒã’ã¾ã™ã€‚Swiftã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³</a></li>
<li><a href="../ja455844/index.html">ä¾‹ã¨ã—ã¦ã‚«ãƒ—ã‚»ãƒ«åŒ–ãƒ†ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ãŸRoslynã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®ä½œæˆ</a></li>
<li><a href="../ja455846/index.html">ã‚¸ãƒ¥ãƒªã‚¢ã§ã®åˆ†æ•£ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</a></li>
<li><a href="../ja455850/index.html">ç ”ç©¶è€…å‘ã‘ãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹-ç¬¬3ç‰ˆï¼šã‚½ãƒ¼ã‚¹ã®æ¤œç´¢ã¨æ“ä½œ</a></li>
<li><a href="../ja455852/index.html">å‰¯é¼»è…”æŒ™ä¸Šã¨åŒæ™‚ç€åºŠ</a></li>
<li><a href="../ja455854/index.html">iOS 13ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja455856/index.html">nRF52832ã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹æ¸©åº¦ã€æ¹¿åº¦ã€ãŠã‚ˆã³æ°—åœ§ã‚»ãƒ³ã‚µãƒ¼</a></li>
<li><a href="../ja455858/index.html">æœ€å°ã®ã‚±ãƒ¼ãƒ–ãƒ«ãƒ†ãƒ¬ãƒ“ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€‚ãƒ‘ãƒ¼ãƒˆ9ï¼šãƒ˜ãƒƒãƒ‰ã‚¨ãƒ³ãƒ‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>