<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👑 ☺️ 👩🏽‍🌾 Verwenden von RabbitMQ mit MonsterMQ Teil 2 ☝🏼 ◀️ 🗒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(Bild von der offiziellen RabbitMQ-Website )
 
 Im ersten Artikel haben wir zwei PHP-Programme geschrieben, die RabbitMQ verwenden: eine gesendete Nac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Verwenden von RabbitMQ mit MonsterMQ Teil 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489022/"><img src="https://habrastorage.org/getpro/habr/post_images/640/66e/579/64066e579d113ef3373c9a3c2c3e75ce.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Bild von der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offiziellen RabbitMQ-Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ersten Artikel haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir zwei PHP-Programme geschrieben, die RabbitMQ verwenden: eine gesendete Nachricht, die zweite empfangene. </font><font style="vertical-align: inherit;">In diesem Artikel wird erläutert, wie Sie eine Warteschlange erstellen, in der Aufgaben, die viel Zeit in Anspruch nehmen, auf viele Mitarbeiter (Nachrichtenhandler) verteilt werden.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptidee besteht nicht darin, Aufgaben, die viel Zeit in Anspruch nehmen, sofort zu erledigen, sondern sie in Form einer Nachricht zur Warteschlange hinzuzufügen. </font><font style="vertical-align: inherit;">Später erhält der Arbeiter eine Nachricht aus der Warteschlange, die er verbraucht und die Aufgabe wie im Hintergrund ausführt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Konzept ist sehr relevant für Webanwendungen, bei denen Sie beispielsweise einige zeitaufwändige Aufgaben ausführen müssen, deren Ergebnis nicht sofort erforderlich ist, z. B. das Senden von E-Mails oder das Senden einer HTTP-Anfrage an eine Drittanbieteranwendung (z. B. über libcurl to) PHP).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kochen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Teil senden wir Nachrichten, die Aufgaben für Mitarbeiter darstellen. Da wir keine wirklichen Aufgaben haben, wie das Verarbeiten von Bildern oder das Generieren von PDF-Dateien, tun wir so, als wären wir mit der Funktion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sleep () beschäftigt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wir werden die Anzahl der Punkte in der Nachricht als die Komplexität der Aufgabe betrachten. Jeder Punkt bedeutet eine Sekunde Arbeit, zum Beispiel </font><font style="vertical-align: inherit;">dauert </font><font style="vertical-align: inherit;">die Meldung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo ...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> drei Sekunden Arbeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden unser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript </font><font style="vertical-align: inherit;">aus der letzten Lektion </font><font style="vertical-align: inherit;">leicht </font><b><font style="vertical-align: inherit;">ändern</font></b><font style="vertical-align: inherit;"> , damit es beliebige Nachrichten senden kann.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $producer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
<font></font>
   $message = implode(<span class="hljs-string">' '</span>, array_slice($argv, <span class="hljs-number">1</span>));<font></font>
   $message = <span class="hljs-keyword">empty</span>($message) ? <span class="hljs-string">'Hello world!'</span> : $message;<font></font>
<font></font>
   $producer-&gt;publish($message, <span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Sent {$message} \n"</span>;<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser Skript " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php" muss</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ebenfalls geändert werden. </font><font style="vertical-align: inherit;">Es sollte den Betrieb für eine Sekunde für jeden Punkt in der empfangenen Nachricht simulieren. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benennen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir die Datei in </font><b><font style="vertical-align: inherit;">worker.php um</font></b><font style="vertical-align: inherit;"> und schreiben den folgenden Code hinein:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
<font></font>
   $consumer-&gt;consume(<span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $consumer-&gt;wait(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$message, $channelNumber</span>) <span class="hljs-title">use</span> (<span class="hljs-params">$consumer</span>)</span>{
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Received: {$message}"</span>;<font></font>
      sleep(substr_count($message, <span class="hljs-string">'.'</span>));
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Done"</span>;<font></font>
   });<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie als Nächstes beide Skripte in verschiedenen Terminals aus:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># Shell 1</span><font></font>
php worker.php <font></font>
</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-comment"># Shell 2</span>
php send.php <span class="hljs-string">"A very hard task which takes two seconds.."</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einer der Vorteile der Verwendung von Aufgabenwarteschlangen ist die Möglichkeit, die Arbeit auf viele Mitarbeiter zu verteilen. </font><font style="vertical-align: inherit;">Versuchen wir, zwei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker.php-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skripte </font><b><font style="vertical-align: inherit;">gleichzeitig</font></b><font style="vertical-align: inherit;"> in zwei verschiedenen Terminals </font><b><font style="vertical-align: inherit;">auszuführen</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Und im dritten werden wir Nachrichten mit dem Skript </font><b><font style="vertical-align: inherit;">send.php</font></b><font style="vertical-align: inherit;"> senden</font></font><b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># Shell 1</span><font></font>
php worker.php <font></font>
</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-comment"># Shell 2</span><font></font>
php worker.php <font></font>
</code></pre><br>
<pre><code class="php hljs"><span class="hljs-comment"># Shell 3</span><font></font>
php new_task.php First message.<font></font>
php new_task.php Second message..<font></font>
php new_task.php Third message...<font></font>
php new_task.php Fourth message....<font></font>
php new_task.php Fifth message.....<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes wollen wir sehen, was unsere Arbeiter herausgebracht haben:</font></font><br>
<pre><code class="php hljs"><span class="hljs-comment"># shell 1</span><font></font>
php worker.php<font></font>
<span class="hljs-comment"># Received: First message.</span>
<span class="hljs-comment"># Done</span>
<span class="hljs-comment"># Received: Third message...</span>
<span class="hljs-comment"># Done</span>
<span class="hljs-comment"># Received: Fifth message.....</span>
<span class="hljs-comment"># Done</span>
</code></pre><br>
<pre><code class="php hljs"><span class="hljs-comment"># shell 2</span><font></font>
php worker.php<font></font>
<span class="hljs-comment"># Received: Second message..</span>
<span class="hljs-comment"># Done</span>
<span class="hljs-comment"># Received: Fourth message....</span>
<span class="hljs-comment"># Done</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Standardmäßig sendet RabbitMQ jede nachfolgende Nachricht nacheinander an den nächsten verbrauchenden Empfänger. </font><font style="vertical-align: inherit;">Im Durchschnitt erhält jeder Empfänger die gleiche Anzahl von Nachrichten. Diese Methode zum Verteilen von Nachrichten wird als Round-Robin (in einem Kreis) bezeichnet. </font><font style="vertical-align: inherit;">Versuchen Sie dies mit drei oder mehr Arbeitern.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachrichtenbestätigung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgaben können eine gewisse Zeit in Anspruch nehmen. </font><font style="vertical-align: inherit;">Vielleicht interessiert Sie, was mit der Nachricht passieren wird, wenn Sie die Arbeit des Empfängers beenden, der es nicht geschafft hat, diese Nachricht bis zum Ende zu verarbeiten. </font><font style="vertical-align: inherit;">Mit unserem aktuellen Code wird die Nachricht an die Warteschlange zurückgegeben, da die Nachrichtenbestätigung in MonsterMQ standardmäßig aktiviert ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir die Nachrichtenbestätigung verwenden, teilen wir RabbitMQ mit, dass die Nachricht verarbeitet wurde und das Recht hat, sie aus der Warteschlange zu entfernen. Wenn der Empfänger seine Arbeit ohne Senden einer Bestätigung abgeschlossen hat (z. B. aufgrund einer unerwarteten Beendigung der TCP-Verbindung), erkennt RabbitMQ, dass die Nachricht nicht verarbeitet wurde, und gibt sie an die Warteschlange zurück und versucht, sie an andere verfügbare Mitarbeiter weiterzuleiten. So können Sie sicher sein, dass Nachrichten auch bei einem unerwarteten Herunterfahren eines der Mitarbeiter nicht verloren gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Nachrichtenbestätigung in MonsterMQ zu deaktivieren, können Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als zweites zu </font><b><font style="vertical-align: inherit;">konsumierendes</font></b><font style="vertical-align: inherit;"> Argument übergeben </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">()</font></font></b><br>
<br>
<pre><code class="php hljs">$consumer-&gt;consume(<span class="hljs-string">'test-queue'</span>, <span class="hljs-literal">true</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Vergessen der Bestätigung empfangener Nachrichten ist ein ziemlich häufiger, leicht tolerierbarer Fehler, der schwerwiegende Folgen haben kann. </font><font style="vertical-align: inherit;">In diesem Fall werden Nachrichten immer wieder zugestellt und sammeln sich auch in den Warteschlangen an, die immer mehr Speicherplatz beanspruchen. </font><font style="vertical-align: inherit;">Um diesen Fehler zu </font><font style="vertical-align: inherit;">debuggen, verwenden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rabbitmqctl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anzuzeigen das </font><b><font style="vertical-align: inherit;">messages_unacknowledged</font></b><font style="vertical-align: inherit;"> Feld</font></font><b><font style="vertical-align: inherit;"></font></b><br>
<br>
<pre><code class="bash hljs">sudo rabbitmqctl list_queues name messages_ready messages_unacknowledged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie unter Windows Sudo fallen</font></font><br>
<br>
<pre><code class="bash hljs">rabbitmqctl.bat list_queues name messages_ready messages_unacknowledged</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warteschlangensicherheit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotz der Tatsache, dass unsere Nachrichten nicht verloren gehen, wenn einer der Mitarbeiter seine Arbeit unerwartet beendet, können wir die erstellten Warteschlangen dennoch verlieren, wenn RabbitMQ heruntergefahren wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um sich vor dem Verlust von Warteschlangen zu schützen, müssen Sie die Warteschlange als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dauerhaft</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dauerhaft, dauerhaft) </font><font style="vertical-align: inherit;">deklarieren </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Da Warteschlangen idempotent sind, dh wir können sie nicht ändern oder neu erstellen, indem wir die Deklarationsmethode mit demselben Namen aufrufen, müssen wir eine neue Warteschlange deklarieren. </font><font style="vertical-align: inherit;">Machen wir es wie folgt</font></font><br>
<br>
<pre><code class="php hljs">$consumer-&gt;queue(<span class="hljs-string">'new-queue'</span>)-&gt;setDurable()-&gt;declare();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, den Warteschlangenansagecode auch im Absendercode zu ändern.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faire Verteilung von Nachrichten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie haben vielleicht bemerkt, dass die Nachrichten zwischen unseren beiden Mitarbeitern immer noch nicht ganz ehrlich verteilt sind. Wenn zum Beispiel jede gerade Nachricht zeitaufwändig ist und jede ungerade Nachricht schnell verarbeitet wird, ist ein Mitarbeiter, der zeitaufwändige Nachrichten empfängt, immer beschäftigt, während der zweite inaktiv ist. Um dies zu vermeiden, können Sie die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servicequalität</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nutzen </font><font style="vertical-align: inherit;">. Fügen wir unserem Code die folgende Zeile hinzu</font></font><br>
<br>
<pre><code class="php hljs">$consumer-&gt;qos()-&gt;prefetchCount(<span class="hljs-number">1</span>)-&gt;perConsumer()-&gt;apply();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Zeile weist RabbitMQ an, keine Nachrichten an den Empfänger zu senden, bis die aktuelle Nachricht verarbeitet und bestätigt wurde. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perConsumer ()</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wendet die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dienstqualität</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf alle Kanäle des Empfängers an. Verwenden Sie die Methode </font><b><font style="vertical-align: inherit;">perChannel ()</font></b><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">wenn Sie </font><font style="vertical-align: inherit;">die </font><b><font style="vertical-align: inherit;">Dienstqualität</font></b><font style="vertical-align: inherit;"> nur auf den aktuellen Kanal anwenden möchten. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/270/e31/4b5/270e314b59a085e186e46b28e2593613.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Bild von der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offiziellen RabbitMQ-Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Den gesamten Code zusammenfügen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies sieht aus wie unsere </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Absender)</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'new-queue'</span>)-&gt;setDurable()-&gt;declare();<font></font>
<font></font>
   $message = implode(<span class="hljs-string">' '</span>, array_slice($argv, <span class="hljs-number">1</span>));<font></font>
   $message = <span class="hljs-keyword">empty</span>($message) ? <span class="hljs-string">'Hello world!'</span> : $message;<font></font>
<font></font>
   $producer-&gt;publish($message, <span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Sent {$message} \n"</span>;<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und so der Empfänger </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker.php</font></font></b><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'new-queue'</span>)-&gt;setDurable()-&gt;declare();<font></font>
<font></font>
   $consumer-&gt;qos()-&gt;prefetchCount(<span class="hljs-number">1</span>)-&gt;perConsumer()-&gt;apply();<font></font>
<font></font>
   $consumer-&gt;consume(<span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $consumer-&gt;wait(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$message, $channelNumber</span>) <span class="hljs-title">use</span> (<span class="hljs-params">$consumer</span>)</span>{
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Received: {$message}"</span>;<font></font>
      sleep(substr_count($message, <span class="hljs-string">'.'</span>));
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"\n Done"</span>;<font></font>
   });<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der nächsten Lektion lernen wir, wie Sie Nachrichten aus derselben Warteschlange an viele Empfänger senden.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489010/index.html">Wir teilen die größte Datenschicht in Russland zum Online-Lernen mit Projekten in den Bereichen Linguistik, Personalisierung, Peddesign, ML</a></li>
<li><a href="../de489012/index.html">Google Cloud Spanner: gut, schlecht, böse</a></li>
<li><a href="../de489014/index.html">Das Buch „Perfekter Algorithmus. Gierige Algorithmen und dynamische Programmierung »</a></li>
<li><a href="../de489016/index.html">German Gref: „Wir haben versucht, eine Diskussion über die AGI zu organisieren, und kein einziger Wissenschaftler mit Selbstachtung ist dazu gekommen.“</a></li>
<li><a href="../de489020/index.html">Das Studium eines böswilligen</a></li>
<li><a href="../de489024/index.html">Webix JavaScript-Bibliothek mit den Augen eines Anfängers. Teil 5. Arbeiten Sie mit Daten auf der Benutzerseite</a></li>
<li><a href="../de489026/index.html">Das Ändern der Google AdSense-Algorithmen kann zu Website-Eigentümern und Webmastern führen</a></li>
<li><a href="../de489028/index.html">Über Fernarbeit</a></li>
<li><a href="../de489034/index.html">Die neue mobile UIS-App oder -Rettung für diejenigen, die ein öffentliches Beschaffungswesen suchen?</a></li>
<li><a href="../de489038/index.html">Das Buch "Java Concurrency in Practice"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>