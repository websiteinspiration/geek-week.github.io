<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚ÄçüöÄ üëàüèø ü§≤üèΩ Hackeie o Age of Empires III para alterar as configura√ß√µes de qualidade do shader üë• üëâüèΩ ‚¨áÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No in√≠cio de maio de 2020 - se voc√™ √© como eu, a quarentena o fez refazer jogos que n√£o s√£o lan√ßados h√° muitos anos. 
 
 E se voc√™ √© ainda mais pareci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hackeie o Age of Empires III para alterar as configura√ß√µes de qualidade do shader</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500542/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No in√≠cio de maio de 2020 - se voc√™ √© como eu, a quarentena o fez refazer jogos que n√£o s√£o lan√ßados h√° muitos anos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se voc√™ √© ainda mais parecido comigo, em algum lugar voc√™ pode ter um disco do Age of Empires 3. Talvez esteja jogando em um Mac, talvez ainda n√£o tenha atualizado para a Catalina e gostaria de comandar Morgan Black. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, voc√™ inicia o jogo, entra no menu principal e imediatamente percebe que algo est√° errado ... O menu parece </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nojento</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5be/dfa/a66/5bedfaa660037faa86c176d9586f9d1a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ est√° se perguntando o que exatamente √© "nojento", preste aten√ß√£o √† √°gua. </font><font style="vertical-align: inherit;">Todo o resto tamb√©m √© terr√≠vel, mas √© menos √≥bvio.</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/578/2d3/34f/5782d334f3be69385a0b69072ef6b7ed.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, voc√™ entra nas op√ß√µes, aumenta todos os par√¢metros ao m√°ximo ... Mas o jogo ainda √© feio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ percebe que as op√ß√µes </font><font style="vertical-align: inherit;">" </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualidade do sombreador</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">est√£o </font><font style="vertical-align: inherit;">suspeitamente bloqueadas em " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baixa</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentativa n¬∫ 1 - par√¢metros de invas√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse ponto, voc√™ come√ßa a procurar a pasta do jogo, que supostamente foi criada em algum lugar da pasta Documents, porque o jogo foi em 2005 e todos fizeram isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que voc√™ est√° procurando? Obviamente, o arquivo no qual os par√¢metros est√£o armazenados. A interface do menu n√£o nos permite alterar as configura√ß√µes, mas somos complicados, certo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontramos o XML necess√°rio, porque o jogo √© 2005 e, √© claro, XML, onde encontramos a op√ß√£o " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optiongrfxshaderquality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", que √© definida como 0. Parece que est√°vamos procurando, ent√£o aumentamos o valor para 100, porque n√£o h√° muita qualidade. Aqui eu concordo com voc√™.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/61d/de5/d85/61dde5d85e5442f781fe9c4eaeb46a55.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ tamb√©m pode perceber que esse √© um uso terr√≠vel do XML. Felizmente, ele n√£o tem bons usos.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Satisfeitos conosco, lan√ßamos o jogo. Infelizmente, nada mudou. Olhando novamente para o arquivo XML, vemos que o par√¢metro √© novamente definido como 0. O Ensemble Studios (que descanse em paz) parece com desprezo toda a sua engenhosidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poder√≠amos desistir</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este √© um Mac, portanto, √© improv√°vel que os patches escritos pelos usu√°rios sejam encontrados (na verdade, verifiquei - existem todos os tipos de solu√ß√µes duvidosas que podem funcionar). √â tudo sobre os gr√°ficos. Parece corrigir o problema ser√° dif√≠cil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas n√£o vamos desistir. </font><font style="vertical-align: inherit;">Porque lembramos como deve ser a idade 3. Lembramos como admiramos essa bela √°gua ondulada. </font><font style="vertical-align: inherit;">Esses efeitos de part√≠culas. </font><font style="vertical-align: inherit;">Esses navios enormes que simplesmente n√£o se encaixam no quadro. </font><font style="vertical-align: inherit;">E, √© s√≥ que a c√¢mera foi ampliada, o que eu estava pensando?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentativa n¬∫ 1 - hackear dados</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No in√≠cio da pasta em Documentos, h√° um arquivo de log. O jogo escreveu uma placa de v√≠deo l√° e informou que havia selecionado a configura√ß√£o "gen√©rico dx7". Ele diz que voc√™ instalou o Intel GMA 950, que realmente estava no computador anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas com isso voc√™ tem o Intel Iris Graphics 6100. Algo est√° realmente errado. Voc√™ assume que o jogo determina os recursos gr√°ficos do computador, comparando-o com um banco de dados de placas gr√°ficas, em vez de verificar os recursos da pr√≥pria placa. Porque √© exatamente isso que os desenvolvedores AAA fazem e, se voc√™ trabalhou no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTS de c√≥digo aberto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sabe como isso acontece.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b6e/8b3/fb2/b6e8b3fb28030917e8300cdce5653fac.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O conte√∫do do arquivo de log. Se voc√™ acha engra√ßado que a Intel seja designada como 0x8086, voc√™ escolheu o artigo apropriado.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por acaso, voc√™ encontra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notas de atualiza√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> antigas </font><font style="vertical-align: inherit;">que confirmam suas preocupa√ß√µes. Voc√™ olha para a pasta GameData, mas h√° apenas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bar</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.xmb arquivos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que s√£o principalmente ileg√≠vel. </font><em><font style="vertical-align: inherit;">Voc√™ est√° procurando</font></em><font style="vertical-align: inherit;"> grep " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dx7</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Nada acontece. Exclua v√°rios arquivos ... Nada acontece. Mas voc√™ sabe que os jogos AAA podem armazenar alguns recursos em lugares estranhos, e essa √© a porta dos jogos do Windows no Mac; portanto, tudo pode ser muito bizarro aqui.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, voc√™ encontra o arquivo ‚Äúrender.bar‚Äù; se voc√™ o mover, o jogo trava quando √© iniciado. N√£o √© muito claro, mas n√£o √© ruim. Abrimos o arquivo no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Fiend</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , porque esse programa geralmente permite que voc√™ aprenda algo sobre arquivos bin√°rios. E assim acontece. Parte desses dados √© um texto leg√≠vel. Alguns deles s√£o shaders. Mas a maioria dos dados √© estranhamente dividida por espa√ßo vazio ...</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/3a2/6f5/9d13a26f5dfff14c2b44f59dbc69b673.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface Hex Fiend √â minimalista, mas funciona. Os primeiros bytes s√£o as letras "ESPN", que provavelmente s√£o o cabe√ßalho .bar.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voc√™ exclama: "Obviamente, isso √© UTF-16!" O jogo foi criado para Windows, por isso √© l√≥gico que armazene texto em UTF-16, desperdi√ßando quase metade de um arquivo de dados de 30 megabytes. Afinal, o Windows adorava o UTF-16 (embora </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o devesse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ent√£o por que n√£o usar essa codifica√ß√£o e shaders ASCII em um arquivo. √â uma ideia l√≥gica! </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Na verdade, demorei um dia para descobrir isso) O</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hex Fiend tem a op√ß√£o de analisar bytes como UTF-16, ent√£o, novamente, estamos procurando a string grep dx7. Existem v√°rias entradas. N√≥s os substitu√≠mos pela linha dx9, que tamb√©m √© encontrada nos dados, salve o arquivo e inicie o jogo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim Os logs novamente n√£o exibem "dx9". Isso provavelmente est√° definido em outro lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar outra coisa. Suponha que o jogo reconhe√ßa placas gr√°ficas e seus identificadores hexadecimais sejam armazenados nos logs (no meu caso, 0x8086 √© Intel e tamb√©m 0x2773). Estamos procurando por ‚Äú8086‚Äù no Hex Fiend, encontramos algo e parte do texto parece promissora. A Intel 9 Series √© a s√©rie GMA 950 e a Age 3 provavelmente n√£o funcionou muito bem nela.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af6/b22/f44/af6b22f4473691b673cb5dba2fd197f0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns n√∫meros s√£o como identificadores de cart√£o (2582, 2592); talvez se voc√™ substitu√≠-los, algo mudar√°. De qualquer forma, fizemos uma c√≥pia do arquivo, para que voc√™ possa tentar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, este tamb√©m √© um beco sem sa√≠da. De fato, estamos estudando o arquivo errado. Felizmente, posso lhe dizer isso porque gastei muito tempo nisso e tentei </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demais</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Essa coisa demorou cerca de 20 horas. E isso n√£o est√° contando o tempo para todas as capturas de tela ... O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
arquivo desejado √© chamado "DataP.bar" e, se substituirmos sabiamente o ID, veremos algo completamente novo nos logs:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/445/e79/6a2/445e796a2ca507e1f1a056da1cbd30a3.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o entendo por que esse "dx7 gen√©rico" n√£o √© o mesmo da captura de tela acima. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, no jogo ainda estamos limitados pelas configura√ß√µes "Baixa", ou seja, os logs n√£o mentem. </font><font style="vertical-align: inherit;">Est√°vamos esperando um m√©dium, mas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">infelizmente</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que mais dados de hackers n√£o podem ser alcan√ßados. </font><font style="vertical-align: inherit;">√â hora de levar as ferramentas a s√©rio.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentativa n¬∫ 2 - hackers</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se nada der certo, resta uma √∫ltima coisa: alterar o pr√≥prio arquivo execut√°vel (isto √©, como eles disseram em 2005, "quebr√°-lo"). </font><font style="vertical-align: inherit;">Parece que hoje √© simplesmente chamado de hacking, mas esse termo foi preservado no campo da pirataria de jogos (√© claro, eu pessoalmente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nunca</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fiz isso). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passamos para a parte mais interessante do artigo (sim, voc√™ j√° leu mil palavras, mas n√£o foi curioso?).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funil do desmontador</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, nossa ferramenta ser√° um desmontador: um aplicativo que recebe o c√≥digo bin√°rio do arquivo execut√°vel e o transforma em c√≥digo assembler leg√≠vel (ha ha). O mais popular deles √© o IDA Pro, mas √© incrivelmente caro e n√£o tenho certeza se ele funciona em um Mac; portanto, usarei o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hopper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o √© gratuito (custa US $ 90), mas pode ser usado livremente por 30 minutos por vez, com quase todas as fun√ß√µes necess√°rias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o explicarei a interface em detalhes, porque </font><font style="vertical-align: inherit;">tudo est√° bem </font><font style="vertical-align: inherit;">explicado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tutorial Hopper</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas vou lhe dizer o que farei e tentarei tirar capturas de tela suficientes para que voc√™ possa aprender alguma coisa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, voc√™ precisa dizer: demorei cinco dias para resolver e muitas tentativas malsucedidas foram feitas. Basicamente, falarei sobre etapas bem-sucedidas, para que pare√ßa m√°gico. Mas foi </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dif√≠cil</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o se preocupe se tiver algum problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mais uma observa√ß√£o: "cracking" geralmente √© ilegal e / ou executado para fins ilegais. Eu demonstro um exemplo bastante raro de uso bastante leg√≠timo, que ao mesmo tempo √© completamente "chap√©u branco", ent√£o tudo est√° em ordem aqui. Assumirei que, estritamente falando, isso √© ilegal / contr√°rio ao contrato do usu√°rio final, mas, obviamente, √© um caso de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for√ßa maior</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Seja como for, pague pelo que quiser e s√≥ por isso, porque o anti-consumismo √© legal.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a04/597/b6a/a04597b6a9ad1979e14216547ecf61d6.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db3/dfb/1e3/db3dfb1e3ec50890530001d69a22cdd2.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/605/66d/e69/60566de69653b745f83d196f56679263.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arraste o aplicativo Age 3 para abri-lo. </font><font style="vertical-align: inherit;">Basta selecionar "x86" em vez de powerPC, porque o jogo √© algo em 2005.</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 1 - procure o fragmento desejado</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Surpreendentemente, isso pode ser o mais dif√≠cil. </font><font style="vertical-align: inherit;">Temos um c√≥digo desmontado, mas n√£o temos id√©ia de onde procurar. </font><font style="vertical-align: inherit;">Sim, alguns jogos possuem s√≠mbolos de depura√ß√£o, para que voc√™ possa ler os nomes das fun√ß√µes, mas n√£o no nosso caso. </font><font style="vertical-align: inherit;">Hopper nos d√° nomes como "sub_a8cbb6", com os quais temos que lidar sozinhos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, temos uma vantagem: nosso </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo de log</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√â altamente prov√°vel que </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">literais de seq√º√™ncia de caracteres</font></a><font style="vertical-align: inherit;"> sejam usados ‚Äã‚Äãao gravar no log</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, ASCII s√£o exibidos no arquivo execut√°vel. </font><font style="vertical-align: inherit;">Podemos procur√°-los com grep, porque n√£o vamos nos livrar deles por nenhuma compila√ß√£o (no entanto, eles podem ser ocultados pela ofusca√ß√£o do c√≥digo. Felizmente, isso n√£o aconteceu). </font><font style="vertical-align: inherit;">Encontrar literais de string grep √© geralmente a primeira coisa que eles fazem quando desmontam um programa. </font><font style="vertical-align: inherit;">Ent√£o, vamos inserir "fornecedor encontrado" na caixa de pesquisa do funil e ele encontrar√° algo:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da7/114/b61/da7114b61ecba23df73633ad41ab338f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ah, sim, literais de string, eu os adoro. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso por si s√≥ n√£o nos adiantou tanto. </font><font style="vertical-align: inherit;">Por√©m, como o endere√ßo dessa "sequ√™ncia de literais" √© codificado, podemos encontrar links para ele. </font><font style="vertical-align: inherit;">Hopper os destacou em verde √† direita: "DADOS XREF = sub_1d5908 + 1252". </font><font style="vertical-align: inherit;">Clicando duas vezes na linha, passaremos ao procedimento hero - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sub_1d5908</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6d/d6a/e8b/d6dd6ae8bbe346215273e7beb930b0a7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui encontramos o c√≥digo do assembler. </font><font style="vertical-align: inherit;">Acredita-se que seja dif√≠cil de ler, mas n√£o √©. </font><font style="vertical-align: inherit;">O mais dif√≠cil √© entender. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padr√£o, o Hopper usa "Intel sintaxe", ou seja, o primeiro operando √© o receptor e o segundo √© a fonte. </font><font style="vertical-align: inherit;">Na linha destacada, vemos </font></font><code>mov dword [esp+0x1DC8+var_1DC4], aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vamos fazer isso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nossa primeira linha em montador</font></font></h2><br>
<code>mov</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â uma equipe MOV conhecida por estar em x86 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turing-complete</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ele move (na verdade copia) os dados de A para B, o que significa essencialmente ler A e grav√°-los em B. Com base no exposto, </font></font><code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esse √© A e </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B, o destinat√°rio. Vamos dar uma olhada mais de perto nisso. </font></font><br>
<br>
<code>aXmlRenderConfi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- esse √© o valor que Hopper nos ajuda. Na verdade, esse √© um apelido para o endere√ßo de mem√≥ria da string literal em que clicamos alguns segundos atr√°s. Se voc√™ dividir a janela e olhar o c√≥digo no modo Hex (que √© o </font><font style="vertical-align: inherit;">modo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preferido</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para hackers), veremos l√° </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d3/d74/31d/0d3d7431d27f6a03c2af6142f27c9a9b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O funil destaca convenientemente os mesmos fragmentos selecionados nas duas janelas.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Se o valor "flip" estiver correto, obteremos 0x00831888 - o endere√ßo de mem√≥ria da string literal (em uma das capturas de tela mostradas acima, ela fica destacada em amarelo). Portanto, um enigma √© resolvido: o c√≥digo executa MOV, ou seja, grava o endere√ßo 0x00831888. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que est√° escrito como </font></font><code>88 18 83 00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o como </font></font><code>00 83 18 88</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Isso aconteceu por causa da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ordem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">bytes</font></a><font style="vertical-align: inherit;"> - um t√≥pico bastante confuso que geralmente tem pouco impacto. Essa √© uma daquelas coisas que fazem as pessoas dizerem que ‚Äúos computadores n√£o funcionam‚Äù. Para n√≥s, isso significa que esse problema ocorrer√° em todos os n√∫meros com os quais trabalharemos hoje.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ deve ter notado que eu disse "anote o endere√ßo" e isso √© verdade: n√£o nos importamos com o conte√∫do, que acabou sendo uma string literal com um byte zero no final. Anotamos o endere√ßo porque o c√≥digo se referir√° posteriormente a esse endere√ßo. Este √© um ponteiro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que tal </font></font><code>dword [esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Tudo √© mais complicado aqui. </font></font><code>dword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa que estamos trabalhando com "palavras duplas (palavras duplas)", ou seja, com 16 * 2 bits. Ou seja, copiamos 32 bits. Lembre-se: nosso endere√ßo √©</font></font><code>0x00831888</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ou seja, 8 caracteres hexadecimais e cada caractere hexadecimal pode ter 16 valores, ou seja, 4 bits de dados. Portanto, obtemos 8 * 4 = 32. A prop√≥sito, a nota√ß√£o "32 bits" para sistemas de computadores veio daqui. Se us√°ssemos 64 bits, o endere√ßo de mem√≥ria seria escrito como 0x001122334455667788, seria duas vezes maior e 2 ^ 32 vezes maior, e ter√≠amos que copiar 16 bytes. Portanto, ter√≠amos muito mais mem√≥ria, mas copiar o ponteiro exigiria o dobro de trabalho e, portanto, 64 bits n√£o s√£o duas vezes mais r√°pidos que 32 bits. A prop√≥sito, uma explica√ß√£o mais detalhada do termo "palavra" pode ser encontrada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Porque √© claro que √© mais complicado do que minha explica√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, e a parte entre colchetes? Os colchetes significam que calculamos o que est√° dentro e o consideramos um ponteiro. Portanto, o comando MOV gravar√° no endere√ßo de mem√≥ria obtido dos c√°lculos. Vamos analisar novamente com mais detalhes (e n√£o se preocupe, quando terminar, voc√™ saber√° essencialmente como ler o c√≥digo do assembler com a sintaxe da Intel). </font></font><br>
<br>
<code>esp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© um </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que no assembler √© o equivalente mais pr√≥ximo de uma vari√°vel. Existem muitos registros na arquitetura x86, e diferentes registros t√™m diferentes formas de aplica√ß√£o, mas n√£o nos importamos. Saiba mais sobre isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Lembre-se de que existem registros especiais para n√∫meros de ponto flutuante, bem como "sinalizadores" que s√£o usados ‚Äã‚Äãpara compara√ß√µes e opera√ß√µes similares. Tudo o resto s√£o apenas n√∫meros hexadecimais que Hopper retrabalhou um pouco para nos ajudar. </font></font><code>var_1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>-0x1DC4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">podemos v√™-lo no in√≠cio do procedimento ou no painel direito. Isso significa que o resultado do c√°lculo </font></font><code>[esp+0x1DC8+var_1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° </font></font><code>[esp + 0x1DC8 ‚Äî 0x1DC4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">igual a </font></font><code>[esp + 4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em ess√™ncia, isso significa "pegar o valor de 32 bits do registro ESP, adicionar 4 e interpretar o resultado como um endere√ßo de mem√≥ria". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, repetimos: escrevemos o endere√ßo da string literal em "esp + 4". Esta √© uma informa√ß√£o correta, mas √© completamente in√∫til. O que isto significa?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© a dificuldade em ler o c√≥digo do assembly: ao analisar o que ele deve fazer. </font><font style="vertical-align: inherit;">Aqui temos uma vantagem: sabemos que ele provavelmente escreve algo no log. </font><font style="vertical-align: inherit;">Portanto, podemos esperar uma chamada para uma fun√ß√£o que grava no log. </font><font style="vertical-align: inherit;">Vamos procur√°-la.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c57/7f8/827/c577f8827feb59247a7c69ed0467fef2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na captura de tela acima, existem v√°rias chamadas semelhantes, bem como o comando </font></font><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que chama o procedimento. </font><font style="vertical-align: inherit;">Hopper geralmente fala sobre isso (n√£o sei por que ele n√£o fez isso aqui), mas, em ess√™ncia, damos argumentos para chamar a fun√ß√£o. </font><font style="vertical-align: inherit;">Se voc√™ clicar em diferentes chamadas de sub-rotina, encontraremos algo chamado imp___jump_table___Z22StringVPrintfExWorkerAPcmmPS_PmmPKcS_. </font><font style="vertical-align: inherit;">Este √© o </font><font style="vertical-align: inherit;">nome </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decodificado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da fun√ß√£o, e a parte ‚ÄúPrintf‚Äù √© suficiente para entender que ela realmente gera alguma coisa. </font><font style="vertical-align: inherit;">N√≥s n√£o nos importamos como ela faz isso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√™ um passo para tr√°s</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta fase, nos afastamos completamente do que fizemos: tentamos convencer o jogo de que nossa placa de v√≠deo de 2015 era poderosa o suficiente para lan√ßar o jogo de 2005. Vamos resumir. Encontramos o local em que o log est√° sendo gravado. Se tivermos sorte, aqui est√° o c√≥digo que verifica os par√¢metros e os recursos das placas gr√°ficas. Felizmente, tivemos muita sorte (existe uma alta probabilidade de que, de outro modo, este artigo n√£o teria sido). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender melhor, usaremos a fun√ß√£o Gr√°fico de fluxo do controle de tremonha, que divide o c√≥digo em pequenos blocos e desenha setas indicando diferentes transi√ß√µes. Isso √© muito mais f√°cil de entender do que no assembler comum, no qual muitas vezes tudo est√° uma bagun√ßa.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3a/4bd/1b1/e3a4bd1b1528d0344f4f1174b16be79c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A chamada para a entrada do log est√° no meio de uma fun√ß√£o terrivelmente longa, porque isso, novamente, geralmente acontece em jogos AAA. </font><font style="vertical-align: inherit;">Aqui, devemos procurar outros literais e "dicas" da string Hopper, na esperan√ßa de encontrar algo. </font><font style="vertical-align: inherit;">No in√≠cio do procedimento, est√° o restante do registro, e abaixo h√° partes interessantes sobre os par√¢metros "for√ßando dx7" e "Muito alto", al√©m de um problema com a vers√£o dos pixel shaders ... </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que temos.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O log de nossos dados "invadidos" relatou que t√≠nhamos pixel shaders da vers√£o 0.0 e eles s√£o incompat√≠veis com os par√¢metros "Alto". </font><font style="vertical-align: inherit;">Este c√≥digo est√° localizado no canto inferior esquerdo da nossa fun√ß√£o e, se voc√™ olhar com aten√ß√£o, poder√° ver algo curioso (destacado por seu humilde servo): este √© o mesmo c√≥digo repetido quatro vezes para os par√¢metros "Muito Alto", "Alto", "M√©dio" e "Baixo". </font><font style="vertical-align: inherit;">E sim, levei v√°rias horas para encontrar isso.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/27b/132/603/27b13260328e5da3cbef4323e840563f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu destaquei em azul o bloco em que ‚Äúpixel shader version 0.0 High‚Äù √© exibido no log. Eu destaquei pe√ßas semelhantes com outras cores bonitas.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As √∫nicas diferen√ßas s√£o que escrevemos "0x0", "0x1", "0x2" e "0x3" em lugares diferentes. √â suspeito de ser semelhante ao arquivo de par√¢metros que examinamos acima e ao par√¢metro </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optiongrfxshaderquality</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (talvez voc√™ ainda n√£o tenha entendido isso. Mas √©, acredite). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta fase, podemos tentar seguir de maneiras diferentes, o que eu fiz. Mas serei breve - faremos o mais necess√°rio: descubra por que a verifica√ß√£o do pixel shader falha. Vamos procurar um ramo. O bloco de sa√≠da para o log √© linear, o que significa que deve estar em algum lugar acima.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/724/d53/3a7/724d533a7f9af2353f611c6bea4f15b7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEMVER f√£s, veja um formato de vers√£o mais avan√ßada: n√∫meros de ponto flutuante.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E, de fato, logo acima dele h√° </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um comando de transi√ß√£o (pense em "ir"). Este √© um " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salto condicional</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " e a condi√ß√£o √© " </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se for menor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Os ‚Äúifs‚Äù do assembler funcionam atrav√©s de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinalizadores de registro</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sobre os quais falei brevemente acima. Basta saber que precisamos examinar o comando acima: provavelmente, ele define o sinalizador. Muitas vezes, este √© um comando </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas usado aqui </font></font><code>ucomiss</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso √© barb√°rie. Mas ela </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pesquise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> facilmente: sem </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">gra√ßa</font></a><font style="vertical-align: inherit;"> . Este √© um comando de compara√ß√£o de ponto flutuante e explica por que o c√≥digo foi</font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Este √© um registro de n√∫meros de ponto flutuante. Isso √© l√≥gico: os logs relatam que nossa vers√£o dos pixel shaders √© "0.0", que √© um valor de ponto flutuante. Ent√£o, o que est√° localizado no endere√ßo de mem√≥ria 0x89034c? Os dados hexadecimais t√™m uma apar√™ncia </font></font><code>00 00 00 40</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e podem ser confusos. Mas sabemos que devemos esperar n√∫meros de ponto flutuante, ent√£o vamos interpretar os dados assim: isso significa </font></font><code>2.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Qual √© um valor l√≥gico de ponto flutuante para a vers√£o dos pixel shaders que a Microsoft realmente usou na sua </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linguagem de sombreamento de alto n√≠vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em que os shaders do DirectX s√£o gravados. </font><font style="vertical-align: inherit;">E o Age 3 √© um jogo DirectX, mesmo que a porta do Mac use o OpenGL. </font><font style="vertical-align: inherit;">Tamb√©m √© l√≥gico que, em 2005, os pixel shaders da vers√£o 2.0 sejam necess√°rios para ativar o par√¢metro High, portanto, estamos nos movendo na dire√ß√£o certa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como n√≥s consertamos isso? </font><font style="vertical-align: inherit;">Esta instru√ß√£o compara√ß√£o realiza uma compara√ß√£o com o valor ao </font></font><code>xmm0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qual √© dado na linha acima: </font></font><code>movss xmm0, dword [eax+0xA2A8]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">O MOVSS √© um comando especial "move" para registradores de ponto flutuante e escrevemos 32 bits a partir do endere√ßo, que √© o resultado da avalia√ß√£o de eax + 0xA2A8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presumivelmente, esse valor n√£o √© 2,0, mas sim 0,0. </font><font style="vertical-align: inherit;">Vamos consertar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazendo hackers reais</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, estamos prontos para chegar aos par√¢metros do jogo High. Queremos seguir o caminho "vermelho" e pular toda a l√≥gica com a "vers√£o errada dos pixel shaders". Isso pode ser feito passando com √™xito na compara√ß√£o, ou seja, revertendo a condi√ß√£o de transi√ß√£o, mas temos mais um truque: o c√≥digo √© composto de tal maneira que, ao excluir a transi√ß√£o, seguiremos o caminho "vermelho". Vamos substituir a transi√ß√£o por </font></font><code>nop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma opera√ß√£o que n√£o faz nada (√© imposs√≠vel simplesmente excluir ou adicionar dados ao arquivo execut√°vel porque ocorrer√° um deslocamento e tudo quebrar√°). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu recomendo sair do CFG para isso, porque, caso contr√°rio, Hopper come√ßa a enlouquecer. Se tudo for feito corretamente, na janela Hex, veremos linhas vermelhas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/903/09d/db2/90309ddb2fecf42031e8bf9d4a6abe88.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/010/d39/b35/010d39b355b0cb7e5b55fc83007e17ae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vermelho mostra as altera√ß√µes que fizemos. </font><font style="vertical-align: inherit;">Nesse ponto, se voc√™ pagou pelo Hopper, pode simplesmente salvar o arquivo. </font><font style="vertical-align: inherit;">Mas como n√£o paguei, vou abrir o arquivo execut√°vel no Hex Fiend, encontrar a √°rea desejada (copiando a √°rea do Hopper para a guia Localizar dentro do Hex Fiend) e alter√°-lo manualmente. </font><font style="vertical-align: inherit;">Tenha cuidado aqui, voc√™ pode quebrar tudo, por isso recomendo copiar o arquivo execut√°vel de origem em algum lugar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Feito isso, inicie o jogo, v√° para as op√ß√µes ... E um brinde - podemos selecionar "Alto". </font><font style="vertical-align: inherit;">Mas n√£o podemos escolher "m√©dio". </font><font style="vertical-align: inherit;">E n√£o podemos usar os altos par√¢metros das sombras. </font><font style="vertical-align: inherit;">No entanto, estamos progredindo!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3df/3a2/bba/3df3a2bbaa02e57ce2997e53137bdb56.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basta dar uma olhada nessas reflex√µes magn√≠ficas na √°gua!</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprimoramentos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, voc√™ pode corrigir isso da melhor maneira. Nossa solu√ß√£o funcionou, mas podemos faz√™-lo para que a condi√ß√£o seja atendida corretamente: fazendo o jogo pensar que nossa placa de v√≠deo realmente possui shaders da vers√£o 2.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como lembramos, o jogo carrega o valor no endere√ßo </font></font><code>eax+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Voc√™ pode usar o Hopper para descobrir o que foi originalmente gravado l√°. Precisamos encontrar um comando no qual 0xA2A8 seja usado como operando destinat√°rio (escolhi 0xA2A8 porque √© um valor bastante espec√≠fico e n√£o podemos ter certeza de que o mesmo registro n√£o seja usado em outro lugar). Aqui, a luz de fundo da tremonha √© muito √∫til para n√≥s, porque podemos clicar em 0xA2A8 e procurar as pe√ßas amarelas no CFG.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/5ed/75b/bbd5ed75b7b712a39861769efc3f63cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa vit√≥ria √© um pouco maior: como esperado, escrevemos o valor de algum tipo de registro de ponto flutuante. Admito que realmente n√£o entendo o que est√° acontecendo antes disso (meu melhor palpite: o jogo verifica a possibilidade de compress√£o de textura), mas isso n√£o √© particularmente importante. Vamos escrever "2.0" e continuar o trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer isso, usaremos a "Instru√ß√µes de montagem" do aplicativo Hopper e, em seguida, faremos as mesmas manipula√ß√µes no Hex Fiend.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92d/3d1/637/92d3d1637e2c46321c9983f68ffda742.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/784/a8f/f5b/784a8ff5bb2755f378143d4740d4201f.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b6/fed/ff0/9b6fedff0d7cbbeb9713c34513776468.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usamos MOV em vez de MOVSS porque escrevemos o valor usual, e n√£o o valor especial do registro de ponto flutuante. Al√©m disso, est√° em ordem de bytes direta, ou seja, invertida.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voc√™ notar√° que algo estranho est√° acontecendo: n√≥s "comemos" a equipe </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso aconteceu porque o novo comando usa mais bytes que o anterior e, como eu disse, n√£o podemos adicionar ou remover dados do arquivo execut√°vel para salvar compensa√ß√µes. Portanto, Hopper n√£o tem escolha a n√£o ser destruir o time </font></font><code>jb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Isso pode se tornar um problema, e podemos elimin√°-lo movendo o comando para cima (afinal, n√£o precisamos mais escrever o valor xmm3). Isso funcionar√° aqui, porque, de qualquer forma, estamos fazendo a ramifica√ß√£o no caminho certo. Por sorte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ iniciar o jogo ... nada mudar√° muito. </font><font style="vertical-align: inherit;">Sugeri que a s√©rie Intel 9 n√£o √© r√°pida o suficiente, ent√£o o jogo reclama. </font><font style="vertical-align: inherit;">Isso n√£o √© um problema, porque, na realidade, estamos lutando por "Muito Alto". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual foi o cart√£o mais poderoso em 2004? </font><font style="vertical-align: inherit;">NVIDIA GeforceFX 6800. Vamos nos convencer a convencer o jogo de que ele est√° instalado.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No buraco do coelho</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, esta √© uma se√ß√£o completamente nova. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabemos que o jogo usa c√≥digos Hex para se referir a placas gr√°ficas e que recebe informa√ß√µes de arquivos de dados. Sabemos que isso deve acontecer na fun√ß√£o que estamos estudando (pelo menos seria estranho se n√£o estivesse). Para que possamos encontrar o c√≥digo que faz isso. Mas ainda pode ser dif√≠cil, porque n√£o sabemos exatamente o que procurar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos uma pista: as op√ß√µes se comportam de maneira estranha; h√° Baixa / Alta, mas n√£o M√©dia. Ent√£o, talvez exista outro c√≥digo que lide com todos esses "Muito Alto", "Alto", "M√©dio" e "Baixo". E ele realmente est√°, na mesma fun√ß√£o. Ele est√° muito mais cedo na CFG e parece interessante.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e73/73a/ea1/e7373aea138358b603c609d8704cfed0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos supor que os dados brutos sejam armazenados em algum tipo de XML, porque √© muito prov√°vel, porque existem v√°rios outros arquivos de dados que s√£o XML. E XML √© essencialmente um monte de ponteiros e atributos. Portanto, o c√≥digo aqui provavelmente verifica alguns atributos XML (e, de fato, abaixo √© "esperado um dos ID, Muito Alto ...", o que √© muito semelhante √† verifica√ß√£o da corre√ß√£o do arquivo). Podemos imaginar uma estrutura XML semelhante na qual os valores booleanos determinam a qualidade dos shaders:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e8/bf7/411/4e8bf7411dd677f1415ae71c887cbef5.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vale a pena considerar que esse √© um palpite muito arbitr√°rio. </font><font style="vertical-align: inherit;">Tudo pode parecer um pouco diferente. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma parte muito interessante √© mostrada no lado esquerdo do CFG (para voc√™, pode estar √† direita, mas √† esquerda na captura de tela): vemos a mesma </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que √© usada no c√≥digo que grava o ID do dispositivo no log. </font><font style="vertical-align: inherit;">Ou seja </font></font><code>ebp+var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, provavelmente se refere ao ID do nosso dispositivo, 0x2773. </font><font style="vertical-align: inherit;">O estranho √© que n√£o h√° literal de cadeia de caracteres na primeira "verifica√ß√£o", mas isso √© um bug do Hopper: o endere√ßo 0x0089da8e cont√©m dados hexadecimais 69006400, que em UTF-16 significa "id" (na verdade, provavelmente Hopper n√£o conseguiu entender isso porque UTF16). </font><font style="vertical-align: inherit;">E estamos </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> procurando por um ID. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ sabe o que? </font><font style="vertical-align: inherit;">Vamos executar o depurador e verificar tudo na realidade.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depura√ß√£o de jogos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra uma janela do terminal e execute lldb (apenas digite lldb e pressione enter). Primeiro, precisamos dizer ao LLDB para seguir a idade 3 e, em seguida, podemos iniciar o jogo ligando </font></font><code>run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O jogo come√ßa e n√£o temos nada √∫til.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47b/0f2/279/47b0f227957a0414bc739002abafb432.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora precisamos adicionar um ponto de interrup√ß√£o: para confirmar nossas suposi√ß√µes, queremos interromper a execu√ß√£o quando chegarmos ao c√≥digo mostrado acima. N√£o temos c√≥digo-fonte, mas isso n√£o importa: podemos definir um ponto de interrup√ß√£o no endere√ßo de mem√≥ria. E n√≥s temos o endere√ßo no c√≥digo. Vamos adicionar uma parada a uma chamada MOV que recebe um "id", seu endere√ßo √© 0x001d5e68. Para adicionar um ponto de interrup√ß√£o, basta digitar </font></font><code>br set -a 001D5E68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Depois de iniciar o jogo, ele para e o LLDB mostra o c√≥digo desmontado (na sintaxe da AT&amp;T, n√£o na Intel, portanto todos os operandos s√£o invertidos, mas vemos que esse √© o mesmo c√≥digo). Voc√™ pode perceber que o LLDB nesse caso √© realmente mais inteligente que Hopper; ele nos diz que estamos executando opera√ß√µes relacionadas √† sa√≠da XML e printf.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd0/2fa/07c/cd02fa07c9a2dbd13ed07558f0983595.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95d/fa6/710/95dfa671088f1c7097b439851f586b24.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinta-se como um hacker? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para seguir em frente, vamos dar uma "instru√ß√£o de passo". </font><font style="vertical-align: inherit;">Um pequeno comando para isso </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 √© </font></font><code>ni</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Repetindo v√°rias vezes, percebemos que estamos de volta ao ponto em que come√ßamos. </font><font style="vertical-align: inherit;">Este √© um ciclo! </font><font style="vertical-align: inherit;">E isso √© completamente l√≥gico: provavelmente estamos repetindo algum tipo de XML. </font><font style="vertical-align: inherit;">De fato, Hopper nos mostrou isso - se seguirmos o CFG, veremos um (poss√≠vel) ciclo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70f/63f/fdd/70f63ffddb8c3c073dcc257af70581d8.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso significa:</font></font><code>if (*(ebp+var_CC) == *(ebp+var_28)) { *(ebp+var_1D84)=edi }</code></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sua condi√ß√£o de sa√≠da √© que o valor </font></font><code>ebp+var_1D84</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seja diferente de zero. </font><font style="vertical-align: inherit;">E vemos um par√¢metro de c√≥digo interessante no destacado por mim </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos adicionar um ponto de interrup√ß√£o neste </font></font><code>cmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e vamos descobrir isso.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a3/c32/d3a/9a3c32d3a01dd202e192648f5ef6609c.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/593/bc4/34d/593bc434d505cb29799846d61cb177bb.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquerda: defina um ponto de interrup√ß√£o no CMP e continue a execu√ß√£o. √Ä direita, monitoramos os registros e a mem√≥ria.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Examinamos os registros com </font></font><code>reg r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o valor da mem√≥ria com </font></font><code>mem read $ebp-0x28</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, na verdade, cont√©m 0x2773, e o valor na mem√≥ria agora √© 0x00A0. Se voc√™ execut√°- </font></font><code>thread c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo </font><font style="vertical-align: inherit;">v√°rias vezes </font><font style="vertical-align: inherit;">, veremos que a itera√ß√£o ocorre em diferentes IDs em busca de correspond√™ncias. Em algum momento, os valores coincidir√£o, o loop sair√° e o jogo come√ßar√°. Agora sabemos como gerenci√°-lo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembre-se do arquivo de log: ele identificou o dispositivo e o fabricante. Provavelmente em algum lugar existe um ciclo semelhante para os nomes dos fabricantes. E, de fato, √© muito semelhante e est√° localizado no CFG diretamente acima do nosso ciclo. Esse loop √© um pouco mais simples e procuramos a string "vendor". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desta vez, a compara√ß√£o √© feita com</font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Essa vari√°vel √© realmente usada como o ID do fabricante. </font><font style="vertical-align: inherit;">Se colocarmos um ponto de interrup√ß√£o aqui e verificarmos tudo, veremos o familiar 0x8086 em </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, ao mesmo tempo, uma compara√ß√£o com 0x10DE est√° acontecendo. </font><font style="vertical-align: inherit;">Vamos escrever </font></font><code>eax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e ver o que acontece.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4a/014/fd5/e4a014fd58bcc6408f48de1411db83b8.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03b/9ce/7d0/03b9ce7d056048ecdf69987c3e8d774a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uau. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, 0x10DE √© NVIDIA. </font><font style="vertical-align: inherit;">De fato, √© poss√≠vel entender isso quando se estuda um arquivo de dados, mas n√£o √© muito interessante. </font><font style="vertical-align: inherit;">Agora, a pergunta √©: qual √© o identificador da GeforceFX 6800? </font><font style="vertical-align: inherit;">Podemos usar o LLDB e apenas verificar cada identificador, mas isso levar√° tempo (existem muitos, tentei encontrar o correto). </font><font style="vertical-align: inherit;">Ent√£o, vamos dar uma olhada em render.bar neste momento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/605/7f4/cbc6057f454e5ee95865324fea40e271.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha que seja "XMB", a representa√ß√£o bin√°ria de XML usada no Age 3.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Este arquivo √© bastante ca√≥tico. Por√©m, ap√≥s as tags Geforce FX 6800, vemos v√°rios identificadores. Provavelmente, precisamos de um deles. Vamos tentar 00F1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais f√°cil de testar isso √© usar o LLDB e definir os pontos de interrup√ß√£o desejados. Vou pular esta etapa, mas direi que 00F1 surgiu (felizmente). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, precisamos responder √† pergunta: "Como tornar essa mudan√ßa permanente?" Parece que ser√° mais f√°cil alterar os valores </font></font><code>var_CC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>var_D0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em 0X00F1 e 0X10DE. Para fazer isso, precisamos apenas de espa√ßo para o c√≥digo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solu√ß√£o simples seria substituir uma das chamadas de registro de log por um NOP, por exemplo, uma chamada de subsistema. </font><font style="vertical-align: inherit;">Isso nos libertar√° v√°rias dezenas de bytes, e isso √© ainda mais do que necess√°rio. </font><font style="vertical-align: inherit;">Vamos selecionar tudo isso e substitu√≠-lo pelo NOP. </font><font style="vertical-align: inherit;">Ent√£o, precisamos escrever informa√ß√µes usando as vari√°veis ‚Äã‚ÄãMOV: assembler </font></font><code>mov dword [ebp+var_CC], 0xF1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>mov dword [ebp+var_D0], 0x10DE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/eb6/d19/e6feb6d1903ca8305714594fe1911413.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/79c/096/783/79c096783f59920be40a85fdac85f44f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes e depois</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vamos rodar o jogo. </font><font style="vertical-align: inherit;">Finalmente, conseguimos algo: voc√™ pode escolher entre Baixo, M√©dio ou Alto, al√©m de ativar os par√¢metros Altos para sombras.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/370/8b5/7cb/3708b57cb8d0d5e405e54e4c5ee99eb8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas ainda n√£o podemos ativar o Very High, e isso √© triste. </font><font style="vertical-align: inherit;">O que est√° acontecendo?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e16/2e6/732/e162e673279757ba3cac035fa5f9b0f6.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ah, entendi.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Como se viu, o Geforce FX 6800 deve suportar os shaders de pixel da vers√£o 3.0 e definimos apenas a vers√£o 2.0. Agora √© f√°cil corrigi-lo: basta escrever o ponto flutuante 3.0 </font></font><code>ebp+0xA2A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este valor √© 0x40400000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, o jogo n√£o √© mais caprichoso e podemos desfrutar de configura√ß√µes muito altas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3c/24e/2c1/f3c24e2c156feb16f1d34bf67aa33d5a.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estranho, mas parece completamente diferente. As cores s√£o muito menos vibrantes e o nevoeiro dependente do alcance apareceu. H√° tamb√©m um pequeno problema de conflito de sombra (tamb√©m est√° nas capturas de tela acima, devido aos par√¢metros High shadow, n√£o √† qualidade dos shaders), que ainda n√£o consegui resolver.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E este √© o fim de nossa jornada, obrigado pela leitura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, darei exemplos de como cada um dos par√¢metros do jogo se parece, porque todas as capturas de tela encontradas online s√£o terr√≠veis ou incompletas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os gr√°ficos no Medium s√£o bastante aceit√°veis, mas sofrem com a falta de sombras. Pelo que sei, o Very High geralmente adiciona uma LUT completamente diferente (uma boa explica√ß√£o desse termo pode ser encontrada na se√ß√£o Grada√ß√£o de cores </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deste artigo.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), neblina √† dist√¢ncia e talvez at√© um modelo de ilumina√ß√£o completamente diferente? </font><font style="vertical-align: inherit;">A imagem √© muito diferente e √© bastante estranha.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5a/ed3/00d/b5aed300d967d53f67bf3e8798615525.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c8/0b8/bd7/1c80b8bd77a9cdfb4fdbd1da13146035.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45a/73b/776/45a73b7760497a9424b4e92984071e2c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/817/12a/54c/81712a54ca17e71925eea886f628db3f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De cima para baixo: Muito alto, Alto (com op√ß√µes de sombra alta), M√©dio (apenas com sombra ativada), Baixo (com sombra desativada).</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros links √∫teis</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O blog ao qual vinculei acima cont√©m uma an√°lise maravilhosa dos pipelines de renderiza√ß√£o modernos: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.adriancourreges.com/blog/ O</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Rate 0 AD √© um jogo RTS de c√≥digo aberto do mesmo g√™nero: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://play0ad.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ela precisa de desenvolvedores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ quiser saber mais sobre o formato XMB, poder√° ler </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seu c√≥digo no 0 AD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o verifiquei, mas tenho certeza de que esse √© o mesmo formato, porque a pessoa que escreveu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o decodificador XMB para o Age 3 no c√©u do Age of Empires</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamb√©m implementou esses arquivos no c√≥digo-fonte 0 AD em 2004. Portanto, essa ser√° uma li√ß√£o divertida de paleontologia de c√≥digo. Obrigado por todo o trabalho, Ykkrosh.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lembro exatamente que li um excelente tutorial sobre o uso do Hopper, mas agora n√£o consigo encontrar o link. </font><font style="vertical-align: inherit;">Se algu√©m souber do que estou falando, solte o link. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, gostaria de mencionar o projeto Cosmic Frontier: um remake da cl√°ssica s√©rie Escape Velocity (mais de Override, mas tamb√©m √© compat√≠vel com Nova). </font><font style="vertical-align: inherit;">Este √© um jogo incr√≠vel, e √© muito triste que poucas pessoas o conhe√ßam. </font><font style="vertical-align: inherit;">Agora, os criadores lan√ßaram uma campanha no Kickstarter, e o desenvolvedor principal possui um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desenvolvimento muito interessante </font><font style="vertical-align: inherit;">, que fala sobre o uso do Hex Fiend para fazer a engenharia reversa dos formatos de dados do jogo original. </font><font style="vertical-align: inherit;">Esta √© uma √≥tima leitura. </font><font style="vertical-align: inherit;">Se voc√™ acha que </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meu artigo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi insano. </font><font style="vertical-align: inherit;">ent√£o em uma das postagens eles:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lan√ßamos o emulador cl√°ssico de Mac para usar as APIs obsoletas h√° muito tempo para ler um arquivo de dados criptografados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criptografia de engenharia reversa a partir do c√≥digo do jogo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eles usaram um hack do sistema de arquivos para acessar os mesmos dados em um Mac moderno.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, s√£o pessoas verdadeiramente apaixonadas, e espero que o projeto seja conclu√≠do com sucesso, porque EV Nova √© o meu jogo favorito.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt500516/index.html">Transfer√™ncia r√°pida de mensageiros instant√¢neos - QIWI Android Wallet</a></li>
<li><a href="../pt500518/index.html">Itera√ß√µes da introdu√ß√£o do scrum em uma empresa</a></li>
<li><a href="../pt500520/index.html">Como usar seus aplicativos em todo o mundo: 10 dicas do CEO Wachanga</a></li>
<li><a href="../pt500528/index.html">Sobre a tradu√ß√£o de "pr√°tica" / "praticidade" sem pr√°tica / pr√°tica</a></li>
<li><a href="../pt500530/index.html">Memorando da API do Canvas</a></li>
<li><a href="../pt500546/index.html">Crie um documento de tabela simples usando o ODF Toolkit</a></li>
<li><a href="../pt500552/index.html">Como acelerar a revis√£o de c√≥digo</a></li>
<li><a href="../pt500554/index.html">Modelo de servidor back-end Golang - parte 2 (API REST)</a></li>
<li><a href="../pt500556/index.html">Dois anos de transforma√ß√£o digital em dois meses</a></li>
<li><a href="../pt500558/index.html">Uma sele√ß√£o de artigos sobre aprendizado de m√°quina: estudos de caso, guias e pesquisas para abril de 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>