<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ŸğŸ¼ ğŸ‘©ğŸ»â€âš–ï¸ ğŸš¶ğŸ» Firmware-Entwicklung fÃ¼r eine analoge Videokamera EVR-Y2022F ğŸ–¥ï¸ ğŸ¤˜ğŸ¼ ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem frÃ¼heren Artikel wurde das GerÃ¤t einer analogen Videokamera eingehend untersucht, um eine eigene Firmware zu erstellen. Wie bereits erwÃ¤hnt, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Firmware-Entwicklung fÃ¼r eine analoge Videokamera EVR-Y2022F</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499546/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In einem frÃ¼heren Artikel wurde das GerÃ¤t einer analogen Videokamera eingehend untersucht, um eine eigene Firmware zu erstellen. Wie bereits erwÃ¤hnt, verfÃ¼gt die Kamera Ã¼ber einen Mikrocontroller unbekannter Herkunft. Es ist viel reicher als die Ã¼blichen AVRs: Es hat zwei Versorgungsspannungen von 3,3 V und 1,8 V und eine DSP-Funktion. Zu diesem Schluss kam ich, als ich Ã¼ber die Implementierung des Autofokus-Algorithmus nachdachte. Trotzdem habe ich komplexe MKs wie STM32 und andere nicht bevorzugt, schon weil ich nie mit ihnen gearbeitet habe. Ich habe definitiv die Entscheidung getroffen, einen der AVR MKs zur Implementierung meiner Firmware zu verwenden. Daher wurde mir bereits zu diesem Zeitpunkt klar, dass die Implementierung der Autofokusfunktion nicht sehr einfach oder eher unmÃ¶glich zu handhaben sein wird.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meine Wahl fiel auf den ATmega128 MK, da er in meinen Arm fiel. Der ATmega8 MK wird in Bezug auf die Anzahl der Schlussfolgerungen offensichtlich nicht ausreichen, zumal ich fÃ¼r alle FÃ¤lle beschlossen habe, einen ganzen MK-Port fÃ¼r den digitalen Videostream vom Videoprozessor zu reservieren. ZunÃ¤chst habe ich herausgefunden, welche Funktionen in meiner eigenen Firmware enthalten sein werden, insbesondere Funktionen, die nicht in der ursprÃ¼nglichen Firmware enthalten sind, und welche Funktionen vernachlÃ¤ssigt werden mÃ¼ssen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Betrachten wir eine Variante des Autofokus-Algorithmus zur Analyse eines digitalen Videostreams. Es gelang mir herauszufinden, dass die Videostreamdaten eine Abwechslung von Bytes sind, die mit den "CK" -Pulsen synchronisiert sind. Bytes des Videostreams codieren die Pegel der Y-, Cr-, Cb-Komponenten des Videosignals mit 8-Bit-Abstufung (256 Pegel). Das heiÃŸt, die digitale Videoausgabe vom Videoprozessor dieser Kamera wird komponentenmultiplexiert. Informationen zur Helligkeit (Y) sind in jedem zweiten Byte des Videostreams enthalten, und Informationen zur Farbe sind zweimal seltener. Das heiÃŸt, Informationen Ã¼ber das Farbdifferenzsignal von Rot Cr sind in jedem vierten Byte enthalten, sowie Informationen Ã¼ber das Farbdifferenzsignal von Blau. Somit reprÃ¤sentiert der Strom die folgende Sequenz: Cb0, Y0, Cr0, Y1, Cb2, Y2, Cr2, Y3, Cb4, Y4, Cr4, Y5, .... Also,WÃ¤hrend Informationen Ã¼ber die Helligkeit jedes Pixels lÃ¼ckenlos sind, werden Informationen Ã¼ber die Farbe von Pixeln nacheinander komponentenweise eingegeben. Diese AusdÃ¼nnung ist auf die Eigenschaften der Unempfindlichkeit gegenÃ¼ber der Farbe kleiner Details und einer Verringerung des Farbbandes im Videosignal zurÃ¼ckzufÃ¼hren. Diese Eigenschaften werden bei der analogen Fernseh- und Videodigitalisierung verwendet. Die obige "Komprimierung" (Farbunterabtastung) hat ein KomponentenverhÃ¤ltnis von 4: 2: 2.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit der Autofokus-Algorithmus funktioniert, reicht es aus, nur die Helligkeitskomponente zu analysieren. Dies ist auch leicht zu erreichen, wenn der Videostream â€Byte fÃ¼r Byteâ€œ abgefangen wird. Wenn die CK-Frequenz etwa 18 MHz betrÃ¤gt, betrÃ¤gt CK / 2 9 MHz, was fÃ¼r den ATmega128 MK durchaus erreichbar zu sein scheint. Die horizontalen und vertikalen Synchronisationsimpulse ermÃ¶glichen es der Steuerung, jeden Bereich des Bildes zu â€zÃ¤hlenâ€œ und zu analysieren. FÃ¼r den Autofokus-Algorithmus reicht es mÃ¶glicherweise aus, nur die Mitte des Rasters zu analysieren. Je besser der Fokus, desto schÃ¤rfer das Bild und desto breiter das Frequenzband des Videosignals (mehr HF-Komponenten). Das heiÃŸt, es ist mÃ¶glich (sogar notwendig), den Fast Fourier Transform (FFT) -Algorithmus auf Fragmente eines digitalen Videostreams anzuwenden und die HF-Komponenten zu analysieren. In diesem Fall mÃ¼ssen Sie den Fokusfokus jedes Mal drehen.Verwendung der Methode der â€halben Teilungâ€œ als mathematische Optimierungsmethode. So kÃ¶nnen Sie das beste Ergebnis erzielen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mich nicht um die Autofokusfunktion gekÃ¼mmert, da es auf MK mit einer einfachen Architektur unmÃ¶glich war, obwohl ich auf jeden Fall einen Port fÃ¼r digitales Video reserviert habe. Anstelle der Autofokussierung habe ich beschlossen, eine Reihe anderer Funktionen zu implementieren, die in der ursprÃ¼nglichen Firmware nicht verfÃ¼gbar waren. Dazu muss die Videokamera jedoch auf stationÃ¤re Bedingungen beschrÃ¤nkt werden, was fÃ¼r die VideoÃ¼berwachung typisch ist. Es wird davon ausgegangen, dass sich die Kamera anschlieÃŸend mithilfe spezieller Mechanismen automatisch und manuell in der horizontalen und vertikalen Ebene drehen kann. Wenn die Kamera automatisch auf ein bestimmtes Objekt gerichtet ist, dessen sphÃ¤rische Koordinaten im Speicher des SteuergerÃ¤ts vorgespeichert werden, Ã¤ndern sich auch die â€Koordinatenâ€œ von Zoom und Fokus, die ebenfalls vorgewÃ¤hlt und im Speicher gespeichert werden.Das Management kann nach dem PELCO-D-Protokoll organisiert werden. DarÃ¼ber hinaus gibt es in der Spezifikation dieses Protokolls ein spezielles Team fÃ¼r dieses Unternehmen. Die Koordinaten von Zoom und Fokus werden natÃ¼rlich fÃ¼r eine bestimmte Entfernung "gepaart". Das heiÃŸt, ein Objekt, das sich in einer bestimmten Entfernung befindet, wird scharfgestellt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie mit dem Schreiben eines Firmware-Programms beginnen, mÃ¼ssen Sie sich Ã¼berlegen, welche PeripheriegerÃ¤te von MK und welche Schlussfolgerungen daraus entstehen. Dann mÃ¼ssen Sie darÃ¼ber nachdenken, wie Sie das Board mit einem eigenen MK in der Kamera platzieren und befestigen kÃ¶nnen. Und damit es so bequem und wartbar wie mÃ¶glich war. Ich habe mich fÃ¼r ein Board mit MK entschieden, dessen Schlussfolgerungen vollstÃ¤ndig nach links und rechts geleitet werden. Die Platine befindet sich an der Unterseite der Kamera, wo wenig Platz vorhanden ist, und wird an einer abnehmbaren Verbindung gehalten. Gleichzeitig befinden sich auf der Platine selbst â€Stifteâ€œ des Anschlusses und an den Seiten der Kamera befinden sich Steckdosen. FÃ¼r die Antwortbuchsen habe ich mich entschieden, zwei weitere Adapterplatinen herzustellen, die so groÃŸ sind wie die Seite der Kamera. Die Lamellen dieser Karten befinden sich auf der Oberseite der Kamera direkt auf der Hauptplatine. Es wird davon ausgegangen, dass jede Lamelle an den gewÃ¼nschten Punkt auf der Hauptplatine der Kamera angeschlossen wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WÃ¤hrend der Entwicklung des Boards mit MK hatte ich die Idee, den Camcorder mit einer Uhr (RTC) zu ergÃ¤nzen, und ich hob die I2C-Linie hervor, die auf dem RTC DS1307-Board (ich weiÃŸ schon was zum Teufel) mit Quarz und einer Batterie und fÃ¼r alle FÃ¤lle mit dem EEPROM 24AA512 platziert war von Hand. Auf der Platine am oberen Rand befinden sich auÃŸerdem AnschlÃ¼sse zum AnschlieÃŸen von SPI- und JTAG-Programmierern. Auf dem Original-Motherboard wird MK mit 12-MHz-Quarz getaktet. Es ist fÃ¼r mich das gleiche. Im Allgemeinen ist es besser, dort Quarz auf 11,0592 MHz zu setzen, um einen klaren UART-Betrieb zu gewÃ¤hrleisten. Die AbstÃ¤nde zwischen den "KÃ¤mmen" abnehmbarer Gelenke habe ich vorher sorgfÃ¤ltig berechnet. Ich habe mich entschieden, MK aus dem FÃ¼nf-Volt-Krenka zu speisen, der auf den Rahmen unter der Hauptplatine geschraubt wird (er wird auch als KÃ¼hlkÃ¶rper dienen). Die Eingangsspannung 12V wird unmittelbar nach der Sicherung FB801 mit Strom versorgt, wie in der Abbildung gezeigt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pk/rs/q8/pkrsq8mtjjredo8w2mfne5goziy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 1. Energieverwaltung des Mikrocontrollers.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Beim Zeichnen von Brettern in "SprintLayout" habe ich mich gefragt, welchen Zweck jeder Pin des MK hat, der "out" an den Anschluss ausgegeben wird. Das Ergebnis ist ein solches Bild. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bm/95/xg/bm95xgf-akgycofwc_mdsjp8rki.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 2. Skizzen zusÃ¤tzlicher Leiterplatten.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um die Wahrheit zu sagen, habe ich die Seitenbretter (entlang der Kanten) beim Schreiben dieses Artikels gezeichnet. Aber tatsÃ¤chlich habe ich sie mit einem Cutter gemacht. Es stellte sich heraus, dass dies nicht die erfolgreichste Option war. Und das Board selbst mit MK wurde schief gemacht. Ich habe irgendwie die seitlichen Hilfskarten an die Seiten des Kamerarahmens geschraubt und Flussmittelmuttern auf die KupferoberflÃ¤che der Leiterplatte gelÃ¶tet. Tatsache ist, dass an den Seiten nur sehr wenig Platz ist und der Deckel der Kamera praktisch RÃ¼cken an RÃ¼cken â€festgezogenâ€œ wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgenden Abbildungen zeigen die Verteilung der Schlussfolgerungen des MK sowie deren Zweck.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/ry/d2/ccryd2b_viknimo-w0asy0j8fuy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 3. Der Zweck der Schlussfolgerungen des Mikrocontrollers.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es gibt viele Punkte zu kommentieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FÃ¼r den SPI-Programmierer (STK200 +) war die Ausgabe â€PENâ€œ nicht erforderlich. Die Aktivierung erfolgt wie gewohnt durch â€RESETâ€œ. Anstelle von â€MISOâ€œ und â€MOSIâ€œ verfÃ¼gt der MK jedoch Ã¼ber eine separate Schnittstelle (PDI / PDO), und die Leitung â€CLKâ€œ wird kombiniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Referenzspannung fÃ¼r den ADC habe ich die gleichen 5 V gewÃ¤hlt, von denen der MK selbst gespeist wird. Ich habe versucht, separat 3,3 V zu bekommen (wie in der ursprÃ¼nglichen Schaltung), aber gleichzeitig gab es Fallstricke. Um auf die 5-V-Referenzspannung umzuschalten, mÃ¼ssen Sie die Schaltung leicht Ã¤ndern, wie in der Abbildung gezeigt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/od/wr/mnodwrbakf5xlxkq1qskzeuhmkc.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 4. Ãœbersetzung der Tasten auf die 5V Referenzspannung.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Das heiÃŸt, Sie mÃ¼ssen eine Seite des R505-Widerstands von der 3,3-V-Versorgungsseite ablÃ¶ten und stattdessen 5 V von der MK-Stromleitung an ihn anlegen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Schlussfolgerungen von MK, die nur innerhalb des entworfenen Boards verwendet werden, sind nur drei beteiligt. Ein 1-Hz-Impulssignal mit RTC kommt bei PB7 an, um die Zeit zu aktualisieren. Die Pins PD0 und PD1 sind dem I2C-Bus zugeordnet. Es wird programmgesteuert unter Verwendung der CVAVR-Bibliothek â€i2c.hâ€œ implementiert, obwohl an diese AusgÃ¤nge eine Hardware-i2c-Schnittstelle (TWI) angeschlossen ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der MC-Pin â€RESETâ€œ wird ausgegeben, aber der MK-Reset erfolgt von selbst ohne externe Reset-Kette. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde verstanden, dass die HD- und VD-Taktimpulse Ã¼ber externe Interrupt-Ports zum MK gelangen wÃ¼rden, um das Videofeld genau lesen zu kÃ¶nnen. Ohne die Autofokusfunktion werden sie jedoch nicht mehr benÃ¶tigt. Signale von den Zoom- und Fokus-Endschaltern kommen zu benachbarten Ports externer Interrupts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Port "A" MK ist fÃ¼r den digitalen Videostream reserviert. Port "C" ist vollstÃ¤ndig fÃ¼r SD reserviert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pin PD4 wird zum Umschalten von TX / RX RS-485 verwendet. In der ursprÃ¼nglichen Schaltung gab es kein Schalten: Der 2. und 3. Zweig des MAX485-Chips befanden sich am Boden. Der ursprÃ¼ngliche MK konnte nur Daten zur Steuerung der Kamera Ã¼ber PELCO-D empfangen. Ich entschied mich fÃ¼r ein kleines Upgrade. Die Idee war dies. Wenn der Camcorder hoch und in einem geschlossenen GehÃ¤use hÃ¤ngt, ist es einfach unmÃ¶glich, die Firmware schnell zu aktualisieren. Und ein solches BedÃ¼rfnis wird sich sicherlich ergeben: Die Beseitigung verschiedener Fehler und die Verbesserung der FunktionalitÃ¤t werden zum ersten Mal zu einer regelmÃ¤ÃŸigen Praxis. Aus diesem Grund kam mir die Idee, einen Bootloader fÃ¼r MK zu implementieren und diesen bereits zu verwenden, um die Firmware Ã¼ber RS-485 remote zu aktualisieren. In diesem Fall ist ein wechselseitiger Austausch sehr wÃ¼nschenswert. Informationen zum Bootloader finden Sie in diesem Artikel. Und um den MAX485 (2 und 3 Beine) an diesen MK-Pin anzuschlieÃŸen,Sie mÃ¼ssen eine kleine Ã„nderung an der ersten und zweiten Karte vornehmen. Diese Karten sind Ã¼ber ein Schleifenkabel verbunden, an dessen AnschlÃ¼ssen sich ein nicht verwendeter â€IRLâ€œ -Kontakt zur Steuerung der Hintergrundbeleuchtung befindet. Auf der zweiten (Haupt-) Karte mÃ¼ssen Sie den Widerstand R520 ablÃ¶ten und stattdessen den Draht, der durch die Adapterplatine zum ATmega128 MK fÃ¼hrt, an den entsprechenden Ausgang lÃ¶ten. Und auf der ersten Platine mÃ¼ssen Sie 2 und 3 Beine von U202 ablÃ¶ten und biegen, sie zusammenlÃ¶ten und von der Verkabelung zum freien Ausgang von 1 Stecker J302 ziehen. Diese VorgÃ¤nge zum Ã„ndern der Schaltung sind in der Abbildung dargestellt.Das geht Ã¼ber die Adapterplatine zum ATmega128 MK zum entsprechenden Ausgang. Und auf der ersten Platine mÃ¼ssen Sie 2 und 3 Beine von U202 ablÃ¶ten und biegen, sie zusammenlÃ¶ten und von der Verkabelung zum freien Ausgang von 1 Stecker J302 ziehen. Diese VorgÃ¤nge zum Ã„ndern der Schaltung sind in der Abbildung dargestellt.Das geht Ã¼ber die Adapterplatine zum ATmega128 MK zum entsprechenden Ausgang. Und auf der ersten Platine mÃ¼ssen Sie 2 und 3 Beine von U202 ablÃ¶ten und biegen, sie zusammenlÃ¶ten und von der Verkabelung zum freien Ausgang von 1 Stecker J302 ziehen. Diese VorgÃ¤nge zum Ã„ndern der Schaltung sind in der Abbildung dargestellt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/20/oe/qu20oe_mzvupcc4mpsbtg4omwma.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 5. Organisation der TRX-Leitung zur Steuerung des TX / RX MAX485.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
An Bord des ATmega128 befinden sich zwei UART-Schnittstellen. In diesem Fall mÃ¼ssen Sie die zweite Schnittstelle (Pins 27, 28) verwenden, da die erste Schnittstelle an den Pins (Pins 2, 3) mit der Schnittstelle fÃ¼r den SPI-Programmierer kombiniert ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vorstand sind fast alle Schlussfolgerungen des MK involviert. Die Schlussfolgerungen von Port â€Gâ€œ erwiesen sich als ungenutzt. Die Uhr konnte Ã¼brigens programmgesteuert auf Basis von MK implementiert werden. Es bietet einen Ruhemodus mit einer Batterie zum ZÃ¤hlen der Zeit, wenn die Hauptstromversorgung ausgeschaltet ist. Es gibt sogar Schlussfolgerungen fÃ¼r den Anschluss eines separaten Niederfrequenzquarzes. Ich habe mich jedoch nicht darum gekÃ¼mmert und den DS1307 geschlagen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt den Zweck jedes Ausgangs der Karte mit MK. AuÃŸerdem ist bedingt markiert, auf welcher Seite der Hauptplatine die DrÃ¤hte von jedem Pin verlÃ¶tet werden. Es ist auch notwendig, einige Kommentare abzugeben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i0/fd/df/i0fddfrritx4bjzwqgsfl3bu1r4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 6. Abtretung von Schlussfolgerungen einer zusÃ¤tzlichen Zahlung mit MK.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Signale von den Zoom- und Fokus-Endschaltern kommen nicht nur zu den Interrupt-Ports, sondern auch zu den ADC-EingÃ¤ngen. Tatsache ist, dass ich bereits in der Phase des SD-Studiums ein solches Merkmal bemerkt habe. Wenn der Zoom- oder Fokusmechanismus auf â€Nullâ€œ steht, kann das Ausgangssignal vom AnhÃ¤nger einen â€Zwischenzustandâ€œ annehmen. Um solche seltenen FÃ¤lle besser erfassen zu kÃ¶nnen, habe ich mich fÃ¼r den ADC entschieden. NatÃ¼rlich ist dies kein sehr kompetenter Ansatz, aber auf diese Weise kam ich schnell aus dem Problem heraus, das manchmal in der Initialisierungsphase meiner Test-Firmware auftrat. Dadurch habe ich die StabilitÃ¤t des Algorithmus erhÃ¶ht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die SDA / SCL-Signale vom I2C werden nur fÃ¼r den Fall in den Anschluss eingesteckt und nicht auÃŸerhalb dieser Karte verwendet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Namen der einzelnen Pins zur Steuerung der ID werden entsprechend der tatsÃ¤chlichen Verbindung signiert. Das Verbinden von Daten mit Blick auf die Zukunft wurde schlieÃŸlich in der Debugging-Phase korrigiert. Es gab viel Verwirrung, aber die Fehler waren nur im Wechsel der Phasen genau umgekehrt und nicht in ihrer Reihenfolge. Die Alternativen â€4-1-2-3â€œ (fÃ¼r Zoom) und â€2-3-4-1â€œ (fÃ¼r Fokus) sind ein und dieselbe sowie â€1-2-3-4â€œ und wurde als Grundlage genommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende des Artikels </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(um nicht zu blamieren) werden</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zwei Fotos prÃ¤sentiert. Die erste ist die Unteransicht des Camcorders mit Blick auf die zusÃ¤tzliche Leiterplatte. Die zweite ist eine Ansicht von oben von oben auf die Hauptplatine einer Videokamera mit einem abgedichteten Standard-MK (genauer gesagt Mikroprozessor), einem BÃ¼ndel DrahtbrÃ¼cken und anderem Rotz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe das Programm (Firmware) zusammen mit seinen vorlÃ¤ufigen Tests im ISIS 7 Professional (Proteus) -Programm geschrieben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/qr/f7/mtqrf7iej-6e3adbtcg-bgghokq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 7. Ansicht des Projekts in Proteus.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anstelle der einzigartigen Chips des Zeichengenerators und des Videoprozessors (die natÃ¼rlich nicht in Proteus enthalten sind) habe ich SPI-Debugger installiert. Mit ihrer Hilfe ist es bequem, die Bytes zu steuern, die MK per SPI sendet. Die tatsÃ¤chliche Reaktion auf diese Bytes wird jedoch direkt auf der Hardware gesteuert. Mit Proteus kÃ¶nnen Sie PELCO-D-Befehle von einem echten DVR Ã¼berwachen und debuggen. Zu diesem Zweck mÃ¼ssen Sie den DVR optional Ã¼ber den einfachsten Einwegadapter RS485-&gt; RS232 an den COM-Anschluss des Computers anschlieÃŸen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann begann ich zu entwickeln und zu modellieren. Excel hat dabei sehr geholfen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst mÃ¼ssen Sie die Timer und ihre Konfiguration festlegen. Ein Timer - um die Drehung des Schrittmotors und die AusfÃ¼hrung wiederholter Operationen der Tasten zu realisieren, wÃ¤hrend sie gedrÃ¼ckt gehalten werden. Wenn Sie diese oder jene Taste wÃ¤hrend der Einstellungen Ã¼ber das MenÃ¼ gedrÃ¼ckt halten, wird der Betrieb der SD ausgeschlossen. Wenn Sie eine der Zoom- oder Fokussteuertasten auÃŸerhalb des MenÃ¼s gedrÃ¼ckt halten, dreht sich die SD mit dem entsprechenden Zeitparameter. Somit gibt es keine Konflikte. Ich hatte vor, den zweiten Timer zu verwenden, um PWM fÃ¼r die SD zu implementieren, aber im Laufe der Zeit habe ich beschlossen, ihn aufzugeben. In meinem Fall ist PWM nicht erforderlich, wenn kein Autofokus vorhanden ist. DarÃ¼ber hinaus hat der Ãœbertragungsmechanismus eine helikale Struktur, daher kÃ¶nnen Sie im Ruhezustand die SD nicht durch Gleichstrom "halten", der Mechanismus kriecht nirgendwo hin.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AnschlieÃŸend mÃ¼ssen Sie das Zeichenalphabet des Zeichengenerators gemÃ¤ÃŸ Datenblatt Ã¼berarbeiten und mit dem Standardalphabet ASCII vergleichen. Das Alphabet des Zeichengenerators besteht aus 128 Zeichen, was der halben GrÃ¶ÃŸe des letzten entspricht. Zum Beispiel fehlen die kyrillischen Zeichen im Zeichengenerator vollstÃ¤ndig, aber es gibt Sonderzeichen, die fÃ¼r seine Anwendung charakteristisch sind (Sonne, Sanduhr, kleiner Mann, Notiz, Telefon usw.). Ich habe ein Array von "smb [256]" aus 256 Elementen erstellt und es in das EEPROM MK eingefÃ¼gt. Die Notation smb [i] = adr bedeutet, dass sich an der Adresse adr im Zeichengenerator ein Zeichen mit dem ASCII-Code i befindet. Und wenn das Symbol i nicht im Alphabet des Zeichengenerators enthalten ist, bezieht sich der Wert des Array-Elements auf das "Leerzeichen" mit der Adresse 0x7E. Das heiÃŸt, fast die HÃ¤lfte der Elemente im Array hat den Wert "0x7E". Dieses Array ist in der folgenden Abbildung in Tabellenform dargestellt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/_b/_g/yo_b_gqswkjfk1smuefynrwgs0e.png"><br>
<i>. 8.    ASCII    PD6464A.</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nÃ¤chstes mÃ¼ssen Sie Ã¼berlegen, wie SchaltflÃ¤chen Ã¼ber den ADC verarbeitet werden. Nach dem Ohmschen Gesetz ist es einfach, die Spannungswerte am Eingang des ADC zu berechnen, wenn Sie auf eine SchaltflÃ¤che klicken. Danach ist es einfach, die Grenzen der Intervalle zu berechnen, deren Mitte die gleichen Spannungswerte aufweist. Insgesamt werden sechs Intervalle erhalten: fÃ¼nf davon entsprechen jeder Taste und eines dem Fehlen eines Drucks (es wird keine Taste gedrÃ¼ckt). Auf Hardwareebene analysiert der ADC MK regelmÃ¤ÃŸig den Spannungswert Ã¼ber die Tasten. Der Timer fÃ¼r Anti-Bounce kann basierend auf der Berechnung der ADC-Taktzyklen implementiert werden, was ich getan habe. In der Debugging-Phase hatte dieser Teil des Programms seine TÃ¼cken. Ich denke, dass es sich nicht lohnt, Details zu schreiben. Um die klare Arbeit dieser FunktionalitÃ¤t zu erreichen, musste ich lange basteln. Die Tastenerkennungsfunktion befindet sich im ADC-Interrupt-Bereich, und an seinem Ausgang befindet sich die Tastennummer.Depressionsflagge und Freigabeflagge. Die Weiterverarbeitung der Tasten erfolgt im Hauptprogrammzyklus. Die Tastenabruffrequenz (ADC-Frequenz) betrug 12000/128 = 93,75 (kHz), wobei 128 der maximal mÃ¶gliche Teiler ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann habe ich ein Array von Werten des UART-Registers UBRR1 der UART-Konfiguration erstellt, abhÃ¤ngig von dem einen oder anderen Bodyrate-Wert fÃ¼r PELCO-D, der aus der Liste in den Einstellungen Ã¼ber das MenÃ¼ ausgewÃ¤hlt werden kann. </font><font style="vertical-align: inherit;">Diese Werte kÃ¶nnen mithilfe der Formel aus dem Datenblatt des MK berechnet und auch mit dem automatischen Konfigurator des AVR-Assistenten abgerufen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann fing ich an, das MenÃ¼ zu modellieren. </font><font style="vertical-align: inherit;">Dies ist die wichtigste und zeitaufwÃ¤ndige Phase beim Schreiben eines Programms. </font><font style="vertical-align: inherit;">Im Prinzip wollte ich das MenÃ¼ der Standard-Firmware nicht wiederholen, auÃŸer dass ich mich entschied, es zu einer hierarchischen Struktur zu komplizieren (Abschnitt im Abschnitt). </font><font style="vertical-align: inherit;">Unten finden Sie eine Beschreibung des Modells und die Definitionen des MenÃ¼s, das ich fÃ¼r mich selbst erstellt habe.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kann nicht lesen</font></font></b>
                        <div class="spoiler_text">     .<br>
          .<br>
      .<br>
          .<br>
       Â«MENUÂ».<br>
<br>
    Â«Â»    .<br>
    Â«Â»  Â«Â»       .<br>
  Â«Â»       .<br>
  Â«Â»       .<br>
  (   )   ,         .<br>
   Â« Â»,     .<br>
<br>
   :<br>
 â€” ;<br>
 â€” ;<br>
 â€” ;<br>
 â€” .<br>
<br>
    ,   ,   .<br>
    &lt;&gt;.<br>
     .<br>
         "&lt;..&gt;".<br>
      Â«Â».<br>
      ,   .<br>
        ( ) .<br>
    "&lt;..&gt;"      .<br>
        ,    .<br>
           .<br>
<br>
      .<br>
     .<br>
        .<br>
     "&lt;â€¢&gt;" ( ).<br>
     "&lt; &gt;" ().<br>
      Â«Â».<br>
<br>
    .<br>
           .<br>
     Â«l*lÂ» (,   Â«lÂ»).<br>
     Â«l lÂ» (,   Â«lÂ»).<br>
        Â«Â».<br>
<br>
  ,       .<br>
     .<br>
           .<br>
            .<br>
       : Â«000Â», Â«00Â», Â«0Â».<br>
        .<br>
         : ": ".<br>
  â€”      (    )       .<br>
 ,   ,     Â«Â»  Â«Â».<br>
    Â«Â»     1.<br>
    Â«Â»     1.<br>
<br>
         .<br>
         .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher Ã¤hnelt die MenÃ¼navigation der Navigation durch Dateien und Ordner Ã¼ber â€Total Commanderâ€œ. Der Implementierungscode fÃ¼r dieses MenÃ¼modell ist nicht sehr kompliziert, aber sehr umstÃ¤ndlich. Es gibt zwei SchlÃ¼sselvariablen: die Nummer der aktiven Seite und die Nummer der aktiven Position auf der Seite. FÃ¼r beide Variablen arbeiten zwei "Switch-Case" -Funktionen ineinander. Dieses Funktionspaar ist am DrÃ¼cken der Tasten "Links", "Rechts" und "MenÃ¼" beteiligt. An jedem Ort (fÃ¼r jede SchaltflÃ¤che, Seite und jedes aktuelle Element) werden bestimmte Aktionen registriert. Jede MenÃ¼seite verfÃ¼gt Ã¼ber eine Funktion, die die Anzeige der Seite auf dem Bildschirm mit allen Beschriftungen und Parametern implementiert. Bevor ich die Seitenausgabefunktionen implementierte, habe ich sie zuvor in Excel modelliert, wie sie "nach Zellen" sagen.So werden die Koordinaten der Zellen jedes Symbols auf dem Bildschirmfeld klarer dargestellt, und diese Informationen sind in der Programmierphase erforderlich. In der folgenden Abbildung habe ich als Beispiel die Ansicht von Seite 9 gegeben, auf der die PELCO-D-Baudrate aus der Liste ausgewÃ¤hlt ist. Das Schnittstellenelement auf der Seite ist ein Optionsfeld. DarÃ¼ber hinaus soll der erste Absatz &lt;..&gt; diesen Abschnitt verlassen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c0/s1/uy/c0s1uyuaoh9dawm-bqpf5g4pmjg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 9. Modellieren des OSD in Excel.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ich habe auch ein Array erstellt, das die Anzahl der Punkte auf jeder Seite widerspiegelt. Es wird beim DrÃ¼cken der Auf- und Ab-Tasten verwendet. Dies geschieht, um den Code zu reduzieren und die Verwendung der Switch-Case-Funktion zu vermeiden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiederholtes virtuelles DrÃ¼cken bei gedrÃ¼ckter Taste wird im Hauptteil des Timer-Interrupts durch die Funktion â€Switch-Caseâ€œ implementiert, die mit einer Ganzzahlvariablen arbeitet, die ein Flag ist. Der Flag-Wert ist fÃ¼r jede Aktion einer SchaltflÃ¤che auf einer bestimmten Seite und einem bestimmten MenÃ¼punkt eindeutig. Es wird dem Flag nur an den Stellen als Seriennummer zugewiesen, an denen virtuelle Klicks erforderlich sind. Gleichzeitig werden innerhalb der Funktion â€Switch-Caseâ€œ (im Hauptteil des Timer-Interrupts) Kopien von Funktionen platziert, die die Aktionen der Tasten implementieren. Um Speicherplatz zu sparen, konnten bei regelmÃ¤ÃŸigen Aufrufen der Tastenverarbeitungsfunktion VerknÃ¼pfungen (Links) platziert werden. Es ist noch vernÃ¼nftiger, aber in diesem Moment hatte ich nicht die Geduld darÃ¼ber nachzudenken, wie ich es besser machen kÃ¶nnte, weil ich das Projekt so schnell wie mÃ¶glich abschlieÃŸen wollte. Und der Speicher in ATmega128 stellte sich als ziemlich viel heraus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SchlieÃŸlich habe ich â€Bibliothekenâ€œ fÃ¼r die Arbeit mit einem Videoprozessor, einem Zeichengenerator und einer RTC DS1307 mit den erforderlichen Funktionen implementiert. Danach habe ich die Adressen des EEPROM MK ermittelt, um diese oder jene Informationen zu speichern. Die ersten 32 Bytes sind zum Speichern von MenÃ¼einstellungsinformationen reserviert. Die nÃ¤chsten 32 Bytes sind fÃ¼r das Speichern von Text reserviert, der auf dem Bildschirm angezeigt oder mit dem Standardbefehl â€Pelco-D Write Char. Zum Bildschirm. " Die nÃ¤chsten 256 Bytes des EEPROM-Bereichs sind fÃ¼r das Alphabet reserviert (Konvertierung eines Zeichens von ASCII in eine Adresse fÃ¼r einen Zeichengenerator, wie oben erwÃ¤hnt). SchlieÃŸlich sind die nÃ¤chsten 128 Bytes fÃ¼r das Speichern von â€Voreinstellungenâ€œ (Vorlagen) fÃ¼r Zoom / Fokus reserviert. Ich habe diese Funktion aufgrund des fehlenden Autofokus eingefÃ¼hrt. Ich habe darÃ¼ber am Anfang des Artikels geschrieben. Insgesamt 32 Vorlagen. Die Koordinaten des Zooms oder Fokus werden in zwei Bytes codiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UnabhÃ¤ngig davon lohnt es sich, Ã¼ber die Implementierung des SD-Managements zu schreiben. Die Drehung der SD wird durch Aufrufen der Funktionen StepF () und StepZ () im Timer-Interrupt-Block erreicht. Die Drehzahl wird durch die Konfiguration dieses Timers bestimmt. Und die Implementierung der obigen Funktionen implementiert die FÃ¶rderung des Fokus bzw. des Zooms in einem minimalen Schritt. WÃ¤hrend der Drehung des Zoomobjektivs und des Fokus werden ihre Endpositionen gesteuert. Die Position des maximalen Fokus und die Position des minimalen Zooms werden im Programm durch Konstanten (280 bzw. -600) dargestellt. Aber die Position des minimalen Fokus und die Position des maximalen Zooms - in Form der Variablen F_min und Z_max (genauer gesagt Funktionen). Dieser Ansatz wurde durch einen nicht rechteckigen Arbeitsbereich mit einer abgeschnittenen unteren rechten Ecke erleichtert. Zur Berechnung der Werte von F_min und Z_max werden stÃ¼ckweise definierte Funktionen F_min (Z) und Z_max (F) verwendet. AuÃŸerdem,Wenn sich der SD-Zoom bei Z (Zoomkoordinate)&gt; 500 in die positive Richtung dreht, dreht sich der SD-Fokus gleichzeitig in die gleiche Richtung, wenn dieser Koordinaten &lt;(- 180) hat. Das heiÃŸt, die maximale Zoomposition ist im Prinzip nicht durch die aktuelle Fokusposition begrenzt, sondern auf 600. Es kommt einfach vor, dass sich zwei SDs gleichzeitig drehen, wenn der entsprechende Winkelrand des fÃ¼nfeckigen Bereichs erreicht ist, und die Bewegung in diesem Stadium entlang der â€Schnittseiteâ€œ erfolgt (wenn grafisch interpretiert). ) Aus mechanischer Sicht entspricht dies dem im vorherigen Artikel beschriebenen Prozess, wenn in Abwesenheit von SD und beim manuellen Verschieben der Zoom- und Fokusknoten der Zoomknoten am Ende des Pfads den Fokusknoten â€ziehtâ€œ. Aufgrund der Tatsache, dass die Zoomkoordinate die Fokuskoordinate dominiert (weshalb ich die F (Z) -AbhÃ¤ngigkeit betrachte,aber nicht umgekehrt), ich habe nicht begonnen, ein Ã¤hnliches Zoom-Scrolling-Verfahren in der Funktion Step_F () zu implementieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der ursprÃ¼nglichen Firmware hatte die Geschwindigkeit zum Ã„ndern von Zoom und Fokus feste Werte. Dies ist nicht immer bequem. In meiner Firmware habe ich vier Werte fÃ¼r die Zoom- und Fokusgeschwindigkeit (unabhÃ¤ngig voneinander) angegeben, die sowohl Ã¼ber das MenÃ¼ als auch mit dem dieser Funktion zugewiesenen PELCO-D-Befehl ausgewÃ¤hlt werden kÃ¶nnen. Diese vier Werte werden in der Debugging-Phase nach Belieben vorgewÃ¤hlt und dann in die Firmware eingegeben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die BD-Initialisierungsfunktion init_MR () wird benÃ¶tigt, um die Mechanik des Zooms und des Fokus an das Koordinatensystem zu binden. Es wird jedes Mal einmal ausgefÃ¼hrt, wenn Sie den Camcorder einschalten. Der Algorithmus ihrer Arbeit ist ungefÃ¤hr der folgende. ZunÃ¤chst wird angenommen, dass sich der Zoom oder Fokus auf dem Nullpunkt befindet, und es wird versucht, den Abprall des Signals von den Endschaltern durch externe Interruptfunktionen zu erfassen. Ich werde sofort feststellen, dass das Signal am Ausgang des AnhÃ¤ngers einen "Zwischen" -Zustand zwischen logischer "0" und "1" hat, wenn der Zoom oder Fokus auf "Null" (an der Grenze der Aufteilung des optischen AnhÃ¤ngers) liegt. Solche FÃ¤lle sind sehr unwahrscheinlich, kÃ¶nnen aber nicht ausgeschlossen werden. Die Interrupt-Funktion interpretiert jedoch kein Signal wie Bounce. Aus diesem Grund habe ich den ADC MK verwendet, der Signale von den End- und Zoom-Endschaltern auf seinen beiden freien KanÃ¤len auslÃ¶st. Damit,Der erste Schritt ist die "Digitalisierung" der Signale von den Endschaltern mit 8-Bit-Genauigkeit. Dies erfolgt mit einer einzigen Analog-Digital-Wandlung. Es ist zu beachten, dass die Referenzspannung in unserem Fall 5 V betrÃ¤gt und der logische Pegel â€1â€œ vom Endschalter 3,3 V betrÃ¤gt. FÃ¼r eine logische "0" ist der ADC-Wert Null und fÃ¼r eine "1" - 3,3 / 5 * 255 = 168. Wenn der Signalwert von dem einen oder anderen Trailer in den Bereich von beispielsweise 2 bis 165 fÃ¤llt (ein Fuzzy-Intervall wird verwendet), bedeutet dies, dass der entsprechende Knoten bereits "auf Null" ist und der Initialisierungsvorgang fÃ¼r diesen Knoten gestoppt werden kann. Andernfalls mÃ¼ssen Sie anhand des logischen Werts des AnhÃ¤ngersignals (â€0â€œ oder â€1â€œ) bestimmen, in welchem â€‹â€‹Teil (zur HÃ¤lfte) sich der Knoten befindet. Die Drehrichtung des SD hÃ¤ngt davon ab. Auf die eine oder andere Weise sollte der SD in diese Richtung gedreht werden.so dass sich der entsprechende Knoten in Richtung "Null" (Endschalter) bewegt. Somit wird die Drehung des Motorantriebs mit der gleichzeitigen Berechnung der Anzahl von Schritten gestartet, bis der Endschalter erreicht ist. Sobald der entsprechende Endschalter erreicht ist, der die Funktion der externen Unterbrechung entsprechend der Differenz der logischen Ebene bestimmt, erfolgt eine RÃ¼ckwÃ¤rtsdrehung des Motorantriebs. Es dreht sich in der gleichen Anzahl von Schritten in die entgegengesetzte Richtung und kehrt dadurch in seine ursprÃ¼ngliche Position zurÃ¼ck. Der Wert der Anzahl der Schritte fÃ¼r jede BD mit dem entsprechenden Vorzeichen wird vor dem Verlassen der Initialisierungsfunktion in die entsprechenden Variablen kopiert. Das oben beschriebene Verfahren erfolgt unabhÃ¤ngig voneinander fÃ¼r Fokus und Zoom innerhalb derselben Funktion (nicht wiederum).Die Drehzahl des Motorantriebs in der Initialisierungsphase wird durch eine separate Konstante bestimmt und entspricht der maximalen Drehzahl fÃ¼r eine sichere korrekte Drehung des SM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie sich das Beispiel vor, in dem sich der Zoom vor dem Einschalten der Kamera im negativen Bereich und der Fokus im positiven Bereich befand. Die Abbildung zeigt schematisch die Flugbahn des Punktes (Z; F) wÃ¤hrend des Initialisierungsvorgangs des Schrittmotors. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/59/6d/1p596dlrqriwqff1jh4jfrtvu-8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 10. Der Vorgang zum Initialisieren von Zoom und Fokus.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Punkt A ist die Anfangsposition von Zoom und Fokus. Die Bewegung beider Knoten erfolgt in Richtung "Null" mit gleicher Geschwindigkeit (Initialisierungsgeschwindigkeit). Bei Punkt B erreicht der Fokus Null, da er nÃ¤her an Null als der Zoom lag. Dann wird der Fokus umgekehrt. Bei Punkt C schlieÃŸt der Fokus den Initialisierungsprozess ab und kehrt zu seiner ursprÃ¼nglichen Position zurÃ¼ck. Gleichzeitig bewegt sich der Zoom immer noch in Richtung seiner â€Nullâ€œ. Am Punkt D erreicht es seine â€Nullâ€œ und kehrt zu seiner ursprÃ¼nglichen Position zurÃ¼ck (Punkt A).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ZusÃ¤tzlich zur Initialisierungsfunktion init_MR () gibt es eine Funktion goto_zf (z, f). </font><font style="vertical-align: inherit;">Basierend auf dem Namen soll von einem Preset zu einem anderen gewechselt werden, Ã¼ber das ich am Anfang des Artikels geschrieben habe. </font><font style="vertical-align: inherit;">Die Drehzahl des Schrittmotors wÃ¤hrend des Ãœbergangs ist dieselbe wie wÃ¤hrend der Initialisierung. </font><font style="vertical-align: inherit;">Der Ãœbergangsprozess in Zoom und Fokus wird gleichzeitig ausgefÃ¼hrt. </font><font style="vertical-align: inherit;">Das heiÃŸt, wenn es erforderlich ist, vom Punkt (z1; f1) zum Punkt (z2; f2) zu gelangen, wird die gleichzeitige Drehung von zwei SDs gestartet. </font><font style="vertical-align: inherit;">Wenn zum Beispiel | f2-f1 | &lt;| z2-z1 |, wird die Fokus-SD frÃ¼her gestoppt. </font><font style="vertical-align: inherit;">Dies ist in der folgenden Abbildung dargestellt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fb/-y/ya/fb-yyanbovlb6i3pe6rxsfh0ax8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">11. Der Vorgang zum Ã„ndern des Zooms und des Fokus bei der Auswahl einer Voreinstellung.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WÃ¤hrend der gesamten Betriebszeit des Schrittmotors wÃ¤hrend des Durchlaufs des Nullmarkenbegrenzers wird die entsprechende Koordinate auf Null gesetzt. </font><font style="vertical-align: inherit;">Und das trotz der Tatsache, dass dies theoretisch nicht mÃ¶glich ist. </font><font style="vertical-align: inherit;">In der Praxis tritt jedoch immer noch ein Fehler von 1-2 Schritten der SD auf.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erwÃ¤hnenswert, dass ich im Gegensatz zur ursprÃ¼nglichen Firmware in meinem Fall bei der Steuerung von Zoom und Fokus (sowohl Ã¼ber die Tasten als auch Ã¼ber PELCO-D) die MÃ¶glichkeit einer schrittweisen Bewegung vorgesehen habe. Dies funktioniert wie folgt. Wenn Sie auf eine der 4 SchaltflÃ¤chen klicken, um den Zoom oder Fokus zu steuern, wird die entsprechende SD um einen Schritt gedreht, wodurch die Bewegung des Zoom- oder Fokusknotens minimiert wird. Wenn Sie die Taste nicht loslassen, beginnt nach kurzer Zeit die normale Drehung des Schrittmotors. Diese VerzÃ¶gerung wird empirisch im Voraus ausgewÃ¤hlt. Diese Funktion Ã¤hnelt virtuellen wiederholten DrÃ¼cken, wÃ¤hrend Sie die Taste gedrÃ¼ckt halten. Dank dieser Funktion wird das Problem des â€Festhaltensâ€œ der Taste beim Steuern des Zooms oder beim Fokussieren auf ein PELCO-D-Remote-GerÃ¤t Ã¼ber eine schlechte Internetverbindung beseitigt. Genauer gesagt ergibt sich die Gelegenheit als unhÃ¶flich,und Feinabstimmung des Zooms oder Fokus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Interpreter der PELCO-D-Befehle erfolgt nach der gleichen Analogie wie im GerÃ¤t zum Lastschalten Ã¼ber PTZ. Ich habe diesem einfachen GerÃ¤t zuvor einen separaten kleinen Artikel Ã¼ber HabrÃ© gewidmet. Im Gegensatz zur ursprÃ¼nglichen Firmware beziehen sich Zoom- und Fokussteuerbefehle vollstÃ¤ndig auf das DrÃ¼cken der entsprechenden Tasten. Das heiÃŸt, es ist mÃ¶glich, das MenÃ¼ mit den PELCO-D-Zoom- und Fokustasten zu â€kletternâ€œ. Und um das MenÃ¼ Ã¼ber PELCO-D aus der Ferne aufzurufen oder vielmehr die Taste â€MENUâ€œ zu drÃ¼cken, habe ich die Taste zum Ã–ffnen der Blende damit verglichen, da diese Funktion in diesem Kameramodell nicht verwendet wird. Somit gibt es fÃ¼nf grundlegende PELCO-D-Befehle zum DrÃ¼cken sowie fÃ¼nf grundlegende Befehle zum Loslassen von Tasten. DarÃ¼ber hinaus werden, wie ich bereits beilÃ¤ufig im gesamten Artikel geschrieben habe, zusÃ¤tzliche Befehle verarbeitet: "Voreinstellung festlegen", "Voreinstellung lÃ¶schen","Gehe zu Preset", "Write Char. Zum Bildschirm â€œ,â€ Bildschirm lÃ¶schen â€œ,â€ Zoomgeschwindigkeit einstellen â€œ,â€ Fokusgeschwindigkeit einstellen â€œ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Datum und Uhrzeit mit RTC werden in Analogie zu alten VHS-Kameras in der unteren linken Ecke des Bildes angezeigt, wenn diese Option im MenÃ¼ aktiviert ist. AuÃŸerdem kÃ¶nnen Sie im MenÃ¼ das Ausgabeformat auswÃ¤hlen, das ich auch im Voraus angegeben habe. Auch auf dem Bildschirm neben Datum und Uhrzeit kann der Wochentag angezeigt werden. ZusÃ¤tzlich zur Uhr werden die aktuellen Koordinaten von Zoom und Fokus als zusÃ¤tzliche Informationen auf dem Bildschirm angezeigt. Diese Option wird hauptsÃ¤chlich in der Debugging-Phase benÃ¶tigt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde Ihnen die Funktionen des von mir implementierten MenÃ¼s erlÃ¤utern. Im Laufe der Zeit wird das MenÃ¼ bei Bedarf Ã¼berarbeitet: Einige Funktionen kÃ¶nnen entfernt und andere hinzugefÃ¼gt werden. Die MenÃ¼struktur, die ich in SPlan mit Seitenaufrufen gezeichnet habe, ist in der folgenden Abbildung dargestellt. Rote Pfeile - betreten Sie den Abschnitt. Blaue Pfeile - Verlassen Sie den Abschnitt. Ich habe nicht auf jeder Seite des MenÃ¼s blaue Pfeile gezeichnet, sondern nur zwei. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/vs/mp/rlvsmpdeoixbmwlg-jmf2uwj51m.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 12. Die Struktur des BildschirmmenÃ¼s.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einige Abschnitte meines MenÃ¼s sind ein bisschen wie Abschnitte des Originals. Dies sind zunÃ¤chst die ersten beiden Abschnitte: WeiÃŸabgleich und Belichtung. Im dritten Abschnitt kÃ¶nnen Sie die Adresse der PELCO-D-Kamera angeben und die Datenrate (Baudrate) aus der Liste auswÃ¤hlen. Der vierte Abschnitt ist Datum und Uhrzeit gewidmet. Sie kÃ¶nnen Datum, Uhrzeit und Wochentag einstellen, eines von vier Anzeigeformaten auswÃ¤hlen und eine Anzeigemethode auswÃ¤hlen. Der fÃ¼nfte Abschnitt - Arbeiten mit Voreinstellungen (Vorlagen) fÃ¼r Zoom und Fokus, wo Sie ihn nach Nummer aufrufen sowie lÃ¶schen oder Ã¼berschreiben kÃ¶nnen. Auch in diesem Abschnitt des MenÃ¼s kÃ¶nnen Sie eine von vier Geschwindigkeiten zum Ã„ndern des Fokus oder des Zooms auswÃ¤hlen. Im fÃ¼nften Abschnitt kÃ¶nnen Sie die Parameter des Videoprozessors bearbeiten, der sich im Byte 9 der Kategorie 3 befindet. Dies ist der Pegel und die Inversion der Burst-Komponente des Videosignals sowie die Videospiegelung. Der letzte Abschnitt des MenÃ¼s dient zum Debuggen.Mit ihm kÃ¶nnen Sie einen beliebigen Wert eines beliebigen Bytes in einer beliebigen Kategorie in den Videoprozessor schreiben. Der Wert kann sowohl in Dezimal- als auch in BinÃ¤rform eingestellt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werde ich ein paar Worte Ã¼ber den Bootloader sagen. Wie ich bereits geschrieben habe, wird der Bootloader zum Remote-Flashen des Camcorders Ã¼ber RS-485 benÃ¶tigt. Anfangs dachte ich, den Bootloader selbst vollstÃ¤ndig zu implementieren. Um Zeit zu sparen, habe ich mich jedoch fÃ¼r einen der bereits implementierten fertigen Downloader entschieden, die im Internet zu finden sind. AuÃŸerdem habe ich sie nie benutzt und nur auf theoretischer Ebene eine Vorstellung von ihnen gehabt. Eines der wichtigsten Kriterien fÃ¼r die Auswahl eines Bootloaders ist die RS-485-UnterstÃ¼tzung. Normalerweise arbeiten AVR-Downloader mit UART RS-232. Und der Bootloader mit RS-485-UnterstÃ¼tzung unterscheidet sich nur dadurch, dass auf der MK-Seite ein zusÃ¤tzlicher Ausgang zum Umschalten des RS-485-Transceivers (z. B. MAX485) wÃ¤hrend der DatenÃ¼bertragung vom MK zum PC zugewiesen wird. Beim Flashen von MK Ã¼bertrÃ¤gt der Bootloader Informationen Ã¼ber erfolgreiche oder nicht erfolgreiche Aufzeichnung an den Computer. Erster BootloaderMit dem, was ich gefunden habe, kÃ¶nnen Sie nicht nur den FLASH-Speicher von MK mit Firmware, sondern auch das EEPROM aufzeichnen. Neben dem Schreiben kÃ¶nnen Sie auch Daten lesen. Aber dieses Projekt mit Assembler-Quellcode war ziemlich verwirrend und ich habe es nicht verstanden. DarÃ¼ber hinaus lag der Schwerpunkt dieses Bootloaders auf der MÃ¶glichkeit, mehrere GerÃ¤te einzeln zu flashen, ohne sie vom RS-485-Netzwerk zu trennen, und auf jedes GerÃ¤t unter einer zuvor eingenÃ¤hten Adresse zuzugreifen. Ich benÃ¶tige solche Funktionsmerkmale nicht, da ich eine andere Topologie des RS-485-Netzwerks verwende und der Camcorder schnell vom DVR auf den PC umgeschaltet werden kann. Der zweite Bootloader ist der deutsche Chip45. Der Quellcode ist nicht gemeinfrei, er kann vom Autor gekauft werden. Stattdessen gibt es mehrere hundert HEX-Dateien fÃ¼r verschiedene AVR-MKs, verschiedene UART-Schnittstellen (wenn es mehrere gibt, wie in meinem Fall),RS-485 oder RS-232 zur Auswahl. Kurz gesagt, fÃ¼r alle Gelegenheiten. Gleichzeitig stellt der Autor fest, dass im Fall von RS-485 der TX / RX-Schaltstift fest ist und dem XCK-UART-Stift der Controller-Schnittstelle entspricht, der in UART praktisch nicht verwendet wird. In meinem Fall ist der 30. Pin des XCK der zweiten UART-Schnittstelle des Atmega128 MK PORTD.5 â€‹â€‹und wird zum Aktivieren der Zoom- und Fokus-Endschalter verwendet. Im Prinzip wird diese Funktion nicht benÃ¶tigt, da, wie Studien gezeigt haben, Endschalter immer aktiv sind, wie ich bereits geschrieben habe. Bei Bedarf kÃ¶nnen Sie diese Funktion auf jeden anderen freien Ausgang MK Ã¼bertragen. Aber dieser Bootloader hat mich auch nicht beeindruckt, zumal ich auf einen interessanteren Bootloader namens â€AVR Universal Bootloaderâ€œ mit chinesischem Design gestoÃŸen bin. Wie Chip45 kann es nur schreiben und nur im FLASH-Speicher von MK.Aber er hat eine Vielzahl von MÃ¶glichkeiten, und deshalb habe ich mich entschieden, daran festzuhalten. Es kommt als AVR Studio-Projekt mit C-Quellcode. Aufgrund der Tatsache, dass ich in CodeVisionAVR arbeite, musste ich AVR Studio zusammen mit WinAVR installieren. Um die HEX-Datei fÃ¼r die Bootloader-Firmware zu erhalten, mÃ¼ssen Sie das Projekt kompilieren, indem Sie vorlÃ¤ufige Ã„nderungen am Quellcode fÃ¼r die Konfiguration Ihres GerÃ¤ts vornehmen, und Sie benÃ¶tigen Ihre eigene. Die Kompilierung des Projekts besteht darin, eine Bat-Datei (Batch-Datei) zu starten, in die die Kompilierungsbefehle geschrieben werden. Daher muss ein Projekt in AVR Studio nicht geÃ¶ffnet werden. Ã„nderungen im Quellcode kÃ¶nnen entweder manuell (auf Programmiererebene) oder mithilfe des Konfigurators vorgenommen werden. Die Rolle des letzteren ist ein zusÃ¤tzliches Fenster des Dienstprogramms, das mit dem ebenfalls angehÃ¤ngten Bootloader funktioniert.Im Konfigurator kÃ¶nnen Sie festlegen, dass der MK-Pin fÃ¼r die TX / RX RS-485-Umschaltung, der MK-Pin fÃ¼r die blinkende LED der Steuerung, der MK-Pin fÃ¼r die Eingabe des Bootloaders, die Art und Weise, wie der Bootloader eingegeben wird, der MK-Name und die Frequenz usw. nicht aufgefÃ¼hrt werden kÃ¶nnen. DarÃ¼ber hinaus kann das bekannte Standardprogramm â€HyperTerminalâ€œ als Dienstprogramm zum Laden eines Benutzerprogramms in MK dienen, dh zum Arbeiten mit dem Bootloader. Es verwendet das Protokoll â€Xmodemâ€œ zum Herunterladen der Firmware. Und um bequem und visuell mit dem Bootloader Ã¼ber das Textterminal arbeiten zu kÃ¶nnen, steht im Konfigurator die Sonderfunktion â€AusfÃ¼hrlicher Modusâ€œ zur VerfÃ¼gung. Trotz der AttraktivitÃ¤t des Hyperterminals habe ich mich fÃ¼r das Dienstprogramm entschieden, das mit dem Bootloader geliefert wurde. Tatsache ist, dass ich mit der im Konfigurator aktivierten praktischen Funktion Verbose, die Ã¼ber das Terminal funktioniert, auf die folgende Situation gestoÃŸen bin.Manchmal passierte es, wenn der Datenverkehr in der Leitung â€kollidierteâ€œ (beide GerÃ¤te im TX-Modus), wodurch der MAX485 im Camcorder sehr heiÃŸ wurde und ausfiel, oder vielmehr nicht vollstÃ¤ndig, sondern nur der RX-Bereich (DatenÃ¼bertragung Ã¼ber RS-485 an die Kamera). . Aus diesem Grund habe ich HyperTerminal aufgegeben. Und es gibt noch eine weitere Unannehmlichkeit. HyperTerminal funktioniert nicht mit HEX-Textdateien und akzeptiert nur eine BinÃ¤rdatei. Daher mÃ¼sste ich eine zusÃ¤tzliche Konvertierung von hex zu bin anwenden. Nachdem die Bootloader-HEX-Datei von mir generiert wurde, habe ich sie mit dem PonyProg-Programm und dem Ã¼blichen SPI-Programmierer in den MK eingenÃ¤ht. Infolgedessen funktioniert der Bootloader wie folgt. Wenn Sie den Camcorder einschalten, wird der Bootloader sofort aktiviert. Er wartet eine Sekunde lang auf eine Verbindung vom Dienstprogramm, dann funktioniert die Hauptfirmware. Wenn die Verbindung erfolgreich hergestellt wurde,dann beginnt der Blinkvorgang. Gleichzeitig muss das andere Ende der RS-485-Leitung vorab vom DVR getrennt und Ã¼ber den RS485 &lt;-&gt; RS232- oder RS485 &lt;-&gt; USB-Adapter mit dem PC verbunden werden. Ãœbrigens Ã¼ber die Adapter. Es stellte sich die Frage, wie man einen solchen Adapter selbst herstellt, da gekaufte Adapter teuer sind. Beim StÃ¶bern im Internet fand ich eine einfache RS485 &lt;-&gt; RS232-Adapterschaltung. Es ist in der folgenden Abbildung dargestellt. Es besteht hauptsÃ¤chlich aus bekannten MAX232- und MAX485-Mikroschaltungen, und TX / RX wird durch das Signal vom 3. Ausgang des COM-Port-Anschlusses des Computers Ã¼ber eine Zenerdiodenschaltung geschaltet. Das heiÃŸt, der MAX485 wird durch den vom PC Ã¼bertragenen Datenverkehr geschaltet. Alles ist einfach und genial.RS232 oder RS485 &lt;-&gt; USB. Ãœbrigens Ã¼ber die Adapter. Es stellte sich die Frage, wie man einen solchen Adapter selbst herstellt, da gekaufte Adapter teuer sind. Beim StÃ¶bern im Internet fand ich eine einfache RS485 &lt;-&gt; RS232-Adapterschaltung. Es ist in der folgenden Abbildung dargestellt. Es besteht hauptsÃ¤chlich aus bekannten MAX232- und MAX485-Mikroschaltungen, und TX / RX wird durch das Signal vom 3. Ausgang des COM-Port-Anschlusses des Computers Ã¼ber eine Zenerdiodenschaltung geschaltet. Das heiÃŸt, der MAX485 wird durch den vom PC Ã¼bertragenen Datenverkehr geschaltet. Alles ist einfach und genial.RS232 oder RS485 &lt;-&gt; USB. Ãœbrigens Ã¼ber die Adapter. Es stellte sich die Frage, wie man einen solchen Adapter selbst herstellt, da gekaufte Adapter teuer sind. Beim StÃ¶bern im Internet fand ich eine einfache RS485 &lt;-&gt; RS232-Adapterschaltung. Es ist in der folgenden Abbildung dargestellt. Es besteht hauptsÃ¤chlich aus bekannten MAX232- und MAX485-Mikroschaltungen, und TX / RX wird durch das Signal vom 3. Ausgang des COM-Port-Anschlusses des Computers Ã¼ber eine Zenerdiodenschaltung geschaltet. Das heiÃŸt, der MAX485 wird durch den vom PC Ã¼bertragenen Datenverkehr geschaltet. Alles ist einfach und genial.Es besteht hauptsÃ¤chlich aus bekannten MAX232- und MAX485-Mikroschaltungen, und TX / RX wird durch das Signal vom 3. Ausgang des COM-Port-Anschlusses des Computers Ã¼ber eine Zenerdiodenschaltung geschaltet. Das heiÃŸt, der MAX485 wird durch den vom PC Ã¼bertragenen Datenverkehr geschaltet. Alles ist einfach und genial.Es besteht hauptsÃ¤chlich aus bekannten MAX232- und MAX485-Mikroschaltungen, und TX / RX wird durch das Signal vom 3. Ausgang des COM-Port-Anschlusses des Computers Ã¼ber eine Zenerdiodenschaltung geschaltet. Das heiÃŸt, der MAX485 wird durch den vom PC Ã¼bertragenen Datenverkehr geschaltet. Alles ist einfach und genial.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/_j/xg/dg_jxg5vy5h-i32yee8szg8urho.png"><br>
<i>. 13.   RS-232 &lt;-&gt; RS-485.</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich den Bootloader beherrscht hatte, beschloss ich in meiner Freizeit, die Optik des Camcorders zu erforschen. Genauer gesagt wurde es fÃ¼r mich interessant, welche Kombinationen von Zoom- und Fokuswerten fokussierte Bilder in unterschiedlichen AbstÃ¤nden vom Objektiv zum Motiv erzeugen. Ich mÃ¶chte Sie daran erinnern, dass der Bereich verschiedener gegenseitiger Werte fÃ¼r Zoom und Fokus durch einen fÃ¼nfeckigen Bereich (fast rechteckig) beschrieben wird. Nehmen Sie beispielsweise den Abstand vom Objektiv zum Motiv 10 cm. Das Argument (entlang der Abszissenachse) des Zooms hat einen Wertebereich von -600 bis 600. Sie mÃ¼ssen den Fokuswert bei jedem Zoomwert auswÃ¤hlen, bei dem das Motiv vor dem Objektiv im Videobild scharfgestellt wird. Dann mÃ¼ssen Sie einen Tisch machen. NatÃ¼rlich macht es keinen Sinn, alle 1200 Zoomwerte zu sortieren. Es reicht aus, ein paar Dutzend Werte mit einem bestimmten gleichen Schritt zu verwenden. Als solchen Schritt habe ich den Wert 50 gewÃ¤hlt.Bei jedem Zoomwert mit diesem Schritt (-600, -550, -500, ...) habe ich den Fokuswert ausgewÃ¤hlt und die Messergebnisse aufgezeichnet. Ich habe ein Ã¤hnliches Verfahren mit anderen AbstÃ¤nden vom Objektiv zum Motiv durchgefÃ¼hrt: 50 cm, 1 m, 10 m, 100 m. Das Ergebnis war eine Kurvenfamilie, die ich in Excel angezeigt habe.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5o/_4/qi/5o_4qikxragcwmdaeespjactaoi.png"><br>
<i>. 14.  Z-F   .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Blick auf die Grafiken mÃ¶chte ich viele Kommentare abgeben. Bei minimalem Zoom liegen die Fokuswerte fÃ¼r fast jede Entfernung etwas unter der â€Mitteâ€œ (Null). Die rosa Kurve fÃ¼r einen Abstand von 10 cm endet bei einem Zoomwert von ca. 250, was dem minimalen Fokuswert entspricht. Diese Kurve hat abnehmenden Charakter und ist nach oben konvex. Die rote Kurve fÃ¼r eine Entfernung von 1 m hat eine vÃ¶llig andere Form. Erstens ist es nicht eintÃ¶nig, und zweitens gibt es hinsichtlich der KonvexitÃ¤tseigenschaft einen Wendepunkt. Die Kurven fÃ¼r Entfernungen von 10 m und 100 m sind von Ã¤hnlicher Natur. Letztere stimmen Ã¼brigens praktisch Ã¼berein, was ich bereits im Voraus wusste. Daher habe ich die gemessenen Entfernungen von 10 und 100 Metern natÃ¼rlich ungefÃ¤hr genommen. Was die blaue Kurve fÃ¼r einen halben Meter beeinflusst - anfangs wollte ich keine Messungen daran vornehmen.Ich habe diesen Abstand ungefÃ¤hr nach dem Prinzip gewÃ¤hlt, dass sich ein Fragment der entsprechenden Kurve so nah wie mÃ¶glich der Eckgrenze der Region nÃ¤hert (Schnitt). Und so geschah es: Diese Grenze berÃ¼hrt praktisch ein Fragment der Kurve. Im Allgemeinen ist anzumerken, dass die obere HÃ¤lfte der Region (positive Fokuswerte) praktisch nicht verwendet wird. Die Ausnahme ist in groÃŸer Entfernung vom Motiv zum Objektiv und beim grÃ¶ÃŸten Zoom. Bei fast allen Entfernungen (mit Ausnahme der nÃ¤chsten, weniger als einem halben Meter) sind die Fokuswerte bei geringem Zoom (150 oder weniger) nahezu gleich. Im Allgemeinen sollten alle angegebenen Messdaten eine theoretische Interpretation haben, die auf den Gesetzen der Optik basiert. GegenwÃ¤rtig habe ich jedoch keine Ahnung von den GerÃ¤ten solcher Objektive. Maximal,Was mir auf dem Gebiet der Optik begegnet ist, ist der Aufbau eines einfachen Refraktorteleskops mit zwei Linsen. Und bei diesem Camcorder habe ich die Mechanik der Optik nicht verstanden. Am Ausgang sind nur zwei sich bewegende Knoten nicht verfÃ¼gbar: der Fokusknoten (verantwortlich fÃ¼r den Fokus) und der Zoomknoten. Und ich weiÃŸ nicht, wie viele Objektive sich insgesamt befinden. Ich nehme an, zwei, die mit diesen sich bewegenden Knoten verbunden sind. Es ist auch erwÃ¤hnenswert, dass sich der Zoom beim Einstellen des Fokus auch optisch geringfÃ¼gig Ã¤ndert, selbst wenn der entsprechende Knoten fest ist.verbunden mit diesen sich bewegenden Knoten. Es ist auch erwÃ¤hnenswert, dass sich der Zoom beim Einstellen des Fokus auch optisch geringfÃ¼gig Ã¤ndert, selbst wenn der entsprechende Knoten fest ist.verbunden mit diesen sich bewegenden Knoten. Es ist auch erwÃ¤hnenswert, dass sich der Zoom beim Einstellen des Fokus auch optisch geringfÃ¼gig Ã¤ndert, selbst wenn der entsprechende Knoten fest ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende des Artikels fahren wir mit dem praktischen Testen des Camcorders fort. Ich habe beschlossen, nicht viele Standbilder zu machen, sondern sofort das gesamte Video hochzuladen. Ich habe die Videoaufnahme Ã¼ber das GerÃ¤t aufgenommen, der Ton wurde separat auf den Audiorecorder geschrieben. Die ursprÃ¼ngliche AuflÃ¶sung betrÃ¤gt 720 x 576. Nach dem Hochladen des Videos auf YouTube hat sich die QualitÃ¤t merklich geÃ¤ndert.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/H4agAlZlWW8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie die Kamera einschalten, werden zunÃ¤chst die Schrittmotoren des Zooms initialisiert und auf den Hintergrund des Videobilds fokussiert. Dieses Bild ist schwarzweiÃŸ und ohne AGC, da das Initialisierungsverfahren fÃ¼r den Videoprozessor noch nicht abgeschlossen ist. Unten links zeigen das aktuelle Datum und die aktuelle Uhrzeit das Datum und die Uhrzeit der Kompilierung der aktuellen Kamera-Firmware an. Im Firmware-Quellcode habe ich die entsprechenden Variablen erstellt, die sich an festen Adressen im HEX-Code befinden. Es wird davon ausgegangen, dass in der Kompilierungsphase, genauer danach, automatisch ein Programm ausgefÃ¼hrt wird, das die Werte der Variablen aus der Systemzeit entnimmt und an den gewÃ¼nschten Adressen in die HEX-Datei einfÃ¼gt. DarÃ¼ber hinaus mÃ¼ssen die PrÃ¼fsummen noch nachgezÃ¤hlt werden. Vielleicht gibt es einen einfacheren Weg. Im Beispiel im Video sind diese Variablen gleich Null, da ich diese Funktion noch nicht implementiert habe.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Initialisierung der SD wird der Videoprozessor initialisiert und sofort eine BegrÃ¼ÃŸung auf dem Hintergrund des Videobildes angezeigt. Beim Anpassen von Zoom und Fokus werden deren Koordinaten unten rechts angezeigt. Im Video zeige ich die Verwendung der Funktion zum Speichern und Abrufen von Vorlagen (Voreinstellungen) fÃ¼r Zoom und Fokus in verschiedenen Teilen des Bildes. Beim LÃ¶schen einer Voreinstellung erhalten die entsprechenden Variablen den Wert 0xFFFF, der einem Wert von -1 entspricht. Diese Funktion ist grundsÃ¤tzlich Ã¼berflÃ¼ssig, sie kann ausgeschlossen werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im letzten Abschnitt des MenÃ¼s, der zum Debuggen verwendet wird, zeige ich den Datensatz von Byte 3 der Kategorie 9. Die diesem Byte entsprechenden Funktionen befinden sich im vorherigen Abschnitt des MenÃ¼s, Ã¼ber den ich viele Male geschrieben habe. Aufgrund der Tatsache, dass der aktuelle Status des Bytes nicht vom Videoprozessor gelesen wird, habe ich ihn manuell auf â€48â€œ als einen der akzeptablen Werte gesetzt. Danach Ã¤ndere ich die einzelnen Bits dieses Bytes und zeige dabei die Funktionen "Mirror" und "Inverse Burst". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den Burst-Pegel im vorletzten Abschnitt des MenÃ¼s anpassen, werden Sie einen kleinen Firmware-Fehler bemerken, der leicht zu beheben ist. Von den anderen MÃ¤ngeln - manchmal treten beim Aktualisieren der Zeit LÃ¼cken in den Zeichen auf. Ich denke, das liegt an der â€krummenâ€œ Installation der Elektronik im Camcorder.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen wurden beim Bedienen der Kamera geringfÃ¼gige Unannehmlichkeiten im Zusammenhang mit der MenÃ¼navigation festgestellt. </font><font style="vertical-align: inherit;">Daher ist es durchaus mÃ¶glich, dass die erforderliche Ãœberarbeitung im Laufe der Zeit vorgenommen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, ich hÃ¤tte es fast vergessen. </font><font style="vertical-align: inherit;">Wie versprochen bringe ich zwei Fotos mit, wie sich die FÃ¼llung des Camcorders nach der Entwicklung entwickelt hat. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/0-/ah/m-0-ahq2z2xqxpr988ndcfae5uu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">15. Eine aktualisierte Ansicht des Camcorders unten. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/gs/8_/bw/gs8_bwxf2yy1mqyrt2gmbgzoyu8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">16. Eine aktualisierte Ansicht des Camcorders oben.</font></font></i><br>
<br></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499534/index.html">Entwicklungshandbuch fÃ¼r Python-Backend-Dienste</a></li>
<li><a href="../de499536/index.html">Growbox als Methode, sich selbst zu kennen</a></li>
<li><a href="../de499540/index.html">So funktioniert das Rendern von 3D-Spielen: Texturierung und Texturfilterung</a></li>
<li><a href="../de499542/index.html">Top Fakapov Cyan</a></li>
<li><a href="../de499544/index.html">Lernen Sie neuronale Netze in Google Sheets</a></li>
<li><a href="../de499548/index.html">Maske - FÃ¼rsorge fÃ¼r andere oder eine Illusion von Sicherheit?</a></li>
<li><a href="../de499550/index.html">Low-Code-LÃ¶sungen fÃ¼r Ã–kosysteme</a></li>
<li><a href="../de499556/index.html">Game Server auf MS Orleans - Teil 3: Zusammenfassung</a></li>
<li><a href="../de499560/index.html">Xswitcher Layout Corrector fÃ¼r Linux: Schritt zwei</a></li>
<li><a href="../de499562/index.html">Erfolgloser Artikel Ã¼ber die Beschleunigung der Reflexion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>