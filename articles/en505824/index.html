<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê® üå∏ üö¥üèª Guide: Your Own L2TP VPN ‚ò£Ô∏è ‚ÑπÔ∏è ‚ùé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having rummaged around the Internet in search of software for building your own VPN, you constantly stumble upon a bunch of guides related to OpenVPN,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guide: Your Own L2TP VPN</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/505824/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Having rummaged around the Internet in search of software for building your own VPN, you constantly stumble upon a bunch of guides related to OpenVPN, which is inconvenient to configure and use, which requires the Wireguard proprietary client, only one SoftEther from all this circus has an adequate implementation. </font><font style="vertical-align: inherit;">But we will tell, so to speak, about the native VPN implementation for Windows - Routing And Remote Access (RRAS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For a strange reason, no one in one guide wrote about how to deploy all this and how to enable NAT on it, so now we will fix it and tell you how to make your own VPN on Windows Server. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, a ready-made and pre-configured VPN can be ordered from our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marketplace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , by the way it works out of the box.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/qd/_q/-e/qd_q-ewnh9imcvaaujksgzzhfyq.jpeg"></div></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Install services</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, we need the Windows Server Desktop Experience. </font><font style="vertical-align: inherit;">Installing Core will not work for us, because there is no NPA component. </font><font style="vertical-align: inherit;">If the computer is a member of a domain, you can stop at Server Core, in which case the whole thing can be put in gigabytes of RAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to install RRAS and NPA (Network Policy Server). </font><font style="vertical-align: inherit;">We need the first one to create a tunnel, and the second one is needed if the server is not a member of the domain. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/vc/cg/hwvccgfuaaiklixrhtsf-3jc_g0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the selection of RRAS components, select Direct access and VPN and Routing.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bm/pr/ly/bmprly1klryjjgc6cr5bcd3w_9k.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Configure RRAS</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we installed all the components and rebooted the machine, we need to start the configuration. As in the picture, at start-up, we find the RRAS manager. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i6/rj/ry/i6rjryud0us53ivjbdknjmt43vq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Through this snap-in we can manage servers with RRAS installed. Right-click, select the setting and go. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/_o/5d/ss_o5de0katdbw7tyrp81pzv7vu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having skipped the first page, we go to the choice of configuration, select your own. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/gb/ku/ncgbkuset2thtgb-lrxiqyxvyvu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the next page, we are invited to select the components, select VPN and NAT. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q0/ol/uj/q0oluj1q4hgl-jfvhgc7ngt081o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further, further. Done. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now you need to enable ipsec and assign the address pool that our NAT will use. Right-click on the server and go to the properties. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6_/19/f-/6_19f-vs-vmjtv8h_epxtdchpam.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, enter your password for l2TP ipsec.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ds/jd/ln/dsjdlntmm_eoy6eymyuqfg29hqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the IPv4 tab, it is necessary to set the range of ip addresses issued to clients. </font><font style="vertical-align: inherit;">Without this, NAT will not work. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/oa/td/hhoatdwghrbykefsev7ioqg-2-w.png"><br>
<br>
<img src="https://habrastorage.org/webt/th/ol/dc/tholdcsuhekfwb00_pzqlexwnco.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now it remains to add the interface for NAT. </font><font style="vertical-align: inherit;">Go to the IPv4 sub-item, right-click on an empty space and add a new interface. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/rg/mq/v9rgmqsrvnlkxbpbwgupalc54si.png"><br>
<br>
<img src="https://habrastorage.org/webt/an/mc/b-/anmcb-lels67_oetwjsqvu2tpks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the interface (one that is not Internal), enable NAT.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/s-/mb/hhs-mbbbqocw0mvvdjydjddr1xy.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Allow rules in the firewall</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is simple here. </font><font style="vertical-align: inherit;">You need to find the Routing and Remote Access rule group and enable them all.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bo/qk/hd/boqkhd0qpat-thjtkpxrzy2xaok.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Configure NPS</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are looking at the launch of Network Policy Server. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kh/ta/o1/khtao1xs4n-xinhylbwpq8rmb8k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the tabs where all the policies are listed, you need to enable both standard ones. </font><font style="vertical-align: inherit;">This will allow all local users to connect to the VPN.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/e5/un/f7e5und8rmofp9npiq8iqszwfrw.png"><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Connect via VPN</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For demonstration purposes, choose Windows 10. In the start menu, look for VPN. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u6/ly/ge/u6lygemk7e49hku8vb8xpeate8w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Click on the add connection button and go to the settings. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nh/-u/_f/nh-u_f5xvirnp8fx_0eulynloqo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Specify the name of the connection you want. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IP address is the address of your VPN server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VPN type - l2TP with a preliminary key. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The shared key is vpn (for our image in the marketplace.) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And the username and password is the username and password from the local user, that is, from the administrator. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/at/kh/spatkhujdiiuivv9imaqxjjdtc0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Click on the connection and you're done. </font><font style="vertical-align: inherit;">So your own VPN is ready. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g4/ic/ws/g4icwstdvv5o_ge-3nlb5soxang.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We hope that our guide will give another option to those who want to make their own VPN without contacting Linux or just want to add a gateway to their AD.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/gu/ab/cg/guabcgmwuqoopx1ar80sjpz6keq.png"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/de/0y/l-/de0yl-6ppopvisr_a80b4yuhjj8.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505796/index.html">CO2, Sp02 and COVID-19: why you need to ventilate more often (few measurements)</a></li>
<li><a href="../en505798/index.html">PHP 25 years: a brief history of the language and a 50% discount on PhpStorm</a></li>
<li><a href="../en505802/index.html">Hosting and dedicated servers: answer questions. Part 4</a></li>
<li><a href="../en505812/index.html">4 engineers, 7000 servers and one global pandemic</a></li>
<li><a href="../en505814/index.html">Radarr, Jackett and the bot in the cart. Download torrents in a new way</a></li>
<li><a href="../en505826/index.html">How to get 100% vision and even more</a></li>
<li><a href="../en505834/index.html">Median Samples. Confidence Intervals and Comparison</a></li>
<li><a href="../en505838/index.html">FPGA technology for thousands of applications</a></li>
<li><a href="../en505846/index.html">What are the real math problems when developing vaccines from COVID-19?</a></li>
<li><a href="../en505850/index.html">C ++ Concept-Based Polymorphism in Product Code: PassManager in LLVM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>