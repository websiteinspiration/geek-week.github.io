<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ŒğŸ¾ âš’ï¸ ğŸŒ‚ ãƒ¡ãƒ¢ãƒªç®¡ç†ã¾ãŸã¯ã‚ã¾ã‚Šé »ç¹ã«è¶³ã‚’æ’ƒãŸãªã„ ğŸ¤›ğŸ» ğŸ‘©ğŸ¿â€âœˆï¸ ğŸ–ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®è¦³ç‚¹ã‹ã‚‰ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ /ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ¢ãƒªç®¡ç†ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã“ã‚Œã¯å®Œå…¨ãªã‚¬ã‚¤ãƒ‰ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ãªãã€å˜ã«æ—¢å­˜ã®å•é¡Œã®æ¦‚è¦ã¨ãã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚
 

ãªãœã“ã‚ŒãŒå¿…è¦ãªã®ã§ã™ã‹ï¼Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¸€é€£ã®ãƒ‡ãƒ¼...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ãƒ¡ãƒ¢ãƒªç®¡ç†ã¾ãŸã¯ã‚ã¾ã‚Šé »ç¹ã«è¶³ã‚’æ’ƒãŸãªã„</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473294/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®è¦³ç‚¹ã‹ã‚‰ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ /ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ¢ãƒªç®¡ç†ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã¯å®Œå…¨ãªã‚¬ã‚¤ãƒ‰ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ãªãã€å˜ã«æ—¢å­˜ã®å•é¡Œã®æ¦‚è¦ã¨ãã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªãœã“ã‚ŒãŒå¿…è¦ãªã®ã§ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¸€é€£ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†å‘½ä»¤ã§ã™ï¼ˆæœ€ã‚‚ä¸€èˆ¬çš„ãªå ´åˆï¼‰ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯</font><font style="vertical-align: inherit;">ã€</font><font style="vertical-align: inherit;">ä½•ã‚‰ã‹ã®æ–¹æ³•</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ä¿å­˜</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ­ãƒ¼ãƒ‰</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è»¢é€</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªã©</font><font style="vertical-align: inherit;">ã™ã‚‹å¿…è¦ãŒã‚ã‚Š</font><strong><font style="vertical-align: inherit;">ã¾ã™</font></strong><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã®æ“ä½œã¯ã™ã¹ã¦å³åº§ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ãŸã‚ã€æœ€çµ‚çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é€Ÿåº¦ã«ç›´æ¥å½±éŸ¿ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä½œæ¥­ã®éç¨‹ã§ãƒ‡ãƒ¼ã‚¿ã‚’æœ€é©ã«ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã«ã‚ˆã‚Šã€éå¸¸ã«ç°¡å˜ã§éå¸¸ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’å¿…è¦ã¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã§ãã¾ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨ï¼šè³‡æ–™ã®å¤§éƒ¨åˆ†ã¯ã‚²ãƒ¼ãƒ /ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰ã®ä¾‹ã§ç¤ºã•ã‚Œã¦ã„ã¾ã™ï¼ˆã“ã®ãƒˆãƒ”ãƒƒã‚¯ã¯ç§ã«ã¨ã£ã¦å€‹äººçš„ã«èˆˆå‘³æ·±ã„ã®ã§ï¼‰ãŒã€è³‡æ–™ã®ã»ã¨ã‚“ã©ã¯ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã©ã«é©ç”¨ã§ãã¾ã™ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/f13/ef3/482/f13ef3482dfe066b41b53e44179a0242.jpg"></p><br>
<p><em>    .     ,   </em></p><a name="habracut"></a><br>
<h1 id="s-mesta-v-karer">   </h1><br>
<p>   ,         ,    C++.           . Java/C#  ..     (GarbageCollection/GC) â€”           .      ,      :        soft-real time      .</p><br>
<p>,    "Minecraft"  GC    , ..        ,   ,  "Red Dead Redemption 2", "God of War", "Last of Us",  " "              ,      .</p><br>
<p> ,          ,         .  ,  Java          ,            ,         . ,           (      AI,  , ,  ..)      .</p><br>
<h1 id="kak-vyglyadyat-allokacii-v-kode">    </h1><br>
<p>   ,    ,        C/C++   .   ,            :</p><br>
<pre><code class="plaintext hljs">//        size <font></font>
void* malloc(size_t size); <font></font>
<font></font>
//      p<font></font>
void free(void* p); </code></pre><br>
<p>     ,      :</p><br>
<pre><code class="plaintext hljs">// C11  -     , * alignment<font></font>
void* aligned_alloc(size_t size, size_t alignment);<font></font>
<font></font>
// Posix  -      <font></font>
//        address (*address = allocated_mem_p)<font></font>
int posix_memalign(void** address, size_t alignment, size_t size);</code></pre><br>
<p>   ,         , ,   macOS,    win.</p><br>
<p> ,  <strong> </strong>          - ,          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SSE</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">MMX</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AVX</a>,  .).</p><br>
<p> "" ,       ,       :</p><br>
<pre><code class="plaintext hljs">/* main.cpp */<font></font>
#include &lt;cstdio&gt;<font></font>
#include &lt;cstdlib&gt;<font></font>
<font></font>
int main(int argc, char** argv) {<font></font>
   const int N = 10;<font></font>
   int* buffer = (int*) malloc(sizeof(int) * N);<font></font>
   for(int i = 0; i &lt; N; i++) {<font></font>
      printf("%i ", buffer[i]);<font></font>
   }<font></font>
   free(buffer);<font></font>
   return 0;<font></font>
}</code></pre><br>
<p> macOS 10.14         :</p><br>
<pre><code class="plaintext hljs">$ clang++ main.cpp -o main<font></font>
$ ./main</code></pre><br>
<p>:           C++  new/delete,       /  ,            malloc/free.</p><br>
<h1 id="problemy-s-pamyatyu">  </h1><br>
<p>  ,      .  ,   ,       ,    ,      . </p><br>
<h3 id="1-kolichestvo-pamyati">1.  </h3><br>
<p> ,   .  PlayStation 4  8 GiB GDDR5, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">3.5 GiB        </a>.        ,   swapping    â€”    (   N   ,    ).</p><br>
<p>     "<em></em>" â€”       ,        .            ,    ,            .         ,          ,   , , . </p><br>
<h3 id="2-fragmentaciya">2. </h3><br>
<p> ,          .           .          ,     ,       . </p><br>
<p><img src="https://habrastorage.org/webt/8f/un/ie/8funiekbmroqz6xqhdpsyrpovcs.png"><br>
        </p><br>
<p> :       ,   .   , , "    "    , .       .</p><br>
<h3 id="3-kesh-processora">3.  </h3><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/e9d/592/5e5/e9d5925e5a0fc9629656ead20ce91b36.png"><br>
  </p><br>
<p>   â€”    ,     ()    .  ,      / â€”     (   -  CPU,   ).      (L1, L2, L3,  ),     "  "    ,        . </p><br>
<p>       ""     (   ),       ,    .   ""     .       Unity   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  GDC</a>. </p><br>
<h3 id="4-multi-threading">4. Multi-Threading</h3><br>
<p><strong>        </strong>     ,         //  ,        .      .       ,    .         ,             (          ).    ,     :<br>
<img src="https://habrastorage.org/webt/sl/dm/2y/sldm2ybotnk9ncozwf5rkgozifw.png"><br>
       ,                .</p><br>
<h3 id="5-mallocfree">5. Malloc/free</h3><br>
<p>  /   .   ,     Windows/Linux/MacOS      <em>   </em>.      .  ,     ,                (First Fit, Best fit,  .)      /   . </p><br>
<p> , -           ,         .</p><br>
<p>  ,    ? Malloc/new     ,   ,       .    (  )  1 KiB  100 MiB â€¦  .        ,  ,      .</p><br>
<h3 id="6-memory-corruption">6. Memory corruption</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>,      ,      ,          .       ?   ( ),       .    ,      ,   <em> </em>.  : </p><br>
<ol>
<li>    /     </li>
<li>    ,  .        (1),    ,      ,       ,        . . ,     , .    ,         .             ,     .</li>
<li>   ( )      </li>
<li> ..</li>
</ol><br>
<p> /++,    ,      -.   Java Runtime   ,      (  ,  ,   ,      ).</p><br>
<h3 id="7-utechki-pamyati">7.  </h3><br>
<p>     ,     .   C/C++     .    , ,   ..        <br>
    .        â€”          "out of memory" ,          .            .</p><br>
<p>           GPU, .              .       ,     â€”        .</p><br>
<h3 id="8-dangling-pointer">8. Dangling pointer</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><strong> </strong></a> â€”  ,  ,      .         C-style   C/C++ . ,   ,       p,     (.  ):</p><br>
<pre><code class="plaintext hljs">//  <font></font>
void* p = malloc(size);<font></font>
// ...  -   <font></font>
//  <font></font>
free(p);<font></font>
//    p?<font></font>
// *p == ? </code></pre><br>
<p>   ,        .  ,     ,      ,  .  ,      ,   .   C++11         "smart pointers",                -   (  ).</p><br>
<p>     <em> </em> ,      ,      .  C       NULL,   C++    nullptr.   ,  : </p><br>
<ol>
<li>    ,       . </li>
<li>nullptr   0x0    ,  ,    ,         .   legacy,         ,     0x0.</li>
</ol><br>
<p>   null:</p><br>
<pre><code class="plaintext hljs">//  -  p<font></font>
free(p);<font></font>
p = nullptr;<font></font>
//   p == nullptr   ,       </code></pre><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">void _free(void* &amp;p) {<font></font>
   free(p);<font></font>
   p = nullptr;<font></font>
}<font></font>
<font></font>
//  -  p<font></font>
_free(p);<font></font>
//   p == nullptr,     <font></font>
//   </code></pre><br>
<h3 id="9-tip-pamyati">9.  </h3><br>
<p><strong>RAM</strong> â€”     ,              .   ,       N ,  N  1,2,4,8,16  .  malloc/free          RAM .</p><br>
<p><strong>VRAM</strong> (video memory) â€”  ,    /-  . ,  ,    RAM ( 1,2,4 GiB),    .       ,          . </p><br>
<p> PlayStation 4   ,       8   GDDR5.   ,   ,    -  .</p><br>
<p>              Main RAM,     VRAM.     <strong></strong>,           ,   <strong> </strong>   RAM  VRAM  .</p><br>
<p><strong>      </strong>:          PlayStation 4 (.).    , 8 ,   L1  L2,  ,  ,    ..            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"Game Engine Architecture"</a>. </p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/c50/7ba/756/c507ba75624a3c9be702f85ddfa50e11.png"><br>
 PlayStation 4</p><br>
<h1 id="obschie-podhody-k-resheniyu">   </h1><br>
<p>  .     ,     ,            .     ,   ,   ,  /,    .</p><br>
<h2 id="tipy-allokatorov"> </h2><br>
<p>       :  ,  ,            . ,     , -     / .     /   .    (  )   :</p><br>
<ol>
<li><p><strong>Linear allocator</strong><br>
    .          (,     ).         1 . .        â€”      <em></em>   ,        .        O(1),       .<br>
<img src="https://habrastorage.org/webt/eb/tp/vm/ebtpvmrs616uwpgdfpd1nujw69s.png"><br>
 use-case:      (   )    LinearAllocator   tmp   -  :  ,   ,   ConsoleManager     ..</p><br>
</li>
<li><p><strong>Stack allocator</strong><br>
  .     ,   ,  ,        LIFO.          ( ),     ,   ,       .<br>
<img src="https://habrastorage.org/webt/hu/7j/fm/hu7jfm6iqhxz0uk5xwo_ayzwyfo.png"><br>
   O(1)     .</p><br>
</li>
<li><p><strong>Pool allocator</strong><br>
     .        ,      .      .    ,      .        ,        (sizeof(void*)).     .<br>
<img src="https://habrastorage.org/webt/cv/sl/qz/cvslqzmqj1nsp-gtqccoyx6hwy4.png"><br>
     ,   ,   ,      /     O(1). </p><br>
</li>
<li><p><strong>Frame allocator</strong><br>
         â€”   tmp          .    ,           runtime ,        ,    MiB,          .</p><br>
</li>
<li><p><strong>Double frame allocator</strong><br>
   frame allocator,    .       ,      ,     . . ,      N,     N+1 .     frame      .<br>
<img src="https://habrastorage.org/webt/ug/cc/zh/ugcczhvv6ibzbarvb0plwhvgbuu.png"><br>
             ,     .        ,        ,           .</p><br>
</li>
<li><p><strong>Static allocator</strong><br>
      , , ,    ,       .        : linear, pool, stack.    <em></em>?        <strong>  </strong> .    :           .   ?         (   ,     ).    ,    ,      .<br>
       ,         -   :<br>
<img src="https://habrastorage.org/webt/3s/xk/t5/3sxkt5_00ztji1gesnh0cd1edno.png"><br>
  ,         , ..            .</p><br>
</li>
</ol><br>
<p>         ,   ,        ,        .</p><br>
<p>   ,            <em></em> , , : pool    frame alloc,  frame alloc       linear alloc.      ,      . </p><br>
<p><img src="https://habrastorage.org/webt/rf/l8/4a/rfl84aakccaw2qfdw6hxlqiygos.png"></p><br>
<p>        :</p><br>
<pre><code class="plaintext hljs">class IAllocator {<font></font>
public:<font></font>
   virtual void* alloc(size_t size) = 0;<font></font>
   virtual void* alloc(size_t size, size_t alignment) = 0;<font></font>
   virtual void  free (void* &amp;p) = 0;<font></font>
}</code></pre><br>
<p>         malloc/free ,     .  ,        ,            .           /    ,       .</p><br>
<h2 id="umnye-ukazateli"> </h2><br>
<p>Smart pointer â€”        C++   ++11 (   boost,    ).   -,     ,        -  ,        .                .</p><br>
<p>      ?     :</p><br>
<ol>
<li>     </li>
<li>  (/)</li>
<li>  </li>
</ol><br>
<p>        :</p><br>
<ol>
<li><p><strong>Unique pointer</strong><br>
     1    ( ).<br>
  unique pointer ,          .        , ..    1   / .<br>
       uniquePtr1  uniquePtr2,    uniquePtr1 , .   1  .<br>
<img src="https://habrastorage.org/webt/xl/qd/x2/xlqdx2thnzcg7rvvv0va70zpzl4.png"></p><br>
</li>
<li><p><strong>Shared pointer</strong><br>
       (reference counting).       ,    ,      .    , ,      ,    .<br>
<img src="https://habrastorage.org/webt/jb/y6/wi/jby6wipfn5sv2ghabpuzzresgsk.png"><br>
      . -,       ,      .        . -,  -                . </p><br>
</li>
<li><p><strong>Weak pointer</strong><br>
   .       ,    .   ?           shared pointer.   ,   shared pointer  ,     . ,     shared pointer weak pointer.  ,   (shared)    ,   weak pointer    shared pointer.    â€”  weak pointer ,     ,  ,       .<br>
<img src="https://habrastorage.org/webt/nr/bt/bq/nrbtbqg6rukrcdgmij-v08bpim4.png"><br>
  shared,   weak pointer     meta-data   .    -   ,     ..   ,  O(N) overhead  ,  N â€” -  .      , .               ,        .         .</p><br>
</li>
</ol><br>
<p>    :         . ,  shared pointer,     ,    (      )  <em>- - -</em> .           .            meta-info   ,  ,           . : </p><br>
<pre><code class="plaintext hljs">/*     */<font></font>
/*   ,  shared pointer */<font></font>
Array&lt;TSharedPtr&lt;Object&gt;&gt; objects;<font></font>
objects.add(newShared&lt;Object&gt;(...));<font></font>
...<font></font>
objects.add(newShared&lt;Object&gt;(...));</code></pre><br>
<pre><code class="plaintext hljs">/*      (   meta-info    ) */<font></font>
Array&lt;Object&gt; objects;<font></font>
objects.emplace(...);<font></font>
...<font></font>
objects.emplace(...);</code></pre><br>
<p>  .            .   .</p><br>
<h2 id="unique-id">Unique id</h2><br>
<p>     ,    .     (id/identificator),   , ,   -.    :</p><br>
<ol>
<li><strong> </strong><br>
    ,   id.    ,   <strong>  </strong>,  ,          id.</li>
<li><strong>  </strong><br>
     ,          (  ,     )</li>
<li><strong>    </strong><br>
   id  ,      ,        id.</li>
<li><strong>    </strong><br>
                . ,   id,     .</li>
</ol><br>
<p>    :    id,   ,      id,         .</p><br>
<p> id     ,  (Vulkan, OpenGL),   (Godot, CryEngine).  EntityID   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     CryEngine</a>.</p><br>
<p>  ,  id   :   .     ,     (   ),     ,      .</p><br>
<pre><code class="plaintext hljs">/*    */<font></font>
class ID {<font></font>
   uint32 index;<font></font>
   uint32 generation;<font></font>
}</code></pre><br>
<pre><code class="plaintext hljs">/*  - /   */<font></font>
class ObjectManager {<font></font>
public:<font></font>
   ID create(...);<font></font>
   void destroy(ID);<font></font>
   void update(ID id, ...);<font></font>
private:<font></font>
   Array&lt;uint32&gt; generations;<font></font>
   Array&lt;Objects&gt; objects;<font></font>
}</code></pre><br>
<p>  ID        ,     ID .     :</p><br>
<pre><code class="plaintext hljs">generation = generations[id.index];<font></font>
if (generation == id.generation) <font></font>
   then /*    */<font></font>
   else /*  ,     */</code></pre><br>
<p>     id      generation  1   id   ids.</p><br>
<h2 id="konteynery"></h2><br>
<p>    C++   ,         .      std,     <strong></strong>   ,   <strong></strong>    .        :</p><br>
<ul>
<li>Linked list â€”  </li>
<li>Array â€” / </li>
<li>Queue â€” </li>
<li>Stack â€” </li>
<li>Map â€”  </li>
<li>Set â€” </li>
</ul><br>
<p>        ?             memory corruption.        / ,    ,   ,    ,     .</p><br>
<h1 id="obschie-idei"> </h1><br>
<p>          ,     ,       .  , ,    /         .</p><br>
<h2 id="pod-konkretnye-zadachi">  </h2><br>
<p>  ,      ,       .              ,   (  )   .    ,   malloc/free  ,       ,            .</p><br>
<p>    ?   ,     (/ ),     ,     ,   .    ,     ,    ,           . </p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/554/778/95b/55477895bb7e2fcf71d44ad06ceb8ce3.jpg"><br>
ryEngine Sandbox:      </p><br>
<p>  ,   Unreal, Unity, CryEngine  .,     ,    . ,       , ,     â€”       ,                 . </p><br>
<h2 id="pre-allocating">Pre-allocating</h2><br>
<p>       ,      /          . </p><br>
<p>   :   malloc/free      .     ,      "run out of memory", .        .         ,       (,   ,     .).</p><br>
<p>      .          .  ,         -  .           ,           malloc/free,    : ,  ,  .</p><br>
<h2 id="ne-nado-boyatsya-dinamicheskoy-pamyati">    </h2><br>
<p>           .   :     ,       , ,   ..             . </p><br>
<p>   :   ,      ,       ,    .  open-source ,      ,     .   ,  ,   â€”     malloc/free. </p><br>
<h2 id="dizayn-iz-ogranicheniy">  </h2><br>
<p> GDC  CD Project Red <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>,     ,       "The Witcher: Blood and Wine"    ()        .     ,     ,    ,         ,         .<br>
<img src="https://habrastorage.org/getpro/habr/post_images/80b/c6c/fb0/80bc6cfb08009ba02caee322cb092110.png"></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>    Naughty Dog  ,      "Uncharted 4: A Thief's End"     ,         (,    )       .<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7c4/2c8/469/7c42c84690c9374423bba12dea6126ff.jpg"></p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>    ,    ,     ,          .       ,         .     / ,     ,   -   ..       ,        (,    ).</p><br>
<h1 id="literatura-i-poleznye-ssylki">   </h1><br>
<ul>
<li>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"Game Engine Architecture"</a>.           ,  , , ,   ..  ,    ,      .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Custom memory allocators</a> â€”        ,     C++  .     ,         .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Smart pointers</a> â€”     ,      .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Start Pre-allocating And Stop Worrying</a> â€”       </li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473284/index.html">ã‚·ãƒ‹ã‚¢ã€ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ-æ¬¡ã¯ä½•ã§ã™ã‹ï¼Ÿä½œæ¥­ãƒ«ãƒ¼ãƒãƒ³ã«å¯¾å‡¦ã™ã‚‹æ–¹æ³•ã¨æ¬¡ã«é€²ã‚€ã«ã¯ï¼Ÿ</a></li>
<li><a href="../ja473286/index.html">XDPã«å¯¾ã™ã‚‹DDoSæ”»æ’ƒã«å¯¾ã™ã‚‹ä¿è­·ã‚’è¨˜è¿°ã—ã¾ã™ã€‚æ ¸éƒ¨åˆ†</a></li>
<li><a href="../ja473288/index.html">ã‚³ãƒ¼ãƒ‰ã‚’æœ€åˆã‹ã‚‰æ§‹ç¯‰ã—ã¾ã™ã€‚ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ã¾ã™</a></li>
<li><a href="../ja473290/index.html">ã‚¸ãƒ¥ãƒªã‚¢ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã©ã“ã‹ã‚‰å§‹ã‚ã¾ã™ã‹ï¼Ÿ...</a></li>
<li><a href="../ja473292/index.html">ãƒ¢ãƒã‚¤ãƒ«ï¼ƒ319é–‹ç™ºè€…å‘ã‘ã®èˆˆå‘³æ·±ã„è³‡æ–™ã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆ10æœˆ21ã€œ27æ—¥ï¼‰</a></li>
<li><a href="../ja473296/index.html">ãŠé‡‘ã®ãªã„ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã€‚å€‹äººçš„ä½“é¨“</a></li>
<li><a href="../ja473298/index.html">ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ§‹ç¯‰ã—ã€ãƒãƒ¼ãƒ ã®ãƒ¢ãƒƒã‚¯ã‚’åœæ­¢ã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja473300/index.html">ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚ä»£ã®PRã€æœ€æ–°ã®ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ†ã‚£ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°</a></li>
<li><a href="../ja473302/index.html">ã•ã‚ˆã†ãªã‚‰HTMLã€ã“ã‚“ã«ã¡ã¯QML</a></li>
<li><a href="../ja473306/index.html">æ‹¡å¼µç¾å®Ÿãƒ¡ã‚¬ãƒã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€‚å¯èƒ½ãªå®Œç’§ãªARãƒ˜ãƒƒãƒ‰ã‚»ãƒƒãƒˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>