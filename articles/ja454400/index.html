<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¾ â†ªï¸ â˜ªï¸ RãŠã‚ˆã³PowerShellã‚’ä½¿ç”¨ã—ãŸä»®æƒ³ãƒã‚·ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ ğŸ‘¨ğŸ¿â€ğŸŒ¾ ğŸ“’ ğŸ•‹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰æ›¸ã
 

ã“ã‚“ã«ã¡ã¯ã€‚åŠå¹´ã®é–“ã€ç§ãŸã¡ã¯ä»®æƒ³ãƒã‚·ãƒ³ã®çŠ¶æ…‹ã«é–¢ã™ã‚‹ï¼ˆãã—ã¦ãã‚Œã ã‘ã§ã¯ãªã„ï¼‰ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚ˆã‚Šæ­£ç¢ºã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚»ãƒƒãƒˆï¼‰ã‚’å®Ÿè¡Œã—ã¦ãã¾ã—ãŸã€‚ä½œæˆä½“é¨“ã¨ã‚³ãƒ¼ãƒ‰è‡ªä½“ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ç§ã¯ã“ã®è³‡æ–™ãŒèª°ã‹ã«å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œãªã„ã¨ã„ã†æ‰¹åˆ¤ã¨äº‹å®Ÿã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>RãŠã‚ˆã³PowerShellã‚’ä½¿ç”¨ã—ãŸä»®æƒ³ãƒã‚·ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454400/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/px/tu/kg/pxtukg8q2rhe_wcyxiwdbfa9euq.jpeg"></div><br>
<h4 id="vstuplenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰æ›¸ã</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã‚“ã«ã¡ã¯ã€‚</font><font style="vertical-align: inherit;">åŠå¹´ã®é–“ã€ç§ãŸã¡ã¯ä»®æƒ³ãƒã‚·ãƒ³ã®çŠ¶æ…‹ã«é–¢ã™ã‚‹ï¼ˆãã—ã¦ãã‚Œã ã‘ã§ã¯ãªã„ï¼‰ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚ˆã‚Šæ­£ç¢ºã«ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚»ãƒƒãƒˆï¼‰ã‚’å®Ÿè¡Œã—ã¦ãã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ä½œæˆä½“é¨“ã¨ã‚³ãƒ¼ãƒ‰è‡ªä½“ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ã¯ã“ã®è³‡æ–™ãŒèª°ã‹ã«å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œãªã„ã¨ã„ã†æ‰¹åˆ¤ã¨äº‹å®Ÿã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚</font></font></p><a name="habracut"></a><br>
<h4 id="formirovanie-potrebnosti"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½¢æˆãŒå¿…è¦</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤šæ•°ã®ä»®æƒ³ãƒã‚·ãƒ³ãŒã‚ã‚Šã¾ã™ï¼ˆ3ç•ªç›®ã®vCenterã«åˆ†æ•£ã•ã‚ŒãŸç´„1,500ã®VMï¼‰ã€‚æ–°ã—ã„ã‚‚ã®ãŒä½œæˆã•ã‚Œã€å¤ã„ã‚‚ã®ã¯ã‹ãªã‚Šé »ç¹ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚é †åºã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€vCenterã«ã„ãã¤ã‹ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚Œã€VMã‚’ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã«åˆ†å‰²ã—ã€ãã‚Œã‚‰ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã€ãŠã‚ˆã³èª°ãŒã„ã¤è¡Œã£ãŸã‹ã‚’ç¤ºã—ã¾ã™ã€‚äººçš„è¦å› ã«ã‚ˆã‚Šã€è»Šã®åŠåˆ†ä»¥ä¸Šã«ç©ºç™½ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ®‹ã•ã‚Œã€ä½œæ¥­ãŒè¤‡é›‘ã«ãªã£ãŸã¨ã„ã†äº‹å®Ÿã«ã¤ãªãŒã‚Šã¾ã—ãŸã€‚ 6ã‹æœˆã«1åº¦ã€èª°ã‹ãŒã³ã£ãã‚Šã—ã¦ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã«å–ã‚Šæ›ã‹ã‚Šå§‹ã‚ã¾ã—ãŸãŒã€çµæœã¯1é€±é–“åŠã»ã©é–¢é€£æ€§ãŒãªããªã‚Šã¾ã—ãŸã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ©Ÿæ¢°ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã€ãã‚Œã‚‰ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚»ã‚¹ãªã©ãŒã‚ã‚‹ã“ã¨ã‚’èª°ã‚‚ãŒç†è§£ã—ã¦ã„ã‚‹ã“ã¨ã‚’ã™ãã«æ˜ç¢ºã«ã—ã¾ã™ã€‚ç­‰ãã—ã¦ã€ã“ã®ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå³æ ¼ã«é †å®ˆã•ã‚Œã¦ã„ã¾ã™ãŒã€‚æ®‹å¿µãªãŒã‚‰ã€ã“ã‚Œã¯ç§ãŸã¡ã«ã¯å½“ã¦ã¯ã¾ã‚Šã¾ã›ã‚“ãŒã€ã“ã‚Œã¯è¨˜äº‹ã®ä¸»é¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“:)</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€èˆ¬ã«ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¸ã®å…¥åŠ›ã®æ­£ã—ã•ã®æ¤œè¨¼ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã“ã¨ãŒæ±ºå®šã•ã‚Œã¾ã—ãŸã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŸã¡ã¯ã€è²¬ä»»ã®ã‚ã‚‹ã™ã¹ã¦ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ãã®ä¸Šå¸ã®ãŸã‚ã«ã€èª¤ã£ã¦å…¥åŠ›ã•ã‚ŒãŸãƒã‚·ãƒ³ã®ãƒªã‚¹ãƒˆãŒè¨˜è¼‰ã•ã‚ŒãŸæ¯æ—¥ã®æ‰‹ç´™ãŒè‰¯ã„ã‚¹ã‚¿ãƒ¼ãƒˆã«ãªã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®æ™‚ç‚¹ã§ã€åŒåƒšã®1äººãŒæ—¢ã«PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€æ¯æ—¥ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¾“ã£ã¦ã™ã¹ã¦ã®vCenter-sã®ã™ã¹ã¦ã®ãƒã‚·ãƒ³ã®æƒ…å ±ã‚’åé›†ã—ã€å…±æœ‰ãƒ‡ã‚£ã‚¹ã‚¯ã«é…ç½®ã•ã‚ŒãŸ3ã¤ã®csvãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆãã‚Œãã‚ŒãŒç‹¬è‡ªã®vCenterï¼‰ã‚’å½¢æˆã—ã¦ã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ã€ç§ãŒã‚ã‚‹ç¨‹åº¦çµŒé¨“ã—ãŸRè¨€èªã‚’ä½¿ç”¨ã—ãŸãƒã‚§ãƒƒã‚¯ã§è£œè¶³ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ”¹è‰¯ã®éç¨‹ã§ã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ã—ã€ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã¨å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚™ãˆãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã“ã‚Œã«ã¤ã„ã¦ã¯å¾Œã§è©³ã—ãèª¬æ˜ã—ã¾ã™ï¼‰ã«åŠ ãˆã¦ã€vSphereãƒ­ã‚°ã‚’åˆ†æã—ã¦vmã®å®Ÿéš›ã®ä½œæˆè€…ã¨ãã‚Œã‚‰ãŒä½œæˆã•ã‚ŒãŸæ™‚åˆ»ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã§å¤§ãããªã‚Šã¾ã—ãŸã€‚ </font></font></p><br>
<p>   IDE RStudio Desktop  PowerShell ISE.</p><br>
<p>      .</p><br>
<h4 id="opisanie-obschey-logiki">  .</h4><br>
<p>    .</p><br>
<ul>
<li>       PowerShell ,    R,     csv.      . (      R  PowerShell   ,   ,     csv      -  ).</li>
<li>  R     ,    . â€”  word ,           ,       "       ?".</li>
<li>      csv   R,  dataframe,       xlsx ,        ,     .</li>
<li> dataframe            ,        (   ).</li>
<li>      PowerShell ,     vCenter     ,          .   ,    ,  .     , ,   ,     2 ,    workflow,         .         .    csv,     R. </li>
<li>   xlsx ,         ,     ,     ,       .</li>
<li>  ,   ,    ,       .        ,       .      â€”        .</li>
<li>       SQL Server       (   â€”    )</li>
</ul><br>
<h4 id="sobstvenno-skripty"> </h4><br>
<div class="spoiler"><b class="spoiler_title">     R</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#     (       )</span>
setwd(<span class="hljs-string">"C:\\Scripts\\getVm"</span>)<font></font>
<font></font>
<span class="hljs-comment">####    ####</span><font></font>
library(tidyverse)<font></font>
library(xlsx)<font></font>
library(mailR)<font></font>
library(rmarkdown)<font></font>
<font></font>
<span class="hljs-comment">#####         #####</span>
source(file = <span class="hljs-string">"const.R"</span>, local = T, encoding = <span class="hljs-string">"utf-8"</span>)<font></font>
<font></font>
<span class="hljs-comment">#        ,  .</span>
<span class="hljs-keyword">if</span> (file.exists(filenameVmCreationRules)) {file.remove(filenameVmCreationRules)}<font></font>
<font></font>
<span class="hljs-comment">####      </span>
render(<span class="hljs-string">"VM_name_rules.Rmd"</span>,<font></font>
       output_format = word_document(),<font></font>
       output_file = filenameVmCreationRules)<font></font>
<font></font>
<span class="hljs-comment">#        ,  </span>
<span class="hljs-keyword">if</span> (file.exists(allVmXlsxPath)) {file.remove(allVmXlsxPath)}<font></font>
<font></font>
<span class="hljs-comment">####       PowerShell .    csv.</span>
system(paste0(<span class="hljs-string">"powershell -File "</span>, getVmPsPath))<font></font>
<font></font>
<span class="hljs-comment">#  df</span><font></font>
fullXslx_df &lt;- allVmXlsxPath %&gt;% <font></font>
  read.csv2(stringsAsFactors = FALSE)<font></font>
<font></font>
<span class="hljs-comment">#    </span><font></font>
full_df &lt;- fullXslx_df %&gt;%<font></font>
  mutate(<font></font>
    <span class="hljs-comment">#       ,    ,      ,</span><font></font>
    isSubsystemCorrect = Subsystem %&gt;% <font></font>
      gsub(<span class="hljs-string">"[[:space:]]"</span>, <span class="hljs-string">""</span>, .) %&gt;% <font></font>
      str_split(., <span class="hljs-string">","</span>) %&gt;% <font></font>
      map(function(x) (all(x %<span class="hljs-keyword">in</span>% AllowedValues$Subsystem))) %&gt;%
      <span class="hljs-keyword">as</span>.logical(),<font></font>
    isOwnerCorrect = Owner %<span class="hljs-keyword">in</span>% AllowedValues$Owner,<font></font>
    isCategoryCorrect = Category %<span class="hljs-keyword">in</span>% AllowedValues$Category,<font></font>
    isCreatorCorrect = (!<span class="hljs-keyword">is</span>.na(Creator) &amp; Creator != <span class="hljs-string">''</span>),<font></font>
    isCreation.DateCorrect = map(Creation.Date, IsDate)<font></font>
  )<font></font>
<font></font>
<span class="hljs-comment">#        ,  .</span>
<span class="hljs-keyword">if</span> (file.exists(filenameAll)) {file.remove(filenameAll)}<font></font>
<font></font>
<span class="hljs-comment">####  xslx    ####</span>
<span class="hljs-comment">#     </span><font></font>
full_df %&gt;% write.xlsx(file=filenameAll,<font></font>
                       sheetName=names[<span class="hljs-number">1</span>],<font></font>
                       col.names=TRUE,<font></font>
                       row.names=FALSE,<font></font>
                       append=FALSE)<font></font>
<font></font>
<span class="hljs-comment">####  xslx      ####</span>
<span class="hljs-comment">#  df</span><font></font>
incorrect_df &lt;- full_df %&gt;%<font></font>
  select(VM.Name, <font></font>
         IP.s, <font></font>
         Owner,<font></font>
         Subsystem,<font></font>
         Creator,<font></font>
         Category,<font></font>
         Creation.Date,<font></font>
         isOwnerCorrect, <font></font>
         isSubsystemCorrect, <font></font>
         isCategoryCorrect,<font></font>
         isCreatorCorrect,<font></font>
         vCenter.Name) %&gt;%<font></font>
  filter(isSubsystemCorrect == F | <font></font>
           isOwnerCorrect == F |<font></font>
           isCategoryCorrect == F |<font></font>
           isCreatorCorrect == F)<font></font>
<font></font>
<span class="hljs-comment">#        ,  .</span>
<span class="hljs-keyword">if</span> (file.exists(filenameIncVM)) {file.remove(filenameIncVM)}<font></font>
<font></font>
<span class="hljs-comment">#   VM     csv</span><font></font>
incorrect_df %&gt;%<font></font>
  select(VM.Name) %&gt;%<font></font>
  write_csv2(path = filenameIncVM, append = FALSE)<font></font>
<font></font>
<span class="hljs-comment">#     </span><font></font>
incorrect_df_filtered &lt;- incorrect_df %&gt;% <font></font>
  select(VM.Name, <font></font>
         IP.s, <font></font>
         Owner, <font></font>
         Subsystem, <font></font>
         Category,<font></font>
         Creator,<font></font>
         vCenter.Name,<font></font>
         Creation.Date<font></font>
  )<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
numberOfRows &lt;- nrow(incorrect_df)<font></font>
<font></font>
<span class="hljs-comment">####   ####</span>
<span class="hljs-comment">#        ,  .</span>
<span class="hljs-comment">#   -    </span><font></font>
<font></font>
<span class="hljs-keyword">if</span> (numberOfRows &gt; <span class="hljs-number">0</span>) {<font></font>
<font></font>
  <span class="hljs-comment">#       ,  .</span>
  <span class="hljs-keyword">if</span> (file.exists(creatorsFilePath)) {file.remove(creatorsFilePath)}<font></font>
<font></font>
  <span class="hljs-comment">#  PowerShell ,     VM.    csv.</span>
  system(paste0(<span class="hljs-string">"powershell -File "</span>, getCreatorsPath))<font></font>
<font></font>
  <span class="hljs-comment">#    </span><font></font>
  creators_df &lt;- creatorsFilePath %&gt;%<font></font>
    read.csv2(stringsAsFactors = FALSE)<font></font>
<font></font>
  <span class="hljs-comment">#     ,      </span><font></font>
  incorrect_df_filtered &lt;- incorrect_df_filtered %&gt;% <font></font>
    select(VM.Name, <font></font>
           IP.s, <font></font>
           Owner, <font></font>
           Subsystem, <font></font>
           Category,<font></font>
           Creator,<font></font>
           vCenter.Name,<font></font>
           Creation.Date<font></font>
    ) %&gt;% <font></font>
    left_join(creators_df, by = <span class="hljs-string">"VM.Name"</span>) %&gt;% <font></font>
    rename(` ` = CreatedBy, <font></font>
           `  ` = CreatedOn)  <font></font>
<font></font>
  <span class="hljs-comment">#   </span><font></font>
  emailBody &lt;- paste0(<font></font>
    <span class="hljs-string">'&lt;html&gt;
                    &lt;h3&gt; ,  .&lt;/h3&gt;
                    &lt;p&gt;           H:  :&lt;p&gt;
                    &lt;p&gt;\\\\server.ru\\VM\\'</span>, sourceFileFormat, <span class="hljs-string">'&lt;/p&gt;
                    &lt;p&gt;      &lt;strong&gt; &lt;/strong&gt; .   &lt;strong&gt;'</span>, numberOfRows,<span class="hljs-string">'&lt;/strong&gt;.&lt;/p&gt;
                    &lt;p&gt;   2  . &lt;strong&gt; &lt;/strong&gt;  &lt;strong&gt;  &lt;/strong&gt;,     vCenter   2 &lt;/p&gt;
                    &lt;p&gt;        .      &lt;/p&gt;
                    &lt;p&gt;&lt;img src="data/meme.jpg"&gt;&lt;/p&gt;
                    &lt;/html&gt;'</span><font></font>
  )<font></font>
<font></font>
  <span class="hljs-comment">#   </span>
  <span class="hljs-keyword">if</span> (file.exists(filenameIncorrect)) {file.remove(filenameIncorrect)}<font></font>
<font></font>
  <span class="hljs-comment">#       ..</span>
  source(file = <span class="hljs-string">"email.R"</span>, local = T, encoding = <span class="hljs-string">"utf-8"</span>)<font></font>
<font></font>
  <span class="hljs-comment">####       ####</span>
  send.mail(<span class="hljs-keyword">from</span> = emailParams$<span class="hljs-keyword">from</span>,<font></font>
            to = emailParams$to,<font></font>
            subject = <span class="hljs-string">"    "</span>,<font></font>
            body = emailBody,<font></font>
            encoding = <span class="hljs-string">"utf-8"</span>,<font></font>
            html = TRUE,<font></font>
            inline = TRUE,<font></font>
            smtp = emailParams$smtpParams,<font></font>
            authenticate = TRUE,<font></font>
            send = TRUE,<font></font>
            attach.files = c(filenameIncorrect, filenameVmCreationRules),<font></font>
            debug = FALSE)<font></font>
<font></font>
  <span class="hljs-comment">####   ,      ####</span>
} <span class="hljs-keyword">else</span> {<font></font>
<font></font>
  <span class="hljs-comment">#   </span><font></font>
  emailBody &lt;- paste0(<font></font>
    <span class="hljs-string">'&lt;html&gt;
    &lt;h3&gt; ,  &lt;/h3&gt;
   &lt;p&gt;           H:  :&lt;p&gt;
    &lt;p&gt;\\\\server.ru\\VM\\'</span>, sourceFileFormat, <span class="hljs-string">'&lt;/p&gt;
    &lt;p&gt;,   ,     &lt;/p&gt;
    &lt;p&gt;&lt;img src="data/meme_correct.jpg"&gt;&lt;/p&gt;
    &lt;/html&gt;'</span><font></font>
  )<font></font>
<font></font>
  <span class="hljs-comment">####      VM ####</span>
  send.mail(<span class="hljs-keyword">from</span> = emailParams$<span class="hljs-keyword">from</span>,<font></font>
            to = emailParams$to,<font></font>
            subject = <span class="hljs-string">" "</span>,<font></font>
            body = emailBody,<font></font>
            encoding = <span class="hljs-string">"utf-8"</span>,<font></font>
            html = TRUE,<font></font>
            inline = TRUE,<font></font>
            smtp = emailParams$smtpParams,<font></font>
            authenticate = TRUE,<font></font>
            send = TRUE,<font></font>
            debug = FALSE)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#######     #####</span><font></font>
<font></font>
source(file = <span class="hljs-string">"DB.R"</span>, local = T, encoding = <span class="hljs-string">"utf-8"</span>)
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">   vm  PowerShell</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#      </span><font></font>
$vCenterNames = @(<font></font>
                    <span class="hljs-string">"vcenter01"</span>, 
                    <span class="hljs-string">"vcenter02"</span>, 
                    <span class="hljs-string">"vcenter03"</span><font></font>
                    )<font></font>
$vCenterUsername = <span class="hljs-string">"myusername"</span>
$vCenterPassword = <span class="hljs-string">"mypassword"</span><font></font>
<font></font>
$filename = <span class="hljs-string">"C:\Scripts\getVm\data\allvm\all-vm-$(get-date -f yyyy-MM-dd).csv"</span><font></font>
<font></font>
$destinationSMB = <span class="hljs-string">"\\server.ru\myfolder$\vm"</span>
$IP0=<span class="hljs-string">""</span>
$IP1=<span class="hljs-string">""</span>
$IP2=<span class="hljs-string">""</span>
$IP3=<span class="hljs-string">""</span>
$IP4=<span class="hljs-string">""</span>
$IP5=<span class="hljs-string">""</span><font></font>
<font></font>
<span class="hljs-comment">#    vCenter,    .  ,      (, )</span><font></font>
Connect-VIServer -Server $vCenterNames -User $vCenterUsername -Password $vCenterPassword<font></font>
<font></font>
write-host <span class="hljs-string">""</span><font></font>
<font></font>
<span class="hljs-comment">#       vCenter-</span><font></font>
function Get-VMinventory {<font></font>
<font></font>
<span class="hljs-comment">#       ,  </span><font></font>
$AllVM = Get-VM | Sort Name<font></font>
$cnt = $AllVM.Count<font></font>
$count = <span class="hljs-number">1</span><font></font>
<font></font>
<span class="hljs-comment">#           </span>
   foreach ($vm <span class="hljs-keyword">in</span> $AllVM) {<font></font>
   $StartTime = $(get-date)<font></font>
<font></font>
     $IP0 = $vm.Guest.IPAddress[<span class="hljs-number">0</span>]<font></font>
     $IP1 = $vm.Guest.IPAddress[<span class="hljs-number">1</span>]<font></font>
     $IP2 = $vm.Guest.IPAddress[<span class="hljs-number">2</span>]<font></font>
     $IP3 = $vm.Guest.IPAddress[<span class="hljs-number">3</span>]<font></font>
     $IP4 = $vm.Guest.IPAddress[<span class="hljs-number">4</span>]<font></font>
     $IP5 = $vm.Guest.IPAddress[<span class="hljs-number">5</span>]<font></font>
<font></font>
     If ($IP0 -ne $null) {If ($IP0.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP0=<span class="hljs-string">""</span>}}<font></font>
     If ($IP1 -ne $null) {If ($IP1.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP1=<span class="hljs-string">""</span>}}<font></font>
     If ($IP2 -ne $null) {If ($IP2.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP2=<span class="hljs-string">""</span>}}<font></font>
     If ($IP3 -ne $null) {If ($IP3.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP3=<span class="hljs-string">""</span>}}<font></font>
     If ($IP4 -ne $null) {If ($IP4.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP4=<span class="hljs-string">""</span>}}<font></font>
     If ($IP5 -ne $null) {If ($IP5.Contains(<span class="hljs-string">":"</span>) -ne <span class="hljs-number">0</span>) {$IP5=<span class="hljs-string">""</span>}}<font></font>
<font></font>
     $cluster = $vm | Get-Cluster | Select-Object -ExpandProperty name  <font></font>
     $Bootime = $vm.ExtensionData.Runtime.BootTime<font></font>
     $TotalHDDs = $vm.ProvisionedSpaceGB -<span class="hljs-keyword">as</span> [int]<font></font>
     $CreationDate = $vm.CustomFields.Item(<span class="hljs-string">"CreationDate"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
     $Creator = $vm.CustomFields.Item(<span class="hljs-string">"Creator"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
     $Category = $vm.CustomFields.Item(<span class="hljs-string">"Category"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
     $Owner = $vm.CustomFields.Item(<span class="hljs-string">"Owner"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
     $Subsystem = $vm.CustomFields.Item(<span class="hljs-string">"Subsystem"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
<font></font>
     $IPS = $vm.CustomFields.Item(<span class="hljs-string">"IP"</span>) -<span class="hljs-keyword">as</span> [string]<font></font>
<font></font>
     $vCPU = $vm.NumCpu<font></font>
     $CorePerSocket = $vm.ExtensionData.config.hardware.NumCoresPerSocket<font></font>
     $Sockets = $vCPU/$CorePerSocket<font></font>
<font></font>
     $Id = $vm.Id.Split(<span class="hljs-string">'-'</span>)[<span class="hljs-number">2</span>] -<span class="hljs-keyword">as</span> [int]<font></font>
<font></font>
     <span class="hljs-comment">#      </span><font></font>
     $Vmresult = New-Object PSObject<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Id"</span> -Value $Id   <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VM Name"</span> -Value $vm.Name  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Cluster"</span> -Value $cluster  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Esxi Host"</span> -Value $VM.VMHost  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 1"</span> -Value $IP0<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 2"</span> -Value $IP1<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 3"</span> -Value $IP2<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 4"</span> -Value $IP3<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 5"</span> -Value $IP4<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP Address 6"</span> -Value $IP5<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"vCPU"</span> -Value $vCPU<font></font>
     $Vmresult | Add-Member -MemberType NoteProperty -Name <span class="hljs-string">"CPU Sockets"</span> -Value $Sockets<font></font>
     $Vmresult | Add-Member -MemberType NoteProperty -Name <span class="hljs-string">"Core per Socket"</span> -Value $CorePerSocket<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"RAM (GB)"</span> -Value $vm.MemoryGB<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Total-HDD (GB)"</span> -Value $TotalHDDs<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Power State"</span> -Value $vm.PowerState<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"OS"</span> -Value $VM.ExtensionData.summary.config.guestfullname  <font></font>
     $Vmresult | Add-Member -MemberType NoteProperty -Name <span class="hljs-string">"Boot Time"</span> -Value $Bootime<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VMTools Status"</span> -Value $vm.ExtensionData.Guest.ToolsStatus  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VMTools Version"</span> -Value $vm.ExtensionData.Guest.ToolsVersion  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VMTools Version Status"</span> -Value $vm.ExtensionData.Guest.ToolsVersionStatus  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VMTools Running Status"</span> -Value $vm.ExtensionData.Guest.ToolsRunningStatus  <font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Creation Date"</span> -Value $CreationDate<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Creator"</span> -Value $Creator<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Category"</span> -Value $Category<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Owner"</span> -Value $Owner<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"Subsystem"</span> -Value $Subsystem<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"IP's"</span> -Value $IPS<font></font>
     $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"vCenter Name"</span> -Value $vm.Uid.Split(<span class="hljs-string">'@'</span>)[<span class="hljs-number">1</span>].Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">0</span>]  <font></font>
<font></font>
<span class="hljs-comment">#           .   ,      .</span><font></font>
     $elapsedTime = $(get-date) - $StartTime<font></font>
     $totalTime = <span class="hljs-string">"{0:HH:mm:ss}"</span> -f ([datetime]($elapsedTime.Ticks*($cnt - $count)))<font></font>
<font></font>
     clear-host<font></font>
     Write-Host <span class="hljs-string">"Processing"</span> $count <span class="hljs-string">"from"</span> $cnt <font></font>
     Write-host <span class="hljs-string">"Progress:"</span> ([math]::Round($count/$cnt*<span class="hljs-number">100</span>, <span class="hljs-number">2</span>)) <span class="hljs-string">"%"</span> 
     Write-host <span class="hljs-string">"You have about "</span> $totalTime <span class="hljs-string">"for cofee"</span>
     Write-host <span class="hljs-string">""</span><font></font>
<font></font>
     $count++<font></font>
<font></font>
<span class="hljs-comment">#  ,   ""      </span><font></font>
     $Vmresult<font></font>
   }<font></font>
<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">#         csv</span><font></font>
$allVm = Get-VMinventory | Export-CSV -Path $filename -NoTypeInformation -UseCulture -Force<font></font>
<font></font>
<span class="hljs-comment">#         ,   ,  .</span>
<span class="hljs-keyword">try</span><font></font>
    {<font></font>
        Copy-Item $filename -Destination $destinationSMB -Force -ErrorAction SilentlyContinue<font></font>
    }<font></font>
catch<font></font>
    {<font></font>
        $error | Export-CSV -Path $filename<span class="hljs-string">".error"</span> -NoTypeInformation -UseCulture -Force<font></font>
    }</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  PowerShell,          </b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#   ,      VM</span>
$VMfilePath = <span class="hljs-string">"C:\Scripts\getVm\creators_VM\creators_VM_$(get-date -f yyyy-MM-dd).csv"</span>
<span class="hljs-comment">#   ,     </span>
$filePath = <span class="hljs-string">"C:\Scripts\getVm\data\creators\creators-$(get-date -f yyyy-MM-dd).csv"</span><font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
Workflow GetCreators-Wf<font></font>
{<font></font>
    <span class="hljs-comment"># ,       </span><font></font>
    param([string[]]$VMfilePath)<font></font>
<font></font>
<span class="hljs-comment"># ,     workflow</span>
$vCenterUsername = <span class="hljs-string">"myusername"</span>
$vCenterPassword = <span class="hljs-string">"mypassword"</span>
$daysToLook = <span class="hljs-number">14</span><font></font>
$start = (get-date).AddDays(-$daysToLook)<font></font>
$finish = get-date<font></font>
<span class="hljs-comment"># ,     csv  ,      </span>
$UnknownUser = <span class="hljs-string">"UNKNOWN"</span>
$UnknownCreatedTime = <span class="hljs-string">"0000-00-00"</span><font></font>
<font></font>
<span class="hljs-comment">#      ,      .</span><font></font>
$vCenterNames = @(<font></font>
                    <span class="hljs-string">"vcenter01"</span>, 
                    <span class="hljs-string">"vcenter02"</span>, 
                    <span class="hljs-string">"vcenter03"</span><font></font>
                    )<font></font>
<font></font>
<span class="hljs-comment">#   VM  csv    </span><font></font>
$list = Import-Csv $VMfilePath -UseCulture | select -ExpandProperty VM.Name<font></font>
<font></font>
<span class="hljs-comment"># ,     ( 5   )</span>
foreach -parallel ($row <span class="hljs-keyword">in</span> $list)<font></font>
  {<font></font>
    <span class="hljs-comment">#  ,       ,     $Using</span><font></font>
    InlineScript {<font></font>
<font></font>
    <span class="hljs-comment">#     </span><font></font>
        $StartTime = $(get-date)<font></font>
<font></font>
        Write-Host <span class="hljs-string">""</span>
        Write-Host <span class="hljs-string">"Processing $Using:row started at $StartTime"</span>
        Write-Host <span class="hljs-string">""</span><font></font>
<font></font>
        <span class="hljs-comment">#    ,        </span><font></font>
        $con = Connect-VIServer -Server $Using:vCenterNames -User $Using:vCenterUsername -Password $Using:vCenterPassword<font></font>
<font></font>
        <span class="hljs-comment">#   vm</span><font></font>
        $vm = Get-VM -Name $Using:row<font></font>
<font></font>
      <span class="hljs-comment">#  2  .     ,  - .   ,</span>
      $Event = $vm | Get-VIEvent -Start $Using:start -Finish $Using:finish -Types Info | Where { $_.Gettype().Name -eq <span class="hljs-string">"VmBeingDeployedEvent"</span> -<span class="hljs-keyword">or</span> $_.Gettype().Name -eq <span class="hljs-string">"VmCreatedEvent"</span> -<span class="hljs-keyword">or</span> $_.Gettype().Name -eq <span class="hljs-string">"VmRegisteredEvent"</span> -<span class="hljs-keyword">or</span> $_.Gettype().Name -eq <span class="hljs-string">"VmClonedEvent"</span>}
      <span class="hljs-comment"># $Event = $vm | Get-VIEvent -Types Info | Where { $_.Gettype().Name -eq "VmBeingDeployedEvent" -or $_.Gettype().Name -eq "VmCreatedEvent" -or $_.Gettype().Name -eq "VmRegisteredEvent" -or $_.Gettype().Name -eq "VmClonedEvent"}</span><font></font>
<font></font>
      <span class="hljs-comment">#      ,      -</span>
      If (($Event | Measure-Object).Count -eq <span class="hljs-number">0</span>){<font></font>
         $User = $Using:UnknownUser<font></font>
         $Created = $Using:UnknownCreatedTime<font></font>
         $CreatedFormat = $Using:UnknownCreatedTime<font></font>
      } Else {<font></font>
         If ($Event.Username -eq <span class="hljs-string">""</span> -<span class="hljs-keyword">or</span> $Event.Username -eq $null) {<font></font>
            $User = $Using:UnknownUser<font></font>
         } Else {<font></font>
         $User = $Event.Username<font></font>
         } <span class="hljs-comment"># Else</span><font></font>
            $CreatedFormat = $Event.CreatedTime<font></font>
            <span class="hljs-comment">#     ,      ,   .      .</span>
            $Created = $Event.CreatedTime.ToString(<span class="hljs-string">'yyyy-MM-dd'</span>)<font></font>
         } <span class="hljs-comment"># Else</span><font></font>
<font></font>
      Write-Host <span class="hljs-string">"Creator for $vm is $User. Creating object."</span><font></font>
<font></font>
      <span class="hljs-comment">#  .  .</span><font></font>
      $Vmresult = New-Object PSObject<font></font>
      $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"VM Name"</span> -Value $vm.Name  <font></font>
      $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"CreatedBy"</span> -Value $User<font></font>
      $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"CreatedOn"</span> -Value $CreatedFormat<font></font>
      $Vmresult | add-member -MemberType NoteProperty -Name <span class="hljs-string">"CreatedOnFormat"</span> -Value $Created           
      <span class="hljs-comment">#  </span><font></font>
      $Vmresult<font></font>
<font></font>
    } <span class="hljs-comment"># Inline</span><font></font>
<font></font>
} <span class="hljs-comment"># ForEach</span><font></font>
<font></font>
}<font></font>
<font></font>
$Creators = GetCreators-Wf $VMfilePath<font></font>
<span class="hljs-comment">#    </span>
$Creators | select <span class="hljs-string">'VM Name'</span>, CreatedBy, CreatedOn | Export-Csv -Path $filePath -NoTypeInformation -UseCulture -Force<font></font>
<font></font>
Write-Host <span class="hljs-string">"CSV generetion finisghed at $(get-date). PROFIT"</span>
</code></pre></div></div><br>
<p><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xlsx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ç‰¹åˆ¥ãªæ³¨æ„</font><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">å€¤ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€csvãƒ†ãƒ¼ãƒ–ãƒ«ã ã‘ã§ãªãã€ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®ã‚ˆã†ã«ï¼‰æ˜ç¢ºã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸæ–‡å­—ã¸ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</font></font></p><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ãªã„ãƒã‚·ãƒ³ã®ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ç¾ã—ã„xlsxãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹</font></font></b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#   </span>
<span class="hljs-comment">#   : "xls"  "xlsx"</span>
wb&lt;-createWorkbook(type=<span class="hljs-string">"xlsx"</span>)<font></font>
<font></font>
<span class="hljs-comment">#        </span><font></font>
TABLE_ROWNAMES_STYLE &lt;- CellStyle(wb) + Font(wb, isBold=TRUE)<font></font>
TABLE_COLNAMES_STYLE &lt;- CellStyle(wb) + Font(wb, isBold=TRUE) +<font></font>
  Alignment(wrapText=TRUE, horizontal=<span class="hljs-string">"ALIGN_CENTER"</span>) +<font></font>
  Border(color=<span class="hljs-string">"black"</span>, position=c(<span class="hljs-string">"TOP"</span>, <span class="hljs-string">"BOTTOM"</span>), <font></font>
         pen=c(<span class="hljs-string">"BORDER_THIN"</span>, <span class="hljs-string">"BORDER_THICK"</span>))<font></font>
<font></font>
<span class="hljs-comment">#   </span>
sheet &lt;- createSheet(wb, sheetName = names[<span class="hljs-number">2</span>])<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
addDataFrame(incorrect_df_filtered, <font></font>
             sheet, startRow=<span class="hljs-number">1</span>, startColumn=<span class="hljs-number">1</span>,  row.names=FALSE, byrow=FALSE,<font></font>
             colnamesStyle = TABLE_COLNAMES_STYLE,<font></font>
             rownamesStyle = TABLE_ROWNAMES_STYLE)<font></font>
<font></font>
<span class="hljs-comment">#  ,    </span>
autoSizeColumn(sheet = sheet, colIndex=c(<span class="hljs-number">1</span>:ncol(incorrect_df)))<font></font>
<font></font>
<span class="hljs-comment">#  </span>
addAutoFilter(sheet, cellRange = <span class="hljs-string">"C1:G1"</span>)<font></font>
<font></font>
<span class="hljs-comment">#  </span>
fo2 &lt;- Fill(foregroundColor=<span class="hljs-string">"red"</span>)<font></font>
cs2 &lt;- CellStyle(wb, <font></font>
                 fill = fo2, <font></font>
                 dataFormat = DataFormat(<span class="hljs-string">"@"</span>))<font></font>
<font></font>
<span class="hljs-comment">#             </span>
rowsOwner &lt;- getRows(sheet, rowIndex = (which(!incorrect_df$isOwnerCorrect) + <span class="hljs-number">1</span>))<font></font>
cellsOwner &lt;- getCells(rowsOwner, colIndex = which( colnames(incorrect_df_filtered) == <span class="hljs-string">"Owner"</span> )) <font></font>
lapply(names(cellsOwner), function(x) setCellStyle(cellsOwner[[x]], cs2))<font></font>
<font></font>
<span class="hljs-comment">#             </span>
rowsSubsystem &lt;- getRows(sheet, rowIndex = (which(!incorrect_df$isSubsystemCorrect) + <span class="hljs-number">1</span>))<font></font>
cellsSubsystem &lt;- getCells(rowsSubsystem, colIndex = which( colnames(incorrect_df_filtered) == <span class="hljs-string">"Subsystem"</span> )) <font></font>
lapply(names(cellsSubsystem), function(x) setCellStyle(cellsSubsystem[[x]], cs2))<font></font>
<font></font>
<span class="hljs-comment">#   </span>
rowsCategory &lt;- getRows(sheet, rowIndex = (which(!incorrect_df$isCategoryCorrect) + <span class="hljs-number">1</span>))<font></font>
cellsCategory &lt;- getCells(rowsCategory, colIndex = which( colnames(incorrect_df_filtered) == <span class="hljs-string">"Category"</span> )) <font></font>
lapply(names(cellsCategory), function(x) setCellStyle(cellsCategory[[x]], cs2))<font></font>
<font></font>
<span class="hljs-comment"># </span>
rowsCreator &lt;- getRows(sheet, rowIndex = (which(!incorrect_df$isCreatorCorrect) + <span class="hljs-number">1</span>))<font></font>
cellsCreator &lt;- getCells(rowsCreator, colIndex = which( colnames(incorrect_df_filtered) == <span class="hljs-string">"Creator"</span> )) <font></font>
lapply(names(cellsCreator), function(x) setCellStyle(cellsCreator[[x]], cs2))<font></font>
<font></font>
<span class="hljs-comment">#  </span>
saveWorkbook(wb, filenameIncorrect)</code></pre></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ºåŠ›ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font></p><br>
<img src="https://habrastorage.org/webt/ax/y7/bv/axy7bvclwghyjabvvzuanyb2_ry.jpeg"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®è¨­å®šã«ã‚‚èˆˆå‘³æ·±ã„ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ­£ã—ã„æ¨©åˆ©ã¨è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å–å¾—ã—ã¦ã€ã™ã¹ã¦ãŒæ­£å¸¸ã«é–‹å§‹ã•ã‚Œã‚‹ã‚ˆã†ã«ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãã®çµæœã€Rãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ãã‚Œè‡ªä½“ãŒRã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¿˜ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€ãƒšãƒ³ã§ã‚¿ã‚¹ã‚¯ã‚’ä¿®æ­£ã§ãã¾ã™ã€‚</font></font><br>
<br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windowsã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹2ã¤ã®ä¾‹ã‚’å«ã‚€Rã‚³ãƒ¼ãƒ‰</font></font></b><div class="spoiler_text"><pre><code class="python hljs">library(taskscheduleR)<font></font>
myscript &lt;- file.path(getwd(), <span class="hljs-string">"all_vm.R"</span>)<font></font>
<font></font>
<span class="hljs-comment">##    62 </span>
taskscheduler_create(taskname = <span class="hljs-string">"getAllVm"</span>, rscript = myscript, <font></font>
                     schedule = <span class="hljs-string">"ONCE"</span>, starttime = format(Sys.time() + <span class="hljs-number">62</span>, <span class="hljs-string">"%H:%M"</span>))<font></font>
<font></font>
<span class="hljs-comment">##      09:10</span>
taskscheduler_create(taskname = <span class="hljs-string">"getAllVmDaily"</span>, rscript = myscript, <font></font>
                     schedule = <span class="hljs-string">"WEEKLY"</span>, <font></font>
                     days = c(<span class="hljs-string">"MON"</span>, <span class="hljs-string">"TUE"</span>, <span class="hljs-string">"WED"</span>, <span class="hljs-string">"THU"</span>, <span class="hljs-string">"FRI"</span>),<font></font>
                     starttime = <span class="hljs-string">"02:00"</span>)<font></font>
<font></font>
<span class="hljs-comment">##  </span>
taskscheduler_delete(taskname = <span class="hljs-string">"getAllVm"</span>)<font></font>
taskscheduler_delete(taskname = <span class="hljs-string">"getAllVmDaily"</span>)<font></font>
<font></font>
<span class="hljs-comment">#   ( 4 )</span>
tail(readLines(<span class="hljs-string">"all_vm.log"</span>), sep =<span class="hljs-string">"\n"</span>, n = <span class="hljs-number">4</span>)</code></pre></div></div><br>
<h4 id="otdelno-pro-bd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¥é€”ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¤ã„ã¦</font></font></h4><br>
<p>      . ,   ,    ,    vCenter  .            ( ,  ),         ,     .    .</p><br>
<p>   .</p><br>
<p>    MS SQL SERVER â€” system-versioned temporal table.   ,   ( ) .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  Microsoft</a>. </p><br>
<p>  â€”  , ,         SQL Server  2  datetime     (       )   ,     .      ,   ,     ,        ,        . </p><br>
<p>    â€”        ,        . ..             ,         .</p><br>
<p> ,       R    ,            ,           .    ,   compareDF,      .</p><br>
<div class="spoiler"><b class="spoiler_title">  R     </b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
library(odbc)<font></font>
library(compareDF)<font></font>
<font></font>
<span class="hljs-comment">#  </span><font></font>
con &lt;- dbConnect(odbc(),<font></font>
                 Driver = <span class="hljs-string">"ODBC Driver 13 for SQL Server"</span>,<font></font>
                 Server = DBParams$server,<font></font>
                 Database = DBParams$database,<font></font>
                 UID = DBParams$UID,<font></font>
                 PWD = DBParams$PWD,<font></font>
                 Port = <span class="hljs-number">1433</span>)<font></font>
<font></font>
<span class="hljs-comment">####    .   - . ####</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> (!dbExistsTable(con, DBParams$TblName)) {
  <span class="hljs-comment">####   ####</span><font></font>
  create &lt;- dbSendStatement(<font></font>
    con,<font></font>
    paste0(<font></font>
      <span class="hljs-string">'CREATE TABLE '</span>,<font></font>
      DBParams$TblName,<font></font>
      <span class="hljs-string">'(
    [Id] [int] NOT NULL PRIMARY KEY CLUSTERED,
    [VM.Name] [varchar](255) NULL,
    [Cluster] [varchar](255) NULL,
    [Esxi.Host] [varchar](255) NULL,
    [IP.Address.1] [varchar](255) NULL,
    [IP.Address.2] [varchar](255) NULL,
    [IP.Address.3] [varchar](255) NULL,
    [IP.Address.4] [varchar](255) NULL,
    [IP.Address.5] [varchar](255) NULL,
    [IP.Address.6] [varchar](255) NULL,
    [vCPU] [int] NULL,
    [CPU.Sockets] [int] NULL,
    [Core.per.Socket] [int] NULL,
    [RAM..GB.] [int] NULL,
    [Total.HDD..GB.] [int] NULL,
    [Power.State] [varchar](255) NULL,
    [OS] [varchar](255) NULL,
    [Boot.Time] [varchar](255) NULL,
    [VMTools.Status] [varchar](255) NULL,
    [VMTools.Version] [int] NULL,
    [VMTools.Version.Status] [varchar](255) NULL,
    [VMTools.Running.Status] [varchar](255) NULL,
    [Creation.Date] [varchar](255) NULL,
    [Creator] [varchar](255) NULL,
    [Category] [varchar](255) NULL,
    [Owner] [varchar](255) NULL,
    [Subsystem] [varchar](255) NULL,
    [IP.s] [varchar](255) NULL,
    [vCenter.Name] [varchar](255) NULL,
    DateFrom datetime2 GENERATED ALWAYS AS ROW START NOT NULL,
    DateTo datetime2 GENERATED ALWAYS AS ROW END NOT NULL,
    PERIOD FOR SYSTEM_TIME (DateFrom, DateTo)
        ) ON [PRIMARY]
        WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE = '</span>, DBParams$TblHistName,<span class="hljs-string">'));'</span><font></font>
    )<font></font>
  )<font></font>
<font></font>
  <span class="hljs-comment">#   </span><font></font>
  dbClearResult(create)<font></font>
<font></font>
} <span class="hljs-comment"># if</span><font></font>
<font></font>
<span class="hljs-comment">####     ####</span><font></font>
<font></font>
<span class="hljs-comment">#  ,    </span><font></font>
allVM_db_con &lt;- tbl(con, DBParams$TblName) <font></font>
<font></font>
<span class="hljs-comment">####   ####</span><font></font>
<font></font>
<span class="hljs-comment">#     (   )</span><font></font>
allVM_db &lt;- allVM_db_con %&gt;% <font></font>
  select(c(-<span class="hljs-string">"DateTo"</span>, -<span class="hljs-string">"DateFrom"</span>)) %&gt;% <font></font>
  collect()<font></font>
<font></font>
<span class="hljs-comment">#     .   Id</span>
<span class="hljs-comment">#       -,   +,   -  +</span><font></font>
ctable_VM &lt;- fullXslx_df %&gt;% <font></font>
  compare_df(allVM_db, <font></font>
             c(<span class="hljs-string">"Id"</span>))<font></font>
<font></font>
<span class="hljs-comment">####   ####</span><font></font>
<font></font>
<span class="hljs-comment">#  Id ,      </span><font></font>
remove_Id &lt;- ctable_VM$comparison_df %&gt;% <font></font>
  filter(chng_type == <span class="hljs-string">"-"</span>) %&gt;%<font></font>
  select(Id)<font></font>
<font></font>
<span class="hljs-comment"># ,    (   -     )</span>
<span class="hljs-keyword">if</span> (remove_Id %&gt;% nrow() &gt; <span class="hljs-number">0</span>) {<font></font>
<font></font>
  <span class="hljs-comment">#       </span><font></font>
  delete &lt;- dbSendStatement(con, <font></font>
                        paste0(<span class="hljs-string">'
                               DELETE 
                               FROM '</span>,<font></font>
                               DBParams$TblName,<font></font>
                               <span class="hljs-string">' WHERE "Id"=?
                               '</span>) <span class="hljs-comment"># paste</span>
                        ) <span class="hljs-comment"># send</span><font></font>
<font></font>
  <span class="hljs-comment">#     </span><font></font>
  dbBind(delete, remove_Id)<font></font>
<font></font>
  <span class="hljs-comment">#   </span><font></font>
  dbClearResult(delete)<font></font>
<font></font>
} <span class="hljs-comment"># if</span><font></font>
<font></font>
<span class="hljs-comment">####   ####</span><font></font>
<font></font>
<span class="hljs-comment">#  ,  ,   .</span><font></font>
allVM_add &lt;- ctable_VM$comparison_df %&gt;% <font></font>
  filter(chng_type == <span class="hljs-string">"+"</span>) %&gt;% <font></font>
  select(-chng_type)<font></font>
<font></font>
<span class="hljs-comment"># ,   ,      (  -  )</span>
<span class="hljs-keyword">if</span> (allVM_add %&gt;% nrow() &gt; <span class="hljs-number">0</span>) {
  <span class="hljs-comment">#      </span><font></font>
  dbWriteTable(con,<font></font>
               DBParams$TblName,<font></font>
               allVM_add,<font></font>
               overwrite = FALSE,<font></font>
               append = TRUE)<font></font>
<font></font>
} <span class="hljs-comment"># if</span><font></font>
<font></font>
<span class="hljs-comment">####     ####</span>
dbDisconnect(con)</code></pre></div></div><br>
<h4 id="itogo"></h4><br>
<p>   ,        .     ,            2  .</p><br>
<p>       .</p><br>
<p>,        " ",   ,     ,  , .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rã¯ã€çµ±è¨ˆçš„ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã ã‘ã§ãªãã€ä»–ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é–“ã®å„ªã‚ŒãŸã€Œãƒ¬ã‚¤ã‚¤ãƒ³ã‚°ã€ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ç´ æ™´ã‚‰ã—ã„ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«è¨€èªã§ã‚ã‚‹ã“ã¨ãŒè¨¼æ˜ã•ã‚Œã¾ã—ãŸã€‚</font></font></p><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/g6/bn/1i/g6bn1ijgn9x3_e2nhnjq6jk5bdw.jpeg"></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja454384/index.html">ãƒ¬ãƒ¼ã‚¶ãƒ¼è¦–åŠ›çŸ¯æ­£-ã‚¹ãƒã‚¤ãƒ«æ³•ã¯æœ¬å½“ã«åŠ¹æœçš„ã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja454388/index.html">ARAï¼šç›´ç·šä¸Šã®ãƒã‚¤ãƒ³ãƒˆã®æœ€å¤§æ•°ã‚’è¦‹ã¤ã‘ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </a></li>
<li><a href="../ja454394/index.html">ãƒŸãƒ‹ãƒãƒªã‚¹ãƒˆ4ãƒ‘ãƒ¼ãƒˆMIDIãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼</a></li>
<li><a href="../ja454396/index.html">ä¸»è¦ãªãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«sdl2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></li>
<li><a href="../ja454398/index.html">æ‰¹è©•å®¶ã‹ã‚‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¸ï¼šæ°‘ä¸»ä¸»ç¾©ã¨ãƒ†ã‚¯ãƒã‚¯ãƒ©ã‚·ãƒ¼ãŒéŸ³æ¥½æ¥­ç•Œã«ã©ã®ã‚ˆã†ã«ã‚„ã£ã¦ããŸã‹</a></li>
<li><a href="../ja454402/index.html">ãƒ¦ãƒ‹ãƒƒãƒˆã®å‹•ä½œã‚’æ•´ç†ã™ã‚‹ãŸã‚ã®Unityã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</a></li>
<li><a href="../ja454404/index.html">Cisco 200-125 CCNA v3.0ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€‚6æ—¥ç›®ï¼šç©ºç™½ã‚’å…¥åŠ›ã—ã¾ã™ï¼ˆDHCPã€TCPã€ã€Œãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã€ã€ä¸€èˆ¬çš„ãªãƒãƒ¼ãƒˆç•ªå·ï¼‰</a></li>
<li><a href="../ja454406/index.html">ç§‹è‘‰åŸï¼šã‚ªã‚¿ã‚¯å–¶å·£åœ°</a></li>
<li><a href="../ja454408/index.html">CortexM3 / M4ï¼ˆARMï¼‰ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ“ãƒƒãƒˆãƒãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚«ãƒ¼ãƒãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã€C / C ++ 14ã€ãŠã‚ˆã³ä¸€é€£ã®ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</a></li>
<li><a href="../ja454410/index.html">PHP 7.4ã®æ–°æ©Ÿèƒ½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>