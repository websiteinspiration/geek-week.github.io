<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☢️ 🍷 🆘 Geokodierung Wie binde ich in 10 Minuten 250.000 Adressen an Koordinaten? 👨🏽‍✈️ 🧔🏾 👨🏼‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 
 
 In diesem Artikel möchte ich meine Erfahrungen bei der Lösung eines kleinen Problems mit einer großen Anzahl von Adressen teilen. Wenn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Geokodierung Wie binde ich in 10 Minuten 250.000 Adressen an Koordinaten?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499990/"><img src="https://habrastorage.org/webt/6b/g3/oo/6bg3ooc_jcrhty63bg_33x8inta.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel möchte ich meine Erfahrungen bei der Lösung eines kleinen Problems mit einer großen Anzahl von Adressen teilen. </font><font style="vertical-align: inherit;">Wenn Sie jemals mit der Geokodierungs-API gearbeitet oder Online-Tools verwendet haben, dann teilen Sie wahrscheinlich meinen Schmerz, mehrere Stunden oder sogar länger auf das Ergebnis zu warten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier geht es nicht um komplexe Optimierungsalgorithmen, sondern um die Verwendung eines Paket-Geokodierungsdienstes, der eine Liste von Adressen als Eingabe verwendet und eine Datei mit den Ergebnissen zurückgibt. </font><font style="vertical-align: inherit;">Dies kann die Verarbeitungszeit von einigen Stunden auf Minuten verkürzen.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das wichtigste zuerst:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrund</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch-Geokodierung</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auswählen eines Paket-Geocoder-Anbieters</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python-Servicehandbuch</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung der vollständigen Chargenklasse</font></font></h3></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisanalyse</font></font></h3></a></li>
</ul><br>
<a name="history"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrund</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Aufgabe kam - "Binden Sie an die Koordinaten von 24 Tausend Adressen." </font><font style="vertical-align: inherit;">Es gab nur zwei Lösungen für das Problem:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webanwendung für Geokodierung, die an der Universität verwendet wurde;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie ein Skript, das auf der REST-API des Geocoders basiert.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im ersten Fall stellte sich heraus, dass die Webanwendung nach der Verarbeitung von Tausenden von Adressen abstürzt. Das Verteilen eines Datensatzes zwischen Kollegen ist eine Idee, die sofort aufgegeben wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher müssen Sie die REST-API des Geocoders verwenden, um Ihr eigenes Skript zu schreiben, wobei die Ergebnisse gespeichert werden (dies ist kein völlig legaler Weg und Sie müssen die Nutzungsbedingungen des Dienstes lesen). Ein neues Problem tritt auf - es ist eine Sache, wenn wir die Adressensuche in der Anwendung verwenden und sofort das Ergebnis erhalten, aber wenn die Aufgabe darin besteht, mehr als zehntausend Adressen unter Beibehaltung zu verarbeiten, verzögert sich die Arbeit des Skripts erheblich. Sie können ein oder zwei Stunden warten, aber eine Million Adressen müssen "immense Zeit" geocodieren, also müssen Sie nach einer anderen Lösung suchen und das ist es!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Große Anbieter von Geolokalisierungsdiensten bieten zusätzlich zum üblichen Geokodierungsdienst einen Paket-Geocoder (Batch-Geocoder) an, um eine große Anzahl von Adressen in einer Anfrage zu verarbeiten.</font></font><br>
<br>
<a name="batch"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batch-Geokodierung</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Name des Dienstes spricht für sich - wir haben ein Paket (zum Beispiel eine CSV-Datei mit einer Liste von Adressen in Form einer Tabelle), das wir auf den Server hochladen und das die ganze Arbeit für uns erledigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Prozess sieht folgendermaßen aus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorbereiten des Datensatzes, damit der Dienst ihn fehlerfrei akzeptiert;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einstellen der Parameter des Arbeitsergebnisses (Auswahl der Spalten, Trennzeichen ...);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie eine Datei in die Cloud hoch.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten auf den Abschluss der Verarbeitung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laden Sie die fertige Datei herunter.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank der Cloud-Computing-Leistung ist das, was mit einem selbst geschriebenen Skript in 1 Stunde erledigt wird, in 1 Minute erledigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste Schritt besteht darin, das Unternehmen mit den loyalsten Nutzungsbedingungen für den Paket-Geocoder auszuwählen. </font><font style="vertical-align: inherit;">Erstens hat nicht jeder einen solchen Dienst, andere erlauben es Ihnen, den Dienst mit einer ernsthaften Einschränkung zu testen. </font><font style="vertical-align: inherit;">Wenn Sie sehr große Mengen haben, müssen Sie auch die Kosten für zusätzliche Transaktionen berücksichtigen, falls das Limit des kostenlosen Pakets überschritten wird.</font></font><br>
<br>
<a name="provider"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auswählen eines Batch-Geokodierungsdienstanbieters</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem globalen Markt für Geolokalisierungsdienste sind die führenden Positionen besetzt mit: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Maps</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HIER Technologien; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MapBox</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TomTom </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESRI.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich sollten Sie Yandex Technologies nicht vergessen, das in Russland eine ziemlich starke Position einnimmt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die folgenden Parameter als Grundlage für die Auswahl eines Anbieters herangezogen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Anzahl der Anfragen an den Geokodierungsdienst pro Monat ist kostenlos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begrenzung der Anzahl der Transaktionen pro Tag;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verfügbarkeit des Batch-Geokodierungsdienstes;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Möglichkeit, einen Paket-Geocoder in einem kostenlosen Plan zu verwenden. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jedes Unternehmen hat sein eigenes Monetarisierungsmodell. </font><font style="vertical-align: inherit;">Je nach Projekt kann das eine oder andere Modell in die Hände spielen oder umgekehrt eine erhebliche Einschränkung darstellen.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Maps</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um mit den Google Geo-Diensten zu beginnen, müssen Sie zunächst Ihrem Konto Kreditkarteninformationen hinzufügen. Ein monatliches Limit von 200 virtuellen Dollar, dann kommt die Zahlung zusätzlicher Transaktionen von der verknüpften Karte. Innerhalb dieser Grenze können Sie verschiedene Dienste nutzen, aber jede Transaktion wird anders betrachtet. Zum Beispiel kosten eintausend Geokodierungsanfragen 5 US-Dollar, aber der Routenaufbau ist doppelt so teuer. Weitere Details finden Sie auf der Website, wir interessieren uns nur für den Geokodierungsdienst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei 200 USD pro Monat ist es einfach, die kostenlose Anzahl von Transaktionen zu berechnen - 40.000 (Geokodierungsdienst). </font><font style="vertical-align: inherit;">Es gibt keinen Paket-Geocoder unter den Diensten. </font><font style="vertical-align: inherit;">Dies bedeutet, dass Sie Ihr eigenes Skript schreiben müssen. Das Ergebnis ist ungefähr 1 Adresse pro Sekunde, was sechs Stunden für 24.000 Adressen entspricht. </font><font style="vertical-align: inherit;">Um den Prozess zu beschleunigen, können Sie versuchen, das Skript auf der Google Cloud APIs-Plattform auszuführen. Ich habe mich jedoch entschlossen, nach alternativen Lösungen zu suchen. </font><font style="vertical-align: inherit;">Die Anzahl der Transaktionen pro Tag unterliegt keinen Einschränkungen, sodass alle vierzigtausend gleichzeitig ausgegeben werden können.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HIER Technologien</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Vergangenheit bietet Nokia Maps und in der noch tieferen Vergangenheit Navteq jeden Monat 250.000 Transaktionen kostenlos an. Ähnlich wie bei Google Maps gilt diese Nummer für alle Dienste und wird jeweils unterschiedlich betrachtet. Wenn Sie das kostenlose Paket verwenden, müssen Sie keine Bankkarte anhängen. Wenn Sie das Limit überschreiten, müssen Sie für jede weiteren tausend Transaktionen 1 US-Dollar bezahlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig, einen Paket-Geocoder als separaten Dienst zu haben, der im kostenlosen Plan enthalten ist. Die darin enthaltenen Transaktionen werden nach demselben Modell wie im üblichen Modell berücksichtigt, dh nach jeder Adresse in der Datei, die der Paket-Geocoder in einer Transaktion wahrnimmt.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus dem Titel des Artikels geht hervor, dass ich den HERE-Batch-Geocoder verwendet habe, da Sie alle Transaktionen für den Geocoder ausgeben und 250.000 Geokodierungsvorgänge pro Monat ausführen können. </font><font style="vertical-align: inherit;">Dies ist jedoch nicht die einzige Option, daher schauen wir uns an, was andere Unternehmen haben.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapbox</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Verwendung des MapBox-Geocoders stehen 100.000 Transaktionen pro Monat zur Verfügung. </font><font style="vertical-align: inherit;">Das Unternehmen hält an demselben Monetarisierungsmodell fest und zahlt für zusätzliche Transaktionen. </font><font style="vertical-align: inherit;">Nur für „Großhändler“ gibt es eine interessante Option - je mehr Transaktionen Sie haben, desto weniger kosten sie (natürlich gibt es eine Preissenkungsgrenze). </font><font style="vertical-align: inherit;">Beispielsweise kosten von 100.000 bis 500.000 weitere tausend Anfragen 0,75 USD, von 500.000 bis 1 Million USD - 0,60 USD. Weitere Informationen finden Sie auf der Website. </font><font style="vertical-align: inherit;">Batch-Geocoder ist leider nur auf einem kostenpflichtigen Konto verfügbar.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomtom</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Plattform ermöglicht die Durchführung von 2500 Transaktionen pro Tag, ungefähr 75.000 pro Monat. </font><font style="vertical-align: inherit;">Während des Testens und der Entwicklung sieht das Tageslimit im Vergleich zu Wettbewerbern nicht sehr attraktiv aus, aber die Zahlung für zusätzliche Transaktionen ist am flexibelsten. </font><font style="vertical-align: inherit;">Es gibt 8 Zahlungsoptionen für zusätzliche tausend Anfragen und der Preis wird von 0,5 USD auf 0,42 USD reduziert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter den Diensten gibt es einen Batch-Geocoder mit der Fähigkeit, bis zu 10.000 Adressen pro Anfrage zu verarbeiten (das Tageslimit muss jedoch berücksichtigt werden).</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex Technologies</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Modell mit einem täglichen Transaktionslimit für Yandex, aber loyaleren 25.000 Anfragen. </font><font style="vertical-align: inherit;">Wenn Sie diese Zahl mit der Anzahl der Tage in einem Monat multiplizieren, erhalten Sie eine beeindruckende Zahl von 750.000. </font><font style="vertical-align: inherit;">Die Website bietet Preise für weitere tausend Transaktionen in Rubel im Bereich von 120 Rubel. </font><font style="vertical-align: inherit;">bis zu 11 Rubel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Packet Geocoder als Service wird nicht vorgestellt, daher schlägt eine Optimierung fehl.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESRI</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein sehr verlockender kostenloser Plan mit 1 Million Transaktionen pro Monat. </font><font style="vertical-align: inherit;">Das Unternehmen belastet außerdem jedes Konto mit 50 Gutschriften (ungefähr 5 US-Dollar). </font><font style="vertical-align: inherit;">Es ist erwähnenswert, dass dies der loyalste Plan für die Nutzung von Geolokalisierungsdiensten ist. </font><font style="vertical-align: inherit;">Es gibt auch einen Batch-Geokodierungsdienst, den Sie jedoch nur verwenden können, wenn Sie über ein Unternehmenskonto auf der ArcGIS Online-Plattform verfügen.</font></font><br>
<br>
<h4><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was soll man am Ende wählen?</font></font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am einfachsten ist es, eine Auswahl zu treffen, indem Sie eine kleine Tabelle zusammenstellen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kg/xy/b1/kgxyb1kmzemqxqicwajfi7hggva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher fiel meine Auswahl auf HIER, da dies die beste Option zur Lösung meines Problems ist. </font><font style="vertical-align: inherit;">Natürlich habe ich keine vollständige Analyse durchgeführt. Idealerweise müssen Sie Ihren Datensatz durch alle Geocodierer laufen lassen, um die Qualität zu bewerten. </font><font style="vertical-align: inherit;">Wenn Sie mehrere Millionen Adressen haben, sollten Sie über ein kostenpflichtiges Paket nachdenken und dann die Kosten für das Hinzufügen berücksichtigen. </font><font style="vertical-align: inherit;">Transaktionen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Artikel dient nicht dazu, Unternehmen zu vergleichen, sondern das Problem der Optimierung der Geokodierung eines großen Adressvolumens zu lösen. </font><font style="vertical-align: inherit;">Ich habe nur meine Gedanken bei der Auswahl eines Dienstleisters gezeigt.</font></font><br>
<br>
<a name="guide"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python-Servicehandbuch</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst müssen Sie im Portal ein Konto für Entwickler erstellen und im Projektabschnitt einen REST-API-SCHLÜSSEL generieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können Sie mit der Plattform arbeiten. </font><font style="vertical-align: inherit;">Ich werde nur einen Teil der Funktionalität beschreiben, die der HERE-Paket-Geocoder bietet: Laden von Daten, Statusprüfung, Speichern von Ergebnissen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir also mit dem Importieren der erforderlichen Bibliotheken:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> zipfile
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn keine Fehler aufgetreten sind, erstellen Sie eine Klasse:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Batch</span>:</span><font></font>
<font></font>
    SERVICE_URL = <span class="hljs-string">"https://batch.geocoder.ls.hereapi.com/6.2/jobs"</span>
    jobId = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, apikey=<span class="hljs-string">"your_api_key"</span></span>):</span><font></font>
        self.apikey = apikey<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, während der Initialisierung muss die Klasse ihren eigenen Schlüssel für die REST-API übergeben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Variable SERVICE_URL ist die Basis-URL für die Arbeit mit dem Batch-Geokodierungsdienst. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und in jobId wird die Kennung der aktuellen Arbeit des Geocoders gespeichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein wichtiger Punkt ist die korrekte Datenstruktur auf Anfrage. </font><font style="vertical-align: inherit;">Die Datei muss zwei erforderliche Spalten enthalten: recId und searchText. </font><font style="vertical-align: inherit;">Andernfalls gibt der Dienst eine Antwort mit Informationen zum Downloadfehler zurück. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein Beispieldatensatz:</font></font><br>
<br>
<pre><code class="plaintext hljs">   recId; searchText<font></font>
   1; -, . , 6<font></font>
   2; ,  1,  -., 72<font></font>
   3; 425 W Randolph St Chicago IL 60606<font></font>
   4; , DJ106 20-30, Sibiu 557260<font></font>
   5; 200 S Mathilda Ave Sunnyvale CA 94086<font></font>
  </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funktion zum Hochladen einer Datei in die Cloud:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self, filename, indelim=<span class="hljs-string">";"</span>, outdelim=<span class="hljs-string">";"</span></span>):</span><font></font>
        <font></font>
        file = open(filename, <span class="hljs-string">'rb'</span>)<font></font>
<font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"run"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,
            <span class="hljs-string">"politicalview"</span>:<span class="hljs-string">"RUS"</span>,
            <span class="hljs-string">"gen"</span>: <span class="hljs-number">9</span>,
            <span class="hljs-string">"maxresults"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"header"</span>: <span class="hljs-string">"true"</span>,
            <span class="hljs-string">"indelim"</span>: indelim,
            <span class="hljs-string">"outdelim"</span>: outdelim,
            <span class="hljs-string">"outcols"</span>: <span class="hljs-string">"displayLatitude,displayLongitude,locationLabel,houseNumber,street,district,city,postalCode,county,state,country"</span>,
            <span class="hljs-string">"outputcombined"</span>: <span class="hljs-string">"true"</span>,<font></font>
        }<font></font>
<font></font>
        response = requests.post(self.SERVICE_URL, params=params, data=file)<font></font>
        self.__stats (response)<font></font>
        file.close()<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist ganz einfach, öffnen Sie eine Datei mit einer Liste von Adressen zum Lesen, bilden Sie ein Wörterbuch mit GET-Anforderungsparametern. </font><font style="vertical-align: inherit;">Einige Parameter sind erklärenswert:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aktion": "Ausführen" - Start der Adressverarbeitung;</font></font></li>
<li>“politicalView”: “RUS” –    .         (    );</li>
<li>“gen”: 9 –   (   );</li>
<li>“maxresults”: 1 –          ;</li>
<li>“header”: true –        ;</li>
<li>“indelim”: “;” –   ,  ;</li>
<li>“outdelim”: “;” –    ;</li>
<li>“outcols”: “” –  ,      ;</li>
<li>“outcombined”: true –                .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Senden Sie als Nächstes einfach eine Anfrage über die Anforderungsbibliothek und zeigen Sie Statistiken an. </font><font style="vertical-align: inherit;">Natürlich müssen Sie die Datei am Ende der Funktion schließen. </font><font style="vertical-align: inherit;">Die Funktion __stats analysiert die Antwort des Servers, die die ID der laufenden Arbeit enthält, und zeigt auch allgemeine Informationen zum Vorgang an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste Schritt besteht darin, den Status der Arbeit zu überprüfen. </font><font style="vertical-align: inherit;">Die Anforderung wird auf ähnliche Weise gebildet, nur ist es erforderlich, die Operations-ID zu übertragen. </font><font style="vertical-align: inherit;">Der Aktionsparameter muss den Wert „Status“ enthalten. </font><font style="vertical-align: inherit;">Die Funktion __stats zeigt der Konsole vollständige Statistiken an, um die Abschaltzeit des Geocoders abzuschätzen.</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">status</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        statusUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId<font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"status"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,<font></font>
        }<font></font>
        <font></font>
        response = requests.get(statusUrl, params=params)<font></font>
        self.__stats (response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der wichtigsten Funktionen ist das Speichern des Ergebnisses. </font><font style="vertical-align: inherit;">Der Einfachheit halber ist es besser, die vom Server stammende Datei sofort zu entpacken. </font><font style="vertical-align: inherit;">Die Anforderung zum Speichern der Datei ist identisch mit der Überprüfung des Status. Fügen Sie am Ende einfach / result hinzu.</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        print(<span class="hljs-string">"Requesting result data ..."</span>)<font></font>
        <font></font>
        resultUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId + <span class="hljs-string">"/result"</span><font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"apiKey"</span>: self.apikey<font></font>
        }<font></font>
        <font></font>
        response = requests.get(resultUrl, params=params, stream=<span class="hljs-literal">True</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (response.ok):    <font></font>
            zipResult = zipfile.ZipFile(io.BytesIO(response.content))<font></font>
            zipResult.extractall()<font></font>
            print(<span class="hljs-string">"File saved successfully"</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Error"</span>)<font></font>
            print(response.text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzte Funktion zum Parsen der Antwort des Dienstes. </font><font style="vertical-align: inherit;">Ihre Aufgabe ist es auch, die Kennung der aktuellen Geokodierungsaufgabe zu speichern:</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stats</span> (<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> (response.ok):<font></font>
            parsedXMLResponse = BeautifulSoup(response.text, <span class="hljs-string">"lxml"</span>)<font></font>
<font></font>
            self.jobId = parsedXMLResponse.find(<span class="hljs-string">'requestid'</span>).get_text()<font></font>
            <font></font>
            <span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> parsedXMLResponse.find(<span class="hljs-string">'response'</span>).findChildren():
                <span class="hljs-keyword">if</span>(len(stat.findChildren()) == <span class="hljs-number">0</span>):<font></font>
                    print(<span class="hljs-string">"{name}: {data}"</span>.format(name=stat.name, data=stat.get_text()))<font></font>
<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(response.text)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Führen Sie zum Testen einfach den Python-Interpreter im Skriptordner aus. </font><font style="vertical-align: inherit;">Die Batch-Klasse befindet sich in der Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geocoder.py</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; from geocoder import Batch<font></font>
&gt;&gt;&gt; service = Batch(apikey="   REST API")<font></font>
&gt;&gt;&gt; service.start("big_data_addresses.csv", indelim=";", outdelim=";")<font></font>
<font></font>
requestid: "  Id "<font></font>
status: accepted<font></font>
totalcount: 0<font></font>
validcount: 0<font></font>
invalidcount: 0<font></font>
processedcount: 0<font></font>
pendingcount: 0<font></font>
successcount: 0<font></font>
errorcount: 0<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Großartige Arbeit hat begonnen. </font><font style="vertical-align: inherit;">Überprüfen Sie den Status:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; service.status()<font></font>
<font></font>
requestid: "  Id "<font></font>
status: completed<font></font>
jobstarted: 2020-04-27T10:09:58.000Z<font></font>
jobfinished: 2020-04-27T10:17:18.000Z<font></font>
totalcount: 249999<font></font>
validcount: 249999<font></font>
invalidcount: 0<font></font>
processedcount: 249999<font></font>
pendingcount: 0<font></font>
successcount: 249978<font></font>
errorcount: 21<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen, dass die Verarbeitung des Datensatzes abgeschlossen ist. </font><font style="vertical-align: inherit;">In nur sieben Minuten konnten die 250.000 Adressen proklamiert werden (ohne Fehler - Fehleranzahl). </font><font style="vertical-align: inherit;">Es bleibt, um die Ergebnisse zu speichern:</font></font><br>
<br>
<pre><code class="plaintext hljs">&gt;&gt;&gt; service.result()<font></font>
Requesting result data ...<font></font>
File saved successfully<font></font>
</code></pre><br>
<a name="code"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung der vollständigen Chargenklasse</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, es tut nicht weh, das Skript vollständig hinzuzufügen:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> zipfile
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Batch</span>:</span><font></font>
<font></font>
    SERVICE_URL = <span class="hljs-string">"https://batch.geocoder.ls.hereapi.com/6.2/jobs"</span>
    jobId = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, apikey=<span class="hljs-string">"   REST API "</span></span>):</span><font></font>
        self.apikey = apikey<font></font>
        <font></font>
            <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self, filename, indelim=<span class="hljs-string">";"</span>, outdelim=<span class="hljs-string">";"</span></span>):</span><font></font>
        <font></font>
        file = open(filename, <span class="hljs-string">'rb'</span>)<font></font>
<font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"run"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,
            <span class="hljs-string">"politicalview"</span>:<span class="hljs-string">"RUS"</span>,
            <span class="hljs-string">"gen"</span>: <span class="hljs-number">9</span>,
            <span class="hljs-string">"maxresults"</span>: <span class="hljs-string">"1"</span>,
            <span class="hljs-string">"header"</span>: <span class="hljs-string">"true"</span>,
            <span class="hljs-string">"indelim"</span>: indelim,
            <span class="hljs-string">"outdelim"</span>: outdelim,
            <span class="hljs-string">"outcols"</span>: <span class="hljs-string">"displayLatitude,displayLongitude,locationLabel,houseNumber,street,district,city,postalCode,county,state,country"</span>,
            <span class="hljs-string">"outputcombined"</span>: <span class="hljs-string">"true"</span>,<font></font>
        }<font></font>
<font></font>
        response = requests.post(self.SERVICE_URL, params=params, data=file)<font></font>
        self.__stats (response)<font></font>
        file.close()<font></font>
    <font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">status</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        statusUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId<font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"action"</span>: <span class="hljs-string">"status"</span>,
            <span class="hljs-string">"apiKey"</span>: self.apikey,<font></font>
        }<font></font>
        <font></font>
        response = requests.get(statusUrl, params=params)<font></font>
        self.__stats (response)<font></font>
        <font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span> (<span class="hljs-params">self, jobId = None</span>):</span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> jobId <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.jobId = jobId<font></font>
        <font></font>
        print(<span class="hljs-string">"Requesting result data ..."</span>)<font></font>
        <font></font>
        resultUrl = self.SERVICE_URL + <span class="hljs-string">"/"</span> + self.jobId + <span class="hljs-string">"/result"</span><font></font>
        <font></font>
        params = {<font></font>
            <span class="hljs-string">"apiKey"</span>: self.apikey<font></font>
        }<font></font>
        <font></font>
        response = requests.get(resultUrl, params=params, stream=<span class="hljs-literal">True</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (response.ok):    <font></font>
            zipResult = zipfile.ZipFile(io.BytesIO(response.content))<font></font>
            zipResult.extractall()<font></font>
            print(<span class="hljs-string">"File saved successfully"</span>)<font></font>
        <font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(<span class="hljs-string">"Error"</span>)<font></font>
            print(response.text)<font></font>
    <font></font>
<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stats</span> (<span class="hljs-params">self, response</span>):</span>
        <span class="hljs-keyword">if</span> (response.ok):<font></font>
            parsedXMLResponse = BeautifulSoup(response.text, <span class="hljs-string">"lxml"</span>)<font></font>
<font></font>
            self.jobId = parsedXMLResponse.find(<span class="hljs-string">'requestid'</span>).get_text()<font></font>
            <font></font>
            <span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> parsedXMLResponse.find(<span class="hljs-string">'response'</span>).findChildren():
                <span class="hljs-keyword">if</span>(len(stat.findChildren()) == <span class="hljs-number">0</span>):<font></font>
                    print(<span class="hljs-string">"{name}: {data}"</span>.format(name=stat.name, data=stat.get_text()))<font></font>
<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            print(response.text)<font></font>
</code></pre><br>
<a name="result"></a><h3><font color="#9cc2ce"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisanalyse</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen wechselte ich von langsam arbeitenden Online-Anwendungen zu Batch-Geokodierungsdiensten. </font><font style="vertical-align: inherit;">Die Wahl eines Geodienstleisters hängt ganz von den Aufgaben ab, mit denen Sie konfrontiert sind. </font><font style="vertical-align: inherit;">Ich erhalte regelmäßig Anfragen zur Verarbeitung einer großen Anzahl von Adressen, und der im Artikel beschriebene Ansatz hat dazu beigetragen, die Zeit erheblich zu verkürzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass dieser Artikel nützlich sein wird und bin natürlich offen für Kommentare und Ergänzungen!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499974/index.html">3D-Spiele auf Instagram Javascript oder Wurstflugbahn</a></li>
<li><a href="../de499978/index.html">Übersetzung von Andrew Un's Buch, Leidenschaft für maschinelles Lernen, Kapitel 36 und 37</a></li>
<li><a href="../de499982/index.html">Anfänger-Tester-Plan: Von "IT eingeben" bis "Ich bin Ingenieur!"</a></li>
<li><a href="../de499986/index.html">Und noch einmal zu Embedded: Suche nach Fehlern im Embox-Projekt</a></li>
<li><a href="../de499988/index.html">Zucker und COVID-19</a></li>
<li><a href="../de499992/index.html">Designtechnologien zur Implementierung von Abrechnungssystemen für Firmenkunden (Teil 2)</a></li>
<li><a href="../de499994/index.html">Wenn das Coronavirus endet</a></li>
<li><a href="../de500000/index.html">Zum Radiotag. Kommunikation - die Nerven des Krieges</a></li>
<li><a href="../de500002/index.html">IT-Spezialisten gegen Verkäufer: und die Welt hat sich halbiert</a></li>
<li><a href="../de500008/index.html">Treffen Sie Upscaler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>