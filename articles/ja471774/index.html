<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚒 🤙🏾 🌱 ティーポットからのAndroid Camera2 API、パート2、ビデオの作成 💅🏼 ↪️ 🔏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私たちは引き続きCAMERA2 Android APIを扱います。
 前回の記事では、新しいAPIを使用して写真を撮るためにカメラをマスターしました。それではビデオを撮りましょう。一般的に、最初の私の目標は、Media Codecを使用してAndroidカメラからライブビデオをストリーミングすること...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ティーポットからのAndroid Camera2 API、パート2、ビデオの作成</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471774/"><img src="https://habrastorage.org/webt/kk/8_/gf/kk8_gf5d1vt1kyxcb_vkbjqwpnk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは引き続きCAMERA2 Android APIを扱います。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 前回の記事では、新しいAPIを使用して写真を撮るためにカメラをマスターしました。それではビデオを撮りましょう。一般的に、最初の私の目標は、Media Codecを使用してAndroidカメラからライブビデオをストリーミングすることでしたが、たまたま最初にMedia Recorderが登場し、最も立派な視聴者とどれだけうまくビデオクリップを記録できるかを共有したいと思いました。したがって、次回はストリーミングを開始しますが、ここでは新しいAPIにメディアレコーダーを追加する方法を理解します。彼に関する投稿はかなり平凡であることが判明したため、初心者と完璧なティーポットだけが猫の下を見ることができます。</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、メディアレコーダー</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/18/jb/si/18jbsij8rxc6kpxef3xfr7h9uug.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
クラスの名前と上記の写真からわかるように、オーディオまたはビデオのソースまたはすべてをまとめて記録し、最後にすべてを記録するために、必要なファイルの最も重要なアクセスが可能なメディアレコーダーが必要です。フォーマット。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの場合、タスクは簡単です。カメラとマイクからビデオとオーディオを取得し、MPEG_4形式のファイルに書き込みます。一部の変質者は、ネットワーク経由でビデオをドライブできるようにするために、Media Recorderのファイルの代わりにネットワークソケットを掌握していましたが、幸いにも、これらの洞窟の時間はすでに過去にあります。次の記事でも同じことを行いますが、これにはすでに文明化されたメディアコーデックを使用します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 誰もが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">2011年までの</font></a><font style="vertical-align: inherit;">以前のCamera APIを覚えているように</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それからMediaRecorderの接続は難しくありませんでした。</font><font style="vertical-align: inherit;">現在、問題は発生していません。</font><font style="vertical-align: inherit;">そして、カメラの全体的なスキームの写真に怖がらないでください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gu/c5/56/guc556ggwubf72480f69h-khi_q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カメラからの画像が表示されるSurfaceサーフェスにMedia Recorderを固定するだけで、すべてを自分で行います。</font><font style="vertical-align: inherit;">オーディオの場合、必要なフォーマットを設定するだけで、さらに簡単になります。メディアレコーダーは、あらゆる種類のコールバックで煩わされることなく、独自にサウンドを処理します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前回の投稿で日本人の友人が驚いたことを思い出してください：</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camera2が困惑する理由の1つは、1つのショットを撮るために使用する必要があるコールバックの数です。</font></font></blockquote><br>
 <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてここでは、逆に、</font><font style="vertical-align: inherit;">ビデオファイルを記録するために必要な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバックの数</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が驚くほど</font><b><font style="vertical-align: inherit;">少ないの</font></b><font style="vertical-align: inherit;">は驚くべきこと</font><font style="vertical-align: inherit;">です。 2つだけ。 Zemfiraが歌うように：「私はあなたのコールバックが最低限必要です。」</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、今度はそれらを</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ソースとして</font><b><font style="vertical-align: inherit;">記述します。</font></b><font style="vertical-align: inherit;">前の記事のコードを使用して、撮影に関連するすべてのものを破棄し、実際には、カメラの解像度と初期化のみを残します。また、カメラは1つだけ残します-正面。</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-keyword">private</span> CameraManager mCameraManager = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1 = <span class="hljs-number">0</span>;<font></font>
<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED)<font></font>
        ) {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.RECORD_AUDIO}, <span class="hljs-number">1</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
  mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//     </span><font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span> + cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager, cameraID);<font></font>
<font></font>
<font></font>
            }<font></font>
        } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
<font></font>
<font></font>
   <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mSession;
        <span class="hljs-keyword">private</span> CaptureRequest.Builder mPreviewBuilder;<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span> + mCameraDevice.getId());<font></font>
<font></font>
                <span class="hljs-comment">//startCameraPreviewSession();         Media Recorder</span><font></font>
            } <font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span> + mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span> + camera.getId() + <span class="hljs-string">" error:"</span> + error);<font></font>
            }<font></font>
        };<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ご覧のとおり、権限にRECORD_AUDIOオプションが追加されています。</font><font style="vertical-align: inherit;">メディアレコーダーがなければ、音声なしで裸のビデオのみを記録できます。</font><font style="vertical-align: inherit;">許可なくサウンド形式を指定しようとすると、まったく開始されません。</font><font style="vertical-align: inherit;">したがって、サウンドの録音などを許可します。もちろん、メインストリームの実際のコードでは、そのようなことは良いことではなく、デモでのみ良いことを思い出してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、別のメソッドでメディアレコーダー自体を初期化します</font></font></b><br>
<br>
<pre><code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUpMediaRecorder</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        mMediaRecorder = <span class="hljs-keyword">new</span> MediaRecorder();<font></font>
<font></font>
        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);<font></font>
        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);<font></font>
        mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);<font></font>
        mCurrentFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test"</span>+count+<span class="hljs-string">".mp4"</span>);<font></font>
        mMediaRecorder.setOutputFile(mCurrentFile.getAbsolutePath());<font></font>
        CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_480P);<font></font>
        mMediaRecorder.setVideoFrameRate(profile.videoFrameRate);<font></font>
        mMediaRecorder.setVideoSize(profile.videoFrameWidth, profile.videoFrameHeight);<font></font>
        mMediaRecorder.setVideoEncodingBitRate(profile.videoBitRate);<font></font>
        mMediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);<font></font>
        mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);<font></font>
        mMediaRecorder.setAudioEncodingBitRate(profile.audioBitRate);<font></font>
        mMediaRecorder.setAudioSamplingRate(profile.audioSampleRate);<font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mMediaRecorder.prepare();<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
<font></font>
        } <span class="hljs-keyword">catch</span> (Exception e) {<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも、すべてが明確で理解可能であり、説明は必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次は最も重要な段階です。SurfaceにMedia Recorderを追加します。</font><font style="vertical-align: inherit;">最後の投稿では、カメラからの画像をSurfaceに表示し、イメージリーダーを使用してそこからフレームを撮影しました。</font><font style="vertical-align: inherit;">これを行うには、Surfaceリストで両方のコンポーネントを指定するだけです。</font></font><br>
<br>
<pre><code class="java hljs">Arrays.asList(surface,mImageReader.getSurface())
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでも同じことを、ImageReaderの代わりに指定します。</font></font><br>
<br>
<pre><code class="java hljs">(Arrays.asList(surface, mMediaRecorder.getSurface()).<font></font>
<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこでは、一般的に、コンマ、使用するすべてのコンポーネント、さらにはメディアコーデックを使用して、あらゆるものをスカルプトできます。</font><font style="vertical-align: inherit;">つまり、1つのウィンドウで写真を撮り、ビデオを撮影してストリーミングすることができます。</font><font style="vertical-align: inherit;">表面が良い-可能。</font><font style="vertical-align: inherit;">確かに、すべてを同時に実行することは可能ですか？教えません。</font><font style="vertical-align: inherit;">理論的には、カメラの画像で判断すると-できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yj/nu/5l/yjnu5lirz9x8dqlsknioakgtjys.jpeg"><br>
 <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、異なるストリームに分散する必要があります。</font><font style="vertical-align: inherit;">だから実験のフィールドがあります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、実際には</font><b><font style="vertical-align: inherit;">Media Recorderに戻り</font></b><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">写真撮影とは異なり、撮影のための追加のリクエストは必要ありません。ImageSaverの類似物は必要ありません。私たちのハードワーカーレコーダーはすべてを自分で行います。</font><font style="vertical-align: inherit;">そして、それは素晴らしいことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、プログラムは完全にミニマリストな外観になります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.mediarecorder1;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.core.content.ContextCompat;
<span class="hljs-keyword">import</span> android.Manifest;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.pm.PackageManager;
<span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCaptureSession;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraDevice;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.CaptureRequest;
<span class="hljs-keyword">import</span> android.media.CamcorderProfile;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.media.MediaRecorder;
<span class="hljs-keyword">import</span> android.os.Environment;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.HandlerThread;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.TextureView;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.util.Arrays;<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;<font></font>
<font></font>
    CameraService[] myCameras = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> CameraManager mCameraManager = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count =<span class="hljs-number">1</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonRecordVideo = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonStopRecordVideo = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TextureView mImageView = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> HandlerThread mBackgroundThread;
    <span class="hljs-keyword">private</span> Handler mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> File mCurrentFile;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> MediaRecorder mMediaRecorder = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread = <span class="hljs-keyword">new</span> HandlerThread(<span class="hljs-string">"CameraBackground"</span>);<font></font>
        mBackgroundThread.start();<font></font>
        mBackgroundHandler = <span class="hljs-keyword">new</span> Handler(mBackgroundThread.getLooper());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread.quitSafely();<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mBackgroundThread.join();<font></font>
            mBackgroundThread = <span class="hljs-keyword">null</span>;<font></font>
            mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED)<font></font>
        ) {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.RECORD_AUDIO}, <span class="hljs-number">1</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
        mButtonOpenCamera1 = findViewById(R.id.button1);<font></font>
        mButtonRecordVideo = findViewById(R.id.button2);<font></font>
        mButtonStopRecordVideo = findViewById(R.id.button3);<font></font>
        mImageView = findViewById(R.id.textureView);<font></font>
<font></font>
        mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
        mButtonRecordVideo.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) &amp; mMediaRecorder != <span class="hljs-keyword">null</span>) {<font></font>
<font></font>
                    mMediaRecorder.start();<font></font>
<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mButtonStopRecordVideo.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) &amp; (mMediaRecorder != <span class="hljs-keyword">null</span>)) {<font></font>
                    myCameras[CAMERA1].stopRecordingVideo();<font></font>
                }<font></font>
<font></font>
<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//     </span><font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span> + cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager, cameraID);<font></font>
<font></font>
<font></font>
            }<font></font>
        } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
<font></font>
<font></font>
        setUpMediaRecorder();<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUpMediaRecorder</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        mMediaRecorder = <span class="hljs-keyword">new</span> MediaRecorder();<font></font>
<font></font>
        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);<font></font>
        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);<font></font>
        mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);<font></font>
        mCurrentFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test"</span>+count+<span class="hljs-string">".mp4"</span>);<font></font>
        mMediaRecorder.setOutputFile(mCurrentFile.getAbsolutePath());<font></font>
        CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_480P);<font></font>
        mMediaRecorder.setVideoFrameRate(profile.videoFrameRate);<font></font>
        mMediaRecorder.setVideoSize(profile.videoFrameWidth, profile.videoFrameHeight);<font></font>
        mMediaRecorder.setVideoEncodingBitRate(profile.videoBitRate);<font></font>
        mMediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);<font></font>
        mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);<font></font>
        mMediaRecorder.setAudioEncodingBitRate(profile.audioBitRate);<font></font>
        mMediaRecorder.setAudioSamplingRate(profile.audioSampleRate);<font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mMediaRecorder.prepare();<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
<font></font>
        } <span class="hljs-keyword">catch</span> (Exception e) {<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mSession;
        <span class="hljs-keyword">private</span> CaptureRequest.Builder mPreviewBuilder;<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span> + mCameraDevice.getId());<font></font>
<font></font>
                startCameraPreviewSession();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span> + mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span> + camera.getId() + <span class="hljs-string">" error:"</span> + error);<font></font>
            }<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
            texture.setDefaultBufferSize(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>);<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD);<font></font>
<font></font>
                <span class="hljs-comment">/**Surface for the camera preview set up*/</span><font></font>
<font></font>
                mPreviewBuilder.addTarget(surface);<font></font>
<font></font>
                <span class="hljs-comment">/**MediaRecorder setup for surface*/</span><font></font>
<font></font>
                Surface recorderSurface = mMediaRecorder.getSurface();<font></font>
<font></font>
                mPreviewBuilder.addTarget(recorderSurface);<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface, mMediaRecorder.getSurface()),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mSession = session;<font></font>
<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mSession.setRepeatingRequest(mPreviewBuilder.build(), <span class="hljs-keyword">null</span>, mBackgroundHandler);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                            }<font></font>
                        }, mBackgroundHandler);<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopRecordingVideo</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {<font></font>
                mSession.stopRepeating();<font></font>
                mSession.abortCaptures();<font></font>
                mSession.close();<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
<font></font>
            mMediaRecorder.stop();<font></font>
            mMediaRecorder.release();<font></font>
            count++;<font></font>
            setUpMediaRecorder();<font></font>
            startCameraPreviewSession();<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
                    mCameraManager.openCamera(mCameraID, mCameraCallback, mBackgroundHandler);<font></font>
<font></font>
                }<font></font>
<font></font>
<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG, e.getMessage());<font></font>
<font></font>
            }<font></font>
        }<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        stopBackgroundThread();<font></font>
        <span class="hljs-keyword">super</span>.onPause();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onResume();<font></font>
        startBackgroundThread();<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
}<font></font>
</code></pre><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それにレイアウトを追加</font></font></b><div class="spoiler_text"><pre><code class="java hljs">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;<font></font>
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    xmlns:app=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns:tools=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"match_parent"</span>
    tools:context=<span class="hljs-string">".MainActivity"</span>&gt;<font></font>
<font></font>
    &lt;TextureView<font></font>
        android:id=<span class="hljs-string">"@+id/textureView"</span>
        android:layout_width=<span class="hljs-string">"356dp"</span>
        android:layout_height=<span class="hljs-string">"410dp"</span>
        android:layout_marginTop=<span class="hljs-string">"32dp"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintHorizontal_bias=<span class="hljs-string">"0.49"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toTopOf=<span class="hljs-string">"parent"</span> /&gt;<font></font>
<font></font>
    &lt;LinearLayout<font></font>
        android:layout_width=<span class="hljs-string">"292dp"</span>
        android:layout_height=<span class="hljs-string">"145dp"</span>
        android:layout_marginStart=<span class="hljs-string">"16dp"</span>
        android:orientation=<span class="hljs-string">"vertical"</span>
        app:layout_constraintBottom_toBottomOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
        app:layout_constraintTop_toBottomOf=<span class="hljs-string">"@+id/textureView"</span>
        app:layout_constraintVertical_bias=<span class="hljs-string">"0.537"</span>&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button1"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button2"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
<font></font>
        &lt;Button<font></font>
            android:id=<span class="hljs-string">"@+id/button3"</span>
            android:layout_width=<span class="hljs-string">"match_parent"</span>
            android:layout_height=<span class="hljs-string">"wrap_content"</span>
            android:text=<span class="hljs-string">" "</span> /&gt;<font></font>
    &lt;/LinearLayout&gt;<font></font>
<font></font>
<font></font>
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;<font></font>
<font></font>
</code></pre><br>
<br>
</div></div><br>
<br>
<img src="https://habrastorage.org/webt/lw/fx/lc/lwfxlcrhoz15zhw5qcwwj5fssp0.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そしてマニフェストに少し追加</font></font></b><br>
<br>
<pre><code class="java hljs">&lt;uses-permission android:name=<span class="hljs-string">"android.permission.RECORD_AUDIO"</span>/&gt;<font></font>
<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが機能し、ファイルを正常に書き込みます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
唯一のことは、ばかからの保護がないということです。そのため、画面上のボタンをランダムな順序で突くのが不合理であれば、すべてを壊すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
投稿の公開後、好奇心旺盛な読者は、「記録を終了」ボタンをクリックした後、新しい記録を作成する前に、カメラ画像に顕著な遅れが存在することに気付きました。</font><font style="vertical-align: inherit;">一方、標準のAndroidカメラで同じことを行おうとすると、遅延は見られず、すべてが非常にスムーズになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
判明したように、遅延は2つの理由で発生します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つ目は、mSessionを再作成することです。</font><font style="vertical-align: inherit;">ご存知のように、カメラの新しい初期化には時間がかかります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つ目-メインの時間遅延は、メディアレコーダーのmMediaRecorder.stop（）の停止が非同期で実行されなかったことが原因でした。そして理論的には、それを背景にすべきです。しかし実際には、mSessionを再作成するにはまだmMediaRecorderの新しいインスタンスが必要であり、古いインスタンスを停止するまで取得できないため、背景もここでは役に立ちません。もちろん、mMediaRecorder1を閉じながら、特定のmMediaRecorder2を実行しようとすることもできますが、これはヒンドゥー教で信頼性の低いアプローチです。</font></font><br>
<br>
<blockquote>    MediaRecorder   afaik          .<br>
<br>
   ,    :<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">developer.android.com/reference/android/media/MediaRecorder.html</a><br>
<br>
         .<br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多分これはまだ事実であるか、多分それ以降状況が変わったかもしれませんが、いずれにせよ解決策があります。</font><font style="vertical-align: inherit;">一方、そうです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい記録が必要になるたびにCameraPreviewSession（）を閉じないようにします。</font><font style="vertical-align: inherit;">しかし、この場合、メディアレコーダーを停止すると、メディアレコーダーは自動的に閉じ、アプリケーションと共に、「メディアレコーダーの表面が失われました」とあざけって書き込みます。</font><font style="vertical-align: inherit;">それは論理的だったので、私たち自身が停止して閉じました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ここでは別のサーフェスを使用する必要があります-ラテン語のPersistentInputSurface（）または「</font><font style="vertical-align: inherit;">永続的な頑固な</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーフェス</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」。</font><font style="vertical-align: inherit;">メディアレコーダーが停止しても閉じませんが、引き続き動作します。</font><font style="vertical-align: inherit;">確かに、より具体的な処理が必要です（記事のコメントを参照）。ただし、遅延なく動作します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラグのないコードバリアント</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">package</span> com.example.mediarecorder1;
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.core.content.ContextCompat;
<span class="hljs-keyword">import</span> android.Manifest;
<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.content.pm.PackageManager;
<span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraAccessException;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraCaptureSession;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraDevice;
<span class="hljs-keyword">import</span> android.hardware.camera2.CameraManager;
<span class="hljs-keyword">import</span> android.hardware.camera2.CaptureRequest;
<span class="hljs-keyword">import</span> android.media.CamcorderProfile;
<span class="hljs-keyword">import</span> android.media.MediaCodec;
<span class="hljs-keyword">import</span> android.os.AsyncTask;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.media.MediaRecorder;
<span class="hljs-keyword">import</span> android.os.Environment;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.HandlerThread;
<span class="hljs-keyword">import</span> android.util.Log;
<span class="hljs-keyword">import</span> android.view.Surface;
<span class="hljs-keyword">import</span> android.view.TextureView;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.util.Arrays;<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AppCompatActivity</span> </span>{<font></font>
<font></font>
    Surface recorderSurface =<span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOG_TAG = <span class="hljs-string">"myLogs"</span>;<font></font>
<font></font>
    CameraService[] myCameras = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> CameraManager mCameraManager = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAMERA1 = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count =<span class="hljs-number">1</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> Button mButtonOpenCamera1 = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonRecordVideo = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Button mButtonStopRecordVideo = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TextureView mImageView = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> HandlerThread mBackgroundThread;
    <span class="hljs-keyword">private</span> Handler mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> File mCurrentFile;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> MediaRecorder mMediaRecorder = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread = <span class="hljs-keyword">new</span> HandlerThread(<span class="hljs-string">"CameraBackground"</span>);<font></font>
        mBackgroundThread.start();<font></font>
        mBackgroundHandler = <span class="hljs-keyword">new</span> Handler(mBackgroundThread.getLooper());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopBackgroundThread</span><span class="hljs-params">()</span> </span>{<font></font>
        mBackgroundThread.quitSafely();<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mBackgroundThread.join();<font></font>
            mBackgroundThread = <span class="hljs-keyword">null</span>;<font></font>
            mBackgroundHandler = <span class="hljs-keyword">null</span>;<font></font>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);<font></font>
        setContentView(R.layout.activity_main);<font></font>
<font></font>
<font></font>
        Log.d(LOG_TAG, <span class="hljs-string">" "</span>);
        <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)<font></font>
                ||<font></font>
                (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword">this</span>, Manifest.permission.RECORD_AUDIO) != PackageManager.PERMISSION_GRANTED)<font></font>
        ) {<font></font>
            requestPermissions(<span class="hljs-keyword">new</span> String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.RECORD_AUDIO}, <span class="hljs-number">1</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
        mButtonOpenCamera1 = findViewById(R.id.button1);<font></font>
        mButtonRecordVideo = findViewById(R.id.button2);<font></font>
        mButtonStopRecordVideo = findViewById(R.id.button3);<font></font>
        mImageView = findViewById(R.id.textureView);<font></font>
<font></font>
        mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera();<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
        mButtonRecordVideo.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) &amp; mMediaRecorder != <span class="hljs-keyword">null</span>) {<font></font>
<font></font>
<font></font>
<font></font>
                    mMediaRecorder.start();<font></font>
                    Log.i(LOG_TAG, <span class="hljs-string">"START"</span>);<font></font>
<font></font>
                }<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mButtonStopRecordVideo.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((myCameras[CAMERA1] != <span class="hljs-keyword">null</span>) &amp; (mMediaRecorder != <span class="hljs-keyword">null</span>)) {<font></font>
                    myCameras[CAMERA1].stopRecordingVideo();<font></font>
                    Log.i(LOG_TAG, <span class="hljs-string">"STOP"</span>);<font></font>
                }<font></font>
<font></font>
<font></font>
            }<font></font>
        });<font></font>
<font></font>
<font></font>
        mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);<font></font>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//     </span><font></font>
<font></font>
            myCameras = <span class="hljs-keyword">new</span> CameraService[mCameraManager.getCameraIdList().length];<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (String cameraID : mCameraManager.getCameraIdList()) {<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"cameraID: "</span> + cameraID);
                <span class="hljs-keyword">int</span> id = Integer.parseInt(cameraID);<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                myCameras[id] = <span class="hljs-keyword">new</span> CameraService(mCameraManager, cameraID);<font></font>
<font></font>
<font></font>
            }<font></font>
        } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
            Log.e(LOG_TAG, e.getMessage());<font></font>
            e.printStackTrace();<font></font>
        }<font></font>
<font></font>
<font></font>
        setUpMediaRecorder();<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUpMediaRecorder</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        mMediaRecorder = <span class="hljs-keyword">new</span> MediaRecorder();<font></font>
<font></font>
        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);<font></font>
        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);<font></font>
        mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);<font></font>
        mCurrentFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test"</span>+count+<span class="hljs-string">".mp4"</span>);<font></font>
        mMediaRecorder.setOutputFile(mCurrentFile.getAbsolutePath());<font></font>
        CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_480P);<font></font>
        mMediaRecorder.setVideoSize(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>);<font></font>
        mMediaRecorder.setVideoFrameRate(profile.videoFrameRate);<font></font>
        mMediaRecorder.setVideoSize(profile.videoFrameWidth, profile.videoFrameHeight);<font></font>
        mMediaRecorder.setVideoEncodingBitRate(profile.videoBitRate);<font></font>
        mMediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);<font></font>
        mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);<font></font>
        mMediaRecorder.setAudioEncodingBitRate(profile.audioBitRate);<font></font>
        mMediaRecorder.setAudioSamplingRate(profile.audioSampleRate);<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUpMediaRecorder2</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        mMediaRecorder = <span class="hljs-keyword">new</span> MediaRecorder();<font></font>
<font></font>
        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);<font></font>
        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);<font></font>
<font></font>
        mMediaRecorder.setInputSurface(recorderSurface);<font></font>
<font></font>
<font></font>
        mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);<font></font>
        mCurrentFile = <span class="hljs-keyword">new</span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string">"test"</span>+count+<span class="hljs-string">".mp4"</span>);<font></font>
        mMediaRecorder.setOutputFile(mCurrentFile.getAbsolutePath());<font></font>
        mMediaRecorder.setVideoSize(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>);<font></font>
        CamcorderProfile profile = CamcorderProfile.get(CamcorderProfile.QUALITY_480P);<font></font>
        mMediaRecorder.setVideoFrameRate(profile.videoFrameRate);<font></font>
        mMediaRecorder.setVideoSize(profile.videoFrameWidth, profile.videoFrameHeight);<font></font>
        mMediaRecorder.setVideoEncodingBitRate(profile.videoBitRate);<font></font>
        mMediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);<font></font>
        mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);<font></font>
        mMediaRecorder.setAudioEncodingBitRate(profile.audioBitRate);<font></font>
        mMediaRecorder.setAudioSamplingRate(profile.audioSampleRate);<font></font>
<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            mMediaRecorder.prepare();<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   2"</span>);<font></font>
<font></font>
        } <span class="hljs-keyword">catch</span> (Exception e) {<font></font>
            Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
        }<font></font>
<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CameraService</span> </span>{<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> String mCameraID;
        <span class="hljs-keyword">private</span> CameraDevice mCameraDevice = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">private</span> CameraCaptureSession mSession;
        <span class="hljs-keyword">private</span> CaptureRequest.Builder mPreviewBuilder;<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CameraService</span><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span> </span>{<font></font>
<font></font>
            mCameraManager = cameraManager;<font></font>
            mCameraID = cameraID;<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-keyword">private</span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword">new</span> CameraDevice.StateCallback() {<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onOpened</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice = camera;<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"Open camera  with id:"</span> + mCameraDevice.getId());<font></font>
<font></font>
                startCameraPreviewSession();<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">(CameraDevice camera)</span> </span>{<font></font>
                mCameraDevice.close();<font></font>
<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"disconnect camera  with id:"</span> + mCameraDevice.getId());<font></font>
                mCameraDevice = <span class="hljs-keyword">null</span>;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(CameraDevice camera, <span class="hljs-keyword">int</span> error)</span> </span>{<font></font>
                Log.i(LOG_TAG, <span class="hljs-string">"error! camera id:"</span> + camera.getId() + <span class="hljs-string">" error:"</span> + error);<font></font>
            }<font></font>
        };<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startCameraPreviewSession</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
            SurfaceTexture texture = mImageView.getSurfaceTexture();<font></font>
            texture.setDefaultBufferSize(<span class="hljs-number">640</span>, <span class="hljs-number">480</span>);<font></font>
            Surface surface = <span class="hljs-keyword">new</span> Surface(texture);<font></font>
<font></font>
<font></font>
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);<font></font>
<font></font>
                <span class="hljs-comment">/**Surface for the camera preview set up*/</span><font></font>
<font></font>
                mPreviewBuilder.addTarget(surface);<font></font>
<font></font>
                <span class="hljs-comment">/**MediaRecorder setup for surface*/</span><font></font>
<font></font>
<font></font>
              <span class="hljs-comment">//  Surface recorderSurface = mMediaRecorder.getSurface();</span><font></font>
<font></font>
                recorderSurface=MediaCodec.createPersistentInputSurface();<font></font>
                mMediaRecorder.setInputSurface(recorderSurface);<font></font>
<font></font>
<font></font>
<font></font>
                <span class="hljs-keyword">try</span> {<font></font>
                    mMediaRecorder.prepare();<font></font>
                    Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
<font></font>
                } <span class="hljs-keyword">catch</span> (Exception e) {<font></font>
                    Log.i(LOG_TAG, <span class="hljs-string">"   "</span>);<font></font>
                }<font></font>
                mPreviewBuilder.addTarget(recorderSurface);<font></font>
<font></font>
                mCameraDevice.createCaptureSession(Arrays.asList(surface,recorderSurface),<font></font>
                        <span class="hljs-keyword">new</span> CameraCaptureSession.StateCallback() {<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigured</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                                mSession = session;<font></font>
<font></font>
                                <span class="hljs-keyword">try</span> {<font></font>
                                    mSession.setRepeatingRequest(mPreviewBuilder.build(), <span class="hljs-keyword">null</span>, mBackgroundHandler);<font></font>
                                } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                                    e.printStackTrace();<font></font>
                                }<font></font>
                            }<font></font>
<font></font>
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigureFailed</span><span class="hljs-params">(CameraCaptureSession session)</span> </span>{<font></font>
                            }<font></font>
                        }, mBackgroundHandler);<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                e.printStackTrace();<font></font>
            }<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopRecordingVideo</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
            count++;<font></font>
            MyTask mt = <span class="hljs-keyword">new</span> MyTask();<font></font>
            mt.execute();<font></font>
<font></font>
<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (mCameraDevice == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openCamera</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">try</span> {<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {<font></font>
<font></font>
                    mCameraManager.openCamera(mCameraID, mCameraCallback, mBackgroundHandler);<font></font>
<font></font>
                }<font></font>
<font></font>
<font></font>
            } <span class="hljs-keyword">catch</span> (CameraAccessException e) {<font></font>
                Log.i(LOG_TAG, e.getMessage());<font></font>
<font></font>
            }<font></font>
        }<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPause</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        stopBackgroundThread();<font></font>
        <span class="hljs-keyword">super</span>.onPause();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onResume();<font></font>
        startBackgroundThread();<font></font>
<font></font>
    }<font></font>
<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">Void</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">Void</span>&gt; </span>{<font></font>
<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPreExecute</span><span class="hljs-params">()</span> </span>{<font></font>
<font></font>
        }<font></font>
<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">protected</span> Void <span class="hljs-title">doInBackground</span><span class="hljs-params">(Void... params)</span> </span>{<font></font>
            mMediaRecorder.stop();<font></font>
            mMediaRecorder.release();<font></font>
            setUpMediaRecorder2();<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPostExecute</span><span class="hljs-params">(Void result)</span> </span>{<font></font>
<font></font>
        }<font></font>
    }<font></font>
<font></font>
<font></font>
<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471756/index.html">サーバーの起動方法</a></li>
<li><a href="../ja471760/index.html">エドワードスノーデン：戦場-暗号化</a></li>
<li><a href="../ja471766/index.html">Kotlin / Javaエラー処理：それを正しく行う方法？</a></li>
<li><a href="../ja471770/index.html">ビッグデータツールの紹介：IntelliJ IDEAでのSparkおよびZeppelinノートブックのサポート</a></li>
<li><a href="../ja471772/index.html">Javaアプリケーションの起動と開発、JVMでのコンパイル、実行のためのツール</a></li>
<li><a href="../ja471776/index.html">Laravel：基本的な概念を説明してください。パート2：練習</a></li>
<li><a href="../ja471778/index.html">HackQuest 2019でMicosoft Lunixを壊す</a></li>
<li><a href="../ja471792/index.html">ウィザードは「通常の奇跡」のどこから来たのですか</a></li>
<li><a href="../ja471794/index.html">フラットシーリングマイクの時代</a></li>
<li><a href="../ja471796/index.html">少しの経験-多くのインタビュー：チームインタビューの実施方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>