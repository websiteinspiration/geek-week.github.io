<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✴️ 👨🏽‍💼 🤾🏾 كيفية بناء مسرع صاروخي لنصوص PowerCLI  🔀 👹 🎱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="عاجلاً أم آجلاً ، يتمكن أي مسؤول نظام VMware من أتمتة المهام الروتينية. يبدأ كل شيء من سطر الأوامر ، ثم يأتي PowerShell أو VMware PowerCLI. 
 
 افترض ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>كيفية بناء مسرع صاروخي لنصوص PowerCLI </h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/498628/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عاجلاً أم آجلاً ، يتمكن أي مسؤول نظام VMware من أتمتة المهام الروتينية. </font><font style="vertical-align: inherit;">يبدأ كل شيء من سطر الأوامر ، ثم يأتي PowerShell أو VMware PowerCLI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
افترض أنك أتقنت PowerShell أبعد قليلاً من بدء تشغيل ISE واستخدام cmdlets القياسية من الوحدات النمطية التي تعمل مع نوع من السحر. </font><font style="vertical-align: inherit;">عندما تبدأ في عد المئات من الأجهزة الافتراضية ، ستجد أن البرامج النصية التي ساعدت على النطاقات الصغيرة تعمل بشكل أبطأ بشكل ملحوظ على الأجهزة الكبيرة.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في هذه الحالة ، ستساعد أداتان:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell Runspaces</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - نهج يسمح لك بموازاة تنفيذ العمليات في سلاسل عمليات منفصلة ؛&nbsp;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-View</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> هي إحدى وظائف PowerCLI الأساسية ، وهي نظير لـ Get-WMIObject على Windows. </font><font style="vertical-align: inherit;">لا يقوم cmdlet هذا بسحب كائنات مرتبطة به ، ولكنه يتلقى معلومات في شكل كائن بسيط مع أنواع بيانات بسيطة. </font><font style="vertical-align: inherit;">في كثير من الحالات ، يخرج بشكل أسرع.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد ذلك ، سأتحدث باختصار عن كل أداة وأعرض أمثلة على الاستخدام. </font><font style="vertical-align: inherit;">سنقوم بتحليل نصوص محددة ونرى متى يعمل أحدها بشكل أفضل ، عندما يكون الثاني. </font><font style="vertical-align: inherit;">اذهب!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/2q/fe/xp2qfe2m-lyc8feedka2nyhc2sq.jpeg"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المرحلة الأولى: Runspace</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لذلك ، تم تصميم Runspace للمعالجة المتوازية للمهام خارج الوحدة الرئيسية. </font><font style="vertical-align: inherit;">بالطبع ، يمكنك بدء عملية أخرى تستهلك بعض الذاكرة والمعالج ، وما إلى ذلك. إذا تم تشغيل النص البرمجي الخاص بك في غضون دقيقتين وقضاء جيجابايت من الذاكرة ، فربما لن تحتاج إلى Runspace. </font><font style="vertical-align: inherit;">ولكن بالنسبة للنصوص الموجودة على عشرات الآلاف من الأشياء ، هناك حاجة إليها.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يمكنك البدء في التطوير من هنا:&nbsp; </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بدء استخدام PowerShell Runspaces: الجزء 1</font></font></a></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ما الذي يستخدم Runspace:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">السرعة بتحديد قائمة الأوامر القابلة للتنفيذ ،</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المهام الموازية</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">سلامة.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هنا مثال من الإنترنت عندما يساعد Runspace:</font></font><br>
<blockquote>«    –   ,     vSphere.  vCenter     ,      .  ,        PowerShell.<br>
 ,     VMware      vCenter          .&nbsp;&nbsp;<br>
  PowerShell runspaces,    ESXi          Runspace     .   PowerShell   ,        ,     ». <br>
<br>
<i>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">How to Show Virtual Machine I/O on an ESXi Dashboard</a></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الحالة أدناه ، لم يعد Runspace في العمل:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"أحاول كتابة نص برمجي يجمع الكثير من البيانات من الجهاز الظاهري ، وإذا لزم الأمر ، يكتب بيانات جديدة. </font><font style="vertical-align: inherit;">المشكلة هي أن هناك الكثير من VMs ، ويستغرق الأمر 5-8 ثوانٍ لآلة واحدة. "&nbsp;</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المصدر: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multithreading PowerCLI مع RunspacePool</font></font></a></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get-View مطلوب هنا ، دعنا ننتقل إليه.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المرحلة الثانية: Get-View</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لفهم فائدة Get-View ، تذكر كيفية عمل أوامر cmdlets بشكل عام.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك حاجة إلى Cmdlets للحصول على المعلومات بسهولة دون الحاجة إلى دراسة الكتب المرجعية لـ API وإعادة اختراع العجلة. ما تم كتابته في الأيام القديمة في مائة أو سطرين من التعليمات البرمجية ، يتيح لك PowerShell تنفيذ أمر واحد. من أجل هذه الراحة ندفع السرعة. داخل cmdlets نفسها ، لا يوجد سحر: نفس النص ، ولكن من مستوى أدنى ، مكتوبة بأيدي ماهر من سيد مشمس من الهند. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن ، للمقارنة مع Get-View ، خذ Get-VM cmdlet: يصل إلى الجهاز الظاهري ويعيد كائنًا مركبًا ، أي يعلق عليه كائنات أخرى ذات صلة: VMHost ، Datastore ، إلخ.&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get-View في مكانه لا يبرر أي شيء إضافي في الكائن المرتجع. </font><font style="vertical-align: inherit;">علاوة على ذلك ، فإنه يسمح لك بالإشارة بدقة إلى المعلومات التي نحتاجها بالضبط ، والتي ستسهل الكائن عند الإخراج. </font><font style="vertical-align: inherit;">في Windows Server بشكل عام وفي Hyper-V على وجه الخصوص ، يعد Get-WMIObject cmdlet تناظريًا مباشرًا - الفكرة هي نفسها تمامًا. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get-View غير مريح في العمليات الروتينية على ميزات النقاط. </font><font style="vertical-align: inherit;">ولكن عندما يتعلق الأمر بالآلاف وعشرات الآلاف من الأشياء ، ليس لديه سعر.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">اقرأ المزيد على مدونة VMware: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مقدمة في Get-View</font></font></a></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن سأعرض كل شيء في حالة حقيقية.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نكتب سيناريو لتفريغ VM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ذات مرة طلب مني زميلي تحسين نصه. </font><font style="vertical-align: inherit;">تعتبر المهمة روتينًا عاديًا: ابحث عن جميع الأجهزة الافتراضية ذات معلمة cloud.uuid مكررة (نعم ، هذا ممكن عند استنساخ VM في vCloud Director).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الحل الواضح الذي يتبادر إلى الذهن:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">احصل على قائمة بجميع الأجهزة الافتراضية.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بطريقة ما تحليل القائمة.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كانت النسخة الأصلية مثل هذا البرنامج النصي البسيط:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-CloudUUID1</span></span> {
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$vms</span> = <span class="hljs-built_in">Get-VM</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$report</span> = <span class="hljs-selector-tag">@</span>()<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#   ,     2 :    Cloud UUID.</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     PS-   VM  UUID</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$vm</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$vms</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$table</span> = <span class="hljs-string">""</span> | <span class="hljs-built_in">select</span> VM,UUID<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$table</span>.VM = <span class="hljs-variable">$vm</span>.name
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$table</span>.UUID = (<span class="hljs-variable">$vm</span> | <span class="hljs-built_in">Get-AdvancedSetting</span> <span class="hljs-literal">-Name</span> cloud.uuid).Value<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$report</span> += <span class="hljs-variable">$table</span><font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<span class="hljs-comment">#   </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$report</span><font></font>
}<font></font>
<span class="hljs-comment">#     </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كل شيء بسيط للغاية وواضح. هو مكتوب في بضع دقائق مع استراحة قهوة. المسمار على المرشح ، ويتم ذلك. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ولكن قياس الوقت: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iz/xb/i-/izxbi-_-xo9odcuouzqan83vd1o.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/kv/xy/fb/kvxyfb7lj5asvvkm3nuebjljcx0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">دقيقتان و 47 ثانية</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> عند معالجة ما يقرب من 10 كيلو VM. المكافأة هي نقص الفلاتر والحاجة إلى فرز النتيجة يدويًا. من الواضح أن النص يطلب التحسين. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يأتي Ranspace لأول مرة عند الإنقاذ عندما تحتاج إلى الحصول على مقاييس المضيف باستخدام vCenter في كل مرة أو عندما تحتاج إلى معالجة عشرات الآلاف من الأشياء. دعونا نرى ما سيعطيه هذا النهج. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نقوم بتشغيل السرعة الأولى: PowerShell Runspaces</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
أول شيء يتبادر إلى الذهن لهذا البرنامج النصي هو تنفيذ الحلقة ليس في سلسلة ، ولكن في سلاسل متوازية ، قم بتجميع جميع البيانات في كائن واحد وتصفيتها.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ولكن هناك مشكلة: لن يسمح لنا برنامج PowerCLI بفتح العديد من الجلسات المستقلة على vCenter وسيؤدي إلى حدوث خطأ مضحك:</font></font><br>
<br>
<pre><code class="plaintext hljs">You have modified the global:DefaultVIServer and global:DefaultVIServers system variables. This is not allowed. Please reset them to $null and reconnect to the vSphere server.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لحلها ، يجب عليك أولاً تمرير معلومات الجلسة إلى الدفق. </font><font style="vertical-align: inherit;">نتذكر أن PowerShell يعمل مع كائنات يمكن تمريرها كمعلمة إلى دالة على الأقل ، على الأقل إلى ScriptBlock. </font><font style="vertical-align: inherit;">دعنا نجتاز الجلسة ككائن يتجاوز $ global: DefaultVIServers (Connect-VIServer مع -NotDefault key):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$ConnectionString</span> = <span class="hljs-selector-tag">@</span>()
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$vCenter</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$vCenters</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span> += <span class="hljs-built_in">Connect-VIServer</span> <span class="hljs-literal">-Server</span> <span class="hljs-variable">$vCenter</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Credential</span> <span class="hljs-literal">-NotDefault</span> <span class="hljs-literal">-AllLinked</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ErrorAction</span> stop <span class="hljs-literal">-WarningAction</span> SilentlyContinue <span class="hljs-literal">-ErrorVariable</span> er<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">catch</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$er</span>.Message <span class="hljs-operator">-like</span> <span class="hljs-string">"*not part of a linked mode*"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span> += <span class="hljs-built_in">Connect-VIServer</span> <span class="hljs-literal">-Server</span> <span class="hljs-variable">$vCenter</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Credential</span> <span class="hljs-literal">-NotDefault</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ErrorAction</span> stop <span class="hljs-literal">-WarningAction</span> SilentlyContinue <span class="hljs-literal">-ErrorVariable</span> er<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">catch</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> <span class="hljs-variable">$_</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> <span class="hljs-variable">$_</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن ننفذ تعدد مؤشرات الترابط من خلال تجمعات Runspace.&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الخوارزمية هي على النحو التالي:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">احصل على قائمة بجميع الأجهزة الافتراضية.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في خيوط متوازية نحصل على cloud.uuid.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نجمع البيانات من التدفقات في كائن واحد.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نقوم بتصفية الكائن من خلال التجميع حسب قيمة حقل CloudUUID: تلك التي يكون فيها عدد القيم الفريدة أكثر من 1 ، وهناك أجهزة VM المطلوبة.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ونتيجة لذلك ، نحصل على البرنامج النصي:</font></font><br>
<br>
<pre><code class="powershell hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-VMCloudUUID</span></span> {
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">param</span> (<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-built_in">string</span>[]]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-type">ValidateNotNullOrEmpty</span>()]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$vCenters</span> = <span class="hljs-selector-tag">@</span>(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-built_in">int</span>]<span class="hljs-variable">$MaxThreads</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-type">System.Management.Automation.PSCredential</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="hljs-type">System.Management.Automation.Credential</span>()]
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Credential</span><font></font>
&nbsp;&nbsp;&nbsp;)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span> = <span class="hljs-selector-tag">@</span>()<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$vCenter</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$vCenters</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span> += <span class="hljs-built_in">Connect-VIServer</span> <span class="hljs-literal">-Server</span> <span class="hljs-variable">$vCenter</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Credential</span> <span class="hljs-literal">-NotDefault</span> <span class="hljs-literal">-AllLinked</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ErrorAction</span> stop <span class="hljs-literal">-WarningAction</span> SilentlyContinue <span class="hljs-literal">-ErrorVariable</span> er<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">catch</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (<span class="hljs-variable">$er</span>.Message <span class="hljs-operator">-like</span> <span class="hljs-string">"*not part of a linked mode*"</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span> += <span class="hljs-built_in">Connect-VIServer</span> <span class="hljs-literal">-Server</span> <span class="hljs-variable">$vCenter</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Credential</span> <span class="hljs-literal">-NotDefault</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-ErrorAction</span> stop <span class="hljs-literal">-WarningAction</span> SilentlyContinue <span class="hljs-literal">-ErrorVariable</span> er<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">catch</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> <span class="hljs-variable">$_</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> <span class="hljs-variable">$_</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Global:AllVMs</span> = <span class="hljs-built_in">Get-VM</span> <span class="hljs-literal">-Server</span> <span class="hljs-variable">$ConnectionString</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># !</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ISS</span> = [<span class="hljs-type">system.management.automation.runspaces.initialsessionstate</span>]::CreateDefault()
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$RunspacePool</span> = [<span class="hljs-type">runspacefactory</span>]::CreateRunspacePool(<span class="hljs-number">1</span>, <span class="hljs-variable">$MaxThreads</span>, <span class="hljs-variable">$ISS</span>, <span class="hljs-variable">$Host</span>)
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$RunspacePool</span>.ApartmentState = <span class="hljs-string">"MTA"</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$RunspacePool</span>.Open()
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Jobs</span> = <span class="hljs-selector-tag">@</span>()<font></font>
<font></font>
<span class="hljs-comment"># ScriptBlock  !)))</span>
<span class="hljs-comment">#      </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$scriptblock</span> = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">Param</span> (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$ConnectionString</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$VM</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Data</span> = <span class="hljs-variable">$VM</span> | <span class="hljs-built_in">Get-AdvancedSetting</span> <span class="hljs-literal">-Name</span> Cloud.uuid <span class="hljs-literal">-Server</span> <span class="hljs-variable">$ConnectionString</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"VMName"</span>;E={<span class="hljs-variable">$_</span>.Entity.Name}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"CloudUUID"</span>;E={<span class="hljs-variable">$_</span>.Value}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"PowerState"</span>;E={<span class="hljs-variable">$_</span>.Entity.PowerState}}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> <span class="hljs-variable">$Data</span><font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<span class="hljs-comment">#  </span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$VM</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$AllVMs</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$PowershellThread</span> = [<span class="hljs-type">PowerShell</span>]::Create()
<span class="hljs-comment">#  </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$null</span> = <span class="hljs-variable">$PowershellThread</span>.AddScript(<span class="hljs-variable">$scriptblock</span>)
<span class="hljs-comment">#  ,      </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$null</span> = <span class="hljs-variable">$PowershellThread</span>.AddArgument(<span class="hljs-variable">$ConnectionString</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$null</span> = <span class="hljs-variable">$PowershellThread</span>.AddArgument(<span class="hljs-variable">$VM</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$PowershellThread</span>.RunspacePool = <span class="hljs-variable">$RunspacePool</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Handle</span> = <span class="hljs-variable">$PowershellThread</span>.BeginInvoke()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span> = <span class="hljs-string">""</span> | <span class="hljs-built_in">Select-Object</span> Handle, Thread, object
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Handle = <span class="hljs-variable">$Handle</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Thread = <span class="hljs-variable">$PowershellThread</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Object = <span class="hljs-variable">$VM</span>.ToString()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Jobs</span> += <span class="hljs-variable">$Job</span><font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
<span class="hljs-comment">#  ,     </span>
<span class="hljs-comment">#      </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">While</span> (<span class="hljs-selector-tag">@</span>(<span class="hljs-variable">$Jobs</span> | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.Handle <span class="hljs-operator">-ne</span> <span class="hljs-variable">$Null</span>}).count <span class="hljs-operator">-gt</span> <span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Remaining</span> = <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$Jobs</span> | Where-Object {<span class="hljs-variable">$_</span>.Handle.IsCompleted -eq <span class="hljs-variable">$False</span>}).object)"</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">If</span> (<span class="hljs-variable">$Remaining</span>.Length <span class="hljs-operator">-gt</span> <span class="hljs-number">60</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Remaining</span> = <span class="hljs-variable">$Remaining</span>.Substring(<span class="hljs-number">0</span>,<span class="hljs-number">60</span>) + <span class="hljs-string">"..."</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Write-Progress</span> <span class="hljs-literal">-Activity</span> <span class="hljs-string">"Waiting for Jobs - <span class="hljs-variable">$</span>(<span class="hljs-variable">$MaxThreads</span> - <span class="hljs-variable">$</span>(<span class="hljs-variable">$RunspacePool</span>.GetAvailableRunspaces())) of <span class="hljs-variable">$MaxThreads</span> threads running"</span> <span class="hljs-literal">-PercentComplete</span> ((<span class="hljs-variable">$Jobs</span>.count - <span class="hljs-variable">$</span>(<span class="hljs-variable">$</span>(<span class="hljs-variable">$Jobs</span> | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.Handle.IsCompleted <span class="hljs-operator">-eq</span> <span class="hljs-variable">$False</span>}).count)) / <span class="hljs-variable">$Jobs</span>.Count * <span class="hljs-number">100</span>) <span class="hljs-literal">-Status</span> <span class="hljs-string">"<span class="hljs-variable">$</span>(@(<span class="hljs-variable">$</span>(<span class="hljs-variable">$Jobs</span> | Where-Object {<span class="hljs-variable">$_</span>.Handle.IsCompleted -eq <span class="hljs-variable">$False</span>})).count) remaining - <span class="hljs-variable">$remaining</span>"</span><font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">ForEach</span> (<span class="hljs-variable">$Job</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$</span>(<span class="hljs-variable">$Jobs</span> | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.Handle.IsCompleted <span class="hljs-operator">-eq</span> <span class="hljs-variable">$True</span>})){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Thread.EndInvoke(<span class="hljs-variable">$Job</span>.Handle)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Thread.Dispose()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Thread = <span class="hljs-variable">$Null</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Job</span>.Handle = <span class="hljs-variable">$Null</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$RunspacePool</span>.Close() | <span class="hljs-built_in">Out-Null</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$RunspacePool</span>.Dispose() | <span class="hljs-built_in">Out-Null</span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-CloudUUID2</span></span><font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-function">[<span class="hljs-type">CmdletBinding</span>()]</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">param</span>(<font></font>
&nbsp;&nbsp;&nbsp;[<span class="hljs-built_in">string</span>[]]<font></font>
&nbsp;&nbsp;&nbsp;[<span class="hljs-type">ValidateNotNullOrEmpty</span>()]
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$vCenters</span> = <span class="hljs-selector-tag">@</span>(),<font></font>
&nbsp;&nbsp;&nbsp;[<span class="hljs-built_in">int</span>]<span class="hljs-variable">$MaxThreads</span> = <span class="hljs-number">50</span>,<font></font>
&nbsp;&nbsp;&nbsp;[<span class="hljs-type">System.Management.Automation.PSCredential</span>]<font></font>
&nbsp;&nbsp;&nbsp;[<span class="hljs-type">System.Management.Automation.Credential</span>()]
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Credential</span>)<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>(!<span class="hljs-variable">$Credential</span>)<font></font>
&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Credential</span> = <span class="hljs-built_in">Get-Credential</span> <span class="hljs-literal">-Message</span> <span class="hljs-string">"Please enter vCenter credentials."</span><font></font>
&nbsp;&nbsp;&nbsp;}<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#   Get-VMCloudUUID,    </span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$AllCloudVMs</span> = <span class="hljs-built_in">Get-VMCloudUUID</span> <span class="hljs-literal">-vCenters</span> <span class="hljs-variable">$vCenters</span> <span class="hljs-literal">-MaxThreads</span> <span class="hljs-variable">$MaxThreads</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Credential</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Result</span> = <span class="hljs-variable">$AllCloudVMs</span> | <span class="hljs-built_in">Sort-Object</span> Value | <span class="hljs-built_in">Group-Object</span> <span class="hljs-literal">-Property</span> CloudUUID | <span class="hljs-built_in">Where-Object</span> <span class="hljs-literal">-FilterScript</span> {<span class="hljs-variable">$_</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">1</span>} | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> <span class="hljs-built_in">Group</span>
&nbsp;&nbsp;&nbsp;<span class="hljs-variable">$Result</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
جمال هذا البرنامج النصي هو أنه يمكن استخدامه في حالات أخرى مماثلة ، ببساطة استبدال ScriptBlock والمعلمات التي سيتم نقلها إلى الدفق. استغلالها! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نقيس الوقت: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d_/hr/ji/d_hrjiq58scxnha1wiknf9jd1zw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55 ثانية.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> أفضل بالفعل ، ولكن لا يزال أسرع.&nbsp; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ننتقل إلى السرعة الثانية: GetView</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
نكتشف ما هو الخطأ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الأول والواضح: يستغرق الحصول على أمر cmdlet لـ Get-VM وقتًا طويلاً. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ثانيًا: يعمل أمر cmdlet لـ Get-AdvancedOptions لفترة أطول. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أولاً ، دعنا نتعامل مع الثانية.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get-AdvancedOptions مناسب لكائنات VM الفردية ، ولكنه بطيء جدًا عند العمل مع العديد من الكائنات. </font><font style="vertical-align: inherit;">يمكننا الحصول على نفس المعلومات من كائن الجهاز الظاهري نفسه (Get-VM). </font><font style="vertical-align: inherit;">إنه فقط مدفون بشكل جيد في كائن ExtensionData. </font><font style="vertical-align: inherit;">مسلحين بالفلترة ، نقوم بتسريع عملية الحصول على البيانات اللازمة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بنقرة من المعصم هذا:</font></font><br>
<br>
<pre><code class="powershell hljs">
VM | <span class="hljs-built_in">Get-AdvancedSetting</span> <span class="hljs-literal">-Name</span> Cloud.uuid <span class="hljs-literal">-Server</span> <span class="hljs-variable">$ConnectionString</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"VMName"</span>;E={<span class="hljs-variable">$_</span>.Entity.Name}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"CloudUUID"</span>;E={<span class="hljs-variable">$_</span>.Value}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"PowerState"</span>;E={<span class="hljs-variable">$_</span>.Entity.PowerState}}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتحول إلى هذا:</font></font><br>
<br>
<pre><code class="powershell hljs">
<span class="hljs-variable">$VM</span> | <span class="hljs-built_in">Where-Object</span> {(<span class="hljs-variable">$_</span>.ExtensionData.Config.ExtraConfig | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.key <span class="hljs-operator">-eq</span> <span class="hljs-string">"cloud.uuid"</span>}).Value <span class="hljs-operator">-ne</span> <span class="hljs-variable">$null</span>} | <span class="hljs-built_in">Select-Object</span> <span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"VMName"</span>;E={<span class="hljs-variable">$_</span>.Name}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"CloudUUID"</span>;E={(<span class="hljs-variable">$_</span>.ExtensionData.Config.ExtraConfig | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.key <span class="hljs-operator">-eq</span> <span class="hljs-string">"cloud.uuid"</span>}).Value}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"PowerState"</span>;E={<span class="hljs-variable">$_</span>.summary.runtime.powerstate}}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الاستنتاج هو نفسه Get-AdvancedOptions ، ولكنه يعمل بشكل أسرع عدة مرات.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الآن احصل على VM. لا يتم تنفيذها بسرعة ، لأنها تتعامل مع الأشياء المعقدة. ينشأ سؤال منطقي: لماذا في هذه الحالة نحتاج إلى معلومات إضافية و PSObject وحشية عندما نحتاج فقط إلى اسم VM وحالته وقيمة السمة الصعبة؟&nbsp;&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بالإضافة إلى ذلك ، تركت الفرامل في وجه Get-AdvancedOptions النص. يبدو أن استخدام Runspace Pools مبالغة الآن ، حيث لم تعد هناك حاجة لموازاة مهمة بطيئة في التدفقات مع القرفصاء عند نقل الجلسة. الأداة جيدة ، ولكن ليس لهذه الحالة.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نحن ننظر إلى إخراج ExtensionData: إنه ليس سوى كائن Get-View.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
دعونا نطلق على التقنية القديمة لأساتذة PowerShell: سطر واحد باستخدام الفلاتر وأنواعها والتجمعات. ينهار كل الرعب السابق بشكل أنيق في سطر واحد ويتم تنفيذه في جلسة واحدة:</font></font><br>
<br>
<pre><code class="powershell hljs">
<span class="hljs-variable">$AllVMs</span> = <span class="hljs-built_in">Get-View</span> <span class="hljs-literal">-viewtype</span> VirtualMachine <span class="hljs-literal">-Property</span> Name,Config.ExtraConfig,summary.runtime.powerstate | <span class="hljs-built_in">Where-Object</span> {(<span class="hljs-variable">$_</span>.Config.ExtraConfig | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.key <span class="hljs-operator">-eq</span> <span class="hljs-string">"cloud.uuid"</span>}).Value <span class="hljs-operator">-ne</span> <span class="hljs-variable">$null</span>} | <span class="hljs-built_in">Select-Object</span> <span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"VMName"</span>;E={<span class="hljs-variable">$_</span>.Name}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"CloudUUID"</span>;E={(<span class="hljs-variable">$_</span>.Config.ExtraConfig | <span class="hljs-built_in">Where-Object</span> {<span class="hljs-variable">$_</span>.key <span class="hljs-operator">-eq</span> <span class="hljs-string">"cloud.uuid"</span>}).Value}},<span class="hljs-selector-tag">@</span>{N=<span class="hljs-string">"PowerState"</span>;E={<span class="hljs-variable">$_</span>.summary.runtime.powerstate}} | <span class="hljs-built_in">Sort-Object</span> CloudUUID | <span class="hljs-built_in">Group-Object</span> <span class="hljs-literal">-Property</span> CloudUUID | <span class="hljs-built_in">Where-Object</span> <span class="hljs-literal">-FilterScript</span> {<span class="hljs-variable">$_</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-number">1</span>} | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> <span class="hljs-built_in">Group</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
نقيس الوقت: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iy/x4/7q/iyx47qcshcsbjbglrcwi_zzceps.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 ثوانٍ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> لما يقرب من 10 كائنات مع التصفية وفقًا للحالة المطلوبة. </font><font style="vertical-align: inherit;">غرامة! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بدلاً من الاستنتاج</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
تعتمد النتيجة المقبولة بشكل مباشر على اختيار الأداة. </font><font style="vertical-align: inherit;">غالبًا ما يكون من الصعب القول على وجه اليقين ما الذي يجب اختياره بالضبط لتحقيقه. </font><font style="vertical-align: inherit;">كل طريقة من طرق تسريع البرنامج النصي جيدة في حدود قابلية تطبيقها. </font><font style="vertical-align: inherit;">آمل أن تساعدك هذه المقالة في المهمة الصعبة المتمثلة في فهم أساسيات أتمتة العمليات وتحسينها في البنية التحتية الخاصة بك. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملاحظة:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> المؤلف يشكر جميع أعضاء الكومونة لمساعدتهم ودعمهم في إعداد المقال. </font><font style="vertical-align: inherit;">حتى مع الكفوف. </font><font style="vertical-align: inherit;">وحتى الذين ليس لديهم أرجل ، مثل الأصلة العاصرة.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar498612/index.html">لا تقرر للمصمم مهمة المصمم</a></li>
<li><a href="../ar498614/index.html">تحليل سلسلة فيديوهات ترويجية للعبة Spin Voyage</a></li>
<li><a href="../ar498618/index.html">Android في وحدة تحكم صناعية</a></li>
<li><a href="../ar498620/index.html">لمس العالم: الميكانيكا الحيوية لمستقبلات الجلد البشري</a></li>
<li><a href="../ar498624/index.html">[تعليمات] إنشاء اختبارات Google (نماذج Google)</a></li>
<li><a href="../ar498630/index.html">محاكاة فيزيائية لمئات الآلاف من الجسيمات على Unity + DOTS</a></li>
<li><a href="../ar498632/index.html">الببتيد لملاطو جميل</a></li>
<li><a href="../ar498634/index.html">11 سؤالًا غبيًا لجراح العظام ومدلكًا حول العمل على جهاز كمبيوتر وليس فقط</a></li>
<li><a href="../ar498636/index.html">تظليل بسيط لأضواء نقطة في الضباب</a></li>
<li><a href="../ar498638/index.html">لعبة آركيد ثلاثية الأبعاد في المتصفح: كيف صنعنا اللعبة على React + Redux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>