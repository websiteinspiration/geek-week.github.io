<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â˜€ï¸ ğŸ® ğŸ„ VictoriaMetricsã§æœ€é©åŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã‚¢ãƒ¬ã‚¯ã‚µãƒ³ãƒ€ãƒ¼ãƒãƒªãƒ£ãƒ«ã‚­ãƒ³ ğŸ¤´ ğŸ˜… ğŸ‘©ğŸ¿â€ğŸ”§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alexander Valyalkinã«ã‚ˆã‚‹2019å¹´æœ«ã®ãƒ¬ãƒãƒ¼ãƒˆã€ŒVictorMetricsã®Goæœ€é©åŒ–ã€ã®è§£èª­ã«ã¤ã„ã¦çŸ¥ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™
 

VictoriaMetricsã¯ã€æ™‚ç³»åˆ—ã®å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãŠã‚ˆã³å‡¦ç†ã™ã‚‹ãŸã‚ã®é«˜é€Ÿã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ï¼ˆãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ã€æ™‚é–“ã¨ã€...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>VictoriaMetricsã§æœ€é©åŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã‚¢ãƒ¬ã‚¯ã‚µãƒ³ãƒ€ãƒ¼ãƒãƒªãƒ£ãƒ«ã‚­ãƒ³</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500844/"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Valyalkinã«ã‚ˆã‚‹2019å¹´æœ«ã®ãƒ¬ãƒãƒ¼ãƒˆã€ŒVictorMetricsã®Goæœ€é©åŒ–ã€ã®è§£èª­ã«ã¤ã„ã¦çŸ¥ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™</font></font></strong></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VictoriaMetrics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã€æ™‚ç³»åˆ—ã®å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãŠã‚ˆã³å‡¦ç†ã™ã‚‹ãŸã‚ã®é«˜é€Ÿã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ï¼ˆãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ã€æ™‚é–“ã¨ã€ã“ã®æ™‚é–“ã«å¯¾å¿œã™ã‚‹å€¤ã®ã‚»ãƒƒãƒˆã‚’å½¢æˆã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€ã‚»ãƒ³ã‚µãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å®šæœŸçš„ãªãƒãƒ¼ãƒªãƒ³ã‚°ã¾ãŸã¯ãƒ¡ãƒˆãƒªãƒƒã‚¯ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’é€šã˜ã¦å–å¾—ã•ã‚Œã¾ã™ï¼‰ã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/a8/ua/hz/a8uahzgkj1ezyu0qiegqysypnls.png"></p><a name="habracut"></a><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/MZ5P21j_HLE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ãƒ©ã‚¤ãƒ‰</font></font></a></p><br>
<p><img src="https://habrastorage.org/webt/8m/wd/k2/8mwdk2k-7ks6a5bml4u2yao7zzq.png"></p><br>
<p>   .  â€“  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> GitHub </a>.   Go   .        .     <code>fast</code>,   <code>quick</code> . </p><br>
<p>      VictoriaMetrics.        ?       . </p><br>
<p><img src="https://habrastorage.org/webt/z6/x0/g3/z6x0g3th4zzzylpolm60bsfqxdu.png"></p><br>
<p>  :</p><br>
<ul>
<li>   ,   VictoriaMetrics. </li>
<li> ,    . </li>
<li> ,      .</li>
<li>     :    .</li>
<li>    ,    VictoriaMetrics.        bitset-  Go.</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/xo/yu/wf/xoyuwfsgtrs-aoqx1d7exrfthcw.png"></p><br>
<p>  VictoriaMetrics -   ?  ,    .   .  ,    â€“      .     ClickHouse,     ClickHouse. ,  , : MergeTree,                ,     . </p><br>
<p>VictoriaMetrics             . </p><br>
<p>   â€” . .      ,       . VictoriaMetrics           .</p><br>
<p> VictoriaMetrics   â€” . .        VictoriaMetrics,       .</p><br>
<p>  , VictoriaMetrics   ,       .     Go,        .</p><br>
<p><img src="https://habrastorage.org/webt/ta/ux/wg/tauxwgc2bngokx6meub0bsw46w8.png"></p><br>
<p> ,    ?    .   â€”    <code>(timestamp, )</code>,      .         â€“ float64.</p><br>
<p>     .     ?       -. </p><br>
<p>   .      : <code>__name__="cpu_usage"</code> â€“   , <code>instance="my-server"</code> â€”  ,     , <code>datacenter="us-east"</code> â€”  ,    .</p><br>
<p>     ,     -.      <code>(timestamp, value)</code>. <code>t1, t3, t3, ..., tN</code> â€”  timestamps, <code>10, 20, 12, ..., 15</code> â€”  .  cpu-usage       .</p><br>
<p><img src="https://habrastorage.org/webt/av/jp/2n/avjp2nl6qfh9u4ltsxdntkeachc.png"></p><br>
<p>     ?  -  ? </p><br>
<ul>
<li> DevOps     CPU, RAM, , rps,    . . </li>
<li>IoT â€“    , geo coordinates   -.</li>
<li>  â€“        . </li>
<li> ,          .    ,   VictoriaMetrics    ,  .</li>
<li>          . ,  ;     ;   , ;      . .</li>
<li>       .      ,         .       . </li>
<li>Healthcare â€“   ,   ..</li>
</ul><br>
<p> ,   ,    , , ,   ,        .        .</p><br>
<p><img src="https://habrastorage.org/webt/vx/rg/gn/vxrggn2eqb_sf1p-q85xr1g3xdg.png"></p><br>
<p>       ?          ?</p><br>
<p>        ,         .       .      <code>(timestamp, value)</code>   .   API      ,    -,     ,   regexp. ,            ,      .</p><br>
<p>         ,   SQL       .    ,  SQL ,      .      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PromQL</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">InfluxQL</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Flux</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Q</a>.  ,  -       .  PromQL, ,  .    Prometheus.</p><br>
<p><img src="https://habrastorage.org/webt/hl/g7/a0/hlg7a02gquoqb9xku3ynmbhr9d0.png"></p><br>
<p>            VictoriaMetrics.</p><br>
<p>    .           .   . </p><br>
<p>      ,       ,         <code>label=value</code>   .         .</p><br>
<p>  -      TSDB,        .   <code>timeseries_ids</code> ,     <code>label=value</code>.         ,   <code>timeseries_ids</code>.</p><br>
<p><img src="https://habrastorage.org/webt/13/jn/v7/13jnv7nyijhaymi0olcvkdeuf-s.png"></p><br>
<p> ,         select-.</p><br>
<ul>
<li>      <code>timeseries_ids</code>   ,     <code>label=value</code>,     .</li>
<li>    data points          <code>timeseries_ids</code>.</li>
<li>     -    data points,   .     .</li>
</ul><br>
<p>        .   <code>timeseries_ids</code>   .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> VictoriaMetrics</a>,  ,      :)</p><br>
<p><img src="https://habrastorage.org/webt/vg/6o/ig/vg6oighnetd3sfv22srzz6azu6k.png"></p><br>
<p>   .   ,   .  ,        ? ,     .   ,   . </p><br>
<p>    .   ,     .   ?   <code>label=value</code>,  <code>label</code>  <code>value</code> â€”  .   â€“   <code>timeseries_ids</code>,      <code>label=value</code>.</p><br>
<p>      <code>timeseries_ids</code>,     <code>label=value</code>.</p><br>
<p>      <code>timeseries_ids</code>      <code>label=value</code>,    <code>label=regexp</code>.   ?      <code>timeseries_ids</code>    <code>label=value</code>.</p><br>
<p><img src="https://habrastorage.org/webt/or/6i/3q/or6i3q-m3bhqomcofrb7dk0co1y.png"></p><br>
<p>    .      .    . </p><br>
<p> <code>getMetricIDs</code>   .    <code>label=value</code>.     <code>metricIDs</code>.</p><br>
<p>  ?      ,   <code>invertedIndex</code>.    (<code>map</code>),     slice int-.   <code>label=value</code>.</p><br>
<p> :  <code>metricIDs</code>   <code>label=value</code>,      <code>label=value</code>,  <code>metricIDs</code>  .    <code>intersectInts</code>,     .       .</p><br>
<p><img src="https://habrastorage.org/webt/46/jm/hz/46jmhzn4yky5ea_nfznx__swyru.png"></p><br>
<p>  ,      .    .     ?      ,          .       .      .         .</p><br>
<p>     .       .      ,  ,    â€“ out of memory error.     .</p><br>
<p><img src="https://habrastorage.org/webt/mp/sp/1d/mpsp1dsehfavabbej5ml7djgcng.png"></p><br>
<p>        ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">LevelDB</a>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">RocksDB</a>.</p><br>
<p> ,     ,      . </p><br>
<ul>
<li>  â€“   <code>-</code>   .     ,  <code>-</code> â€“   . </li>
<li>  â€“       .</li>
<li>   â€“        . </li>
</ul><br>
<p>LevelDB  RocksDB â€“     Google  Facebook.   LevelDB.    Facebook  LevelDB    ,  RocksDB.   RocksDB  Facebook      ,       RocksDB  MySQL.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">MyRocks</a>.</p><br>
<p>      LevelDB.   ?      <code>label=value</code>.     â€“   ,    <code>label=value</code>.</p><br>
<p>       c   <code>label=value</code>,              <code>timeseries_ids</code>.     <code>timeseries_ids</code>,     <code>label=prefix</code>,   range scan,      . . .   ,    <code>label=prefix</code>    <code>timeseries_ids</code>.</p><br>
<p><img src="https://habrastorage.org/webt/os/0b/el/os0belq1vsrju4ebdhlgtcfmypg.png"></p><br>
<p>  ,      Go.     .  LevelDB.</p><br>
<p>  ,    .        .  ,     <code>map</code>     .      <code>label=value</code>.       <code>label=value</code>     metricIDs  .   . </p><br>
<p><img src="https://habrastorage.org/webt/7u/cq/5o/7ucq5omzldvhbpn1fwpbumvd0j8.png"></p><br>
<p>   ,      . VictoriaMetrics       LevelDB.       .</p><br>
<p>?   LevelDB ,   .           slice <code>metricIDs</code>.     â€”  slice   .</p><br>
<p> LevelDB      <code>GetValues</code>     ,    <code>label=value</code>.       <code>timeseries_ids</code>.   <code>timeseries_ids</code>  slice  <code>timeseries_ids</code>. ,    ,      map'  .</p><br>
<p>   ,  LevelDB   C.   C-  Go   .    .    ,        ,   go,   1-5 ,       .  VictoriaMetrics â€“     :)</p><br>
<p><img src="https://habrastorage.org/webt/lc/_c/sw/lc_csw07os6wcpc8jyvla39pk5w.png"></p><br>
<p>      .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">mergeset</a>.</p><br>
<p>Mergeset     MergeTree.      ClickHouse. ,  mergeset       <code>timeseries_ids</code>   . Mergeset    Go.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> VictoriaMetrics  GitHub</a>.  mergeset    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">/lib/mergeset</a>.    ,   .</p><br>
<p>API mergeset    LevelDB  RocksDB. . .              .</p><br>
<p><img src="https://habrastorage.org/webt/j0/-l/mo/j0-lmotkgyw_rg-at2dopsk7e74.png"></p><br>
<p>  mergeset   .    ,     VictoriaMetrics  production    .</p><br>
<p>  ?</p><br>
<p>  â€“  high churn rate.     â€“     .         ,      .    .</p><br>
<p>  â€“     . ,    ,     . ,       , ,   . 4     .  , , 100   400  .   . </p><br>
<p>    ,      . ,     ,      .     40  , , ,     40        . </p><br>
<p>    .         ,  idle,   .     user space,   kernel space   .       ,    .       7-8 .</p><br>
<p>      40  8 = 320     .   100,  32 000  400. </p><br>
<p>  Kubernetes.    ,    Kubernetes     .    Kubernetes    .     .       deployment    .         .                ,   high-cardinality. VictoriaMetrics             . </p><br>
<p><img src="https://habrastorage.org/webt/jn/u8/8x/jnu88xu0opegwjjghubewiyq8xk.png"></p><br>
<p>  high churn rate. -   high churn rate  production?         .</p><br>
<p>,  Kubernetes,     <code>deployment</code>, . .      .  Kubernetes -   idâ€™ deployment'  label.</p><br>
<p>   ?  ,     deployment'       ,            <code>deployment_id</code>.         .</p><br>
<p>     ,      ,    ,     ,    ,  .    â€“ high churn rate.</p><br>
<p>  high churn rate  ,              -  .           . </p><br>
<p><img src="https://habrastorage.org/webt/yn/tn/7-/yntn7-crolkneezzzqqp7ez1lak.png"></p><br>
<p>   ?   .         . . .  -  ,      .     .     ,      . </p><br>
<p>           ,     . , ,   id  . </p><br>
<p>   ,       ,      . . . ,       ,        . </p><br>
<p><img src="https://habrastorage.org/webt/uy/yb/xx/uyybxxbjvedganmy_y6cpb_cqr4.png"></p><br>
<p>      .        id  ,     .</p><br>
<p>         ,        ,      .      . </p><br>
<p>  ,          .  VictoriaMetrics   .   .      ,    .        - ,       partition   ,   , . .      . VictoriaMetrics         ,       .           ,    . </p><br>
<p>   .    ,            <code>timeseries_ids</code>  , ,      .</p><br>
<p><img src="https://habrastorage.org/webt/--/a8/jq/--a8jqa82xqvnozcauydt12y6y4.png"></p><br>
<p>    ?      â€“              . . .     <code>label=value</code>,      .      <code>timeseries_ids</code>   .</p><br>
<p> .     N ,       ,     ,     .       id  . </p><br>
<p>         10 .       ,       <code>label=value</code>       N .      ,       labels   ,     Kubernetes.</p><br>
<p><img src="https://habrastorage.org/webt/et/xz/fq/etxzfqr5q9ypgf_det_z_rcbhem.png"></p><br>
<p>        â€“  .             .   <code>key=value</code> . . .       ,        .        , . .      .         ,     ClickHouse.    .</p><br>
<p><img src="https://habrastorage.org/webt/v6/me/yu/v6meyus-znzr09ej6yph4f64bc4.png"></p><br>
<p>      â€“    <code>timeseries_ids</code>. ,    .     <code>timeseries_ids</code>    <code>label=value</code>.</p><br>
<p><img src="https://habrastorage.org/webt/f5/mw/x6/f5mwx6uxaksryzqajhrvqlqmdrm.png"></p><br>
<p>  â€“   .   .       <code>intersectInts</code>  slices â€” <code>a</code>  <code>b</code>.         slices.</p><br>
<p>   .       slice <code>a</code>,        slice <code>b</code>.   .   , ,   .     <code>result</code>.</p><br>
<p><img src="https://habrastorage.org/webt/z_/fv/v7/z_fvv7xrf2hff-qsbkeqm1zbzcw.png"></p><br>
<p>  ?   â€”    . ,     slice <code>a</code>  <code>b</code>   ,        .         ,       .</p><br>
<p><img src="https://habrastorage.org/webt/9j/yj/-c/9jyj-cdn6kppt-opngjo_jjgday.png"></p><br>
<p>    map.   map.    map    slice <code>a</code>.      slice <code>b</code>.   â€“      slice <code>b</code>  map.   ,     . </p><br>
<p><img src="https://habrastorage.org/webt/y8/zg/2i/y8zg2ifmtrfkhovyhbzq8_v6lqs.png"></p><br>
<p> ?   ,     . . .        slices.    slice     2  ,     ,    .</p><br>
<p>   ,        ,    map.</p><br>
<p>  â€“   overhead  .     .         ,    VictoriaMetrics  intersection   map.    ,         map        map.</p><br>
<p>      ?      Go   . . .   hash  ,        HashMap.    hashâ€™    .    VictoriaMetrics.</p><br>
<p><img src="https://habrastorage.org/webt/q7/da/iv/q7daivrlao2ivquuumz6yzh8w1s.png"></p><br>
<p>   bitset,     .       slices.   bitset.       slice.        slice.     . . .      . ,       map   <code>add</code>  <code>has</code>.</p><br>
<p><img src="https://habrastorage.org/webt/ra/r-/xb/rar-xbesf3yq7pmt8fiqqwlms7k.png"></p><br>
<p>   ,     ,      map,    -  ,   ,      10  ,   map    VictoriaMetrics.</p><br>
<p> ,           map.         .</p><br>
<p>     ,     ,  . </p><br>
<p>  ,      â€“  ,         . . .     ,     ids   VictoriaMetrics.   ,      .    ,     ,  out of memory error   . </p><br>
<p><img src="https://habrastorage.org/webt/eh/qw/11/ehqw11vht8nqkuvtqfg4vh1rure.png"></p><br>
<p>   .   ,      VictoriaMetrics,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">lib/uint64set</a>.      VictoriaMetrics,  <code>timeseries_id</code>    64- ,   32         32 .</p><br>
<p>      ,     . </p><br>
<p><img src="https://habrastorage.org/webt/ou/5e/ik/ou5eik1fmavrysmoqzerbjh6qhk.png"></p><br>
<p>  API.    . API       VictoriaMetrics. . .    .  ,    VictoriaMetrics.</p><br>
<p>  <code>add</code>,    .   <code>has</code>,    .    <code>del</code>,   .    <code>len</code>,    .  <code>clone</code>  .   <code>appendto</code>     slice <code>timeseries_ids</code>.</p><br>
<p><img src="https://habrastorage.org/webt/cs/zo/g8/cszog8jpbuijmvgvzpoqsas4gcy.png"></p><br>
<p>      .  set   :</p><br>
<ul>
<li><p><code>ItemsCount</code> â€“   ,       set.        ,     ,   VictoriaMetrics       bitset.</p><br>
</li>
<li><p>  â€“  <code>buckets</code>.  slice   <code>bucket32</code>.     <code>hi</code> .   32 .   slice â€” <code>b16his</code>  <code>buckets</code>  <code>bucket16</code> . </p><br>
</li>
</ul><br>
<p>   16    64- .    bitsets   16   . </p><br>
<p><code>Bucket64</code>    <code>uint64</code>.      .   <code>bucket16</code>    <code>2^16=65536</code> .     8,   8 .      8,   1000 <code>uint64</code> . . . <code>Bucket16</code> â€“    8- . </p><br>
<p><img src="https://habrastorage.org/webt/ve/kw/p0/vekwp0pi-suxonq7o6cluhibigk.png"></p><br>
<p>,          . </p><br>
<p>   <code>uint64</code> .   32 ,   32 .    <code>buckets</code>.   32    bucket   .    ,    <code>add</code>   b32 <code>buckets</code>.     32 .     <code>true</code>,   ,             .    <code>false</code>,     .      . </p><br>
<p>     <code>bucket</code>   hi-,     <code>addAlloc</code>,    <code>bucket</code>,    bucket-.</p><br>
<p><img src="https://habrastorage.org/webt/rl/g4/7i/rlg47ibsxvxtsef-b7xgl3jceym.png"></p><br>
<p>   <code>b32.add</code>.     .    16 ,  16 .</p><br>
<p>      16 .  .      add,       <code>bucket16</code>.</p><br>
<p><img src="https://habrastorage.org/webt/hv/j6/zc/hvj6zchagd_6ujzwa97p2bncbt0.png"></p><br>
<p>    ,     .    <code>uint64</code> id   slice bit,   <code>bitmask</code>.     64- ,       ,   .     ,    ,   .     ,      ids    10      maps.</p><br>
<p><img src="https://habrastorage.org/webt/xl/g_/ez/xlg_ezzq-y_qagmmkzwawnor4sg.png"></p><br>
<p> VictoriaMetrics       .        ,      production.</p><br>
<p>    â€“   , ,     ,    ,      .     .          production,     .  ,    VictoriaMetrics    ,   .</p><br>
<p><img src="https://habrastorage.org/webt/tb/un/om/tbunom334y_4nk6zkfyck-tdt_u.png"></p><br>
<p><em>    bitset.     C++ vector bool,  bitset.    ?</em></p><br>
<p>,  .    bitset       ids timeseries,    VictoriaMetrics.     ,   32    .  32   .   ,     .         . C++ ,   ,    .      ,   ,         .</p><br>
<p>      .  -        ClickHouse   .    ,     C++   -          .    ,      ,   ,   ,   32    .</p><br>
<p><em>   .      InfluxDB?</em></p><br>
<p>  .       ,  InfluxDB     10      high cardinality  ,     , , . , VictoriaMetrics  1 GB    ,  InfluxDB    10 Gb.    . </p><br>
<p>    ,   InfluxDB    â€“ Flux  InfluxQL.             <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PromQL</a>,    VictoriaMetrics. PromQL â€“     Prometheus.</p><br>
<p>    â€“  ,   InfluxDB    ,        fields    .       .          .     .</p><br>
<p> VictoriaMetrics   .        -.  â€“    â€“ <code>(timestamp, value)</code>,   â€“   <code>label=value</code>.     fields  measurements.      ,    , , , ,     InfluxDB,          ,   .   ,  ,    . </p><br>
<p><em>    .   ,   - ,    ,        ,    ?</em></p><br>
<p>         Go' map'.       ,         ,       ,       .           .       ,      . </p><br>
<p><em>!   !   .    Wildberries.      .  .   ,                , , ,         ,    ,          , . .            ,     - ?   2 â€”       bitset   , , ,     ?  ,    ?</em></p><br>
<p>   .      .    , .  ,   ?</p><br>
<p><em>   .  ,       .    ,     .</em> </p><br>
<p>.         ,                ,      .     churn rate    , . .       ,                   .</p><br>
<p>  â€“ ,    â€“  .  Prometheus .   Prometheus   .     ,      -   label  timeseries. ,    ,   ,        ,    VictoriaMetrics.   VictoriaMetrics    ,  -   ,      .</p><br>
<p><em>,    ,   .    timeseries-,    .              .   â€“  intersect  .      , ,                  .</em> </p><br>
<p>       ?</p><br>
<p><em>.</em> </p><br>
<p>   LevelDB   mergeset     .       .    ?   â€“  .      ,       .   â€“  5 .     100 000 000 ,  ,        .</p><br>
<p><em> , .     . ,  ,   .                ?      -   VictoriaMetrics, ClickHouse  . .,        ?</em></p><br>
<p><em> ,   . ,     ?   ,   ,       ,   â€“ .  .    .     .     .</em></p><br>
<p>,  .      .   ,    ,     .    ,     , -   ClickHouse     ,       , ,      .    ,     - ,      ,  ,      ?      ,    ,   .</p><br>
<p>,        . , Prometheus  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">recording rules</a>. . .   ,   ,    .  VictoriaMetrics   ,      Prometheus,       recoding rules.</p><br>
<p>,              .   ,       Go, . .     .      ,     .    ,     -     .         ,     ,  .  ,        ClickHouse   timeseries-,     .</p><br>
<p><em>   .     ,   ,  -     Graphite   Carbon.      , . .     ,      . .  ,   ,     ,  ,  ,     .  Prometheus, VictoriaMetrics    .   ?  ,  ?</em></p><br>
<p>  .     . ,      (downsampling).   . -,     <code>downsampling</code> - : -        , -  , ,  .        ,       .  ,        .     .</p><br>
<p>  â€“  ,  VictoriaMetrics,   ClickHouse,        ,       ,   ,         .      VictoriaMetrics â€“ 50 000 000      .       . . .    20 , ,       .    VictoriaMetrics  ClickHouse    downsamling.</p><br>
<p>    ,  VictoriaMetrics    .     production  0,4  0,8   .   â€“  timestamp + .    ,      . </p><br>
<p><em>.    .     ?</em></p><br>
<p> .             .      â€“   .   Graphite, ,   .  OpenTSDB   .  InfluxDB â€“  .  VictoriaMetrics â€“  ,    Prometheus  .  VictoriaMetrics   remote storage  Prometheus .          . </p><br>
<p>,    , ,      â€”   ,       ,      .   DevOps-    ,        30 ,  ,     ,    .       high frequency trading systems,     .</p><br>
<p>   VictoriaMetrics    DevOps-,      ,      . ,       â€“  high frequency trading systems.</p><br>
<p><em>!   .    PromQL?</em></p><br>
<p>  . VictoriaMetrics   PromQL.          PromQL,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">MetricsQL</a>.         YouTube.    Monitoring Meetup   .</p><br>
<p>Telegram  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">VictoriaMetrics</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja500832/index.html">ĞÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½ĞµĞµ Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ bash-ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²</a></li>
<li><a href="../ja500834/index.html">Webã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</a></li>
<li><a href="../ja500836/index.html">5æœˆ7æ—¥ã«è¼¸é€ã¯ã©ã†ãªã‚Šã¾ã™ã‹-ç•°ãªã‚‹åœ°åŸŸã®ç•°ãªã‚‹æ¤œç–«</a></li>
<li><a href="../ja500838/index.html">O2ã®ä»£ã‚ã‚Šã«CO2ï¼šè£¸ã®ã»ãã‚ãƒ©ãƒƒãƒˆãŒã‘ã„ã‚Œã‚“ç™ºä½œã‚’ã©ã®ã‚ˆã†ã«é˜²ãã‹</a></li>
<li><a href="../ja500840/index.html">ãƒ¢ãƒ¼ã‚¿ãƒ«ã‚³ãƒ³ãƒãƒƒãƒˆ11ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†æ</a></li>
<li><a href="../ja500848/index.html">å˜ä¸€ã®é–‹ç™ºè€…ã«ã‚ˆã‚‹MVP</a></li>
<li><a href="../ja500850/index.html">ã‚ˆã‚Šå¤šãã®é–‹ç™ºè€…ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¤ã„ã¦ã“ã‚Œã‚’çŸ¥ã£ã¦ã„ã‚‹ã¹ãã§ã™ã€‚</a></li>
<li><a href="../ja500852/index.html">Avira Free Antivirusã‚¢ãƒ³ãƒã‚¦ã‚¤ãƒ«ã‚¹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ©ãƒ¼</a></li>
<li><a href="../ja500854/index.html">æ¤œç–«ä¸­ã®ABBYYã‚ªãƒ•ã‚£ã‚¹ã®é‹ç”¨ã‚’æŠ€è¡“çš„ã«ã©ã®ã‚ˆã†ã«ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹</a></li>
<li><a href="../ja500856/index.html">èˆˆå‘³ã®ãªã„ã€ŒãŠã‚‚ã—ã‚ã„ã€ã®ç¿»è¨³ã«ã¤ã„ã¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>