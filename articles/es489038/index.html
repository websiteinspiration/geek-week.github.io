<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèø üéüÔ∏è üåå El libro "Concurrencia de Java en la pr√°ctica" üë®üèæ‚Äçüé® üë®‚Äçüî¨ üßìüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habrozhiteli! Las transmisiones son una parte fundamental de la plataforma Java. Los procesadores multi-core son comunes, y el uso efectivo de la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>El libro "Concurrencia de Java en la pr√°ctica"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/489038/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/1r/ku/4r/1rku4rb0w0tevxfiae9gxkkkzse.jpeg" align="left" alt="imagen"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola habrozhiteli! Las transmisiones son una parte fundamental de la plataforma Java. Los procesadores multi-core son comunes, y el uso efectivo de la concurrencia se ha vuelto necesario para crear cualquier aplicaci√≥n de alto rendimiento. Una m√°quina virtual Java mejorada, soporte para clases de alto rendimiento y un rico conjunto de bloques de construcci√≥n para tareas de paralelizaci√≥n fueron un gran avance en el desarrollo de aplicaciones paralelas. En Java Concurrency in Practice, los creadores de tecnolog√≠a innovadora explican no solo c√≥mo funcionan, sino que tambi√©n hablan sobre patrones de dise√±o. Es f√°cil crear un programa competitivo que parece funcionar. Sin embargo, el desarrollo, las pruebas y la depuraci√≥n de programas multiproceso plantean muchos problemas. El c√≥digo deja de funcionar justo cuando es m√°s importante: bajo una carga pesada.En "Concurrencia de Java en la pr√°ctica" encontrar√° teor√≠a y m√©todos espec√≠ficos para crear aplicaciones paralelas confiables, escalables y compatibles. Los autores no ofrecen una lista de API y mecanismos de paralelismo; introducen reglas de dise√±o, patrones y modelos que son independientes de la versi√≥n de Java y siguen siendo relevantes y efectivos durante muchos a√±os.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extracto. </font><font style="vertical-align: inherit;">Hilo de seguridad</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede que se sorprenda de que la programaci√≥n competitiva se asocie con hilos o bloqueos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no m√°s que la ingenier√≠a civil se asocia con remaches y vigas en I. </font><font style="vertical-align: inherit;">Por supuesto, la construcci√≥n de puentes requiere el uso correcto de una gran cantidad de remaches y vigas en I, y lo mismo se aplica a la construcci√≥n de programas competitivos, que requieren el uso correcto de hilos y cerraduras. </font><font style="vertical-align: inherit;">Pero estos son solo mecanismos, medios para lograr el objetivo. </font><font style="vertical-align: inherit;">Escribir c√≥digo seguro para subprocesos es, en esencia, controlar el acceso a un estado y, en particular, a un estado mutable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, el estado de un objeto son sus datos almacenados en variables de estado, como instancia y campos est√°ticos o campos de otros objetos dependientes. El estado del hash HashMap se almacena parcialmente en el propio HashMap, pero tambi√©n en muchos objetos Map.Entry. El estado de un objeto incluye cualquier dato que pueda afectar su comportamiento. </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b>     lock  block,      ¬´¬ª,     ,  .            blocking.   lock    ¬´¬ª, ¬´  ¬ª.     lock ,  ,   ,    ¬´¬ª.  ‚Äî          .       ,          , ,         . ‚Äî . . .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Varios subprocesos pueden acceder a una variable compartida, mutada: cambia su valor. De hecho, estamos tratando de proteger los datos, no el c√≥digo, del acceso competitivo no controlado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La creaci√≥n de un objeto seguro para subprocesos requiere sincronizaci√≥n para coordinar el acceso a un estado mutado, un incumplimiento que puede conducir a la corrupci√≥n de datos y otras consecuencias indeseables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que m√°s de un hilo accede a una variable de estado y uno de los hilos posiblemente escribe en √©l, todos los hilos deben coordinar su acceso a √©l mediante sincronizaci√≥n. La sincronizaci√≥n en Java es proporcionada por la palabra clave sincronizada, que proporciona bloqueo exclusivo, as√≠ como variables vol√°tiles y at√≥micas y bloqueos expl√≠citos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resista la tentaci√≥n de pensar que hay situaciones que no requieren sincronizaci√≥n. </font><font style="vertical-align: inherit;">El programa puede funcionar y pasar sus pruebas, pero sigue funcionando mal y se bloquea en cualquier momento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si varios subprocesos acceden a la misma variable con un estado mutado sin una sincronizaci√≥n adecuada, entonces su programa no funciona correctamente. </font><font style="vertical-align: inherit;">Hay tres formas de solucionarlo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No comparta la variable de estado en todos los hilos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hacer que la variable de estado no sea mutable;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use la sincronizaci√≥n de estado cada vez que acceda a la variable de estado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las correcciones pueden requerir cambios de dise√±o significativos, por lo que es mucho m√°s f√°cil dise√±ar una clase segura para subprocesos de inmediato que actualizarla m√°s tarde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es dif√≠cil averiguar si m√∫ltiples hilos acceder√°n a esta o aquella variable. Afortunadamente, las soluciones t√©cnicas orientadas a objetos que ayudan a crear clases bien organizadas y f√°ciles de mantener, como encapsular y ocultar datos, tambi√©n ayudan a crear clases seguras para subprocesos. Cuantos menos subprocesos tengan acceso a una variable en particular, m√°s f√°cil ser√° garantizar la sincronizaci√≥n y establecer las condiciones bajo las cuales se puede acceder a esta variable. El lenguaje Java no lo obliga a encapsular el estado; es perfectamente aceptable almacenar el estado en campos p√∫blicos (incluso campos est√°ticos p√∫blicos) o publicar un enlace a un objeto que de otro modo ser√≠a interno, pero cuanto mejor est√© encapsulado el estado de su programa,cuanto m√°s f√°cil sea hacer que su programa sea seguro y ayudar a los encargados a mantenerlo as√≠.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al dise√±ar clases seguras para subprocesos, sus buenos asistentes ser√°n soluciones t√©cnicas orientadas a objetos: encapsulaci√≥n, mutabilidad y una especificaci√≥n clara de invariantes.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si las buenas soluciones t√©cnicas de dise√±o orientado a objetos difieren de las necesidades del desarrollador, debe sacrificar las reglas del buen dise√±o por el bien del rendimiento o la compatibilidad con el c√≥digo heredado. </font><font style="vertical-align: inherit;">A veces, la abstracci√≥n y la encapsulaci√≥n est√°n en desacuerdo con el rendimiento, aunque no tan a menudo como creen muchos desarrolladores, pero la mejor pr√°ctica es hacer que el c√≥digo sea correcto primero y luego r√°pido. </font><font style="vertical-align: inherit;">Intente utilizar la optimizaci√≥n solo si las mediciones de productividad y necesidades indican que debe hacerlo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el c√≥digo competitivo, debe cumplir con esta pr√°ctica incluso m√°s de lo habitual. Dado que los errores competitivos son extremadamente dif√≠ciles de reproducir y no son f√°ciles de depurar, la ventaja de una peque√±a ganancia de rendimiento en algunas ramas de c√≥digo raramente utilizadas puede ser bastante insignificante en comparaci√≥n con el riesgo de que el programa se bloquee en condiciones operativas.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si decide que necesita romper la encapsulaci√≥n, no todo est√° perdido. Su programa a√∫n puede hacerse seguro para subprocesos, pero el proceso ser√° m√°s complicado y m√°s costoso, y el resultado ser√° poco confiable. El Cap√≠tulo 4 describe las condiciones bajo las cuales se puede mitigar de forma segura la encapsulaci√≥n de variables de estado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasta ahora, hemos usado los t√©rminos "clase segura para subprocesos" y "programa seguro para subprocesos" casi indistintamente. ¬øEs un programa seguro para subprocesos construido completamente a partir de clases seguras para subprocesos? Opcional: un programa que consiste completamente en clases seguras para subprocesos puede no ser seguro para subprocesos y un programa seguro para subprocesos puede contener clases que no son seguras para subprocesos. Los problemas relacionados con el dise√±o de clases seguras para subprocesos tambi√©n se analizan en el Cap√≠tulo 4. En cualquier caso, el concepto de una clase segura para subprocesos tiene sentido solo si la clase encapsula su propio estado. El t√©rmino "seguridad de subprocesos" se puede aplicar al c√≥digo, pero habla del estado y solo se puede aplicar a esa matriz de c√≥digo que encapsula su estado (puede ser un objeto o todo el programa).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">¬øQu√© es la seguridad del hilo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Definir la seguridad del hilo no es f√°cil. </font><font style="vertical-align: inherit;">Una b√∫squeda r√°pida en Google le ofrece numerosas opciones como estas: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... se puede llamar desde m√∫ltiples hilos de programa sin interacciones no deseadas entre hilos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... puede ser llamado por dos o m√°s hilos al mismo tiempo, sin requerir ninguna otra acci√≥n de la persona que llama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadas tales definiciones, ¬°no es sorprendente que la seguridad de los hilos sea confusa! </font><font style="vertical-align: inherit;">¬øC√≥mo distinguir una clase segura para subprocesos de una clase insegura? </font><font style="vertical-align: inherit;">¬øQu√© queremos decir con la palabra "seguro"? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el coraz√≥n de cualquier definici√≥n razonable de seguridad del hilo est√° la noci√≥n de correcci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La correcci√≥n significa que la clase se ajusta a su especificaci√≥n. </font><font style="vertical-align: inherit;">La especificaci√≥n define invariantes que limitan el estado de un objeto y las condiciones posteriores que describen los efectos de las operaciones. </font><font style="vertical-align: inherit;">¬øC√≥mo sabes que las especificaciones para las clases son correctas? </font><font style="vertical-align: inherit;">De ninguna manera, pero esto no nos impide usarlos despu√©s de habernos convencido de que el c√≥digo funciona. </font><font style="vertical-align: inherit;">As√≠ que supongamos que la correcci√≥n de un solo subproceso es algo visible. </font><font style="vertical-align: inherit;">Ahora podemos suponer que la clase segura para subprocesos se comporta correctamente durante el acceso desde m√∫ltiples subprocesos.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una clase es segura para subprocesos si se comporta correctamente durante el acceso desde m√∫ltiples subprocesos, independientemente de c√≥mo estos subprocesos est√°n programados o intercalados por el entorno de trabajo, y sin sincronizaci√≥n adicional u otra coordinaci√≥n por parte del c√≥digo de llamada.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un programa multiproceso no puede ser seguro para subprocesos si no es correcto incluso en un entorno de subproceso √∫nico </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si el objeto se implementa correctamente, entonces ninguna secuencia de operaciones (acceso a m√©todos p√∫blicos y lectura o escritura en campos p√∫blicos) deber√≠a violar sus invariantes o condiciones posteriores. </font><font style="vertical-align: inherit;">Ning√∫n conjunto de operaciones realizadas de forma secuencial o competitiva en instancias de una clase segura para subprocesos puede hacer que una instancia est√© en un estado no v√°lido. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(3) </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el uso suelto del t√©rmino correcci√≥n le molesta aqu√≠, entonces puede pensar en una clase segura para subprocesos como una clase que es defectuosa en un entorno competitivo, as√≠ como en un entorno de un solo subproceso.</font></font></i><br>
 <br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las clases seguras para subprocesos encapsulan cualquier sincronizaci√≥n necesaria y no necesitan la ayuda de un cliente.</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.1 </font><font style="vertical-align: inherit;">Ejemplo: servlet sin soporte de estado interno</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el Cap√≠tulo 1, hemos enumerado las estructuras que crean hilos y llaman componentes de los cuales usted es responsable de la seguridad de los hilos. </font><font style="vertical-align: inherit;">Ahora tenemos la intenci√≥n de desarrollar un servicio de factorizaci√≥n de servlets y expandir gradualmente su funcionalidad mientras se mantiene la seguridad del hilo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El Listado 2.1 muestra un servlet simple que descomprime un n√∫mero de una consulta, lo factoriza y envuelve los resultados en respuesta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listado 2.1. </font><font style="vertical-align: inherit;">Servlet sin soporte interno del estado</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@ThreadSafe</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StatelessFactorizer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Servlet</span> </span>{
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest req, ServletResponse resp)</span> </span>{<font></font>
            BigInteger i = extractFromRequest(req);<font></font>
            BigInteger[] factors = factor(i);<font></font>
            encodeIntoResponse(resp, factors);<font></font>
      }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase StatelessFactorizer, como la mayor√≠a de los servlets, no tiene estado interno: no contiene campos y no hace referencia a campos de otras clases. </font><font style="vertical-align: inherit;">El estado para un c√°lculo particular existe solo en las variables locales que se almacenan en la pila de flujo y est√°n disponibles solo para el flujo en ejecuci√≥n. </font><font style="vertical-align: inherit;">Un subproceso que accede a StatelessFactorizer no puede afectar el resultado de que otro subproceso haga lo mismo, porque estos subprocesos no comparten el estado.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los objetos sin soporte de estado interno siempre son seguros para subprocesos.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El hecho de que la mayor√≠a de los servlets se pueden implementar sin soporte interno del estado reduce significativamente la carga de enhebrar los servlets mismos. </font><font style="vertical-align: inherit;">Y solo cuando los servlets necesitan recordar algo, aumentan los requisitos para la seguridad de su hilo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Atomicidad</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© sucede cuando un elemento de estado se agrega a un objeto sin soporte interno de estado? Supongamos que queremos agregar un contador de visitas que mida el n√∫mero de solicitudes procesadas. Puede agregar un campo de tipo largo al servlet e incrementarlo con cada solicitud, como se muestra en UnsafeCountingFactorizer en el Listado 2.2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listado 2.2. Un servlet que cuenta las solicitudes sin la sincronizaci√≥n necesaria. Esto no debe hacerse.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/lj/hg/geljhgzyo9aogxu-ttztrzuawqo.jpeg" alt="imagen"></div><br>
<pre><code class="java hljs"><span class="hljs-meta">@NotThreadSafe</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnsafeCountingFactorizer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Servlet</span> </span>{
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> count = <span class="hljs-number">0</span>;<font></font>
<font></font>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> count; }<font></font>
<font></font>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest req, ServletResponse resp)</span> </span>{<font></font>
            BigInteger i = extractFromRequest(req);<font></font>
            BigInteger[] factors = factor(i);<font></font>
            ++count;<font></font>
            encodeIntoResponse(resp, factors);<font></font>
      }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, la clase UnsafeCountingFactorizer no es segura para subprocesos, incluso si funciona bien en un entorno de subproceso √∫nico. Al igual que UnsafeSequence, es propenso a perder actualizaciones. Aunque el recuento de la operaci√≥n incremental ++ tiene una sintaxis compacta, no es at√≥mica, es decir, indivisible, sino una secuencia de tres operaciones: entregar el valor actual, agregarle uno y volver a escribir el nuevo valor. En las operaciones de "lectura, cambio, escritura", el estado resultante se deriva del anterior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la Fig. </font><font style="vertical-align: inherit;">1.1 se muestra lo que puede suceder si dos hilos intentan aumentar el contador al mismo tiempo, sin sincronizaci√≥n. </font><font style="vertical-align: inherit;">Si el contador es 9, entonces, debido a una coordinaci√≥n de tiempo fallida, ambos hilos ver√°n el valor 9, agregar√°n uno y establecer√°n el valor en 10. Por lo tanto, el contador de visitas comenzar√° a retrasarse en uno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede pensar que tener un contador de visitas ligeramente inexacto en un servicio web es una p√©rdida aceptable, y a veces lo es. </font><font style="vertical-align: inherit;">Pero si el contador se usa para crear secuencias o identificadores √∫nicos de objetos, entonces devolver el mismo valor de m√∫ltiples activaciones puede generar serios problemas de integridad de datos. </font><font style="vertical-align: inherit;">La posibilidad de la aparici√≥n de resultados incorrectos debido a una coordinaci√≥n de tiempo fallida surge en una condici√≥n de carrera.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.1. </font><font style="vertical-align: inherit;">Condiciones de carrera</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase UnsafeCountingFactorizer tiene varias condiciones de carrera </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . El tipo m√°s com√∫n de condici√≥n de carrera es la situaci√≥n de "comprobar y luego actuar", donde se usa una observaci√≥n potencialmente obsoleta para decidir qu√© hacer a continuaci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4)</font></font></b> <i>          (data race).   ,            .        ,    ,       ,   ,         ,      .               Java.       ,        ,             . UnsafeCountingFactorizer   .       16.</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A menudo nos encontramos con una condici√≥n de carrera en la vida real. Suponga que planea encontrarse con un amigo al mediod√≠a en Starbucks Caf√© en Universitetskiy Prospekt. Pero descubrir√°s que hay dos Starbucks en University Avenue. A las 12:10 no ves a tu amigo en el caf√© A y vas al caf√© B, pero √©l tampoco est√° all√≠. O tu amigo llega tarde, o lleg√≥ al caf√© A inmediatamente despu√©s de que te fuiste, o estaba en el caf√© B, pero fue a buscarte y ahora se dirige al caf√© A. Aceptaremos esto √∫ltimo, es decir, el peor de los casos. Ahora son las 12:15 y los dos se preguntan si su amigo cumpli√≥ su promesa. ¬øRegresar√°s a otro caf√©? ¬øCu√°ntas veces ir√°s de un lado a otro? Si no ha acordado un protocolo, puede pasar todo el d√≠a caminando por la Avenida de la Universidad en euforia con cafe√≠na.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema con el enfoque de "dar un paseo y ver si √©l est√° all√≠" es que un paseo por la calle entre dos caf√©s lleva varios minutos, y durante este tiempo el estado del sistema puede cambiar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo con Starbucks ilustra la dependencia del resultado en la coordinaci√≥n relativa del tiempo de los eventos (en cu√°nto tiempo espera a un amigo mientras est√° en un caf√©, etc.). </font><font style="vertical-align: inherit;">La observaci√≥n de que no est√° en el caf√© A se vuelve potencialmente inv√°lida: tan pronto como salgas de la puerta principal, √©l puede entrar por la puerta trasera. </font><font style="vertical-align: inherit;">La mayor√≠a de las condiciones de carrera causan problemas como una excepci√≥n inesperada, datos sobrescritos y corrupci√≥n de archivos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2. </font><font style="vertical-align: inherit;">Ejemplo: condiciones de carrera en inicializaci√≥n perezosa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un truco com√∫n que utiliza el enfoque "comprobar y luego actuar" es la inicializaci√≥n diferida (LazyInitRace). Su prop√≥sito es posponer la inicializaci√≥n del objeto hasta que sea necesario, y asegurarse de que se inicialice solo una vez. En el Listado 2.3, el m√©todo getInstance verifica que el ExpensiveObject se inicializa y devuelve una instancia existente o, de lo contrario, crea una nueva instancia y la devuelve despu√©s de mantener una referencia a ella. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listado 2.3. La condici√≥n de carrera est√° en una inicializaci√≥n perezosa. Esto no debe hacerse.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/lj/hg/geljhgzyo9aogxu-ttztrzuawqo.jpeg" alt="imagen"></div><br>
<pre><code class="java hljs"><span class="hljs-meta">@NotThreadSafe</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyInitRace</span> </span>{
      <span class="hljs-keyword">private</span> ExpensiveObject instance = <span class="hljs-keyword">null</span>;<font></font>
<font></font>
      <span class="hljs-function"><span class="hljs-keyword">public</span> ExpensiveObject <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-keyword">null</span>)<font></font>
                instance = <span class="hljs-keyword">new</span> ExpensiveObject();
            <span class="hljs-keyword">return</span> instance;<font></font>
      }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La clase LazyInitRace contiene condiciones de carrera. Suponga que los hilos A y B ejecutan el m√©todo getInstance al mismo tiempo. A ve que el campo de instancia es nulo y crea un nuevo objeto caro. El hilo B tambi√©n verifica si el campo de instancia es el mismo nulo. La presencia de nulo en el campo en este momento depende de la coordinaci√≥n del tiempo, incluidos los caprichos de la planificaci√≥n y la cantidad de tiempo requerida para crear una instancia del Objeto caro y establecer el valor en el campo de la instancia. Si el campo de instancia es nulo cuando B lo verifica, dos elementos de c√≥digo que llaman al m√©todo getInstance pueden obtener dos resultados diferentes, incluso si se supone que el m√©todo getInstance siempre devuelve la misma instancia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contador de visitas en UnsafeCountingFactorizer tambi√©n contiene condiciones de carrera. El enfoque de "leer, cambiar, escribir" implica que para incrementar el contador, la secuencia debe conocer su valor anterior y asegurarse de que nadie m√°s cambie o use este valor durante el proceso de actualizaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como la mayor√≠a de los errores competitivos, las condiciones de carrera no siempre conducen al fracaso: la coordinaci√≥n temporal es exitosa. </font><font style="vertical-align: inherit;">Pero si la clase LazyInitRace se usa para crear instancias del registro de toda la aplicaci√≥n, cuando devuelva diferentes instancias de m√∫ltiples activaciones, los registros se perder√°n o las acciones recibir√°n representaciones contradictorias del conjunto de objetos registrados. </font><font style="vertical-align: inherit;">O si la clase UnsafeSequence se usa para generar identificadores de entidad en una estructura de conservaci√≥n de datos, entonces dos objetos diferentes pueden tener el mismo identificador, violando las restricciones de identidad.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.3. </font><font style="vertical-align: inherit;">Acciones compuestas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanto LazyInitRace como UnsafeCountingFactorizer contienen una secuencia de operaciones que deben ser at√≥micas. </font><font style="vertical-align: inherit;">Pero para evitar una condici√≥n de carrera, debe haber un obst√°culo para que otros hilos usen la variable mientras un hilo la modifica.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las operaciones A y B son at√≥micas si, desde el punto de vista del hilo que realiza la operaci√≥n A, la operaci√≥n B fue realizada completamente por otro hilo o ni siquiera parcialmente.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La atomicidad de la operaci√≥n de incremento en UnsafeSequence evitar√≠a la condici√≥n de carrera que se muestra en la Fig. 1.1. Las operaciones "verificar y luego actuar" y "leer, cambiar, escribir" siempre deben ser at√≥micas. Se denominan acciones compuestas: secuencias de operaciones que deben realizarse at√≥micamente para mantener la seguridad de subprocesos. En la siguiente secci√≥n, consideraremos el bloqueo, un mecanismo integrado en Java que proporciona atomicidad. Mientras tanto, solucionaremos el problema de otra manera aplicando la clase segura de subprocesos existente, como se muestra en el Factorizador de conteo en el Listado 2.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listado 2.4. Solicitudes de conteo de servlets usando AtomicLong</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@ThreadSafe</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountingFactorizer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Servlet</span> </span>{
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicLong count = <span class="hljs-keyword">new</span> AtomicLong(<span class="hljs-number">0</span>);<font></font>
<font></font>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> count.get(); }<font></font>
<font></font>
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">(ServletRequest req, ServletResponse resp)</span> </span>{<font></font>
            BigInteger i = extractFromRequest(req);<font></font>
            BigInteger[] factors = factor(i);<font></font>
            count.incrementAndGet();<font></font>
            encodeIntoResponse(resp, factors);<font></font>
      }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El paquete java.util.concurrent.atomic contiene variables at√≥micas para gestionar estados de clase. Reemplazando el tipo de contador de largo a AtomicLong, garantizamos que todas las acciones que se refieren al estado del contador son at√≥micas1. Dado que el estado del servlet es el estado del contador, y el contador es seguro para subprocesos, nuestro servlet se vuelve seguro para subprocesos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se agrega un √∫nico elemento de estado a una clase que no admite el estado interno, la clase resultante ser√° segura para subprocesos si el estado est√° completamente controlado por el objeto seguro para subprocesos. Pero, como veremos en la siguiente secci√≥n, la transici√≥n de una variable de estado a la siguiente no ser√° tan simple como la transici√≥n de cero a uno.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando sea conveniente, utilice objetos existentes seguros para subprocesos, como AtomicLong, para controlar el estado de su clase. </font><font style="vertical-align: inherit;">Los posibles estados de los objetos seguros para subprocesos existentes y sus transiciones a otros estados son m√°s f√°ciles de mantener y verificar para la seguridad de subprocesos que las variables de estado arbitrarias.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬ªSe puede encontrar m√°s informaci√≥n sobre el libro en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el sitio web del editor</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
¬ª </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extracto de</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Khabrozhiteley 25% de descuento en el cup√≥n - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Despu√©s del pago de la versi√≥n en papel del libro, se env√≠a un libro electr√≥nico por correo electr√≥nico.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489022/index.html">Usando RabbitMQ con MonsterMQ Parte 2</a></li>
<li><a href="../es489024/index.html">Biblioteca JavaScript de Webix a trav√©s de los ojos de un principiante. Parte 5. Trabajar con datos del lado del usuario</a></li>
<li><a href="../es489026/index.html">Cambiar los algoritmos de Google AdSense puede conducir a propietarios de sitios y webmasters</a></li>
<li><a href="../es489028/index.html">Sobre trabajo remoto</a></li>
<li><a href="../es489034/index.html">¬øLa nueva aplicaci√≥n m√≥vil UIS o salvaci√≥n para aquellos que buscan contrataci√≥n p√∫blica?</a></li>
<li><a href="../es489040/index.html">Contact Center AI: un tercero en conversaci√≥n est√° bien</a></li>
<li><a href="../es489042/index.html">Gran reapertura de la tienda: cargando datos en Android usando corutina</a></li>
<li><a href="../es489044/index.html">F√≠sica del texto. Parte 1. S√≠mbolos</a></li>
<li><a href="../es489046/index.html">Auto-conducci√≥n Monster Truck GAZ66 1/16</a></li>
<li><a href="../es489048/index.html">El registro y el seguimiento de consultas son las mejores pr√°cticas. Informe Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>