<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≠ üíº ‚õÖÔ∏è Disclosure of telephone number and geolocation through vulnerability in Telegram üóÇÔ∏è üé£ üÜö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, Telegram has been increasingly discussing the topic of breaking through people and leaking personal data. I was wondering how much the Teleg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Disclosure of telephone number and geolocation through vulnerability in Telegram</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495990/"><img src="https://habrastorage.org/webt/ve/mw/s5/vemws5sils-r3vtvvr7rg162sdw.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recently, Telegram has been increasingly discussing the topic of breaking through people and leaking personal data. </font><font style="vertical-align: inherit;">I was wondering how much the Telegram ecosystem itself is resistant to such leaks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the cut is the story of how I found a bug in Telegram. </font><font style="vertical-align: inherit;">The bug allows you to mislead the user, and push him to unknowingly share his data - geolocation and phone number.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's how it works:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/o8N0kjurgfo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
System complexity has always been an enemy of security. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegram has grown, has ceased to be just a messenger, and has grown to a large media platform with rich functionality. The Telegram Bot API stands out as a separate house, allowing you to build entire applications inside the messenger - the so-called bots. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Most likely, everyone who tried to create their own bot already knows that the user can be sent a request for his phone number using a special button. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The text on this button can be set to any. Moreover, the bot can use the same buttons for other interactions: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/c7/k8/trc7k8xz2pvmmzac1pfbwxdlxqi.jpeg" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After clicking on the button, the user will of course be shown a warning that his contact will now be sent to the bot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/su/5t/rk/su5trkfoqcrvxad8wg82xegm3bg.png" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This message speaks quite clearly about the risk of deanonymization, and warns the thoughtful user from actions dangerous to him. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Going through the API updates, I remembered that at some point Telegram gave users the opportunity to make their own localization of the messenger. There were examples when localization was used for comic alterations of the interface. At that moment, the same thought occurred to me that you might now: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But what if you try to "comically translate" a dialog box warning the user about transferring the phone number to the bot, replacing its text?</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/s_/gj/ed/s_gjeddr_shl8q4ghctcrur4g4s.png" alt="image" width="300"> <img src="https://habrastorage.org/webt/xt/cm/il/xtcmilq-vxhoyslwjpn8uolmhrs.png" alt="image" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At first, I thought that getting a user to install an extraneous xml file localization into the application would be much more difficult than just convincing to click on Share contact. Indeed, just like that, using an xml file, Telegram offered to distribute its localizations among interlocutors. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I thought, until I came across the </font><font style="vertical-align: inherit;">setlanguage link handler in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">android application source code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/nm/xv/qsnmxvjbble2rnvl-ufuadej46w.png" alt="image" width="600"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exactly what is needed! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turned out that Telegram had long ago made a translation platform, translations.telegram.org, accessible to all Telegram users, and now there is no need to transfer any xml files. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ws/rs/ov/wsrsovq81u4lsjh10u2dxoj3kjk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just click on the link </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/setlanguage/%lang%</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, after which the user will see a dialog box asking you to install a new language. </font><font style="vertical-align: inherit;">And this window is much less intimidating than a message about a phone number request:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/yu/mp/uoyumprj8sk-0mil-xflt1lqjre.png" alt="image" width="300"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How it works?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Register at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translations.telegram.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We add our language, translate the necessary </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface elements</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a couple of others</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In localization, you can write anything you want. We will write a harmless text instead of a terrible warning about sharing geolocation and phone number. We do the same for the other platforms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our poisonous language is ready. It remains to slip it to the user. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/aq/38/-waq38nqpnrd9a07kthuuuybsmk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I still could not find a way to find out if the user installed the localization offered to him. There were no language statistics on translations.telegram.org, nor changes in the user profile. Bot api allows you to find out the user's language through </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the language_code parameter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but its value is taken from the system settings. </font><font style="vertical-align: inherit;">Changing the language in the application does not affect the parameter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Well, then just add a little delay after the message with a link to the language. </font><font style="vertical-align: inherit;">After choosing a language, we suggest the user to familiarize themselves with the bot menu. </font><font style="vertical-align: inherit;">When you click OK in this dialog box, the number leaks to the bot with a message, and the bot deletes this message immediately. </font><font style="vertical-align: inherit;">If the bot uses webhook to receive updates, the message is deleted faster and the user may not understand that he just sent his contact. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
By the way, similarly to a contact request, a bot can ask a user to share his geolocation. </font><font style="vertical-align: inherit;">Yes, and this dialog box can also be ‚Äútranslated‚Äù.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to fix</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, you should not allow users to translate absolutely the entire interface without moderation. By the way, translation moderation is enabled for, for example, this dialog box </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translations.telegram.org/rutech/ios/unsorted/AuthCode.Alert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The need for moderation is reported to us by the Critical label. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/mq/1v/ekmq1vbreb7dxbm005uvbkx7rua.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that here is such a small omission as the absence of a Critical label for dialogs about sharing numbers and geolocation lead to a leak. A leak of very sensitive data, as for a messenger building its marketing around privacy / security. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A messenger tied to your personal phone number, by definition, cannot be private. It can only increase the cost of revealing your identity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This vulnerability fell into the bug bounty telegram program and was rated at 100 ‚Ç¨.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Come to us at Telegram chat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@secinfosec</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">There we share our experience and discuss everything related to information security: a bounty bug, pentests, paper and practical security, new threats and methods of dealing with them.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en495978/index.html">Three levels of audience analysis: looking for insights</a></li>
<li><a href="../en495980/index.html">How to disassemble the Tesla Model 3, modify it with a file and make a ventilator</a></li>
<li><a href="../en495982/index.html">We study the Mediastreamer2 VoIP engine. Part 4</a></li>
<li><a href="../en495984/index.html">React, performance and -500 milliseconds at launch - the history of our optimizations in numbers</a></li>
<li><a href="../en495986/index.html">Analysis of international documents on information security risk management. Part 2</a></li>
<li><a href="../en495994/index.html">Beginning of the academic quarter or how I became the coordinator of distance learning</a></li>
<li><a href="../en495996/index.html">Raspberry Pi, Python and watering indoor plants</a></li>
<li><a href="../en495998/index.html">Creating a Dark Theme for Stack Overflow</a></li>
<li><a href="../en496004/index.html">New models of data search and analysis. WSDM 2020 through the eyes of the Yandex.Tolki team</a></li>
<li><a href="../en496006/index.html">Outgrowing reverse proxy - technology for remote protection and site optimization without changing DNS A-records</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>