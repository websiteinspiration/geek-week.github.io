<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📻 🛡️ 🙌🏿 Der einfachste Start in STM durch "einen Ort" 🎁 👨🏿‍🤝‍👨🏾 🌂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wahrscheinlich ist die Zeit der Religionskriege von AVR gegen STM bereits vorbei, aber nein, nein, ja, es gibt Ausbrüche von Zusammenstößen zwischen d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Der einfachste Start in STM durch "einen Ort"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488380/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wahrscheinlich ist die Zeit der Religionskriege von AVR gegen STM bereits vorbei, aber nein, nein, ja, es gibt Ausbrüche von Zusammenstößen zwischen den beiden Lagern. Fast jede Veröffentlichung über AVR-Kunsthandwerk wird definitiv einen Kommentar enthalten wie "Ja, wie viel Sie Ihrer Großmutter scheißen können, es ist höchste Zeit, auf STM umzusteigen", dann die Variationen zum Thema Preis, Anzahl der Beine und Timer. Wenn der STMshcher weiter fortgeschritten ist, gibt es sicherlich einen Hinweis darauf, dass der AVR keinen DMA enthält und nicht, daher sollte der AVR sterben. Warum ein einfaches Blink-Voltmeter-Thermometer DMA, ein Berg von 16-Bit-Timern, 100 Beinen und einem 12-Bit-ADC, erklärt normalerweise niemand. Warum brauchen wir einen solchen Harvester in einem Gerät, das Tiny13 leicht herausnehmen kann und das gleichzeitig nicht einmal auf ein Drittel seiner Ressourcen geladen ist, wird niemand verstehen. Sie müssen nur zu STM32 wechseln, und das war's. Für hier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich muss sagen, die Leute haben ein Verlangen nach Neuheit. Aber kann ich es wirklich versuchen? Was ist, wenn es dir gefällt? Hier ist nur das Referenzhandbuch für das beliebte STM32F103C8T6, auf dem das massivste 1126-seitige Blue-Tablet basiert. Irgendwie hat es keinen „Schnellstart“. Sogar ein separates Dienstprogramm, das von den Ältesten „Kalokub“ so gehasst wird, und das muss untersucht werden, was ist was? Ja, und nachdem er sich mit Cube befasst hat, ist es unwahrscheinlich, dass er in 5 Minuten beginnt. Das von ihm erzeugte Fußtuch ist nicht die am besten zugängliche Lektüre für die Nacht. Es geht nur darum, in die Stirn zu gelangen, über die nicht jeder diskutieren kann.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zahlreiche Artikel, ähnlich wie dieser, über den schnellen und einfachen Start in STM verdienen eine gesonderte Diskussion. Bei all diesen Artikeln war ich zunächst durch einen Umstand sehr verwirrt. Nirgendwo gibt es eine detaillierte Erklärung dessen, was wir hier tatsächlich schreiben. Ein paar Screenshots, wie man ein Projekt erstellt, dann sofort eine Codewand, machen Sie es so! Und was ist da, warum ist es, warum ist es so, woher all diese scheinbar verständlichen Worte kommen, niemand vertieft sich darin, weil die Kräfte beim Schreiben eines Handbuchs zur Installation von Cale und Kuba und beim Starten des Projekts erschöpft waren. Erst nach einiger Zeit, individuell für jeden, versteht man, was passiert und warum. Im Gegenzug schlage ich einen Weg vor, nicht wie alle anderen von vorne zu beginnen, sondern vom Ende. Jetzt machen wir das Gegenteil, konfigurieren den Controller nicht, schreiben Code und debütieren ihn, sondern fahren sofort mit dem Debuggen fort.und zeichnen Sie unsere Aktionen in Form von Code auf.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher installieren wir Keil als kostenlose Umgebung (bis zu 32 KB Code). Wir werden diese Aktion nicht beschreiben, sie befindet sich im Internet und die schrittweise Anleitung des Installateurs muss von der Person beherrscht werden, die zu STM geht. Wir starten das Projekt: Project-New uVision Project, erstellen einen Ordner und eine Projektdatei. Das Controller-Auswahlfenster wird geöffnet, geben Sie 103C8 in die Suche ein und stimmen Sie dem einzigen ausgewählten Modell zu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes gelangen wir zum Bibliotheksauswahlfenster:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/ox/yf/4voxyfdppukch2gamrnsguvzbfk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier setzen wir drei Morgen: CMSIS-CORE, Device-Startup und Device-GPIO. Dieses Set reicht völlig aus, um ein Bein zu hüpfen und die LED zu beleuchten. Dann müssen Sie noch konfigurieren, Sie können nichts davon bekommen. Alt + F7 öffnet das Einstellungsfenster unter Projektoptionen für Ziel. Auf der Registerkarte "Ausgabe" müssen Sie das Kontrollkästchen "HEX-Datei erstellen" aktivieren, um eine Firmware-Datei zu erstellen, die wir auf den Controller hochladen. Als nächstes wählen wir auf der Registerkarte "Debuggen" ST-Link aus, wodurch die Firmware und das Debüt heruntergeladen werden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kd/uw/6l/kduw6ltbrav_uadgbbrp93w5oke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Über die Schaltfläche "Einstellungen" neben dem Auswahlfenster des Programmierers gelangen wir zum Fenster "Cortex-M-Zieltreiber-Setup", in dem sich " Flash Download "Setzen Sie eine Morgendämmerung" Zurücksetzen und Ausführen ".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie in der Projektstruktur mit der rechten Maustaste auf den Ordner „Quellgruppe 1“. Erstellen Sie im daraufhin geöffneten Assistenten die Datei main.c, in die wir in Kürze den Code schreiben werden. Klicken Sie in der geöffneten Datei main.c mit der rechten Maustaste auf die erste und wichtigste Aufnahme: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qc/zp/ju/qczpjupur2s0vqx-reffsuzy5qo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie den Code hinzu, der aus main und endlos besteht, während:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
int main(){<font></font>
	while(1){<font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seltsamerweise ist dies alles für den Moment, dies ist ein vorgefertigtes und verständliches Programm, das korrekt kompiliert und in die Steuerung geladen wird. Wir drücken F7 und sehen, dass die Firmware erfolgreich zusammengestellt wurde, es gibt keine Fehler oder Warnungen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4b/bs/d3/4bbsd3ca51m6nmrx4gon6a_rwyw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von diesem Moment an ist der Controller für uns vollständig zugänglich. Wir können ihn unter der Debug-Zeile eingeben und in alle Richtungen drehen, und er wird reagieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Tasten Strg + F5 führen uns zum Debuggen, und mit der Schaltfläche „System Viewer Windows“ können Sie die Fenster zum Steuern der Registerregister und zum Steuern der Beine des GPIO starten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1e/ri/u1/1eriu1hhnribtydyhsaq-i36lr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem schlage ich vor, dass Sie das Referenzhandbuch weiterhin verwenden, insbesondere da Sie es nicht einmal herunterladen müssen. Es ist verfügbar, indem Sie im Menü „Ansicht“ auf die Registerkarte „Bücher“ klicken:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fx/4j/hm/fx4jhmgymzqzczhfcqto1wusr2m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt schlage ich vor, die folgenden Argumente zu verwenden. Aus der Pinbelegung auf dem Blue Tablet ist ersichtlich, dass die LED am Zweig von Port 13 hängt. Zahlreiche Internetressourcen und Diskussionen erwähnen immer, dass Sie etwas aktivieren müssen, bevor Sie etwas in STM tun, andernfalls stellen Sie die Uhr ein. Ohne weiteres schreiben wir in das Suchfeld des PDF-Readers, was wir brauchen, nämlich Port C zu aktivieren: "PORT C CLOCK ENABLE". Wir </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qf/lh/vs/qflhvsoyc3fhyds54-clxwq0eqo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kommen </font><font style="vertical-align: inherit;">zu folgendem Bild: </font><font style="vertical-align: inherit;">Daraus können wir schließen, dass die Taktung von Port C im IOPCEN-Register aktiviert ist. Mit diesem Wissen wechseln wir im Debug-Modus zur Registerkarte RCC und geben diesen Namen in die Suchleiste ein: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/x4/3q/z0x43qbnbga_-q0voxoajotxuqs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Markieren Sie das erforderliche Kontrollkästchen mit einem Häkchen, und ab diesem Moment betrachten wir Port C als aktiviert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir uns nun an den langmütigen AVR erinnern, werden wir nach der Einstellung des tatsächlichen Pins suchen. Damit es funktioniert, muss erklärt werden, was genau wir davon wollen. Und wir wollen mit Fuß Nummer 13 von Port C springen, dafür müssen wir den Betriebsmodus einstellen. In der Suchleiste im Referenzhandbuch fahren wir in der „Port-Bit-Konfiguration“, die unseren Wunsch zum Ausdruck bringt, zu lesen, wo die Beineinstellungen versteckt sind. Die Suche führt uns zu einer Tabelle, aus der folgt, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/c4/ot/odc4oti0osjwy9qvuax79slsqv4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dass zum Zuweisen eines Beins als Ausgang die Register </font><font style="vertical-align: inherit;">MODE und CNF konfiguriert werden müssen: </font><font style="vertical-align: inherit;">Aus Tabelle Nr. 20 geht hervor, dass zum Zuweisen eines Beins als Push-Pull-Ausgang die Register CNF0 und CNF1 sowie der Paarzustand zurückgesetzt werden müssen MODE0 und MODE1 sind in Tabelle Nr. 21 beschrieben. Ich werde die obere Option wählen, bis zu 10 MHz, MODE0 = 1, MODE1 = 0. Dies werde ich im GPIOC-Fenster für die Register CNF13 und MODE13 tun</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-n/x5/y3/-nx5y33grvntsdchwf7emhxlgnc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt haben wir die Uhr und den Betriebsmodus des Ports konfiguriert. Es ist Zeit, genau herauszufinden, wie man ein Bein springt. Auf Englisch wird gesetzt, dass das Port-Bit als „Port-Bit gesetzt“ geschrieben ist, und wir werden im Handbuch nach diesem Satz suchen: Die </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nw/l8/r2/nwl8r2ne5djl9o3hmpwxg2eigg0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suche führt uns zu einer Seite mit einer Tabelle, die deutlich zeigt, dass das BSRR-Register, bestehend aus BS- und BR-Paaren, für das Setzen des Status des Port-Beins verantwortlich ist , Bit gesetzt bzw. Bit zurückgesetzt. Wir finden diese Register im GPIOC-Fenster im Debug-Modus und genießen die Steuerung von Bein Nummer 13 direkt, indem wir Dohlen mit der Maus in die entsprechenden Kontrollkästchen stecken:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ob/vj/c3/obvjc3gnvzem1sh6tecfly7quyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine LED auf der blauen Pillenplatte hängt zwischen dem Bein und dem VCC und steuert diese zurück zum Registernamen. Das Bit-Set (BS13-Register) löscht es und das Bit-Reset (BR13-Register) zündet es. Dies sind Register atomarer Operationen, die nach dem Aktivieren des Kontrollkästchens zurückgesetzt werden. Es ist möglich, den Fuß über das ODR-Register zu steuern (Abschnitt 9.2.4 Port-Ausgangsdatenregister (GPIOx_ODR) im Referenzhandbuch). Es zeigt deutlich, wozu die Installation und das Zurücksetzen der Dohle führt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nv/rd/ou/nvrdouc1ano_fn8gdpdplk2v5rq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine grüne und dimmende grüne LED zeigt an, dass alles richtig funktioniert. Es bleibt nur, dies alles in Form von Code in die main.c. zu schreiben. Hier erscheinen genau die Rosinen, die diese Methode zum Erfassen des STM-Controllers durch Debug von den anderen unterscheiden, mit denen das gesamte Internet übersät ist. Ich schlage vor, nur das, was wir im Debug-Fenster sehen, in Code umzuschreiben. Beispiel:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kq/f9/ww/kqf9wwqdt2ydqoz9ovv1f9k2xt0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie den Port-Betriebsmodus ein und aktivieren Sie die Taktung. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/a-/fk/iua-fkaw0im1tjbpxqm4kwpruio.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie schalteten das Hafenbein ein, warteten, schalteten es aus und so weiter:</font></font><br>
<br>
<pre><code class="plaintext hljs">#include "stm32f10x.h"                  // Device header<font></font>
<font></font>
int main(){<font></font>
	RCC-&gt;APB2ENR=0x00000010;			//  <font></font>
	GPIOC-&gt;CRH=0x44144444;			//   Push-Pull  10MHz<font></font>
	int i;								//     / <font></font>
	while(1){<font></font>
		GPIOC-&gt;ODR=0x00002000;		//  LED,      <font></font>
		i=2000000;					//    <font></font>
		while (i) i--;					// <font></font>
		GPIOC-&gt;ODR=0x00000000;		//  LED<font></font>
		i=2000000;					//  <font></font>
		while (i) i--;					<font></font>
	}<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich ist diese Methode alles andere als die beste und nicht korrekt, aber meiner Meinung nach die verständlichste und einfachste. Darüber hinaus führt er in die Arbeit mit einem Datenblatt (Referenzhandbuch) ein und macht keine Angst, wie das Lesen von Mana und das Schreiben mehrseitiger Fußtücher mit Code für Blink. Ja, es gibt keine Abstraktionsebenen, viel wurde übersehen, aber ich denke, Sie können dies für den elementaren Start verzeihen. Mana lesen und richtig mit Registern arbeiten ist jetzt, jetzt blinkt die LED und wir verstehen im Grunde, wie und was wir getan haben und vor allem, woher all diese Abkürzungen kamen. Wenn mir diese Art des Studierens von STM schon einmal gezeigt worden wäre, hätte ich vielleicht nicht mehr als 9000 verschiedene Programmierer für AVR gesammelt, in denen es kein Debugging gab, sondern mich sofort mit dem Cortex befasst. In AVR gibt es zwar kein verständliches und zugängliches Debug, aber es ist noch zu früh, um Tiny13 zu vergessen. Sie nimmt ihre Aufgaben auf.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488368/index.html">Was ich bei der Arbeit an meinem ersten Großprojekt gelernt habe</a></li>
<li><a href="../de488370/index.html">TDD für Mikrocontroller. Teil 2: Wie Spione Abhängigkeiten loswerden</a></li>
<li><a href="../de488374/index.html">Telegramm + 1C + Webhooks + Apache + Selbstsigniertes Zertifikat</a></li>
<li><a href="../de488376/index.html">Wenn das Prinzip "zur Hölle mit allem, nimm es und mach es!" funktioniert nicht: Zaudernotizen</a></li>
<li><a href="../de488378/index.html">Kurz über die Benennung in JS</a></li>
<li><a href="../de488382/index.html">Ich füge Websites, die ich besuche, eine Verzögerung von 3 bis 25 Sekunden hinzu</a></li>
<li><a href="../de488386/index.html">Fälle für die Anwendung von Tools zur Analyse von Netzwerkanomalien: Angriffe über Browser-Plug-Ins</a></li>
<li><a href="../de488388/index.html">Relogin und HTTP Basic Auth</a></li>
<li><a href="../de488390/index.html">So machen Sie mit OpenId Connect Telegramm-Bot-Freunde</a></li>
<li><a href="../de488392/index.html">Produktionsbereite Bilder für k8s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>