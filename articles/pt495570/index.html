<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚌 👩🏾‍🎓 ☁️ Profundidade da toca do coelho ou entrevista em C ++ no PVS-Studio 🤸🏽 🚨 🏉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Autores: Andrey Karpov, khandeliantsPhilip Handelyants. 
 
 Gostaria de compartilhar uma situação interessante quando a pergunta que usamos na entrevi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Profundidade da toca do coelho ou entrevista em C ++ no PVS-Studio</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/495570/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c8/090/606/9c80906065d1212a18f358f97ebbd11f.png" alt="Entrevista em C ++ no PVS-Studio"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autores: Andrey Karpov, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">khandeliants</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philip Handelyants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gostaria de compartilhar uma situação interessante quando a pergunta que usamos na entrevista se mostrou mais complicada do que o autor pretendia. </font><font style="vertical-align: inherit;">Com a linguagem C ++ e os compiladores, você sempre deve estar atento. </font><font style="vertical-align: inherit;">Não fique entediado.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como em qualquer outra empresa de programação, temos conjuntos de perguntas para entrevistas para vagas de desenvolvedores em C ++, C # e Java. Temos muitas perguntas com fundo duplo ou triplo. Para perguntas sobre C # e Java, não podemos ter certeza, pois eles têm outros autores. Mas muitas das perguntas compiladas por Andrei Karpov para entrevistas em C ++ foram imediatamente concebidas para sondar a profundidade do conhecimento dos recursos da linguagem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas perguntas podem receber uma resposta correta simples. Você pode ir cada vez mais fundo. Dependendo disso, durante a entrevista, determinamos o quanto uma pessoa está familiarizada com as nuances do idioma. Isso é importante para nós, pois estamos desenvolvendo um analisador de código e deve entender muito bem as sutilezas e as "piadas" do idioma.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, contaremos uma pequena história sobre como uma das primeiras perguntas feitas na entrevista foi ainda mais profunda do que planejamos. Então, mostramos este código:</font></font><br>
<br>
<pre><code class="cpp">void F1()<font></font>
{<font></font>
  int i = 1;<font></font>
  printf("%d, %d\n", i++, i++);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e pergunte: "O que será impresso?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Boa pergunta. Imediatamente pode dizer muito sobre o conhecimento. Casos em que uma pessoa não possa respondê-la não serão considerados. Estes são eliminados por testes preliminares no site do HeadHunter (hh.ru). Embora não, eles são besteiras. Em nossa memória, havia duas personalidades únicas que responderam algo no espírito: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este código imprimirá no início uma porcentagem, depois d, depois outra porcentagem, d, depois uma varinha, ne duas unidades.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Claramente, nesses casos, a entrevista termina rapidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, agora de volta à entrevista normal :). Frequentemente, eles respondem assim: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 e 2. serão impressos.Esta</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
é a resposta do nível interno. Sim, é claro que esses valores podem ser impressos, mas estamos aguardando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aproximadamente a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seguinte resposta:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso não quer dizer o que </font></font></i><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exatamente</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esse código imprimirá. Esse é um comportamento não especificado (ou indefinido). A ordem na qual os argumentos são calculados não está definida. Todos os argumentos devem ser avaliados antes que o corpo da função chamada seja executado, mas a ordem na qual isso acontecerá é deixada a critério do compilador. Portanto, o código pode muito bem imprimir "1, 2" e vice-versa "2, 1". Em geral, escrever esse código é </font></font></i><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">altamente</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indesejável; se for construído por pelo menos dois compiladores, é possível disparar com o pé. E muitos compiladores darão um aviso aqui.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De fato, se você usar o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , poderá obter "1, 2". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se você usa o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pode obter "2, 1".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Era uma vez tentamos o compilador MSVC, e ele também produziu "2, 1". Sem sinais de problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recentemente, para fins gerais de terceiros, foi novamente necessário compilar esse código usando o Visual C ++ moderno e executá-lo. Montado em Configuração da versão com a otimização </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ O2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ativada </font><font style="vertical-align: inherit;">. E, como eles dizem, eles encontraram aventura em suas próprias cabeças :). O que você acha que aconteceu? Ha! Aqui está o que: "1, 1". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então pense no que você quer. Acontece que a questão é ainda mais profunda e mais confusa. Nós mesmos não esperávamos que isso acontecesse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o padrão C ++ não regula o cálculo dos argumentos de forma alguma, o compilador interpreta esse tipo de comportamento não especificado de uma maneira muito peculiar. </font><font style="vertical-align: inherit;">Vamos dar uma olhada no código do assembler gerado pelo compilador MSVC 19.25 (Microsoft Visual Studio Community 2019, versão 16.5.1), a versão do sinalizador do padrão de idioma é '/ std: c ++ 14':</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e42/26e/b7c/e4226eb7c1a4ab93f734807976c269bc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formalmente, o otimizador transformou o código acima no seguinte:</font></font><br>
<br>
<pre><code class="cpp">void F1()<font></font>
{<font></font>
  int i = 1;<font></font>
  int tmp = i;<font></font>
  i += 2;<font></font>
  printf("%d, %d\n", tmp, tmp);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do ponto de vista do compilador, essa otimização não altera o comportamento observado do programa. </font><font style="vertical-align: inherit;">Olhando para isso, você começa a entender que, por uma boa razão, o padrão C ++ 11, além de ponteiros inteligentes, também adicionou a função "mágica" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make_shared</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (e o C ++ 14 também adicionou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make_unique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Um exemplo tão inofensivo, e também pode "quebrar lenha":</font></font><br>
<br>
<pre><code class="cpp">void foo(std::unique_ptr&lt;int&gt;, std::unique_ptr&lt;double&gt;);<font></font>
<font></font>
int main()<font></font>
{<font></font>
  foo(std::unique_ptr&lt;int&gt; { new int { 0 } },<font></font>
      std::unique_ptr&lt;double&gt; { new double { 0.0 } });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um compilador astuto pode transformar isso na seguinte ordem de cálculos (o mesmo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSVC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por exemplo):</font></font><br>
<br>
<pre><code class="cpp">new int { .... };<font></font>
new double { .... };<font></font>
std::unique_ptr&lt;int&gt;::unique_ptr<font></font>
std::unique_ptr&lt;double&gt;::unique_ptr<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a segunda chamada para o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operador </font><font style="vertical-align: inherit;">gerar uma exceção, ocorreremos um vazamento de memória. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas voltando ao tópico original. </font><font style="vertical-align: inherit;">Apesar do fato de que tudo estava bem do ponto de vista do compilador, ainda tínhamos certeza de que a saída "1, 1" foi incorretamente considerada o comportamento esperado pelo desenvolvedor. </font><font style="vertical-align: inherit;">E então tentamos compilar o código-fonte com o compilador MSVC com o sinalizador de versão padrão '/ std: c ++ 17'. </font><font style="vertical-align: inherit;">E tudo começa a funcionar como esperado, e "2, 1" é impresso. </font><font style="vertical-align: inherit;">Dê uma olhada no código do assembler:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f44/a37/a88/f44a37a8836d786f6dda5b11b165b944.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo é justo, o compilador passou os valores 2 e 1. Mas por que tudo mudou tão dramaticamente? Acontece que o seguinte foi adicionado ao padrão C ++ 17: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A expressão postfix é sequenciada antes de cada expressão na lista de expressões e em qualquer argumento padrão. A inicialização de um parâmetro, incluindo todo cálculo de valor associado e efeito colateral, é sequenciada indeterminadamente em relação a qualquer outro parâmetro.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O compilador ainda tem o direito de calcular argumentos em uma ordem arbitrária, mas agora, a partir do padrão C ++ 17, tem o direito de começar a calcular o próximo argumento e seus efeitos colaterais apenas a partir do momento em que todos os cálculos e efeitos colaterais do argumento anterior forem concluídos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, se você compilar o mesmo exemplo com ponteiros inteligentes com o sinalizador '/ std: c ++ 17', tudo ficará </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bom</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lá </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">também</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - usar </font><i><font style="vertical-align: inherit;">std :: make_unique</font></i><font style="vertical-align: inherit;"> agora </font><i><font style="vertical-align: inherit;">é</font></i><font style="vertical-align: inherit;"> opcional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está outra medida de profundidade na questão que acabou. Existe uma teoria, mas existe prática na forma de um compilador específico ou uma interpretação diferente do padrão :). O mundo do C ++ é sempre mais complexo e inesperado do que parece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se alguém puder explicar com mais precisão o que está acontecendo, informe-nos nos comentários. Finalmente, precisamos entender a pergunta para, pelo menos, nós mesmos sabermos a resposta na entrevista! :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está uma história tão informativa. </font><font style="vertical-align: inherit;">Esperamos que tenha sido interessante e você compartilhe sua opinião sobre esse tópico. </font><font style="vertical-align: inherit;">E recomendamos usar o mais moderno padrão de linguagem possível, para ficar menos surpreso com o que os compiladores de otimização atuais podem. </font><font style="vertical-align: inherit;">Melhor ainda, não escreva esse código :). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Podemos dizer que "iluminamos a pergunta" e agora ela terá que ser removida do questionário. </font><font style="vertical-align: inherit;">Não vemos o ponto nisso. </font><font style="vertical-align: inherit;">Se uma pessoa não está com preguiça de estudar nossas publicações antes da entrevista, lê esse material e depois o usa, então ele está bem-feito e, merecidamente, receberá uma vantagem :).</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você deseja compartilhar este artigo com um público que fala inglês, use o link para a tradução: Andrey Karpov, Phillip Khandeliants. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual é a profundidade da toca do coelho ou entrevistas de emprego em C ++ no PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495552/index.html">Minha tentativa de atrasar o COVID-19 (aparelho de respiração independente)</a></li>
<li><a href="../pt495554/index.html">Programa para pesquisar o VKontakte com a mesma opinião [Código aberto]</a></li>
<li><a href="../pt495556/index.html">Fortinet - uma seleção de materiais úteis</a></li>
<li><a href="../pt495558/index.html">O amanhã está nublado: as nuvens terão inteligência, complicarão a contratação de especialistas em TI, mas ajudarão a vender software</a></li>
<li><a href="../pt495560/index.html">Tendências da Internet das Coisas: IA responde a chamadas, nuvens e 5G domestica big data, habitação e serviços públicos - líder em inovação</a></li>
<li><a href="../pt495572/index.html">Comunidade de ecossistemas de hardware lança podcast para todos na indústria de eletrônicos</a></li>
<li><a href="../pt495574/index.html">Detecção e contagem de visitantes: nuvem vs. contador da câmera</a></li>
<li><a href="../pt495576/index.html">Plataforma automotriz no esp8266 MK com micropython</a></li>
<li><a href="../pt495580/index.html">JVM de pepino - não apenas BDD</a></li>
<li><a href="../pt495588/index.html">Criando roguelike no Unity a partir do zero: gerador de masmorras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>