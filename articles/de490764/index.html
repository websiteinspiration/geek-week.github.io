<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùáÔ∏è üôÜüèæ üÉè Grafana, InfluxDB, zwei Tags und eine Menge. Oder wie berechnet man die Summe der Untergruppen? üï∂Ô∏è üíáüèø üßëüèæ‚Äçü§ù‚Äçüßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen! 
 
 An Leistungstests beteiligt. Und ich mag es wirklich, die √úberwachung einzurichten und die Metriken in Grafana zu genie√üen . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Grafana, InfluxDB, zwei Tags und eine Menge. Oder wie berechnet man die Summe der Untergruppen?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/490764/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ol/b6/9a/olb69a8cdqhqtmjf-ic8x8qjevi.png"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo alle zusammen! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An Leistungstests beteiligt. </font><font style="vertical-align: inherit;">Und ich mag es wirklich, die √úberwachung einzurichten und die Metriken in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana zu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> genie√üen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Standard zum Speichern von Metriken in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lastwerkzeugen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">InfluxDB</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB k√∂nnen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie Metriken aus so beliebten Tools wie den folgenden speichern:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="  Apache.JMeter
Real-time results

In this document we will present the configuration setup to graph and historize the data in different backends:

 ‚Ä¢ InfluxDB setup for InfluxDBBackendListenerClient
 ‚Ä¢ InfluxDB setup for GraphiteBackendListenerClient
 ‚Ä¢ Grafana
 ‚Ä¢ Graphite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache.JMeter</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="  Gatling
Realtime monitoring

The sections below describe how to configure Gatling with InfluxDB and Graphite, and use Grafana as a graphing library"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gatling</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="  LoadRunner Enterprise
Manage analysis servers

This section describes how to configure external analysis database servers to be used with LoadRunner Enterprise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loadrunner-Unternehmen</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="  Yandex.Tank
Modules / Artifact uploaders / InfluxDB

      Yandex.Tank  InfluxDB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Arbeit mit Leistungstest-Tools und deren Metriken habe ich eine Auswahl von Programmierrezepten f√ºr das Bundle von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB zusammengestellt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ich schlage vor, ein interessantes Problem zu betrachten, das auftritt, wenn es eine Metrik mit zwei oder mehr Tags gibt. </font><font style="vertical-align: inherit;">Ich denke, das ist nicht ungew√∂hnlich. </font><font style="vertical-align: inherit;">Und im allgemeinen Fall klingt die Aufgabe so: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berechnung der Gesamtmetrik f√ºr eine Gruppe, die in Untergruppen unterteilt ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt drei M√∂glichkeiten: </font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur der Betrag, der nach Typ-Tag gruppiert ist</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana-Weg. </font><font style="vertical-align: inherit;">Wir verwenden einen Stapel von Werten</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summe der H√∂hen mit Unterabfrage</font></font></a></li>
</ol> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie alles begann</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurierte JVM-MBean-√úberwachung mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jolokia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Und er visualisierte Metriken f√ºr Speicherpools - wie viel Speicher von jedem Speicherpool in HEAP und dar√ºber hinaus zugewiesen wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagramme zu JVM-Speicherpools und Garbage Collector-Aktivit√§ten von 13:00 Uhr des Vortages bis 01:00 Uhr der Nacht des aktuellen Tages (Zeitraum von 12 Stunden). Hier sehen Sie, dass die Speicherpools in zwei Gruppen unterteilt sind: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Und dass es gegen 17:00 Uhr eine Speicherbereinigung gab, nach der die Gr√∂√üe der Speicherpools abnahm: </font><font style="vertical-align: inherit;">
Um Metriken f√ºr Speicherpools zu erfassen, habe ich die </font><font style="vertical-align: inherit;">folgenden Einstellungen </font><font style="vertical-align: inherit;">in der </font><b><font style="vertical-align: inherit;">Telegraf-</font></b><font style="vertical-align: inherit;"> Konfigurationsdatei angegeben </font><font style="vertical-align: inherit;">: </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ow/ow/os/owowosl0e-neglcsbew-0u7bjjq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<pre><code class="apache hljs">[<span class="hljs-attribute">outputs</span>.influxdb]
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://influxdb_server:8086"]</span>
  <span class="hljs-attribute">database</span> = <span class="hljs-string">"telegraf"</span>
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-InfluxDb"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">retention_policy</span> = <span class="hljs-string">"month"</span>
  <span class="hljs-attribute">influx_uint_support</span> = false<font></font>
<font></font>
[<span class="hljs-attribute">agent</span>]
  <span class="hljs-attribute">collection_jitter</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">interval</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">precision</span> = <span class="hljs-string">"s"</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent]]
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-Jolokia"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://127.0.0.1:7777/jvm-service"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent.metric]]
  <span class="hljs-attribute">paths</span> =<span class="hljs-meta"> ["Usage","PeakUsage","CollectionUsage","Type"]</span>
  <span class="hljs-attribute">name</span> = <span class="hljs-string">"java_memory_pool"</span>
  <span class="hljs-attribute">mbean</span> = <span class="hljs-string">"java.lang:name=*,type=MemoryPool"</span>
  <span class="hljs-attribute">tag_keys</span> =<span class="hljs-meta"> ["name"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">processors</span>.converter]]<font></font>
  [<span class="hljs-attribute">processors</span>.converter.fields]
    <span class="hljs-attribute">integer</span> =<span class="hljs-meta"> ["CollectionUsage.*", "PeakUsage.*", "Usage.*"]</span>
    <span class="hljs-attribute">tag</span> =<span class="hljs-meta"> ["Type"]</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana habe ich</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Anfrage an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB erstellt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um den maximalen </font><b><font style="vertical-align: inherit;">Metrikwert</font></b></font><b><code>Usage.Committed</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr einen bestimmten Zeitraum mit einem Schritt </font></font><b><code>$granularity</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1 m) </font><font style="vertical-align: inherit;">in Diagrammen anzuzeigen </font><font style="vertical-align: inherit;">und nach zwei Tags </font></font><b><code>Type</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(HEAP oder NON_HEAP) und </font></font><b><code>name</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Metaspace, G1 Old Gen, ...) zu </font><font style="vertical-align: inherit;">gruppieren: </font><font style="vertical-align: inherit;">Dieselbe </font><font style="vertical-align: inherit;">
Anfrage in Textform unter Ber√ºcksichtigung aller </font><b><font style="vertical-align: inherit;">Grafana-</font></b><font style="vertical-align: inherit;"> Variablen </font><font style="vertical-align: inherit;">(achten Sie darauf, dass die Variablenwerte nicht mit </font><font style="vertical-align: inherit;">- dies ist wichtig, damit die Abfrage ordnungsgem√§√ü funktioniert):</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/qx/2z/-2/qx2z-2mblgxyi-u6g4mrbyvybf8.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><code>:regex</code></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieselbe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Abfrage in Textform unter Ber√ºcksichtigung der spezifischen Werte der </font><b><font style="vertical-align: inherit;">Grafana-</font></b><font style="vertical-align: inherit;"> Variablen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^serverName$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^<span class="hljs-keyword">http</span>:\/\/<span class="hljs-number">127</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.1</span>:<span class="hljs-number">7777</span>\/jvm-service$/ <span class="hljs-keyword">AND</span>
    <span class="hljs-built_in">time</span> &gt;= <span class="hljs-number">1583834400000</span>ms <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &lt;= <span class="hljs-number">1583877600000</span>ms
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>m)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gruppieren nach Zeit </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder wird </font></font><b><code>GROUP BY time(1m)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwendet, um die Anzahl der Punkte im Diagramm zu reduzieren. </font><font style="vertical-align: inherit;">F√ºr einen Zeitraum von 12 Stunden und einen Gruppierungsschritt von 1 Minute erhalten wir: 12 x 60 = 720 mal oder 721 Punkte (der letzte Punkt mit dem Wert null).</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denken Sie daran, dass </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die erwartete Anzahl von Punkten als Antwort auf Anforderungen an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit den aktuellen Einstellungen f√ºr das Zeitintervall (12 Stunden) und den Gruppierungsschritt (1 Minute) ist.</font></font></blockquote> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Speicherpool </font><b><font style="vertical-align: inherit;">: Metaspace</font></b><font style="vertical-align: inherit;"> (blau) liegt beim Speicherverbrauch um 20:00 Uhr an der Spitze. </font><font style="vertical-align: inherit;">Und laut </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP: G1 Old Gen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gelb) gab es um 17:03 Uhr einen kleinen lokalen Anstieg. </font><font style="vertical-align: inherit;">Insgesamt </font><font style="vertical-align: inherit;">verlie√üen </font><font style="vertical-align: inherit;">alle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pools </font><font style="vertical-align: inherit;">zum Zeitpunkt 20:00 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (113,2 + 45,9 + 13,4) und die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (67 + 57 + 4).</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ku/mo/wf/kumowfdo6gkw3wx_b8mugtsp8l4.png"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie die Werte f√ºr 20:00: </font><b><font style="vertical-align: inherit;">NON_HEAP-</font></b><font style="vertical-align: inherit;"> Pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172,5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pools </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir werden uns in Zukunft auf diese Werte konzentrieren.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Kontext von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> haben wir den Metrikwert leicht erhalten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur im Zusammenhang mit dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namensschild</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Metrikwert ebenfalls leicht zu erhalten, da alle Namen der Speicherpools eindeutig sind und es ausreicht, die Gruppierung der Ergebnisse nur nach </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namen zu belassen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Frage bleibt: Wie erh√§lt man die Gr√∂√üe, die allen HEAP-Pools und allen NON_HEAP-Pools insgesamt zugewiesen ist?</font></font></blockquote><br>
<a name="1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Nur der Betrag, der nach Typ-Tag gruppiert ist</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1. </font><font style="vertical-align: inherit;">Summe gruppiert nach Tag</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die erste L√∂sung, die in den Sinn kommen k√∂nnte, besteht darin, die Werte nach dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tag zu gruppieren </font><font style="vertical-align: inherit;">und die Summe der Werte in jeder Gruppe zu berechnen. </font><font style="vertical-align: inherit;">Eine solche Abfrage sieht folgenderma√üen aus: Eine </font><font style="vertical-align: inherit;">
Textdarstellung einer </font><b><font style="vertical-align: inherit;">Summenberechnungsanforderung,</font></b><font style="vertical-align: inherit;"> gruppiert nach </font><b><font style="vertical-align: inherit;">Typ-</font></b><font style="vertical-align: inherit;"> Tag </font><font style="vertical-align: inherit;">mit allen </font><b><font style="vertical-align: inherit;">Grafana-</font></b><font style="vertical-align: inherit;"> Variablen </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/xz/w_/4a/xzw_4aonrgekrw4onxv9fwcctlg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine g√ºltige Abfrage, die jedoch nur zwei Punkte </font><font style="vertical-align: inherit;">zur√ºckgibt </font><font style="vertical-align: inherit;">: Die Summe wird bei Gruppierung nur durch das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tag </font><font style="vertical-align: inherit;">mit zwei Werten (HEAP und NON_HEAP) berechnet. </font><font style="vertical-align: inherit;">Wir werden nicht einmal den Zeitplan sehen. </font><font style="vertical-align: inherit;">Es gibt zwei freistehende Punkte mit einer gro√üen Wertesumme (mehr als 3 TiB): </font><font style="vertical-align: inherit;">
Eine solche Summe ist nicht geeignet, eine Aufteilung in Zeitintervalle ist erforderlich.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/sz/lx/bo/szlxboh0o4r3-jsq7jg9d49wnic.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2. </font><font style="vertical-align: inherit;">Betrag gruppiert nach Tag pro Minute</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der urspr√ºnglichen Abfrage haben wir Metriken nach einem benutzerdefinierten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ Granularit√§tsintervall</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gruppiert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lassen Sie uns jetzt die Gruppierung nach einem benutzerdefinierten Intervall durchf√ºhren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Abfrage wird sich herausstellen, f√ºgte sie hinzu </font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Wir erhalten aufgeblasene Werte, anstatt 172,5 MiB von </font><b><font style="vertical-align: inherit;">NON_HEAP sehen</font></b><font style="vertical-align: inherit;"> wir 4,88 GiB: </font><font style="vertical-align: inherit;">
Da Metriken alle 2 Sekunden einmal an InfluxDB gesendet werden (siehe </font><b><font style="vertical-align: inherit;">telegraf.conf</font></b><font style="vertical-align: inherit;"> oben), gibt die Summe der Messwerte in einer Minute nicht den Betrag an im Moment und die Summe von drei√üig solchen Betr√§gen. </font><font style="vertical-align: inherit;">Wir k√∂nnen </font><font style="vertical-align: inherit;">
das Ergebnis auch nicht durch die Konstante </font><b><font style="vertical-align: inherit;">30</font></b><font style="vertical-align: inherit;"> teilen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Da </font><b><font style="vertical-align: inherit;">$ granularity</font></b><font style="vertical-align: inherit;"> ein Parameter ist, kann er sowohl auf 1 Minute als auch auf 10 Minuten eingestellt werden. </font><font style="vertical-align: inherit;">Und der Wert des Betrags √§ndert sich.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/yb/xp/tw/ybxptwbmibq2xlujuuwbkwb83nq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/9l/lo/hn/9llohn9ncpoztbtcsrfqzfzoqya.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3. </font><font style="vertical-align: inherit;">Tag pro Sekunde gruppiert</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Metrikwert f√ºr die aktuelle Intensit√§t der Metriksammlung (2 Sekunden) korrekt zu erhalten, m√ºssen Sie den Betrag f√ºr ein festes Intervall berechnen, das die Intensit√§t der Metriksammlung nicht √ºberschreitet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, Statistiken mit einer Gruppierung in Sekunden anzuzeigen. Zur </font></font><b><code>GROUP BY</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gruppierung hinzuf√ºgen </font></font><b><code>time(1s)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Mit einer so kleinen Granularit√§t erhalten wir eine gro√üe Anzahl von Punkten f√ºr unser Zeitintervall von 12 Stunden (12 Stunden * 60 Minuten * 60 Sekunden = 43.200 Intervalle, 43.201 Punkte pro Zeile, von denen der letzte null ist): </font><font style="vertical-align: inherit;">
43.201 Punkte in jeder Zeile des Diagramms. Es gibt so viele </font><b><font style="vertical-align: inherit;">Punkte,</font></b><font style="vertical-align: inherit;"> dass </font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;"> f√ºr eine lange Zeit eine Antwort bildet, </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> eine Antwort l√§nger ben√∂tigt und der Browser dann f√ºr eine lange Zeit eine so gro√üe Anzahl von Punkten zieht.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/vn/sl/q_/vnslq_lq48mzzh9hgmjwiuvcy2i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/_2/mw/4k/_2mw4ki9rcnf140m2doyqsn-zxy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nicht in jeder Sekunde gibt es Punkte: Metriken wurden alle 2 Sekunden gesammelt und nach jeder Sekunde gruppiert, was bedeutet, dass jeder zweite Punkt null ist. Konfigurieren Sie die Verbindung nicht leerer Werte, um eine glatte Linie anzuzeigen. Andernfalls werden die Grafiken nicht </font><b><font style="vertical-align: inherit;">angezeigt</font></b><font style="vertical-align: inherit;"> : </font><font style="vertical-align: inherit;">
Bisher war </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> so, dass der Browser beim Zeichnen einer gro√üen Anzahl von Punkten h√§ngen blieb. Jetzt kann die Version von </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> mehrere Zehntausend Punkte zeichnen: Der Browser √ºberspringt einfach einige davon und zeichnet anhand der ausged√ºnnten Daten ein Diagramm. Das Diagramm wird jedoch gegl√§ttet. Hochs werden als Durchschnittshochs angezeigt.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/xx/ya/hf/xxyahfkl3xzk6ezsakvgsbi8lp4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis gibt es ein Diagramm, das genau angezeigt wird, die Metriken um 20:00 Uhr werden korrekt berechnet, die Metriken in der Diagrammlegende werden korrekt berechnet. </font><font style="vertical-align: inherit;">Das Diagramm wird jedoch gegl√§ttet: Bursts sind mit einer Genauigkeit von 1 Sekunde nicht sichtbar. </font><font style="vertical-align: inherit;">Insbesondere der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anstieg </font><font style="vertical-align: inherit;">um 17:03 Uhr verschwand aus dem Diagramm, das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diagramm ist </font><font style="vertical-align: inherit;">sehr glatt: Das </font><font style="vertical-align: inherit;">
Minus in der Leistung wird sich √ºber ein l√§ngeres Zeitintervall deutlich manifestieren. </font><font style="vertical-align: inherit;">Wenn Sie versuchen, ein Diagramm in einem Monat (720 Stunden) und nicht in 12 Stunden zu erstellen, friert alles mit einer so geringen Granularit√§t (1 Sekunde) ein, dass zu viele Punkte vorhanden sind. </font><font style="vertical-align: inherit;">Und es gibt ein Minus in Abwesenheit von Peaks, ein Paradoxon - </font><b><font style="vertical-align: inherit;">aufgrund der hohen Genauigkeit beim Erhalten von Metriken erhalten wir eine geringe Genauigkeit ihrer Anzeige</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/1g/vs/m8/1gvsm8owfg-ifjjcqwf-w1q2lbk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Grafana-Weg. </font><font style="vertical-align: inherit;">Wir verwenden einen Stapel von Werten</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und dem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abfrage- </font><b><font style="vertical-align: inherit;">Designer konnte</font></b><font style="vertical-align: inherit;"> keine </font><font style="vertical-align: inherit;">einfache und produktive L√∂sung </font><b><font style="vertical-align: inherit;">erstellt</font></b><font style="vertical-align: inherit;"> werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wir werden nur versuchen, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tools </font><b><font style="vertical-align: inherit;">zu verwenden</font></b><font style="vertical-align: inherit;"> , um die im Originaldiagramm </font><b><font style="vertical-align: inherit;">angezeigten</font></b><font style="vertical-align: inherit;"> Metriken zusammenzufassen. </font><font style="vertical-align: inherit;">Und ja, das ist m√∂glich!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1. </font><font style="vertical-align: inherit;">Machen Sie einfach den Hover-Tooltip / Stacked-Wert: kumulativ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Anforderung zur Auswahl von Metriken unver√§ndert lassen, wie im Abschnitt ‚ÄûWie alles begann‚Äú: </font><font style="vertical-align: inherit;">
Metriken werden nach </font><b><font style="vertical-align: inherit;">Typ</font></b><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">Name</font></b><font style="vertical-align: inherit;"> gruppiert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Das </font><b><font style="vertical-align: inherit;">Type-</font></b><font style="vertical-align: inherit;"> Tag wird jedoch nur in den Namen der Diagramme angezeigt </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
In den Visualisierungseinstellungen werden die Metriken nach </font><b><font style="vertical-align: inherit;">Grafana-</font></b><font style="vertical-align: inherit;"> Stapeln </font><b><font style="vertical-align: inherit;">gruppiert</font></b><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">F√ºgen</font></b><font style="vertical-align: inherit;"> 
Sie zun√§chst die Trennung zweier Tags in zwei verschiedene Stapel A und B hinzu, damit sich ihre Werte nicht √ºberschneiden:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/s5/an/3e/s5an3errkt29lgc8byme6tnowz4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ls/vg/to/lsvgtohynssezzeiy04px0qwq3c.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/no/py/5g/nopy5ggb9ittxbz2phdei1egphg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Serie √ºberschreiben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : A</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Serie √ºberschreiben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / NON_HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : B</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurieren Sie anschlie√üend die Visualisierung von Metriken so, dass die Gesamtwerte in einem Tooltip mit Diagrammen angezeigt werden:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stacking &amp; Nullwert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : On</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hover-Tooltip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestapelter Wert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : kumulativ</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hover-Tooltip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modus</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Single</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund der verschiedenen Funktionen von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana m√ºssen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie Aktionen in dieser Reihenfolge ausf√ºhren. </font><font style="vertical-align: inherit;">Wenn Sie die Reihenfolge der Aktionen √§ndern oder einige Felder mit Standardeinstellungen belassen, funktioniert etwas nicht:</font></font><br>
<br>
<ul>
<li>    Stack <b>A</b>  <b>B</b>    <b>Stacking &amp; Null value</b> / <b>Stack</b>: On,    ;</li>
<li>  <b>Hover tooltip / Mode</b>    ,    <b>Single</b>,  <b>Hover tooltip</b>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt sehen wir viele Linien, solche f√ºr uns. </font><font style="vertical-align: inherit;">Aber! </font><font style="vertical-align: inherit;">Wenn Sie den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mauszeiger</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºber den obersten </font><b><font style="vertical-align: inherit;">NON_HEAP bewegen</font></b><font style="vertical-align: inherit;"> , wird </font><font style="vertical-align: inherit;">in der </font><b><font style="vertical-align: inherit;">QuickInfo</font></b><font style="vertical-align: inherit;"> die Summe der Werte aller </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAPs angezeigt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Der Betrag gilt als wahr, die </font><font style="vertical-align: inherit;">bereits von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mitteln </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Und wenn Sie schweben √ºber den obersten Plan mit dem Namen </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> , werden wir den Betrag , </font><font style="vertical-align: inherit;">um sehen </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Das Diagramm wird korrekt angezeigt. </font><font style="vertical-align: inherit;">Sogar der </font><b><font style="vertical-align: inherit;">HEAP-</font></b><font style="vertical-align: inherit;"> Anstieg </font><font style="vertical-align: inherit;">um 17:03 Uhr ist sichtbar: </font><font style="vertical-align: inherit;">
Formal ist die Aufgabe erledigt. </font><font style="vertical-align: inherit;">
Aber es gibt Nachteile - viele zus√§tzliche Diagramme werden angezeigt. </font><font style="vertical-align: inherit;">Sie m√ºssen den Cursor ganz nach oben bewegen. </font><font style="vertical-align: inherit;">Und in der Legende zum Diagramm werden nicht kumulative, sondern einzelne Werte angezeigt, sodass die Legende unbrauchbar geworden ist.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/p9/tx/tw/p9txtwio9i4uozvliutk5_dg13o.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/g5/78/bo/g578boco1u0sncwf0jmh8ejsyow.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2. </font><font style="vertical-align: inherit;">Gestapelter Wert: kumulativ mit ausgeblendeten Zwischenzeilen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beheben wir das erste Minus der vorherigen L√∂sung: Stellen Sie sicher, dass keine zus√§tzlichen Diagramme angezeigt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daf√ºr:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie den Ergebnissen neue Metriken mit einem anderen Namen und Wert 0 hinzu.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oben im Stapel </font><font style="vertical-align: inherit;">neue Metriken hinzu </font><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus der Anzeige ausblenden - die urspr√ºnglichen Zeilen von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Hauptanforderung f√ºgen wir zwei neue hinzu: Anforderung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Empfangen einer Reihe mit den Werten 0 und Name </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Anforderung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Empfangen einer Reihe mit den Werten 0 und Name </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Um 0 zu erhalten, nehmen wir den ersten Wert des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Felds "Usage.committed"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in jeder </font><b><font style="vertical-align: inherit;">Zeitgruppe</font></b><font style="vertical-align: inherit;"> und subtrahieren ihn: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first ("Usage.committed") - first ("Usage.committed")</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - wir erhalten eine stabile 0. Die Namen der Diagramme werden ge√§ndert, ohne an Bedeutung zu verlieren Aufgrund der eckigen Klammern: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> und </font><b><font style="vertical-align: inherit;">HEAP werden</font></b><font style="vertical-align: inherit;"> in </font><b><font style="vertical-align: inherit;">Stapel A</font></b><font style="vertical-align: inherit;"> kombiniert </font><font style="vertical-align: inherit;">und verbergen auch alle </font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/no/kh/0f/nokh0fb2fp1t_ictdthli2etylg.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">kombinieren Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stapel B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verbergen Sie NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><b><font style="vertical-align: inherit;">Ermitteln Sie den</font></b><font style="vertical-align: inherit;"> 
korrekten Betrag mit </font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b><font style="vertical-align: inherit;"> in der QuickInfo, wenn Sie den Mauszeiger √ºber das Diagramm halten: </font><b><font style="vertical-align: inherit;">Ermitteln</font></b><font style="vertical-align: inherit;"> 
Sie den korrekten Betrag mit </font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;"> in der QuickInfo, wenn Sie mit der Maus √ºber das Diagramm fahren. </font><font style="vertical-align: inherit;">Und sogar alle Bursts sind sichtbar: </font><font style="vertical-align: inherit;">
Und der Zeitplan wird schnell erstellt. </font><font style="vertical-align: inherit;">Aber die Legende zeigt immer 0 an, die Legende ist unbrauchbar geworden. </font><font style="vertical-align: inherit;">
Es hat alles geklappt! </font><font style="vertical-align: inherit;">Echter Bypass ist durch die </font><b><font style="vertical-align: inherit;">Grafana-</font></b><font style="vertical-align: inherit;"> Stapel </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Aus diesem Grund wurde der Artikel der Kategorie </font><b><font style="vertical-align: inherit;">Abnormale Programmierung</font></b><font style="vertical-align: inherit;"> hinzugef√ºgt </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/uf/zw/7s/ufzw7sw-oxjflnzkglbilrdgmw4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ga/mh/nz/gamhnzyw1thhnbi5mflkwrlvr_i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/p_/tp/ev/p_tpevfzm7rwkc1534vyhe92ozg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Die Summe der H√∂hen mit der Unterabfrage</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir bereits mit einer Reihe von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Weg der abnormalen Programmierung </font><b><font style="vertical-align: inherit;">eingeschlagen haben</font></b><font style="vertical-align: inherit;"> , fahren wir fort. </font><font style="vertical-align: inherit;">Lassen Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine kleine Anzahl von Punkten zur√ºckgeben und die Legende erscheinen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 Summe der Inkremente der kumulierten Summe der Maxima</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die M√∂glichkeiten von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB untersuchen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Fr√ºher habe ich oft geholfen, indem ich die Ableitung des kumulierten Betrags genommen habe. Deshalb werden wir jetzt versuchen, diesen Ansatz anzuwenden. </font><font style="vertical-align: inherit;">Wechseln wir in den Modus der manuellen Bearbeitung von Anfragen: Stellen </font><font style="vertical-align: inherit;">
wir eine solche Anfrage:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/om/-b/yt/om-bytkvhp5zisny6gw5io_g2ba.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"U"</span>) <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> non_negative_difference(cumulative_sum(<span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>))) <span class="hljs-keyword">AS</span> <span class="hljs-string">"U"</span> 
        <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
        <span class="hljs-keyword">WHERE</span> <font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter <font></font>
        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">"Type"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wird der Maximalwert der Metrik in der Gruppe nach Zeit genommen und die Summe dieser Werte ab dem Zeitpunkt, zu dem die Referenz beginnt, gruppiert nach den Tags </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Infolgedessen wird zu jedem Zeitpunkt eine Summe aller Angaben nach Typ ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) mit Trennung nach </font><b><font style="vertical-align: inherit;">Poolname </font></b><b><font style="vertical-align: inherit;">angezeigt</font></b><font style="vertical-align: inherit;"> , es werden jedoch nicht 30 Werte summiert, wie dies in Version 1.2 der Fall war, sondern nur einer ist das Maximum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn wir die nehmen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zuwachs von </font><font style="vertical-align: inherit;">solchen kumulativen Summe f√ºr den letzten Schritt, dann werden wir den Summenwert aller Datenpools gruppiert nach erhalten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Tags </font><font style="vertical-align: inherit;">zu Beginn des Zeitintervalls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, um den Betrag nur per Tag zu erhalten</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geben Sie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ohne Gruppierung nach </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namensschild</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Anforderung der obersten Ebene mit √§hnlichen Gruppierungsparametern ein, jedoch ohne Gruppierung nach </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis einer solch komplexen Abfrage erhalten wir die Summe aller Typen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perfekter Zeitplan. </font><font style="vertical-align: inherit;">Die Summe der Maxima wird korrekt berechnet. </font><font style="vertical-align: inherit;">Es gibt eine Legende mit den richtigen Werten ungleich Null. </font><font style="vertical-align: inherit;">In der QuickInfo k√∂nnen Sie alle Metriken anzeigen, nicht nur Single. </font><font style="vertical-align: inherit;">Sogar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bursts werden angezeigt </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">
Eine Sache, aber - die Anforderung stellte sich als schwierig heraus: die Summe des Inkrements der kumulierten Summe von Maxima mit einer √Ñnderung der Gruppierungsstufe.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 Summe der H√∂hen mit √Ñnderung der Gruppierungsstufe</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
K√∂nnen Sie etwas einfacher machen als in Version 3.1? Die B√ºchse der Pandora ist bereits ge√∂ffnet. Wir haben in den manuellen Bearbeitungsmodus f√ºr Abfragen gewechselt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es besteht der Verdacht, dass der Erhalt eines Inkrements aus dem kumulierten Betrag zu einem Null-Effekt f√ºhrt - einer l√∂scht den anderen aus. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entfernen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie </font><b><font style="vertical-align: inherit;">non_negative_difference (cumulative_sum (...))</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vereinfachen Sie die Anfrage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir belassen einfach die Summe der Maxima mit einer Abnahme der Gruppierungsstufe:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"A"</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">"A"</span>
    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
    <span class="hljs-keyword">WHERE</span><font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter<font></font>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">WHERE</span> $timeFilter
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist eine schnelle, einfache Abfrage, die in 12 Stunden nur 721 Punkte pro Serie zur√ºckgibt, gruppiert nach Minuten: 12 (Stunden) * 60 (Minuten) = 720 Intervalle, 721 Punkte (zuletzt leer). Bitte beachten Sie, dass der Zeitfilter doppelt vorhanden ist. Es befindet sich in der Unterabfrage und in der Gruppierungsanforderung: </font><font style="vertical-align: inherit;">
Ohne </font><b><font style="vertical-align: inherit;">$ timeFilter</font></b><font style="vertical-align: inherit;"> betr√§gt die Anzahl der zur√ºckgegebenen Punkte in der externen Gruppierungsanforderung in 12 Stunden nicht 721, sondern mehr. Da die Unterabfrage f√ºr das Intervall </font><b><font style="vertical-align: inherit;">von</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">bis</font></b><font style="vertical-align: inherit;"> gruppiert </font><font style="vertical-align: inherit;">ist und die Gruppierung einer externen Anforderung ohne Filter f√ºr das Intervall </font><b><font style="vertical-align: inherit;">von</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">jetzt erfolgt</font></b><font style="vertical-align: inherit;"> . Und wenn in </font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;"> ein Zeitintervall ausgew√§hlt ist, das nicht die letzten X Stunden betr√§gt (nicht so, dass </font><b><font style="vertical-align: inherit;">bis</font></b><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">jetzt</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/8s/ab/tg/8sabtg9rebcu-tonmirjck2jdmk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), aber f√ºr das Intervall von der Vergangenheit ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jetzt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) werden leere Punkte mit einem Nullwert am Ende der Auswahl angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das resultierende Diagramm erwies sich als einfach, schnell und korrekt. </font><font style="vertical-align: inherit;">Mit einer Legende, die zusammenfassende Metriken anzeigt. </font><font style="vertical-align: inherit;">Mit Tooltip f√ºr mehrere Zeilen gleichzeitig. </font><font style="vertical-align: inherit;">Und auch mit der Anzeige aller Wertest√∂√üe: </font><font style="vertical-align: inherit;">
Das Ergebnis ist erreicht!</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referenzen (anstelle von Referenzen)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verteilungen der im Artikel verwendeten Tools:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grafana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (6.5.0)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">influxdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.7.9)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.13.3)</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jolokia-jvm-1.6.2-agent.jar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (1.6.2)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dokumentation zu den Funktionen der im Artikel verwendeten Tools:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wesen</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschreibung</font></font></th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufbewahrungsrichtlinien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB Vorratsdatenspeicherung</font></font></a></td>
<td>Retention policy <b>montn</b>   30  ,     JVM    .       <b>auto</b>,     .   ¬´  ¬ª   <b>telegraf.conf</b>      <b>InfluxDB</b>  ,      <b>Grafana</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">InfluxDB v1.x Output Plugin</a></td>
<td>    <b>Telegraf</b>  <b>InfluxDB</b>.     <b>telegraf.conf</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">agent / interval</a></td>
<td>   ,     2 .   ¬´  ¬ª   <b>telegraf.conf</b>.   ¬´1.2.       ¬ª  ¬´1.3.       ¬ª</td>
</tr>
<tr>
<td>Java 8 / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Interface MemoryPoolMXBean</a></td>
<td>  MemoryPool,  ,     bool,  long.     <b>telegraf.conf</b>    int</td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jolokia2 Input Plugins</a></td>
<td>  <b>telegraf.conf</b>   MBean-,     <b>InfluxDB</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Converter Processor</a></td>
<td>  <b>telegraf.conf</b>,      <b>float</b>   <b>int</b>    <b>InfluxDB</b>.      <b>Type</b>   <b>Type</b>,        </td>
</tr>
<tr>
<td>Grafana / Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Advanced Formatting Options / Regex</a></td>
<td> Grafana,    Multiselect    ,    ,     ,    <b><code>~ /^<u>${}</u>$/</code></b> ‚Äî ,  <b><code>~ /^${<u>:regex</u>}$/</code></b></td>
</tr>
<tr>
<td>Grafana / Variables / Global Built-in Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The $timeFilter or $__timeFilter Variable</a></td>
<td> Grafana- <b>$timeFilter</b>,     </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MAX()</a></td>
<td>  <b>MAX()</b>  <b>InfluxDB</b> 1.7,       </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SUM()</a></td>
<td>    <b>SUM()</b>  <b>InfluxDB</b> 1.7</td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Subqueries</a></td>
<td>    <b>InfluxDB</b> 1.7,     3 </td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CUMULATIVE_SUM()</a></td>
<td>  <b>CUMULATIVE_SUM()</b>,        <b>InfluxDB</b>,    <b>NON_NEGATIVE_DERIVATIVE()</b></td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NON_NEGATIVE_DERIVATIVE()</a></td>
<td>  <b>NON_NEGATIVE_DERIVATIVE()</b>,     3 .     <b>CUMULATIVE_SUM()</b> ‚Äî          3</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Using Grafana‚Äôs Query Inspector to troubleshoot issues</a></td>
<td> <b>Query Inspector</b>,         ,        Grafana-</td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Draw Options</a></td>
<td>  Stack, Tooltip,‚Ä¶              ¬´2. Grafana-way.   ¬ª </td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Series overrides</a></td>
<td>       (     )  <b>Grafana</b></td>
</tr>
</tbody></table></div><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kombination von Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sollte den Leistungstestingenieuren bekannt sein. Und in diesem Bundle sind viele einfache Aufgaben sehr interessant und k√∂nnen mit normalen Programmiermethoden nicht immer gel√∂st werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal sind bei den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktionen </font><font style="vertical-align: inherit;">und Feinheiten der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abfragesprache </font><font style="vertical-align: inherit;">abnormale Programmierkenntnisse erforderlich </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dem Artikel wurden vier Optionen zum Implementieren der Summierung einer Metrik ber√ºcksichtigt, die nach einem Tag gruppiert ist, jedoch mehrere Tags enth√§lt. Die Aufgabe war interessant. Und es gibt viele solche Aufgaben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bereite einen Bericht √ºber die Feinheiten der Programmierung mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB vor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ich werde regelm√§√üig Materialien zu diesem Thema ver√∂ffentlichen. </font><font style="vertical-align: inherit;">In der Zwischenzeit freue ich mich √ºber Ihre Fragen zum aktuellen Artikel.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490754/index.html">Visual Studio Code Code Editor. Die ausf√ºhrlichste Anleitung zum Einrichten und Installieren von Plugins f√ºr Anf√§nger</a></li>
<li><a href="../de490756/index.html">Stellen Sie Jenkins als Code bereit</a></li>
<li><a href="../de490758/index.html">Mathematiker haben das universelle Gesetz der Turbulenzen bewiesen</a></li>
<li><a href="../de490760/index.html">Ray Casting Visuelle Suche (RCVS). Einfacher und schneller Algorithmus zum Auffinden von 3D-Modellen mit √§hnlicher Geometrie</a></li>
<li><a href="../de490762/index.html">Wie prognostiziere ich den Flugpreis?</a></li>
<li><a href="../de490766/index.html">Wie verstehe ich einen Anf√§nger, welche Sprache f√ºr den gew√ºnschten Beruf zu w√§hlen?</a></li>
<li><a href="../de490768/index.html">Wenn Computerspiele Ihre Aufgabe sind: das interne Ger√§t f√ºr Cloud-Spiele</a></li>
<li><a href="../de490770/index.html">Nieder mit der technischen Verschuldung! Auf der TechLead Conf 2020 zeigen wir Ihnen, wie</a></li>
<li><a href="../de490772/index.html">So schreiben und ver√∂ffentlichen Sie einen intelligenten Vertrag im Telegram Open Network (TON)</a></li>
<li><a href="../de490774/index.html">Reaktionsschnell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>