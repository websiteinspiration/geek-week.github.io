<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙅🏻 🧛🏾 👍🏾 クォーラムブロックチェーン：Javaコードへの統合 👩🏽 😦 😓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 

Ethereum、Bitcoin、Zcashなどのパブリックブロックチェーンに加えて、パブリックネットワークよりもいくつかの点で「エンタープライズ（プライベート）」「兄弟」も存在することは、ブロックチェーンのトピックに興味がある人にとって秘密ではありません。しかし、何かで...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>クォーラムブロックチェーン：Javaコードへの統合</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462549/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font></p><br>
<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ethereum</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitcoin</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zcash</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのパブリックブロックチェーンに加えて</font><font style="vertical-align: inherit;">、パブリックネットワークよりもいくつかの点で「エンタープライズ（プライベート）」「兄弟」も存在することは</font><font style="vertical-align: inherit;">、ブロックチェーンのトピックに興味がある人にとって秘密ではありません</font><font style="vertical-align: inherit;">。しかし、何かで彼らは彼らに負けます。最も有名なネットワークの中で、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quorum</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ベンダー</font><strong><font style="vertical-align: inherit;">-JP </font></strong></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morgan Chase</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pantheon</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ベンダー</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-PegaSys</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hyperledger</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><strong><font style="vertical-align: inherit;">The Linux Foundation</font></strong><font style="vertical-align: inherit;">が管理</font><font style="vertical-align: inherit;">）</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">非常に多くの公的決定があるにもかかわらず、企業は必要なレベルのプライバシーを提供でき、トランザクションが高速になるなど、プライベートブロックチェーンへの関心が高まっています。</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プライベートブロックチェーンとパブリックブロックチェーンの違い、およびそれらの長所と短所は、この記事のトピックではありません。</font><font style="vertical-align: inherit;">あなたがそれについて読むことに興味があるなら、それは例えば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mediumの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような記事</font><font style="vertical-align: inherit;">です。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quorum</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックチェーンを</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">して、プライベートおよびパブリックトランザクションをサポートするアプリケーションを開発する</font><font style="vertical-align: inherit;">方法について説明します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">機能を示すために、</font><font style="vertical-align: inherit;">スマートコントラクトのデプロイ（デプロイ）、トランザクションの実行、スマートコントラクトからのデータの読み取りのリクエストを受け入れる</font><font style="vertical-align: inherit;">小さな</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java / Spring</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションを作成します。</font><font style="vertical-align: inherit;">実際、記事で使用するテクノロジースタックは次のとおりです。</font></font></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java 8</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle 5.2.1</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Springフレームワーク</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web3j</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Ethereumのようなネットワークでパブリックトランザクションを操作するためのライブラリ）</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web3j-quorum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Quorumネットワークでプライベートトランザクションを操作するためのライブラリ）</font></font></li>
</ul><br>
<h1 id="nemnogo-obschey-informacii-o-quorum"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定足数に関する一般的な情報</font></font></h1><br>
<p><em>Quorum</em> —       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">GitHub</a>,                    .     <em>Quorum</em>   <em>Ethereum</em>,        <em>Geth</em>-      .</p><br>
<p>    <em>enclave</em> ,    ,       .   2  <em>enclave</em> :</p><br>
<ol>
<li><strong>Constellation</strong> —   Haskell,   <em>enclave</em>,     ,           ;</li>
<li><strong>Tessera</strong> —  ,   <em>Java</em>,    J.P. Morgan Chase,          ""  (,     <em>HashiCorp Vault</em>   ).</li>
</ol><br>
<p>  ,       <em>Ethereum</em>    (  ).       ,     ,     <strong> privateFor</strong> —   ,    —   <em>enclave</em> .      <em>payload</em>     <em>payoad</em>'a  <strong>Tessera</strong>-  .</p><br>
<p>     <em>Quorum</em>,     ,            (  ,             ).</p><br>
<h1 id="razrabotka-java-prilozheniya"> Java </h1><br>
<p> ,    RESTful API,   <em>Java/Spring</em>,  <em>Gradle</em>       ,    -  ,          -.</p><br>
<p> ,    ,     .   ,   <em>Quorum</em>   2  ,      3 :</p><br>
<ol>
<li><em>Public</em>  —       (    <em>payload</em>), <em>enclave</em>-      ,    .    <em>Quorum</em>      <em>Ethereum</em> ;</li>
<li><em>Permissioned</em>  —     ,     ,               ,    <em>payload</em>       64- -,      <em>payload</em>  <em>enclave</em> ,  <em>enclave</em>    , ,    <em>payload</em>'a    ;</li>
<li><em>Private</em>  —   <em>permissioned</em>       ,    ,       <em>payload</em> .<br>
        .</li>
</ol><br>
<p>   ,      — <code>gradle.build</code>:</p><br>
<pre><code class="plaintext hljs">plugins {<font></font>
    id 'org.springframework.boot' version '2.1.6.RELEASE'<font></font>
    id 'java'<font></font>
}<font></font>
<font></font>
apply plugin: 'io.spring.dependency-management'<font></font>
<font></font>
group = 'com.github'<font></font>
version = '1.0'<font></font>
sourceCompatibility = '1.8'<font></font>
<font></font>
configurations {<font></font>
    compileOnly {<font></font>
        extendsFrom annotationProcessor<font></font>
    }<font></font>
}<font></font>
<font></font>
repositories {<font></font>
    mavenCentral()<font></font>
}<font></font>
<font></font>
test {<font></font>
    testLogging.showStandardStreams = true<font></font>
}<font></font>
<font></font>
dependencies {<font></font>
    implementation 'org.springframework.boot:spring-boot-starter-webflux'<font></font>
<font></font>
    implementation group: 'org.web3j', name: 'quorum', version: '4.0.6'<font></font>
    implementation group: 'org.web3j', name: 'core', version: '4.1.0'<font></font>
    implementation group: 'org.web3j', name: 'codegen', version: '4.1.0'<font></font>
<font></font>
    compileOnly 'org.projectlombok:lombok'<font></font>
    annotationProcessor 'org.projectlombok:lombok'<font></font>
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'<font></font>
<font></font>
    testImplementation 'org.springframework.boot:spring-boot-starter-test'<font></font>
    testImplementation 'io.projectreactor:reactor-test'<font></font>
}<font></font>
<font></font>
task generateWrappers(type: JavaExec) {<font></font>
    group 'Demo'<font></font>
    description 'Generates wrappers for smart-contracts'<font></font>
<font></font>
    classpath = sourceSets.main.runtimeClasspath<font></font>
    main = 'com.github.quorum.utils.WrappersGenerator'<font></font>
}</code></pre><br>
<p> :</p><br>
<ol>
<li><code>org.web3j.core</code> —        <em>Ethereum</em>      <em>Quorum</em></li>
<li><code>org.web3j.quorum</code> —         <em>Quorum</em></li>
<li><code>org.web3j.codegen</code> —    <em>wrapper</em>'  <em>Solidity</em> -</li>
<li><em>generateWrappers</em> — Gradle-task   <em>Java-wrapper</em>'  <em>Solidity</em>  </li>
</ol><br>
<p>     -,      :  <code>QuorumDemo.sol</code>:</p><br>
<pre><code class="plaintext hljs">pragma solidity 0.5.0;<font></font>
<font></font>
/**<font></font>
 * @dev Smart-Contract for demonstration purposes.<font></font>
 */<font></font>
contract QuorumDemo {<font></font>
<font></font>
    string public user;<font></font>
<font></font>
    /**<font></font>
     * @dev Rewrite user name in storage.<font></font>
     */<font></font>
    function writeUser(string calldata _user) public {<font></font>
        user = _user;<font></font>
    }<font></font>
}</code></pre><br>
<p>   ,       .    <em>Solidity</em>,     :</p><br>
<ul>
<li><code>string public user</code> —    <em>string</em>   <em>user</em>.    <em>Java</em>, <em>Solidity</em>   <em>getter</em>   ,      .</li>
<li><code>function writeUser(...)</code> —    ,   — <em>setter</em>.</li>
</ul><br>
<p> ,    -  <code>Java-wrapper</code>,      <code>src/main/solidity/contracts</code>   ,  <code>QuorumDemo.sol</code>.<br>
   Gradle-task <em>generateWrappers</em> :</p><br>
<pre><code class="plaintext hljs">gradle generateWrappers</code></pre><br>
<p>      <code>src/main/java/com/github/quorum/component/wrappers</code>   <em>Java-wrapper</em>,       <em>Java</em> .</p><br>
<p> ,      ,      <em>payload</em>   ,    .          <em>Java-wrapper</em> .    2   .     <em>ABI</em> ,       -.   —       -.    :</p><br>
<pre><code class="plaintext hljs">public static String getBinary() {<font></font>
    return BINARY;<font></font>
}<font></font>
<font></font>
public static String getDataOnWriteUser(final String user) {<font></font>
    final Function function = new Function(<font></font>
            FUNC_WRITEUSER,<font></font>
            Arrays.asList(new Utf8String(user)),<font></font>
            Collections.emptyList()<font></font>
    );<font></font>
    return FunctionEncoder.encode(function);<font></font>
}</code></pre><br>
<p>    <em>Java-wrapper</em>,    <em>payload</em>  .</p><br>
<p>,        ,         .        2  : </p><br>
<ol>
<li><code>TesseraTransactionManager</code>,    </li>
<li><code>GethTransactionManager</code>,    </li>
</ol><br>
<p>  .  <code>TesseraTransactionManager</code>:</p><br>
<pre><code class="plaintext hljs">@Slf4j<font></font>
public class TesseraTransactionManager implements TransactionManager {<font></font>
<font></font>
    private static final byte ATTEMPTS = 20;<font></font>
    private static final int SLEEP_DURATION = 100;<font></font>
<font></font>
    private final Quorum quorum;<font></font>
    private final String fromAddress;<font></font>
    private final QuorumTransactionManager quorumTxManager;<font></font>
    private final TransactionReceiptProcessor txReceiptProcessor;<font></font>
<font></font>
    public TesseraTransactionManager(<font></font>
            Quorum quorum,<font></font>
            Credentials credentials,<font></font>
            String publicKey,<font></font>
            List&lt;String&gt; privateFor,<font></font>
            Tessera tessera<font></font>
    ) {<font></font>
        this.quorum = quorum;<font></font>
        this.fromAddress = credentials.getAddress();<font></font>
        this.quorumTxManager = new QuorumTransactionManager(quorum, credentials, publicKey, privateFor, tessera);<font></font>
        this.txReceiptProcessor = new PollingTransactionReceiptProcessor(quorum, SLEEP_DURATION, ATTEMPTS);<font></font>
    }<font></font>
<font></font>
    @Override<font></font>
    public TransactionReceipt executeTransaction(<font></font>
            final BigInteger gasPrice, final BigInteger gasLimit, final String to, final String data) {<font></font>
<font></font>
        while (true) {<font></font>
            try {<font></font>
                final EthSendTransaction ethSendTx = sendTransaction(gasPrice, gasLimit, to, data);<font></font>
<font></font>
                if (ethSendTx.hasError() &amp;&amp; NONCE_TOO_LOW_ERROR_MESSAGE.equals(ethSendTx.getError().getMessage())) {<font></font>
                    log.warn("[BLOCKCHAIN] try to re-send transaction cause error {}", ethSendTx.getError().getMessage());<font></font>
                    continue;<font></font>
                }<font></font>
                return processResponse(ethSendTx);<font></font>
<font></font>
            } catch (TransactionException ex) {<font></font>
                log.error("[BLOCKCHAIN] exception while receiving TransactionReceipt from Quorum node", ex);<font></font>
                throw new RuntimeException(ex);<font></font>
            } catch (Exception ex) {<font></font>
                log.error("[BLOCKCHAIN] exception while sending transaction to Quorum node", ex);<font></font>
                throw new RuntimeException(ex);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    private EthSendTransaction sendTransaction(<font></font>
            final BigInteger gasPrice, final BigInteger gasLimit, final String to, final String data) throws IOException {<font></font>
<font></font>
        final BigInteger nonce = getNonce();<font></font>
        final RawTransaction rawTransaction = RawTransaction.createTransaction(nonce, gasPrice, gasLimit, to, data);<font></font>
<font></font>
        return this.quorumTxManager.signAndSend(rawTransaction);<font></font>
    }<font></font>
<font></font>
    private TransactionReceipt processResponse(final EthSendTransaction transactionResponse)<font></font>
            throws IOException, TransactionException {<font></font>
        if (transactionResponse.hasError()) {<font></font>
            throw new RuntimeException(<font></font>
                    "[BLOCKCHAIN] error processing transaction request: "<font></font>
                    + transactionResponse.getError().getMessage()<font></font>
            );<font></font>
        }<font></font>
<font></font>
        final String transactionHash = transactionResponse.getTransactionHash();<font></font>
<font></font>
        return this.txReceiptProcessor.waitForTransactionReceipt(transactionHash);<font></font>
    }<font></font>
<font></font>
    private BigInteger getNonce() throws IOException {<font></font>
        final EthGetTransactionCount ethGetTxCount = this.quorum.ethGetTransactionCount(<font></font>
                this.fromAddress, DefaultBlockParameterName.PENDING).send();<font></font>
        return ethGetTxCount.getTransactionCount();<font></font>
    }<font></font>
}</code></pre><br>
<ul>
<li><code>TransactionReceipt executeTransaction(...)</code> —  ,         ,   .   c   ;</li>
<li><code>EthSendTransaction sendTransaction(...)</code> —        .        ;</li>
<li><code>TransactionReceipt processResponse(...)</code> — ,       <code>TransactionReceipt</code>   ;</li>
<li><code>BigInteger getNonce()</code> —  "nonce"  .</li>
</ul><br>
<p>  <code>GethTransactionManager</code>:</p><br>
<pre><code class="plaintext hljs">@Slf4j<font></font>
public class GethTransactionManager extends FastRawTransactionManager implements TransactionManager {<font></font>
<font></font>
    private static final byte ATTEMPTS = 20;<font></font>
    private static final int SLEEP_DURATION = 100;<font></font>
<font></font>
    private final TransactionReceiptProcessor txReceiptProcessor;<font></font>
<font></font>
    public GethTransactionManager(Web3j web3j, Credentials credentials) {<font></font>
        this(web3j, credentials, new PollingTransactionReceiptProcessor(web3j, SLEEP_DURATION, ATTEMPTS));<font></font>
    }<font></font>
<font></font>
    public GethTransactionManager(Web3j web3j, Credentials credentials, TransactionReceiptProcessor txReceiptProcessor) {<font></font>
        super(web3j, credentials, txReceiptProcessor);<font></font>
        this.txReceiptProcessor = txReceiptProcessor;<font></font>
    }<font></font>
<font></font>
    @Override<font></font>
    public TransactionReceipt executeTransaction(<font></font>
            final BigInteger gasPrice, final BigInteger gasLimit, final String to, final String data) {<font></font>
<font></font>
        while (true) {<font></font>
            try {<font></font>
                final EthSendTransaction ethSendTx = sendTransaction(gasPrice, gasLimit, to, data, BigInteger.ZERO);<font></font>
<font></font>
                if (ethSendTx != null &amp;&amp; ethSendTx.hasError() &amp;&amp; NONCE_TOO_LOW_ERROR_MESSAGE.equals(ethSendTx.getError().getMessage())) {<font></font>
                    log.warn("[BLOCKCHAIN] try to re-send transaction cause error: {}", ethSendTx.getError().getMessage());<font></font>
                    continue;<font></font>
                }<font></font>
<font></font>
                return this.txReceiptProcessor.waitForTransactionReceipt(ethSendTx.getTransactionHash());<font></font>
<font></font>
            } catch (TransactionException ex) {<font></font>
                log.error("[BLOCKCHAIN] exception while receiving TransactionReceipt from Quorum node", ex);<font></font>
                throw new RuntimeException(ex);<font></font>
<font></font>
            } catch (IOException ex) {<font></font>
                log.error("[BLOCKCHAIN] exception while sending transaction to Quorum node", ex);<font></font>
                throw new RuntimeException(ex);<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    @Override<font></font>
    public EthSendTransaction sendTransaction(<font></font>
            final BigInteger gasPrice,<font></font>
            final BigInteger gasLimit,<font></font>
            final String to,<font></font>
            final String data,<font></font>
            final BigInteger value<font></font>
    ) throws IOException {<font></font>
        return super.sendTransaction(gasPrice, gasLimit.add(BigInteger.valueOf(21_000L)), to, data, value);<font></font>
    }<font></font>
}</code></pre><br>
<ul>
<li><code>TransactionReceipt executeTransaction(...)</code> —  ,         ,   .   c   ;</li>
<li><code>EthSendTransaction sendTransaction(...)</code> — ,    -     .</li>
</ul><br>
<p> ,    <em>API</em>:</p><br>
<pre><code class="plaintext hljs">@Slf4j<font></font>
@Component<font></font>
public class RequestHandler {<font></font>
<font></font>
    private final Web3j web3j;<font></font>
<font></font>
    private final Quorum quorum;<font></font>
<font></font>
    private final Tessera tessera;<font></font>
<font></font>
    private final Credentials credentials;<font></font>
<font></font>
    private final BlockchainConfig blockchainConfig;<font></font>
<font></font>
    private String deployedContract;<font></font>
<font></font>
    @Autowired<font></font>
    public RequestHandler(<font></font>
            @Qualifier("initWeb3j") Web3j web3j,<font></font>
            Quorum quorum,<font></font>
            Tessera tessera,<font></font>
            Credentials credentials,<font></font>
            BlockchainConfig blockchainConfig<font></font>
    ) {<font></font>
        this.web3j = web3j;<font></font>
        this.quorum = quorum;<font></font>
        this.tessera = tessera;<font></font>
        this.credentials = credentials;<font></font>
        this.blockchainConfig = blockchainConfig;<font></font>
    }<font></font>
<font></font>
    /**<font></font>
     * Deploy new smart-contract.<font></font>
     *<font></font>
     * @param serverRequest<font></font>
     *          - {@link ServerRequest} object with request information<font></font>
     * @return {@link ServerResponse} object with response data<font></font>
     */<font></font>
    public Mono&lt;ServerResponse&gt; deployContract(final ServerRequest serverRequest) {<font></font>
        return serverRequest<font></font>
                .bodyToMono(APIRequest.class)<font></font>
                .map(this::getTransactionManager)<font></font>
                .map(this::deployContract)<font></font>
                .flatMap(this::generateResponse);<font></font>
    }<font></font>
<font></font>
    private TransactionManager getTransactionManager(final APIRequest apiRequest) {<font></font>
        log.info("[HANDLER] privateFor = {}", apiRequest.getPrivateFor());<font></font>
        TransactionManager txManager;<font></font>
        if (isPrivate(apiRequest.getPrivateFor())) {<font></font>
            if (apiRequest.getPrivateFor().size() == 0) {<font></font>
                apiRequest.getPrivateFor().add(this.blockchainConfig.getTesseraPublicKey());<font></font>
            }<font></font>
            txManager = new TesseraTransactionManager(this.quorum, this.credentials, this.blockchainConfig.getTesseraPublicKey(), apiRequest.getPrivateFor(), this.tessera);<font></font>
        } else {<font></font>
            txManager = new GethTransactionManager(this.web3j, this.credentials);<font></font>
        }<font></font>
<font></font>
        return txManager;<font></font>
    }<font></font>
<font></font>
    private boolean isPrivate(final List&lt;String&gt; limitedTo) {<font></font>
        return limitedTo == null || limitedTo.size() == 0 || !limitedTo.get(0).equals("public");<font></font>
    }<font></font>
<font></font>
    private APIResponse deployContract(final TransactionManager txManager) {<font></font>
        log.info("[HANDLER] deploying new smart-contract");<font></font>
        final String data = QuorumDemo.getBinary();<font></font>
        final TransactionReceipt txReceipt = txManager.executeTransaction(GAS_PRICE, DEPLOY_GAS_LIMIT, null, data);<font></font>
        final APIResponse apiResponse = APIResponse.newInstance(txReceipt);<font></font>
        this.deployedContract = txReceipt.getContractAddress();<font></font>
        log.info("[HANDLER] contract has been successfully deployed. Result: {}", apiResponse.getMap());<font></font>
<font></font>
        return apiResponse;<font></font>
    }<font></font>
<font></font>
    private Mono&lt;ServerResponse&gt; generateResponse(final APIResponse apiResponse) {<font></font>
        return ServerResponse<font></font>
                .ok()<font></font>
                .body(Mono.just(apiResponse.getMap()), Map.class);<font></font>
    }<font></font>
<font></font>
    /**<font></font>
     * Send transaction on update user in smart-contract.<font></font>
     *<font></font>
     * @param serverRequest<font></font>
     *          - {@link ServerRequest} object with request information<font></font>
     * @return {@link ServerResponse} object with response data<font></font>
     */<font></font>
    public Mono&lt;ServerResponse&gt; updateUser(final ServerRequest serverRequest) {<font></font>
        return serverRequest<font></font>
                .bodyToMono(APIRequest.class)<font></font>
                .map(this::sendTransaction)<font></font>
                .flatMap(this::generateResponse);<font></font>
    }<font></font>
<font></font>
    private APIResponse sendTransaction(final APIRequest apiRequest) {<font></font>
        final TransactionManager txManager = getTransactionManager(apiRequest);<font></font>
        log.info("[HANDLER] sending new transaction");<font></font>
        final String data = QuorumDemo.getDataOnWriteUser(apiRequest.getUser());<font></font>
        final TransactionReceipt txReceipt = txManager.executeTransaction(GAS_PRICE, TX_GAS_LIMIT, this.deployedContract, data);<font></font>
        final APIResponse apiResponse = APIResponse.newInstance(txReceipt);<font></font>
        log.info("[HANDLER] transaction has been successfully executed. Result: {}", apiResponse.getMap());<font></font>
<font></font>
        return apiResponse;<font></font>
    }<font></font>
<font></font>
    /**<font></font>
     * Read user from smart-contract.<font></font>
     *<font></font>
     * @param serverRequest<font></font>
     *          - {@link ServerRequest} object with request information<font></font>
     * @return {@link ServerResponse} object with response data<font></font>
     */<font></font>
    public Mono&lt;ServerResponse&gt; getUser(final ServerRequest serverRequest) {<font></font>
        final APIResponse apiResponse = getUser();<font></font>
        return generateResponse(apiResponse);<font></font>
    }<font></font>
<font></font>
    private APIResponse getUser() {<font></font>
        log.info("[HANDLER] reading user from smart-contract");<font></font>
        final QuorumDemo quorumDemo = QuorumDemo.load(this.deployedContract, this.web3j, this.credentials, new StaticGasProvider(GAS_PRICE, DEPLOY_GAS_LIMIT));<font></font>
        final String user = readUserFromSmartContract(quorumDemo);<font></font>
        final APIResponse apiResponse = APIResponse.newInstance(user);<font></font>
        log.info("[HANDLER] user: '{}'", user);<font></font>
<font></font>
        return apiResponse;<font></font>
    }<font></font>
<font></font>
    private String readUserFromSmartContract(final QuorumDemo quorumDemo) {<font></font>
        try {<font></font>
            return quorumDemo.user().send().getValue();<font></font>
        } catch (Exception ex) {<font></font>
            log.info("[HANDLER] exception while reading user from smart-contract: {}", ex);<font></font>
            return null;<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>      .<br>
 <code>Mono&lt;ServerResponse&gt; deployContract(...)</code> —     (deploy) -,     .<br>
 <code>TransactionManager getTransactionManager(...)</code> —          .         <strong>privateFor</strong>,       <em>Tessera</em> .<br>
 <code>boolean isPrivate(...)</code> —  "true",   <strong>privateFor</strong>   (<em>private</em> ),      (<em>permissioned</em> ).  "false",   <strong>privateFor</strong>  ,      "public".<br>
 <code>APIResponse deployContract(...)</code> —   (deploy)  .<br>
 <code>Mono&lt;ServerResponse&gt; generateResponse(...)</code> —      .<br>
 <code>Mono&lt;ServerResponse&gt; updateUser(...)</code> —         -.<br>
 <code>APIResponse sendTransaction(...)</code> —       .<br>
 <code>APIResponse getUser()</code> —       -    .<br>
 <code>String readUserFromSmartContract(...)</code> —    -   .</p><br>
<p>     <em>GitHub</em> ,       .</p><br>
<h1 id="proverka"></h1><br>
<p>   3       (   <em>GitHub</em> ).       3 <em>Quorum</em>  (3  <em>Geth</em> + 3  <em>Tessera</em>). 3 <em>Quorum</em>          .   ,    .</p><br>
<h2 id="public-tranzakcii">Public </h2><br>
<p>          :</p><br>
<pre><code class="plaintext hljs">gradle test --tests *.PublicTransactionsTests</code></pre><br>
<p>    3   <em>API</em>.    -  ,  —       —    -.          (     ,    ):</p><br>
<pre><code class="plaintext hljs">[HANDLER] privateFor = [public]<font></font>
[HANDLER] deploying new smart-contract<font></font>
[HANDLER] contract has been successfully deployed. Result: {contract_address=0xf9425b94e459805da09950f5988071692d925097, transaction_hash=0x31bc179f8cd12c640d1663f3df51ce6da1fbc2875f2b724c3911108fcd19a5d0}<font></font>
[HANDLER] privateFor = [public]<font></font>
[HANDLER] sending new transaction<font></font>
[HANDLER] transaction has been successfully executed. Result: {contract_address=null, transaction_hash=0x33ba66d5deec33f3142bfa190a0d37d0ff07c2e66b06037f5b5ff9578154a3ff}<font></font>
[HANDLER] reading user from smart-contract<font></font>
[HANDLER] user: 'Public Test User'</code></pre><br>
<p> ,     ,   3   .  3  —     -,  3  —   ,   2 —    -.<br>
,         <strong>contract_address</strong>,      — ,   ,         ,       -.</p><br>
<p>  ,    <em>Geth</em>,       <em>IPC</em>   <em>Geth</em> :</p><br>
<pre><code class="plaintext hljs">geth attach /path/to/ipc</code></pre><br>
<p> ,   ""  ,      .    <code>TransactionReceipt</code>     -,   (    ,      ):</p><br>
<pre><code class="plaintext hljs">web3.eth.getTransactionReceipt('0x31bc179f8cd12c640d1663f3df51ce6da1fbc2875f2b724c3911108fcd19a5d0');</code></pre><br>
<p>    :</p><br>
<p><img src="https://habrastorage.org/webt/so/jm/yw/sojmyw_4gei16afdq47ypzmvtru.png"></p><br>
<p>   :</p><br>
<ul>
<li>"contractAddress" —   "null",   ,      -;</li>
<li>"status" —      "0x1" —  ,    .</li>
</ul><br>
<p>     .  : </p><br>
<pre><code class="plaintext hljs">web3.eth.getTransaction('0x31bc179f8cd12c640d1663f3df51ce6da1fbc2875f2b724c3911108fcd19a5d0');</code></pre><br>
<p>:</p><br>
<p><img src="https://habrastorage.org/webt/ju/jq/86/jujq86cugnifanot96ypy_hvusm.png"></p><br>
<p>    :</p><br>
<ul>
<li>"input" —  <em>payload</em> ;</li>
<li>"v" —  ,    <em>ECDSA</em>,   ,      —  .   ,         . "0x1c" ("28"   )  "0x1b" ("27"   )    ,  "0x25" ("37"   )  "0x26" ("38"   ) —    .</li>
</ul><br>
<p>  ,         ,    .</p><br>
<p>       -.  :</p><br>
<pre><code class="plaintext hljs">web3.eth.getTransactionReceipt('0x33ba66d5deec33f3142bfa190a0d37d0ff07c2e66b06037f5b5ff9578154a3ff');</code></pre><br>
<p>:</p><br>
<p><img src="https://habrastorage.org/webt/zz/8g/a-/zz8ga-le8lswmr7vkizq5tu_zog.png"></p><br>
<p>   :</p><br>
<ul>
<li>"to" — ,     -  -;</li>
<li>"status" —   "0x1",  ,    .</li>
</ul><br>
<p>:</p><br>
<p><img src="https://habrastorage.org/webt/t9/yh/xp/t9yhxp0-hzbkvylmous8p--ft2e.png"></p><br>
<p> ,       ,  .</p><br>
<h2 id="private-tranzakcii">Private </h2><br>
<p>      ,    :</p><br>
<pre><code class="plaintext hljs">gradle test --tests *.PrivateTransactionsTests</code></pre><br>
<p>,   -   ,  -   -,            -.</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">[HANDLER] privateFor = []<font></font>
[HANDLER] deploying new smart-contract<font></font>
[HANDLER] contract has been successfully deployed. Result: {contract_address=0x3e2284d92842f781b83cc7e56fbb074ab15f9a90, transaction_hash=0x8fd619bd9a526f83e29d7b417551e174862f7503ef430eb45793509d05039595}<font></font>
[HANDLER] privateFor = []<font></font>
[HANDLER] sending new transaction<font></font>
[HANDLER] transaction has been successfully executed. Result: {contract_address=null, transaction_hash=0x72a0458a7b313c8a1c18269ae160e140c6a6e41cb2fd087c64cf665b08a6aefb}<font></font>
[HANDLER] reading user from smart-contract<font></font>
[HANDLER] user: 'Private Test User'</code></pre><br>
<p>,     ,   <strong>privateFor</strong> —      .<br>
  <code>TransactionReceipt</code>  . :</p><br>
<pre><code class="plaintext hljs">web3.eth.getTransactionReceipt('0x8fd619bd9a526f83e29d7b417551e174862f7503ef430eb45793509d05039595');</code></pre><br>
<p>:</p><br>
<p><img src="https://habrastorage.org/webt/qx/aj/1g/qxaj1gluf9gl-o-rwbwaa6-oww8.png"></p><br>
<p> ,     ,  ,      ,     — <strong>gasUsed</strong>  <strong>cumulativeGasUsed</strong>   "0".<br>
      .  :</p><br>
<pre><code class="plaintext hljs">web3.eth.getTransaction('0x8fd619bd9a526f83e29d7b417551e174862f7503ef430eb45793509d05039595');</code></pre><br>
<p>   :</p><br>
<p><img src="https://habrastorage.org/webt/of/zj/ud/ofzjuds-akmr-koc9ed9dasubnq.png"></p><br>
<p>     :</p><br>
<ol>
<li>       ,   <em>payload</em>       64  (128 )   <strong>input</strong>.   —      <em>Tessera</em>,         <em>Tessera</em>.</li>
<li>"v" —   "0x1c"  "0x1b"    ,      "0x26"  "0x25".</li>
</ol><br>
<p>   <code>TransactionReceipt</code>        (   ). :</p><br>
<p><img src="https://habrastorage.org/webt/of/zj/ud/ofzjuds-akmr-koc9ed9dasubnq.png"></p><br>
<p><img src="https://habrastorage.org/webt/cw/mp/vk/cwmpvk3hjzcnh51isapyhecpkf0.png"></p><br>
<p>      ,  ,  .</p><br>
<h2 id="permissioned-tranzakcii">Permissioned </h2><br>
<p>,     ,      1 ,   ,            .   ,      ,     <strong>privateFor</strong>   ,       <strong>privateFor</strong> (          ).<br>
   -        (permissioned ),    :</p><br>
<pre><code class="plaintext hljs">gradle test --tests *.PermissionTransactionsTests</code></pre><br>
<p> <em>Java API</em>:</p><br>
<pre><code class="plaintext hljs">[HANDLER] privateFor = [wQTHrl/eqa7TvOz9XJcazsp4ZuncfxHb8c1J1njIOGA=]<font></font>
[HANDLER] deploying new smart-contract<font></font>
[HANDLER] contract has been successfully deployed. Result: {contract_address=0xf1cc0ba22bd0d18fc9acb22dd57795a3f2fb4ebd, transaction_hash=0x585980bec88aa8a0fe5caffe6d6f24b82d3cd381fcf72fdd8e2102ce67799f01}<font></font>
[HANDLER] privateFor = [wQTHrl/eqa7TvOz9XJcazsp4ZuncfxHb8c1J1njIOGA=]<font></font>
[HANDLER] sending new transaction<font></font>
[HANDLER] transaction has been successfully executed. Result: {contract_address=null, transaction_hash=0x47edc0d00fa9447b2da9f5a78f44602f96145497238cb1ce1d879afb351a3cbe}<font></font>
[HANDLER] reading user from smart-contract<font></font>
[HANDLER] user: 'Permissioned Test User'</code></pre><br>
<p>  <em>Geth</em>-,    -, <code>TransactionReceipt</code>    :</p><br>
<p><img src="https://habrastorage.org/webt/nk/cs/do/nkcsdozorvcuh7gv7kxspwovxmm.png"></p><br>
<p><img src="https://habrastorage.org/webt/bc/z5/1u/bcz51u6c28aussavjw7fdieayuq.png"></p><br>
<p>    , <code>TransactionReceipt</code>   :</p><br>
<p><img src="https://habrastorage.org/webt/4f/al/lt/4falltfjniekypa5r38xu8j6tzo.png"></p><br>
<p><img src="https://habrastorage.org/webt/tq/-s/ta/tq-stauf7_6a00ts7qgkzif0p18.png"></p><br>
<h3 id="http-zaprosy">HTTP </h3><br>
<p>  ,   ,          <em>Geth</em>-,        .   ,   ,      ,    ,       <em>CURL</em>  3 ,     - (    <em>private</em>  <em>persmissioned</em> ).<br>
HTTP       2 :</p><br>
<ol>
<li>"endpoint" —  endpoint  <em>Quorum</em> ,     .</li>
<li>"contractAddress" —  ,     .</li>
</ol><br>
<p>   "endopint"     — <em>localhost</em> —     3 <em>Quorum</em> : 22000 (     ), 22001 (      permissioned ), 22002 (     ).</p><br>
<p>  <em>private</em>  (   22000        -).</p><br>
<p><em>CURL</em>      :</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22000",<font></font>
    "contractAddress": "0x3e2284d92842f781b83cc7e56fbb074ab15f9a90"<font></font>
}'</code></pre><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">{"data":{"user":"Private Test User"}}</code></pre><br>
<p> ,        -.</p><br>
<p>  ,      22001 . <em>CURL</em> :</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22001",<font></font>
    "contractAddress": "0x3e2284d92842f781b83cc7e56fbb074ab15f9a90"<font></font>
}'</code></pre><br>
<p>!        :</p><br>
<pre><code class="plaintext hljs">{"data":{"status_code":500,"description":"Something went wrong"}}</code></pre><br>
<p>    ,        - —    !</p><br>
<p>    , 3- . <em>CURL</em> :</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22002",<font></font>
    "contractAddress": "0x3e2284d92842f781b83cc7e56fbb074ab15f9a90"<font></font>
}'</code></pre><br>
<p>! API  :</p><br>
<pre><code class="plaintext hljs">{"data":{"status_code":500,"description":"Something went wrong"}}</code></pre><br>
<p>  ,        .     "permissioned" .</p><br>
<p> <em>CURL</em>       "permissioned" -  ,    22000:</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22000",<font></font>
    "contractAddress": "0xf1cc0ba22bd0d18fc9acb22dd57795a3f2fb4ebd"<font></font>
}'</code></pre><br>
<p>:</p><br>
<pre><code class="plaintext hljs">{"data":{"user":"Permissioned Test User"}}</code></pre><br>
<p> ,         ,   ,       .</p><br>
<p>      -   ,         -,       . <em>CURL</em> :</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22001",<font></font>
    "contractAddress": "0xf1cc0ba22bd0d18fc9acb22dd57795a3f2fb4ebd"<font></font>
}'</code></pre><br>
<p>!         :</p><br>
<pre><code class="plaintext hljs">{"data":{"user":"Permissioned Test User"}}</code></pre><br>
<p>     ,          ,    . <em>CURL</em> :</p><br>
<pre><code class="plaintext hljs">curl -X POST \<font></font>
    http://127.0.0.1:8080/user \<font></font>
    -H 'Content-Type: application/json' \<font></font>
    -d '{<font></font>
    "endpoint": "http://127.0.0.1:22002",<font></font>
    "contractAddress": "0xf1cc0ba22bd0d18fc9acb22dd57795a3f2fb4ebd"<font></font>
}'</code></pre><br>
<p>!         -.    .</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>     ,    <em>Quorum blockchain</em>   Java .      ,    -     .</p><br>
<p>  :</p><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">定足数</font></em><font style="vertical-align: inherit;">ドキュメント</font></font><em><font style="vertical-align: inherit;"></font></em></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">クォーラム</font></em><font style="vertical-align: inherit;">テストネットワーク</font></font><em><font style="vertical-align: inherit;"></font></em></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">GitHub</font></em><font style="vertical-align: inherit;">プロジェクト</font></font><em><font style="vertical-align: inherit;"></font></em></a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">Slackの</font></em><em><font style="vertical-align: inherit;">クォーラム</font></em><font style="vertical-align: inherit;">チャネル</font></font><em><font style="vertical-align: inherit;"></font></em> </a></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご清聴ありがとうございました！</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja462539/index.html">三角法を避ける</a></li>
<li><a href="../ja462541/index.html">SpringでのConditionalの使用</a></li>
<li><a href="../ja462543/index.html">RaiffeisenbankでのJavaミートアップ</a></li>
<li><a href="../ja462545/index.html">テレグラムブロッキング、ヘッツナーサブネット/ 16、ILVの経験</a></li>
<li><a href="../ja462547/index.html">SGX Malvar：悪意のある人が、それが考えられた目的のためにインテルの新しいテクノロジーをどのように利用するか</a></li>
<li><a href="../ja462551/index.html">テストに関する開発者からのよくある質問</a></li>
<li><a href="../ja462553/index.html">シンプルについて少し。テスト設計。パート1</a></li>
<li><a href="../ja462555/index.html">ディスカッション：Cookieなしで機能する場合-代替案を教えてくれます</a></li>
<li><a href="../ja462563/index.html">ウェビナー「コンプライアンスを生き残る方法は？」規制要件を満たすための最善のアプローチ」</a></li>
<li><a href="../ja462565/index.html">CelonisによるSAP Process Miningのデータを準備する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>