<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤ üëäüèΩ üö∂üèº Houston, tenemos un problema. Falla de dise√±o del sistema üë®üèæ‚ÄçüöÄ üßõüèª ü§≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 1970, los ingenieros estadounidenses lanzaron la nave espacial Apolo 13 a la luna. A bordo hay tres bater√≠as de celdas de combustible, no hay nada ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Houston, tenemos un problema. Falla de dise√±o del sistema</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/497332/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 1970, los ingenieros estadounidenses lanzaron la nave espacial Apolo 13 a la luna. A bordo hay tres bater√≠as de celdas de combustible, no hay nada de qu√© preocuparse, todo se duplica de manera confiable y repetida. Pero nadie podr√≠a haber imaginado que la explosi√≥n de un cilindro de ox√≠geno desactivar√≠a dos de las tres bater√≠as. ¬°Tragedia! Los astronautas regresaron a casa, se realiz√≥ un largometraje sobre el evento con Tom Hanks, y la frase del astronauta Jack Swigert: "¬°Houston, tenemos un problema!", Pas√≥ a la historia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/iu/oj/oi/iuojoilj6ikne43fxjqm5q6bjm4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La historia del Apolo 13 es otra prueba del hecho bien conocido de que no puede prepararse para todos los posibles problemas. Esta es una propiedad natural del mundo: el hierro se rompe peri√≥dicamente, el c√≥digo se bloquea y la gente comete errores. Es imposible eliminar completamente esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para sistemas distribuidos grandes, este comportamiento es normal; es consecuencia de econom√≠as de escala y estad√≠sticas. </font><font style="vertical-align: inherit;">Es por eso que Design for Failure (AWS) es el principio de dise√±o b√°sico para los servicios en la nube de AWS. </font><font style="vertical-align: inherit;">Los sistemas se construyen inicialmente de tal manera que restablecen la operaci√≥n a tiempo completo lo m√°s r√°pido posible y minimizan el da√±o de fallas conocidas y a√∫n desconocidas. </font><font style="vertical-align: inherit;">En </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HighLoad ++,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vasily Pantyukhin, utilizando como ejemplo problemas de la vida real con servicios de combate, mostr√≥ patrones de dise√±o para sistemas distribuidos que usan los desarrolladores de AWS.</font></font><br>
<a name="habracut"></a><br>
 <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vasily Pantyukhin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gallina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Es el arquitecto de Amazon Web Services en Europa, Oriente Medio y √Åfrica. Comenz√≥ como administrador de Unix, trabaj√≥ en Sun Microsystem durante 6 a√±os, imparti√≥ cursos t√©cnicos y durante 11 a√±os ense√±√≥ la centralizaci√≥n de datos del mundo en EMC. En un equipo internacional, dise√±√≥ e implement√≥ proyectos desde Ciudad del Cabo hasta Oslo. Ahora ayuda a grandes y peque√±as empresas a trabajar en nubes p√∫blicas.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RxWVxr4uUpI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 1949, se investig√≥ un accidente a√©reo en una base de la fuerza a√©rea de California. </font><font style="vertical-align: inherit;">Uno de los ingenieros que hizo esto fue Edward Murphy. </font><font style="vertical-align: inherit;">Describi√≥ el trabajo de los t√©cnicos locales de la siguiente manera: "Si hay dos formas de hacer algo y una de ellas conduce al desastre, entonces alguien elegir√° este m√©todo". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s tarde, gracias a Arthur Bloch, la declaraci√≥n pas√≥ a la historia como una de las leyes de Murphy. </font><font style="vertical-align: inherit;">En ruso: la ley de la maldad. </font><font style="vertical-align: inherit;">Su esencia es que no ser√° posible evitar aver√≠as y errores humanos, y tendr√° que vivir con ello de alguna manera. </font><font style="vertical-align: inherit;">Es por eso que, al dise√±ar, inmediatamente colocamos fallas y fallas de componentes individuales en nuestros sistemas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dise√±o de falla</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el dise√±o para fallas, estamos tratando de mejorar tres caracter√≠sticas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accesibilidad (esos mismos "nueves");</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fiabilidad: la propiedad del sistema para proporcionar el nivel de servicio necesario;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tolerancia a fallas: una propiedad del sistema para evitar la aparici√≥n de problemas y recuperarse r√°pidamente despu√©s de ellos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fiabilidad tiene la propiedad de " </font><font style="vertical-align: inherit;">inc√≥gnitas </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conocidas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Nos protegemos de los problemas conocidos, pero no sabemos cu√°ndo ocurrir√°n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Äú </font></font><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conocidos desconocidos‚Äù</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se </font><font style="vertical-align: inherit;">a√±aden a la tolerancia a fallos </font><font style="vertical-align: inherit;">- estos son problemas sorpresa de que no sabemos nada. </font><font style="vertical-align: inherit;">Muchos de estos problemas en la nube est√°n relacionados con econom√≠as de escala: el sistema crece al tama√±o cuando aparecen efectos nuevos, sorprendentes e inesperados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El fracaso generalmente no es un fen√≥meno binario. </font><font style="vertical-align: inherit;">Su propiedad principal es el </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"radio de explosi√≥n"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o el nivel de degradaci√≥n del servicio, radio de destrucci√≥n. </font><font style="vertical-align: inherit;">Nuestra tarea es reducir el "radio de explosi√≥n" de los sistemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si reconocemos que los problemas no pueden evitarse, entonces debemos prepararnos proactivamente para ellos. </font><font style="vertical-align: inherit;">Esto significa que dise√±amos servicios de tal manera que, en caso de problemas (seguramente lo ser√°n), controlamos los problemas, y no al rev√©s.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando respondemos a un problema, nos controla.</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plano de datos y plano de control</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seguramente, tiene dispositivos electr√≥nicos en el hogar controlados por un control remoto, como un televisor. </font><font style="vertical-align: inherit;">La pantalla del televisor es parte del plano de datos, que realiza directamente la funci√≥n. </font><font style="vertical-align: inherit;">El control remoto es la interfaz de usuario - Plano de control. </font><font style="vertical-align: inherit;">Se utiliza para administrar y configurar el servicio. </font><font style="vertical-align: inherit;">En la nube, intentamos separar el plano de datos y el plano de control para pruebas y desarrollo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los usuarios, con mayor frecuencia, no ven la complejidad del plano de Control. </font><font style="vertical-align: inherit;">Pero los errores en su dise√±o e implementaci√≥n son las causas m√°s comunes de fallas masivas. </font><font style="vertical-align: inherit;">Es por eso que mi consejo se centra en el plano de Control, a veces expl√≠citamente, a veces no.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La historia de un problema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En julio de 2012, una tormenta severa pas√≥ en el norte de Virginia. El centro de datos tiene protecci√≥n, generadores di√©sel y m√°s, pero sucedi√≥ que en uno de los centros de datos de una de las zonas de disponibilidad (Zona de disponibilidad, AZ) de la regi√≥n de Virginia del Norte, se perdi√≥ la energ√≠a. La electricidad se restableci√≥ r√°pidamente, pero la restauraci√≥n de los servicios se prolong√≥ durante horas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/ev/yd/igevydk5zuise0toukfgy9gdxsw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Te contar√© las razones en el ejemplo de uno de los servicios b√°sicos: CLB (Classic Load Balancer). Funciona de manera simple: cuando inicia un nuevo equilibrador en cada zona de disponibilidad, se crean instancias separadas, cuya IP resolver√° el DNS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/al/l0/gwall0xgawp614yocrkqtoz87dk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando falla una de las instancias, se env√≠a un mensaje sobre esto a una base de datos especial. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/ts/bj/sktsbjffpcebdnovro-u6dyr0pu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En respuesta, comienzan los procedimientos: eliminar registros del DNS, comenzar una nueva instancia y agregar una nueva IP al DNS.</font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: As√≠ es como funcionaba el sistema en el pasado, ahora todo es fundamentalmente diferente.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Todo es simple: no hay nada que romper. Pero durante una falla masiva, cuando miles de instancias colapsan al mismo tiempo, aparece un </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enorme Backlog en la base</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><strong><font style="vertical-align: inherit;">datos</font></strong><font style="vertical-align: inherit;"> de mensajes para su procesamiento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r2/--/nw/r2--nw4kqcrocoysqgptvysranu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero se puso peor. El plano de control es un sistema distribuido. Debido a un error, recibimos duplicados y miles de registros en la base de datos aumentaron a cientos de miles. Se hizo muy dif√≠cil trabajar con esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando ocurre una falla en una de las instancias, todo el tr√°fico se cambia casi instant√°neamente a las m√°quinas sobrevivientes y la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carga se duplica</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (en el ejemplo, por simplicidad, solo hay dos zonas de acceso). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uz/jl/ox/uzjloxrf6wvv5hrju2-votyb-o4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay suficientes recursos, una instancia en vivo comienza a </font><strong><font style="vertical-align: inherit;">escalar</font></strong><font style="vertical-align: inherit;"> autom√°ticamente</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El proceso lleva un tiempo relativamente largo. Todo sucede al m√°ximo y al mismo tiempo con una gran cantidad de instancias: los recursos gratuitos de la zona de disponibilidad se est√°n agotando. Comienza la "lucha" por los recursos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el norte de Virginia, la automatizaci√≥n no pudo hacer frente a la falla masiva, y los ingenieros manualmente (usando scripts) restauraron los servicios para que funcionen. Tales problemas son raros. Durante la sesi√≥n informativa, surgieron preguntas sobre las causas de la falla, decidieron que la situaci√≥n ya no deber√≠a repetirse y que todo el servicio deber√≠a cambiarse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los ocho patrones que cubrir√© son respuestas a algunas de las preguntas. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. Esta es nuestra experiencia en el dise√±o de servicios, no la sabidur√≠a universal para un uso generalizado. Los patrones se usan en situaciones espec√≠ficas.</font></font></em><br>
<br>
<em>      ‚Äî  .   AWS           .    ‚Äî ,  .    .     ‚Äî     .     !</em><br>
<br>
<h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minimizar el impacto de las fallas, muchos enfoques. Una de ellas es responder la pregunta: "¬øC√≥mo puedo asegurarme de que los usuarios que no conocen un problema no lo sepan durante una falla y durante la recuperaci√≥n?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestro enorme Backlog no solo recibe mensajes fallidos, sino tambi√©n otros, por ejemplo, sobre el escalado o que alguien est√° lanzando un nuevo equilibrador. Dichos mensajes deben aislarse entre s√≠, agrupando funcionalmente: un grupo separado de mensajes de recuperaci√≥n despu√©s de una falla, iniciando por separado un nuevo equilibrador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que diez usuarios notaron un problema: uno de los nodos de sus equilibradores se cay√≥. Los servicios de alguna manera funcionan con los recursos restantes, pero el problema se siente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/wu/3a/3cwu3agcfwjtemyacuneqwtmrfm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos diez usuarios frustrados. </font><font style="vertical-align: inherit;">El und√©cimo aparece: no sabe nada sobre el problema, pero simplemente quiere un nuevo equilibrador. </font><font style="vertical-align: inherit;">Si su solicitud de dejar la cola para el procesamiento, lo m√°s probable es que no espere. </font><font style="vertical-align: inherit;">Mientras se completan otros procedimientos de procesamiento, el tiempo de solicitud finalizar√°. </font><font style="vertical-align: inherit;">En lugar de diez usuarios frustrados, tendremos once. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evitar que esto suceda, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priorizamos algunas solicitudes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : colocamos las colas en la parte superior, por ejemplo, solicitudes de nuevos recursos. </font><font style="vertical-align: inherit;">Con una falla masiva, un n√∫mero relativamente peque√±o de tales solicitudes no afectar√° el tiempo de recuperaci√≥n de los recursos de otros clientes. </font><font style="vertical-align: inherit;">Pero en el proceso de recuperaci√≥n, restringiremos la cantidad de usuarios involucrados en el problema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajo de tiempo completo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La respuesta a los informes de problemas es el lanzamiento de procedimientos de recuperaci√≥n, en particular, el trabajo con DNS. Las fallas masivas son enormes cargas m√°ximas en el plano de control. El segundo patr√≥n ayuda al plano de Control a ser m√°s </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estable y predecible</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en tal situaci√≥n. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fg/dv/zm/fgdvzmrez2rrlgfsc4ztmxmkaxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos un enfoque llamado </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabajo constante: trabajo permanente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/pa/ee/ripaeenvgoadihywoj90c7vvopa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, el DNS se puede hacer un poco m√°s inteligente: comprobar√° constantemente las instancias del equilibrador, est√©n activas o no. El resultado ser√° un mapa de bits cada vez: la instancia responde - 1, muerta - 0. El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DNS verifica las instancias cada pocos segundos, independientemente de si el sistema se restaura despu√©s de una falla masiva o est√° funcionando normalmente. √âl hace el mismo trabajo: sin picos, todo es predecible y estable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro ejemplo simplificado: queremos cambiar la configuraci√≥n en una flota grande. </font><font style="vertical-align: inherit;">En nuestra terminolog√≠a, una </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flota es un grupo de m√°quinas virtuales</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que juntas hacen algo de trabajo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nb/wq/go/nbwqgolicpqizt1bkehgk4ney9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocamos los cambios de configuraci√≥n en el bucket S3, y cada 10 segundos (por ejemplo) enviamos toda esta configuraci√≥n a nuestra flota de m√°quinas virtuales. </font><font style="vertical-align: inherit;">Dos puntos importantes.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacemos esto regularmente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y nunca rompemos la regla. </font><font style="vertical-align: inherit;">Si elige un segmento de 10 segundos, presione solo de esta manera, independientemente de la situaci√≥n.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre damos la configuraci√≥n completa</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , independientemente de si ha cambiado o no. </font><font style="vertical-align: inherit;">El plano de datos (m√°quinas virtuales) ellos mismos deciden qu√© hacer con √©l. </font><font style="vertical-align: inherit;">No empujamos el delta. </font><font style="vertical-align: inherit;">Puede hacerse muy grande con interrupciones o cambios masivos. </font><font style="vertical-align: inherit;">Potencialmente, esto puede contribuir a la inestabilidad e imprevisibilidad.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando realizamos alg√∫n tipo de trabajo permanente, pagamos m√°s por ello. Por ejemplo, 100 m√°quinas virtuales solicitan una configuraci√≥n cada segundo. Cuesta alrededor de $ 1200 por a√±o. Esta cantidad es esencialmente menor que el salario de un programador, a quien podemos confiar el desarrollo de un plano de Control con un enfoque cl√°sico: una reacci√≥n a una falla y la distribuci√≥n de solo cambios de configuraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si cambia la configuraci√≥n cada pocos segundos, como en el ejemplo, entonces esto es lento. Pero en muchos casos, un cambio de configuraci√≥n o el lanzamiento de servicios lleva minutos; unos segundos no resuelven nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los segundos son importantes para los servicios en los que la configuraci√≥n debe cambiar instant√°neamente, por ejemplo, al cambiar la configuraci√≥n de VPC. Aqu√≠ el "trabajo permanente" no es aplicable. Esto es solo un patr√≥n, no una regla. Si esto no funciona en su caso, no lo use.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escalamiento preliminar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro ejemplo, cuando la instancia del equilibrador se bloquea, la segunda instancia superviviente recibe la carga duplicada casi de inmediato y comienza a escalar. </font><font style="vertical-align: inherit;">En una falla masiva, consume una gran cantidad de recursos. </font><font style="vertical-align: inherit;">El tercer patr√≥n ayuda a controlar este proceso: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escalar por adelantado</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de dos zonas de disponibilidad, escalamos al eliminar menos del 50%. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/wy/n4/chwyn4ffipap4mcwshur7bikoj4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si todo se hace por adelantado, en caso de falla, las instancias sobrevivientes del equilibrador est√°n listas para aceptar el tr√°fico duplicado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anteriormente, escalamos solo con alta utilizaci√≥n, por ejemplo, 80%, y ahora en 45%. </font><font style="vertical-align: inherit;">El sistema est√° inactivo la mayor parte del tiempo y se vuelve m√°s costoso. </font><font style="vertical-align: inherit;">Pero estamos listos para soportar esto y usar activamente el patr√≥n, porque esto </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es seguro</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Debe pagar el seguro, pero en caso de problemas serios, la ganancia cubre todos los gastos. </font><font style="vertical-align: inherit;">Si decide utilizar el patr√≥n, calcule todos los riesgos y el precio por adelantado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura celular</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay dos formas de construir y servicios escalados: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el monolito</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estructura de panal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (basada en c√©lulas). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/y7/ab/ncy7abk8fzjvr8lsez7wwcjuc70.png"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El monolito se</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desarrolla y crece como un solo contenedor grande. </font><font style="vertical-align: inherit;">Agregamos recursos, el sistema se hincha, nos encontramos con diferentes l√≠mites, las caracter√≠sticas lineales se vuelven no lineales y se saturan, y el "radio de explosi√≥n" del sistema: todo el sistema.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el monolito se prueba mal, aumenta la probabilidad de sorpresas: "inc√≥gnitas desconocidas". Pero un gran monolito no se puede probar completamente. A veces, para esto, tendr√° que construir una zona de acceso separada, por ejemplo, para un servicio popular que se construye como un monolito dentro de la zona de acceso (se trata de muchos centros de datos). Adem√°s de crear de alguna manera una gran carga de prueba que es similar al presente, esto es imposible desde un punto de vista financiero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, en la mayor√≠a de los casos, utilizamos una </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquitectura celular</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , una configuraci√≥n en la cual un sistema se construye a partir de celdas de un tama√±o fijo. Al agregar celdas, lo escalamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La arquitectura celular es popular en la nube de AWS. Ayuda a aislar fallas y </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reducir el radio de explosi√≥n.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a una o m√°s celdas. Podemos probar completamente las c√©lulas de tama√±o mediano, esto reduce seriamente los riesgos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se utiliza un enfoque similar en la construcci√≥n naval: el casco de un barco o embarcaci√≥n se divide por particiones en compartimentos. En el caso de un agujero, uno o m√°s compartimientos se inundan, pero el barco no se hunde. S√≠, no ayud√≥ al Titanic, pero rara vez encontramos problemas de iceberg. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ilustrar√© la aplicaci√≥n del enfoque de malla utilizando el Servicio de formas simples como ejemplo. Este no es un servicio de AWS, se me ocurri√≥. Este es un conjunto de API simples para trabajar con formas geom√©tricas simples. Puede crear una instancia de una forma geom√©trica, solicitar el tipo de una forma por su id o contar todas las instancias de un tipo dado. Por ejemplo, </font></font><code>put(triangle)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un objeto "tri√°ngulo" con alguna identificaci√≥n se crea </font><font style="vertical-align: inherit;">en una solicitud </font><font style="vertical-align: inherit;">.</font></font><code>getShape(id)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve el tipo "tri√°ngulo", "c√≠rculo" o "rombo". </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7t/z6/dv/7tz6dv0w3f9laswjhuwtbpedggs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer un servicio nublado, debe ser utilizado por diferentes usuarios al mismo tiempo. </font><font style="vertical-align: inherit;">Hag√°moslo multiinquilino. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/64/hk/pq/64hkpq9niokkw8w-w9rsu7m-w04.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debe encontrar una forma de partici√≥n: separar las figuras en celdas. </font><font style="vertical-align: inherit;">Hay varias opciones para elegir la clave de partici√≥n. </font><font style="vertical-align: inherit;">El m√°s simple est√° </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la forma geom√©trica</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : todos los rombos en la primera celda, c√≠rculos en la segunda, tri√°ngulos en la tercera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo tiene pros y contras.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si hay notablemente menos c√≠rculos que otras figuras, entonces la celda correspondiente permanecer√° subutilizada (distribuci√≥n desigual).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunas solicitudes de API son f√°ciles de implementar. </font><font style="vertical-align: inherit;">Por ejemplo, contando todos los objetos en la segunda celda, encontramos el n√∫mero de c√≠rculos en el sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otras consultas son m√°s complicadas. </font><font style="vertical-align: inherit;">Por ejemplo, para encontrar una forma geom√©trica por id, debe pasar por todas las celdas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda forma es usar la </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificaci√≥n de los objetos por rangos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : los primeros mil objetos en la primera celda, el segundo en la segunda. </font><font style="vertical-align: inherit;">Entonces la distribuci√≥n es m√°s uniforme, pero hay otras dificultades. </font><font style="vertical-align: inherit;">Por ejemplo, para contar todos los tri√°ngulos, debe usar el m√©todo </font></font><code>scatter/gather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: distribuimos las solicitudes en cada celda, cuenta los tri√°ngulos dentro de s√≠ mismo, luego recopila las respuestas, resume y produce el resultado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tercera v√≠a: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">divisi√≥n de inquilinos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a los usuarios). Aqu√≠ nos enfrentamos a un problema cl√°sico. Por lo general, hay muchos usuarios "peque√±os" en la nube que prueban algo y pr√°cticamente no cargan el servicio. Hay usuarios de mastodontes. Son pocos, pero consumen una gran cantidad de recursos. Dichos usuarios nunca encajar√°n en ninguna celda. Debe encontrar formas complicadas de distribuirlas entre muchas celdas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/1i/3c/wp1i3c0ac5bjnvnxividrzrq6fk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No existe una forma ideal, cada servicio es individual. La buena noticia es que la sabidur√≠a mundana funciona aqu√≠: cortar le√±a es m√°s conveniente a lo largo de las fibras, en lugar de cortarlas. En muchos servicios, estas "fibras" son m√°s o menos obvias. Luego puede experimentar y encontrar la clave de partici√≥n √≥ptima.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las c√©lulas est√°n interconectadas (aunque d√©bilmente). Por lo tanto, debe haber un nivel de conexi√≥n. A menudo se denomina enrutamiento o capa de mapeo. Es necesario comprender a qu√© celdas enviar solicitudes espec√≠ficas. Este nivel debe ser lo m√°s simple posible. Trate de no poner l√≥gica empresarial en ello. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/os/ox/mgosox1qloxyngz5k1fd4wwy_ws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se plantea la cuesti√≥n del tama√±o de las celdas: peque√±o - malo, grande - tambi√©n malo. No existe un consejo universal: decida seg√∫n la situaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la nube de AWS, utilizamos celdas l√≥gicas y f√≠sicas de diferentes tama√±os. Hay servicios regionales con un gran tama√±o de celda, hay servicios de zona, donde las celdas son m√°s peque√±as. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z9/s8/k-/z9s8k-8v60dwwojzqv86ozp7s7k.png"><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota. Habl√© sobre microc√©lulas en Saint Highload ++ Online a principios de abril de este a√±o. All√≠ discut√≠ en detalle un ejemplo del uso espec√≠fico de este patr√≥n en nuestro servicio central de Amazon EBS.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiinquilino</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando un usuario inicia un nuevo equilibrador, recibe instancias en cada zona de disponibilidad. </font><font style="vertical-align: inherit;">Independientemente de si los recursos se utilizan o no, se asignan y pertenecen exclusivamente a este inquilino de la nube. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para AWS, este enfoque es ineficiente porque la utilizaci√≥n de los recursos del servicio es, en promedio, muy baja. </font><font style="vertical-align: inherit;">Esto afecta el costo. </font><font style="vertical-align: inherit;">Para los usuarios de la nube, esta no es una soluci√≥n flexible. </font><font style="vertical-align: inherit;">No puede adaptarse a condiciones que cambian r√°pidamente, por ejemplo, para proporcionar recursos con una carga inesperadamente aumentada en el menor tiempo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/52/xg/fk52xgzaaqhgq09uw_zlhbhxpfc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLB fue el primer equilibrador en la nube de Amazon. </font><font style="vertical-align: inherit;">Los servicios actuales utilizan un enfoque de m√∫ltiples inquilinos, como NLB (Network Load Balancer). </font><font style="vertical-align: inherit;">La base, el "motor" de dichos servicios de red es </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HyperPlane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esta es una gran flota de m√°quinas virtuales (nodos) internas, invisibles para los usuarios finales. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-b/65/3a/-b653as3g91ombi9itfq5wwqjxg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ventajas del </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enfoque multiinquilino</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o el quinto patr√≥n.</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La tolerancia a fallas es fundamentalmente mayor</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En HyperPlane, una gran cantidad de nodos ya se est√°n ejecutando y est√°n esperando la carga. </font><font style="vertical-align: inherit;">Los nodos conocen el estado de cada uno: cuando algunos recursos fallan, la carga se distribuye instant√°neamente entre los restantes. </font><font style="vertical-align: inherit;">Los usuarios ni siquiera notan los choques masivos.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protecci√≥n de carga m√°xima</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Los inquilinos viven sus propias vidas y sus cargas generalmente no se correlacionan entre s√≠. </font><font style="vertical-align: inherit;">La carga promedio total en HyperPlane es bastante suave.</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La utilizaci√≥n de tales servicios es fundamentalmente mejor</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Por lo tanto, proporcionando un mejor rendimiento, son m√°s baratos.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso suena genial! Pero el enfoque de m√∫ltiples inquilinos tiene inconvenientes. En la figura, la flota HyperPlane con tres inquilinos (rombos, c√≠rculos y tri√°ngulos), que se </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distribuyen en todos los nodos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kv/by/dg/kvbydgnlm6a8plns-cewltag1e8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto plantea el cl√°sico problema del vecino ruidoso: la acci√≥n destructiva del inquilino, que genera tr√°fico ultra alto o malo, afectar√° potencialmente a todos los usuarios. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/b9/v4/3fb9v4-hnl27k0sgihgjybo_x70.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El "radio de explosi√≥n" en dicho sistema es todos los inquilinos. La probabilidad de un "vecino ruidoso" destructivo en la zona de disponibilidad real de AWS no es alta. Pero siempre debemos estar preparados para lo peor. Nos defendemos usando un enfoque de malla: seleccionamos grupos de nodos como celdas. En este contexto, los llamamos fragmentos. C√©lulas, fragmentos, particiones: aqu√≠ es lo mismo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d1/7z/yy/d17zyyesjijnpsqpllrwhlthqn4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, un rombo, como "vecino ruidoso", afectar√° solo a un inquilino: un tri√°ngulo. </font><font style="vertical-align: inherit;">Pero el tri√°ngulo ser√° muy doloroso. </font><font style="vertical-align: inherit;">Para suavizar el efecto, aplique el sexto patr√≥n: mezcla de fragmentaci√≥n.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barajar fragmentos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Distribuimos al azar los inquilinos a los nodos. </font><font style="vertical-align: inherit;">Por ejemplo, un rombo aterriza en 1, 3 y 6 nodos, y un tri√°ngulo en 2, 6 y 8. Tenemos 8 nodos y un fragmento de tama√±o 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/6n/-w/ft6n-wgdpnlw1g5_t6thpanrtdm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ funciona la combinatoria simple. </font><font style="vertical-align: inherit;">Con una probabilidad del 54%, solo habr√° una intersecci√≥n entre los inquilinos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cg/uu/jq/cguujqg-8xjmp-cktarugsfdd6c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Vecino ruidoso" afectar√° solo a un inquilino, y no a toda la carga, sino solo al 30 por ciento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere una configuraci√≥n cercana a la real: 100 nodos, tama√±o de fragmento 5. Con una probabilidad del 77%, no habr√° intersecciones en absoluto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/14/tj/dr/14tjdrziuvtturqjld0comvzycy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fragmentaci√≥n aleatoria puede reducir significativamente el "radio de explosi√≥n". </font><font style="vertical-align: inherit;">Este enfoque se utiliza en muchos servicios de AWS.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Una flota peque√±a causa una flota grande, y no al rev√©s"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando nos recuperamos de una falla masiva, actualizamos la configuraci√≥n de muchos componentes. ¬øUna pregunta t√≠pica en este caso es empujar o vi√±etar una configuraci√≥n cambiada? ¬øQui√©n es el iniciador de los cambios: la fuente que contiene los cambios de configuraci√≥n o sus consumidores? Pero estas preguntas est√°n mal. La pregunta correcta es ¬øqu√© flota es m√°s grande? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere una situaci√≥n simple: una gran flota de m√°quinas virtuales front-end y una cierta cantidad de backends. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/av/er/vgaverdwdhgvag5w_pbichyvro0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilizamos un enfoque de malla: los grupos de instancias de front-end funcionar√°n con ciertos backends. Para hacer esto, determine la ruta: mapeo de backends y frontends que trabajan con ellos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/_a/_a/bx_a_ayxwrvjrvh9uwmaj5ifsru.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El enrutamiento est√°tico no es adecuado. Los algoritmos de hash no funcionan bien en fallas masivas, cuando necesita cambiar r√°pidamente la mayor√≠a de las rutas. Por lo tanto, es mejor usar</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enrutamiento din√°mico</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Junto a las grandes flotas de instancias de front-end y back-end, ponemos un peque√±o servicio que solo se ocupar√° del enrutamiento. √âl sabr√° y asignar√° un mapeo de backend y frontend en cualquier momento dado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/o3/kl/jio3kl9vxu3hx5p9b1uvfgxsih8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que tuvimos un gran accidente, muchas instancias de front-end cayeron. Comienzan a recuperarse masivamente y casi simult√°neamente solicitan la configuraci√≥n de mapeo del servicio de enrutamiento. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/qv/fz/ndqvfzx9d_2qn6nfnu8bpmmjrqc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peque√±o servicio de enrutamiento es bombardeado con una gran cantidad de solicitudes. No har√° frente a la carga, en el mejor de los casos, se degradar√° y, en el peor de los casos, morir√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, es correcto no solicitar cambios de configuraci√≥n de un servicio peque√±o, sino m√°s bien construir su sistema para que el "beb√©" mismo</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambios de configuraci√≥n iniciados hacia una gran flota de instancias</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/hf/gq/uahfgqlyxt-yn190bzu-q8on_rw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos el patr√≥n del trabajo constante. </font><font style="vertical-align: inherit;">Un peque√±o servicio de enrutamiento enviar√° la configuraci√≥n a todas las instancias de la flota front-end una vez cada pocos segundos. </font><font style="vertical-align: inherit;">Nunca podr√° sobrecargar un gran servicio. </font><font style="vertical-align: inherit;">El s√©ptimo patr√≥n ayuda a mejorar la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estabilidad y la resistencia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los primeros siete patrones mejoran el sistema. </font><font style="vertical-align: inherit;">El √∫ltimo patr√≥n funciona de manera diferente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ca√≠da de carga</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra un gr√°fico cl√°sico del retraso versus la carga. </font><font style="vertical-align: inherit;">En el lado derecho del gr√°fico est√° la "rodilla", cuando a cargas extremadamente altas, incluso un peque√±o aumento conduce a un aumento significativo en la latencia.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/fw/vq/sbfwvqhbni-3lzbd0gjlnorzzqi.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En modo normal, nunca llevamos nuestros servicios al lado derecho del horario. Una manera f√°cil de controlar esto es agregar recursos a tiempo. Pero nos estamos preparando para cualquier problema. Por ejemplo, podemos movernos hacia el lado derecho del gr√°fico recuper√°ndonos de una falla masiva. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ponemos el tiempo de espera del cliente en el gr√°fico. Cualquiera puede ser un cliente, por ejemplo, otro componente dentro de nuestro servicio. Por simplicidad, dibujamos un gr√°fico de retraso del percentil 50. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g5/sj/vw/g5sjvwfpnmekcg2mu-kiynw1p6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ nos enfrentamos a una situaci√≥n llamada </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apag√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Es posible que est√© familiarizado con el t√©rmino </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apag√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuando se corta la electricidad en la ciudad. Brownout es cuando algo funciona, pero es tan malo y lento que, cuenta, no funciona en absoluto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos el apag√≥n de la zona marr√≥n. El servicio recibi√≥ una solicitud del cliente, la proces√≥ y devolvi√≥ el resultado. Sin embargo, en la mitad de los casos, los clientes ya han agotado el tiempo de espera y nadie est√° esperando el resultado. En la otra mitad, el resultado regresa m√°s r√°pido que el tiempo de espera, pero en un sistema lento lleva demasiado tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos enfrentamos a un doble problema: ya estamos sobrecargados y estamos en el lado derecho del cronograma, pero al mismo tiempo todav√≠a estamos "calentando el aire", haciendo mucho trabajo in√∫til. ¬øC√≥mo evitar esto? </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encuentra la "rodilla"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el punto de inflexi√≥n en la tabla </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Medimos o estimamos te√≥ricamente. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soltar el tr√°fico</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que nos obliga a ir a la derecha del punto de inflexi√≥n </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/nz/2e/t7/nz2et7zg-cebdkle6rzusm0f0ts.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplemente debemos ignorar parte de las solicitudes. </font><font style="vertical-align: inherit;">Ni siquiera intentamos procesarlos, pero inmediatamente devolvemos un error al cliente. </font><font style="vertical-align: inherit;">Incluso con sobrecarga, podemos permitirnos esta operaci√≥n: es "barata". </font><font style="vertical-align: inherit;">Las solicitudes no se cumplen, se reduce la disponibilidad general del servicio. </font><font style="vertical-align: inherit;">Aunque las solicitudes rechazadas se procesar√°n tarde o temprano despu√©s de uno o varios reintentos de los clientes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/4n/xk/bz4nxkpmofmaqg-deszxrwhra5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, otra parte de las solicitudes se procesa con una baja latencia garantizada. </font><font style="vertical-align: inherit;">Como resultado, no hacemos un trabajo in√∫til, y lo que hacemos, lo hacemos bien.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breve resumen de los patrones de dise√±o de sistemas para fallas</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aislamiento y regulaci√≥n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A veces tiene sentido priorizar ciertos tipos de consultas. Por ejemplo, con un volumen relativamente peque√±o de solicitudes para crear nuevos recursos, se pueden colocar en la parte superior de la cola. Es importante que esto no infrinja a otros usuarios. En una interrupci√≥n masiva, los usuarios que esperan que se recuperen sus recursos no sentir√°n una diferencia significativa. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajo a tiempo completo</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Reduzca o elimine completamente el cambio de modos de servicio. Un modo, que funciona de manera estable y constante, independientemente de las situaciones de emergencia o de trabajo, mejora fundamentalmente la estabilidad y la previsibilidad del plano de Control. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escalamiento preliminar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Escale de antemano con valores de eliminaci√≥n m√°s bajos. Tendr√° que pagar un poco m√°s por esto, pero este es un seguro que vale la pena durante fallas graves del sistema. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arquitectura celular</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se prefieren muchas c√©lulas d√©bilmente acopladas sobre un monolito. El enfoque de malla reduce el "radio de explosi√≥n" y la probabilidad de errores sorpresa. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El enfoque de m√∫ltiples inquilinos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mejora significativamente la utilizaci√≥n del servicio, reduce su costo y reduce el "radio de explosi√≥n". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barajar fragmentos</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este es un enfoque que se aplica a los servicios de m√∫ltiples inquilinos. Adem√°s, le permite controlar el "radio de explosi√≥n". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Una flota peque√±a causa una flota grande, y no al rev√©s"</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Intentamos crear servicios para que los servicios peque√±os inicien cambios en configuraciones grandes. A menudo lo usamos junto con un patr√≥n de carga constante. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dejar caer la carga</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En situaciones de emergencia, tratamos de hacer solo un trabajo √∫til y hacerlo bien. Para hacer esto, descartamos parte de la carga, que todav√≠a no podemos manejar.</font></font><br>
<br>
<blockquote>  ‚Äî    ,    Saint HighLoad++ Online.  --  , Q&amp;A-,  ,    .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> -</a>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>. ,   -   . <br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  telegram- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@HighLoadChannel</a> ‚Äî         ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497322/index.html">Prueba de nivel de calidad objetiva con el mapa de viaje del cliente</a></li>
<li><a href="../es497324/index.html">"Como la ni√±a de un ojo ..." o hacemos un sistema de seguridad simple basado en un microcontrolador (Canny o Arduino) y Raspberry PI</a></li>
<li><a href="../es497326/index.html">Conectividad SSH m√°s segura con DNSSEC</a></li>
<li><a href="../es497328/index.html">Manera f√°cil de aprender un idioma (cualquiera)</a></li>
<li><a href="../es497330/index.html">Escritorio remoto de Chrome. Soporte remoto</a></li>
<li><a href="../es497334/index.html">Los errores notorios y c√≥mo evitarlos en el ejemplo de ClickHouse</a></li>
<li><a href="../es497336/index.html">Marcas de computadoras de los 90, parte 3, final</a></li>
<li><a href="../es497338/index.html">Lo que sucedi√≥ con el transporte la semana pasada: la crisis se est√° desarrollando</a></li>
<li><a href="../es497340/index.html">COVID-19: c√≥mo dejar de leer noticias y comenzar a analizar datos</a></li>
<li><a href="../es497342/index.html">Navegador en guardia de solicitudes API: construyendo una comunicaci√≥n segura entre el front-end y el back-end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>