<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóûÔ∏è üë©üèæ‚Äç‚öïÔ∏è üêë Embox RTOS en Raspberry Pi ‚òòÔ∏è üëΩ üöú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Hola! 
 
 A menudo se nos pregunta si Embox es compatible con Raspberry Pi. S√≠ hay. Descripci√≥n de c√≥mo ejecutar ahora aqu√≠ . En este art√≠culo quiero...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Embox RTOS en Raspberry Pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/494286/"><img src="https://habrastorage.org/files/c92/874/069/c92874069b4e49d4ae65eb48e6d6af19.png" alt="imagen" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hola! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A menudo se nos pregunta si </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embox es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compatible con Raspberry Pi. </font><font style="vertical-align: inherit;">S√≠ hay. </font><font style="vertical-align: inherit;">Descripci√≥n de c√≥mo ejecutar ahora </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En este art√≠culo quiero hablar un poco m√°s sobre esto.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hab√≠amos comprado la placa Raspberry Pi Model B rev 2.0 durante mucho tiempo (este es el primer Rpi 1) e incluso dimos los primeros pasos en la transferencia: el UART, el controlador de interrupci√≥n, el temporizador e incluso el framebuffer se implementaron de alguna forma. Pero los datos sobre c√≥mo comenzar se perdieron, as√≠ que tuve que recordarlo / entenderlo nuevamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, se lanzaron en el emulador QEMU. QEMU regular tiene soporte de m√°quina raspi2, pero no raspi. Pero cuando hubo un proceso de portabilidad, solo se agreg√≥ soporte raspi. Todav√≠a tenemos la versi√≥n en nuestro repositorio, aunque tuvimos que redactar confirmaciones para compilarla en el entorno moderno, pero al final obtuvimos una versi√≥n del emulador QEMU que tiene soporte para rpi1: la m√°quina "-M raspi" (puedes ver c√≥mo ejecutarla en nuestra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">Como resultado, Embox se lanz√≥ all√≠ y dibuj√≥ un gradiente en la memoria de video. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hab√≠a una pregunta sobre comenzar con hierro. </font><font style="vertical-align: inherit;">Al principio no estaba claro c√≥mo arrancar, as√≠ que decidimos probar el Raspbian est√°ndar. </font><font style="vertical-align: inherit;">2020-02-13-raspbian-buster-lite.img se descarga </font><font style="vertical-align: inherit;">del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sitio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oficial </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Todas las descargas se realizan desde una tarjeta microSD, as√≠ que la preparamos: copie la imagen resultante</font></font><pre><code class="bash hljs">dd bs=4M <span class="hljs-keyword">if</span>=2020-02-13-raspbian-buster-lite.img of=/dev/sdb conv=fsync</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donde "/ dev / sdb" es la tarjeta SD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nos fijamos en lsblk ahora, habr√° algo como esto:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
sdb      8:16   1  14,6G  0 disk <font></font>
‚îú‚îÄsdb1   8:17   1   256M  0 part <font></font>
‚îî‚îÄsdb2   8:18   1  14,3G  0 part<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montemos sdb1 y veamos qu√© hay ah√≠:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
$ sudo mount /dev/sdb1 /mnt<font></font>
$ ls /mnt/<font></font>
bcm2708-rpi-b.dtb       bcm2710-rpi-3-b.dtb       COPYING.linux  fixup_db.dat      start_db.elf<font></font>
bcm2708-rpi-b-plus.dtb  bcm2710-rpi-3-b-plus.dtb  fixup4cd.dat   fixup_x.dat       start.elf<font></font>
bcm2708-rpi-cm.dtb      bcm2710-rpi-cm3.dtb       fixup4.dat     issue.txt         start_x.elf<font></font>
bcm2708-rpi-zero.dtb    bcm2711-rpi-4-b.dtb       fixup4db.dat   kernel.img<font></font>
bcm2708-rpi-zero-w.dtb  bootcode.bin              fixup4x.dat    LICENCE.broadcom<font></font>
bcm2709-rpi-2-b.dtb     cmdline.txt               fixup_cd.dat   overlays<font></font>
bcm2710-rpi-2-b.dtb     config.txt                fixup.dat      start_cd.elf<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, hay un conjunto completo de * .dtb para todas las ocasiones, para diferentes versiones de Raspberry. </font><font style="vertical-align: inherit;">Tambi√©n vemos el gestor de arranque: bootcode.bin, y kernel.img es Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conectamos el monitor a trav√©s de HDMI a la placa, arrancamos, vimos a Raspbian, todo est√° bien. </font><font style="vertical-align: inherit;">Luego, necesitamos copiar nuestro binario con Embox a kernel.img para que el gestor de arranque lo cargue. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Construir Embox:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
make confload-arm/rpi1-model-b<font></font>
make<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copie el binario resultante:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
cp build/base/bin/embox.bin /mnt/kernel.img<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volvemos a insertar la tarjeta SD en el Rpi y activamos la alimentaci√≥n: en el monitor, el recuadro que deber√≠a haber sido dibujado por el Embox no apareci√≥. </font><font style="vertical-align: inherit;">Bueno, intentemos conectarnos a trav√©s del puerto serie y depurar nuestro binario. </font><font style="vertical-align: inherit;">Para hacer esto, use el adaptador RDC1-USB-UART. </font><font style="vertical-align: inherit;">Lo conectamos a la placa de la siguiente manera:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
RDC1      Rapi<font></font>
<font></font>
GND &lt;---&gt; GND<font></font>
5V  &lt;---&gt; 5V<font></font>
RX  &lt;---&gt; TXD0/GPIO14<font></font>
TX  &lt;---&gt; RXD0/GPIO15<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puedes ver el pinout en la imagen para que sea perdonado. Ahora resulta que la alimentaci√≥n del adaptador USB proviene del concentrador USB de la PC, y la alimentaci√≥n del Rpi, a su vez, se suministra desde el adaptador USB. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/un/ro/_l/unro_lw0ym064oh8harvubx6fhy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encender. Con√©ctese a trav√©s de minicom:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
sudo minicom -d /dev/ttyUSB0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ninguna conclusi√≥n es visible. Debe haber alg√∫n tipo de problema con el controlador del puerto serie. Intentamos deshabilitar la inicializaci√≥n del registro, y utilizamos lo que fue configurado por el gestor de arranque, rellenamos una nueva imagen en la tarjeta SD: apareci√≥ la salida. Todo est√° claro, significa que se conect√≥ correctamente, pero el controlador del puerto serie no es programable correctamente. No hablar√© sobre c√≥mo reparamos el controlador del puerto serie PL011, pero se√±alar√© un par de puntos que pueden ser √∫tiles al desarrollar para esta plataforma. En primer lugar, las direcciones base en Rpi se calculan de alguna manera confusas, no se pueden encontrar inmediatamente en la documentaci√≥n, por lo que una buena manera de verificar la direcci√≥n base de los registros es mirarlos en Linux:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
pi@raspberrypi:~$ ls /sys/bus/amba/devices/20201000.serial<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que la direcci√≥n es 0x20201000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto es que hay Linux modificado para Rpi, que se puede ensamblar y copiar en kernel.img - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.raspberrypi.org/documentation/linux/kernel/building.md</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En el caso del puerto serie, realmente ayud√≥ a comprender la frecuencia de entrada UARTCLK, necesario para programar la velocidad en baudios: simplemente inserte printk () en el lugar correcto en drivers / tty / serial / amba-pl011.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, sin cambios significativos, logramos lanzar la misma imagen que para QEMU en hierro.</font></font><img src="https://habrastorage.org/webt/gm/wm/k8/gmwmk81lk6v4yuxsqvwyfidytj0.jpeg" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablemente eso sea todo, ya que no tiene sentido desarmar las fuentes del controlador, ya que puede estudiarlas en nuestro repositorio. En general, parece que bajo Raspberry hay muy pocos puertos de otros sistemas operativos que no sean Linux. Por ejemplo, no encontr√© FreeRTOS (result√≥ que alg√∫n tipo de repositorio est√° en GitHub, pero no en lanzamientos oficiales), ni para NuttX, ni nada de eso. S√≠, y las discusiones en los foros sugieren que supuestamente no se necesita RTOS all√≠ y que es mejor jugar a Arduino - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.raspberrypi.org/forums/viewtopic.php?t=201540 El </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo de </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Osdev </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">result√≥</font></a><font style="vertical-align: inherit;"> inoperativo, as√≠ que si alguien quiere algo- luego hacerlo en metal desnudo, luego ver mejores ejemplos de nosotros :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El soporte completo para el nuevo Rpi 2/3/4 todav√≠a est√° en nuestros planes. </font><font style="vertical-align: inherit;">Pero lo m√°s probable es que se brinde apoyo como parte de GSoC 2020, una de las ideas m√°s populares entre los estudiantes. </font><font style="vertical-align: inherit;">En realidad, para GSoC, restauramos el soporte de Rpi1 en Embox. </font><font style="vertical-align: inherit;">Si alguien piensa por qu√© necesita Rpi RTOS, escriba en los comentarios, estaremos encantados :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, si estudia las fuentes de RaPi o simplemente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embox,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estaremos encantados de responder las preguntas: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bolet√≠n: embox-ru@googlegroups.com </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Telegram chat: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/embox_chat</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494270/index.html">Antig√ºedades: trabajo remoto en dispositivos de 1998</a></li>
<li><a href="../es494272/index.html">Creaci√≥n de un plan de negocio de inicio de TI: estructura detallada paso a paso</a></li>
<li><a href="../es494274/index.html">Sistema de autotest de comercio electr√≥nico</a></li>
<li><a href="../es494278/index.html">EF Core + Oracle: c√≥mo hacer que las migraciones sean idempotentes</a></li>
<li><a href="../es494284/index.html">Antis√©ptico casero de lo que hay en la farmacia. Hacemos alcohol con vodka sin alcohol a la antigua usanza</a></li>
<li><a href="../es494290/index.html">#YAMYWork. Una decisi√≥n que puede ser correcta</a></li>
<li><a href="../es494292/index.html">Wrike: 5 a√±os con OKR</a></li>
<li><a href="../es494294/index.html">Impresi√≥n 3D certificada para las industrias de petr√≥leo y gas y marina.</a></li>
<li><a href="../es494296/index.html">Xiaomi Gateway (versi√≥n de la UE - Lumi.gateway.mieu01) pirateado</a></li>
<li><a href="../es494298/index.html">Enviado para los peque√±os.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>