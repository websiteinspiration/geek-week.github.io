<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴🏻 👨‍👦‍👦 🤛🏻 Erhöhen Sie Ihre Webogram-Instanz mit Proxy über Nginx 👨🏻‍🌾 🙃 😃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 
 
 Ich bin kürzlich in eine Situation geraten, in der es notwendig war, in einem Unternehmensnetzwerk mit unvollständigem Internetzugang ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erhöhen Sie Ihre Webogram-Instanz mit Proxy über Nginx</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487174/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich bin kürzlich in eine Situation geraten, in der es notwendig war, in einem Unternehmensnetzwerk mit unvollständigem Internetzugang zu arbeiten, und wie Sie aus der Überschrift ersehen können, war das Telegramm darin blockiert. Ich bin sicher, dass diese Situation vielen bekannt ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich kann auf Boten verzichten, aber es war ein Telegramm, das ich für die Arbeit brauchte. Es war nicht möglich, den Client auf einem funktionierenden Computer zu installieren oder einen persönlichen Laptop zu verwenden. Eine andere Lösung scheint darin zu bestehen, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offizielle Webversion zu verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber wie Sie sich vorstellen können, war sie auch nicht verfügbar. Ich lösche die Option sofort mit der Suche nach einem inoffiziellen Spiegel (ich hoffe aus offensichtlichen Gründen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Glücklicherweise ist Webogram ein Open-Source-Projekt, dessen Quellcode auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">github</font></a><font style="vertical-align: inherit;"> verfügbar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sein Autor (wofür ich ihm vielmals danke!) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Installation und der Start selbst sind keine große Sache. Unter Betriebsbedingungen innerhalb des Netzwerks mit blockiertem Zugriff auf Telegrammserver werden Sie jedoch eher enttäuscht als erfolgreich sein, da die Webversion Anfragen nach sendet Telegrammserver vom Computer des Benutzers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Glücklicherweise ist dies recht einfach (aber nicht sehr offensichtlich) zu beheben. Ich möchte Sie warnen, dass ich nicht der Autor dieser Lösung bin. Ich habe es in einem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thread gefunden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in dem ein ähnliches Problem wie </font><font style="vertical-align: inherit;">ich </font><font style="vertical-align: inherit;">besprochen wurde. Die vom Benutzer github </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tecknojock</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorgeschlagene Lösung </font><font style="vertical-align: inherit;">hat mir sehr geholfen. Ich bin mir jedoch sicher, dass sie jemand anderem helfen kann. </font><font style="vertical-align: inherit;">Deshalb </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">habe</font></a><font style="vertical-align: inherit;"> ich beschlossen, dieses Tutorial zu schreiben.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter der Katze finden Sie eine schrittweise Konfiguration Ihres Webogram-Spiegels und Proxy-Einstellungen seiner Anforderungen an Telegrammserver mit nginx.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Beispiel habe ich den gerade installierten und aktualisierten Ubuntu Server 18.04.3 ausgewählt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In diesem Lernprogramm finden Sie keine Anweisungen zum Einrichten einer Domain in Nginx. Dies muss unabhängig erfolgen. In diesem Lernprogramm wird davon ausgegangen, dass Sie bereits eine Domain mit ssl konfiguriert haben und der Server, auf dem Sie konfigurieren möchten, Zugriff auf Telegrammserver hat (wie Sie </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
möchten </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Angenommen, die IP-Adresse dieses Servers lautet 10.23.0.3 und der Domainname lautet mywebogram. localhost </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend auf diesen Konventionen werde ich Beispiele für Konfigurationen geben. Vergessen Sie nicht, die Werte in Ihre eigenen zu ändern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
los geht's </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Um Webogram auszuführen, benötigen wir nodejs. Wenn Sie es standardmäßig aus den Ubuntu-Repositorys installieren, erhalten wir standardmäßig nodejs Version 8.x. Wir brauchen 12.x:</font></font><br>
<br>
<pre><code class="bash hljs">curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - <font></font>
sudo apt update &amp;&amp; sudo apt -y install nodejs</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wählen den Ort, an dem unser Webogramm basiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Beispiel - wir werden es in einem Stammverzeichnis eines Home-Verzeichnisses ablegen. </font><font style="vertical-align: inherit;">Dazu klonen wir das offizielle Repository auf unseren Server:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> ~ &amp;&amp; git <span class="hljs-built_in">clone</span> https://github.com/zhukov/webogram.git</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste Schritt besteht darin, alle zum Ausführen der Anwendung erforderlichen Abhängigkeiten zu installieren:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> webogram &amp;&amp; npm install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen wir, einen Testlauf durchzuführen. </font><font style="vertical-align: inherit;">Führen Sie den folgenden Befehl aus:</font></font><br>
<br>
<pre><code class="bash hljs">npm start</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach versuchen wir im Browser zu öffnen </font></font><br>
<br>
<pre><code class="bash hljs"> http://10.23.0.3:8000/app/index.html</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie bis zu diesem Zeitpunkt alles richtig gemacht haben, wird Ihre Webogramm-Autorisierungsseite geöffnet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen wir den Start der Anwendung als Dienst konfigurieren. </font><font style="vertical-align: inherit;">Erstellen Sie dazu eine Datei</font></font><br>
<br>
<pre><code class="bash hljs">sudo touch /lib/systemd/system/webogram.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie es in einem beliebigen Editor und sehen Sie folgendermaßen aus (geben Sie Ihren Pfad zu WorkDirectory ein).</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=Webogram mirror<font></font>
[Service]<font></font>
WorkingDirectory=/home/tg/webogram<font></font>
ExecStart=/usr/bin/npm start<font></font>
SuccessExitStatus=143<font></font>
TimeoutStopSec=10<font></font>
Restart=on-failure<font></font>
RestartSec=5<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann führen wir die folgenden Befehle aus: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Übernehmen Sie die Änderungen</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autostart einschalten:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl <span class="hljs-built_in">enable</span> webogram.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten den Service:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl start webogram.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Abschluss der Schritte ist das Webogramm weiterhin auf Port 8000 verfügbar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir den Zugriff auf unser Webogramm über nginx konfigurieren, schließen wir Port 8000 für Anfragen von außerhalb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verwenden dazu das Dienstprogramm udf (oder eine für Sie geeignete Methode):</font></font><br>
<br>
<pre><code class="bash hljs">sudo ufw deny 8000</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falls Sie sich immer noch für udf entscheiden, es aber auf dem Server deaktiviert ist, fügen Sie weitere Regeln hinzu (damit nicht alles auseinander fällt) und aktivieren Sie udf:</font></font><br>
<br>
<pre><code class="bash hljs">sudo ufw allow ssh<font></font>
sudo ufw allow 80<font></font>
sudo ufw allow 443<font></font>
sudo ufw <span class="hljs-built_in">enable</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes ändern wir die Nginx-Konfiguration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ich oben gewarnt habe, wird davon ausgegangen, dass auf Ihrem Server bereits eine Domain mit SSL konfiguriert ist. </font><font style="vertical-align: inherit;">Ich werde Ihre Aufmerksamkeit nur auf die Tatsache lenken, dass es notwendig ist, die Konfigurationsdatei der Domäne für den korrekten Betrieb hinzuzufügen:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
server {<font></font>
...<font></font>
  location ^~ /pluto/apiw1/ {<font></font>
    proxy_pass https://pluto.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /venus/apiw1/ {<font></font>
    proxy_pass https://venus.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /aurora/apiw1/ {<font></font>
    proxy_pass https://aurora.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /vesta/apiw1/ {<font></font>
    proxy_pass https://vesta.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /flora/apiw1/ {<font></font>
    proxy_pass https://flora.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /pluto-1/apiw1/ {<font></font>
    proxy_pass https://pluto-1.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /venus-1/apiw1/ {<font></font>
    proxy_pass https://venus-1.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /aurora-1/apiw1/ {<font></font>
    proxy_pass https://aurora-1.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /vesta-1/apiw1/ {<font></font>
    proxy_pass https://vesta-1.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /flora-1/apiw1/ {<font></font>
    proxy_pass https://flora-1.web.telegram.org/apiw1/;<font></font>
  }<font></font>
  location ^~ /DC1/ {<font></font>
    proxy_pass http://149.154.175.10:80/;<font></font>
  }<font></font>
  location ^~ /DC2/ {<font></font>
    proxy_pass http://149.154.167.40:80/;<font></font>
  }<font></font>
  location ^~ /DC3/ {<font></font>
    proxy_pass http://149.154.175.117:80/;<font></font>
  }<font></font>
  location ^~ /DC4/ {<font></font>
    proxy_pass http://149.154.175.50:80/;<font></font>
  }<font></font>
  location ^~ /DC5/ {<font></font>
    proxy_pass http://149.154.167.51:80/;<font></font>
  }<font></font>
  location ^~ /DC6/ {<font></font>
    proxy_pass http://149.154.175.100:80/;<font></font>
  }<font></font>
  location ^~ /DC7/ {<font></font>
    proxy_pass http://149.154.167.91:80/;<font></font>
  }<font></font>
  location ^~ /DC8/ {<font></font>
    proxy_pass http://149.154.171.5:80/;<font></font>
  }<font></font>
 location / {<font></font>
    auth_basic <span class="hljs-string">"tg"</span>;<font></font>
    auth_basic_user_file /etc/nginx/passwd.htpasswd;<font></font>
    proxy_pass http://localhost:8000/;<font></font>
    proxy_read_timeout 90s;<font></font>
    proxy_connect_timeout 90s;<font></font>
    proxy_send_timeout 90s;<font></font>
    proxy_set_header Host <span class="hljs-variable">$http_host</span>;<font></font>
    proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<font></font>
    proxy_set_header X-Forwarded-For <span class="hljs-variable">$remote_addr</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was wir der Nginx-Konfiguration hinzufügen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir ändern den Stammspeicherort, der Anfragen an Port 8000 weiterleitet, auf den Webogram antwortet</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schließen Sie den Stammspeicherort mit basic-auth. </font><font style="vertical-align: inherit;">Dies ist ein rein symbolischer Schritt, um unsere Anwendung vor neugierigen Blicken und Bots zu schützen. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Und auch, dass es keine Probleme mit Schlössern gab)</font></font></s></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Speicherortheap mit proxy_path auf dem Telegrammserver ist nur unser Endpunkt, über den wir unsere Anforderungen weiterleiten </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie außerdem eine Datei, </font></font><code>/etc/nginx/passwd.htpasswd;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">damit nginx Benutzerkennwörter vergleichen kann.</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install apache2-utils<font></font>
sudo htpasswd -c /etc/nginx/passwd.htpasswd tg</code></pre><br>
<img src="https://habrastorage.org/webt/i6/yy/18/i6yy182bp4w4sbynldld7_ml3wu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starten Sie nginx neu:</font></font><br>
<br>
<pre><code class="bash hljs">sudo systemctl restart nginx</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist das Webogramm nur unter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mywebogram.localhost / app / index.html verfügbar,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nachdem die Anmeldung und das Kennwort eingegeben wurden, die Sie beim Erstellen des Befehls htpasswd definiert haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt wenig übrig: Nehmen Sie kleine Änderungen am Projekt selbst vor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie die Datei im Editor </font></font><code>~/webogram/app/js/lib/mtproto.js</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und bringen Sie den Anfang in das folgende Formular:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">/*!
 * Webogram v0.7.0 - messaging web application for MTProto
 * https://github.com/zhukov/webogram
 * Copyright (C) 2014 Igor Zhukov &lt;igor.beatle@gmail.com&gt;
 * https://github.com/zhukov/webogram/blob/master/LICENSE
 */</span><font></font>
<font></font>
angular.module(<span class="hljs-string">'izhukov.mtproto'</span>, [<span class="hljs-string">'izhukov.utils'</span>])<font></font>
<font></font>
  .factory(<span class="hljs-string">'MtpDcConfigurator'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> sslSubdomains = [<span class="hljs-string">'pluto'</span>, <span class="hljs-string">'venus'</span>, <span class="hljs-string">'aurora'</span>, <span class="hljs-string">'vesta'</span>, <span class="hljs-string">'flora'</span>]<font></font>
<font></font>
    <span class="hljs-keyword">var</span> dcOptions = Config.Modes.test<font></font>
      ? [<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC1'</span>,  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC2'</span>,  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC3'</span>, <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>}<font></font>
      ]<font></font>
      : [<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC4'</span>,  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC5'</span>,  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC6'</span>, <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC7'</span>,  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>},<font></font>
        {<span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">'mywebogram.localhost/DC8'</span>,   <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>}<font></font>
      ]<font></font>
<font></font>
    <span class="hljs-keyword">var</span> chosenServers = {}<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chooseServer</span> (<span class="hljs-params">dcID, upload</span>) </span>{
      <span class="hljs-keyword">if</span> (chosenServers[dcID] === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">var</span> chosenServer = <span class="hljs-literal">false</span>,<font></font>
          i, dcOption<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Config.Modes.ssl || !Config.Modes.http) {
          <span class="hljs-keyword">var</span> subdomain = sslSubdomains[dcID - <span class="hljs-number">1</span>] + (upload ? <span class="hljs-string">'-1'</span> : <span class="hljs-string">''</span>)
          <span class="hljs-keyword">var</span> path = Config.Modes.test ? <span class="hljs-string">'apiw_test1'</span> : <span class="hljs-string">'/apiw1/'</span>
          chosenServer = <span class="hljs-string">'https://mywebogram.localhost/'</span> + subdomain + path
          <span class="hljs-keyword">return</span> chosenServer<font></font>
        }<font></font>
       <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; dcOptions.length; i++) {<font></font>
          dcOption = dcOptions[i]<font></font>
          <span class="hljs-keyword">if</span> (dcOption.id == dcID) {<font></font>
            chosenServer = <span class="hljs-string">'http://'</span> + dcOption.host + <span class="hljs-string">'/apiw1'</span>
            <span class="hljs-keyword">break</span><font></font>
          }<font></font>
        }<font></font>
        chosenServers[dcID] = chosenServer<font></font>
      }<font></font>
...<font></font>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach müssen Sie die Seite mit der Anwendung im Browser aktualisieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Öffnen Sie die Browserkonsole und sehen Sie sich die Netzwerkanforderungen der Anwendung an. </font><font style="vertical-align: inherit;">Wenn alles funktioniert und XHR-Anforderungen an Ihren Server gesendet werden, wird alles korrekt ausgeführt, und Webogram wird jetzt über nginx übertragen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1n/k8/g-/1nk8g-spk2c1egtmwbo5t8xn-vk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hoffe, dass dieses Tutorial für andere als mich nützlich sein wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank an alle, die bis zum Ende gelesen haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn jemand irgendwelche Schwierigkeiten hat oder ich einige Ungenauigkeiten gemacht habe, werde ich gerne antworten und versuchen, Ihnen in den Kommentaren oder der PM zu helfen.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487146/index.html">ResizeObserver - ein neues leistungsstarkes Tool zum Arbeiten mit Anpassungsfähigkeit</a></li>
<li><a href="../de487154/index.html">Erkundung des Sand-Shaders des Journey-Spiels</a></li>
<li><a href="../de487162/index.html">Brauchen moderne Geschäftsleute und Unternehmen Privatsphäre?</a></li>
<li><a href="../de487168/index.html">Toxic Grandfather Interface Tales "Instrumental Trash" (s1 e2)</a></li>
<li><a href="../de487172/index.html">Offener Kurs "Deep Learning in NLP" von den Machern von DeepPavlov basierend auf dem Kurs cs224n</a></li>
<li><a href="../de487176/index.html">Halten Sie COVID-19 gedrückt. Alles über pandemische Luftfiltration</a></li>
<li><a href="../de487178/index.html">Timlid Marktforschung in Russland</a></li>
<li><a href="../de487182/index.html">So erstellen Sie eine API für eine beliebige Android-Anwendung. Zum Beispiel WhatsApp</a></li>
<li><a href="../de487184/index.html">Wie ich an Samsung "Smart" TV erinnerte - erweiterte Überprüfung</a></li>
<li><a href="../de487186/index.html">Ich habe den Quellcode meiner ersten Webanwendung veröffentlicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>