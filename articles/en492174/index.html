<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèì üçï üç¢ Wireless DIY Soil Moisture Monitor üßòüèª üìÅ üòå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all readers of Habr! Today I want to share with you my new project - a wireless soil moisture sensor, which is built on the basis of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wireless DIY Soil Moisture Monitor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492174/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Greetings to all readers of Habr! Today I want to share with you my new project - a wireless soil moisture sensor, which is built on the basis of the well-known soil moisture module with aliexpress. The new sensor is a logical continuation of my first DIY project on this topic. But in the new implementation, this is no longer an arduino module, but a complete device with its own case. So, porridge from the ax, part two! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k9/ea/gd/k9eagdijc2lxr-garqi6eooxuxm.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Chinese soil moisture measurement module is built on a 555 timer. The measurement method is capacitive. For my project, I needed a version of the module with the XC6206P332 voltage regulator installed at 3.3V, which in the future will have to be removed from the module board. The fact is that in such versions we use a modification of the TLC555 timer with a lower threshold for power supply of 2V. In versions without a stabilizer, NE555 timers are used with a lower power threshold of 5V. But in any case, what is easier to buy for repeating this project is a repeater's business. In the first option, we solder the voltage regulator, in the second we change the timer, for example to one like this - LMC555 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">datasheet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) working even from 1.5V. For the wireless module to the Chinese soil moisture sensor, I chose a radio module from EBYTE E73C on which the nRF52840 chip is installed. The argument was the price of the module and the available amount of these modules in my reserves. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e4/c4/3t/e4c43tfn22ihs1-ywelmsoikjwq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The wireless module turned out to be very simple, RGB LED, a couple of buttons, a field effect transistor, a battery. Even the most inexperienced beginner solder can assemble such a device. On the humidity sensor, in addition to removing the voltage stabilizer, it is also necessary to unsolder the connector and solder the 3P male plug in its place, step 2.54 mm. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The dimensions of the board turned out to be slightly smaller than in the first project - 42x29mm, determined by the size of the battery holder.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tw/oq/sj/twoqsjaebwgnyxb9xl1lzao174m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The case was printed on my ANYCUBIC household SLA printer. The printing time for parts is about a couple of hours. Subsequent post processing took about half an hour. The cost of spent polymer resin is ~ 100r. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consumption in sleep mode - 4.7mA, in transmission mode 8mA. The measurement interval is variable, step 1 minute. Measurement time 50ms (5 measurements in the test program), consumption during measurement ~ 1 mA. It also measures the temperature of the chip, measures the battery level. Data transfer to the UD controller through the Mysensors network, data transfer to the UD controller through the Zigbee network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code of the test programs is on my Github. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example of working in the Mysensors network and the Mazhordomo UD. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/cx/xc/4tcxxc4zmsos7jw_bpb0k_rojc4.png"><br>
<br>
<img src="https://habrastorage.org/webt/lg/ni/c8/lgnic80mcvhmva1ifxmjr_afluy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example of working on the ZigBee network and the Mazhordomo UD</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ev/-q/bv/ev-qbvfynpoemmo0w5l7iijqnvw.png"><br>
<br>
<img src="https://habrastorage.org/webt/dh/m6/yh/dhm6yhm6l7o6btdqyfhq2onmlpo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The converter configuration code in the zigbee2mqtt module for the humidity sensor (not sure yet that this is the right solution). </font></font><br>
<br>
<pre><code class="javascript hljs">{
        <span class="hljs-attr">zigbeeModel</span>: [<span class="hljs-string">'nrf52840.ru_PWS'</span>],
        <span class="hljs-attr">model</span>: <span class="hljs-string">'nrf52840.ru_PWS'</span>,
        <span class="hljs-attr">vendor</span>: <span class="hljs-string">'nrf52840.ru'</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">'Plant watering sensor'</span>,
        <span class="hljs-attr">supports</span>: <span class="hljs-string">'humidity'</span>,
		<span class="hljs-attr">fromZigbee</span>: [fz.humidity2, fz.battery_PWS],
        <span class="hljs-attr">toZigbee</span>: [],
		<span class="hljs-attr">meta</span>: {<span class="hljs-attr">configureKey</span>: <span class="hljs-number">1</span>},
        <span class="hljs-attr">configure</span>: <span class="hljs-keyword">async</span> (device, coordinatorEndpoint) =&gt; {
            <span class="hljs-keyword">const</span> endpoint = device.getEndpoint(<span class="hljs-number">10</span>);
			<span class="hljs-keyword">await</span> bind(endpoint, coordinatorEndpoint, [<span class="hljs-string">'msRelativeHumidity'</span>, <span class="hljs-string">'genPowerCfg'</span>]);
            <span class="hljs-keyword">await</span> configureReporting.humidity(endpoint);
			<span class="hljs-keyword">await</span> configureReporting.batteryVoltage(endpoint);<font></font>
        },<font></font>
    },<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/vs/iv/6f/vsiv6fyhbwc0ns9spmifwe1a5g8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Test firmware was written by one of the participants in our DIY community - Lenz, here is his </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIthub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The cost of the components that had to be added to the Chinese moisture meter was about 400-500 rubles. </font><font style="vertical-align: inherit;">In my opinion it‚Äôs quite good. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor operation video</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LTzc0X-ESm4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor Photo</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/pw/is/l2/pwisl2sjbuwgpytlnqtttmikphc.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/oq/12/oi/oq12oihawzfhxgkf9topgaaohgq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/da/sk/h7/daskh7kfgzsgkqsgytolve37ixg.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yo/nu/34/yonu34vue48s2vdub5vlil9fdne.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/rv/kd/va/rvkdvaawgrkepxu2tb5ho5dmw4c.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z2/ez/pg/z2ezpg7vbscf6w68ucainaan0b0.jpeg"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Further plans for this project. I would like to replace the MK with something simpler, for example, with nRF52810 or nRF52811, but everything will depend on the price, most likely you will have to abandon the radio modules and just make it on a chip. Perhaps I‚Äôll think about adding a buzzer, it‚Äôs very likely the power stabilizer, since now you need to take into account the supply voltage when measuring. Bring the Zigbee version to a stable state, make the BLE version, make a mobile display application. In general, there will definitely be something else. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github of this project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
If you are interested in this project, I propose to go to the telegram group, there will always be assistance in mastering the Maysensors, Zigbee, BLE protocol on nRF5, they will help to master nRF52 programming in Arduino IDE and not only in it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cart Chat - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@DIY Devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cart Chat - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@MySensors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492162/index.html">Eye Interfaces. Report in Yandex</a></li>
<li><a href="../en492164/index.html">Gateway to the sky, or the city of the future</a></li>
<li><a href="../en492166/index.html">Widgets on Android. A rare feature to figure out</a></li>
<li><a href="../en492168/index.html">Front work on the backend development of the largest portals on open source software: sharing experience</a></li>
<li><a href="../en492172/index.html">Thin backup of Linux file systems. How to create working copies of a three-terabyte MySQL DBMS in 20 seconds</a></li>
<li><a href="../en492178/index.html">A seven-thousand-pixel path: evolution of monitor resolutions and our requirements</a></li>
<li><a href="../en492182/index.html">Information Security Fundamentals at Microsoft Teams</a></li>
<li><a href="../en492184/index.html">Forbes talked with market representatives about the mandatory preinstallation of Russian software. We selected the main points</a></li>
<li><a href="../en492186/index.html">Popularly about articles in English</a></li>
<li><a href="../en492190/index.html">Russian SaaS 2019 - results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>