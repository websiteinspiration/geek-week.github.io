<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüéì üë©üèæ üë¶üèæ Analyze your builds programmatically with the C ++ Build Insights SDK ‚öúÔ∏è ‚úãüèª ü•É</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are pleased to announce the release of the¬† C ++ Build Insights SDK , a framework that gives you access to MSVC build time information through the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Analyze your builds programmatically with the C ++ Build Insights SDK</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/492336/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are pleased to announce the release of the&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Build Insights SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a framework that gives you access to MSVC build time information through the C and C ++ APIs. </font><font style="vertical-align: inherit;">In addition to this release, we are publishing&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vcperf open source on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Since vcperf itself is built using the SDK, you can use it as a reference when developing your own tools. </font><font style="vertical-align: inherit;">We will be glad to see which applications you will create using the SDK, and we look forward to your feedback!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yc/iy/i8/yciyi8hvnc5-mmakcc9qfp_5avc.png"><a name="habracut"></a><br>
<br>
<h2><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Background</font></font></strong></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Last November, we introduced </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vcperf and its Windows Performance Analyzer (WPA) plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which help MSVC users understand their build time. Both components were announced under the auspices of C ++ Build Insights. But what is C ++ Build Insights? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In November, we already said that C ++ Build Insights is based on&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Event Tracing for Windows</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;(ETW), a convenient tracing mechanism available on the Windows operating system. But ETW was not enough to scale our technology to the very large C ++ builds made by our customers. We needed to fine-tune the event model and the analysis algorithms used. The result of this work is a new data analysis platform for MSVC, which we now call C ++ Build Insights.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Today, the C ++ Build Insights platform is what vcperf and some of our internal tools support. </font><font style="vertical-align: inherit;">Nevertheless, we wanted to give all of you the opportunity to benefit from this. </font><font style="vertical-align: inherit;">To do this, we assembled it with the C and C ++ interfaces to create a complete software development kit.</font></font><br>
<br>
<h2><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get started with the C ++ Build Insights SDK</font></font></strong></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use the C ++ Build Insights SDK to create custom tools that fit your scripts:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyze traces programmatically, not through WPA.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add build time analysis to your continuous integration (CI).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or just have some fun!</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here's how you can get started with the SDK. </font><font style="vertical-align: inherit;">This example shows how to create a program that lists functions that take more than 500 milliseconds to create.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dy/1c/l9/dy1cl9smsmgbtkg25cf-qkg4yt8.png"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download and install a copy of&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visual Studio 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li>  (trace)  .<br>
<ol>
<li>   x64 Native Tools  VS 2019.</li>
<li>  :&nbsp;vcperf /start MySessionName</li>
<li>   C++   ,   Visual Studio (vcperf      ).</li>
<li>  :&nbsp;vcperf /stopnoanalyze MySessionName outputFile.etl.    (trace)     outputFile.etl.</li>
</ol><br>
</li>
<li> Visual Studio     C++.</li>
<li>       ,  ¬´  NuGet‚Ä¶¬ª     Microsoft.Cpp.BuildInsights NuGet    nuget.org.     .</li>
<li>  .</li>
<li>  ,    outputFile.etl    .</li>
</ol><br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;CppBuildInsights.hpp&gt;</span></span><font></font>
 <font></font>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> Microsoft::Cpp::BuildInsights;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> Activities;<font></font>
 <font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LongCodeGenFinder</span> :</span> <span class="hljs-keyword">public</span> IAnalyzer<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">//     ,    </span>
    <span class="hljs-comment">//    (trace). </span>
    <span class="hljs-function">AnalysisControl <span class="hljs-title">OnStopActivity</span><span class="hljs-params">(<span class="hljs-keyword">const</span> EventStack&amp; eventStack)</span> <span class="hljs-keyword">override</span>
    </span>{
        <span class="hljs-comment">// ,    </span>
        <span class="hljs-comment">//  TopFunctionsFinder::CheckForTopFunction's.</span>
        <span class="hljs-comment">//   ,     .</span><font></font>
 <font></font>
        MatchEventStackInMemberFunction(eventStack, <span class="hljs-keyword">this</span>, <font></font>
            &amp;LongCodeGenFinder::CheckForLongFunctionCodeGen);<font></font>
 <font></font>
        <span class="hljs-comment">//       </span><font></font>
 <font></font>
        <span class="hljs-keyword">return</span> AnalysisControl::CONTINUE;<font></font>
    }<font></font>
 <font></font>
    <span class="hljs-comment">//        , </span>
    <span class="hljs-comment">//  CodeGeneration,     ,</span>
    <span class="hljs-comment">//      500 .</span><font></font>
 <font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CheckForLongFunctionCodeGen</span><span class="hljs-params">(CodeGeneration cg, Function f)</span>
    </span>{
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>::chrono;<font></font>
 <font></font>
        <span class="hljs-keyword">if</span> (f.Duration() &lt; milliseconds(<span class="hljs-number">500</span>)) {
            <span class="hljs-keyword">return</span>;<font></font>
        }<font></font>
 <font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Duration: "</span> &lt;&lt; duration_cast&lt;milliseconds&gt;(<font></font>
            f.Duration()).count();<font></font>
 <font></font>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"\t Function Name: "</span> &lt;&lt; f.Name() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<font></font>
    }<font></font>
};<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
    <span class="hljs-keyword">if</span> (argc &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
 <font></font>
    LongCodeGenFinder lcgf;<font></font>
 <font></font>
    <span class="hljs-comment">//    ,       (trace).     ; !</span>
    <span class="hljs-keyword">auto</span> group = MakeStaticAnalyzerGroup(&amp;lcgf);<font></font>
 <font></font>
    <span class="hljs-comment">// argv[1]      </span>
    <span class="hljs-keyword">int</span> numberOfPasses = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> Analyze(argv[<span class="hljs-number">1</span>], numberOfPasses, group);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cloned and embedded version of this example is also available in our&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub repository with C ++ Build Insights examples. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that you can also get the trace programmatically, and not through vcperf, using the SDK. </font><font style="vertical-align: inherit;">See the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Build Insights SDK white papers for more</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> details </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vcperf is now open source</font></font></strong></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vcperf itself is created using the C ++ Build Insights SDK, and we&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make it open-source on GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We hope you can use it to learn more about the SDK and customize vcperf to your needs. </font><font style="vertical-align: inherit;">The repository includes&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an example commit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that extends vcperf to detect linkers that were restarted due to errors. </font><font style="vertical-align: inherit;">The example highlights these calls in the C ++ Build Insights' Build Explorer view in WPA. </font><font style="vertical-align: inherit;">We recommend reading this commit example in the following order:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RestartedLinkerDetector.h</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildExplorerView.cpp</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commands.cpp</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The reason you might want to build and run vcperf from GitHub today is to access new events that are not yet supported in the released version of vcperf, including new template creation events. </font><font style="vertical-align: inherit;">Please note that vcperf is not tied to any specific version of Visual Studio, but new events are only supported in Visual Studio 2019 version 16.4 and higher. </font><font style="vertical-align: inherit;">Here is the updated event table:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fp/vh/sk/fpvhskjz-oosdomvw8dubhjqxzk.png"><br>
<br>
<h2><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Share your opinion</font></font></strong></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We hope you enjoy the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ Build Insights SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> release&nbsp; </font><font style="vertical-align: inherit;">, as well as the open source version of vcperf.&nbsp;</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download Visual Studio 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;today and get started on the first C ++ Build Insights app.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492322/index.html">Raspberry Pi + Fedora (aarch64) = Wi-Fi Hotspot (or a raspberry router in a blue hat)</a></li>
<li><a href="../en492324/index.html">We discuss the EARN IT Act - a new US bill that could lead to a ban on E2E encryption</a></li>
<li><a href="../en492326/index.html">Analysis of the popularity of YouTube videos of Eurovision 2020 participants</a></li>
<li><a href="../en492328/index.html">Continuous integration and deployment of desktop applications with GitHub Actions</a></li>
<li><a href="../en492332/index.html">Build apps for free with Azure Cosmos DB Free Tier</a></li>
<li><a href="../en492338/index.html">Weekend Reading: 10 materials on Easter eggs, rhythm games and free audio samples</a></li>
<li><a href="../en492342/index.html">Life and work under national quarantine</a></li>
<li><a href="../en492350/index.html">IT emigration to New Zealand</a></li>
<li><a href="../en492352/index.html">Gnuplot 5.0. DIY 4-axis spiderplot</a></li>
<li><a href="../en492354/index.html">History of Speech Synthesizers: The Computer Age</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>